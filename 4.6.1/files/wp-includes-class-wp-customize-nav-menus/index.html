<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.6.1" data-type="file" data-id="4543"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-class-wp-customize-nav-menus | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.6.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.8"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=7ea17311fb90a6b16561dd194dd64d6a' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.8' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-class-wp-customize-nav-menus/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-class-wp-customize-nav-menus%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-class-wp-customize-nav-menus%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.6.1-file-wp-includes-class-wp-customize-nav-menus","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-class-wp-customize-nav-menus" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.6.1." href="http://hookr.io/4.6.1/" class="H_VERSION"><span property="name">4.6.1</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-class-wp-customiz&hellip;</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6118"><a href="http://hookr.io/4.6.1/all/" title="All">All <span class="count badge">6118</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.6.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2420"><a href="http://hookr.io/4.6.1/hooks/" title="Hooks">Hooks <span class="count badge">2420</span></a></li><li class="" data-id="action" data-count="835"><a href="http://hookr.io/4.6.1/actions/" title="Actions">Actions <span class="count badge">835</span></a></li><li class="" data-id="filter" data-count="1585"><a href="http://hookr.io/4.6.1/filters/" title="Filters">Filters <span class="count badge">1585</span></a></li><li class="" data-id="class" data-count="329"><a href="http://hookr.io/4.6.1/classes/" title="Classes">Classes <span class="count badge">329</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.6.1/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2795"><a href="http://hookr.io/4.6.1/functions/" title="Functions">Functions <span class="count badge">2795</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.6.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/class-wp-customize-nav-menus.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress Customize Nav Menus classes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Customize</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Customize Nav Menus class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Implements menu management in the Customizer.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see WP_Customize_Manager</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>final class WP_Customize_Nav_Menus {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * WP_Customize_Manager instance.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var WP_Customize_Manager</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $manager;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Previewed Menus.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $previewed_menus;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param object $manager An instance of the WP_Customize_Manager class.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct( $manager ) {&nbsp;</div></li><li><div>      $this-&gt;previewed_menus = array();&nbsp;</div></li><li><div>      $this-&gt;manager = $manager;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Skip useless hooks when the user can't manage nav menus anyway.</span>&nbsp;</div></li><li><div>      if ( ! current_user_can( 'edit_theme_options' ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'customize_refresh_nonces', array( $this, 'filter_nonces' ) );&nbsp;</div></li><li><div>      add_action( 'wp_ajax_load-available-menu-items-customizer', array( $this, 'ajax_load_available_items' ) );&nbsp;</div></li><li><div>      add_action( 'wp_ajax_search-available-menu-items-customizer', array( $this, 'ajax_search_available_items' ) );&nbsp;</div></li><li><div>      add_action( 'customize_controls_enqueue_scripts', array( $this, 'enqueue_scripts' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Needs to run after core Navigation section is set up.</span>&nbsp;</div></li><li><div>      add_action( 'customize_register', array( $this, 'customize_register' ), 11 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'customize_dynamic_setting_args', array( $this, 'filter_dynamic_setting_args' ), 10, 2 );&nbsp;</div></li><li><div>      add_filter( 'customize_dynamic_setting_class', array( $this, 'filter_dynamic_setting_class' ), 10, 3 );&nbsp;</div></li><li><div>      add_action( 'customize_controls_print_footer_scripts', array( $this, 'print_templates' ) );&nbsp;</div></li><li><div>      add_action( 'customize_controls_print_footer_scripts', array( $this, 'available_items_template' ) );&nbsp;</div></li><li><div>      add_action( 'customize_preview_init', array( $this, 'customize_preview_init' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Selective Refresh partials.</span>&nbsp;</div></li><li><div>      add_filter( 'customize_dynamic_partial_args', array( $this, 'customize_dynamic_partial_args' ), 10, 2 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds a nonce for customizing menus.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $nonces Array of nonces.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array $nonces Modified array of nonces.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function filter_nonces( $nonces ) {&nbsp;</div></li><li><div>      $nonces['customize-menus'] = wp_create_nonce( 'customize-menus' );&nbsp;</div></li><li><div>      return $nonces;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Ajax handler for loading available menu items.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function ajax_load_available_items() {&nbsp;</div></li><li><div>      check_ajax_referer( 'customize-menus', 'customize-menus-nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! current_user_can( 'edit_theme_options' ) ) {&nbsp;</div></li><li><div>          wp_die( -1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $_POST['type'] ) || empty( $_POST['object'] ) ) {&nbsp;</div></li><li><div>          wp_send_json_error( 'nav_menus_missing_type_or_object_parameter' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $type = sanitize_key( $_POST['type'] );&nbsp;</div></li><li><div>      $object = sanitize_key( $_POST['object'] );&nbsp;</div></li><li><div>      $page = empty( $_POST['page'] ) ? 0 : absint( $_POST['page'] );&nbsp;</div></li><li><div>      $items = $this-&gt;load_available_items_query( $type, $object, $page );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_wp_error( $items ) ) {&nbsp;</div></li><li><div>          wp_send_json_error( $items-&gt;get_error_code() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_send_json_success( array( 'items' =&gt; $items ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Performs the post_type and taxonomy queries for loading available menu items.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type   Optional. Accepts any custom object type and has built-in support for</span>&nbsp;</div></li><li><div><span class="comment">   *                         'post_type' and 'taxonomy'. Default is 'post_type'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $object Optional. Accepts any registered taxonomy or post type name. Default is 'page'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $page   Optional. The page number used to generate the query offset. Default is '0'.</span>&nbsp;</div></li><li><div><span class="comment">   * @return WP_Error|array Returns either a WP_Error object or an array of menu items.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function load_available_items_query( $type = 'post_type', $object = 'page', $page = 0 ) {&nbsp;</div></li><li><div>      $items = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'post_type' === $type ) {&nbsp;</div></li><li><div>          $post_type = get_post_type_object( $object );&nbsp;</div></li><li><div>          if ( ! $post_type ) {&nbsp;</div></li><li><div>              return new WP_Error( 'nav_menus_invalid_post_type' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 0 === $page && 'page' === $object ) {&nbsp;</div></li><li><div>              <span class="comment">// Add &quot;Home&quot; link. Treat as a page, but switch to custom on add.</span>&nbsp;</div></li><li><div>              $items[] = array(&nbsp;</div></li><li><div>                  'id' =&gt; 'home', &nbsp;</div></li><li><div>                  'title' =&gt; _x( 'Home', 'nav menu home label' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'custom', &nbsp;</div></li><li><div>                  'type_label' =&gt; __( 'Custom Link' ), &nbsp;</div></li><li><div>                  'object' =&gt; '', &nbsp;</div></li><li><div>                  'url' =&gt; home_url(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          } elseif ( 'post' !== $object && 0 === $page && $post_type-&gt;has_archive ) {&nbsp;</div></li><li><div>              <span class="comment">// Add a post type archive link.</span>&nbsp;</div></li><li><div>              $items[] = array(&nbsp;</div></li><li><div>                  'id' =&gt; $object . '-archive', &nbsp;</div></li><li><div>                  'title' =&gt; $post_type-&gt;labels-&gt;archives, &nbsp;</div></li><li><div>                  'type' =&gt; 'post_type_archive', &nbsp;</div></li><li><div>                  'type_label' =&gt; __( 'Post Type Archive' ), &nbsp;</div></li><li><div>                  'object' =&gt; $object, &nbsp;</div></li><li><div>                  'url' =&gt; get_post_type_archive_link( $object ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $posts = get_posts( array(&nbsp;</div></li><li><div>              'numberposts' =&gt; 10, &nbsp;</div></li><li><div>              'offset' =&gt; 10 * $page, &nbsp;</div></li><li><div>              'orderby' =&gt; 'date', &nbsp;</div></li><li><div>              'order' =&gt; 'DESC', &nbsp;</div></li><li><div>              'post_type' =&gt; $object, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          foreach ( $posts as $post ) {&nbsp;</div></li><li><div>              $post_title = $post-&gt;post_title;&nbsp;</div></li><li><div>              if ( '' === $post_title ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">/** translators: %d: ID of a post */</span></span>&nbsp;</div></li><li><div>                  $post_title = sprintf( __( '#%d (no title)' ), $post-&gt;ID );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $items[] = array(&nbsp;</div></li><li><div>                  'id' =&gt; &quot;post-{$post-&gt;ID}&quot;, &nbsp;</div></li><li><div>                  'title' =&gt; html_entity_decode( $post_title, ENT_QUOTES, get_bloginfo( 'charset' ) ), &nbsp;</div></li><li><div>                  'type' =&gt; 'post_type', &nbsp;</div></li><li><div>                  'type_label' =&gt; get_post_type_object( $post-&gt;post_type )-&gt;labels-&gt;singular_name, &nbsp;</div></li><li><div>                  'object' =&gt; $post-&gt;post_type, &nbsp;</div></li><li><div>                  'object_id' =&gt; intval( $post-&gt;ID ), &nbsp;</div></li><li><div>                  'url' =&gt; get_permalink( intval( $post-&gt;ID ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( 'taxonomy' === $type ) {&nbsp;</div></li><li><div>          $terms = get_terms( $object, array(&nbsp;</div></li><li><div>              'child_of' =&gt; 0, &nbsp;</div></li><li><div>              'exclude' =&gt; '', &nbsp;</div></li><li><div>              'hide_empty' =&gt; false, &nbsp;</div></li><li><div>              'hierarchical' =&gt; 1, &nbsp;</div></li><li><div>              'include' =&gt; '', &nbsp;</div></li><li><div>              'number' =&gt; 10, &nbsp;</div></li><li><div>              'offset' =&gt; 10 * $page, &nbsp;</div></li><li><div>              'order' =&gt; 'DESC', &nbsp;</div></li><li><div>              'orderby' =&gt; 'count', &nbsp;</div></li><li><div>              'pad_counts' =&gt; false, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          if ( is_wp_error( $terms ) ) {&nbsp;</div></li><li><div>              return $terms;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $terms as $term ) {&nbsp;</div></li><li><div>              $items[] = array(&nbsp;</div></li><li><div>                  'id' =&gt; &quot;term-{$term-&gt;term_id}&quot;, &nbsp;</div></li><li><div>                  'title' =&gt; html_entity_decode( $term-&gt;name, ENT_QUOTES, get_bloginfo( 'charset' ) ), &nbsp;</div></li><li><div>                  'type' =&gt; 'taxonomy', &nbsp;</div></li><li><div>                  'type_label' =&gt; get_taxonomy( $term-&gt;taxonomy )-&gt;labels-&gt;singular_name, &nbsp;</div></li><li><div>                  'object' =&gt; $term-&gt;taxonomy, &nbsp;</div></li><li><div>                  'object_id' =&gt; intval( $term-&gt;term_id ), &nbsp;</div></li><li><div>                  'url' =&gt; get_term_link( intval( $term-&gt;term_id ), $term-&gt;taxonomy ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the available menu items.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $items  The array of menu items.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $type   The object type.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $object The object name.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $page   The current page number.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $items = apply_filters( 'customize_nav_menu_available_items', $items, $type, $object, $page );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $items;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Ajax handler for searching available menu items.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function ajax_search_available_items() {&nbsp;</div></li><li><div>      check_ajax_referer( 'customize-menus', 'customize-menus-nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! current_user_can( 'edit_theme_options' ) ) {&nbsp;</div></li><li><div>          wp_die( -1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $_POST['search'] ) ) {&nbsp;</div></li><li><div>          wp_send_json_error( 'nav_menus_missing_search_parameter' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $p = isset( $_POST['page'] ) ? absint( $_POST['page'] ) : 0;&nbsp;</div></li><li><div>      if ( $p &lt; 1 ) {&nbsp;</div></li><li><div>          $p = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s = sanitize_text_field( wp_unslash( $_POST['search'] ) );&nbsp;</div></li><li><div>      $items = $this-&gt;search_available_items_query( array( 'pagenum' =&gt; $p, 's' =&gt; $s ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $items ) ) {&nbsp;</div></li><li><div>          wp_send_json_error( array( 'message' =&gt; __( 'No results found.' ) ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_send_json_success( array( 'items' =&gt; $items ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Performs post queries for available-item searching.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Based on WP_Editor::wp_link_query().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args Optional. Accepts 'pagenum' and 's' (search) arguments.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Menu items.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function search_available_items_query( $args = array() ) {&nbsp;</div></li><li><div>      $items = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_type_objects = get_post_types( array( 'show_in_nav_menus' =&gt; true ), 'objects' );&nbsp;</div></li><li><div>      $query = array(&nbsp;</div></li><li><div>          'post_type' =&gt; array_keys( $post_type_objects ), &nbsp;</div></li><li><div>          'suppress_filters' =&gt; true, &nbsp;</div></li><li><div>          'update_post_term_cache' =&gt; false, &nbsp;</div></li><li><div>          'update_post_meta_cache' =&gt; false, &nbsp;</div></li><li><div>          'post_status' =&gt; 'publish', &nbsp;</div></li><li><div>          'posts_per_page' =&gt; 20, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args['pagenum'] = isset( $args['pagenum'] ) ? absint( $args['pagenum'] ) : 1;&nbsp;</div></li><li><div>      $query['offset'] = $args['pagenum'] &gt; 1 ? $query['posts_per_page'] * ( $args['pagenum'] - 1 ) : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $args['s'] ) ) {&nbsp;</div></li><li><div>          $query['s'] = $args['s'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Query posts.</span>&nbsp;</div></li><li><div>      $get_posts = new WP_Query( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check if any posts were found.</span>&nbsp;</div></li><li><div>      if ( $get_posts-&gt;post_count ) {&nbsp;</div></li><li><div>          foreach ( $get_posts-&gt;posts as $post ) {&nbsp;</div></li><li><div>              $post_title = $post-&gt;post_title;&nbsp;</div></li><li><div>              if ( '' === $post_title ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">/** translators: %d: ID of a post */</span></span>&nbsp;</div></li><li><div>                  $post_title = sprintf( __( '#%d (no title)' ), $post-&gt;ID );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $items[] = array(&nbsp;</div></li><li><div>                  'id' =&gt; 'post-' . $post-&gt;ID, &nbsp;</div></li><li><div>                  'title' =&gt; html_entity_decode( $post_title, ENT_QUOTES, get_bloginfo( 'charset' ) ), &nbsp;</div></li><li><div>                  'type' =&gt; 'post_type', &nbsp;</div></li><li><div>                  'type_label' =&gt; $post_type_objects[ $post-&gt;post_type ]-&gt;labels-&gt;singular_name, &nbsp;</div></li><li><div>                  'object' =&gt; $post-&gt;post_type, &nbsp;</div></li><li><div>                  'object_id' =&gt; intval( $post-&gt;ID ), &nbsp;</div></li><li><div>                  'url' =&gt; get_permalink( intval( $post-&gt;ID ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Query taxonomy terms.</span>&nbsp;</div></li><li><div>      $taxonomies = get_taxonomies( array( 'show_in_nav_menus' =&gt; true ), 'names' );&nbsp;</div></li><li><div>      $terms = get_terms( $taxonomies, array(&nbsp;</div></li><li><div>          'name__like' =&gt; $args['s'], &nbsp;</div></li><li><div>          'number' =&gt; 20, &nbsp;</div></li><li><div>          'offset' =&gt; 20 * ($args['pagenum'] - 1), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check if any taxonomies were found.</span>&nbsp;</div></li><li><div>      if ( ! empty( $terms ) ) {&nbsp;</div></li><li><div>          foreach ( $terms as $term ) {&nbsp;</div></li><li><div>              $items[] = array(&nbsp;</div></li><li><div>                  'id' =&gt; 'term-' . $term-&gt;term_id, &nbsp;</div></li><li><div>                  'title' =&gt; html_entity_decode( $term-&gt;name, ENT_QUOTES, get_bloginfo( 'charset' ) ), &nbsp;</div></li><li><div>                  'type' =&gt; 'taxonomy', &nbsp;</div></li><li><div>                  'type_label' =&gt; get_taxonomy( $term-&gt;taxonomy )-&gt;labels-&gt;singular_name, &nbsp;</div></li><li><div>                  'object' =&gt; $term-&gt;taxonomy, &nbsp;</div></li><li><div>                  'object_id' =&gt; intval( $term-&gt;term_id ), &nbsp;</div></li><li><div>                  'url' =&gt; get_term_link( intval( $term-&gt;term_id ), $term-&gt;taxonomy ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the available menu items during a search request.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $items The array of menu items.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $args  Includes 'pagenum' and 's' (search) arguments.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $items = apply_filters( 'customize_nav_menu_searched_items', $items, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $items;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue scripts and styles for Customizer pane.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function enqueue_scripts() {&nbsp;</div></li><li><div>      wp_enqueue_style( 'customize-nav-menus' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'customize-nav-menus' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $temp_nav_menu_setting = new WP_Customize_Nav_Menu_Setting( $this-&gt;manager, 'nav_menu[-1]' );&nbsp;</div></li><li><div>      $temp_nav_menu_item_setting = new WP_Customize_Nav_Menu_Item_Setting( $this-&gt;manager, 'nav_menu_item[-1]' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Pass data to JS.</span>&nbsp;</div></li><li><div>      $settings = array(&nbsp;</div></li><li><div>          'allMenus' =&gt; wp_get_nav_menus(), &nbsp;</div></li><li><div>          'itemTypes' =&gt; $this-&gt;available_item_types(), &nbsp;</div></li><li><div>          'l10n' =&gt; array(&nbsp;</div></li><li><div>              'untitled' =&gt; _x( '(no label)', 'missing menu item navigation label' ), &nbsp;</div></li><li><div>              'unnamed' =&gt; _x( '(unnamed)', 'Missing menu name.' ), &nbsp;</div></li><li><div>              'custom_label' =&gt; __( 'Custom Link' ), &nbsp;</div></li><li><div>              <span class="comment">/** translators: %s: menu location */</span>&nbsp;</div></li><li><div>              'menuLocation' =&gt; _x( '(Currently set to: %s)', 'menu' ), &nbsp;</div></li><li><div>              'menuNameLabel' =&gt; __( 'Menu Name' ), &nbsp;</div></li><li><div>              'itemAdded' =&gt; __( 'Menu item added' ), &nbsp;</div></li><li><div>              'itemDeleted' =&gt; __( 'Menu item deleted' ), &nbsp;</div></li><li><div>              'menuAdded' =&gt; __( 'Menu created' ), &nbsp;</div></li><li><div>              'menuDeleted' =&gt; __( 'Menu deleted' ), &nbsp;</div></li><li><div>              'movedUp' =&gt; __( 'Menu item moved up' ), &nbsp;</div></li><li><div>              'movedDown' =&gt; __( 'Menu item moved down' ), &nbsp;</div></li><li><div>              'movedLeft' =&gt; __( 'Menu item moved out of submenu' ), &nbsp;</div></li><li><div>              'movedRight' =&gt; __( 'Menu item is now a sub-item' ), &nbsp;</div></li><li><div>              <span class="comment"><span class="comment">/** translators: &#9656; is the unicode right-pointing triangle, and %s is the section title in the Customizer */</span></span>&nbsp;</div></li><li><div>              'customizingMenus' =&gt; sprintf( __( 'Customizing &#9656; %s' ), esc_html( $this-&gt;manager-&gt;get_panel( 'nav_menus' )-&gt;title ) ), &nbsp;</div></li><li><div>              <span class="comment">/** translators: %s: title of menu item which is invalid */</span>&nbsp;</div></li><li><div>              'invalidTitleTpl' =&gt; __( '%s (Invalid)' ), &nbsp;</div></li><li><div>              <span class="comment">/** translators: %s: title of menu item in draft status */</span>&nbsp;</div></li><li><div>              'pendingTitleTpl' =&gt; __( '%s (Pending)' ), &nbsp;</div></li><li><div>              'itemsFound' =&gt; __( 'Number of items found: %d' ), &nbsp;</div></li><li><div>              'itemsFoundMore' =&gt; __( 'Additional items found: %d' ), &nbsp;</div></li><li><div>              'itemsLoadingMore' =&gt; __( 'Loading more results... please wait.' ), &nbsp;</div></li><li><div>              'reorderModeOn' =&gt; __( 'Reorder mode enabled' ), &nbsp;</div></li><li><div>              'reorderModeOff' =&gt; __( 'Reorder mode closed' ), &nbsp;</div></li><li><div>              'reorderLabelOn' =&gt; esc_attr__( 'Reorder menu items' ), &nbsp;</div></li><li><div>              'reorderLabelOff' =&gt; esc_attr__( 'Close reorder mode' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'settingTransport' =&gt; 'postMessage', &nbsp;</div></li><li><div>          'phpIntMax' =&gt; PHP_INT_MAX, &nbsp;</div></li><li><div>          'defaultSettingValues' =&gt; array(&nbsp;</div></li><li><div>              'nav_menu' =&gt; $temp_nav_menu_setting-&gt;default, &nbsp;</div></li><li><div>              'nav_menu_item' =&gt; $temp_nav_menu_item_setting-&gt;default, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'locationSlugMappedToName' =&gt; get_registered_nav_menus(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $data = sprintf( 'var _wpCustomizeNavMenusSettings = %s;', wp_json_encode( $settings ) );&nbsp;</div></li><li><div>      wp_scripts()-&gt;add_data( 'customize-nav-menus', 'data', $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This is copied from nav-menus.php, and it has an unfortunate object name of `menus`.</span>&nbsp;</div></li><li><div>      $nav_menus_l10n = array(&nbsp;</div></li><li><div>          'oneThemeLocationNoMenus' =&gt; null, &nbsp;</div></li><li><div>          'moveUp' =&gt; __( 'Move up one' ), &nbsp;</div></li><li><div>          'moveDown' =&gt; __( 'Move down one' ), &nbsp;</div></li><li><div>          'moveToTop' =&gt; __( 'Move to the top' ), &nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: previous item name */</span></span></span></span>&nbsp;</div></li><li><div>          'moveUnder' =&gt; __( 'Move under %s' ), &nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: previous item name */</span></span></span></span>&nbsp;</div></li><li><div>          'moveOutFrom' =&gt; __( 'Move out from under %s' ), &nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: previous item name */</span></span></span></span>&nbsp;</div></li><li><div>          'under' =&gt; __( 'Under %s' ), &nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: previous item name */</span></span></span></span>&nbsp;</div></li><li><div>          'outFrom' =&gt; __( 'Out from under %s' ), &nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: item name, 2: item position, 3: total number of items */</span>&nbsp;</div></li><li><div>          'menuFocus' =&gt; __( '%1$s. Menu item %2$d of %3$d.' ), &nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: item name, 2: item position, 3: parent item name */</span>&nbsp;</div></li><li><div>          'subMenuFocus' =&gt; __( '%1$s. Sub item number %2$d under %3$s.' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_localize_script( 'nav-menu', 'menus', $nav_menus_l10n );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a dynamic setting's constructor args.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * For a dynamic setting to be registered, this filter must be employed</span>&nbsp;</div></li><li><div><span class="comment">   * to override the default false value with an array of args to pass to</span>&nbsp;</div></li><li><div><span class="comment">   * the WP_Customize_Setting constructor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param false|array $setting_args The arguments to the WP_Customize_Setting constructor.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $setting_id   ID for dynamic setting, usually coming from `$_POST['customized']`.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array|false</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function filter_dynamic_setting_args( $setting_args, $setting_id ) {&nbsp;</div></li><li><div>      if ( preg_match( WP_Customize_Nav_Menu_Setting::ID_PATTERN, $setting_id ) ) {&nbsp;</div></li><li><div>          $setting_args = array(&nbsp;</div></li><li><div>              'type' =&gt; WP_Customize_Nav_Menu_Setting::TYPE, &nbsp;</div></li><li><div>              'transport' =&gt; 'postMessage', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      } elseif ( preg_match( WP_Customize_Nav_Menu_Item_Setting::ID_PATTERN, $setting_id ) ) {&nbsp;</div></li><li><div>          $setting_args = array(&nbsp;</div></li><li><div>              'type' =&gt; WP_Customize_Nav_Menu_Item_Setting::TYPE, &nbsp;</div></li><li><div>              'transport' =&gt; 'postMessage', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $setting_args;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Allow non-statically created settings to be constructed with custom WP_Customize_Setting subclass.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $setting_class WP_Customize_Setting or a subclass.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $setting_id    ID for dynamic setting, usually coming from `$_POST['customized']`.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $setting_args  WP_Customize_Setting or a subclass.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function filter_dynamic_setting_class( $setting_class, $setting_id, $setting_args ) {&nbsp;</div></li><li><div>      unset( $setting_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $setting_args['type'] ) && WP_Customize_Nav_Menu_Setting::TYPE === $setting_args['type'] ) {&nbsp;</div></li><li><div>          $setting_class = 'WP_Customize_Nav_Menu_Setting';&nbsp;</div></li><li><div>      } elseif ( ! empty( $setting_args['type'] ) && WP_Customize_Nav_Menu_Item_Setting::TYPE === $setting_args['type'] ) {&nbsp;</div></li><li><div>          $setting_class = 'WP_Customize_Nav_Menu_Item_Setting';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $setting_class;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add the customizer settings and controls.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function customize_register() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Require JS-rendered control types.</span>&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;register_panel_type( 'WP_Customize_Nav_Menus_Panel' );&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;register_control_type( 'WP_Customize_Nav_Menu_Control' );&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;register_control_type( 'WP_Customize_Nav_Menu_Name_Control' );&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;register_control_type( 'WP_Customize_Nav_Menu_Auto_Add_Control' );&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;register_control_type( 'WP_Customize_Nav_Menu_Item_Control' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Create a panel for Menus.</span>&nbsp;</div></li><li><div>      $description = '&lt;p&gt;' . __( 'This panel is used for managing navigation menus for content you have already published on your site. You can create menus and add items for existing content such as pages, posts, categories, tags, formats, or custom links.' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      if ( current_theme_supports( 'widgets' ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** translators: URL to the widgets panel of the customizer */</span></span>&nbsp;</div></li><li><div>          $description .= '&lt;p&gt;' . sprintf( __( 'Menus can be displayed in locations defined by your theme or in &lt;a href=&quot;%s&quot;&gt;widget areas&lt;/a&gt; by adding a &#8220;Custom Menu&#8221; widget.' ), &quot;javascript:wp.customize.panel( 'widgets' ).focus();&quot; ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $description .= '&lt;p&gt;' . __( 'Menus can be displayed in locations defined by your theme.' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;add_panel( new WP_Customize_Nav_Menus_Panel( $this-&gt;manager, 'nav_menus', array(&nbsp;</div></li><li><div>          'title' =&gt; __( 'Menus' ), &nbsp;</div></li><li><div>          'description' =&gt; $description, &nbsp;</div></li><li><div>          'priority' =&gt; 100, &nbsp;</div></li><li><div>          <span class="comment">// 'theme_supports' =&gt; 'menus|widgets', @todo allow multiple theme supports</span>&nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>      $menus = wp_get_nav_menus();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Menu locations.</span>&nbsp;</div></li><li><div>      $locations = get_registered_nav_menus();&nbsp;</div></li><li><div>      $num_locations = count( array_keys( $locations ) );&nbsp;</div></li><li><div>      if ( 1 == $num_locations ) {&nbsp;</div></li><li><div>          $description = '&lt;p&gt;' . __( 'Your theme supports one menu. Select which menu you would like to use.' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">/** translators: %s: number of menu locations */</span>&nbsp;</div></li><li><div>          $description = '&lt;p&gt;' . sprintf( _n( 'Your theme supports %s menu. Select which menu appears in each location.', 'Your theme supports %s menus. Select which menu appears in each location.', $num_locations ), number_format_i18n( $num_locations ) ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( current_theme_supports( 'widgets' ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** translators: URL to the widgets panel of the customizer */</span></span>&nbsp;</div></li><li><div>          $description .= '&lt;p&gt;' . sprintf( __( 'You can also place menus in &lt;a href=&quot;%s&quot;&gt;widget areas&lt;/a&gt; with the &#8220;Custom Menu&#8221; widget.' ), &quot;javascript:wp.customize.panel( 'widgets' ).focus();&quot; ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;add_section( 'menu_locations', array(&nbsp;</div></li><li><div>          'title' =&gt; __( 'Menu Locations' ), &nbsp;</div></li><li><div>          'panel' =&gt; 'nav_menus', &nbsp;</div></li><li><div>          'priority' =&gt; 5, &nbsp;</div></li><li><div>          'description' =&gt; $description, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $choices = array( '0' =&gt; __( '&mdash; Select &mdash;' ) );&nbsp;</div></li><li><div>      foreach ( $menus as $menu ) {&nbsp;</div></li><li><div>          $choices[ $menu-&gt;term_id ] = wp_html_excerpt( $menu-&gt;name, 40, '&hellip;' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $locations as $location =&gt; $description ) {&nbsp;</div></li><li><div>          $setting_id = &quot;nav_menu_locations[{$location}]&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $setting = $this-&gt;manager-&gt;get_setting( $setting_id );&nbsp;</div></li><li><div>          if ( $setting ) {&nbsp;</div></li><li><div>              $setting-&gt;transport = 'postMessage';&nbsp;</div></li><li><div>              remove_filter( &quot;customize_sanitize_{$setting_id}&quot;, 'absint' );&nbsp;</div></li><li><div>              add_filter( &quot;customize_sanitize_{$setting_id}&quot;, array( $this, 'intval_base10' ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;manager-&gt;add_setting( $setting_id, array(&nbsp;</div></li><li><div>                  'sanitize_callback' =&gt; array( $this, 'intval_base10' ), &nbsp;</div></li><li><div>                  'theme_supports' =&gt; 'menus', &nbsp;</div></li><li><div>                  'type' =&gt; 'theme_mod', &nbsp;</div></li><li><div>                  'transport' =&gt; 'postMessage', &nbsp;</div></li><li><div>                  'default' =&gt; 0, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;manager-&gt;add_control( new WP_Customize_Nav_Menu_Location_Control( $this-&gt;manager, $setting_id, array(&nbsp;</div></li><li><div>              'label' =&gt; $description, &nbsp;</div></li><li><div>              'location_id' =&gt; $location, &nbsp;</div></li><li><div>              'section' =&gt; 'menu_locations', &nbsp;</div></li><li><div>              'choices' =&gt; $choices, &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Register each menu as a Customizer section, and add each menu item to each menu.</span>&nbsp;</div></li><li><div>      foreach ( $menus as $menu ) {&nbsp;</div></li><li><div>          $menu_id = $menu-&gt;term_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Create a section for each menu.</span>&nbsp;</div></li><li><div>          $section_id = 'nav_menu[' . $menu_id . ']';&nbsp;</div></li><li><div>          $this-&gt;manager-&gt;add_section( new WP_Customize_Nav_Menu_Section( $this-&gt;manager, $section_id, array(&nbsp;</div></li><li><div>              'title' =&gt; html_entity_decode( $menu-&gt;name, ENT_QUOTES, get_bloginfo( 'charset' ) ), &nbsp;</div></li><li><div>              'priority' =&gt; 10, &nbsp;</div></li><li><div>              'panel' =&gt; 'nav_menus', &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $nav_menu_setting_id = 'nav_menu[' . $menu_id . ']';&nbsp;</div></li><li><div>          $this-&gt;manager-&gt;add_setting( new WP_Customize_Nav_Menu_Setting( $this-&gt;manager, $nav_menu_setting_id, array(&nbsp;</div></li><li><div>              'transport' =&gt; 'postMessage', &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Add the menu contents.</span>&nbsp;</div></li><li><div>          $menu_items = (array) wp_get_nav_menu_items( $menu_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( array_values( $menu_items ) as $i =&gt; $item ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Create a setting for each menu item (which doesn't actually manage data, currently).</span>&nbsp;</div></li><li><div>              $menu_item_setting_id = 'nav_menu_item[' . $item-&gt;ID . ']';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $value = (array) $item;&nbsp;</div></li><li><div>              $value['nav_menu_term_id'] = $menu_id;&nbsp;</div></li><li><div>              $this-&gt;manager-&gt;add_setting( new WP_Customize_Nav_Menu_Item_Setting( $this-&gt;manager, $menu_item_setting_id, array(&nbsp;</div></li><li><div>                  'value' =&gt; $value, &nbsp;</div></li><li><div>                  'transport' =&gt; 'postMessage', &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Create a control for each menu item.</span>&nbsp;</div></li><li><div>              $this-&gt;manager-&gt;add_control( new WP_Customize_Nav_Menu_Item_Control( $this-&gt;manager, $menu_item_setting_id, array(&nbsp;</div></li><li><div>                  'label' =&gt; $item-&gt;title, &nbsp;</div></li><li><div>                  'section' =&gt; $section_id, &nbsp;</div></li><li><div>                  'priority' =&gt; 10 + $i, &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Note: other controls inside of this section get added dynamically in JS via the MenuSection.ready() function.</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add the add-new-menu section and controls.</span>&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;add_section( new WP_Customize_New_Menu_Section( $this-&gt;manager, 'add_menu', array(&nbsp;</div></li><li><div>          'title' =&gt; __( 'Add a Menu' ), &nbsp;</div></li><li><div>          'panel' =&gt; 'nav_menus', &nbsp;</div></li><li><div>          'priority' =&gt; 999, &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;add_control( 'new_menu_name', array(&nbsp;</div></li><li><div>          'label' =&gt; '', &nbsp;</div></li><li><div>          'section' =&gt; 'add_menu', &nbsp;</div></li><li><div>          'type' =&gt; 'text', &nbsp;</div></li><li><div>          'settings' =&gt; array(), &nbsp;</div></li><li><div>          'input_attrs' =&gt; array(&nbsp;</div></li><li><div>              'class' =&gt; 'menu-name-field', &nbsp;</div></li><li><div>              'placeholder' =&gt; __( 'New menu name' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;manager-&gt;add_control( new WP_Customize_New_Menu_Control( $this-&gt;manager, 'create_new_menu', array(&nbsp;</div></li><li><div>          'section' =&gt; 'add_menu', &nbsp;</div></li><li><div>          'settings' =&gt; array(), &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the base10 intval.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This is used as a setting's sanitize_callback; we can't use just plain</span>&nbsp;</div></li><li><div><span class="comment">   * intval because the second argument is not what intval() expects.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $value Number to convert.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Integer.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function intval_base10( $value ) {&nbsp;</div></li><li><div>      return intval( $value, 10 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return an array of all the available item types.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array The available menu item types.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function available_item_types() {&nbsp;</div></li><li><div>      $item_types = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_types = get_post_types( array( 'show_in_nav_menus' =&gt; true ), 'objects' );&nbsp;</div></li><li><div>      if ( $post_types ) {&nbsp;</div></li><li><div>          foreach ( $post_types as $slug =&gt; $post_type ) {&nbsp;</div></li><li><div>              $item_types[] = array(&nbsp;</div></li><li><div>                  'title' =&gt; $post_type-&gt;labels-&gt;name, &nbsp;</div></li><li><div>                  'type' =&gt; 'post_type', &nbsp;</div></li><li><div>                  'object' =&gt; $post_type-&gt;name, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $taxonomies = get_taxonomies( array( 'show_in_nav_menus' =&gt; true ), 'objects' );&nbsp;</div></li><li><div>      if ( $taxonomies ) {&nbsp;</div></li><li><div>          foreach ( $taxonomies as $slug =&gt; $taxonomy ) {&nbsp;</div></li><li><div>              if ( 'post_format' === $taxonomy && ! current_theme_supports( 'post-formats' ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $item_types[] = array(&nbsp;</div></li><li><div>                  'title' =&gt; $taxonomy-&gt;labels-&gt;name, &nbsp;</div></li><li><div>                  'type' =&gt; 'taxonomy', &nbsp;</div></li><li><div>                  'object' =&gt; $taxonomy-&gt;name, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the available menu item types.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $item_types Custom menu item types.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $item_types = apply_filters( 'customize_nav_menu_available_item_types', $item_types );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $item_types;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Print the JavaScript templates used to render Menu Customizer components.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Templates are imported into the JS use wp.template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function print_templates() {&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/html&quot; id=&quot;tmpl-available-menu-item&quot;&gt;&nbsp;</div></li><li><div>          &lt;li id=&quot;menu-item-tpl-{{ data.id }}&quot; class=&quot;menu-item-tpl&quot; data-menu-item-id=&quot;{{ data.id }}&quot;&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;menu-item-bar&quot;&gt;&nbsp;</div></li><li><div>                  &lt;div class=&quot;menu-item-handle&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;item-type&quot; aria-hidden=&quot;true&quot;&gt;{{ data.type_label }}&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;item-title&quot; aria-hidden=&quot;true&quot;&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;menu-item-title&lt;# if ( ! data.title ) { #&gt; no-title&lt;# } #&gt;&quot;&gt;{{ data.title || wp.customize.Menus.data.l10n.untitled }}&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;button type=&quot;button&quot; class=&quot;button-link item-add&quot;&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                              <span class="comment">/** translators: 1: Title of a menu item, 2: Type of a menu item */</span>&nbsp;</div></li><li><div>                              printf( __( 'Add to menu: %1$s (%2$s)' ), '{{ data.title || wp.customize.Menus.data.l10n.untitled }}', '{{ data.type_label }}' );&nbsp;</div></li><li><div>                          ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;/button&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/li&gt;&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;script type=&quot;text/html&quot; id=&quot;tmpl-menu-item-reorder-nav&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;menu-item-reorder-nav&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>              printf(&nbsp;</div></li><li><div>                  '&lt;button type=&quot;button&quot; class=&quot;menus-move-up&quot;&gt;%1$s&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;menus-move-down&quot;&gt;%2$s&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;menus-move-left&quot;&gt;%3$s&lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;menus-move-right&quot;&gt;%4$s&lt;/button&gt;', &nbsp;</div></li><li><div>                  __( 'Move up' ), &nbsp;</div></li><li><div>                  __( 'Move down' ), &nbsp;</div></li><li><div>                  __( 'Move one level up' ), &nbsp;</div></li><li><div>                  __( 'Move one level down' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Print the html template used to render the add-menu-item frame.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function available_items_template() {&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;available-menu-items&quot; class=&quot;accordion-container&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;customize-section-title&quot;&gt;&nbsp;</div></li><li><div>              &lt;button type=&quot;button&quot; class=&quot;customize-section-back&quot; tabindex=&quot;-1&quot;&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Back' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;/button&gt;&nbsp;</div></li><li><div>              &lt;h3&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;customize-action&quot;&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">/** translators: &#9656; is the unicode right-pointing triangle, and %s is the section title in the Customizer */</span></span>&nbsp;</div></li><li><div>                          printf( __( 'Customizing &#9656; %s' ), esc_html( $this-&gt;manager-&gt;get_panel( 'nav_menus' )-&gt;title ) );&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                  &lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Add Menu Items' ); ?&gt;&nbsp;</div></li><li><div>              &lt;/h3&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;available-menu-items-search&quot; class=&quot;accordion-section cannot-expand&quot;&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;accordion-section-title&quot;&gt;&nbsp;</div></li><li><div>                  &lt;label class=&quot;screen-reader-text&quot; for=&quot;menu-items-search&quot;&gt;&lt;?php _e( 'Search Menu Items' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;text&quot; id=&quot;menu-items-search&quot; placeholder=&quot;&lt;?php esc_attr_e( 'Search menu items&hellip;' ) ?&gt;&quot; aria-describedby=&quot;menu-items-search-desc&quot; /&gt;&nbsp;</div></li><li><div>                  &lt;p class=&quot;screen-reader-text&quot; id=&quot;menu-items-search-desc&quot;&gt;&lt;?php _e( 'The search results will be updated as you type.' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;spinner&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;button type=&quot;button&quot; class=&quot;clear-results&quot;&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Clear Results' ); ?&gt;&lt;/span&gt;&lt;/button&gt;&nbsp;</div></li><li><div>              &lt;ul class=&quot;accordion-section-content&quot; data-type=&quot;search&quot;&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;new-custom-menu-item&quot; class=&quot;accordion-section&quot;&gt;&nbsp;</div></li><li><div>              &lt;h4 class=&quot;accordion-section-title&quot; role=&quot;presentation&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Custom Links' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-link&quot; aria-expanded=&quot;false&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Toggle section: Custom Links' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;toggle-indicator&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>              &lt;/h4&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;accordion-section-content customlinkdiv&quot;&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;hidden&quot; value=&quot;custom&quot; id=&quot;custom-menu-item-type&quot; name=&quot;menu-item[-1][menu-item-type]&quot; /&gt;&nbsp;</div></li><li><div>                  &lt;p id=&quot;menu-item-url-wrap&quot; class=&quot;wp-clearfix&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label class=&quot;howto&quot; for=&quot;custom-menu-item-url&quot;&gt;&lt;?php _e( 'URL' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;input id=&quot;custom-menu-item-url&quot; name=&quot;menu-item[-1][menu-item-url]&quot; type=&quot;text&quot; class=&quot;code menu-item-textbox&quot; value=&quot;http:<span class="comment">//&quot;&gt;</span>&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>                  &lt;p id=&quot;menu-item-name-wrap&quot; class=&quot;wp-clearfix&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label class=&quot;howto&quot; for=&quot;custom-menu-item-name&quot;&gt;&lt;?php _e( 'Link Text' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;input id=&quot;custom-menu-item-name&quot; name=&quot;menu-item[-1][menu-item-title]&quot; type=&quot;text&quot; class=&quot;regular-text menu-item-textbox&quot;&gt;&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>                  &lt;p class=&quot;button-controls&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;add-to-menu&quot;&gt;&nbsp;</div></li><li><div>                          &lt;input type=&quot;submit&quot; class=&quot;button-secondary submit-add-to-menu right&quot; value=&quot;&lt;?php esc_attr_e( 'Add to Menu' ); ?&gt;&quot; name=&quot;add-custom-menu-item&quot; id=&quot;custom-menu-item-submit&quot;&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;spinner&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          <span class="comment">// Containers for per-post-type item browsing; items added with JS.</span>&nbsp;</div></li><li><div>          foreach ( $this-&gt;available_item_types() as $available_item_type ) {&nbsp;</div></li><li><div>              $id = sprintf( 'available-menu-items-%s-%s', $available_item_type['type'], $available_item_type['object'] );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;&lt;?php echo esc_attr( $id ); ?&gt;&quot; class=&quot;accordion-section&quot;&gt;&nbsp;</div></li><li><div>                  &lt;h4 class=&quot;accordion-section-title&quot; role=&quot;presentation&quot;&gt;&nbsp;</div></li><li><div>                      &lt;?php echo esc_html( $available_item_type['title'] ); ?&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;spinner&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;no-items&quot;&gt;&lt;?php _e( 'No items' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;button type=&quot;button&quot; class=&quot;button-link&quot; aria-expanded=&quot;false&quot;&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                          <span class="comment">/** translators: %s: Title of a section with menu items */</span>&nbsp;</div></li><li><div>                          printf( __( 'Toggle section: %s' ), esc_html( $available_item_type['title'] ) ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;toggle-indicator&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;/button&gt;&nbsp;</div></li><li><div>                  &lt;/h4&gt;&nbsp;</div></li><li><div>                  &lt;ul class=&quot;accordion-section-content&quot; data-type=&quot;&lt;?php echo esc_attr( $available_item_type['type'] ); ?&gt;&quot; data-object=&quot;&lt;?php echo esc_attr( $available_item_type['object'] ); ?&gt;&quot;&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&lt;!-- #available-menu-items --&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//</span>&nbsp;</div></li><li><div><span class="comment">  // Start functionality specific to partial-refresh of menu changes in Customizer preview.</span>&nbsp;</div></li><li><div>  <span class="comment">//</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Nav menu args used for each instance, keyed by the args HMAC.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $preview_nav_menu_instance_args = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters arguments for dynamic nav_menu selective refresh partials.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|false $partial_args Partial args.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $partial_id   Partial ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Partial args.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function customize_dynamic_partial_args( $partial_args, $partial_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match( '/^nav_menu_instance\[[0-9a-f]{32}\]$/', $partial_id ) ) {&nbsp;</div></li><li><div>          if ( false === $partial_args ) {&nbsp;</div></li><li><div>              $partial_args = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $partial_args = array_merge(&nbsp;</div></li><li><div>              $partial_args, &nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'type' =&gt; 'nav_menu_instance', &nbsp;</div></li><li><div>                  'render_callback' =&gt; array( $this, 'render_nav_menu_partial' ), &nbsp;</div></li><li><div>                  'container_inclusive' =&gt; true, &nbsp;</div></li><li><div>                  'settings' =&gt; array(), <span class="comment">// Empty because the nav menu instance may relate to a menu or a location.</span>&nbsp;</div></li><li><div>                  'capability' =&gt; 'edit_theme_options', &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $partial_args;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add hooks for the Customizer preview.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function customize_preview_init() {&nbsp;</div></li><li><div>      add_action( 'wp_enqueue_scripts', array( $this, 'customize_preview_enqueue_deps' ) );&nbsp;</div></li><li><div>      add_filter( 'wp_nav_menu_args', array( $this, 'filter_wp_nav_menu_args' ), 1000 );&nbsp;</div></li><li><div>      add_filter( 'wp_nav_menu', array( $this, 'filter_wp_nav_menu' ), 10, 2 );&nbsp;</div></li><li><div>      add_filter( 'wp_footer', array( $this, 'export_preview_data' ), 1 );&nbsp;</div></li><li><div>      add_filter( 'customize_render_partials_response', array( $this, 'export_partial_rendered_nav_menu_instances' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Keep track of the arguments that are being passed to wp_nav_menu().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @see wp_nav_menu()</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Customize_Widgets_Partial_Refresh::filter_dynamic_sidebar_params()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args An array containing wp_nav_menu() arguments.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Arguments.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function filter_wp_nav_menu_args( $args ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * The following conditions determine whether or not this instance of</span>&nbsp;</div></li><li><div><span class="comment">       * wp_nav_menu() can use selective refreshed. A wp_nav_menu() can be</span>&nbsp;</div></li><li><div><span class="comment">       * selective refreshed if...</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $can_partial_refresh = (&nbsp;</div></li><li><div>          <span class="comment">// ...if wp_nav_menu() is directly echoing out the menu (and thus isn't manipulating the string after generated), </span>&nbsp;</div></li><li><div>          ! empty( $args['echo'] )&nbsp;</div></li><li><div>          &&&nbsp;</div></li><li><div>          <span class="comment">// ...and if the fallback_cb can be serialized to JSON, since it will be included in the placement context data, </span>&nbsp;</div></li><li><div>          ( empty( $args['fallback_cb'] ) || is_string( $args['fallback_cb'] ) )&nbsp;</div></li><li><div>          &&&nbsp;</div></li><li><div>          <span class="comment">// ...and if the walker can also be serialized to JSON, since it will be included in the placement context data as well, </span>&nbsp;</div></li><li><div>          ( empty( $args['walker'] ) || is_string( $args['walker'] ) )&nbsp;</div></li><li><div>          <span class="comment">// ...and if it has a theme location assigned or an assigned menu to display, </span>&nbsp;</div></li><li><div>          && (&nbsp;</div></li><li><div>              ! empty( $args['theme_location'] )&nbsp;</div></li><li><div>              ||&nbsp;</div></li><li><div>              ( ! empty( $args['menu'] ) && ( is_numeric( $args['menu'] ) || is_object( $args['menu'] ) ) )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>          &&&nbsp;</div></li><li><div>          <span class="comment">// ...and if the nav menu would be rendered with a wrapper container element (upon which to attach data-* attributes).</span>&nbsp;</div></li><li><div>          (&nbsp;</div></li><li><div>              ! empty( $args['container'] )&nbsp;</div></li><li><div>              ||&nbsp;</div></li><li><div>              ( isset( $args['items_wrap'] ) && '&lt;' === substr( $args['items_wrap'], 0, 1 ) )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $args['can_partial_refresh'] = $can_partial_refresh;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $exported_args = $args;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Empty out args which may not be JSON-serializable.</span>&nbsp;</div></li><li><div>      if ( ! $can_partial_refresh ) {&nbsp;</div></li><li><div>          $exported_args['fallback_cb'] = '';&nbsp;</div></li><li><div>          $exported_args['walker'] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Replace object menu arg with a term_id menu arg, as this exports better</span>&nbsp;</div></li><li><div><span class="comment">       * to JS and is easier to compare hashes.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( ! empty( $exported_args['menu'] ) && is_object( $exported_args['menu'] ) ) {&nbsp;</div></li><li><div>          $exported_args['menu'] = $exported_args['menu']-&gt;term_id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ksort( $exported_args );&nbsp;</div></li><li><div>      $exported_args['args_hmac'] = $this-&gt;hash_nav_menu_args( $exported_args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args['customize_preview_nav_menus_args'] = $exported_args;&nbsp;</div></li><li><div>      $this-&gt;preview_nav_menu_instance_args[ $exported_args['args_hmac'] ] = $exported_args;&nbsp;</div></li><li><div>      return $args;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Prepares wp_nav_menu() calls for partial refresh.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Injects attributes into container element.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see wp_nav_menu()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $nav_menu_content The HTML content for the navigation menu.</span>&nbsp;</div></li><li><div><span class="comment">   * @param object $args             An object containing wp_nav_menu() arguments.</span>&nbsp;</div></li><li><div><span class="comment">   * @return null</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function filter_wp_nav_menu( $nav_menu_content, $args ) {&nbsp;</div></li><li><div>      if ( isset( $args-&gt;customize_preview_nav_menus_args['can_partial_refresh'] ) && $args-&gt;customize_preview_nav_menus_args['can_partial_refresh'] ) {&nbsp;</div></li><li><div>          $attributes = sprintf( ' data-customize-partial-id=&quot;%s&quot;', esc_attr( 'nav_menu_instance[' . $args-&gt;customize_preview_nav_menus_args['args_hmac'] . ']' ) );&nbsp;</div></li><li><div>          $attributes .= ' data-customize-partial-type=&quot;nav_menu_instance&quot;';&nbsp;</div></li><li><div>          $attributes .= sprintf( ' data-customize-partial-placement-context=&quot;%s&quot;', esc_attr( wp_json_encode( $args-&gt;customize_preview_nav_menus_args ) ) );&nbsp;</div></li><li><div>          $nav_menu_content = preg_replace( '#^(&lt;\w+)#', '$1 ' . $attributes, $nav_menu_content, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $nav_menu_content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Hashes (hmac) the nav menu arguments to ensure they are not tampered with when</span>&nbsp;</div></li><li><div><span class="comment">   * submitted in the Ajax request.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Note that the array is expected to be pre-sorted.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args The arguments to hash.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Hashed nav menu arguments.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function hash_nav_menu_args( $args ) {&nbsp;</div></li><li><div>      return wp_hash( serialize( $args ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue scripts for the Customizer preview.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function customize_preview_enqueue_deps() {&nbsp;</div></li><li><div>      wp_enqueue_script( 'customize-preview-nav-menus' ); <span class="comment">// Note that we have overridden this.</span>&nbsp;</div></li><li><div>      wp_enqueue_style( 'customize-preview' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Exports data from PHP to JS.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function export_preview_data() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Why not wp_localize_script? Because we're not localizing, and it forces values into strings.</span>&nbsp;</div></li><li><div>      $exports = array(&nbsp;</div></li><li><div>          'navMenuInstanceArgs' =&gt; $this-&gt;preview_nav_menu_instance_args, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      printf( '&lt;script&gt;var _wpCustomizePreviewNavMenusExports = %s;&lt;/script&gt;', wp_json_encode( $exports ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Export any wp_nav_menu() calls during the rendering of any partials.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $response Response.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Response.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function export_partial_rendered_nav_menu_instances( $response ) {&nbsp;</div></li><li><div>      $response['nav_menu_instance_args'] = $this-&gt;preview_nav_menu_instance_args;&nbsp;</div></li><li><div>      return $response;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Render a specific menu via wp_nav_menu() using the supplied arguments.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see wp_nav_menu()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Customize_Partial $partial       Partial.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array                $nav_menu_args Nav menu args supplied as container context.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|false</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function render_nav_menu_partial( $partial, $nav_menu_args ) {&nbsp;</div></li><li><div>      unset( $partial );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $nav_menu_args['args_hmac'] ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Error: missing_args_hmac.</span>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $nav_menu_args_hmac = $nav_menu_args['args_hmac'];&nbsp;</div></li><li><div>      unset( $nav_menu_args['args_hmac'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ksort( $nav_menu_args );&nbsp;</div></li><li><div>      if ( ! hash_equals( $this-&gt;hash_nav_menu_args( $nav_menu_args ), $nav_menu_args_hmac ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Error: args_hmac_mismatch.</span>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ob_start();&nbsp;</div></li><li><div>      wp_nav_menu( $nav_menu_args );&nbsp;</div></li><li><div>      $content = ob_get_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>