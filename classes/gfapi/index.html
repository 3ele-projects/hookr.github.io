<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-id="72787"><head xmlns="http://www.w3.org/1999/xhtml"><title> gfapi | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="GFAPI, class, plugin, gravity-forms, 1.9.14.22" /><meta name="description" content="API for standard Gravity Forms functionality." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=69b4cbb80a76dad0c3be3767ffdf4d59' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/gfapi/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgfapi%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgfapi%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-1.9.14.22-class-gfapi","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="gfapi" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to gravity-forms." href="http://hookr.io/plugins/gravity-forms/" class="plugin"><span property="name">gravity-forms</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.9.14.22." href="http://hookr.io/plugins/gravity-forms/1.9.14.22/" class="H_VERSION"><span property="name">1.9.14.22</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/gravity-forms/1.9.14.22/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">gfapi</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="0"><a href="http://hookr.io/1.9.14.22/all/" title="All">All <span class="count badge">0</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/1.9.14.22/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/1.9.14.22/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/1.9.14.22/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/1.9.14.22/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="0"><a href="http://hookr.io/1.9.14.22/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/1.9.14.22/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="0"><a href="http://hookr.io/1.9.14.22/functions/" title="Functions">Functions <span class="count badge">0</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/1.9.14.22/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>GFAPI</strong></h1><p>API for standard Gravity Forms functionality.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/files/includes-api/" class="file">/includes/api.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="19" class="block" start="19"><li><div>class GFAPI {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // FORMS ----------------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the form object for a given Form ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $form_id The ID of the Form&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed The form meta array or false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_form( $form_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form_id = absint( $form_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = GFFormsModel::get_form_meta( $form_id );&nbsp;</div></li><li><div>        if ( ! $form ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //loading form columns into meta&nbsp;</div></li><li><div>        $form_info = GFFormsModel::get_form( $form_id, true );&nbsp;</div></li><li><div>        $form['is_active'] = $form_info-&gt;is_active;&nbsp;</div></li><li><div>        $form['date_created'] = $form_info-&gt;date_created;&nbsp;</div></li><li><div>        $form['is_trash'] = $form_info-&gt;is_trash;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $form;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns all the form objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8.11.5&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $active&nbsp;</div></li><li><div>     * @param bool $trash&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed The array of Forms&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_forms( $active = true, $trash = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form_ids = GFFormsModel::get_form_ids( $active, $trash );&nbsp;</div></li><li><div>        if ( empty( $form_ids ) ) {&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $forms = array();&nbsp;</div></li><li><div>        foreach ( $form_ids as $form_id ) {&nbsp;</div></li><li><div>            $forms[] = GFAPI::get_form( $form_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $forms;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes the forms with the given Form IDs&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $form_ids An array of form IDs to delete&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_forms( $form_ids ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        GFFormsModel::delete_forms( $form_ids );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes the form with the given Form ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $form_id The ID of the Form to delete&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed True for success, or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_form( $form_id ) {&nbsp;</div></li><li><div>        $form = self::get_form( $form_id );&nbsp;</div></li><li><div>        if ( empty( $form ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'not_found', sprintf( __( 'Form with id: %s not found', 'gravityforms' ), $form_id ), $form_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        self::delete_forms( array( $form_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates the forms with an array of form objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $forms The Form objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed True for success, or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_forms( $forms ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $forms as $form ) {&nbsp;</div></li><li><div>            $result = self::update_form( $form );&nbsp;</div></li><li><div>            if ( is_wp_error( $result ) ) {&nbsp;</div></li><li><div>                return $result;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates the form with a given form object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $form The Form object&nbsp;</div></li><li><div>     * @param int   $form_id   Optional. If specified, then the ID in the Form object will be ignored&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed True for success, or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_form( $form, $form_id = null ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $form ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid', __( 'Invalid form object', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form_table_name = $wpdb-&gt;prefix . 'rg_form';&nbsp;</div></li><li><div>        if ( empty( $form_id ) ) {&nbsp;</div></li><li><div>            $form_id = $form['id'];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // make sure the form object has the right form id&nbsp;</div></li><li><div>            $form['id'] = $form_id;&nbsp;</div></li><li><div>            if ( isset( $form['fields'] ) ) {&nbsp;</div></li><li><div>                foreach ( $form['fields'] as &$field ) {&nbsp;</div></li><li><div>                    if ( $field instanceof GF_Field ) {&nbsp;</div></li><li><div>                        $field-&gt;formId = $form_id;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $field['formId'] = $form_id;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $form_id ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'missing_form_id', __( 'Missing form id', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta_table_name = GFFormsModel::get_meta_table_name();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( intval( $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT count(0) FROM {$meta_table_name} WHERE form_id=%d&quot;, $form_id ) ) ) == 0 ) {&nbsp;</div></li><li><div>            return new WP_Error( 'not_found', __( 'Form not found', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Strip confirmations and notifications&nbsp;</div></li><li><div>        $form_display_meta = $form;&nbsp;</div></li><li><div>        unset( $form_display_meta['confirmations'] );&nbsp;</div></li><li><div>        unset( $form_display_meta['notifications'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = GFFormsModel::update_form_meta( $form_id, $form_display_meta );&nbsp;</div></li><li><div>        if ( false === $result ) {&nbsp;</div></li><li><div>            return new WP_Error( 'error_updating_form', __( 'Error updating form', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $form['confirmations'] ) && is_array( $form['confirmations'] ) ) {&nbsp;</div></li><li><div>            $result = GFFormsModel::update_form_meta( $form_id, $form['confirmations'], 'confirmations' );&nbsp;</div></li><li><div>            if ( false === $result ) {&nbsp;</div></li><li><div>                return new WP_Error( 'error_updating_confirmations', __( 'Error updating form confirmations', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $form['notifications'] ) && is_array( $form['notifications'] ) ) {&nbsp;</div></li><li><div>            $result = GFFormsModel::update_form_meta( $form_id, $form['notifications'], 'notifications' );&nbsp;</div></li><li><div>            if ( false === $result ) {&nbsp;</div></li><li><div>                return new WP_Error( 'error_updating_notifications', __( 'Error updating form notifications', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //updating form title and is_active flag&nbsp;</div></li><li><div>        $is_active = rgar( $form, 'is_active' ) ? '1' : '0';&nbsp;</div></li><li><div>        $result = $wpdb-&gt;query( $wpdb-&gt;prepare( &quot;UPDATE {$form_table_name} SET title=%s, is_active=%s WHERE id=%d&quot;, $form['title'], $is_active, $form['id'] ) );&nbsp;</div></li><li><div>        if ( false === $result ) {&nbsp;</div></li><li><div>            return new WP_Error( 'error_updating_title', __( 'Error updating title', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates a form property - a column in the main forms table. e.g. is_trash, is_active, title&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8.3.15&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $form_ids     The IDs of the forms to update&nbsp;</div></li><li><div>     * @param array $property_key The name of the column in the database e.g. is_trash, is_active, title&nbsp;</div></li><li><div>     * @param array $value        The new value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either a WP_Error instance or the result of the query&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_forms_property( $form_ids, $property_key, $value ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $table = GFFormsModel::get_form_table_name();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $db_columns = GFFormsModel::get_form_db_columns();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! in_array( strtolower( $property_key ), $db_columns ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'property_key_incorrect', __( 'Property key incorrect', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = esc_sql( $value );&nbsp;</div></li><li><div>        if ( ! is_numeric( $value ) ) {&nbsp;</div></li><li><div>            $value = sprintf( &quot;'%s'&quot;, $value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $in_str_arr = array_fill( 0, count( $form_ids ), '%d' );&nbsp;</div></li><li><div>        $in_str = join( $in_str_arr, ', ' );&nbsp;</div></li><li><div>        $result = $wpdb-&gt;query(&nbsp;</div></li><li><div>            $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                &quot;&nbsp;</div></li><li><div>                UPDATE $table&nbsp;</div></li><li><div>                SET {$property_key} = {$value}&nbsp;</div></li><li><div>                WHERE id IN ($in_str)&nbsp;</div></li><li><div>                &quot;, $form_ids&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates the property of one form - columns in the main forms table. e.g. is_trash, is_active, title&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8.3.15&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|int $form_id      The ID of the forms to update&nbsp;</div></li><li><div>     * @param string    $property_key The name of the column in the database e.g. is_trash, is_active, title&nbsp;</div></li><li><div>     * @param string    $value        The new value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either a WP_Error instance or the result of the query&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_form_property( $form_id, $property_key, $value ) {&nbsp;</div></li><li><div>        return self::update_forms_property( array( $form_id ), $property_key, $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds multiple form objects.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $forms The Form objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either an array of new form IDs or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function add_forms( $forms ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $forms || ! is_array( $forms ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid', __( 'Invalid form objects', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $form_ids = array();&nbsp;</div></li><li><div>        foreach ( $forms as $form ) {&nbsp;</div></li><li><div>            $result = self::add_form( $form );&nbsp;</div></li><li><div>            if ( is_wp_error( $result ) ) {&nbsp;</div></li><li><div>                return $result;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $form_ids[] = $result;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $form_ids;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a new form using the given Form object. Warning, little checking is done to make sure it's a valid Form object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $form_meta The Form object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either the new Form ID or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function add_form( $form_meta ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $form_meta || ! is_array( $form_meta ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid', __( 'Invalid form object', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( rgar( $form_meta, 'title' ) == '' ) {&nbsp;</div></li><li><div>            return new WP_Error( 'missing_title', __( 'The form title is missing', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        //Making sure title is not duplicate&nbsp;</div></li><li><div>        $title = $form_meta['title'];&nbsp;</div></li><li><div>        $count = 2;&nbsp;</div></li><li><div>        while ( ! RGFormsModel::is_unique_title( $title ) ) {&nbsp;</div></li><li><div>            $title = $form_meta['title'] . &quot;($count)&quot;;&nbsp;</div></li><li><div>            $count ++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //inserting form&nbsp;</div></li><li><div>        $form_id = RGFormsModel::insert_form( $title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //updating form meta&nbsp;</div></li><li><div>        $form_meta['title'] = $title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //updating object's id property&nbsp;</div></li><li><div>        $form_meta['id'] = $form_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $form_meta['confirmations'] ) ) {&nbsp;</div></li><li><div>            $form_meta['confirmations'] = self::set_property_as_key( $form_meta['confirmations'], 'id' );&nbsp;</div></li><li><div>            GFFormsModel::update_form_meta( $form_id, $form_meta['confirmations'], 'confirmations' );&nbsp;</div></li><li><div>            unset( $form_meta['confirmations'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $form_meta['notifications'] ) ) {&nbsp;</div></li><li><div>            $form_meta['notifications'] = self::set_property_as_key( $form_meta['notifications'], 'id' );&nbsp;</div></li><li><div>            GFFormsModel::update_form_meta( $form_id, $form_meta['notifications'], 'notifications' );&nbsp;</div></li><li><div>            unset( $form_meta['notifications'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //updating form meta&nbsp;</div></li><li><div>        $result = GFFormsModel::update_form_meta( $form_id, $form_meta );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $result ) {&nbsp;</div></li><li><div>            return new WP_Error( 'insert_form_error', __( 'There was a problem while inserting the form', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $form_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Private.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @ignore&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function set_property_as_key( $array, $property ) {&nbsp;</div></li><li><div>        $new_array = array();&nbsp;</div></li><li><div>        foreach ( $array as $item ) {&nbsp;</div></li><li><div>            $new_array[ $item[ $property ] ] = $item;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $new_array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // ENTRIES ----------------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns an array of Entry objects for the given search criteria. The search criteria array is constructed as follows:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by status&nbsp;</div></li><li><div>     *     $search_criteria['status'] = 'active';&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by date range&nbsp;</div></li><li><div>     *     $search_criteria['start_date'] = $start_date;&nbsp;</div></li><li><div>     *     $search_criteria['end_date'] =  $end_date;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by any column in the main table&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array(&quot;key&quot; =&gt; 'currency', value =&gt; 'USD');&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array(&quot;key&quot; =&gt; 'is_read', value =&gt; true);&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by Field Values&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; '1', 'value' =&gt; 'gquiz159982170');&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter Operators&nbsp;</div></li><li><div>     *     Supported operators for scalar values: is/=, isnot/&lt;&gt;, contains&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; '1', 'operator' =&gt; 'contains', value' =&gt; 'Steve');&nbsp;</div></li><li><div>     *     Supported operators for array values: in/=, not in/&lt;&gt;/!=&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; '1', 'operator' =&gt; 'not in', value' =&gt; array( 'Alex', 'David', 'Dana' );&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by a checkbox value (not recommended)&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; '2.2', 'value' =&gt; 'gquiz246fec995');&nbsp;</div></li><li><div>     *     note: this will work for checkboxes but it won't work if the checkboxes have been re-ordered - best to use the following examples below&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by a checkbox value (recommended)&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; '2', 'value' =&gt; 'gquiz246fec995');&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; '2', 'operator' =&gt; 'not in', value' =&gt; array( 'First Choice', 'Third Choice' );&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by a global search of values of any form field&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('value' =&gt; $search_value);&nbsp;</div></li><li><div>     *  OR&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; 0, 'value' =&gt; $search_value);&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter entries by Entry meta (added using the gform_entry_meta hook)&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; 'gquiz_score', 'value' =&gt; '1');&nbsp;</div></li><li><div>     *     $search_criteria['field_filters'][] = array('key' =&gt; 'gquiz_is_pass', 'value' =&gt; '1');&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Filter by ALL / ANY of the field filters&nbsp;</div></li><li><div>     *     $search_criteria['field_filters']['mode'] = 'all'; // default&nbsp;</div></li><li><div>     *     $search_criteria['field_filters']['mode'] = 'any';&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Sorting: column, field or entry meta&nbsp;</div></li><li><div>     *     $sorting = array('key' =&gt; $sort_field, 'direction' =&gt; 'ASC' );&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *  Paging&nbsp;</div></li><li><div>     *     $paging = array('offset' =&gt; 0, 'page_size' =&gt; 20 );&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int|array $form_ids        The ID of the form or an array IDs of the Forms. Zero for all forms.&nbsp;</div></li><li><div>     * @param array     $search_criteria Optional. An array containing the search criteria&nbsp;</div></li><li><div>     * @param array     $sorting         Optional. An array containing the sorting criteria&nbsp;</div></li><li><div>     * @param array     $paging          Optional. An array containing the paging criteria&nbsp;</div></li><li><div>     * @param int       $total_count     Optional. An output parameter containing the total number of entries. Pass a non-null value to get the total count.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either an array of the Entry objects or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_entries( $form_ids, $search_criteria = array(), $sorting = null, $paging = null, &$total_count = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $sorting ) ) {&nbsp;</div></li><li><div>            $sorting = array( 'key' =&gt; 'id', 'direction' =&gt; 'DESC', 'is_numeric' =&gt; true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entries = GFFormsModel::search_leads( $form_ids, $search_criteria, $sorting, $paging );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_null( $total_count ) ) {&nbsp;</div></li><li><div>            $total_count = self::count_entries( $form_ids, $search_criteria );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $entries;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the total number of entries for the given search criteria. See get_entries() for examples of the search criteria.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int|array $form_ids        The ID of the Form or an array of Form IDs&nbsp;</div></li><li><div>     * @param array     $search_criteria Optional. An array containing the search criteria&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The total count&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function count_entries( $form_ids, $search_criteria = array() ) {&nbsp;</div></li><li><div>        return GFFormsModel::count_search_leads( $form_ids, $search_criteria );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the Entry object for a given Entry ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $entry_id The ID of the Entry&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed The Entry object or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_entry( $entry_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $search_criteria['field_filters'][] = array( 'key' =&gt; 'id', 'value' =&gt; $entry_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $paging = array( 'offset' =&gt; 0, 'page_size' =&gt; 1 );&nbsp;</div></li><li><div>        $entries = self::get_entries( 0, $search_criteria, null, $paging );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $entries ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'not_found', sprintf( __( 'Entry with id %s not found', 'gravityforms' ), $entry_id ), $entry_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $entries[0];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds multiple Entry objects.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $entries The Entry objects&nbsp;</div></li><li><div>     * @param int   $form_id Optional. If specified, the form_id in the Entry objects will be ignored&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either an array of new Entry IDs or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function add_entries( $entries, $form_id = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entry_ids = array();&nbsp;</div></li><li><div>        foreach ( $entries as $entry ) {&nbsp;</div></li><li><div>            if ( $form_id ) {&nbsp;</div></li><li><div>                $entry['form_id'] = $form_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $result = self::add_entry( $entry );&nbsp;</div></li><li><div>            if ( is_wp_error( $result ) ) {&nbsp;</div></li><li><div>                return $result;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $entry_ids[] = $result;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $entry_ids;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates multiple Entry objects.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $entries The Entry objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either True for success, or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_entries( $entries ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $entries as $entry ) {&nbsp;</div></li><li><div>            $entry_id = rgar( $entry, 'id' );&nbsp;</div></li><li><div>            GFCommon::log_debug( 'Updating entry ' . $entry_id );&nbsp;</div></li><li><div>            $result = self::update_entry( $entry, $entry_id );&nbsp;</div></li><li><div>            if ( is_wp_error( $result ) ) {&nbsp;</div></li><li><div>                return $result;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates a single Entry object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $entry    The Entry object&nbsp;</div></li><li><div>     * @param int   $entry_id Optional. If specified, the ID in the Entry object will be ignored&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either True or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_entry( $entry, $entry_id = null ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $entry_id ) ) {&nbsp;</div></li><li><div>            if ( rgar( $entry, 'id' ) ) {&nbsp;</div></li><li><div>                $entry_id = absint( $entry['id'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $entry['id'] = absint( $entry_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $entry_id ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'missing_entry_id', __( 'Missing entry id', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current_entry = $original_entry = self::get_entry( $entry_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $current_entry ) {&nbsp;</div></li><li><div>            return new WP_Error( 'not_found', __( 'Entry not found', 'gravityforms' ), $entry_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $current_entry ) ) {&nbsp;</div></li><li><div>            return $current_entry;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // make sure the form id exists&nbsp;</div></li><li><div>        $form_id = rgar( $entry, 'form_id' );&nbsp;</div></li><li><div>        if ( empty( $form_id ) ) {&nbsp;</div></li><li><div>            $form_id = rgar( $current_entry, 'form_id' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === self::form_id_exists( $form_id ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_form_id', __( 'The form for this entry does not exist', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entry = apply_filters( 'gform_entry_pre_update', $entry, $original_entry );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // use values in the entry object if present&nbsp;</div></li><li><div>        $post_id = isset( $entry['post_id'] ) ? intval( $entry['post_id'] ) : 'NULL';&nbsp;</div></li><li><div>        $date_created = isset( $entry['date_created'] ) ? sprintf( &quot;'%s'&quot;, esc_sql( $entry['date_created'] ) ) : 'utc_timestamp()';&nbsp;</div></li><li><div>        $is_starred = isset( $entry['is_starred'] ) ? $entry['is_starred'] : 0;&nbsp;</div></li><li><div>        $is_read = isset( $entry['is_read'] ) ? $entry['is_read'] : 0;&nbsp;</div></li><li><div>        $ip = isset( $entry['ip'] ) ? $entry['ip'] : GFFormsModel::get_ip();&nbsp;</div></li><li><div>        $source_url = isset( $entry['source_url'] ) ? $entry['source_url'] : GFFormsModel::get_current_page_url();&nbsp;</div></li><li><div>        $user_agent = isset( $entry['user_agent'] ) ? $entry['user_agent'] : 'API';&nbsp;</div></li><li><div>        $currency = isset( $entry['currency'] ) ? $entry['currency'] : GFCommon::get_currency();&nbsp;</div></li><li><div>        $payment_status = isset( $entry['payment_status'] ) ? sprintf( &quot;'%s'&quot;, esc_sql( $entry['payment_status'] ) ) : 'NULL';&nbsp;</div></li><li><div>        $payment_date = strtotime( rgar( $entry, 'payment_date' ) ) ? &quot;'&quot; . gmdate( 'Y-m-d H:i:s', strtotime( &quot;{$entry['payment_date']}&quot; ) ) . &quot;'&quot; : 'NULL';&nbsp;</div></li><li><div>        $payment_amount = isset( $entry['payment_amount'] ) ? (float) $entry['payment_amount'] : 'NULL';&nbsp;</div></li><li><div>        $payment_method = isset( $entry['payment_method'] ) ? $entry['payment_method'] : '';&nbsp;</div></li><li><div>        $transaction_id = isset( $entry['transaction_id'] ) ? sprintf( &quot;'%s'&quot;, esc_sql( $entry['transaction_id'] ) ) : 'NULL';&nbsp;</div></li><li><div>        $is_fulfilled = isset( $entry['is_fulfilled'] ) ? intval( $entry['is_fulfilled'] ) : 'NULL';&nbsp;</div></li><li><div>        $status = isset( $entry['status'] ) ? $entry['status'] : 'active';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $current_user;&nbsp;</div></li><li><div>        $user_id = isset( $entry['created_by'] ) ?  absint( $entry['created_by'] ) : '';&nbsp;</div></li><li><div>        if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>            $user_id = $current_user && $current_user-&gt;ID ? absint( $current_user-&gt;ID ) : 'NULL';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction_type = isset( $entry['transaction_type'] ) ? intval( $entry['transaction_type'] ) : 'NULL';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lead_table = GFFormsModel::get_lead_table_name();&nbsp;</div></li><li><div>        $sql = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                &quot;&nbsp;</div></li><li><div>                UPDATE $lead_table&nbsp;</div></li><li><div>                SET&nbsp;</div></li><li><div>                form_id = %d, &nbsp;</div></li><li><div>                post_id = {$post_id}, &nbsp;</div></li><li><div>                date_created = {$date_created}, &nbsp;</div></li><li><div>                is_starred = %d, &nbsp;</div></li><li><div>                is_read = %d, &nbsp;</div></li><li><div>                ip = %s, &nbsp;</div></li><li><div>                source_url = %s, &nbsp;</div></li><li><div>                user_agent = %s, &nbsp;</div></li><li><div>                currency = %s, &nbsp;</div></li><li><div>                payment_status = {$payment_status}, &nbsp;</div></li><li><div>                payment_date = {$payment_date}, &nbsp;</div></li><li><div>                payment_amount = {$payment_amount}, &nbsp;</div></li><li><div>                transaction_id = {$transaction_id}, &nbsp;</div></li><li><div>                is_fulfilled = {$is_fulfilled}, &nbsp;</div></li><li><div>                created_by = {$user_id}, &nbsp;</div></li><li><div>                transaction_type = {$transaction_type}, &nbsp;</div></li><li><div>                status = %s, &nbsp;</div></li><li><div>                payment_method = %s&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                id = %d&nbsp;</div></li><li><div>                &quot;, $form_id, $is_starred, $is_read, $ip, $source_url, $user_agent, $currency, $status, $payment_method, $entry_id&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $result = $wpdb-&gt;query( $sql );&nbsp;</div></li><li><div>        if ( false === $result ) {&nbsp;</div></li><li><div>            return new WP_Error( 'update_entry_properties_failed', __( 'There was a problem while updating the entry properties', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // only save field values for fields that currently exist in the form. The rest in $entry will be ignored. The rest in $current_entry will get deleted.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lead_detail_table = GFFormsModel::get_lead_details_table_name();&nbsp;</div></li><li><div>        $current_fields = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT id, field_number FROM $lead_detail_table WHERE lead_id=%d&quot;, $entry_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = GFFormsModel::get_form_meta( $form_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = gf_apply_filters( array( 'gform_form_pre_update_entry', $form_id ), $form, $entry, $entry_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $form['fields'] as $field ) {&nbsp;</div></li><li><div>            /** @var GF_Field $field */&nbsp;</div></li><li><div>            $type = GFFormsModel::get_input_type( $field );&nbsp;</div></li><li><div>            if ( in_array( $type, array( 'html', 'page', 'section' ) ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $inputs = $field-&gt;get_entry_inputs();&nbsp;</div></li><li><div>            if ( is_array( $inputs ) ) {&nbsp;</div></li><li><div>                foreach ( $field-&gt;inputs as $input ) {&nbsp;</div></li><li><div>                    $input_id = (string) $input['id'];&nbsp;</div></li><li><div>                    if ( isset( $entry[ $input_id ] ) ) {&nbsp;</div></li><li><div>                        if ( $entry[ $input_id ] != $current_entry[ $input_id ] ) {&nbsp;</div></li><li><div>                            $lead_detail_id = GFFormsModel::get_lead_detail_id( $current_fields, $input_id );&nbsp;</div></li><li><div>                            $result = GFFormsModel::update_lead_field_value( $form, $entry, $field, $lead_detail_id, $input_id, $entry[ $input_id ] );&nbsp;</div></li><li><div>                            if ( false === $result ) {&nbsp;</div></li><li><div>                                return new WP_Error( 'update_input_value_failed', __( 'There was a problem while updating one of the input values for the entry', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        unset( $current_entry[ $input_id ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $field_id = $field-&gt;id;&nbsp;</div></li><li><div>                $field_value = isset( $entry[ (string) $field_id ] ) ? $entry[ (string) $field_id ] : '';&nbsp;</div></li><li><div>                if ( $field_value != $current_entry[ $field_id ] ) {&nbsp;</div></li><li><div>                    $lead_detail_id = GFFormsModel::get_lead_detail_id( $current_fields, $field_id );&nbsp;</div></li><li><div>                    $result = GFFormsModel::update_lead_field_value( $form, $entry, $field, $lead_detail_id, $field_id, $field_value );&nbsp;</div></li><li><div>                    if ( false === $result ) {&nbsp;</div></li><li><div>                        return new WP_Error( 'update_field_values_failed', __( 'There was a problem while updating the field values', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                unset( $current_entry[ $field_id ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // save the entry meta values - only for the entry meta currently available for the form, ignore the rest&nbsp;</div></li><li><div>        $entry_meta = GFFormsModel::get_entry_meta( $form_id );&nbsp;</div></li><li><div>        if ( is_array( $entry_meta ) ) {&nbsp;</div></li><li><div>            foreach ( array_keys( $entry_meta ) as $key ) {&nbsp;</div></li><li><div>                if ( isset( $entry[ $key ] ) ) {&nbsp;</div></li><li><div>                    if ( $entry[ $key ] != $current_entry[ $key ] ) {&nbsp;</div></li><li><div>                        gform_update_meta( $entry_id, $key, $entry[ $key ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    unset( $current_entry[ $key ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // now delete remaining values from the old entry&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $entry_meta ) ) {&nbsp;</div></li><li><div>            foreach ( array_keys( $entry_meta ) as $meta_key ) {&nbsp;</div></li><li><div>                if ( isset( $current_entry[ $meta_key ] ) ) {&nbsp;</div></li><li><div>                    gform_delete_meta( $entry_id, $meta_key );&nbsp;</div></li><li><div>                    unset( $current_entry[ $meta_key ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $current_entry as $k =&gt; $v ) {&nbsp;</div></li><li><div>            $lead_detail_id = GFFormsModel::get_lead_detail_id( $current_fields, $k );&nbsp;</div></li><li><div>            $field = GFFormsModel::get_field( $form, $k );&nbsp;</div></li><li><div>            $result = GFFormsModel::update_lead_field_value( $form, $entry, $field, $lead_detail_id, $k, '' );&nbsp;</div></li><li><div>            if ( false === $result ) {&nbsp;</div></li><li><div>                return new WP_Error( 'update_field_values_failed', __( 'There was a problem while updating the field values', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after the Entry is updated.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $lead The entry object after being updated.&nbsp;</div></li><li><div>         * @param array $original_entry The entry object before being updated.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        gf_do_action( array( 'gform_post_update_entry', $form_id ), $entry, $original_entry );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a single Entry object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Intended to be used for importing an entry object. The usual hooks that are triggered while saving entries are not fired here.&nbsp;</div></li><li><div>     * Checks that the form id, field ids and entry meta exist and ignores legacy values (i.e. values for fields that no longer exist).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $entry The Entry object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either the new Entry ID or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function add_entry( $entry ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_array( $entry ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_entry_object', __( 'The entry object must be an array', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // make sure the form id exists&nbsp;</div></li><li><div>        $form_id = rgar( $entry, 'form_id' );&nbsp;</div></li><li><div>        if ( empty( $form_id ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'empty_form_id', __( 'The form id must be specified', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === self::form_id_exists( $form_id ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_form_id', __( 'The form for this entry does not exist', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // use values in the entry object if present&nbsp;</div></li><li><div>        $post_id = isset( $entry['post_id'] ) ? intval( $entry['post_id'] ) : 'NULL';&nbsp;</div></li><li><div>        $date_created = isset( $entry['date_created'] ) && $entry['date_created'] != '' ? sprintf( &quot;'%s'&quot;, esc_sql( $entry['date_created'] ) ) : 'utc_timestamp()';&nbsp;</div></li><li><div>        $is_starred = isset( $entry['is_starred'] ) ? $entry['is_starred'] : 0;&nbsp;</div></li><li><div>        $is_read = isset( $entry['is_read'] ) ? $entry['is_read'] : 0;&nbsp;</div></li><li><div>        $ip = isset( $entry['ip'] ) ? $entry['ip'] : GFFormsModel::get_ip();&nbsp;</div></li><li><div>        $source_url = isset( $entry['source_url'] ) ? $entry['source_url'] : esc_url_raw( GFFormsModel::get_current_page_url() );&nbsp;</div></li><li><div>        $user_agent = isset( $entry['user_agent'] ) ? $entry['user_agent'] : 'API';&nbsp;</div></li><li><div>        $currency = isset( $entry['currency'] ) ? $entry['currency'] : GFCommon::get_currency();&nbsp;</div></li><li><div>        $payment_status = isset( $entry['payment_status'] ) ? sprintf( &quot;'%s'&quot;, esc_sql( $entry['payment_status'] ) ) : 'NULL';&nbsp;</div></li><li><div>        $payment_date = strtotime( rgar( $entry, 'payment_date' ) ) ? sprintf( &quot;'%s'&quot;, gmdate( 'Y-m-d H:i:s', strtotime( &quot;{$entry['payment_date']}&quot; ) ) ) : 'NULL';&nbsp;</div></li><li><div>        $payment_amount = isset( $entry['payment_amount'] ) ? (float) $entry['payment_amount'] : 'NULL';&nbsp;</div></li><li><div>        $payment_method = isset( $entry['payment_method'] ) ? $entry['payment_method'] : '';&nbsp;</div></li><li><div>        $transaction_id = isset( $entry['transaction_id'] ) ? sprintf( &quot;'%s'&quot;, esc_sql( $entry['transaction_id'] ) ) : 'NULL';&nbsp;</div></li><li><div>        $is_fulfilled = isset( $entry['is_fulfilled'] ) ? intval( $entry['is_fulfilled'] ) : 'NULL';&nbsp;</div></li><li><div>        $status = isset( $entry['status'] ) ? $entry['status'] : 'active';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $current_user;&nbsp;</div></li><li><div>        $user_id = isset( $entry['created_by'] ) ? absint( $entry['created_by'] ) : '';&nbsp;</div></li><li><div>        if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>            $user_id = $current_user && $current_user-&gt;ID ? absint( $current_user-&gt;ID )  : 'NULL';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction_type = isset( $entry['transaction_type'] ) ? intval( $entry['transaction_type'] ) : 'NULL';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lead_table = GFFormsModel::get_lead_table_name();&nbsp;</div></li><li><div>        $result = $wpdb-&gt;query(&nbsp;</div></li><li><div>            $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                &quot;&nbsp;</div></li><li><div>                INSERT INTO $lead_table&nbsp;</div></li><li><div>                (form_id, post_id, date_created, is_starred, is_read, ip, source_url, user_agent, currency, payment_status, payment_date, payment_amount, transaction_id, is_fulfilled, created_by, transaction_type, status, payment_method)&nbsp;</div></li><li><div>                VALUES&nbsp;</div></li><li><div>                (%d, {$post_id}, {$date_created}, %d, %d, %s, %s, %s, %s, {$payment_status}, {$payment_date}, {$payment_amount}, {$transaction_id}, {$is_fulfilled}, {$user_id}, {$transaction_type}, %s, %s)&nbsp;</div></li><li><div>                &quot;, $form_id, $is_starred, $is_read, $ip, $source_url, $user_agent, $currency, $status, $payment_method&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        if ( false === $result ) {&nbsp;</div></li><li><div>            return new WP_Error( 'insert_entry_properties_failed', __( 'There was a problem while inserting the entry properties', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // reading newly created lead id&nbsp;</div></li><li><div>        $entry_id = $wpdb-&gt;insert_id;&nbsp;</div></li><li><div>        $entry['id'] = $entry_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // only save field values for fields that currently exist in the form&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = GFFormsModel::get_form_meta( $form_id );&nbsp;</div></li><li><div>        foreach ( $form['fields'] as $field ) {&nbsp;</div></li><li><div>            /** @var GF_Field $field */&nbsp;</div></li><li><div>            if ( in_array( $field-&gt;type, array( 'html', 'page', 'section' ) ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $inputs = $field-&gt;get_entry_inputs();&nbsp;</div></li><li><div>            if ( is_array( $inputs ) ) {&nbsp;</div></li><li><div>                foreach ( $inputs as $input ) {&nbsp;</div></li><li><div>                    $input_id = (string) $input['id'];&nbsp;</div></li><li><div>                    if ( isset( $entry[ $input_id ] ) ) {&nbsp;</div></li><li><div>                        $result = GFFormsModel::update_lead_field_value( $form, $entry, $field, 0, $input_id, $entry[ $input_id ] );&nbsp;</div></li><li><div>                        if ( false === $result ) {&nbsp;</div></li><li><div>                            return new WP_Error( 'insert_input_value_failed', __( 'There was a problem while inserting one of the input values for the entry', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $field_id = $field-&gt;id;&nbsp;</div></li><li><div>                $field_value = isset( $entry[ (string) $field_id ] ) ? $entry[ (string) $field_id ] : '';&nbsp;</div></li><li><div>                $result = GFFormsModel::update_lead_field_value( $form, $entry, $field, 0, $field_id, $field_value );&nbsp;</div></li><li><div>                if ( false === $result ) {&nbsp;</div></li><li><div>                    return new WP_Error( 'insert_field_values_failed', __( 'There was a problem while inserting the field values', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add save the entry meta values - only for the entry meta currently available for the form, ignore the rest&nbsp;</div></li><li><div>        $entry_meta = GFFormsModel::get_entry_meta( $form_id );&nbsp;</div></li><li><div>        if ( is_array( $entry_meta ) ) {&nbsp;</div></li><li><div>            foreach ( array_keys( $entry_meta ) as $key ) {&nbsp;</div></li><li><div>                if ( isset( $entry[ $key ] ) ) {&nbsp;</div></li><li><div>                    gform_update_meta( $entry_id, $key, $entry[ $key ], $form['id'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $entry_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes a single Entry.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $entry_id The ID of the Entry object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either true for success or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_entry( $entry_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entry = GFFormsModel::get_lead( $entry_id );&nbsp;</div></li><li><div>        if ( empty( $entry ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_entry_id', sprintf( __( 'Invalid entry id: %s', 'gravityforms' ), $entry_id ), $entry_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        GFFormsModel::delete_lead( $entry_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates a single property of an entry.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8.3.1&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int    $entry_id The ID of the Entry object&nbsp;</div></li><li><div>     * @param string $property The property of the Entry object to be updated&nbsp;</div></li><li><div>     * @param mixed  $value    The value to which the property should be set&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether the entry property was updated successfully&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_entry_property( $entry_id, $property, $value ) {&nbsp;</div></li><li><div>        return GFFormsModel::update_lead_property( $entry_id, $property, $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Updates a single field of an entry.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.9&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int    $entry_id The ID of the Entry object&nbsp;</div></li><li><div>     * @param string $input_id The id of the input to be updated. For single input fields such as text, paragraph, website, drop down etc... this will be the same as the field ID.&nbsp;</div></li><li><div>     *                         For multi input fields such as name, address, checkboxes, etc... the input id will be in the format {FIELD_ID}.{INPUT NUMBER}. ( i.e. &quot;1.3&quot; )&nbsp;</div></li><li><div>     *                         The $input_id can be obtained by inspecting the key for the specified field in the $entry object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed  $value    The value to which the field should be set&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether the entry property was updated successfully&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_entry_field( $entry_id, $input_id, $value ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entry = self::get_entry( $entry_id );&nbsp;</div></li><li><div>        if ( is_wp_error( $entry ) ) {&nbsp;</div></li><li><div>            return $entry;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = self::get_form( $entry['form_id'] );&nbsp;</div></li><li><div>        if ( ! $form ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = GFFormsModel::get_field( $form, $input_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $input_id_min = (float) $input_id - 0.0001;&nbsp;</div></li><li><div>        $input_id_max = (float) $input_id + 0.0001;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lead_details_table_name = GFFormsModel::get_lead_details_table_name();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lead_detail_id = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT id FROM {$lead_details_table_name} WHERE lead_id=%d AND field_number BETWEEN %s AND %s&quot;, $entry_id, $input_id_min, $input_id_max ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = true;&nbsp;</div></li><li><div>        if ( ! isset( $entry[ $input_id ] ) || $entry[ $input_id ] != $value ) {&nbsp;</div></li><li><div>            $result = GFFormsModel::update_lead_field_value( $form, $entry, $field, $lead_detail_id, $input_id, $value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // FORM SUBMISSIONS -------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Submits a form. Use this function to send input values through the complete form submission process.&nbsp;</div></li><li><div>     * Supports field validation, notifications, confirmations, multiple-pages and save & continue.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Example usage:&nbsp;</div></li><li><div>     * $input_values['input_1'] = 'Single line text';&nbsp;</div></li><li><div>     * $input_values['input_2_3'] = 'First name';&nbsp;</div></li><li><div>     * $input_values['input_2_6'] = 'Last name';&nbsp;</div></li><li><div>     * $input_values['input_5'] = 'A paragraph of text.';&nbsp;</div></li><li><div>     * //$input_values['gform_save'] = true; // support for save and continue&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $result = GFAPI::submit_form( 52, $input_values );&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Example output for a successful submission:&nbsp;</div></li><li><div>     * 'is_valid' =&gt; boolean true&nbsp;</div></li><li><div>     * 'page_number' =&gt; int 0&nbsp;</div></li><li><div>     * 'source_page_number' =&gt; int 1&nbsp;</div></li><li><div>     * 'confirmation_message' =&gt; string 'confirmation message [snip]'&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Example output for failed validation:&nbsp;</div></li><li><div>     * 'is_valid' =&gt; boolean false&nbsp;</div></li><li><div>     * 'validation_messages' =&gt;&nbsp;</div></li><li><div>     *      array (size=1)&nbsp;</div></li><li><div>     *          2 =&gt; string 'This field is required. Please enter the first and last name.'&nbsp;</div></li><li><div>     *    'page_number' =&gt; int 1&nbsp;</div></li><li><div>     *  'source_page_number' =&gt; int 1&nbsp;</div></li><li><div>     *    'confirmation_message' =&gt; string ''&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Example output for save and continue:&nbsp;</div></li><li><div>     * 'is_valid' =&gt; boolean true&nbsp;</div></li><li><div>     * 'page_number' =&gt; int 1&nbsp;</div></li><li><div>     * 'source_page_number' =&gt; int 1&nbsp;</div></li><li><div>     * 'confirmation_message' =&gt; string 'Please use the following link to return to your form from any computer. [snip]'&nbsp;</div></li><li><div>     * 'resume_token' =&gt; string '045f941cc4c04d479556bab1db6d3495'&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $form_id The Form ID&nbsp;</div></li><li><div>     * @param array $input_values An array of values.&nbsp;</div></li><li><div>     * @param array $field_values Optional.&nbsp;</div></li><li><div>     * @param int $target_page Optional.&nbsp;</div></li><li><div>     * @param int $source_page Optional.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array An array containing the result of the submission.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function submit_form( $form_id, $input_values, $field_values = array(), $target_page = 0, $source_page = 1 ) {&nbsp;</div></li><li><div>        $form_id = absint( $form_id );&nbsp;</div></li><li><div>        $form = GFAPI::get_form( $form_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $form ) || ! $form['is_active'] || $form['is_trash'] ) {&nbsp;</div></li><li><div>            return new WP_Error( 'form_not_found', __( 'Your form could not be found', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $input_values[ 'is_submit_' . $form_id ]                = true;&nbsp;</div></li><li><div>        $input_values['gform_submit'] = $form_id;&nbsp;</div></li><li><div>        $input_values[ 'gform_target_page_number_' . $form_id ] = absint( $target_page );&nbsp;</div></li><li><div>        $input_values[ 'gform_source_page_number_' . $form_id ] = absint( $source_page );&nbsp;</div></li><li><div>        $input_values['gform_field_values'] = $field_values;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        require_once(GFCommon::get_base_path() . '/form_display.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $_POST ) ) {&nbsp;</div></li><li><div>            $_POST = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_POST = array_merge_recursive( $_POST, $input_values );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            GFFormDisplay::process_form( $form_id );&nbsp;</div></li><li><div>        } catch ( Exception $ex ) {&nbsp;</div></li><li><div>            return new WP_Error( 'error_processing_form', __( 'There was an error while processing the form:', 'gravityforms' ) . ' ' . $ex-&gt;getCode() . ' ' . $ex-&gt;getMessage() );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( GFFormDisplay::$submission ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'error_processing_form', __( 'There was an error while processing the form:', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $submissions_array = GFFormDisplay::$submission;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $submission_details = $submissions_array[ $form_id ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result['is_valid'] = $submission_details['is_valid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $result['is_valid'] == false ) {&nbsp;</div></li><li><div>            $validation_messages = array();&nbsp;</div></li><li><div>            foreach ( $submission_details['form']['fields'] as $field ) {&nbsp;</div></li><li><div>                if ( $field-&gt;failed_validation ) {&nbsp;</div></li><li><div>                    $validation_messages[ $field-&gt;id ] = $field-&gt;validation_message;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $result['validation_messages'] = $validation_messages;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result['page_number'] = $submission_details['page_number'];&nbsp;</div></li><li><div>        $result['source_page_number'] = $submission_details['source_page_number'];&nbsp;</div></li><li><div>        $result['confirmation_message'] = $submission_details['confirmation_message'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $submission_details['resume_token'] ) ) {&nbsp;</div></li><li><div>            $result['resume_token'] = $submission_details['resume_token'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $form = self::get_form( $form_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $result['confirmation_message'] = GFFormDisplay::replace_save_variables( $result['confirmation_message'], $form, $result['resume_token'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // FEEDS ------------------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns all the feeds for the given criteria.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed  $feed_ids   The ID of the Feed or an array of Feed IDs&nbsp;</div></li><li><div>     * @param int    $form_id    The ID of the Form to which the Feeds belong&nbsp;</div></li><li><div>     * @param string $addon_slug The slug of the add-on to which the Feeds belong&nbsp;</div></li><li><div>     * @param bool   $is_active&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either an array of Feed objects or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_feeds( $feed_ids = null, $form_id = null, $addon_slug = null, $is_active = true ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table = $wpdb-&gt;prefix . 'gf_addon_feed';&nbsp;</div></li><li><div>        $where_arr = array();&nbsp;</div></li><li><div>        $where_arr[] = $wpdb-&gt;prepare( 'is_active=%d', $is_active );&nbsp;</div></li><li><div>        if ( false === empty( $form_id ) ) {&nbsp;</div></li><li><div>            $where_arr[] = $wpdb-&gt;prepare( 'form_id=%d', $form_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( false === empty( $addon_slug ) ) {&nbsp;</div></li><li><div>            $where_arr[] = $wpdb-&gt;prepare( 'addon_slug=%s', $addon_slug );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( false === empty( $feed_ids ) ) {&nbsp;</div></li><li><div>            if ( ! is_array( $feed_ids ) ) {&nbsp;</div></li><li><div>                $feed_ids = array( $feed_ids );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $in_str_arr = array_fill( 0, count( $feed_ids ), '%d' );&nbsp;</div></li><li><div>            $in_str = join( $in_str_arr, ', ' );&nbsp;</div></li><li><div>            $where_arr[] = $wpdb-&gt;prepare( &quot;id IN ($in_str)&quot;, $feed_ids );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $where = join( ' AND ', $where_arr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;SELECT id, form_id, addon_slug, meta FROM {$table} WHERE $where&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = $wpdb-&gt;get_results( $sql, ARRAY_A );&nbsp;</div></li><li><div>        if ( empty( $results ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'not_found', __( 'Feed not found', 'gravityforms' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $results as &$result ) {&nbsp;</div></li><li><div>            $result['meta'] = json_decode( $result['meta'], true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $results;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes a single Feed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $feed_id The ID of the Feed to delete&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either an array of Feed objects or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_feed( $feed_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table = $wpdb-&gt;prefix . 'gf_addon_feed';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = $wpdb-&gt;prepare( &quot;DELETE FROM {$table} WHERE id=%d&quot;, $feed_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = $wpdb-&gt;query( $sql );&nbsp;</div></li><li><div>        if ( false === $results ) {&nbsp;</div></li><li><div>            return new WP_Error( 'error_deleting', sprintf( __( 'There was an an error while deleting feed id %s', 'gravityforms' ), $feed_id ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 === $results ) {&nbsp;</div></li><li><div>            return new WP_Error( 'not_found', sprintf( __( 'Feed id %s not found', 'gravityforms' ), $feed_id ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function update_feed( $feed_id, $feed_meta, $form_id = null ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $feed_meta_json = json_encode( $feed_meta );&nbsp;</div></li><li><div>        $table = $wpdb-&gt;prefix . 'gf_addon_feed';&nbsp;</div></li><li><div>        if ( empty( $form_id ) ) {&nbsp;</div></li><li><div>            $sql = $wpdb-&gt;prepare( &quot;UPDATE {$table} SET meta= %s WHERE id=%d&quot;, $feed_meta_json, $feed_id );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $sql = $wpdb-&gt;prepare( &quot;UPDATE {$table} SET form_id = %d, meta= %s WHERE id=%d&quot;, $form_id, $feed_meta_json, $feed_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = $wpdb-&gt;query( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $results ) {&nbsp;</div></li><li><div>            return new WP_Error( 'error_updating', sprintf( __( 'There was an an error while updating feed id %s', 'gravityforms' ), $feed_id ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 === $results ) {&nbsp;</div></li><li><div>            return new WP_Error( 'not_found', sprintf( __( 'Feed id %s not found', 'gravityforms' ), $feed_id ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $results;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a feed with the given Feed object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int    $form_id    The ID of the Form to which the Feed belongs&nbsp;</div></li><li><div>     * @param array  $feed_meta  The Feed object&nbsp;</div></li><li><div>     * @param string $addon_slug The slug of the add-on to which the Feeds belong&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Either the ID of the newly created Feed or a WP_Error instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function add_feed( $form_id, $feed_meta, $addon_slug ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table = $wpdb-&gt;prefix . 'gf_addon_feed';&nbsp;</div></li><li><div>        $feed_meta_json = json_encode( $feed_meta );&nbsp;</div></li><li><div>        $sql = $wpdb-&gt;prepare( &quot;INSERT INTO {$table} (form_id, meta, addon_slug) VALUES (%d, %s, %s)&quot;, $form_id, $feed_meta_json, $addon_slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = $wpdb-&gt;query( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $results ) {&nbsp;</div></li><li><div>            return new WP_Error( 'error_inserting', __( 'There was an an error while inserting a feed', 'gravityforms' ), $wpdb-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $wpdb-&gt;insert_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // NOTIFICATIONS ----------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sends all active notifications for a form given an entry object and an event.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $form&nbsp;</div></li><li><div>     * @param $entry&nbsp;</div></li><li><div>     * @param string $event Default = 'form_submission'&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function send_notifications( $form, $entry, $event = 'form_submission' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( rgempty( 'notifications', $form ) || ! is_array( $form['notifications'] ) ) {&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entry_id = rgar( $entry, 'id' );&nbsp;</div></li><li><div>        GFCommon::log_debug( &quot;GFAPI::send_notifications(): Gathering notifications for {$event} event for entry #{$entry_id}.&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $notifications_to_send = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //running through filters that disable form submission notifications&nbsp;</div></li><li><div>        foreach ( $form['notifications'] as $notification ) {&nbsp;</div></li><li><div>            if ( rgar( $notification, 'event' ) != $event ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $event == 'form_submission' ) {&nbsp;</div></li><li><div>                if ( rgar( $notification, 'type' ) == 'user' && gf_apply_filters( array( 'gform_disable_user_notification', $form['id'] ), false, $form, $entry ) ) {&nbsp;</div></li><li><div>                    GFCommon::log_debug( &quot;GFAPI::send_notifications(): Notification is disabled by gform_disable_user_notification hook, not including notification (#{$notification['id']} - {$notification['name']}).&quot; );&nbsp;</div></li><li><div>                    //skip user notification if it has been disabled by a hook&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                } elseif ( rgar( $notification, 'type' ) == 'admin' && gf_apply_filters( array( 'gform_disable_admin_notification', $form['id'] ), false, $form, $entry ) ) {&nbsp;</div></li><li><div>                    GFCommon::log_debug( &quot;GFAPI::send_notifications(): Notification is disabled by gform_disable_admin_notification hook, not including notification (#{$notification['id']} - {$notification['name']}).&quot; );&nbsp;</div></li><li><div>                    //skip admin notification if it has been disabled by a hook&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( gf_apply_filters( array( 'gform_disable_notification', $form['id'] ), false, $notification, $form, $entry ) ) {&nbsp;</div></li><li><div>                GFCommon::log_debug( &quot;GFAPI::send_notifications(): Notification is disabled by gform_disable_notification hook, not including notification (#{$notification['id']} - {$notification['name']}).&quot; );&nbsp;</div></li><li><div>                //skip notifications if it has been disabled by a hook&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $notifications_to_send[] = $notification['id'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        GFCommon::send_notifications( $notifications_to_send, $form, $entry, true, $event );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // PERMISSIONS ------------------------------------------------&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks the permissions for the current user. Returns true if the current user has any of the specified capabilities.&nbsp;</div></li><li><div>     * IMPORTANT: Call this before calling any of the other API Functions as permission checks are not performed at lower levels.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8.5.10&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|string $capabilities An array of capabilities, or a single capability&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Returns true if the current user has any of the specified capabilities&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function current_user_can_any( $capabilities ) {&nbsp;</div></li><li><div>        return GFCommon::current_user_can_any( $capabilities );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // FIELDS -----------------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns an array containing the form fields of the specified type or types.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.9.8&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $form&nbsp;</div></li><li><div>     * @param array|string $types&nbsp;</div></li><li><div>     * @param bool $use_input_type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return GF_Field[]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_fields_by_type( $form, $types, $use_input_type = false ) {&nbsp;</div></li><li><div>        return GFFormsModel::get_fields_by_type( $form, $types, $use_input_type );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // HELPERS ----------------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Private.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  1.8&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @ignore&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function form_id_exists( $form_id ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $form_table_name = GFFormsModel::get_form_table_name();&nbsp;</div></li><li><div>        $form_id = intval( $form_id );&nbsp;</div></li><li><div>        $result = $wpdb-&gt;get_var(&nbsp;</div></li><li><div>            $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                &quot; SELECT count(id) FROM {$form_table_name}&nbsp;</div></li><li><div>                  WHERE id=%d&quot;, $form_id&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = intval( $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result &gt; 0;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd> <a href="http://hookr.io/plugins/gravity-forms/1.9.14.22/classes/gfapi/">1.9.14.22</a></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>GFAPI</li><li><span></span>wp-plugin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>