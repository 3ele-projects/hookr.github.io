<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-id="80539"><head xmlns="http://www.w3.org/1999/xhtml"><title> angelleye_gateway_paypal | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="AngellEYE_Gateway_Paypal, class, plugin, paypal-for-woocommerce, 1.4.3" /><meta name="description" content="The WordPress Core AngellEYE Gateway Paypal class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=5d0ceefa87e7cb4ac0bc89bb09a39fff' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/angell_eye_gateway_paypal/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fangell_eye_gateway_paypal%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fangell_eye_gateway_paypal%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-1.4.3-class-angell_eye_gateway_paypal","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="angell_eye_gateway_paypal" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to paypal-for-woocommerce." href="http://hookr.io/plugins/paypal-for-woocommerce/" class="plugin"><span property="name">paypal-for-woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.4.3." href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/" class="H_VERSION"><span property="name">1.4.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">angell_eye_gateway_paypal</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="0"><a href="http://hookr.io/1.4.3/all/" title="All">All <span class="count badge">0</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/1.4.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/1.4.3/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/1.4.3/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/1.4.3/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="0"><a href="http://hookr.io/1.4.3/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/1.4.3/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="0"><a href="http://hookr.io/1.4.3/functions/" title="Functions">Functions <span class="count badge">0</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/1.4.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>AngellEYE_Gateway_Paypal</strong></h1><p>The WordPress Core <strong>AngellEYE Gateway Paypal</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/files/paypal-for-woocommerce/" class="file">/paypal-for-woocommerce.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="51" class="block" start="58"><li><div>class AngellEYE_Gateway_Paypal&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    protected $plugin_screen_hook_suffix = null;&nbsp;</div></li><li><div>    protected $plugin_slug = 'paypal-for-woocommerce';&nbsp;</div></li><li><div>    private $subscription_support_enabled = false;&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * General class constructor where we'll setup our actions, hooks, and shortcodes.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public $customer_id = '';&nbsp;</div></li><li><div>    public function __construct()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        include_once plugin_dir_path(__FILE__) . 'angelleye-includes/angelleye-utility.php';&nbsp;</div></li><li><div>        $plugin_admin = new AngellEYE_Utility($this-&gt;plugin_slug, VERSION_PFW);&nbsp;</div></li><li><div>        $woo_version = $this-&gt;wpbo_get_woo_version_number();&nbsp;</div></li><li><div>        add_filter( 'woocommerce_paypal_args', array($this, 'ae_paypal_standard_additional_parameters'));&nbsp;</div></li><li><div>        if(version_compare($woo_version, '2.6', '&gt;=')) {&nbsp;</div></li><li><div>            add_action( 'plugins_loaded', array($this, 'init'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        register_activation_hook( __FILE__, array($this, 'activate_paypal_for_woocommerce' ));&nbsp;</div></li><li><div>        register_deactivation_hook( __FILE__, array($this, 'deactivate_paypal_for_woocommerce' ));&nbsp;</div></li><li><div>        add_action( 'wp_enqueue_scripts', array($this, 'frontend_scripts'), 100 );&nbsp;</div></li><li><div>        add_action( 'admin_notices', array($this, 'admin_notices') );&nbsp;</div></li><li><div>        add_action( 'admin_init', array($this, 'set_ignore_tag'));&nbsp;</div></li><li><div>        add_filter( 'woocommerce_product_title' , array($this, 'woocommerce_product_title') );&nbsp;</div></li><li><div>        add_action( 'woocommerce_sections_checkout', array( $this, 'donate_message' ), 11 );&nbsp;</div></li><li><div>       &nbsp;</div></li><li><div>        add_action( 'parse_request', array($this, 'wc_gateway_payment_token_api_parser') , 99);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // http://stackoverflow.com/questions/22577727/problems-adding-action-links-to-wordpress-plugin&nbsp;</div></li><li><div>        $basename = plugin_basename(__FILE__);&nbsp;</div></li><li><div>        $prefix = is_network_admin() ? 'network_admin_' : '';&nbsp;</div></li><li><div>        add_filter(&quot;{$prefix}plugin_action_links_$basename&quot;, array($this, 'plugin_action_links'), 10, 4);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        add_action( 'admin_enqueue_scripts', array( $this , 'admin_scripts' ) );&nbsp;</div></li><li><div>        add_action( 'admin_print_styles', array( $this , 'admin_styles' ) );&nbsp;</div></li><li><div>       &nbsp;</div></li><li><div>       add_action( 'admin_menu', array( $this, 'angelleye_admin_menu_own' ) );&nbsp;</div></li><li><div>        add_action( 'product_type_options', array( $this, 'angelleye_product_type_options_own' ), 10, 1);&nbsp;</div></li><li><div>        add_action( 'woocommerce_process_product_meta', array( $this, 'angelleye_woocommerce_process_product_meta_own' ), 10, 1 );&nbsp;</div></li><li><div>        add_filter( 'woocommerce_add_to_cart_sold_individually_quantity', array( $this, 'angelleye_woocommerce_add_to_cart_sold_individually_quantity' ), 10, 5 );&nbsp;</div></li><li><div>        add_action('admin_enqueue_scripts', array( $this, 'angelleye_woocommerce_admin_enqueue_scripts' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_pfw_ed_shipping_bulk_tool', array( $this, 'angelleye_woocommerce_pfw_ed_shipping_bulk_tool' ) );&nbsp;</div></li><li><div>        add_filter('body_class', array($this, 'add_body_classes'));&nbsp;</div></li><li><div>        add_action('http_api_curl', array($this, 'http_api_curl_ec_add_curl_parameter'), 10, 3);&nbsp;</div></li><li><div>        add_filter( &quot;pre_option_woocommerce_paypal_express_settings&quot;, array($this, 'angelleye_express_checkout_decrypt_gateway_api'), 10, 1);&nbsp;</div></li><li><div>        add_filter( &quot;pre_option_woocommerce_paypal_advanced_settings&quot;, array($this, 'angelleye_paypal_advanced_decrypt_gateway_api'), 10, 1);&nbsp;</div></li><li><div>        add_filter( &quot;pre_option_woocommerce_paypal_credit_card_rest_settings&quot;, array($this, 'angelleye_paypal_credit_card_rest_decrypt_gateway_api'), 10, 1);&nbsp;</div></li><li><div>        add_filter( &quot;pre_option_woocommerce_paypal_pro_settings&quot;, array($this, 'angelleye_paypal_pro_decrypt_gateway_api'), 10, 1);&nbsp;</div></li><li><div>        add_filter( &quot;pre_option_woocommerce_paypal_pro_payflow_settings&quot;, array($this, 'angelleye_paypal_pro_payflow_decrypt_gateway_api'), 10, 1);&nbsp;</div></li><li><div>        add_filter( &quot;pre_option_woocommerce_braintree_settings&quot;, array($this, 'angelleye_braintree_decrypt_gateway_api'), 10, 1);&nbsp;</div></li><li><div>        add_filter( &quot;pre_option_woocommerce_enable_guest_checkout&quot;, array($this, 'angelleye_express_checkout_woocommerce_enable_guest_checkout'), 10, 1);&nbsp;</div></li><li><div>        add_filter('the_title', array($this, 'angelleye_paypal_for_woocommerce_page_title'), 99, 1);&nbsp;</div></li><li><div>        $this-&gt;customer_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds class name to HTML body to enable easy conditional CSS styling&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param array $classes&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_body_classes($classes) {&nbsp;</div></li><li><div>      global $pp_settings;&nbsp;</div></li><li><div>      if(@$pp_settings['enabled'] == 'yes')&nbsp;</div></li><li><div>        $classes[] = 'has_paypal_express_checkout';&nbsp;</div></li><li><div>      return $classes;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get WooCommerce Version Number&nbsp;</div></li><li><div>     * http://wpbackoffice.com/get-current-woocommerce-version-number/&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function wpbo_get_woo_version_number()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // If get_plugins() isn't available, require it&nbsp;</div></li><li><div>        if ( ! function_exists( 'get_plugins' ) )&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            include_once( ABSPATH . 'wp-admin/includes/plugin.php' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create the plugins folder and file variables&nbsp;</div></li><li><div>        $plugin_folder = get_plugins( '/' . 'woocommerce' );&nbsp;</div></li><li><div>        $plugin_file = 'woocommerce.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If the plugin version number is set, return it&nbsp;</div></li><li><div>        if ( isset( $plugin_folder[$plugin_file]['Version'] ) )&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            return $plugin_folder[$plugin_file]['Version'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Otherwise return null&nbsp;</div></li><li><div>            return NULL;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Return the plugin action links.  This will only be called if the plugin&nbsp;</div></li><li><div>     * is active.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.6&nbsp;</div></li><li><div>     * @param array $actions associative array of action names to anchor tags&nbsp;</div></li><li><div>     * @return array associative array of plugin action links&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function plugin_action_links($actions, $plugin_file, $plugin_data, $context)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $custom_actions = array(&nbsp;</div></li><li><div>            //'configure' =&gt; sprintf( '&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;', admin_url( 'admin.php?page=wc-settings&tab=checkout' ), __( 'Configure', 'paypal-for-woocommerce' ) ), &nbsp;</div></li><li><div>            'docs' =&gt; sprintf( '&lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;%s&lt;/a&gt;', 'http://www.angelleye.com/category/docs/paypal-for-woocommerce/?utm_source=paypal_for_woocommerce&utm_medium=docs_link&utm_campaign=paypal_for_woocommerce', __( 'Docs', 'paypal-for-woocommerce' ) ), &nbsp;</div></li><li><div>            'support' =&gt; sprintf( '&lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;%s&lt;/a&gt;', 'http://wordpress.org/support/plugin/paypal-for-woocommerce/', __( 'Support', 'paypal-for-woocommerce' ) ), &nbsp;</div></li><li><div>            'review' =&gt; sprintf( '&lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;%s&lt;/a&gt;', 'http://wordpress.org/support/view/plugin-reviews/paypal-for-woocommerce', __( 'Write a Review', 'paypal-for-woocommerce' ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add the links to the front of the actions list&nbsp;</div></li><li><div>        return array_merge( $custom_actions, $actions );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function woocommerce_product_title($title) {&nbsp;</div></li><li><div>        $title = str_replace(array(&quot;&#8211;&quot;, &quot;&#8211&quot;), array(&quot;-&quot;), $title);&nbsp;</div></li><li><div>        return $title;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function set_ignore_tag() {&nbsp;</div></li><li><div>        global $current_user;&nbsp;</div></li><li><div>        $plugin = plugin_basename( __FILE__ );&nbsp;</div></li><li><div>        $plugin_data = get_plugin_data( __FILE__, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !in_array( 'woocommerce/woocommerce.php', apply_filters( 'active_plugins', get_option( 'active_plugins' ) ) ) && !is_plugin_active_for_network( 'woocommerce/woocommerce.php' ) ) {&nbsp;</div></li><li><div>            if(!in_array(@$_GET['action'], array('activate-plugin', 'upgrade-plugin', 'activate', 'do-plugin-upgrade')) && is_plugin_active($plugin) ) {&nbsp;</div></li><li><div>                deactivate_plugins( $plugin );&nbsp;</div></li><li><div>                wp_die( &quot;&lt;strong&gt;&quot;.$plugin_data['Name'].&quot;&lt;/strong&gt; requires &lt;strong&gt;WooCommerce&lt;/strong&gt; plugin to work normally. Please activate it or install it from &lt;a href=\&quot;http://wordpress.org/plugins/woocommerce/\&quot; target=\&quot;_blank\&quot;&gt;here&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;Back to the WordPress &lt;a href='&quot;.get_admin_url(null, 'plugins.php').&quot;'&gt;Plugins page&lt;/a&gt;.&quot; );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $user_id = $current_user-&gt;ID;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        /** If user clicks to ignore the notice, add that to their user meta */&nbsp;</div></li><li><div>        $notices = array('ignore_pp_ssl', 'ignore_pp_sandbox', 'ignore_pp_woo', 'ignore_pp_check', 'ignore_pp_donate', 'ignore_paypal_plus_move_notice');&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        foreach ($notices as $notice) {&nbsp;</div></li><li><div>            if ( isset($_GET[$notice]) && '0' == $_GET[$notice] ) {&nbsp;</div></li><li><div>                add_user_meta($user_id, $notice, 'true', true);&nbsp;</div></li><li><div>                $set_ignore_tag_url =  remove_query_arg( $notice );&nbsp;</div></li><li><div>                wp_redirect($set_ignore_tag_url);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_notices() {&nbsp;</div></li><li><div>        global $current_user, $pp_settings ;&nbsp;</div></li><li><div>        $user_id = $current_user-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pp_pro = get_option('woocommerce_paypal_pro_settings');&nbsp;</div></li><li><div>        $pp_payflow = get_option('woocommerce_paypal_pro_payflow_settings');&nbsp;</div></li><li><div>        $pp_standard = get_option('woocommerce_paypal_settings');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'angelleye_admin_notices', $pp_pro, $pp_payflow, $pp_standard );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (@$pp_pro['enabled']=='yes' || @$pp_payflow['enabled']=='yes') {&nbsp;</div></li><li><div>            // Show message if enabled and FORCE SSL is disabled and WordpressHTTPS plugin is not detected&nbsp;</div></li><li><div>            if ( get_option('woocommerce_force_ssl_checkout')=='no' && ! class_exists( 'WordPressHTTPS' ) && !get_user_meta($user_id, 'ignore_pp_ssl') )&nbsp;</div></li><li><div>                echo '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;' . sprintf(__('WooCommerce PayPal Payments Pro requires that the %sForce secure checkout%s option is enabled; your checkout may not be secure! Please enable SSL and ensure your server has a valid SSL certificate - PayPal Pro will only work in test mode. | &lt;a href=%s&gt;%s&lt;/a&gt;', 'paypal-for-woocommerce'), '&lt;a href=&quot;'.admin_url('admin.php?page=woocommerce').'&quot;&gt;', &quot;&lt;/a&gt;&quot;, '&quot;'.esc_url(add_query_arg(&quot;ignore_pp_ssl&quot;, 0)).'&quot;', __(&quot;Hide this notice&quot;, 'paypal-for-woocommerce'))  . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>            if ((@$pp_pro['testmode']=='yes' || @$pp_payflow['testmode']=='yes' || @$pp_settings['testmode']=='yes') && !get_user_meta($user_id, 'ignore_pp_sandbox')) {&nbsp;</div></li><li><div>                $testmodes = array();&nbsp;</div></li><li><div>                if (@$pp_pro['enabled']=='yes' && @$pp_pro['testmode']=='yes') $testmodes[] = 'PayPal Pro';&nbsp;</div></li><li><div>                if (@$pp_payflow['enabled']=='yes' && @$pp_payflow['testmode']=='yes') $testmodes[] = 'PayPal Pro PayFlow';&nbsp;</div></li><li><div>                if (@$pp_settings['enabled']=='yes' && @$pp_settings['testmode']=='yes') $testmodes[] = 'PayPal Express';&nbsp;</div></li><li><div>                $testmodes_str = implode(&quot;, &quot;, $testmodes);&nbsp;</div></li><li><div>                echo '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;' . sprintf(__('WooCommerce PayPal Payments ( %s ) is currently running in Sandbox mode and will NOT process any actual payments. | &lt;a href=%s&gt;%s&lt;/a&gt;', 'paypal-for-woocommerce'), $testmodes_str, '&quot;'.esc_url(add_query_arg(&quot;ignore_pp_sandbox&quot;, 0)).'&quot;', __(&quot;Hide this notice&quot;, 'paypal-for-woocommerce')) . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif (@$pp_settings['enabled']=='yes') {&nbsp;</div></li><li><div>            if (@$pp_settings['testmode']=='yes' && !get_user_meta($user_id, 'ignore_pp_sandbox')) {&nbsp;</div></li><li><div>                echo '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;' . sprintf(__('WooCommerce PayPal Express is currently running in Sandbox mode and will NOT process any actual payments. | &lt;a href=%s&gt;%s&lt;/a&gt;', 'paypal-for-woocommerce'), '&quot;'.esc_url(add_query_arg(&quot;ignore_pp_sandbox&quot;, 0)).'&quot;', __(&quot;Hide this notice&quot;, 'paypal-for-woocommerce')) . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(@$pp_settings['enabled']=='yes' && @$pp_standard['enabled']=='yes' && !get_user_meta($user_id, 'ignore_pp_check')) {&nbsp;</div></li><li><div>            echo '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;' . sprintf(__('You currently have both PayPal (standard) and Express Checkout enabled.  It is recommended that you disable the standard PayPal from &lt;a href=&quot;'.get_admin_url().'admin.php?page=wc-settings&tab=checkout&section=wc_gateway_paypal&quot;&gt;the settings page&lt;/a&gt; when using Express Checkout. | &lt;a href=%s&gt;%s&lt;/a&gt;', 'paypal-for-woocommerce'), '&quot;'.esc_url(add_query_arg(&quot;ignore_pp_check&quot;, 0)).'&quot;', __(&quot;Hide this notice&quot;, 'paypal-for-woocommerce')) . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !in_array( 'woocommerce/woocommerce.php', apply_filters( 'active_plugins', get_option( 'active_plugins' ) ) ) && !get_user_meta($user_id, 'ignore_pp_woo') && !is_plugin_active_for_network( 'woocommerce/woocommerce.php' )) {&nbsp;</div></li><li><div>            echo '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;' . sprintf( __(&quot;WooCommerce PayPal Payments requires WooCommerce plugin to work normally. Please activate it or install it from &lt;a href='http://wordpress.org/plugins/woocommerce/' target='_blank'&gt;here&lt;/a&gt;. | &lt;a href=%s&gt;%s&lt;/a&gt;&quot;, 'paypal-for-woocommerce'), '&quot;'.esc_url(add_query_arg(&quot;ignore_pp_woo&quot;, 0)).'&quot;', __(&quot;Hide this notice&quot;, 'paypal-for-woocommerce') ) . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $screen = get_current_screen();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if( $screen-&gt;id == &quot;settings_page_paypal-for-woocommerce&quot; ) {&nbsp;</div></li><li><div>            $processed = (isset($_GET['processed']) ) ? $_GET['processed'] : FALSE;&nbsp;</div></li><li><div>            if($processed) {&nbsp;</div></li><li><div>                echo '&lt;div class=&quot;updated&quot;&gt;';&nbsp;</div></li><li><div>                echo '&lt;p&gt;'. sprintf( __('Action completed; %s records processed. ', 'paypal-for-woocommerce'), ($processed == 'zero') ? 0 : $processed);&nbsp;</div></li><li><div>                echo '&lt;/div&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $this-&gt;angelleye_paypal_plus_notice($user_id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //init function&nbsp;</div></li><li><div>    public function init() {&nbsp;</div></li><li><div>        if (!class_exists(&quot;WC_Payment_Gateway&quot;)) return;&nbsp;</div></li><li><div>        load_plugin_textdomain( 'paypal-for-woocommerce', FALSE, basename( dirname( __FILE__ ) ) . '/i18n/languages/' );&nbsp;</div></li><li><div>        include_once plugin_dir_path(__FILE__) . 'angelleye-includes/express-checkout/class-wc-gateway-paypal-express-helper-angelleye.php';&nbsp;</div></li><li><div>        include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-pro-payflow-angelleye.php' );&nbsp;</div></li><li><div>        include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-advanced-angelleye.php');&nbsp;</div></li><li><div>        include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-express-angelleye.php');&nbsp;</div></li><li><div>        include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-pro-angelleye.php');&nbsp;</div></li><li><div>        if (version_compare(phpversion(), '5.4.0', '&gt;=')) {&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-braintree-angelleye.php');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (version_compare(phpversion(), '5.3.0', '&gt;=')) {&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-credit-cards-rest-angelleye.php');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        new Angelleye_PayPal_Express_Checkout_Helper(VERSION_PFW);&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Check current WooCommerce version to ensure compatibility.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $woo_version = $this-&gt;wpbo_get_woo_version_number();&nbsp;</div></li><li><div>        if(version_compare($woo_version, '2.6', '&lt;')) {&nbsp;</div></li><li><div>            add_action( 'admin_notices', array($this, 'woo_compatibility_notice') );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            add_filter( 'woocommerce_payment_gateways', array($this, 'angelleye_add_paypal_pro_gateway'), 1000 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Admin Script&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_scripts()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $dir = plugin_dir_path( __FILE__ );&nbsp;</div></li><li><div>        wp_enqueue_media();&nbsp;</div></li><li><div>        wp_enqueue_script( 'jquery');&nbsp;</div></li><li><div>        // Localize the script with new data&nbsp;</div></li><li><div>        wp_register_script( 'angelleye_admin', plugins_url( '/assets/js/angelleye-admin.js' , __FILE__ ), array( 'jquery' ));&nbsp;</div></li><li><div>        $translation_array = array(&nbsp;</div></li><li><div>            'is_ssl' =&gt; AngellEYE_Gateway_Paypal::is_ssl()? &quot;yes&quot;:&quot;no&quot;, &nbsp;</div></li><li><div>            'choose_image' =&gt; __('Choose Image', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>            'shop_based_us' =&gt; (substr(get_option(&quot;woocommerce_default_country&quot;), 0, 2) == 'US')? &quot;yes&quot;:&quot;no&quot;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        wp_localize_script( 'angelleye_admin', 'angelleye_admin', $translation_array );&nbsp;</div></li><li><div>        wp_enqueue_script( 'angelleye_admin');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Admin Style&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function admin_styles()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        wp_enqueue_style('thickbox');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * frontend_scripts function.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function frontend_scripts() {&nbsp;</div></li><li><div>        global $pp_settings;&nbsp;</div></li><li><div>        global $post;&nbsp;</div></li><li><div>        $_enable_ec_button = 'no';&nbsp;</div></li><li><div>        if( !empty($post) ) {&nbsp;</div></li><li><div>            $_enable_ec_button = get_post_meta($post-&gt;ID, '_enable_ec_button', true);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_register_script( 'angelleye_frontend', plugins_url( '/assets/js/angelleye-frontend.js' , __FILE__ ), array( 'jquery' ), WC_VERSION, true );&nbsp;</div></li><li><div>        $translation_array = array(&nbsp;</div></li><li><div>            'is_product' =&gt; is_product()? &quot;yes&quot; : &quot;no&quot;, &nbsp;</div></li><li><div>            'is_cart' =&gt; is_cart()? &quot;yes&quot;:&quot;no&quot;, &nbsp;</div></li><li><div>            'is_checkout' =&gt; is_checkout()? &quot;yes&quot;:&quot;no&quot;, &nbsp;</div></li><li><div>            'three_digits' =&gt; __('3 digits usually found on the signature strip.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>            'four_digits' =&gt; __('4 digits usually found on the front of the card.', 'paypal-for-woocommerce')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        wp_localize_script( 'angelleye_frontend', 'angelleye_frontend', $translation_array );&nbsp;</div></li><li><div>        wp_enqueue_script('angelleye_frontend');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_admin() && is_cart()) {&nbsp;</div></li><li><div>            wp_enqueue_style( 'ppe_cart', plugins_url( 'assets/css/cart.css' , __FILE__ ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_admin() && is_checkout() ) {&nbsp;</div></li><li><div>            wp_enqueue_style( 'ppe_checkout', plugins_url( 'assets/css/checkout.css' , __FILE__ ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! is_admin() && is_single() && @$pp_settings['enabled']=='yes' && @$pp_settings['show_on_product_page']=='yes' && $_enable_ec_button == 'yes') {&nbsp;</div></li><li><div>            wp_enqueue_style( 'ppe_single', plugins_url( 'assets/css/single.css' , __FILE__ ) );&nbsp;</div></li><li><div>            wp_enqueue_script('angelleye_button');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Run when plugin is activated&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function activate_paypal_for_woocommerce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // If WooCommerce is not enabled, deactivate plugin.&nbsp;</div></li><li><div>        if(!in_array( 'woocommerce/woocommerce.php', apply_filters('active_plugins', get_option('active_plugins'))) && !is_plugin_active_for_network( 'woocommerce/woocommerce.php' ))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            deactivate_plugins(plugin_basename(__FILE__));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            global $woocommerce;&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // Log activation in Angell EYE database via web service.&nbsp;</div></li><li><div>            // @todo Need to turn this into an option people can enable by request.&nbsp;</div></li><li><div>            //$log_url = $_SERVER['HTTP_HOST'];&nbsp;</div></li><li><div>            //$log_plugin_id = 1;&nbsp;</div></li><li><div>            //$log_activation_status = 1;&nbsp;</div></li><li><div>            //wp_remote_request('http://www.angelleye.com/web-services/wordpress/update-plugin-status.php?url='.$log_url.'&plugin_id='.$log_plugin_id.'&activation_status='.$log_activation_status);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Run when plugin is deactivated.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function deactivate_paypal_for_woocommerce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Log activation in Angell EYE database via web service.&nbsp;</div></li><li><div>        // @todo Need to turn this into an option people can enable.&nbsp;</div></li><li><div>        //$log_url = $_SERVER['HTTP_HOST'];&nbsp;</div></li><li><div>        //$log_plugin_id = 1;&nbsp;</div></li><li><div>        //$log_activation_status = 0;&nbsp;</div></li><li><div>        //wp_remote_request('http://www.angelleye.com/web-services/wordpress/update-plugin-status.php?url='.$log_url.'&plugin_id='.$log_plugin_id.'&activation_status='.$log_activation_status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds PayPal gateway options for Payments Pro and Express Checkout into the WooCommerce checkout settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function angelleye_add_paypal_pro_gateway( $methods ) {&nbsp;</div></li><li><div>        if ( class_exists( 'WC_Subscriptions_Order' ) && function_exists( 'wcs_create_renewal_order' ) ) {&nbsp;</div></li><li><div>            $this-&gt;subscription_support_enabled = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ($methods as $key=&gt;$method) {&nbsp;</div></li><li><div>            if (in_array($method, array('WC_Gateway_PayPal_Pro', 'WC_Gateway_PayPal_Pro_Payflow', 'WC_Gateway_PayPal_Express'))) {&nbsp;</div></li><li><div>                unset($methods[$key]);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if( $this-&gt;subscription_support_enabled ) {&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/subscriptions/wc-gateway-paypal-pro-payflow-subscriptions-angelleye.php' );&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/subscriptions/wc-gateway-paypal-advanced-subscriptions-angelleye.php');&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/subscriptions/wc-gateway-paypal-express-subscriptions-angelleye.php');&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/subscriptions/wc-gateway-paypal-pro-subscriptions-angelleye.php');&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Pro_PayFlow_Subscriptions_AngellEYE';&nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Advanced_Subscriptions_AngellEYE';&nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Pro_Subscriptions_AngellEYE';&nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Express_Subscriptions_AngellEYE';&nbsp;</div></li><li><div>            if (version_compare(phpversion(), '5.4.0', '&gt;=')) {&nbsp;</div></li><li><div>                include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/subscriptions/wc-gateway-braintree-subscriptions-angelleye.php');&nbsp;</div></li><li><div>                $methods[] = 'WC_Gateway_Braintree_Subscriptions_AngellEYE';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (version_compare(phpversion(), '5.3.0', '&gt;=')) {&nbsp;</div></li><li><div>                include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/subscriptions/wc-gateway-paypal-credit-cards-rest-subscriptions-angelleye.php');&nbsp;</div></li><li><div>                $methods[] = 'WC_Gateway_PayPal_Credit_Card_Rest_Subscriptions_AngellEYE';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-pro-payflow-angelleye.php' );&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-advanced-angelleye.php');&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-express-angelleye.php');&nbsp;</div></li><li><div>            include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-pro-angelleye.php');&nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Pro_Payflow_AngellEYE';&nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Advanced_AngellEYE';&nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Pro_AngellEYE';&nbsp;</div></li><li><div>            $methods[] = 'WC_Gateway_PayPal_Express_AngellEYE';&nbsp;</div></li><li><div>            if (version_compare(phpversion(), '5.4.0', '&gt;=')) {&nbsp;</div></li><li><div>                include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-braintree-angelleye.php');&nbsp;</div></li><li><div>                $methods[] = 'WC_Gateway_Braintree_AngellEYE';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if (version_compare(phpversion(), '5.3.0', '&gt;=')) {&nbsp;</div></li><li><div>                include_once ( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/wc-gateway-paypal-credit-cards-rest-angelleye.php');&nbsp;</div></li><li><div>                $methods[] = 'WC_Gateway_PayPal_Credit_Card_Rest_AngellEYE';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $methods;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add additional parameters to the PayPal Standard checkout built into WooCommerce.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function ae_paypal_standard_additional_parameters($paypal_args)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paypal_args['bn'] = 'AngellEYE_SP_WooCommerce';&nbsp;</div></li><li><div>        return $paypal_args;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>     * Donate function&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function donate_message() {&nbsp;</div></li><li><div>        if (@$_GET['page']=='wc-settings' && @$_GET['tab']=='checkout' && in_array( @$_GET['section'], array('wc_gateway_paypal_express_angelleye', 'wc_gateway_paypal_pro_angelleye', 'wc_gateway_paypal_pro_payflow_angelleye')) && !get_user_meta(get_current_user_id(), 'ignore_pp_donate') ) {&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;updated welcome-panel notice&quot; id=&quot;paypal-for-woocommerce-donation&quot;&gt;&nbsp;</div></li><li><div>                &lt;div style=&quot;float:left; margin: 19px 16px 19px 0;&quot; id=&quot;plugin-icon-paypal-for-woocommerce&quot; &gt;&lt;/div&gt;&nbsp;</div></li><li><div>                &lt;h3&gt;PayPal for WooCommerce&lt;/h3&gt;&nbsp;</div></li><li><div>                &lt;p class=&quot;donation_text&quot;&gt;We are learning why it is difficult to provide, support, and maintain free software. Every little bit helps and is greatly appreciated.&lt;/p&gt;&nbsp;</div></li><li><div>                &lt;p&gt;Developers, join us on &lt;a href=&quot;https://github.com/angelleye/paypal-woocommerce&quot; target=&quot;_blank&quot;&gt;GitHub&lt;/a&gt;. Pull Requests are welcomed!&lt;/p&gt;&nbsp;</div></li><li><div>                &lt;a target=&quot;_blank&quot; href=&quot;https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=SG9SQU2GBXJNA&quot;&gt;&lt;img style=&quot;float:left;margin-right:10px;&quot; src=&quot;https://www.angelleye.com/images/paypal-for-woocommerce/donate-button.png&quot; border=&quot;0&quot; alt=&quot;PayPal - The safer, easier way to pay online!&quot;&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                &lt;a class=&quot;welcome-panel-close&quot; href=&quot;&lt;?php echo esc_url( add_query_arg( array( 'ignore_pp_donate' =&gt; '0' ) ) ); ?&gt;&quot;&gt;&lt;?php _e( 'Dismiss' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>           &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function calculate($order, $send_items = false) {&nbsp;</div></li><li><div>        $PaymentOrderItems = array();&nbsp;</div></li><li><div>        $ctr = $giftwrapamount = $total_items = $total_discount = $total_tax = $shipping = 0;&nbsp;</div></li><li><div>        $ITEMAMT = 0;&nbsp;</div></li><li><div>        if ($order) {&nbsp;</div></li><li><div>            $order_total = $order-&gt;get_total();&nbsp;</div></li><li><div>            $items = $order-&gt;get_items();&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>            * Set shipping and tax values.&nbsp;</div></li><li><div>            */&nbsp;</div></li><li><div>            if (get_option('woocommerce_prices_include_tax') == 'yes') {&nbsp;</div></li><li><div>                $shipping = version_compare( WC_VERSION, '3.0', '&lt;' ) ? $order-&gt;get_total_shipping() : $order-&gt;get_shipping_total() + $order-&gt;get_shipping_tax();&nbsp;</div></li><li><div>                $tax = 0;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $shipping = version_compare( WC_VERSION, '3.0', '&lt;' ) ? $order-&gt;get_total_shipping() : $order-&gt;get_shipping_total();&nbsp;</div></li><li><div>                $tax = $order-&gt;get_total_tax();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if('yes' === get_option( 'woocommerce_calc_taxes' ) && 'yes' === get_option( 'woocommerce_prices_include_tax' )) {&nbsp;</div></li><li><div>                $tax = $order-&gt;get_total_tax();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            //if empty order we get data from cart&nbsp;</div></li><li><div>            $order_total = WC()-&gt;cart-&gt;total;&nbsp;</div></li><li><div>            $items = WC()-&gt;cart-&gt;get_cart();&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Get shipping and tax.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            if(get_option('woocommerce_prices_include_tax' ) == 'yes')&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $shipping = WC()-&gt;cart-&gt;shipping_total + WC()-&gt;cart-&gt;shipping_tax_total;&nbsp;</div></li><li><div>                $tax = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $shipping = WC()-&gt;cart-&gt;shipping_total;&nbsp;</div></li><li><div>                $tax = WC()-&gt;cart-&gt;get_taxes_total();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if('yes' === get_option( 'woocommerce_calc_taxes' ) && 'yes' === get_option( 'woocommerce_prices_include_tax' )) {&nbsp;</div></li><li><div>                $tax = WC()-&gt;cart-&gt;get_taxes_total();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($send_items) {&nbsp;</div></li><li><div>            foreach ($items as $item) {&nbsp;</div></li><li><div>                /**&nbsp;</div></li><li><div>                 * Get product data from WooCommerce&nbsp;</div></li><li><div>                 */&nbsp;</div></li><li><div>                if ($order) {&nbsp;</div></li><li><div>                    $_product = $order-&gt;get_product_from_item($item);&nbsp;</div></li><li><div>                    $qty = absint($item['qty']);&nbsp;</div></li><li><div>                    $item_meta = new WC_Order_Item_Meta($item, $_product);&nbsp;</div></li><li><div>                    $meta = $item_meta-&gt;display(true, true);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $_product = $item['data'];&nbsp;</div></li><li><div>                    $qty = absint($item['quantity']);&nbsp;</div></li><li><div>                    $meta = WC()-&gt;cart-&gt;get_item_data($item, true);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $sku = $_product-&gt;get_sku();&nbsp;</div></li><li><div>                $item['name'] = html_entity_decode($_product-&gt;get_title(), ENT_NOQUOTES, 'UTF-8');&nbsp;</div></li><li><div>                if ($_product-&gt;is_type('variation')) {&nbsp;</div></li><li><div>                    if (empty($sku)) {&nbsp;</div></li><li><div>                        $sku = $_product-&gt;parent-&gt;get_sku();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (!empty($meta)) {&nbsp;</div></li><li><div>                        $item['name'] .= &quot; - &quot; . str_replace(&quot;, \n&quot;, &quot; - &quot;, $meta);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $Item = array(&nbsp;</div></li><li><div>                    'name' =&gt; $item['name'], // Item name. 127 char max.&nbsp;</div></li><li><div>                    'desc' =&gt; '', // Item description. 127 char max.&nbsp;</div></li><li><div>                    'amt' =&gt; self::number_format(self::round( $item['line_subtotal'] / $qty)), // Cost of item.&nbsp;</div></li><li><div>                    'number' =&gt; $sku, // Item number.  127 char max.&nbsp;</div></li><li><div>                    'qty' =&gt; $qty, // Item qty on order.  Any positive integer.&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                array_push($PaymentOrderItems, $Item);&nbsp;</div></li><li><div>                $ITEMAMT += self::round( $item['line_subtotal'] / $qty ) * $qty;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Add custom Woo cart fees as line items&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            foreach (WC()-&gt;cart-&gt;get_fees() as $fee) {&nbsp;</div></li><li><div>                $Item = array(&nbsp;</div></li><li><div>                    'name' =&gt; $fee-&gt;name, // Item name. 127 char max.&nbsp;</div></li><li><div>                    'desc' =&gt; '', // Item description. 127 char max.&nbsp;</div></li><li><div>                    'amt' =&gt; self::number_format($fee-&gt;amount, 2, '.', ''), // Cost of item.&nbsp;</div></li><li><div>                    'number' =&gt; $fee-&gt;id, // Item number. 127 char max.&nbsp;</div></li><li><div>                    'qty' =&gt; 1, // Item qty on order. Any positive integer.&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                /**&nbsp;</div></li><li><div>                 * The gift wrap amount actually has its own parameter in&nbsp;</div></li><li><div>                 * DECP, so we don't want to include it as one of the line&nbsp;</div></li><li><div>                 * items.&nbsp;</div></li><li><div>                 */&nbsp;</div></li><li><div>                if ($Item['number'] != 'gift-wrap') {&nbsp;</div></li><li><div>                    array_push($PaymentOrderItems, $Item);&nbsp;</div></li><li><div>                    $ITEMAMT += self::round($fee-&gt;amount);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $giftwrapamount = self::round($fee-&gt;amount);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $ctr++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            //caculate discount&nbsp;</div></li><li><div>            if ($order) {&nbsp;</div></li><li><div>                if (!AngellEYE_Gateway_Paypal::is_wc_version_greater_2_3()) {&nbsp;</div></li><li><div>                    if ($order-&gt;get_cart_discount() &gt; 0) {&nbsp;</div></li><li><div>                        foreach (WC()-&gt;cart-&gt;get_coupons('cart') as $code =&gt; $coupon) {&nbsp;</div></li><li><div>                            $Item = array(&nbsp;</div></li><li><div>                                'name' =&gt; 'Cart Discount', &nbsp;</div></li><li><div>                                'number' =&gt; $code, &nbsp;</div></li><li><div>                                'qty' =&gt; '1', &nbsp;</div></li><li><div>                                'amt' =&gt; '-' . self::number_format(WC()-&gt;cart-&gt;coupon_discount_amounts[$code])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                            array_push($PaymentOrderItems, $Item);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $total_discount -= $order-&gt;get_cart_discount();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($order-&gt;get_order_discount() &gt; 0) {&nbsp;</div></li><li><div>                        foreach (WC()-&gt;cart-&gt;get_coupons('order') as $code =&gt; $coupon) {&nbsp;</div></li><li><div>                            $Item = array(&nbsp;</div></li><li><div>                                'name' =&gt; 'Order Discount', &nbsp;</div></li><li><div>                                'number' =&gt; $code, &nbsp;</div></li><li><div>                                'qty' =&gt; '1', &nbsp;</div></li><li><div>                                'amt' =&gt; '-' . self::number_format(WC()-&gt;cart-&gt;coupon_discount_amounts[$code])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                            array_push($PaymentOrderItems, $Item);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $total_discount -= $order-&gt;get_order_discount();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    if ($order-&gt;get_total_discount() &gt; 0) {&nbsp;</div></li><li><div>                        $Item = array(&nbsp;</div></li><li><div>                            'name' =&gt; 'Total Discount', &nbsp;</div></li><li><div>                            'qty' =&gt; 1, &nbsp;</div></li><li><div>                            'amt' =&gt; - self::number_format($order-&gt;get_total_discount()), &nbsp;</div></li><li><div>                            'number' =&gt; implode(&quot;, &quot;, $order-&gt;get_used_coupons())&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        array_push($PaymentOrderItems, $Item);&nbsp;</div></li><li><div>                        $total_discount -= $order-&gt;get_total_discount();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( !empty( WC()-&gt;cart-&gt;applied_coupons ) ) {&nbsp;</div></li><li><div>                    foreach (WC()-&gt;cart-&gt;get_coupons('cart') as $code =&gt; $coupon) {&nbsp;</div></li><li><div>                        $Item = array(&nbsp;</div></li><li><div>                            'name' =&gt; 'Cart Discount', &nbsp;</div></li><li><div>                            'qty' =&gt; '1', &nbsp;</div></li><li><div>                            'number'=&gt; $code, &nbsp;</div></li><li><div>                            'amt' =&gt; '-' . self::number_format(WC()-&gt;cart-&gt;coupon_discount_amounts[$code])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        array_push($PaymentOrderItems, $Item);&nbsp;</div></li><li><div>                        $total_discount -= self::number_format(WC()-&gt;cart-&gt;coupon_discount_amounts[$code]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!AngellEYE_Gateway_Paypal::is_wc_version_greater_2_3()) {&nbsp;</div></li><li><div>                    if ( !empty( WC()-&gt;cart-&gt;applied_coupons ) ) {&nbsp;</div></li><li><div>                        foreach (WC()-&gt;cart-&gt;get_coupons('order') as $code =&gt; $coupon) {&nbsp;</div></li><li><div>                            $Item = array(&nbsp;</div></li><li><div>                                'name' =&gt; 'Order Discount', &nbsp;</div></li><li><div>                                'qty' =&gt; '1', &nbsp;</div></li><li><div>                                'number'=&gt; $code, &nbsp;</div></li><li><div>                                'amt' =&gt; '-' . self::number_format(WC()-&gt;cart-&gt;coupon_discount_amounts[$code])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                            array_push($PaymentOrderItems, $Item);&nbsp;</div></li><li><div>                            $total_discount -= self::number_format(WC()-&gt;cart-&gt;coupon_discount_amounts[$code]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if( $tax &gt; 0) {&nbsp;</div></li><li><div>            $tax = self::number_format($tax);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if( $shipping &gt; 0) {&nbsp;</div></li><li><div>            $shipping = self::number_format($shipping);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if( $total_discount ) {&nbsp;</div></li><li><div>            $total_discount = self::round($total_discount);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (empty($ITEMAMT)) {&nbsp;</div></li><li><div>            $cart_fees = WC()-&gt;cart-&gt;get_fees();&nbsp;</div></li><li><div>            if( isset($cart_fees[0]-&gt;id) && $cart_fees[0]-&gt;id == 'gift-wrap' ) {&nbsp;</div></li><li><div>                $giftwrapamount = isset($cart_fees[0]-&gt;amount)  ? $cart_fees[0]-&gt;amount : 0;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $giftwrapamount = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $Payment['itemamt'] = $order_total - $tax - $shipping - $giftwrapamount;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $Payment['itemamt'] = self::number_format($ITEMAMT + $total_discount);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Set tax&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ($tax &gt; 0) {&nbsp;</div></li><li><div>            $Payment['taxamt'] = self::number_format($tax);       // Required if you specify itemized L_TAXAMT fields.  Sum of all tax items in this order.&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $Payment['taxamt'] = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Set shipping&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ($shipping &gt; 0) {&nbsp;</div></li><li><div>            $Payment['shippingamt'] = self::number_format($shipping);      // Total shipping costs for this order.  If you specify SHIPPINGAMT you mut also specify a value for ITEMAMT.&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $Payment['shippingamt'] = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $Payment['order_items'] = $PaymentOrderItems;&nbsp;</div></li><li><div>        // Rounding amendment&nbsp;</div></li><li><div>        if (trim(self::number_format($order_total)) !== trim(self::number_format($Payment['itemamt'] + $giftwrapamount + $tax + $shipping))) {&nbsp;</div></li><li><div>            $diffrence_amount = AngellEYE_Gateway_Paypal::get_diffrent($order_total, $Payment['itemamt'] + $tax + $shipping);&nbsp;</div></li><li><div>            if($shipping &gt; 0) {&nbsp;</div></li><li><div>                $Payment['shippingamt'] = abs(self::number_format($shipping + $diffrence_amount));&nbsp;</div></li><li><div>            } elseif ($tax &gt; 0) {&nbsp;</div></li><li><div>                $Payment['taxamt'] = abs(self::number_format($tax + $diffrence_amount));&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                //make change to itemamt&nbsp;</div></li><li><div>                $Payment['itemamt'] = abs(self::number_format($Payment['itemamt'] + $diffrence_amount));&nbsp;</div></li><li><div>                //also make change to the first item&nbsp;</div></li><li><div>                if ($send_items) {&nbsp;</div></li><li><div>                    $Payment['order_items'][0]['amt'] = abs(self::number_format($Payment['order_items'][0]['amt'] + $diffrence_amount / $Payment['order_items'][0]['qty']));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $Payment;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function get_diffrent($amout_1, $amount_2) {&nbsp;</div></li><li><div>        $diff_amount = $amout_1 - $amount_2;&nbsp;</div></li><li><div>        return $diff_amount;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public static function cut_off($number) {&nbsp;</div></li><li><div>        $parts = explode(&quot;.&quot;, $number);&nbsp;</div></li><li><div>        $newnumber = $parts[0] . &quot;.&quot; . $parts[1][0] . $parts[1][1];&nbsp;</div></li><li><div>        return $newnumber;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function is_wc_version_greater_2_3() {&nbsp;</div></li><li><div>        return AngellEYE_Gateway_Paypal::get_wc_version() && version_compare(AngellEYE_Gateway_Paypal::get_wc_version(), '2.3', '&gt;=');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function get_wc_version() {&nbsp;</div></li><li><div>        return defined('WC_VERSION') && WC_VERSION ? WC_VERSION : null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if site is SSL ready&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static public function is_ssl()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (is_ssl() || get_option('woocommerce_force_ssl_checkout') == 'yes' || class_exists('WordPressHTTPS'))&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function angelleye_admin_menu_own() {&nbsp;</div></li><li><div>        $this-&gt;plugin_screen_hook_suffix = add_submenu_page(&nbsp;</div></li><li><div>        'options-general.php', &nbsp;</div></li><li><div>        __( 'PayPal for WooCommerce - Settings', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>        __( 'PayPal for WooCommerce', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>        'manage_options', &nbsp;</div></li><li><div>        'paypal-for-woocommerce', &nbsp;</div></li><li><div>        array( $this, 'display_plugin_admin_page'));    &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function display_plugin_admin_page() {&nbsp;</div></li><li><div>        // WooCommerce product categories&nbsp;</div></li><li><div>        $taxonomy = 'product_cat';&nbsp;</div></li><li><div>        $orderby = 'name';&nbsp;</div></li><li><div>        $show_count = 0;      // 1 for yes, 0 for no&nbsp;</div></li><li><div>        $pad_counts = 0;      // 1 for yes, 0 for no&nbsp;</div></li><li><div>        $hierarchical = 1;      // 1 for yes, 0 for no&nbsp;</div></li><li><div>        $title = '';&nbsp;</div></li><li><div>        $empty = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>        'taxonomy' =&gt; $taxonomy, &nbsp;</div></li><li><div>        'orderby' =&gt; $orderby, &nbsp;</div></li><li><div>        'show_count' =&gt; $show_count, &nbsp;</div></li><li><div>        'pad_counts' =&gt; $pad_counts, &nbsp;</div></li><li><div>        'hierarchical' =&gt; $hierarchical, &nbsp;</div></li><li><div>        'title_li' =&gt; $title, &nbsp;</div></li><li><div>        'hide_empty' =&gt; $empty&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $product_cats = get_categories( $args );&nbsp;</div></li><li><div>        include_once( 'template/admin.php' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    static public function curPageURL() {&nbsp;</div></li><li><div>        $pageURL = 'http';&nbsp;</div></li><li><div>        if (@$_SERVER[&quot;HTTPS&quot;] == &quot;on&quot;) {$pageURL .= &quot;s&quot;;}&nbsp;</div></li><li><div>        $pageURL .= &quot;://&quot;;&nbsp;</div></li><li><div>        if ($_SERVER[&quot;SERVER_PORT&quot;] != &quot;80&quot;) {&nbsp;</div></li><li><div>            $pageURL .= $_SERVER[&quot;SERVER_NAME&quot;].&quot;:&quot;.$_SERVER[&quot;SERVER_PORT&quot;].$_SERVER[&quot;REQUEST_URI&quot;];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $pageURL .= $_SERVER[&quot;SERVER_NAME&quot;].$_SERVER[&quot;REQUEST_URI&quot;];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $pageURL;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>   function angelleye_product_type_options_own($product_type) {&nbsp;</div></li><li><div>        if( isset($product_type) && !empty($product_type) ) {&nbsp;</div></li><li><div>            $product_type['no_shipping_required'] = array(&nbsp;</div></li><li><div>                    'id' =&gt; '_no_shipping_required', &nbsp;</div></li><li><div>                    'wrapper_class' =&gt; '', &nbsp;</div></li><li><div>                    'label' =&gt; __( 'No Shipping Required', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'description' =&gt; __( 'Disables shipping requirements in the PayPal checkout flow.', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'default' =&gt; 'no'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $product_type['paypal_billing_agreement'] = array(&nbsp;</div></li><li><div>                    'id' =&gt; '_paypal_billing_agreement', &nbsp;</div></li><li><div>                    'wrapper_class' =&gt; '', &nbsp;</div></li><li><div>                    'label' =&gt; __( 'Enable PayPal Billing Agreement', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'description' =&gt; __( 'Adds a billing agreement to the product.  The user must agree to the billing agreement on the PayPal checkout pages, and then you can process future payments for the buyer using reference transactions.', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'default' =&gt; 'no'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $product_type['enable_sandbox_mode'] = array(&nbsp;</div></li><li><div>                    'id' =&gt; '_enable_sandbox_mode', &nbsp;</div></li><li><div>                    'wrapper_class' =&gt; '', &nbsp;</div></li><li><div>                    'label' =&gt; __( 'Enable Sandbox Mode', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'description' =&gt; __( 'If this product is included in the cart the order will be processed in the PayPal sandbox for testing purposes.', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'default' =&gt; 'no'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $product_type['enable_ec_button'] = array(&nbsp;</div></li><li><div>                    'id' =&gt; '_enable_ec_button', &nbsp;</div></li><li><div>                    'wrapper_class' =&gt; '', &nbsp;</div></li><li><div>                    'label' =&gt; __( 'Enable Express Checkout Button', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'description' =&gt; __( 'Adds the PayPal Express Checkout button to the product page allowing buyers to checkout directly from the product page.', 'paypal-for-woocommerce' ), &nbsp;</div></li><li><div>                    'default' =&gt; 'no'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            return $product_type;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>                return $product_type;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    function angelleye_woocommerce_process_product_meta_own( $post_id ) {&nbsp;</div></li><li><div>        $no_shipping_required = isset( $_POST['_no_shipping_required'] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>        update_post_meta( $post_id, '_no_shipping_required', $no_shipping_required );&nbsp;</div></li><li><div>        $_paypal_billing_agreement = isset( $_POST['_paypal_billing_agreement'] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>        update_post_meta( $post_id, '_paypal_billing_agreement', $_paypal_billing_agreement );&nbsp;</div></li><li><div>        $_enable_sandbox_mode = isset( $_POST['_enable_sandbox_mode'] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>        update_post_meta( $post_id, '_enable_sandbox_mode', $_enable_sandbox_mode );&nbsp;</div></li><li><div>        $_enable_ec_button = isset( $_POST['_enable_ec_button'] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>        update_post_meta( $post_id, '_enable_ec_button', $_enable_ec_button );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public static function angelleye_paypal_for_woocommerce_curl_error_handler($PayPalResult, $methos_name = null, $gateway = null, $error_email_notify = true) {&nbsp;</div></li><li><div>        if( isset( $PayPalResult['CURL_ERROR'] ) ) {&nbsp;</div></li><li><div>            try {&nbsp;</div></li><li><div>                    if($error_email_notify == true) {&nbsp;</div></li><li><div>                        $admin_email = get_option(&quot;admin_email&quot;);&nbsp;</div></li><li><div>                        $message = __( $methos_name . &quot; call failed.&quot; , &quot;paypal-for-woocommerce&quot; ).&quot;\n\n&quot;;&nbsp;</div></li><li><div>                        $message .= __( 'Error Code: 0' , 'paypal-for-woocommerce' ) . &quot;\n&quot;;&nbsp;</div></li><li><div>                        $message .= __( 'Detailed Error Message: ' , 'paypal-for-woocommerce') . $PayPalResult['CURL_ERROR'];&nbsp;</div></li><li><div>                        wp_mail($admin_email, $gateway . &quot; Error Notification&quot;, $message);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $display_error = 'There was a problem connecting to the payment gateway.';&nbsp;</div></li><li><div>                    wc_add_notice($display_error, 'error');&nbsp;</div></li><li><div>                    if (!is_ajax()) {&nbsp;</div></li><li><div>                        wp_redirect(get_permalink(wc_get_page_id('cart')));&nbsp;</div></li><li><div>                        exit;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        wp_send_json_error( array( 'error' =&gt; $display_error ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>            } catch ( Exception $e ) {&nbsp;</div></li><li><div>                if ( ! empty( $e ) ) {&nbsp;</div></li><li><div>                    throw new Exception( __( $e-&gt;getMessage(), 'paypal-for-woocommerce' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Express Checkout - Adjust button on product details page. #208 &nbsp;</div></li><li><div>     * @param type $qtyone&nbsp;</div></li><li><div>     * @param type $quantity&nbsp;</div></li><li><div>     * @param type $product_id&nbsp;</div></li><li><div>     * @param type $variation_id&nbsp;</div></li><li><div>     * @param type $cart_item_data&nbsp;</div></li><li><div>     * @return type&nbsp;</div></li><li><div>     * @since    1.1.8&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function angelleye_woocommerce_add_to_cart_sold_individually_quantity($qtyone, $quantity, $product_id, $variation_id, $cart_item_data) {&nbsp;</div></li><li><div>        if( (isset($_REQUEST['express_checkout']) && $_REQUEST['express_checkout'] == 1) && (isset($_REQUEST['add-to-cart']) && !empty($_REQUEST['add-to-cart'])) ) {&nbsp;</div></li><li><div>            if (sizeof(WC()-&gt;cart-&gt;get_cart()) != 0) {&nbsp;</div></li><li><div>                foreach ( WC()-&gt;cart-&gt;get_cart() as $cart_item_key =&gt; $cart_item ) {&nbsp;</div></li><li><div>                    $cart_product_id = apply_filters( 'woocommerce_cart_item_product_id', $cart_item['product_id'], $cart_item, $cart_item_key );&nbsp;</div></li><li><div>                    if( $product_id == $cart_product_id || $variation_id == $cart_product_id) {&nbsp;</div></li><li><div>                        wp_redirect(add_query_arg('pp_action', 'set_express_checkout', add_query_arg('wc-api', 'WC_Gateway_PayPal_Express_AngellEYE', home_url('/'))));&nbsp;</div></li><li><div>                        exit();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>               return $qtyone; &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $qtyone;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function angelleye_woocommerce_admin_enqueue_scripts() {&nbsp;</div></li><li><div>        wp_enqueue_style( 'ppe_cart', plugins_url( 'assets/css/admin.css' , __FILE__ ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function angelleye_woocommerce_pfw_ed_shipping_bulk_tool() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (is_admin() && (defined('DOING_AJAX') || DOING_AJAX)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $processed_product_id = array();&nbsp;</div></li><li><div>            $errors = FALSE;&nbsp;</div></li><li><div>            $products = FALSE;&nbsp;</div></li><li><div>            $product_ids = FALSE;&nbsp;</div></li><li><div>            $update_count = 0;&nbsp;</div></li><li><div>            $where_args = array(&nbsp;</div></li><li><div>                'post_type' =&gt; array('product', 'product_variation'), &nbsp;</div></li><li><div>                'posts_per_page' =&gt; -1, &nbsp;</div></li><li><div>                'post_status' =&gt; 'publish', &nbsp;</div></li><li><div>                'fields' =&gt; 'id=&gt;parent', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $where_args['meta_query'] = array();&nbsp;</div></li><li><div>            $pfw_bulk_action_type = ( isset($_POST[&quot;actionType&quot;]) ) ? $_POST['actionType'] : FALSE;&nbsp;</div></li><li><div>            $pfw_bulk_action_target_type = ( isset($_POST[&quot;actionTargetType&quot;]) ) ? $_POST['actionTargetType'] : FALSE;&nbsp;</div></li><li><div>            $pfw_bulk_action_target_where_type = ( isset($_POST[&quot;actionTargetWhereType&quot;]) ) ? $_POST['actionTargetWhereType'] : FALSE;&nbsp;</div></li><li><div>            $pfw_bulk_action_target_where_category = ( isset($_POST[&quot;actionTargetWhereCategory&quot;]) ) ? $_POST['actionTargetWhereCategory'] : FALSE;&nbsp;</div></li><li><div>            $pfw_bulk_action_target_where_product_type = ( isset($_POST[&quot;actionTargetWhereProductType&quot;]) ) ? $_POST['actionTargetWhereProductType'] : FALSE;&nbsp;</div></li><li><div>            $pfw_bulk_action_target_where_price_value = ( isset($_POST[&quot;actionTargetWherePriceValue&quot;]) ) ? $_POST['actionTargetWherePriceValue'] : FALSE;&nbsp;</div></li><li><div>            $pfw_bulk_action_target_where_stock_value = ( isset($_POST[&quot;actionTargetWhereStockValue&quot;]) ) ? $_POST['actionTargetWhereStockValue'] : FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!$pfw_bulk_action_type || !$pfw_bulk_action_target_type) {&nbsp;</div></li><li><div>                $errors = TRUE;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $is_enable_value = explode(&quot;_&quot;, $pfw_bulk_action_type);&nbsp;</div></li><li><div>            $is_enable = (isset($is_enable_value[0]) && $is_enable_value[0] == 'enable') ? 'yes' : 'no';&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if( $pfw_bulk_action_type == 'enable_no_shipping' || $pfw_bulk_action_type == 'disable_no_shipping' ) {&nbsp;</div></li><li><div>                $action_key = &quot;_no_shipping_required&quot;;&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            } elseif ($pfw_bulk_action_type == 'enable_paypal_billing_agreement' || $pfw_bulk_action_type == 'disable_paypal_billing_agreement') {&nbsp;</div></li><li><div>                $action_key = &quot;_paypal_billing_agreement&quot;;&nbsp;</div></li><li><div>            } elseif ($pfw_bulk_action_type == 'enable_express_checkout_button' || $pfw_bulk_action_type == 'disable_express_checkout_button') {&nbsp;</div></li><li><div>                $action_key = &quot;_enable_ec_button&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // All Products&nbsp;</div></li><li><div>            if ($pfw_bulk_action_target_type == 'all') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $products = new WP_Query($where_args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } elseif ($pfw_bulk_action_target_type == 'featured') {&nbsp;</div></li><li><div>                // Featured products&nbsp;</div></li><li><div>                array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                    'key' =&gt; '_featured', &nbsp;</div></li><li><div>                    'value' =&gt; 'yes'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $products = new WP_Query($where_args);&nbsp;</div></li><li><div>            } elseif($pfw_bulk_action_target_type == 'all_downloadable') {&nbsp;</div></li><li><div>                // downloadable products.&nbsp;</div></li><li><div>                array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_downloadable', &nbsp;</div></li><li><div>                        'value' =&gt; 'yes'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                $products = new WP_Query($where_args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } elseif($pfw_bulk_action_target_type == 'all_virtual') {&nbsp;</div></li><li><div>                // virtual products.&nbsp;</div></li><li><div>                array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_virtual', &nbsp;</div></li><li><div>                        'value' =&gt; 'yes'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                $products = new WP_Query($where_args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } elseif ($pfw_bulk_action_target_type == 'where' && $pfw_bulk_action_target_where_type) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Where - By Category&nbsp;</div></li><li><div>                if ($pfw_bulk_action_target_where_type == 'category' && $pfw_bulk_action_target_where_category) {&nbsp;</div></li><li><div>                    $where_args['product_cat'] = $pfw_bulk_action_target_where_category;&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'product_type' && $pfw_bulk_action_target_where_product_type) {&nbsp;</div></li><li><div>                    // Where - By Product type&nbsp;</div></li><li><div>                    $where_args['product_type'] = $pfw_bulk_action_target_where_product_type;&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'price_greater') {&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_price', &nbsp;</div></li><li><div>                        'value' =&gt; str_replace(&quot;, &quot;, &quot;&quot;, number_format($pfw_bulk_action_target_where_price_value, 2)), &nbsp;</div></li><li><div>                        'compare' =&gt; '&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'DECIMAL(10, 2)'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'price_less') {&nbsp;</div></li><li><div>                    // Where - By Price - less than&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_price', &nbsp;</div></li><li><div>                        'value' =&gt; str_replace(&quot;, &quot;, &quot;&quot;, number_format($pfw_bulk_action_target_where_price_value, 2)), &nbsp;</div></li><li><div>                        'compare' =&gt; '&lt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'DECIMAL(10, 2)'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'stock_greater') {&nbsp;</div></li><li><div>                    // Where - By Stock - greater than&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_manage_stock', &nbsp;</div></li><li><div>                        'value' =&gt; 'yes'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_stock', &nbsp;</div></li><li><div>                        'value' =&gt; str_replace(&quot;, &quot;, &quot;&quot;, number_format($pfw_bulk_action_target_where_stock_value, 0)), &nbsp;</div></li><li><div>                        'compare' =&gt; '&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'NUMERIC'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'stock_less') {&nbsp;</div></li><li><div>                    // Where - By Stock - less than&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_manage_stock', &nbsp;</div></li><li><div>                        'value' =&gt; 'yes'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_stock', &nbsp;</div></li><li><div>                        'value' =&gt; str_replace(&quot;, &quot;, &quot;&quot;, number_format($pfw_bulk_action_target_where_stock_value, 0)), &nbsp;</div></li><li><div>                        'compare' =&gt; '&lt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'NUMERIC'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'instock') {&nbsp;</div></li><li><div>                    // Where - Stock status 'instock'&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_stock_status', &nbsp;</div></li><li><div>                        'value' =&gt; 'instock'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'outofstock') {&nbsp;</div></li><li><div>                    // Where - Stock status 'outofstock'&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_stock_status', &nbsp;</div></li><li><div>                        'value' =&gt; 'outofstock'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                } elseif ($pfw_bulk_action_target_where_type == 'sold_individually') {&nbsp;</div></li><li><div>                    // Where - Sold Individually&nbsp;</div></li><li><div>                    array_push($where_args['meta_query'], array(&nbsp;</div></li><li><div>                        'key' =&gt; '_sold_individually', &nbsp;</div></li><li><div>                        'value' =&gt; 'yes'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $products = new WP_Query($where_args);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $errors = TRUE;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Update posts&nbsp;</div></li><li><div>            if (!$errors && $products) {&nbsp;</div></li><li><div>                if (count($products-&gt;posts) &lt; 1) {&nbsp;</div></li><li><div>                    $errors = TRUE;&nbsp;</div></li><li><div>                    $update_count = 'zero';&nbsp;</div></li><li><div>                    $redirect_url = admin_url('options-general.php?page=' . $this-&gt;plugin_slug . '&tab=tools&processed=' . $update_count);&nbsp;</div></li><li><div>                    echo $redirect_url;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    foreach ($products-&gt;posts as $target) {&nbsp;</div></li><li><div>                        $target_product_id = ( $target-&gt;post_parent != '0' ) ? $target-&gt;post_parent : $target-&gt;ID;&nbsp;</div></li><li><div>                        if (get_post_type($target_product_id) == 'product' && !in_array($target_product_id, $processed_product_id)) {&nbsp;</div></li><li><div>                            if (!update_post_meta($target_product_id, $action_key, $is_enable)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $processed_product_id[$target_product_id] = $target_product_id;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $update_count = count($processed_product_id);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // return&nbsp;</div></li><li><div>            if (!$errors) {&nbsp;</div></li><li><div>                if ($update_count == 0) {&nbsp;</div></li><li><div>                    $update_count = 'zero';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $redirect_url = admin_url('options-general.php?page=paypal-for-woocommerce&tab=tabs&processed=' . $update_count);&nbsp;</div></li><li><div>                echo $redirect_url;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                //echo 'failed';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            die(); // this is required to return a proper result&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @since    1.1.8.1&nbsp;</div></li><li><div>     * Non-decimal currency bug..?? #384 &nbsp;</div></li><li><div>     * Check if currency has decimals&nbsp;</div></li><li><div>     * @param type $currency&nbsp;</div></li><li><div>     * @return boolean&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function currency_has_decimals( $currency ) {&nbsp;</div></li><li><div>    if ( in_array( $currency, array( 'HUF', 'JPY', 'TWD' ) ) ) {&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @since    1.1.8.1&nbsp;</div></li><li><div>     * Non-decimal currency bug..?? #384 &nbsp;</div></li><li><div>     * Round prices&nbsp;</div></li><li><div>     * @param type $price&nbsp;</div></li><li><div>     * @return type&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>public static function round( $price ) {&nbsp;</div></li><li><div>    $precision = 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( !self::currency_has_decimals( get_woocommerce_currency() ) ) {&nbsp;</div></li><li><div>        $precision = 0;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return round( $price, $precision );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @since    1.1.8.1&nbsp;</div></li><li><div>     * Non-decimal currency bug..?? #384 &nbsp;</div></li><li><div>     * Round prices&nbsp;</div></li><li><div>     * @param type $price&nbsp;</div></li><li><div>     * @return type&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>public static function number_format( $price ) {&nbsp;</div></li><li><div>    $decimals = 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( !self::currency_has_decimals( get_woocommerce_currency() ) ) {&nbsp;</div></li><li><div>        $decimals = 0;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return number_format( $price, $decimals, '.', '' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function angelleye_paypal_express_checkout_process_checkout_fields() {&nbsp;</div></li><li><div>        $this-&gt;set_session('checkout_form_post_data', serialize($_POST));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private function set_session($key, $value) {&nbsp;</div></li><li><div>        WC()-&gt;session-&gt;set( $key, $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function http_api_curl_ec_add_curl_parameter($handle, $r, $url ) {&nbsp;</div></li><li><div>        $Force_tls_one_point_two = get_option('Force_tls_one_point_two', 'no');&nbsp;</div></li><li><div>        if ( (strstr( $url, 'https://' ) && strstr( $url, '.paypal.com' )) && isset($Force_tls_one_point_two) && $Force_tls_one_point_two == 'yes' ) {&nbsp;</div></li><li><div>            curl_setopt($handle, CURLOPT_VERBOSE, 1);&nbsp;</div></li><li><div>            curl_setopt($handle, CURLOPT_SSLVERSION, 6);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function angelleye_paypal_plus_notice($user_id) {&nbsp;</div></li><li><div>        $paypal_plus = get_option('woocommerce_paypal_plus_settings');&nbsp;</div></li><li><div>        $ignore_paypal_plus_move_notice = get_option('ignore_paypal_plus_move_notice');&nbsp;</div></li><li><div>        $ignore_paypal_plus_move_notice = get_user_meta($user_id, 'ignore_paypal_plus_move_notice');&nbsp;</div></li><li><div>        if($ignore_paypal_plus_move_notice == 'true') {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( !empty($paypal_plus['enabled']) && $paypal_plus['enabled'] == 'yes' && version_compare(VERSION_PFW, '1.2.4', '&lt;=') && $this-&gt;is_paypal_plus_plugin_active() == false && $ignore_paypal_plus_move_notice == false) {&nbsp;</div></li><li><div>            echo '&lt;div class=&quot;notice welcome-panel error&quot;&gt;&lt;p style=&quot;margin: 10px;&quot;&gt;' . sprintf( __(&quot;In order to better support the different countries and international features that PayPal Plus provides we have created a new, separate plugin. &lt;a href='https://www.angelleye.com/product/woocommerce-paypal-plus-plugin' target='_blank'&gt;Get the New PayPal Plus Plugin!&lt;/a&gt;&quot;));&nbsp;</div></li><li><div>            ?&gt;&lt;/p&gt;&lt;a class=&quot;welcome-panel-close&quot; href=&quot;&lt;?php echo esc_url( add_query_arg( array( 'ignore_paypal_plus_move_notice' =&gt; '0' ) ) ); ?&gt;&quot;&gt;&lt;?php _e( 'Dismiss' ); ?&gt;&lt;/a&gt;&lt;/div&gt;&lt;?php &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function is_paypal_plus_plugin_active() {&nbsp;</div></li><li><div>        if ( !in_array( 'woo-paypal-plus/woo-paypal-plus.php', apply_filters( 'active_plugins', get_option( 'active_plugins' ) ) ) && !is_plugin_active_for_network( 'woo-paypal-plus/woo-paypal-plus.php' )) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function wc_gateway_payment_token_api_parser() {&nbsp;</div></li><li><div>        if( !empty($_GET['do_action']) && $_GET['do_action'] = 'update_payment_method') {&nbsp;</div></li><li><div>            if( !empty($_GET['method_name']) && $_GET['method_name'] == 'paypal_express') {&nbsp;</div></li><li><div>                switch ($_GET['action_name']) {&nbsp;</div></li><li><div>                   case 'SetExpressCheckout':&nbsp;</div></li><li><div>                        $woocommerce_token_api = new WC_Gateway_PayPal_Express_AngellEYE();&nbsp;</div></li><li><div>                        $woocommerce_token_api-&gt;paypal_express_checkout_token_request_handler();&nbsp;</div></li><li><div>                       break;&nbsp;</div></li><li><div>                   default:&nbsp;</div></li><li><div>                       break;&nbsp;</div></li><li><div>               }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function woo_compatibility_notice() {&nbsp;</div></li><li><div>        echo '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;' . __('PayPal for WooCommerce requires WooCommerce version 2.6 or higher.  Please backup your site files and database, update WooCommerce, and try again.', 'paypal-for-woocommerce') . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function angelleye_express_checkout_decrypt_gateway_api($bool) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, 'woocommerce_paypal_express_settings' ) );&nbsp;</div></li><li><div>        $gateway_settings = isset($row-&gt;option_value) ? maybe_unserialize($row-&gt;option_value) : array();&nbsp;</div></li><li><div>        if( !empty($row-&gt;option_value) && !empty($gateway_settings['is_encrypt'])) {&nbsp;</div></li><li><div>            $gateway_settings_key_array = array('sandbox_api_username', 'sandbox_api_password', 'sandbox_api_signature', 'api_username', 'api_password', 'api_signature');&nbsp;</div></li><li><div>            foreach ($gateway_settings_key_array as $gateway_setting_key =&gt; $gateway_settings_value) {&nbsp;</div></li><li><div>                if( !empty( $gateway_settings[$gateway_settings_value]) ) {&nbsp;</div></li><li><div>                    $gateway_settings[$gateway_settings_value] = AngellEYE_Utility::crypting($gateway_settings[$gateway_settings_value], $action = 'd');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $gateway_settings;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $bool;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function angelleye_paypal_advanced_decrypt_gateway_api($bool) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, 'woocommerce_paypal_advanced_settings' ) );&nbsp;</div></li><li><div>        $gateway_settings = isset($row-&gt;option_value) ? maybe_unserialize($row-&gt;option_value) : array();&nbsp;</div></li><li><div>        if( !empty($row-&gt;option_value) && !empty($gateway_settings['is_encrypt'])) {&nbsp;</div></li><li><div>            $gateway_settings_key_array = array('loginid', 'resellerid', 'user', 'password');&nbsp;</div></li><li><div>            foreach ($gateway_settings_key_array as $gateway_settings_key =&gt; $gateway_settings_value) {&nbsp;</div></li><li><div>                if( !empty( $gateway_settings[$gateway_settings_value]) ) {&nbsp;</div></li><li><div>                    $gateway_settings[$gateway_settings_value] = AngellEYE_Utility::crypting($gateway_settings[$gateway_settings_value], $action = 'd');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $gateway_settings;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $bool;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function angelleye_paypal_credit_card_rest_decrypt_gateway_api($bool) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, 'woocommerce_paypal_credit_card_rest_settings' ) );&nbsp;</div></li><li><div>        $gateway_settings = isset($row-&gt;option_value) ? maybe_unserialize($row-&gt;option_value) : array();&nbsp;</div></li><li><div>        if( !empty($row-&gt;option_value) && !empty($gateway_settings['is_encrypt'])) {&nbsp;</div></li><li><div>            $gateway_settings_key_array = array('rest_client_id_sandbox', 'rest_secret_id_sandbox', 'rest_client_id', 'rest_secret_id');&nbsp;</div></li><li><div>            foreach ($gateway_settings_key_array as $gateway_settings_key =&gt; $gateway_settings_value) {&nbsp;</div></li><li><div>                if( !empty( $gateway_settings[$gateway_settings_value]) ) {&nbsp;</div></li><li><div>                    $gateway_settings[$gateway_settings_value] = AngellEYE_Utility::crypting($gateway_settings[$gateway_settings_value], $action = 'd');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $gateway_settings;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $bool;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function angelleye_paypal_pro_decrypt_gateway_api($bool) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, 'woocommerce_paypal_pro_settings' ) );&nbsp;</div></li><li><div>        $gateway_settings = isset($row-&gt;option_value) ? maybe_unserialize($row-&gt;option_value) : array();&nbsp;</div></li><li><div>        if( !empty($row-&gt;option_value) && !empty($gateway_settings['is_encrypt'])) {&nbsp;</div></li><li><div>            $gateway_settings_key_array = array('sandbox_api_username', 'sandbox_api_password', 'sandbox_api_signature', 'api_username', 'api_password', 'api_signature');&nbsp;</div></li><li><div>            foreach ($gateway_settings_key_array as $gateway_settings_key =&gt; $gateway_settings_value) {&nbsp;</div></li><li><div>                if( !empty( $gateway_settings[$gateway_settings_value]) ) {&nbsp;</div></li><li><div>                    $gateway_settings[$gateway_settings_value] = AngellEYE_Utility::crypting($gateway_settings[$gateway_settings_value], $action = 'd');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $gateway_settings;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $bool;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function angelleye_paypal_pro_payflow_decrypt_gateway_api($bool) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, 'woocommerce_paypal_pro_payflow_settings' ) );&nbsp;</div></li><li><div>        $gateway_settings = isset($row-&gt;option_value) ? maybe_unserialize($row-&gt;option_value) : array();&nbsp;</div></li><li><div>        if( !empty($row-&gt;option_value) && !empty($gateway_settings['is_encrypt'])) {&nbsp;</div></li><li><div>            $gateway_settings_key_array = array('sandbox_paypal_vendor', 'sandbox_paypal_password', 'sandbox_paypal_user', 'sandbox_paypal_partner', 'paypal_vendor', 'paypal_password', 'paypal_user', 'paypal_partner');&nbsp;</div></li><li><div>            foreach ($gateway_settings_key_array as $gateway_settings_key =&gt; $gateway_settings_value) {&nbsp;</div></li><li><div>                if( !empty( $gateway_settings[$gateway_settings_value]) ) {&nbsp;</div></li><li><div>                    $gateway_settings[$gateway_settings_value] = AngellEYE_Utility::crypting($gateway_settings[$gateway_settings_value], $action = 'd');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $gateway_settings;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $bool;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function angelleye_express_checkout_woocommerce_enable_guest_checkout($bool) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        if (sizeof(WC()-&gt;session) == 0) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, 'woocommerce_enable_guest_checkout' ) );&nbsp;</div></li><li><div>        $paypal_express_checkout = WC()-&gt;session-&gt;get( 'paypal_express_checkout' );&nbsp;</div></li><li><div>        $ec_save_to_account = WC()-&gt;session-&gt;get( 'ec_save_to_account' );&nbsp;</div></li><li><div>        if( !empty($row-&gt;option_value) && $row-&gt;option_value == 'yes' && isset($paypal_express_checkout) && !empty($paypal_express_checkout) && isset($ec_save_to_account) && $ec_save_to_account == 'on') {&nbsp;</div></li><li><div>           return 'no';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $bool;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function angelleye_braintree_decrypt_gateway_api($bool) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, 'woocommerce_braintree_settings' ) );&nbsp;</div></li><li><div>        $gateway_settings = isset($row-&gt;option_value) ? maybe_unserialize($row-&gt;option_value) : array();&nbsp;</div></li><li><div>        if( !empty($row-&gt;option_value) && !empty($gateway_settings['is_encrypt'])) {&nbsp;</div></li><li><div>            $gateway_settings_key_array = array('sandbox_public_key', 'sandbox_private_key', 'sandbox_merchant_id', 'sandbox_merchant_account_id', 'public_key', 'private_key', 'merchant_id', 'merchant_account_id');&nbsp;</div></li><li><div>            foreach ($gateway_settings_key_array as $gateway_settings_key =&gt; $gateway_settings_value) {&nbsp;</div></li><li><div>                if( !empty( $gateway_settings[$gateway_settings_value]) ) {&nbsp;</div></li><li><div>                    $gateway_settings[$gateway_settings_value] = AngellEYE_Utility::crypting($gateway_settings[$gateway_settings_value], $action = 'd');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $gateway_settings;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $bool;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function angelleye_paypal_for_woocommerce_page_title($page_title) {&nbsp;</div></li><li><div>        if (sizeof(WC()-&gt;session) == 0) {&nbsp;</div></li><li><div>            return $page_title;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $paypal_express_checkout = WC()-&gt;session-&gt;get( 'paypal_express_checkout' );&nbsp;</div></li><li><div>        if ('Checkout' == $page_title && !empty($paypal_express_checkout)) {&nbsp;</div></li><li><div>            remove_filter('the_title', array($this, 'angelleye_paypal_for_woocommerce_page_title'));&nbsp;</div></li><li><div>            return 'Review Order';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $page_title;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.3.3</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/classes/angell_eye_gateway_paypal/" class="active">1.4.3</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.2/classes/angell_eye_gateway_paypal/" class="">1.4.2</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.1/classes/angell_eye_gateway_paypal/" class="">1.4.1</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/classes/angell_eye_gateway_paypal/" class="">1.4.0</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.3.3/classes/angell_eye_gateway_paypal/" class="">1.3.3</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>AngellEYE_Gateway_Paypal</li><li><span></span>wp-plugin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>