<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-type="class" data-id="641"><head xmlns="http://www.w3.org/1999/xhtml"><title> custom_background | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Custom_Background, class, wordpress, 4.7.4" /><meta name="description" content="The custom background class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ecf4dbc7deec876949431b745e3691a9' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/custom_background/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcustom_background%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcustom_background%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-class-custom_background","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="custom_background" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7.4/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">custom_background</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Custom_Background</strong></h1><p>The custom background class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7.4/files/wp-admin-custom-background/" class="file">/wp-admin/custom-background.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="16" class="block" start="16"><li><div>class Custom_Background {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback for administration header.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var callable&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $admin_header_callback;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback for header div.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var callable&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $admin_image_div_callback;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Used to trigger a success message when settings updated and set to true.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $updated;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor - Register administration header callback.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @param callable $admin_header_callback&nbsp;</div></li><li><div>     * @param callable $admin_image_div_callback Optional custom image div output callback.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct($admin_header_callback = '', $admin_image_div_callback = '') {&nbsp;</div></li><li><div>        $this-&gt;admin_header_callback = $admin_header_callback;&nbsp;</div></li><li><div>        $this-&gt;admin_image_div_callback = $admin_image_div_callback;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'admin_menu', array( $this, 'init' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'wp_ajax_custom-background-add', array( $this, 'ajax_background_add' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Unused since 3.5.0.&nbsp;</div></li><li><div>        add_action( 'wp_ajax_set-background-image', array( $this, 'wp_set_background_image' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set up the hooks for the Custom Background admin page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function init() {&nbsp;</div></li><li><div>        $page = add_theme_page( __( 'Background' ), __( 'Background' ), 'edit_theme_options', 'custom-background', array( $this, 'admin_page' ) );&nbsp;</div></li><li><div>        if ( ! $page ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( &quot;load-$page&quot;, array( $this, 'admin_load' ) );&nbsp;</div></li><li><div>        add_action( &quot;load-$page&quot;, array( $this, 'take_action' ), 49 );&nbsp;</div></li><li><div>        add_action( &quot;load-$page&quot;, array( $this, 'handle_upload' ), 49 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;admin_header_callback ) {&nbsp;</div></li><li><div>            add_action( &quot;admin_head-$page&quot;, $this-&gt;admin_header_callback, 51 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set up the enqueue for the CSS & JavaScript files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_load() {&nbsp;</div></li><li><div>        get_current_screen()-&gt;add_help_tab( array(&nbsp;</div></li><li><div>            'id' =&gt; 'overview', &nbsp;</div></li><li><div>            'title' =&gt; __('Overview'), &nbsp;</div></li><li><div>            'content' =&gt;&nbsp;</div></li><li><div>                '&lt;p&gt;' . __( 'You can customize the look of your site without touching any of your theme&#8217;s code by using a custom background. Your background can be an image or a color.' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>                '&lt;p&gt;' . __( 'To use a background image, simply upload it or choose an image that has already been uploaded to your Media Library by clicking the &#8220;Choose Image&#8221; button. You can display a single instance of your image, or tile it to fill the screen. You can have your background fixed in place, so your site content moves on top of it, or you can have it scroll with your site.' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>                '&lt;p&gt;' . __( 'You can also choose a background color by clicking the Select Color button and either typing in a legitimate HTML hex value, e.g. &#8220;#ff0000&#8221; for red, or by choosing a color using the color picker.' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>                '&lt;p&gt;' . __( 'Don&#8217;t forget to click on the Save Changes button when you are finished.' ) . '&lt;/p&gt;'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        get_current_screen()-&gt;set_help_sidebar(&nbsp;</div></li><li><div>            '&lt;p&gt;&lt;strong&gt;' . __( 'For more information:' ) . '&lt;/strong&gt;&lt;/p&gt;' .&nbsp;</div></li><li><div>            '&lt;p&gt;' . __( '&lt;a href=&quot;https://codex.wordpress.org/Appearance_Background_Screen&quot;&gt;Documentation on Custom Background&lt;/a&gt;' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>            '&lt;p&gt;' . __( '&lt;a href=&quot;https://wordpress.org/support/&quot;&gt;Support Forums&lt;/a&gt;' ) . '&lt;/p&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_enqueue_media();&nbsp;</div></li><li><div>        wp_enqueue_script('custom-background');&nbsp;</div></li><li><div>        wp_enqueue_style('wp-color-picker');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Execute custom background modification.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function take_action() {&nbsp;</div></li><li><div>        if ( empty($_POST) )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($_POST['reset-background']) ) {&nbsp;</div></li><li><div>            check_admin_referer('custom-background-reset', '_wpnonce-custom-background-reset');&nbsp;</div></li><li><div>            remove_theme_mod('background_image');&nbsp;</div></li><li><div>            remove_theme_mod('background_image_thumb');&nbsp;</div></li><li><div>            $this-&gt;updated = true;&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($_POST['remove-background']) ) {&nbsp;</div></li><li><div>            // @TODO: Uploaded files are not removed here.&nbsp;</div></li><li><div>            check_admin_referer('custom-background-remove', '_wpnonce-custom-background-remove');&nbsp;</div></li><li><div>            set_theme_mod('background_image', '');&nbsp;</div></li><li><div>            set_theme_mod('background_image_thumb', '');&nbsp;</div></li><li><div>            $this-&gt;updated = true;&nbsp;</div></li><li><div>            wp_safe_redirect( $_POST['_wp_http_referer'] );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST['background-preset'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'custom-background' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $_POST['background-preset'], array( 'default', 'fill', 'fit', 'repeat', 'custom' ), true ) ) {&nbsp;</div></li><li><div>                $preset = $_POST['background-preset'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $preset = 'default';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            set_theme_mod( 'background_preset', $preset );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST['background-position'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'custom-background' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $position = explode( ' ', $_POST['background-position'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $position[0], array( 'left', 'center', 'right' ), true ) ) {&nbsp;</div></li><li><div>                $position_x = $position[0];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $position_x = 'left';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $position[1], array( 'top', 'center', 'bottom' ), true ) ) {&nbsp;</div></li><li><div>                $position_y = $position[1];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $position_y = 'top';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            set_theme_mod( 'background_position_x', $position_x );&nbsp;</div></li><li><div>            set_theme_mod( 'background_position_y', $position_y );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST['background-size'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'custom-background' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $_POST['background-size'], array( 'auto', 'contain', 'cover' ), true ) ) {&nbsp;</div></li><li><div>                $size = $_POST['background-size'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $size = 'auto';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            set_theme_mod( 'background_size', $size );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST['background-repeat'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'custom-background' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $repeat = $_POST['background-repeat'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'no-repeat' !== $repeat ) {&nbsp;</div></li><li><div>                $repeat = 'repeat';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            set_theme_mod( 'background_repeat', $repeat );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST['background-attachment'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'custom-background' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $attachment = $_POST['background-attachment'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'fixed' !== $attachment ) {&nbsp;</div></li><li><div>                $attachment = 'scroll';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            set_theme_mod( 'background_attachment', $attachment );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($_POST['background-color']) ) {&nbsp;</div></li><li><div>            check_admin_referer('custom-background');&nbsp;</div></li><li><div>            $color = preg_replace('/[^0-9a-fA-F]/', '', $_POST['background-color']);&nbsp;</div></li><li><div>            if ( strlen($color) == 6 || strlen($color) == 3 )&nbsp;</div></li><li><div>                set_theme_mod('background_color', $color);&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                set_theme_mod('background_color', '');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;updated = true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display the custom background page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_page() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;wrap&quot; id=&quot;custom-background&quot;&gt;&nbsp;</div></li><li><div>&lt;h1&gt;&lt;?php _e( 'Custom Background' ); ?&gt;&lt;/h1&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php if ( current_user_can( 'customize' ) ) { ?&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;notice notice-info hide-if-no-customize&quot;&gt;&nbsp;</div></li><li><div>    &lt;p&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        printf(&nbsp;</div></li><li><div>            __( 'You can now manage and live-preview Custom Backgrounds in the &lt;a href=&quot;%1$s&quot;&gt;Customizer&lt;/a&gt;.' ), &nbsp;</div></li><li><div>            admin_url( 'customize.php?autofocus[control]=background_image' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>    &lt;/p&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php if ( ! empty( $this-&gt;updated ) ) { ?&gt;&nbsp;</div></li><li><div>&lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;&nbsp;</div></li><li><div>&lt;p&gt;&lt;?php printf( __( 'Background updated. &lt;a href=&quot;%s&quot;&gt;Visit your site&lt;/a&gt; to see how it looks.' ), home_url( '/' ) ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;h3&gt;&lt;?php _e( 'Background Image' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>&lt;tbody&gt;&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Preview' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&nbsp;</div></li><li><div>    &lt;?php&nbsp;</div></li><li><div>    if ( $this-&gt;admin_image_div_callback ) {&nbsp;</div></li><li><div>        call_user_func( $this-&gt;admin_image_div_callback );&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $background_styles = '';&nbsp;</div></li><li><div>        if ( $bgcolor = get_background_color() )&nbsp;</div></li><li><div>            $background_styles .= 'background-color: #' . $bgcolor . ';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $background_image_thumb = get_background_image();&nbsp;</div></li><li><div>        if ( $background_image_thumb ) {&nbsp;</div></li><li><div>            $background_image_thumb = esc_url( set_url_scheme( get_theme_mod( 'background_image_thumb', str_replace( '%', '%%', $background_image_thumb ) ) ) );&nbsp;</div></li><li><div>            $background_position_x = get_theme_mod( 'background_position_x', get_theme_support( 'custom-background', 'default-position-x' ) );&nbsp;</div></li><li><div>            $background_position_y = get_theme_mod( 'background_position_y', get_theme_support( 'custom-background', 'default-position-y' ) );&nbsp;</div></li><li><div>            $background_size = get_theme_mod( 'background_size', get_theme_support( 'custom-background', 'default-size' ) );&nbsp;</div></li><li><div>            $background_repeat = get_theme_mod( 'background_repeat', get_theme_support( 'custom-background', 'default-repeat' ) );&nbsp;</div></li><li><div>            $background_attachment = get_theme_mod( 'background_attachment', get_theme_support( 'custom-background', 'default-attachment' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Background-image URL must be single quote, see below.&nbsp;</div></li><li><div>            $background_styles .= &quot; background-image: url('$background_image_thumb');&quot;&nbsp;</div></li><li><div>                . &quot; background-size: $background_size;&quot;&nbsp;</div></li><li><div>                . &quot; background-position: $background_position_x $background_position_y;&quot;&nbsp;</div></li><li><div>                . &quot; background-repeat: $background_repeat;&quot;&nbsp;</div></li><li><div>                . &quot; background-attachment: $background_attachment;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    ?&gt;&nbsp;</div></li><li><div>    &lt;div id=&quot;custom-background-image&quot; style=&quot;&lt;?php echo $background_styles; ?&gt;&quot;&gt;&lt;?php // must be double quote, see above ?&gt;&nbsp;</div></li><li><div>        &lt;?php if ( $background_image_thumb ) { ?&gt;&nbsp;</div></li><li><div>        &lt;img class=&quot;custom-background-image&quot; src=&quot;&lt;?php echo $background_image_thumb; ?&gt;&quot; style=&quot;visibility:hidden;&quot; alt=&quot;&quot; /&gt;&lt;br /&gt;&nbsp;</div></li><li><div>        &lt;img class=&quot;custom-background-image&quot; src=&quot;&lt;?php echo $background_image_thumb; ?&gt;&quot; style=&quot;visibility:hidden;&quot; alt=&quot;&quot; /&gt;&nbsp;</div></li><li><div>        &lt;?php } ?&gt;&nbsp;</div></li><li><div>    &lt;/div&gt;&nbsp;</div></li><li><div>    &lt;?php } ?&gt;&nbsp;</div></li><li><div>&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php if ( get_background_image() ) : ?&gt;&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _e('Remove Image'); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&nbsp;</div></li><li><div>&lt;form method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&lt;?php wp_nonce_field('custom-background-remove', '_wpnonce-custom-background-remove'); ?&gt;&nbsp;</div></li><li><div>&lt;?php submit_button( __( 'Remove Background Image' ), '', 'remove-background', false ); ?&gt;&lt;br/&gt;&nbsp;</div></li><li><div>&lt;?php _e('This will remove the background image. You will not be able to restore any customizations.') ?&gt;&nbsp;</div></li><li><div>&lt;/form&gt;&nbsp;</div></li><li><div>&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php $default_image = get_theme_support( 'custom-background', 'default-image' ); ?&gt;&nbsp;</div></li><li><div>&lt;?php if ( $default_image && get_background_image() != $default_image ) : ?&gt;&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _e('Restore Original Image'); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&nbsp;</div></li><li><div>&lt;form method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&lt;?php wp_nonce_field('custom-background-reset', '_wpnonce-custom-background-reset'); ?&gt;&nbsp;</div></li><li><div>&lt;?php submit_button( __( 'Restore Original Image' ), '', 'reset-background', false ); ?&gt;&lt;br/&gt;&nbsp;</div></li><li><div>&lt;?php _e('This will restore the original background image. You will not be able to restore any customizations.') ?&gt;&nbsp;</div></li><li><div>&lt;/form&gt;&nbsp;</div></li><li><div>&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php if ( current_user_can( 'upload_files' ) ): ?&gt;&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _e('Select Image'); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&lt;form enctype=&quot;multipart/form-data&quot; id=&quot;upload-form&quot; class=&quot;wp-upload-form&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>    &lt;p&gt;&nbsp;</div></li><li><div>        &lt;label for=&quot;upload&quot;&gt;&lt;?php _e( 'Choose an image from your computer:' ); ?&gt;&lt;/label&gt;&lt;br /&gt;&nbsp;</div></li><li><div>        &lt;input type=&quot;file&quot; id=&quot;upload&quot; name=&quot;import&quot; /&gt;&nbsp;</div></li><li><div>        &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;save&quot; /&gt;&nbsp;</div></li><li><div>        &lt;?php wp_nonce_field( 'custom-background-upload', '_wpnonce-custom-background-upload' ); ?&gt;&nbsp;</div></li><li><div>        &lt;?php submit_button( __( 'Upload' ), '', 'submit', false ); ?&gt;&nbsp;</div></li><li><div>    &lt;/p&gt;&nbsp;</div></li><li><div>    &lt;p&gt;&nbsp;</div></li><li><div>        &lt;label for=&quot;choose-from-library-link&quot;&gt;&lt;?php _e( 'Or choose an image from your media library:' ); ?&gt;&lt;/label&gt;&lt;br /&gt;&nbsp;</div></li><li><div>        &lt;button id=&quot;choose-from-library-link&quot; class=&quot;button&quot;&nbsp;</div></li><li><div>            data-choose=&quot;&lt;?php esc_attr_e( 'Choose a Background Image' ); ?&gt;&quot;&nbsp;</div></li><li><div>            data-update=&quot;&lt;?php esc_attr_e( 'Set as background' ); ?&gt;&quot;&gt;&lt;?php _e( 'Choose Image' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>    &lt;/p&gt;&nbsp;</div></li><li><div>    &lt;/form&gt;&nbsp;</div></li><li><div>&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&lt;/tbody&gt;&nbsp;</div></li><li><div>&lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;h3&gt;&lt;?php _e( 'Display Options' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>&lt;form method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>&lt;tbody&gt;&nbsp;</div></li><li><div>&lt;?php if ( get_background_image() ) : ?&gt;&nbsp;</div></li><li><div>&lt;input name=&quot;background-preset&quot; type=&quot;hidden&quot; value=&quot;custom&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>$background_position = sprintf(&nbsp;</div></li><li><div>    '%s %s', &nbsp;</div></li><li><div>    get_theme_mod( 'background_position_x', get_theme_support( 'custom-background', 'default-position-x' ) ), &nbsp;</div></li><li><div>    get_theme_mod( 'background_position_y', get_theme_support( 'custom-background', 'default-position-y' ) )&nbsp;</div></li><li><div>);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$background_position_options = array(&nbsp;</div></li><li><div>    array(&nbsp;</div></li><li><div>        'left top' =&gt; array( 'label' =&gt; __( 'Top Left' ), 'icon' =&gt; 'dashicons dashicons-arrow-left-alt' ), &nbsp;</div></li><li><div>        'center top' =&gt; array( 'label' =&gt; __( 'Top' ), 'icon' =&gt; 'dashicons dashicons-arrow-up-alt' ), &nbsp;</div></li><li><div>        'right top' =&gt; array( 'label' =&gt; __( 'Top Right' ), 'icon' =&gt; 'dashicons dashicons-arrow-right-alt' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>    array(&nbsp;</div></li><li><div>        'left center' =&gt; array( 'label' =&gt; __( 'Left' ), 'icon' =&gt; 'dashicons dashicons-arrow-left-alt' ), &nbsp;</div></li><li><div>        'center center' =&gt; array( 'label' =&gt; __( 'Center' ), 'icon' =&gt; 'background-position-center-icon' ), &nbsp;</div></li><li><div>        'right center' =&gt; array( 'label' =&gt; __( 'Right' ), 'icon' =&gt; 'dashicons dashicons-arrow-right-alt' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>    array(&nbsp;</div></li><li><div>        'left bottom' =&gt; array( 'label' =&gt; __( 'Bottom Left' ), 'icon' =&gt; 'dashicons dashicons-arrow-left-alt' ), &nbsp;</div></li><li><div>        'center bottom' =&gt; array( 'label' =&gt; __( 'Bottom' ), 'icon' =&gt; 'dashicons dashicons-arrow-down-alt' ), &nbsp;</div></li><li><div>        'right bottom' =&gt; array( 'label' =&gt; __( 'Bottom Right' ), 'icon' =&gt; 'dashicons dashicons-arrow-right-alt' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>);&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Image Position' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;&lt;?php _e( 'Image Position' ); ?&gt;&lt;/span&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;background-position-control&quot;&gt;&nbsp;</div></li><li><div>&lt;?php foreach ( $background_position_options as $group ) : ?&gt;&nbsp;</div></li><li><div>    &lt;div class=&quot;button-group&quot;&gt;&nbsp;</div></li><li><div>    &lt;?php foreach ( $group as $value =&gt; $input ) : ?&gt;&nbsp;</div></li><li><div>        &lt;label&gt;&nbsp;</div></li><li><div>            &lt;input class=&quot;screen-reader-text&quot; name=&quot;background-position&quot; type=&quot;radio&quot; value=&quot;&lt;?php echo esc_attr( $value ); ?&gt;&quot;&lt;?php checked( $value, $background_position ); ?&gt;&gt;&nbsp;</div></li><li><div>            &lt;span class=&quot;button display-options position&quot;&gt;&lt;span class=&quot;&lt;?php echo esc_attr( $input['icon'] ); ?&gt;&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt;&lt;/span&gt;&nbsp;</div></li><li><div>            &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php echo $input['label']; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>        &lt;/label&gt;&nbsp;</div></li><li><div>    &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>    &lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;label for=&quot;background-size&quot;&gt;&lt;?php _e( 'Image Size' ); ?&gt;&lt;/label&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;&lt;?php _e( 'Image Size' ); ?&gt;&lt;/span&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;select id=&quot;background-size&quot; name=&quot;background-size&quot;&gt;&nbsp;</div></li><li><div>&lt;option value=&quot;auto&quot;&lt;?php selected( 'auto', get_theme_mod( 'background_size', get_theme_support( 'custom-background', 'default-size' ) ) ); ?&gt;&gt;&lt;?php _ex( 'Original', 'Original Size' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>&lt;option value=&quot;contain&quot;&lt;?php selected( 'contain', get_theme_mod( 'background_size', get_theme_support( 'custom-background', 'default-size' ) ) ); ?&gt;&gt;&lt;?php _e( 'Fit to Screen' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>&lt;option value=&quot;cover&quot;&lt;?php selected( 'cover', get_theme_mod( 'background_size', get_theme_support( 'custom-background', 'default-size' ) ) ); ?&gt;&gt;&lt;?php _e( 'Fill Screen' ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>&lt;/select&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _ex( 'Repeat', 'Background Repeat' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;&lt;?php _ex( 'Repeat', 'Background Repeat' ); ?&gt;&lt;/span&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;input name=&quot;background-repeat&quot; type=&quot;hidden&quot; value=&quot;no-repeat&quot;&gt;&nbsp;</div></li><li><div>&lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;background-repeat&quot; value=&quot;repeat&quot;&lt;?php checked( 'repeat', get_theme_mod( 'background_repeat', get_theme_support( 'custom-background', 'default-repeat' ) ) ); ?&gt;&gt; &lt;?php _e( 'Repeat Background Image' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _ex( 'Scroll', 'Background Scroll' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;&lt;?php _ex( 'Scroll', 'Background Scroll' ); ?&gt;&lt;/span&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;input name=&quot;background-attachment&quot; type=&quot;hidden&quot; value=&quot;fixed&quot;&gt;&nbsp;</div></li><li><div>&lt;label&gt;&lt;input name=&quot;background-attachment&quot; type=&quot;checkbox&quot; value=&quot;scroll&quot; &lt;?php checked( 'scroll', get_theme_mod( 'background_attachment', get_theme_support( 'custom-background', 'default-attachment' ) ) ); ?&gt;&gt; &lt;?php _e( 'Scroll with Page' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;?php endif; // get_background_image() ?&gt;&nbsp;</div></li><li><div>&lt;tr&gt;&nbsp;</div></li><li><div>&lt;th scope=&quot;row&quot;&gt;&lt;?php _e( 'Background Color' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>&lt;td&gt;&lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;&lt;?php _e( 'Background Color' ); ?&gt;&lt;/span&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>$default_color = '';&nbsp;</div></li><li><div>if ( current_theme_supports( 'custom-background', 'default-color' ) )&nbsp;</div></li><li><div>    $default_color = ' data-default-color=&quot;#' . esc_attr( get_theme_support( 'custom-background', 'default-color' ) ) . '&quot;';&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;input type=&quot;text&quot; name=&quot;background-color&quot; id=&quot;background-color&quot; value=&quot;#&lt;?php echo esc_attr( get_background_color() ); ?&gt;&quot;&lt;?php echo $default_color ?&gt;&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;/tbody&gt;&nbsp;</div></li><li><div>&lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php wp_nonce_field('custom-background'); ?&gt;&nbsp;</div></li><li><div>&lt;?php submit_button( null, 'primary', 'save-background-options' ); ?&gt;&nbsp;</div></li><li><div>&lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle an Image upload for the background image.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function handle_upload() {&nbsp;</div></li><li><div>        if ( empty($_FILES) )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        check_admin_referer('custom-background-upload', '_wpnonce-custom-background-upload');&nbsp;</div></li><li><div>        $overrides = array('test_form' =&gt; false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $uploaded_file = $_FILES['import'];&nbsp;</div></li><li><div>        $wp_filetype = wp_check_filetype_and_ext( $uploaded_file['tmp_name'], $uploaded_file['name'] );&nbsp;</div></li><li><div>        if ( ! wp_match_mime_types( 'image', $wp_filetype['type'] ) )&nbsp;</div></li><li><div>            wp_die( __( 'The uploaded file is not a valid image. Please try again.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $file = wp_handle_upload($uploaded_file, $overrides);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($file['error']) )&nbsp;</div></li><li><div>            wp_die( $file['error'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $url = $file['url'];&nbsp;</div></li><li><div>        $type = $file['type'];&nbsp;</div></li><li><div>        $file = $file['file'];&nbsp;</div></li><li><div>        $filename = basename($file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Construct the object array&nbsp;</div></li><li><div>        $object = array(&nbsp;</div></li><li><div>            'post_title' =&gt; $filename, &nbsp;</div></li><li><div>            'post_content' =&gt; $url, &nbsp;</div></li><li><div>            'post_mime_type' =&gt; $type, &nbsp;</div></li><li><div>            'guid' =&gt; $url, &nbsp;</div></li><li><div>            'context' =&gt; 'custom-background'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save the data&nbsp;</div></li><li><div>        $id = wp_insert_attachment($object, $file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the meta-data&nbsp;</div></li><li><div>        wp_update_attachment_metadata( $id, wp_generate_attachment_metadata( $id, $file ) );&nbsp;</div></li><li><div>        update_post_meta( $id, '_wp_attachment_is_custom_background', get_option('stylesheet' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        set_theme_mod('background_image', esc_url_raw($url));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $thumbnail = wp_get_attachment_image_src( $id, 'thumbnail' );&nbsp;</div></li><li><div>        set_theme_mod('background_image_thumb', esc_url_raw( $thumbnail[0] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-admin/custom-header.php */&nbsp;</div></li><li><div>        do_action( 'wp_create_file_in_uploads', $file, $id ); // For replication&nbsp;</div></li><li><div>        $this-&gt;updated = true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Ajax handler for adding custom background context to an attachment.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Triggered when the user adds a new background image from the&nbsp;</div></li><li><div>     * Media Manager.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function ajax_background_add() {&nbsp;</div></li><li><div>        check_ajax_referer( 'background-add', 'nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_theme_options' ) ) {&nbsp;</div></li><li><div>            wp_send_json_error();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $attachment_id = absint( $_POST['attachment_id'] );&nbsp;</div></li><li><div>        if ( $attachment_id &lt; 1 ) {&nbsp;</div></li><li><div>            wp_send_json_error();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        update_post_meta( $attachment_id, '_wp_attachment_is_custom_background', get_stylesheet() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_send_json_success();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @deprecated 3.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $form_fields&nbsp;</div></li><li><div>     * @return array $form_fields&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function attachment_fields_to_edit( $form_fields ) {&nbsp;</div></li><li><div>        return $form_fields;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @deprecated 3.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $tabs&nbsp;</div></li><li><div>     * @return array $tabs&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function filter_upload_tabs( $tabs ) {&nbsp;</div></li><li><div>        return $tabs;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @deprecated 3.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_set_background_image() {&nbsp;</div></li><li><div>        if ( ! current_user_can('edit_theme_options') || ! isset( $_POST['attachment_id'] ) ) exit;&nbsp;</div></li><li><div>        $attachment_id = absint($_POST['attachment_id']);&nbsp;</div></li><li><div>        /** This filter is documented in wp-admin/includes/media.php */&nbsp;</div></li><li><div>        $sizes = array_keys(apply_filters( 'image_size_names_choose', array('thumbnail' =&gt; __('Thumbnail'), 'medium' =&gt; __('Medium'), 'large' =&gt; __('Large'), 'full' =&gt; __('Full Size')) ));&nbsp;</div></li><li><div>        $size = 'thumbnail';&nbsp;</div></li><li><div>        if ( in_array( $_POST['size'], $sizes ) )&nbsp;</div></li><li><div>            $size = esc_attr( $_POST['size'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        update_post_meta( $attachment_id, '_wp_attachment_is_custom_background', get_option('stylesheet' ) );&nbsp;</div></li><li><div>        $url = wp_get_attachment_image_src( $attachment_id, $size );&nbsp;</div></li><li><div>        $thumbnail = wp_get_attachment_image_src( $attachment_id, 'thumbnail' );&nbsp;</div></li><li><div>        set_theme_mod( 'background_image', esc_url_raw( $url[0] ) );&nbsp;</div></li><li><div>        set_theme_mod( 'background_image_thumb', esc_url_raw( $thumbnail[0] ) );&nbsp;</div></li><li><div>        exit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.0.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/custom_background/" class="active">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/custom_background/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/custom_background/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/custom_background/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/custom_background/" class="">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>Custom_Background</li><li><span></span>wp-admin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>