<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-type="class" data-id="1302"><head xmlns="http://www.w3.org/1999/xhtml"><title> getid3_flac | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="getid3_flac, class, wordpress, 4.7.4" /><meta name="description" content="The WordPress Core getid3 flac class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=4f2fa6d343cbc4554a0d4554da0f5bcb' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/getid3_flac/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgetid3_flac%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgetid3_flac%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-class-getid3_flac","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="getid3_flac" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7.4/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">getid3_flac</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>getid3_flac</strong></h1><p>The WordPress Core <strong>getid3 flac</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7.4/files/wp-includes-id3-module-audio-flac/" class="file">/wp-includes/ID3/module.audio.flac.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="23" class="block" start="23"><li><div>class getid3_flac extends getid3_handler&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    const syncword = 'fLaC';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function Analyze() {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;fseek($info['avdataoffset']);&nbsp;</div></li><li><div>        $StreamMarker = $this-&gt;fread(4);&nbsp;</div></li><li><div>        if ($StreamMarker != self::syncword) {&nbsp;</div></li><li><div>            return $this-&gt;error('Expecting &quot;'.getid3_lib::PrintHexBytes(self::syncword).'&quot; at offset '.$info['avdataoffset'].', found &quot;'.getid3_lib::PrintHexBytes($StreamMarker).'&quot;');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $info['fileformat'] = 'flac';&nbsp;</div></li><li><div>        $info['audio']['dataformat'] = 'flac';&nbsp;</div></li><li><div>        $info['audio']['bitrate_mode'] = 'vbr';&nbsp;</div></li><li><div>        $info['audio']['lossless'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // parse flac container&nbsp;</div></li><li><div>        return $this-&gt;parseMETAdata();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function parseMETAdata() {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>        do {&nbsp;</div></li><li><div>            $BlockOffset = $this-&gt;ftell();&nbsp;</div></li><li><div>            $BlockHeader = $this-&gt;fread(4);&nbsp;</div></li><li><div>            $LBFBT = getid3_lib::BigEndian2Int(substr($BlockHeader, 0, 1));&nbsp;</div></li><li><div>            $LastBlockFlag = (bool) ($LBFBT & 0x80);&nbsp;</div></li><li><div>            $BlockType =        ($LBFBT & 0x7F);&nbsp;</div></li><li><div>            $BlockLength = getid3_lib::BigEndian2Int(substr($BlockHeader, 1, 3));&nbsp;</div></li><li><div>            $BlockTypeText = self::metaBlockTypeLookup($BlockType);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (($BlockOffset + 4 + $BlockLength) &gt; $info['avdataend']) {&nbsp;</div></li><li><div>                $this-&gt;error('METADATA_BLOCK_HEADER.BLOCK_TYPE ('.$BlockTypeText.') at offset '.$BlockOffset.' extends beyond end of file');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($BlockLength &lt; 1) {&nbsp;</div></li><li><div>                $this-&gt;error('METADATA_BLOCK_HEADER.BLOCK_LENGTH ('.$BlockLength.') at offset '.$BlockOffset.' is invalid');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info['flac'][$BlockTypeText]['raw'] = array();&nbsp;</div></li><li><div>            $BlockTypeText_raw = &$info['flac'][$BlockTypeText]['raw'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $BlockTypeText_raw['offset'] = $BlockOffset;&nbsp;</div></li><li><div>            $BlockTypeText_raw['last_meta_block'] = $LastBlockFlag;&nbsp;</div></li><li><div>            $BlockTypeText_raw['block_type'] = $BlockType;&nbsp;</div></li><li><div>            $BlockTypeText_raw['block_type_text'] = $BlockTypeText;&nbsp;</div></li><li><div>            $BlockTypeText_raw['block_length'] = $BlockLength;&nbsp;</div></li><li><div>            if ($BlockTypeText_raw['block_type'] != 0x06) { // do not read attachment data automatically&nbsp;</div></li><li><div>                $BlockTypeText_raw['block_data'] = $this-&gt;fread($BlockLength);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch ($BlockTypeText) {&nbsp;</div></li><li><div>                case 'STREAMINFO':     // 0x00&nbsp;</div></li><li><div>                    if (!$this-&gt;parseSTREAMINFO($BlockTypeText_raw['block_data'])) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'PADDING':        // 0x01&nbsp;</div></li><li><div>                    unset($info['flac']['PADDING']); // ignore&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'APPLICATION':    // 0x02&nbsp;</div></li><li><div>                    if (!$this-&gt;parseAPPLICATION($BlockTypeText_raw['block_data'])) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'SEEKTABLE':      // 0x03&nbsp;</div></li><li><div>                    if (!$this-&gt;parseSEEKTABLE($BlockTypeText_raw['block_data'])) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'VORBIS_COMMENT': // 0x04&nbsp;</div></li><li><div>                    if (!$this-&gt;parseVORBIS_COMMENT($BlockTypeText_raw['block_data'])) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'CUESHEET':       // 0x05&nbsp;</div></li><li><div>                    if (!$this-&gt;parseCUESHEET($BlockTypeText_raw['block_data'])) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'PICTURE':        // 0x06&nbsp;</div></li><li><div>                    if (!$this-&gt;parsePICTURE()) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    $this-&gt;warning('Unhandled METADATA_BLOCK_HEADER.BLOCK_TYPE ('.$BlockType.') at offset '.$BlockOffset);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset($info['flac'][$BlockTypeText]['raw']);&nbsp;</div></li><li><div>            $info['avdataoffset'] = $this-&gt;ftell();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        while ($LastBlockFlag === false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // handle tags&nbsp;</div></li><li><div>        if (!empty($info['flac']['VORBIS_COMMENT']['comments'])) {&nbsp;</div></li><li><div>            $info['flac']['comments'] = $info['flac']['VORBIS_COMMENT']['comments'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!empty($info['flac']['VORBIS_COMMENT']['vendor'])) {&nbsp;</div></li><li><div>            $info['audio']['encoder'] = str_replace('reference ', '', $info['flac']['VORBIS_COMMENT']['vendor']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // copy attachments to 'comments' array if nesesary&nbsp;</div></li><li><div>        if (isset($info['flac']['PICTURE']) && ($this-&gt;getid3-&gt;option_save_attachments !== getID3::ATTACHMENTS_NONE)) {&nbsp;</div></li><li><div>            foreach ($info['flac']['PICTURE'] as $entry) {&nbsp;</div></li><li><div>                if (!empty($entry['data'])) {&nbsp;</div></li><li><div>                    if (!isset($info['flac']['comments']['picture'])) {&nbsp;</div></li><li><div>                        $info['flac']['comments']['picture'] = array();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $comments_picture_data = array();&nbsp;</div></li><li><div>                    foreach (array('data', 'image_mime', 'image_width', 'image_height', 'imagetype', 'picturetype', 'description', 'datalength') as $picture_key) {&nbsp;</div></li><li><div>                        if (isset($entry[$picture_key])) {&nbsp;</div></li><li><div>                            $comments_picture_data[$picture_key] = $entry[$picture_key];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $info['flac']['comments']['picture'][] = $comments_picture_data;&nbsp;</div></li><li><div>                    unset($comments_picture_data);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($info['flac']['STREAMINFO'])) {&nbsp;</div></li><li><div>            if (!$this-&gt;isDependencyFor('matroska')) {&nbsp;</div></li><li><div>                $info['flac']['compressed_audio_bytes'] = $info['avdataend'] - $info['avdataoffset'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $info['flac']['uncompressed_audio_bytes'] = $info['flac']['STREAMINFO']['samples_stream'] * $info['flac']['STREAMINFO']['channels'] * ($info['flac']['STREAMINFO']['bits_per_sample'] / 8);&nbsp;</div></li><li><div>            if ($info['flac']['uncompressed_audio_bytes'] == 0) {&nbsp;</div></li><li><div>                return $this-&gt;error('Corrupt FLAC file: uncompressed_audio_bytes == zero');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!empty($info['flac']['compressed_audio_bytes'])) {&nbsp;</div></li><li><div>                $info['flac']['compression_ratio'] = $info['flac']['compressed_audio_bytes'] / $info['flac']['uncompressed_audio_bytes'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set md5_data_source - built into flac 0.5+&nbsp;</div></li><li><div>        if (isset($info['flac']['STREAMINFO']['audio_signature'])) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($info['flac']['STREAMINFO']['audio_signature'] === str_repeat(&quot;\x00&quot;, 16)) {&nbsp;</div></li><li><div>                $this-&gt;warning('FLAC STREAMINFO.audio_signature is null (known issue with libOggFLAC)');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $info['md5_data_source'] = '';&nbsp;</div></li><li><div>                $md5 = $info['flac']['STREAMINFO']['audio_signature'];&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; strlen($md5); $i++) {&nbsp;</div></li><li><div>                    $info['md5_data_source'] .= str_pad(dechex(ord($md5[$i])), 2, '00', STR_PAD_LEFT);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!preg_match('/^[0-9a-f]{32}$/', $info['md5_data_source'])) {&nbsp;</div></li><li><div>                    unset($info['md5_data_source']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($info['flac']['STREAMINFO']['bits_per_sample'])) {&nbsp;</div></li><li><div>            $info['audio']['bits_per_sample'] = $info['flac']['STREAMINFO']['bits_per_sample'];&nbsp;</div></li><li><div>            if ($info['audio']['bits_per_sample'] == 8) {&nbsp;</div></li><li><div>                // special case&nbsp;</div></li><li><div>                // must invert sign bit on all data bytes before MD5'ing to match FLAC's calculated value&nbsp;</div></li><li><div>                // MD5sum calculates on unsigned bytes, but FLAC calculated MD5 on 8-bit audio data as signed&nbsp;</div></li><li><div>                $this-&gt;warning('FLAC calculates MD5 data strangely on 8-bit audio, so the stored md5_data_source value will not match the decoded WAV file');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function parseSTREAMINFO($BlockData) {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info['flac']['STREAMINFO'] = array();&nbsp;</div></li><li><div>        $streaminfo = &$info['flac']['STREAMINFO'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $streaminfo['min_block_size'] = getid3_lib::BigEndian2Int(substr($BlockData, 0, 2));&nbsp;</div></li><li><div>        $streaminfo['max_block_size'] = getid3_lib::BigEndian2Int(substr($BlockData, 2, 2));&nbsp;</div></li><li><div>        $streaminfo['min_frame_size'] = getid3_lib::BigEndian2Int(substr($BlockData, 4, 3));&nbsp;</div></li><li><div>        $streaminfo['max_frame_size'] = getid3_lib::BigEndian2Int(substr($BlockData, 7, 3));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $SRCSBSS = getid3_lib::BigEndian2Bin(substr($BlockData, 10, 8));&nbsp;</div></li><li><div>        $streaminfo['sample_rate'] = getid3_lib::Bin2Dec(substr($SRCSBSS, 0, 20));&nbsp;</div></li><li><div>        $streaminfo['channels'] = getid3_lib::Bin2Dec(substr($SRCSBSS, 20, 3)) + 1;&nbsp;</div></li><li><div>        $streaminfo['bits_per_sample'] = getid3_lib::Bin2Dec(substr($SRCSBSS, 23, 5)) + 1;&nbsp;</div></li><li><div>        $streaminfo['samples_stream'] = getid3_lib::Bin2Dec(substr($SRCSBSS, 28, 36));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $streaminfo['audio_signature'] = substr($BlockData, 18, 16);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($streaminfo['sample_rate'])) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info['audio']['bitrate_mode'] = 'vbr';&nbsp;</div></li><li><div>            $info['audio']['sample_rate'] = $streaminfo['sample_rate'];&nbsp;</div></li><li><div>            $info['audio']['channels'] = $streaminfo['channels'];&nbsp;</div></li><li><div>            $info['audio']['bits_per_sample'] = $streaminfo['bits_per_sample'];&nbsp;</div></li><li><div>            $info['playtime_seconds'] = $streaminfo['samples_stream'] / $streaminfo['sample_rate'];&nbsp;</div></li><li><div>            if ($info['playtime_seconds'] &gt; 0) {&nbsp;</div></li><li><div>                if (!$this-&gt;isDependencyFor('matroska')) {&nbsp;</div></li><li><div>                    $info['audio']['bitrate'] = (($info['avdataend'] - $info['avdataoffset']) * 8) / $info['playtime_seconds'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $this-&gt;warning('Cannot determine audio bitrate because total stream size is unknown');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $this-&gt;error('Corrupt METAdata block: STREAMINFO');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function parseAPPLICATION($BlockData) {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ApplicationID = getid3_lib::BigEndian2Int(substr($BlockData, 0, 4));&nbsp;</div></li><li><div>        $info['flac']['APPLICATION'][$ApplicationID]['name'] = self::applicationIDLookup($ApplicationID);&nbsp;</div></li><li><div>        $info['flac']['APPLICATION'][$ApplicationID]['data'] = substr($BlockData, 4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function parseSEEKTABLE($BlockData) {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $offset = 0;&nbsp;</div></li><li><div>        $BlockLength = strlen($BlockData);&nbsp;</div></li><li><div>        $placeholderpattern = str_repeat(&quot;\xFF&quot;, 8);&nbsp;</div></li><li><div>        while ($offset &lt; $BlockLength) {&nbsp;</div></li><li><div>            $SampleNumberString = substr($BlockData, $offset, 8);&nbsp;</div></li><li><div>            $offset += 8;&nbsp;</div></li><li><div>            if ($SampleNumberString == $placeholderpattern) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // placeholder point&nbsp;</div></li><li><div>                getid3_lib::safe_inc($info['flac']['SEEKTABLE']['placeholders'], 1);&nbsp;</div></li><li><div>                $offset += 10;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $SampleNumber = getid3_lib::BigEndian2Int($SampleNumberString);&nbsp;</div></li><li><div>                $info['flac']['SEEKTABLE'][$SampleNumber]['offset'] = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 8));&nbsp;</div></li><li><div>                $offset += 8;&nbsp;</div></li><li><div>                $info['flac']['SEEKTABLE'][$SampleNumber]['samples'] = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 2));&nbsp;</div></li><li><div>                $offset += 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function parseVORBIS_COMMENT($BlockData) {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $getid3_ogg = new getid3_ogg($this-&gt;getid3);&nbsp;</div></li><li><div>        if ($this-&gt;isDependencyFor('matroska')) {&nbsp;</div></li><li><div>            $getid3_ogg-&gt;setStringMode($this-&gt;data_string);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $getid3_ogg-&gt;ParseVorbisComments();&nbsp;</div></li><li><div>        if (isset($info['ogg'])) {&nbsp;</div></li><li><div>            unset($info['ogg']['comments_raw']);&nbsp;</div></li><li><div>            $info['flac']['VORBIS_COMMENT'] = $info['ogg'];&nbsp;</div></li><li><div>            unset($info['ogg']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset($getid3_ogg);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function parseCUESHEET($BlockData) {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>        $offset = 0;&nbsp;</div></li><li><div>        $info['flac']['CUESHEET']['media_catalog_number'] =                              trim(substr($BlockData, $offset, 128), &quot;\0&quot;);&nbsp;</div></li><li><div>        $offset += 128;&nbsp;</div></li><li><div>        $info['flac']['CUESHEET']['lead_in_samples'] =         getid3_lib::BigEndian2Int(substr($BlockData, $offset, 8));&nbsp;</div></li><li><div>        $offset += 8;&nbsp;</div></li><li><div>        $info['flac']['CUESHEET']['flags']['is_cd'] = (bool) (getid3_lib::BigEndian2Int(substr($BlockData, $offset, 1)) & 0x80);&nbsp;</div></li><li><div>        $offset += 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $offset += 258; // reserved&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info['flac']['CUESHEET']['number_tracks'] =         getid3_lib::BigEndian2Int(substr($BlockData, $offset, 1));&nbsp;</div></li><li><div>        $offset += 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ($track = 0; $track &lt; $info['flac']['CUESHEET']['number_tracks']; $track++) {&nbsp;</div></li><li><div>            $TrackSampleOffset = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 8));&nbsp;</div></li><li><div>            $offset += 8;&nbsp;</div></li><li><div>            $TrackNumber = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 1));&nbsp;</div></li><li><div>            $offset += 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info['flac']['CUESHEET']['tracks'][$TrackNumber]['sample_offset'] = $TrackSampleOffset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info['flac']['CUESHEET']['tracks'][$TrackNumber]['isrc'] =                           substr($BlockData, $offset, 12);&nbsp;</div></li><li><div>            $offset += 12;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $TrackFlagsRaw = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 1));&nbsp;</div></li><li><div>            $offset += 1;&nbsp;</div></li><li><div>            $info['flac']['CUESHEET']['tracks'][$TrackNumber]['flags']['is_audio'] = (bool) ($TrackFlagsRaw & 0x80);&nbsp;</div></li><li><div>            $info['flac']['CUESHEET']['tracks'][$TrackNumber]['flags']['pre_emphasis'] = (bool) ($TrackFlagsRaw & 0x40);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $offset += 13; // reserved&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info['flac']['CUESHEET']['tracks'][$TrackNumber]['index_points'] = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 1));&nbsp;</div></li><li><div>            $offset += 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            for ($index = 0; $index &lt; $info['flac']['CUESHEET']['tracks'][$TrackNumber]['index_points']; $index++) {&nbsp;</div></li><li><div>                $IndexSampleOffset = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 8));&nbsp;</div></li><li><div>                $offset += 8;&nbsp;</div></li><li><div>                $IndexNumber = getid3_lib::BigEndian2Int(substr($BlockData, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $offset += 3; // reserved&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info['flac']['CUESHEET']['tracks'][$TrackNumber]['indexes'][$IndexNumber] = $IndexSampleOffset;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    * Parse METADATA_BLOCK_PICTURE flac structure and extract attachment&nbsp;</div></li><li><div>    * External usage: audio.ogg&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    public function parsePICTURE() {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $picture['typeid'] = getid3_lib::BigEndian2Int($this-&gt;fread(4));&nbsp;</div></li><li><div>        $picture['picturetype'] = self::pictureTypeLookup($picture['typeid']);&nbsp;</div></li><li><div>        $picture['image_mime'] = $this-&gt;fread(getid3_lib::BigEndian2Int($this-&gt;fread(4)));&nbsp;</div></li><li><div>        $descr_length = getid3_lib::BigEndian2Int($this-&gt;fread(4));&nbsp;</div></li><li><div>        if ($descr_length) {&nbsp;</div></li><li><div>            $picture['description'] = $this-&gt;fread($descr_length);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $picture['image_width'] = getid3_lib::BigEndian2Int($this-&gt;fread(4));&nbsp;</div></li><li><div>        $picture['image_height'] = getid3_lib::BigEndian2Int($this-&gt;fread(4));&nbsp;</div></li><li><div>        $picture['color_depth'] = getid3_lib::BigEndian2Int($this-&gt;fread(4));&nbsp;</div></li><li><div>        $picture['colors_indexed'] = getid3_lib::BigEndian2Int($this-&gt;fread(4));&nbsp;</div></li><li><div>        $picture['datalength'] = getid3_lib::BigEndian2Int($this-&gt;fread(4));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($picture['image_mime'] == '--&gt;') {&nbsp;</div></li><li><div>            $picture['data'] = $this-&gt;fread($picture['datalength']);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $picture['data'] = $this-&gt;saveAttachment(&nbsp;</div></li><li><div>                str_replace('/', '_', $picture['picturetype']).'_'.$this-&gt;ftell(), &nbsp;</div></li><li><div>                $this-&gt;ftell(), &nbsp;</div></li><li><div>                $picture['datalength'], &nbsp;</div></li><li><div>                $picture['image_mime']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info['flac']['PICTURE'][] = $picture;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function metaBlockTypeLookup($blocktype) {&nbsp;</div></li><li><div>        static $lookup = array(&nbsp;</div></li><li><div>            0 =&gt; 'STREAMINFO', &nbsp;</div></li><li><div>            1 =&gt; 'PADDING', &nbsp;</div></li><li><div>            2 =&gt; 'APPLICATION', &nbsp;</div></li><li><div>            3 =&gt; 'SEEKTABLE', &nbsp;</div></li><li><div>            4 =&gt; 'VORBIS_COMMENT', &nbsp;</div></li><li><div>            5 =&gt; 'CUESHEET', &nbsp;</div></li><li><div>            6 =&gt; 'PICTURE', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return (isset($lookup[$blocktype]) ? $lookup[$blocktype] : 'reserved');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function applicationIDLookup($applicationid) {&nbsp;</div></li><li><div>        // http://flac.sourceforge.net/id.html&nbsp;</div></li><li><div>        static $lookup = array(&nbsp;</div></li><li><div>            0x41544348 =&gt; 'FlacFile', // &quot;ATCH&quot;&nbsp;</div></li><li><div>            0x42534F4C =&gt; 'beSolo', // &quot;BSOL&quot;&nbsp;</div></li><li><div>            0x42554753 =&gt; 'Bugs Player', // &quot;BUGS&quot;&nbsp;</div></li><li><div>            0x43756573 =&gt; 'GoldWave cue points (specification)', // &quot;Cues&quot;&nbsp;</div></li><li><div>            0x46696361 =&gt; 'CUE Splitter', // &quot;Fica&quot;&nbsp;</div></li><li><div>            0x46746F6C =&gt; 'flac-tools', // &quot;Ftol&quot;&nbsp;</div></li><li><div>            0x4D4F5442 =&gt; 'MOTB MetaCzar', // &quot;MOTB&quot;&nbsp;</div></li><li><div>            0x4D505345 =&gt; 'MP3 Stream Editor', // &quot;MPSE&quot;&nbsp;</div></li><li><div>            0x4D754D4C =&gt; 'MusicML: Music Metadata Language', // &quot;MuML&quot;&nbsp;</div></li><li><div>            0x52494646 =&gt; 'Sound Devices RIFF chunk storage', // &quot;RIFF&quot;&nbsp;</div></li><li><div>            0x5346464C =&gt; 'Sound Font FLAC', // &quot;SFFL&quot;&nbsp;</div></li><li><div>            0x534F4E59 =&gt; 'Sony Creative Software', // &quot;SONY&quot;&nbsp;</div></li><li><div>            0x5351455A =&gt; 'flacsqueeze', // &quot;SQEZ&quot;&nbsp;</div></li><li><div>            0x54745776 =&gt; 'TwistedWave', // &quot;TtWv&quot;&nbsp;</div></li><li><div>            0x55495453 =&gt; 'UITS Embedding tools', // &quot;UITS&quot;&nbsp;</div></li><li><div>            0x61696666 =&gt; 'FLAC AIFF chunk storage', // &quot;aiff&quot;&nbsp;</div></li><li><div>            0x696D6167 =&gt; 'flac-image application for storing arbitrary files in APPLICATION metadata blocks', // &quot;imag&quot;&nbsp;</div></li><li><div>            0x7065656D =&gt; 'Parseable Embedded Extensible Metadata (specification)', // &quot;peem&quot;&nbsp;</div></li><li><div>            0x71667374 =&gt; 'QFLAC Studio', // &quot;qfst&quot;&nbsp;</div></li><li><div>            0x72696666 =&gt; 'FLAC RIFF chunk storage', // &quot;riff&quot;&nbsp;</div></li><li><div>            0x74756E65 =&gt; 'TagTuner', // &quot;tune&quot;&nbsp;</div></li><li><div>            0x78626174 =&gt; 'XBAT', // &quot;xbat&quot;&nbsp;</div></li><li><div>            0x786D6364 =&gt; 'xmcd', // &quot;xmcd&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return (isset($lookup[$applicationid]) ? $lookup[$applicationid] : 'reserved');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function pictureTypeLookup($type_id) {&nbsp;</div></li><li><div>        static $lookup = array (&nbsp;</div></li><li><div>             0 =&gt; 'Other', &nbsp;</div></li><li><div>             1 =&gt; '32x32 pixels \'file icon\' (PNG only)', &nbsp;</div></li><li><div>             2 =&gt; 'Other file icon', &nbsp;</div></li><li><div>             3 =&gt; 'Cover (front)', &nbsp;</div></li><li><div>             4 =&gt; 'Cover (back)', &nbsp;</div></li><li><div>             5 =&gt; 'Leaflet page', &nbsp;</div></li><li><div>             6 =&gt; 'Media (e.g. label side of CD)', &nbsp;</div></li><li><div>             7 =&gt; 'Lead artist/lead performer/soloist', &nbsp;</div></li><li><div>             8 =&gt; 'Artist/performer', &nbsp;</div></li><li><div>             9 =&gt; 'Conductor', &nbsp;</div></li><li><div>            10 =&gt; 'Band/Orchestra', &nbsp;</div></li><li><div>            11 =&gt; 'Composer', &nbsp;</div></li><li><div>            12 =&gt; 'Lyricist/text writer', &nbsp;</div></li><li><div>            13 =&gt; 'Recording Location', &nbsp;</div></li><li><div>            14 =&gt; 'During recording', &nbsp;</div></li><li><div>            15 =&gt; 'During performance', &nbsp;</div></li><li><div>            16 =&gt; 'Movie/video screen capture', &nbsp;</div></li><li><div>            17 =&gt; 'A bright coloured fish', &nbsp;</div></li><li><div>            18 =&gt; 'Illustration', &nbsp;</div></li><li><div>            19 =&gt; 'Band/artist logotype', &nbsp;</div></li><li><div>            20 =&gt; 'Publisher/Studio logotype', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return (isset($lookup[$type_id]) ? $lookup[$type_id] : 'reserved');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.7</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/getid3_flac/" class="active">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/getid3_flac/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/getid3_flac/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/getid3_flac/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/getid3_flac/" class="">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>getid3_flac</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>