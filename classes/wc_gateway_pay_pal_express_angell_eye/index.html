<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-id="81214"><head xmlns="http://www.w3.org/1999/xhtml"><title> wc_gateway_paypal_express_angelleye | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WC_Gateway_PayPal_Express_AngellEYE, class, plugin, paypal-for-woocommerce, 1.4.3" /><meta name="description" content="The WordPress Core WC Gateway PayPal Express AngellEYE class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=61568584303a83b5d6e01720ea577c42' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wc_gateway_pay_pal_express_angell_eye/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwc_gateway_pay_pal_express_angell_eye%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwc_gateway_pay_pal_express_angell_eye%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-1.4.3-class-wc_gateway_pay_pal_express_angell_eye","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wc_gateway_pay_pal_express_angell_eye" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to paypal-for-woocommerce." href="http://hookr.io/plugins/paypal-for-woocommerce/" class="plugin"><span property="name">paypal-for-woocommerce</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.4.3." href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/" class="H_VERSION"><span property="name">1.4.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wc_gateway_pay_pal_express_an&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="0"><a href="http://hookr.io/1.4.3/all/" title="All">All <span class="count badge">0</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/1.4.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/1.4.3/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/1.4.3/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/1.4.3/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="0"><a href="http://hookr.io/1.4.3/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/1.4.3/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="0"><a href="http://hookr.io/1.4.3/functions/" title="Functions">Functions <span class="count badge">0</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/1.4.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WC_Gateway_PayPal_Express_AngellEYE</strong></h1><p>The WordPress Core <strong>WC Gateway PayPal Express AngellEYE</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/files/classes-wc-gateway-paypal-express-angelleye/" class="file">/classes/wc-gateway-paypal-express-angelleye.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="6" class="block" start="6"><li><div>class WC_Gateway_PayPal_Express_AngellEYE extends WC_Payment_Gateway {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public $function_helper;&nbsp;</div></li><li><div>    public static $log_enabled = false;&nbsp;</div></li><li><div>    public static $log = false;&nbsp;</div></li><li><div>    public $checkout_fields;&nbsp;</div></li><li><div>    public $posted;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function __construct() {&nbsp;</div></li><li><div>        $this-&gt;id = 'paypal_express';&nbsp;</div></li><li><div>        $this-&gt;method_title = __('PayPal Express Checkout ', 'paypal-for-woocommerce');&nbsp;</div></li><li><div>        $this-&gt;method_description = __('PayPal Express Checkout is designed to make the checkout experience for buyers using PayPal much more quick and easy than filling out billing and shipping forms.  Customers will be taken directly to PayPal to sign in and authorize the payment, and are then returned back to your store to choose a shipping method, review the final order total, and complete the payment.', 'paypal-for-woocommerce');&nbsp;</div></li><li><div>        $this-&gt;has_fields = false;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $this-&gt;supports = array(&nbsp;</div></li><li><div>            'products', &nbsp;</div></li><li><div>            'refunds'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        if (substr(get_option(&quot;woocommerce_default_country&quot;), 0, 2) == 'US' || substr(get_option(&quot;woocommerce_default_country&quot;), 0, 2) == 'GB') {&nbsp;</div></li><li><div>            $this-&gt;is_us_or_uk = true;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;is_us_or_uk = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;init_form_fields();&nbsp;</div></li><li><div>        $this-&gt;init_settings();&nbsp;</div></li><li><div>        $this-&gt;enable_tokenized_payments = $this-&gt;get_option('enable_tokenized_payments', 'no');&nbsp;</div></li><li><div>        if ($this-&gt;enable_tokenized_payments == 'yes') {&nbsp;</div></li><li><div>            $this-&gt;supports = array(&nbsp;</div></li><li><div>                'subscriptions', &nbsp;</div></li><li><div>                'products', &nbsp;</div></li><li><div>                'refunds', &nbsp;</div></li><li><div>                'subscription_cancellation', &nbsp;</div></li><li><div>                'subscription_reactivation', &nbsp;</div></li><li><div>                'subscription_suspension', &nbsp;</div></li><li><div>                'subscription_amount_changes', &nbsp;</div></li><li><div>                'subscription_payment_method_change', // Subs 1.n compatibility.&nbsp;</div></li><li><div>                'subscription_payment_method_change_customer', &nbsp;</div></li><li><div>                'subscription_payment_method_change_admin', &nbsp;</div></li><li><div>                'subscription_date_changes', &nbsp;</div></li><li><div>                'multiple_subscriptions', &nbsp;</div></li><li><div>                'add_payment_method', &nbsp;</div></li><li><div>                'tokenization'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;enabled = $this-&gt;get_option('enabled');&nbsp;</div></li><li><div>        $this-&gt;title = $this-&gt;get_option('title');&nbsp;</div></li><li><div>        $this-&gt;description = $this-&gt;get_option('description');&nbsp;</div></li><li><div>        $this-&gt;prevent_to_add_additional_item = 'yes' === $this-&gt;get_option('prevent_to_add_additional_item', 'no');&nbsp;</div></li><li><div>        $this-&gt;testmode = 'yes' === $this-&gt;get_option('testmode', 'yes');&nbsp;</div></li><li><div>        if ($this-&gt;testmode == false) {&nbsp;</div></li><li><div>            $this-&gt;testmode = AngellEYE_Utility::angelleye_paypal_for_woocommerce_is_set_sandbox_product();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;debug = 'yes' === $this-&gt;get_option('debug', 'no');&nbsp;</div></li><li><div>        $this-&gt;save_abandoned_checkout = 'yes' === $this-&gt;get_option('save_abandoned_checkout', 'no');&nbsp;</div></li><li><div>        self::$log_enabled = $this-&gt;debug;&nbsp;</div></li><li><div>        $this-&gt;error_email_notify = 'yes' === $this-&gt;get_option('error_email_notify', 'no');&nbsp;</div></li><li><div>        $this-&gt;show_on_checkout = $this-&gt;get_option('show_on_checkout', 'top');&nbsp;</div></li><li><div>        $this-&gt;paypal_account_optional = $this-&gt;get_option('paypal_account_optional', 'no');&nbsp;</div></li><li><div>        $this-&gt;error_display_type = $this-&gt;get_option('error_display_type', 'detailed');&nbsp;</div></li><li><div>        $this-&gt;landing_page = $this-&gt;get_option('landing_page', 'login');&nbsp;</div></li><li><div>        $this-&gt;checkout_logo = $this-&gt;get_option('checkout_logo', '');&nbsp;</div></li><li><div>        $this-&gt;checkout_logo_hdrimg = $this-&gt;get_option('checkout_logo_hdrimg', '');&nbsp;</div></li><li><div>        $this-&gt;show_paypal_credit = $this-&gt;get_option('show_paypal_credit', 'yes');&nbsp;</div></li><li><div>        $this-&gt;brand_name = $this-&gt;get_option('brand_name', get_bloginfo('name'));&nbsp;</div></li><li><div>        $this-&gt;customer_service_number = $this-&gt;get_option('customer_service_number', '');&nbsp;</div></li><li><div>        $this-&gt;use_wp_locale_code = $this-&gt;get_option('use_wp_locale_code', 'yes');&nbsp;</div></li><li><div>        $this-&gt;angelleye_skip_text = $this-&gt;get_option('angelleye_skip_text', 'Skip the forms and pay faster with PayPal!');&nbsp;</div></li><li><div>        $this-&gt;skip_final_review = $this-&gt;get_option('skip_final_review', 'no');&nbsp;</div></li><li><div>        $this-&gt;disable_term = $this-&gt;get_option('disable_term', 'no');&nbsp;</div></li><li><div>        $this-&gt;payment_action = $this-&gt;get_option('payment_action', 'Sale');&nbsp;</div></li><li><div>        $this-&gt;billing_address = 'yes' === $this-&gt;get_option('billing_address', 'no');&nbsp;</div></li><li><div>        $this-&gt;send_items = 'yes' === $this-&gt;get_option('send_items', 'yes');&nbsp;</div></li><li><div>        $this-&gt;order_cancellations = $this-&gt;get_option('order_cancellations', 'disabled');&nbsp;</div></li><li><div>        $this-&gt;email_notify_order_cancellations = 'yes' === $this-&gt;get_option('email_notify_order_cancellations', 'no');&nbsp;</div></li><li><div>        $this-&gt;customer_id = get_current_user_id();&nbsp;</div></li><li><div>        $this-&gt;enable_notifyurl = $this-&gt;get_option('enable_notifyurl', 'no');&nbsp;</div></li><li><div>        $this-&gt;notifyurl = '';&nbsp;</div></li><li><div>        $this-&gt;is_encrypt = $this-&gt;get_option('is_encrypt', 'no');&nbsp;</div></li><li><div>        $this-&gt;cancel_page_id = $this-&gt;get_option('cancel_page', '');&nbsp;</div></li><li><div>        $this-&gt;fraud_management_filters = $this-&gt;get_option('fraud_management_filters', 'place_order_on_hold_for_further_review');&nbsp;</div></li><li><div>        $this-&gt;invoice_id_prefix = $this-&gt;get_option('invoice_id_prefix', 'WC-EC');&nbsp;</div></li><li><div>        if ($this-&gt;enable_notifyurl == 'yes') {&nbsp;</div></li><li><div>            $this-&gt;notifyurl = $this-&gt;get_option('notifyurl');&nbsp;</div></li><li><div>            if (isset($this-&gt;notifyurl) && !empty($this-&gt;notifyurl)) {&nbsp;</div></li><li><div>                $this-&gt;notifyurl = str_replace('&amp;', '&', $this-&gt;notifyurl);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($this-&gt;is_us_or_uk == false) {&nbsp;</div></li><li><div>            $this-&gt;show_paypal_credit = 'no';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($this-&gt;testmode == true) {&nbsp;</div></li><li><div>            $this-&gt;API_Endpoint = &quot;https://api-3t.sandbox.paypal.com/nvp&quot;;&nbsp;</div></li><li><div>            $this-&gt;PAYPAL_URL = &quot;https://www.sandbox.paypal.com/webscr?cmd=_express-checkout&token=&quot;;&nbsp;</div></li><li><div>            $this-&gt;api_username = $this-&gt;get_option('sandbox_api_username');&nbsp;</div></li><li><div>            $this-&gt;api_password = $this-&gt;get_option('sandbox_api_password');&nbsp;</div></li><li><div>            $this-&gt;api_signature = $this-&gt;get_option('sandbox_api_signature');&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;API_Endpoint = &quot;https://api-3t.paypal.com/nvp&quot;;&nbsp;</div></li><li><div>            $this-&gt;PAYPAL_URL = &quot;https://www.paypal.com/cgi-bin/webscr?cmd=_express-checkout&token=&quot;;&nbsp;</div></li><li><div>            $this-&gt;api_username = $this-&gt;get_option('api_username');&nbsp;</div></li><li><div>            $this-&gt;api_password = $this-&gt;get_option('api_password');&nbsp;</div></li><li><div>            $this-&gt;api_signature = $this-&gt;get_option('api_signature');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;button_position = $this-&gt;get_option('button_position', 'bottom');&nbsp;</div></li><li><div>        $this-&gt;show_on_cart = $this-&gt;get_option('show_on_cart', 'yes');&nbsp;</div></li><li><div>        $this-&gt;checkout_with_pp_button_type = $this-&gt;get_option('checkout_with_pp_button_type', 'paypalimage');&nbsp;</div></li><li><div>        $this-&gt;pp_button_type_text_button = $this-&gt;get_option('pp_button_type_text_button', 'Proceed to Checkout');&nbsp;</div></li><li><div>        $this-&gt;pp_button_type_my_custom = $this-&gt;get_option('pp_button_type_my_custom', self::angelleye_get_paypalimage());&nbsp;</div></li><li><div>        $this-&gt;softdescriptor = $this-&gt;get_option('softdescriptor', '');&nbsp;</div></li><li><div>        $this-&gt;version = &quot;64&quot;;&nbsp;</div></li><li><div>        $this-&gt;Force_tls_one_point_two = get_option('Force_tls_one_point_two', 'no');&nbsp;</div></li><li><div>        $this-&gt;page_style = $this-&gt;get_option('page_style', '');&nbsp;</div></li><li><div>        add_action('woocommerce_update_options_payment_gateways_' . $this-&gt;id, array($this, 'process_admin_options'));&nbsp;</div></li><li><div>        add_filter('woocommerce_settings_api_sanitized_fields_' . $this-&gt;id, array($this, 'angelleye_express_checkout_encrypt_gateway_api'), 10, 1);&nbsp;</div></li><li><div>        if (!has_action('woocommerce_api_' . strtolower('WC_Gateway_PayPal_Express_AngellEYE'))) {&nbsp;</div></li><li><div>            add_action('woocommerce_api_' . strtolower('WC_Gateway_PayPal_Express_AngellEYE'), array($this, 'handle_wc_api'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!class_exists('WC_Gateway_PayPal_Express_Function_AngellEYE')) {&nbsp;</div></li><li><div>            require_once( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/angelleye-includes/express-checkout/class-wc-gateway-paypal-express-function-angelleye.php' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;function_helper = new WC_Gateway_PayPal_Express_Function_AngellEYE();&nbsp;</div></li><li><div>        $this-&gt;order_button_text = ($this-&gt;function_helper-&gt;ec_is_express_checkout() == false) ?  __('Proceed to PayPal', 'paypal-for-woocommerce') :  __( 'Place order', 'paypal-for-woocommerce' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function admin_options() {&nbsp;</div></li><li><div>        $guest_checkout = get_option('woocommerce_enable_guest_checkout', 'yes');&nbsp;</div></li><li><div>        if (wc_get_page_id('terms') &gt; 0 && apply_filters('woocommerce_checkout_show_terms', true)) {&nbsp;</div></li><li><div>            if ($guest_checkout === 'yes') {&nbsp;</div></li><li><div>                $display_disable_terms = 'yes';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $display_disable_terms = 'no';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $display_disable_terms = 'no';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;h3&gt;&lt;?php _e('PayPal Express Checkout', 'paypal-for-woocommerce'); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>        &lt;p&gt;&lt;?php _e($this-&gt;method_description, 'paypal-for-woocommerce'); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>        &lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php $this-&gt;generate_settings_html(); ?&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>                var display_disable_terms = &quot;&lt;?php echo $display_disable_terms; ?&gt;&quot;;&nbsp;</div></li><li><div>        &lt;?php if ($guest_checkout === 'no') { ?&gt;&nbsp;</div></li><li><div>                    jQuery(&quot;#woocommerce_paypal_express_skip_final_review&quot;).prop(&quot;checked&quot;, false);&nbsp;</div></li><li><div>                    jQuery(&quot;#woocommerce_paypal_express_skip_final_review&quot;).attr(&quot;disabled&quot;, true);&nbsp;</div></li><li><div>        &lt;?php } ?&gt;&nbsp;</div></li><li><div>                jQuery('#woocommerce_paypal_express_skip_final_review').change(function () {&nbsp;</div></li><li><div>                    disable_term = jQuery('#woocommerce_paypal_express_disable_term').closest('tr');&nbsp;</div></li><li><div>                    if (jQuery(this).is(':checked')) {&nbsp;</div></li><li><div>                        if (display_disable_terms === 'yes') {&nbsp;</div></li><li><div>                            disable_term.show();&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            disable_term.hide();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        disable_term.hide();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }).change();&nbsp;</div></li><li><div>                jQuery('#woocommerce_paypal_express_disable_term').change(function () {&nbsp;</div></li><li><div>                    term_notice = jQuery('.terms_notice');&nbsp;</div></li><li><div>                    if (jQuery(this).is(':checked')) {&nbsp;</div></li><li><div>                        term_notice.hide();&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        term_notice.show();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }).change();&nbsp;</div></li><li><div>                jQuery('#woocommerce_paypal_express_testmode').change(function () {&nbsp;</div></li><li><div>                    sandbox = jQuery('#woocommerce_paypal_express_sandbox_api_username, #woocommerce_paypal_express_sandbox_api_password, #woocommerce_paypal_express_sandbox_api_signature').closest('tr'), &nbsp;</div></li><li><div>                            production = jQuery('#woocommerce_paypal_express_api_username, #woocommerce_paypal_express_api_password, #woocommerce_paypal_express_api_signature').closest('tr');&nbsp;</div></li><li><div>                    if (jQuery(this).is(':checked')) {&nbsp;</div></li><li><div>                        sandbox.show();&nbsp;</div></li><li><div>                        production.hide();&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        sandbox.hide();&nbsp;</div></li><li><div>                        production.show();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }).change();&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>        &lt;/table&gt; &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * get_icon function.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_icon() {&nbsp;</div></li><li><div>        $image_path = plugins_url('/assets/images/paypal.png', plugin_basename(dirname(__FILE__)));&nbsp;</div></li><li><div>        if ($this-&gt;show_paypal_credit == 'yes') {&nbsp;</div></li><li><div>            $image_path = plugins_url('/assets/images/paypal-credit-card-logos.png', plugin_basename(dirname(__FILE__)));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($this-&gt;checkout_with_pp_button_type == 'customimage') {&nbsp;</div></li><li><div>            $image_path = $this-&gt;pp_button_type_my_custom;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (is_ssl()) {&nbsp;</div></li><li><div>            $image_path = preg_replace(&quot;/^http:/i&quot;, &quot;https:&quot;, $image_path);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $icon = &quot;&lt;img src=\&quot;$image_path\&quot; alt='&quot; . __('Pay with PayPal', 'paypal-for-woocommerce') . &quot;'/&gt;&quot;;&nbsp;</div></li><li><div>        return apply_filters('woocommerce_paypal_express_icon', $icon, $this-&gt;id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function init_form_fields() {&nbsp;</div></li><li><div>        $require_ssl = '';&nbsp;</div></li><li><div>        if (!AngellEYE_Gateway_Paypal::is_ssl()) {&nbsp;</div></li><li><div>            $require_ssl = __('This image requires an SSL host.  Please upload your image to &lt;a target=&quot;_blank&quot; href=&quot;http://www.sslpic.com&quot;&gt;www.sslpic.com&lt;/a&gt; and enter the image URL here.', 'paypal-for-woocommerce');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $skip_final_review_option_not_allowed_guest_checkout = '';&nbsp;</div></li><li><div>        $skip_final_review_option_not_allowed_terms = '';&nbsp;</div></li><li><div>        $skip_final_review_option_not_allowed_tokenized_payments = '';&nbsp;</div></li><li><div>        $woocommerce_enable_guest_checkout = get_option('woocommerce_enable_guest_checkout');&nbsp;</div></li><li><div>        if (isset($woocommerce_enable_guest_checkout) && ( $woocommerce_enable_guest_checkout === &quot;no&quot; )) {&nbsp;</div></li><li><div>            $skip_final_review_option_not_allowed_guest_checkout = ' (The WooCommerce guest checkout option is disabled.  Therefore, the review page is required for login / account creation, and this option will be overridden.)';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (wc_get_page_id('terms') &gt; 0 && apply_filters('woocommerce_checkout_show_terms', true)) {&nbsp;</div></li><li><div>            $skip_final_review_option_not_allowed_terms = ' (You currently have a Terms &amp; Conditions page set, which requires the review page, and will override this option.)';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;enable_tokenized_payments = $this-&gt;get_option('enable_tokenized_payments', 'no');&nbsp;</div></li><li><div>        if ($this-&gt;enable_tokenized_payments == 'yes') {&nbsp;</div></li><li><div>            $skip_final_review_option_not_allowed_tokenized_payments = ' (Payments tokens are enabled, which require the review page, and that will override this option.)';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>            'sort_order' =&gt; 'ASC', &nbsp;</div></li><li><div>            'sort_column' =&gt; 'post_title', &nbsp;</div></li><li><div>            'hierarchical' =&gt; 1, &nbsp;</div></li><li><div>            'exclude' =&gt; '', &nbsp;</div></li><li><div>            'include' =&gt; '', &nbsp;</div></li><li><div>            'meta_key' =&gt; '', &nbsp;</div></li><li><div>            'meta_value' =&gt; '', &nbsp;</div></li><li><div>            'authors' =&gt; '', &nbsp;</div></li><li><div>            'child_of' =&gt; 0, &nbsp;</div></li><li><div>            'parent' =&gt; -1, &nbsp;</div></li><li><div>            'exclude_tree' =&gt; '', &nbsp;</div></li><li><div>            'number' =&gt; '', &nbsp;</div></li><li><div>            'offset' =&gt; 0, &nbsp;</div></li><li><div>            'post_type' =&gt; 'page', &nbsp;</div></li><li><div>            'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $pages = get_pages($args);&nbsp;</div></li><li><div>        $cancel_page = array();&nbsp;</div></li><li><div>        foreach ($pages as $p) {&nbsp;</div></li><li><div>            $cancel_page[$p-&gt;ID] = $p-&gt;post_title;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;form_fields = array(&nbsp;</div></li><li><div>            'enabled' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Enable/Disable', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Enable PayPal Express', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'default' =&gt; 'no'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'title' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Title', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('This controls the title which the user sees during checkout.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; __('PayPal Express', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'description' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Description', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'textarea', &nbsp;</div></li><li><div>                'description' =&gt; __('This controls the description which the user sees during checkout.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; __(&quot;Pay via PayPal; you can pay with your credit card if you don't have a PayPal account&quot;, 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'testmode' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('PayPal Sandbox', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; __('Enable PayPal Sandbox', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'yes', &nbsp;</div></li><li><div>                'description' =&gt; __('The sandbox is PayPal\'s test environment and is only for use with sandbox accounts created within your &lt;a href=&quot;http://developer.paypal.com&quot; target=&quot;_blank&quot;&gt;PayPal developer account&lt;/a&gt;.', 'paypal-for-woocommerce')&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'sandbox_api_username' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Sandbox API User Name', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('Create sandbox accounts and obtain API credentials from within your &lt;a href=&quot;http://developer.paypal.com&quot;&gt;PayPal developer account&lt;/a&gt;.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'sandbox_api_password' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Sandbox API Password', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'password', &nbsp;</div></li><li><div>                'default' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'sandbox_api_signature' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Sandbox API Signature', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'password', &nbsp;</div></li><li><div>                'default' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'api_username' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Live API User Name', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('Get your live account API credentials from your PayPal account profile under the API Access section &lt;br /&gt;or by using &lt;a target=&quot;_blank&quot; href=&quot;https://www.paypal.com/us/cgi-bin/webscr?cmd=_login-api-run&quot;&gt;this tool&lt;/a&gt;.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'api_password' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Live API Password', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'password', &nbsp;</div></li><li><div>                'default' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'api_signature' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Live API Signature', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'password', &nbsp;</div></li><li><div>                'default' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'error_email_notify' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Error Email Notifications', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; __('Enable admin email notifications for errors.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'yes', &nbsp;</div></li><li><div>                'description' =&gt; __('This will send a detailed error email to the WordPress site administrator if a PayPal API error occurs.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'invoice_id_prefix' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Invoice ID Prefix', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('Add a prefix to the invoice ID sent to PayPal. This can resolve duplicate invoice problems when working with multiple websites on the same PayPal account.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div>                'default' =&gt; 'WC-EC'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'checkout_with_pp_button_type' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Checkout Button Type', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'label' =&gt; __('Use Checkout with PayPal image button', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'class' =&gt; 'checkout_with_pp_button_type', &nbsp;</div></li><li><div>                'options' =&gt; array(&nbsp;</div></li><li><div>                    'paypalimage' =&gt; __('PayPal Image', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'textbutton' =&gt; __('Text Button', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'customimage' =&gt; __('Custom Image', 'paypal-for-woocommerce')&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; 'paypalimage', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'pp_button_type_my_custom' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Select Image', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'label' =&gt; __('Use Checkout with PayPal image button', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'class' =&gt; 'pp_button_type_my_custom, button_upload', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'pp_button_type_text_button' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Custom Text', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'class' =&gt; 'pp_button_type_text_button', &nbsp;</div></li><li><div>                'default' =&gt; 'Proceed to Checkout', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'show_on_cart' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Cart Page', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Show Express Checkout button on shopping cart page.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'yes'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'button_position' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Cart Button Position', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Where to display PayPal Express Checkout button(s).', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'description' =&gt; __('Set where to display the PayPal Express Checkout button(s).'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'options' =&gt; array(&nbsp;</div></li><li><div>                    'top' =&gt; 'At the top, above the shopping cart details.', &nbsp;</div></li><li><div>                    'bottom' =&gt; 'At the bottom, below the shopping cart details.', &nbsp;</div></li><li><div>                    'both' =&gt; 'Both at the top and bottom, above and below the shopping cart details.'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; 'bottom', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'show_on_checkout' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Checkout Page Display', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'options' =&gt; array(&nbsp;</div></li><li><div>                    'no' =&gt; __(&quot;Do not display on checkout page.&quot;, 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'top' =&gt; __('Display at the top of the checkout page.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'regular' =&gt; __('Display in general list of enabled gatways on checkout page.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'both' =&gt; __('Display both at the top and in the general list of gateways on the checkout page.')), &nbsp;</div></li><li><div>                'default' =&gt; 'top', &nbsp;</div></li><li><div>                'description' =&gt; __('Displaying the checkout button at the top of the checkout page will allow users to skip filling out the forms and can potentially increase conversion rates.'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'show_on_product_page' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Product Page', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; __('Show the Express Checkout button on product detail pages.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'description' =&gt; __('Allows customers to checkout using PayPal directly from a product page.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'paypal_account_optional' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('PayPal Account Optional', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; __('Allow customers to checkout without a PayPal account using their credit card.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'description' =&gt; __('PayPal Account Optional must be turned on in your PayPal account profile under Website Preferences.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'landing_page' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Landing Page', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'description' =&gt; __('Type of PayPal page to display as default. PayPal Account Optional must be checked for this option to be used.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'options' =&gt; array('login' =&gt; __('Login', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'billing' =&gt; __('Billing', 'paypal-for-woocommerce')), &nbsp;</div></li><li><div>                'default' =&gt; 'login', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'error_display_type' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Error Display Type', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'label' =&gt; __('Display detailed or generic errors', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'class' =&gt; 'error_display_type_option', &nbsp;</div></li><li><div>                'options' =&gt; array(&nbsp;</div></li><li><div>                    'detailed' =&gt; __('Detailed', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'generic' =&gt; __('Generic', 'paypal-for-woocommerce')&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'description' =&gt; __('Detailed displays actual errors returned from PayPal.  Generic displays general errors that do not reveal details and helps to prevent fraudulant activity on your site.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'detailed', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'show_paypal_credit' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Enable PayPal Credit', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; __('Show the PayPal Credit button next to the Express Checkout button.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'yes', &nbsp;</div></li><li><div>                'description' =&gt; ($this-&gt;is_us_or_uk == false) ? __('Currently disabled because PayPal Credit is only available for U.S. and U.K merchants.', 'paypal-for-woocommerce') : &quot;&quot;, &nbsp;</div></li><li><div>                'desc_tip' =&gt; ($this-&gt;is_us_or_uk) ? true : false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'use_wp_locale_code' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Use WordPress Locale Code', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; __('Pass the WordPress Locale Code setting to PayPal in order to display localized PayPal pages to buyers.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'yes'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'page_style' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Page Style', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('If you wish to use a &lt;a target=&quot;_blank&quot; href=&quot;https://www.paypal.com/customize&quot;&gt;custom page style configured in your PayPal account&lt;/a&gt;, enter the name of the page style here.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'brand_name' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Brand Name', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('This controls what users see as the brand / company name on PayPal review pages.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; __(get_bloginfo('name'), 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'checkout_logo' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('PayPal Checkout Logo (190x60px)', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('This controls what users see as the logo on PayPal review pages. ', 'paypal-for-woocommerce') . $require_ssl, &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'checkout_logo_hdrimg' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('PayPal Checkout Banner (750x90px)', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('This controls what users see as the header banner on PayPal review pages. ', 'paypal-for-woocommerce') . $require_ssl, &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'customer_service_number' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Customer Service Number', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('This controls what users see for your customer service phone number on PayPal review pages.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'softdescriptor' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Credit Card Statement Name', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('The value entered here will be displayed on the buyer\'s credit card statement.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'angelleye_skip_text' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Express Checkout Message', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('This message will be displayed next to the PayPal Express Checkout button at the top of the checkout page.'), &nbsp;</div></li><li><div>                'default' =&gt; __('Skip the forms and pay faster with PayPal!', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'skip_final_review' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Skip Final Review', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Enables the option to skip the final review page.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'description' =&gt; __('By default, users will be returned from PayPal and presented with a final review page which includes shipping and tax in the order details.  Enable this option to eliminate this page in the checkout process.') . '&lt;br /&gt;&lt;b class=&quot;final_review_notice&quot;&gt;&lt;span class=&quot;guest_checkout_notice&quot;&gt;' . $skip_final_review_option_not_allowed_guest_checkout . '&lt;/span&gt;&lt;/b&gt;' . '&lt;b class=&quot;final_review_notice&quot;&gt;&lt;span class=&quot;terms_notice&quot;&gt;' . $skip_final_review_option_not_allowed_terms . '&lt;/span&gt;&lt;/b&gt;' . '&lt;b class=&quot;final_review_notice&quot;&gt;&lt;span class=&quot;tokenized_payments_notice&quot;&gt;' . $skip_final_review_option_not_allowed_tokenized_payments . '&lt;/span&gt;&lt;/b&gt;', &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'no'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'disable_term' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Disable Terms and Conditions', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Disable Terms and Conditions for Express Checkout orders.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'description' =&gt; __('By default, if a Terms and Conditions page is set in WooCommerce, this would require the review page and would override the Skip Final Review option.  Check this option to disable Terms and Conditions for Express Checkout orders only so that you can use the Skip Final Review option.'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'class' =&gt; 'disable_term', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'payment_action' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Payment Action', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Whether to process as a Sale or Authorization.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'description' =&gt; __('Sale will capture the funds immediately when the order is placed.  Authorization will authorize the payment but will not capture the funds.  You would need to capture funds from within the WooCommerce order when you are ready to deliver.'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'options' =&gt; array(&nbsp;</div></li><li><div>                    'Sale' =&gt; 'Sale', &nbsp;</div></li><li><div>                    'Authorization' =&gt; 'Authorization', &nbsp;</div></li><li><div>                    'Order' =&gt; 'Order'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; 'Sale', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'billing_address' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Billing Address', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Set billing address in WooCommerce using the address returned by PayPal.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'description' =&gt; __('PayPal only returns a shipping address back to the website.  Enable this option if you would like to use this address for both billing and shipping in WooCommerce.'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'cancel_page' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Cancel Page', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'description' =&gt; __('Sets the page users will be returned to if they click the Cancel link on the PayPal checkout pages.'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'options' =&gt; $cancel_page, &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'send_items' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Send Item Details', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Send line item details to PayPal.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'description' =&gt; __('Include all line item details in the payment request to PayPal so that they can be seen from the PayPal transaction details page.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'yes', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'enable_tokenized_payments' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Enable Tokenized Payments', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Enable Tokenized Payments', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'description' =&gt; __('Allow buyers to securely save payment details to their account for quick checkout / auto-ship orders in the future. (Currently considered BETA for Express Checkout.)', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'class' =&gt; 'enable_tokenized_payments'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'enable_notifyurl' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Enable PayPal IPN', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Configure an IPN URL to be included with Express Checkout payments.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'description' =&gt; __('This will override any URL configured in your PayPal account profile.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'class' =&gt; 'angelleye_enable_notifyurl', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'prevent_to_add_additional_item' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Prevent Adding Extra Item', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Prevent adding an addition unit to the shopping cart when the Express Checkout button is pushed from the product page.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'description' =&gt; __('By default, clicking the PayPal Express Checkout button from the product page adds 1 unit of that item to the cart before sending the user to PayPal.  This option will disable that, and send the user without adding an additional unit.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'class' =&gt; '', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'notifyurl' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('PayPal IPN URL', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'description' =&gt; __('Your URL for receiving Instant Payment Notification (IPN) for transactions.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'class' =&gt; 'angelleye_notifyurl', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'order_cancellations' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Auto Cancel / Refund Orders ', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; '', &nbsp;</div></li><li><div>                'description' =&gt; __('Allows you to cancel and refund orders that do not meet PayPal\'s Seller Protection criteria.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'class' =&gt; 'order_cancellations', &nbsp;</div></li><li><div>                'options' =&gt; array(&nbsp;</div></li><li><div>                    'no_seller_protection' =&gt; __('Do *not* have PayPal Seller Protection', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'no_unauthorized_payment_protection' =&gt; __('Do *not* have PayPal Unauthorized Payment Protection', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'disabled' =&gt; __('Do not cancel any orders', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; 'disabled', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'fraud_management_filters' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Fraud Management Filters ', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; '', &nbsp;</div></li><li><div>                'description' =&gt; __('Choose how you would like to handle orders when Fraud Management Filters are flagged.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'select', &nbsp;</div></li><li><div>                'class' =&gt; '', &nbsp;</div></li><li><div>                'options' =&gt; array(&nbsp;</div></li><li><div>                    'ignore_warnings_and_proceed_as_usual' =&gt; __('Ignore warnings and proceed as usual.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                    'place_order_on_hold_for_further_review' =&gt; __('Place order On Hold for further review.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; 'place_order_on_hold_for_further_review', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'email_notify_order_cancellations' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Order canceled/refunded Email Notifications', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('Enable buyer email notifications for Order canceled/refunded', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'description' =&gt; __('This will send buyer email notifications for Order canceled/refunded when Auto Cancel / Refund Orders option is selected.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'no', &nbsp;</div></li><li><div>                'class' =&gt; 'email_notify_order_cancellations', &nbsp;</div></li><li><div>                'desc_tip' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'save_abandoned_checkout' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Save Abandoned Checkouts', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; __('If a buyer clicks to pay with PayPal, but they never return from PayPal, this will save the order as pending with all available details to that point.', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 'no'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'debug' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('Debug', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'label' =&gt; sprintf(__('Enable logging&lt;code&gt;%s&lt;/code&gt;', 'paypal-for-woocommerce'), version_compare(WC_VERSION, '3.0', '&lt;') ? wc_get_log_file_path('paypal_express') : WC_Log_Handler_File::get_log_file_path('paypal_express')), &nbsp;</div></li><li><div>                'default' =&gt; 'no'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'is_encrypt' =&gt; array(&nbsp;</div></li><li><div>                'title' =&gt; __('', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'label' =&gt; __('', 'paypal-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'hidden', &nbsp;</div></li><li><div>                'default' =&gt; 'yes', &nbsp;</div></li><li><div>                'class' =&gt; ''&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;form_fields = apply_filters('angelleye_ec_form_fields', $this-&gt;form_fields);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function is_available() {&nbsp;</div></li><li><div>        if (AngellEYE_Utility::is_express_checkout_credentials_is_set() == false) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!AngellEYE_Utility::is_valid_for_use_paypal_express()) {&nbsp;</div></li><li><div>           return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if( $this-&gt;show_on_checkout != 'regular' && $this-&gt;show_on_checkout != 'both') {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return parent::is_available();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function payment_fields() {&nbsp;</div></li><li><div>        if ($description = $this-&gt;get_description()) {&nbsp;</div></li><li><div>            echo wpautop(wptexturize($description));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if($this-&gt;function_helper-&gt;ec_is_express_checkout() == false) {&nbsp;</div></li><li><div>            $this-&gt;new_method_label = __('Create a new billing agreement', 'paypal-for-woocommerce');&nbsp;</div></li><li><div>            if ($this-&gt;supports('tokenization') && is_checkout()) {&nbsp;</div></li><li><div>                $this-&gt;tokenization_script();&nbsp;</div></li><li><div>                $this-&gt;saved_payment_methods();&nbsp;</div></li><li><div>                $this-&gt;save_payment_method_checkbox();&nbsp;</div></li><li><div>                do_action('payment_fields_saved_payment_methods', $this);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function process_payment($order_id) {&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            if (!empty($_POST['wc-paypal_express-payment-token']) && $_POST['wc-paypal_express-payment-token'] != 'new') {&nbsp;</div></li><li><div>                $result = $this-&gt;angelleye_ex_doreference_transaction($order_id);&nbsp;</div></li><li><div>                if ($result['ACK'] == 'Success' || $result['ACK'] == 'SuccessWithWarning') {&nbsp;</div></li><li><div>                    WC()-&gt;checkout-&gt;posted = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                    $_POST = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                    $order = wc_get_order($order_id);&nbsp;</div></li><li><div>                    $order-&gt;payment_complete($result['TRANSACTIONID']);&nbsp;</div></li><li><div>                    $order-&gt;add_order_note(sprintf(__('%s payment approved! Trnsaction ID: %s', 'paypal-for-woocommerce'), $this-&gt;title, $result['TRANSACTIONID']));&nbsp;</div></li><li><div>                    WC()-&gt;cart-&gt;empty_cart();&nbsp;</div></li><li><div>                    return array(&nbsp;</div></li><li><div>                        'result' =&gt; 'success', &nbsp;</div></li><li><div>                        'redirect' =&gt; $this-&gt;get_return_url($order)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $redirect_url = get_permalink(wc_get_page_id('cart'));&nbsp;</div></li><li><div>                    $this-&gt;paypal_express_checkout_error_handler($request_name = 'DoReferenceTransaction', $redirect_url, $result);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($this-&gt;function_helper-&gt;ec_is_express_checkout()) {&nbsp;</div></li><li><div>                $return_url = add_query_arg('order_id', $order_id, $this-&gt;function_helper-&gt;ec_get_checkout_url('do_express_checkout_payment', $order_id));&nbsp;</div></li><li><div>                $args = array(&nbsp;</div></li><li><div>                    'result' =&gt; 'success', &nbsp;</div></li><li><div>                    'redirect' =&gt; $return_url, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                if (isset($_POST['terms']) && wc_get_page_id('terms') &gt; 0) {&nbsp;</div></li><li><div>                    WC()-&gt;session-&gt;set( 'paypal_express_terms', true );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (is_ajax()) {&nbsp;</div></li><li><div>                    if ($this-&gt;function_helper-&gt;ec_is_version_gte_2_4()) {&nbsp;</div></li><li><div>                        wp_send_json($args);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        echo '&lt;!--WC_START--&gt;' . json_encode($args) . '&lt;!--WC_END--&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    wp_redirect($args['redirect']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                exit;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if (isset($_POST['terms']) && wc_get_page_id('terms') &gt; 0) {&nbsp;</div></li><li><div>                    WC()-&gt;session-&gt;set( 'paypal_express_terms', true );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                WC()-&gt;session-&gt;set( 'post_data', $_POST);&nbsp;</div></li><li><div>                WC()-&gt;checkout-&gt;posted = $_POST;&nbsp;</div></li><li><div>                $_GET['pp_action'] = 'set_express_checkout';&nbsp;</div></li><li><div>                $this-&gt;handle_wc_api();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } catch (Exception $ex) {&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function angelleye_ex_doreference_transaction($order_id) {&nbsp;</div></li><li><div>        require_once( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/angelleye-includes/express-checkout/class-wc-gateway-paypal-express-request-angelleye.php' );&nbsp;</div></li><li><div>        $paypal_express_request = new WC_Gateway_PayPal_Express_Request_AngellEYE($this);&nbsp;</div></li><li><div>        return $paypal_response = $paypal_express_request-&gt;DoReferenceTransaction($order_id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function angelleye_express_checkout_encrypt_gateway_api($settings) {&nbsp;</div></li><li><div>        if( !empty($settings['sandbox_api_password'])) {&nbsp;</div></li><li><div>            $api_password = $settings['sandbox_api_password'];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $api_password = $settings['api_password'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(strlen($api_password) &gt; 35 ) {&nbsp;</div></li><li><div>            return $settings;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!empty($settings['is_encrypt'])) {&nbsp;</div></li><li><div>            $gateway_settings_keys = array('sandbox_api_username', 'sandbox_api_password', 'sandbox_api_signature', 'api_username', 'api_password', 'api_signature');&nbsp;</div></li><li><div>            foreach ($gateway_settings_keys as $gateway_settings_key =&gt; $gateway_settings_value) {&nbsp;</div></li><li><div>                if (!empty($settings[$gateway_settings_value])) {&nbsp;</div></li><li><div>                    $settings[$gateway_settings_value] = AngellEYE_Utility::crypting($settings[$gateway_settings_value], $action = 'e');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $settings;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function get_button_locale_code() {&nbsp;</div></li><li><div>        $_supportedLocale = array(&nbsp;</div></li><li><div>            'en_US', 'fr_XC', 'es_XC', 'zh_XC', 'en_AU', 'de_DE', 'nl_NL', &nbsp;</div></li><li><div>            'fr_FR', 'pt_BR', 'fr_CA', 'zh_CN', 'ru_RU', 'en_GB', 'zh_HK', &nbsp;</div></li><li><div>            'he_IL', 'it_IT', 'ja_JP', 'pl_PL', 'pt_PT', 'es_ES', 'sv_SE', 'zh_TW', 'tr_TR'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $wpml_locale = self::angelleye_ec_get_wpml_locale();&nbsp;</div></li><li><div>        if ($wpml_locale) {&nbsp;</div></li><li><div>            if (in_array($wpml_locale, $_supportedLocale)) {&nbsp;</div></li><li><div>                return $wpml_locale;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $locale = get_locale();&nbsp;</div></li><li><div>        if (!in_array($locale, $_supportedLocale)) {&nbsp;</div></li><li><div>            $locale = 'en_US';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $locale;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function angelleye_get_paypalimage() {&nbsp;</div></li><li><div>        if (self::get_button_locale_code() == 'en_US') {&nbsp;</div></li><li><div>            return &quot;https://www.paypalobjects.com/webstatic/&quot; . self::get_button_locale_code() . &quot;/i/buttons/checkout-logo-medium.png&quot;;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return esc_url(add_query_arg('cmd', '_dynamic-image', add_query_arg('locale', self::get_button_locale_code(), 'https://fpdbs.paypal.com/dynamicimageweb')));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function handle_wc_api() {&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            $old_wc = version_compare(WC_VERSION, '3.0', '&lt;');&nbsp;</div></li><li><div>            require_once( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/angelleye-includes/express-checkout/class-wc-gateway-paypal-express-request-angelleye.php' );&nbsp;</div></li><li><div>            $paypal_express_request = new WC_Gateway_PayPal_Express_Request_AngellEYE($this);&nbsp;</div></li><li><div>            if (!isset($_GET['pp_action'])) {&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $cart_contains_subscription = false;&nbsp;</div></li><li><div>            if (class_exists('WC_Subscriptions_Order') && class_exists('WC_Subscriptions_Cart')) {&nbsp;</div></li><li><div>                $cart_contains_subscription = WC_Subscriptions_Cart::cart_contains_subscription();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!defined('WOOCOMMERCE_CHECKOUT')) {&nbsp;</div></li><li><div>                define('WOOCOMMERCE_CHECKOUT', true);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!defined('WOOCOMMERCE_CART')) {&nbsp;</div></li><li><div>                define('WOOCOMMERCE_CART', true);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            WC()-&gt;cart-&gt;calculate_totals();&nbsp;</div></li><li><div>            WC()-&gt;cart-&gt;calculate_shipping();&nbsp;</div></li><li><div>            if (version_compare(WC_VERSION, '3.0', '&lt;')) {&nbsp;</div></li><li><div>                WC()-&gt;customer-&gt;calculated_shipping(true);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                WC()-&gt;customer-&gt;set_calculated_shipping(true);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (WC()-&gt;cart-&gt;cart_contents_total &lt;= 0 && WC()-&gt;cart-&gt;total &lt;= 0 && $cart_contains_subscription == false) {&nbsp;</div></li><li><div>                wc_add_notice(__('your order amount is zero, We were unable to process your order, please try again.', 'paypal-for-woocommerce'), 'error');&nbsp;</div></li><li><div>                $paypal_express_request-&gt;angelleye_redirect();&nbsp;</div></li><li><div>                exit;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch ($_GET['pp_action']) {&nbsp;</div></li><li><div>                case 'cancel_order':&nbsp;</div></li><li><div>                    $this-&gt;function_helper-&gt;ec_clear_session_data();&nbsp;</div></li><li><div>                     $cancel_url = !empty($this-&gt;cancel_page_id) ? get_permalink($this-&gt;cancel_page_id) : WC()-&gt;cart-&gt;get_cart_url();&nbsp;</div></li><li><div>                     wp_safe_redirect( $cancel_url );&nbsp;</div></li><li><div>                     exit;&nbsp;</div></li><li><div>                case 'set_express_checkout':&nbsp;</div></li><li><div>                    if ((isset($_POST['wc-paypal_express-new-payment-method']) && $_POST['wc-paypal_express-new-payment-method'] = 'on') || ( isset($_GET['ec_save_to_account']) && $_GET['ec_save_to_account'] == true)) {&nbsp;</div></li><li><div>                        WC()-&gt;session-&gt;set( 'ec_save_to_account', 'on' );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $paypal_express_request-&gt;angelleye_set_express_checkout();&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'get_express_checkout_details':&nbsp;</div></li><li><div>                    $paypal_express_request-&gt;angelleye_get_express_checkout_details();&nbsp;</div></li><li><div>                    $order_id = absint(WC()-&gt;session-&gt;get('order_awaiting_payment'));&nbsp;</div></li><li><div>                    if ( $order_id &gt; 0 && ( $order = wc_get_order( $order_id ) ) && $order-&gt;has_status( array( 'pending', 'failed' ) ) ) {&nbsp;</div></li><li><div>                        WC()-&gt;checkout-&gt;posted = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $_POST = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $this-&gt;posted = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $chosen_shipping_methods = WC()-&gt;session-&gt;get('chosen_shipping_methods');&nbsp;</div></li><li><div>                        if (isset($_POST['shipping_method']) && is_array($_POST['shipping_method']))&nbsp;</div></li><li><div>                            foreach ($_POST['shipping_method'] as $i =&gt; $value)&nbsp;</div></li><li><div>                                $chosen_shipping_methods[$i] = wc_clean($value);&nbsp;</div></li><li><div>                        WC()-&gt;session-&gt;set('chosen_shipping_methods', $chosen_shipping_methods);&nbsp;</div></li><li><div>                        if (WC()-&gt;cart-&gt;needs_shipping()) {&nbsp;</div></li><li><div>                            // Validate Shipping Methods&nbsp;</div></li><li><div>                            $packages = WC()-&gt;shipping-&gt;get_packages();&nbsp;</div></li><li><div>                            WC()-&gt;checkout()-&gt;shipping_methods = WC()-&gt;session-&gt;get('chosen_shipping_methods');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (empty($this-&gt;posted)) {&nbsp;</div></li><li><div>                            $this-&gt;posted = array();&nbsp;</div></li><li><div>                            $paypal_express_checkout = WC()-&gt;session-&gt;get( 'paypal_express_checkout' );&nbsp;</div></li><li><div>                            if( !empty($paypal_express_checkout['shipping_details']['email'])) {&nbsp;</div></li><li><div>                                $this-&gt;posted['billing_email'] = $paypal_express_checkout['shipping_details']['email'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if( !empty($paypal_express_checkout['shipping_details']['first_name'])) {&nbsp;</div></li><li><div>                                $this-&gt;posted['billing_first_name'] = $paypal_express_checkout['shipping_details']['first_name'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if( !empty($paypal_express_checkout['shipping_details']['last_name'])) {&nbsp;</div></li><li><div>                                $this-&gt;posted['billing_last_name'] = $paypal_express_checkout['shipping_details']['last_name'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $this-&gt;posted['payment_method'] = $this-&gt;id;&nbsp;</div></li><li><div>                             &nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $order_id = WC()-&gt;checkout()-&gt;create_order($this-&gt;posted);&nbsp;</div></li><li><div>                        if (is_wp_error($order_id)) {&nbsp;</div></li><li><div>                            throw new Exception($order_id-&gt;get_error_message());&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        do_action('woocommerce_checkout_order_processed', $order_id, $this-&gt;posted);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        WC()-&gt;checkout-&gt;posted = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $_POST = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $this-&gt;posted = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( $order_id == 0 ) {&nbsp;</div></li><li><div>                        WC()-&gt;checkout-&gt;posted = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $_POST = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $this-&gt;posted = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                        $chosen_shipping_methods = WC()-&gt;session-&gt;get('chosen_shipping_methods');&nbsp;</div></li><li><div>                        if (isset($_POST['shipping_method']) && is_array($_POST['shipping_method']))&nbsp;</div></li><li><div>                            foreach ($_POST['shipping_method'] as $i =&gt; $value)&nbsp;</div></li><li><div>                                $chosen_shipping_methods[$i] = wc_clean($value);&nbsp;</div></li><li><div>                        WC()-&gt;session-&gt;set('chosen_shipping_methods', $chosen_shipping_methods);&nbsp;</div></li><li><div>                        if (WC()-&gt;cart-&gt;needs_shipping()) {&nbsp;</div></li><li><div>                            // Validate Shipping Methods&nbsp;</div></li><li><div>                            $packages = WC()-&gt;shipping-&gt;get_packages();&nbsp;</div></li><li><div>                            WC()-&gt;checkout()-&gt;shipping_methods = WC()-&gt;session-&gt;get('chosen_shipping_methods');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (empty($this-&gt;posted)) {&nbsp;</div></li><li><div>                            $this-&gt;posted = array();&nbsp;</div></li><li><div>                            $paypal_express_checkout = WC()-&gt;session-&gt;get( 'paypal_express_checkout' );&nbsp;</div></li><li><div>                            if( !empty($paypal_express_checkout['shipping_details']['email'])) {&nbsp;</div></li><li><div>                                $this-&gt;posted['billing_email'] = $paypal_express_checkout['shipping_details']['email'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if( !empty($paypal_express_checkout['shipping_details']['first_name'])) {&nbsp;</div></li><li><div>                                $this-&gt;posted['billing_first_name'] = $paypal_express_checkout['shipping_details']['first_name'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if( !empty($paypal_express_checkout['shipping_details']['last_name'])) {&nbsp;</div></li><li><div>                                $this-&gt;posted['billing_last_name'] = $paypal_express_checkout['shipping_details']['last_name'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $this-&gt;posted['payment_method'] = $this-&gt;id;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $order_id = WC()-&gt;checkout()-&gt;create_order($this-&gt;posted);&nbsp;</div></li><li><div>                        if (is_wp_error($order_id)) {&nbsp;</div></li><li><div>                            throw new Exception($order_id-&gt;get_error_message());&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        do_action('woocommerce_checkout_order_processed', $order_id, $this-&gt;posted);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $order = wc_get_order($order_id);&nbsp;</div></li><li><div>                    if ($this-&gt;billing_address) {&nbsp;</div></li><li><div>                        $paypal_express_checkout = WC()-&gt;session-&gt;get( 'paypal_express_checkout' );&nbsp;</div></li><li><div>                        $shipping_details = isset($paypal_express_checkout['shipping_details']) ? $paypal_express_checkout['shipping_details'] : array();&nbsp;</div></li><li><div>                        if( $old_wc ) {&nbsp;</div></li><li><div>                            AngellEYE_Utility::angelleye_set_address($order_id, $shipping_details, 'billing');&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $order-&gt;set_address($shipping_details, 'billing');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $billing_address = array();&nbsp;</div></li><li><div>                        $checkout_fields['billing'] = WC()-&gt;countries-&gt;get_address_fields(WC()-&gt;checkout-&gt;get_value('billing_country'), 'billing_');&nbsp;</div></li><li><div>                        if ($checkout_fields['billing']) {&nbsp;</div></li><li><div>                            foreach (array_keys($checkout_fields['billing']) as $field) {&nbsp;</div></li><li><div>                                $field_name = str_replace('billing_', '', $field);&nbsp;</div></li><li><div>                                $billing_address[$field_name] = $this-&gt;angelleye_ec_get_posted_address_data($field_name);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if( $old_wc ) {&nbsp;</div></li><li><div>                            AngellEYE_Utility::angelleye_set_address($order_id, $billing_address, 'billing');&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $order-&gt;set_address($billing_address, 'billing');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $paypal_express_checkout = WC()-&gt;session-&gt;get( 'paypal_express_checkout' );&nbsp;</div></li><li><div>                    $shipping_details = isset($paypal_express_checkout['shipping_details']) ? $paypal_express_checkout['shipping_details'] : array();&nbsp;</div></li><li><div>                    if( $old_wc ) {&nbsp;</div></li><li><div>                        AngellEYE_Utility::angelleye_set_address($order_id, $shipping_details, 'shipping');&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $order-&gt;set_address($shipping_details, 'shipping');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $order_id = version_compare(WC_VERSION, '3.0', '&lt;') ? $order-&gt;id : $order-&gt;get_id();&nbsp;</div></li><li><div>                    if ($old_wc) {&nbsp;</div></li><li><div>                        update_post_meta($order_id, '_payment_method', $this-&gt;id);&nbsp;</div></li><li><div>                        update_post_meta($order_id, '_payment_method_title', $this-&gt;title);&nbsp;</div></li><li><div>                        update_post_meta($order_id, '_customer_user', get_current_user_id());&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $order-&gt;set_payment_method($this);&nbsp;</div></li><li><div>                        update_post_meta($order-&gt;get_id(), '_customer_user', get_current_user_id());&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $post_data = WC()-&gt;session-&gt;get( 'post_data' );&nbsp;</div></li><li><div>                    if (!empty($post_data['billing_phone'])) {&nbsp;</div></li><li><div>                        if ($old_wc) {&nbsp;</div></li><li><div>                            update_post_meta($order_id, '_billing_phone', $post_data['billing_phone']);&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            update_post_meta($order-&gt;get_id(), '_billing_phone', $post_data['billing_phone']);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (!empty($post_data['order_comments'])) {&nbsp;</div></li><li><div>                        if ($old_wc) {&nbsp;</div></li><li><div>                            update_post_meta($order_id, 'order_comments', $post_data['order_comments']);&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            update_post_meta($order-&gt;get_id(), 'order_comments', $post_data['order_comments']);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $my_post = array(&nbsp;</div></li><li><div>                            'ID' =&gt; $order_id, &nbsp;</div></li><li><div>                            'post_excerpt' =&gt; $post_data['order_comments'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        wp_update_post($my_post);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $_GET['order_id'] = $order_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $paypal_express_request-&gt;angelleye_do_express_checkout_payment();&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'do_express_checkout_payment':&nbsp;</div></li><li><div>                    $paypal_express_request-&gt;angelleye_do_express_checkout_payment();&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } catch (Exception $ex) {&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_transaction_url($order) {&nbsp;</div></li><li><div>        if (!$this-&gt;supports('tokenization')) {&nbsp;</div></li><li><div>            $sandbox_transaction_url = 'https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=_view-a-trans&id=%s';&nbsp;</div></li><li><div>            $live_transaction_url = 'https://www.paypal.com/cgi-bin/webscr?cmd=_view-a-trans&id=%s';&nbsp;</div></li><li><div>            $old_wc = version_compare(WC_VERSION, '3.0', '&lt;');&nbsp;</div></li><li><div>            $is_sandbox = $old_wc ? get_post_meta($order-&gt;id, 'is_sandbox', true) : get_post_meta($order-&gt;get_id(), 'is_sandbox', true);&nbsp;</div></li><li><div>            if ($is_sandbox == true) {&nbsp;</div></li><li><div>                $this-&gt;view_transaction_url = $sandbox_transaction_url;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if (empty($is_sandbox)) {&nbsp;</div></li><li><div>                    if ($this-&gt;testmode == true) {&nbsp;</div></li><li><div>                        $this-&gt;view_transaction_url = $sandbox_transaction_url;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $this-&gt;view_transaction_url = $live_transaction_url;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $this-&gt;view_transaction_url = $live_transaction_url;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return parent::get_transaction_url($order);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function add_payment_method() {&nbsp;</div></li><li><div>        $SECFields = array(&nbsp;</div></li><li><div>            'returnurl' =&gt; add_query_arg(array(&nbsp;</div></li><li><div>                'do_action' =&gt; 'update_payment_method', &nbsp;</div></li><li><div>                'action_name' =&gt; 'SetExpressCheckout', &nbsp;</div></li><li><div>                'method_name' =&gt; 'paypal_express', &nbsp;</div></li><li><div>                'customer_id' =&gt; get_current_user_id()&nbsp;</div></li><li><div> ), home_url('/')), &nbsp;</div></li><li><div>            'cancelurl' =&gt; wc_get_account_endpoint_url('add-payment-method'), &nbsp;</div></li><li><div>            'noshipping' =&gt; '1', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $Payments = array(&nbsp;</div></li><li><div>            'amt' =&gt; '0', &nbsp;</div></li><li><div>            'currencycode' =&gt; get_woocommerce_currency(), &nbsp;</div></li><li><div>            'paymentaction' =&gt; 'AUTHORIZATION', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $BillingAgreements = array();&nbsp;</div></li><li><div>        $Item = array(&nbsp;</div></li><li><div>            'l_billingtype' =&gt; 'MerchantInitiatedBilling', &nbsp;</div></li><li><div>            'l_billingagreementdescription' =&gt; 'Billing Agreement', &nbsp;</div></li><li><div>            'l_paymenttype' =&gt; 'Any', &nbsp;</div></li><li><div>            'l_billingagreementcustom' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        array_push($BillingAgreements, $Item);&nbsp;</div></li><li><div>        $PayPalRequest = array(&nbsp;</div></li><li><div>            'SECFields' =&gt; $SECFields, &nbsp;</div></li><li><div>            'BillingAgreements' =&gt; $BillingAgreements, &nbsp;</div></li><li><div>            'Payments' =&gt; $Payments&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $result = $this-&gt;paypal_express_checkout_token_request_handler($PayPalRequest, 'SetExpressCheckout');&nbsp;</div></li><li><div>        if ($result['ACK'] == 'Success') {&nbsp;</div></li><li><div>            return array(&nbsp;</div></li><li><div>                'result' =&gt; 'success', &nbsp;</div></li><li><div>                'redirect' =&gt; $this-&gt;PAYPAL_URL . $result['TOKEN']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $redirect_url = wc_get_account_endpoint_url('add-payment-method');&nbsp;</div></li><li><div>            $this-&gt;paypal_express_checkout_error_handler($request_name = 'SetExpressCheckout', $redirect_url, $result);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function paypal_express_checkout_token_request_handler($PayPalRequest = array(), $action_name = '') {&nbsp;</div></li><li><div>        if (!class_exists('Angelleye_PayPal')) {&nbsp;</div></li><li><div>            require_once( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/classes/lib/angelleye/paypal-php-library/includes/paypal.class.php' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $PayPalConfig = array(&nbsp;</div></li><li><div>            'Sandbox' =&gt; $this-&gt;testmode, &nbsp;</div></li><li><div>            'APIUsername' =&gt; $this-&gt;api_username, &nbsp;</div></li><li><div>            'APIPassword' =&gt; $this-&gt;api_password, &nbsp;</div></li><li><div>            'APISignature' =&gt; $this-&gt;api_signature, &nbsp;</div></li><li><div>            'Force_tls_one_point_two' =&gt; $this-&gt;Force_tls_one_point_two&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $PayPal = new Angelleye_PayPal($PayPalConfig);&nbsp;</div></li><li><div>        if (!empty($PayPalRequest) && !empty($action_name)) {&nbsp;</div></li><li><div>            if ('SetExpressCheckout' == $action_name) {&nbsp;</div></li><li><div>                $PayPalResult = $PayPal-&gt;SetExpressCheckout(apply_filters('angelleye_woocommerce_express_set_express_checkout_request_args', $PayPalRequest));&nbsp;</div></li><li><div>                AngellEYE_Gateway_Paypal::angelleye_paypal_for_woocommerce_curl_error_handler($PayPalResult, $methos_name = 'SetExpressCheckout', $gateway = 'PayPal Express Checkout', $this-&gt;error_email_notify);&nbsp;</div></li><li><div>                self::log('Test Mode: ' . $this-&gt;testmode);&nbsp;</div></li><li><div>                self::log('Endpoint: ' . $this-&gt;API_Endpoint);&nbsp;</div></li><li><div>                $PayPalRequest = isset($PayPalResult['RAWREQUEST']) ? $PayPalResult['RAWREQUEST'] : '';&nbsp;</div></li><li><div>                $PayPalResponse = isset($PayPalResult['RAWRESPONSE']) ? $PayPalResult['RAWRESPONSE'] : '';&nbsp;</div></li><li><div>                self::log('Request: ' . print_r($PayPal-&gt;NVPToArray($PayPal-&gt;MaskAPIResult($PayPalRequest)), true));&nbsp;</div></li><li><div>                self::log('Response: ' . print_r($PayPal-&gt;NVPToArray($PayPal-&gt;MaskAPIResult($PayPalResponse)), true));&nbsp;</div></li><li><div>                return $PayPalResult;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!empty($_GET['method_name']) && $_GET['method_name'] == 'paypal_express') {&nbsp;</div></li><li><div>            if ($_GET['action_name'] == 'SetExpressCheckout') {&nbsp;</div></li><li><div>                $PayPalResult = $PayPal-&gt;GetExpressCheckoutDetails($_GET['token']);&nbsp;</div></li><li><div>                if ($PayPalResult['ACK'] == 'Success') {&nbsp;</div></li><li><div>                    $data = array(&nbsp;</div></li><li><div>                        'METHOD' =&gt; 'CreateBillingAgreement', &nbsp;</div></li><li><div>                        'TOKEN' =&gt; $_GET['token']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $billing_result = $PayPal-&gt;CreateBillingAgreement($_GET['token']);&nbsp;</div></li><li><div>                    if ($billing_result['ACK'] == 'Success') {&nbsp;</div></li><li><div>                        if (!empty($billing_result['BILLINGAGREEMENTID'])) {&nbsp;</div></li><li><div>                            $billing_agreement_id = $billing_result['BILLINGAGREEMENTID'];&nbsp;</div></li><li><div>                            $token = new WC_Payment_Token_CC();&nbsp;</div></li><li><div>                            $customer_id = get_current_user_id();&nbsp;</div></li><li><div>                            $token-&gt;set_user_id($customer_id);&nbsp;</div></li><li><div>                            $token-&gt;set_token($billing_agreement_id);&nbsp;</div></li><li><div>                            $token-&gt;set_gateway_id($this-&gt;id);&nbsp;</div></li><li><div>                            $token-&gt;set_card_type('PayPal Billing Agreement');&nbsp;</div></li><li><div>                            $token-&gt;set_last4(substr($billing_agreement_id, -4));&nbsp;</div></li><li><div>                            $token-&gt;set_expiry_month(date('m'));&nbsp;</div></li><li><div>                            $token-&gt;set_expiry_year(date('Y', strtotime('+20 year')));&nbsp;</div></li><li><div>                            &nbsp;</div></li><li><div>                            $save_result = $token-&gt;save();&nbsp;</div></li><li><div>                            wp_redirect(wc_get_account_endpoint_url('payment-methods'));&nbsp;</div></li><li><div>                            exit();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $redirect_url = wc_get_account_endpoint_url('add-payment-method');&nbsp;</div></li><li><div>                    $this-&gt;paypal_express_checkout_error_handler($request_name = 'GetExpressCheckoutDetails', $redirect_url, $PayPalResult);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function paypal_express_checkout_error_handler($request_name = '', $redirect_url = '', $result) {&nbsp;</div></li><li><div>        $ErrorCode = urldecode($result[&quot;L_ERRORCODE0&quot;]);&nbsp;</div></li><li><div>        $ErrorShortMsg = urldecode($result[&quot;L_SHORTMESSAGE0&quot;]);&nbsp;</div></li><li><div>        $ErrorLongMsg = urldecode($result[&quot;L_LONGMESSAGE0&quot;]);&nbsp;</div></li><li><div>        $ErrorSeverityCode = urldecode($result[&quot;L_SEVERITYCODE0&quot;]);&nbsp;</div></li><li><div>        self::log(__($request_name . 'API call failed. ', 'paypal-for-woocommerce'));&nbsp;</div></li><li><div>        self::log(__('Detailed Error Message: ', 'paypal-for-woocommerce') . $ErrorLongMsg);&nbsp;</div></li><li><div>        self::log(__('Short Error Message: ', 'paypal-for-woocommerce') . $ErrorShortMsg);&nbsp;</div></li><li><div>        self::log(__('Error Code: ', 'paypal-for-woocommerce') . $ErrorCode);&nbsp;</div></li><li><div>        self::log(__('Error Severity Code: ', 'paypal-for-woocommerce') . $ErrorSeverityCode);&nbsp;</div></li><li><div>        $message = '';&nbsp;</div></li><li><div>        if ($this-&gt;error_email_notify) {&nbsp;</div></li><li><div>            $admin_email = get_option(&quot;admin_email&quot;);&nbsp;</div></li><li><div>            $message .= __($request_name . &quot; API call failed.&quot;, &quot;paypal-for-woocommerce&quot;) . &quot;\n\n&quot;;&nbsp;</div></li><li><div>            $message .= __('Error Code: ', 'paypal-for-woocommerce') . $ErrorCode . &quot;\n&quot;;&nbsp;</div></li><li><div>            $message .= __('Error Severity Code: ', 'paypal-for-woocommerce') . $ErrorSeverityCode . &quot;\n&quot;;&nbsp;</div></li><li><div>            $message .= __('Short Error Message: ', 'paypal-for-woocommerce') . $ErrorShortMsg . &quot;\n&quot;;&nbsp;</div></li><li><div>            $message .= __('Detailed Error Message: ', 'paypal-for-woocommerce') . $ErrorLongMsg . &quot;\n&quot;;&nbsp;</div></li><li><div>            $message .= __('User IP: ', 'paypal-for-woocommerce') . $this-&gt;get_user_ip() . &quot;\n&quot;;&nbsp;</div></li><li><div>            $error_email_notify_mes = apply_filters('ae_ppec_error_email_message', $message, $ErrorCode, $ErrorSeverityCode, $ErrorShortMsg, $ErrorLongMsg);&nbsp;</div></li><li><div>            $subject = &quot;PayPal Express Checkout Error Notification&quot;;&nbsp;</div></li><li><div>            $error_email_notify_subject = apply_filters('ae_ppec_error_email_subject', $subject);&nbsp;</div></li><li><div>            wp_mail($admin_email, $error_email_notify_subject, $error_email_notify_mes);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($this-&gt;error_display_type == 'detailed') {&nbsp;</div></li><li><div>            $sec_error_notice = $ErrorCode . ' - ' . $ErrorLongMsg;&nbsp;</div></li><li><div>            $error_display_type_message = sprintf(__($sec_error_notice, 'paypal-for-woocommerce'));&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $error_display_type_message = sprintf(__('There was a problem paying with PayPal.  Please try another method.', 'paypal-for-woocommerce'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $error_display_type_message = apply_filters('ae_ppec_error_user_display_message', $error_display_type_message, $ErrorCode, $ErrorLongMsg);&nbsp;</div></li><li><div>        wc_add_notice($error_display_type_message, 'error');&nbsp;</div></li><li><div>        if (!is_ajax()) {&nbsp;</div></li><li><div>            wp_redirect($redirect_url);&nbsp;</div></li><li><div>            exit;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return array(&nbsp;</div></li><li><div>                'result' =&gt; 'fail', &nbsp;</div></li><li><div>                'redirect' =&gt; $redirect_url&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function log($message, $level = 'info') {&nbsp;</div></li><li><div>        if (self::$log_enabled) {&nbsp;</div></li><li><div>            if (version_compare(WC_VERSION, '3.0', '&lt;')) {&nbsp;</div></li><li><div>                if (empty(self::$log)) {&nbsp;</div></li><li><div>                    self::$log = new WC_Logger();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                self::$log-&gt;add('paypal_express', $message);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if (empty(self::$log)) {&nbsp;</div></li><li><div>                    self::$log = wc_get_logger();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                self::$log-&gt;log($level, $message, array('source' =&gt; 'paypal_express'));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_user_ip() {&nbsp;</div></li><li><div>        return (isset($_SERVER['HTTP_X_FORWARD_FOR']) && !empty($_SERVER['HTTP_X_FORWARD_FOR'])) ? $_SERVER['HTTP_X_FORWARD_FOR'] : $_SERVER['REMOTE_ADDR'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function angelleye_ec_get_posted_address_data($key, $type = 'billing') {&nbsp;</div></li><li><div>        if ('billing' === $type || false === $this-&gt;posted['ship_to_different_address']) {&nbsp;</div></li><li><div>            $return = isset($this-&gt;posted['billing_' . $key]) ? $this-&gt;posted['billing_' . $key] : '';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $return = isset($this-&gt;posted['shipping_' . $key]) ? $this-&gt;posted['shipping_' . $key] : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ('email' === $key && empty($return) && is_user_logged_in()) {&nbsp;</div></li><li><div>            $current_user = wp_get_current_user();&nbsp;</div></li><li><div>            $return = $current_user-&gt;user_email;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function angelleye_ec_get_wpml_locale() {&nbsp;</div></li><li><div>        $locale = false;&nbsp;</div></li><li><div>        if (defined('ICL_LANGUAGE_CODE') && function_exists('icl_object_id')) {&nbsp;</div></li><li><div>            global $sitepress;&nbsp;</div></li><li><div>            if (isset($sitepress)) {&nbsp;</div></li><li><div>                $details = $sitepress-&gt;get_language_details(ICL_LANGUAGE_CODE);&nbsp;</div></li><li><div>                $locale = $details['locale'];&nbsp;</div></li><li><div>            } else if (function_exists('pll_current_language')) {&nbsp;</div></li><li><div>                $locale = pll_current_language('locale');&nbsp;</div></li><li><div>            } else if (function_exists('pll_default_language')) {&nbsp;</div></li><li><div>                $locale = pll_default_language('locale');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $locale;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function free_signup_order_payment($order_id) {&nbsp;</div></li><li><div>        $order = new WC_Order($order_id);&nbsp;</div></li><li><div>        $this-&gt;log('Processing order #' . $order_id);&nbsp;</div></li><li><div>        if (!empty($_POST['wc-paypal_express-payment-token']) && $_POST['wc-paypal_express-payment-token'] != 'new') {&nbsp;</div></li><li><div>            $token_id = wc_clean($_POST['wc-paypal_express-payment-token']);&nbsp;</div></li><li><div>            $token = WC_Payment_Tokens::get($token_id);&nbsp;</div></li><li><div>            $order-&gt;payment_complete($token-&gt;get_token());&nbsp;</div></li><li><div>            update_post_meta($order_id, '_first_transaction_id', $token-&gt;get_token());&nbsp;</div></li><li><div>            $order-&gt;add_order_note('Payment Action: ' . $this-&gt;payment_action);&nbsp;</div></li><li><div>            WC()-&gt;cart-&gt;empty_cart();&nbsp;</div></li><li><div>            return array(&nbsp;</div></li><li><div>                'result' =&gt; 'success', &nbsp;</div></li><li><div>                'redirect' =&gt; $this-&gt;get_return_url($order)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Process a refund if supported&nbsp;</div></li><li><div>     * @param  int $order_id&nbsp;</div></li><li><div>     * @param  float $amount&nbsp;</div></li><li><div>     * @param  string $reason&nbsp;</div></li><li><div>     * @return  bool|wp_error True or false based on success, or a WP_Error object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function process_refund($order_id, $amount = null, $reason = '') {&nbsp;</div></li><li><div>        require_once( PAYPAL_FOR_WOOCOMMERCE_PLUGIN_DIR . '/angelleye-includes/express-checkout/class-wc-gateway-paypal-express-request-angelleye.php' );&nbsp;</div></li><li><div>        $paypal_express_request = new WC_Gateway_PayPal_Express_Request_AngellEYE($this);&nbsp;</div></li><li><div>        $bool = $paypal_express_request-&gt;angelleye_process_refund($order_id, $amount, $reason);&nbsp;</div></li><li><div>        if($bool == true) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.3.3</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.3/classes/wc_gateway_pay_pal_express_angell_eye/" class="active">1.4.3</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.2/classes/wc_gateway_pay_pal_express_angell_eye/" class="">1.4.2</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.1/classes/wc_gateway_pay_pal_express_angell_eye/" class="">1.4.1</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.4.0/classes/wc_gateway_pay_pal_express_angell_eye/" class="">1.4.0</a></li><li><a href="http://hookr.io/plugins/paypal-for-woocommerce/1.3.3/classes/wc_gateway_pay_pal_express_angell_eye/" class="">1.3.3</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WC_Gateway_PayPal_Express_AngellEYE</li><li><span></span>wp-plugin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>