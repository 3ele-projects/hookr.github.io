<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-id="7745"><head xmlns="http://www.w3.org/1999/xhtml"><title> ngfbmeta | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="NgfbMeta, class, plugin, nextgen-facebook-ngfb, 8.43.0" /><meta name="description" content="The WordPress Core NgfbMeta class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.11"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=18dcd3757cb2cc8f3e8690ed3e133d0a' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.11' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/ngfb_meta/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fngfb_meta%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fngfb_meta%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-8.43.0-class-ngfb_meta","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="ngfb_meta" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to nextgen-facebook-ngfb." href="http://hookr.io/plugins/nextgen-facebook-ngfb/" class="plugin"><span property="name">nextgen-facebook-ngfb</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 8.43.0." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/" class="H_VERSION"><span property="name">8.43.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">ngfb_meta</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="0"><a href="http://hookr.io/8.43.0/all/" title="All">All <span class="count badge">0</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/8.43.0/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/8.43.0/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/8.43.0/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/8.43.0/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="0"><a href="http://hookr.io/8.43.0/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/8.43.0/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="0"><a href="http://hookr.io/8.43.0/functions/" title="Functions">Functions <span class="count badge">0</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/8.43.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>NgfbMeta</strong></h1><p>The WordPress Core <strong>NgfbMeta</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/files/lib-meta/" class="file">/lib/meta.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="14" class="block" start="14"><li><div>class NgfbMeta {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected $p;&nbsp;</div></li><li><div>    protected $form;&nbsp;</div></li><li><div>    protected $opts = array();    // cache for options&nbsp;</div></li><li><div>    protected $defs = array();    // cache for default values&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected static $head_meta_tags = false;&nbsp;</div></li><li><div>    protected static $head_meta_info = array();&nbsp;</div></li><li><div>    protected static $last_column_id = null;    // cache_id of the last column request in list table&nbsp;</div></li><li><div>    protected static $last_column_array = array();    // array of column values for last column requested &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected static $rename_md_options_keys = array(&nbsp;</div></li><li><div>        'ngfb' =&gt; array(&nbsp;</div></li><li><div>            499 =&gt; array(&nbsp;</div></li><li><div>                'link_desc' =&gt; 'seo_desc', &nbsp;</div></li><li><div>                'meta_desc' =&gt; 'seo_desc', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            503 =&gt; array(&nbsp;</div></li><li><div>                'schema_recipe_calories' =&gt; 'schema_recipe_nutri_cal', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            514 =&gt; array(&nbsp;</div></li><li><div>                'rp_img_id' =&gt; 'p_img_id', &nbsp;</div></li><li><div>                'rp_img_id_pre' =&gt; 'p_img_id_pre', &nbsp;</div></li><li><div>                'rp_img_width' =&gt; 'p_img_width', &nbsp;</div></li><li><div>                'rp_img_height' =&gt; 'p_img_height', &nbsp;</div></li><li><div>                'rp_img_crop' =&gt; 'p_img_crop', &nbsp;</div></li><li><div>                'rp_img_crop_x' =&gt; 'p_img_crop_x', &nbsp;</div></li><li><div>                'rp_img_crop_y' =&gt; 'p_img_crop_y', &nbsp;</div></li><li><div>                'rp_img_url' =&gt; 'p_img_url', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static $mod_defaults = array(&nbsp;</div></li><li><div>        'id' =&gt; 0, &nbsp;</div></li><li><div>        'name' =&gt; false, &nbsp;</div></li><li><div>        'obj' =&gt; false, &nbsp;</div></li><li><div>        'use_post' =&gt; false, &nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Post&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        'is_post' =&gt; false, // is post module&nbsp;</div></li><li><div>        'is_home' =&gt; false, // home page (index or static)&nbsp;</div></li><li><div>        'is_home_page' =&gt; false, // static front page&nbsp;</div></li><li><div>        'is_home_index' =&gt; false, // static posts page or home index&nbsp;</div></li><li><div>        'post_type' =&gt; false, &nbsp;</div></li><li><div>        'post_status' =&gt; false, &nbsp;</div></li><li><div>        'post_author' =&gt; false, &nbsp;</div></li><li><div>        'post_coauthors' =&gt; array(), &nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Term&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        'is_term' =&gt; false, // is term module&nbsp;</div></li><li><div>        'tax_slug' =&gt; '', // empty string by default&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * User&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        'is_user' =&gt; false, // is user module&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function __construct() {&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_mod( $mod_id ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, self::$mod_defaults );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_posts( array $mod, $posts_per_page = false, $paged = false ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, $array() );    // return an empty array&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_posts_mods( array $mod, $posts_per_page = false, $paged = false ) {&nbsp;</div></li><li><div>        $ret = array();&nbsp;</div></li><li><div>        foreach ( $this-&gt;get_posts( $mod, $posts_per_page, $paged ) as $post ) {&nbsp;</div></li><li><div>            if ( ! empty( $post-&gt;ID ) ) {    // just in case&nbsp;</div></li><li><div>                $ret[] = $this-&gt;p-&gt;m['util']['post']-&gt;get_mod( $post-&gt;ID );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $ret;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function add_actions() {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__ );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function add_metaboxes() {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__ );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function show_metabox_social_settings( $obj ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__ );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function get_social_tabs( $metabox, array &$mod ) {&nbsp;</div></li><li><div>        switch ( $metabox ) {&nbsp;</div></li><li><div>            case 'social_settings':&nbsp;</div></li><li><div>                $tabs = array(&nbsp;</div></li><li><div>                    'text' =&gt; _x( 'Edit Text', 'metabox tab', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                    'media' =&gt; _x( 'Select Media', 'metabox tab', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                    'preview' =&gt; _x( 'Preview', 'metabox tab', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                    'tags' =&gt; _x( 'Head Tags', 'metabox tab', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                    'validate' =&gt; _x( 'Validate', 'metabox tab', 'nextgen-facebook' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                // move the text and media option tabs to the end&nbsp;</div></li><li><div>                if ( ! empty( $this-&gt;p-&gt;options['plugin_hide_pro'] ) ) {&nbsp;</div></li><li><div>                    foreach ( array( 'text', 'media' ) as $key ) {&nbsp;</div></li><li><div>                        SucomUtil::move_to_end( $tabs, $key );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                $tabs = array();    // just in case&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return apply_filters( $this-&gt;p-&gt;cf['lca'].'_'.$mod['name'].'_'.$metabox.'_tabs', $tabs, $mod );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function get_table_rows( &$metabox, &$key, &$head_info, &$mod ) {&nbsp;</div></li><li><div>        $table_rows = array();&nbsp;</div></li><li><div>        switch ( $key ) {&nbsp;</div></li><li><div>            case 'preview':&nbsp;</div></li><li><div>                $table_rows = $this-&gt;get_rows_social_preview( $this-&gt;form, $head_info, $mod );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'tags':    &nbsp;</div></li><li><div>                $table_rows = $this-&gt;get_rows_head_tags( $this-&gt;form, $head_info, $mod );&nbsp;</div></li><li><div>                break; &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'validate':&nbsp;</div></li><li><div>                $table_rows = $this-&gt;get_rows_validate( $this-&gt;form, $head_info, $mod );&nbsp;</div></li><li><div>                break; &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $table_rows;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_rows_social_preview( $form, $head_info, $mod ) {&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_rows = array();&nbsp;</div></li><li><div>        $prev_width = 600;&nbsp;</div></li><li><div>        $prev_height = 315;&nbsp;</div></li><li><div>        $refresh_cache = $this-&gt;p-&gt;util-&gt;is_force_regen( $mod, 'og' ) ? '?force_regen='.time() : '';&nbsp;</div></li><li><div>        $media_url = SucomUtil::get_mt_media_url( $head_info, 'og:image' ).$refresh_cache;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $have_sizes = ( ! empty( $head_info['og:image:width'] ) && $head_info['og:image:width'] &gt; 0 && &nbsp;</div></li><li><div>                ! empty( $head_info['og:image:height'] ) && $head_info['og:image:height'] &gt; 0 ) ? true : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $is_sufficient = ( $have_sizes === true && &nbsp;</div></li><li><div>            $head_info['og:image:width'] &gt;= $prev_width && &nbsp;</div></li><li><div>            $head_info['og:image:height'] &gt;= $prev_height ) ? true : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $media_url ) ) {&nbsp;</div></li><li><div>            if ( $have_sizes === true ) {&nbsp;</div></li><li><div>                $image_preview_html = '&lt;div class=&quot;preview_img&quot; style=&quot;&nbsp;</div></li><li><div>                background-size:'.( $is_sufficient === true ?&nbsp;</div></li><li><div>                    'cover' : $head_info['og:image:width'].' '.$head_info['og:image:height'] ).'; &nbsp;</div></li><li><div>                background-image:url('.$media_url.');&quot; /&gt;'.( $is_sufficient === true ? &nbsp;</div></li><li><div>                    '' : '&lt;p&gt;'.sprintf( _x( 'Image Dimensions Smaller&lt;br/&gt;than Suggested Minimum&lt;br/&gt;of %s', &nbsp;</div></li><li><div>                        'preview image error', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                            $prev_width.'x'.$prev_height.'px' ).'&lt;/p&gt;' ).'&lt;/div&gt;';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $image_preview_html = '&lt;div class=&quot;preview_img&quot; style=&quot;&nbsp;</div></li><li><div>                background-image:url('.$media_url.');&quot; /&gt;&lt;p&gt;'.&nbsp;</div></li><li><div>                _x( 'Image Dimensions Unknown&lt;br/&gt;or Not Available', &nbsp;</div></li><li><div>                    'preview image error', 'nextgen-facebook' ).'&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else $image_preview_html = '&lt;div class=&quot;preview_img&quot;&gt;&lt;p&gt;'.&nbsp;</div></li><li><div>            _x( 'No Open Graph Image Found', 'preview image error', 'nextgen-facebook' ).'&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $mod['post_status'] ) &&&nbsp;</div></li><li><div>            $mod['post_status'] === 'auto-draft' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $auto_draft_msg = sprintf( __( 'Save a draft version or publish the %s to update this value.', &nbsp;</div></li><li><div>                'nextgen-facebook' ), SucomUtil::titleize( $mod['post_type'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $table_rows[] = $form-&gt;get_th_html( _x( 'Sharing URL', &nbsp;</div></li><li><div>                'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>            '&lt;td class=&quot;blank&quot;&gt;&lt;em&gt;'.$auto_draft_msg.'&lt;/em&gt;&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $table_rows[] = $form-&gt;get_th_html( _x( 'Shortened URL', &nbsp;</div></li><li><div>                'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>            '&lt;td class=&quot;blank&quot;&gt;&lt;em&gt;'.$auto_draft_msg.'&lt;/em&gt;&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $long_url = $this-&gt;p-&gt;util-&gt;get_sharing_url( $mod, false );    // $add_page = false&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $mod['is_post'] ) {&nbsp;</div></li><li><div>                $short_url = wp_get_shortlink( $mod['id'], 'post' );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $short_url = apply_filters( $this-&gt;p-&gt;cf['lca'].'_shorten_url', &nbsp;</div></li><li><div>                    $long_url, $this-&gt;p-&gt;options['plugin_shortener'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $table_rows[] = $form-&gt;get_th_html( _x( 'Sharing URL', &nbsp;</div></li><li><div>                'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>            '&lt;td&gt;'.$form-&gt;get_copy_input( $long_url ).'&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $table_rows[] = $form-&gt;get_th_html( _x( 'Shortened URL', &nbsp;</div></li><li><div>                'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>            '&lt;td&gt;'.$form-&gt;get_copy_input( $short_url ).'&lt;/td&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_rows[] = $form-&gt;get_th_html( _x( 'Open Graph Example', &nbsp;</div></li><li><div>            'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>        '&lt;td rowspan=&quot;2&quot; style=&quot;background-color:#e9eaed;border:1px dotted #e0e0e0;&quot;&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;preview_box_border&quot;&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;preview_box&quot;&gt;&nbsp;</div></li><li><div>                '.$image_preview_html.'&nbsp;</div></li><li><div>                &lt;div class=&quot;preview_txt&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;preview_title&quot;&gt;'.( empty( $head_info['og:title'] ) ?&nbsp;</div></li><li><div>                        'No Title' : $head_info['og:title'] ).'&lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;preview_desc&quot;&gt;'.( empty( $head_info['og:description'] ) ?&nbsp;</div></li><li><div>                        'No Description' : $head_info['og:description'] ).'&lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;preview_by&quot;&gt;'.( $_SERVER['SERVER_NAME'].&nbsp;</div></li><li><div>                        ( empty( $this-&gt;p-&gt;options['add_meta_property_article:author'] ) ||&nbsp;</div></li><li><div>                            empty( $head_info['article:author:name'] ) ?&nbsp;</div></li><li><div>                                '' : ' | By '.$head_info['article:author:name'] ) ).'&lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_rows[] = '&lt;th class=&quot;medium textinfo&quot; id=&quot;info-meta-social-preview&quot;&gt;'.&nbsp;</div></li><li><div>            $this-&gt;p-&gt;msgs-&gt;get( 'info-meta-social-preview' ).'&lt;/th&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $table_rows;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_rows_head_tags( &$form, &$head_info, &$mod ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_rows = array();&nbsp;</div></li><li><div>        $script_class = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_array( NgfbMeta::$head_meta_tags ) ) {    // just in case&nbsp;</div></li><li><div>            return $table_rows;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( NgfbMeta::$head_meta_tags as $parts ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( count( $parts ) === 1 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( strpos( $parts[0], '&lt;script ' ) === 0 ) {&nbsp;</div></li><li><div>                    $script_class = 'script';&nbsp;</div></li><li><div>                } elseif ( strpos( $parts[0], '&lt;noscript ' ) === 0 ) {&nbsp;</div></li><li><div>                    $script_class = 'noscript';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $table_rows[] = '&lt;td colspan=&quot;5&quot; class=&quot;html '.&nbsp;</div></li><li><div>                    $script_class.'&quot;&gt;&lt;pre&gt;'.esc_html( $parts[0] ).'&lt;/pre&gt;&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $script_class === 'script' || strpos( $parts[0], '&lt;/noscript&gt;' ) === 0 ) {&nbsp;</div></li><li><div>                    $script_class = '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } elseif ( isset( $parts[5] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // skip meta tags with reserved values but display empty values&nbsp;</div></li><li><div>                if ( $parts[5] === NGFB_UNDEF_INT || $parts[5] === (string) NGFB_UNDEF_INT ) {&nbsp;</div></li><li><div>                    if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                        $this-&gt;p-&gt;debug-&gt;log( $parts[3].' value is '.NGFB_UNDEF_INT.' (skipped)' );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $parts[1] === 'meta' && $parts[2] === 'itemprop' && strpos( $parts[3], '.' ) !== 0 ) {&nbsp;</div></li><li><div>                    $match_name = preg_replace( '/^.*\./', '', $parts[3] );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $match_name = $parts[3];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // convert mixed case itemprop names (for example) to lower case&nbsp;</div></li><li><div>                $opt_name = strtolower( 'add_'.$parts[1].'_'.$parts[2].'_'.$parts[3] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $tr_class = ( empty( $script_class ) ? '' : ' '.$script_class ).&nbsp;</div></li><li><div>                    ( empty( $parts[0] ) ? ' is_disabled' : ' is_enabled' ).&nbsp;</div></li><li><div>                    ( empty( $parts[5] ) && ! empty( $this-&gt;p-&gt;options[$opt_name] ) ? ' is_empty' : '' ).&nbsp;</div></li><li><div>                    ( isset( $this-&gt;p-&gt;options[$opt_name] ) ? ' is_standard' : ' is_internal hide_row_in_basic' ).'&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $table_rows[] = '&lt;tr class=&quot;'.trim( $tr_class ).&nbsp;</div></li><li><div>                '&lt;th class=&quot;xshort&quot;&gt;'.$parts[1].'&lt;/th&gt;'.&nbsp;</div></li><li><div>                '&lt;th class=&quot;xshort&quot;&gt;'.$parts[2].'&lt;/th&gt;'.&nbsp;</div></li><li><div>                '&lt;td class=&quot;&quot;&gt;'.( empty( $parts[6] ) ?&nbsp;</div></li><li><div>                    '' : '&lt;!-- '.$parts[6].' --&gt;' ).$match_name.'&lt;/td&gt;'.&nbsp;</div></li><li><div>                '&lt;th class=&quot;xshort&quot;&gt;'.$parts[4].'&lt;/th&gt;'.&nbsp;</div></li><li><div>                '&lt;td class=&quot;wide&quot;&gt;'.( strpos( $parts[5], 'http' ) === 0 ? &nbsp;</div></li><li><div>                    '&lt;a href=&quot;'.$parts[5].'&quot;&gt;'.$parts[5].'&lt;/a&gt;' : $parts[5] ).'&lt;/td&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $table_rows;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_rows_validate( &$form, &$head_info, &$mod ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_rows = array();&nbsp;</div></li><li><div>        $sharing_url = $this-&gt;p-&gt;util-&gt;get_sharing_url( $mod, false );    // $add_page = false&nbsp;</div></li><li><div>        $sharing_url_encoded = urlencode( $sharing_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $amp_url = $mod['is_post'] && function_exists( 'amp_get_permalink' ) ?&nbsp;</div></li><li><div>            'https://validator.ampproject.org/#url='.urlencode( amp_get_permalink( $mod['id'] ) ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $bing_url = 'https://www.bing.com/webmaster/diagnostics/markup/validator?url='.$sharing_url_encoded;&nbsp;</div></li><li><div>        $facebook_url = 'https://developers.facebook.com/tools/debug/og/object?q='.$sharing_url_encoded;&nbsp;</div></li><li><div>        $google_url = 'https://search.google.com/structured-data/testing-tool/u/0/#url='.$sharing_url_encoded;&nbsp;</div></li><li><div>        $pinterest_url = 'https://developers.pinterest.com/tools/url-debugger/?link='.$sharing_url_encoded;&nbsp;</div></li><li><div>        $twitter_url = 'https://cards-dev.twitter.com/validator';&nbsp;</div></li><li><div>        $w3c_url = 'https://validator.w3.org/nu/?doc='.$sharing_url_encoded;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Facebook&nbsp;</div></li><li><div>        $table_rows[] = $form-&gt;get_th_html( _x( 'Facebook Debugger', 'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$this-&gt;p-&gt;msgs-&gt;get( 'info-meta-validate-facebook' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$form-&gt;get_button( _x( 'Validate Open Graph', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div>            'button-secondary', '', $facebook_url, true ).'&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Google&nbsp;</div></li><li><div>        $table_rows[] = $form-&gt;get_th_html( _x( 'Google Structured Data Testing Tool', 'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$this-&gt;p-&gt;msgs-&gt;get( 'info-meta-validate-google' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$form-&gt;get_button( _x( 'Validate Data Markup', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div>            'button-secondary', '', $google_url, true ).'&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Pinterest&nbsp;</div></li><li><div>        $table_rows[] = $form-&gt;get_th_html( _x( 'Pinterest Rich Pin Validator', 'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$this-&gt;p-&gt;msgs-&gt;get( 'info-meta-validate-pinterest' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$form-&gt;get_button( _x( 'Validate Rich Pins', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div>            'button-secondary', '', $pinterest_url, true ).'&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Twitter&nbsp;</div></li><li><div>        $table_rows[] = $form-&gt;get_th_html( _x( 'Twitter Card Validator', 'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$this-&gt;p-&gt;msgs-&gt;get( 'info-meta-validate-twitter' ).$form-&gt;get_copy_input( $sharing_url ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$form-&gt;get_button( _x( 'Validate Twitter Card', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div>            'button-secondary', '', $twitter_url, true ).'&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // W3C&nbsp;</div></li><li><div>        $table_rows[] = $form-&gt;get_th_html( _x( 'W3C Markup Validation', 'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$this-&gt;p-&gt;msgs-&gt;get( 'info-meta-validate-w3c' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>        '&lt;td class=&quot;validate&quot;&gt;'.$form-&gt;get_button( _x( 'Validate HTML Markup', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div>            'button-secondary', '', $w3c_url, true ).'&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // AMP&nbsp;</div></li><li><div>        if ( $mod['is_post'] ) {&nbsp;</div></li><li><div>            $table_rows[] = $form-&gt;get_th_html( _x( 'The AMP Validator', 'option label', 'nextgen-facebook' ), 'medium' ).&nbsp;</div></li><li><div>            '&lt;td class=&quot;validate&quot;&gt;'.$this-&gt;p-&gt;msgs-&gt;get( 'info-meta-validate-amp' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>            '&lt;td class=&quot;validate&quot;&gt;'.$form-&gt;get_button( _x( 'Validate AMP Markup', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                'button-secondary', '', $amp_url, true, ( $amp_url ? false : true ) ).'&lt;/td&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $table_rows;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Return a specific option from the custom social settings meta with fallback for &nbsp;</div></li><li><div>     * multiple option keys. If $md_idx is an array, then get the first non-empty option &nbsp;</div></li><li><div>     * from the options array. This is an easy way to provide a fallback value for the &nbsp;</div></li><li><div>     * first array key. Use 'none' as a key name to skip this fallback behavior.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Example: get_options_multi( $id, array( 'p_desc', 'og_desc' ) );&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_options_multi( $mod_id, $mixed = false, $filter_opts = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                'mod_id' =&gt; $mod_id, &nbsp;</div></li><li><div>                'mixed' =&gt; $mixed, &nbsp;</div></li><li><div>                'filter_opts' =&gt; $filter_opts, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $mod_id ) ) {&nbsp;</div></li><li><div>            return null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // return the whole options array&nbsp;</div></li><li><div>        if ( $mixed === false ) {&nbsp;</div></li><li><div>            $md_val = $this-&gt;get_options( $mod_id, $mixed, $filter_opts );&nbsp;</div></li><li><div>        // return the first matching index value&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( ! is_array( $mixed ) ) {        // convert a string to an array&nbsp;</div></li><li><div>                $mixed = array( $mixed );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $mixed = array_unique( $mixed );    // prevent duplicate idx values&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            foreach ( $mixed as $md_idx ) {&nbsp;</div></li><li><div>                if ( $md_idx === 'none' ) {    // special index keyword&nbsp;</div></li><li><div>                    return null;&nbsp;</div></li><li><div>                } elseif ( empty( $md_idx ) ) {    // just in case&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                        $this-&gt;p-&gt;debug-&gt;log( 'getting id '.$mod_id.' option '.$md_idx.' value' );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ( $md_val = $this-&gt;get_options( $mod_id, $md_idx, $filter_opts ) ) !== null ) {&nbsp;</div></li><li><div>                        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                            $this-&gt;p-&gt;debug-&gt;log( 'option '.$md_idx.' value found (not null)' );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;        // stop after first match&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $md_val !== null ) {&nbsp;</div></li><li><div>            if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                $mod = $this-&gt;get_mod( $mod_id );&nbsp;</div></li><li><div>                $this-&gt;p-&gt;debug-&gt;log( 'custom '.$mod['name'].' '.( $mixed === false ? 'options' : &nbsp;</div></li><li><div>                    ( is_array( $mixed ) ? implode( ', ', $mixed ) : $mixed ) ).' = '.&nbsp;</div></li><li><div>                    ( is_array( $md_val ) ? print_r( $md_val, true ) : '&quot;'.$md_val.'&quot;' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $md_val;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_options( $mod_id, $idx = false, $filter_opts = true ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, &nbsp;</div></li><li><div>            ( $idx !== false ? null : array() ) );    // return an empty array or null&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_defaults( $mod_id, $idx = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $this-&gt;defs[$mod_id] ) )&nbsp;</div></li><li><div>            $this-&gt;defs[$mod_id] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $opts =& $this-&gt;p-&gt;options;        // shortcut&nbsp;</div></li><li><div>        $md_defs =& $this-&gt;defs[$mod_id];    // shortcut&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! NgfbOptions::can_cache() || &nbsp;</div></li><li><div>            empty( $md_defs['options_filtered'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $md_defs = array(&nbsp;</div></li><li><div>                'options_filtered' =&gt; '', &nbsp;</div></li><li><div>                'options_version' =&gt; '', &nbsp;</div></li><li><div>                'og_art_section' =&gt; isset( $opts['og_art_section'] ) ? $opts['og_art_section'] : 'none', &nbsp;</div></li><li><div>                'og_title' =&gt; '', &nbsp;</div></li><li><div>                'og_desc' =&gt; '', &nbsp;</div></li><li><div>                'seo_desc' =&gt; '', &nbsp;</div></li><li><div>                'tc_desc' =&gt; '', &nbsp;</div></li><li><div>                'pin_desc' =&gt; '', &nbsp;</div></li><li><div>                'schema_desc' =&gt; '', &nbsp;</div></li><li><div>                'sharing_url' =&gt; '', &nbsp;</div></li><li><div>                'og_img_id' =&gt; '', &nbsp;</div></li><li><div>                'og_img_id_pre' =&gt; empty( $opts['og_def_img_id_pre'] ) ? '' : $opts['og_def_img_id_pre'], &nbsp;</div></li><li><div>                'og_img_width' =&gt; '', &nbsp;</div></li><li><div>                'og_img_height' =&gt; '', &nbsp;</div></li><li><div>                'og_img_crop' =&gt; empty( $opts['og_img_crop'] ) ? 0 : 1, &nbsp;</div></li><li><div>                'og_img_crop_x' =&gt; empty( $opts['og_img_crop_x'] ) ? 'center' : $opts['og_img_crop_x'], &nbsp;</div></li><li><div>                'og_img_crop_y' =&gt; empty( $opts['og_img_crop_y'] ) ? 'center' : $opts['og_img_crop_y'], &nbsp;</div></li><li><div>                'og_img_url' =&gt; '', &nbsp;</div></li><li><div>                'og_img_max' =&gt; isset( $opts['og_img_max'] ) ? (int) $opts['og_img_max'] : 1, // cast as integer&nbsp;</div></li><li><div>                'og_vid_url' =&gt; '', &nbsp;</div></li><li><div>                'og_vid_embed' =&gt; '', &nbsp;</div></li><li><div>                'og_vid_title' =&gt; '', &nbsp;</div></li><li><div>                'og_vid_desc' =&gt; '', &nbsp;</div></li><li><div>                'og_vid_max' =&gt; isset( $opts['og_vid_max'] ) ? (int) $opts['og_vid_max'] : 1, // cast as integer&nbsp;</div></li><li><div>                'og_vid_prev_img' =&gt; empty( $opts['og_vid_prev_img'] ) ? 0 : 1, &nbsp;</div></li><li><div>                'p_img_id' =&gt; '', &nbsp;</div></li><li><div>                'p_img_id_pre' =&gt; empty( $opts['og_def_img_id_pre'] ) ? '' : $opts['og_def_img_id_pre'], &nbsp;</div></li><li><div>                'p_img_width' =&gt; '', &nbsp;</div></li><li><div>                'p_img_height' =&gt; '', &nbsp;</div></li><li><div>                'p_img_crop' =&gt; empty( $opts['p_img_crop'] ) ? 0 : 1, &nbsp;</div></li><li><div>                'p_img_crop_x' =&gt; empty( $opts['p_img_crop_x'] ) ? 'center' : $opts['p_img_crop_x'], &nbsp;</div></li><li><div>                'p_img_crop_y' =&gt; empty( $opts['p_img_crop_y'] ) ? 'center' : $opts['p_img_crop_y'], &nbsp;</div></li><li><div>                'p_img_url' =&gt; '', &nbsp;</div></li><li><div>                'schema_img_id' =&gt; '', &nbsp;</div></li><li><div>                'schema_img_id_pre' =&gt; empty( $opts['og_def_img_id_pre'] ) ? '' : $opts['og_def_img_id_pre'], &nbsp;</div></li><li><div>                'schema_img_width' =&gt; '', &nbsp;</div></li><li><div>                'schema_img_height' =&gt; '', &nbsp;</div></li><li><div>                'schema_img_crop' =&gt; empty( $opts['schema_img_crop'] ) ? 0 : 1, &nbsp;</div></li><li><div>                'schema_img_crop_x' =&gt; empty( $opts['schema_img_crop_x'] ) ? 'center' : $opts['schema_img_crop_x'], &nbsp;</div></li><li><div>                'schema_img_crop_y' =&gt; empty( $opts['schema_img_crop_y'] ) ? 'center' : $opts['schema_img_crop_y'], &nbsp;</div></li><li><div>                'schema_img_url' =&gt; '', &nbsp;</div></li><li><div>                'schema_img_max' =&gt; isset( $opts['schema_img_max'] ) ? (int) $opts['schema_img_max'] : 1, // cast as integer&nbsp;</div></li><li><div>                'product_avail' =&gt; 'none', &nbsp;</div></li><li><div>                'product_condition' =&gt; 'none', &nbsp;</div></li><li><div>                'product_price' =&gt; '0.00', &nbsp;</div></li><li><div>                'product_currency' =&gt; NGFB_PROD_CURRENCY, &nbsp;</div></li><li><div>                'gv_id_title' =&gt; 0, &nbsp;</div></li><li><div>                'gv_id_desc' =&gt; 0, &nbsp;</div></li><li><div>                'gv_id_img' =&gt; 0, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $md_defs = apply_filters( $this-&gt;p-&gt;cf['lca'].'_get_md_defaults', $md_defs, $this-&gt;get_mod( $mod_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( NgfbOptions::can_cache() ) {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'setting options_filtered to true' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $md_defs['options_filtered'] = true;&nbsp;</div></li><li><div>            } elseif ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                $this-&gt;p-&gt;debug-&gt;log( 'options_filtered value unchanged' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } elseif ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log( 'get_defaults filter skipped' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $idx !== false ) {&nbsp;</div></li><li><div>            if ( isset( $md_defs[$idx] ) ) {&nbsp;</div></li><li><div>                return $md_defs[$idx];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return null;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $md_defs;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function save_options( $mod_id, $rel_id = false ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, $mod_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function clear_cache( $mod_id, $rel_id = false ) {&nbsp;</div></li><li><div>        // nothing to do&nbsp;</div></li><li><div>        return $mod_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function delete_options( $mod_id, $rel_id = false ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, $mod_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function not_implemented( $method, $ret = true ) {&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log( $method.' not implemented in this version', &nbsp;</div></li><li><div>                get_class( $this ) );    // log the extended class name&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $ret;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function must_be_extended( $method, $ret = true ) {&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log( $method.' must be extended', &nbsp;</div></li><li><div>                get_class( $this ) );    // log the extended class name&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $ret;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function verify_submit_nonce() {&nbsp;</div></li><li><div>        if ( empty( $_POST ) ) {&nbsp;</div></li><li><div>            if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                $this-&gt;p-&gt;debug-&gt;log( 'empty POST for submit' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        } elseif ( empty( $_POST[ NGFB_NONCE ] ) ) {&nbsp;</div></li><li><div>            if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                $this-&gt;p-&gt;debug-&gt;log( 'submit POST missing nonce token' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        } elseif ( ! wp_verify_nonce( $_POST[ NGFB_NONCE ], NgfbAdmin::get_nonce() ) ) {&nbsp;</div></li><li><div>            if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                $this-&gt;p-&gt;debug-&gt;log( 'submit nonce token validation failed' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( is_admin() ) {&nbsp;</div></li><li><div>                $this-&gt;p-&gt;notice-&gt;err( __( 'Nonce token validation failed for the submitted form (update ignored).', &nbsp;</div></li><li><div>                    'nextgen-facebook' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        } else return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function get_submit_opts( $mod_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $mod = $this-&gt;get_mod( $mod_id );&nbsp;</div></li><li><div>        $md_defs = $this-&gt;get_defaults( $mod['id'] );&nbsp;</div></li><li><div>        $md_prev = $this-&gt;get_options( $mod['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Remove plugin / extension version strings.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $unset_idx = array( 'options_filtered', 'options_version' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>            if ( isset( $info['opt_version'] ) ) {&nbsp;</div></li><li><div>                $unset_idx[] = 'plugin_'.$ext.'_opt_version';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $unset_idx as $md_idx ) {&nbsp;</div></li><li><div>            unset( $md_defs[$md_idx], $md_prev[$md_idx] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Merge and sanitize the new options.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $md_opts = empty( $_POST[ NGFB_META_NAME ] ) ?            // make sure we have an array&nbsp;</div></li><li><div>            array() : $_POST[ NGFB_META_NAME ];&nbsp;</div></li><li><div>        $md_opts = SucomUtil::restore_checkboxes( $md_opts );&nbsp;</div></li><li><div>        $md_opts = array_merge( $md_prev, $md_opts );                // update the previous options array&nbsp;</div></li><li><div>        $md_opts = $this-&gt;p-&gt;opt-&gt;sanitize( $md_opts, $md_defs, false, $mod );    // $network = false&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Check image size options (id, prefix, width, height, crop, etc.).&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        foreach ( array( 'p', 'og' ) as $md_pre ) {&nbsp;</div></li><li><div>            if ( empty( $md_opts[$md_pre.'_img_id'] ) ) {&nbsp;</div></li><li><div>                unset( $md_opts[$md_pre.'_img_id_pre'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $force_regen = false;&nbsp;</div></li><li><div>            foreach ( array( 'width', 'height', 'crop', 'crop_x', 'crop_y' ) as $md_suffix ) {&nbsp;</div></li><li><div>                // if option is the same as the default, then unset it&nbsp;</div></li><li><div>                if ( isset( $md_opts[$md_pre.'_img_'.$md_suffix] ) &&&nbsp;</div></li><li><div>                    isset( $md_defs[$md_pre.'_img_'.$md_suffix] ) &&&nbsp;</div></li><li><div>                        $md_opts[$md_pre.'_img_'.$md_suffix] === $md_defs[$md_pre.'_img_'.$md_suffix] ) {&nbsp;</div></li><li><div>                    unset( $md_opts[$md_pre.'_img_'.$md_suffix] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $check_current = isset( $md_opts[$md_pre.'_img_'.$md_suffix] ) ?&nbsp;</div></li><li><div>                    $md_opts[$md_pre.'_img_'.$md_suffix] : '';&nbsp;</div></li><li><div>                $check_previous = isset( $md_prev[$md_pre.'_img_'.$md_suffix] ) ?&nbsp;</div></li><li><div>                    $md_prev[$md_pre.'_img_'.$md_suffix] : '';&nbsp;</div></li><li><div>                if ( $check_current !== $check_previous ) {&nbsp;</div></li><li><div>                    $force_regen = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $force_regen !== false ) {&nbsp;</div></li><li><div>                $this-&gt;p-&gt;util-&gt;set_force_regen( $mod, $md_pre );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Remove &quot;use plugin settings&quot;, or &quot;same as default&quot; option values, or empty strings.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        foreach ( $md_opts as $md_idx =&gt; $md_val ) {&nbsp;</div></li><li><div>            // use strict comparison to manage conversion (don't allow string to integer conversion, for example)&nbsp;</div></li><li><div>            if ( $md_val === '' || $md_val === NGFB_UNDEF_INT || $md_val === (string) NGFB_UNDEF_INT || &nbsp;</div></li><li><div>                ( isset( $md_defs[$md_idx] ) && ( $md_val === $md_defs[$md_idx] || $md_val === (string) $md_defs[$md_idx] ) ) ) {&nbsp;</div></li><li><div>                unset( $md_opts[$md_idx] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Renumber multi options (example: recipe ingredients and instructions).&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        foreach ( $this-&gt;p-&gt;cf['opt']['md_multi'] as $md_multi =&gt; $is_multi ) {&nbsp;</div></li><li><div>            $md_renum = array();    // start with a fresh array&nbsp;</div></li><li><div>            foreach ( SucomUtil::preg_grep_keys( '/^'.$md_multi.'_[0-9]+$/', $md_opts ) as $md_idx =&gt; $md_val ) {&nbsp;</div></li><li><div>                unset( $md_opts[$md_idx] );&nbsp;</div></li><li><div>                if ( ! empty( $md_val ) ) {&nbsp;</div></li><li><div>                    $md_renum[] = $md_val;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            foreach ( $md_renum as $num =&gt; $md_val ) {    // start at 0&nbsp;</div></li><li><div>                $md_opts[$md_multi.'_'.$num] = $md_val;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Mark the new options as current.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( ! empty( $md_opts ) ) {&nbsp;</div></li><li><div>            $md_opts['options_version'] = $this-&gt;p-&gt;cf['opt']['version'];&nbsp;</div></li><li><div>            foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>                if ( isset( $info['opt_version'] ) ) {&nbsp;</div></li><li><div>                    $md_opts['plugin_'.$ext.'_opt_version'] = $info['opt_version'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $md_opts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // return sortable column keys and their query sort info&nbsp;</div></li><li><div>    public static function get_sortable_columns( $col_idx = false ) { &nbsp;</div></li><li><div>        $sort_cols = NgfbConfig::$cf['edit']['columns'];&nbsp;</div></li><li><div>        if ( $col_idx !== false ) {&nbsp;</div></li><li><div>            if ( isset( $sort_cols[$col_idx] ) ) {&nbsp;</div></li><li><div>                return $sort_cols[$col_idx];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return null;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $sort_cols;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // called from the uninstall static method&nbsp;</div></li><li><div>    public static function get_column_meta_keys() { &nbsp;</div></li><li><div>        $meta_keys = array();&nbsp;</div></li><li><div>        $sort_cols = self::get_sortable_columns();&nbsp;</div></li><li><div>        foreach ( $sort_cols as $col_idx =&gt; $col_info ) {&nbsp;</div></li><li><div>            if ( ! empty( $col_info['meta_key'] ) ) {&nbsp;</div></li><li><div>                $meta_keys[$col_idx] = $col_info['meta_key'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $meta_keys;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function get_column_headers() { &nbsp;</div></li><li><div>        $headers = array();&nbsp;</div></li><li><div>        $sort_cols = self::get_sortable_columns();&nbsp;</div></li><li><div>        foreach ( $sort_cols as $col_idx =&gt; $col_info ) {&nbsp;</div></li><li><div>            if ( ! empty( $col_info['header'] ) ) {&nbsp;</div></li><li><div>                $headers[$col_idx] = _x( $col_info['header'], &nbsp;</div></li><li><div>                    'column header', 'nextgen-facebook' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $headers;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_column_content( $value, $column_name, $id ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, $value );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function update_sortable_meta( $obj_id, $col_idx, $content ) { &nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__ );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function add_sortable_columns( $columns ) { &nbsp;</div></li><li><div>        $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>        foreach ( self::get_sortable_columns() as $col_idx =&gt; $col_info ) {&nbsp;</div></li><li><div>            if ( ! empty( $col_info['orderby'] ) ) {&nbsp;</div></li><li><div>                $columns[$lca.'_'.$col_idx] = $lca.'_'.$col_idx;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $columns;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function set_column_orderby( $query ) { &nbsp;</div></li><li><div>        $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>        $col_name = $query-&gt;get( 'orderby' );&nbsp;</div></li><li><div>        if ( is_string( $col_name ) && strpos( $col_name, $lca.'_' ) === 0 ) {&nbsp;</div></li><li><div>            $col_idx = str_replace( $lca.'_', '', $col_name );&nbsp;</div></li><li><div>            if ( ( $col_info = self::get_sortable_columns( $col_idx ) ) !== null ) {&nbsp;</div></li><li><div>                foreach ( array( 'meta_key', 'orderby' ) as $set_name ) {&nbsp;</div></li><li><div>                    if ( ! empty( $col_info[$set_name] ) ) {&nbsp;</div></li><li><div>                        $query-&gt;set( $set_name, $col_info[$set_name] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function add_mod_column_headings( $columns, $mod_name = '' ) { &nbsp;</div></li><li><div>        if ( ! empty( $mod_name ) ) {&nbsp;</div></li><li><div>            $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>            foreach ( self::get_column_headers() as $col_idx =&gt; $col_header ) {&nbsp;</div></li><li><div>                if ( ! empty( $this-&gt;p-&gt;options['plugin_'.$col_idx.'_col_'.$mod_name] ) ) {&nbsp;</div></li><li><div>                    $columns[$lca.'_'.$col_idx] = $col_header;&nbsp;</div></li><li><div>                    if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                        $this-&gt;p-&gt;debug-&gt;log( 'adding '.$lca.'_'.$col_idx.' column' );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $columns;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_og_img_column_html( $head_info, $mod ) {&nbsp;</div></li><li><div>        $value = false;&nbsp;</div></li><li><div>        $force_regen = $this-&gt;p-&gt;util-&gt;is_force_regen( $mod, 'og' );    // false by default&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $head_info['og:image:id'] ) && &nbsp;</div></li><li><div>            $head_info['og:image:id'] &gt; 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                $this-&gt;p-&gt;debug-&gt;log( 'getting thumbnail for image id '.$head_info['og:image:id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            list(&nbsp;</div></li><li><div>                $og_img_thumb['og:image'], &nbsp;</div></li><li><div>                $og_img_thumb['og:image:width'], &nbsp;</div></li><li><div>                $og_img_thumb['og:image:height'], &nbsp;</div></li><li><div>                $og_img_thumb['og:image:cropped'], &nbsp;</div></li><li><div>                $og_img_thumb['og:image:id']&nbsp;</div></li><li><div> ) = $this-&gt;p-&gt;media-&gt;get_attachment_image_src( $head_info['og:image:id'], 'thumbnail', false, $force_regen );&nbsp;</div></li><li><div>            if ( ! empty( $og_img_thumb['og:image'] ) )    // just in case&nbsp;</div></li><li><div>                $head_info =& $og_img_thumb;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $refresh_cache = $force_regen ? '?force_regen='.time() : '';&nbsp;</div></li><li><div>        $media_url = SucomUtil::get_mt_media_url( $head_info, 'og:image' ).$refresh_cache;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $media_url ) )&nbsp;</div></li><li><div>            $value = '&lt;div class=&quot;preview_img&quot; style=&quot;background-image:url('.$media_url.');&quot;&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_og_image( $num, $size_name, $mod_id, $check_dupes = true, $force_regen = false, $md_pre = 'og' ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, array() );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_md_image( $num, $size_name, array $mod, $check_dupes = true, $force_regen = false, $md_pre = 'og', $mt_pre = 'og' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                'num' =&gt; $num, &nbsp;</div></li><li><div>                'size_name' =&gt; $size_name, &nbsp;</div></li><li><div>                'mod' =&gt; $mod, &nbsp;</div></li><li><div>                'check_dupes' =&gt; $check_dupes, &nbsp;</div></li><li><div>                'force_regen' =&gt; $force_regen, &nbsp;</div></li><li><div>                'md_pre' =&gt; $md_pre, &nbsp;</div></li><li><div>                'mt_pre' =&gt; $mt_pre, &nbsp;</div></li><li><div> ), get_class( $this ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>        $meta_ret = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $mod['id'] ) ) {&nbsp;</div></li><li><div>            return $meta_ret;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // unless $md_pre is 'none' allways fallback to the 'og' custom meta&nbsp;</div></li><li><div>        foreach( array_unique( array( $md_pre, 'og' ) ) as $prefix ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $prefix === 'none' ) {    // special index keyword&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            } elseif ( empty( $prefix ) ) {    // skip empty md_pre values&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $meta_image = SucomUtil::get_mt_prop_image( $mt_pre );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // get the image id, library prefix, and/or url values&nbsp;</div></li><li><div>            $pid = $this-&gt;get_options( $mod['id'], $prefix.'_img_id' );&nbsp;</div></li><li><div>            $pre = $this-&gt;get_options( $mod['id'], $prefix.'_img_id_pre' );&nbsp;</div></li><li><div>            $url = $this-&gt;get_options( $mod['id'], $prefix.'_img_url' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $pid &gt; 0 ) {&nbsp;</div></li><li><div>                $pid = $pre === 'ngg' ? 'ngg-'.$pid : $pid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'using custom '.$prefix.' image id = &quot;'.$pid.'&quot;', &nbsp;</div></li><li><div>                        get_class( $this ) );    // log extended class name&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                list( &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:width'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:height'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:cropped'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:id']&nbsp;</div></li><li><div> ) = $this-&gt;p-&gt;media-&gt;get_attachment_image_src( $pid, $size_name, $check_dupes, $force_regen );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $meta_image[$mt_pre.':image'] ) && ! empty( $url ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'using custom '.$prefix.' image url = &quot;'.$url.'&quot;', &nbsp;</div></li><li><div>                        get_class( $this ) );    // log extended class name&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $width = $this-&gt;get_options( $mod['id'], $prefix.'_img_url:width' );&nbsp;</div></li><li><div>                $height = $this-&gt;get_options( $mod['id'], $prefix.'_img_url:height' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                list(&nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:width'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:height']&nbsp;</div></li><li><div> ) = array(&nbsp;</div></li><li><div>                    $url, &nbsp;</div></li><li><div>                    ( $width &gt; 0 ? $width : NGFB_UNDEF_INT ), &nbsp;</div></li><li><div>                    ( $height &gt; 0 ? $height : NGFB_UNDEF_INT )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $meta_image[$mt_pre.':image'] ) &&&nbsp;</div></li><li><div>                $this-&gt;p-&gt;util-&gt;push_max( $meta_ret, $meta_image, $num ) ) {&nbsp;</div></li><li><div>                    return $meta_ret;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( apply_filters( $lca.'_'.$mod['name'].'_image_ids', array(), $size_name, $mod['id'], $mod ) as $pid ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $pid &gt; 0 ) {    // quick sanity check&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'adding image pid: '.$pid );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $meta_image = SucomUtil::get_mt_prop_image( $mt_pre );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                list( &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:width'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:height'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:cropped'], &nbsp;</div></li><li><div>                    $meta_image[$mt_pre.':image:id']&nbsp;</div></li><li><div> ) = $this-&gt;p-&gt;media-&gt;get_attachment_image_src( $pid, $size_name, $check_dupes, $force_regen );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! empty( $meta_image[$mt_pre.':image'] ) &&&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;util-&gt;push_max( $meta_ret, $meta_image, $num ) )&nbsp;</div></li><li><div>                        return $meta_ret;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( apply_filters( $lca.'_'.$mod['name'].'_image_urls', array(), $size_name, $mod['id'], $mod ) as $url ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( strpos( $url, '://' ) !== false ) {    // quick sanity check&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'adding image url: '.$url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $meta_image = SucomUtil::get_mt_prop_image( $mt_pre );&nbsp;</div></li><li><div>                $meta_image[$mt_pre.':image'] = $url;&nbsp;</div></li><li><div>                $this-&gt;p-&gt;util-&gt;add_image_url_size( $mt_pre.':image', $meta_image );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! empty( $meta_image[$mt_pre.':image'] ) &&&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;util-&gt;push_max( $meta_ret, $meta_image, $num ) ) {&nbsp;</div></li><li><div>                    return $meta_ret;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $meta_ret;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_og_video( $num = 0, $mod_id, $check_dupes = false, $md_pre = 'og', $mt_pre = 'og' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                'num' =&gt; $num, &nbsp;</div></li><li><div>                'mod_id' =&gt; $mod_id, &nbsp;</div></li><li><div>                'check_dupes' =&gt; $check_dupes, &nbsp;</div></li><li><div>                'md_pre' =&gt; $md_pre, &nbsp;</div></li><li><div>                'mt_pre' =&gt; $mt_pre, &nbsp;</div></li><li><div> ), get_class( $this ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $mod = $this-&gt;get_mod( $mod_id );    // required for get_content_videos()&nbsp;</div></li><li><div>        $og_ret = array();&nbsp;</div></li><li><div>        $og_video = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $mod_id ) ) {&nbsp;</div></li><li><div>            return $og_ret;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach( array_unique( array( $md_pre, 'og' ) ) as $prefix ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $html = $this-&gt;get_options( $mod_id, $prefix.'_vid_embed' );&nbsp;</div></li><li><div>            $url = $this-&gt;get_options( $mod_id, $prefix.'_vid_url' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $html ) ) {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'fetching video(s) from custom '.$prefix.' embed code', &nbsp;</div></li><li><div>                        get_class( $this ) );    // log extended class name&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $og_video = $this-&gt;p-&gt;media-&gt;get_content_videos( $num, $mod, $check_dupes, $html );&nbsp;</div></li><li><div>                if ( ! empty( $og_video ) ) {&nbsp;</div></li><li><div>                    return array_merge( $og_ret, $og_video );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $url ) && ( $check_dupes == false || $this-&gt;p-&gt;util-&gt;is_uniq_url( $url ) ) ) {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'fetching video from custom '.$prefix.' url '.$url, &nbsp;</div></li><li><div>                        get_class( $this ) );    // log extended class name&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $og_video = $this-&gt;p-&gt;media-&gt;get_video_info( $url, &nbsp;</div></li><li><div>                    NGFB_UNDEF_INT, NGFB_UNDEF_INT, $check_dupes, true );    // $fallback = true&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;util-&gt;push_max( $og_ret, $og_video, $num ) )  {&nbsp;</div></li><li><div>                    return $og_ret;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $og_ret;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_og_video_preview_image( $mod, $check_dupes = false, $md_pre = 'og' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                'mod' =&gt; $mod, &nbsp;</div></li><li><div>                'check_dupes' =&gt; $check_dupes, &nbsp;</div></li><li><div>                'md_pre' =&gt; $md_pre, &nbsp;</div></li><li><div> ), get_class( $this ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $og_image = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // fallback to value from general plugin settings&nbsp;</div></li><li><div>        if ( ( $use_prev_img = $this-&gt;get_options( $mod['id'], 'og_vid_prev_img' ) ) === null )&nbsp;</div></li><li><div>            $use_prev_img = $this-&gt;p-&gt;options['og_vid_prev_img'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get video preview images if allowed&nbsp;</div></li><li><div>        if ( ! empty( $use_prev_img ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // assumes the first video will have a preview image&nbsp;</div></li><li><div>            $og_video = $this-&gt;p-&gt;og-&gt;get_all_videos( 1, $mod, $check_dupes, $md_pre );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $og_video ) && is_array( $og_video ) ) {&nbsp;</div></li><li><div>                foreach ( $og_video as $video ) {&nbsp;</div></li><li><div>                    if ( ! empty( $video['og:image'] ) ) {&nbsp;</div></li><li><div>                        $og_image[] = $video;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;log( 'use_prev_img is 0 - skipping retrieval of video preview image' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $og_image;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_og_type_reviews( $mod_id, $og_type = 'product', $rating_meta = 'rating' ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, $array() );    // return an empty array&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_og_review_mt( $comment_obj, $og_type = 'product', $rating_meta = 'rating' ) {&nbsp;</div></li><li><div>        return $this-&gt;must_be_extended( __METHOD__, $array() );    // return an empty array&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // $wp_meta can be a post/term/user meta array or empty / false&nbsp;</div></li><li><div>    protected function get_custom_fields( array $md_opts, $wp_meta = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>            $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $wp_meta ) || ! is_array( $wp_meta ) ) {&nbsp;</div></li><li><div>            if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                $this-&gt;p-&gt;debug-&gt;log( 'wp_meta provided is empty or not an array' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $md_opts;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $charset = get_bloginfo( 'charset' );    // required for html_entity_decode()&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( (array) apply_filters( $this-&gt;p-&gt;cf['lca'].'_get_cf_md_idx', &nbsp;</div></li><li><div>            $this-&gt;p-&gt;cf['opt']['cf_md_idx'] ) as $cf_idx =&gt; $md_idx ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // custom fields can be disabled by filters&nbsp;</div></li><li><div>            if ( empty( $md_idx ) ) {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'custom field '.$cf_idx.' index is disabled' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            // check that a custom field meta key has been defined&nbsp;</div></li><li><div>            // example: 'plugin_cf_img_url' = '_format_image_url'&nbsp;</div></li><li><div>            } elseif ( ! empty( $this-&gt;p-&gt;options[$cf_idx] ) ) {&nbsp;</div></li><li><div>                $meta_key = $this-&gt;p-&gt;options[$cf_idx];&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'custom field '.$cf_idx.' option has meta key '.$meta_key );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'custom field '.$cf_idx.' option is empty' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // empty or not, if the array element is set, use it&nbsp;</div></li><li><div>            if ( isset( $wp_meta[$meta_key][0] ) ) {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( $meta_key.' meta key found for '.$md_idx.' option' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $mixed =& $wp_meta[$meta_key][0];&nbsp;</div></li><li><div>            } else continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $mixed = maybe_unserialize( $mixed );&nbsp;</div></li><li><div>            $values = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // decode the string or each array element&nbsp;</div></li><li><div>            if ( is_array( $mixed ) ) {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( $meta_key.' is array of '.count( $mixed ).' values (decoding each value)' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                foreach ( $mixed as $value ) {&nbsp;</div></li><li><div>                    if ( is_array( $value ) ) {&nbsp;</div></li><li><div>                        $value = SucomUtil::array_implode( $value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $values[] = trim( html_entity_decode( SucomUtil::decode_utf8( $value ), ENT_QUOTES, $charset ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                    $this-&gt;p-&gt;debug-&gt;log( 'decoding '.$meta_key.' as string of '.strlen( $mixed ).' chars' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $values[] = trim( html_entity_decode( SucomUtil::decode_utf8( $mixed ), ENT_QUOTES, $charset ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;p-&gt;cf['opt']['md_multi'][$md_idx] ) ) {&nbsp;</div></li><li><div>                if ( ! is_array( $mixed ) ) {&nbsp;</div></li><li><div>                    $values = array_map( 'trim', explode( PHP_EOL, reset( $values ) ) );    // explode first element into array&nbsp;</div></li><li><div>                    if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                        $this-&gt;p-&gt;debug-&gt;log( 'exploded '.$meta_key.' into array of '.count( $values ).' elements' );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $is_multi = true;        // increment the option name&nbsp;</div></li><li><div>            } else $is_multi = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // increment the option name, starting with 0&nbsp;</div></li><li><div>            if ( $is_multi ) {&nbsp;</div></li><li><div>                // remove any old values from the options array&nbsp;</div></li><li><div>                $md_opts = SucomUtil::preg_grep_keys( '/^'.$md_idx.'_[0-9]+$/', $md_opts, true );    // $invert = true&nbsp;</div></li><li><div>                foreach ( $values as $num =&gt; $value ) {&nbsp;</div></li><li><div>                    $md_opts[$md_idx.'_'.$num] = $value;&nbsp;</div></li><li><div>                    $md_opts[$md_idx.'_'.$num.':is'] = 'disabled';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $md_opts[$md_idx] = reset( $values );    // get first element of $values array&nbsp;</div></li><li><div>                $md_opts[$md_idx.':is'] = 'disabled';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $md_opts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 8.20.1.2</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/classes/ngfb_meta/" class="active">8.43.0</a></li><li><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/classes/ngfb_meta/" class="">8.35.4-1</a></li><li><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.21.0/classes/ngfb_meta/" class="">8.21.0</a></li><li><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.20.1.3/classes/ngfb_meta/" class="">8.20.1.3</a></li><li><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.20.1.2/classes/ngfb_meta/" class="">8.20.1.2</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>NgfbMeta</li><li><span></span>wp-plugin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>