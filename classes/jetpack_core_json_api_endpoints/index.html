<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-id="11795"><head xmlns="http://www.w3.org/1999/xhtml"><title> jetpack_core_json_api_endpoints | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Jetpack_Core_Json_Api_Endpoints, class, plugin, jetpack, 4.9" /><meta name="description" content="Class Jetpack_Core_Json_Api_Endpoints" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=b64d2aac4a4bba9d36f73d7d60a49d41' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/jetpack_core_json_api_endpoints/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fjetpack_core_json_api_endpoints%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fjetpack_core_json_api_endpoints%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.9-class-jetpack_core_json_api_endpoints","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="jetpack_core_json_api_endpoints" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to jetpack." href="http://hookr.io/plugins/jetpack/" class="plugin"><span property="name">jetpack</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.9." href="http://hookr.io/plugins/jetpack/4.9/" class="H_VERSION"><span property="name">4.9</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/jetpack/4.9/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">jetpack_core_json_api_endpoin&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="0"><a href="http://hookr.io/4.9/all/" title="All">All <span class="count badge">0</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.9/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/4.9/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/4.9/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/4.9/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="0"><a href="http://hookr.io/4.9/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/4.9/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="0"><a href="http://hookr.io/4.9/functions/" title="Functions">Functions <span class="count badge">0</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/4.9/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Jetpack_Core_Json_Api_Endpoints</strong></h1><p>Class Jetpack_Core_Json_Api_Endpoints.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/jetpack/4.9/files/inc-lib-class-core-rest-api-endpoints/" class="file">/_inc/lib/class.core-rest-api-endpoints.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="26" class="block" start="26"><li><div>class Jetpack_Core_Json_Api_Endpoints {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string Generic error message when user is not allowed to perform an action.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static $user_permissions_error_msg;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array Roles that can access Stats once they're granted access.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static $stats_roles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Declare the Jetpack REST API endpoints.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function register_endpoints() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load API endpoint base classes&nbsp;</div></li><li><div>        require_once JETPACK__PLUGIN_DIR . '_inc/lib/core-api/class.jetpack-core-api-xmlrpc-consumer-endpoint.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load API endpoints&nbsp;</div></li><li><div>        require_once JETPACK__PLUGIN_DIR . '_inc/lib/core-api/class.jetpack-core-api-module-endpoints.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        self::$user_permissions_error_msg = esc_html__(&nbsp;</div></li><li><div>            'You do not have the correct user permissions to perform this action.&nbsp;</div></li><li><div>            Please contact your site admin if you think this is a mistake.', &nbsp;</div></li><li><div>            'jetpack'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        self::$stats_roles = array( 'administrator', 'editor', 'author', 'contributor', 'subscriber' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Jetpack::load_xml_rpc_client();&nbsp;</div></li><li><div>        $ixr_client = new Jetpack_IXR_Client( array( 'user_id' =&gt; get_current_user_id() ) );&nbsp;</div></li><li><div>        $core_api_endpoint = new Jetpack_Core_API_Data( $ixr_client );&nbsp;</div></li><li><div>        $module_list_endpoint = new Jetpack_Core_API_Module_List_Endpoint();&nbsp;</div></li><li><div>        $module_data_endpoint = new Jetpack_Core_API_Module_Data_Endpoint();&nbsp;</div></li><li><div>        $module_toggle_endpoint = new Jetpack_Core_API_Module_Toggle_Endpoint( new Jetpack_IXR_Client() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get current connection status of Jetpack&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/connection', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::jetpack_connection_status', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fetches a fresh connect URL&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/connection/url', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::build_connect_url', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::connect_url_permission_callback', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get current user connection data&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/connection/data', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::get_user_connection_data', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::get_user_connection_data_permission_callback', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Disconnect site from WordPress.com servers&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/connection', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::disconnect_site', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::disconnect_site_permission_callback', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Disconnect/unlink user from WordPress.com servers&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/connection/user', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::unlink_user', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::unlink_user_permission_callback', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get current site data&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/site', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::get_site_data', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::view_admin_page_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Confirm that a site in identity crisis should be in staging mode&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/identity-crisis/confirm-safe-mode', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::confirm_safe_mode', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::identity_crisis_mitigation_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // IDC resolve: create an entirely new shadow site for this URL.&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/identity-crisis/start-fresh', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::start_fresh_connection', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::identity_crisis_mitigation_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handles the request to migrate stats and subscribers during an identity crisis.&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', 'identity-crisis/migrate', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::migrate_stats_and_subscribers', &nbsp;</div></li><li><div>            'permissison_callback' =&gt; __CLASS__ . '::identity_crisis_mitigation_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return all modules&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/all', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $module_list_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $module_list_endpoint, 'can_request' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Activate many modules&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/all/active', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $module_list_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $module_list_endpoint, 'can_request' ), &nbsp;</div></li><li><div>            'args' =&gt; array(&nbsp;</div></li><li><div>                'modules' =&gt; array(&nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'type' =&gt; 'array', &nbsp;</div></li><li><div>                    'items' =&gt; array(&nbsp;</div></li><li><div>                        'type' =&gt; 'string', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'required' =&gt; true, &nbsp;</div></li><li><div>                    'validate_callback' =&gt; __CLASS__ . '::validate_module_list', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'active' =&gt; array(&nbsp;</div></li><li><div>                    'default' =&gt; true, &nbsp;</div></li><li><div>                    'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                    'required' =&gt; false, &nbsp;</div></li><li><div>                    'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return a single module and update it when needed&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/(?P&lt;slug&gt;[a-z\-]+)', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $core_api_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $core_api_endpoint, 'can_request' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Activate and deactivate a module&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/(?P&lt;slug&gt;[a-z\-]+)/active', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $module_toggle_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $module_toggle_endpoint, 'can_request' ), &nbsp;</div></li><li><div>            'args' =&gt; array(&nbsp;</div></li><li><div>                'active' =&gt; array(&nbsp;</div></li><li><div>                    'default' =&gt; true, &nbsp;</div></li><li><div>                    'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                    'required' =&gt; true, &nbsp;</div></li><li><div>                    'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update a module&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/(?P&lt;slug&gt;[a-z\-]+)', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $core_api_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $core_api_endpoint, 'can_request' ), &nbsp;</div></li><li><div>            'args' =&gt; self::get_updateable_parameters( 'any' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get data for a specific module, i.e. Protect block count, WPCOM stats, &nbsp;</div></li><li><div>        // Akismet spam count, etc.&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/(?P&lt;slug&gt;[a-z\-]+)/data', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $module_data_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $module_data_endpoint, 'can_request' ), &nbsp;</div></li><li><div>            'args' =&gt; array(&nbsp;</div></li><li><div>                'range' =&gt; array(&nbsp;</div></li><li><div>                    'default' =&gt; 'day', &nbsp;</div></li><li><div>                    'type' =&gt; 'string', &nbsp;</div></li><li><div>                    'required' =&gt; false, &nbsp;</div></li><li><div>                    'validate_callback' =&gt; __CLASS__ . '::validate_string', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if the API key for a specific service is valid or not&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/(?P&lt;service&gt;[a-z\-]+)/key/check', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $module_data_endpoint, 'key_check' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::update_settings_permission_check', &nbsp;</div></li><li><div>            'sanitize_callback' =&gt; 'sanitize_text_field', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/module/(?P&lt;service&gt;[a-z\-]+)/key/check', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $module_data_endpoint, 'key_check' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::update_settings_permission_check', &nbsp;</div></li><li><div>            'sanitize_callback' =&gt; 'sanitize_text_field', &nbsp;</div></li><li><div>            'args' =&gt; array(&nbsp;</div></li><li><div>                'api_key' =&gt; array(&nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'type' =&gt; 'string', &nbsp;</div></li><li><div>                    'validate_callback' =&gt; __CLASS__ . '::validate_alphanum', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update any Jetpack module option or setting&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/settings', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $core_api_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $core_api_endpoint, 'can_request' ), &nbsp;</div></li><li><div>            'args' =&gt; self::get_updateable_parameters( 'any' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update a module&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/settings/(?P&lt;slug&gt;[a-z\-]+)', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $core_api_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $core_api_endpoint, 'can_request' ), &nbsp;</div></li><li><div>            'args' =&gt; self::get_updateable_parameters()&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return all module settings&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/settings/', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; array( $core_api_endpoint, 'process' ), &nbsp;</div></li><li><div>            'permission_callback' =&gt; array( $core_api_endpoint, 'can_request' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Reset all Jetpack options&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/options/(?P&lt;options&gt;[a-z\-]+)', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::reset_jetpack_options', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::manage_modules_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return current Jumpstart status&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/jumpstart', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::jumpstart_status', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::update_settings_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update Jumpstart&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/jumpstart', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::jumpstart_toggle', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::manage_modules_permission_check', &nbsp;</div></li><li><div>            'args' =&gt; array(&nbsp;</div></li><li><div>                'active' =&gt; array(&nbsp;</div></li><li><div>                    'required' =&gt; true, &nbsp;</div></li><li><div>                    'validate_callback' =&gt; __CLASS__  . '::validate_boolean', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Updates: get number of plugin updates available&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/updates/plugins', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::get_plugin_update_count', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::view_admin_page_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Dismiss Jetpack Notices&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/notice/(?P&lt;notice&gt;[a-z\-_]+)', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::EDITABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::dismiss_notice', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::view_admin_page_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugins: get list of all plugins.&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/plugins', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::get_plugins', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::activate_plugins_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugins: check if the plugin is active.&nbsp;</div></li><li><div>        register_rest_route( 'jetpack/v4', '/plugin/(?P&lt;plugin&gt;[a-z\/\.\-_]+)', array(&nbsp;</div></li><li><div>            'methods' =&gt; WP_REST_Server::READABLE, &nbsp;</div></li><li><div>            'callback' =&gt; __CLASS__ . '::get_plugin', &nbsp;</div></li><li><div>            'permission_callback' =&gt; __CLASS__ . '::activate_plugins_permission_check', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handles dismissing of Jetpack Notices&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|wp-error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function dismiss_notice( $request ) {&nbsp;</div></li><li><div>        $notice = $request['notice'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $request['dismissed'] ) || $request['dismissed'] !== true ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', esc_html__( 'Invalid parameter &quot;dismissed&quot;.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $notice ) && ! empty( $notice ) ) {&nbsp;</div></li><li><div>            switch( $notice ) {&nbsp;</div></li><li><div>                case 'feedback_dash_request':&nbsp;</div></li><li><div>                case 'welcome':&nbsp;</div></li><li><div>                    $notices = get_option( 'jetpack_dismissed_notices', array() );&nbsp;</div></li><li><div>                    $notices[ $notice ] = true;&nbsp;</div></li><li><div>                    update_option( 'jetpack_dismissed_notices', $notices );&nbsp;</div></li><li><div>                    return rest_ensure_response( get_option( 'jetpack_dismissed_notices', array() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    return new WP_Error( 'invalid_param', esc_html__( 'Invalid parameter &quot;notice&quot;.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'required_param', esc_html__( 'Missing parameter &quot;notice&quot;.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that the user can disconnect the site.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if user is able to disconnect the site.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function disconnect_site_permission_callback() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_disconnect' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_jetpack_disconnect', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that the user can get a connect/link URL&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if user is able to disconnect the site.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function connect_url_permission_callback() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_connect_user' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_jetpack_disconnect', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that a user can get the data about the current user.&nbsp;</div></li><li><div>     * Only those who can connect.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses Jetpack::is_user_connected();&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if user is able to unlink.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_user_connection_data_permission_callback() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_connect_user' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_user_connection_data', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that a user can use the /connection/user endpoint. Has to be a registered user and be currently linked.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses Jetpack::is_user_connected();&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if user is able to unlink.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function unlink_user_permission_callback() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_connect_user' ) && Jetpack::is_user_connected( get_current_user_id() ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_unlink_user', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that user can manage Jetpack modules.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether user has the capability 'jetpack_manage_modules'.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function manage_modules_permission_check() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_manage_modules' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_manage_modules', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that user can update Jetpack modules.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether user has the capability 'jetpack_configure_modules'.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function configure_modules_permission_check() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_configure_modules' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_configure_modules', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that user can view Jetpack admin page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether user has the capability 'jetpack_admin_page'.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function view_admin_page_permission_check() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_admin_page' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_view_admin', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that user can mitigate an identity crisis.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether user has capability 'jetpack_disconnect'.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function identity_crisis_mitigation_permission_check() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_disconnect' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_identity_crisis', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that user can update Jetpack general settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether user has the capability 'update_settings_permission_check'.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_settings_permission_check() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_configure_modules' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_manage_settings', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Verify that user can view Jetpack admin page and can activate plugins.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether user has the capability 'jetpack_admin_page' and 'activate_plugins'.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function activate_plugins_permission_check() {&nbsp;</div></li><li><div>        if ( current_user_can( 'jetpack_admin_page' ) && current_user_can( 'activate_plugins' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'invalid_user_permission_activate_plugins', self::$user_permissions_error_msg, array( 'status' =&gt; self::rest_authorization_required_code() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Contextual HTTP error code for authorization failure.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Taken from rest_authorization_required_code() in WP-API plugin until is added to core.&nbsp;</div></li><li><div>     * @see https://github.com/WP-API/WP-API/commit/7ba0ae6fe4f605d5ffe4ee85b1cd5f9fb46900a6&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function rest_authorization_required_code() {&nbsp;</div></li><li><div>        return is_user_logged_in() ? 403 : 401;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get connection status for this Jetpack site.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool True if site is connected&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function jetpack_connection_status() {&nbsp;</div></li><li><div>        return rest_ensure_response( array(&nbsp;</div></li><li><div>                'isActive' =&gt; Jetpack::is_active(), &nbsp;</div></li><li><div>                'isStaging' =&gt; Jetpack::is_staging_site(), &nbsp;</div></li><li><div>                'devMode' =&gt; array(&nbsp;</div></li><li><div>                    'isActive' =&gt; Jetpack::is_development_mode(), &nbsp;</div></li><li><div>                    'constant' =&gt; defined( 'JETPACK_DEV_DEBUG' ) && JETPACK_DEV_DEBUG, &nbsp;</div></li><li><div>                    'url' =&gt; site_url() && false === strpos( site_url(), '.' ), &nbsp;</div></li><li><div>                    'filter' =&gt; apply_filters( 'jetpack_development_mode', false ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Disconnects Jetpack from the WordPress.com Servers&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses Jetpack::disconnect();&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if Jetpack successfully disconnected.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function disconnect_site( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $request['isActive'] ) || $request['isActive'] !== false ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', esc_html__( 'Invalid Parameter', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( Jetpack::is_active() ) {&nbsp;</div></li><li><div>            Jetpack::disconnect();&nbsp;</div></li><li><div>            return rest_ensure_response( array( 'code' =&gt; 'success' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'disconnect_failed', esc_html__( 'Was not able to disconnect the site.  Please try again.', 'jetpack' ), array( 'status' =&gt; 400 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets a new connect raw URL with fresh nonce.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses Jetpack::disconnect();&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|WP_Error A raw URL if the connection URL could be built; error message otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function build_connect_url() {&nbsp;</div></li><li><div>        $url = Jetpack::init()-&gt;build_connect_url( true, false, false );&nbsp;</div></li><li><div>        if ( $url ) {&nbsp;</div></li><li><div>            return rest_ensure_response( $url );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'build_connect_url_failed', esc_html__( 'Unable to build the connect URL.  Please reload the page and try again.', 'jetpack' ), array( 'status' =&gt; 400 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get miscellaneous user data related to the connection. Similar data available in old &quot;My Jetpack&quot;.&nbsp;</div></li><li><div>     * Information about the master/primary user.&nbsp;</div></li><li><div>     * Information about the current user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_user_connection_data() {&nbsp;</div></li><li><div>        require_once( JETPACK__PLUGIN_DIR . '_inc/lib/admin-pages/class.jetpack-react-page.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $response = array(&nbsp;</div></li><li><div>//            'othersLinked' =&gt; Jetpack::get_other_linked_admins(), &nbsp;</div></li><li><div>            'currentUser' =&gt; jetpack_current_user_data(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return rest_ensure_response( $response );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the proper name for Jetpack Holiday Snow setting.&nbsp;</div></li><li><div>     * When the REST route starts, the holiday-snow.php file where jetpack_holiday_snow_option_name() function is defined is not loaded, &nbsp;</div></li><li><div>     * so where using this to replicate it and have the same functionality.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function holiday_snow_option_name() {&nbsp;</div></li><li><div>        /** This filter is documented in modules/holiday-snow.php */&nbsp;</div></li><li><div>        return apply_filters( 'jetpack_holiday_snow_option_name', 'jetpack_holiday_snow_enabled' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update a single miscellaneous setting for this Jetpack installation, like Holiday Snow.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return object Jetpack miscellaneous settings.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_setting( $request ) {&nbsp;</div></li><li><div>        // Get parameters to update the module.&nbsp;</div></li><li><div>        $param = $request-&gt;get_params();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Exit if no parameters were passed.&nbsp;</div></li><li><div>        if ( ! is_array( $param ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'missing_setting', esc_html__( 'Missing setting.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get option name and value.&nbsp;</div></li><li><div>        $option = key( $param );&nbsp;</div></li><li><div>        $value = current( $param );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Log success or not&nbsp;</div></li><li><div>        $updated = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $option ) {&nbsp;</div></li><li><div>            case self::holiday_snow_option_name():&nbsp;</div></li><li><div>                $updated = update_option( $option, ( true == (bool) $value ) ? 'letitsnow' : '' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $updated ) {&nbsp;</div></li><li><div>            return rest_ensure_response( array(&nbsp;</div></li><li><div>                'code' =&gt; 'success', &nbsp;</div></li><li><div>                'message' =&gt; esc_html__( 'Setting updated.', 'jetpack' ), &nbsp;</div></li><li><div>                'value' =&gt; $value, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'setting_not_updated', esc_html__( 'The setting was not updated.', 'jetpack' ), array( 'status' =&gt; 400 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Unlinks current user from the WordPress.com Servers.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     * @uses  Jetpack::unlink_user&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if user successfully unlinked.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function unlink_user( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $request['linked'] ) || $request['linked'] !== false ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', esc_html__( 'Invalid Parameter', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( Jetpack::unlink_user() ) {&nbsp;</div></li><li><div>            return rest_ensure_response(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'code' =&gt; 'success'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'unlink_user_failed', esc_html__( 'Was not able to unlink the user.  Please try again.', 'jetpack' ), array( 'status' =&gt; 400 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get site data, including for example, the site's current plan.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of Jetpack modules.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_site_data() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $site_id = Jetpack_Options::get_option( 'id' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $response = Jetpack_Client::wpcom_json_api_request_as_blog( sprintf( '/sites/%d', $site_id ) .'?force=wpcom', '1.1' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 200 !== wp_remote_retrieve_response_code( $response ) ) {&nbsp;</div></li><li><div>                return new WP_Error( 'site_data_fetch_failed', esc_html__( 'Failed fetching site data. Try again later.', 'jetpack' ), array( 'status' =&gt; 400 ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Save plan details in the database for future use without API calls&nbsp;</div></li><li><div>            $results = json_decode( $response['body'], true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $results ) && isset( $results['plan'] ) ) {&nbsp;</div></li><li><div>                update_option( 'jetpack_active_plan', $results['plan'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return rest_ensure_response( array(&nbsp;</div></li><li><div>                    'code' =&gt; 'success', &nbsp;</div></li><li><div>                    'message' =&gt; esc_html__( 'Site data correctly received.', 'jetpack' ), &nbsp;</div></li><li><div>                    'data' =&gt; wp_remote_retrieve_body( $response ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'site_id_missing', esc_html__( 'The ID of this site does not exist.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handles identity crisis mitigation, confirming safe mode for this site.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool | WP_Error True if option is properly set.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function confirm_safe_mode() {&nbsp;</div></li><li><div>        $updated = Jetpack_Options::update_option( 'safe_mode_confirmed', true );&nbsp;</div></li><li><div>        if ( $updated ) {&nbsp;</div></li><li><div>            return rest_ensure_response(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'code' =&gt; 'success'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return new WP_Error(&nbsp;</div></li><li><div>            'error_setting_jetpack_safe_mode', &nbsp;</div></li><li><div>            esc_html__( 'Could not confirm safe mode.', 'jetpack' ), &nbsp;</div></li><li><div>            array( 'status' =&gt; 500 )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handles identity crisis mitigation, migrating stats and subscribers from old url to this, new url.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool | WP_Error True if option is properly set.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function migrate_stats_and_subscribers() {&nbsp;</div></li><li><div>        if ( Jetpack_Options::get_option( 'sync_error_idc' ) && ! Jetpack_Options::delete_option( 'sync_error_idc' ) ) {&nbsp;</div></li><li><div>            return new WP_Error(&nbsp;</div></li><li><div>                'error_deleting_sync_error_idc', &nbsp;</div></li><li><div>                esc_html__( 'Could not delete sync error option.', 'jetpack' ), &nbsp;</div></li><li><div>                array( 'status' =&gt; 500 )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( Jetpack_Options::get_option( 'migrate_for_idc' ) || Jetpack_Options::update_option( 'migrate_for_idc', true ) ) {&nbsp;</div></li><li><div>            return rest_ensure_response(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'code' =&gt; 'success'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return new WP_Error(&nbsp;</div></li><li><div>            'error_setting_jetpack_migrate', &nbsp;</div></li><li><div>            esc_html__( 'Could not confirm migration.', 'jetpack' ), &nbsp;</div></li><li><div>            array( 'status' =&gt; 500 )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * This IDC resolution will disconnect the site and re-connect to a completely new&nbsp;</div></li><li><div>     * and separate shadow site than the original.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * It will first will disconnect the site without phoning home as to not disturb the production site.&nbsp;</div></li><li><div>     * It then builds a fresh connection URL and sends it back along with the response.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.4.0&nbsp;</div></li><li><div>     * @return bool|WP_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function start_fresh_connection() {&nbsp;</div></li><li><div>        // First clear the options / disconnect.&nbsp;</div></li><li><div>        Jetpack::disconnect();&nbsp;</div></li><li><div>        return self::build_connect_url();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reset Jetpack options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request {&nbsp;</div></li><li><div>     *     Array of parameters received by request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type string $options Available options to reset are options|modules&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if options were reset. Otherwise, a WP_Error instance with the corresponding error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function reset_jetpack_options( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $request['reset'] ) || $request['reset'] !== true ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', esc_html__( 'Invalid Parameter', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $request['options'] ) ) {&nbsp;</div></li><li><div>            $data = $request['options'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch( $data ) {&nbsp;</div></li><li><div>                case ( 'options' ) :&nbsp;</div></li><li><div>                    $options_to_reset = Jetpack::get_jetpack_options_for_reset();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Reset the Jetpack options&nbsp;</div></li><li><div>                    foreach ( $options_to_reset['jp_options'] as $option_to_reset ) {&nbsp;</div></li><li><div>                        Jetpack_Options::delete_option( $option_to_reset );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $options_to_reset['wp_options'] as $option_to_reset ) {&nbsp;</div></li><li><div>                        delete_option( $option_to_reset );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Reset to default modules&nbsp;</div></li><li><div>                    $default_modules = Jetpack::get_default_modules();&nbsp;</div></li><li><div>                    Jetpack::update_active_modules( $default_modules );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Jumpstart option is special&nbsp;</div></li><li><div>                    Jetpack_Options::update_option( 'jumpstart', 'new_connection' );&nbsp;</div></li><li><div>                    return rest_ensure_response( array(&nbsp;</div></li><li><div>                        'code' =&gt; 'success', &nbsp;</div></li><li><div>                        'message' =&gt; esc_html__( 'Jetpack options reset.', 'jetpack' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'modules':&nbsp;</div></li><li><div>                    $default_modules = Jetpack::get_default_modules();&nbsp;</div></li><li><div>                    Jetpack::update_active_modules( $default_modules );&nbsp;</div></li><li><div>                    return rest_ensure_response( array(&nbsp;</div></li><li><div>                        'code' =&gt; 'success', &nbsp;</div></li><li><div>                        'message' =&gt; esc_html__( 'Modules reset to default.', 'jetpack' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    return new WP_Error( 'invalid_param', esc_html__( 'Invalid Parameter', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'required_param', esc_html__( 'Missing parameter &quot;type&quot;.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves the current status of Jumpstart.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function jumpstart_status() {&nbsp;</div></li><li><div>        return array(&nbsp;</div></li><li><div>            'status' =&gt; Jetpack_Options::get_option( 'jumpstart' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Toggles activation or deactivation of the JumpStart&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if toggling Jumpstart succeeded. Otherwise, a WP_Error instance with the corresponding error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function jumpstart_toggle( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $request[ 'active' ] ) {&nbsp;</div></li><li><div>            return self::jumpstart_activate( $request );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return self::jumpstart_deactivate( $request );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Activates a series of valid Jetpack modules and initializes some options.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if Jumpstart succeeded. Otherwise, a WP_Error instance with the corresponding error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function jumpstart_activate( $request ) {&nbsp;</div></li><li><div>        $modules = Jetpack::get_available_modules();&nbsp;</div></li><li><div>        $activate_modules = array();&nbsp;</div></li><li><div>        foreach ( $modules as $module ) {&nbsp;</div></li><li><div>            $module_info = Jetpack::get_module( $module );&nbsp;</div></li><li><div>            if ( isset( $module_info['feature'] ) && is_array( $module_info['feature'] ) && in_array( 'Jumpstart', $module_info['feature'] ) ) {&nbsp;</div></li><li><div>                $activate_modules[] = $module;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Collect success/error messages like modules that are properly activated.&nbsp;</div></li><li><div>        $result = array(&nbsp;</div></li><li><div>            'activated_modules' =&gt; array(), &nbsp;</div></li><li><div>            'failed_modules' =&gt; array(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update the jumpstart option&nbsp;</div></li><li><div>        if ( 'new_connection' === Jetpack_Options::get_option( 'jumpstart' ) ) {&nbsp;</div></li><li><div>            $result['jumpstart_activated'] = Jetpack_Options::update_option( 'jumpstart', 'jumpstart_activated' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for possible conflicting plugins&nbsp;</div></li><li><div>        $module_slugs_filtered = Jetpack::init()-&gt;filter_default_modules( $activate_modules );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $module_slugs_filtered as $module_slug ) {&nbsp;</div></li><li><div>            Jetpack::log( 'activate', $module_slug );&nbsp;</div></li><li><div>            if ( Jetpack::activate_module( $module_slug, false, false ) ) {&nbsp;</div></li><li><div>                $result['activated_modules'][] = $module_slug;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $result['failed_modules'][] = $module_slug;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the default sharing buttons and set to display on posts if none have been set.&nbsp;</div></li><li><div>        $sharing_services = get_option( 'sharing-services' );&nbsp;</div></li><li><div>        $sharing_options = get_option( 'sharing-options' );&nbsp;</div></li><li><div>        if ( empty( $sharing_services['visible'] ) ) {&nbsp;</div></li><li><div>            // Default buttons to set&nbsp;</div></li><li><div>            $visible = array(&nbsp;</div></li><li><div>                'twitter', &nbsp;</div></li><li><div>                'facebook', &nbsp;</div></li><li><div>                'google-plus-1', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $hidden = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Set some sharing settings&nbsp;</div></li><li><div>            if ( class_exists( 'Sharing_Service' ) ) {&nbsp;</div></li><li><div>                $sharing = new Sharing_Service();&nbsp;</div></li><li><div>                $sharing_options['global'] = array(&nbsp;</div></li><li><div>                    'button_style' =&gt; 'icon', &nbsp;</div></li><li><div>                    'sharing_label' =&gt; $sharing-&gt;default_sharing_label, &nbsp;</div></li><li><div>                    'open_links' =&gt; 'same', &nbsp;</div></li><li><div>                    'show' =&gt; array( 'post' ), &nbsp;</div></li><li><div>                    'custom' =&gt; isset( $sharing_options['global']['custom'] ) ? $sharing_options['global']['custom'] : array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $result['sharing_options'] = update_option( 'sharing-options', $sharing_options );&nbsp;</div></li><li><div>                $result['sharing_services'] = update_option( 'sharing-services', array( 'visible' =&gt; $visible, 'hidden' =&gt; $hidden ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If all Jumpstart modules were activated&nbsp;</div></li><li><div>        if ( empty( $result['failed_modules'] ) ) {&nbsp;</div></li><li><div>            return rest_ensure_response( array(&nbsp;</div></li><li><div>                'code' =&gt; 'success', &nbsp;</div></li><li><div>                'message' =&gt; esc_html__( 'Jumpstart done.', 'jetpack' ), &nbsp;</div></li><li><div>                'data' =&gt; $result, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'jumpstart_failed', esc_html( sprintf( _n( 'Jumpstart failed activating this module: %s.', 'Jumpstart failed activating these modules: %s.', count( $result['failed_modules'] ), 'jetpack' ), join( ', ', $result['failed_modules'] ) ) ), array( 'status' =&gt; 400 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Dismisses Jumpstart so user is not prompted to go through it again.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if Jumpstart was disabled or was nothing to dismiss. Otherwise, a WP_Error instance with a message.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function jumpstart_deactivate( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If dismissed, flag the jumpstart option as such.&nbsp;</div></li><li><div>        if ( 'new_connection' === Jetpack_Options::get_option( 'jumpstart' ) ) {&nbsp;</div></li><li><div>            if ( Jetpack_Options::update_option( 'jumpstart', 'jumpstart_dismissed' ) ) {&nbsp;</div></li><li><div>                return rest_ensure_response( array(&nbsp;</div></li><li><div>                    'code' =&gt; 'success', &nbsp;</div></li><li><div>                    'message' =&gt; esc_html__( 'Jumpstart dismissed.', 'jetpack' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return new WP_Error( 'jumpstart_failed_dismiss', esc_html__( 'Jumpstart could not be dismissed.', 'jetpack' ), array( 'status' =&gt; 400 ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If this was not a new connection and there was nothing to dismiss, don't fail.&nbsp;</div></li><li><div>        return rest_ensure_response( array(&nbsp;</div></li><li><div>            'code' =&gt; 'success', &nbsp;</div></li><li><div>            'message' =&gt; esc_html__( 'Nothing to dismiss. This was not a new connection.', 'jetpack' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the query parameters to update module options or general settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     * @since 4.4.0 Accepts a $selector parameter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $selector Selects a set of options to update, Can be empty, a module slug or 'any'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_updateable_parameters( $selector = '' ) {&nbsp;</div></li><li><div>        $parameters = array(&nbsp;</div></li><li><div>            'context' =&gt; array(&nbsp;</div></li><li><div>                'default' =&gt; 'edit', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array_merge( $parameters, self::get_updateable_data_list( $selector ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a list of module options or general settings that can be updated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     * @since 4.4.0 Accepts 'any' as a parameter which will make it return the entire list.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $selector Module slug, 'any', or an array of parameters.&nbsp;</div></li><li><div>     *                               If empty, it's assumed we're updating a module and we'll try to get its slug.&nbsp;</div></li><li><div>     *                               If 'any' the full list is returned.&nbsp;</div></li><li><div>     *                               If it's an array of parameters, includes the elements by matching keys.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_updateable_data_list( $selector = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $options = array(&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Carousel&nbsp;</div></li><li><div>            'carousel_background_color' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Color scheme.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; 'black', &nbsp;</div></li><li><div>                'enum' =&gt; array(&nbsp;</div></li><li><div>                    'black', &nbsp;</div></li><li><div>                    'white', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'enum_labels' =&gt; array(&nbsp;</div></li><li><div>                    'black' =&gt; esc_html__( 'Black', 'jetpack' ), &nbsp;</div></li><li><div>                    'white' =&gt; esc_html__( 'White', 'jetpack' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_list_item', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'carousel', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'carousel_display_exif' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; wp_kses( sprintf( __( 'Show photo metadata (&lt;a href=&quot;http://en.wikipedia.org/wiki/Exchangeable_image_file_format&quot; target=&quot;_blank&quot;&gt;Exif&lt;/a&gt;) in carousel, when available.', 'jetpack' ) ), array( 'a' =&gt; array( 'href' =&gt; true, 'target' =&gt; true ) ) ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'carousel', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Comments&nbsp;</div></li><li><div>            'highlander_comment_form_prompt' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Greeting Text', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; esc_html__( 'Leave a Reply', 'jetpack' ), &nbsp;</div></li><li><div>                'sanitize_callback' =&gt; 'sanitize_text_field', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'comments', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'jetpack_comment_form_color_scheme' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( &quot;Color scheme&quot;, 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; 'light', &nbsp;</div></li><li><div>                'enum' =&gt; array(&nbsp;</div></li><li><div>                    'light', &nbsp;</div></li><li><div>                    'dark', &nbsp;</div></li><li><div>                    'transparent', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'enum_labels' =&gt; array(&nbsp;</div></li><li><div>                    'light' =&gt; esc_html__( 'Light', 'jetpack' ), &nbsp;</div></li><li><div>                    'dark' =&gt; esc_html__( 'Dark', 'jetpack' ), &nbsp;</div></li><li><div>                    'transparent' =&gt; esc_html__( 'Transparent', 'jetpack' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_list_item', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'comments', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Custom Content Types&nbsp;</div></li><li><div>            'jetpack_portfolio' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Enable or disable Jetpack portfolio post type.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'custom-content-types', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'jetpack_portfolio_posts_per_page' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Number of entries to show at most in Portfolio pages.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'integer', &nbsp;</div></li><li><div>                'default' =&gt; 10, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_posint', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'custom-content-types', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'jetpack_testimonial' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Enable or disable Jetpack testimonial post type.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'custom-content-types', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'jetpack_testimonial_posts_per_page' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Number of entries to show at most in Testimonial pages.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'integer', &nbsp;</div></li><li><div>                'default' =&gt; 10, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_posint', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'custom-content-types', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Galleries&nbsp;</div></li><li><div>            'tiled_galleries' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Display all your gallery pictures in a cool mosaic.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'tiled-gallery', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'gravatar_disable_hovercards' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( &quot;View people's profiles when you mouse over their Gravatars&quot;, 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; 'enabled', &nbsp;</div></li><li><div>                // Not visible. This is used as the checkbox value.&nbsp;</div></li><li><div>                'enum' =&gt; array(&nbsp;</div></li><li><div>                    'enabled', &nbsp;</div></li><li><div>                    'disabled', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'enum_labels' =&gt; array(&nbsp;</div></li><li><div>                    'enabled' =&gt; esc_html__( 'Enabled', 'jetpack' ), &nbsp;</div></li><li><div>                    'disabled' =&gt; esc_html__( 'Disabled', 'jetpack' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_list_item', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'gravatar-hovercards', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Infinite Scroll&nbsp;</div></li><li><div>            'infinite_scroll' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'To infinity and beyond', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'infinite-scroll', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'infinite_scroll_google_analytics' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Use Google Analytics with Infinite Scroll', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'infinite-scroll', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Likes&nbsp;</div></li><li><div>            'wpl_default' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'WordPress.com Likes are', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; 'on', &nbsp;</div></li><li><div>                'enum' =&gt; array(&nbsp;</div></li><li><div>                    'on', &nbsp;</div></li><li><div>                    'off', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'enum_labels' =&gt; array(&nbsp;</div></li><li><div>                    'on' =&gt; esc_html__( 'On for all posts', 'jetpack' ), &nbsp;</div></li><li><div>                    'off' =&gt; esc_html__( 'Turned on per post', 'jetpack' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_list_item', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'likes', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'social_notifications_like' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Send email notification when someone likes a post', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'likes', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Markdown&nbsp;</div></li><li><div>            'wpcom_publish_comments_with_markdown' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Use Markdown for comments.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'markdown', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wpcom_publish_posts_with_markdown' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Use Markdown for posts.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'markdown', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Mobile Theme&nbsp;</div></li><li><div>            'wp_mobile_excerpt' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Excerpts', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'minileven', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wp_mobile_featured_images' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Featured Images', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'minileven', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wp_mobile_app_promos' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Show a promo for the WordPress mobile apps in the footer of the mobile theme.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'minileven', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Monitor&nbsp;</div></li><li><div>            'monitor_receive_notifications' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Receive Monitor Email Notifications.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'monitor', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Post by Email&nbsp;</div></li><li><div>            'post_by_email_address' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Email Address', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; 'noop', &nbsp;</div></li><li><div>                'enum' =&gt; array(&nbsp;</div></li><li><div>                    'noop', &nbsp;</div></li><li><div>                    'create', &nbsp;</div></li><li><div>                    'regenerate', &nbsp;</div></li><li><div>                    'delete', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'enum_labels' =&gt; array(&nbsp;</div></li><li><div>                    'noop' =&gt; '', &nbsp;</div></li><li><div>                    'create' =&gt; esc_html__( 'Create Post by Email address', 'jetpack' ), &nbsp;</div></li><li><div>                    'regenerate' =&gt; esc_html__( 'Regenerate Post by Email address', 'jetpack' ), &nbsp;</div></li><li><div>                    'delete' =&gt; esc_html__( 'Delete Post by Email address', 'jetpack' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_list_item', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'post-by-email', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Protect&nbsp;</div></li><li><div>            'jetpack_protect_key' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Protect API key', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_alphanum', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'protect', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'jetpack_protect_global_whitelist' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Protect global whitelist', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_string', &nbsp;</div></li><li><div>                'sanitize_callback' =&gt; 'esc_textarea', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'protect', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Sharing&nbsp;</div></li><li><div>            'sharing_services' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Enabled Services and those hidden behind a button', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'object', &nbsp;</div></li><li><div>                'default' =&gt; array(&nbsp;</div></li><li><div>                    'visible' =&gt; array( 'twitter', 'facebook', 'google-plus-1' ), &nbsp;</div></li><li><div>                    'hidden' =&gt; array(), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_services', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'button_style' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Button Style', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; 'icon', &nbsp;</div></li><li><div>                'enum' =&gt; array(&nbsp;</div></li><li><div>                    'icon-text', &nbsp;</div></li><li><div>                    'icon', &nbsp;</div></li><li><div>                    'text', &nbsp;</div></li><li><div>                    'official', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'enum_labels' =&gt; array(&nbsp;</div></li><li><div>                    'icon-text' =&gt; esc_html__( 'Icon + text', 'jetpack' ), &nbsp;</div></li><li><div>                    'icon' =&gt; esc_html__( 'Icon only', 'jetpack' ), &nbsp;</div></li><li><div>                    'text' =&gt; esc_html__( 'Text only', 'jetpack' ), &nbsp;</div></li><li><div>                    'official' =&gt; esc_html__( 'Official buttons', 'jetpack' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_list_item', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'sharing_label' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Sharing Label', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_string', &nbsp;</div></li><li><div>                'sanitize_callback' =&gt; 'esc_html', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'show' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Views where buttons are shown', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'array', &nbsp;</div></li><li><div>                'items' =&gt; array(&nbsp;</div></li><li><div>                    'type' =&gt; 'string'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; array( 'post' ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_sharing_show', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'jetpack-twitter-cards-site-tag' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( &quot;The Twitter username of the owner of this site's domain.&quot;, 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_twitter_username', &nbsp;</div></li><li><div>                'sanitize_callback' =&gt; 'esc_html', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'sharedaddy_disable_resources' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Disable CSS and JS', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'custom' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Custom sharing services added by user.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'object', &nbsp;</div></li><li><div>                'default' =&gt; array(&nbsp;</div></li><li><div>                    'sharing_name' =&gt; '', &nbsp;</div></li><li><div>                    'sharing_url' =&gt; '', &nbsp;</div></li><li><div>                    'sharing_icon' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_custom_service', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            // Not an option, but an action that can be perfomed on the list of custom services passing the service ID.&nbsp;</div></li><li><div>            'sharing_delete_service' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Delete custom sharing service.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_custom_service_id', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sharedaddy', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // SSO&nbsp;</div></li><li><div>            'jetpack_sso_require_two_step' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Require Two-Step Authentication', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sso', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'jetpack_sso_match_by_email' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Match by Email', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'sso', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Subscriptions&nbsp;</div></li><li><div>            'stb_enabled' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( &quot;Show a &lt;em&gt;'follow blog'&lt;/em&gt; option in the comment form&quot;, 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'subscriptions', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'stc_enabled' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( &quot;Show a &lt;em&gt;'follow comments'&lt;/em&gt; option in the comment form&quot;, 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'subscriptions', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Related Posts&nbsp;</div></li><li><div>            'show_headline' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Show a &quot;Related&quot; header to more clearly separate the related section from posts', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'related-posts', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'show_thumbnails' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Use a large and visually striking layout', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'related-posts', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Spelling and Grammar - After the Deadline&nbsp;</div></li><li><div>            'onpublish' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Proofread when a post or page is first published.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'onupdate' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Proofread when a post or page is updated.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Bias Language' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Bias Language', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Cliches' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Clichs', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Complex Expression' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Complex Phrases', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Diacritical Marks' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Diacritical Marks', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Double Negative' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Double Negatives', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Hidden Verbs' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Hidden Verbs', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Jargon Language' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Jargon', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Passive voice' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Passive Voice', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Phrases to Avoid' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Phrases to Avoid', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'Redundant Expression' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Redundant Phrases', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'guess_lang' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Use automatically detected language to proofread posts and pages', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'ignored_phrases' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Add Phrase to be ignored', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'sanitize_callback' =&gt; 'esc_html', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'unignore_phrase' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Remove Phrase from being ignored', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'sanitize_callback' =&gt; 'esc_html', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'after-the-deadline', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Verification Tools&nbsp;</div></li><li><div>            'google' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Google Search Console', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_verification_service', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'verification-tools', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'bing' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Bing Webmaster Center', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_verification_service', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'verification-tools', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'pinterest' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Pinterest Site Verification', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_verification_service', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'verification-tools', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'yandex' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Yandex Site Verification', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_verification_service', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'verification-tools', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'enable_header_ad' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Display an ad unit at the top of each page.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'wordads', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wordads_approved' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Is site approved for WordAds?', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'wordads', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Google Analytics&nbsp;</div></li><li><div>            'google_analytics_tracking_id' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Google Analytics', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_alphanum', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'google-analytics', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Stats&nbsp;</div></li><li><div>            'admin_bar' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Put a chart showing 48 hours of views in the admin bar.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'stats', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'roles' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Select the roles that will be able to view stats reports.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'array', &nbsp;</div></li><li><div>                'items' =&gt; array(&nbsp;</div></li><li><div>                    'type' =&gt; 'string'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; array( 'administrator' ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_stats_roles', &nbsp;</div></li><li><div>                'sanitize_callback' =&gt; __CLASS__ . '::sanitize_stats_allowed_roles', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'stats', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'count_roles' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Count the page views of registered users who are logged in.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'array', &nbsp;</div></li><li><div>                'items' =&gt; array(&nbsp;</div></li><li><div>                    'type' =&gt; 'string'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'default' =&gt; array( 'administrator' ), &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_stats_roles', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'stats', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'blog_id' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Blog ID.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'stats', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'do_not_track' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Do not track.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'stats', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'hide_smile' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Hide the stats smiley face image.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 1, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'stats', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'version' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; esc_html__( 'Version.', 'jetpack' ), &nbsp;</div></li><li><div>                'type' =&gt; 'integer', &nbsp;</div></li><li><div>                'default' =&gt; 9, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_posint', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'stats', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Settings - Not a module&nbsp;</div></li><li><div>            self::holiday_snow_option_name() =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'settings', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Akismet - Not a module, but a plugin. The options can be passed and handled differently.&nbsp;</div></li><li><div>            'akismet_show_user_comments_approved' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'settings', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'wordpress_api_key' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'type' =&gt; 'string', &nbsp;</div></li><li><div>                'default' =&gt; '', &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_alphanum', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'settings', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Apps card on dashboard&nbsp;</div></li><li><div>            'dismiss_dash_app_card' =&gt; array(&nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'settings', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add modules to list so they can be toggled&nbsp;</div></li><li><div>        $modules = Jetpack::get_available_modules();&nbsp;</div></li><li><div>        if ( is_array( $modules ) && ! empty( $modules ) ) {&nbsp;</div></li><li><div>            $module_args = array(&nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'type' =&gt; 'boolean', &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'validate_callback' =&gt; __CLASS__ . '::validate_boolean', &nbsp;</div></li><li><div>                'jp_group' =&gt; 'modules', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            foreach( $modules as $module ) {&nbsp;</div></li><li><div>                $options[ $module ] = $module_args;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $selector ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Return only those options whose keys match $selector keys&nbsp;</div></li><li><div>            return array_intersect_key( $options, $selector );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'any' === $selector ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Toggle module or update any module option or any general setting&nbsp;</div></li><li><div>            return $options;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // We're updating the options for a single module.&nbsp;</div></li><li><div>        if ( empty( $selector ) ) {&nbsp;</div></li><li><div>            $selector = self::get_module_requested();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $selected = array();&nbsp;</div></li><li><div>        foreach ( $options as $option =&gt; $attributes ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Not adding an isset( $attributes['jp_group'] ) because if it's not set, it must be fixed, otherwise options will fail.&nbsp;</div></li><li><div>            if ( $selector === $attributes['jp_group'] ) {&nbsp;</div></li><li><div>                $selected[ $option ] = $attributes;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $selected;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is either a pure boolean or a numeric string that can be mapped to a boolean.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|bool $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_boolean( $value, $request, $param ) {&nbsp;</div></li><li><div>        if ( ! is_bool( $value ) && ! ( ( ctype_digit( $value ) || is_numeric( $value ) ) && in_array( $value, array( 0, 1 ) ) ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be true, false, 0 or 1.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is a positive integer.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_posint( $value = 0, $request, $param ) {&nbsp;</div></li><li><div>        if ( ! is_numeric( $value ) || $value &lt;= 0 ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be a positive integer.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter belongs to a list of admitted values.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_list_item( $value = '', $request, $param ) {&nbsp;</div></li><li><div>        $attributes = $request-&gt;get_attributes();&nbsp;</div></li><li><div>        if ( ! isset( $attributes['args'][ $param ] ) || ! is_array( $attributes['args'][ $param ] ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s not recognized', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $args = $attributes['args'][ $param ];&nbsp;</div></li><li><div>        if ( ! empty( $args['enum'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If it's an associative array, use the keys to check that the value is among those admitted.&nbsp;</div></li><li><div>            $enum = ( count( array_filter( array_keys( $args['enum'] ), 'is_string' ) ) &gt; 0 ) ? array_keys( $args['enum'] ) : $args['enum'];&nbsp;</div></li><li><div>            if ( ! in_array( $value, $enum ) ) {&nbsp;</div></li><li><div>                return new WP_Error( 'invalid_param_value', sprintf(&nbsp;</div></li><li><div>                    /** Translators: first variable is the parameter passed to endpoint that holds the list item, the second is a list of admitted values. */&nbsp;</div></li><li><div>                    esc_html__( '%1$s must be one of %2$s', 'jetpack' ), $param, implode( ', ', $enum )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter belongs to a list of admitted values.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_module_list( $value = '', $request, $param ) {&nbsp;</div></li><li><div>        if ( ! is_array( $value ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param_value', sprintf( esc_html__( '%s must be an array', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $modules = Jetpack::get_available_modules();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( count( array_intersect( $value, $modules ) ) != count( $value ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param_value', sprintf( esc_html__( '%s must be a list of valid modules', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is an alphanumeric or empty string (to be able to clear the field).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_alphanum( $value = '', $request, $param ) {&nbsp;</div></li><li><div>        if ( ! empty( $value ) && ( ! is_string( $value ) || ! preg_match( '/^[a-z0-9]+$/i', $value ) ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be an alphanumeric string.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is a tag or id for a verification service, or an empty string (to be able to clear the field).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_verification_service( $value = '', $request, $param ) {&nbsp;</div></li><li><div>        if ( ! empty( $value ) && ! ( is_string( $value ) && ( preg_match( '/^[a-z0-9_-]+$/i', $value ) || preg_match( '#^&lt;meta name=&quot;([a-z0-9_\-.:]+)?&quot; content=&quot;([a-z0-9_-]+)?&quot; /&gt;$#i', $value ) ) ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be an alphanumeric string or a verification tag.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is among the roles allowed for Stats.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|bool $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_stats_roles( $value, $request, $param ) {&nbsp;</div></li><li><div>        if ( ! empty( $value ) && ! array_intersect( self::$stats_roles, $value ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf(&nbsp;</div></li><li><div>                /** Translators: first variable is the name of a parameter passed to endpoint holding the role that will be checked, the second is a list of roles allowed to see stats. The parameter is checked against this list. */&nbsp;</div></li><li><div>                esc_html__( '%1$s must be %2$s.', 'jetpack' ), $param, join( ', ', self::$stats_roles )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is among the views where the Sharing can be displayed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|bool $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_sharing_show( $value, $request, $param ) {&nbsp;</div></li><li><div>        $views = array( 'index', 'post', 'page', 'attachment', 'jetpack-portfolio' );&nbsp;</div></li><li><div>        if ( ! is_array( $value ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be an array of post types.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! array_intersect( $views, $value ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf(&nbsp;</div></li><li><div>                /** Translators: first variable is the name of a parameter passed to endpoint holding the post type where Sharing will be displayed, the second is a list of post types where Sharing can be displayed */&nbsp;</div></li><li><div>                esc_html__( '%1$s must be %2$s.', 'jetpack' ), $param, join( ', ', $views )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is among the views where the Sharing can be displayed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|bool $value {&nbsp;</div></li><li><div>     *     Value to check received by request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type array $visible List of slug of services to share to that are displayed directly in the page.&nbsp;</div></li><li><div>     *     @type array $hidden  List of slug of services to share to that are concealed in a folding menu.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_services( $value, $request, $param ) {&nbsp;</div></li><li><div>        if ( ! is_array( $value ) || ! isset( $value['visible'] ) || ! isset( $value['hidden'] ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be an array with visible and hidden items.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow to clear everything.&nbsp;</div></li><li><div>        if ( empty( $value['visible'] ) && empty( $value['hidden'] ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! class_exists( 'Sharing_Service' ) && ! include_once( JETPACK__PLUGIN_DIR . 'modules/sharedaddy/sharing-service.php' ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', esc_html__( 'Failed loading required dependency Sharing_Service.', 'jetpack' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $sharer = new Sharing_Service();&nbsp;</div></li><li><div>        $services = array_keys( $sharer-&gt;get_all_services() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (&nbsp;</div></li><li><div>            ( ! empty( $value['visible'] ) && ! array_intersect( $value['visible'], $services ) )&nbsp;</div></li><li><div>            ||&nbsp;</div></li><li><div>            ( ! empty( $value['hidden'] ) && ! array_intersect( $value['hidden'], $services ) ) )&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf(&nbsp;</div></li><li><div>                /** Translators: placeholder 1 is a parameter holding the services passed to endpoint, placeholder 2 is a list of all Jetpack Sharing services */&nbsp;</div></li><li><div>                esc_html__( '%1$s visible and hidden items must be a list of %2$s.', 'jetpack' ), $param, join( ', ', $services )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter has enough information to build a custom sharing button.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|bool $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_custom_service( $value, $request, $param ) {&nbsp;</div></li><li><div>        if ( ! is_array( $value ) || ! isset( $value['sharing_name'] ) || ! isset( $value['sharing_url'] ) || ! isset( $value['sharing_icon'] ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be an array with sharing name, url and icon.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow to clear everything.&nbsp;</div></li><li><div>        if ( empty( $value['sharing_name'] ) && empty( $value['sharing_url'] ) && empty( $value['sharing_icon'] ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! class_exists( 'Sharing_Service' ) && ! include_once( JETPACK__PLUGIN_DIR . 'modules/sharedaddy/sharing-service.php' ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', esc_html__( 'Failed loading required dependency Sharing_Service.', 'jetpack' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( ! empty( $value['sharing_name'] ) && ! is_string( $value['sharing_name'] ) )&nbsp;</div></li><li><div>        || ( ! empty( $value['sharing_url'] ) && ! is_string( $value['sharing_url'] ) )&nbsp;</div></li><li><div>        || ( ! empty( $value['sharing_icon'] ) && ! is_string( $value['sharing_icon'] ) ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s needs sharing name, url and icon.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is a custom sharing service ID like 'custom-1461976264'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_custom_service_id( $value = '', $request, $param ) {&nbsp;</div></li><li><div>        if ( ! empty( $value ) && ( ! is_string( $value ) || ! preg_match( '/custom\-[0-1]+/i', $value ) ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( &quot;%s must be a string prefixed with 'custom-' and followed by a numeric ID.&quot;, 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! class_exists( 'Sharing_Service' ) && ! include_once( JETPACK__PLUGIN_DIR . 'modules/sharedaddy/sharing-service.php' ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', esc_html__( 'Failed loading required dependency Sharing_Service.', 'jetpack' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $sharer = new Sharing_Service();&nbsp;</div></li><li><div>        $services = array_keys( $sharer-&gt;get_all_services() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $value ) && ! in_array( $value, $services ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s is not a registered custom sharing service.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is a Twitter username or empty string (to be able to clear the field).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_twitter_username( $value = '', $request, $param ) {&nbsp;</div></li><li><div>        if ( ! empty( $value ) && ( ! is_string( $value ) || ! preg_match( '/^@?\w{1, 15}$/i', $value ) ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be a Twitter username.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates that the parameter is a string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $value Value to check.&nbsp;</div></li><li><div>     * @param WP_REST_Request $request The request sent to the WP REST API.&nbsp;</div></li><li><div>     * @param string $param Name of the parameter passed to endpoint holding $value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function validate_string( $value = '', $request, $param ) {&nbsp;</div></li><li><div>        if ( ! is_string( $value ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_param', sprintf( esc_html__( '%s must be a string.', 'jetpack' ), $param ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * If for some reason the roles allowed to see Stats are empty (for example, user tampering with checkboxes), &nbsp;</div></li><li><div>     * return an array with only 'administrator' as the allowed role and save it for 'roles' option.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|bool $value Value to check.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function sanitize_stats_allowed_roles( $value ) {&nbsp;</div></li><li><div>        if ( empty( $value ) ) {&nbsp;</div></li><li><div>            return array( 'administrator' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the currently accessed route and return the module slug in it.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $route Regular expression for the endpoint with the module slug to return.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_module_requested( $route = '/module/(?P&lt;slug&gt;[a-z\-]+)' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $GLOBALS['wp']-&gt;query_vars['rest_route'] ) ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        preg_match( &quot;#$route#&quot;, $GLOBALS['wp']-&gt;query_vars['rest_route'], $module );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $module['slug'] ) ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $module['slug'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds extra information for modules.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string      $modules Can be a single module or a list of modules.&nbsp;</div></li><li><div>     * @param null|string $slug    Slug of the module in the first parameter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function prepare_modules_for_response( $modules = '', $slug = null ) {&nbsp;</div></li><li><div>        global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This filter is documented in modules/sitemaps/sitemaps.php */&nbsp;</div></li><li><div>        $location = apply_filters( 'jetpack_sitemap_location', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $wp_rewrite-&gt;using_index_permalinks() ) {&nbsp;</div></li><li><div>            $sitemap_url = home_url( '/index.php' . $location . '/sitemap.xml' );&nbsp;</div></li><li><div>            $news_sitemap_url = home_url( '/index.php' . $location . '/news-sitemap.xml' );&nbsp;</div></li><li><div>        } else if ( $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>            $sitemap_url = home_url( $location . '/sitemap.xml' );&nbsp;</div></li><li><div>            $news_sitemap_url = home_url( $location . '/news-sitemap.xml' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $sitemap_url = home_url( $location . '/?jetpack-sitemap=sitemap.xml' );&nbsp;</div></li><li><div>            $news_sitemap_url = home_url( $location . '/?jetpack-sitemap=news-sitemap.xml' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_null( $slug ) && isset( $modules['sitemaps'] ) ) {&nbsp;</div></li><li><div>            // Is a list of modules&nbsp;</div></li><li><div>            $modules['sitemaps']['extra']['sitemap_url'] = $sitemap_url;&nbsp;</div></li><li><div>            $modules['sitemaps']['extra']['news_sitemap_url'] = $news_sitemap_url;&nbsp;</div></li><li><div>        } elseif ( 'sitemaps' == $slug ) {&nbsp;</div></li><li><div>            // It's a single module&nbsp;</div></li><li><div>            $modules['extra']['sitemap_url'] = $sitemap_url;&nbsp;</div></li><li><div>            $modules['extra']['news_sitemap_url'] = $news_sitemap_url;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $modules;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove 'validate_callback' item from options available for module.&nbsp;</div></li><li><div>     * Fetch current option value and add to array of module options.&nbsp;</div></li><li><div>     * Prepare values of module options that need special handling, like those saved in wpcom.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $module Module slug.&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function prepare_options_for_response( $module = '' ) {&nbsp;</div></li><li><div>        $options = self::get_updateable_data_list( $module );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_array( $options ) || empty( $options ) ) {&nbsp;</div></li><li><div>            return $options;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $options as $key =&gt; $value ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $options[ $key ]['validate_callback'] ) ) {&nbsp;</div></li><li><div>                unset( $options[ $key ]['validate_callback'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $default_value = isset( $options[ $key ]['default'] ) ? $options[ $key ]['default'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $current_value = get_option( $key, $default_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $options[ $key ]['current_value'] = self::cast_value( $current_value, $options[ $key ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Some modules need special treatment.&nbsp;</div></li><li><div>        switch ( $module ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'monitor':&nbsp;</div></li><li><div>                // Status of user notifications&nbsp;</div></li><li><div>                $options['monitor_receive_notifications']['current_value'] = self::cast_value( self::get_remote_value( 'monitor', 'monitor_receive_notifications' ), $options['monitor_receive_notifications'] );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'post-by-email':&nbsp;</div></li><li><div>                // Email address&nbsp;</div></li><li><div>                $options['post_by_email_address']['current_value'] = self::cast_value( self::get_remote_value( 'post-by-email', 'post_by_email_address' ), $options['post_by_email_address'] );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'protect':&nbsp;</div></li><li><div>                // Protect&nbsp;</div></li><li><div>                $options['jetpack_protect_key']['current_value'] = get_site_option( 'jetpack_protect_key', false );&nbsp;</div></li><li><div>                if ( ! function_exists( 'jetpack_protect_format_whitelist' ) ) {&nbsp;</div></li><li><div>                    include_once( JETPACK__PLUGIN_DIR . 'modules/protect/shared-functions.php' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $options['jetpack_protect_global_whitelist']['current_value'] = jetpack_protect_format_whitelist();&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'related-posts':&nbsp;</div></li><li><div>                // It's local, but it must be broken apart since it's saved as an array.&nbsp;</div></li><li><div>                $options = self::split_options( $options, Jetpack_Options::get_option( 'relatedposts' ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'verification-tools':&nbsp;</div></li><li><div>                // It's local, but it must be broken apart since it's saved as an array.&nbsp;</div></li><li><div>                $options = self::split_options( $options, get_option( 'verification_services_codes' ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'google-analytics':&nbsp;</div></li><li><div>                $wga = get_option( 'jetpack_wga' );&nbsp;</div></li><li><div>                $code = '';&nbsp;</div></li><li><div>                if ( is_array( $wga ) && array_key_exists( 'code', $wga ) ) {&nbsp;</div></li><li><div>                     $code = $wga[ 'code' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $options[ 'google_analytics_tracking_id' ][ 'current_value' ] = $code;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'sharedaddy':&nbsp;</div></li><li><div>                // It's local, but it must be broken apart since it's saved as an array.&nbsp;</div></li><li><div>                if ( ! class_exists( 'Sharing_Service' ) && ! include_once( JETPACK__PLUGIN_DIR . 'modules/sharedaddy/sharing-service.php' ) ) {&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $sharer = new Sharing_Service();&nbsp;</div></li><li><div>                $options = self::split_options( $options, $sharer-&gt;get_global_options() );&nbsp;</div></li><li><div>                $options['sharing_services']['current_value'] = $sharer-&gt;get_blog_services();&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'after-the-deadline':&nbsp;</div></li><li><div>                if ( ! function_exists( 'AtD_get_options' ) ) {&nbsp;</div></li><li><div>                    include_once( JETPACK__PLUGIN_DIR . 'modules/after-the-deadline.php' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $atd_options = array_merge( AtD_get_options( get_current_user_id(), 'AtD_options' ), AtD_get_options( get_current_user_id(), 'AtD_check_when' ) );&nbsp;</div></li><li><div>                unset( $atd_options['name'] );&nbsp;</div></li><li><div>                foreach ( $atd_options as $key =&gt; $value ) {&nbsp;</div></li><li><div>                    $options[ $key ]['current_value'] = self::cast_value( $value, $options[ $key ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $atd_options = AtD_get_options( get_current_user_id(), 'AtD_guess_lang' );&nbsp;</div></li><li><div>                $options['guess_lang']['current_value'] = self::cast_value( isset( $atd_options['true'] ), $options[ 'guess_lang' ] );&nbsp;</div></li><li><div>                $options['ignored_phrases']['current_value'] = AtD_get_setting( get_current_user_id(), 'AtD_ignored_phrases' );&nbsp;</div></li><li><div>                unset( $options['unignore_phrase'] );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stats':&nbsp;</div></li><li><div>                // It's local, but it must be broken apart since it's saved as an array.&nbsp;</div></li><li><div>                if ( ! function_exists( 'stats_get_options' ) ) {&nbsp;</div></li><li><div>                    include_once( JETPACK__PLUGIN_DIR . 'modules/stats.php' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $options = self::split_options( $options, stats_get_options() );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $options;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Splits module options saved as arrays like relatedposts or verification_services_codes into separate options to be returned in the response.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $separate_options Array of options admitted by the module.&nbsp;</div></li><li><div>     * @param array  $grouped_options Option saved as array to be splitted.&nbsp;</div></li><li><div>     * @param string $prefix Optional prefix for the separate option keys.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function split_options( $separate_options, $grouped_options, $prefix = '' ) {&nbsp;</div></li><li><div>        if ( is_array( $grouped_options ) ) {&nbsp;</div></li><li><div>            foreach ( $grouped_options as $key =&gt; $value ) {&nbsp;</div></li><li><div>                $option_key = $prefix . $key;&nbsp;</div></li><li><div>                if ( isset( $separate_options[ $option_key ] ) ) {&nbsp;</div></li><li><div>                    $separate_options[ $option_key ]['current_value'] = self::cast_value( $grouped_options[ $key ], $separate_options[ $option_key ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $separate_options;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Perform a casting to the value specified in the option definition.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $value Value to cast to the proper type.&nbsp;</div></li><li><div>     * @param array $definition Type to cast the value to.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|float|int|string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function cast_value( $value, $definition ) {&nbsp;</div></li><li><div>        if ( $value === 'NULL' ) {&nbsp;</div></li><li><div>            return null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $definition['type'] ) ) {&nbsp;</div></li><li><div>            switch ( $definition['type'] ) {&nbsp;</div></li><li><div>                case 'boolean':&nbsp;</div></li><li><div>                    if ( 'true' === $value ) {&nbsp;</div></li><li><div>                        return true;&nbsp;</div></li><li><div>                    } elseif ( 'false' === $value ) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    return (bool) $value;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'integer':&nbsp;</div></li><li><div>                    return (int) $value;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'float':&nbsp;</div></li><li><div>                    return (float) $value;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'string':&nbsp;</div></li><li><div>                    return (string) $value;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a value not saved locally.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $module Module slug.&nbsp;</div></li><li><div>     * @param string $option Option name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether user is receiving notifications or not.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_remote_value( $module, $option ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $module, array( 'post-by-email' ), true ) ) {&nbsp;</div></li><li><div>            $option .= get_current_user_id();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If option doesn't exist, 'does_not_exist' will be returned.&nbsp;</div></li><li><div>        $value = get_option( $option, 'does_not_exist' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If option exists, just return it.&nbsp;</div></li><li><div>        if ( 'does_not_exist' !== $value ) {&nbsp;</div></li><li><div>            return $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only check a remote option if Jetpack is connected.&nbsp;</div></li><li><div>        if ( ! Jetpack::is_active() ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do what is necessary for each module.&nbsp;</div></li><li><div>        switch ( $module ) {&nbsp;</div></li><li><div>            case 'monitor':&nbsp;</div></li><li><div>                // Load the class to use the method. If class can't be found, do nothing.&nbsp;</div></li><li><div>                if ( ! class_exists( 'Jetpack_Monitor' ) && ! include_once( Jetpack::get_module_path( $module ) ) ) {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $value = Jetpack_Monitor::user_receives_notifications( false );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'post-by-email':&nbsp;</div></li><li><div>                // Load the class to use the method. If class can't be found, do nothing.&nbsp;</div></li><li><div>                if ( ! class_exists( 'Jetpack_Post_By_Email' ) && ! include_once( Jetpack::get_module_path( $module ) ) ) {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $post_by_email = new Jetpack_Post_By_Email();&nbsp;</div></li><li><div>                $value = $post_by_email-&gt;get_post_by_email_address();&nbsp;</div></li><li><div>                if ( $value === null ) {&nbsp;</div></li><li><div>                    $value = 'NULL'; // sentinel value so it actually gets set&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Normalize value to boolean.&nbsp;</div></li><li><div>        if ( is_wp_error( $value ) || is_null( $value ) ) {&nbsp;</div></li><li><div>            $value = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save option to use it next time.&nbsp;</div></li><li><div>        update_option( $option, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get number of plugin updates available.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed|WP_Error Number of plugin updates available. Otherwise, a WP_Error instance with the corresponding error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_plugin_update_count() {&nbsp;</div></li><li><div>        $updates = wp_get_update_data();&nbsp;</div></li><li><div>        if ( isset( $updates['counts'] ) && isset( $updates['counts']['plugins'] ) ) {&nbsp;</div></li><li><div>            $count = $updates['counts']['plugins'];&nbsp;</div></li><li><div>            if ( 0 == $count ) {&nbsp;</div></li><li><div>                $response = array(&nbsp;</div></li><li><div>                    'code' =&gt; 'success', &nbsp;</div></li><li><div>                    'message' =&gt; esc_html__( 'All plugins are up-to-date. Keep up the good work!', 'jetpack' ), &nbsp;</div></li><li><div>                    'count' =&gt; 0, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $response = array(&nbsp;</div></li><li><div>                    'code' =&gt; 'updates-available', &nbsp;</div></li><li><div>                    'message' =&gt; esc_html( sprintf( _n( '%s plugin need updating.', '%s plugins need updating.', $count, 'jetpack' ), $count ) ), &nbsp;</div></li><li><div>                    'count' =&gt; $count, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return rest_ensure_response( $response );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'not_found', esc_html__( 'Could not check updates for plugins on this site.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a list of all plugins in the site.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.2.0&nbsp;</div></li><li><div>     * @uses get_plugins()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function core_get_plugins() {&nbsp;</div></li><li><div>        if ( ! function_exists( 'get_plugins' ) ) {&nbsp;</div></li><li><div>            require_once ABSPATH . 'wp-admin/includes/plugin.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        /** This filter is documented in wp-admin/includes/class-wp-plugins-list-table.php */&nbsp;</div></li><li><div>        $plugins = apply_filters( 'all_plugins', get_plugins() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $plugins ) && ! empty( $plugins ) ) {&nbsp;</div></li><li><div>            foreach ( $plugins as $plugin_slug =&gt; $plugin_data ) {&nbsp;</div></li><li><div>                $plugins[ $plugin_slug ]['active'] = self::core_is_plugin_active( $plugin_slug );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $plugins;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if the queried plugin is active.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.2.0&nbsp;</div></li><li><div>     * @uses is_plugin_active()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function core_is_plugin_active( $plugin ) {&nbsp;</div></li><li><div>        if ( ! function_exists( 'is_plugin_active' ) ) {&nbsp;</div></li><li><div>            require_once ABSPATH . 'wp-admin/includes/plugin.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return is_plugin_active( $plugin );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get plugins data in site.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return WP_REST_Response|WP_Error List of plugins in the site. Otherwise, a WP_Error instance with the corresponding error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_plugins() {&nbsp;</div></li><li><div>        $plugins = self::core_get_plugins();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $plugins ) ) {&nbsp;</div></li><li><div>            return rest_ensure_response( $plugins );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'not_found', esc_html__( 'Unable to list plugins.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get data about the queried plugin. Currently it only returns whether the plugin is active or not.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_REST_Request $request {&nbsp;</div></li><li><div>     *     Array of parameters received by request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type string $slug Plugin slug with the syntax 'plugin-directory/plugin-main-file.php'.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|WP_Error True if module was activated. Otherwise, a WP_Error instance with the corresponding error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_plugin( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $plugins = self::core_get_plugins();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $plugins ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'no_plugins_found', esc_html__( 'This site has no plugins.', 'jetpack' ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $plugin = stripslashes( $request['plugin'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! in_array( $plugin, array_keys( $plugins ) ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'plugin_not_found', esc_html( sprintf( __( 'Plugin %s is not installed.', 'jetpack' ), $plugin ) ), array( 'status' =&gt; 404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $plugin_data = $plugins[ $plugin ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $plugin_data['active'] = self::core_is_plugin_active( $plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return rest_ensure_response( array(&nbsp;</div></li><li><div>            'code' =&gt; 'success', &nbsp;</div></li><li><div>            'message' =&gt; esc_html__( 'Plugin found.', 'jetpack' ), &nbsp;</div></li><li><div>            'data' =&gt; $plugin_data&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>} // class end&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.3.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/jetpack/4.9/classes/jetpack_core_json_api_endpoints/" class="active">4.9</a></li><li><a href="http://hookr.io/plugins/jetpack/4.8.2/classes/jetpack_core_json_api_endpoints/" class="">4.8.2</a></li><li><a href="http://hookr.io/plugins/jetpack/4.8.1/classes/jetpack_core_json_api_endpoints/" class="">4.8.1</a></li><li><a href="http://hookr.io/plugins/jetpack/4.8/classes/jetpack_core_json_api_endpoints/" class="">4.8</a></li><li><a href="http://hookr.io/plugins/jetpack/4.7.1/classes/jetpack_core_json_api_endpoints/" class="">4.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>Jetpack_Core_Json_Api_Endpoints</li><li><span></span>wp-plugin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>