<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-type="class" data-id="6238"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp_theme | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WP_Theme, class, wordpress, 4.7.4" /><meta name="description" content="WP_Theme Class" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=9c64d248ef8e131d6b673a369c7e0a2f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wp_theme/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwp_theme%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwp_theme%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-class-wp_theme","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp_theme" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7.4/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp_theme</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WP_Theme</strong></h1><p>WP_Theme Class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7.4/files/wp-includes-class-wp-theme/" class="file">/wp-includes/class-wp-theme.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="9" class="block" start="9"><li><div>final class WP_Theme implements ArrayAccess {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether the theme has been marked as updateable.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see WP_MS_Themes_List_Table&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $update = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Headers for style.css files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $file_headers = array(&nbsp;</div></li><li><div>        'Name' =&gt; 'Theme Name', &nbsp;</div></li><li><div>        'ThemeURI' =&gt; 'Theme URI', &nbsp;</div></li><li><div>        'Description' =&gt; 'Description', &nbsp;</div></li><li><div>        'Author' =&gt; 'Author', &nbsp;</div></li><li><div>        'AuthorURI' =&gt; 'Author URI', &nbsp;</div></li><li><div>        'Version' =&gt; 'Version', &nbsp;</div></li><li><div>        'Template' =&gt; 'Template', &nbsp;</div></li><li><div>        'Status' =&gt; 'Status', &nbsp;</div></li><li><div>        'Tags' =&gt; 'Tags', &nbsp;</div></li><li><div>        'TextDomain' =&gt; 'Text Domain', &nbsp;</div></li><li><div>        'DomainPath' =&gt; 'Domain Path', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Default themes.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $default_themes = array(&nbsp;</div></li><li><div>        'classic' =&gt; 'WordPress Classic', &nbsp;</div></li><li><div>        'default' =&gt; 'WordPress Default', &nbsp;</div></li><li><div>        'twentyten' =&gt; 'Twenty Ten', &nbsp;</div></li><li><div>        'twentyeleven' =&gt; 'Twenty Eleven', &nbsp;</div></li><li><div>        'twentytwelve' =&gt; 'Twenty Twelve', &nbsp;</div></li><li><div>        'twentythirteen' =&gt; 'Twenty Thirteen', &nbsp;</div></li><li><div>        'twentyfourteen' =&gt; 'Twenty Fourteen', &nbsp;</div></li><li><div>        'twentyfifteen' =&gt; 'Twenty Fifteen', &nbsp;</div></li><li><div>        'twentysixteen' =&gt; 'Twenty Sixteen', &nbsp;</div></li><li><div>        'twentyseventeen' =&gt; 'Twenty Seventeen', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Renamed theme tags.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $tag_map = array(&nbsp;</div></li><li><div>        'fixed-width' =&gt; 'fixed-layout', &nbsp;</div></li><li><div>        'flexible-width' =&gt; 'fluid-layout', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Absolute path to the theme root, usually wp-content/themes&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $theme_root;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Header data from the theme's style.css file.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $headers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Header data from the theme's style.css file after being sanitized.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $headers_sanitized;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Header name from the theme's style.css after being translated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Cached due to sorting functions running over the translated name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $name_translated;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Errors encountered when initializing the theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var WP_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $errors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The directory name of the theme's files, inside the theme root.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is directory name of the child theme.&nbsp;</div></li><li><div>     * Otherwise, 'stylesheet' is the same as 'template'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $stylesheet;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The directory name of the theme's files, inside the theme root.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is the directory name of the parent theme.&nbsp;</div></li><li><div>     * Otherwise, 'template' is the same as 'stylesheet'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $template;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * A reference to the parent theme, in the case of a child theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var WP_Theme&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $parent;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * URL to the theme root, usually an absolute URL to wp-content/themes&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $theme_root_uri;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flag for whether the theme's textdomain is loaded.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $textdomain_loaded;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Stores an md5 hash of the theme root, to function as the cache key.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $cache_hash;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flag for whether the themes cache bucket should be persistently cached.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Default is false. Can be set with the {@see 'wp_cache_themes_persistently'} filter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $persistently_cache;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Expiration time for the themes cache bucket.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * By default the bucket is not cached, so this value is useless.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $cache_expiration = 1800;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor for WP_Theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global array $wp_theme_directories&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $theme_dir Directory of the theme within the theme_root.&nbsp;</div></li><li><div>     * @param string $theme_root Theme root.&nbsp;</div></li><li><div>     * @param WP_Error|void $_child If this theme is a parent theme, the child may be passed for validation purposes.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct( $theme_dir, $theme_root, $_child = null ) {&nbsp;</div></li><li><div>        global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Initialize caching on first run.&nbsp;</div></li><li><div>        if ( ! isset( self::$persistently_cache ) ) {&nbsp;</div></li><li><div>            /** This action is documented in wp-includes/theme.php */&nbsp;</div></li><li><div>            self::$persistently_cache = apply_filters( 'wp_cache_themes_persistently', false, 'WP_Theme' );&nbsp;</div></li><li><div>            if ( self::$persistently_cache ) {&nbsp;</div></li><li><div>                wp_cache_add_global_groups( 'themes' );&nbsp;</div></li><li><div>                if ( is_int( self::$persistently_cache ) )&nbsp;</div></li><li><div>                    self::$cache_expiration = self::$persistently_cache;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                wp_cache_add_non_persistent_groups( 'themes' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;theme_root = $theme_root;&nbsp;</div></li><li><div>        $this-&gt;stylesheet = $theme_dir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Correct a situation where the theme is 'some-directory/some-theme' but 'some-directory' was passed in as part of the theme root instead.&nbsp;</div></li><li><div>        if ( ! in_array( $theme_root, (array) $wp_theme_directories ) && in_array( dirname( $theme_root ), (array) $wp_theme_directories ) ) {&nbsp;</div></li><li><div>            $this-&gt;stylesheet = basename( $this-&gt;theme_root ) . '/' . $this-&gt;stylesheet;&nbsp;</div></li><li><div>            $this-&gt;theme_root = dirname( $theme_root );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;cache_hash = md5( $this-&gt;theme_root . '/' . $this-&gt;stylesheet );&nbsp;</div></li><li><div>        $theme_file = $this-&gt;stylesheet . '/style.css';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cache = $this-&gt;cache_get( 'theme' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $cache ) ) {&nbsp;</div></li><li><div>            foreach ( array( 'errors', 'headers', 'template' ) as $key ) {&nbsp;</div></li><li><div>                if ( isset( $cache[ $key ] ) )&nbsp;</div></li><li><div>                    $this-&gt;$key = $cache[ $key ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $this-&gt;errors )&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            if ( isset( $cache['theme_root_template'] ) )&nbsp;</div></li><li><div>                $theme_root_template = $cache['theme_root_template'];&nbsp;</div></li><li><div>        } elseif ( ! file_exists( $this-&gt;theme_root . '/' . $theme_file ) ) {&nbsp;</div></li><li><div>            $this-&gt;headers['Name'] = $this-&gt;stylesheet;&nbsp;</div></li><li><div>            if ( ! file_exists( $this-&gt;theme_root . '/' . $this-&gt;stylesheet ) )&nbsp;</div></li><li><div>                $this-&gt;errors = new WP_Error( 'theme_not_found', sprintf( __( 'The theme directory &quot;%s&quot; does not exist.' ), esc_html( $this-&gt;stylesheet ) ) );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $this-&gt;errors = new WP_Error( 'theme_no_stylesheet', __( 'Stylesheet is missing.' ) );&nbsp;</div></li><li><div>            $this-&gt;template = $this-&gt;stylesheet;&nbsp;</div></li><li><div>            $this-&gt;cache_add( 'theme', array( 'headers' =&gt; $this-&gt;headers, 'errors' =&gt; $this-&gt;errors, 'stylesheet' =&gt; $this-&gt;stylesheet, 'template' =&gt; $this-&gt;template ) );&nbsp;</div></li><li><div>            if ( ! file_exists( $this-&gt;theme_root ) ) // Don't cache this one.&nbsp;</div></li><li><div>                $this-&gt;errors-&gt;add( 'theme_root_missing', __( 'ERROR: The themes directory is either empty or doesn&#8217;t exist. Please check your installation.' ) );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        } elseif ( ! is_readable( $this-&gt;theme_root . '/' . $theme_file ) ) {&nbsp;</div></li><li><div>            $this-&gt;headers['Name'] = $this-&gt;stylesheet;&nbsp;</div></li><li><div>            $this-&gt;errors = new WP_Error( 'theme_stylesheet_not_readable', __( 'Stylesheet is not readable.' ) );&nbsp;</div></li><li><div>            $this-&gt;template = $this-&gt;stylesheet;&nbsp;</div></li><li><div>            $this-&gt;cache_add( 'theme', array( 'headers' =&gt; $this-&gt;headers, 'errors' =&gt; $this-&gt;errors, 'stylesheet' =&gt; $this-&gt;stylesheet, 'template' =&gt; $this-&gt;template ) );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;headers = get_file_data( $this-&gt;theme_root . '/' . $theme_file, self::$file_headers, 'theme' );&nbsp;</div></li><li><div>            // Default themes always trump their pretenders.&nbsp;</div></li><li><div>            // Properly identify default themes that are inside a directory within wp-content/themes.&nbsp;</div></li><li><div>            if ( $default_theme_slug = array_search( $this-&gt;headers['Name'], self::$default_themes ) ) {&nbsp;</div></li><li><div>                if ( basename( $this-&gt;stylesheet ) != $default_theme_slug )&nbsp;</div></li><li><div>                    $this-&gt;headers['Name'] .= '/' . $this-&gt;stylesheet;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // (If template is set from cache [and there are no errors], we know it's good.)&nbsp;</div></li><li><div>        if ( ! $this-&gt;template && ! ( $this-&gt;template = $this-&gt;headers['Template'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;template = $this-&gt;stylesheet;&nbsp;</div></li><li><div>            if ( ! file_exists( $this-&gt;theme_root . '/' . $this-&gt;stylesheet . '/index.php' ) ) {&nbsp;</div></li><li><div>                $error_message = sprintf(&nbsp;</div></li><li><div>                    /** translators: 1: index.php, 2: Codex URL, 3: style.css */&nbsp;</div></li><li><div>                    __( 'Template is missing. Standalone themes need to have a %1$s template file. &lt;a href=&quot;%2$s&quot;&gt;Child themes&lt;/a&gt; need to have a Template header in the %3$s stylesheet.' ), &nbsp;</div></li><li><div>                    '&lt;code&gt;index.php&lt;/code&gt;', &nbsp;</div></li><li><div>                    __( 'https://codex.wordpress.org/Child_Themes' ), &nbsp;</div></li><li><div>                    '&lt;code&gt;style.css&lt;/code&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;errors = new WP_Error( 'theme_no_index', $error_message );&nbsp;</div></li><li><div>                $this-&gt;cache_add( 'theme', array( 'headers' =&gt; $this-&gt;headers, 'errors' =&gt; $this-&gt;errors, 'stylesheet' =&gt; $this-&gt;stylesheet, 'template' =&gt; $this-&gt;template ) );&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we got our data from cache, we can assume that 'template' is pointing to the right place.&nbsp;</div></li><li><div>        if ( ! is_array( $cache ) && $this-&gt;template != $this-&gt;stylesheet && ! file_exists( $this-&gt;theme_root . '/' . $this-&gt;template . '/index.php' ) ) {&nbsp;</div></li><li><div>            // If we're in a directory of themes inside /themes, look for the parent nearby.&nbsp;</div></li><li><div>            // wp-content/themes/directory-of-themes/*&nbsp;</div></li><li><div>            $parent_dir = dirname( $this-&gt;stylesheet );&nbsp;</div></li><li><div>            if ( '.' != $parent_dir && file_exists( $this-&gt;theme_root . '/' . $parent_dir . '/' . $this-&gt;template . '/index.php' ) ) {&nbsp;</div></li><li><div>                $this-&gt;template = $parent_dir . '/' . $this-&gt;template;&nbsp;</div></li><li><div>            } elseif ( ( $directories = search_theme_directories() ) && isset( $directories[ $this-&gt;template ] ) ) {&nbsp;</div></li><li><div>                // Look for the template in the search_theme_directories() results, in case it is in another theme root.&nbsp;</div></li><li><div>                // We don't look into directories of themes, just the theme root.&nbsp;</div></li><li><div>                $theme_root_template = $directories[ $this-&gt;template ]['theme_root'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // Parent theme is missing.&nbsp;</div></li><li><div>                $this-&gt;errors = new WP_Error( 'theme_no_parent', sprintf( __( 'The parent theme is missing. Please install the &quot;%s&quot; parent theme.' ), esc_html( $this-&gt;template ) ) );&nbsp;</div></li><li><div>                $this-&gt;cache_add( 'theme', array( 'headers' =&gt; $this-&gt;headers, 'errors' =&gt; $this-&gt;errors, 'stylesheet' =&gt; $this-&gt;stylesheet, 'template' =&gt; $this-&gt;template ) );&nbsp;</div></li><li><div>                $this-&gt;parent = new WP_Theme( $this-&gt;template, $this-&gt;theme_root, $this );&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the parent, if we're a child theme.&nbsp;</div></li><li><div>        if ( $this-&gt;template != $this-&gt;stylesheet ) {&nbsp;</div></li><li><div>            // If we are a parent, then there is a problem. Only two generations allowed! Cancel things out.&nbsp;</div></li><li><div>            if ( $_child instanceof WP_Theme && $_child-&gt;template == $this-&gt;stylesheet ) {&nbsp;</div></li><li><div>                $_child-&gt;parent = null;&nbsp;</div></li><li><div>                $_child-&gt;errors = new WP_Error( 'theme_parent_invalid', sprintf( __( 'The &quot;%s&quot; theme is not a valid parent theme.' ), esc_html( $_child-&gt;template ) ) );&nbsp;</div></li><li><div>                $_child-&gt;cache_add( 'theme', array( 'headers' =&gt; $_child-&gt;headers, 'errors' =&gt; $_child-&gt;errors, 'stylesheet' =&gt; $_child-&gt;stylesheet, 'template' =&gt; $_child-&gt;template ) );&nbsp;</div></li><li><div>                // The two themes actually reference each other with the Template header.&nbsp;</div></li><li><div>                if ( $_child-&gt;stylesheet == $this-&gt;template ) {&nbsp;</div></li><li><div>                    $this-&gt;errors = new WP_Error( 'theme_parent_invalid', sprintf( __( 'The &quot;%s&quot; theme is not a valid parent theme.' ), esc_html( $this-&gt;template ) ) );&nbsp;</div></li><li><div>                    $this-&gt;cache_add( 'theme', array( 'headers' =&gt; $this-&gt;headers, 'errors' =&gt; $this-&gt;errors, 'stylesheet' =&gt; $this-&gt;stylesheet, 'template' =&gt; $this-&gt;template ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Set the parent. Pass the current instance so we can do the crazy checks above and assess errors.&nbsp;</div></li><li><div>            $this-&gt;parent = new WP_Theme( $this-&gt;template, isset( $theme_root_template ) ? $theme_root_template : $this-&gt;theme_root, $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // We're good. If we didn't retrieve from cache, set it.&nbsp;</div></li><li><div>        if ( ! is_array( $cache ) ) {&nbsp;</div></li><li><div>            $cache = array( 'headers' =&gt; $this-&gt;headers, 'errors' =&gt; $this-&gt;errors, 'stylesheet' =&gt; $this-&gt;stylesheet, 'template' =&gt; $this-&gt;template );&nbsp;</div></li><li><div>            // If the parent theme is in another root, we'll want to cache this. Avoids an entire branch of filesystem calls above.&nbsp;</div></li><li><div>            if ( isset( $theme_root_template ) )&nbsp;</div></li><li><div>                $cache['theme_root_template'] = $theme_root_template;&nbsp;</div></li><li><div>            $this-&gt;cache_add( 'theme', $cache );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * When converting the object to a string, the theme name is returned.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Theme name, ready for display (translated)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __toString() {&nbsp;</div></li><li><div>        return (string) $this-&gt;display('Name');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * __isset() magic method for properties formerly returned by current_theme_info()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @staticvar array $properties&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $offset Property to check if set.&nbsp;</div></li><li><div>     * @return bool Whether the given property is set.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __isset( $offset ) {&nbsp;</div></li><li><div>        static $properties = array(&nbsp;</div></li><li><div>            'name', 'title', 'version', 'parent_theme', 'template_dir', 'stylesheet_dir', 'template', 'stylesheet', &nbsp;</div></li><li><div>            'screenshot', 'description', 'author', 'tags', 'theme_root', 'theme_root_uri', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return in_array( $offset, $properties );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * __get() magic method for properties formerly returned by current_theme_info()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $offset Property to get.&nbsp;</div></li><li><div>     * @return mixed Property value.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __get( $offset ) {&nbsp;</div></li><li><div>        switch ( $offset ) {&nbsp;</div></li><li><div>            case 'name' :&nbsp;</div></li><li><div>            case 'title' :&nbsp;</div></li><li><div>                return $this-&gt;get('Name');&nbsp;</div></li><li><div>            case 'version' :&nbsp;</div></li><li><div>                return $this-&gt;get('Version');&nbsp;</div></li><li><div>            case 'parent_theme' :&nbsp;</div></li><li><div>                return $this-&gt;parent() ? $this-&gt;parent()-&gt;get('Name') : '';&nbsp;</div></li><li><div>            case 'template_dir' :&nbsp;</div></li><li><div>                return $this-&gt;get_template_directory();&nbsp;</div></li><li><div>            case 'stylesheet_dir' :&nbsp;</div></li><li><div>                return $this-&gt;get_stylesheet_directory();&nbsp;</div></li><li><div>            case 'template' :&nbsp;</div></li><li><div>                return $this-&gt;get_template();&nbsp;</div></li><li><div>            case 'stylesheet' :&nbsp;</div></li><li><div>                return $this-&gt;get_stylesheet();&nbsp;</div></li><li><div>            case 'screenshot' :&nbsp;</div></li><li><div>                return $this-&gt;get_screenshot( 'relative' );&nbsp;</div></li><li><div>            // 'author' and 'description' did not previously return translated data.&nbsp;</div></li><li><div>            case 'description' :&nbsp;</div></li><li><div>                return $this-&gt;display('Description');&nbsp;</div></li><li><div>            case 'author' :&nbsp;</div></li><li><div>                return $this-&gt;display('Author');&nbsp;</div></li><li><div>            case 'tags' :&nbsp;</div></li><li><div>                return $this-&gt;get( 'Tags' );&nbsp;</div></li><li><div>            case 'theme_root' :&nbsp;</div></li><li><div>                return $this-&gt;get_theme_root();&nbsp;</div></li><li><div>            case 'theme_root_uri' :&nbsp;</div></li><li><div>                return $this-&gt;get_theme_root_uri();&nbsp;</div></li><li><div>            // For cases where the array was converted to an object.&nbsp;</div></li><li><div>            default :&nbsp;</div></li><li><div>                return $this-&gt;offsetGet( $offset );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Method to implement ArrayAccess for keys formerly returned by get_themes()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $offset&nbsp;</div></li><li><div>     * @param mixed $value&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function offsetSet( $offset, $value ) {}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Method to implement ArrayAccess for keys formerly returned by get_themes()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $offset&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function offsetUnset( $offset ) {}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Method to implement ArrayAccess for keys formerly returned by get_themes()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @staticvar array $keys&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $offset&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function offsetExists( $offset ) {&nbsp;</div></li><li><div>        static $keys = array(&nbsp;</div></li><li><div>            'Name', 'Version', 'Status', 'Title', 'Author', 'Author Name', 'Author URI', 'Description', &nbsp;</div></li><li><div>            'Template', 'Stylesheet', 'Template Files', 'Stylesheet Files', 'Template Dir', 'Stylesheet Dir', &nbsp;</div></li><li><div>            'Screenshot', 'Tags', 'Theme Root', 'Theme Root URI', 'Parent Theme', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return in_array( $offset, $keys );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Method to implement ArrayAccess for keys formerly returned by get_themes().&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Author, Author Name, Author URI, and Description did not previously return&nbsp;</div></li><li><div>     * translated data. We are doing so now as it is safe to do. However, as&nbsp;</div></li><li><div>     * Name and Title could have been used as the key for get_themes(), both remain&nbsp;</div></li><li><div>     * untranslated for back compatibility. This means that ['Name'] is not ideal, &nbsp;</div></li><li><div>     * and care should be taken to use `$theme::display( 'Name' )` to get a properly&nbsp;</div></li><li><div>     * translated header.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $offset&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function offsetGet( $offset ) {&nbsp;</div></li><li><div>        switch ( $offset ) {&nbsp;</div></li><li><div>            case 'Name' :&nbsp;</div></li><li><div>            case 'Title' :&nbsp;</div></li><li><div>                /**&nbsp;</div></li><li><div>                 * See note above about using translated data. get() is not ideal.&nbsp;</div></li><li><div>                 * It is only for backward compatibility. Use display().&nbsp;</div></li><li><div>                 */&nbsp;</div></li><li><div>                return $this-&gt;get('Name');&nbsp;</div></li><li><div>            case 'Author' :&nbsp;</div></li><li><div>                return $this-&gt;display( 'Author');&nbsp;</div></li><li><div>            case 'Author Name' :&nbsp;</div></li><li><div>                return $this-&gt;display( 'Author', false);&nbsp;</div></li><li><div>            case 'Author URI' :&nbsp;</div></li><li><div>                return $this-&gt;display('AuthorURI');&nbsp;</div></li><li><div>            case 'Description' :&nbsp;</div></li><li><div>                return $this-&gt;display( 'Description');&nbsp;</div></li><li><div>            case 'Version' :&nbsp;</div></li><li><div>            case 'Status' :&nbsp;</div></li><li><div>                return $this-&gt;get( $offset );&nbsp;</div></li><li><div>            case 'Template' :&nbsp;</div></li><li><div>                return $this-&gt;get_template();&nbsp;</div></li><li><div>            case 'Stylesheet' :&nbsp;</div></li><li><div>                return $this-&gt;get_stylesheet();&nbsp;</div></li><li><div>            case 'Template Files' :&nbsp;</div></li><li><div>                return $this-&gt;get_files( 'php', 1, true );&nbsp;</div></li><li><div>            case 'Stylesheet Files' :&nbsp;</div></li><li><div>                return $this-&gt;get_files( 'css', 0, false );&nbsp;</div></li><li><div>            case 'Template Dir' :&nbsp;</div></li><li><div>                return $this-&gt;get_template_directory();&nbsp;</div></li><li><div>            case 'Stylesheet Dir' :&nbsp;</div></li><li><div>                return $this-&gt;get_stylesheet_directory();&nbsp;</div></li><li><div>            case 'Screenshot' :&nbsp;</div></li><li><div>                return $this-&gt;get_screenshot( 'relative' );&nbsp;</div></li><li><div>            case 'Tags' :&nbsp;</div></li><li><div>                return $this-&gt;get('Tags');&nbsp;</div></li><li><div>            case 'Theme Root' :&nbsp;</div></li><li><div>                return $this-&gt;get_theme_root();&nbsp;</div></li><li><div>            case 'Theme Root URI' :&nbsp;</div></li><li><div>                return $this-&gt;get_theme_root_uri();&nbsp;</div></li><li><div>            case 'Parent Theme' :&nbsp;</div></li><li><div>                return $this-&gt;parent() ? $this-&gt;parent()-&gt;get('Name') : '';&nbsp;</div></li><li><div>            default :&nbsp;</div></li><li><div>                return null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns errors property.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return WP_Error|false WP_Error if there are errors, or false.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function errors() {&nbsp;</div></li><li><div>        return is_wp_error( $this-&gt;errors ) ? $this-&gt;errors : false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether the theme exists.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * A theme with errors exists. A theme with the error of 'theme_not_found', &nbsp;</div></li><li><div>     * meaning that the theme's directory was not found, does not exist.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether the theme exists.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function exists() {&nbsp;</div></li><li><div>        return ! ( $this-&gt;errors() && in_array( 'theme_not_found', $this-&gt;errors()-&gt;get_error_codes() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns reference to the parent theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return WP_Theme|false Parent theme, or false if the current theme is not a child theme.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parent() {&nbsp;</div></li><li><div>        return isset( $this-&gt;parent ) ? $this-&gt;parent : false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds theme data to cache.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Cache entries keyed by the theme and the type of data.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $key Type of data to store (theme, screenshot, headers, post_templates)&nbsp;</div></li><li><div>     * @param string $data Data to store&nbsp;</div></li><li><div>     * @return bool Return value from wp_cache_add()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function cache_add( $key, $data ) {&nbsp;</div></li><li><div>        return wp_cache_add( $key . '-' . $this-&gt;cache_hash, $data, 'themes', self::$cache_expiration );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets theme data from cache.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Cache entries are keyed by the theme and the type of data.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $key Type of data to retrieve (theme, screenshot, headers, post_templates)&nbsp;</div></li><li><div>     * @return mixed Retrieved data&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function cache_get( $key ) {&nbsp;</div></li><li><div>        return wp_cache_get( $key . '-' . $this-&gt;cache_hash, 'themes' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Clears the cache for the theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function cache_delete() {&nbsp;</div></li><li><div>        foreach ( array( 'theme', 'screenshot', 'headers', 'post_templates' ) as $key )&nbsp;</div></li><li><div>            wp_cache_delete( $key . '-' . $this-&gt;cache_hash, 'themes' );&nbsp;</div></li><li><div>        $this-&gt;template = $this-&gt;textdomain_loaded = $this-&gt;theme_root_uri = $this-&gt;parent = $this-&gt;errors = $this-&gt;headers_sanitized = $this-&gt;name_translated = null;&nbsp;</div></li><li><div>        $this-&gt;headers = array();&nbsp;</div></li><li><div>        $this-&gt;__construct( $this-&gt;stylesheet, $this-&gt;theme_root );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a raw, unformatted theme header.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The header is sanitized, but is not translated, and is not marked up for display.&nbsp;</div></li><li><div>     * To get a theme header for display, use the display() method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Use the get_template() method, not the 'Template' header, for finding the template.&nbsp;</div></li><li><div>     * The 'Template' header is only good for what was written in the style.css, while&nbsp;</div></li><li><div>     * get_template() takes into account where WordPress actually located the theme and&nbsp;</div></li><li><div>     * whether it is actually valid.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $header Theme header. Name, Description, Author, Version, ThemeURI, AuthorURI, Status, Tags.&nbsp;</div></li><li><div>     * @return string|false String on success, false on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get( $header ) {&nbsp;</div></li><li><div>        if ( ! isset( $this-&gt;headers[ $header ] ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $this-&gt;headers_sanitized ) ) {&nbsp;</div></li><li><div>            $this-&gt;headers_sanitized = $this-&gt;cache_get( 'headers' );&nbsp;</div></li><li><div>            if ( ! is_array( $this-&gt;headers_sanitized ) )&nbsp;</div></li><li><div>                $this-&gt;headers_sanitized = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $this-&gt;headers_sanitized[ $header ] ) )&nbsp;</div></li><li><div>            return $this-&gt;headers_sanitized[ $header ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If themes are a persistent group, sanitize everything and cache it. One cache add is better than many cache sets.&nbsp;</div></li><li><div>        if ( self::$persistently_cache ) {&nbsp;</div></li><li><div>            foreach ( array_keys( $this-&gt;headers ) as $_header )&nbsp;</div></li><li><div>                $this-&gt;headers_sanitized[ $_header ] = $this-&gt;sanitize_header( $_header, $this-&gt;headers[ $_header ] );&nbsp;</div></li><li><div>            $this-&gt;cache_add( 'headers', $this-&gt;headers_sanitized );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;headers_sanitized[ $header ] = $this-&gt;sanitize_header( $header, $this-&gt;headers[ $header ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;headers_sanitized[ $header ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets a theme header, formatted and translated for display.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $header Theme header. Name, Description, Author, Version, ThemeURI, AuthorURI, Status, Tags.&nbsp;</div></li><li><div>     * @param bool $markup Optional. Whether to mark up the header. Defaults to true.&nbsp;</div></li><li><div>     * @param bool $translate Optional. Whether to translate the header. Defaults to true.&nbsp;</div></li><li><div>     * @return string|false Processed header, false on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function display( $header, $markup = true, $translate = true ) {&nbsp;</div></li><li><div>        $value = $this-&gt;get( $header );&nbsp;</div></li><li><div>        if ( false === $value ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $translate && ( empty( $value ) || ! $this-&gt;load_textdomain() ) )&nbsp;</div></li><li><div>            $translate = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $translate )&nbsp;</div></li><li><div>            $value = $this-&gt;translate_header( $header, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $markup )&nbsp;</div></li><li><div>            $value = $this-&gt;markup_header( $header, $value, $translate );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sanitize a theme header.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @staticvar array $header_tags&nbsp;</div></li><li><div>     * @staticvar array $header_tags_with_a&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $header Theme header. Name, Description, Author, Version, ThemeURI, AuthorURI, Status, Tags.&nbsp;</div></li><li><div>     * @param string $value Value to sanitize.&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function sanitize_header( $header, $value ) {&nbsp;</div></li><li><div>        switch ( $header ) {&nbsp;</div></li><li><div>            case 'Status' :&nbsp;</div></li><li><div>                if ( ! $value ) {&nbsp;</div></li><li><div>                    $value = 'publish';&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // Fall through otherwise.&nbsp;</div></li><li><div>            case 'Name' :&nbsp;</div></li><li><div>                static $header_tags = array(&nbsp;</div></li><li><div>                    'abbr' =&gt; array( 'title' =&gt; true ), &nbsp;</div></li><li><div>                    'acronym' =&gt; array( 'title' =&gt; true ), &nbsp;</div></li><li><div>                    'code' =&gt; true, &nbsp;</div></li><li><div>                    'em' =&gt; true, &nbsp;</div></li><li><div>                    'strong' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $value = wp_kses( $value, $header_tags );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'Author' :&nbsp;</div></li><li><div>                // There shouldn't be anchor tags in Author, but some themes like to be challenging.&nbsp;</div></li><li><div>            case 'Description' :&nbsp;</div></li><li><div>                static $header_tags_with_a = array(&nbsp;</div></li><li><div>                    'a' =&gt; array( 'href' =&gt; true, 'title' =&gt; true ), &nbsp;</div></li><li><div>                    'abbr' =&gt; array( 'title' =&gt; true ), &nbsp;</div></li><li><div>                    'acronym' =&gt; array( 'title' =&gt; true ), &nbsp;</div></li><li><div>                    'code' =&gt; true, &nbsp;</div></li><li><div>                    'em' =&gt; true, &nbsp;</div></li><li><div>                    'strong' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $value = wp_kses( $value, $header_tags_with_a );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'ThemeURI' :&nbsp;</div></li><li><div>            case 'AuthorURI' :&nbsp;</div></li><li><div>                $value = esc_url_raw( $value );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'Tags' :&nbsp;</div></li><li><div>                $value = array_filter( array_map( 'trim', explode( ', ', strip_tags( $value ) ) ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'Version' :&nbsp;</div></li><li><div>                $value = strip_tags( $value );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Mark up a theme header.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @staticvar string $comma&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $header Theme header. Name, Description, Author, Version, ThemeURI, AuthorURI, Status, Tags.&nbsp;</div></li><li><div>     * @param string $value Value to mark up.&nbsp;</div></li><li><div>     * @param string $translate Whether the header has been translated.&nbsp;</div></li><li><div>     * @return string Value, marked up.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function markup_header( $header, $value, $translate ) {&nbsp;</div></li><li><div>        switch ( $header ) {&nbsp;</div></li><li><div>            case 'Name' :&nbsp;</div></li><li><div>                if ( empty( $value ) ) {&nbsp;</div></li><li><div>                    $value = esc_html( $this-&gt;get_stylesheet() );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'Description' :&nbsp;</div></li><li><div>                $value = wptexturize( $value );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'Author' :&nbsp;</div></li><li><div>                if ( $this-&gt;get('AuthorURI') ) {&nbsp;</div></li><li><div>                    $value = sprintf( '&lt;a href=&quot;%1$s&quot;&gt;%2$s&lt;/a&gt;', $this-&gt;display( 'AuthorURI', true, $translate ), $value );&nbsp;</div></li><li><div>                } elseif ( ! $value ) {&nbsp;</div></li><li><div>                    $value = __( 'Anonymous' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'Tags' :&nbsp;</div></li><li><div>                static $comma = null;&nbsp;</div></li><li><div>                if ( ! isset( $comma ) ) {&nbsp;</div></li><li><div>                    /** translators: used between list items, there is a space after the comma */&nbsp;</div></li><li><div>                    $comma = __( ', ' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $value = implode( $comma, $value );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'ThemeURI' :&nbsp;</div></li><li><div>            case 'AuthorURI' :&nbsp;</div></li><li><div>                $value = esc_url( $value );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Translate a theme header.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @staticvar array $tags_list&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $header Theme header. Name, Description, Author, Version, ThemeURI, AuthorURI, Status, Tags.&nbsp;</div></li><li><div>     * @param string $value Value to translate.&nbsp;</div></li><li><div>     * @return string Translated value.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function translate_header( $header, $value ) {&nbsp;</div></li><li><div>        switch ( $header ) {&nbsp;</div></li><li><div>            case 'Name' :&nbsp;</div></li><li><div>                // Cached for sorting reasons.&nbsp;</div></li><li><div>                if ( isset( $this-&gt;name_translated ) )&nbsp;</div></li><li><div>                    return $this-&gt;name_translated;&nbsp;</div></li><li><div>                $this-&gt;name_translated = translate( $value, $this-&gt;get('TextDomain' ) );&nbsp;</div></li><li><div>                return $this-&gt;name_translated;&nbsp;</div></li><li><div>            case 'Tags' :&nbsp;</div></li><li><div>                if ( empty( $value ) || ! function_exists( 'get_theme_feature_list' ) ) {&nbsp;</div></li><li><div>                    return $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                static $tags_list;&nbsp;</div></li><li><div>                if ( ! isset( $tags_list ) ) {&nbsp;</div></li><li><div>                    $tags_list = array(&nbsp;</div></li><li><div>                        // As of 4.6, deprecated tags which are only used to provide translation for older themes.&nbsp;</div></li><li><div>                        'black' =&gt; __( 'Black' ), 'blue' =&gt; __( 'Blue' ), 'brown' =&gt; __( 'Brown' ), &nbsp;</div></li><li><div>                        'gray' =&gt; __( 'Gray' ), 'green' =&gt; __( 'Green' ), 'orange' =&gt; __( 'Orange' ), &nbsp;</div></li><li><div>                        'pink' =&gt; __( 'Pink' ), 'purple' =&gt; __( 'Purple' ), 'red' =&gt; __( 'Red' ), &nbsp;</div></li><li><div>                        'silver' =&gt; __( 'Silver' ), 'tan' =&gt; __( 'Tan' ), 'white' =&gt; __( 'White' ), &nbsp;</div></li><li><div>                        'yellow' =&gt; __( 'Yellow' ), 'dark' =&gt; __( 'Dark' ), 'light' =&gt; __( 'Light' ), &nbsp;</div></li><li><div>                        'fixed-layout' =&gt; __( 'Fixed Layout' ), 'fluid-layout' =&gt; __( 'Fluid Layout' ), &nbsp;</div></li><li><div>                        'responsive-layout' =&gt; __( 'Responsive Layout' ), 'blavatar' =&gt; __( 'Blavatar' ), &nbsp;</div></li><li><div>                        'photoblogging' =&gt; __( 'Photoblogging' ), 'seasonal' =&gt; __( 'Seasonal' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $feature_list = get_theme_feature_list( false ); // No API&nbsp;</div></li><li><div>                    foreach ( $feature_list as $tags ) {&nbsp;</div></li><li><div>                        $tags_list += $tags;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $value as &$tag ) {&nbsp;</div></li><li><div>                    if ( isset( $tags_list[ $tag ] ) ) {&nbsp;</div></li><li><div>                        $tag = $tags_list[ $tag ];&nbsp;</div></li><li><div>                    } elseif ( isset( self::$tag_map[ $tag ] ) ) {&nbsp;</div></li><li><div>                        $tag = $tags_list[ self::$tag_map[ $tag ] ];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default :&nbsp;</div></li><li><div>                $value = translate( $value, $this-&gt;get('TextDomain') );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The directory name of the theme's &quot;stylesheet&quot; files, inside the theme root.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is directory name of the child theme.&nbsp;</div></li><li><div>     * Otherwise, get_stylesheet() is the same as get_template().&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Stylesheet&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_stylesheet() {&nbsp;</div></li><li><div>        return $this-&gt;stylesheet;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The directory name of the theme's &quot;template&quot; files, inside the theme root.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is the directory name of the parent theme.&nbsp;</div></li><li><div>     * Otherwise, the get_template() is the same as get_stylesheet().&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Template&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_template() {&nbsp;</div></li><li><div>        return $this-&gt;template;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the absolute path to the directory of a theme's &quot;stylesheet&quot; files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is the absolute path to the directory&nbsp;</div></li><li><div>     * of the child theme's files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Absolute path of the stylesheet directory.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_stylesheet_directory() {&nbsp;</div></li><li><div>        if ( $this-&gt;errors() && in_array( 'theme_root_missing', $this-&gt;errors()-&gt;get_error_codes() ) )&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;theme_root . '/' . $this-&gt;stylesheet;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the absolute path to the directory of a theme's &quot;template&quot; files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is the absolute path to the directory&nbsp;</div></li><li><div>     * of the parent theme's files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Absolute path of the template directory.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_template_directory() {&nbsp;</div></li><li><div>        if ( $this-&gt;parent() )&nbsp;</div></li><li><div>            $theme_root = $this-&gt;parent()-&gt;theme_root;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $theme_root = $this-&gt;theme_root;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $theme_root . '/' . $this-&gt;template;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the URL to the directory of a theme's &quot;stylesheet&quot; files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is the URL to the directory of the&nbsp;</div></li><li><div>     * child theme's files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string URL to the stylesheet directory.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_stylesheet_directory_uri() {&nbsp;</div></li><li><div>        return $this-&gt;get_theme_root_uri() . '/' . str_replace( '%2F', '/', rawurlencode( $this-&gt;stylesheet ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the URL to the directory of a theme's &quot;template&quot; files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the case of a child theme, this is the URL to the directory of the&nbsp;</div></li><li><div>     * parent theme's files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string URL to the template directory.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_template_directory_uri() {&nbsp;</div></li><li><div>        if ( $this-&gt;parent() )&nbsp;</div></li><li><div>            $theme_root_uri = $this-&gt;parent()-&gt;get_theme_root_uri();&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $theme_root_uri = $this-&gt;get_theme_root_uri();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $theme_root_uri . '/' . str_replace( '%2F', '/', rawurlencode( $this-&gt;template ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The absolute path to the directory of the theme root.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This is typically the absolute path to wp-content/themes.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Theme root.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_theme_root() {&nbsp;</div></li><li><div>        return $this-&gt;theme_root;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the URL to the directory of the theme root.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This is typically the absolute URL to wp-content/themes. This forms the basis&nbsp;</div></li><li><div>     * for all other URLs returned by WP_Theme, so we pass it to the public function&nbsp;</div></li><li><div>     * get_theme_root_uri() and allow it to run the {@see 'theme_root_uri'} filter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Theme root URI.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_theme_root_uri() {&nbsp;</div></li><li><div>        if ( ! isset( $this-&gt;theme_root_uri ) )&nbsp;</div></li><li><div>            $this-&gt;theme_root_uri = get_theme_root_uri( $this-&gt;stylesheet, $this-&gt;theme_root );&nbsp;</div></li><li><div>        return $this-&gt;theme_root_uri;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the main screenshot file for the theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The main screenshot is called screenshot.png. gif and jpg extensions are also allowed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Screenshots for a theme must be in the stylesheet directory. (In the case of child&nbsp;</div></li><li><div>     * themes, parent theme screenshots are not inherited.)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $uri Type of URL to return, either 'relative' or an absolute URI. Defaults to absolute URI.&nbsp;</div></li><li><div>     * @return string|false Screenshot file. False if the theme does not have a screenshot.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_screenshot( $uri = 'uri' ) {&nbsp;</div></li><li><div>        $screenshot = $this-&gt;cache_get( 'screenshot' );&nbsp;</div></li><li><div>        if ( $screenshot ) {&nbsp;</div></li><li><div>            if ( 'relative' == $uri )&nbsp;</div></li><li><div>                return $screenshot;&nbsp;</div></li><li><div>            return $this-&gt;get_stylesheet_directory_uri() . '/' . $screenshot;&nbsp;</div></li><li><div>        } elseif ( 0 === $screenshot ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( array( 'png', 'gif', 'jpg', 'jpeg' ) as $ext ) {&nbsp;</div></li><li><div>            if ( file_exists( $this-&gt;get_stylesheet_directory() . &quot;/screenshot.$ext&quot; ) ) {&nbsp;</div></li><li><div>                $this-&gt;cache_add( 'screenshot', 'screenshot.' . $ext );&nbsp;</div></li><li><div>                if ( 'relative' == $uri )&nbsp;</div></li><li><div>                    return 'screenshot.' . $ext;&nbsp;</div></li><li><div>                return $this-&gt;get_stylesheet_directory_uri() . '/' . 'screenshot.' . $ext;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;cache_add( 'screenshot', 0 );&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Return files in the theme's directory.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $type Optional. Array of extensions to return. Defaults to all files (null).&nbsp;</div></li><li><div>     * @param int $depth Optional. How deep to search for files. Defaults to a flat scan (0 depth). -1 depth is infinite.&nbsp;</div></li><li><div>     * @param bool $search_parent Optional. Whether to return parent files. Defaults to false.&nbsp;</div></li><li><div>     * @return array Array of files, keyed by the path to the file relative to the theme's directory, with the values&nbsp;</div></li><li><div>     *                  being absolute paths.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_files( $type = null, $depth = 0, $search_parent = false ) {&nbsp;</div></li><li><div>        $files = (array) self::scandir( $this-&gt;get_stylesheet_directory(), $type, $depth );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $search_parent && $this-&gt;parent() )&nbsp;</div></li><li><div>            $files += (array) self::scandir( $this-&gt;get_template_directory(), $type, $depth );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $files;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the theme's post templates.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.7.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of page templates, keyed by filename and post type, &nbsp;</div></li><li><div>     *               with the value of the translated header name.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_post_templates() {&nbsp;</div></li><li><div>        // If you screw up your current theme and we invalidate your parent, most things still work. Let it slide.&nbsp;</div></li><li><div>        if ( $this-&gt;errors() && $this-&gt;errors()-&gt;get_error_codes() !== array( 'theme_parent_invalid' ) ) {&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_templates = $this-&gt;cache_get( 'post_templates' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_array( $post_templates ) ) {&nbsp;</div></li><li><div>            $post_templates = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $files = (array) $this-&gt;get_files( 'php', 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $files as $file =&gt; $full_path ) {&nbsp;</div></li><li><div>                if ( ! preg_match( '|Template Name:(.*)$|mi', file_get_contents( $full_path ), $header ) ) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $types = array( 'page' );&nbsp;</div></li><li><div>                if ( preg_match( '|Template Post Type:(.*)$|mi', file_get_contents( $full_path ), $type ) ) {&nbsp;</div></li><li><div>                    $types = explode( ', ', _cleanup_header_comment( $type[1] ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $types as $type ) {&nbsp;</div></li><li><div>                    $type = sanitize_key( $type );&nbsp;</div></li><li><div>                    if ( ! isset( $post_templates[ $type ] ) ) {&nbsp;</div></li><li><div>                        $post_templates[ $type ] = array();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $post_templates[ $type ][ $file ] = _cleanup_header_comment( $header[1] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;cache_add( 'post_templates', $post_templates );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;load_textdomain() ) {&nbsp;</div></li><li><div>            foreach ( $post_templates as &$post_type ) {&nbsp;</div></li><li><div>                foreach ( $post_type as &$post_template ) {&nbsp;</div></li><li><div>                    $post_template = $this-&gt;translate_header( 'Template Name', $post_template );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $post_templates;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the theme's post templates for a given post type.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @since 4.7.0 Added the `$post_type` parameter.&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_Post|null $post      Optional. The post being edited, provided for context.&nbsp;</div></li><li><div>     * @param string       $post_type Optional. Post type to get the templates for. Default 'page'.&nbsp;</div></li><li><div>     *                                If a post is provided, its post type is used.&nbsp;</div></li><li><div>     * @return array Array of page templates, keyed by filename, with the value of the translated header name.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_page_templates( $post = null, $post_type = 'page' ) {&nbsp;</div></li><li><div>        if ( $post ) {&nbsp;</div></li><li><div>            $post_type = get_post_type( $post );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_templates = $this-&gt;get_post_templates();&nbsp;</div></li><li><div>        $post_templates = isset( $post_templates[ $post_type ] ) ? $post_templates[ $post_type ] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;parent() ) {&nbsp;</div></li><li><div>            $post_templates += $this-&gt;parent()-&gt;get_page_templates( $post, $post_type );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters list of page templates for a theme.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * The dynamic portion of the hook name, `$post_type`, refers to the post type.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.9.0&nbsp;</div></li><li><div>         * @since 4.4.0 Converted to allow complete control over the `$page_templates` array.&nbsp;</div></li><li><div>         * @since 4.7.0 Added the `$post_type` parameter.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array        $post_templates Array of page templates. Keys are filenames, &nbsp;</div></li><li><div>         *                                     values are translated names.&nbsp;</div></li><li><div>         * @param WP_Theme     $this           The theme object.&nbsp;</div></li><li><div>         * @param WP_Post|null $post           The post being edited, provided for context, or null.&nbsp;</div></li><li><div>         * @param string       $post_type      Post type to get the templates for.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return (array) apply_filters( &quot;theme_{$post_type}_templates&quot;, $post_templates, $this, $post, $post_type );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Scans a directory for files of a certain extension.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string            $path          Absolute path to search.&nbsp;</div></li><li><div>     * @param array|string|null $extensions    Optional. Array of extensions to find, string of a single extension, &nbsp;</div></li><li><div>     *                                         or null for all extensions. Default null.&nbsp;</div></li><li><div>     * @param int               $depth         Optional. How many levels deep to search for files. Accepts 0, 1+, or&nbsp;</div></li><li><div>     *                                         -1 (infinite depth). Default 0.&nbsp;</div></li><li><div>     * @param string            $relative_path Optional. The basename of the absolute path. Used to control the&nbsp;</div></li><li><div>     *                                         returned path for the found files, particularly when this function&nbsp;</div></li><li><div>     *                                         recurses to lower depths. Default empty.&nbsp;</div></li><li><div>     * @return array|false Array of files, keyed by the path to the file relative to the `$path` directory prepended&nbsp;</div></li><li><div>     *                     with `$relative_path`, with the values being absolute paths. False otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function scandir( $path, $extensions = null, $depth = 0, $relative_path = '' ) {&nbsp;</div></li><li><div>        if ( ! is_dir( $path ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $extensions ) {&nbsp;</div></li><li><div>            $extensions = (array) $extensions;&nbsp;</div></li><li><div>            $_extensions = implode( '|', $extensions );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $relative_path = trailingslashit( $relative_path );&nbsp;</div></li><li><div>        if ( '/' == $relative_path )&nbsp;</div></li><li><div>            $relative_path = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = scandir( $path );&nbsp;</div></li><li><div>        $files = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the array of excluded directories and files while scanning theme folder.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>          * @since 4.7.4&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $exclusions Array of excluded directories and files.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $exclusions = (array) apply_filters( 'theme_scandir_exclusions', array( 'CVS', 'node_modules' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $results as $result ) {&nbsp;</div></li><li><div>            if ( '.' == $result[0] || in_array( $result, $exclusions, true ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( is_dir( $path . '/' . $result ) ) {&nbsp;</div></li><li><div>                if ( ! $depth )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                $found = self::scandir( $path . '/' . $result, $extensions, $depth - 1 , $relative_path . $result );&nbsp;</div></li><li><div>                $files = array_merge_recursive( $files, $found );&nbsp;</div></li><li><div>            } elseif ( ! $extensions || preg_match( '~\.(' . $_extensions . ')$~', $result ) ) {&nbsp;</div></li><li><div>                $files[ $relative_path . $result ] = $path . '/' . $result;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $files;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads the theme's textdomain.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Translation files are not inherited from the parent theme. Todo: if this fails for the&nbsp;</div></li><li><div>     * child theme, it should probably try to load the parent theme's translations.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool True if the textdomain was successfully loaded or has already been loaded.&nbsp;</div></li><li><div>     *     False if no textdomain was specified in the file headers, or if the domain could not be loaded.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_textdomain() {&nbsp;</div></li><li><div>        if ( isset( $this-&gt;textdomain_loaded ) )&nbsp;</div></li><li><div>            return $this-&gt;textdomain_loaded;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $textdomain = $this-&gt;get('TextDomain');&nbsp;</div></li><li><div>        if ( ! $textdomain ) {&nbsp;</div></li><li><div>            $this-&gt;textdomain_loaded = false;&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_textdomain_loaded( $textdomain ) ) {&nbsp;</div></li><li><div>            $this-&gt;textdomain_loaded = true;&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $path = $this-&gt;get_stylesheet_directory();&nbsp;</div></li><li><div>        if ( $domainpath = $this-&gt;get('DomainPath') )&nbsp;</div></li><li><div>            $path .= $domainpath;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $path .= '/languages';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;textdomain_loaded = load_theme_textdomain( $textdomain, $path );&nbsp;</div></li><li><div>        return $this-&gt;textdomain_loaded;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether the theme is allowed (multisite only).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $check Optional. Whether to check only the 'network'-wide settings, the 'site'&nbsp;</div></li><li><div>     *     settings, or 'both'. Defaults to 'both'.&nbsp;</div></li><li><div>     * @param int $blog_id Optional. Ignored if only network-wide settings are checked. Defaults to current site.&nbsp;</div></li><li><div>     * @return bool Whether the theme is allowed for the network. Returns true in single-site.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_allowed( $check = 'both', $blog_id = null ) {&nbsp;</div></li><li><div>        if ( ! is_multisite() )&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'both' == $check || 'network' == $check ) {&nbsp;</div></li><li><div>            $allowed = self::get_allowed_on_network();&nbsp;</div></li><li><div>            if ( ! empty( $allowed[ $this-&gt;get_stylesheet() ] ) )&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'both' == $check || 'site' == $check ) {&nbsp;</div></li><li><div>            $allowed = self::get_allowed_on_site( $blog_id );&nbsp;</div></li><li><div>            if ( ! empty( $allowed[ $this-&gt;get_stylesheet() ] ) )&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determines the latest WordPress default theme that is installed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This hits the filesystem.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return WP_Theme|false Object, or false if no theme is installed, which would be bad.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_core_default_theme() {&nbsp;</div></li><li><div>        foreach ( array_reverse( self::$default_themes ) as $slug =&gt; $name ) {&nbsp;</div></li><li><div>            $theme = wp_get_theme( $slug );&nbsp;</div></li><li><div>            if ( $theme-&gt;exists() ) {&nbsp;</div></li><li><div>                return $theme;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns array of stylesheet names of themes allowed on the site or network.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $blog_id Optional. ID of the site. Defaults to the current site.&nbsp;</div></li><li><div>     * @return array Array of stylesheet names.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_allowed( $blog_id = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the array of themes allowed on the network.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Site is provided as context so that a list of network allowed themes can&nbsp;</div></li><li><div>         * be filtered further.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 4.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $allowed_themes An array of theme stylesheet names.&nbsp;</div></li><li><div>         * @param int   $blog_id        ID of the site.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $network = (array) apply_filters( 'network_allowed_themes', self::get_allowed_on_network(), $blog_id );&nbsp;</div></li><li><div>        return $network + self::get_allowed_on_site( $blog_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns array of stylesheet names of themes allowed on the network.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @staticvar array $allowed_themes&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of stylesheet names.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_allowed_on_network() {&nbsp;</div></li><li><div>        static $allowed_themes;&nbsp;</div></li><li><div>        if ( ! isset( $allowed_themes ) ) {&nbsp;</div></li><li><div>            $allowed_themes = (array) get_site_option( 'allowedthemes' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the array of themes allowed on the network.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since MU&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $allowed_themes An array of theme stylesheet names.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $allowed_themes = apply_filters( 'allowed_themes', $allowed_themes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $allowed_themes;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns array of stylesheet names of themes allowed on the site.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @staticvar array $allowed_themes&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $blog_id Optional. ID of the site. Defaults to the current site.&nbsp;</div></li><li><div>     * @return array Array of stylesheet names.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_allowed_on_site( $blog_id = null ) {&nbsp;</div></li><li><div>        static $allowed_themes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $blog_id || ! is_multisite() )&nbsp;</div></li><li><div>            $blog_id = get_current_blog_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $allowed_themes[ $blog_id ] ) ) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters the array of themes allowed on the site.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 4.5.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array $allowed_themes An array of theme stylesheet names.&nbsp;</div></li><li><div>             * @param int   $blog_id        ID of the site. Defaults to current site.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            return (array) apply_filters( 'site_allowed_themes', $allowed_themes[ $blog_id ], $blog_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current = $blog_id == get_current_blog_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $current ) {&nbsp;</div></li><li><div>            $allowed_themes[ $blog_id ] = get_option( 'allowedthemes' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            switch_to_blog( $blog_id );&nbsp;</div></li><li><div>            $allowed_themes[ $blog_id ] = get_option( 'allowedthemes' );&nbsp;</div></li><li><div>            restore_current_blog();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // This is all super old MU back compat joy.&nbsp;</div></li><li><div>        // 'allowedthemes' keys things by stylesheet. 'allowed_themes' keyed things by name.&nbsp;</div></li><li><div>        if ( false === $allowed_themes[ $blog_id ] ) {&nbsp;</div></li><li><div>            if ( $current ) {&nbsp;</div></li><li><div>                $allowed_themes[ $blog_id ] = get_option( 'allowed_themes' );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                switch_to_blog( $blog_id );&nbsp;</div></li><li><div>                $allowed_themes[ $blog_id ] = get_option( 'allowed_themes' );&nbsp;</div></li><li><div>                restore_current_blog();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! is_array( $allowed_themes[ $blog_id ] ) || empty( $allowed_themes[ $blog_id ] ) ) {&nbsp;</div></li><li><div>                $allowed_themes[ $blog_id ] = array();&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $converted = array();&nbsp;</div></li><li><div>                $themes = wp_get_themes();&nbsp;</div></li><li><div>                foreach ( $themes as $stylesheet =&gt; $theme_data ) {&nbsp;</div></li><li><div>                    if ( isset( $allowed_themes[ $blog_id ][ $theme_data-&gt;get('Name') ] ) )&nbsp;</div></li><li><div>                        $converted[ $stylesheet ] = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $allowed_themes[ $blog_id ] = $converted;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Set the option so we never have to go through this pain again.&nbsp;</div></li><li><div>            if ( is_admin() && $allowed_themes[ $blog_id ] ) {&nbsp;</div></li><li><div>                if ( $current ) {&nbsp;</div></li><li><div>                    update_option( 'allowedthemes', $allowed_themes[ $blog_id ] );&nbsp;</div></li><li><div>                    delete_option( 'allowed_themes' );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    switch_to_blog( $blog_id );&nbsp;</div></li><li><div>                    update_option( 'allowedthemes', $allowed_themes[ $blog_id ] );&nbsp;</div></li><li><div>                    delete_option( 'allowed_themes' );&nbsp;</div></li><li><div>                    restore_current_blog();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This filter is documented in wp-includes/class-wp-theme.php */&nbsp;</div></li><li><div>        return (array) apply_filters( 'site_allowed_themes', $allowed_themes[ $blog_id ], $blog_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enables a theme for all sites on the current network.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.6.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $stylesheets Stylesheet name or array of stylesheet names.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function network_enable_theme( $stylesheets ) {&nbsp;</div></li><li><div>        if ( ! is_multisite() ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_array( $stylesheets ) ) {&nbsp;</div></li><li><div>            $stylesheets = array( $stylesheets );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $allowed_themes = get_site_option( 'allowedthemes' );&nbsp;</div></li><li><div>        foreach ( $stylesheets as $stylesheet ) {&nbsp;</div></li><li><div>            $allowed_themes[ $stylesheet ] = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        update_site_option( 'allowedthemes', $allowed_themes );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Disables a theme for all sites on the current network.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.6.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $stylesheets Stylesheet name or array of stylesheet names.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function network_disable_theme( $stylesheets ) {&nbsp;</div></li><li><div>        if ( ! is_multisite() ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_array( $stylesheets ) ) {&nbsp;</div></li><li><div>            $stylesheets = array( $stylesheets );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $allowed_themes = get_site_option( 'allowedthemes' );&nbsp;</div></li><li><div>        foreach ( $stylesheets as $stylesheet ) {&nbsp;</div></li><li><div>            if ( isset( $allowed_themes[ $stylesheet ] ) ) {&nbsp;</div></li><li><div>                unset( $allowed_themes[ $stylesheet ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        update_site_option( 'allowedthemes', $allowed_themes );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sorts themes by name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $themes Array of themes to sort, passed by reference.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function sort_by_name( &$themes ) {&nbsp;</div></li><li><div>        if ( 0 === strpos( get_user_locale(), 'en_' ) ) {&nbsp;</div></li><li><div>            uasort( $themes, array( 'WP_Theme', '_name_sort' ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            uasort( $themes, array( 'WP_Theme', '_name_sort_i18n' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback function for usort() to naturally sort themes by name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Accesses the Name header directly from the class for maximum speed.&nbsp;</div></li><li><div>     * Would choke on HTML but we don't care enough to slow it down with strip_tags().&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $a First name.&nbsp;</div></li><li><div>     * @param string $b Second name.&nbsp;</div></li><li><div>     * @return int Negative if `$a` falls lower in the natural order than `$b`. Zero if they fall equally.&nbsp;</div></li><li><div>     *             Greater than 0 if `$a` falls higher in the natural order than `$b`. Used with usort().&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function _name_sort( $a, $b ) {&nbsp;</div></li><li><div>        return strnatcasecmp( $a-&gt;headers['Name'], $b-&gt;headers['Name'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Name sort (with translation).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $a First name.&nbsp;</div></li><li><div>     * @param string $b Second name.&nbsp;</div></li><li><div>     * @return int Negative if `$a` falls lower in the natural order than `$b`. Zero if they fall equally.&nbsp;</div></li><li><div>     *             Greater than 0 if `$a` falls higher in the natural order than `$b`. Used with usort().&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function _name_sort_i18n( $a, $b ) {&nbsp;</div></li><li><div>        // Don't mark up; Do translate.&nbsp;</div></li><li><div>        return strnatcasecmp( $a-&gt;display( 'Name', false, true ), $b-&gt;display( 'Name', false, true ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.4.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/wp_theme/" class="active">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/wp_theme/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/wp_theme/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/wp_theme/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/wp_theme/" class="">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>WP_Theme</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>