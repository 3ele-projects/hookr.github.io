<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7" data-type="file" data-id="4492"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-admin-includes-file | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=a361caabdc20b69f26e5c7beb716d904' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-admin-includes-file/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-admin-includes-file%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-admin-includes-file%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-file-wp-admin-includes-file","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-admin-includes-file" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-admin-includes-file</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-admin/includes/file.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filesystem API: Top-level functionality</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Functions for reading, writing, modifying, and deleting files on the file system.</span>&nbsp;</div></li><li><div><span class="comment"> * Includes functionality for theme-specific files as well as operations for uploading, </span>&nbsp;</div></li><li><div><span class="comment"> * archiving, and rendering output when necessary.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Filesystem</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** The descriptions for theme files. */</span>&nbsp;</div></li><li><div>$wp_file_descriptions = array(&nbsp;</div></li><li><div>  'functions.php' =&gt; __( 'Theme Functions' ), &nbsp;</div></li><li><div>  'header.php' =&gt; __( 'Theme Header' ), &nbsp;</div></li><li><div>  'footer.php' =&gt; __( 'Theme Footer' ), &nbsp;</div></li><li><div>  'sidebar.php' =&gt; __( 'Sidebar' ), &nbsp;</div></li><li><div>  'comments.php' =&gt; __( 'Comments' ), &nbsp;</div></li><li><div>  'searchform.php' =&gt; __( 'Search Form' ), &nbsp;</div></li><li><div>  '404.php' =&gt; __( '404 Template' ), &nbsp;</div></li><li><div>  'link.php' =&gt; __( 'Links Template' ), &nbsp;</div></li><li><div>  <span class="comment">// Archives</span>&nbsp;</div></li><li><div>  'index.php' =&gt; __( 'Main Index Template' ), &nbsp;</div></li><li><div>  'archive.php' =&gt; __( 'Archives' ), &nbsp;</div></li><li><div>  'author.php' =&gt; __( 'Author Template' ), &nbsp;</div></li><li><div>  'taxonomy.php' =&gt; __( 'Taxonomy Template' ), &nbsp;</div></li><li><div>  'category.php' =&gt; __( 'Category Template' ), &nbsp;</div></li><li><div>  'tag.php' =&gt; __( 'Tag Template' ), &nbsp;</div></li><li><div>  'home.php' =&gt; __( 'Posts Page' ), &nbsp;</div></li><li><div>  'search.php' =&gt; __( 'Search Results' ), &nbsp;</div></li><li><div>  'date.php' =&gt; __( 'Date Template' ), &nbsp;</div></li><li><div>  <span class="comment">// Content</span>&nbsp;</div></li><li><div>  'singular.php' =&gt; __( 'Singular Template' ), &nbsp;</div></li><li><div>  'single.php' =&gt; __( 'Single Post' ), &nbsp;</div></li><li><div>  'page.php' =&gt; __( 'Single Page' ), &nbsp;</div></li><li><div>  'front-page.php' =&gt; __( 'Static Front Page' ), &nbsp;</div></li><li><div>  <span class="comment">// Attachments</span>&nbsp;</div></li><li><div>  'attachment.php' =&gt; __( 'Attachment Template' ), &nbsp;</div></li><li><div>  'image.php' =&gt; __( 'Image Attachment Template' ), &nbsp;</div></li><li><div>  'video.php' =&gt; __( 'Video Attachment Template' ), &nbsp;</div></li><li><div>  'audio.php' =&gt; __( 'Audio Attachment Template' ), &nbsp;</div></li><li><div>  'application.php' =&gt; __( 'Application Attachment Template' ), &nbsp;</div></li><li><div>  <span class="comment">// Embeds</span>&nbsp;</div></li><li><div>  'embed.php' =&gt; __( 'Embed Template' ), &nbsp;</div></li><li><div>  'embed-404.php' =&gt; __( 'Embed 404 Template' ), &nbsp;</div></li><li><div>  'embed-content.php' =&gt; __( 'Embed Content Template' ), &nbsp;</div></li><li><div>  'header-embed.php' =&gt; __( 'Embed Header Template' ), &nbsp;</div></li><li><div>  'footer-embed.php' =&gt; __( 'Embed Footer Template' ), &nbsp;</div></li><li><div>  <span class="comment">// Stylesheets</span>&nbsp;</div></li><li><div>  'style.css' =&gt; __( 'Stylesheet' ), &nbsp;</div></li><li><div>  'editor-style.css' =&gt; __( 'Visual Editor Stylesheet' ), &nbsp;</div></li><li><div>  'editor-style-rtl.css' =&gt; __( 'Visual Editor RTL Stylesheet' ), &nbsp;</div></li><li><div>  'rtl.css' =&gt; __( 'RTL Stylesheet' ), &nbsp;</div></li><li><div>  <span class="comment">// Other</span>&nbsp;</div></li><li><div>  'my-hacks.php' =&gt; __( 'my-hacks.php (legacy hacks support)' ), &nbsp;</div></li><li><div>  '.htaccess' =&gt; __( '.htaccess (for rewrite rules )' ), &nbsp;</div></li><li><div>  <span class="comment">// Deprecated files</span>&nbsp;</div></li><li><div>  'wp-layout.css' =&gt; __( 'Stylesheet' ), &nbsp;</div></li><li><div>  'wp-comments.php' =&gt; __( 'Comments Template' ), &nbsp;</div></li><li><div>  'wp-comments-popup.php' =&gt; __( 'Popup Comments Template' ), &nbsp;</div></li><li><div>  'comments-popup.php' =&gt; __( 'Popup Comments' ), &nbsp;</div></li><li><div>);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the description for standard WordPress theme files and other various standard</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress files</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_file_descriptions</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file Filesystem path or filename</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Description of file from $wp_file_descriptions or basename of $file if description doesn't exist.</span>&nbsp;</div></li><li><div><span class="comment"> *                Appends 'Page Template' to basename of $file if the file is a page template</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_file_description( $file ) {&nbsp;</div></li><li><div>  global $wp_file_descriptions, $allowed_files;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $dirname = pathinfo( $file, PATHINFO_DIRNAME );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $file_path = $allowed_files[ $file ];&nbsp;</div></li><li><div>  if ( isset( $wp_file_descriptions[ basename( $file ) ] ) && '.' === $dirname ) {&nbsp;</div></li><li><div>      return $wp_file_descriptions[ basename( $file ) ];&nbsp;</div></li><li><div>  } elseif ( file_exists( $file_path ) && is_file( $file_path ) ) {&nbsp;</div></li><li><div>      $template_data = implode( '', file( $file_path ) );&nbsp;</div></li><li><div>      if ( preg_match( '|Template Name:(.*)$|mi', $template_data, $name ) ) {&nbsp;</div></li><li><div>          return sprintf( __( '%s Page Template' ), _cleanup_header_comment( $name[1] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return trim( basename( $file ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the absolute filesystem path to the root of the WordPress installation</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Full filesystem path to the root of the WordPress installation</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_home_path() {&nbsp;</div></li><li><div>  $home = set_url_scheme( get_option( 'home' ), 'http' );&nbsp;</div></li><li><div>  $siteurl = set_url_scheme( get_option( 'siteurl' ), 'http' );&nbsp;</div></li><li><div>  if ( ! empty( $home ) && 0 !== strcasecmp( $home, $siteurl ) ) {&nbsp;</div></li><li><div>      $wp_path_rel_to_home = str_ireplace( $home, '', $siteurl ); <span class="comment">/** $siteurl - $home */</span>&nbsp;</div></li><li><div>      $pos = strripos( str_replace( '\\', '/', $_SERVER['SCRIPT_FILENAME'] ), trailingslashit( $wp_path_rel_to_home ) );&nbsp;</div></li><li><div>      $home_path = substr( $_SERVER['SCRIPT_FILENAME'], 0, $pos );&nbsp;</div></li><li><div>      $home_path = trailingslashit( $home_path );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $home_path = ABSPATH;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return str_replace( '\\', '/', $home_path );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns a listing of all files in the specified folder and all subdirectories up to 100 levels deep.</span>&nbsp;</div></li><li><div><span class="comment"> * The depth of the recursiveness can be controlled by the $levels param.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $folder Optional. Full path to folder. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $levels Optional. Levels of folders to follow, Default 100 (PHP Loop limit).</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|array False on failure, Else array of files</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function list_files( $folder = '', $levels = 100 ) {&nbsp;</div></li><li><div>  if ( empty($folder) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $levels )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $files = array();&nbsp;</div></li><li><div>  if ( $dir = @opendir( $folder ) ) {&nbsp;</div></li><li><div>      while (($file = readdir( $dir ) ) !== false ) {&nbsp;</div></li><li><div>          if ( in_array($file, array('.', '..') ) )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          if ( is_dir( $folder . '/' . $file ) ) {&nbsp;</div></li><li><div>              $files2 = list_files( $folder . '/' . $file, $levels - 1);&nbsp;</div></li><li><div>              if ( $files2 )&nbsp;</div></li><li><div>                  $files = array_merge($files, $files2 );&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $files[] = $folder . '/' . $file . '/';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $files[] = $folder . '/' . $file;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  @closedir( $dir );&nbsp;</div></li><li><div>  return $files;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns a filename of a Temporary unique file.</span>&nbsp;</div></li><li><div><span class="comment"> * Please note that the calling function must unlink() this itself.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The filename is based off the passed parameter or defaults to the current unix timestamp, </span>&nbsp;</div></li><li><div><span class="comment"> * while the directory can either be passed as well, or by leaving it blank, default to a writable temporary directory.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename Optional. Filename to base the Unique file off. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $dir      Optional. Directory to store the file in. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string a writable filename</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_tempnam( $filename = '', $dir = '' ) {&nbsp;</div></li><li><div>  if ( empty( $dir ) ) {&nbsp;</div></li><li><div>      $dir = get_temp_dir();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $filename ) || '.' == $filename || '/' == $filename || '\\' == $filename ) {&nbsp;</div></li><li><div>      $filename = time();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Use the basename of the given file without the extension as the name for the temporary directory</span>&nbsp;</div></li><li><div>  $temp_filename = basename( $filename );&nbsp;</div></li><li><div>  $temp_filename = preg_replace( '|\.[^.]*$|', '', $temp_filename );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the folder is falsey, use its parent directory name instead.</span>&nbsp;</div></li><li><div>  if ( ! $temp_filename ) {&nbsp;</div></li><li><div>      return wp_tempnam( dirname( $filename ), $dir );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Suffix some random data to avoid filename conflicts</span>&nbsp;</div></li><li><div>  $temp_filename .= '-' . wp_generate_password( 6, false );&nbsp;</div></li><li><div>  $temp_filename .= '.tmp';&nbsp;</div></li><li><div>  $temp_filename = $dir . wp_unique_filename( $dir, $temp_filename );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fp = @fopen( $temp_filename, 'x' );&nbsp;</div></li><li><div>  if ( ! $fp && is_writable( $dir ) && file_exists( $temp_filename ) ) {&nbsp;</div></li><li><div>      return wp_tempnam( $filename, $dir );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $fp ) {&nbsp;</div></li><li><div>      fclose( $fp );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $temp_filename;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Make sure that the file that was requested to edit, is allowed to be edited</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Function will die if you are not allowed to edit the file</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file file the users is attempting to edit</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $allowed_files Array of allowed files to edit, $file must match an entry exactly</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|null</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function validate_file_to_edit( $file, $allowed_files = '' ) {&nbsp;</div></li><li><div>  $code = validate_file( $file, $allowed_files );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!$code )&nbsp;</div></li><li><div>      return $file;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $code ) {&nbsp;</div></li><li><div>      case 1 :&nbsp;</div></li><li><div>          wp_die( __( 'Sorry, that file cannot be edited.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// case 2 :</span>&nbsp;</div></li><li><div>      <span class="comment">// wp_die( __('Sorry, can&#8217;t call files with their real path.' ));</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 3 :&nbsp;</div></li><li><div>          wp_die( __( 'Sorry, that file cannot be edited.' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle PHP uploads in WordPress, sanitizing file names, checking extensions for mime type, </span>&nbsp;</div></li><li><div><span class="comment"> * and moving the file to the appropriate directory within the uploads directory.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_handle_upload_error</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array       $file      Reference to a single element of $_FILES. Call the function once for each uploaded file.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|false $overrides An associative array of names =&gt; values to override default variables. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $time      Time formatted in 'yyyy/mm'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $action    Expected value for $_POST['action'].</span>&nbsp;</div></li><li><div><span class="comment"> * @return array On success, returns an associative array of file attributes. On failure, returns</span>&nbsp;</div></li><li><div><span class="comment"> *               $overrides['upload_error_handler'](&$file, $message ) or array( 'error'=&gt;$message ).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_handle_upload( &$file, $overrides, $time, $action ) {&nbsp;</div></li><li><div>  <span class="comment">// The default error handler.</span>&nbsp;</div></li><li><div>  if ( ! function_exists( 'wp_handle_upload_error' ) ) {&nbsp;</div></li><li><div>      function wp_handle_upload_error( &$file, $message ) {&nbsp;</div></li><li><div>          return array( 'error' =&gt; $message );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the data for a file before it is uploaded to WordPress.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$action`, refers to the post action.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0 as 'wp_handle_upload_prefilter'.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.0.0 Converted to a dynamic hook with `$action`.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $file An array of data for a single file.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $file = apply_filters( &quot;{$action}_prefilter&quot;, $file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// You may define your own function and pass the name in $overrides['upload_error_handler']</span>&nbsp;</div></li><li><div>  $upload_error_handler = 'wp_handle_upload_error';&nbsp;</div></li><li><div>  if ( isset( $overrides['upload_error_handler'] ) ) {&nbsp;</div></li><li><div>      $upload_error_handler = $overrides['upload_error_handler'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// You may have had one or more 'wp_handle_upload_prefilter' functions error out the file. Handle that gracefully.</span>&nbsp;</div></li><li><div>  if ( isset( $file['error'] ) && ! is_numeric( $file['error'] ) && $file['error'] ) {&nbsp;</div></li><li><div>      return call_user_func_array( $upload_error_handler, array( &$file, $file['error'] ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Install user overrides. Did we mention that this voids your warranty?</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// You may define your own function and pass the name in $overrides['unique_filename_callback']</span>&nbsp;</div></li><li><div>  $unique_filename_callback = null;&nbsp;</div></li><li><div>  if ( isset( $overrides['unique_filename_callback'] ) ) {&nbsp;</div></li><li><div>      $unique_filename_callback = $overrides['unique_filename_callback'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This may not have orignially been intended to be overrideable, </span>&nbsp;</div></li><li><div><span class="comment">   * but historically has been.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( isset( $overrides['upload_error_strings'] ) ) {&nbsp;</div></li><li><div>      $upload_error_strings = $overrides['upload_error_strings'];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Courtesy of php.net, the strings that describe the error indicated in $_FILES[{form field}]['error'].</span>&nbsp;</div></li><li><div>      $upload_error_strings = array(&nbsp;</div></li><li><div>          false, &nbsp;</div></li><li><div>          __( 'The uploaded file exceeds the upload_max_filesize directive in php.ini.' ), &nbsp;</div></li><li><div>          __( 'The uploaded file exceeds the MAX_FILE_SIZE directive that was specified in the HTML form.' ), &nbsp;</div></li><li><div>          __( 'The uploaded file was only partially uploaded.' ), &nbsp;</div></li><li><div>          __( 'No file was uploaded.' ), &nbsp;</div></li><li><div>          '', &nbsp;</div></li><li><div>          __( 'Missing a temporary folder.' ), &nbsp;</div></li><li><div>          __( 'Failed to write file to disk.' ), &nbsp;</div></li><li><div>          __( 'File upload stopped by extension.' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// All tests are on by default. Most can be turned off by $overrides[{test_name}] = false;</span>&nbsp;</div></li><li><div>  $test_form = isset( $overrides['test_form'] ) ? $overrides['test_form'] : true;&nbsp;</div></li><li><div>  $test_size = isset( $overrides['test_size'] ) ? $overrides['test_size'] : true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If you override this, you must provide $ext and $type!!</span>&nbsp;</div></li><li><div>  $test_type = isset( $overrides['test_type'] ) ? $overrides['test_type'] : true;&nbsp;</div></li><li><div>  $mimes = isset( $overrides['mimes'] ) ? $overrides['mimes'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// A correct form post will pass this test.</span>&nbsp;</div></li><li><div>  if ( $test_form && ( ! isset( $_POST['action'] ) || ( $_POST['action'] != $action ) ) ) {&nbsp;</div></li><li><div>      return call_user_func_array( $upload_error_handler, array( &$file, __( 'Invalid form submission.' ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">// A successful upload will pass this test. It makes no sense to override this one.</span>&nbsp;</div></li><li><div>  if ( isset( $file['error'] ) && $file['error'] &gt; 0 ) {&nbsp;</div></li><li><div>      return call_user_func_array( $upload_error_handler, array( &$file, $upload_error_strings[ $file['error'] ] ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $test_file_size = 'wp_handle_upload' === $action ? $file['size'] : filesize( $file['tmp_name'] );&nbsp;</div></li><li><div>  <span class="comment">// A non-empty file will pass this test.</span>&nbsp;</div></li><li><div>  if ( $test_size && ! ( $test_file_size &gt; 0 ) ) {&nbsp;</div></li><li><div>      if ( is_multisite() ) {&nbsp;</div></li><li><div>          $error_msg = __( 'File is empty. Please upload something more substantial.' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $error_msg = __( 'File is empty. Please upload something more substantial. This error could also be caused by uploads being disabled in your php.ini or by post_max_size being defined as smaller than upload_max_filesize in php.ini.' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return call_user_func_array( $upload_error_handler, array( &$file, $error_msg ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// A properly uploaded file will pass this test. There should be no reason to override this one.</span>&nbsp;</div></li><li><div>  $test_uploaded_file = 'wp_handle_upload' === $action ? @ is_uploaded_file( $file['tmp_name'] ) : @ is_file( $file['tmp_name'] );&nbsp;</div></li><li><div>  if ( ! $test_uploaded_file ) {&nbsp;</div></li><li><div>      return call_user_func_array( $upload_error_handler, array( &$file, __( 'Specified file failed upload test.' ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// A correct MIME type will pass this test. Override $mimes or use the upload_mimes filter.</span>&nbsp;</div></li><li><div>  if ( $test_type ) {&nbsp;</div></li><li><div>      $wp_filetype = wp_check_filetype_and_ext( $file['tmp_name'], $file['name'], $mimes );&nbsp;</div></li><li><div>      $ext = empty( $wp_filetype['ext'] ) ? '' : $wp_filetype['ext'];&nbsp;</div></li><li><div>      $type = empty( $wp_filetype['type'] ) ? '' : $wp_filetype['type'];&nbsp;</div></li><li><div>      $proper_filename = empty( $wp_filetype['proper_filename'] ) ? '' : $wp_filetype['proper_filename'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check to see if wp_check_filetype_and_ext() determined the filename was incorrect</span>&nbsp;</div></li><li><div>      if ( $proper_filename ) {&nbsp;</div></li><li><div>          $file['name'] = $proper_filename;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ( ! $type || !$ext ) && ! current_user_can( 'unfiltered_upload' ) ) {&nbsp;</div></li><li><div>          return call_user_func_array( $upload_error_handler, array( &$file, __( 'Sorry, this file type is not permitted for security reasons.' ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! $type ) {&nbsp;</div></li><li><div>          $type = $file['type'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $type = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A writable uploads dir will pass this test. Again, there's no point</span>&nbsp;</div></li><li><div><span class="comment">   * overriding this one.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( ! ( ( $uploads = wp_upload_dir( $time ) ) && false === $uploads['error'] ) ) {&nbsp;</div></li><li><div>      return call_user_func_array( $upload_error_handler, array( &$file, $uploads['error'] ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $filename = wp_unique_filename( $uploads['path'], $file['name'], $unique_filename_callback );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Move the file to the uploads dir.</span>&nbsp;</div></li><li><div>  $new_file = $uploads['path'] . &quot;/$filename&quot;;&nbsp;</div></li><li><div>  if ( 'wp_handle_upload' === $action ) {&nbsp;</div></li><li><div>      $move_new_file = @ move_uploaded_file( $file['tmp_name'], $new_file );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// use copy and unlink because rename breaks streams.</span>&nbsp;</div></li><li><div>      $move_new_file = @ copy( $file['tmp_name'], $new_file );&nbsp;</div></li><li><div>      unlink( $file['tmp_name'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $move_new_file ) {&nbsp;</div></li><li><div>      if ( 0 === strpos( $uploads['basedir'], ABSPATH ) ) {&nbsp;</div></li><li><div>          $error_path = str_replace( ABSPATH, '', $uploads['basedir'] ) . $uploads['subdir'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $error_path = basename( $uploads['basedir'] ) . $uploads['subdir'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $upload_error_handler( $file, sprintf( __('The uploaded file could not be moved to %s.' ), $error_path ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set correct file permissions.</span>&nbsp;</div></li><li><div>  $stat = stat( dirname( $new_file ));&nbsp;</div></li><li><div>  $perms = $stat['mode'] & 0000666;&nbsp;</div></li><li><div>  @ chmod( $new_file, $perms );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Compute the URL.</span>&nbsp;</div></li><li><div>  $url = $uploads['url'] . &quot;/$filename&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_multisite() ) {&nbsp;</div></li><li><div>      delete_transient( 'dirsize_cache' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the data array for the uploaded file.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $upload {</span>&nbsp;</div></li><li><div><span class="comment">   *     Array of upload data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $file Filename of the newly-uploaded file.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $url  URL of the uploaded file.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $type File type.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $context The type of upload action. Values include 'upload' or 'sideload'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_handle_upload', array(&nbsp;</div></li><li><div>      'file' =&gt; $new_file, &nbsp;</div></li><li><div>      'url' =&gt; $url, &nbsp;</div></li><li><div>      'type' =&gt; $type&nbsp;</div></li><li><div> ), 'wp_handle_sideload' === $action ? 'sideload' : 'upload' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Wrapper for _wp_handle_upload().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Passes the {@see 'wp_handle_upload'} action.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see _wp_handle_upload()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array      $file      Reference to a single element of `$_FILES`. Call the function once for</span>&nbsp;</div></li><li><div><span class="comment"> *                              each uploaded file.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|bool $overrides Optional. An associative array of names=&gt;values to override default</span>&nbsp;</div></li><li><div><span class="comment"> *                              variables. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $time      Optional. Time formatted in 'yyyy/mm'. Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array On success, returns an associative array of file attributes. On failure, returns</span>&nbsp;</div></li><li><div><span class="comment"> *               $overrides['upload_error_handler'](&$file, $message ) or array( 'error'=&gt;$message ).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_handle_upload( &$file, $overrides = false, $time = null ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *  $_POST['action'] must be set and its value must equal $overrides['action']</span>&nbsp;</div></li><li><div><span class="comment">   *  or this:</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $action = 'wp_handle_upload';&nbsp;</div></li><li><div>  if ( isset( $overrides['action'] ) ) {&nbsp;</div></li><li><div>      $action = $overrides['action'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return _wp_handle_upload( $file, $overrides, $time, $action );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Wrapper for _wp_handle_upload().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Passes the {@see 'wp_handle_sideload'} action.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see _wp_handle_upload()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array      $file      An array similar to that of a PHP `$_FILES` POST array</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|bool $overrides Optional. An associative array of names=&gt;values to override default</span>&nbsp;</div></li><li><div><span class="comment"> *                              variables. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $time      Optional. Time formatted in 'yyyy/mm'. Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array On success, returns an associative array of file attributes. On failure, returns</span>&nbsp;</div></li><li><div><span class="comment"> *               $overrides['upload_error_handler'](&$file, $message ) or array( 'error'=&gt;$message ).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_handle_sideload( &$file, $overrides = false, $time = null ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *  $_POST['action'] must be set and its value must equal $overrides['action']</span>&nbsp;</div></li><li><div><span class="comment">   *  or this:</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $action = 'wp_handle_sideload';&nbsp;</div></li><li><div>  if ( isset( $overrides['action'] ) ) {&nbsp;</div></li><li><div>      $action = $overrides['action'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return _wp_handle_upload( $file, $overrides, $time, $action );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Downloads a URL to a local temporary file using the WordPress HTTP Class.</span>&nbsp;</div></li><li><div><span class="comment"> * Please note, That the calling function must unlink() the file.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $url the URL of the file to download</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $timeout The timeout for the request to download the file default 300 seconds</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed WP_Error on failure, string Filename on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function download_url( $url, $timeout = 300 ) {&nbsp;</div></li><li><div>  <span class="comment">//WARNING: The file is not automatically deleted, The script must unlink() the file.</span>&nbsp;</div></li><li><div>  if ( ! $url )&nbsp;</div></li><li><div>      return new WP_Error('http_no_url', __('Invalid URL Provided.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url_filename = basename( parse_url( $url, PHP_URL_PATH ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tmpfname = wp_tempnam( $url_filename );&nbsp;</div></li><li><div>  if ( ! $tmpfname )&nbsp;</div></li><li><div>      return new WP_Error('http_no_file', __('Could not create Temporary file.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $response = wp_safe_remote_get( $url, array( 'timeout' =&gt; $timeout, 'stream' =&gt; true, 'filename' =&gt; $tmpfname ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_wp_error( $response ) ) {&nbsp;</div></li><li><div>      unlink( $tmpfname );&nbsp;</div></li><li><div>      return $response;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 200 != wp_remote_retrieve_response_code( $response ) ) {&nbsp;</div></li><li><div>      unlink( $tmpfname );&nbsp;</div></li><li><div>      return new WP_Error( 'http_404', trim( wp_remote_retrieve_response_message( $response ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content_md5 = wp_remote_retrieve_header( $response, 'content-md5' );&nbsp;</div></li><li><div>  if ( $content_md5 ) {&nbsp;</div></li><li><div>      $md5_check = verify_file_md5( $tmpfname, $content_md5 );&nbsp;</div></li><li><div>      if ( is_wp_error( $md5_check ) ) {&nbsp;</div></li><li><div>          unlink( $tmpfname );&nbsp;</div></li><li><div>          return $md5_check;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $tmpfname;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Calculates and compares the MD5 of a file to its expected value.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename The filename to check the MD5 of.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $expected_md5 The expected MD5 of the file, either a base64 encoded raw md5, or a hex-encoded md5</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|object WP_Error on failure, true on success, false when the MD5 format is unknown/unexpected</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function verify_file_md5( $filename, $expected_md5 ) {&nbsp;</div></li><li><div>  if ( 32 == strlen( $expected_md5 ) )&nbsp;</div></li><li><div>      $expected_raw_md5 = pack( 'H*', $expected_md5 );&nbsp;</div></li><li><div>  elseif ( 24 == strlen( $expected_md5 ) )&nbsp;</div></li><li><div>      $expected_raw_md5 = base64_decode( $expected_md5 );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      return false; <span class="comment">// unknown format</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $file_md5 = md5_file( $filename, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $file_md5 === $expected_raw_md5 )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return new WP_Error( 'md5_mismatch', sprintf( __( 'The checksum of the file (%1$s) does not match the expected checksum value (%2$s).' ), bin2hex( $file_md5 ), bin2hex( $expected_raw_md5 ) ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Unzips a specified ZIP file to a location on the Filesystem via the WordPress Filesystem Abstraction.</span>&nbsp;</div></li><li><div><span class="comment"> * Assumes that WP_Filesystem() has already been called and set up. Does not extract a root-level __MACOSX directory, if present.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Attempts to increase the PHP Memory limit to 256M before uncompressing, </span>&nbsp;</div></li><li><div><span class="comment"> * However, The most memory required shouldn't be much larger than the Archive itself.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Filesystem_Base $wp_filesystem Subclass</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file Full path and filename of zip archive</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $to Full path on the filesystem to extract archive to</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed WP_Error on failure, True on success</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function unzip_file($file, $to) {&nbsp;</div></li><li><div>  global $wp_filesystem;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $wp_filesystem || !is_object($wp_filesystem) )&nbsp;</div></li><li><div>      return new WP_Error('fs_unavailable', __('Could not access filesystem.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Unzip can use a lot of memory, but not this much hopefully.</span>&nbsp;</div></li><li><div>  wp_raise_memory_limit( 'admin' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $needed_dirs = array();&nbsp;</div></li><li><div>  $to = trailingslashit($to);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Determine any parent dir's needed (of the upgrade directory)</span>&nbsp;</div></li><li><div>  if ( ! $wp_filesystem-&gt;is_dir($to) ) { <span class="comment">//Only do parents if no children exist</span>&nbsp;</div></li><li><div>      $path = preg_split('![/\\\]!', untrailingslashit($to));&nbsp;</div></li><li><div>      for ( $i = count($path); $i &gt;= 0; $i-- ) {&nbsp;</div></li><li><div>          if ( empty($path[$i]) )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $dir = implode('/', array_slice($path, 0, $i+1) );&nbsp;</div></li><li><div>          if ( preg_match('!^[a-z]:$!i', $dir) ) <span class="comment">// Skip it if it looks like a Windows Drive letter.</span>&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $wp_filesystem-&gt;is_dir($dir) )&nbsp;</div></li><li><div>              $needed_dirs[] = $dir;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              break; <span class="comment">// A folder exists, therefor, we dont need the check the levels below this</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to use ZipArchive to unzip archives.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $ziparchive Whether to use ZipArchive. Default true.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( class_exists( 'ZipArchive', false ) && apply_filters( 'unzip_file_use_ziparchive', true ) ) {&nbsp;</div></li><li><div>      $result = _unzip_file_ziparchive($file, $to, $needed_dirs);&nbsp;</div></li><li><div>      if ( true === $result ) {&nbsp;</div></li><li><div>          return $result;&nbsp;</div></li><li><div>      } elseif ( is_wp_error($result) ) {&nbsp;</div></li><li><div>          if ( 'incompatible_archive' != $result-&gt;get_error_code() )&nbsp;</div></li><li><div>              return $result;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">// Fall through to PclZip if ZipArchive is not available, or encountered an error opening the file.</span>&nbsp;</div></li><li><div>  return _unzip_file_pclzip($file, $to, $needed_dirs);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This function should not be called directly, use unzip_file instead. Attempts to unzip an archive using the ZipArchive class.</span>&nbsp;</div></li><li><div><span class="comment"> * Assumes that WP_Filesystem() has already been called and set up.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see unzip_file</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Filesystem_Base $wp_filesystem Subclass</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file Full path and filename of zip archive</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $to Full path on the filesystem to extract archive to</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $needed_dirs A partial list of required folders needed to be created.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed WP_Error on failure, True on success</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _unzip_file_ziparchive($file, $to, $needed_dirs = array() ) {&nbsp;</div></li><li><div>  global $wp_filesystem;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $z = new ZipArchive();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $zopen = $z-&gt;open( $file, ZIPARCHIVE::CHECKCONS );&nbsp;</div></li><li><div>  if ( true !== $zopen )&nbsp;</div></li><li><div>      return new WP_Error( 'incompatible_archive', __( 'Incompatible Archive.' ), array( 'ziparchive_error' =&gt; $zopen ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uncompressed_size = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  for ( $i = 0; $i &lt; $z-&gt;numFiles; $i++ ) {&nbsp;</div></li><li><div>      if ( ! $info = $z-&gt;statIndex($i) )&nbsp;</div></li><li><div>          return new WP_Error( 'stat_failed_ziparchive', __( 'Could not retrieve file from archive.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '__MACOSX/' === substr($info['name'], 0, 9) ) <span class="comment"><span class="comment">// Skip the OS X-created __MACOSX directory</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $uncompressed_size += $info['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '/' === substr( $info['name'], -1 ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Directory.</span>&nbsp;</div></li><li><div>          $needed_dirs[] = $to . untrailingslashit( $info['name'] );&nbsp;</div></li><li><div>      } elseif ( '.' !== $dirname = dirname( $info['name'] ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Path to a file.</span>&nbsp;</div></li><li><div>          $needed_dirs[] = $to . untrailingslashit( $dirname );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * disk_free_space() could return false. Assume that any falsey value is an error.</span>&nbsp;</div></li><li><div><span class="comment">   * A disk that has zero free bytes has bigger problems.</span>&nbsp;</div></li><li><div><span class="comment">   * Require we have enough space to unzip the file and copy its contents, with a 10% buffer.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( defined( 'DOING_CRON' ) && DOING_CRON ) {&nbsp;</div></li><li><div>      $available_space = @disk_free_space( WP_CONTENT_DIR );&nbsp;</div></li><li><div>      if ( $available_space && ( $uncompressed_size * 2.1 ) &gt; $available_space )&nbsp;</div></li><li><div>          return new WP_Error( 'disk_full_unzip_file', __( 'Could not copy files. You may have run out of disk space.' ), compact( 'uncompressed_size', 'available_space' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $needed_dirs = array_unique($needed_dirs);&nbsp;</div></li><li><div>  foreach ( $needed_dirs as $dir ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Check the parent folders of the folders all exist within the creation array.</span></span>&nbsp;</div></li><li><div>      if ( untrailingslashit($to) == $dir ) <span class="comment"><span class="comment">// Skip over the working directory, We know this exists (or will exist)</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      if ( strpos($dir, $to) === false ) <span class="comment"><span class="comment">// If the directory is not within the working directory, Skip it</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $parent_folder = dirname($dir);&nbsp;</div></li><li><div>      while ( !empty($parent_folder) && untrailingslashit($to) != $parent_folder && !in_array($parent_folder, $needed_dirs) ) {&nbsp;</div></li><li><div>          $needed_dirs[] = $parent_folder;&nbsp;</div></li><li><div>          $parent_folder = dirname($parent_folder);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  asort($needed_dirs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Create those directories if need be:</span></span>&nbsp;</div></li><li><div>  foreach ( $needed_dirs as $_dir ) {&nbsp;</div></li><li><div>      <span class="comment">// Only check to see if the Dir exists upon creation failure. Less I/O this way.</span>&nbsp;</div></li><li><div>      if ( ! $wp_filesystem-&gt;mkdir( $_dir, FS_CHMOD_DIR ) && ! $wp_filesystem-&gt;is_dir( $_dir ) ) {&nbsp;</div></li><li><div>          return new WP_Error( 'mkdir_failed_ziparchive', __( 'Could not create directory.' ), substr( $_dir, strlen( $to ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  unset($needed_dirs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  for ( $i = 0; $i &lt; $z-&gt;numFiles; $i++ ) {&nbsp;</div></li><li><div>      if ( ! $info = $z-&gt;statIndex($i) )&nbsp;</div></li><li><div>          return new WP_Error( 'stat_failed_ziparchive', __( 'Could not retrieve file from archive.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '/' == substr($info['name'], -1) ) <span class="comment">// directory</span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '__MACOSX/' === substr($info['name'], 0, 9) ) <span class="comment"><span class="comment">// Don't extract the OS X-created __MACOSX directory files</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $contents = $z-&gt;getFromIndex($i);&nbsp;</div></li><li><div>      if ( false === $contents )&nbsp;</div></li><li><div>          return new WP_Error( 'extract_failed_ziparchive', __( 'Could not extract file from archive.' ), $info['name'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $wp_filesystem-&gt;put_contents( $to . $info['name'], $contents, FS_CHMOD_FILE) )&nbsp;</div></li><li><div>          return new WP_Error( 'copy_failed_ziparchive', __( 'Could not copy file.' ), $info['name'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $z-&gt;close();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This function should not be called directly, use unzip_file instead. Attempts to unzip an archive using the PclZip library.</span>&nbsp;</div></li><li><div><span class="comment"> * Assumes that WP_Filesystem() has already been called and set up.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see unzip_file</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Filesystem_Base $wp_filesystem Subclass</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file Full path and filename of zip archive</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $to Full path on the filesystem to extract archive to</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $needed_dirs A partial list of required folders needed to be created.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed WP_Error on failure, True on success</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _unzip_file_pclzip($file, $to, $needed_dirs = array()) {&nbsp;</div></li><li><div>  global $wp_filesystem;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  mbstring_binary_safe_encoding();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  require_once(ABSPATH . 'wp-admin/includes/class-pclzip.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $archive = new PclZip($file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $archive_files = $archive-&gt;extract(PCLZIP_OPT_EXTRACT_AS_STRING);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  reset_mbstring_encoding();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Is the archive valid?</span>&nbsp;</div></li><li><div>  if ( !is_array($archive_files) )&nbsp;</div></li><li><div>      return new WP_Error('incompatible_archive', __('Incompatible Archive.'), $archive-&gt;errorInfo(true));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 == count($archive_files) )&nbsp;</div></li><li><div>      return new WP_Error( 'empty_archive_pclzip', __( 'Empty archive.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uncompressed_size = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Determine any children directories needed (From within the archive)</span>&nbsp;</div></li><li><div>  foreach ( $archive_files as $file ) {&nbsp;</div></li><li><div>      if ( '__MACOSX/' === substr($file['filename'], 0, 9) ) <span class="comment"><span class="comment">// Skip the OS X-created __MACOSX directory</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $uncompressed_size += $file['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $needed_dirs[] = $to . untrailingslashit( $file['folder'] ? $file['filename'] : dirname($file['filename']) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * disk_free_space() could return false. Assume that any falsey value is an error.</span>&nbsp;</div></li><li><div><span class="comment">   * A disk that has zero free bytes has bigger problems.</span>&nbsp;</div></li><li><div><span class="comment">   * Require we have enough space to unzip the file and copy its contents, with a 10% buffer.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( defined( 'DOING_CRON' ) && DOING_CRON ) {&nbsp;</div></li><li><div>      $available_space = @disk_free_space( WP_CONTENT_DIR );&nbsp;</div></li><li><div>      if ( $available_space && ( $uncompressed_size * 2.1 ) &gt; $available_space )&nbsp;</div></li><li><div>          return new WP_Error( 'disk_full_unzip_file', __( 'Could not copy files. You may have run out of disk space.' ), compact( 'uncompressed_size', 'available_space' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $needed_dirs = array_unique($needed_dirs);&nbsp;</div></li><li><div>  foreach ( $needed_dirs as $dir ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Check the parent folders of the folders all exist within the creation array.</span></span>&nbsp;</div></li><li><div>      if ( untrailingslashit($to) == $dir ) <span class="comment"><span class="comment">// Skip over the working directory, We know this exists (or will exist)</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      if ( strpos($dir, $to) === false ) <span class="comment"><span class="comment">// If the directory is not within the working directory, Skip it</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $parent_folder = dirname($dir);&nbsp;</div></li><li><div>      while ( !empty($parent_folder) && untrailingslashit($to) != $parent_folder && !in_array($parent_folder, $needed_dirs) ) {&nbsp;</div></li><li><div>          $needed_dirs[] = $parent_folder;&nbsp;</div></li><li><div>          $parent_folder = dirname($parent_folder);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  asort($needed_dirs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Create those directories if need be:</span></span>&nbsp;</div></li><li><div>  foreach ( $needed_dirs as $_dir ) {&nbsp;</div></li><li><div>      <span class="comment">// Only check to see if the dir exists upon creation failure. Less I/O this way.</span>&nbsp;</div></li><li><div>      if ( ! $wp_filesystem-&gt;mkdir( $_dir, FS_CHMOD_DIR ) && ! $wp_filesystem-&gt;is_dir( $_dir ) )&nbsp;</div></li><li><div>          return new WP_Error( 'mkdir_failed_pclzip', __( 'Could not create directory.' ), substr( $_dir, strlen( $to ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  unset($needed_dirs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Extract the files from the zip</span>&nbsp;</div></li><li><div>  foreach ( $archive_files as $file ) {&nbsp;</div></li><li><div>      if ( $file['folder'] )&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '__MACOSX/' === substr($file['filename'], 0, 9) ) <span class="comment"><span class="comment">// Don't extract the OS X-created __MACOSX directory files</span></span>&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $wp_filesystem-&gt;put_contents( $to . $file['filename'], $file['content'], FS_CHMOD_FILE) )&nbsp;</div></li><li><div>          return new WP_Error( 'copy_failed_pclzip', __( 'Could not copy file.' ), $file['filename'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Copies a directory from one location to another via the WordPress Filesystem Abstraction.</span>&nbsp;</div></li><li><div><span class="comment"> * Assumes that WP_Filesystem() has already been called and setup.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Filesystem_Base $wp_filesystem Subclass</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $from source directory</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $to destination directory</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $skip_list a list of files/folders to skip copying</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed WP_Error on failure, True on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function copy_dir($from, $to, $skip_list = array() ) {&nbsp;</div></li><li><div>  global $wp_filesystem;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $dirlist = $wp_filesystem-&gt;dirlist($from);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $from = trailingslashit($from);&nbsp;</div></li><li><div>  $to = trailingslashit($to);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( (array) $dirlist as $filename =&gt; $fileinfo ) {&nbsp;</div></li><li><div>      if ( in_array( $filename, $skip_list ) )&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'f' == $fileinfo['type'] ) {&nbsp;</div></li><li><div>          if ( ! $wp_filesystem-&gt;copy($from . $filename, $to . $filename, true, FS_CHMOD_FILE) ) {&nbsp;</div></li><li><div>              <span class="comment">// If copy failed, chmod file to 0644 and try again.</span>&nbsp;</div></li><li><div>              $wp_filesystem-&gt;chmod( $to . $filename, FS_CHMOD_FILE );&nbsp;</div></li><li><div>              if ( ! $wp_filesystem-&gt;copy($from . $filename, $to . $filename, true, FS_CHMOD_FILE) )&nbsp;</div></li><li><div>                  return new WP_Error( 'copy_failed_copy_dir', __( 'Could not copy file.' ), $to . $filename );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( 'd' == $fileinfo['type'] ) {&nbsp;</div></li><li><div>          if ( !$wp_filesystem-&gt;is_dir($to . $filename) ) {&nbsp;</div></li><li><div>              if ( !$wp_filesystem-&gt;mkdir($to . $filename, FS_CHMOD_DIR) )&nbsp;</div></li><li><div>                  return new WP_Error( 'mkdir_failed_copy_dir', __( 'Could not create directory.' ), $to . $filename );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// generate the $sub_skip_list for the subdirectory as a sub-set of the existing $skip_list</span>&nbsp;</div></li><li><div>          $sub_skip_list = array();&nbsp;</div></li><li><div>          foreach ( $skip_list as $skip_item ) {&nbsp;</div></li><li><div>              if ( 0 === strpos( $skip_item, $filename . '/' ) )&nbsp;</div></li><li><div>                  $sub_skip_list[] = preg_replace( '!^' . preg_quote( $filename, '!' ) . '/!i', '', $skip_item );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $result = copy_dir($from . $filename, $to . $filename, $sub_skip_list);&nbsp;</div></li><li><div>          if ( is_wp_error($result) )&nbsp;</div></li><li><div>              return $result;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Initialises and connects the WordPress Filesystem Abstraction classes.</span>&nbsp;</div></li><li><div><span class="comment"> * This function will include the chosen transport and attempt connecting.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Plugins may add extra transports, And force WordPress to use them by returning</span>&nbsp;</div></li><li><div><span class="comment"> * the filename via the {@see 'filesystem_method_file'} filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Filesystem_Base $wp_filesystem Subclass</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|false  $args                         Optional. Connection args, These are passed directly to</span>&nbsp;</div></li><li><div><span class="comment"> *                                                   the `WP_Filesystem_*()` classes. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|false $context                      Optional. Context for get_filesystem_method(). Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $allow_relaxed_file_ownership Optional. Whether to allow Group/World writable. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return null|bool false on failure, true on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function WP_Filesystem( $args = false, $context = false, $allow_relaxed_file_ownership = false ) {&nbsp;</div></li><li><div>  global $wp_filesystem;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  require_once(ABSPATH . 'wp-admin/includes/class-wp-filesystem-base.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $method = get_filesystem_method( $args, $context, $allow_relaxed_file_ownership );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $method )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! class_exists( &quot;WP_Filesystem_$method&quot; ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the path for a specific filesystem method class file.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see get_filesystem_method()</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $path   Path to the specific filesystem method class file.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $method The filesystem method to use.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $abstraction_file = apply_filters( 'filesystem_method_file', ABSPATH . 'wp-admin/includes/class-wp-filesystem-' . $method . '.php', $method );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! file_exists($abstraction_file) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      require_once($abstraction_file);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $method = &quot;WP_Filesystem_$method&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_filesystem = new $method($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Define the timeouts for the connections. Only available after the construct is called to allow for per-transport overriding of the default.</span>&nbsp;</div></li><li><div>  if ( ! defined('FS_CONNECT_TIMEOUT') )&nbsp;</div></li><li><div>      define('FS_CONNECT_TIMEOUT', 30);&nbsp;</div></li><li><div>  if ( ! defined('FS_TIMEOUT') )&nbsp;</div></li><li><div>      define('FS_TIMEOUT', 30);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_wp_error($wp_filesystem-&gt;errors) && $wp_filesystem-&gt;errors-&gt;get_error_code() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$wp_filesystem-&gt;connect() )&nbsp;</div></li><li><div>      return false; <span class="comment">//There was an error connecting to the server.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set the permission constants if not already set.</span>&nbsp;</div></li><li><div>  if ( ! defined('FS_CHMOD_DIR') )&nbsp;</div></li><li><div>      define('FS_CHMOD_DIR', ( fileperms( ABSPATH ) & 0777 | 0755 ) );&nbsp;</div></li><li><div>  if ( ! defined('FS_CHMOD_FILE') )&nbsp;</div></li><li><div>      define('FS_CHMOD_FILE', ( fileperms( ABSPATH . 'index.php' ) & 0777 | 0644 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Determines which method to use for reading, writing, modifying, or deleting</span>&nbsp;</div></li><li><div><span class="comment"> * files on the filesystem.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The priority of the transports are: Direct, SSH2, FTP PHP Extension, FTP Sockets</span>&nbsp;</div></li><li><div><span class="comment"> * (Via Sockets class, or `fsockopen()`). Valid values for these are: 'direct', 'ssh2', </span>&nbsp;</div></li><li><div><span class="comment"> * 'ftpext' or 'ftpsockets'.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The return value can be overridden by defining the `FS_METHOD` constant in `wp-config.php`, </span>&nbsp;</div></li><li><div><span class="comment"> * or filtering via {@see 'filesystem_method'}.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @link https://codex.wordpress.org/Editing_wp-config.php#WordPress_Upgrade_Constants</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Plugins may define a custom transport handler, See WP_Filesystem().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global callable $_wp_filesystem_direct_method</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $args                         Optional. Connection details. Default empty array.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $context                      Optional. Full path to the directory that is tested</span>&nbsp;</div></li><li><div><span class="comment"> *                                             for being writable. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $allow_relaxed_file_ownership Optional. Whether to allow Group/World writable.</span>&nbsp;</div></li><li><div><span class="comment"> *                                             Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The transport to use, see description for valid return values.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_filesystem_method( $args = array(), $context = '', $allow_relaxed_file_ownership = false ) {&nbsp;</div></li><li><div>  $method = defined('FS_METHOD') ? FS_METHOD : false; <span class="comment">// Please ensure that this is either 'direct', 'ssh2', 'ftpext' or 'ftpsockets'</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $context ) {&nbsp;</div></li><li><div>      $context = WP_CONTENT_DIR;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the directory doesn't exist (wp-content/languages) then use the parent directory as we'll create it.</span>&nbsp;</div></li><li><div>  if ( WP_LANG_DIR == $context && ! is_dir( $context ) ) {&nbsp;</div></li><li><div>      $context = dirname( $context );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $context = trailingslashit( $context );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $method ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $temp_file_name = $context . 'temp-write-test-' . time();&nbsp;</div></li><li><div>      $temp_handle = @fopen($temp_file_name, 'w');&nbsp;</div></li><li><div>      if ( $temp_handle ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Attempt to determine the file owner of the WordPress files, and that of newly created files</span>&nbsp;</div></li><li><div>          $wp_file_owner = $temp_file_owner = false;&nbsp;</div></li><li><div>          if ( function_exists('fileowner') ) {&nbsp;</div></li><li><div>              $wp_file_owner = @fileowner( __FILE__ );&nbsp;</div></li><li><div>              $temp_file_owner = @fileowner( $temp_file_name );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $wp_file_owner !== false && $wp_file_owner === $temp_file_owner ) {&nbsp;</div></li><li><div>              <span class="comment">// WordPress is creating files as the same owner as the WordPress files, </span>&nbsp;</div></li><li><div>              <span class="comment">// this means it's safe to modify & create new files via PHP.</span>&nbsp;</div></li><li><div>              $method = 'direct';&nbsp;</div></li><li><div>              $GLOBALS['_wp_filesystem_direct_method'] = 'file_owner';&nbsp;</div></li><li><div>          } elseif ( $allow_relaxed_file_ownership ) {&nbsp;</div></li><li><div>              <span class="comment">// The $context directory is writable, and $allow_relaxed_file_ownership is set, this means we can modify files</span>&nbsp;</div></li><li><div>              <span class="comment">// safely in this directory. This mode doesn't create new files, only alter existing ones.</span>&nbsp;</div></li><li><div>              $method = 'direct';&nbsp;</div></li><li><div>              $GLOBALS['_wp_filesystem_direct_method'] = 'relaxed_ownership';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          @fclose($temp_handle);&nbsp;</div></li><li><div>          @unlink($temp_file_name);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>   }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $method && isset($args['connection_type']) && 'ssh' == $args['connection_type'] && extension_loaded('ssh2') && function_exists('stream_get_contents') ) $method = 'ssh2';&nbsp;</div></li><li><div>  if ( ! $method && extension_loaded('ftp') ) $method = 'ftpext';&nbsp;</div></li><li><div>  if ( ! $method && ( extension_loaded('sockets') || function_exists('fsockopen') ) ) $method = 'ftpsockets'; <span class="comment">//Sockets: Socket extension; PHP Mode: FSockopen / fwrite / fread</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the filesystem method to use.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $method  Filesystem method to return.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args    An array of connection details for the method.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $context Full path to the directory that is tested for being writable.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool   $allow_relaxed_file_ownership Whether to allow Group/World writable.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'filesystem_method', $method, $args, $context, $allow_relaxed_file_ownership );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays a form to the user to request for their FTP/SSH details in order</span>&nbsp;</div></li><li><div><span class="comment"> * to connect to the filesystem.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * All chosen/entered details are saved, excluding the password.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Hostnames may be in the form of hostname:portnumber (eg: wordpress.org:2467)</span>&nbsp;</div></li><li><div><span class="comment"> * to specify an alternate FTP/SSH port.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Plugins may override this form by returning true|false via the {@see 'request_filesystem_credentials'} filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.6.0 The `$context` parameter default changed from `false` to an empty string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global string $pagenow</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $form_post                    The URL to post the form to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type                         Optional. Chosen type of filesystem. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $error                        Optional. Whether the current request has failed to connect.</span>&nbsp;</div></li><li><div><span class="comment"> *                                             Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $context                      Optional. Full path to the directory that is tested for being</span>&nbsp;</div></li><li><div><span class="comment"> *                                             writable. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $extra_fields                 Optional. Extra `POST` fields to be checked for inclusion in</span>&nbsp;</div></li><li><div><span class="comment"> *                                             the post. Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $allow_relaxed_file_ownership Optional. Whether to allow Group/World writable. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False on failure, true on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function request_filesystem_credentials( $form_post, $type = '', $error = false, $context = '', $extra_fields = null, $allow_relaxed_file_ownership = false ) {&nbsp;</div></li><li><div>  global $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the filesystem credentials form output.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Returning anything other than an empty string will effectively short-circuit</span>&nbsp;</div></li><li><div><span class="comment">   * output of the filesystem credentials form, returning that value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.6.0 The `$context` parameter default changed from `false` to an empty string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $output                       Form output to return instead. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $form_post                    The URL to post the form to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type                         Chosen type of filesystem.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool   $error                        Whether the current request has failed to connect.</span>&nbsp;</div></li><li><div><span class="comment">   *                                             Default false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $context                      Full path to the directory that is tested for</span>&nbsp;</div></li><li><div><span class="comment">   *                                             being writable.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool   $allow_relaxed_file_ownership Whether to allow Group/World writable.</span>&nbsp;</div></li><li><div><span class="comment">   *                                             Default false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $extra_fields                 Extra POST fields.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $req_cred = apply_filters( 'request_filesystem_credentials', '', $form_post, $type, $error, $context, $extra_fields, $allow_relaxed_file_ownership );&nbsp;</div></li><li><div>  if ( '' !== $req_cred )&nbsp;</div></li><li><div>      return $req_cred;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty($type) ) {&nbsp;</div></li><li><div>      $type = get_filesystem_method( array(), $context, $allow_relaxed_file_ownership );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'direct' == $type )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_null( $extra_fields ) )&nbsp;</div></li><li><div>      $extra_fields = array( 'version', 'locale' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $credentials = get_option('ftp_credentials', array( 'hostname' =&gt; '', 'username' =&gt; ''));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If defined, set it to that, Else, If POST'd, set it to that, If not, Set it to whatever it previously was(saved details in option)</span>&nbsp;</div></li><li><div>  $credentials['hostname'] = defined('FTP_HOST') ? FTP_HOST : (!empty($_POST['hostname']) ? wp_unslash( $_POST['hostname'] ) : $credentials['hostname']);&nbsp;</div></li><li><div>  $credentials['username'] = defined('FTP_USER') ? FTP_USER : (!empty($_POST['username']) ? wp_unslash( $_POST['username'] ) : $credentials['username']);&nbsp;</div></li><li><div>  $credentials['password'] = defined('FTP_PASS') ? FTP_PASS : (!empty($_POST['password']) ? wp_unslash( $_POST['password'] ) : '');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check to see if we are setting the public/private keys for ssh</span>&nbsp;</div></li><li><div>  $credentials['public_key'] = defined('FTP_PUBKEY') ? FTP_PUBKEY : (!empty($_POST['public_key']) ? wp_unslash( $_POST['public_key'] ) : '');&nbsp;</div></li><li><div>  $credentials['private_key'] = defined('FTP_PRIKEY') ? FTP_PRIKEY : (!empty($_POST['private_key']) ? wp_unslash( $_POST['private_key'] ) : '');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Sanitize the hostname, Some people might pass in odd-data:</span>&nbsp;</div></li><li><div>  $credentials['hostname'] = preg_replace('|\w+:<span class="comment">//|', '', $credentials['hostname']); //Strip any schemes off</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( strpos($credentials['hostname'], ':') ) {&nbsp;</div></li><li><div>      list( $credentials['hostname'], $credentials['port'] ) = explode(':', $credentials['hostname'], 2);&nbsp;</div></li><li><div>      if ( ! is_numeric($credentials['port']) )&nbsp;</div></li><li><div>          unset($credentials['port']);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      unset($credentials['port']);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( defined( 'FTP_SSH' ) && FTP_SSH ) || ( defined( 'FS_METHOD' ) && 'ssh2' == FS_METHOD ) ) {&nbsp;</div></li><li><div>      $credentials['connection_type'] = 'ssh';&nbsp;</div></li><li><div>  } elseif ( ( defined( 'FTP_SSL' ) && FTP_SSL ) && 'ftpext' == $type ) { <span class="comment">//Only the FTP Extension understands SSL</span>&nbsp;</div></li><li><div>      $credentials['connection_type'] = 'ftps';&nbsp;</div></li><li><div>  } elseif ( ! empty( $_POST['connection_type'] ) ) {&nbsp;</div></li><li><div>      $credentials['connection_type'] = wp_unslash( $_POST['connection_type'] );&nbsp;</div></li><li><div>  } elseif ( ! isset( $credentials['connection_type'] ) ) { <span class="comment">//All else fails (And it's not defaulted to something else saved), Default to FTP</span>&nbsp;</div></li><li><div>      $credentials['connection_type'] = 'ftp';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( ! $error &&&nbsp;</div></li><li><div>          (&nbsp;</div></li><li><div>              ( !empty($credentials['password']) && !empty($credentials['username']) && !empty($credentials['hostname']) ) ||&nbsp;</div></li><li><div>              ( 'ssh' == $credentials['connection_type'] && !empty($credentials['public_key']) && !empty($credentials['private_key']) )&nbsp;</div></li><li><div> ) ) {&nbsp;</div></li><li><div>      $stored_credentials = $credentials;&nbsp;</div></li><li><div>      if ( !empty($stored_credentials['port']) ) <span class="comment">//save port as part of hostname to simplify above code.</span>&nbsp;</div></li><li><div>          $stored_credentials['hostname'] .= ':' . $stored_credentials['port'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset($stored_credentials['password'], $stored_credentials['port'], $stored_credentials['private_key'], $stored_credentials['public_key']);&nbsp;</div></li><li><div>      if ( ! wp_installing() ) {&nbsp;</div></li><li><div>          update_option( 'ftp_credentials', $stored_credentials );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $credentials;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $hostname = isset( $credentials['hostname'] ) ? $credentials['hostname'] : '';&nbsp;</div></li><li><div>  $username = isset( $credentials['username'] ) ? $credentials['username'] : '';&nbsp;</div></li><li><div>  $public_key = isset( $credentials['public_key'] ) ? $credentials['public_key'] : '';&nbsp;</div></li><li><div>  $private_key = isset( $credentials['private_key'] ) ? $credentials['private_key'] : '';&nbsp;</div></li><li><div>  $port = isset( $credentials['port'] ) ? $credentials['port'] : '';&nbsp;</div></li><li><div>  $connection_type = isset( $credentials['connection_type'] ) ? $credentials['connection_type'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $error ) {&nbsp;</div></li><li><div>      $error_string = __('&lt;strong&gt;ERROR:&lt;/strong&gt; There was an error connecting to the server, Please verify the settings are correct.');&nbsp;</div></li><li><div>      if ( is_wp_error($error) )&nbsp;</div></li><li><div>          $error_string = esc_html( $error-&gt;get_error_message() );&nbsp;</div></li><li><div>      echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;' . $error_string . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $types = array();&nbsp;</div></li><li><div>  if ( extension_loaded('ftp') || extension_loaded('sockets') || function_exists('fsockopen') )&nbsp;</div></li><li><div>      $types[ 'ftp' ] = __('FTP');&nbsp;</div></li><li><div>  if ( extension_loaded('ftp') ) <span class="comment">//Only this supports FTPS</span>&nbsp;</div></li><li><div>      $types[ 'ftps' ] = __('FTPS (SSL)');&nbsp;</div></li><li><div>  if ( extension_loaded('ssh2') && function_exists('stream_get_contents') )&nbsp;</div></li><li><div>      $types[ 'ssh' ] = __('SSH2');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the connection types to output to the filesystem credentials form.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.6.0 The `$context` parameter default changed from `false` to an empty string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $types       Types of connections.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $credentials Credentials to connect with.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type        Chosen filesystem method.</span>&nbsp;</div></li><li><div><span class="comment">   * @param object $error       Error object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $context     Full path to the directory that is tested</span>&nbsp;</div></li><li><div><span class="comment">   *                            for being writable.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $types = apply_filters( 'fs_ftp_connection_types', $types, $credentials, $type, $error, $context );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;form action=&quot;&lt;?php echo esc_url( $form_post ) ?&gt;&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&lt;div id=&quot;request-filesystem-credentials-form&quot; class=&quot;request-filesystem-credentials-form&quot;&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">// Print a H1 heading in the FTP credentials modal dialog, default is a H2.</span>&nbsp;</div></li><li><div>$heading_tag = 'h2';&nbsp;</div></li><li><div>if ( 'plugins.php' === $pagenow || 'plugin-install.php' === $pagenow ) {&nbsp;</div></li><li><div>  $heading_tag = 'h1';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>echo &quot;&lt;$heading_tag id='request-filesystem-credentials-title'&gt;&quot; . __( 'Connection Information' ) . &quot;&lt;/$heading_tag&gt;&quot;;&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;p id=&quot;request-filesystem-credentials-desc&quot;&gt;&lt;?php&nbsp;</div></li><li><div>  $label_user = __('Username');&nbsp;</div></li><li><div>  $label_pass = __('Password');&nbsp;</div></li><li><div>  _e('To perform the requested action, WordPress needs to access your web server.');&nbsp;</div></li><li><div>  echo ' ';&nbsp;</div></li><li><div>  if ( ( isset( $types['ftp'] ) || isset( $types['ftps'] ) ) ) {&nbsp;</div></li><li><div>      if ( isset( $types['ssh'] ) ) {&nbsp;</div></li><li><div>          _e('Please enter your FTP or SSH credentials to proceed.');&nbsp;</div></li><li><div>          $label_user = __('FTP/SSH Username');&nbsp;</div></li><li><div>          $label_pass = __('FTP/SSH Password');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          _e('Please enter your FTP credentials to proceed.');&nbsp;</div></li><li><div>          $label_user = __('FTP Username');&nbsp;</div></li><li><div>          $label_pass = __('FTP Password');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      echo ' ';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  _e('If you do not remember your credentials, you should contact your web host.');&nbsp;</div></li><li><div>?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&lt;label for=&quot;hostname&quot;&gt;&nbsp;</div></li><li><div>  &lt;span class=&quot;field-title&quot;&gt;&lt;?php _e( 'Hostname' ) ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;input name=&quot;hostname&quot; type=&quot;text&quot; id=&quot;hostname&quot; aria-describedby=&quot;request-filesystem-credentials-desc&quot; class=&quot;code&quot; placeholder=&quot;&lt;?php esc_attr_e( 'example: www.wordpress.org' ) ?&gt;&quot; value=&quot;&lt;?php echo esc_attr($hostname); if ( !empty($port) ) echo &quot;:$port&quot;; ?&gt;&quot;&lt;?php disabled( defined('FTP_HOST') ); ?&gt; /&gt;&nbsp;</div></li><li><div>&lt;/label&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;ftp-username&quot;&gt;&nbsp;</div></li><li><div>  &lt;label for=&quot;username&quot;&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;field-title&quot;&gt;&lt;?php echo $label_user; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;username&quot; type=&quot;text&quot; id=&quot;username&quot; value=&quot;&lt;?php echo esc_attr($username) ?&gt;&quot;&lt;?php disabled( defined('FTP_USER') ); ?&gt; /&gt;&nbsp;</div></li><li><div>  &lt;/label&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;ftp-password&quot;&gt;&nbsp;</div></li><li><div>  &lt;label for=&quot;password&quot;&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;field-title&quot;&gt;&lt;?php echo $label_pass; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;password&quot; type=&quot;password&quot; id=&quot;password&quot; value=&quot;&lt;?php if ( defined('FTP_PASS') ) echo '*****'; ?&gt;&quot;&lt;?php disabled( defined('FTP_PASS') ); ?&gt; /&gt;&nbsp;</div></li><li><div>      &lt;em&gt;&lt;?php if ( ! defined('FTP_PASS') ) _e( 'This password will not be stored on the server.' ); ?&gt;&lt;/em&gt;&nbsp;</div></li><li><div>  &lt;/label&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;fieldset&gt;&nbsp;</div></li><li><div>&lt;legend&gt;&lt;?php _e( 'Connection Type' ); ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  $disabled = disabled( ( defined( 'FTP_SSL' ) && FTP_SSL ) || ( defined( 'FTP_SSH' ) && FTP_SSH ), true, false );&nbsp;</div></li><li><div>  foreach ( $types as $name =&gt; $text ) : ?&gt;&nbsp;</div></li><li><div>  &lt;label for=&quot;&lt;?php echo esc_attr( $name ) ?&gt;&quot;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;radio&quot; name=&quot;connection_type&quot; id=&quot;&lt;?php echo esc_attr( $name ) ?&gt;&quot; value=&quot;&lt;?php echo esc_attr( $name ) ?&gt;&quot;&lt;?php checked( $name, $connection_type ); echo $disabled; ?&gt; /&gt;&nbsp;</div></li><li><div>      &lt;?php echo $text; ?&gt;&nbsp;</div></li><li><div>  &lt;/label&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  endforeach;&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>if ( isset( $types['ssh'] ) ) {&nbsp;</div></li><li><div>  $hidden_class = '';&nbsp;</div></li><li><div>  if ( 'ssh' != $connection_type || empty( $connection_type ) ) {&nbsp;</div></li><li><div>      $hidden_class = ' class=&quot;hidden&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;fieldset id=&quot;ssh-keys&quot;&lt;?php echo $hidden_class; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>&lt;legend&gt;&lt;?php _e( 'Authentication Keys' ); ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;label for=&quot;public_key&quot;&gt;&nbsp;</div></li><li><div>  &lt;span class=&quot;field-title&quot;&gt;&lt;?php _e('Public Key:') ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;input name=&quot;public_key&quot; type=&quot;text&quot; id=&quot;public_key&quot; aria-describedby=&quot;auth-keys-desc&quot; value=&quot;&lt;?php echo esc_attr($public_key) ?&gt;&quot;&lt;?php disabled( defined('FTP_PUBKEY') ); ?&gt; /&gt;&nbsp;</div></li><li><div>&lt;/label&gt;&nbsp;</div></li><li><div>&lt;label for=&quot;private_key&quot;&gt;&nbsp;</div></li><li><div>  &lt;span class=&quot;field-title&quot;&gt;&lt;?php _e('Private Key:') ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;input name=&quot;private_key&quot; type=&quot;text&quot; id=&quot;private_key&quot; value=&quot;&lt;?php echo esc_attr($private_key) ?&gt;&quot;&lt;?php disabled( defined('FTP_PRIKEY') ); ?&gt; /&gt;&nbsp;</div></li><li><div>&lt;/label&gt;&nbsp;</div></li><li><div>&lt;p id=&quot;auth-keys-desc&quot;&gt;&lt;?php _e( 'Enter the location on the server where the public and private keys are located. If a passphrase is needed, enter that in the password field above.' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>foreach ( (array) $extra_fields as $field ) {&nbsp;</div></li><li><div>  if ( isset( $_POST[ $field ] ) )&nbsp;</div></li><li><div>      echo '&lt;input type=&quot;hidden&quot; name=&quot;' . esc_attr( $field ) . '&quot; value=&quot;' . esc_attr( wp_unslash( $_POST[ $field ] ) ) . '&quot; /&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;p class=&quot;request-filesystem-credentials-action-buttons&quot;&gt;&nbsp;</div></li><li><div>      &lt;button class=&quot;button cancel-button&quot; data-js-action=&quot;close&quot; type=&quot;button&quot;&gt;&lt;?php _e( 'Cancel' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;?php submit_button( __( 'Proceed' ), '', 'upgrade', false ); ?&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;/form&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Print the filesystem credentials modal when needed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_print_request_filesystem_credentials_modal() {&nbsp;</div></li><li><div>  $filesystem_method = get_filesystem_method();&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>  $filesystem_credentials_are_stored = request_filesystem_credentials( self_admin_url() );&nbsp;</div></li><li><div>  ob_end_clean();&nbsp;</div></li><li><div>  $request_filesystem_credentials = ( $filesystem_method != 'direct' && ! $filesystem_credentials_are_stored );&nbsp;</div></li><li><div>  if ( ! $request_filesystem_credentials ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;request-filesystem-credentials-dialog&quot; class=&quot;notification-dialog-wrap request-filesystem-credentials-dialog&quot;&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;notification-dialog-background&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;notification-dialog&quot; role=&quot;dialog&quot; aria-labelledby=&quot;request-filesystem-credentials-title&quot; tabindex=&quot;0&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;request-filesystem-credentials-dialog-content&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php request_filesystem_credentials( site_url() ); ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-admin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>