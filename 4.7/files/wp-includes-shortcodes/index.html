<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7" data-type="file" data-id="4928"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-shortcodes | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=83f22d20f5059098a8b6acfc5cf300ed' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-shortcodes/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-shortcodes%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-shortcodes%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-file-wp-includes-shortcodes","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-shortcodes" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-shortcodes</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/shortcodes.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress API for creating bbcode-like tags or what WordPress calls</span>&nbsp;</div></li><li><div><span class="comment"> * &quot;shortcodes&quot;. The tag and attribute parsing or regular expression code is</span>&nbsp;</div></li><li><div><span class="comment"> * based on the Textpattern tag parser.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A few examples are below:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * [shortcode /]</span>&nbsp;</div></li><li><div><span class="comment"> * [shortcode foo=&quot;bar&quot; baz=&quot;bing&quot; /]</span>&nbsp;</div></li><li><div><span class="comment"> * [shortcode foo=&quot;bar&quot;]content[/shortcode]</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Shortcode tags support attributes and enclosed content, but does not entirely</span>&nbsp;</div></li><li><div><span class="comment"> * support inline shortcodes in other shortcodes. You will have to call the</span>&nbsp;</div></li><li><div><span class="comment"> * shortcode parser in your function to account for that.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * {@internal</span>&nbsp;</div></li><li><div><span class="comment"> * Please be aware that the above note was made during the beta of WordPress 2.6</span>&nbsp;</div></li><li><div><span class="comment"> * and in the future may not be accurate. Please update the note when it is no</span>&nbsp;</div></li><li><div><span class="comment"> * longer the case.}}</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * To apply shortcode tags to content:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     $out = do_shortcode( $content );</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @link https://codex.wordpress.org/Shortcode_API</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Shortcodes</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Container for storing shortcode tags and their hook to call for the shortcode</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @name $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> * @var array</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>$shortcode_tags = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add hook for shortcode tag.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * There can only be one hook for each shortcode. Which means that if another</span>&nbsp;</div></li><li><div><span class="comment"> * plugin has a similar shortcode, it will override yours or yours will override</span>&nbsp;</div></li><li><div><span class="comment"> * theirs depending on which order the plugins are included and/or ran.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Simplest example of a shortcode tag using the API:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     // [footag foo=&quot;bar&quot;]</span>&nbsp;</div></li><li><div><span class="comment"> *     function footag_func( $atts ) {</span>&nbsp;</div></li><li><div><span class="comment"> *         return &quot;foo = {</span>&nbsp;</div></li><li><div><span class="comment"> *             $atts[foo]</span>&nbsp;</div></li><li><div><span class="comment"> *         }&quot;;</span>&nbsp;</div></li><li><div><span class="comment"> *     }</span>&nbsp;</div></li><li><div><span class="comment"> *     add_shortcode( 'footag', 'footag_func' );</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Example with nice attribute defaults:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     // [bartag foo=&quot;bar&quot;]</span>&nbsp;</div></li><li><div><span class="comment"> *     function bartag_func( $atts ) {</span>&nbsp;</div></li><li><div><span class="comment"> *         $args = shortcode_atts( array(</span>&nbsp;</div></li><li><div><span class="comment"> *             'foo' =&gt; 'no foo', </span>&nbsp;</div></li><li><div><span class="comment"> *             'baz' =&gt; 'default baz', </span>&nbsp;</div></li><li><div><span class="comment"> * ), $atts );</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *         return &quot;foo = {$args['foo']}&quot;;</span>&nbsp;</div></li><li><div><span class="comment"> *     }</span>&nbsp;</div></li><li><div><span class="comment"> *     add_shortcode( 'bartag', 'bartag_func' );</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Example with enclosed content:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     // [baztag]content[/baztag]</span>&nbsp;</div></li><li><div><span class="comment"> *     function baztag_func( $atts, $content = '' ) {</span>&nbsp;</div></li><li><div><span class="comment"> *         return &quot;content = $content&quot;;</span>&nbsp;</div></li><li><div><span class="comment"> *     }</span>&nbsp;</div></li><li><div><span class="comment"> *     add_shortcode( 'baztag', 'baztag_func' );</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $tag  Shortcode tag to be searched in post content.</span>&nbsp;</div></li><li><div><span class="comment"> * @param callable $func Hook to run when shortcode is found.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_shortcode($tag, $func) {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' == trim( $tag ) ) {&nbsp;</div></li><li><div>      $message = __( 'Invalid shortcode name: Empty name given.' );&nbsp;</div></li><li><div>      _doing_it_wrong( __FUNCTION__, $message, '4.4.0' );&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 !== preg_match( '@[&lt;&gt;&/\[\]\x00-\x20=]@', $tag ) ) {&nbsp;</div></li><li><div>      <span class="comment">/** translators: 1: shortcode name, 2: space separated list of reserved characters */</span>&nbsp;</div></li><li><div>      $message = sprintf( __( 'Invalid shortcode name: %1$s. Do not use spaces or reserved characters: %2$s' ), $tag, '& / &lt; &gt; [ ] =' );&nbsp;</div></li><li><div>      _doing_it_wrong( __FUNCTION__, $message, '4.4.0' );&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $shortcode_tags[ $tag ] = $func;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes hook for shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $tag Shortcode tag to remove hook for.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_shortcode($tag) {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  unset($shortcode_tags[$tag]);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Clear all shortcodes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function is simple, it clears all of the shortcode tags by replacing the</span>&nbsp;</div></li><li><div><span class="comment"> * shortcodes global by a empty array. This is actually a very efficient method</span>&nbsp;</div></li><li><div><span class="comment"> * for removing all shortcodes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_all_shortcodes() {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $shortcode_tags = array();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether a registered shortcode exists named $tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags List of shortcode tags and their callback hooks.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $tag Shortcode tag to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether the given shortcode exists.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function shortcode_exists( $tag ) {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>  return array_key_exists( $tag, $shortcode_tags );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether the passed content contains the specified shortcode</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Content to search for shortcodes.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $tag     Shortcode tag to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether the passed content contains the given shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function has_shortcode( $content, $tag ) {&nbsp;</div></li><li><div>  if ( false === strpos( $content, '[' ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( shortcode_exists( $tag ) ) {&nbsp;</div></li><li><div>      preg_match_all( '/' . get_shortcode_regex() . '/', $content, $matches, PREG_SET_ORDER );&nbsp;</div></li><li><div>      if ( empty( $matches ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $matches as $shortcode ) {&nbsp;</div></li><li><div>          if ( $tag === $shortcode[2] ) {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          } elseif ( ! empty( $shortcode[5] ) && has_shortcode( $shortcode[5], $tag ) ) {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Search content for shortcodes and filter shortcodes through their hooks.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If there are no shortcode tags defined, then the content will be returned</span>&nbsp;</div></li><li><div><span class="comment"> * without any filtering. This might cause issues when plugins are disabled but</span>&nbsp;</div></li><li><div><span class="comment"> * the shortcode will still show up in the post or content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags List of shortcode tags and their callback hooks.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Content to search for shortcodes.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $ignore_html When true, shortcodes inside HTML elements will be skipped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Content with shortcodes filtered out.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function do_shortcode( $content, $ignore_html = false ) {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === strpos( $content, '[' ) ) {&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (empty($shortcode_tags) || !is_array($shortcode_tags))&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Find all registered tag names in $content.</span></span>&nbsp;</div></li><li><div>  preg_match_all( '@\[([^&lt;&gt;&/\[\]\x00-\x20=]++)@', $content, $matches );&nbsp;</div></li><li><div>  $tagnames = array_intersect( array_keys( $shortcode_tags ), $matches[1] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $tagnames ) ) {&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content = do_shortcodes_in_html_tags( $content, $ignore_html, $tagnames );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pattern = get_shortcode_regex( $tagnames );&nbsp;</div></li><li><div>  $content = preg_replace_callback( &quot;/$pattern/&quot;, 'do_shortcode_tag', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Always restore square braces so we don't break things like &lt;!--[if IE ]&gt;</span></span>&nbsp;</div></li><li><div>  $content = unescape_invalid_shortcodes( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $content;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the shortcode regular expression for searching.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The regular expression combines the shortcode tags in the regular expression</span>&nbsp;</div></li><li><div><span class="comment"> * in a regex class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The regular expression contains 6 different sub matches to help with parsing.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * 1 - An extra [ to allow for escaping shortcodes with double [[]]</span>&nbsp;</div></li><li><div><span class="comment"> * 2 - The shortcode name</span>&nbsp;</div></li><li><div><span class="comment"> * 3 - The shortcode argument list</span>&nbsp;</div></li><li><div><span class="comment"> * 4 - The self closing /</span>&nbsp;</div></li><li><div><span class="comment"> * 5 - The content of a shortcode when it wraps some content.</span>&nbsp;</div></li><li><div><span class="comment"> * 6 - An extra ] to allow for escaping shortcodes with double [[]]</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Added the `$tagnames` parameter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $tagnames Optional. List of shortcodes to find. Defaults to all registered shortcodes.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The shortcode search regular expression</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_shortcode_regex( $tagnames = null ) {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $tagnames ) ) {&nbsp;</div></li><li><div>      $tagnames = array_keys( $shortcode_tags );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $tagregexp = join( '|', array_map('preg_quote', $tagnames) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// WARNING! Do not change this regex without changing do_shortcode_tag() and strip_shortcode_tag()</span>&nbsp;</div></li><li><div>  <span class="comment">// Also, see shortcode_unautop() and shortcode.js.</span>&nbsp;</div></li><li><div>  return&nbsp;</div></li><li><div>        '\\['                              <span class="comment">// Opening bracket</span>&nbsp;</div></li><li><div>      . '(\\[?)'                           <span class="comment">// 1: Optional second opening bracket for escaping shortcodes: [[tag]]</span>&nbsp;</div></li><li><div>      . &quot;($tagregexp)&quot;                     <span class="comment">// 2: Shortcode name</span>&nbsp;</div></li><li><div>      . '(?![\\w-])'                       <span class="comment">// Not followed by word character or hyphen</span>&nbsp;</div></li><li><div>      . '('                                <span class="comment">// 3: Unroll the loop: Inside the opening shortcode tag</span>&nbsp;</div></li><li><div>      .     '[^\\]\\/]*'                   <span class="comment"><span class="comment">// Not a closing bracket or forward slash</span></span>&nbsp;</div></li><li><div>      .     '(?:'&nbsp;</div></li><li><div>      .         '\\/(?!\\])'               <span class="comment">// A forward slash not followed by a closing bracket</span>&nbsp;</div></li><li><div>      .         '[^\\]\\/]*'               <span class="comment"><span class="comment">// Not a closing bracket or forward slash</span></span>&nbsp;</div></li><li><div>      .     ')*?'&nbsp;</div></li><li><div>      . ')'&nbsp;</div></li><li><div>      . '(?:'&nbsp;</div></li><li><div>      .     '(\\/)'                        <span class="comment">// 4: Self closing tag ...</span>&nbsp;</div></li><li><div>      .     '\\]'                          <span class="comment">// ... and closing bracket</span>&nbsp;</div></li><li><div>      . '|'&nbsp;</div></li><li><div>      .     '\\]'                          <span class="comment">// Closing bracket</span>&nbsp;</div></li><li><div>      .     '(?:'&nbsp;</div></li><li><div>      .         '('                        <span class="comment">// 5: Unroll the loop: Optionally, anything between the opening and closing shortcode tags</span>&nbsp;</div></li><li><div>      .             '[^\\[]*+'             <span class="comment"><span class="comment">// Not an opening bracket</span></span>&nbsp;</div></li><li><div>      .             '(?:'&nbsp;</div></li><li><div>      .                 '\\[(?!\\/\\2\\])' <span class="comment">// An opening bracket not followed by the closing shortcode tag</span>&nbsp;</div></li><li><div>      .                 '[^\\[]*+'         <span class="comment"><span class="comment">// Not an opening bracket</span></span>&nbsp;</div></li><li><div>      .             ')*+'&nbsp;</div></li><li><div>      .         ')'&nbsp;</div></li><li><div>      .         '\\[\\/\\2\\]'             <span class="comment">// Closing shortcode tag</span>&nbsp;</div></li><li><div>      .     ')?'&nbsp;</div></li><li><div>      . ')'&nbsp;</div></li><li><div>      . '(\\]?)';                          <span class="comment">// 6: Optional second closing brocket for escaping shortcodes: [[tag]]</span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Regular Expression callable for do_shortcode() for calling shortcode hook.</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_shortcode_regex for details of the match array contents.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $m Regular expression match array</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|false False on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function do_shortcode_tag( $m ) {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// allow [[foo]] syntax for escaping a tag</span></span>&nbsp;</div></li><li><div>  if ( $m[1] == '[' && $m[6] == ']' ) {&nbsp;</div></li><li><div>      return substr($m[0], 1, -1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tag = $m[2];&nbsp;</div></li><li><div>  $attr = shortcode_parse_atts( $m[3] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_callable( $shortcode_tags[ $tag ] ) ) {&nbsp;</div></li><li><div>      <span class="comment">/** translators: %s: shortcode tag */</span>&nbsp;</div></li><li><div>      $message = sprintf( __( 'Attempting to parse a shortcode without a valid callback: %s' ), $tag );&nbsp;</div></li><li><div>      _doing_it_wrong( __FUNCTION__, $message, '4.3.0' );&nbsp;</div></li><li><div>      return $m[0];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to call a shortcode callback.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a truthy value to the filter will effectively short-circuit the</span>&nbsp;</div></li><li><div><span class="comment">   * shortcode generation process, returning that value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool|string $return      Short-circuit return value. Either false or the value to replace the shortcode with.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $tag         Shortcode name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array       $attr        Shortcode attributes array, </span>&nbsp;</div></li><li><div><span class="comment">   * @param array       $m           Regular expression match array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $return = apply_filters( 'pre_do_shortcode_tag', false, $tag, $attr, $m );&nbsp;</div></li><li><div>  if ( false !== $return ) {&nbsp;</div></li><li><div>      return $return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content = isset( $m[5] ) ? $m[5] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $output = $m[1] . call_user_func( $shortcode_tags[ $tag ], $attr, $content, $tag ) . $m[6];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the output created by a shortcode callback.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output Shortcode output.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $tag    Shortcode name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $attr   Shortcode attributes array, </span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $m      Regular expression match array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'do_shortcode_tag', $output, $tag, $attr, $m );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Search only inside HTML elements for shortcodes and process them.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Any [ or ] characters remaining inside elements will be HTML encoded</span>&nbsp;</div></li><li><div><span class="comment"> * to prevent interference with shortcodes that are outside the elements.</span>&nbsp;</div></li><li><div><span class="comment"> * Assumes $content processed by KSES already.  Users with unfiltered_html</span>&nbsp;</div></li><li><div><span class="comment"> * capability may get unexpected output if angle braces are nested in tags.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Content to search for shortcodes</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $ignore_html When true, all square braces inside elements will be encoded.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $tagnames List of shortcodes to find.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Content with shortcodes filtered out.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function do_shortcodes_in_html_tags( $content, $ignore_html, $tagnames ) {&nbsp;</div></li><li><div>  <span class="comment">// Normalize entities in unfiltered HTML before adding placeholders.</span>&nbsp;</div></li><li><div>  $trans = array( '&#91;' =&gt; '&#091;', '&#93;' =&gt; '&#093;' );&nbsp;</div></li><li><div>  $content = strtr( $content, $trans );&nbsp;</div></li><li><div>  $trans = array( '[' =&gt; '&#91;', ']' =&gt; '&#93;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pattern = get_shortcode_regex( $tagnames );&nbsp;</div></li><li><div>  $textarr = wp_html_split( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $textarr as &$element ) {&nbsp;</div></li><li><div>      if ( '' == $element || '&lt;' !== $element[0] ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $noopen = false === strpos( $element, '[' );&nbsp;</div></li><li><div>      $noclose = false === strpos( $element, ']' );&nbsp;</div></li><li><div>      if ( $noopen || $noclose ) {&nbsp;</div></li><li><div>          <span class="comment">// This element does not contain shortcodes.</span>&nbsp;</div></li><li><div>          if ( $noopen xor $noclose ) {&nbsp;</div></li><li><div>              <span class="comment">// Need to encode stray [ or ] chars.</span>&nbsp;</div></li><li><div>              $element = strtr( $element, $trans );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $ignore_html || '&lt;!--' === substr( $element, 0, 4 ) || '&lt;![CDATA[' === substr( $element, 0, 9 ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Encode all [ and ] chars.</span>&nbsp;</div></li><li><div>          $element = strtr( $element, $trans );&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attributes = wp_kses_attr_parse( $element );&nbsp;</div></li><li><div>      if ( false === $attributes ) {&nbsp;</div></li><li><div>          <span class="comment">// Some plugins are doing things like [name] &lt;[email]&gt;.</span>&nbsp;</div></li><li><div>          if ( 1 === preg_match( '%^&lt;\s*\[\[?[^\[\]]+\]%', $element ) ) {&nbsp;</div></li><li><div>              $element = preg_replace_callback( &quot;/$pattern/&quot;, 'do_shortcode_tag', $element );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Looks like we found some crazy unfiltered HTML.  Skipping it for sanity.</span>&nbsp;</div></li><li><div>          $element = strtr( $element, $trans );&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get element name</span>&nbsp;</div></li><li><div>      $front = array_shift( $attributes );&nbsp;</div></li><li><div>      $back = array_pop( $attributes );&nbsp;</div></li><li><div>      $matches = array();&nbsp;</div></li><li><div>      preg_match('%[a-zA-Z0-9]+%', $front, $matches);&nbsp;</div></li><li><div>      $elname = $matches[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Look for shortcodes in each attribute separately.</span>&nbsp;</div></li><li><div>      foreach ( $attributes as &$attr ) {&nbsp;</div></li><li><div>          $open = strpos( $attr, '[' );&nbsp;</div></li><li><div>          $close = strpos( $attr, ']' );&nbsp;</div></li><li><div>          if ( false === $open || false === $close ) {&nbsp;</div></li><li><div>              continue; <span class="comment">// Go to next attribute.  Square braces will be escaped at end of loop.</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $double = strpos( $attr, '&quot;' );&nbsp;</div></li><li><div>          $single = strpos( $attr, &quot;'&quot; );&nbsp;</div></li><li><div>          if ( ( false === $single || $open &lt; $single ) && ( false === $double || $open &lt; $double ) ) {&nbsp;</div></li><li><div>              <span class="comment">// $attr like '[shortcode]' or 'name = [shortcode]' implies unfiltered_html.</span>&nbsp;</div></li><li><div>              <span class="comment">// In this specific situation we assume KSES did not run because the input</span>&nbsp;</div></li><li><div>              <span class="comment">// was written by an administrator, so we should avoid changing the output</span>&nbsp;</div></li><li><div>              <span class="comment">// and we do not need to run KSES here.</span>&nbsp;</div></li><li><div>              $attr = preg_replace_callback( &quot;/$pattern/&quot;, 'do_shortcode_tag', $attr );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// $attr like 'name = &quot;[shortcode]&quot;' or &quot;name = '[shortcode]'&quot;</span>&nbsp;</div></li><li><div>              <span class="comment">// We do not know if $content was unfiltered. Assume KSES ran before shortcodes.</span>&nbsp;</div></li><li><div>              $count = 0;&nbsp;</div></li><li><div>              $new_attr = preg_replace_callback( &quot;/$pattern/&quot;, 'do_shortcode_tag', $attr, -1, $count );&nbsp;</div></li><li><div>              if ( $count &gt; 0 ) {&nbsp;</div></li><li><div>                  <span class="comment">// Sanitize the shortcode output using KSES.</span>&nbsp;</div></li><li><div>                  $new_attr = wp_kses_one_attr( $new_attr, $elname );&nbsp;</div></li><li><div>                  if ( '' !== trim( $new_attr ) ) {&nbsp;</div></li><li><div>                      <span class="comment">// The shortcode is safe to use now.</span>&nbsp;</div></li><li><div>                      $attr = $new_attr;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $element = $front . implode( '', $attributes ) . $back;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Now encode any remaining [ or ] chars.</span>&nbsp;</div></li><li><div>      $element = strtr( $element, $trans );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content = implode( '', $textarr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $content;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove placeholders added by do_shortcodes_in_html_tags().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Content to search for placeholders.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Content with placeholders removed.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function unescape_invalid_shortcodes( $content ) {&nbsp;</div></li><li><div>      <span class="comment">// Clean up entire string, avoids re-parsing HTML.</span>&nbsp;</div></li><li><div>      $trans = array( '&#91;' =&gt; '[', '&#93;' =&gt; ']' );&nbsp;</div></li><li><div>      $content = strtr( $content, $trans );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the shortcode attributes regex.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The shortcode attribute regular expression</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_shortcode_atts_regex() {&nbsp;</div></li><li><div>  return '/([\w-]+)\s*=\s*&quot;([^&quot;]*)&quot;(?:\s|$)|([\w-]+)\s*=\s*\'([^\']*)\'(?:\s|$)|([\w-]+)\s*=\s*([^\s\'&quot;]+)(?:\s|$)|&quot;([^&quot;]*)&quot;(?:\s|$)|(\S+)(?:\s|$)/';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve all attributes from the shortcodes tag.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The attributes list has the attribute name as the key and the value of the</span>&nbsp;</div></li><li><div><span class="comment"> * attribute as the value in the key/value pair. This allows for easier</span>&nbsp;</div></li><li><div><span class="comment"> * retrieval of the attributes, since all attributes have to be known.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|string List of attribute values.</span>&nbsp;</div></li><li><div><span class="comment"> *                      Returns empty array if trim( $text ) == '&quot;&quot;'.</span>&nbsp;</div></li><li><div><span class="comment"> *                      Returns empty string if trim( $text ) == ''.</span>&nbsp;</div></li><li><div><span class="comment"> *                      All other matches are checked for not empty().</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function shortcode_parse_atts($text) {&nbsp;</div></li><li><div>  $atts = array();&nbsp;</div></li><li><div>  $pattern = get_shortcode_atts_regex();&nbsp;</div></li><li><div>  $text = preg_replace(&quot;/[\x{00a0}\x{200b}]+/u&quot;, &quot; &quot;, $text);&nbsp;</div></li><li><div>  if ( preg_match_all($pattern, $text, $match, PREG_SET_ORDER) ) {&nbsp;</div></li><li><div>      foreach ($match as $m) {&nbsp;</div></li><li><div>          if (!empty($m[1]))&nbsp;</div></li><li><div>              $atts[strtolower($m[1])] = stripcslashes($m[2]);&nbsp;</div></li><li><div>          elseif (!empty($m[3]))&nbsp;</div></li><li><div>              $atts[strtolower($m[3])] = stripcslashes($m[4]);&nbsp;</div></li><li><div>          elseif (!empty($m[5]))&nbsp;</div></li><li><div>              $atts[strtolower($m[5])] = stripcslashes($m[6]);&nbsp;</div></li><li><div>          elseif (isset($m[7]) && strlen($m[7]))&nbsp;</div></li><li><div>              $atts[] = stripcslashes($m[7]);&nbsp;</div></li><li><div>          elseif (isset($m[8]))&nbsp;</div></li><li><div>              $atts[] = stripcslashes($m[8]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Reject any unclosed HTML elements</span>&nbsp;</div></li><li><div>      foreach( $atts as &$value ) {&nbsp;</div></li><li><div>          if ( false !== strpos( $value, '&lt;' ) ) {&nbsp;</div></li><li><div>              if ( 1 !== preg_match( '/^[^&lt;]*+(?:&lt;[^&gt;]*+&gt;[^&lt;]*+)*+$/', $value ) ) {&nbsp;</div></li><li><div>                  $value = '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $atts = ltrim($text);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $atts;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Combine user attributes with known attributes and fill in defaults when needed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The pairs should be considered to be all of the attributes which are</span>&nbsp;</div></li><li><div><span class="comment"> * supported by the caller and given as a list. The returned attributes will</span>&nbsp;</div></li><li><div><span class="comment"> * only contain the attributes in the $pairs list.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the $atts list has unsupported attributes, then they will be ignored and</span>&nbsp;</div></li><li><div><span class="comment"> * removed from the final returned list.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $pairs     Entire list of supported attributes and their defaults.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $atts      User defined attributes in shortcode tag.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $shortcode Optional. The name of the shortcode, provided for context to enable filtering</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Combined and filtered attribute list.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function shortcode_atts( $pairs, $atts, $shortcode = '' ) {&nbsp;</div></li><li><div>  $atts = (array)$atts;&nbsp;</div></li><li><div>  $out = array();&nbsp;</div></li><li><div>  foreach ($pairs as $name =&gt; $default) {&nbsp;</div></li><li><div>      if ( array_key_exists($name, $atts) )&nbsp;</div></li><li><div>          $out[$name] = $atts[$name];&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $out[$name] = $default;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a shortcode's default attributes.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the third parameter of the shortcode_atts() function is present then this filter is available.</span>&nbsp;</div></li><li><div><span class="comment">   * The third parameter, $shortcode, is the name of the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 Added the `$shortcode` parameter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $out       The output array of shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $pairs     The supported attributes and their defaults.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $atts      The user defined shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $shortcode The shortcode name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( $shortcode ) {&nbsp;</div></li><li><div>      $out = apply_filters( &quot;shortcode_atts_{$shortcode}&quot;, $out, $pairs, $atts, $shortcode );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $out;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove all shortcode tags from the given content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $shortcode_tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Content to remove shortcode tags.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Content without shortcode tags.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function strip_shortcodes( $content ) {&nbsp;</div></li><li><div>  global $shortcode_tags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === strpos( $content, '[' ) ) {&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (empty($shortcode_tags) || !is_array($shortcode_tags))&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Find all registered tag names in $content.</span></span>&nbsp;</div></li><li><div>  preg_match_all( '@\[([^&lt;&gt;&/\[\]\x00-\x20=]++)@', $content, $matches );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tags_to_remove = array_keys( $shortcode_tags );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of shortcode tags to remove from the content.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $tag_array Array of shortcode tags to remove.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content   Content shortcodes are being removed from.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $tags_to_remove = apply_filters( 'strip_shortcodes_tagnames', $tags_to_remove, $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tagnames = array_intersect( $tags_to_remove, $matches[1] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $tagnames ) ) {&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content = do_shortcodes_in_html_tags( $content, true, $tagnames );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pattern = get_shortcode_regex( $tagnames );&nbsp;</div></li><li><div>  $content = preg_replace_callback( &quot;/$pattern/&quot;, 'strip_shortcode_tag', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Always restore square braces so we don't break things like &lt;!--[if IE ]&gt;</span></span>&nbsp;</div></li><li><div>  $content = unescape_invalid_shortcodes( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $content;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Strips a shortcode tag based on RegEx matches against post content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $m RegEx matches against post content.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|false The content stripped of the tag, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function strip_shortcode_tag( $m ) {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// allow [[foo]] syntax for escaping a tag</span></span>&nbsp;</div></li><li><div>  if ( $m[1] == '[' && $m[6] == ']' ) {&nbsp;</div></li><li><div>      return substr($m[0], 1, -1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $m[1] . $m[6];&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>