<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7" data-type="file" data-id="4693"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-class-wp-query | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=c9a6960f64e08f4ee416e50cd62543d7' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-class-wp-query/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-class-wp-query%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-class-wp-query%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-file-wp-includes-class-wp-query","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-class-wp-query" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-class-wp-query</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/class-wp-query.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Query API: WP_Query class</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Query</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * The WordPress Query class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @link https://codex.wordpress.org/Function_Reference/WP_Query Codex page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.5.0 Removed the `$comments_popup` property.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class WP_Query {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Query vars set by the user</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Query vars, after parsing</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $query_vars = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Taxonomy query, as passed to get_tax_sql()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var object WP_Tax_Query</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $tax_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Metadata query container</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var object WP_Meta_Query</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $meta_query = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Date query container</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var object WP_Date_Query</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $date_query = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the data for a single object that is queried.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the contents of a post, page, category, attachment.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var object|array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $queried_object;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The ID of the queried object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $queried_object_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get post database query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.1</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $request;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * List of posts.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $posts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The amount of posts for the current query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $post_count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Index of the current item in the loop.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $current_post = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether the loop has started and the caller is in the loop.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $in_the_loop = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The current post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var WP_Post</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The list of comments for current post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $comments;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The amount of comments for the posts.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $comment_count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The index of the comment in the comment loop.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $current_comment = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Current comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $comment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The amount of found posts for the current query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If limit clause was not used, equals $post_count.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $found_posts = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The amount of pages.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $max_num_pages = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The amount of comment pages.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $max_num_comment_pages = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is single post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_single = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is preview of blog.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_preview = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query returns a page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_page = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is an archive list.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_archive = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is part of a date.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_date = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains a year.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_year = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains a month.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_month = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains a day.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_day = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains time.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_time = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains an author.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_author = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains category.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_category = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains tag.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_tag = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains taxonomy.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_tax = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query was part of a search result.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_search = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is feed display.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_feed = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is comment feed display.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_comment_feed = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is trackback.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_trackback = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is blog homepage.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_home = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query couldn't found anything.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_404 = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is embed.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_embed = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is paged</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_paged = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is part of administration page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_admin = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is an attachment.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_attachment = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if is single, is a page, or is an attachment.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_singular = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is for robots.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_robots = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query contains posts.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Basically, the homepage if the option isn't set for the static homepage.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_posts_page = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if query is for a post type archive.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $is_post_type_archive = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Stores the -&gt;query_vars state like md5(serialize( $this-&gt;query_vars ) ) so we know</span>&nbsp;</div></li><li><div><span class="comment">   * whether we have to re-parse because something has changed</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool|string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $query_vars_hash = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether query vars have changed since the initial parse_query() call. Used to catch modifications to query vars made</span>&nbsp;</div></li><li><div><span class="comment">   * via pre_get_posts hooks.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.1</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $query_vars_changed = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set if post thumbnails are cached</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>   public $thumbnails_cached = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Cached list of search stopwords.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $stopwords;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $compat_fields = array( 'query_vars_hash', 'query_vars_changed' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $compat_methods = array( 'init_query_flags', 'parse_tax_query' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Resets query flags to false.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The query flags are what page info WordPress was able to figure out.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function init_query_flags() {&nbsp;</div></li><li><div>      $this-&gt;is_single = false;&nbsp;</div></li><li><div>      $this-&gt;is_preview = false;&nbsp;</div></li><li><div>      $this-&gt;is_page = false;&nbsp;</div></li><li><div>      $this-&gt;is_archive = false;&nbsp;</div></li><li><div>      $this-&gt;is_date = false;&nbsp;</div></li><li><div>      $this-&gt;is_year = false;&nbsp;</div></li><li><div>      $this-&gt;is_month = false;&nbsp;</div></li><li><div>      $this-&gt;is_day = false;&nbsp;</div></li><li><div>      $this-&gt;is_time = false;&nbsp;</div></li><li><div>      $this-&gt;is_author = false;&nbsp;</div></li><li><div>      $this-&gt;is_category = false;&nbsp;</div></li><li><div>      $this-&gt;is_tag = false;&nbsp;</div></li><li><div>      $this-&gt;is_tax = false;&nbsp;</div></li><li><div>      $this-&gt;is_search = false;&nbsp;</div></li><li><div>      $this-&gt;is_feed = false;&nbsp;</div></li><li><div>      $this-&gt;is_comment_feed = false;&nbsp;</div></li><li><div>      $this-&gt;is_trackback = false;&nbsp;</div></li><li><div>      $this-&gt;is_home = false;&nbsp;</div></li><li><div>      $this-&gt;is_404 = false;&nbsp;</div></li><li><div>      $this-&gt;is_paged = false;&nbsp;</div></li><li><div>      $this-&gt;is_admin = false;&nbsp;</div></li><li><div>      $this-&gt;is_attachment = false;&nbsp;</div></li><li><div>      $this-&gt;is_singular = false;&nbsp;</div></li><li><div>      $this-&gt;is_robots = false;&nbsp;</div></li><li><div>      $this-&gt;is_posts_page = false;&nbsp;</div></li><li><div>      $this-&gt;is_post_type_archive = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Initiates object properties and sets default values.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function init() {&nbsp;</div></li><li><div>      unset($this-&gt;posts);&nbsp;</div></li><li><div>      unset($this-&gt;query);&nbsp;</div></li><li><div>      $this-&gt;query_vars = array();&nbsp;</div></li><li><div>      unset($this-&gt;queried_object);&nbsp;</div></li><li><div>      unset($this-&gt;queried_object_id);&nbsp;</div></li><li><div>      $this-&gt;post_count = 0;&nbsp;</div></li><li><div>      $this-&gt;current_post = -1;&nbsp;</div></li><li><div>      $this-&gt;in_the_loop = false;&nbsp;</div></li><li><div>      unset( $this-&gt;request );&nbsp;</div></li><li><div>      unset( $this-&gt;post );&nbsp;</div></li><li><div>      unset( $this-&gt;comments );&nbsp;</div></li><li><div>      unset( $this-&gt;comment );&nbsp;</div></li><li><div>      $this-&gt;comment_count = 0;&nbsp;</div></li><li><div>      $this-&gt;current_comment = -1;&nbsp;</div></li><li><div>      $this-&gt;found_posts = 0;&nbsp;</div></li><li><div>      $this-&gt;max_num_pages = 0;&nbsp;</div></li><li><div>      $this-&gt;max_num_comment_pages = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;init_query_flags();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Reparse the query vars.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function parse_query_vars() {&nbsp;</div></li><li><div>      $this-&gt;parse_query();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fills in the query variables, which do not exist within the parameter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 Removed the `comments_popup` public query variable.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $array Defined query variables.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Complete query variables with undefined ones filled in empty.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function fill_query_vars($array) {&nbsp;</div></li><li><div>      $keys = array(&nbsp;</div></li><li><div>          'error'&nbsp;</div></li><li><div> , 'm'&nbsp;</div></li><li><div> , 'p'&nbsp;</div></li><li><div> , 'post_parent'&nbsp;</div></li><li><div> , 'subpost'&nbsp;</div></li><li><div> , 'subpost_id'&nbsp;</div></li><li><div> , 'attachment'&nbsp;</div></li><li><div> , 'attachment_id'&nbsp;</div></li><li><div> , 'name'&nbsp;</div></li><li><div> , 'static'&nbsp;</div></li><li><div> , 'pagename'&nbsp;</div></li><li><div> , 'page_id'&nbsp;</div></li><li><div> , 'second'&nbsp;</div></li><li><div> , 'minute'&nbsp;</div></li><li><div> , 'hour'&nbsp;</div></li><li><div> , 'day'&nbsp;</div></li><li><div> , 'monthnum'&nbsp;</div></li><li><div> , 'year'&nbsp;</div></li><li><div> , 'w'&nbsp;</div></li><li><div> , 'category_name'&nbsp;</div></li><li><div> , 'tag'&nbsp;</div></li><li><div> , 'cat'&nbsp;</div></li><li><div> , 'tag_id'&nbsp;</div></li><li><div> , 'author'&nbsp;</div></li><li><div> , 'author_name'&nbsp;</div></li><li><div> , 'feed'&nbsp;</div></li><li><div> , 'tb'&nbsp;</div></li><li><div> , 'paged'&nbsp;</div></li><li><div> , 'meta_key'&nbsp;</div></li><li><div> , 'meta_value'&nbsp;</div></li><li><div> , 'preview'&nbsp;</div></li><li><div> , 's'&nbsp;</div></li><li><div> , 'sentence'&nbsp;</div></li><li><div> , 'title'&nbsp;</div></li><li><div> , 'fields'&nbsp;</div></li><li><div> , 'menu_order'&nbsp;</div></li><li><div> , 'embed'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $keys as $key ) {&nbsp;</div></li><li><div>          if ( !isset($array[$key]) )&nbsp;</div></li><li><div>              $array[$key] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $array_keys = array( 'category__in', 'category__not_in', 'category__and', 'post__in', 'post__not_in', 'post_name__in', &nbsp;</div></li><li><div>          'tag__in', 'tag__not_in', 'tag__and', 'tag_slug__in', 'tag_slug__and', 'post_parent__in', 'post_parent__not_in', &nbsp;</div></li><li><div>          'author__in', 'author__not_in' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $array_keys as $key ) {&nbsp;</div></li><li><div>          if ( !isset($array[$key]) )&nbsp;</div></li><li><div>              $array[$key] = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $array;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Parse a query string and set query type booleans.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0 Introduced the ability to order by specific clauses of a `$meta_query`, by passing the clause's</span>&nbsp;</div></li><li><div><span class="comment">   *              array key to `$orderby`.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 Introduced `$post_name__in` and `$title` parameters. `$s` was updated to support excluded</span>&nbsp;</div></li><li><div><span class="comment">   *              search terms, by prepending a hyphen.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.5.0 Removed the `$comments_popup` parameter.</span>&nbsp;</div></li><li><div><span class="comment">   *              Introduced the `$comment_status` and `$ping_status` parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *              Introduced `RAND(x)` syntax for `$orderby`, which allows an integer seed value to random sorts.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.6.0 Added 'post_name__in' support for `$orderby`. Introduced the `$lazy_load_term_meta` argument.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $query {</span>&nbsp;</div></li><li><div><span class="comment">   *     Optional. Array or string of Query parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $attachment_id           Attachment post ID. Used for 'attachment' post_type.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int|string   $author                  Author ID, or comma-separated list of IDs.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $author_name             User 'user_nicename'.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $author__in              An array of author IDs to query from.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $author__not_in          An array of author IDs not to query from.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $cache_results           Whether to cache post information. Default true.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int|string   $cat                     Category ID or comma-separated list of IDs (this or any children).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $category__and           An array of category IDs (AND in).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $category__in            An array of category IDs (OR in, no children).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $category__not_in        An array of category IDs (NOT in).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $category_name           Use category slug (not name, this or any children).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $comment_status          Comment status.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $comments_per_page       The number of comments to return per page.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 Default 'comments_per_page' option.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $date_query              An associative array of WP_Date_Query arguments.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 See WP_Date_Query::__construct().</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $day                     Day of the month. Default empty. Accepts numbers 1-31.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $exact                   Whether to search by exact keyword. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string|array $fields                  Which fields to return. Single field or all fields (string), </span>&nbsp;</div></li><li><div><span class="comment">   *                                                 or array of fields. 'id=&gt;parent' uses 'id' and 'post_parent'.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 Default all fields. Accepts 'ids', 'id=&gt;parent'.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $hour                    Hour of the day. Default empty. Accepts numbers 0-23.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int|bool     $ignore_sticky_posts     Whether to ignore sticky posts or not. Setting this to false</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 excludes stickies from 'post__in'. Accepts 1|true, 0|false.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 Default 0|false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $m                       Combination YearMonth. Accepts any four-digit year and month</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 numbers 1-12. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $meta_compare            Comparison operator to test the 'meta_value'.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $meta_key                Custom field key.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $meta_query              An associative array of WP_Meta_Query arguments. See WP_Meta_Query.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $meta_value              Custom field value.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $meta_value_num          Custom field value number.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $menu_order              The menu order of the posts.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $monthnum                The two-digit month. Default empty. Accepts numbers 1-12.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $name                    Post slug.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $nopaging                Show all posts (true) or paginate (false). Default false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $no_found_rows           Whether to skip counting the total rows found. Enabling can improve</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 performance. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $offset                  The number of posts to offset before retrieval.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $order                   Designates ascending or descending order of posts. Default 'DESC'.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 Accepts 'ASC', 'DESC'.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string|array $orderby                 Sort retrieved posts by parameter. One or more options may be</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 passed. To use 'meta_value', or 'meta_value_num', </span>&nbsp;</div></li><li><div><span class="comment">   *                                                 'meta_key=keyname' must be also be defined. To sort by a</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 specific `$meta_query` clause, use that clause's array key.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 Default 'date'. Accepts 'none', 'name', 'author', 'date', </span>&nbsp;</div></li><li><div><span class="comment">   *                                                 'title', 'modified', 'menu_order', 'parent', 'ID', 'rand', </span>&nbsp;</div></li><li><div><span class="comment">   *                                                 'RAND(x)' (where 'x' is an integer seed value), </span>&nbsp;</div></li><li><div><span class="comment">   *                                                 'comment_count', 'meta_value', 'meta_value_num', 'post__in', </span>&nbsp;</div></li><li><div><span class="comment">   *                                                 'post_name__in', 'post_parent__in', and the array keys</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 of `$meta_query`.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $p                       Post ID.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $page                    Show the number of posts that would show up on page X of a</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 static front page.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $paged                   The number of the current page.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $page_id                 Page ID.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $pagename                Page slug.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $perm                    Show posts if user has the appropriate capability.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $ping_status             Ping status.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $post__in                An array of post IDs to retrieve, sticky posts will be included</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $post_mime_type          The mime type of the post. Used for 'attachment' post_type.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $post__not_in            An array of post IDs not to retrieve. Note: a string of comma-</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 separated IDs will NOT work.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $post_parent             Page ID to retrieve child pages for. Use 0 to only retrieve</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 top-level pages.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $post_parent__in         An array containing parent page IDs to query child pages from.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $post_parent__not_in     An array containing parent page IDs not to query child pages from.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string|array $post_type               A post type slug (string) or array of post type slugs.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 Default 'any' if using 'tax_query'.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string|array $post_status             A post status (string) or array of post statuses.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $posts_per_page          The number of posts to query for. Use -1 to request all posts.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $posts_per_archive_page  The number of posts to query for by archive page. Overrides</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 'posts_per_page' when is_archive(), or is_search() are true.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $post_name__in           An array of post slugs that results must match.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $s                       Search keyword(s). Prepending a term with a hyphen will</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 exclude posts matching that term. Eg, 'pillow -sofa' will</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 return posts containing 'pillow' but not 'sofa'. The</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 character used for exclusion can be modified using the</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 the 'wp_query_search_exclusion_prefix' filter.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $second                  Second of the minute. Default empty. Accepts numbers 0-60.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $sentence                Whether to search by phrase. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $suppress_filters        Whether to suppress filters. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $tag                     Tag slug. Comma-separated (either), Plus-separated (all).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $tag__and                An array of tag ids (AND in).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $tag__in                 An array of tag ids (OR in).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $tag__not_in             An array of tag ids (NOT in).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $tag_id                  Tag id or comma-separated list of IDs.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $tag_slug__and           An array of tag slugs (AND in).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $tag_slug__in            An array of tag slugs (OR in). unless 'ignore_sticky_posts' is</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 true. Note: a string of comma-separated IDs will NOT work.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $tax_query               An associative array of WP_Tax_Query arguments.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 See WP_Tax_Query-&gt;queries.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $title                   Post title.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $update_post_meta_cache  Whether to update the post meta cache. Default true.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $update_post_term_cache  Whether to update the post term cache. Default true.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $lazy_load_term_meta     Whether to lazy-load term meta. Setting to false will</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 disable cache priming for term meta, so that each</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 get_term_meta() call will hit the database.</span>&nbsp;</div></li><li><div><span class="comment">   *                                                 Defaults to the value of `$update_post_term_cache`.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $w                       The week number of the year. Default empty. Accepts numbers 0-53.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $year                    The four-digit year. Default empty. Accepts any four-digit year.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function parse_query( $query =  '' ) {&nbsp;</div></li><li><div>      if ( ! empty( $query ) ) {&nbsp;</div></li><li><div>          $this-&gt;init();&nbsp;</div></li><li><div>          $this-&gt;query = $this-&gt;query_vars = wp_parse_args( $query );&nbsp;</div></li><li><div>      } elseif ( ! isset( $this-&gt;query ) ) {&nbsp;</div></li><li><div>          $this-&gt;query = $this-&gt;query_vars;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;query_vars = $this-&gt;fill_query_vars($this-&gt;query_vars);&nbsp;</div></li><li><div>      $qv = &$this-&gt;query_vars;&nbsp;</div></li><li><div>      $this-&gt;query_vars_changed = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty($qv['robots']) )&nbsp;</div></li><li><div>          $this-&gt;is_robots = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_scalar( $qv['p'] ) || $qv['p'] &lt; 0 ) {&nbsp;</div></li><li><div>          $qv['p'] = 0;&nbsp;</div></li><li><div>          $qv['error'] = '404';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $qv['p'] = intval( $qv['p'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $qv['page_id'] =  absint($qv['page_id']);&nbsp;</div></li><li><div>      $qv['year'] = absint($qv['year']);&nbsp;</div></li><li><div>      $qv['monthnum'] = absint($qv['monthnum']);&nbsp;</div></li><li><div>      $qv['day'] = absint($qv['day']);&nbsp;</div></li><li><div>      $qv['w'] = absint($qv['w']);&nbsp;</div></li><li><div>      $qv['m'] = is_scalar( $qv['m'] ) ? preg_replace( '|[^0-9]|', '', $qv['m'] ) : '';&nbsp;</div></li><li><div>      $qv['paged'] = absint($qv['paged']);&nbsp;</div></li><li><div>      $qv['cat'] = preg_replace( '|[^0-9, -]|', '', $qv['cat'] ); <span class="comment"><span class="comment">// comma separated list of positive or negative integers</span></span>&nbsp;</div></li><li><div>      $qv['author'] = preg_replace( '|[^0-9, -]|', '', $qv['author'] ); <span class="comment"><span class="comment">// comma separated list of positive or negative integers</span></span>&nbsp;</div></li><li><div>      $qv['pagename'] = trim( $qv['pagename'] );&nbsp;</div></li><li><div>      $qv['name'] = trim( $qv['name'] );&nbsp;</div></li><li><div>      $qv['title'] = trim( $qv['title'] );&nbsp;</div></li><li><div>      if ( '' !== $qv['hour'] ) $qv['hour'] = absint($qv['hour']);&nbsp;</div></li><li><div>      if ( '' !== $qv['minute'] ) $qv['minute'] = absint($qv['minute']);&nbsp;</div></li><li><div>      if ( '' !== $qv['second'] ) $qv['second'] = absint($qv['second']);&nbsp;</div></li><li><div>      if ( '' !== $qv['menu_order'] ) $qv['menu_order'] = absint($qv['menu_order']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fairly insane upper bound for search string lengths.</span>&nbsp;</div></li><li><div>      if ( ! is_scalar( $qv['s'] ) || ( ! empty( $qv['s'] ) && strlen( $qv['s'] ) &gt; 1600 ) ) {&nbsp;</div></li><li><div>          $qv['s'] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Compat. Map subpost to attachment.</span>&nbsp;</div></li><li><div>      if ( '' != $qv['subpost'] )&nbsp;</div></li><li><div>          $qv['attachment'] = $qv['subpost'];&nbsp;</div></li><li><div>      if ( '' != $qv['subpost_id'] )&nbsp;</div></li><li><div>          $qv['attachment_id'] = $qv['subpost_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $qv['attachment_id'] = absint($qv['attachment_id']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ('' != $qv['attachment']) || !empty($qv['attachment_id']) ) {&nbsp;</div></li><li><div>          $this-&gt;is_single = true;&nbsp;</div></li><li><div>          $this-&gt;is_attachment = true;&nbsp;</div></li><li><div>      } elseif ( '' != $qv['name'] ) {&nbsp;</div></li><li><div>          $this-&gt;is_single = true;&nbsp;</div></li><li><div>      } elseif ( $qv['p'] ) {&nbsp;</div></li><li><div>          $this-&gt;is_single = true;&nbsp;</div></li><li><div>      } elseif ( ('' !== $qv['hour']) && ('' !== $qv['minute']) &&('' !== $qv['second']) && ('' != $qv['year']) && ('' != $qv['monthnum']) && ('' != $qv['day']) ) {&nbsp;</div></li><li><div>          <span class="comment">// If year, month, day, hour, minute, and second are set, a single</span>&nbsp;</div></li><li><div>          <span class="comment">// post is being queried.</span>&nbsp;</div></li><li><div>          $this-&gt;is_single = true;&nbsp;</div></li><li><div>      } elseif ( '' != $qv['static'] || '' != $qv['pagename'] || !empty($qv['page_id']) ) {&nbsp;</div></li><li><div>          $this-&gt;is_page = true;&nbsp;</div></li><li><div>          $this-&gt;is_single = false;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// Look for archive queries. Dates, categories, authors, search, post type archives.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $this-&gt;query['s'] ) ) {&nbsp;</div></li><li><div>              $this-&gt;is_search = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( '' !== $qv['second'] ) {&nbsp;</div></li><li><div>              $this-&gt;is_time = true;&nbsp;</div></li><li><div>              $this-&gt;is_date = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( '' !== $qv['minute'] ) {&nbsp;</div></li><li><div>              $this-&gt;is_time = true;&nbsp;</div></li><li><div>              $this-&gt;is_date = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( '' !== $qv['hour'] ) {&nbsp;</div></li><li><div>              $this-&gt;is_time = true;&nbsp;</div></li><li><div>              $this-&gt;is_date = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $qv['day'] ) {&nbsp;</div></li><li><div>              if ( ! $this-&gt;is_date ) {&nbsp;</div></li><li><div>                  $date = sprintf( '%04d-%02d-%02d', $qv['year'], $qv['monthnum'], $qv['day'] );&nbsp;</div></li><li><div>                  if ( $qv['monthnum'] && $qv['year'] && ! wp_checkdate( $qv['monthnum'], $qv['day'], $qv['year'], $date ) ) {&nbsp;</div></li><li><div>                      $qv['error'] = '404';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;is_day = true;&nbsp;</div></li><li><div>                      $this-&gt;is_date = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $qv['monthnum'] ) {&nbsp;</div></li><li><div>              if ( ! $this-&gt;is_date ) {&nbsp;</div></li><li><div>                  if ( 12 &lt; $qv['monthnum'] ) {&nbsp;</div></li><li><div>                      $qv['error'] = '404';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;is_month = true;&nbsp;</div></li><li><div>                      $this-&gt;is_date = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $qv['year'] ) {&nbsp;</div></li><li><div>              if ( ! $this-&gt;is_date ) {&nbsp;</div></li><li><div>                  $this-&gt;is_year = true;&nbsp;</div></li><li><div>                  $this-&gt;is_date = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $qv['m'] ) {&nbsp;</div></li><li><div>              $this-&gt;is_date = true;&nbsp;</div></li><li><div>              if ( strlen($qv['m']) &gt; 9 ) {&nbsp;</div></li><li><div>                  $this-&gt;is_time = true;&nbsp;</div></li><li><div>              } elseif ( strlen( $qv['m'] ) &gt; 7 ) {&nbsp;</div></li><li><div>                  $this-&gt;is_day = true;&nbsp;</div></li><li><div>              } elseif ( strlen( $qv['m'] ) &gt; 5 ) {&nbsp;</div></li><li><div>                  $this-&gt;is_month = true;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;is_year = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( '' != $qv['w'] ) {&nbsp;</div></li><li><div>              $this-&gt;is_date = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;query_vars_hash = false;&nbsp;</div></li><li><div>          $this-&gt;parse_tax_query( $qv );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;tax_query-&gt;queries as $tax_query ) {&nbsp;</div></li><li><div>              if ( ! is_array( $tax_query ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $tax_query['operator'] ) && 'NOT IN' != $tax_query['operator'] ) {&nbsp;</div></li><li><div>                  switch ( $tax_query['taxonomy'] ) {&nbsp;</div></li><li><div>                      case 'category':&nbsp;</div></li><li><div>                          $this-&gt;is_category = true;&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'post_tag':&nbsp;</div></li><li><div>                          $this-&gt;is_tag = true;&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      default:&nbsp;</div></li><li><div>                          $this-&gt;is_tax = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $tax_query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty($qv['author']) || ($qv['author'] == '0') ) {&nbsp;</div></li><li><div>              $this-&gt;is_author = false;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;is_author = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( '' != $qv['author_name'] )&nbsp;</div></li><li><div>              $this-&gt;is_author = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !empty( $qv['post_type'] ) && ! is_array( $qv['post_type'] ) ) {&nbsp;</div></li><li><div>              $post_type_obj = get_post_type_object( $qv['post_type'] );&nbsp;</div></li><li><div>              if ( ! empty( $post_type_obj-&gt;has_archive ) )&nbsp;</div></li><li><div>                  $this-&gt;is_post_type_archive = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;is_post_type_archive || $this-&gt;is_date || $this-&gt;is_author || $this-&gt;is_category || $this-&gt;is_tag || $this-&gt;is_tax )&nbsp;</div></li><li><div>              $this-&gt;is_archive = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' != $qv['feed'] )&nbsp;</div></li><li><div>          $this-&gt;is_feed = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' != $qv['embed'] ) {&nbsp;</div></li><li><div>          $this-&gt;is_embed = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' != $qv['tb'] )&nbsp;</div></li><li><div>          $this-&gt;is_trackback = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' != $qv['paged'] && ( intval($qv['paged']) &gt; 1 ) )&nbsp;</div></li><li><div>          $this-&gt;is_paged = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// if we're previewing inside the write screen</span>&nbsp;</div></li><li><div>      if ( '' != $qv['preview'] )&nbsp;</div></li><li><div>          $this-&gt;is_preview = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_admin() )&nbsp;</div></li><li><div>          $this-&gt;is_admin = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( false !== strpos($qv['feed'], 'comments-') ) {&nbsp;</div></li><li><div>          $qv['feed'] = str_replace('comments-', '', $qv['feed']);&nbsp;</div></li><li><div>          $qv['withcomments'] = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;is_singular = $this-&gt;is_single || $this-&gt;is_page || $this-&gt;is_attachment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;is_feed && ( !empty($qv['withcomments']) || ( empty($qv['withoutcomments']) && $this-&gt;is_singular ) ) )&nbsp;</div></li><li><div>          $this-&gt;is_comment_feed = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !( $this-&gt;is_singular || $this-&gt;is_archive || $this-&gt;is_search || $this-&gt;is_feed || ( defined( 'REST_REQUEST' ) && REST_REQUEST ) || $this-&gt;is_trackback || $this-&gt;is_404 || $this-&gt;is_admin || $this-&gt;is_robots ) )&nbsp;</div></li><li><div>          $this-&gt;is_home = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Correct is_* for page_on_front and page_for_posts</span>&nbsp;</div></li><li><div>      if ( $this-&gt;is_home && 'page' == get_option('show_on_front') && get_option('page_on_front') ) {&nbsp;</div></li><li><div>          $_query = wp_parse_args($this-&gt;query);&nbsp;</div></li><li><div>          <span class="comment">// pagename can be set and empty depending on matched rewrite rules. Ignore an empty pagename.</span>&nbsp;</div></li><li><div>          if ( isset($_query['pagename']) && '' == $_query['pagename'] )&nbsp;</div></li><li><div>              unset($_query['pagename']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          unset( $_query['embed'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty($_query) || !array_diff( array_keys($_query), array('preview', 'page', 'paged', 'cpage') ) ) {&nbsp;</div></li><li><div>              $this-&gt;is_page = true;&nbsp;</div></li><li><div>              $this-&gt;is_home = false;&nbsp;</div></li><li><div>              $qv['page_id'] = get_option('page_on_front');&nbsp;</div></li><li><div>              <span class="comment">// Correct &lt;!--nextpage--&gt; for page_on_front</span>&nbsp;</div></li><li><div>              if ( !empty($qv['paged']) ) {&nbsp;</div></li><li><div>                  $qv['page'] = $qv['paged'];&nbsp;</div></li><li><div>                  unset($qv['paged']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' != $qv['pagename'] ) {&nbsp;</div></li><li><div>          $this-&gt;queried_object = get_page_by_path( $qv['pagename'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;queried_object && 'attachment' == $this-&gt;queried_object-&gt;post_type ) {&nbsp;</div></li><li><div>              if ( preg_match( &quot;/^[^%]*%(?:postname)%/&quot;, get_option( 'permalink_structure' ) ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// See if we also have a post with the same slug</span>&nbsp;</div></li><li><div>                  $post = get_page_by_path( $qv['pagename'], OBJECT, 'post' );&nbsp;</div></li><li><div>                  if ( $post ) {&nbsp;</div></li><li><div>                      $this-&gt;queried_object = $post;&nbsp;</div></li><li><div>                      $this-&gt;is_page = false;&nbsp;</div></li><li><div>                      $this-&gt;is_single = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;queried_object ) ) {&nbsp;</div></li><li><div>              $this-&gt;queried_object_id = (int) $this-&gt;queried_object-&gt;ID;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              unset( $this-&gt;queried_object );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if  ( 'page' == get_option('show_on_front') && isset($this-&gt;queried_object_id) && $this-&gt;queried_object_id == get_option('page_for_posts') ) {&nbsp;</div></li><li><div>              $this-&gt;is_page = false;&nbsp;</div></li><li><div>              $this-&gt;is_home = true;&nbsp;</div></li><li><div>              $this-&gt;is_posts_page = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $qv['page_id'] ) {&nbsp;</div></li><li><div>          if  ( 'page' == get_option('show_on_front') && $qv['page_id'] == get_option('page_for_posts') ) {&nbsp;</div></li><li><div>              $this-&gt;is_page = false;&nbsp;</div></li><li><div>              $this-&gt;is_home = true;&nbsp;</div></li><li><div>              $this-&gt;is_posts_page = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($qv['post_type']) ) {&nbsp;</div></li><li><div>          if ( is_array($qv['post_type']) )&nbsp;</div></li><li><div>              $qv['post_type'] = array_map('sanitize_key', $qv['post_type']);&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $qv['post_type'] = sanitize_key($qv['post_type']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $qv['post_status'] ) ) {&nbsp;</div></li><li><div>          if ( is_array( $qv['post_status'] ) )&nbsp;</div></li><li><div>              $qv['post_status'] = array_map('sanitize_key', $qv['post_status']);&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $qv['post_status'] = preg_replace('|[^a-z0-9_, -]|', '', $qv['post_status']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;is_posts_page && ( ! isset($qv['withcomments']) || ! $qv['withcomments'] ) )&nbsp;</div></li><li><div>          $this-&gt;is_comment_feed = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;is_singular = $this-&gt;is_single || $this-&gt;is_page || $this-&gt;is_attachment;&nbsp;</div></li><li><div>      <span class="comment">// Done correcting is_* for page_on_front and page_for_posts</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '404' == $qv['error'] )&nbsp;</div></li><li><div>          $this-&gt;set_404();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;is_embed = $this-&gt;is_embed && ( $this-&gt;is_singular || $this-&gt;is_404 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;query_vars_hash = md5( serialize( $this-&gt;query_vars ) );&nbsp;</div></li><li><div>      $this-&gt;query_vars_changed = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the main query vars have been parsed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action_ref_array( 'parse_query', array( &$this ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Parses various taxonomy related query vars.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * For BC, this method is not marked as protected. See [28987].</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $q The query variables. Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function parse_tax_query( &$q ) {&nbsp;</div></li><li><div>      if ( ! empty( $q['tax_query'] ) && is_array( $q['tax_query'] ) ) {&nbsp;</div></li><li><div>          $tax_query = $q['tax_query'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tax_query = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($q['taxonomy']) && !empty($q['term']) ) {&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; $q['taxonomy'], &nbsp;</div></li><li><div>              'terms' =&gt; array( $q['term'] ), &nbsp;</div></li><li><div>              'field' =&gt; 'slug', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( get_taxonomies( array() , 'objects' ) as $taxonomy =&gt; $t ) {&nbsp;</div></li><li><div>          if ( 'post_tag' == $taxonomy )&nbsp;</div></li><li><div>              continue;    <span class="comment">// Handled further down in the $q['tag'] block</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $t-&gt;query_var && !empty( $q[$t-&gt;query_var] ) ) {&nbsp;</div></li><li><div>              $tax_query_defaults = array(&nbsp;</div></li><li><div>                  'taxonomy' =&gt; $taxonomy, &nbsp;</div></li><li><div>                  'field' =&gt; 'slug', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>               if ( isset( $t-&gt;rewrite['hierarchical'] ) && $t-&gt;rewrite['hierarchical'] ) {&nbsp;</div></li><li><div>                  $q[$t-&gt;query_var] = wp_basename( $q[$t-&gt;query_var] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $term = $q[$t-&gt;query_var];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_array( $term ) ) {&nbsp;</div></li><li><div>                  $term = implode( ', ', $term );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( strpos($term, '+') !== false ) {&nbsp;</div></li><li><div>                  $terms = preg_split( '/[+]+/', $term );&nbsp;</div></li><li><div>                  foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                      $tax_query[] = array_merge( $tax_query_defaults, array(&nbsp;</div></li><li><div>                          'terms' =&gt; array( $term )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tax_query[] = array_merge( $tax_query_defaults, array(&nbsp;</div></li><li><div>                      'terms' =&gt; preg_split( '/[, ]+/', $term )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If querystring 'cat' is an array, implode it.</span>&nbsp;</div></li><li><div>      if ( is_array( $q['cat'] ) ) {&nbsp;</div></li><li><div>          $q['cat'] = implode( ', ', $q['cat'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Category stuff</span>&nbsp;</div></li><li><div>      if ( ! empty( $q['cat'] ) && ! $this-&gt;is_singular ) {&nbsp;</div></li><li><div>          $cat_in = $cat_not_in = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $cat_array = preg_split( '/[, \s]+/', urldecode( $q['cat'] ) );&nbsp;</div></li><li><div>          $cat_array = array_map( 'intval', $cat_array );&nbsp;</div></li><li><div>          $q['cat'] = implode( ', ', $cat_array );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $cat_array as $cat ) {&nbsp;</div></li><li><div>              if ( $cat &gt; 0 )&nbsp;</div></li><li><div>                  $cat_in[] = $cat;&nbsp;</div></li><li><div>              elseif ( $cat &lt; 0 )&nbsp;</div></li><li><div>                  $cat_not_in[] = abs( $cat );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $cat_in ) ) {&nbsp;</div></li><li><div>              $tax_query[] = array(&nbsp;</div></li><li><div>                  'taxonomy' =&gt; 'category', &nbsp;</div></li><li><div>                  'terms' =&gt; $cat_in, &nbsp;</div></li><li><div>                  'field' =&gt; 'term_id', &nbsp;</div></li><li><div>                  'include_children' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $cat_not_in ) ) {&nbsp;</div></li><li><div>              $tax_query[] = array(&nbsp;</div></li><li><div>                  'taxonomy' =&gt; 'category', &nbsp;</div></li><li><div>                  'terms' =&gt; $cat_not_in, &nbsp;</div></li><li><div>                  'field' =&gt; 'term_id', &nbsp;</div></li><li><div>                  'operator' =&gt; 'NOT IN', &nbsp;</div></li><li><div>                  'include_children' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $cat_array, $cat_in, $cat_not_in );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $q['category__and'] ) && 1 === count( (array) $q['category__and'] ) ) {&nbsp;</div></li><li><div>          $q['category__and'] = (array) $q['category__and'];&nbsp;</div></li><li><div>          if ( ! isset( $q['category__in'] ) )&nbsp;</div></li><li><div>              $q['category__in'] = array();&nbsp;</div></li><li><div>          $q['category__in'][] = absint( reset( $q['category__and'] ) );&nbsp;</div></li><li><div>          unset( $q['category__and'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $q['category__in'] ) ) {&nbsp;</div></li><li><div>          $q['category__in'] = array_map( 'absint', array_unique( (array) $q['category__in'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'category', &nbsp;</div></li><li><div>              'terms' =&gt; $q['category__in'], &nbsp;</div></li><li><div>              'field' =&gt; 'term_id', &nbsp;</div></li><li><div>              'include_children' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty($q['category__not_in']) ) {&nbsp;</div></li><li><div>          $q['category__not_in'] = array_map( 'absint', array_unique( (array) $q['category__not_in'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'category', &nbsp;</div></li><li><div>              'terms' =&gt; $q['category__not_in'], &nbsp;</div></li><li><div>              'operator' =&gt; 'NOT IN', &nbsp;</div></li><li><div>              'include_children' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty($q['category__and']) ) {&nbsp;</div></li><li><div>          $q['category__and'] = array_map( 'absint', array_unique( (array) $q['category__and'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'category', &nbsp;</div></li><li><div>              'terms' =&gt; $q['category__and'], &nbsp;</div></li><li><div>              'field' =&gt; 'term_id', &nbsp;</div></li><li><div>              'operator' =&gt; 'AND', &nbsp;</div></li><li><div>              'include_children' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If querystring 'tag' is array, implode it.</span>&nbsp;</div></li><li><div>      if ( is_array( $q['tag'] ) ) {&nbsp;</div></li><li><div>          $q['tag'] = implode( ', ', $q['tag'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Tag stuff</span>&nbsp;</div></li><li><div>      if ( '' != $q['tag'] && !$this-&gt;is_singular && $this-&gt;query_vars_changed ) {&nbsp;</div></li><li><div>          if ( strpos($q['tag'], ', ') !== false ) {&nbsp;</div></li><li><div>              $tags = preg_split('/[, \r\n\t ]+/', $q['tag']);&nbsp;</div></li><li><div>              foreach ( (array) $tags as $tag ) {&nbsp;</div></li><li><div>                  $tag = sanitize_term_field('slug', $tag, 0, 'post_tag', 'db');&nbsp;</div></li><li><div>                  $q['tag_slug__in'][] = $tag;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( preg_match('/[+\r\n\t ]+/', $q['tag'] ) || ! empty( $q['cat'] ) ) {&nbsp;</div></li><li><div>              $tags = preg_split('/[+\r\n\t ]+/', $q['tag']);&nbsp;</div></li><li><div>              foreach ( (array) $tags as $tag ) {&nbsp;</div></li><li><div>                  $tag = sanitize_term_field('slug', $tag, 0, 'post_tag', 'db');&nbsp;</div></li><li><div>                  $q['tag_slug__and'][] = $tag;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $q['tag'] = sanitize_term_field('slug', $q['tag'], 0, 'post_tag', 'db');&nbsp;</div></li><li><div>              $q['tag_slug__in'][] = $q['tag'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($q['tag_id']) ) {&nbsp;</div></li><li><div>          $q['tag_id'] = absint( $q['tag_id'] );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'post_tag', &nbsp;</div></li><li><div>              'terms' =&gt; $q['tag_id']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($q['tag__in']) ) {&nbsp;</div></li><li><div>          $q['tag__in'] = array_map('absint', array_unique( (array) $q['tag__in'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'post_tag', &nbsp;</div></li><li><div>              'terms' =&gt; $q['tag__in']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($q['tag__not_in']) ) {&nbsp;</div></li><li><div>          $q['tag__not_in'] = array_map('absint', array_unique( (array) $q['tag__not_in'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'post_tag', &nbsp;</div></li><li><div>              'terms' =&gt; $q['tag__not_in'], &nbsp;</div></li><li><div>              'operator' =&gt; 'NOT IN'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($q['tag__and']) ) {&nbsp;</div></li><li><div>          $q['tag__and'] = array_map('absint', array_unique( (array) $q['tag__and'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'post_tag', &nbsp;</div></li><li><div>              'terms' =&gt; $q['tag__and'], &nbsp;</div></li><li><div>              'operator' =&gt; 'AND'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($q['tag_slug__in']) ) {&nbsp;</div></li><li><div>          $q['tag_slug__in'] = array_map('sanitize_title_for_query', array_unique( (array) $q['tag_slug__in'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'post_tag', &nbsp;</div></li><li><div>              'terms' =&gt; $q['tag_slug__in'], &nbsp;</div></li><li><div>              'field' =&gt; 'slug'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($q['tag_slug__and']) ) {&nbsp;</div></li><li><div>          $q['tag_slug__and'] = array_map('sanitize_title_for_query', array_unique( (array) $q['tag_slug__and'] ) );&nbsp;</div></li><li><div>          $tax_query[] = array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'post_tag', &nbsp;</div></li><li><div>              'terms' =&gt; $q['tag_slug__and'], &nbsp;</div></li><li><div>              'field' =&gt; 'slug', &nbsp;</div></li><li><div>              'operator' =&gt; 'AND'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tax_query = new WP_Tax_Query( $tax_query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after taxonomy-related query vars have been parsed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Query $this The WP_Query instance.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'parse_tax_query', $this );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generate SQL for the WHERE clause based on passed search terms.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $q Query variables.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string WHERE clause.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function parse_search( &$q ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $search = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// added slashes screw with quote grouping when done early, so done later</span>&nbsp;</div></li><li><div>      $q['s'] = stripslashes( $q['s'] );&nbsp;</div></li><li><div>      if ( empty( $_GET['s'] ) && $this-&gt;is_main_query() )&nbsp;</div></li><li><div>          $q['s'] = urldecode( $q['s'] );&nbsp;</div></li><li><div>      <span class="comment">// there are no line breaks in &lt;input /&gt; fields</span>&nbsp;</div></li><li><div>      $q['s'] = str_replace( array( &quot;\r&quot;, &quot;\n&quot; ), '', $q['s'] );&nbsp;</div></li><li><div>      $q['search_terms_count'] = 1;&nbsp;</div></li><li><div>      if ( ! empty( $q['sentence'] ) ) {&nbsp;</div></li><li><div>          $q['search_terms'] = array( $q['s'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( preg_match_all( '/&quot;.*?(&quot;|$)|((?&lt;=[\t &quot;, +])|^)[^\t &quot;, +]+/', $q['s'], $matches ) ) {&nbsp;</div></li><li><div>              $q['search_terms_count'] = count( $matches[0] );&nbsp;</div></li><li><div>              $q['search_terms'] = $this-&gt;parse_search_terms( $matches[0] );&nbsp;</div></li><li><div>              <span class="comment">// if the search string has only short terms or stopwords, or is 10+ terms long, match it as sentence</span>&nbsp;</div></li><li><div>              if ( empty( $q['search_terms'] ) || count( $q['search_terms'] ) &gt; 9 )&nbsp;</div></li><li><div>                  $q['search_terms'] = array( $q['s'] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $q['search_terms'] = array( $q['s'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $n = ! empty( $q['exact'] ) ? '' : '%';&nbsp;</div></li><li><div>      $searchand = '';&nbsp;</div></li><li><div>      $q['search_orderby_title'] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the prefix that indicates that a search term should be excluded from results.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $exclusion_prefix The prefix. Default '-'. Returning</span>&nbsp;</div></li><li><div><span class="comment">       *                                 an empty value disables exclusions.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $exclusion_prefix = apply_filters( 'wp_query_search_exclusion_prefix', '-' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $q['search_terms'] as $term ) {&nbsp;</div></li><li><div>          <span class="comment">// If there is an $exclusion_prefix, terms prefixed with it should be excluded.</span>&nbsp;</div></li><li><div>          $exclude = $exclusion_prefix && ( $exclusion_prefix === substr( $term, 0, 1 ) );&nbsp;</div></li><li><div>          if ( $exclude ) {&nbsp;</div></li><li><div>              $like_op = 'NOT LIKE';&nbsp;</div></li><li><div>              $andor_op = 'AND';&nbsp;</div></li><li><div>              $term = substr( $term, 1 );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $like_op = 'LIKE';&nbsp;</div></li><li><div>              $andor_op = 'OR';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $n && ! $exclude ) {&nbsp;</div></li><li><div>              $like = '%' . $wpdb-&gt;esc_like( $term ) . '%';&nbsp;</div></li><li><div>              $q['search_orderby_title'][] = $wpdb-&gt;prepare( &quot;{$wpdb-&gt;posts}.post_title LIKE %s&quot;, $like );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $like = $n . $wpdb-&gt;esc_like( $term ) . $n;&nbsp;</div></li><li><div>          $search .= $wpdb-&gt;prepare( &quot;{$searchand}(({$wpdb-&gt;posts}.post_title $like_op %s) $andor_op ({$wpdb-&gt;posts}.post_excerpt $like_op %s) $andor_op ({$wpdb-&gt;posts}.post_content $like_op %s))&quot;, $like, $like, $like );&nbsp;</div></li><li><div>          $searchand = ' AND ';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $search ) ) {&nbsp;</div></li><li><div>          $search = &quot; AND ({$search}) &quot;;&nbsp;</div></li><li><div>          if ( ! is_user_logged_in() ) {&nbsp;</div></li><li><div>              $search .= &quot; AND ({$wpdb-&gt;posts}.post_password = '') &quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $search;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if the terms are suitable for searching.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Uses an array of stopwords (terms) that are excluded from the separate</span>&nbsp;</div></li><li><div><span class="comment">   * term matching when searching for posts. The list of English stopwords is</span>&nbsp;</div></li><li><div><span class="comment">   * the approximate search engines list, and is translatable.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $terms Terms to check.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Terms that are not stopwords.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function parse_search_terms( $terms ) {&nbsp;</div></li><li><div>      $strtolower = function_exists( 'mb_strtolower' ) ? 'mb_strtolower' : 'strtolower';&nbsp;</div></li><li><div>      $checked = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $stopwords = $this-&gt;get_search_stopwords();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $terms as $term ) {&nbsp;</div></li><li><div>          <span class="comment">// keep before/after spaces when term is for exact match</span>&nbsp;</div></li><li><div>          if ( preg_match( '/^&quot;.+&quot;$/', $term ) )&nbsp;</div></li><li><div>              $term = trim( $term, &quot;\&quot;'&quot; );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $term = trim( $term, &quot;\&quot;' &quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Avoid single A-Z and single dashes.</span>&nbsp;</div></li><li><div>          if ( ! $term || ( 1 === strlen( $term ) && preg_match( '/^[a-z\-]$/i', $term ) ) )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( in_array( call_user_func( $strtolower, $term ), $stopwords, true ) )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $checked[] = $term;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $checked;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve stopwords used when parsing search terms.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Stopwords.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function get_search_stopwords() {&nbsp;</div></li><li><div>      if ( isset( $this-&gt;stopwords ) )&nbsp;</div></li><li><div>          return $this-&gt;stopwords;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** translators: This is a comma-separated list of very common words that should be excluded from a search, </span>&nbsp;</div></li><li><div><span class="comment">       * like a, an, and the. These are usually called &quot;stopwords&quot;. You should not simply translate these individual</span>&nbsp;</div></li><li><div><span class="comment">       * words into your language. Instead, look for and provide commonly accepted stopwords in your language.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $words = explode( ', ', _x( 'about, an, are, as, at, be, by, com, for, from, how, in, is, it, of, on, or, that, the, this, to, was, what, when, where, who, will, with, www', &nbsp;</div></li><li><div>          'Comma-separated list of search stopwords in your language' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $stopwords = array();&nbsp;</div></li><li><div>      foreach ( $words as $word ) {&nbsp;</div></li><li><div>          $word = trim( $word, &quot;\r\n\t &quot; );&nbsp;</div></li><li><div>          if ( $word )&nbsp;</div></li><li><div>              $stopwords[] = $word;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters stopwords used when parsing search terms.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $stopwords Stopwords.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $this-&gt;stopwords = apply_filters( 'wp_search_stopwords', $stopwords );&nbsp;</div></li><li><div>      return $this-&gt;stopwords;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generate SQL for the ORDER BY condition based on passed search terms.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $q Query variables.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string ORDER BY clause.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function parse_search_order( &$q ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $q['search_terms_count'] &gt; 1 ) {&nbsp;</div></li><li><div>          $num_terms = count( $q['search_orderby_title'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If the search terms contain negative queries, don't bother ordering by sentence matches.</span>&nbsp;</div></li><li><div>          $like = '';&nbsp;</div></li><li><div>          if ( ! preg_match( '/(?:\s|^)\-/', $q['s'] ) ) {&nbsp;</div></li><li><div>              $like = '%' . $wpdb-&gt;esc_like( $q['s'] ) . '%';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $search_orderby = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// sentence match in 'post_title'</span>&nbsp;</div></li><li><div>          if ( $like ) {&nbsp;</div></li><li><div>              $search_orderby .= $wpdb-&gt;prepare( &quot;WHEN {$wpdb-&gt;posts}.post_title LIKE %s THEN 1 &quot;, $like );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// sanity limit, sort as sentence when more than 6 terms</span>&nbsp;</div></li><li><div>          <span class="comment">// (few searches are longer than 6 terms and most titles are not)</span>&nbsp;</div></li><li><div>          if ( $num_terms &lt; 7 ) {&nbsp;</div></li><li><div>              <span class="comment">// all words in title</span>&nbsp;</div></li><li><div>              $search_orderby .= 'WHEN ' . implode( ' AND ', $q['search_orderby_title'] ) . ' THEN 2 ';&nbsp;</div></li><li><div>              <span class="comment">// any word in title, not needed when $num_terms == 1</span>&nbsp;</div></li><li><div>              if ( $num_terms &gt; 1 )&nbsp;</div></li><li><div>                  $search_orderby .= 'WHEN ' . implode( ' OR ', $q['search_orderby_title'] ) . ' THEN 3 ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Sentence match in 'post_content' and 'post_excerpt'.</span>&nbsp;</div></li><li><div>          if ( $like ) {&nbsp;</div></li><li><div>              $search_orderby .= $wpdb-&gt;prepare( &quot;WHEN {$wpdb-&gt;posts}.post_excerpt LIKE %s THEN 4 &quot;, $like );&nbsp;</div></li><li><div>              $search_orderby .= $wpdb-&gt;prepare( &quot;WHEN {$wpdb-&gt;posts}.post_content LIKE %s THEN 5 &quot;, $like );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $search_orderby ) {&nbsp;</div></li><li><div>              $search_orderby = '(CASE ' . $search_orderby . 'ELSE 6 END)';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// single word or sentence search</span>&nbsp;</div></li><li><div>          $search_orderby = reset( $q['search_orderby_title'] ) . ' DESC';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $search_orderby;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * If the passed orderby value is allowed, convert the alias to a</span>&nbsp;</div></li><li><div><span class="comment">   * properly-prefixed orderby value.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $orderby Alias for the field to order by.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|false Table-prefixed value to used in the ORDER clause. False otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function parse_orderby( $orderby ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Used to filter values.</span>&nbsp;</div></li><li><div>      $allowed_keys = array(&nbsp;</div></li><li><div>          'post_name', 'post_author', 'post_date', 'post_title', 'post_modified', &nbsp;</div></li><li><div>          'post_parent', 'post_type', 'name', 'author', 'date', 'title', 'modified', &nbsp;</div></li><li><div>          'parent', 'type', 'ID', 'menu_order', 'comment_count', 'rand', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $primary_meta_key = '';&nbsp;</div></li><li><div>      $primary_meta_query = false;&nbsp;</div></li><li><div>      $meta_clauses = $this-&gt;meta_query-&gt;get_clauses();&nbsp;</div></li><li><div>      if ( ! empty( $meta_clauses ) ) {&nbsp;</div></li><li><div>          $primary_meta_query = reset( $meta_clauses );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $primary_meta_query['key'] ) ) {&nbsp;</div></li><li><div>              $primary_meta_key = $primary_meta_query['key'];&nbsp;</div></li><li><div>              $allowed_keys[] = $primary_meta_key;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $allowed_keys[] = 'meta_value';&nbsp;</div></li><li><div>          $allowed_keys[] = 'meta_value_num';&nbsp;</div></li><li><div>          $allowed_keys = array_merge( $allowed_keys, array_keys( $meta_clauses ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If RAND() contains a seed value, sanitize and add to allowed keys.</span>&nbsp;</div></li><li><div>      $rand_with_seed = false;&nbsp;</div></li><li><div>      if ( preg_match( '/RAND\(([0-9]+)\)/i', $orderby, $matches ) ) {&nbsp;</div></li><li><div>          $orderby = sprintf( 'RAND(%s)', intval( $matches[1] ) );&nbsp;</div></li><li><div>          $allowed_keys[] = $orderby;&nbsp;</div></li><li><div>          $rand_with_seed = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! in_array( $orderby, $allowed_keys, true ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $orderby ) {&nbsp;</div></li><li><div>          case 'post_name':&nbsp;</div></li><li><div>          case 'post_author':&nbsp;</div></li><li><div>          case 'post_date':&nbsp;</div></li><li><div>          case 'post_title':&nbsp;</div></li><li><div>          case 'post_modified':&nbsp;</div></li><li><div>          case 'post_parent':&nbsp;</div></li><li><div>          case 'post_type':&nbsp;</div></li><li><div>          case 'ID':&nbsp;</div></li><li><div>          case 'menu_order':&nbsp;</div></li><li><div>          case 'comment_count':&nbsp;</div></li><li><div>              $orderby_clause = &quot;{$wpdb-&gt;posts}.{$orderby}&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'rand':&nbsp;</div></li><li><div>              $orderby_clause = 'RAND()';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case $primary_meta_key:&nbsp;</div></li><li><div>          case 'meta_value':&nbsp;</div></li><li><div>              if ( ! empty( $primary_meta_query['type'] ) ) {&nbsp;</div></li><li><div>                  $orderby_clause = &quot;CAST({$primary_meta_query['alias']}.meta_value AS {$primary_meta_query['cast']})&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $orderby_clause = &quot;{$primary_meta_query['alias']}.meta_value&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'meta_value_num':&nbsp;</div></li><li><div>              $orderby_clause = &quot;{$primary_meta_query['alias']}.meta_value+0&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              if ( array_key_exists( $orderby, $meta_clauses ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// $orderby corresponds to a meta_query clause.</span>&nbsp;</div></li><li><div>                  $meta_clause = $meta_clauses[ $orderby ];&nbsp;</div></li><li><div>                  $orderby_clause = &quot;CAST({$meta_clause['alias']}.meta_value AS {$meta_clause['cast']})&quot;;&nbsp;</div></li><li><div>              } elseif ( $rand_with_seed ) {&nbsp;</div></li><li><div>                  $orderby_clause = $orderby;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">// Default: order by post field.</span>&nbsp;</div></li><li><div>                  $orderby_clause = &quot;{$wpdb-&gt;posts}.post_&quot; . sanitize_key( $orderby );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $orderby_clause;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Parse an 'order' query variable and cast it to ASC or DESC as necessary.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $order The 'order' query variable.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The sanitized 'order' query variable.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function parse_order( $order ) {&nbsp;</div></li><li><div>      if ( ! is_string( $order ) || empty( $order ) ) {&nbsp;</div></li><li><div>          return 'DESC';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'ASC' === strtoupper( $order ) ) {&nbsp;</div></li><li><div>          return 'ASC';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return 'DESC';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Sets the 404 property and saves whether query is feed.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function set_404() {&nbsp;</div></li><li><div>      $is_feed = $this-&gt;is_feed;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;init_query_flags();&nbsp;</div></li><li><div>      $this-&gt;is_404 = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;is_feed = $is_feed;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve query variable.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.9.0 The `$default` argument was introduced.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $query_var Query variable key.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $default   Optional. Value to return if the query variable is not set. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed Contents of the query variable.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get( $query_var, $default = '' ) {&nbsp;</div></li><li><div>      if ( isset( $this-&gt;query_vars[ $query_var ] ) ) {&nbsp;</div></li><li><div>          return $this-&gt;query_vars[ $query_var ];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $default;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set query variable.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $query_var Query variable key.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     Query variable value.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function set($query_var, $value) {&nbsp;</div></li><li><div>      $this-&gt;query_vars[$query_var] = $value;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the posts based on query variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * There are a few filters and actions that can be used to modify the post</span>&nbsp;</div></li><li><div><span class="comment">   * database query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array List of posts.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_posts() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;parse_query();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the query variable object is created, but before the actual query is run.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Note: If using conditional tags, use the method versions within the passed instance</span>&nbsp;</div></li><li><div><span class="comment">       * (e.g. $this-&gt;is_main_query() instead of is_main_query()). This is because the functions</span>&nbsp;</div></li><li><div><span class="comment">       * like is_main_query() test against the global $wp_query instance, not the passed one.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action_ref_array( 'pre_get_posts', array( &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Shorthand.</span>&nbsp;</div></li><li><div>      $q = &$this-&gt;query_vars;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fill again in case pre_get_posts unset some vars.</span>&nbsp;</div></li><li><div>      $q = $this-&gt;fill_query_vars($q);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Parse meta query</span>&nbsp;</div></li><li><div>      $this-&gt;meta_query = new WP_Meta_Query();&nbsp;</div></li><li><div>      $this-&gt;meta_query-&gt;parse_query_vars( $q );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set a flag if a pre_get_posts hook changed the query vars.</span>&nbsp;</div></li><li><div>      $hash = md5( serialize( $this-&gt;query_vars ) );&nbsp;</div></li><li><div>      if ( $hash != $this-&gt;query_vars_hash ) {&nbsp;</div></li><li><div>          $this-&gt;query_vars_changed = true;&nbsp;</div></li><li><div>          $this-&gt;query_vars_hash = $hash;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset($hash);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// First let's clear some variables</span>&nbsp;</div></li><li><div>      $distinct = '';&nbsp;</div></li><li><div>      $whichauthor = '';&nbsp;</div></li><li><div>      $whichmimetype = '';&nbsp;</div></li><li><div>      $where = '';&nbsp;</div></li><li><div>      $limits = '';&nbsp;</div></li><li><div>      $join = '';&nbsp;</div></li><li><div>      $search = '';&nbsp;</div></li><li><div>      $groupby = '';&nbsp;</div></li><li><div>      $post_status_join = false;&nbsp;</div></li><li><div>      $page = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $q['caller_get_posts'] ) ) {&nbsp;</div></li><li><div>          _deprecated_argument( 'WP_Query', '3.1.0', __( '&quot;caller_get_posts&quot; is deprecated. Use &quot;ignore_sticky_posts&quot; instead.' ) );&nbsp;</div></li><li><div>          if ( !isset( $q['ignore_sticky_posts'] ) )&nbsp;</div></li><li><div>              $q['ignore_sticky_posts'] = $q['caller_get_posts'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset( $q['ignore_sticky_posts'] ) )&nbsp;</div></li><li><div>          $q['ignore_sticky_posts'] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset($q['suppress_filters']) )&nbsp;</div></li><li><div>          $q['suppress_filters'] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset($q['cache_results']) ) {&nbsp;</div></li><li><div>          if ( wp_using_ext_object_cache() )&nbsp;</div></li><li><div>              $q['cache_results'] = false;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $q['cache_results'] = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset($q['update_post_term_cache']) )&nbsp;</div></li><li><div>          $q['update_post_term_cache'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $q['lazy_load_term_meta'] ) ) {&nbsp;</div></li><li><div>          $q['lazy_load_term_meta'] = $q['update_post_term_cache'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset($q['update_post_meta_cache']) )&nbsp;</div></li><li><div>          $q['update_post_meta_cache'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset($q['post_type']) ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_search )&nbsp;</div></li><li><div>              $q['post_type'] = 'any';&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $q['post_type'] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $post_type = $q['post_type'];&nbsp;</div></li><li><div>      if ( empty( $q['posts_per_page'] ) ) {&nbsp;</div></li><li><div>          $q['posts_per_page'] = get_option( 'posts_per_page' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( isset($q['showposts']) && $q['showposts'] ) {&nbsp;</div></li><li><div>          $q['showposts'] = (int) $q['showposts'];&nbsp;</div></li><li><div>          $q['posts_per_page'] = $q['showposts'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( (isset($q['posts_per_archive_page']) && $q['posts_per_archive_page'] != 0) && ($this-&gt;is_archive || $this-&gt;is_search) )&nbsp;</div></li><li><div>          $q['posts_per_page'] = $q['posts_per_archive_page'];&nbsp;</div></li><li><div>      if ( !isset($q['nopaging']) ) {&nbsp;</div></li><li><div>          if ( $q['posts_per_page'] == -1 ) {&nbsp;</div></li><li><div>              $q['nopaging'] = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $q['nopaging'] = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;is_feed ) {&nbsp;</div></li><li><div>          <span class="comment">// This overrides posts_per_page.</span>&nbsp;</div></li><li><div>          if ( ! empty( $q['posts_per_rss'] ) ) {&nbsp;</div></li><li><div>              $q['posts_per_page'] = $q['posts_per_rss'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $q['posts_per_page'] = get_option( 'posts_per_rss' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $q['nopaging'] = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $q['posts_per_page'] = (int) $q['posts_per_page'];&nbsp;</div></li><li><div>      if ( $q['posts_per_page'] &lt; -1 )&nbsp;</div></li><li><div>          $q['posts_per_page'] = abs($q['posts_per_page']);&nbsp;</div></li><li><div>      elseif ( $q['posts_per_page'] == 0 )&nbsp;</div></li><li><div>          $q['posts_per_page'] = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset($q['comments_per_page']) || $q['comments_per_page'] == 0 )&nbsp;</div></li><li><div>          $q['comments_per_page'] = get_option('comments_per_page');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;is_home && (empty($this-&gt;query) || $q['preview'] == 'true') && ( 'page' == get_option('show_on_front') ) && get_option('page_on_front') ) {&nbsp;</div></li><li><div>          $this-&gt;is_page = true;&nbsp;</div></li><li><div>          $this-&gt;is_home = false;&nbsp;</div></li><li><div>          $q['page_id'] = get_option('page_on_front');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset($q['page']) ) {&nbsp;</div></li><li><div>          $q['page'] = trim($q['page'], '/');&nbsp;</div></li><li><div>          $q['page'] = absint($q['page']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If true, forcibly turns off SQL_CALC_FOUND_ROWS even when limits are present.</span>&nbsp;</div></li><li><div>      if ( isset($q['no_found_rows']) )&nbsp;</div></li><li><div>          $q['no_found_rows'] = (bool) $q['no_found_rows'];&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $q['no_found_rows'] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $q['fields'] ) {&nbsp;</div></li><li><div>          case 'ids':&nbsp;</div></li><li><div>              $fields = &quot;{$wpdb-&gt;posts}.ID&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'id=&gt;parent':&nbsp;</div></li><li><div>              $fields = &quot;{$wpdb-&gt;posts}.ID, {$wpdb-&gt;posts}.post_parent&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              $fields = &quot;{$wpdb-&gt;posts}.*&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' !== $q['menu_order'] ) {&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.menu_order = &quot; . $q['menu_order'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// The &quot;m&quot; parameter is meant for months but accepts datetimes of varying specificity</span>&nbsp;</div></li><li><div>      if ( $q['m'] ) {&nbsp;</div></li><li><div>          $where .= &quot; AND YEAR({$wpdb-&gt;posts}.post_date)=&quot; . substr($q['m'], 0, 4);&nbsp;</div></li><li><div>          if ( strlen($q['m']) &gt; 5 ) {&nbsp;</div></li><li><div>              $where .= &quot; AND MONTH({$wpdb-&gt;posts}.post_date)=&quot; . substr($q['m'], 4, 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( strlen($q['m']) &gt; 7 ) {&nbsp;</div></li><li><div>              $where .= &quot; AND DAYOFMONTH({$wpdb-&gt;posts}.post_date)=&quot; . substr($q['m'], 6, 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( strlen($q['m']) &gt; 9 ) {&nbsp;</div></li><li><div>              $where .= &quot; AND HOUR({$wpdb-&gt;posts}.post_date)=&quot; . substr($q['m'], 8, 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( strlen($q['m']) &gt; 11 ) {&nbsp;</div></li><li><div>              $where .= &quot; AND MINUTE({$wpdb-&gt;posts}.post_date)=&quot; . substr($q['m'], 10, 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( strlen($q['m']) &gt; 13 ) {&nbsp;</div></li><li><div>              $where .= &quot; AND SECOND({$wpdb-&gt;posts}.post_date)=&quot; . substr($q['m'], 12, 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Handle the other individual date parameters</span>&nbsp;</div></li><li><div>      $date_parameters = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' !== $q['hour'] )&nbsp;</div></li><li><div>          $date_parameters['hour'] = $q['hour'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' !== $q['minute'] )&nbsp;</div></li><li><div>          $date_parameters['minute'] = $q['minute'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' !== $q['second'] )&nbsp;</div></li><li><div>          $date_parameters['second'] = $q['second'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $q['year'] )&nbsp;</div></li><li><div>          $date_parameters['year'] = $q['year'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $q['monthnum'] )&nbsp;</div></li><li><div>          $date_parameters['monthnum'] = $q['monthnum'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $q['w'] )&nbsp;</div></li><li><div>          $date_parameters['week'] = $q['w'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $q['day'] )&nbsp;</div></li><li><div>          $date_parameters['day'] = $q['day'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $date_parameters ) {&nbsp;</div></li><li><div>          $date_query = new WP_Date_Query( array( $date_parameters ) );&nbsp;</div></li><li><div>          $where .= $date_query-&gt;get_sql();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $date_parameters, $date_query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Handle complex date queries</span>&nbsp;</div></li><li><div>      if ( ! empty( $q['date_query'] ) ) {&nbsp;</div></li><li><div>          $this-&gt;date_query = new WP_Date_Query( $q['date_query'] );&nbsp;</div></li><li><div>          $where .= $this-&gt;date_query-&gt;get_sql();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If we've got a post_type AND it's not &quot;any&quot; post_type.</span>&nbsp;</div></li><li><div>      if ( !empty($q['post_type']) && 'any' != $q['post_type'] ) {&nbsp;</div></li><li><div>          foreach ( (array)$q['post_type'] as $_post_type ) {&nbsp;</div></li><li><div>              $ptype_obj = get_post_type_object($_post_type);&nbsp;</div></li><li><div>              if ( !$ptype_obj || !$ptype_obj-&gt;query_var || empty($q[ $ptype_obj-&gt;query_var ]) )&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! $ptype_obj-&gt;hierarchical ) {&nbsp;</div></li><li><div>                  <span class="comment">// Non-hierarchical post types can directly use 'name'.</span>&nbsp;</div></li><li><div>                  $q['name'] = $q[ $ptype_obj-&gt;query_var ];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">// Hierarchical post types will operate through 'pagename'.</span>&nbsp;</div></li><li><div>                  $q['pagename'] = $q[ $ptype_obj-&gt;query_var ];&nbsp;</div></li><li><div>                  $q['name'] = '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Only one request for a slug is possible, this is why name & pagename are overwritten above.</span>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          } <span class="comment">//end foreach</span>&nbsp;</div></li><li><div>          unset($ptype_obj);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' !== $q['title'] ) {&nbsp;</div></li><li><div>          $where .= $wpdb-&gt;prepare( &quot; AND {$wpdb-&gt;posts}.post_title = %s&quot;, stripslashes( $q['title'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Parameters related to 'post_name'.</span>&nbsp;</div></li><li><div>      if ( '' != $q['name'] ) {&nbsp;</div></li><li><div>          $q['name'] = sanitize_title_for_query( $q['name'] );&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_name = '&quot; . $q['name'] . &quot;'&quot;;&nbsp;</div></li><li><div>      } elseif ( '' != $q['pagename'] ) {&nbsp;</div></li><li><div>          if ( isset($this-&gt;queried_object_id) ) {&nbsp;</div></li><li><div>              $reqpage = $this-&gt;queried_object_id;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( 'page' != $q['post_type'] ) {&nbsp;</div></li><li><div>                  foreach ( (array)$q['post_type'] as $_post_type ) {&nbsp;</div></li><li><div>                      $ptype_obj = get_post_type_object($_post_type);&nbsp;</div></li><li><div>                      if ( !$ptype_obj || !$ptype_obj-&gt;hierarchical )&nbsp;</div></li><li><div>                          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $reqpage = get_page_by_path($q['pagename'], OBJECT, $_post_type);&nbsp;</div></li><li><div>                      if ( $reqpage )&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  unset($ptype_obj);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $reqpage = get_page_by_path($q['pagename']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( !empty($reqpage) )&nbsp;</div></li><li><div>                  $reqpage = $reqpage-&gt;ID;&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $reqpage = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $page_for_posts = get_option('page_for_posts');&nbsp;</div></li><li><div>          if  ( ('page' != get_option('show_on_front') ) || empty($page_for_posts) || ( $reqpage != $page_for_posts ) ) {&nbsp;</div></li><li><div>              $q['pagename'] = sanitize_title_for_query( wp_basename( $q['pagename'] ) );&nbsp;</div></li><li><div>              $q['name'] = $q['pagename'];&nbsp;</div></li><li><div>              $where .= &quot; AND ({$wpdb-&gt;posts}.ID = '$reqpage')&quot;;&nbsp;</div></li><li><div>              $reqpage_obj = get_post( $reqpage );&nbsp;</div></li><li><div>              if ( is_object($reqpage_obj) && 'attachment' == $reqpage_obj-&gt;post_type ) {&nbsp;</div></li><li><div>                  $this-&gt;is_attachment = true;&nbsp;</div></li><li><div>                  $post_type = $q['post_type'] = 'attachment';&nbsp;</div></li><li><div>                  $this-&gt;is_page = true;&nbsp;</div></li><li><div>                  $q['attachment_id'] = $reqpage;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( '' != $q['attachment'] ) {&nbsp;</div></li><li><div>          $q['attachment'] = sanitize_title_for_query( wp_basename( $q['attachment'] ) );&nbsp;</div></li><li><div>          $q['name'] = $q['attachment'];&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_name = '&quot; . $q['attachment'] . &quot;'&quot;;&nbsp;</div></li><li><div>      } elseif ( is_array( $q['post_name__in'] ) && ! empty( $q['post_name__in'] ) ) {&nbsp;</div></li><li><div>          $q['post_name__in'] = array_map( 'sanitize_title_for_query', $q['post_name__in'] );&nbsp;</div></li><li><div>          $post_name__in = &quot;'&quot; . implode( &quot;', '&quot;, $q['post_name__in'] ) . &quot;'&quot;;&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_name IN ($post_name__in)&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If an attachment is requested by number, let it supersede any post number.</span>&nbsp;</div></li><li><div>      if ( $q['attachment_id'] )&nbsp;</div></li><li><div>          $q['p'] = absint($q['attachment_id']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If a post number is specified, load that post</span>&nbsp;</div></li><li><div>      if ( $q['p'] ) {&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.ID = &quot; . $q['p'];&nbsp;</div></li><li><div>      } elseif ( $q['post__in'] ) {&nbsp;</div></li><li><div>          $post__in = implode(', ', array_map( 'absint', $q['post__in'] ));&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.ID IN ($post__in)&quot;;&nbsp;</div></li><li><div>      } elseif ( $q['post__not_in'] ) {&nbsp;</div></li><li><div>          $post__not_in = implode(', ', array_map( 'absint', $q['post__not_in'] ));&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.ID NOT IN ($post__not_in)&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_numeric( $q['post_parent'] ) ) {&nbsp;</div></li><li><div>          $where .= $wpdb-&gt;prepare( &quot; AND {$wpdb-&gt;posts}.post_parent = %d &quot;, $q['post_parent'] );&nbsp;</div></li><li><div>      } elseif ( $q['post_parent__in'] ) {&nbsp;</div></li><li><div>          $post_parent__in = implode( ', ', array_map( 'absint', $q['post_parent__in'] ) );&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_parent IN ($post_parent__in)&quot;;&nbsp;</div></li><li><div>      } elseif ( $q['post_parent__not_in'] ) {&nbsp;</div></li><li><div>          $post_parent__not_in = implode( ', ', array_map( 'absint', $q['post_parent__not_in'] ) );&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_parent NOT IN ($post_parent__not_in)&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $q['page_id'] ) {&nbsp;</div></li><li><div>          if  ( ('page' != get_option('show_on_front') ) || ( $q['page_id'] != get_option('page_for_posts') ) ) {&nbsp;</div></li><li><div>              $q['p'] = $q['page_id'];&nbsp;</div></li><li><div>              $where = &quot; AND {$wpdb-&gt;posts}.ID = &quot; . $q['page_id'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If a search pattern is specified, load the posts that match.</span>&nbsp;</div></li><li><div>      if ( strlen( $q['s'] ) ) {&nbsp;</div></li><li><div>          $search = $this-&gt;parse_search( $q );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $q['suppress_filters'] ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the search SQL that is used in the WHERE clause of WP_Query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $search Search SQL for WHERE clause.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query $this   The current WP_Query object.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $search = apply_filters_ref_array( 'posts_search', array( $search, &$this ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Taxonomies</span>&nbsp;</div></li><li><div>      if ( !$this-&gt;is_singular ) {&nbsp;</div></li><li><div>          $this-&gt;parse_tax_query( $q );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $clauses = $this-&gt;tax_query-&gt;get_sql( $wpdb-&gt;posts, 'ID' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $join .= $clauses['join'];&nbsp;</div></li><li><div>          $where .= $clauses['where'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;is_tax ) {&nbsp;</div></li><li><div>          if ( empty($post_type) ) {&nbsp;</div></li><li><div>              <span class="comment">// Do a fully inclusive search for currently registered post types of queried taxonomies</span>&nbsp;</div></li><li><div>              $post_type = array();&nbsp;</div></li><li><div>              $taxonomies = array_keys( $this-&gt;tax_query-&gt;queried_terms );&nbsp;</div></li><li><div>              foreach ( get_post_types( array( 'exclude_from_search' =&gt; false ) ) as $pt ) {&nbsp;</div></li><li><div>                  $object_taxonomies = $pt === 'attachment' ? get_taxonomies_for_attachments() : get_object_taxonomies( $pt );&nbsp;</div></li><li><div>                  if ( array_intersect( $taxonomies, $object_taxonomies ) )&nbsp;</div></li><li><div>                      $post_type[] = $pt;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! $post_type )&nbsp;</div></li><li><div>                  $post_type = 'any';&nbsp;</div></li><li><div>              elseif ( count( $post_type ) == 1 )&nbsp;</div></li><li><div>                  $post_type = $post_type[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $post_status_join = true;&nbsp;</div></li><li><div>          } elseif ( in_array('attachment', (array) $post_type) ) {&nbsp;</div></li><li><div>              $post_status_join = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Ensure that 'taxonomy', 'term', 'term_id', 'cat', and</span>&nbsp;</div></li><li><div><span class="comment">       * 'category_name' vars are set for backward compatibility.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;tax_query-&gt;queried_terms ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Set 'taxonomy', 'term', and 'term_id' to the</span>&nbsp;</div></li><li><div><span class="comment">           * first taxonomy other than 'post_tag' or 'category'.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( ! isset( $q['taxonomy'] ) ) {&nbsp;</div></li><li><div>              foreach ( $this-&gt;tax_query-&gt;queried_terms as $queried_taxonomy =&gt; $queried_items ) {&nbsp;</div></li><li><div>                  if ( empty( $queried_items['terms'][0] ) ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! in_array( $queried_taxonomy, array( 'category', 'post_tag' ) ) ) {&nbsp;</div></li><li><div>                      $q['taxonomy'] = $queried_taxonomy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( 'slug' === $queried_items['field'] ) {&nbsp;</div></li><li><div>                          $q['term'] = $queried_items['terms'][0];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $q['term_id'] = $queried_items['terms'][0];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Take the first one we find.</span>&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// 'cat', 'category_name', 'tag_id'</span>&nbsp;</div></li><li><div>          foreach ( $this-&gt;tax_query-&gt;queried_terms as $queried_taxonomy =&gt; $queried_items ) {&nbsp;</div></li><li><div>              if ( empty( $queried_items['terms'][0] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'category' === $queried_taxonomy ) {&nbsp;</div></li><li><div>                  $the_cat = get_term_by( $queried_items['field'], $queried_items['terms'][0], 'category' );&nbsp;</div></li><li><div>                  if ( $the_cat ) {&nbsp;</div></li><li><div>                      $this-&gt;set( 'cat', $the_cat-&gt;term_id );&nbsp;</div></li><li><div>                      $this-&gt;set( 'category_name', $the_cat-&gt;slug );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  unset( $the_cat );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'post_tag' === $queried_taxonomy ) {&nbsp;</div></li><li><div>                  $the_tag = get_term_by( $queried_items['field'], $queried_items['terms'][0], 'post_tag' );&nbsp;</div></li><li><div>                  if ( $the_tag ) {&nbsp;</div></li><li><div>                      $this-&gt;set( 'tag_id', $the_tag-&gt;term_id );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  unset( $the_tag );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $this-&gt;tax_query-&gt;queries ) || !empty( $this-&gt;meta_query-&gt;queries ) ) {&nbsp;</div></li><li><div>          $groupby = &quot;{$wpdb-&gt;posts}.ID&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Author/user stuff</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $q['author'] ) && $q['author'] != '0' ) {&nbsp;</div></li><li><div>          $q['author'] = addslashes_gpc( '' . urldecode( $q['author'] ) );&nbsp;</div></li><li><div>          $authors = array_unique( array_map( 'intval', preg_split( '/[, \s]+/', $q['author'] ) ) );&nbsp;</div></li><li><div>          foreach ( $authors as $author ) {&nbsp;</div></li><li><div>              $key = $author &gt; 0 ? 'author__in' : 'author__not_in';&nbsp;</div></li><li><div>              $q[$key][] = abs( $author );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $q['author'] = implode( ', ', $authors );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $q['author__not_in'] ) ) {&nbsp;</div></li><li><div>          $author__not_in = implode( ', ', array_map( 'absint', array_unique( (array) $q['author__not_in'] ) ) );&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_author NOT IN ($author__not_in) &quot;;&nbsp;</div></li><li><div>      } elseif ( ! empty( $q['author__in'] ) ) {&nbsp;</div></li><li><div>          $author__in = implode( ', ', array_map( 'absint', array_unique( (array) $q['author__in'] ) ) );&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_author IN ($author__in) &quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Author stuff for nice URLs</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' != $q['author_name'] ) {&nbsp;</div></li><li><div>          if ( strpos($q['author_name'], '/') !== false ) {&nbsp;</div></li><li><div>              $q['author_name'] = explode('/', $q['author_name']);&nbsp;</div></li><li><div>              if ( $q['author_name'][ count($q['author_name'])-1 ] ) {&nbsp;</div></li><li><div>                  $q['author_name'] = $q['author_name'][count($q['author_name'])-1]; <span class="comment">// no trailing slash</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $q['author_name'] = $q['author_name'][count($q['author_name'])-2]; <span class="comment">// there was a trailing slash</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $q['author_name'] = sanitize_title_for_query( $q['author_name'] );&nbsp;</div></li><li><div>          $q['author'] = get_user_by('slug', $q['author_name']);&nbsp;</div></li><li><div>          if ( $q['author'] )&nbsp;</div></li><li><div>              $q['author'] = $q['author']-&gt;ID;&nbsp;</div></li><li><div>          $whichauthor .= &quot; AND ({$wpdb-&gt;posts}.post_author = &quot; . absint($q['author']) . ')';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// MIME-Type stuff for attachment browsing</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $q['post_mime_type'] ) && '' != $q['post_mime_type'] ) {&nbsp;</div></li><li><div>          $whichmimetype = wp_post_mime_type_where( $q['post_mime_type'], $wpdb-&gt;posts );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $where .= $search . $whichauthor . $whichmimetype;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;meta_query-&gt;queries ) ) {&nbsp;</div></li><li><div>          $clauses = $this-&gt;meta_query-&gt;get_sql( 'post', $wpdb-&gt;posts, 'ID', $this );&nbsp;</div></li><li><div>          $join   .= $clauses['join'];&nbsp;</div></li><li><div>          $where  .= $clauses['where'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $rand = ( isset( $q['orderby'] ) && 'rand' === $q['orderby'] );&nbsp;</div></li><li><div>      if ( ! isset( $q['order'] ) ) {&nbsp;</div></li><li><div>          $q['order'] = $rand ? '' : 'DESC';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $q['order'] = $rand ? '' : $this-&gt;parse_order( $q['order'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Order by.</span>&nbsp;</div></li><li><div>      if ( empty( $q['orderby'] ) ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Boolean false or empty array blanks out ORDER BY, </span>&nbsp;</div></li><li><div><span class="comment">           * while leaving the value unset or otherwise empty sets the default.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( isset( $q['orderby'] ) && ( is_array( $q['orderby'] ) || false === $q['orderby'] ) ) {&nbsp;</div></li><li><div>              $orderby = '';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $orderby = &quot;{$wpdb-&gt;posts}.post_date &quot; . $q['order'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( 'none' == $q['orderby'] ) {&nbsp;</div></li><li><div>          $orderby = '';&nbsp;</div></li><li><div>      } elseif ( $q['orderby'] == 'post__in' && ! empty( $post__in ) ) {&nbsp;</div></li><li><div>          $orderby = &quot;FIELD( {$wpdb-&gt;posts}.ID, $post__in )&quot;;&nbsp;</div></li><li><div>      } elseif ( $q['orderby'] == 'post_parent__in' && ! empty( $post_parent__in ) ) {&nbsp;</div></li><li><div>          $orderby = &quot;FIELD( {$wpdb-&gt;posts}.post_parent, $post_parent__in )&quot;;&nbsp;</div></li><li><div>      } elseif ( $q['orderby'] == 'post_name__in' && ! empty( $post_name__in ) ) {&nbsp;</div></li><li><div>          $orderby = &quot;FIELD( {$wpdb-&gt;posts}.post_name, $post_name__in )&quot;;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $orderby_array = array();&nbsp;</div></li><li><div>          if ( is_array( $q['orderby'] ) ) {&nbsp;</div></li><li><div>              foreach ( $q['orderby'] as $_orderby =&gt; $order ) {&nbsp;</div></li><li><div>                  $orderby = addslashes_gpc( urldecode( $_orderby ) );&nbsp;</div></li><li><div>                  $parsed = $this-&gt;parse_orderby( $orderby );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! $parsed ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $orderby_array[] = $parsed . ' ' . $this-&gt;parse_order( $order );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $orderby = implode( ', ', $orderby_array );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $q['orderby'] = urldecode( $q['orderby'] );&nbsp;</div></li><li><div>              $q['orderby'] = addslashes_gpc( $q['orderby'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( explode( ' ', $q['orderby'] ) as $i =&gt; $orderby ) {&nbsp;</div></li><li><div>                  $parsed = $this-&gt;parse_orderby( $orderby );&nbsp;</div></li><li><div>                  <span class="comment">// Only allow certain values for safety.</span>&nbsp;</div></li><li><div>                  if ( ! $parsed ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $orderby_array[] = $parsed;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $orderby = implode( ' ' . $q['order'] . ', ', $orderby_array );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $orderby ) ) {&nbsp;</div></li><li><div>                  $orderby = &quot;{$wpdb-&gt;posts}.post_date &quot; . $q['order'];&nbsp;</div></li><li><div>              } elseif ( ! empty( $q['order'] ) ) {&nbsp;</div></li><li><div>                  $orderby .= &quot; {$q['order']}&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Order search results by relevance only when another &quot;orderby&quot; is not specified in the query.</span>&nbsp;</div></li><li><div>      if ( ! empty( $q['s'] ) ) {&nbsp;</div></li><li><div>          $search_orderby = '';&nbsp;</div></li><li><div>          if ( ! empty( $q['search_orderby_title'] ) && ( empty( $q['orderby'] ) && ! $this-&gt;is_feed ) || ( isset( $q['orderby'] ) && 'relevance' === $q['orderby'] ) )&nbsp;</div></li><li><div>              $search_orderby = $this-&gt;parse_search_order( $q );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $q['suppress_filters'] ) {&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the ORDER BY used when ordering search results.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $search_orderby The ORDER BY clause.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query $this           The current WP_Query instance.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $search_orderby = apply_filters( 'posts_search_orderby', $search_orderby, $this );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $search_orderby )&nbsp;</div></li><li><div>              $orderby = $orderby ? $search_orderby . ', ' . $orderby : $search_orderby;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $post_type ) && count( $post_type ) &gt; 1 ) {&nbsp;</div></li><li><div>          $post_type_cap = 'multiple_post_type';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( is_array( $post_type ) )&nbsp;</div></li><li><div>              $post_type = reset( $post_type );&nbsp;</div></li><li><div>          $post_type_object = get_post_type_object( $post_type );&nbsp;</div></li><li><div>          if ( empty( $post_type_object ) )&nbsp;</div></li><li><div>              $post_type_cap = $post_type;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $q['post_password'] ) ) {&nbsp;</div></li><li><div>          $where .= $wpdb-&gt;prepare( &quot; AND {$wpdb-&gt;posts}.post_password = %s&quot;, $q['post_password'] );&nbsp;</div></li><li><div>          if ( empty( $q['perm'] ) ) {&nbsp;</div></li><li><div>              $q['perm'] = 'readable';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( isset( $q['has_password'] ) ) {&nbsp;</div></li><li><div>          $where .= sprintf( &quot; AND {$wpdb-&gt;posts}.post_password %s ''&quot;, $q['has_password'] ? '!=' : '=' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $q['comment_status'] ) ) {&nbsp;</div></li><li><div>          $where .= $wpdb-&gt;prepare( &quot; AND {$wpdb-&gt;posts}.comment_status = %s &quot;, $q['comment_status'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $q['ping_status'] ) )  {&nbsp;</div></li><li><div>          $where .= $wpdb-&gt;prepare( &quot; AND {$wpdb-&gt;posts}.ping_status = %s &quot;, $q['ping_status'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'any' == $post_type ) {&nbsp;</div></li><li><div>          $in_search_post_types = get_post_types( array('exclude_from_search' =&gt; false) );&nbsp;</div></li><li><div>          if ( empty( $in_search_post_types ) ) {&nbsp;</div></li><li><div>              $where .= ' AND 1=0 ';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $where .= &quot; AND {$wpdb-&gt;posts}.post_type IN ('&quot; . join(&quot;', '&quot;, $in_search_post_types ) . &quot;')&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( !empty( $post_type ) && is_array( $post_type ) ) {&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_type IN ('&quot; . join(&quot;', '&quot;, $post_type) . &quot;')&quot;;&nbsp;</div></li><li><div>      } elseif ( ! empty( $post_type ) ) {&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_type = '$post_type'&quot;;&nbsp;</div></li><li><div>          $post_type_object = get_post_type_object ( $post_type );&nbsp;</div></li><li><div>      } elseif ( $this-&gt;is_attachment ) {&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_type = 'attachment'&quot;;&nbsp;</div></li><li><div>          $post_type_object = get_post_type_object ( 'attachment' );&nbsp;</div></li><li><div>      } elseif ( $this-&gt;is_page ) {&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_type = 'page'&quot;;&nbsp;</div></li><li><div>          $post_type_object = get_post_type_object ( 'page' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $where .= &quot; AND {$wpdb-&gt;posts}.post_type = 'post'&quot;;&nbsp;</div></li><li><div>          $post_type_object = get_post_type_object ( 'post' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $edit_cap = 'edit_post';&nbsp;</div></li><li><div>      $read_cap = 'read_post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $post_type_object ) ) {&nbsp;</div></li><li><div>          $edit_others_cap = $post_type_object-&gt;cap-&gt;edit_others_posts;&nbsp;</div></li><li><div>          $read_private_cap = $post_type_object-&gt;cap-&gt;read_private_posts;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $edit_others_cap = 'edit_others_' . $post_type_cap . 's';&nbsp;</div></li><li><div>          $read_private_cap = 'read_private_' . $post_type_cap . 's';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $user_id = get_current_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $q_status = array();&nbsp;</div></li><li><div>      if ( ! empty( $q['post_status'] ) ) {&nbsp;</div></li><li><div>          $statuswheres = array();&nbsp;</div></li><li><div>          $q_status = $q['post_status'];&nbsp;</div></li><li><div>          if ( ! is_array( $q_status ) )&nbsp;</div></li><li><div>              $q_status = explode(', ', $q_status);&nbsp;</div></li><li><div>          $r_status = array();&nbsp;</div></li><li><div>          $p_status = array();&nbsp;</div></li><li><div>          $e_status = array();&nbsp;</div></li><li><div>          if ( in_array( 'any', $q_status ) ) {&nbsp;</div></li><li><div>              foreach ( get_post_stati( array( 'exclude_from_search' =&gt; true ) ) as $status ) {&nbsp;</div></li><li><div>                  if ( ! in_array( $status, $q_status ) ) {&nbsp;</div></li><li><div>                      $e_status[] = &quot;{$wpdb-&gt;posts}.post_status &lt;&gt; '$status'&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              foreach ( get_post_stati() as $status ) {&nbsp;</div></li><li><div>                  if ( in_array( $status, $q_status ) ) {&nbsp;</div></li><li><div>                      if ( 'private' == $status ) {&nbsp;</div></li><li><div>                          $p_status[] = &quot;{$wpdb-&gt;posts}.post_status = '$status'&quot;;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $r_status[] = &quot;{$wpdb-&gt;posts}.post_status = '$status'&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty($q['perm'] ) || 'readable' != $q['perm'] ) {&nbsp;</div></li><li><div>              $r_status = array_merge($r_status, $p_status);&nbsp;</div></li><li><div>              unset($p_status);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !empty($e_status) ) {&nbsp;</div></li><li><div>              $statuswheres[] = &quot;(&quot; . join( ' AND ', $e_status ) . &quot;)&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( !empty($r_status) ) {&nbsp;</div></li><li><div>              if ( !empty($q['perm'] ) && 'editable' == $q['perm'] && !current_user_can($edit_others_cap) ) {&nbsp;</div></li><li><div>                  $statuswheres[] = &quot;({$wpdb-&gt;posts}.post_author = $user_id &quot; . &quot;AND (&quot; . join( ' OR ', $r_status ) . &quot;))&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $statuswheres[] = &quot;(&quot; . join( ' OR ', $r_status ) . &quot;)&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( !empty($p_status) ) {&nbsp;</div></li><li><div>              if ( !empty($q['perm'] ) && 'readable' == $q['perm'] && !current_user_can($read_private_cap) ) {&nbsp;</div></li><li><div>                  $statuswheres[] = &quot;({$wpdb-&gt;posts}.post_author = $user_id &quot; . &quot;AND (&quot; . join( ' OR ', $p_status ) . &quot;))&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $statuswheres[] = &quot;(&quot; . join( ' OR ', $p_status ) . &quot;)&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $post_status_join ) {&nbsp;</div></li><li><div>              $join .= &quot; LEFT JOIN {$wpdb-&gt;posts} AS p2 ON ({$wpdb-&gt;posts}.post_parent = p2.ID) &quot;;&nbsp;</div></li><li><div>              foreach ( $statuswheres as $index =&gt; $statuswhere ) {&nbsp;</div></li><li><div>                  $statuswheres[$index] = &quot;($statuswhere OR ({$wpdb-&gt;posts}.post_status = 'inherit' AND &quot; . str_replace( $wpdb-&gt;posts, 'p2', $statuswhere ) . &quot;))&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $where_status = implode( ' OR ', $statuswheres );&nbsp;</div></li><li><div>          if ( ! empty( $where_status ) ) {&nbsp;</div></li><li><div>              $where .= &quot; AND ($where_status)&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( !$this-&gt;is_singular ) {&nbsp;</div></li><li><div>          $where .= &quot; AND ({$wpdb-&gt;posts}.post_status = 'publish'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Add public states.</span>&nbsp;</div></li><li><div>          $public_states = get_post_stati( array('public' =&gt; true) );&nbsp;</div></li><li><div>          foreach ( (array) $public_states as $state ) {&nbsp;</div></li><li><div>              if ( 'publish' == $state ) <span class="comment">// Publish is hard-coded above.</span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              $where .= &quot; OR {$wpdb-&gt;posts}.post_status = '$state'&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;is_admin ) {&nbsp;</div></li><li><div>              <span class="comment">// Add protected states that should show in the admin all list.</span>&nbsp;</div></li><li><div>              $admin_all_states = get_post_stati( array('protected' =&gt; true, 'show_in_admin_all_list' =&gt; true) );&nbsp;</div></li><li><div>              foreach ( (array) $admin_all_states as $state ) {&nbsp;</div></li><li><div>                  $where .= &quot; OR {$wpdb-&gt;posts}.post_status = '$state'&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_user_logged_in() ) {&nbsp;</div></li><li><div>              <span class="comment">// Add private states that are limited to viewing by the author of a post or someone who has caps to read private states.</span>&nbsp;</div></li><li><div>              $private_states = get_post_stati( array('private' =&gt; true) );&nbsp;</div></li><li><div>              foreach ( (array) $private_states as $state ) {&nbsp;</div></li><li><div>                  $where .= current_user_can( $read_private_cap ) ? &quot; OR {$wpdb-&gt;posts}.post_status = '$state'&quot; : &quot; OR {$wpdb-&gt;posts}.post_author = $user_id AND {$wpdb-&gt;posts}.post_status = '$state'&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $where .= ')';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Apply filters on where and join prior to paging so that any</span>&nbsp;</div></li><li><div><span class="comment">       * manipulations to them are reflected in the paging by day queries.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( !$q['suppress_filters'] ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the WHERE clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $where The WHERE clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $where = apply_filters_ref_array( 'posts_where', array( $where, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $where The JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $join = apply_filters_ref_array( 'posts_join', array( $join, &$this ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Paging</span>&nbsp;</div></li><li><div>      if ( empty($q['nopaging']) && !$this-&gt;is_singular ) {&nbsp;</div></li><li><div>          $page = absint($q['paged']);&nbsp;</div></li><li><div>          if ( !$page )&nbsp;</div></li><li><div>              $page = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If 'offset' is provided, it takes precedence over 'paged'.</span>&nbsp;</div></li><li><div>          if ( isset( $q['offset'] ) && is_numeric( $q['offset'] ) ) {&nbsp;</div></li><li><div>              $q['offset'] = absint( $q['offset'] );&nbsp;</div></li><li><div>              $pgstrt = $q['offset'] . ', ';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $pgstrt = absint( ( $page - 1 ) * $q['posts_per_page'] ) . ', ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $limits = 'LIMIT ' . $pgstrt . $q['posts_per_page'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Comments feeds</span>&nbsp;</div></li><li><div>      if ( $this-&gt;is_comment_feed && ! $this-&gt;is_singular ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_archive || $this-&gt;is_search ) {&nbsp;</div></li><li><div>              $cjoin = &quot;JOIN {$wpdb-&gt;posts} ON ({$wpdb-&gt;comments}.comment_post_ID = {$wpdb-&gt;posts}.ID) $join &quot;;&nbsp;</div></li><li><div>              $cwhere = &quot;WHERE comment_approved = '1' $where&quot;;&nbsp;</div></li><li><div>              $cgroupby = &quot;{$wpdb-&gt;comments}.comment_id&quot;;&nbsp;</div></li><li><div>          } else { <span class="comment">// Other non singular e.g. front</span>&nbsp;</div></li><li><div>              $cjoin = &quot;JOIN {$wpdb-&gt;posts} ON ( {$wpdb-&gt;comments}.comment_post_ID = {$wpdb-&gt;posts}.ID )&quot;;&nbsp;</div></li><li><div>              $cwhere = &quot;WHERE ( post_status = 'publish' OR ( post_status = 'inherit' AND post_type = 'attachment' ) ) AND comment_approved = '1'&quot;;&nbsp;</div></li><li><div>              $cgroupby = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !$q['suppress_filters'] ) {&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the JOIN clause of the comments feed query before sending.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $cjoin The JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $cjoin = apply_filters_ref_array( 'comment_feed_join', array( $cjoin, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the WHERE clause of the comments feed query before sending.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $cwhere The WHERE clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query &$this  The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $cwhere = apply_filters_ref_array( 'comment_feed_where', array( $cwhere, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the GROUP BY clause of the comments feed query before sending.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $cgroupby The GROUP BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query &$this    The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $cgroupby = apply_filters_ref_array( 'comment_feed_groupby', array( $cgroupby, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the ORDER BY clause of the comments feed query before sending.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $corderby The ORDER BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query &$this    The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $corderby = apply_filters_ref_array( 'comment_feed_orderby', array( 'comment_date_gmt DESC', &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the LIMIT clause of the comments feed query before sending.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $climits The JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query &$this   The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $climits = apply_filters_ref_array( 'comment_feed_limits', array( 'LIMIT ' . get_option('posts_per_rss'), &$this ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $cgroupby = ( ! empty( $cgroupby ) ) ? 'GROUP BY ' . $cgroupby : '';&nbsp;</div></li><li><div>          $corderby = ( ! empty( $corderby ) ) ? 'ORDER BY ' . $corderby : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $comments = (array) $wpdb-&gt;get_results(&quot;SELECT $distinct {$wpdb-&gt;comments}.* FROM {$wpdb-&gt;comments} $cjoin $cwhere $cgroupby $corderby $climits&quot;);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Convert to WP_Comment</span></span>&nbsp;</div></li><li><div>          $this-&gt;comments = array_map( 'get_comment', $comments );&nbsp;</div></li><li><div>          $this-&gt;comment_count = count($this-&gt;comments);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $post_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;comments as $comment )&nbsp;</div></li><li><div>              $post_ids[] = (int) $comment-&gt;comment_post_ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $post_ids = join(', ', $post_ids);&nbsp;</div></li><li><div>          $join = '';&nbsp;</div></li><li><div>          if ( $post_ids ) {&nbsp;</div></li><li><div>              $where = &quot;AND {$wpdb-&gt;posts}.ID IN ($post_ids) &quot;;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $where = &quot;AND 0&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $pieces = array( 'where', 'groupby', 'join', 'orderby', 'distinct', 'fields', 'limits' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Apply post-paging filters on where and join. Only plugins that</span>&nbsp;</div></li><li><div><span class="comment">       * manipulate paging queries should use these hooks.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( !$q['suppress_filters'] ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the WHERE clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * Specifically for manipulating paging queries.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $where The WHERE clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $where = apply_filters_ref_array( 'posts_where_paged', array( $where, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the GROUP BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $groupby The GROUP BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this   The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $groupby = apply_filters_ref_array( 'posts_groupby', array( $groupby, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * Specifically for manipulating paging queries.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $join  The JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $join = apply_filters_ref_array( 'posts_join_paged', array( $join, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the ORDER BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.1</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $orderby The ORDER BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this   The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $orderby = apply_filters_ref_array( 'posts_orderby', array( $orderby, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the DISTINCT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $distinct The DISTINCT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this    The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $distinct = apply_filters_ref_array( 'posts_distinct', array( $distinct, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the LIMIT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $limits The LIMIT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this  The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $limits = apply_filters_ref_array( 'post_limits', array( $limits, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the SELECT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $fields The SELECT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this  The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $fields = apply_filters_ref_array( 'posts_fields', array( $fields, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters all query clauses at once, for convenience.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * Covers the WHERE, GROUP BY, JOIN, ORDER BY, DISTINCT, </span>&nbsp;</div></li><li><div><span class="comment">           * fields (SELECT), and LIMITS clauses.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param array    $clauses The list of clauses for the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this   The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $clauses = (array) apply_filters_ref_array( 'posts_clauses', array( compact( $pieces ), &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $where = isset( $clauses[ 'where' ] ) ? $clauses[ 'where' ] : '';&nbsp;</div></li><li><div>          $groupby = isset( $clauses[ 'groupby' ] ) ? $clauses[ 'groupby' ] : '';&nbsp;</div></li><li><div>          $join = isset( $clauses[ 'join' ] ) ? $clauses[ 'join' ] : '';&nbsp;</div></li><li><div>          $orderby = isset( $clauses[ 'orderby' ] ) ? $clauses[ 'orderby' ] : '';&nbsp;</div></li><li><div>          $distinct = isset( $clauses[ 'distinct' ] ) ? $clauses[ 'distinct' ] : '';&nbsp;</div></li><li><div>          $fields = isset( $clauses[ 'fields' ] ) ? $clauses[ 'fields' ] : '';&nbsp;</div></li><li><div>          $limits = isset( $clauses[ 'limits' ] ) ? $clauses[ 'limits' ] : '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires to announce the query's current selection parameters.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $selection The assembled selection query.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'posts_selection', $where . $groupby . $orderby . $limits . $join );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters again for the benefit of caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">       * Regular plugins should use the hooks above.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( !$q['suppress_filters'] ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the WHERE clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $where The WHERE clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $where = apply_filters_ref_array( 'posts_where_request', array( $where, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the GROUP BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $groupby The GROUP BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this   The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $groupby = apply_filters_ref_array( 'posts_groupby_request', array( $groupby, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $join  The JOIN clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $join = apply_filters_ref_array( 'posts_join_request', array( $join, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the ORDER BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $orderby The ORDER BY clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this   The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $orderby = apply_filters_ref_array( 'posts_orderby_request', array( $orderby, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the DISTINCT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $distinct The DISTINCT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this    The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $distinct = apply_filters_ref_array( 'posts_distinct_request', array( $distinct, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the SELECT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $fields The SELECT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this  The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $fields = apply_filters_ref_array( 'posts_fields_request', array( $fields, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the LIMIT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $limits The LIMIT clause of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this  The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $limits = apply_filters_ref_array( 'post_limits_request', array( $limits, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters all query clauses at once, for convenience.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * For use by caching plugins.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * Covers the WHERE, GROUP BY, JOIN, ORDER BY, DISTINCT, </span>&nbsp;</div></li><li><div><span class="comment">           * fields (SELECT), and LIMITS clauses.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param array    $pieces The pieces of the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this  The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $clauses = (array) apply_filters_ref_array( 'posts_clauses_request', array( compact( $pieces ), &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $where = isset( $clauses[ 'where' ] ) ? $clauses[ 'where' ] : '';&nbsp;</div></li><li><div>          $groupby = isset( $clauses[ 'groupby' ] ) ? $clauses[ 'groupby' ] : '';&nbsp;</div></li><li><div>          $join = isset( $clauses[ 'join' ] ) ? $clauses[ 'join' ] : '';&nbsp;</div></li><li><div>          $orderby = isset( $clauses[ 'orderby' ] ) ? $clauses[ 'orderby' ] : '';&nbsp;</div></li><li><div>          $distinct = isset( $clauses[ 'distinct' ] ) ? $clauses[ 'distinct' ] : '';&nbsp;</div></li><li><div>          $fields = isset( $clauses[ 'fields' ] ) ? $clauses[ 'fields' ] : '';&nbsp;</div></li><li><div>          $limits = isset( $clauses[ 'limits' ] ) ? $clauses[ 'limits' ] : '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty($groupby) )&nbsp;</div></li><li><div>          $groupby = 'GROUP BY ' . $groupby;&nbsp;</div></li><li><div>      if ( !empty( $orderby ) )&nbsp;</div></li><li><div>          $orderby = 'ORDER BY ' . $orderby;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $found_rows = '';&nbsp;</div></li><li><div>      if ( !$q['no_found_rows'] && !empty($limits) )&nbsp;</div></li><li><div>          $found_rows = 'SQL_CALC_FOUND_ROWS';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;request = $old_request = &quot;SELECT $found_rows $distinct $fields FROM {$wpdb-&gt;posts} $join WHERE 1=1 $where $groupby $orderby $limits&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !$q['suppress_filters'] ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the completed SQL query before sending.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $request The complete SQL query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this   The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $this-&gt;request = apply_filters_ref_array( 'posts_request', array( $this-&gt;request, &$this ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the posts array before the query takes place.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Return a non-null value to bypass WordPress's default post queries.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Filtering functions that require pagination information are encouraged to set</span>&nbsp;</div></li><li><div><span class="comment">       * the `found_posts` and `max_num_pages` properties of the WP_Query object, </span>&nbsp;</div></li><li><div><span class="comment">       * passed to the filter by reference. If WP_Query does not perform a database</span>&nbsp;</div></li><li><div><span class="comment">       * query, it will not have enough information to generate these values itself.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array|null $posts Return an array of post data to short-circuit WP's query, </span>&nbsp;</div></li><li><div><span class="comment">       *                          or null to allow WP to run its normal queries.</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Query   $this  The WP_Query instance, passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $this-&gt;posts = apply_filters_ref_array( 'posts_pre_query', array( null, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'ids' == $q['fields'] ) {&nbsp;</div></li><li><div>          if ( null === $this-&gt;posts ) {&nbsp;</div></li><li><div>              $this-&gt;posts = $wpdb-&gt;get_col( $this-&gt;request );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;posts = array_map( 'intval', $this-&gt;posts );&nbsp;</div></li><li><div>          $this-&gt;post_count = count( $this-&gt;posts );&nbsp;</div></li><li><div>          $this-&gt;set_found_posts( $q, $limits );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;posts;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'id=&gt;parent' == $q['fields'] ) {&nbsp;</div></li><li><div>          if ( null === $this-&gt;posts ) {&nbsp;</div></li><li><div>              $this-&gt;posts = $wpdb-&gt;get_results( $this-&gt;request );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;post_count = count( $this-&gt;posts );&nbsp;</div></li><li><div>          $this-&gt;set_found_posts( $q, $limits );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $r = array();&nbsp;</div></li><li><div>          foreach ( $this-&gt;posts as $key =&gt; $post ) {&nbsp;</div></li><li><div>              $this-&gt;posts[ $key ]-&gt;ID = (int) $post-&gt;ID;&nbsp;</div></li><li><div>              $this-&gt;posts[ $key ]-&gt;post_parent = (int) $post-&gt;post_parent;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $r[ (int) $post-&gt;ID ] = (int) $post-&gt;post_parent;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $r;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( null === $this-&gt;posts ) {&nbsp;</div></li><li><div>          $split_the_query = ( $old_request == $this-&gt;request && &quot;{$wpdb-&gt;posts}.*&quot; == $fields && !empty( $limits ) && $q['posts_per_page'] &lt; 500 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters whether to split the query.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * Splitting the query will cause it to fetch just the IDs of the found posts</span>&nbsp;</div></li><li><div><span class="comment">           * (and then individually fetch each post by ID), rather than fetching every</span>&nbsp;</div></li><li><div><span class="comment">           * complete row at once. One massive result vs. many small results.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param bool     $split_the_query Whether or not to split the query.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query $this            The WP_Query instance.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $split_the_query = apply_filters( 'split_the_query', $split_the_query, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $split_the_query ) {&nbsp;</div></li><li><div>              <span class="comment">// First get the IDs and then fill in the objects</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;request = &quot;SELECT $found_rows $distinct {$wpdb-&gt;posts}.ID FROM {$wpdb-&gt;posts} $join WHERE 1=1 $where $groupby $orderby $limits&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the Post IDs SQL request before sending.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $request The post ID request.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query $this    The WP_Query instance.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $this-&gt;request = apply_filters( 'posts_request_ids', $this-&gt;request, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $ids = $wpdb-&gt;get_col( $this-&gt;request );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $ids ) {&nbsp;</div></li><li><div>                  $this-&gt;posts = $ids;&nbsp;</div></li><li><div>                  $this-&gt;set_found_posts( $q, $limits );&nbsp;</div></li><li><div>                  _prime_post_caches( $ids, $q['update_post_term_cache'], $q['update_post_meta_cache'] );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;posts = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;posts = $wpdb-&gt;get_results( $this-&gt;request );&nbsp;</div></li><li><div>              $this-&gt;set_found_posts( $q, $limits );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Convert to WP_Post objects.</span>&nbsp;</div></li><li><div>      if ( $this-&gt;posts ) {&nbsp;</div></li><li><div>          $this-&gt;posts = array_map( 'get_post', $this-&gt;posts );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $q['suppress_filters'] ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the raw post results array, prior to status checks.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param array    $posts The post results array.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $this-&gt;posts = apply_filters_ref_array( 'posts_results', array( $this-&gt;posts, &$this ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($this-&gt;posts) && $this-&gt;is_comment_feed && $this-&gt;is_singular ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/query.php */</span></span></span></span></span>&nbsp;</div></li><li><div>          $cjoin = apply_filters_ref_array( 'comment_feed_join', array( '', &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/query.php */</span></span></span></span></span>&nbsp;</div></li><li><div>          $cwhere = apply_filters_ref_array( 'comment_feed_where', array( &quot;WHERE comment_post_ID = '{$this-&gt;posts[0]-&gt;ID}' AND comment_approved = '1'&quot;, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/query.php */</span></span></span></span></span>&nbsp;</div></li><li><div>          $cgroupby = apply_filters_ref_array( 'comment_feed_groupby', array( '', &$this ) );&nbsp;</div></li><li><div>          $cgroupby = ( ! empty( $cgroupby ) ) ? 'GROUP BY ' . $cgroupby : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/query.php */</span></span></span></span></span>&nbsp;</div></li><li><div>          $corderby = apply_filters_ref_array( 'comment_feed_orderby', array( 'comment_date_gmt DESC', &$this ) );&nbsp;</div></li><li><div>          $corderby = ( ! empty( $corderby ) ) ? 'ORDER BY ' . $corderby : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/query.php */</span></span></span></span></span>&nbsp;</div></li><li><div>          $climits = apply_filters_ref_array( 'comment_feed_limits', array( 'LIMIT ' . get_option('posts_per_rss'), &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $comments_request = &quot;SELECT {$wpdb-&gt;comments}.* FROM {$wpdb-&gt;comments} $cjoin $cwhere $cgroupby $corderby $climits&quot;;&nbsp;</div></li><li><div>          $comments = $wpdb-&gt;get_results($comments_request);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Convert to WP_Comment</span></span>&nbsp;</div></li><li><div>          $this-&gt;comments = array_map( 'get_comment', $comments );&nbsp;</div></li><li><div>          $this-&gt;comment_count = count($this-&gt;comments);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check post status to determine if post should be displayed.</span>&nbsp;</div></li><li><div>      if ( !empty($this-&gt;posts) && ($this-&gt;is_single || $this-&gt;is_page) ) {&nbsp;</div></li><li><div>          $status = get_post_status($this-&gt;posts[0]);&nbsp;</div></li><li><div>          if ( 'attachment' === $this-&gt;posts[0]-&gt;post_type && 0 === (int) $this-&gt;posts[0]-&gt;post_parent ) {&nbsp;</div></li><li><div>              $this-&gt;is_page = false;&nbsp;</div></li><li><div>              $this-&gt;is_single = true;&nbsp;</div></li><li><div>              $this-&gt;is_attachment = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $post_status_obj = get_post_status_object($status);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If the post_status was specifically requested, let it pass through.</span>&nbsp;</div></li><li><div>          if ( !$post_status_obj-&gt;public && ! in_array( $status, $q_status ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! is_user_logged_in() ) {&nbsp;</div></li><li><div>                  <span class="comment">// User must be logged in to view unpublished posts.</span>&nbsp;</div></li><li><div>                  $this-&gt;posts = array();&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if  ( $post_status_obj-&gt;protected ) {&nbsp;</div></li><li><div>                      <span class="comment">// User must have edit permissions on the draft to preview.</span>&nbsp;</div></li><li><div>                      if ( ! current_user_can($edit_cap, $this-&gt;posts[0]-&gt;ID) ) {&nbsp;</div></li><li><div>                          $this-&gt;posts = array();&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;is_preview = true;&nbsp;</div></li><li><div>                          if ( 'future' != $status )&nbsp;</div></li><li><div>                              $this-&gt;posts[0]-&gt;post_date = current_time('mysql');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ( $post_status_obj-&gt;private ) {&nbsp;</div></li><li><div>                      if ( ! current_user_can($read_cap, $this-&gt;posts[0]-&gt;ID) )&nbsp;</div></li><li><div>                          $this-&gt;posts = array();&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;posts = array();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;is_preview && $this-&gt;posts && current_user_can( $edit_cap, $this-&gt;posts[0]-&gt;ID ) ) {&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the single post for preview mode.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Post  $post_preview  The Post object.</span>&nbsp;</div></li><li><div><span class="comment">               * @param WP_Query &$this         The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $this-&gt;posts[0] = get_post( apply_filters_ref_array( 'the_preview', array( $this-&gt;posts[0], &$this ) ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Put sticky posts at the top of the posts array</span>&nbsp;</div></li><li><div>      $sticky_posts = get_option('sticky_posts');&nbsp;</div></li><li><div>      if ( $this-&gt;is_home && $page &lt;= 1 && is_array($sticky_posts) && !empty($sticky_posts) && !$q['ignore_sticky_posts'] ) {&nbsp;</div></li><li><div>          $num_posts = count($this-&gt;posts);&nbsp;</div></li><li><div>          $sticky_offset = 0;&nbsp;</div></li><li><div>          <span class="comment">// Loop over posts and relocate stickies to the front.</span>&nbsp;</div></li><li><div>          for ( $i = 0; $i &lt; $num_posts; $i++ ) {&nbsp;</div></li><li><div>              if ( in_array($this-&gt;posts[$i]-&gt;ID, $sticky_posts) ) {&nbsp;</div></li><li><div>                  $sticky_post = $this-&gt;posts[$i];&nbsp;</div></li><li><div>                  <span class="comment">// Remove sticky from current position</span>&nbsp;</div></li><li><div>                  array_splice($this-&gt;posts, $i, 1);&nbsp;</div></li><li><div>                  <span class="comment">// Move to front, after other stickies</span>&nbsp;</div></li><li><div>                  array_splice($this-&gt;posts, $sticky_offset, 0, array($sticky_post));&nbsp;</div></li><li><div>                  <span class="comment">// Increment the sticky offset. The next sticky will be placed at this offset.</span>&nbsp;</div></li><li><div>                  $sticky_offset++;&nbsp;</div></li><li><div>                  <span class="comment">// Remove post from sticky posts array</span>&nbsp;</div></li><li><div>                  $offset = array_search($sticky_post-&gt;ID, $sticky_posts);&nbsp;</div></li><li><div>                  unset( $sticky_posts[$offset] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If any posts have been excluded specifically, Ignore those that are sticky.</span>&nbsp;</div></li><li><div>          if ( !empty($sticky_posts) && !empty($q['post__not_in']) )&nbsp;</div></li><li><div>              $sticky_posts = array_diff($sticky_posts, $q['post__not_in']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Fetch sticky posts that weren't in the query results</span>&nbsp;</div></li><li><div>          if ( !empty($sticky_posts) ) {&nbsp;</div></li><li><div>              $stickies = get_posts( array(&nbsp;</div></li><li><div>                  'post__in' =&gt; $sticky_posts, &nbsp;</div></li><li><div>                  'post_type' =&gt; $post_type, &nbsp;</div></li><li><div>                  'post_status' =&gt; 'publish', &nbsp;</div></li><li><div>                  'nopaging' =&gt; true&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $stickies as $sticky_post ) {&nbsp;</div></li><li><div>                  array_splice( $this-&gt;posts, $sticky_offset, 0, array( $sticky_post ) );&nbsp;</div></li><li><div>                  $sticky_offset++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If comments have been fetched as part of the query, make sure comment meta lazy-loading is set up.</span>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;comments ) ) {&nbsp;</div></li><li><div>          wp_queue_comments_for_comment_meta_lazyload( $this-&gt;comments );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $q['suppress_filters'] ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the array of retrieved posts after they've been fetched and</span>&nbsp;</div></li><li><div><span class="comment">           * internally processed.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param array    $posts The array of retrieved posts.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $this-&gt;posts = apply_filters_ref_array( 'the_posts', array( $this-&gt;posts, &$this ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Ensure that any posts added/modified via one of the filters above are</span>&nbsp;</div></li><li><div>      <span class="comment">// of the type WP_Post and are filtered.</span>&nbsp;</div></li><li><div>      if ( $this-&gt;posts ) {&nbsp;</div></li><li><div>          $this-&gt;post_count = count( $this-&gt;posts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;posts = array_map( 'get_post', $this-&gt;posts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $q['cache_results'] )&nbsp;</div></li><li><div>              update_post_caches($this-&gt;posts, $post_type, $q['update_post_term_cache'], $q['update_post_meta_cache']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;post = reset( $this-&gt;posts );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;post_count = 0;&nbsp;</div></li><li><div>          $this-&gt;posts = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $q['lazy_load_term_meta'] ) {&nbsp;</div></li><li><div>          wp_queue_posts_for_term_meta_lazyload( $this-&gt;posts );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;posts;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set up the amount of found posts and the number of pages (if limit clause was used)</span>&nbsp;</div></li><li><div><span class="comment">   * for the current query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $q      Query variables.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $limits LIMIT clauses of the query.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function set_found_posts( $q, $limits ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>      <span class="comment">// Bail if posts is an empty array. Continue if posts is an empty string, </span>&nbsp;</div></li><li><div>      <span class="comment">// null, or false to accommodate caching plugins that fill posts later.</span>&nbsp;</div></li><li><div>      if ( $q['no_found_rows'] || ( is_array( $this-&gt;posts ) && ! $this-&gt;posts ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $limits ) ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the query to run for retrieving the found posts.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $found_posts The query to run to find the found posts.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this       The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $this-&gt;found_posts = $wpdb-&gt;get_var( apply_filters_ref_array( 'found_posts_query', array( 'SELECT FOUND_ROWS()', &$this ) ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;found_posts = count( $this-&gt;posts );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the number of found posts for the query.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int      $found_posts The number of posts found.</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Query &$this       The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $this-&gt;found_posts = apply_filters_ref_array( 'found_posts', array( $this-&gt;found_posts, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $limits ) )&nbsp;</div></li><li><div>          $this-&gt;max_num_pages = ceil( $this-&gt;found_posts / $q['posts_per_page'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set up the next post and iterate current post index.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return WP_Post Next post.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function next_post() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;current_post++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;post = $this-&gt;posts[$this-&gt;current_post];&nbsp;</div></li><li><div>      return $this-&gt;post;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Sets up the current post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieves the next post, sets up the post, sets the 'in the loop'</span>&nbsp;</div></li><li><div><span class="comment">   * property to true.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global WP_Post $post</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function the_post() {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>      $this-&gt;in_the_loop = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;current_post == -1 ) <span class="comment">// loop has just started</span>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires once the loop is started.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action_ref_array( 'loop_start', array( &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post = $this-&gt;next_post();&nbsp;</div></li><li><div>      $this-&gt;setup_postdata( $post );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determines whether there are more posts available in the loop.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Calls the {@see 'loop_end'} action when the loop is complete.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True if posts are available, false if end of loop.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function have_posts() {&nbsp;</div></li><li><div>      if ( $this-&gt;current_post + 1 &lt; $this-&gt;post_count ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( $this-&gt;current_post + 1 == $this-&gt;post_count && $this-&gt;post_count &gt; 0 ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires once the loop has ended.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Query &$this The WP_Query instance (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action_ref_array( 'loop_end', array( &$this ) );&nbsp;</div></li><li><div>          <span class="comment">// Do some cleaning up after the loop</span>&nbsp;</div></li><li><div>          $this-&gt;rewind_posts();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;in_the_loop = false;&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Rewind the posts and reset post index.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function rewind_posts() {&nbsp;</div></li><li><div>      $this-&gt;current_post = -1;&nbsp;</div></li><li><div>      if ( $this-&gt;post_count &gt; 0 ) {&nbsp;</div></li><li><div>          $this-&gt;post = $this-&gt;posts[0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Iterate current comment index and return WP_Comment object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return WP_Comment Comment object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function next_comment() {&nbsp;</div></li><li><div>      $this-&gt;current_comment++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;comment = $this-&gt;comments[$this-&gt;current_comment];&nbsp;</div></li><li><div>      return $this-&gt;comment;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Sets up the current comment.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @global WP_Comment $comment Current comment.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function the_comment() {&nbsp;</div></li><li><div>      global $comment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $comment = $this-&gt;next_comment();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;current_comment == 0 ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires once the comment loop is started.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'comment_loop_start' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether there are more comments available.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Automatically rewinds comments when finished.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True, if more comments. False, if no more posts.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function have_comments() {&nbsp;</div></li><li><div>      if ( $this-&gt;current_comment + 1 &lt; $this-&gt;comment_count ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( $this-&gt;current_comment + 1 == $this-&gt;comment_count ) {&nbsp;</div></li><li><div>          $this-&gt;rewind_comments();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Rewind the comments, resets the comment index and comment to first.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function rewind_comments() {&nbsp;</div></li><li><div>      $this-&gt;current_comment = -1;&nbsp;</div></li><li><div>      if ( $this-&gt;comment_count &gt; 0 ) {&nbsp;</div></li><li><div>          $this-&gt;comment = $this-&gt;comments[0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Sets up the WordPress query by parsing query string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $query URL query string.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array List of posts.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function query( $query ) {&nbsp;</div></li><li><div>      $this-&gt;init();&nbsp;</div></li><li><div>      $this-&gt;query = $this-&gt;query_vars = wp_parse_args( $query );&nbsp;</div></li><li><div>      return $this-&gt;get_posts();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve queried object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If queried object is not set, then the queried object will be set from</span>&nbsp;</div></li><li><div><span class="comment">   * the category, tag, taxonomy, posts page, single post, page, or author</span>&nbsp;</div></li><li><div><span class="comment">   * query variable. After it is set up, it will be returned.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return object</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_queried_object() {&nbsp;</div></li><li><div>      if ( isset($this-&gt;queried_object) )&nbsp;</div></li><li><div>          return $this-&gt;queried_object;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;queried_object = null;&nbsp;</div></li><li><div>      $this-&gt;queried_object_id = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;is_category || $this-&gt;is_tag || $this-&gt;is_tax ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_category ) {&nbsp;</div></li><li><div>              if ( $this-&gt;get( 'cat' ) ) {&nbsp;</div></li><li><div>                  $term = get_term( $this-&gt;get( 'cat' ), 'category' );&nbsp;</div></li><li><div>              } elseif ( $this-&gt;get( 'category_name' ) ) {&nbsp;</div></li><li><div>                  $term = get_term_by( 'slug', $this-&gt;get( 'category_name' ), 'category' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( $this-&gt;is_tag ) {&nbsp;</div></li><li><div>              if ( $this-&gt;get( 'tag_id' ) ) {&nbsp;</div></li><li><div>                  $term = get_term( $this-&gt;get( 'tag_id' ), 'post_tag' );&nbsp;</div></li><li><div>              } elseif ( $this-&gt;get( 'tag' ) ) {&nbsp;</div></li><li><div>                  $term = get_term_by( 'slug', $this-&gt;get( 'tag' ), 'post_tag' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// For other tax queries, grab the first term from the first clause.</span>&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;tax_query-&gt;queried_terms ) ) {&nbsp;</div></li><li><div>                  $queried_taxonomies = array_keys( $this-&gt;tax_query-&gt;queried_terms );&nbsp;</div></li><li><div>                  $matched_taxonomy = reset( $queried_taxonomies );&nbsp;</div></li><li><div>                  $query = $this-&gt;tax_query-&gt;queried_terms[ $matched_taxonomy ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $query['terms'] ) ) {&nbsp;</div></li><li><div>                      if ( 'term_id' == $query['field'] ) {&nbsp;</div></li><li><div>                          $term = get_term( reset( $query['terms'] ), $matched_taxonomy );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $term = get_term_by( $query['field'], reset( $query['terms'] ), $matched_taxonomy );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $term ) && ! is_wp_error( $term ) )  {&nbsp;</div></li><li><div>              $this-&gt;queried_object = $term;&nbsp;</div></li><li><div>              $this-&gt;queried_object_id = (int) $term-&gt;term_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;is_category && 'category' === $this-&gt;queried_object-&gt;taxonomy )&nbsp;</div></li><li><div>                  _make_cat_compat( $this-&gt;queried_object );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( $this-&gt;is_post_type_archive ) {&nbsp;</div></li><li><div>          $post_type = $this-&gt;get( 'post_type' );&nbsp;</div></li><li><div>          if ( is_array( $post_type ) )&nbsp;</div></li><li><div>              $post_type = reset( $post_type );&nbsp;</div></li><li><div>          $this-&gt;queried_object = get_post_type_object( $post_type );&nbsp;</div></li><li><div>      } elseif ( $this-&gt;is_posts_page ) {&nbsp;</div></li><li><div>          $page_for_posts = get_option('page_for_posts');&nbsp;</div></li><li><div>          $this-&gt;queried_object = get_post( $page_for_posts );&nbsp;</div></li><li><div>          $this-&gt;queried_object_id = (int) $this-&gt;queried_object-&gt;ID;&nbsp;</div></li><li><div>      } elseif ( $this-&gt;is_singular && ! empty( $this-&gt;post ) ) {&nbsp;</div></li><li><div>          $this-&gt;queried_object = $this-&gt;post;&nbsp;</div></li><li><div>          $this-&gt;queried_object_id = (int) $this-&gt;post-&gt;ID;&nbsp;</div></li><li><div>      } elseif ( $this-&gt;is_author ) {&nbsp;</div></li><li><div>          $this-&gt;queried_object_id = (int) $this-&gt;get('author');&nbsp;</div></li><li><div>          $this-&gt;queried_object = get_userdata( $this-&gt;queried_object_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;queried_object;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve ID of the current queried object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_queried_object_id() {&nbsp;</div></li><li><div>      $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset($this-&gt;queried_object_id) ) {&nbsp;</div></li><li><div>          return $this-&gt;queried_object_id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Sets up the WordPress query, if parameter is not empty.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $query URL query string or array of vars.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct( $query = '' ) {&nbsp;</div></li><li><div>      if ( ! empty( $query ) ) {&nbsp;</div></li><li><div>          $this-&gt;query( $query );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Make private properties readable for backward compatibility.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name Property to get.</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed Property.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __get( $name ) {&nbsp;</div></li><li><div>      if ( in_array( $name, $this-&gt;compat_fields ) ) {&nbsp;</div></li><li><div>          return $this-&gt;$name;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Make private properties checkable for backward compatibility.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name Property to check if set.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether the property is set.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __isset( $name ) {&nbsp;</div></li><li><div>      if ( in_array( $name, $this-&gt;compat_fields ) ) {&nbsp;</div></li><li><div>          return isset( $this-&gt;$name );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Make private/protected methods readable for backward compatibility.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param callable $name      Method to call.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array    $arguments Arguments to pass when calling.</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed|false Return value of the callback, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __call( $name, $arguments ) {&nbsp;</div></li><li><div>      if ( in_array( $name, $this-&gt;compat_methods ) ) {&nbsp;</div></li><li><div>          return call_user_func_array( array( $this, $name ), $arguments );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">    * Is the query for an existing archive page?</span>&nbsp;</div></li><li><div><span class="comment">    *</span>&nbsp;</div></li><li><div><span class="comment">    * Month, Year, Category, Author, Post Type archive...</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">    * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">    *</span>&nbsp;</div></li><li><div><span class="comment">    * @return bool</span>&nbsp;</div></li><li><div><span class="comment">    */</span>&nbsp;</div></li><li><div>  public function is_archive() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_archive;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing post type archive page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $post_types Optional. Post type or array of posts types to check against.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_post_type_archive( $post_types = '' ) {&nbsp;</div></li><li><div>      if ( empty( $post_types ) || ! $this-&gt;is_post_type_archive )&nbsp;</div></li><li><div>          return (bool) $this-&gt;is_post_type_archive;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_type = $this-&gt;get( 'post_type' );&nbsp;</div></li><li><div>      if ( is_array( $post_type ) )&nbsp;</div></li><li><div>          $post_type = reset( $post_type );&nbsp;</div></li><li><div>      $post_type_object = get_post_type_object( $post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return in_array( $post_type_object-&gt;name, (array) $post_types );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing attachment page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $attachment Attachment ID, title, slug, or array of such.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_attachment( $attachment = '' ) {&nbsp;</div></li><li><div>      if ( ! $this-&gt;is_attachment ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $attachment ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attachment = array_map( 'strval', (array) $attachment );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_obj = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( (string) $post_obj-&gt;ID, $attachment ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( in_array( $post_obj-&gt;post_title, $attachment ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( in_array( $post_obj-&gt;post_name, $attachment ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing author archive page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $author parameter is specified, this function will additionally</span>&nbsp;</div></li><li><div><span class="comment">   * check if the query is for one of the authors specified.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $author Optional. User ID, nickname, nicename, or array of User IDs, nicknames, and nicenames</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_author( $author = '' ) {&nbsp;</div></li><li><div>      if ( !$this-&gt;is_author )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty($author) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $author_obj = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $author = array_map( 'strval', (array) $author );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( (string) $author_obj-&gt;ID, $author ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( in_array( $author_obj-&gt;nickname, $author ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( in_array( $author_obj-&gt;user_nicename, $author ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing category archive page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $category parameter is specified, this function will additionally</span>&nbsp;</div></li><li><div><span class="comment">   * check if the query is for one of the categories specified.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $category Optional. Category ID, name, slug, or array of Category IDs, names, and slugs.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_category( $category = '' ) {&nbsp;</div></li><li><div>      if ( !$this-&gt;is_category )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty($category) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cat_obj = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $category = array_map( 'strval', (array) $category );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( (string) $cat_obj-&gt;term_id, $category ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( in_array( $cat_obj-&gt;name, $category ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( in_array( $cat_obj-&gt;slug, $category ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing tag archive page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $tag parameter is specified, this function will additionally</span>&nbsp;</div></li><li><div><span class="comment">   * check if the query is for one of the tags specified.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $tag Optional. Tag ID, name, slug, or array of Tag IDs, names, and slugs.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_tag( $tag = '' ) {&nbsp;</div></li><li><div>      if ( ! $this-&gt;is_tag )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $tag ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tag_obj = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tag = array_map( 'strval', (array) $tag );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( (string) $tag_obj-&gt;term_id, $tag ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( in_array( $tag_obj-&gt;name, $tag ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( in_array( $tag_obj-&gt;slug, $tag ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing custom taxonomy archive page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $taxonomy parameter is specified, this function will additionally</span>&nbsp;</div></li><li><div><span class="comment">   * check if the query is for that specific $taxonomy.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $term parameter is specified in addition to the $taxonomy parameter, </span>&nbsp;</div></li><li><div><span class="comment">   * this function will additionally check if the query is for one of the terms</span>&nbsp;</div></li><li><div><span class="comment">   * specified.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global array $wp_taxonomies</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $taxonomy Optional. Taxonomy slug or slugs.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $term     Optional. Term ID, name, slug or array of Term IDs, names, and slugs.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True for custom taxonomy archive pages, false for built-in taxonomies (category and tag archives).</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_tax( $taxonomy = '', $term = '' ) {&nbsp;</div></li><li><div>      global $wp_taxonomies;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !$this-&gt;is_tax )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $taxonomy ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $queried_object = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>      $tax_array = array_intersect( array_keys( $wp_taxonomies ), (array) $taxonomy );&nbsp;</div></li><li><div>      $term_array = (array) $term;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check that the taxonomy matches.</span>&nbsp;</div></li><li><div>      if ( ! ( isset( $queried_object-&gt;taxonomy ) && count( $tax_array ) && in_array( $queried_object-&gt;taxonomy, $tax_array ) ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only a Taxonomy provided.</span>&nbsp;</div></li><li><div>      if ( empty( $term ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return isset( $queried_object-&gt;term_id ) &&&nbsp;</div></li><li><div>          count( array_intersect(&nbsp;</div></li><li><div>              array( $queried_object-&gt;term_id, $queried_object-&gt;name, $queried_object-&gt;slug ), &nbsp;</div></li><li><div>              $term_array&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether the current URL is within the comments popup window.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated 4.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_comments_popup() {&nbsp;</div></li><li><div>      _deprecated_function( __FUNCTION__, '4.5.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing date archive?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_date() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_date;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing day archive?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_day() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_day;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for a feed?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $feeds Optional feed types to check.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_feed( $feeds = '' ) {&nbsp;</div></li><li><div>      if ( empty( $feeds ) || ! $this-&gt;is_feed )&nbsp;</div></li><li><div>          return (bool) $this-&gt;is_feed;&nbsp;</div></li><li><div>      $qv = $this-&gt;get( 'feed' );&nbsp;</div></li><li><div>      if ( 'feed' == $qv )&nbsp;</div></li><li><div>          $qv = get_default_feed();&nbsp;</div></li><li><div>      return in_array( $qv, (array) $feeds );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for a comments feed?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_comment_feed() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_comment_feed;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for the front page of the site?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This is for what is displayed at your site's main URL.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Depends on the site's &quot;Front page displays&quot; Reading Settings 'show_on_front' and 'page_on_front'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If you set a static page for the front page of your site, this function will return</span>&nbsp;</div></li><li><div><span class="comment">   * true when viewing that page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Otherwise the same as @see WP_Query::is_home()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True, if front of site.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_front_page() {&nbsp;</div></li><li><div>      <span class="comment">// most likely case</span>&nbsp;</div></li><li><div>      if ( 'posts' == get_option( 'show_on_front') && $this-&gt;is_home() )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( 'page' == get_option( 'show_on_front') && get_option( 'page_on_front' ) && $this-&gt;is_page( get_option( 'page_on_front' ) ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for the blog homepage?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This is the page which shows the time based blog content of your site.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Depends on the site's &quot;Front page displays&quot; Reading Settings 'show_on_front' and 'page_for_posts'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If you set a static page for the front page of your site, this function will return</span>&nbsp;</div></li><li><div><span class="comment">   * true only on the page you set as the &quot;Posts page&quot;.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Query::is_front_page()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True if blog view homepage.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_home() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_home;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing month archive?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_month() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_month;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing single page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $page parameter is specified, this function will additionally</span>&nbsp;</div></li><li><div><span class="comment">   * check if the query is for one of the pages specified.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Query::is_single()</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Query::is_singular()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|string|array $page Optional. Page ID, title, slug, path, or array of such. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether the query is for an existing single page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_page( $page = '' ) {&nbsp;</div></li><li><div>      if ( !$this-&gt;is_page )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $page ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $page_obj = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $page = array_map( 'strval', (array) $page );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( (string) $page_obj-&gt;ID, $page ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( in_array( $page_obj-&gt;post_title, $page ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( in_array( $page_obj-&gt;post_name, $page ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          foreach ( $page as $pagepath ) {&nbsp;</div></li><li><div>              if ( ! strpos( $pagepath, '/' ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $pagepath_obj = get_page_by_path( $pagepath );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $pagepath_obj && ( $pagepath_obj-&gt;ID == $page_obj-&gt;ID ) ) {&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for paged result and not for the first page?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_paged() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_paged;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for a post or page preview?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_preview() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_preview;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for the robots file?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_robots() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_robots;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for a search?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_search() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_search;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing single post?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Works for any post type excluding pages.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $post parameter is specified, this function will additionally</span>&nbsp;</div></li><li><div><span class="comment">   * check if the query is for one of the Posts specified.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Query::is_page()</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Query::is_singular()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|string|array $post Optional. Post ID, title, slug, path, or array of such. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether the query is for an existing single post.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_single( $post = '' ) {&nbsp;</div></li><li><div>      if ( !$this-&gt;is_single )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty($post) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_obj = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post = array_map( 'strval', (array) $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( (string) $post_obj-&gt;ID, $post ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( in_array( $post_obj-&gt;post_title, $post ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } elseif ( in_array( $post_obj-&gt;post_name, $post ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          foreach ( $post as $postpath ) {&nbsp;</div></li><li><div>              if ( ! strpos( $postpath, '/' ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $postpath_obj = get_page_by_path( $postpath, OBJECT, $post_obj-&gt;post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $postpath_obj && ( $postpath_obj-&gt;ID == $post_obj-&gt;ID ) ) {&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing single post of any post type (post, attachment, page, ... )?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the $post_types parameter is specified, this function will additionally</span>&nbsp;</div></li><li><div><span class="comment">   * check if the query is for one of the Posts Types specified.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Query::is_page()</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Query::is_single()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $post_types Optional. Post type or array of post types. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether the query is for an existing single post of any of the given post types.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_singular( $post_types = '' ) {&nbsp;</div></li><li><div>      if ( empty( $post_types ) || !$this-&gt;is_singular )&nbsp;</div></li><li><div>          return (bool) $this-&gt;is_singular;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_obj = $this-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return in_array( $post_obj-&gt;post_type, (array) $post_types );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for a specific time?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_time() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_time;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for a trackback endpoint call?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_trackback() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_trackback;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an existing year archive?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_year() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_year;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query a 404 (returns no results)?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_404() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_404;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query for an embedded post?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_embed() {&nbsp;</div></li><li><div>      return (bool) $this-&gt;is_embed;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the query the main query?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global WP_Query $wp_query Global WP_Query instance.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_main_query() {&nbsp;</div></li><li><div>      global $wp_the_query;&nbsp;</div></li><li><div>      return $wp_the_query === $this;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set up global post data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 Added the ability to pass a post ID to `$post`.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global int             $id</span>&nbsp;</div></li><li><div><span class="comment">   * @global WP_User         $authordata</span>&nbsp;</div></li><li><div><span class="comment">   * @global string|int|bool $currentday</span>&nbsp;</div></li><li><div><span class="comment">   * @global string|int|bool $currentmonth</span>&nbsp;</div></li><li><div><span class="comment">   * @global int             $page</span>&nbsp;</div></li><li><div><span class="comment">   * @global array           $pages</span>&nbsp;</div></li><li><div><span class="comment">   * @global int             $multipage</span>&nbsp;</div></li><li><div><span class="comment">   * @global int             $more</span>&nbsp;</div></li><li><div><span class="comment">   * @global int             $numpages</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post|object|int $post WP_Post instance or Post ID/object.</span>&nbsp;</div></li><li><div><span class="comment">   * @return true True when finished.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function setup_postdata( $post ) {&nbsp;</div></li><li><div>      global $id, $authordata, $currentday, $currentmonth, $page, $pages, $multipage, $more, $numpages;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! ( $post instanceof WP_Post ) ) {&nbsp;</div></li><li><div>          $post = get_post( $post );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $post ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $id = (int) $post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $authordata = get_userdata($post-&gt;post_author);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $currentday = mysql2date('d.m.y', $post-&gt;post_date, false);&nbsp;</div></li><li><div>      $currentmonth = mysql2date('m', $post-&gt;post_date, false);&nbsp;</div></li><li><div>      $numpages = 1;&nbsp;</div></li><li><div>      $multipage = 0;&nbsp;</div></li><li><div>      $page = $this-&gt;get( 'page' );&nbsp;</div></li><li><div>      if ( ! $page )&nbsp;</div></li><li><div>          $page = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Force full post content when viewing the permalink for the $post, </span>&nbsp;</div></li><li><div><span class="comment">       * or when on an RSS feed. Otherwise respect the 'more' tag.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( $post-&gt;ID === get_queried_object_id() && ( $this-&gt;is_page() || $this-&gt;is_single() ) ) {&nbsp;</div></li><li><div>          $more = 1;&nbsp;</div></li><li><div>      } elseif ( $this-&gt;is_feed() ) {&nbsp;</div></li><li><div>          $more = 1;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $more = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $content = $post-&gt;post_content;&nbsp;</div></li><li><div>      if ( false !== strpos( $content, '&lt;!--nextpage--&gt;' ) ) {&nbsp;</div></li><li><div>          $content = str_replace( &quot;\n&lt;!--nextpage--&gt;\n&quot;, '&lt;!--nextpage--&gt;', $content );&nbsp;</div></li><li><div>          $content = str_replace( &quot;\n&lt;!--nextpage--&gt;&quot;, '&lt;!--nextpage--&gt;', $content );&nbsp;</div></li><li><div>          $content = str_replace( &quot;&lt;!--nextpage--&gt;\n&quot;, '&lt;!--nextpage--&gt;', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Ignore nextpage at the beginning of the content.</span>&nbsp;</div></li><li><div>          if ( 0 === strpos( $content, '&lt;!--nextpage--&gt;' ) )&nbsp;</div></li><li><div>              $content = substr( $content, 15 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $pages = explode('&lt;!--nextpage--&gt;', $content);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $pages = array( $post-&gt;post_content );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the &quot;pages&quot; derived from splitting the post content.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * &quot;Pages&quot; are determined by splitting the post content based on the presence</span>&nbsp;</div></li><li><div><span class="comment">       * of `&lt;!-- nextpage --&gt;` tags.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array   $pages Array of &quot;pages&quot; derived from the post content.</span>&nbsp;</div></li><li><div><span class="comment">       *                       of `&lt;!-- nextpage --&gt;` tags..</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Post $post  Current post object.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $pages = apply_filters( 'content_pagination', $pages, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $numpages = count( $pages );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $numpages &gt; 1 ) {&nbsp;</div></li><li><div>          if ( $page &gt; 1 ) {&nbsp;</div></li><li><div>              $more = 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $multipage = 1;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>           $multipage = 0;&nbsp;</div></li><li><div>       }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires once the post data has been setup.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.1.0 Introduced `$this` parameter.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Post  &$post The Post object (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Query &$this The current Query object (passed by reference).</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action_ref_array( 'the_post', array( &$post, &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * After looping through a nested query, this function</span>&nbsp;</div></li><li><div><span class="comment">   * restores the $post global to the current post in this query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global WP_Post $post</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function reset_postdata() {&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;post ) ) {&nbsp;</div></li><li><div>          $GLOBALS['post'] = $this-&gt;post;&nbsp;</div></li><li><div>          $this-&gt;setup_postdata( $this-&gt;post );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Lazyload term meta for posts in the loop.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated 4.5.0 See wp_queue_posts_for_term_meta_lazyload().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $check</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $term_id</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function lazyload_term_meta( $check, $term_id ) {&nbsp;</div></li><li><div>      _deprecated_function( __METHOD__, '4.5.0' );&nbsp;</div></li><li><div>      return $check;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Lazyload comment meta for comments in the loop.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated 4.5.0 See wp_queue_comments_for_comment_meta_lazyload().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $check</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $comment_id</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function lazyload_comment_meta( $check, $comment_id ) {&nbsp;</div></li><li><div>      _deprecated_function( __METHOD__, '4.5.0' );&nbsp;</div></li><li><div>      return $check;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>