<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7" data-type="file" data-id="4805"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-media | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=56149e5f13af40aac7da8ab074600a46' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-media/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-media%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-media%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-file-wp-includes-media","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-media" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-media</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/media.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress API for media display.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Media</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve additional image sizes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_additional_image_sizes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Additional images size data.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_additional_image_sizes() {&nbsp;</div></li><li><div>  global $_wp_additional_image_sizes;&nbsp;</div></li><li><div>  if ( ! $_wp_additional_image_sizes ) {&nbsp;</div></li><li><div>      $_wp_additional_image_sizes = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $_wp_additional_image_sizes;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Scale down the default size of an image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This is so that the image is a better fit for the editor and theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The `$size` parameter accepts either an array or a string. The supported string</span>&nbsp;</div></li><li><div><span class="comment"> * values are 'thumb' or 'thumbnail' for the given thumbnail size or defaults at</span>&nbsp;</div></li><li><div><span class="comment"> * 128 width and 96 height in pixels. Also supported for the string value is</span>&nbsp;</div></li><li><div><span class="comment"> * 'medium', 'medium_large' and 'full'. The 'full' isn't actually supported, but any value other</span>&nbsp;</div></li><li><div><span class="comment"> * than the supported will result in the content_width size or 500 if that is</span>&nbsp;</div></li><li><div><span class="comment"> * not set.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Finally, there is a filter named {@see 'editor_max_image_size'}, that will be</span>&nbsp;</div></li><li><div><span class="comment"> * called on the calculated array for width and height, respectively. The second</span>&nbsp;</div></li><li><div><span class="comment"> * parameter will be the value that was in the $size parameter. The returned</span>&nbsp;</div></li><li><div><span class="comment"> * type for the hook is an array with the width as the first element and the</span>&nbsp;</div></li><li><div><span class="comment"> * height as the second element.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global int   $content_width</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $width   Width of the image in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $height  Height of the image in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size    Optional. Image size. Accepts any valid image size, or an array</span>&nbsp;</div></li><li><div><span class="comment"> *                              of width and height values in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment"> *                              Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $context Optional. Could be 'display' (like in a theme) or 'edit'</span>&nbsp;</div></li><li><div><span class="comment"> *                              (like inserting into an editor). Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Width and height of what the result image should resize to.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function image_constrain_size_for_editor( $width, $height, $size = 'medium', $context = null ) {&nbsp;</div></li><li><div>  global $content_width;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_wp_additional_image_sizes = wp_get_additional_image_sizes();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $context )&nbsp;</div></li><li><div>      $context = is_admin() ? 'edit' : 'display';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array($size) ) {&nbsp;</div></li><li><div>      $max_width = $size[0];&nbsp;</div></li><li><div>      $max_height = $size[1];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  elseif ( $size == 'thumb' || $size == 'thumbnail' ) {&nbsp;</div></li><li><div>      $max_width = intval(get_option('thumbnail_size_w'));&nbsp;</div></li><li><div>      $max_height = intval(get_option('thumbnail_size_h'));&nbsp;</div></li><li><div>      <span class="comment">// last chance thumbnail size defaults</span>&nbsp;</div></li><li><div>      if ( !$max_width && !$max_height ) {&nbsp;</div></li><li><div>          $max_width = 128;&nbsp;</div></li><li><div>          $max_height = 96;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  elseif ( $size == 'medium' ) {&nbsp;</div></li><li><div>      $max_width = intval(get_option('medium_size_w'));&nbsp;</div></li><li><div>      $max_height = intval(get_option('medium_size_h'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  elseif ( $size == 'medium_large' ) {&nbsp;</div></li><li><div>      $max_width = intval( get_option( 'medium_large_size_w' ) );&nbsp;</div></li><li><div>      $max_height = intval( get_option( 'medium_large_size_h' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( intval( $content_width ) &gt; 0 ) {&nbsp;</div></li><li><div>          $max_width = min( intval( $content_width ), $max_width );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  elseif ( $size == 'large' ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * We're inserting a large size image into the editor. If it's a really</span>&nbsp;</div></li><li><div><span class="comment">       * big image we'll scale it down to fit reasonably within the editor</span>&nbsp;</div></li><li><div><span class="comment">       * itself, and within the theme's content width if it's known. The user</span>&nbsp;</div></li><li><div><span class="comment">       * can resize it in the editor if they wish.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $max_width = intval(get_option('large_size_w'));&nbsp;</div></li><li><div>      $max_height = intval(get_option('large_size_h'));&nbsp;</div></li><li><div>      if ( intval($content_width) &gt; 0 ) {&nbsp;</div></li><li><div>          $max_width = min( intval($content_width), $max_width );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } elseif ( ! empty( $_wp_additional_image_sizes ) && in_array( $size, array_keys( $_wp_additional_image_sizes ) ) ) {&nbsp;</div></li><li><div>      $max_width = intval( $_wp_additional_image_sizes[$size]['width'] );&nbsp;</div></li><li><div>      $max_height = intval( $_wp_additional_image_sizes[$size]['height'] );&nbsp;</div></li><li><div>      <span class="comment">// Only in admin. Assume that theme authors know what they're doing.</span>&nbsp;</div></li><li><div>      if ( intval( $content_width ) &gt; 0 && 'edit' === $context ) {&nbsp;</div></li><li><div>          $max_width = min( intval( $content_width ), $max_width );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">// $size == 'full' has no constraint</span>&nbsp;</div></li><li><div>  else {&nbsp;</div></li><li><div>      $max_width = $width;&nbsp;</div></li><li><div>      $max_height = $height;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the maximum image size dimensions for the editor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array        $max_image_size An array with the width as the first element, </span>&nbsp;</div></li><li><div><span class="comment">   *                                     and the height as the second element.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $size           Size of what the result image should be.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $context        The context the image is being resized for.</span>&nbsp;</div></li><li><div><span class="comment">   *                                     Possible values are 'display' (like in a theme)</span>&nbsp;</div></li><li><div><span class="comment">   *                                     or 'edit' (like inserting into an editor).</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  list( $max_width, $max_height ) = apply_filters( 'editor_max_image_size', array( $max_width, $max_height ), $size, $context );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return wp_constrain_dimensions( $width, $height, $max_width, $max_height );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve width and height attributes using given width and height values.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Both attributes are required in the sense that both parameters must have a</span>&nbsp;</div></li><li><div><span class="comment"> * value, but are optional in that if you set them to false or null, then they</span>&nbsp;</div></li><li><div><span class="comment"> * will not be added to the returned string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You can set the value using a string, but it will only take numeric values.</span>&nbsp;</div></li><li><div><span class="comment"> * If you wish to put 'px' after the numbers, then it will be stripped out of</span>&nbsp;</div></li><li><div><span class="comment"> * the return.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|string $width  Image width in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|string $height Image height in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML attributes for width and, or height.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function image_hwstring( $width, $height ) {&nbsp;</div></li><li><div>  $out = '';&nbsp;</div></li><li><div>  if ($width)&nbsp;</div></li><li><div>      $out .= 'width=&quot;'.intval($width).'&quot; ';&nbsp;</div></li><li><div>  if ($height)&nbsp;</div></li><li><div>      $out .= 'height=&quot;'.intval($height).'&quot; ';&nbsp;</div></li><li><div>  return $out;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Scale an image to fit a particular size (such as 'thumb' or 'medium').</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Array with image url, width, height, and whether is intermediate size, in</span>&nbsp;</div></li><li><div><span class="comment"> * that order is returned on success is returned. $is_intermediate is true if</span>&nbsp;</div></li><li><div><span class="comment"> * $url is a resized image, false if it is the original.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The URL might be the original image, or it might be a resized version. This</span>&nbsp;</div></li><li><div><span class="comment"> * function won't create a new resized copy, it will just return an already</span>&nbsp;</div></li><li><div><span class="comment"> * resized one if it exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A plugin may use the {@see 'image_downsize'} filter to hook into and offer image</span>&nbsp;</div></li><li><div><span class="comment"> * resizing services for images. The hook must return an array with the same</span>&nbsp;</div></li><li><div><span class="comment"> * elements that are returned in the function. The first element being the URL</span>&nbsp;</div></li><li><div><span class="comment"> * to the new image that was resized.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $id   Attachment ID for image.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $size Optional. Image size to scale to. Accepts any valid image size, </span>&nbsp;</div></li><li><div><span class="comment"> *                           or an array of width and height values in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment"> *                           Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|array Array containing the image URL, width, height, and boolean for whether</span>&nbsp;</div></li><li><div><span class="comment"> *                     the image is an intermediate size. False on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function image_downsize( $id, $size = 'medium' ) {&nbsp;</div></li><li><div>  $is_image = wp_attachment_is_image( $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to preempt the output of image_downsize().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a truthy value to the filter will effectively short-circuit</span>&nbsp;</div></li><li><div><span class="comment">   * down-sizing the image, returning that value as output instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool         $downsize Whether to short-circuit the image downsize. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int          $id       Attachment ID for image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|string $size     Size of image. Image size or array of width and height values (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   *                               Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( $out = apply_filters( 'image_downsize', false, $id, $size ) ) {&nbsp;</div></li><li><div>      return $out;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $img_url = wp_get_attachment_url($id);&nbsp;</div></li><li><div>  $meta = wp_get_attachment_metadata($id);&nbsp;</div></li><li><div>  $width = $height = 0;&nbsp;</div></li><li><div>  $is_intermediate = false;&nbsp;</div></li><li><div>  $img_url_basename = wp_basename($img_url);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the file isn't an image, attempt to replace its URL with a rendered image from its meta.</span>&nbsp;</div></li><li><div>  <span class="comment">// Otherwise, a non-image type could be returned.</span>&nbsp;</div></li><li><div>  if ( ! $is_image ) {&nbsp;</div></li><li><div>      if ( ! empty( $meta['sizes'] ) ) {&nbsp;</div></li><li><div>          $img_url = str_replace( $img_url_basename, $meta['sizes']['full']['file'], $img_url );&nbsp;</div></li><li><div>          $img_url_basename = $meta['sizes']['full']['file'];&nbsp;</div></li><li><div>          $width = $meta['sizes']['full']['width'];&nbsp;</div></li><li><div>          $height = $meta['sizes']['full']['height'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// try for a new style intermediate size</span>&nbsp;</div></li><li><div>  if ( $intermediate = image_get_intermediate_size($id, $size) ) {&nbsp;</div></li><li><div>      $img_url = str_replace($img_url_basename, $intermediate['file'], $img_url);&nbsp;</div></li><li><div>      $width = $intermediate['width'];&nbsp;</div></li><li><div>      $height = $intermediate['height'];&nbsp;</div></li><li><div>      $is_intermediate = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  elseif ( $size == 'thumbnail' ) {&nbsp;</div></li><li><div>      <span class="comment">// fall back to the old thumbnail</span>&nbsp;</div></li><li><div>      if ( ($thumb_file = wp_get_attachment_thumb_file($id)) && $info = getimagesize($thumb_file) ) {&nbsp;</div></li><li><div>          $img_url = str_replace($img_url_basename, wp_basename($thumb_file), $img_url);&nbsp;</div></li><li><div>          $width = $info[0];&nbsp;</div></li><li><div>          $height = $info[1];&nbsp;</div></li><li><div>          $is_intermediate = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( !$width && !$height && isset( $meta['width'], $meta['height'] ) ) {&nbsp;</div></li><li><div>      <span class="comment">// any other type: use the real image</span>&nbsp;</div></li><li><div>      $width = $meta['width'];&nbsp;</div></li><li><div>      $height = $meta['height'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $img_url) {&nbsp;</div></li><li><div>      <span class="comment">// we have the actual image size, but might need to further constrain it if content_width is narrower</span>&nbsp;</div></li><li><div>      list( $width, $height ) = image_constrain_size_for_editor( $width, $height, $size );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( $img_url, $width, $height, $is_intermediate );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register a new image size.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Cropping behavior for the image size is dependent on the value of $crop:</span>&nbsp;</div></li><li><div><span class="comment"> * 1. If false (default), images will be scaled, not cropped.</span>&nbsp;</div></li><li><div><span class="comment"> * 2. If an array in the form of array( x_crop_position, y_crop_position ):</span>&nbsp;</div></li><li><div><span class="comment"> *    - x_crop_position accepts 'left' 'center', or 'right'.</span>&nbsp;</div></li><li><div><span class="comment"> *    - y_crop_position accepts 'top', 'center', or 'bottom'.</span>&nbsp;</div></li><li><div><span class="comment"> *    Images will be cropped to the specified dimensions within the defined crop area.</span>&nbsp;</div></li><li><div><span class="comment"> * 3. If true, images will be cropped to the specified dimensions using center positions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_additional_image_sizes Associative array of additional image sizes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $name   Image size identifier.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $width  Image width in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $height Image height in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool|array $crop   Optional. Whether to crop images to specified width and height or resize.</span>&nbsp;</div></li><li><div><span class="comment"> *                           An array can specify positioning of the crop area. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_image_size( $name, $width = 0, $height = 0, $crop = false ) {&nbsp;</div></li><li><div>  global $_wp_additional_image_sizes;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_wp_additional_image_sizes[ $name ] = array(&nbsp;</div></li><li><div>      'width' =&gt; absint( $width ), &nbsp;</div></li><li><div>      'height' =&gt; absint( $height ), &nbsp;</div></li><li><div>      'crop' =&gt; $crop, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check if an image size exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name The image size to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the image size exists, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function has_image_size( $name ) {&nbsp;</div></li><li><div>  $sizes = wp_get_additional_image_sizes();&nbsp;</div></li><li><div>  return isset( $sizes[ $name ] );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove a new image size.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_additional_image_sizes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name The image size to remove.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the image size was successfully removed, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_image_size( $name ) {&nbsp;</div></li><li><div>  global $_wp_additional_image_sizes;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_wp_additional_image_sizes[ $name ] ) ) {&nbsp;</div></li><li><div>      unset( $_wp_additional_image_sizes[ $name ] );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Registers an image size for the post thumbnail.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see add_image_size() for details on cropping behavior.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $width  Image width in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $height Image height in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool|array $crop   Optional. Whether to crop images to specified width and height or resize.</span>&nbsp;</div></li><li><div><span class="comment"> *                           An array can specify positioning of the crop area. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function set_post_thumbnail_size( $width = 0, $height = 0, $crop = false ) {&nbsp;</div></li><li><div>  add_image_size( 'post-thumbnail', $width, $height, $crop );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets an img tag for an image attachment, scaling it down if requested.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The {@see 'get_image_tag_class'} filter allows for changing the class name for the</span>&nbsp;</div></li><li><div><span class="comment"> * image without having to use regular expressions on the HTML content. The</span>&nbsp;</div></li><li><div><span class="comment"> * parameters are: what WordPress will use for the class, the Attachment ID, </span>&nbsp;</div></li><li><div><span class="comment"> * image align value, and the size the image should be.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The second filter, {@see 'get_image_tag'}, has the HTML content, which can then be</span>&nbsp;</div></li><li><div><span class="comment"> * further manipulated by a plugin to change all attribute values and even HTML</span>&nbsp;</div></li><li><div><span class="comment"> * content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $id    Attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $alt   Image Description for the alt attribute.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $title Image Description for the title attribute.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $align Part of the class name for aligning the image.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size  Optional. Registered image size to retrieve a tag for. Accepts any</span>&nbsp;</div></li><li><div><span class="comment"> *                            valid image size, or an array of width and height values in pixels</span>&nbsp;</div></li><li><div><span class="comment"> *                            (in that order). Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML IMG element for given image attachment</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_image_tag( $id, $alt, $title, $align, $size = 'medium' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  list( $img_src, $width, $height ) = image_downsize($id, $size);&nbsp;</div></li><li><div>  $hwstring = image_hwstring($width, $height);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $title = $title ? 'title=&quot;' . esc_attr( $title ) . '&quot; ' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $class = 'align' . esc_attr($align) .' size-' . esc_attr($size) . ' wp-image-' . $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of the attachment's image tag class attribute.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $class CSS class name or space-separated list of classes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int          $id    Attachment ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $align Part of the class name for aligning the image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $size  Size of image. Image size or array of width and height values (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   *                            Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $class = apply_filters( 'get_image_tag_class', $class, $id, $align, $size );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html = '&lt;img src=&quot;' . esc_attr($img_src) . '&quot; alt=&quot;' . esc_attr($alt) . '&quot; ' . $title . $hwstring . 'class=&quot;' . $class . '&quot; /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the HTML content for the image tag.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $html  HTML content for the image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int          $id    Attachment ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $alt   Alternate text.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $title Attachment title.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $align Part of the class name for aligning the image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $size  Size of image. Image size or array of width and height values (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   *                            Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'get_image_tag', $html, $id, $alt, $title, $align, $size );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Calculates the new dimensions for a down-sampled image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If either width or height are empty, no constraint is applied on</span>&nbsp;</div></li><li><div><span class="comment"> * that dimension.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $current_width  Current width of the image.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $current_height Current height of the image.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $max_width      Optional. Max width in pixels to constrain to. Default 0.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $max_height     Optional. Max height in pixels to constrain to. Default 0.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array First item is the width, the second item is the height.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_constrain_dimensions( $current_width, $current_height, $max_width = 0, $max_height = 0 ) {&nbsp;</div></li><li><div>  if ( !$max_width && !$max_height )&nbsp;</div></li><li><div>      return array( $current_width, $current_height );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $width_ratio = $height_ratio = 1.0;&nbsp;</div></li><li><div>  $did_width = $did_height = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $max_width &gt; 0 && $current_width &gt; 0 && $current_width &gt; $max_width ) {&nbsp;</div></li><li><div>      $width_ratio = $max_width / $current_width;&nbsp;</div></li><li><div>      $did_width = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $max_height &gt; 0 && $current_height &gt; 0 && $current_height &gt; $max_height ) {&nbsp;</div></li><li><div>      $height_ratio = $max_height / $current_height;&nbsp;</div></li><li><div>      $did_height = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Calculate the larger/smaller ratios</span>&nbsp;</div></li><li><div>  $smaller_ratio = min( $width_ratio, $height_ratio );&nbsp;</div></li><li><div>  $larger_ratio = max( $width_ratio, $height_ratio );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( (int) round( $current_width * $larger_ratio ) &gt; $max_width || (int) round( $current_height * $larger_ratio ) &gt; $max_height ) {&nbsp;</div></li><li><div>       <span class="comment">// The larger ratio is too big. It would result in an overflow.</span>&nbsp;</div></li><li><div>      $ratio = $smaller_ratio;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// The larger ratio fits, and is likely to be a more &quot;snug&quot; fit.</span>&nbsp;</div></li><li><div>      $ratio = $larger_ratio;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Very small dimensions may result in 0, 1 should be the minimum.</span>&nbsp;</div></li><li><div>  $w = max ( 1, (int) round( $current_width  * $ratio ) );&nbsp;</div></li><li><div>  $h = max ( 1, (int) round( $current_height * $ratio ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Sometimes, due to rounding, we'll end up with a result like this: 465x700 in a 177x177 box is 117x176... a pixel short</span>&nbsp;</div></li><li><div>  <span class="comment">// We also have issues with recursive calls resulting in an ever-changing result. Constraining to the result of a constraint should yield the original result.</span>&nbsp;</div></li><li><div>  <span class="comment">// Thus we look for dimensions that are one pixel shy of the max value and bump them up</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Note: $did_width means it is possible $smaller_ratio == $width_ratio.</span>&nbsp;</div></li><li><div>  if ( $did_width && $w == $max_width - 1 ) {&nbsp;</div></li><li><div>      $w = $max_width; <span class="comment"><span class="comment">// Round it up</span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Note: $did_height means it is possible $smaller_ratio == $height_ratio.</span>&nbsp;</div></li><li><div>  if ( $did_height && $h == $max_height - 1 ) {&nbsp;</div></li><li><div>      $h = $max_height; <span class="comment"><span class="comment">// Round it up</span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters dimensions to constrain down-sampled images to.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $dimensions     The image width and height.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int     $current_width  The current width of the image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int     $current_height The current height of the image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int     $max_width      The maximum width permitted.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int     $max_height     The maximum height permitted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_constrain_dimensions', array( $w, $h ), $current_width, $current_height, $max_width, $max_height );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves calculated resize dimensions for use in WP_Image_Editor.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Calculates dimensions and coordinates for a resized image that fits</span>&nbsp;</div></li><li><div><span class="comment"> * within a specified width and height.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Cropping behavior is dependent on the value of $crop:</span>&nbsp;</div></li><li><div><span class="comment"> * 1. If false (default), images will not be cropped.</span>&nbsp;</div></li><li><div><span class="comment"> * 2. If an array in the form of array( x_crop_position, y_crop_position ):</span>&nbsp;</div></li><li><div><span class="comment"> *    - x_crop_position accepts 'left' 'center', or 'right'.</span>&nbsp;</div></li><li><div><span class="comment"> *    - y_crop_position accepts 'top', 'center', or 'bottom'.</span>&nbsp;</div></li><li><div><span class="comment"> *    Images will be cropped to the specified dimensions within the defined crop area.</span>&nbsp;</div></li><li><div><span class="comment"> * 3. If true, images will be cropped to the specified dimensions using center positions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $orig_w Original width in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $orig_h Original height in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $dest_w New width in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $dest_h New height in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool|array $crop   Optional. Whether to crop image to specified width and height or resize.</span>&nbsp;</div></li><li><div><span class="comment"> *                           An array can specify positioning of the crop area. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|array False on failure. Returned array matches parameters for `imagecopyresampled()`.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function image_resize_dimensions( $orig_w, $orig_h, $dest_w, $dest_h, $crop = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($orig_w &lt;= 0 || $orig_h &lt;= 0)&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  <span class="comment">// at least one of dest_w or dest_h must be specific</span>&nbsp;</div></li><li><div>  if ($dest_w &lt;= 0 && $dest_h &lt;= 0)&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to preempt calculating the image resize dimensions.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a non-null value to the filter will effectively short-circuit</span>&nbsp;</div></li><li><div><span class="comment">   * image_resize_dimensions(), returning that value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param null|mixed $null   Whether to preempt output of the resize dimensions.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int        $orig_w Original width in pixels.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int        $orig_h Original height in pixels.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int        $dest_w New width in pixels.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int        $dest_h New height in pixels.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool|array $crop   Whether to crop image to specified width and height or resize.</span>&nbsp;</div></li><li><div><span class="comment">   *                           An array can specify positioning of the crop area. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $output = apply_filters( 'image_resize_dimensions', null, $orig_w, $orig_h, $dest_w, $dest_h, $crop );&nbsp;</div></li><li><div>  if ( null !== $output )&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $crop ) {&nbsp;</div></li><li><div>      <span class="comment">// crop the largest possible portion of the original image that we can size to $dest_w x $dest_h</span>&nbsp;</div></li><li><div>      $aspect_ratio = $orig_w / $orig_h;&nbsp;</div></li><li><div>      $new_w = min($dest_w, $orig_w);&nbsp;</div></li><li><div>      $new_h = min($dest_h, $orig_h);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $new_w ) {&nbsp;</div></li><li><div>          $new_w = (int) round( $new_h * $aspect_ratio );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $new_h ) {&nbsp;</div></li><li><div>          $new_h = (int) round( $new_w / $aspect_ratio );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $size_ratio = max($new_w / $orig_w, $new_h / $orig_h);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $crop_w = round($new_w / $size_ratio);&nbsp;</div></li><li><div>      $crop_h = round($new_h / $size_ratio);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_array( $crop ) || count( $crop ) !== 2 ) {&nbsp;</div></li><li><div>          $crop = array( 'center', 'center' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      list( $x, $y ) = $crop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'left' === $x ) {&nbsp;</div></li><li><div>          $s_x = 0;&nbsp;</div></li><li><div>      } elseif ( 'right' === $x ) {&nbsp;</div></li><li><div>          $s_x = $orig_w - $crop_w;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $s_x = floor( ( $orig_w - $crop_w ) / 2 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'top' === $y ) {&nbsp;</div></li><li><div>          $s_y = 0;&nbsp;</div></li><li><div>      } elseif ( 'bottom' === $y ) {&nbsp;</div></li><li><div>          $s_y = $orig_h - $crop_h;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $s_y = floor( ( $orig_h - $crop_h ) / 2 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// don't crop, just resize using $dest_w x $dest_h as a maximum bounding box</span>&nbsp;</div></li><li><div>      $crop_w = $orig_w;&nbsp;</div></li><li><div>      $crop_h = $orig_h;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s_x = 0;&nbsp;</div></li><li><div>      $s_y = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      list( $new_w, $new_h ) = wp_constrain_dimensions( $orig_w, $orig_h, $dest_w, $dest_h );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// if the resulting image would be the same size or larger we don't want to resize it</span>&nbsp;</div></li><li><div>  if ( $new_w &gt;= $orig_w && $new_h &gt;= $orig_h && $dest_w != $orig_w && $dest_h != $orig_h ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// the return array matches the parameters to imagecopyresampled()</span>&nbsp;</div></li><li><div>  <span class="comment">// int dst_x, int dst_y, int src_x, int src_y, int dst_w, int dst_h, int src_w, int src_h</span>&nbsp;</div></li><li><div>  return array( 0, 0, (int) $s_x, (int) $s_y, (int) $new_w, (int) $new_h, (int) $crop_w, (int) $crop_h );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Resizes an image to make a thumbnail or intermediate size.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The returned array has the file size, the image width, and image height. The</span>&nbsp;</div></li><li><div><span class="comment"> * {@see 'image_make_intermediate_size'} filter can be used to hook in and change the</span>&nbsp;</div></li><li><div><span class="comment"> * values of the returned array. The only parameter is the resized file path.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file   File path.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $width  Image width.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $height Image height.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $crop   Optional. Whether to crop image to specified width and height or resize.</span>&nbsp;</div></li><li><div><span class="comment"> *                       Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|array False, if no image was created. Metadata array on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function image_make_intermediate_size( $file, $width, $height, $crop = false ) {&nbsp;</div></li><li><div>  if ( $width || $height ) {&nbsp;</div></li><li><div>      $editor = wp_get_image_editor( $file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_wp_error( $editor ) || is_wp_error( $editor-&gt;resize( $width, $height, $crop ) ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $resized_file = $editor-&gt;save();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_wp_error( $resized_file ) && $resized_file ) {&nbsp;</div></li><li><div>          unset( $resized_file['path'] );&nbsp;</div></li><li><div>          return $resized_file;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Helper function to test if aspect ratios for two images match.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $source_width  Width of the first image in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $source_height Height of the first image in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $target_width  Width of the second image in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $target_height Height of the second image in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if aspect ratios match within 1px. False if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_image_matches_ratio( $source_width, $source_height, $target_width, $target_height ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * To test for varying crops, we constrain the dimensions of the larger image</span>&nbsp;</div></li><li><div><span class="comment">   * to the dimensions of the smaller image and see if they match.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( $source_width &gt; $target_width ) {&nbsp;</div></li><li><div>      $constrained_size = wp_constrain_dimensions( $source_width, $source_height, $target_width );&nbsp;</div></li><li><div>      $expected_size = array( $target_width, $target_height );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $constrained_size = wp_constrain_dimensions( $target_width, $target_height, $source_width );&nbsp;</div></li><li><div>      $expected_size = array( $source_width, $source_height );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the image dimensions are within 1px of the expected size, we consider it a match.</span>&nbsp;</div></li><li><div>  $matched = ( abs( $constrained_size[0] - $expected_size[0] ) &lt;= 1 && abs( $constrained_size[1] - $expected_size[1] ) &lt;= 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $matched;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the image's intermediate size (resized) path, width, and height.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The $size parameter can be an array with the width and height respectively.</span>&nbsp;</div></li><li><div><span class="comment"> * If the size matches the 'sizes' metadata array for width and height, then it</span>&nbsp;</div></li><li><div><span class="comment"> * will be used. If there is no direct match, then the nearest image size larger</span>&nbsp;</div></li><li><div><span class="comment"> * than the specified size will be used. If nothing is found, then the function</span>&nbsp;</div></li><li><div><span class="comment"> * will break out and return false.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The metadata 'sizes' is used for compatible sizes that can be used for the</span>&nbsp;</div></li><li><div><span class="comment"> * parameter $size value.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The url path will be given, when the $size parameter is a string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If you are passing an array for the $size, you should consider using</span>&nbsp;</div></li><li><div><span class="comment"> * add_image_size() so that a cropped version is generated. It's much more</span>&nbsp;</div></li><li><div><span class="comment"> * efficient than having to find the closest-sized image and then having the</span>&nbsp;</div></li><li><div><span class="comment"> * browser scale down the image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $post_id Attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $size    Optional. Image size. Accepts any valid image size, or an array</span>&nbsp;</div></li><li><div><span class="comment"> *                              of width and height values in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment"> *                              Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|array $data {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of file relative path, width, and height on success. Additionally includes absolute</span>&nbsp;</div></li><li><div><span class="comment"> *     path and URL if registered size is passed to $size parameter. False on failure.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $file   Image's path relative to uploads directory</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $width  Width of image</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $height Height of image</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $path   Image's absolute filesystem path.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $url    Image's URL.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function image_get_intermediate_size( $post_id, $size = 'thumbnail' ) {&nbsp;</div></li><li><div>  if ( ! $size || ! is_array( $imagedata = wp_get_attachment_metadata( $post_id ) ) || empty( $imagedata['sizes'] ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Find the best match when '$size' is an array.</span>&nbsp;</div></li><li><div>  if ( is_array( $size ) ) {&nbsp;</div></li><li><div>      $candidates = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $imagedata['file'] ) && isset( $imagedata['sizes']['full'] ) ) {&nbsp;</div></li><li><div>          $imagedata['height'] = $imagedata['sizes']['full']['height'];&nbsp;</div></li><li><div>          $imagedata['width'] = $imagedata['sizes']['full']['width'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $imagedata['sizes'] as $_size =&gt; $data ) {&nbsp;</div></li><li><div>          <span class="comment">// If there's an exact match to an existing image size, short circuit.</span>&nbsp;</div></li><li><div>          if ( $data['width'] == $size[0] && $data['height'] == $size[1] ) {&nbsp;</div></li><li><div>              $candidates[ $data['width'] * $data['height'] ] = $data;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If it's not an exact match, consider larger sizes with the same aspect ratio.</span>&nbsp;</div></li><li><div>          if ( $data['width'] &gt;= $size[0] && $data['height'] &gt;= $size[1] ) {&nbsp;</div></li><li><div>              <span class="comment">// If '0' is passed to either size, we test ratios against the original file.</span>&nbsp;</div></li><li><div>              if ( 0 === $size[0] || 0 === $size[1] ) {&nbsp;</div></li><li><div>                  $same_ratio = wp_image_matches_ratio( $data['width'], $data['height'], $imagedata['width'], $imagedata['height'] );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $same_ratio = wp_image_matches_ratio( $data['width'], $data['height'], $size[0], $size[1] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $same_ratio ) {&nbsp;</div></li><li><div>                  $candidates[ $data['width'] * $data['height'] ] = $data;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $candidates ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Sort the array by size if we have more than one candidate.</span>&nbsp;</div></li><li><div>          if ( 1 &lt; count( $candidates ) ) {&nbsp;</div></li><li><div>              ksort( $candidates );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $data = array_shift( $candidates );&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * When the size requested is smaller than the thumbnail dimensions, we</span>&nbsp;</div></li><li><div><span class="comment">       * fall back to the thumbnail size to maintain backwards compatibility with</span>&nbsp;</div></li><li><div><span class="comment">       * pre 4.6 versions of WordPress.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      } elseif ( ! empty( $imagedata['sizes']['thumbnail'] ) && $imagedata['sizes']['thumbnail']['width'] &gt;= $size[0] && $imagedata['sizes']['thumbnail']['width'] &gt;= $size[1] ) {&nbsp;</div></li><li><div>          $data = $imagedata['sizes']['thumbnail'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Constrain the width and height attributes to the requested values.</span>&nbsp;</div></li><li><div>      list( $data['width'], $data['height'] ) = image_constrain_size_for_editor( $data['width'], $data['height'], $size );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } elseif ( ! empty( $imagedata['sizes'][ $size ] ) ) {&nbsp;</div></li><li><div>      $data = $imagedata['sizes'][ $size ];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If we still don't have a match at this point, return false.</span>&nbsp;</div></li><li><div>  if ( empty( $data ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// include the full filesystem path of the intermediate file</span>&nbsp;</div></li><li><div>  if ( empty( $data['path'] ) && ! empty( $data['file'] ) && ! empty( $imagedata['file'] ) ) {&nbsp;</div></li><li><div>      $file_url = wp_get_attachment_url($post_id);&nbsp;</div></li><li><div>      $data['path'] = path_join( dirname($imagedata['file']), $data['file'] );&nbsp;</div></li><li><div>      $data['url'] = path_join( dirname($file_url), $data['file'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the output of image_get_intermediate_size()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see image_get_intermediate_size()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array        $data    Array of file relative path, width, and height on success. May also include</span>&nbsp;</div></li><li><div><span class="comment">   *                              file absolute path and URL.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int          $post_id The post_id of the image attachment</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $size    Registered image size or flat array of initially-requested height and width</span>&nbsp;</div></li><li><div><span class="comment">   *                              dimensions (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'image_get_intermediate_size', $data, $post_id, $size );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets the available intermediate image sizes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Returns a filtered array of image size strings.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_intermediate_image_sizes() {&nbsp;</div></li><li><div>  $_wp_additional_image_sizes = wp_get_additional_image_sizes();&nbsp;</div></li><li><div>  $image_sizes = array('thumbnail', 'medium', 'medium_large', 'large'); <span class="comment">// Standard sizes</span>&nbsp;</div></li><li><div>  if ( ! empty( $_wp_additional_image_sizes ) ) {&nbsp;</div></li><li><div>      $image_sizes = array_merge( $image_sizes, array_keys( $_wp_additional_image_sizes ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of intermediate image sizes.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $image_sizes An array of intermediate image sizes. Defaults</span>&nbsp;</div></li><li><div><span class="comment">   *                           are 'thumbnail', 'medium', 'medium_large', 'large'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'intermediate_image_sizes', $image_sizes );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve an image to represent an attachment.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A mime icon for files, thumbnail or intermediate size for images.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The returned array contains four values: the URL of the attachment image src, </span>&nbsp;</div></li><li><div><span class="comment"> * the width of the image file, the height of the image file, and a boolean</span>&nbsp;</div></li><li><div><span class="comment"> * representing whether the returned array describes an intermediate (generated)</span>&nbsp;</div></li><li><div><span class="comment"> * image size or the original, full-sized upload.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $attachment_id Image attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size          Optional. Image size. Accepts any valid image size, or an array of width</span>&nbsp;</div></li><li><div><span class="comment"> *                                    and height values in pixels (in that order). Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $icon          Optional. Whether the image should be treated as an icon. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|array Returns an array (url, width, height, is_intermediate), or false, if no image is available.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_attachment_image_src( $attachment_id, $size = 'thumbnail', $icon = false ) {&nbsp;</div></li><li><div>  <span class="comment">// get a thumbnail or intermediate image if there is one</span>&nbsp;</div></li><li><div>  $image = image_downsize( $attachment_id, $size );&nbsp;</div></li><li><div>  if ( ! $image ) {&nbsp;</div></li><li><div>      $src = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $icon && $src = wp_mime_type_icon( $attachment_id ) ) {&nbsp;</div></li><li><div>          <span class="comment">/** This filter is documented in wp-includes/post.php */</span>&nbsp;</div></li><li><div>          $icon_dir = apply_filters( 'icon_dir', ABSPATH . WPINC . '/images/media' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $src_file = $icon_dir . '/' . wp_basename( $src );&nbsp;</div></li><li><div>          @list( $width, $height ) = getimagesize( $src_file );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $src && $width && $height ) {&nbsp;</div></li><li><div>          $image = array( $src, $width, $height );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the image src result.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|false  $image         Either array with src, width & height, icon src, or false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int          $attachment_id Image attachment ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $size          Size of image. Image size or array of width and height values</span>&nbsp;</div></li><li><div><span class="comment">   *                                    (in that order). Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool         $icon          Whether the image should be treated as an icon. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_get_attachment_image_src', $image, $attachment_id, $size, $icon );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get an HTML img element representing an image attachment</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * While `$size` will accept an array, it is better to register a size with</span>&nbsp;</div></li><li><div><span class="comment"> * add_image_size() so that a cropped version is generated. It's much more</span>&nbsp;</div></li><li><div><span class="comment"> * efficient than having to find the closest-sized image and then having the</span>&nbsp;</div></li><li><div><span class="comment"> * browser scale down the image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $attachment_id Image attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size          Optional. Image size. Accepts any valid image size, or an array of width</span>&nbsp;</div></li><li><div><span class="comment"> *                                    and height values in pixels (in that order). Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $icon          Optional. Whether the image should be treated as an icon. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $attr          Optional. Attributes for the image markup. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML img element or empty string on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_attachment_image($attachment_id, $size = 'thumbnail', $icon = false, $attr = '') {&nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>  $image = wp_get_attachment_image_src($attachment_id, $size, $icon);&nbsp;</div></li><li><div>  if ( $image ) {&nbsp;</div></li><li><div>      list($src, $width, $height) = $image;&nbsp;</div></li><li><div>      $hwstring = image_hwstring($width, $height);&nbsp;</div></li><li><div>      $size_class = $size;&nbsp;</div></li><li><div>      if ( is_array( $size_class ) ) {&nbsp;</div></li><li><div>          $size_class = join( 'x', $size_class );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $attachment = get_post($attachment_id);&nbsp;</div></li><li><div>      $default_attr = array(&nbsp;</div></li><li><div>          'src' =&gt; $src, &nbsp;</div></li><li><div>          'class' =&gt; &quot;attachment-$size_class size-$size_class&quot;, &nbsp;</div></li><li><div>          'alt' =&gt; trim( strip_tags( get_post_meta( $attachment_id, '_wp_attachment_image_alt', true ) ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attr = wp_parse_args( $attr, $default_attr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Generate 'srcset' and 'sizes' if not already present.</span>&nbsp;</div></li><li><div>      if ( empty( $attr['srcset'] ) ) {&nbsp;</div></li><li><div>          $image_meta = wp_get_attachment_metadata( $attachment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_array( $image_meta ) ) {&nbsp;</div></li><li><div>              $size_array = array( absint( $width ), absint( $height ) );&nbsp;</div></li><li><div>              $srcset = wp_calculate_image_srcset( $size_array, $src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>              $sizes = wp_calculate_image_sizes( $size_array, $src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $srcset && ( $sizes || ! empty( $attr['sizes'] ) ) ) {&nbsp;</div></li><li><div>                  $attr['srcset'] = $srcset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( empty( $attr['sizes'] ) ) {&nbsp;</div></li><li><div>                      $attr['sizes'] = $sizes;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the list of attachment image attributes.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array        $attr       Attributes for the image markup.</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Post      $attachment Image attachment post.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string|array $size       Requested size. Image size or array of width and height values</span>&nbsp;</div></li><li><div><span class="comment">       *                                 (in that order). Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $attr = apply_filters( 'wp_get_attachment_image_attributes', $attr, $attachment, $size );&nbsp;</div></li><li><div>      $attr = array_map( 'esc_attr', $attr );&nbsp;</div></li><li><div>      $html = rtrim(&quot;&lt;img $hwstring&quot;);&nbsp;</div></li><li><div>      foreach ( $attr as $name =&gt; $value ) {&nbsp;</div></li><li><div>          $html .= &quot; $name=&quot; . '&quot;' . $value . '&quot;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= ' /&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the URL of an image attachment.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $attachment_id Image attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size          Optional. Image size to retrieve. Accepts any valid image size, or an array</span>&nbsp;</div></li><li><div><span class="comment"> *                                    of width and height values in pixels (in that order). Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $icon          Optional. Whether the image should be treated as an icon. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|false Attachment URL or false if no image is available.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_attachment_image_url( $attachment_id, $size = 'thumbnail', $icon = false ) {&nbsp;</div></li><li><div>  $image = wp_get_attachment_image_src( $attachment_id, $size, $icon );&nbsp;</div></li><li><div>  return isset( $image['0'] ) ? $image['0'] : false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the attachment path relative to the upload directory.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.1</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file Attachment file name.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Attachment path relative to the upload directory.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_get_attachment_relative_path( $file ) {&nbsp;</div></li><li><div>  $dirname = dirname( $file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '.' === $dirname ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false !== strpos( $dirname, 'wp-content/uploads' ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Get the directory name relative to the upload directory (back compat for pre-2.7 uploads)</span>&nbsp;</div></li><li><div>      $dirname = substr( $dirname, strpos( $dirname, 'wp-content/uploads' ) + 18 );&nbsp;</div></li><li><div>      $dirname = ltrim( $dirname, '/' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $dirname;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the image size as array from its meta data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Used for responsive images.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $size_name  Image size. Accepts any valid image size name ('thumbnail', 'medium', etc.).</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $image_meta The image meta data.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|bool Array of width and height values in pixels (in that order)</span>&nbsp;</div></li><li><div><span class="comment"> *                    or false if the size doesn't exist.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_get_image_size_from_meta( $size_name, $image_meta ) {&nbsp;</div></li><li><div>  if ( $size_name === 'full' ) {&nbsp;</div></li><li><div>      return array(&nbsp;</div></li><li><div>          absint( $image_meta['width'] ), &nbsp;</div></li><li><div>          absint( $image_meta['height'] ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  } elseif ( ! empty( $image_meta['sizes'][$size_name] ) ) {&nbsp;</div></li><li><div>      return array(&nbsp;</div></li><li><div>          absint( $image_meta['sizes'][$size_name]['width'] ), &nbsp;</div></li><li><div>          absint( $image_meta['sizes'][$size_name]['height'] ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the value for an image attachment's 'srcset' attribute.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_calculate_image_srcset()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $attachment_id Image attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $size          Optional. Image size. Accepts any valid image size, or an array of</span>&nbsp;</div></li><li><div><span class="comment"> *                                    width and height values in pixels (in that order). Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array        $image_meta    Optional. The image meta data as returned by 'wp_get_attachment_metadata()'.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|bool A 'srcset' value string or false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_attachment_image_srcset( $attachment_id, $size = 'medium', $image_meta = null ) {&nbsp;</div></li><li><div>  if ( ! $image = wp_get_attachment_image_src( $attachment_id, $size ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $image_meta ) ) {&nbsp;</div></li><li><div>      $image_meta = wp_get_attachment_metadata( $attachment_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $image_src = $image[0];&nbsp;</div></li><li><div>  $size_array = array(&nbsp;</div></li><li><div>      absint( $image[1] ), &nbsp;</div></li><li><div>      absint( $image[2] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return wp_calculate_image_srcset( $size_array, $image_src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * A helper function to calculate the image sources to include in a 'srcset' attribute.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $size_array    Array of width and height values in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $image_src     The 'src' of the image.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $image_meta    The image meta data as returned by 'wp_get_attachment_metadata()'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $attachment_id Optional. The image attachment ID to pass to the filter. Default 0.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|bool          The 'srcset' attribute value. False on error or when only one source exists.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_calculate_image_srcset( $size_array, $image_src, $image_meta, $attachment_id = 0 ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Let plugins pre-filter the image meta to be able to fix inconsistencies in the stored data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $image_meta    The image meta data as returned by 'wp_get_attachment_metadata()'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $size_array    Array of width and height values in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $image_src     The 'src' of the image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $attachment_id The image attachment ID or 0 if not supplied.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $image_meta = apply_filters( 'wp_calculate_image_srcset_meta', $image_meta, $size_array, $image_src, $attachment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $image_meta['sizes'] ) || ! isset( $image_meta['file'] ) || strlen( $image_meta['file'] ) &lt; 4 ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $image_sizes = $image_meta['sizes'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the width and height of the image.</span>&nbsp;</div></li><li><div>  $image_width = (int) $size_array[0];&nbsp;</div></li><li><div>  $image_height = (int) $size_array[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail early if error/no width.</span>&nbsp;</div></li><li><div>  if ( $image_width &lt; 1 ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $image_basename = wp_basename( $image_meta['file'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * WordPress flattens animated GIFs into one frame when generating intermediate sizes.</span>&nbsp;</div></li><li><div><span class="comment">   * To avoid hiding animation in user content, if src is a full size GIF, a srcset attribute is not generated.</span>&nbsp;</div></li><li><div><span class="comment">   * If src is an intermediate size GIF, the full size is excluded from srcset to keep a flattened GIF from becoming animated.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( ! isset( $image_sizes['thumbnail']['mime-type'] ) || 'image/gif' !== $image_sizes['thumbnail']['mime-type'] ) {&nbsp;</div></li><li><div>      $image_sizes[] = array(&nbsp;</div></li><li><div>          'width' =&gt; $image_meta['width'], &nbsp;</div></li><li><div>          'height' =&gt; $image_meta['height'], &nbsp;</div></li><li><div>          'file' =&gt; $image_basename, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  } elseif ( strpos( $image_src, $image_meta['file'] ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Retrieve the uploads sub-directory from the full size image.</span>&nbsp;</div></li><li><div>  $dirname = _wp_get_attachment_relative_path( $image_meta['file'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $dirname ) {&nbsp;</div></li><li><div>      $dirname = trailingslashit( $dirname );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $upload_dir = wp_get_upload_dir();&nbsp;</div></li><li><div>  $image_baseurl = trailingslashit( $upload_dir['baseurl'] ) . $dirname;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * If currently on HTTPS, prefer HTTPS URLs when we know they're supported by the domain</span>&nbsp;</div></li><li><div><span class="comment">   * (which is to say, when they share the domain name of the current request).</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( is_ssl() && 'https' !== substr( $image_baseurl, 0, 5 ) && parse_url( $image_baseurl, PHP_URL_HOST ) === $_SERVER['HTTP_HOST'] ) {&nbsp;</div></li><li><div>      $image_baseurl = set_url_scheme( $image_baseurl, 'https' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Images that have been edited in WordPress after being uploaded will</span>&nbsp;</div></li><li><div><span class="comment">   * contain a unique hash. Look for that hash and use it later to filter</span>&nbsp;</div></li><li><div><span class="comment">   * out images that are leftovers from previous versions.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $image_edited = preg_match( '/-e[0-9]{13}/', wp_basename( $image_src ), $image_edit_hash );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the maximum image width to be included in a 'srcset' attribute.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $max_width  The maximum image width to be included in the 'srcset'. Default '1600'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $size_array Array of width and height values in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $max_srcset_image_width = apply_filters( 'max_srcset_image_width', 1600, $size_array );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Array to hold URL candidates.</span>&nbsp;</div></li><li><div>  $sources = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * To make sure the ID matches our image src, we will check to see if any sizes in our attachment</span>&nbsp;</div></li><li><div><span class="comment">   * meta match our $image_src. If no matches are found we don't return a srcset to avoid serving</span>&nbsp;</div></li><li><div><span class="comment">   * an incorrect image. See #35045.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $src_matched = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Loop through available images. Only use images that are resized</span>&nbsp;</div></li><li><div><span class="comment">   * versions of the same edit.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  foreach ( $image_sizes as $image ) {&nbsp;</div></li><li><div>      $is_src = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check if image meta isn't corrupted.</span>&nbsp;</div></li><li><div>      if ( ! is_array( $image ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If the file name is part of the `src`, we've confirmed a match.</span>&nbsp;</div></li><li><div>      if ( ! $src_matched && false !== strpos( $image_src, $dirname . $image['file'] ) ) {&nbsp;</div></li><li><div>          $src_matched = $is_src = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Filter out images that are from previous edits.</span>&nbsp;</div></li><li><div>      if ( $image_edited && ! strpos( $image['file'], $image_edit_hash[0] ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters out images that are wider than '$max_srcset_image_width' unless</span>&nbsp;</div></li><li><div><span class="comment">       * that file is in the 'src' attribute.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( $max_srcset_image_width && $image['width'] &gt; $max_srcset_image_width && ! $is_src ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If the image dimensions are within 1px of the expected size, use it.</span>&nbsp;</div></li><li><div>      if ( wp_image_matches_ratio( $image_width, $image_height, $image['width'], $image['height'] ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Add the URL, descriptor, and value to the sources array to be returned.</span>&nbsp;</div></li><li><div>          $source = array(&nbsp;</div></li><li><div>              'url' =&gt; $image_baseurl . $image['file'], &nbsp;</div></li><li><div>              'descriptor' =&gt; 'w', &nbsp;</div></li><li><div>              'value' =&gt; $image['width'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// The 'src' image has to be the first in the 'srcset', because of a bug in iOS8. See #35030.</span>&nbsp;</div></li><li><div>          if ( $is_src ) {&nbsp;</div></li><li><div>              $sources = array( $image['width'] =&gt; $source ) + $sources;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $sources[ $image['width'] ] = $source;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters an image's 'srcset' sources.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $sources {</span>&nbsp;</div></li><li><div><span class="comment">   *     One or more arrays of source data to include in the 'srcset'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $width {</span>&nbsp;</div></li><li><div><span class="comment">   *         @type string $url        The URL of an image source.</span>&nbsp;</div></li><li><div><span class="comment">   *         @type string $descriptor The descriptor type used in the image candidate string, </span>&nbsp;</div></li><li><div><span class="comment">   *                                  either 'w' or 'x'.</span>&nbsp;</div></li><li><div><span class="comment">   *         @type int    $value      The source width if paired with a 'w' descriptor, or a</span>&nbsp;</div></li><li><div><span class="comment">   *                                  pixel density value if paired with an 'x' descriptor.</span>&nbsp;</div></li><li><div><span class="comment">   *     }</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $size_array    Array of width and height values in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $image_src     The 'src' of the image.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $image_meta    The image meta data as returned by 'wp_get_attachment_metadata()'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $attachment_id Image attachment ID or 0.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $sources = apply_filters( 'wp_calculate_image_srcset', $sources, $size_array, $image_src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only return a 'srcset' value if there is more than one source.</span>&nbsp;</div></li><li><div>  if ( ! $src_matched || count( $sources ) &lt; 2 ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $srcset = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $sources as $source ) {&nbsp;</div></li><li><div>      $srcset .= str_replace( ' ', '%20', $source['url'] ) . ' ' . $source['value'] . $source['descriptor'] . ', ';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return rtrim( $srcset, ', ' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the value for an image attachment's 'sizes' attribute.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_calculate_image_sizes()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $attachment_id Image attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $size          Optional. Image size. Accepts any valid image size, or an array of width</span>&nbsp;</div></li><li><div><span class="comment"> *                                    and height values in pixels (in that order). Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array        $image_meta    Optional. The image meta data as returned by 'wp_get_attachment_metadata()'.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|bool A valid source size value for use in a 'sizes' attribute or false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_attachment_image_sizes( $attachment_id, $size = 'medium', $image_meta = null ) {&nbsp;</div></li><li><div>  if ( ! $image = wp_get_attachment_image_src( $attachment_id, $size ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $image_meta ) ) {&nbsp;</div></li><li><div>      $image_meta = wp_get_attachment_metadata( $attachment_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $image_src = $image[0];&nbsp;</div></li><li><div>  $size_array = array(&nbsp;</div></li><li><div>      absint( $image[1] ), &nbsp;</div></li><li><div>      absint( $image[2] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return wp_calculate_image_sizes( $size_array, $image_src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates a 'sizes' attribute value for an image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $size          Image size to retrieve. Accepts any valid image size, or an array</span>&nbsp;</div></li><li><div><span class="comment"> *                                    of width and height values in pixels (in that order). Default 'medium'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $image_src     Optional. The URL to the image file. Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array        $image_meta    Optional. The image meta data as returned by 'wp_get_attachment_metadata()'.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $attachment_id Optional. Image attachment ID. Either `$image_meta` or `$attachment_id`</span>&nbsp;</div></li><li><div><span class="comment"> *                                    is needed when using the image size name as argument for `$size`. Default 0.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|bool A valid source size value for use in a 'sizes' attribute or false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_calculate_image_sizes( $size, $image_src = null, $image_meta = null, $attachment_id = 0 ) {&nbsp;</div></li><li><div>  $width = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array( $size ) ) {&nbsp;</div></li><li><div>      $width = absint( $size[0] );&nbsp;</div></li><li><div>  } elseif ( is_string( $size ) ) {&nbsp;</div></li><li><div>      if ( ! $image_meta && $attachment_id ) {&nbsp;</div></li><li><div>          $image_meta = wp_get_attachment_metadata( $attachment_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $image_meta ) ) {&nbsp;</div></li><li><div>          $size_array = _wp_get_image_size_from_meta( $size, $image_meta );&nbsp;</div></li><li><div>          if ( $size_array ) {&nbsp;</div></li><li><div>              $width = absint( $size_array[0] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $width ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Setup the default 'sizes' attribute.</span>&nbsp;</div></li><li><div>  $sizes = sprintf( '(max-width: %1$dpx) 100vw, %1$dpx', $width );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the output of 'wp_calculate_image_sizes()'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $sizes         A source size value for use in a 'sizes' attribute.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|string $size          Requested size. Image size or array of width and height values</span>&nbsp;</div></li><li><div><span class="comment">   *                                    in pixels (in that order).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|null  $image_src     The URL to the image file or null.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|null   $image_meta    The image meta data as returned by wp_get_attachment_metadata() or null.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int          $attachment_id Image attachment ID of the original image or 0.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_calculate_image_sizes', $sizes, $size, $image_src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filters 'img' elements in post content to add 'srcset' and 'sizes' attributes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_image_add_srcset_and_sizes()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content The raw post content to be filtered.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Converted content with 'srcset' and 'sizes' attributes added to images.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_make_content_images_responsive( $content ) {&nbsp;</div></li><li><div>  if ( ! preg_match_all( '/&lt;img [^&gt;]+&gt;/', $content, $matches ) ) {&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $selected_images = $attachment_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach( $matches[0] as $image ) {&nbsp;</div></li><li><div>      if ( false === strpos( $image, ' srcset=' ) && preg_match( '/wp-image-([0-9]+)/i', $image, $class_id ) &&&nbsp;</div></li><li><div>          ( $attachment_id = absint( $class_id[1] ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * If exactly the same image tag is used more than once, overwrite it.</span>&nbsp;</div></li><li><div><span class="comment">           * All identical tags will be replaced later with 'str_replace()'.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $selected_images[ $image ] = $attachment_id;&nbsp;</div></li><li><div>          <span class="comment">// Overwrite the ID when the same image is included more than once.</span>&nbsp;</div></li><li><div>          $attachment_ids[ $attachment_id ] = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $attachment_ids ) &gt; 1 ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Warm object cache for use with 'get_post_meta()'.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * To avoid making a database call for each image, a single query</span>&nbsp;</div></li><li><div><span class="comment">       * warms the object cache with the meta information for all images.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      update_meta_cache( 'post', array_keys( $attachment_ids ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $selected_images as $image =&gt; $attachment_id ) {&nbsp;</div></li><li><div>      $image_meta = wp_get_attachment_metadata( $attachment_id );&nbsp;</div></li><li><div>      $content = str_replace( $image, wp_image_add_srcset_and_sizes( $image, $image_meta, $attachment_id ), $content );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $content;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds 'srcset' and 'sizes' attributes to an existing 'img' element.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_calculate_image_srcset()</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_calculate_image_sizes()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $image         An HTML 'img' element to be filtered.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $image_meta    The image meta data as returned by 'wp_get_attachment_metadata()'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $attachment_id Image attachment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Converted 'img' element with 'srcset' and 'sizes' attributes added.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_image_add_srcset_and_sizes( $image, $image_meta, $attachment_id ) {&nbsp;</div></li><li><div>  <span class="comment">// Ensure the image meta exists.</span>&nbsp;</div></li><li><div>  if ( empty( $image_meta['sizes'] ) ) {&nbsp;</div></li><li><div>      return $image;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $image_src = preg_match( '/src=&quot;([^&quot;]+)&quot;/', $image, $match_src ) ? $match_src[1] : '';&nbsp;</div></li><li><div>  list( $image_src ) = explode( '?', $image_src );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return early if we couldn't get the image source.</span>&nbsp;</div></li><li><div>  if ( ! $image_src ) {&nbsp;</div></li><li><div>      return $image;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail early if an image has been inserted and later edited.</span>&nbsp;</div></li><li><div>  if ( preg_match( '/-e[0-9]{13}/', $image_meta['file'], $img_edit_hash ) &&&nbsp;</div></li><li><div>      strpos( wp_basename( $image_src ), $img_edit_hash[0] ) === false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $image;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $width = preg_match( '/ width=&quot;([0-9]+)&quot;/', $image, $match_width ) ? (int) $match_width[1]  : 0;&nbsp;</div></li><li><div>  $height = preg_match( '/ height=&quot;([0-9]+)&quot;/', $image, $match_height ) ? (int) $match_height[1] : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $width || ! $height ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * If attempts to parse the size value failed, attempt to use the image meta data to match</span>&nbsp;</div></li><li><div><span class="comment">       * the image file name from 'src' against the available sizes for an attachment.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $image_filename = wp_basename( $image_src );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $image_filename === wp_basename( $image_meta['file'] ) ) {&nbsp;</div></li><li><div>          $width = (int) $image_meta['width'];&nbsp;</div></li><li><div>          $height = (int) $image_meta['height'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          foreach( $image_meta['sizes'] as $image_size_data ) {&nbsp;</div></li><li><div>              if ( $image_filename === $image_size_data['file'] ) {&nbsp;</div></li><li><div>                  $width = (int) $image_size_data['width'];&nbsp;</div></li><li><div>                  $height = (int) $image_size_data['height'];&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $width || ! $height ) {&nbsp;</div></li><li><div>      return $image;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $size_array = array( $width, $height );&nbsp;</div></li><li><div>  $srcset = wp_calculate_image_srcset( $size_array, $image_src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $srcset ) {&nbsp;</div></li><li><div>      <span class="comment">// Check if there is already a 'sizes' attribute.</span>&nbsp;</div></li><li><div>      $sizes = strpos( $image, ' sizes=' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $sizes ) {&nbsp;</div></li><li><div>          $sizes = wp_calculate_image_sizes( $size_array, $image_src, $image_meta, $attachment_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $srcset && $sizes ) {&nbsp;</div></li><li><div>      <span class="comment">// Format the 'srcset' and 'sizes' string and escape attributes.</span>&nbsp;</div></li><li><div>      $attr = sprintf( ' srcset=&quot;%s&quot;', esc_attr( $srcset ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $sizes ) ) {&nbsp;</div></li><li><div>          $attr .= sprintf( ' sizes=&quot;%s&quot;', esc_attr( $sizes ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add 'srcset' and 'sizes' attributes to the image markup.</span>&nbsp;</div></li><li><div>      $image = preg_replace( '/&lt;img ([^&gt;]+?)[\/ ]*&gt;/', '&lt;img $1' . $attr . ' /&gt;', $image );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $image;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds a 'wp-post-image' class to post thumbnails. Internal use only.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Uses the {@see 'begin_fetch_post_thumbnail_html'} and {@see 'end_fetch_post_thumbnail_html'}</span>&nbsp;</div></li><li><div><span class="comment"> * action hooks to dynamically add/remove itself so as to only filter post thumbnails.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @ignore</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr Thumbnail attributes including src, class, alt, title.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Modified array of attributes including the new 'wp-post-image' class.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_post_thumbnail_class_filter( $attr ) {&nbsp;</div></li><li><div>  $attr['class'] .= ' wp-post-image';&nbsp;</div></li><li><div>  return $attr;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds '_wp_post_thumbnail_class_filter' callback to the 'wp_get_attachment_image_attributes'</span>&nbsp;</div></li><li><div><span class="comment"> * filter hook. Internal use only.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @ignore</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr Thumbnail attributes including src, class, alt, title.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_post_thumbnail_class_filter_add( $attr ) {&nbsp;</div></li><li><div>  add_filter( 'wp_get_attachment_image_attributes', '_wp_post_thumbnail_class_filter' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes the '_wp_post_thumbnail_class_filter' callback from the 'wp_get_attachment_image_attributes'</span>&nbsp;</div></li><li><div><span class="comment"> * filter hook. Internal use only.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @ignore</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr Thumbnail attributes including src, class, alt, title.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_post_thumbnail_class_filter_remove( $attr ) {&nbsp;</div></li><li><div>  remove_filter( 'wp_get_attachment_image_attributes', '_wp_post_thumbnail_class_filter' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_shortcode('wp_caption', 'img_caption_shortcode');&nbsp;</div></li><li><div>add_shortcode('caption', 'img_caption_shortcode');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Builds the Caption shortcode output.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Allows a plugin to replace the content that would otherwise be returned. The</span>&nbsp;</div></li><li><div><span class="comment"> * filter is {@see 'img_caption_shortcode'} and passes an empty string, the attr</span>&nbsp;</div></li><li><div><span class="comment"> * parameter and the content parameter values.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The supported attributes for the shortcode are 'id', 'align', 'width', and</span>&nbsp;</div></li><li><div><span class="comment"> * 'caption'.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $attr {</span>&nbsp;</div></li><li><div><span class="comment"> *     Attributes of the caption shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $id      ID of the div element for the caption.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $align   Class name that aligns the caption. Default 'alignnone'. Accepts 'alignleft', </span>&nbsp;</div></li><li><div><span class="comment"> *                           'aligncenter', alignright', 'alignnone'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $width   The width of the caption, in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $caption The caption text.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $class   Additional class name(s) added to the caption container.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Shortcode content.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML content to display the caption.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function img_caption_shortcode( $attr, $content = null ) {&nbsp;</div></li><li><div>  <span class="comment">// New-style shortcode with the caption inside the shortcode with the link and image tags.</span>&nbsp;</div></li><li><div>  if ( ! isset( $attr['caption'] ) ) {&nbsp;</div></li><li><div>      if ( preg_match( '#((?:&lt;a [^&gt;]+&gt;\s*)?&lt;img [^&gt;]+&gt;(?:\s*&lt;/a&gt;)?)(.*)#is', $content, $matches ) ) {&nbsp;</div></li><li><div>          $content = $matches[1];&nbsp;</div></li><li><div>          $attr['caption'] = trim( $matches[2] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } elseif ( strpos( $attr['caption'], '&lt;' ) !== false ) {&nbsp;</div></li><li><div>      $attr['caption'] = wp_kses( $attr['caption'], 'post' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default caption shortcode output.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the filtered output isn't empty, it will be used instead of generating</span>&nbsp;</div></li><li><div><span class="comment">   * the default caption template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see img_caption_shortcode()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output  The caption output. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $attr    Attributes of the caption shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content The image element, possibly wrapped in a hyperlink.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $output = apply_filters( 'img_caption_shortcode', '', $attr, $content );&nbsp;</div></li><li><div>  if ( $output != '' )&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $atts = shortcode_atts( array(&nbsp;</div></li><li><div>      'id' =&gt; '', &nbsp;</div></li><li><div>      'align' =&gt; 'alignnone', &nbsp;</div></li><li><div>      'width' =&gt; '', &nbsp;</div></li><li><div>      'caption' =&gt; '', &nbsp;</div></li><li><div>      'class' =&gt; '', &nbsp;</div></li><li><div> ), $attr, 'caption' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $atts['width'] = (int) $atts['width'];&nbsp;</div></li><li><div>  if ( $atts['width'] &lt; 1 || empty( $atts['caption'] ) )&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $atts['id'] ) )&nbsp;</div></li><li><div>      $atts['id'] = 'id=&quot;' . esc_attr( sanitize_html_class( $atts['id'] ) ) . '&quot; ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $class = trim( 'wp-caption ' . $atts['align'] . ' ' . $atts['class'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html5 = current_theme_supports( 'html5', 'caption' );&nbsp;</div></li><li><div>  <span class="comment">// HTML5 captions never added the extra 10px to the image width</span>&nbsp;</div></li><li><div>  $width = $html5 ? $atts['width'] : ( 10 + $atts['width'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the width of an image's caption.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * By default, the caption is 10 pixels greater than the width of the image, </span>&nbsp;</div></li><li><div><span class="comment">   * to prevent post content from running up against a floated image.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see img_caption_shortcode()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $width    Width of the caption in pixels. To remove this inline style, </span>&nbsp;</div></li><li><div><span class="comment">   *                         return zero.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $atts     Attributes of the caption shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content  The image element, possibly wrapped in a hyperlink.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $caption_width = apply_filters( 'img_caption_shortcode_width', $width, $atts, $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $style = '';&nbsp;</div></li><li><div>  if ( $caption_width ) {&nbsp;</div></li><li><div>      $style = 'style=&quot;width: ' . (int) $caption_width . 'px&quot; ';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $html5 ) {&nbsp;</div></li><li><div>      $html = '&lt;figure ' . $atts['id'] . $style . 'class=&quot;' . esc_attr( $class ) . '&quot;&gt;'&nbsp;</div></li><li><div>      . do_shortcode( $content ) . '&lt;figcaption class=&quot;wp-caption-text&quot;&gt;' . $atts['caption'] . '&lt;/figcaption&gt;&lt;/figure&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html = '&lt;div ' . $atts['id'] . $style . 'class=&quot;' . esc_attr( $class ) . '&quot;&gt;'&nbsp;</div></li><li><div>      . do_shortcode( $content ) . '&lt;p class=&quot;wp-caption-text&quot;&gt;' . $atts['caption'] . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_shortcode('gallery', 'gallery_shortcode');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Builds the Gallery shortcode output.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This implements the functionality of the Gallery Shortcode for displaying</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress images on a post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar int $instance</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr {</span>&nbsp;</div></li><li><div><span class="comment"> *     Attributes of the gallery shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $order      Order of the images in the gallery. Default 'ASC'. Accepts 'ASC', 'DESC'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $orderby    The field to use when ordering the images. Default 'menu_order ID'.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Accepts any valid SQL ORDERBY statement.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int          $id         Post ID.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $itemtag    HTML tag to use for each image in the gallery.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Default 'dl', or 'figure' when the theme registers HTML5 gallery support.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $icontag    HTML tag to use for each image's icon.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Default 'dt', or 'div' when the theme registers HTML5 gallery support.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $captiontag HTML tag to use for each image's caption.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Default 'dd', or 'figcaption' when the theme registers HTML5 gallery support.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int          $columns    Number of columns of images to display. Default 3.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string|array $size       Size of the images to display. Accepts any valid image size, or an array of width</span>&nbsp;</div></li><li><div><span class="comment"> *                                    and height values in pixels (in that order). Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $ids        A comma-separated list of IDs of attachments to display. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $include    A comma-separated list of IDs of attachments to include. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $exclude    A comma-separated list of IDs of attachments to exclude. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $link       What to link each image to. Default empty (links to the attachment page).</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Accepts 'file', 'none'.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML content to display gallery.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function gallery_shortcode( $attr ) {&nbsp;</div></li><li><div>  $post = get_post();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  static $instance = 0;&nbsp;</div></li><li><div>  $instance++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $attr['ids'] ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// 'ids' is explicitly ordered, unless you specify otherwise.</span></span>&nbsp;</div></li><li><div>      if ( empty( $attr['orderby'] ) ) {&nbsp;</div></li><li><div>          $attr['orderby'] = 'post__in';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $attr['include'] = $attr['ids'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default gallery shortcode output.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the filtered output isn't empty, it will be used instead of generating</span>&nbsp;</div></li><li><div><span class="comment">   * the default gallery template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0 The `$instance` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see gallery_shortcode()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output   The gallery output. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $attr     Attributes of the gallery shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $instance Unique numeric ID of this gallery shortcode instance.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $output = apply_filters( 'post_gallery', '', $attr, $instance );&nbsp;</div></li><li><div>  if ( $output != '' ) {&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html5 = current_theme_supports( 'html5', 'gallery' );&nbsp;</div></li><li><div>  $atts = shortcode_atts( array(&nbsp;</div></li><li><div>      'order' =&gt; 'ASC', &nbsp;</div></li><li><div>      'orderby' =&gt; 'menu_order ID', &nbsp;</div></li><li><div>      'id' =&gt; $post ? $post-&gt;ID : 0, &nbsp;</div></li><li><div>      'itemtag' =&gt; $html5 ? 'figure'     : 'dl', &nbsp;</div></li><li><div>      'icontag' =&gt; $html5 ? 'div'        : 'dt', &nbsp;</div></li><li><div>      'captiontag' =&gt; $html5 ? 'figcaption' : 'dd', &nbsp;</div></li><li><div>      'columns' =&gt; 3, &nbsp;</div></li><li><div>      'size' =&gt; 'thumbnail', &nbsp;</div></li><li><div>      'include' =&gt; '', &nbsp;</div></li><li><div>      'exclude' =&gt; '', &nbsp;</div></li><li><div>      'link' =&gt; ''&nbsp;</div></li><li><div> ), $attr, 'gallery' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $id = intval( $atts['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $atts['include'] ) ) {&nbsp;</div></li><li><div>      $_attachments = get_posts( array( 'include' =&gt; $atts['include'], 'post_status' =&gt; 'inherit', 'post_type' =&gt; 'attachment', 'post_mime_type' =&gt; 'image', 'order' =&gt; $atts['order'], 'orderby' =&gt; $atts['orderby'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attachments = array();&nbsp;</div></li><li><div>      foreach ( $_attachments as $key =&gt; $val ) {&nbsp;</div></li><li><div>          $attachments[$val-&gt;ID] = $_attachments[$key];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } elseif ( ! empty( $atts['exclude'] ) ) {&nbsp;</div></li><li><div>      $attachments = get_children( array( 'post_parent' =&gt; $id, 'exclude' =&gt; $atts['exclude'], 'post_status' =&gt; 'inherit', 'post_type' =&gt; 'attachment', 'post_mime_type' =&gt; 'image', 'order' =&gt; $atts['order'], 'orderby' =&gt; $atts['orderby'] ) );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $attachments = get_children( array( 'post_parent' =&gt; $id, 'post_status' =&gt; 'inherit', 'post_type' =&gt; 'attachment', 'post_mime_type' =&gt; 'image', 'order' =&gt; $atts['order'], 'orderby' =&gt; $atts['orderby'] ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $attachments ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_feed() ) {&nbsp;</div></li><li><div>      $output = &quot;\n&quot;;&nbsp;</div></li><li><div>      foreach ( $attachments as $att_id =&gt; $attachment ) {&nbsp;</div></li><li><div>          $output .= wp_get_attachment_link( $att_id, $atts['size'], true ) . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $itemtag = tag_escape( $atts['itemtag'] );&nbsp;</div></li><li><div>  $captiontag = tag_escape( $atts['captiontag'] );&nbsp;</div></li><li><div>  $icontag = tag_escape( $atts['icontag'] );&nbsp;</div></li><li><div>  $valid_tags = wp_kses_allowed_html( 'post' );&nbsp;</div></li><li><div>  if ( ! isset( $valid_tags[ $itemtag ] ) ) {&nbsp;</div></li><li><div>      $itemtag = 'dl';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( ! isset( $valid_tags[ $captiontag ] ) ) {&nbsp;</div></li><li><div>      $captiontag = 'dd';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( ! isset( $valid_tags[ $icontag ] ) ) {&nbsp;</div></li><li><div>      $icontag = 'dt';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $columns = intval( $atts['columns'] );&nbsp;</div></li><li><div>  $itemwidth = $columns &gt; 0 ? floor(100/$columns) : 100;&nbsp;</div></li><li><div>  $float = is_rtl() ? 'right' : 'left';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $selector = &quot;gallery-{$instance}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $gallery_style = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to print default gallery styles.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $print Whether to print default gallery styles.</span>&nbsp;</div></li><li><div><span class="comment">   *                    Defaults to false if the theme supports HTML5 galleries.</span>&nbsp;</div></li><li><div><span class="comment">   *                    Otherwise, defaults to true.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( apply_filters( 'use_default_gallery_style', ! $html5 ) ) {&nbsp;</div></li><li><div>      $gallery_style = &quot;&nbsp;</div></li><li><div>      &lt;style type='text/css'&gt;&nbsp;</div></li><li><div>          #{$selector} {&nbsp;</div></li><li><div>              margin: auto;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          #{$selector} .gallery-item {&nbsp;</div></li><li><div>              float: {$float};&nbsp;</div></li><li><div>              margin-top: 10px;&nbsp;</div></li><li><div>              text-align: center;&nbsp;</div></li><li><div>              width: {$itemwidth}%;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          #{$selector} img {&nbsp;</div></li><li><div>              border: 2px solid #cfcfcf;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          #{$selector} .gallery-caption {&nbsp;</div></li><li><div>              margin-left: 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">/* see gallery_shortcode() in wp-includes/media.php */</span>&nbsp;</div></li><li><div>      &lt;/style&gt;\n\t\t&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $size_class = sanitize_html_class( $atts['size'] );&nbsp;</div></li><li><div>  $gallery_div = &quot;&lt;div id='$selector' class='gallery galleryid-{$id} gallery-columns-{$columns} gallery-size-{$size_class}'&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default gallery shortcode CSS styles.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $gallery_style Default CSS styles and opening HTML div container</span>&nbsp;</div></li><li><div><span class="comment">   *                              for the gallery shortcode output.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $output = apply_filters( 'gallery_style', $gallery_style . $gallery_div );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $i = 0;&nbsp;</div></li><li><div>  foreach ( $attachments as $id =&gt; $attachment ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attr = ( trim( $attachment-&gt;post_excerpt ) ) ? array( 'aria-describedby' =&gt; &quot;$selector-$id&quot; ) : '';&nbsp;</div></li><li><div>      if ( ! empty( $atts['link'] ) && 'file' === $atts['link'] ) {&nbsp;</div></li><li><div>          $image_output = wp_get_attachment_link( $id, $atts['size'], false, false, false, $attr );&nbsp;</div></li><li><div>      } elseif ( ! empty( $atts['link'] ) && 'none' === $atts['link'] ) {&nbsp;</div></li><li><div>          $image_output = wp_get_attachment_image( $id, $atts['size'], false, $attr );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $image_output = wp_get_attachment_link( $id, $atts['size'], true, false, false, $attr );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $image_meta = wp_get_attachment_metadata( $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $orientation = '';&nbsp;</div></li><li><div>      if ( isset( $image_meta['height'], $image_meta['width'] ) ) {&nbsp;</div></li><li><div>          $orientation = ( $image_meta['height'] &gt; $image_meta['width'] ) ? 'portrait' : 'landscape';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $output .= &quot;&lt;{$itemtag} class='gallery-item'&gt;&quot;;&nbsp;</div></li><li><div>      $output .= &quot;&nbsp;</div></li><li><div>          &lt;{$icontag} class='gallery-icon {$orientation}'&gt;&nbsp;</div></li><li><div>              $image_output&nbsp;</div></li><li><div>          &lt;/{$icontag}&gt;&quot;;&nbsp;</div></li><li><div>      if ( $captiontag && trim($attachment-&gt;post_excerpt) ) {&nbsp;</div></li><li><div>          $output .= &quot;&nbsp;</div></li><li><div>              &lt;{$captiontag} class='wp-caption-text gallery-caption' id='$selector-$id'&gt;&nbsp;</div></li><li><div>              &quot; . wptexturize($attachment-&gt;post_excerpt) . &quot;&nbsp;</div></li><li><div>              &lt;/{$captiontag}&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $output .= &quot;&lt;/{$itemtag}&gt;&quot;;&nbsp;</div></li><li><div>      if ( ! $html5 && $columns &gt; 0 && ++$i % $columns == 0 ) {&nbsp;</div></li><li><div>          $output .= '&lt;br style=&quot;clear: both&quot; /&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $html5 && $columns &gt; 0 && $i % $columns !== 0 ) {&nbsp;</div></li><li><div>      $output .= &quot;&nbsp;</div></li><li><div>          &lt;br style='clear: both' /&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $output .= &quot;&nbsp;</div></li><li><div>      &lt;/div&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the templates used by playlists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_underscore_playlist_templates() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;script type=&quot;text/html&quot; id=&quot;tmpl-wp-playlist-current-item&quot;&gt;&nbsp;</div></li><li><div>  &lt;# if ( data.image ) { #&gt;&nbsp;</div></li><li><div>  &lt;img src=&quot;{{ data.thumb.src }}&quot; alt=&quot;&quot; /&gt;&nbsp;</div></li><li><div>  &lt;# } #&gt;&nbsp;</div></li><li><div>  &lt;div class=&quot;wp-playlist-caption&quot;&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;wp-playlist-item-meta wp-playlist-item-title&quot;&gt;&lt;?php&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** translators: playlist item title */</span></span>&nbsp;</div></li><li><div>          printf( _x( '&#8220;%s&#8221;', 'playlist item title' ), '{{ data.title }}' );&nbsp;</div></li><li><div>      ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;# if ( data.meta.album ) { #&gt;&lt;span class=&quot;wp-playlist-item-meta wp-playlist-item-album&quot;&gt;{{ data.meta.album }}&lt;/span&gt;&lt;# } #&gt;&nbsp;</div></li><li><div>      &lt;# if ( data.meta.artist ) { #&gt;&lt;span class=&quot;wp-playlist-item-meta wp-playlist-item-artist&quot;&gt;{{ data.meta.artist }}&lt;/span&gt;&lt;# } #&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&lt;/script&gt;&nbsp;</div></li><li><div>&lt;script type=&quot;text/html&quot; id=&quot;tmpl-wp-playlist-item&quot;&gt;&nbsp;</div></li><li><div>  &lt;div class=&quot;wp-playlist-item&quot;&gt;&nbsp;</div></li><li><div>      &lt;a class=&quot;wp-playlist-caption&quot; href=&quot;{{ data.src }}&quot;&gt;&nbsp;</div></li><li><div>          {{ data.index ? ( data.index + '. ' ) : '' }}&nbsp;</div></li><li><div>          &lt;# if ( data.caption ) { #&gt;&nbsp;</div></li><li><div>              {{ data.caption }}&nbsp;</div></li><li><div>          &lt;# } else { #&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;wp-playlist-item-title&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">/** translators: playlist item title */</span></span>&nbsp;</div></li><li><div>                  printf( _x( '&#8220;%s&#8221;', 'playlist item title' ), '{{{ data.title }}}' );&nbsp;</div></li><li><div>              ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;# if ( data.artists && data.meta.artist ) { #&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;wp-playlist-item-artist&quot;&gt; &mdash; {{ data.meta.artist }}&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;# } #&gt;&nbsp;</div></li><li><div>          &lt;# } #&gt;&nbsp;</div></li><li><div>      &lt;/a&gt;&nbsp;</div></li><li><div>      &lt;# if ( data.meta.length_formatted ) { #&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;wp-playlist-item-length&quot;&gt;{{ data.meta.length_formatted }}&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;# } #&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&lt;/script&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs and enqueue default scripts and styles for playlists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type Type of playlist. Accepts 'audio' or 'video'.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_playlist_scripts( $type ) {&nbsp;</div></li><li><div>  wp_enqueue_style( 'wp-mediaelement' );&nbsp;</div></li><li><div>  wp_enqueue_script( 'wp-playlist' );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;!--[if lt IE 9]&gt;&lt;script&gt;document.createElement('&lt;?php echo esc_js( $type ) ?&gt;');&lt;/script&gt;&lt;![endif]--&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  add_action( 'wp_footer', 'wp_underscore_playlist_templates', 0 );&nbsp;</div></li><li><div>  add_action( 'admin_footer', 'wp_underscore_playlist_templates', 0 );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Builds the Playlist shortcode output.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This implements the functionality of the playlist shortcode for displaying</span>&nbsp;</div></li><li><div><span class="comment"> * a collection of WordPress audio or video files in a post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global int $content_width</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar int $instance</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of default playlist attributes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string  $type         Type of playlist to display. Accepts 'audio' or 'video'. Default 'audio'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string  $order        Designates ascending or descending order of items in the playlist.</span>&nbsp;</div></li><li><div><span class="comment"> *                                 Accepts 'ASC', 'DESC'. Default 'ASC'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string  $orderby      Any column, or columns, to sort the playlist. If $ids are</span>&nbsp;</div></li><li><div><span class="comment"> *                                 passed, this defaults to the order of the $ids array ('post__in').</span>&nbsp;</div></li><li><div><span class="comment"> *                                 Otherwise default is 'menu_order ID'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int     $id           If an explicit $ids array is not present, this parameter</span>&nbsp;</div></li><li><div><span class="comment"> *                                 will determine which attachments are used for the playlist.</span>&nbsp;</div></li><li><div><span class="comment"> *                                 Default is the current post ID.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type array   $ids          Create a playlist out of these explicit attachment IDs. If empty, </span>&nbsp;</div></li><li><div><span class="comment"> *                                 a playlist will be created from all $type attachments of $id.</span>&nbsp;</div></li><li><div><span class="comment"> *                                 Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type array   $exclude      List of specific attachment IDs to exclude from the playlist. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string  $style        Playlist style to use. Accepts 'light' or 'dark'. Default 'light'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool    $tracklist    Whether to show or hide the playlist. Default true.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool    $tracknumbers Whether to show or hide the numbers next to entries in the playlist. Default true.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool    $images       Show or hide the video or audio thumbnail (Featured Image/post</span>&nbsp;</div></li><li><div><span class="comment"> *                                 thumbnail). Default true.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool    $artists      Whether to show or hide artist name in the playlist. Default true.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Playlist output. Empty string if the passed type is unsupported.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_playlist_shortcode( $attr ) {&nbsp;</div></li><li><div>  global $content_width;&nbsp;</div></li><li><div>  $post = get_post();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  static $instance = 0;&nbsp;</div></li><li><div>  $instance++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $attr['ids'] ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// 'ids' is explicitly ordered, unless you specify otherwise.</span></span>&nbsp;</div></li><li><div>      if ( empty( $attr['orderby'] ) ) {&nbsp;</div></li><li><div>          $attr['orderby'] = 'post__in';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $attr['include'] = $attr['ids'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the playlist output.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a non-empty value to the filter will short-circuit generation</span>&nbsp;</div></li><li><div><span class="comment">   * of the default playlist output, returning the passed value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0 The `$instance` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output   Playlist output. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $attr     An array of shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $instance Unique numeric ID of this playlist shortcode instance.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $output = apply_filters( 'post_playlist', '', $attr, $instance );&nbsp;</div></li><li><div>  if ( $output != '' ) {&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $atts = shortcode_atts( array(&nbsp;</div></li><li><div>      'type' =&gt; 'audio', &nbsp;</div></li><li><div>      'order' =&gt; 'ASC', &nbsp;</div></li><li><div>      'orderby' =&gt; 'menu_order ID', &nbsp;</div></li><li><div>      'id' =&gt; $post ? $post-&gt;ID : 0, &nbsp;</div></li><li><div>      'include' =&gt; '', &nbsp;</div></li><li><div>      'exclude' =&gt; '', &nbsp;</div></li><li><div>      'style' =&gt; 'light', &nbsp;</div></li><li><div>      'tracklist' =&gt; true, &nbsp;</div></li><li><div>      'tracknumbers' =&gt; true, &nbsp;</div></li><li><div>      'images' =&gt; true, &nbsp;</div></li><li><div>      'artists' =&gt; true&nbsp;</div></li><li><div> ), $attr, 'playlist' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $id = intval( $atts['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $atts['type'] !== 'audio' ) {&nbsp;</div></li><li><div>      $atts['type'] = 'video';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array(&nbsp;</div></li><li><div>      'post_status' =&gt; 'inherit', &nbsp;</div></li><li><div>      'post_type' =&gt; 'attachment', &nbsp;</div></li><li><div>      'post_mime_type' =&gt; $atts['type'], &nbsp;</div></li><li><div>      'order' =&gt; $atts['order'], &nbsp;</div></li><li><div>      'orderby' =&gt; $atts['orderby']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $atts['include'] ) ) {&nbsp;</div></li><li><div>      $args['include'] = $atts['include'];&nbsp;</div></li><li><div>      $_attachments = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attachments = array();&nbsp;</div></li><li><div>      foreach ( $_attachments as $key =&gt; $val ) {&nbsp;</div></li><li><div>          $attachments[$val-&gt;ID] = $_attachments[$key];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } elseif ( ! empty( $atts['exclude'] ) ) {&nbsp;</div></li><li><div>      $args['post_parent'] = $id;&nbsp;</div></li><li><div>      $args['exclude'] = $atts['exclude'];&nbsp;</div></li><li><div>      $attachments = get_children( $args );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $args['post_parent'] = $id;&nbsp;</div></li><li><div>      $attachments = get_children( $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $attachments ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_feed() ) {&nbsp;</div></li><li><div>      $output = &quot;\n&quot;;&nbsp;</div></li><li><div>      foreach ( $attachments as $att_id =&gt; $attachment ) {&nbsp;</div></li><li><div>          $output .= wp_get_attachment_link( $att_id ) . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $outer = 22; <span class="comment">// default padding and border of wrapper</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $default_width = 640;&nbsp;</div></li><li><div>  $default_height = 360;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $theme_width = empty( $content_width ) ? $default_width : ( $content_width - $outer );&nbsp;</div></li><li><div>  $theme_height = empty( $content_width ) ? $default_height : round( ( $default_height * $theme_width ) / $default_width );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data = array(&nbsp;</div></li><li><div>      'type' =&gt; $atts['type'], &nbsp;</div></li><li><div>      <span class="comment">// don't pass strings to JSON, will be truthy in JS</span>&nbsp;</div></li><li><div>      'tracklist' =&gt; wp_validate_boolean( $atts['tracklist'] ), &nbsp;</div></li><li><div>      'tracknumbers' =&gt; wp_validate_boolean( $atts['tracknumbers'] ), &nbsp;</div></li><li><div>      'images' =&gt; wp_validate_boolean( $atts['images'] ), &nbsp;</div></li><li><div>      'artists' =&gt; wp_validate_boolean( $atts['artists'] ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tracks = array();&nbsp;</div></li><li><div>  foreach ( $attachments as $attachment ) {&nbsp;</div></li><li><div>      $url = wp_get_attachment_url( $attachment-&gt;ID );&nbsp;</div></li><li><div>      $ftype = wp_check_filetype( $url, wp_get_mime_types() );&nbsp;</div></li><li><div>      $track = array(&nbsp;</div></li><li><div>          'src' =&gt; $url, &nbsp;</div></li><li><div>          'type' =&gt; $ftype['type'], &nbsp;</div></li><li><div>          'title' =&gt; $attachment-&gt;post_title, &nbsp;</div></li><li><div>          'caption' =&gt; $attachment-&gt;post_excerpt, &nbsp;</div></li><li><div>          'description' =&gt; $attachment-&gt;post_content&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $track['meta'] = array();&nbsp;</div></li><li><div>      $meta = wp_get_attachment_metadata( $attachment-&gt;ID );&nbsp;</div></li><li><div>      if ( ! empty( $meta ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( wp_get_attachment_id3_keys( $attachment ) as $key =&gt; $label ) {&nbsp;</div></li><li><div>              if ( ! empty( $meta[ $key ] ) ) {&nbsp;</div></li><li><div>                  $track['meta'][ $key ] = $meta[ $key ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'video' === $atts['type'] ) {&nbsp;</div></li><li><div>              if ( ! empty( $meta['width'] ) && ! empty( $meta['height'] ) ) {&nbsp;</div></li><li><div>                  $width = $meta['width'];&nbsp;</div></li><li><div>                  $height = $meta['height'];&nbsp;</div></li><li><div>                  $theme_height = round( ( $height * $theme_width ) / $width );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $width = $default_width;&nbsp;</div></li><li><div>                  $height = $default_height;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $track['dimensions'] = array(&nbsp;</div></li><li><div>                  'original' =&gt; compact( 'width', 'height' ), &nbsp;</div></li><li><div>                  'resized' =&gt; array(&nbsp;</div></li><li><div>                      'width' =&gt; $theme_width, &nbsp;</div></li><li><div>                      'height' =&gt; $theme_height&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $atts['images'] ) {&nbsp;</div></li><li><div>          $thumb_id = get_post_thumbnail_id( $attachment-&gt;ID );&nbsp;</div></li><li><div>          if ( ! empty( $thumb_id ) ) {&nbsp;</div></li><li><div>              list( $src, $width, $height ) = wp_get_attachment_image_src( $thumb_id, 'full' );&nbsp;</div></li><li><div>              $track['image'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>              list( $src, $width, $height ) = wp_get_attachment_image_src( $thumb_id, 'thumbnail' );&nbsp;</div></li><li><div>              $track['thumb'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $src = wp_mime_type_icon( $attachment-&gt;ID );&nbsp;</div></li><li><div>              $width = 48;&nbsp;</div></li><li><div>              $height = 64;&nbsp;</div></li><li><div>              $track['image'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>              $track['thumb'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tracks[] = $track;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $data['tracks'] = $tracks;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $safe_type = esc_attr( $atts['type'] );&nbsp;</div></li><li><div>  $safe_style = esc_attr( $atts['style'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 1 === $instance ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Prints and enqueues playlist scripts, styles, and JavaScript templates.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $type  Type of playlist. Possible values are 'audio' or 'video'.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $style The 'theme' for the playlist. Core provides 'light' and 'dark'.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'wp_playlist_scripts', $atts['type'], $atts['style'] );&nbsp;</div></li><li><div>  } ?&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;wp-playlist wp-&lt;?php echo $safe_type ?&gt;-playlist wp-playlist-&lt;?php echo $safe_style ?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;?php if ( 'audio' === $atts['type'] ): ?&gt;&nbsp;</div></li><li><div>  &lt;div class=&quot;wp-playlist-current-item&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php endif ?&gt;&nbsp;</div></li><li><div>  &lt;&lt;?php echo $safe_type ?&gt; controls=&quot;controls&quot; preload=&quot;none&quot; width=&quot;&lt;?php&nbsp;</div></li><li><div>      echo (int) $theme_width;&nbsp;</div></li><li><div>  ?&gt;&quot;&lt;?php if ( 'video' === $safe_type ):&nbsp;</div></li><li><div>      echo ' height=&quot;', (int) $theme_height, '&quot;';&nbsp;</div></li><li><div>  endif; ?&gt;&gt;&lt;/&lt;?php echo $safe_type ?&gt;&gt;&nbsp;</div></li><li><div>  &lt;div class=&quot;wp-playlist-next&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>  &lt;div class=&quot;wp-playlist-prev&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>  &lt;noscript&gt;&nbsp;</div></li><li><div>  &lt;ol&gt;&lt;?php&nbsp;</div></li><li><div>  foreach ( $attachments as $att_id =&gt; $attachment ) {&nbsp;</div></li><li><div>      printf( '&lt;li&gt;%s&lt;/li&gt;', wp_get_attachment_link( $att_id ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  ?&gt;&lt;/ol&gt;&nbsp;</div></li><li><div>  &lt;/noscript&gt;&nbsp;</div></li><li><div>  &lt;script type=&quot;application/json&quot; class=&quot;wp-playlist-script&quot;&gt;&lt;?php echo wp_json_encode( $data ) ?&gt;&lt;/script&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  return ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_shortcode( 'playlist', 'wp_playlist_shortcode' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Provides a No-JS Flash fallback as a last resort for audio / video.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $url The media element URL.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Fallback HTML.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_mediaelement_fallback( $url ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the Mediaelement fallback output for no-JS.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output Fallback output for no-JS.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url    Media file URL.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_mediaelement_fallback', sprintf( '&lt;a href=&quot;%1$s&quot;&gt;%1$s&lt;/a&gt;', esc_url( $url ) ), $url );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns a filtered list of WP-supported audio formats.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Supported audio formats.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_audio_extensions() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of supported audio formats.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $extensions An array of support audio formats. Defaults are</span>&nbsp;</div></li><li><div><span class="comment">   *                          'mp3', 'ogg', 'wma', 'm4a', 'wav'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_audio_extensions', array( 'mp3', 'ogg', 'wma', 'm4a', 'wav' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns useful keys to use to lookup data from an attachment's stored metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Post $attachment The current attachment, provided for context.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string  $context    Optional. The context. Accepts 'edit', 'display'. Default 'display'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Key/value pairs of field keys to labels.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_attachment_id3_keys( $attachment, $context = 'display' ) {&nbsp;</div></li><li><div>  $fields = array(&nbsp;</div></li><li><div>      'artist' =&gt; __( 'Artist' ), &nbsp;</div></li><li><div>      'album' =&gt; __( 'Album' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'display' === $context ) {&nbsp;</div></li><li><div>      $fields['genre'] = __( 'Genre' );&nbsp;</div></li><li><div>      $fields['year'] = __( 'Year' );&nbsp;</div></li><li><div>      $fields['length_formatted'] = _x( 'Length', 'video or audio' );&nbsp;</div></li><li><div>  } elseif ( 'js' === $context ) {&nbsp;</div></li><li><div>      $fields['bitrate'] = __( 'Bitrate' );&nbsp;</div></li><li><div>      $fields['bitrate_mode'] = __( 'Bitrate Mode' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the editable list of keys to look up data from an attachment's metadata.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array   $fields     Key/value pairs of field keys to labels.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $attachment Attachment object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string  $context    The context. Accepts 'edit', 'display'. Default 'display'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_get_attachment_id3_keys', $fields, $attachment, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Builds the Audio shortcode output.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This implements the functionality of the Audio Shortcode for displaying</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress mp3s in a post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar int $instance</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $attr {</span>&nbsp;</div></li><li><div><span class="comment"> *     Attributes of the audio shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $src      URL to the source of the audio file. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $loop     The 'loop' attribute for the `&lt;audio&gt;` element. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $autoplay The 'autoplay' attribute for the `&lt;audio&gt;` element. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $preload  The 'preload' attribute for the `&lt;audio&gt;` element. Default 'none'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $class    The 'class' attribute for the `&lt;audio&gt;` element. Default 'wp-audio-shortcode'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $style    The 'style' attribute for the `&lt;audio&gt;` element. Default 'width: 100%;'.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Shortcode content.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|void HTML content to display audio.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_audio_shortcode( $attr, $content = '' ) {&nbsp;</div></li><li><div>  $post_id = get_post() ? get_the_ID() : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  static $instance = 0;&nbsp;</div></li><li><div>  $instance++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default audio shortcode output.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the filtered output isn't empty, it will be used instead of generating the default audio template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $html     Empty variable to be replaced with shortcode markup.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $attr     Attributes of the shortcode. @see wp_audio_shortcode()</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content  Shortcode content.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $instance Unique numeric ID of this audio shortcode instance.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $override = apply_filters( 'wp_audio_shortcode_override', '', $attr, $content, $instance );&nbsp;</div></li><li><div>  if ( '' !== $override ) {&nbsp;</div></li><li><div>      return $override;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $audio = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $default_types = wp_get_audio_extensions();&nbsp;</div></li><li><div>  $defaults_atts = array(&nbsp;</div></li><li><div>      'src' =&gt; '', &nbsp;</div></li><li><div>      'loop' =&gt; '', &nbsp;</div></li><li><div>      'autoplay' =&gt; '', &nbsp;</div></li><li><div>      'preload' =&gt; 'none', &nbsp;</div></li><li><div>      'class' =&gt; 'wp-audio-shortcode', &nbsp;</div></li><li><div>      'style' =&gt; 'width: 100%;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  foreach ( $default_types as $type ) {&nbsp;</div></li><li><div>      $defaults_atts[$type] = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $atts = shortcode_atts( $defaults_atts, $attr, 'audio' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $primary = false;&nbsp;</div></li><li><div>  if ( ! empty( $atts['src'] ) ) {&nbsp;</div></li><li><div>      $type = wp_check_filetype( $atts['src'], wp_get_mime_types() );&nbsp;</div></li><li><div>      if ( ! in_array( strtolower( $type['ext'] ), $default_types ) ) {&nbsp;</div></li><li><div>          return sprintf( '&lt;a class=&quot;wp-embedded-audio&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;', esc_url( $atts['src'] ), esc_html( $atts['src'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $primary = true;&nbsp;</div></li><li><div>      array_unshift( $default_types, 'src' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      foreach ( $default_types as $ext ) {&nbsp;</div></li><li><div>          if ( ! empty( $atts[ $ext ] ) ) {&nbsp;</div></li><li><div>              $type = wp_check_filetype( $atts[ $ext ], wp_get_mime_types() );&nbsp;</div></li><li><div>              if ( strtolower( $type['ext'] ) === $ext ) {&nbsp;</div></li><li><div>                  $primary = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $primary ) {&nbsp;</div></li><li><div>      $audios = get_attached_media( 'audio', $post_id );&nbsp;</div></li><li><div>      if ( empty( $audios ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $audio = reset( $audios );&nbsp;</div></li><li><div>      $atts['src'] = wp_get_attachment_url( $audio-&gt;ID );&nbsp;</div></li><li><div>      if ( empty( $atts['src'] ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      array_unshift( $default_types, 'src' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the media library used for the audio shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $library Media library used for the audio shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $library = apply_filters( 'wp_audio_shortcode_library', 'mediaelement' );&nbsp;</div></li><li><div>  if ( 'mediaelement' === $library && did_action( 'init' ) ) {&nbsp;</div></li><li><div>      wp_enqueue_style( 'wp-mediaelement' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'wp-mediaelement' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the class attribute for the audio shortcode output container.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $class CSS class or list of space-separated classes.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $atts['class'] = apply_filters( 'wp_audio_shortcode_class', $atts['class'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html_atts = array(&nbsp;</div></li><li><div>      'class' =&gt; $atts['class'], &nbsp;</div></li><li><div>      'id' =&gt; sprintf( 'audio-%d-%d', $post_id, $instance ), &nbsp;</div></li><li><div>      'loop' =&gt; wp_validate_boolean( $atts['loop'] ), &nbsp;</div></li><li><div>      'autoplay' =&gt; wp_validate_boolean( $atts['autoplay'] ), &nbsp;</div></li><li><div>      'preload' =&gt; $atts['preload'], &nbsp;</div></li><li><div>      'style' =&gt; $atts['style'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// These ones should just be omitted altogether if they are blank</span></span>&nbsp;</div></li><li><div>  foreach ( array( 'loop', 'autoplay', 'preload' ) as $a ) {&nbsp;</div></li><li><div>      if ( empty( $html_atts[$a] ) ) {&nbsp;</div></li><li><div>          unset( $html_atts[$a] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $attr_strings = array();&nbsp;</div></li><li><div>  foreach ( $html_atts as $k =&gt; $v ) {&nbsp;</div></li><li><div>      $attr_strings[] = $k . '=&quot;' . esc_attr( $v ) . '&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>  if ( 'mediaelement' === $library && 1 === $instance ) {&nbsp;</div></li><li><div>      $html .= &quot;&lt;!--[if lt IE 9]&gt;&lt;script&gt;document.createElement('audio');&lt;/script&gt;&lt;![endif]--&gt;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= sprintf( '&lt;audio %s controls=&quot;controls&quot;&gt;', join( ' ', $attr_strings ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fileurl = '';&nbsp;</div></li><li><div>  $source = '&lt;source type=&quot;%s&quot; src=&quot;%s&quot; /&gt;';&nbsp;</div></li><li><div>  foreach ( $default_types as $fallback ) {&nbsp;</div></li><li><div>      if ( ! empty( $atts[ $fallback ] ) ) {&nbsp;</div></li><li><div>          if ( empty( $fileurl ) ) {&nbsp;</div></li><li><div>              $fileurl = $atts[ $fallback ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $type = wp_check_filetype( $atts[ $fallback ], wp_get_mime_types() );&nbsp;</div></li><li><div>          $url = add_query_arg( '_', $instance, $atts[ $fallback ] );&nbsp;</div></li><li><div>          $html .= sprintf( $source, $type['type'], esc_url( $url ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'mediaelement' === $library ) {&nbsp;</div></li><li><div>      $html .= wp_mediaelement_fallback( $fileurl );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&lt;/audio&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the audio shortcode output.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $html    Audio shortcode HTML output.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $atts    Array of audio shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $audio   Audio file.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $post_id Post ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $library Media library used for the audio shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_audio_shortcode', $html, $atts, $audio, $post_id, $library );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_shortcode( 'audio', 'wp_audio_shortcode' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns a filtered list of WP-supported video formats.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array List of supported video formats.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_video_extensions() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of supported video formats.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $extensions An array of support video formats. Defaults are</span>&nbsp;</div></li><li><div><span class="comment">   *                          'mp4', 'm4v', 'webm', 'ogv', 'wmv', 'flv'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_video_extensions', array( 'mp4', 'm4v', 'webm', 'ogv', 'wmv', 'flv' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Builds the Video shortcode output.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This implements the functionality of the Video Shortcode for displaying</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress mp4s in a post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global int $content_width</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar int $instance</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $attr {</span>&nbsp;</div></li><li><div><span class="comment"> *     Attributes of the shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $src      URL to the source of the video file. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $height   Height of the video embed in pixels. Default 360.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $width    Width of the video embed in pixels. Default $content_width or 640.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $poster   The 'poster' attribute for the `&lt;video&gt;` element. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $loop     The 'loop' attribute for the `&lt;video&gt;` element. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $autoplay The 'autoplay' attribute for the `&lt;video&gt;` element. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $preload  The 'preload' attribute for the `&lt;video&gt;` element.</span>&nbsp;</div></li><li><div><span class="comment"> *                            Default 'metadata'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $class    The 'class' attribute for the `&lt;video&gt;` element.</span>&nbsp;</div></li><li><div><span class="comment"> *                            Default 'wp-video-shortcode'.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Shortcode content.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|void HTML content to display video.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_video_shortcode( $attr, $content = '' ) {&nbsp;</div></li><li><div>  global $content_width;&nbsp;</div></li><li><div>  $post_id = get_post() ? get_the_ID() : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  static $instance = 0;&nbsp;</div></li><li><div>  $instance++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default video shortcode output.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If the filtered output isn't empty, it will be used instead of generating</span>&nbsp;</div></li><li><div><span class="comment">   * the default video template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see wp_video_shortcode()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $html     Empty variable to be replaced with shortcode markup.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $attr     Attributes of the video shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content  Video shortcode content.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $instance Unique numeric ID of this video shortcode instance.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $override = apply_filters( 'wp_video_shortcode_override', '', $attr, $content, $instance );&nbsp;</div></li><li><div>  if ( '' !== $override ) {&nbsp;</div></li><li><div>      return $override;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $video = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $default_types = wp_get_video_extensions();&nbsp;</div></li><li><div>  $defaults_atts = array(&nbsp;</div></li><li><div>      'src' =&gt; '', &nbsp;</div></li><li><div>      'poster' =&gt; '', &nbsp;</div></li><li><div>      'loop' =&gt; '', &nbsp;</div></li><li><div>      'autoplay' =&gt; '', &nbsp;</div></li><li><div>      'preload' =&gt; 'metadata', &nbsp;</div></li><li><div>      'width' =&gt; 640, &nbsp;</div></li><li><div>      'height' =&gt; 360, &nbsp;</div></li><li><div>      'class' =&gt; 'wp-video-shortcode', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $default_types as $type ) {&nbsp;</div></li><li><div>      $defaults_atts[$type] = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $atts = shortcode_atts( $defaults_atts, $attr, 'video' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_admin() ) {&nbsp;</div></li><li><div>      <span class="comment">// shrink the video so it isn't huge in the admin</span>&nbsp;</div></li><li><div>      if ( $atts['width'] &gt; $defaults_atts['width'] ) {&nbsp;</div></li><li><div>          $atts['height'] = round( ( $atts['height'] * $defaults_atts['width'] ) / $atts['width'] );&nbsp;</div></li><li><div>          $atts['width'] = $defaults_atts['width'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// if the video is bigger than the theme</span>&nbsp;</div></li><li><div>      if ( ! empty( $content_width ) && $atts['width'] &gt; $content_width ) {&nbsp;</div></li><li><div>          $atts['height'] = round( ( $atts['height'] * $content_width ) / $atts['width'] );&nbsp;</div></li><li><div>          $atts['width'] = $content_width;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $is_vimeo = $is_youtube = false;&nbsp;</div></li><li><div>  $yt_pattern = '#^https?:<span class="comment">//(?:www\.)?(?:youtube\.com/watch|youtu\.be/)#';</span>&nbsp;</div></li><li><div>  $vimeo_pattern = '#^https?:<span class="comment">//(.+\.)?vimeo\.com/.*#';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $primary = false;&nbsp;</div></li><li><div>  if ( ! empty( $atts['src'] ) ) {&nbsp;</div></li><li><div>      $is_vimeo = ( preg_match( $vimeo_pattern, $atts['src'] ) );&nbsp;</div></li><li><div>      $is_youtube = (  preg_match( $yt_pattern, $atts['src'] ) );&nbsp;</div></li><li><div>      if ( ! $is_youtube && ! $is_vimeo ) {&nbsp;</div></li><li><div>          $type = wp_check_filetype( $atts['src'], wp_get_mime_types() );&nbsp;</div></li><li><div>          if ( ! in_array( strtolower( $type['ext'] ), $default_types ) ) {&nbsp;</div></li><li><div>              return sprintf( '&lt;a class=&quot;wp-embedded-video&quot; href=&quot;%s&quot;&gt;%s&lt;/a&gt;', esc_url( $atts['src'] ), esc_html( $atts['src'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $is_vimeo ) {&nbsp;</div></li><li><div>          wp_enqueue_script( 'froogaloop' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $primary = true;&nbsp;</div></li><li><div>      array_unshift( $default_types, 'src' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      foreach ( $default_types as $ext ) {&nbsp;</div></li><li><div>          if ( ! empty( $atts[ $ext ] ) ) {&nbsp;</div></li><li><div>              $type = wp_check_filetype( $atts[ $ext ], wp_get_mime_types() );&nbsp;</div></li><li><div>              if ( strtolower( $type['ext'] ) === $ext ) {&nbsp;</div></li><li><div>                  $primary = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $primary ) {&nbsp;</div></li><li><div>      $videos = get_attached_media( 'video', $post_id );&nbsp;</div></li><li><div>      if ( empty( $videos ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $video = reset( $videos );&nbsp;</div></li><li><div>      $atts['src'] = wp_get_attachment_url( $video-&gt;ID );&nbsp;</div></li><li><div>      if ( empty( $atts['src'] ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      array_unshift( $default_types, 'src' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the media library used for the video shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $library Media library used for the video shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $library = apply_filters( 'wp_video_shortcode_library', 'mediaelement' );&nbsp;</div></li><li><div>  if ( 'mediaelement' === $library && did_action( 'init' ) ) {&nbsp;</div></li><li><div>      wp_enqueue_style( 'wp-mediaelement' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'wp-mediaelement' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the class attribute for the video shortcode output container.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $class CSS class or list of space-separated classes.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $atts['class'] = apply_filters( 'wp_video_shortcode_class', $atts['class'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html_atts = array(&nbsp;</div></li><li><div>      'class' =&gt; $atts['class'], &nbsp;</div></li><li><div>      'id' =&gt; sprintf( 'video-%d-%d', $post_id, $instance ), &nbsp;</div></li><li><div>      'width' =&gt; absint( $atts['width'] ), &nbsp;</div></li><li><div>      'height' =&gt; absint( $atts['height'] ), &nbsp;</div></li><li><div>      'poster' =&gt; esc_url( $atts['poster'] ), &nbsp;</div></li><li><div>      'loop' =&gt; wp_validate_boolean( $atts['loop'] ), &nbsp;</div></li><li><div>      'autoplay' =&gt; wp_validate_boolean( $atts['autoplay'] ), &nbsp;</div></li><li><div>      'preload' =&gt; $atts['preload'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// These ones should just be omitted altogether if they are blank</span></span>&nbsp;</div></li><li><div>  foreach ( array( 'poster', 'loop', 'autoplay', 'preload' ) as $a ) {&nbsp;</div></li><li><div>      if ( empty( $html_atts[$a] ) ) {&nbsp;</div></li><li><div>          unset( $html_atts[$a] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $attr_strings = array();&nbsp;</div></li><li><div>  foreach ( $html_atts as $k =&gt; $v ) {&nbsp;</div></li><li><div>      $attr_strings[] = $k . '=&quot;' . esc_attr( $v ) . '&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>  if ( 'mediaelement' === $library && 1 === $instance ) {&nbsp;</div></li><li><div>      $html .= &quot;&lt;!--[if lt IE 9]&gt;&lt;script&gt;document.createElement('video');&lt;/script&gt;&lt;![endif]--&gt;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= sprintf( '&lt;video %s controls=&quot;controls&quot;&gt;', join( ' ', $attr_strings ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fileurl = '';&nbsp;</div></li><li><div>  $source = '&lt;source type=&quot;%s&quot; src=&quot;%s&quot; /&gt;';&nbsp;</div></li><li><div>  foreach ( $default_types as $fallback ) {&nbsp;</div></li><li><div>      if ( ! empty( $atts[ $fallback ] ) ) {&nbsp;</div></li><li><div>          if ( empty( $fileurl ) ) {&nbsp;</div></li><li><div>              $fileurl = $atts[ $fallback ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( 'src' === $fallback && $is_youtube ) {&nbsp;</div></li><li><div>              $type = array( 'type' =&gt; 'video/youtube' );&nbsp;</div></li><li><div>          } elseif ( 'src' === $fallback && $is_vimeo ) {&nbsp;</div></li><li><div>              $type = array( 'type' =&gt; 'video/vimeo' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $type = wp_check_filetype( $atts[ $fallback ], wp_get_mime_types() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $url = add_query_arg( '_', $instance, $atts[ $fallback ] );&nbsp;</div></li><li><div>          $html .= sprintf( $source, $type['type'], esc_url( $url ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $content ) ) {&nbsp;</div></li><li><div>      if ( false !== strpos( $content, &quot;\n&quot; ) ) {&nbsp;</div></li><li><div>          $content = str_replace( array( &quot;\r\n&quot;, &quot;\n&quot;, &quot;\t&quot; ), '', $content );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= trim( $content );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'mediaelement' === $library ) {&nbsp;</div></li><li><div>      $html .= wp_mediaelement_fallback( $fileurl );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $html .= '&lt;/video&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $width_rule = '';&nbsp;</div></li><li><div>  if ( ! empty( $atts['width'] ) ) {&nbsp;</div></li><li><div>      $width_rule = sprintf( 'width: %dpx;', $atts['width'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $output = sprintf( '&lt;div style=&quot;%s&quot; class=&quot;wp-video&quot;&gt;%s&lt;/div&gt;', $width_rule, $html );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the output of the video shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output  Video shortcode HTML output.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $atts    Array of video shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $video   Video file.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $post_id Post ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $library Media library used for the video shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_video_shortcode', $output, $atts, $video, $post_id, $library );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_shortcode( 'video', 'wp_video_shortcode' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays previous image link that has the same post parent.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see adjacent_image_link()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size Optional. Image size. Accepts any valid image size, an array of width and</span>&nbsp;</div></li><li><div><span class="comment"> *                           height values in pixels (in that order), 0, or 'none'. 0 or 'none' will</span>&nbsp;</div></li><li><div><span class="comment"> *                           default to 'post_title' or `$text`. Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $text Optional. Link text. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function previous_image_link( $size = 'thumbnail', $text = false ) {&nbsp;</div></li><li><div>  adjacent_image_link(true, $size, $text);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays next image link that has the same post parent.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see adjacent_image_link()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size Optional. Image size. Accepts any valid image size, an array of width and</span>&nbsp;</div></li><li><div><span class="comment"> *                           height values in pixels (in that order), 0, or 'none'. 0 or 'none' will</span>&nbsp;</div></li><li><div><span class="comment"> *                           default to 'post_title' or `$text`. Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $text Optional. Link text. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function next_image_link( $size = 'thumbnail', $text = false ) {&nbsp;</div></li><li><div>  adjacent_image_link(false, $size, $text);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays next or previous image link that has the same post parent.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the current attachment object from the $post global.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $prev Optional. Whether to display the next (false) or previous (true) link. Default true.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $size Optional. Image size. Accepts any valid image size, or an array of width and height</span>&nbsp;</div></li><li><div><span class="comment"> *                           values in pixels (in that order). Default 'thumbnail'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $text Optional. Link text. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function adjacent_image_link( $prev = true, $size = 'thumbnail', $text = false ) {&nbsp;</div></li><li><div>  $post = get_post();&nbsp;</div></li><li><div>  $attachments = array_values( get_children( array( 'post_parent' =&gt; $post-&gt;post_parent, 'post_status' =&gt; 'inherit', 'post_type' =&gt; 'attachment', 'post_mime_type' =&gt; 'image', 'order' =&gt; 'ASC', 'orderby' =&gt; 'menu_order ID' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $attachments as $k =&gt; $attachment ) {&nbsp;</div></li><li><div>      if ( $attachment-&gt;ID == $post-&gt;ID ) {&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $output = '';&nbsp;</div></li><li><div>  $attachment_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $attachments ) {&nbsp;</div></li><li><div>      $k = $prev ? $k - 1 : $k + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $attachments[ $k ] ) ) {&nbsp;</div></li><li><div>          $attachment_id = $attachments[ $k ]-&gt;ID;&nbsp;</div></li><li><div>          $output = wp_get_attachment_link( $attachment_id, $size, true, false, $text );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $adjacent = $prev ? 'previous' : 'next';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the adjacent image link.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$adjacent`, refers to the type of adjacency, </span>&nbsp;</div></li><li><div><span class="comment">   * either 'next', or 'previous'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output        Adjacent image HTML markup.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $attachment_id Attachment ID</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $size          Image size.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $text          Link text.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  echo apply_filters( &quot;{$adjacent}_image_link&quot;, $output, $attachment_id, $size, $text );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves taxonomies attached to given the attachment.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0 Introduced the `$output` parameter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|array|object $attachment Attachment ID, data array, or data object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string           $output     Output type. 'names' to return an array of taxonomy names, </span>&nbsp;</div></li><li><div><span class="comment"> *                                     or 'objects' to return an array of taxonomy objects.</span>&nbsp;</div></li><li><div><span class="comment"> *                                     Default is 'names'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Empty array on failure. List of taxonomies on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_attachment_taxonomies( $attachment, $output = 'names' ) {&nbsp;</div></li><li><div>  if ( is_int( $attachment ) ) {&nbsp;</div></li><li><div>      $attachment = get_post( $attachment );&nbsp;</div></li><li><div>  } elseif ( is_array( $attachment ) ) {&nbsp;</div></li><li><div>      $attachment = (object) $attachment;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( ! is_object($attachment) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $file = get_attached_file( $attachment-&gt;ID );&nbsp;</div></li><li><div>  $filename = basename( $file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $objects = array('attachment');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false !== strpos($filename, '.') )&nbsp;</div></li><li><div>      $objects[] = 'attachment:' . substr($filename, strrpos($filename, '.') + 1);&nbsp;</div></li><li><div>  if ( !empty($attachment-&gt;post_mime_type) ) {&nbsp;</div></li><li><div>      $objects[] = 'attachment:' . $attachment-&gt;post_mime_type;&nbsp;</div></li><li><div>      if ( false !== strpos($attachment-&gt;post_mime_type, '/') )&nbsp;</div></li><li><div>          foreach ( explode('/', $attachment-&gt;post_mime_type) as $token )&nbsp;</div></li><li><div>              if ( !empty($token) )&nbsp;</div></li><li><div>                  $objects[] = &quot;attachment:$token&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $taxonomies = array();&nbsp;</div></li><li><div>  foreach ( $objects as $object ) {&nbsp;</div></li><li><div>      if ( $taxes = get_object_taxonomies( $object, $output ) ) {&nbsp;</div></li><li><div>          $taxonomies = array_merge( $taxonomies, $taxes );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'names' === $output ) {&nbsp;</div></li><li><div>      $taxonomies = array_unique( $taxonomies );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $taxonomies;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves all of the taxonomy names that are registered for attachments.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Handles mime-type-specific taxonomies such as attachment:image and attachment:video.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_taxonomies()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $output Optional. The type of taxonomy output to return. Accepts 'names' or 'objects'.</span>&nbsp;</div></li><li><div><span class="comment"> *                       Default 'names'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The names of all taxonomy of $object_type.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_taxonomies_for_attachments( $output = 'names' ) {&nbsp;</div></li><li><div>  $taxonomies = array();&nbsp;</div></li><li><div>  foreach ( get_taxonomies( array(), 'objects' ) as $taxonomy ) {&nbsp;</div></li><li><div>      foreach ( $taxonomy-&gt;object_type as $object_type ) {&nbsp;</div></li><li><div>          if ( 'attachment' == $object_type || 0 === strpos( $object_type, 'attachment:' ) ) {&nbsp;</div></li><li><div>              if ( 'names' == $output )&nbsp;</div></li><li><div>                  $taxonomies[] = $taxonomy-&gt;name;&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $taxonomies[ $taxonomy-&gt;name ] = $taxonomy;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $taxonomies;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create new GD image resource with transparency support</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @todo: Deprecate if possible.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $width  Image width in pixels.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $height Image height in pixels..</span>&nbsp;</div></li><li><div><span class="comment"> * @return resource The GD image resource.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_imagecreatetruecolor($width, $height) {&nbsp;</div></li><li><div>  $img = imagecreatetruecolor($width, $height);&nbsp;</div></li><li><div>  if ( is_resource($img) && function_exists('imagealphablending') && function_exists('imagesavealpha') ) {&nbsp;</div></li><li><div>      imagealphablending($img, false);&nbsp;</div></li><li><div>      imagesavealpha($img, true);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $img;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Based on a supplied width/height example, return the biggest possible dimensions based on the max width/height.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_constrain_dimensions()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $example_width  The width of an example embed.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $example_height The height of an example embed.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $max_width      The maximum allowed width.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $max_height     The maximum allowed height.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The maximum possible width and height based on the example ratio.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_expand_dimensions( $example_width, $example_height, $max_width, $max_height ) {&nbsp;</div></li><li><div>  $example_width = (int) $example_width;&nbsp;</div></li><li><div>  $example_height = (int) $example_height;&nbsp;</div></li><li><div>  $max_width = (int) $max_width;&nbsp;</div></li><li><div>  $max_height = (int) $max_height;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return wp_constrain_dimensions( $example_width * 1000000, $example_height * 1000000, $max_width, $max_height );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Determines the maximum upload size allowed in php.ini.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return int Allowed upload size.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_max_upload_size() {&nbsp;</div></li><li><div>  $u_bytes = wp_convert_hr_to_bytes( ini_get( 'upload_max_filesize' ) );&nbsp;</div></li><li><div>  $p_bytes = wp_convert_hr_to_bytes( ini_get( 'post_max_size' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the maximum upload size allowed in php.ini.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $size    Max upload size limit in bytes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $u_bytes Maximum upload filesize in bytes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $p_bytes Maximum size of POST data in bytes.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'upload_size_limit', min( $u_bytes, $p_bytes ), $u_bytes, $p_bytes );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns a WP_Image_Editor instance and loads file into it.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $path Path to the file to load.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $args Optional. Additional arguments for retrieving the image editor.</span>&nbsp;</div></li><li><div><span class="comment"> *                     Default empty array.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Image_Editor|WP_Error The WP_Image_Editor object if successful, an WP_Error</span>&nbsp;</div></li><li><div><span class="comment"> *                                  object otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_image_editor( $path, $args = array() ) {&nbsp;</div></li><li><div>  $args['path'] = $path;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $args['mime_type'] ) ) {&nbsp;</div></li><li><div>      $file_info = wp_check_filetype( $args['path'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If $file_info['type'] is false, then we let the editor attempt to</span>&nbsp;</div></li><li><div>      <span class="comment">// figure out the file type, rather than forcing a failure based on extension.</span>&nbsp;</div></li><li><div>      if ( isset( $file_info ) && $file_info['type'] )&nbsp;</div></li><li><div>          $args['mime_type'] = $file_info['type'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $implementation = _wp_image_editor_choose( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $implementation ) {&nbsp;</div></li><li><div>      $editor = new $implementation( $path );&nbsp;</div></li><li><div>      $loaded = $editor-&gt;load();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_wp_error( $loaded ) )&nbsp;</div></li><li><div>          return $loaded;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $editor;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return new WP_Error( 'image_no_editor', __('No editor could be selected.') );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Tests whether there is an editor that supports a given mime type or methods.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $args Optional. Array of arguments to retrieve the image editor supports.</span>&nbsp;</div></li><li><div><span class="comment"> *                           Default empty array.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if an eligible editor is found; false otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_image_editor_supports( $args = array() ) {&nbsp;</div></li><li><div>  return (bool) _wp_image_editor_choose( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Tests which editors are capable of supporting the request.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @ignore</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args Optional. Array of arguments for choosing a capable editor. Default empty array.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|false Class name for the first editor that claims to support the request. False if no</span>&nbsp;</div></li><li><div><span class="comment"> *                     editor claims to support the request.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_image_editor_choose( $args = array() ) {&nbsp;</div></li><li><div>  require_once ABSPATH . WPINC . '/class-wp-image-editor.php';&nbsp;</div></li><li><div>  require_once ABSPATH . WPINC . '/class-wp-image-editor-gd.php';&nbsp;</div></li><li><div>  require_once ABSPATH . WPINC . '/class-wp-image-editor-imagick.php';&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of image editing library classes.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $image_editors List of available image editors. Defaults are</span>&nbsp;</div></li><li><div><span class="comment">   *                             'WP_Image_Editor_Imagick', 'WP_Image_Editor_GD'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $implementations = apply_filters( 'wp_image_editors', array( 'WP_Image_Editor_Imagick', 'WP_Image_Editor_GD' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $implementations as $implementation ) {&nbsp;</div></li><li><div>      if ( ! call_user_func( array( $implementation, 'test' ), $args ) )&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $args['mime_type'] ) &&&nbsp;</div></li><li><div>          ! call_user_func(&nbsp;</div></li><li><div>              array( $implementation, 'supports_mime_type' ), &nbsp;</div></li><li><div>              $args['mime_type'] ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $args['methods'] ) &&&nbsp;</div></li><li><div>           array_diff( $args['methods'], get_class_methods( $implementation ) ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $implementation;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Prints default Plupload arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_plupload_default_settings() {&nbsp;</div></li><li><div>  $wp_scripts = wp_scripts();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data = $wp_scripts-&gt;get_data( 'wp-plupload', 'data' );&nbsp;</div></li><li><div>  if ( $data && false !== strpos( $data, '_wpPluploadSettings' ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $max_upload_size = wp_max_upload_size();&nbsp;</div></li><li><div>  $allowed_extensions = array_keys( get_allowed_mime_types() );&nbsp;</div></li><li><div>  $extensions = array();&nbsp;</div></li><li><div>  foreach ( $allowed_extensions as $extension ) {&nbsp;</div></li><li><div>      $extensions = array_merge( $extensions, explode( '|', $extension ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'runtimes' =&gt; 'html5, flash, silverlight, html4', &nbsp;</div></li><li><div>      'file_data_name' =&gt; 'async-upload', <span class="comment">// key passed to $_FILE.</span>&nbsp;</div></li><li><div>      'url' =&gt; admin_url( 'async-upload.php', 'relative' ), &nbsp;</div></li><li><div>      'flash_swf_url' =&gt; includes_url( 'js/plupload/plupload.flash.swf' ), &nbsp;</div></li><li><div>      'silverlight_xap_url' =&gt; includes_url( 'js/plupload/plupload.silverlight.xap' ), &nbsp;</div></li><li><div>      'filters' =&gt; array(&nbsp;</div></li><li><div>          'max_file_size' =&gt; $max_upload_size . 'b', &nbsp;</div></li><li><div>          'mime_types' =&gt; array( array( 'extensions' =&gt; implode( ', ', $extensions ) ) ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Currently only iOS Safari supports multiple files uploading but iOS 7.x has a bug that prevents uploading of videos</span>&nbsp;</div></li><li><div>  <span class="comment">// when enabled. See #29602.</span>&nbsp;</div></li><li><div>  if ( wp_is_mobile() && strpos( $_SERVER['HTTP_USER_AGENT'], 'OS 7_' ) !== false &&&nbsp;</div></li><li><div>      strpos( $_SERVER['HTTP_USER_AGENT'], 'like Mac OS X' ) !== false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $defaults['multi_selection'] = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the Plupload default settings.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $defaults Default Plupload settings array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $defaults = apply_filters( 'plupload_default_settings', $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $params = array(&nbsp;</div></li><li><div>      'action' =&gt; 'upload-attachment', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the Plupload default parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $params Default Plupload parameters array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $params = apply_filters( 'plupload_default_params', $params );&nbsp;</div></li><li><div>  $params['_wpnonce'] = wp_create_nonce( 'media-form' );&nbsp;</div></li><li><div>  $defaults['multipart_params'] = $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = array(&nbsp;</div></li><li><div>      'defaults' =&gt; $defaults, &nbsp;</div></li><li><div>      'browser' =&gt; array(&nbsp;</div></li><li><div>          'mobile' =&gt; wp_is_mobile(), &nbsp;</div></li><li><div>          'supported' =&gt; _device_can_upload(), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'limitExceeded' =&gt; is_multisite() && ! is_upload_space_available()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $script = 'var _wpPluploadSettings = ' . wp_json_encode( $settings ) . ';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $data )&nbsp;</div></li><li><div>      $script = &quot;$data\n$script&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_scripts-&gt;add_data( 'wp-plupload', 'data', $script );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Prepares an attachment post object for JS, where it is expected</span>&nbsp;</div></li><li><div><span class="comment"> * to be JSON-encoded and fit into an Attachment model.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $attachment Attachment ID or object.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|void Array of attachment details.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_prepare_attachment_for_js( $attachment ) {&nbsp;</div></li><li><div>  if ( ! $attachment = get_post( $attachment ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'attachment' != $attachment-&gt;post_type )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta = wp_get_attachment_metadata( $attachment-&gt;ID );&nbsp;</div></li><li><div>  if ( false !== strpos( $attachment-&gt;post_mime_type, '/' ) )&nbsp;</div></li><li><div>      list( $type, $subtype ) = explode( '/', $attachment-&gt;post_mime_type );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      list( $type, $subtype ) = array( $attachment-&gt;post_mime_type, '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $attachment_url = wp_get_attachment_url( $attachment-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $response = array(&nbsp;</div></li><li><div>      'id' =&gt; $attachment-&gt;ID, &nbsp;</div></li><li><div>      'title' =&gt; $attachment-&gt;post_title, &nbsp;</div></li><li><div>      'filename' =&gt; wp_basename( get_attached_file( $attachment-&gt;ID ) ), &nbsp;</div></li><li><div>      'url' =&gt; $attachment_url, &nbsp;</div></li><li><div>      'link' =&gt; get_attachment_link( $attachment-&gt;ID ), &nbsp;</div></li><li><div>      'alt' =&gt; get_post_meta( $attachment-&gt;ID, '_wp_attachment_image_alt', true ), &nbsp;</div></li><li><div>      'author' =&gt; $attachment-&gt;post_author, &nbsp;</div></li><li><div>      'description' =&gt; $attachment-&gt;post_content, &nbsp;</div></li><li><div>      'caption' =&gt; $attachment-&gt;post_excerpt, &nbsp;</div></li><li><div>      'name' =&gt; $attachment-&gt;post_name, &nbsp;</div></li><li><div>      'status' =&gt; $attachment-&gt;post_status, &nbsp;</div></li><li><div>      'uploadedTo' =&gt; $attachment-&gt;post_parent, &nbsp;</div></li><li><div>      'date' =&gt; strtotime( $attachment-&gt;post_date_gmt ) * 1000, &nbsp;</div></li><li><div>      'modified' =&gt; strtotime( $attachment-&gt;post_modified_gmt ) * 1000, &nbsp;</div></li><li><div>      'menuOrder' =&gt; $attachment-&gt;menu_order, &nbsp;</div></li><li><div>      'mime' =&gt; $attachment-&gt;post_mime_type, &nbsp;</div></li><li><div>      'type' =&gt; $type, &nbsp;</div></li><li><div>      'subtype' =&gt; $subtype, &nbsp;</div></li><li><div>      'icon' =&gt; wp_mime_type_icon( $attachment-&gt;ID ), &nbsp;</div></li><li><div>      'dateFormatted' =&gt; mysql2date( __( 'F j, Y' ), $attachment-&gt;post_date ), &nbsp;</div></li><li><div>      'nonces' =&gt; array(&nbsp;</div></li><li><div>          'update' =&gt; false, &nbsp;</div></li><li><div>          'delete' =&gt; false, &nbsp;</div></li><li><div>          'edit' =&gt; false&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'editLink' =&gt; false, &nbsp;</div></li><li><div>      'meta' =&gt; false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $author = new WP_User( $attachment-&gt;post_author );&nbsp;</div></li><li><div>  $response['authorName'] = $author-&gt;display_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $attachment-&gt;post_parent ) {&nbsp;</div></li><li><div>      $post_parent = get_post( $attachment-&gt;post_parent );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $post_parent = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $post_parent ) {&nbsp;</div></li><li><div>      $parent_type = get_post_type_object( $post_parent-&gt;post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $parent_type && $parent_type-&gt;show_ui && current_user_can( 'edit_post', $attachment-&gt;post_parent ) ) {&nbsp;</div></li><li><div>          $response['uploadedToLink'] = get_edit_post_link( $attachment-&gt;post_parent, 'raw' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $parent_type && current_user_can( 'read_post', $attachment-&gt;post_parent ) ) {&nbsp;</div></li><li><div>          $response['uploadedToTitle'] = $post_parent-&gt;post_title ? $post_parent-&gt;post_title : __( '(no title)' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $attached_file = get_attached_file( $attachment-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $meta['filesize'] ) ) {&nbsp;</div></li><li><div>      $bytes = $meta['filesize'];&nbsp;</div></li><li><div>  } elseif ( file_exists( $attached_file ) ) {&nbsp;</div></li><li><div>      $bytes = filesize( $attached_file );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $bytes = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $bytes ) {&nbsp;</div></li><li><div>      $response['filesizeInBytes'] = $bytes;&nbsp;</div></li><li><div>      $response['filesizeHumanReadable'] = size_format( $bytes );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( current_user_can( 'edit_post', $attachment-&gt;ID ) ) {&nbsp;</div></li><li><div>      $response['nonces']['update'] = wp_create_nonce( 'update-post_' . $attachment-&gt;ID );&nbsp;</div></li><li><div>      $response['nonces']['edit'] = wp_create_nonce( 'image_editor-' . $attachment-&gt;ID );&nbsp;</div></li><li><div>      $response['editLink'] = get_edit_post_link( $attachment-&gt;ID, 'raw' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( current_user_can( 'delete_post', $attachment-&gt;ID ) )&nbsp;</div></li><li><div>      $response['nonces']['delete'] = wp_create_nonce( 'delete-post_' . $attachment-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $meta && ( 'image' === $type || ! empty( $meta['sizes'] ) ) ) {&nbsp;</div></li><li><div>      $sizes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-admin/includes/media.php */</span></span></span>&nbsp;</div></li><li><div>      $possible_sizes = apply_filters( 'image_size_names_choose', array(&nbsp;</div></li><li><div>          'thumbnail' =&gt; __('Thumbnail'), &nbsp;</div></li><li><div>          'medium' =&gt; __('Medium'), &nbsp;</div></li><li><div>          'large' =&gt; __('Large'), &nbsp;</div></li><li><div>          'full' =&gt; __('Full Size'), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      unset( $possible_sizes['full'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Loop through all potential sizes that may be chosen. Try to do this with some efficiency.</span>&nbsp;</div></li><li><div>      <span class="comment">// First: run the image_downsize filter. If it returns something, we can use its data.</span>&nbsp;</div></li><li><div>      <span class="comment">// If the filter does not return something, then image_downsize() is just an expensive</span>&nbsp;</div></li><li><div>      <span class="comment">// way to check the image metadata, which we do second.</span>&nbsp;</div></li><li><div>      foreach ( $possible_sizes as $size =&gt; $label ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/** This filter is documented in wp-includes/media.php */</span>&nbsp;</div></li><li><div>          if ( $downsize = apply_filters( 'image_downsize', false, $attachment-&gt;ID, $size ) ) {&nbsp;</div></li><li><div>              if ( empty( $downsize[3] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sizes[ $size ] = array(&nbsp;</div></li><li><div>                  'height' =&gt; $downsize[2], &nbsp;</div></li><li><div>                  'width' =&gt; $downsize[1], &nbsp;</div></li><li><div>                  'url' =&gt; $downsize[0], &nbsp;</div></li><li><div>                  'orientation' =&gt; $downsize[2] &gt; $downsize[1] ? 'portrait' : 'landscape', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          } elseif ( isset( $meta['sizes'][ $size ] ) ) {&nbsp;</div></li><li><div>              if ( ! isset( $base_url ) )&nbsp;</div></li><li><div>                  $base_url = str_replace( wp_basename( $attachment_url ), '', $attachment_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Nothing from the filter, so consult image metadata if we have it.</span>&nbsp;</div></li><li><div>              $size_meta = $meta['sizes'][ $size ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// We have the actual image size, but might need to further constrain it if content_width is narrower.</span>&nbsp;</div></li><li><div>              <span class="comment">// Thumbnail, medium, and full sizes are also checked against the site's height/width options.</span>&nbsp;</div></li><li><div>              list( $width, $height ) = image_constrain_size_for_editor( $size_meta['width'], $size_meta['height'], $size, 'edit' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sizes[ $size ] = array(&nbsp;</div></li><li><div>                  'height' =&gt; $height, &nbsp;</div></li><li><div>                  'width' =&gt; $width, &nbsp;</div></li><li><div>                  'url' =&gt; $base_url . $size_meta['file'], &nbsp;</div></li><li><div>                  'orientation' =&gt; $height &gt; $width ? 'portrait' : 'landscape', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'image' === $type ) {&nbsp;</div></li><li><div>          $sizes['full'] = array( 'url' =&gt; $attachment_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $meta['height'], $meta['width'] ) ) {&nbsp;</div></li><li><div>              $sizes['full']['height'] = $meta['height'];&nbsp;</div></li><li><div>              $sizes['full']['width'] = $meta['width'];&nbsp;</div></li><li><div>              $sizes['full']['orientation'] = $meta['height'] &gt; $meta['width'] ? 'portrait' : 'landscape';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $response = array_merge( $response, $sizes['full'] );&nbsp;</div></li><li><div>      } elseif ( $meta['sizes']['full']['file'] ) {&nbsp;</div></li><li><div>          $sizes['full'] = array(&nbsp;</div></li><li><div>              'url' =&gt; $base_url . $meta['sizes']['full']['file'], &nbsp;</div></li><li><div>              'height' =&gt; $meta['sizes']['full']['height'], &nbsp;</div></li><li><div>              'width' =&gt; $meta['sizes']['full']['width'], &nbsp;</div></li><li><div>              'orientation' =&gt; $meta['sizes']['full']['height'] &gt; $meta['sizes']['full']['width'] ? 'portrait' : 'landscape'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $response = array_merge( $response, array( 'sizes' =&gt; $sizes ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $meta && 'video' === $type ) {&nbsp;</div></li><li><div>      if ( isset( $meta['width'] ) )&nbsp;</div></li><li><div>          $response['width'] = (int) $meta['width'];&nbsp;</div></li><li><div>      if ( isset( $meta['height'] ) )&nbsp;</div></li><li><div>          $response['height'] = (int) $meta['height'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $meta && ( 'audio' === $type || 'video' === $type ) ) {&nbsp;</div></li><li><div>      if ( isset( $meta['length_formatted'] ) )&nbsp;</div></li><li><div>          $response['fileLength'] = $meta['length_formatted'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $response['meta'] = array();&nbsp;</div></li><li><div>      foreach ( wp_get_attachment_id3_keys( $attachment, 'js' ) as $key =&gt; $label ) {&nbsp;</div></li><li><div>          $response['meta'][ $key ] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $meta[ $key ] ) ) {&nbsp;</div></li><li><div>              $response['meta'][ $key ] = $meta[ $key ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $id = get_post_thumbnail_id( $attachment-&gt;ID );&nbsp;</div></li><li><div>      if ( ! empty( $id ) ) {&nbsp;</div></li><li><div>          list( $src, $width, $height ) = wp_get_attachment_image_src( $id, 'full' );&nbsp;</div></li><li><div>          $response['image'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>          list( $src, $width, $height ) = wp_get_attachment_image_src( $id, 'thumbnail' );&nbsp;</div></li><li><div>          $response['thumb'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $src = wp_mime_type_icon( $attachment-&gt;ID );&nbsp;</div></li><li><div>          $width = 48;&nbsp;</div></li><li><div>          $height = 64;&nbsp;</div></li><li><div>          $response['image'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>          $response['thumb'] = compact( 'src', 'width', 'height' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( function_exists('get_compat_media_markup') )&nbsp;</div></li><li><div>      $response['compat'] = get_compat_media_markup( $attachment-&gt;ID, array( 'in_modal' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the attachment data prepared for JavaScript.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array      $response   Array of prepared attachment data.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|object $attachment Attachment ID or object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array      $meta       Array of attachment meta data.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'wp_prepare_attachment_for_js', $response, $attachment, $meta );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Enqueues all scripts, styles, settings, and templates necessary to use</span>&nbsp;</div></li><li><div><span class="comment"> * all media JS APIs.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global int       $content_width</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb      $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Locale $wp_locale</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Arguments for enqueuing media scripts.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int|WP_Post A post object or ID.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_enqueue_media( $args = array() ) {&nbsp;</div></li><li><div>  <span class="comment">// Enqueue me just once per page, please.</span>&nbsp;</div></li><li><div>  if ( did_action( 'wp_enqueue_media' ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $content_width, $wpdb, $wp_locale;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'post' =&gt; null, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// We're going to pass the old thickbox media tabs to `media_upload_tabs`</span>&nbsp;</div></li><li><div>  <span class="comment">// to ensure plugins will work. We will then unset those tabs.</span>&nbsp;</div></li><li><div>  $tabs = array(&nbsp;</div></li><li><div>      <span class="comment">// handler action suffix =&gt; tab label</span>&nbsp;</div></li><li><div>      'type' =&gt; '', &nbsp;</div></li><li><div>      'type_url' =&gt; '', &nbsp;</div></li><li><div>      'gallery' =&gt; '', &nbsp;</div></li><li><div>      'library' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-admin/includes/media.php */</span></span></span>&nbsp;</div></li><li><div>  $tabs = apply_filters( 'media_upload_tabs', $tabs );&nbsp;</div></li><li><div>  unset( $tabs['type'], $tabs['type_url'], $tabs['gallery'], $tabs['library'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $props = array(&nbsp;</div></li><li><div>      'link' =&gt; get_option( 'image_default_link_type' ), <span class="comment">// db default is 'file'</span>&nbsp;</div></li><li><div>      'align' =&gt; get_option( 'image_default_align' ), <span class="comment"><span class="comment">// empty default</span></span>&nbsp;</div></li><li><div>      'size' =&gt; get_option( 'image_default_size' ), <span class="comment"><span class="comment">// empty default</span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $exts = array_merge( wp_get_audio_extensions(), wp_get_video_extensions() );&nbsp;</div></li><li><div>  $mimes = get_allowed_mime_types();&nbsp;</div></li><li><div>  $ext_mimes = array();&nbsp;</div></li><li><div>  foreach ( $exts as $ext ) {&nbsp;</div></li><li><div>      foreach ( $mimes as $ext_preg =&gt; $mime_match ) {&nbsp;</div></li><li><div>          if ( preg_match( '#' . $ext . '#i', $ext_preg ) ) {&nbsp;</div></li><li><div>              $ext_mimes[ $ext ] = $mime_match;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $has_audio = $wpdb-&gt;get_var( &quot;&nbsp;</div></li><li><div>      SELECT ID&nbsp;</div></li><li><div>      FROM $wpdb-&gt;posts&nbsp;</div></li><li><div>      WHERE post_type = 'attachment'&nbsp;</div></li><li><div>      AND post_mime_type LIKE 'audio%'&nbsp;</div></li><li><div>      LIMIT 1&nbsp;</div></li><li><div>  &quot; );&nbsp;</div></li><li><div>  $has_video = $wpdb-&gt;get_var( &quot;&nbsp;</div></li><li><div>      SELECT ID&nbsp;</div></li><li><div>      FROM $wpdb-&gt;posts&nbsp;</div></li><li><div>      WHERE post_type = 'attachment'&nbsp;</div></li><li><div>      AND post_mime_type LIKE 'video%'&nbsp;</div></li><li><div>      LIMIT 1&nbsp;</div></li><li><div>  &quot; );&nbsp;</div></li><li><div>  $months = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;&nbsp;</div></li><li><div>      SELECT DISTINCT YEAR( post_date ) AS year, MONTH( post_date ) AS month&nbsp;</div></li><li><div>      FROM $wpdb-&gt;posts&nbsp;</div></li><li><div>      WHERE post_type = %s&nbsp;</div></li><li><div>      ORDER BY post_date DESC&nbsp;</div></li><li><div>  &quot;, 'attachment' ) );&nbsp;</div></li><li><div>  foreach ( $months as $month_year ) {&nbsp;</div></li><li><div>      $month_year-&gt;text = sprintf( __( '%1$s %2$d' ), $wp_locale-&gt;get_month( $month_year-&gt;month ), $month_year-&gt;year );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = array(&nbsp;</div></li><li><div>      'tabs' =&gt; $tabs, &nbsp;</div></li><li><div>      'tabUrl' =&gt; add_query_arg( array( 'chromeless' =&gt; true ), admin_url('media-upload.php') ), &nbsp;</div></li><li><div>      'mimeTypes' =&gt; wp_list_pluck( get_post_mime_types(), 0 ), &nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-admin/includes/media.php */</span></span></span>&nbsp;</div></li><li><div>      'captions' =&gt; ! apply_filters( 'disable_captions', '' ), &nbsp;</div></li><li><div>      'nonce' =&gt; array(&nbsp;</div></li><li><div>          'sendToEditor' =&gt; wp_create_nonce( 'media-send-to-editor' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'post' =&gt; array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'defaultProps' =&gt; $props, &nbsp;</div></li><li><div>      'attachmentCounts' =&gt; array(&nbsp;</div></li><li><div>          'audio' =&gt; ( $has_audio ) ? 1 : 0, &nbsp;</div></li><li><div>          'video' =&gt; ( $has_video ) ? 1 : 0&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'embedExts' =&gt; $exts, &nbsp;</div></li><li><div>      'embedMimes' =&gt; $ext_mimes, &nbsp;</div></li><li><div>      'contentWidth' =&gt; $content_width, &nbsp;</div></li><li><div>      'months' =&gt; $months, &nbsp;</div></li><li><div>      'mediaTrash' =&gt; MEDIA_TRASH ? 1 : 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post = null;&nbsp;</div></li><li><div>  if ( isset( $args['post'] ) ) {&nbsp;</div></li><li><div>      $post = get_post( $args['post'] );&nbsp;</div></li><li><div>      $settings['post'] = array(&nbsp;</div></li><li><div>          'id' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>          'nonce' =&gt; wp_create_nonce( 'update-post_' . $post-&gt;ID ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $thumbnail_support = current_theme_supports( 'post-thumbnails', $post-&gt;post_type ) && post_type_supports( $post-&gt;post_type, 'thumbnail' );&nbsp;</div></li><li><div>      if ( ! $thumbnail_support && 'attachment' === $post-&gt;post_type && $post-&gt;post_mime_type ) {&nbsp;</div></li><li><div>          if ( wp_attachment_is( 'audio', $post ) ) {&nbsp;</div></li><li><div>              $thumbnail_support = post_type_supports( 'attachment:audio', 'thumbnail' ) || current_theme_supports( 'post-thumbnails', 'attachment:audio' );&nbsp;</div></li><li><div>          } elseif ( wp_attachment_is( 'video', $post ) ) {&nbsp;</div></li><li><div>              $thumbnail_support = post_type_supports( 'attachment:video', 'thumbnail' ) || current_theme_supports( 'post-thumbnails', 'attachment:video' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $thumbnail_support ) {&nbsp;</div></li><li><div>          $featured_image_id = get_post_meta( $post-&gt;ID, '_thumbnail_id', true );&nbsp;</div></li><li><div>          $settings['post']['featuredImageId'] = $featured_image_id ? $featured_image_id : -1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $post ) {&nbsp;</div></li><li><div>      $post_type_object = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $post_type_object = get_post_type_object( 'post' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $strings = array(&nbsp;</div></li><li><div>      <span class="comment">// Generic</span>&nbsp;</div></li><li><div>      'url' =&gt; __( 'URL' ), &nbsp;</div></li><li><div>      'addMedia' =&gt; __( 'Add Media' ), &nbsp;</div></li><li><div>      'search' =&gt; __( 'Search' ), &nbsp;</div></li><li><div>      'select' =&gt; __( 'Select' ), &nbsp;</div></li><li><div>      'cancel' =&gt; __( 'Cancel' ), &nbsp;</div></li><li><div>      'update' =&gt; __( 'Update' ), &nbsp;</div></li><li><div>      'replace' =&gt; __( 'Replace' ), &nbsp;</div></li><li><div>      'remove' =&gt; __( 'Remove' ), &nbsp;</div></li><li><div>      'back' =&gt; __( 'Back' ), &nbsp;</div></li><li><div>      <span class="comment">/** translators: This is a would-be plural string used in the media manager.</span>&nbsp;</div></li><li><div><span class="comment">         If there is not a word you can use in your language to avoid issues with the</span>&nbsp;</div></li><li><div><span class="comment">         lack of plural support here, turn it into &quot;selected: %d&quot; then translate it.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      'selected' =&gt; __( '%d selected' ), &nbsp;</div></li><li><div>      'dragInfo' =&gt; __( 'Drag and drop to reorder media files.' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Upload</span>&nbsp;</div></li><li><div>      'uploadFilesTitle' =&gt; __( 'Upload Files' ), &nbsp;</div></li><li><div>      'uploadImagesTitle' =&gt; __( 'Upload Images' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Library</span>&nbsp;</div></li><li><div>      'mediaLibraryTitle' =&gt; __( 'Media Library' ), &nbsp;</div></li><li><div>      'insertMediaTitle' =&gt; __( 'Insert Media' ), &nbsp;</div></li><li><div>      'createNewGallery' =&gt; __( 'Create a new gallery' ), &nbsp;</div></li><li><div>      'createNewPlaylist' =&gt; __( 'Create a new playlist' ), &nbsp;</div></li><li><div>      'createNewVideoPlaylist' =&gt; __( 'Create a new video playlist' ), &nbsp;</div></li><li><div>      'returnToLibrary' =&gt; __( '&#8592; Return to library' ), &nbsp;</div></li><li><div>      'allMediaItems' =&gt; __( 'All media items' ), &nbsp;</div></li><li><div>      'allDates' =&gt; __( 'All dates' ), &nbsp;</div></li><li><div>      'noItemsFound' =&gt; __( 'No items found.' ), &nbsp;</div></li><li><div>      'insertIntoPost' =&gt; $post_type_object-&gt;labels-&gt;insert_into_item, &nbsp;</div></li><li><div>      'unattached' =&gt; __( 'Unattached' ), &nbsp;</div></li><li><div>      'trash' =&gt; _x( 'Trash', 'noun' ), &nbsp;</div></li><li><div>      'uploadedToThisPost' =&gt; $post_type_object-&gt;labels-&gt;uploaded_to_this_item, &nbsp;</div></li><li><div>      'warnDelete' =&gt; __( &quot;You are about to permanently delete this item.\n  'Cancel' to stop, 'OK' to delete.&quot; ), &nbsp;</div></li><li><div>      'warnBulkDelete' =&gt; __( &quot;You are about to permanently delete these items.\n  'Cancel' to stop, 'OK' to delete.&quot; ), &nbsp;</div></li><li><div>      'warnBulkTrash' =&gt; __( &quot;You are about to trash these items.\n  'Cancel' to stop, 'OK' to delete.&quot; ), &nbsp;</div></li><li><div>      'bulkSelect' =&gt; __( 'Bulk Select' ), &nbsp;</div></li><li><div>      'cancelSelection' =&gt; __( 'Cancel Selection' ), &nbsp;</div></li><li><div>      'trashSelected' =&gt; __( 'Trash Selected' ), &nbsp;</div></li><li><div>      'untrashSelected' =&gt; __( 'Untrash Selected' ), &nbsp;</div></li><li><div>      'deleteSelected' =&gt; __( 'Delete Selected' ), &nbsp;</div></li><li><div>      'deletePermanently' =&gt; __( 'Delete Permanently' ), &nbsp;</div></li><li><div>      'apply' =&gt; __( 'Apply' ), &nbsp;</div></li><li><div>      'filterByDate' =&gt; __( 'Filter by date' ), &nbsp;</div></li><li><div>      'filterByType' =&gt; __( 'Filter by type' ), &nbsp;</div></li><li><div>      'searchMediaLabel' =&gt; __( 'Search Media' ), &nbsp;</div></li><li><div>      'searchMediaPlaceholder' =&gt; __( 'Search media items...' ), <span class="comment">// placeholder (no ellipsis)</span>&nbsp;</div></li><li><div>      'noMedia' =&gt; __( 'No media files found.' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Library</span> Details&nbsp;</div></li><li><div>      'attachmentDetails' =&gt; __( 'Attachment Details' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// From URL</span>&nbsp;</div></li><li><div>      'insertFromUrlTitle' =&gt; __( 'Insert from URL' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Featured Images</span>&nbsp;</div></li><li><div>      'setFeaturedImageTitle' =&gt; $post_type_object-&gt;labels-&gt;featured_image, &nbsp;</div></li><li><div>      'setFeaturedImage' =&gt; $post_type_object-&gt;labels-&gt;set_featured_image, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Gallery</span>&nbsp;</div></li><li><div>      'createGalleryTitle' =&gt; __( 'Create Gallery' ), &nbsp;</div></li><li><div>      'editGalleryTitle' =&gt; __( 'Edit Gallery' ), &nbsp;</div></li><li><div>      'cancelGalleryTitle' =&gt; __( '&#8592; Cancel Gallery' ), &nbsp;</div></li><li><div>      'insertGallery' =&gt; __( 'Insert gallery' ), &nbsp;</div></li><li><div>      'updateGallery' =&gt; __( 'Update gallery' ), &nbsp;</div></li><li><div>      'addToGallery' =&gt; __( 'Add to gallery' ), &nbsp;</div></li><li><div>      'addToGalleryTitle' =&gt; __( 'Add to Gallery' ), &nbsp;</div></li><li><div>      'reverseOrder' =&gt; __( 'Reverse order' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Edit Image</span>&nbsp;</div></li><li><div>      'imageDetailsTitle' =&gt; __( 'Image Details' ), &nbsp;</div></li><li><div>      'imageReplaceTitle' =&gt; __( 'Replace Image' ), &nbsp;</div></li><li><div>      'imageDetailsCancel' =&gt; __( 'Cancel Edit' ), &nbsp;</div></li><li><div>      'editImage' =&gt; __( 'Edit Image' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Crop Image</span>&nbsp;</div></li><li><div>      'chooseImage' =&gt; __( 'Choose Image' ), &nbsp;</div></li><li><div>      'selectAndCrop' =&gt; __( 'Select and Crop' ), &nbsp;</div></li><li><div>      'skipCropping' =&gt; __( 'Skip Cropping' ), &nbsp;</div></li><li><div>      'cropImage' =&gt; __( 'Crop Image' ), &nbsp;</div></li><li><div>      'cropYourImage' =&gt; __( 'Crop your image' ), &nbsp;</div></li><li><div>      'cropping' =&gt; __( 'Cropping&hellip;' ), &nbsp;</div></li><li><div>      'suggestedDimensions' =&gt; __( 'Suggested image dimensions:' ), &nbsp;</div></li><li><div>      'cropError' =&gt; __( 'There has been an error cropping your image.' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Edit Audio</span>&nbsp;</div></li><li><div>      'audioDetailsTitle' =&gt; __( 'Audio Details' ), &nbsp;</div></li><li><div>      'audioReplaceTitle' =&gt; __( 'Replace Audio' ), &nbsp;</div></li><li><div>      'audioAddSourceTitle' =&gt; __( 'Add Audio Source' ), &nbsp;</div></li><li><div>      'audioDetailsCancel' =&gt; __( 'Cancel Edit' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Edit Video</span>&nbsp;</div></li><li><div>      'videoDetailsTitle' =&gt; __( 'Video Details' ), &nbsp;</div></li><li><div>      'videoReplaceTitle' =&gt; __( 'Replace Video' ), &nbsp;</div></li><li><div>      'videoAddSourceTitle' =&gt; __( 'Add Video Source' ), &nbsp;</div></li><li><div>      'videoDetailsCancel' =&gt; __( 'Cancel Edit' ), &nbsp;</div></li><li><div>      'videoSelectPosterImageTitle' =&gt; __( 'Select Poster Image' ), &nbsp;</div></li><li><div>      'videoAddTrackTitle' =&gt; __( 'Add Subtitles' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>       <span class="comment">// Playlist</span>&nbsp;</div></li><li><div>       'playlistDragInfo' =&gt; __( 'Drag and drop to reorder tracks.' ), &nbsp;</div></li><li><div>       'createPlaylistTitle' =&gt; __( 'Create Audio Playlist' ), &nbsp;</div></li><li><div>       'editPlaylistTitle' =&gt; __( 'Edit Audio Playlist' ), &nbsp;</div></li><li><div>       'cancelPlaylistTitle' =&gt; __( '&#8592; Cancel Audio Playlist' ), &nbsp;</div></li><li><div>       'insertPlaylist' =&gt; __( 'Insert audio playlist' ), &nbsp;</div></li><li><div>       'updatePlaylist' =&gt; __( 'Update audio playlist' ), &nbsp;</div></li><li><div>       'addToPlaylist' =&gt; __( 'Add to audio playlist' ), &nbsp;</div></li><li><div>       'addToPlaylistTitle' =&gt; __( 'Add to Audio Playlist' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>       <span class="comment">// Video Playlist</span>&nbsp;</div></li><li><div>       'videoPlaylistDragInfo' =&gt; __( 'Drag and drop to reorder videos.' ), &nbsp;</div></li><li><div>       'createVideoPlaylistTitle' =&gt; __( 'Create Video Playlist' ), &nbsp;</div></li><li><div>       'editVideoPlaylistTitle' =&gt; __( 'Edit Video Playlist' ), &nbsp;</div></li><li><div>       'cancelVideoPlaylistTitle' =&gt; __( '&#8592; Cancel Video Playlist' ), &nbsp;</div></li><li><div>       'insertVideoPlaylist' =&gt; __( 'Insert video playlist' ), &nbsp;</div></li><li><div>       'updateVideoPlaylist' =&gt; __( 'Update video playlist' ), &nbsp;</div></li><li><div>       'addToVideoPlaylist' =&gt; __( 'Add to video playlist' ), &nbsp;</div></li><li><div>       'addToVideoPlaylistTitle' =&gt; __( 'Add to Video Playlist' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the media view settings.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array   $settings List of media view settings.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post     Post object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $settings = apply_filters( 'media_view_settings', $settings, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the media view strings.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array   $strings List of media view strings.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post    Post object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $strings = apply_filters( 'media_view_strings', $strings, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $strings['settings'] = $settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Ensure we enqueue media-editor first, that way media-views is</span>&nbsp;</div></li><li><div>  <span class="comment">// registered internally before we try to localize it. see #24724.</span>&nbsp;</div></li><li><div>  wp_enqueue_script( 'media-editor' );&nbsp;</div></li><li><div>  wp_localize_script( 'media-views', '_wpMediaViewsL10n', $strings );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_enqueue_script( 'media-audiovideo' );&nbsp;</div></li><li><div>  wp_enqueue_style( 'media-views' );&nbsp;</div></li><li><div>  if ( is_admin() ) {&nbsp;</div></li><li><div>      wp_enqueue_script( 'mce-view' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'image-edit' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  wp_enqueue_style( 'imgareaselect' );&nbsp;</div></li><li><div>  wp_plupload_default_settings();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  require_once ABSPATH . WPINC . '/media-template.php';&nbsp;</div></li><li><div>  add_action( 'admin_footer', 'wp_print_media_templates' );&nbsp;</div></li><li><div>  add_action( 'wp_footer', 'wp_print_media_templates' );&nbsp;</div></li><li><div>  add_action( 'customize_controls_print_footer_scripts', 'wp_print_media_templates' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires at the conclusion of wp_enqueue_media().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'wp_enqueue_media' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves media attached to the passed post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $type Mime type.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|WP_Post $post Optional. Post ID or WP_Post object. Default is global $post.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Found attachments.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_attached_media( $type, $post = 0 ) {&nbsp;</div></li><li><div>  if ( ! $post = get_post( $post ) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array(&nbsp;</div></li><li><div>      'post_parent' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>      'post_type' =&gt; 'attachment', &nbsp;</div></li><li><div>      'post_mime_type' =&gt; $type, &nbsp;</div></li><li><div>      'posts_per_page' =&gt; -1, &nbsp;</div></li><li><div>      'orderby' =&gt; 'menu_order', &nbsp;</div></li><li><div>      'order' =&gt; 'ASC', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters arguments used to retrieve media attached to the given post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args Post query arguments.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type Mime type of the desired media.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $post Post ID or object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $args = apply_filters( 'get_attached_media_args', $args, $type, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $children = get_children( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of media attached to the given post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $children Associative array of media attached to the given post.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type     Mime type of the media desired.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $post     Post ID or object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return (array) apply_filters( 'get_attached_media', $children, $type, $post );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check the content blob for an audio, video, object, embed, or iframe tags.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content A string which might contain media data.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $types   An array of media types: 'audio', 'video', 'object', 'embed', or 'iframe'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array A list of found HTML media embeds.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_media_embedded_in_content( $content, $types = null ) {&nbsp;</div></li><li><div>  $html = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the embedded media types that are allowed to be returned from the content blob.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $allowed_media_types An array of allowed media types. Default media types are</span>&nbsp;</div></li><li><div><span class="comment">   *                                   'audio', 'video', 'object', 'embed', and 'iframe'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $allowed_media_types = apply_filters( 'media_embedded_in_content_allowed_types', array( 'audio', 'video', 'object', 'embed', 'iframe' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $types ) ) {&nbsp;</div></li><li><div>      if ( ! is_array( $types ) ) {&nbsp;</div></li><li><div>          $types = array( $types );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $allowed_media_types = array_intersect( $allowed_media_types, $types );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tags = implode( '|', $allowed_media_types );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( preg_match_all( '#&lt;(?P&lt;tag&gt;' . $tags . ')[^&lt;]*?(?:&gt;[\s\S]*?&lt;\/(?P=tag)&gt;|\s*\/&gt;)#', $content, $matches ) ) {&nbsp;</div></li><li><div>      foreach ( $matches[0] as $match ) {&nbsp;</div></li><li><div>          $html[] = $match;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves galleries from the passed post's content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|WP_Post $post Post ID or object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool        $html Optional. Whether to return HTML or data in the array. Default true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array A list of arrays, each containing gallery data and srcs parsed</span>&nbsp;</div></li><li><div><span class="comment"> *               from the expanded shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_post_galleries( $post, $html = true ) {&nbsp;</div></li><li><div>  if ( ! $post = get_post( $post ) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! has_shortcode( $post-&gt;post_content, 'gallery' ) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $galleries = array();&nbsp;</div></li><li><div>  if ( preg_match_all( '/' . get_shortcode_regex() . '/s', $post-&gt;post_content, $matches, PREG_SET_ORDER ) ) {&nbsp;</div></li><li><div>      foreach ( $matches as $shortcode ) {&nbsp;</div></li><li><div>          if ( 'gallery' === $shortcode[2] ) {&nbsp;</div></li><li><div>              $srcs = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $gallery = do_shortcode_tag( $shortcode );&nbsp;</div></li><li><div>              if ( $html ) {&nbsp;</div></li><li><div>                  $galleries[] = $gallery;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  preg_match_all( '#src=([\'&quot;])(.+?)\1#is', $gallery, $src, PREG_SET_ORDER );&nbsp;</div></li><li><div>                  if ( ! empty( $src ) ) {&nbsp;</div></li><li><div>                      foreach ( $src as $s )&nbsp;</div></li><li><div>                          $srcs[] = $s[2];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $data = shortcode_parse_atts( $shortcode[3] );&nbsp;</div></li><li><div>                  $data['src'] = array_values( array_unique( $srcs ) );&nbsp;</div></li><li><div>                  $galleries[] = $data;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of all found galleries in the given post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array   $galleries Associative array of all found post galleries.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post      Post object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'get_post_galleries', $galleries, $post );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check a specified post's content for gallery and, if present, return the first</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|WP_Post $post Optional. Post ID or WP_Post object. Default is global $post.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool        $html Optional. Whether to return HTML or data. Default is true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|array Gallery data and srcs parsed from the expanded shortcode.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_post_gallery( $post = 0, $html = true ) {&nbsp;</div></li><li><div>  $galleries = get_post_galleries( $post, $html );&nbsp;</div></li><li><div>  $gallery = reset( $galleries );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the first-found post gallery.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array       $gallery   The first-found post gallery.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|WP_Post $post      Post ID or object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array       $galleries Associative array of all found post galleries.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'get_post_gallery', $gallery, $post, $galleries );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the image srcs from galleries from a post's content, if present</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_post_galleries()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|WP_Post $post Optional. Post ID or WP_Post object. Default is global `$post`.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array A list of lists, each containing image srcs parsed.</span>&nbsp;</div></li><li><div><span class="comment"> *               from an expanded shortcode</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_post_galleries_images( $post = 0 ) {&nbsp;</div></li><li><div>  $galleries = get_post_galleries( $post, false );&nbsp;</div></li><li><div>  return wp_list_pluck( $galleries, 'src' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks a post's content for galleries and return the image srcs for the first found gallery</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_post_gallery()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|WP_Post $post Optional. Post ID or WP_Post object. Default is global `$post`.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array A list of a gallery's image srcs in order.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_post_gallery_images( $post = 0 ) {&nbsp;</div></li><li><div>  $gallery = get_post_gallery( $post, false );&nbsp;</div></li><li><div>  return empty( $gallery['src'] ) ? array() : $gallery['src'];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Maybe attempts to generate attachment metadata, if missing.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Post $attachment Attachment object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_maybe_generate_attachment_metadata( $attachment ) {&nbsp;</div></li><li><div>  if ( empty( $attachment ) || ( empty( $attachment-&gt;ID ) || ! $attachment_id = (int) $attachment-&gt;ID ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $file = get_attached_file( $attachment_id );&nbsp;</div></li><li><div>  $meta = wp_get_attachment_metadata( $attachment_id );&nbsp;</div></li><li><div>  if ( empty( $meta ) && file_exists( $file ) ) {&nbsp;</div></li><li><div>      $_meta = get_post_meta( $attachment_id );&nbsp;</div></li><li><div>      $regeneration_lock = 'wp_generating_att_' . $attachment_id;&nbsp;</div></li><li><div>      if ( ! array_key_exists( '_wp_attachment_metadata', $_meta ) && ! get_transient( $regeneration_lock ) ) {&nbsp;</div></li><li><div>          set_transient( $regeneration_lock, $file );&nbsp;</div></li><li><div>          wp_update_attachment_metadata( $attachment_id, wp_generate_attachment_metadata( $attachment_id, $file ) );&nbsp;</div></li><li><div>          delete_transient( $regeneration_lock );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Tries to convert an attachment URL into a post ID.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $url The URL to resolve.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int The found post ID, or 0 on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function attachment_url_to_postid( $url ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $dir = wp_get_upload_dir();&nbsp;</div></li><li><div>  $path = $url;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $site_url = parse_url( $dir['url'] );&nbsp;</div></li><li><div>  $image_path = parse_url( $path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//force the protocols to match if needed</span>&nbsp;</div></li><li><div>  if ( isset( $image_path['scheme'] ) && ( $image_path['scheme'] !== $site_url['scheme'] ) ) {&nbsp;</div></li><li><div>      $path = str_replace( $image_path['scheme'], $site_url['scheme'], $path );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 === strpos( $path, $dir['baseurl'] . '/' ) ) {&nbsp;</div></li><li><div>      $path = substr( $path, strlen( $dir['baseurl'] . '/' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sql = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>      &quot;SELECT post_id FROM $wpdb-&gt;postmeta WHERE meta_key = '_wp_attached_file' AND meta_value = %s&quot;, &nbsp;</div></li><li><div>      $path&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $post_id = $wpdb-&gt;get_var( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters an attachment id found by URL.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null $post_id The post_id (if any) found by the function.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string   $url     The URL being looked up.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return (int) apply_filters( 'attachment_url_to_postid', $post_id, $url );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns the URLs for CSS files used in an iframe-sandbox'd TinyMCE media view.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The relevant CSS file URLs.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpview_media_sandbox_styles() {&nbsp;</div></li><li><div>   $version = 'ver=' . get_bloginfo( 'version' );&nbsp;</div></li><li><div>   $mediaelement = includes_url( &quot;js/mediaelement/mediaelementplayer.min.css?$version&quot; );&nbsp;</div></li><li><div>   $wpmediaelement = includes_url( &quot;js/mediaelement/wp-mediaelement.css?$version&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return array( $mediaelement, $wpmediaelement );&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>