<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-version="4.7" data-type="class" data-id="1574"><head xmlns="http://www.w3.org/1999/xhtml"><title> getid3 | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="getID3, class, wordpress, 4.7" /><meta name="description" content="The WordPress Core getID3 class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.11"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ea0b4449795c5da30974c07af8de8826' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.11' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/get_id3/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fget_id3%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fget_id3%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-class-get_id3","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="get_id3" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">get_id3</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>getID3</strong></h1><p>The WordPress Core <strong>getID3</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7/files/wp-includes-id3-getid3/" class="file">/wp-includes/ID3/getid3.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="51" class="block" start="72"><li><div>class getID3&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    // public: Settings&nbsp;</div></li><li><div>    public $encoding = 'UTF-8';        // CASE SENSITIVE! - i.e. (must be supported by iconv()). Examples:  ISO-8859-1  UTF-8  UTF-16  UTF-16BE&nbsp;</div></li><li><div>    public $encoding_id3v1 = 'ISO-8859-1';   // Should always be 'ISO-8859-1', but some tags may be written in other encodings such as 'EUC-CN' or 'CP1252'&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: Optional tag checks - disable for speed.&nbsp;</div></li><li><div>    public $option_tag_id3v1 = true;  // Read and process ID3v1 tags&nbsp;</div></li><li><div>    public $option_tag_id3v2 = true;  // Read and process ID3v2 tags&nbsp;</div></li><li><div>    public $option_tag_lyrics3 = true;  // Read and process Lyrics3 tags&nbsp;</div></li><li><div>    public $option_tag_apetag = true;  // Read and process APE tags&nbsp;</div></li><li><div>    public $option_tags_process = true;  // Copy tags to root key 'tags' and encode to $this-&gt;encoding&nbsp;</div></li><li><div>    public $option_tags_html = true;  // Copy tags to root key 'tags_html' properly translated from various encodings to HTML entities&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: Optional tag/comment calucations&nbsp;</div></li><li><div>    public $option_extra_info = true;  // Calculate additional info such as bitrate, channelmode etc&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: Optional handling of embedded attachments (e.g. images)&nbsp;</div></li><li><div>    public $option_save_attachments = true; // defaults to true (ATTACHMENTS_INLINE) for backward compatibility&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: Optional calculations&nbsp;</div></li><li><div>    public $option_md5_data = false; // Get MD5 sum of data part - slow&nbsp;</div></li><li><div>    public $option_md5_data_source = false; // Use MD5 of source file if availble - only FLAC and OptimFROG&nbsp;</div></li><li><div>    public $option_sha1_data = false; // Get SHA1 sum of data part - slow&nbsp;</div></li><li><div>    public $option_max_2gb_check = null;  // Check whether file is larger than 2GB and thus not supported by 32-bit PHP (null: auto-detect based on PHP_INT_MAX)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: Read buffer size in bytes&nbsp;</div></li><li><div>    public $option_fread_buffer_size = 32768;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Public variables&nbsp;</div></li><li><div>    public $filename;                         // Filename of file being analysed.&nbsp;</div></li><li><div>    public $fp;                               // Filepointer to file being analysed.&nbsp;</div></li><li><div>    public $info;                             // Result array.&nbsp;</div></li><li><div>    public $tempdir = GETID3_TEMP_DIR;&nbsp;</div></li><li><div>    public $memory_limit = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Protected variables&nbsp;</div></li><li><div>    protected $startup_error = '';&nbsp;</div></li><li><div>    protected $startup_warning = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    const VERSION = '1.9.9-20141121';&nbsp;</div></li><li><div>    const FREAD_BUFFER_SIZE = 32768;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    const ATTACHMENTS_NONE = false;&nbsp;</div></li><li><div>    const ATTACHMENTS_INLINE = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: constructor&nbsp;</div></li><li><div>    public function __construct() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check memory&nbsp;</div></li><li><div>        $this-&gt;memory_limit = ini_get('memory_limit');&nbsp;</div></li><li><div>        if (preg_match('#([0-9]+)M#i', $this-&gt;memory_limit, $matches)) {&nbsp;</div></li><li><div>            // could be stored as &quot;16M&quot; rather than 16777216 for example&nbsp;</div></li><li><div>            $this-&gt;memory_limit = $matches[1] * 1048576;&nbsp;</div></li><li><div>        } elseif (preg_match('#([0-9]+)G#i', $this-&gt;memory_limit, $matches)) { // The 'G' modifier is available since PHP 5.1.0&nbsp;</div></li><li><div>            // could be stored as &quot;2G&quot; rather than 2147483648 for example&nbsp;</div></li><li><div>            $this-&gt;memory_limit = $matches[1] * 1073741824;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($this-&gt;memory_limit &lt;= 0) {&nbsp;</div></li><li><div>            // memory limits probably disabled&nbsp;</div></li><li><div>        } elseif ($this-&gt;memory_limit &lt;= 4194304) {&nbsp;</div></li><li><div>            $this-&gt;startup_error .= 'PHP has less than 4MB available memory and will very likely run out. Increase memory_limit in php.ini';&nbsp;</div></li><li><div>        } elseif ($this-&gt;memory_limit &lt;= 12582912) {&nbsp;</div></li><li><div>            $this-&gt;startup_warning .= 'PHP has less than 12MB available memory and might run out if all modules are loaded. Increase memory_limit in php.ini';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check safe_mode off&nbsp;</div></li><li><div>        if (preg_match('#(1|ON)#i', ini_get('safe_mode'))) {&nbsp;</div></li><li><div>            $this-&gt;warning('WARNING: Safe mode is on, shorten support disabled, md5data/sha1data for ogg vorbis disabled, ogg vorbos/flac tag writing disabled.');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (intval(ini_get('mbstring.func_overload')) &gt; 0) {&nbsp;</div></li><li><div>            $this-&gt;warning('WARNING: php.ini contains &quot;mbstring.func_overload = '.ini_get('mbstring.func_overload').'&quot;, this may break things.');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for magic_quotes_runtime&nbsp;</div></li><li><div>        if (function_exists('get_magic_quotes_runtime')) {&nbsp;</div></li><li><div>            if (get_magic_quotes_runtime()) {&nbsp;</div></li><li><div>                return $this-&gt;startup_error('magic_quotes_runtime must be disabled before running getID3(). Surround getid3 block by set_magic_quotes_runtime(0) and set_magic_quotes_runtime(1).');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for magic_quotes_gpc&nbsp;</div></li><li><div>        if (function_exists('magic_quotes_gpc')) {&nbsp;</div></li><li><div>            if (get_magic_quotes_gpc()) {&nbsp;</div></li><li><div>                return $this-&gt;startup_error('magic_quotes_gpc must be disabled before running getID3(). Surround getid3 block by set_magic_quotes_gpc(0) and set_magic_quotes_gpc(1).');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load support library&nbsp;</div></li><li><div>        if (!include_once(GETID3_INCLUDEPATH.'getid3.lib.php')) {&nbsp;</div></li><li><div>            $this-&gt;startup_error .= 'getid3.lib.php is missing or corrupt';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;option_max_2gb_check === null) {&nbsp;</div></li><li><div>            $this-&gt;option_max_2gb_check = (PHP_INT_MAX &lt;= 2147483647);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Needed for Windows only:&nbsp;</div></li><li><div>        // Define locations of helper applications for Shorten, VorbisComment, MetaFLAC&nbsp;</div></li><li><div>        //   as well as other helper functions such as head, tail, md5sum, etc&nbsp;</div></li><li><div>        // This path cannot contain spaces, but the below code will attempt to get the&nbsp;</div></li><li><div>        //   8.3-equivalent path automatically&nbsp;</div></li><li><div>        // IMPORTANT: This path must include the trailing slash&nbsp;</div></li><li><div>        if (GETID3_OS_ISWINDOWS && !defined('GETID3_HELPERAPPSDIR')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $helperappsdir = GETID3_INCLUDEPATH.'..'.DIRECTORY_SEPARATOR.'helperapps'; // must not have any space in this path&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!is_dir($helperappsdir)) {&nbsp;</div></li><li><div>                $this-&gt;startup_warning .= '&quot;'.$helperappsdir.'&quot; cannot be defined as GETID3_HELPERAPPSDIR because it does not exist';&nbsp;</div></li><li><div>            } elseif (strpos(realpath($helperappsdir), ' ') !== false) {&nbsp;</div></li><li><div>                $DirPieces = explode(DIRECTORY_SEPARATOR, realpath($helperappsdir));&nbsp;</div></li><li><div>                $path_so_far = array();&nbsp;</div></li><li><div>                foreach ($DirPieces as $key =&gt; $value) {&nbsp;</div></li><li><div>                    if (strpos($value, ' ') !== false) {&nbsp;</div></li><li><div>                        if (!empty($path_so_far)) {&nbsp;</div></li><li><div>                            $commandline = 'dir /x '.escapeshellarg(implode(DIRECTORY_SEPARATOR, $path_so_far));&nbsp;</div></li><li><div>                            $dir_listing = `$commandline`;&nbsp;</div></li><li><div>                            $lines = explode(&quot;\n&quot;, $dir_listing);&nbsp;</div></li><li><div>                            foreach ($lines as $line) {&nbsp;</div></li><li><div>                                $line = trim($line);&nbsp;</div></li><li><div>                                if (preg_match('#^([0-9/]{10}) +([0-9:]{4, 5}( [AP]M)?) +(&lt;DIR&gt;|[0-9, ]+) +([^ ]{0, 11}) +(.+)$#', $line, $matches)) {&nbsp;</div></li><li><div>                                    list($dummy, $date, $time, $ampm, $filesize, $shortname, $filename) = $matches;&nbsp;</div></li><li><div>                                    if ((strtoupper($filesize) == '&lt;DIR&gt;') && (strtolower($filename) == strtolower($value))) {&nbsp;</div></li><li><div>                                        $value = $shortname;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $this-&gt;startup_warning .= 'GETID3_HELPERAPPSDIR must not have any spaces in it - use 8dot3 naming convention if neccesary. You can run &quot;dir /x&quot; from the commandline to see the correct 8.3-style names.';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $path_so_far[] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $helperappsdir = implode(DIRECTORY_SEPARATOR, $path_so_far);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            define('GETID3_HELPERAPPSDIR', $helperappsdir.DIRECTORY_SEPARATOR);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function version() {&nbsp;</div></li><li><div>        return self::VERSION;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function fread_buffer_size() {&nbsp;</div></li><li><div>        return $this-&gt;option_fread_buffer_size;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: setOption&nbsp;</div></li><li><div>    public function setOption($optArray) {&nbsp;</div></li><li><div>        if (!is_array($optArray) || empty($optArray)) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ($optArray as $opt =&gt; $val) {&nbsp;</div></li><li><div>            if (isset($this-&gt;$opt) === false) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;$opt = $val;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function openfile($filename) {&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            if (!empty($this-&gt;startup_error)) {&nbsp;</div></li><li><div>                throw new getid3_exception($this-&gt;startup_error);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!empty($this-&gt;startup_warning)) {&nbsp;</div></li><li><div>                $this-&gt;warning($this-&gt;startup_warning);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // init result array and set parameters&nbsp;</div></li><li><div>            $this-&gt;filename = $filename;&nbsp;</div></li><li><div>            $this-&gt;info = array();&nbsp;</div></li><li><div>            $this-&gt;info['GETID3_VERSION'] = $this-&gt;version();&nbsp;</div></li><li><div>            $this-&gt;info['php_memory_limit'] = (($this-&gt;memory_limit &gt; 0) ? $this-&gt;memory_limit : false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // remote files not supported&nbsp;</div></li><li><div>            if (preg_match('/^(ht|f)tp:\/\//', $filename)) {&nbsp;</div></li><li><div>                throw new getid3_exception('Remote files are not supported - please copy the file locally first');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $filename = str_replace('/', DIRECTORY_SEPARATOR, $filename);&nbsp;</div></li><li><div>            $filename = preg_replace('#(.+)'.preg_quote(DIRECTORY_SEPARATOR).'{2, }#U', '\1'.DIRECTORY_SEPARATOR, $filename);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // open local file&nbsp;</div></li><li><div>            //if (is_readable($filename) && is_file($filename) && ($this-&gt;fp = fopen($filename, 'rb'))) { // see http://www.getid3.org/phpBB3/viewtopic.php?t=1720&nbsp;</div></li><li><div>            if ((is_readable($filename) || file_exists($filename)) && is_file($filename) && ($this-&gt;fp = fopen($filename, 'rb'))) {&nbsp;</div></li><li><div>                // great&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $errormessagelist = array();&nbsp;</div></li><li><div>                if (!is_readable($filename)) {&nbsp;</div></li><li><div>                    $errormessagelist[] = '!is_readable';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!is_file($filename)) {&nbsp;</div></li><li><div>                    $errormessagelist[] = '!is_file';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!file_exists($filename)) {&nbsp;</div></li><li><div>                    $errormessagelist[] = '!file_exists';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (empty($errormessagelist)) {&nbsp;</div></li><li><div>                    $errormessagelist[] = 'fopen failed';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                throw new getid3_exception('Could not open &quot;'.$filename.'&quot; ('.implode('; ', $errormessagelist).')');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;info['filesize'] = filesize($filename);&nbsp;</div></li><li><div>            // set redundant parameters - might be needed in some include file&nbsp;</div></li><li><div>            // filenames / filepaths in getID3 are always expressed with forward slashes (unix-style) for both Windows and other to try and minimize confusion&nbsp;</div></li><li><div>            $filename = str_replace('\\', '/', $filename);&nbsp;</div></li><li><div>            $this-&gt;info['filepath'] = str_replace('\\', '/', realpath(dirname($filename)));&nbsp;</div></li><li><div>            $this-&gt;info['filename'] = getid3_lib::mb_basename($filename);&nbsp;</div></li><li><div>            $this-&gt;info['filenamepath'] = $this-&gt;info['filepath'].'/'.$this-&gt;info['filename'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // option_max_2gb_check&nbsp;</div></li><li><div>            if ($this-&gt;option_max_2gb_check) {&nbsp;</div></li><li><div>                // PHP (32-bit all, and 64-bit Windows) doesn't support integers larger than 2^31 (~2GB)&nbsp;</div></li><li><div>                // filesize() simply returns (filesize % (pow(2, 32)), no matter the actual filesize&nbsp;</div></li><li><div>                // ftell() returns 0 if seeking to the end is beyond the range of unsigned integer&nbsp;</div></li><li><div>                $fseek = fseek($this-&gt;fp, 0, SEEK_END);&nbsp;</div></li><li><div>                if (($fseek &lt; 0) || (($this-&gt;info['filesize'] != 0) && (ftell($this-&gt;fp) == 0)) ||&nbsp;</div></li><li><div>                    ($this-&gt;info['filesize'] &lt; 0) ||&nbsp;</div></li><li><div>                    (ftell($this-&gt;fp) &lt; 0)) {&nbsp;</div></li><li><div>                        $real_filesize = getid3_lib::getFileSizeSyscall($this-&gt;info['filenamepath']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($real_filesize === false) {&nbsp;</div></li><li><div>                            unset($this-&gt;info['filesize']);&nbsp;</div></li><li><div>                            fclose($this-&gt;fp);&nbsp;</div></li><li><div>                            throw new getid3_exception('Unable to determine actual filesize. File is most likely larger than '.round(PHP_INT_MAX / 1073741824).'GB and is not supported by PHP.');&nbsp;</div></li><li><div>                        } elseif (getid3_lib::intValueSupported($real_filesize)) {&nbsp;</div></li><li><div>                            unset($this-&gt;info['filesize']);&nbsp;</div></li><li><div>                            fclose($this-&gt;fp);&nbsp;</div></li><li><div>                            throw new getid3_exception('PHP seems to think the file is larger than '.round(PHP_INT_MAX / 1073741824).'GB, but filesystem reports it as '.number_format($real_filesize, 3).'GB, please report to info@getid3.org');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $this-&gt;info['filesize'] = $real_filesize;&nbsp;</div></li><li><div>                        $this-&gt;warning('File is larger than '.round(PHP_INT_MAX / 1073741824).'GB (filesystem reports it as '.number_format($real_filesize, 3).'GB) and is not properly supported by PHP.');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // set more parameters&nbsp;</div></li><li><div>            $this-&gt;info['avdataoffset'] = 0;&nbsp;</div></li><li><div>            $this-&gt;info['avdataend'] = $this-&gt;info['filesize'];&nbsp;</div></li><li><div>            $this-&gt;info['fileformat'] = '';                // filled in later&nbsp;</div></li><li><div>            $this-&gt;info['audio']['dataformat'] = '';                // filled in later, unset if not used&nbsp;</div></li><li><div>            $this-&gt;info['video']['dataformat'] = '';                // filled in later, unset if not used&nbsp;</div></li><li><div>            $this-&gt;info['tags'] = array();           // filled in later, unset if not used&nbsp;</div></li><li><div>            $this-&gt;info['error'] = array();           // filled in later, unset if not used&nbsp;</div></li><li><div>            $this-&gt;info['warning'] = array();           // filled in later, unset if not used&nbsp;</div></li><li><div>            $this-&gt;info['comments'] = array();           // filled in later, unset if not used&nbsp;</div></li><li><div>            $this-&gt;info['encoding'] = $this-&gt;encoding;   // required by id3v2 and iso modules - can be unset at the end if desired&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } catch (Exception $e) {&nbsp;</div></li><li><div>            $this-&gt;error($e-&gt;getMessage());&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // public: analyze file&nbsp;</div></li><li><div>    public function analyze($filename) {&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            if (!$this-&gt;openfile($filename)) {&nbsp;</div></li><li><div>                return $this-&gt;info;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Handle tags&nbsp;</div></li><li><div>            foreach (array('id3v2'=&gt;'id3v2', 'id3v1'=&gt;'id3v1', 'apetag'=&gt;'ape', 'lyrics3'=&gt;'lyrics3') as $tag_name =&gt; $tag_key) {&nbsp;</div></li><li><div>                $option_tag = 'option_tag_'.$tag_name;&nbsp;</div></li><li><div>                if ($this-&gt;$option_tag) {&nbsp;</div></li><li><div>                    $this-&gt;include_module('tag.'.$tag_name);&nbsp;</div></li><li><div>                    try {&nbsp;</div></li><li><div>                        $tag_class = 'getid3_'.$tag_name;&nbsp;</div></li><li><div>                        $tag = new $tag_class($this);&nbsp;</div></li><li><div>                        $tag-&gt;Analyze();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    catch (getid3_exception $e) {&nbsp;</div></li><li><div>                        throw $e;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($this-&gt;info['id3v2']['tag_offset_start'])) {&nbsp;</div></li><li><div>                $this-&gt;info['avdataoffset'] = max($this-&gt;info['avdataoffset'], $this-&gt;info['id3v2']['tag_offset_end']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            foreach (array('id3v1'=&gt;'id3v1', 'apetag'=&gt;'ape', 'lyrics3'=&gt;'lyrics3') as $tag_name =&gt; $tag_key) {&nbsp;</div></li><li><div>                if (isset($this-&gt;info[$tag_key]['tag_offset_start'])) {&nbsp;</div></li><li><div>                    $this-&gt;info['avdataend'] = min($this-&gt;info['avdataend'], $this-&gt;info[$tag_key]['tag_offset_start']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // ID3v2 detection (NOT parsing), even if ($this-&gt;option_tag_id3v2 == false) done to make fileformat easier&nbsp;</div></li><li><div>            if (!$this-&gt;option_tag_id3v2) {&nbsp;</div></li><li><div>                fseek($this-&gt;fp, 0);&nbsp;</div></li><li><div>                $header = fread($this-&gt;fp, 10);&nbsp;</div></li><li><div>                if ((substr($header, 0, 3) == 'ID3') && (strlen($header) == 10)) {&nbsp;</div></li><li><div>                    $this-&gt;info['id3v2']['header'] = true;&nbsp;</div></li><li><div>                    $this-&gt;info['id3v2']['majorversion'] = ord($header{3});&nbsp;</div></li><li><div>                    $this-&gt;info['id3v2']['minorversion'] = ord($header{4});&nbsp;</div></li><li><div>                    $this-&gt;info['avdataoffset']          += getid3_lib::BigEndian2Int(substr($header, 6, 4), 1) + 10; // length of ID3v2 tag in 10-byte header doesn't include 10-byte header length&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // read 32 kb file data&nbsp;</div></li><li><div>            fseek($this-&gt;fp, $this-&gt;info['avdataoffset']);&nbsp;</div></li><li><div>            $formattest = fread($this-&gt;fp, 32774);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // determine format&nbsp;</div></li><li><div>            $determined_format = $this-&gt;GetFileFormat($formattest, $filename);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // unable to determine file format&nbsp;</div></li><li><div>            if (!$determined_format) {&nbsp;</div></li><li><div>                fclose($this-&gt;fp);&nbsp;</div></li><li><div>                return $this-&gt;error('unable to determine file format');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // check for illegal ID3 tags&nbsp;</div></li><li><div>            if (isset($determined_format['fail_id3']) && (in_array('id3v1', $this-&gt;info['tags']) || in_array('id3v2', $this-&gt;info['tags']))) {&nbsp;</div></li><li><div>                if ($determined_format['fail_id3'] === 'ERROR') {&nbsp;</div></li><li><div>                    fclose($this-&gt;fp);&nbsp;</div></li><li><div>                    return $this-&gt;error('ID3 tags not allowed on this file type.');&nbsp;</div></li><li><div>                } elseif ($determined_format['fail_id3'] === 'WARNING') {&nbsp;</div></li><li><div>                    $this-&gt;warning('ID3 tags not allowed on this file type.');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // check for illegal APE tags&nbsp;</div></li><li><div>            if (isset($determined_format['fail_ape']) && in_array('ape', $this-&gt;info['tags'])) {&nbsp;</div></li><li><div>                if ($determined_format['fail_ape'] === 'ERROR') {&nbsp;</div></li><li><div>                    fclose($this-&gt;fp);&nbsp;</div></li><li><div>                    return $this-&gt;error('APE tags not allowed on this file type.');&nbsp;</div></li><li><div>                } elseif ($determined_format['fail_ape'] === 'WARNING') {&nbsp;</div></li><li><div>                    $this-&gt;warning('APE tags not allowed on this file type.');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // set mime type&nbsp;</div></li><li><div>            $this-&gt;info['mime_type'] = $determined_format['mime_type'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // supported format signature pattern detected, but module deleted&nbsp;</div></li><li><div>            if (!file_exists(GETID3_INCLUDEPATH.$determined_format['include'])) {&nbsp;</div></li><li><div>                fclose($this-&gt;fp);&nbsp;</div></li><li><div>                return $this-&gt;error('Format not supported, module &quot;'.$determined_format['include'].'&quot; was removed.');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // module requires iconv support&nbsp;</div></li><li><div>            // Check encoding/iconv support&nbsp;</div></li><li><div>            if (!empty($determined_format['iconv_req']) && !function_exists('iconv') && !in_array($this-&gt;encoding, array('ISO-8859-1', 'UTF-8', 'UTF-16LE', 'UTF-16BE', 'UTF-16'))) {&nbsp;</div></li><li><div>                $errormessage = 'iconv() support is required for this module ('.$determined_format['include'].') for encodings other than ISO-8859-1, UTF-8, UTF-16LE, UTF16-BE, UTF-16. ';&nbsp;</div></li><li><div>                if (GETID3_OS_ISWINDOWS) {&nbsp;</div></li><li><div>                    $errormessage .= 'PHP does not have iconv() support. Please enable php_iconv.dll in php.ini, and copy iconv.dll from c:/php/dlls to c:/windows/system32';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $errormessage .= 'PHP is not compiled with iconv() support. Please recompile with the --with-iconv switch';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return $this-&gt;error($errormessage);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // include module&nbsp;</div></li><li><div>            include_once(GETID3_INCLUDEPATH.$determined_format['include']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // instantiate module class&nbsp;</div></li><li><div>            $class_name = 'getid3_'.$determined_format['module'];&nbsp;</div></li><li><div>            if (!class_exists($class_name)) {&nbsp;</div></li><li><div>                return $this-&gt;error('Format not supported, module &quot;'.$determined_format['include'].'&quot; is corrupt.');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $class = new $class_name($this);&nbsp;</div></li><li><div>            $class-&gt;Analyze();&nbsp;</div></li><li><div>            unset($class);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // close file&nbsp;</div></li><li><div>            fclose($this-&gt;fp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // process all tags - copy to 'tags' and convert charsets&nbsp;</div></li><li><div>            if ($this-&gt;option_tags_process) {&nbsp;</div></li><li><div>                $this-&gt;HandleAllTags();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // perform more calculations&nbsp;</div></li><li><div>            if ($this-&gt;option_extra_info) {&nbsp;</div></li><li><div>                $this-&gt;ChannelsBitratePlaytimeCalculations();&nbsp;</div></li><li><div>                $this-&gt;CalculateCompressionRatioVideo();&nbsp;</div></li><li><div>                $this-&gt;CalculateCompressionRatioAudio();&nbsp;</div></li><li><div>                $this-&gt;CalculateReplayGain();&nbsp;</div></li><li><div>                $this-&gt;ProcessAudioStreams();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // get the MD5 sum of the audio/video portion of the file - without ID3/APE/Lyrics3/etc header/footer tags&nbsp;</div></li><li><div>            if ($this-&gt;option_md5_data) {&nbsp;</div></li><li><div>                // do not calc md5_data if md5_data_source is present - set by flac only - future MPC/SV8 too&nbsp;</div></li><li><div>                if (!$this-&gt;option_md5_data_source || empty($this-&gt;info['md5_data_source'])) {&nbsp;</div></li><li><div>                    $this-&gt;getHashdata('md5');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // get the SHA1 sum of the audio/video portion of the file - without ID3/APE/Lyrics3/etc header/footer tags&nbsp;</div></li><li><div>            if ($this-&gt;option_sha1_data) {&nbsp;</div></li><li><div>                $this-&gt;getHashdata('sha1');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // remove undesired keys&nbsp;</div></li><li><div>            $this-&gt;CleanUp();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } catch (Exception $e) {&nbsp;</div></li><li><div>            $this-&gt;error('Caught exception: '.$e-&gt;getMessage());&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // return info array&nbsp;</div></li><li><div>        return $this-&gt;info;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // private: error handling&nbsp;</div></li><li><div>    public function error($message) {&nbsp;</div></li><li><div>        $this-&gt;CleanUp();&nbsp;</div></li><li><div>        if (!isset($this-&gt;info['error'])) {&nbsp;</div></li><li><div>            $this-&gt;info['error'] = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;info['error'][] = $message;&nbsp;</div></li><li><div>        return $this-&gt;info;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // private: warning handling&nbsp;</div></li><li><div>    public function warning($message) {&nbsp;</div></li><li><div>        $this-&gt;info['warning'][] = $message;&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // private: CleanUp&nbsp;</div></li><li><div>    private function CleanUp() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove possible empty keys&nbsp;</div></li><li><div>        $AVpossibleEmptyKeys = array('dataformat', 'bits_per_sample', 'encoder_options', 'streams', 'bitrate');&nbsp;</div></li><li><div>        foreach ($AVpossibleEmptyKeys as $dummy =&gt; $key) {&nbsp;</div></li><li><div>            if (empty($this-&gt;info['audio'][$key]) && isset($this-&gt;info['audio'][$key])) {&nbsp;</div></li><li><div>                unset($this-&gt;info['audio'][$key]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (empty($this-&gt;info['video'][$key]) && isset($this-&gt;info['video'][$key])) {&nbsp;</div></li><li><div>                unset($this-&gt;info['video'][$key]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove empty root keys&nbsp;</div></li><li><div>        if (!empty($this-&gt;info)) {&nbsp;</div></li><li><div>            foreach ($this-&gt;info as $key =&gt; $value) {&nbsp;</div></li><li><div>                if (empty($this-&gt;info[$key]) && ($this-&gt;info[$key] !== 0) && ($this-&gt;info[$key] !== '0')) {&nbsp;</div></li><li><div>                    unset($this-&gt;info[$key]);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove meaningless entries from unknown-format files&nbsp;</div></li><li><div>        if (empty($this-&gt;info['fileformat'])) {&nbsp;</div></li><li><div>            if (isset($this-&gt;info['avdataoffset'])) {&nbsp;</div></li><li><div>                unset($this-&gt;info['avdataoffset']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($this-&gt;info['avdataend'])) {&nbsp;</div></li><li><div>                unset($this-&gt;info['avdataend']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove possible duplicated identical entries&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['error'])) {&nbsp;</div></li><li><div>            $this-&gt;info['error'] = array_values(array_unique($this-&gt;info['error']));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['warning'])) {&nbsp;</div></li><li><div>            $this-&gt;info['warning'] = array_values(array_unique($this-&gt;info['warning']));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove &quot;global variable&quot; type keys&nbsp;</div></li><li><div>        unset($this-&gt;info['php_memory_limit']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // return array containing information about all supported formats&nbsp;</div></li><li><div>    public function GetFileFormatArray() {&nbsp;</div></li><li><div>        static $format_info = array();&nbsp;</div></li><li><div>        if (empty($format_info)) {&nbsp;</div></li><li><div>            $format_info = array(&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Audio formats&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // AC-3   - audio      - Dolby AC-3 / Dolby Digital&nbsp;</div></li><li><div>                'ac3' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x0B\x77', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'ac3', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/ac3', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // AAC  - audio       - Advanced Audio Coding (AAC) - ADIF format&nbsp;</div></li><li><div>                'adif' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^ADIF', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'aac', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'WARNING', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div>                // AA   - audio       - Audible Audiobook&nbsp;</div></li><li><div>                'aa' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^.{4}\x57\x90\x75\x36', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'aa', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/audible', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>*/&nbsp;</div></li><li><div>                // AAC  - audio       - Advanced Audio Coding (AAC) - ADTS format (very similar to MP3)&nbsp;</div></li><li><div>                'adts' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\xFF[\xF0-\xF1\xF8-\xF9]', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'aac', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'WARNING', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // AU   - audio       - NeXT/Sun AUdio (AU)&nbsp;</div></li><li><div>                'au' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\.snd', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'au', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/basic', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // AMR  - audio       - Adaptive Multi Rate&nbsp;</div></li><li><div>                'amr' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x23\x21AMR\x0A', // #!AMR[0A]&nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'amr', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/amr', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // AVR  - audio       - Audio Visual Research&nbsp;</div></li><li><div>                'avr' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^2BIT', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'avr', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // BONK - audio       - Bonk v0.9+&nbsp;</div></li><li><div>                'bonk' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x00(BONK|INFO|META| ID3)', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'bonk', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/xmms-bonk', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // DSS  - audio       - Digital Speech Standard&nbsp;</div></li><li><div>                'dss' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^[\x02-\x03]ds[s2]', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'dss', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // DTS  - audio       - Dolby Theatre System&nbsp;</div></li><li><div>                'dts' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x7F\xFE\x80\x01', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'dts', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/dts', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // FLAC - audio       - Free Lossless Audio Codec&nbsp;</div></li><li><div>                'flac' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^fLaC', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'flac', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/x-flac', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // LA   - audio       - Lossless Audio (LA)&nbsp;</div></li><li><div>                'la' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^LA0[2-4]', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'la', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // LPAC - audio       - Lossless Predictive Audio Compression (LPAC)&nbsp;</div></li><li><div>                'lpac' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^LPAC', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'lpac', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MIDI - audio       - MIDI (Musical Instrument Digital Interface)&nbsp;</div></li><li><div>                'midi' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^MThd', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'midi', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/midi', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MAC  - audio       - Monkey's Audio Compressor&nbsp;</div></li><li><div>                'mac' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^MAC ', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'monkey', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>// has been known to produce false matches in random files (e.g. JPEGs), leave out until more precise matching available&nbsp;</div></li><li><div>//                // MOD  - audio       - MODule (assorted sub-formats)&nbsp;</div></li><li><div>//                'mod' =&gt; array(&nbsp;</div></li><li><div>//                            'pattern' =&gt; '^.{1080}(M\\.K\\.|M!K!|FLT4|FLT8|[5-9]CHN|[1-3][0-9]CH)', &nbsp;</div></li><li><div>//                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>//                            'module' =&gt; 'mod', &nbsp;</div></li><li><div>//                            'option' =&gt; 'mod', &nbsp;</div></li><li><div>//                            'mime_type' =&gt; 'audio/mod', &nbsp;</div></li><li><div>// ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MOD  - audio       - MODule (Impulse Tracker)&nbsp;</div></li><li><div>                'it' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^IMPM', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'mod', &nbsp;</div></li><li><div>                            //'option' =&gt; 'it', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/it', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MOD  - audio       - MODule (eXtended Module, various sub-formats)&nbsp;</div></li><li><div>                'xm' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^Extended Module', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'mod', &nbsp;</div></li><li><div>                            //'option' =&gt; 'xm', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/xm', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MOD  - audio       - MODule (ScreamTracker)&nbsp;</div></li><li><div>                's3m' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^.{44}SCRM', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'mod', &nbsp;</div></li><li><div>                            //'option' =&gt; 's3m', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/s3m', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MPC  - audio       - Musepack / MPEGplus&nbsp;</div></li><li><div>                'mpc' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(MPCK|MP\+|[\x00\x01\x10\x11\x40\x41\x50\x51\x80\x81\x90\x91\xC0\xC1\xD0\xD1][\x20-37][\x00\x20\x40\x60\x80\xA0\xC0\xE0])', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'mpc', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/x-musepack', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MP3  - audio       - MPEG-audio Layer 3 (very similar to AAC-ADTS)&nbsp;</div></li><li><div>                'mp3' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\xFF[\xE2-\xE7\xF2-\xF7\xFA-\xFF][\x00-\x0B\x10-\x1B\x20-\x2B\x30-\x3B\x40-\x4B\x50-\x5B\x60-\x6B\x70-\x7B\x80-\x8B\x90-\x9B\xA0-\xAB\xB0-\xBB\xC0-\xCB\xD0-\xDB\xE0-\xEB\xF0-\xFB]', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'mp3', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/mpeg', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // OFR  - audio       - OptimFROG&nbsp;</div></li><li><div>                'ofr' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(\*RIFF|OFR)', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'optimfrog', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // RKAU - audio       - RKive AUdio compressor&nbsp;</div></li><li><div>                'rkau' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^RKA', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'rkau', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // SHN  - audio       - Shorten&nbsp;</div></li><li><div>                'shn' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^ajkg', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'shorten', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/xmms-shn', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // TTA  - audio       - TTA Lossless Audio Compressor (http://tta.corecodec.org)&nbsp;</div></li><li><div>                'tta' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^TTA', // could also be '^TTA(\x01|\x02|\x03|2|1)'&nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'tta', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // VOC  - audio       - Creative Voice (VOC)&nbsp;</div></li><li><div>                'voc' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^Creative Voice File', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'voc', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/voc', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // VQF  - audio       - transform-domain weighted interleave Vector Quantization Format (VQF)&nbsp;</div></li><li><div>                'vqf' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^TWIN', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'vqf', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // WV  - audio        - WavPack (v4.0+)&nbsp;</div></li><li><div>                'wv' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^wvpk', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'wavpack', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Audio-Video formats&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // ASF  - audio/video - Advanced Streaming Format, Windows Media Video, Windows Media Audio&nbsp;</div></li><li><div>                'asf' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x30\x26\xB2\x75\x8E\x66\xCF\x11\xA6\xD9\x00\xAA\x00\x62\xCE\x6C', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'asf', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'video/x-ms-asf', &nbsp;</div></li><li><div>                            'iconv_req' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // BINK - audio/video - Bink / Smacker&nbsp;</div></li><li><div>                'bink' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(BIK|SMK)', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'bink', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // FLV  - audio/video - FLash Video&nbsp;</div></li><li><div>                'flv' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^FLV\x01', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'flv', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'video/x-flv', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MKAV - audio/video - Mastroka&nbsp;</div></li><li><div>                'matroska' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x1A\x45\xDF\xA3', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'matroska', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'video/x-matroska', // may also be audio/x-matroska&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MPEG - audio/video - MPEG (Moving Pictures Experts Group)&nbsp;</div></li><li><div>                'mpeg' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x00\x00\x01(\xBA|\xB3)', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'mpeg', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'video/mpeg', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // NSV  - audio/video - Nullsoft Streaming Video (NSV)&nbsp;</div></li><li><div>                'nsv' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^NSV[sf]', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'nsv', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Ogg  - audio/video - Ogg (Ogg-Vorbis, Ogg-FLAC, Speex, Ogg-Theora(*), Ogg-Tarkin(*))&nbsp;</div></li><li><div>                'ogg' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^OggS', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio', &nbsp;</div></li><li><div>                            'module' =&gt; 'ogg', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/ogg', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'WARNING', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'WARNING', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // QT   - audio/video - Quicktime&nbsp;</div></li><li><div>                'quicktime' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^.{4}(cmov|free|ftyp|mdat|moov|pnot|skip|wide)', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'quicktime', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'video/quicktime', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // RIFF - audio/video - Resource Interchange File Format (RIFF) / WAV / AVI / CD-audio / SDSS = renamed variant used by SmartSound QuickTracks (www.smartsound.com) / FORM = Audio Interchange File Format (AIFF)&nbsp;</div></li><li><div>                'riff' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(RIFF|SDSS|FORM)', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'riff', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/x-wave', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'WARNING', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Real - audio/video - RealAudio, RealVideo&nbsp;</div></li><li><div>                'real' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(\\.RMF|\\.ra)', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'real', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'audio/x-realaudio', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // SWF - audio/video - ShockWave Flash&nbsp;</div></li><li><div>                'swf' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(F|C)WS', &nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'swf', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/x-shockwave-flash', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // TS - audio/video - MPEG-2 Transport Stream&nbsp;</div></li><li><div>                'ts' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(\x47.{187}) {10, }', // packets are 188 bytes long and start with 0x47 &quot;G&quot;.  Check for at least 10 packets matching this pattern&nbsp;</div></li><li><div>                            'group' =&gt; 'audio-video', &nbsp;</div></li><li><div>                            'module' =&gt; 'ts', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'video/MP2T', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Still-Image formats&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // BMP  - still image - Bitmap (Windows, OS/2; uncompressed, RLE8, RLE4)&nbsp;</div></li><li><div>                'bmp' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^BM', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'bmp', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/bmp', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // GIF  - still image - Graphics Interchange Format&nbsp;</div></li><li><div>                'gif' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^GIF', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'gif', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/gif', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // JPEG - still image - Joint Photographic Experts Group (JPEG)&nbsp;</div></li><li><div>                'jpg' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\xFF\xD8\xFF', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'jpg', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/jpeg', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // PCD  - still image - Kodak Photo CD&nbsp;</div></li><li><div>                'pcd' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^.{2048}PCD_IPI\x00', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'pcd', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/x-photo-cd', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // PNG  - still image - Portable Network Graphics (PNG)&nbsp;</div></li><li><div>                'png' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x89\x50\x4E\x47\x0D\x0A\x1A\x0A', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'png', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/png', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // SVG  - still image - Scalable Vector Graphics (SVG)&nbsp;</div></li><li><div>                'svg' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '(&lt;!DOCTYPE svg PUBLIC |xmlns=&quot;http:\/\/www\.w3\.org\/2000\/svg&quot;)', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'svg', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/svg+xml', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // TIFF - still image - Tagged Information File Format (TIFF)&nbsp;</div></li><li><div>                'tiff' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^(II\x2A\x00|MM\x00\x2A)', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'tiff', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/tiff', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // EFAX - still image - eFax (TIFF derivative)&nbsp;</div></li><li><div>                'efax' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\xDC\xFE', &nbsp;</div></li><li><div>                            'group' =&gt; 'graphic', &nbsp;</div></li><li><div>                            'module' =&gt; 'efax', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'image/efax', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Data formats&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // ISO  - data        - International Standards Organization (ISO) CD-ROM Image&nbsp;</div></li><li><div>                'iso' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^.{32769}CD001', &nbsp;</div></li><li><div>                            'group' =&gt; 'misc', &nbsp;</div></li><li><div>                            'module' =&gt; 'iso', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'iconv_req' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // RAR  - data        - RAR compressed data&nbsp;</div></li><li><div>                'rar' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^Rar\!', &nbsp;</div></li><li><div>                            'group' =&gt; 'archive', &nbsp;</div></li><li><div>                            'module' =&gt; 'rar', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // SZIP - audio/data  - SZIP compressed data&nbsp;</div></li><li><div>                'szip' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^SZ\x0A\x04', &nbsp;</div></li><li><div>                            'group' =&gt; 'archive', &nbsp;</div></li><li><div>                            'module' =&gt; 'szip', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // TAR  - data        - TAR compressed data&nbsp;</div></li><li><div>                'tar' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^.{100}[0-9\x20]{7}\x00[0-9\x20]{7}\x00[0-9\x20]{7}\x00[0-9\x20\x00]{12}[0-9\x20\x00]{12}', &nbsp;</div></li><li><div>                            'group' =&gt; 'archive', &nbsp;</div></li><li><div>                            'module' =&gt; 'tar', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/x-tar', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // GZIP  - data        - GZIP compressed data&nbsp;</div></li><li><div>                'gz' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x1F\x8B\x08', &nbsp;</div></li><li><div>                            'group' =&gt; 'archive', &nbsp;</div></li><li><div>                            'module' =&gt; 'gzip', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/x-gzip', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // ZIP  - data         - ZIP compressed data&nbsp;</div></li><li><div>                'zip' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^PK\x03\x04', &nbsp;</div></li><li><div>                            'group' =&gt; 'archive', &nbsp;</div></li><li><div>                            'module' =&gt; 'zip', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/zip', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Misc other formats&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // PAR2 - data        - Parity Volume Set Specification 2.0&nbsp;</div></li><li><div>                'par2' =&gt; array (&nbsp;</div></li><li><div>                            'pattern' =&gt; '^PAR2\x00PKT', &nbsp;</div></li><li><div>                            'group' =&gt; 'misc', &nbsp;</div></li><li><div>                            'module' =&gt; 'par2', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // PDF  - data        - Portable Document Format&nbsp;</div></li><li><div>                'pdf' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\x25PDF', &nbsp;</div></li><li><div>                            'group' =&gt; 'misc', &nbsp;</div></li><li><div>                            'module' =&gt; 'pdf', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/pdf', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // MSOFFICE  - data   - ZIP compressed data&nbsp;</div></li><li><div>                'msoffice' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '^\xD0\xCF\x11\xE0\xA1\xB1\x1A\xE1', // D0CF11E == DOCFILE == Microsoft Office Document&nbsp;</div></li><li><div>                            'group' =&gt; 'misc', &nbsp;</div></li><li><div>                            'module' =&gt; 'msoffice', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>                            'fail_id3' =&gt; 'ERROR', &nbsp;</div></li><li><div>                            'fail_ape' =&gt; 'ERROR', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                 // CUE  - data       - CUEsheet (index to single-file disc images)&nbsp;</div></li><li><div>                 'cue' =&gt; array(&nbsp;</div></li><li><div>                            'pattern' =&gt; '', // empty pattern means cannot be automatically detected, will fall through all other formats and match based on filename and very basic file contents&nbsp;</div></li><li><div>                            'group' =&gt; 'misc', &nbsp;</div></li><li><div>                            'module' =&gt; 'cue', &nbsp;</div></li><li><div>                            'mime_type' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $format_info;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function GetFileFormat(&$filedata, $filename='') {&nbsp;</div></li><li><div>        // this function will determine the format of a file based on usually&nbsp;</div></li><li><div>        // the first 2-4 bytes of the file (8 bytes for PNG, 16 bytes for JPG, &nbsp;</div></li><li><div>        // and in the case of ISO CD image, 6 bytes offset 32kb from the start&nbsp;</div></li><li><div>        // of the file).&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Identify file format - loop through $format_info and detect with reg expr&nbsp;</div></li><li><div>        foreach ($this-&gt;GetFileFormatArray() as $format_name =&gt; $info) {&nbsp;</div></li><li><div>            // The /s switch on preg_match() forces preg_match() NOT to treat&nbsp;</div></li><li><div>            // newline (0x0A) characters as special chars but do a binary match&nbsp;</div></li><li><div>            if (!empty($info['pattern']) && preg_match('#'.$info['pattern'].'#s', $filedata)) {&nbsp;</div></li><li><div>                $info['include'] = 'module.'.$info['group'].'.'.$info['module'].'.php';&nbsp;</div></li><li><div>                return $info;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (preg_match('#\.mp[123a]$#i', $filename)) {&nbsp;</div></li><li><div>            // Too many mp3 encoders on the market put gabage in front of mpeg files&nbsp;</div></li><li><div>            // use assume format on these if format detection failed&nbsp;</div></li><li><div>            $GetFileFormatArray = $this-&gt;GetFileFormatArray();&nbsp;</div></li><li><div>            $info = $GetFileFormatArray['mp3'];&nbsp;</div></li><li><div>            $info['include'] = 'module.'.$info['group'].'.'.$info['module'].'.php';&nbsp;</div></li><li><div>            return $info;&nbsp;</div></li><li><div>        } elseif (preg_match('/\.cue$/i', $filename) && preg_match('#FILE &quot;[^&quot;]+&quot; (BINARY|MOTOROLA|AIFF|WAVE|MP3)#', $filedata)) {&nbsp;</div></li><li><div>            // there's not really a useful consistent &quot;magic&quot; at the beginning of .cue files to identify them&nbsp;</div></li><li><div>            // so until I think of something better, just go by filename if all other format checks fail&nbsp;</div></li><li><div>            // and verify there's at least one instance of &quot;TRACK xx AUDIO&quot; in the file&nbsp;</div></li><li><div>            $GetFileFormatArray = $this-&gt;GetFileFormatArray();&nbsp;</div></li><li><div>            $info = $GetFileFormatArray['cue'];&nbsp;</div></li><li><div>            $info['include'] = 'module.'.$info['group'].'.'.$info['module'].'.php';&nbsp;</div></li><li><div>            return $info;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // converts array to $encoding charset from $this-&gt;encoding&nbsp;</div></li><li><div>    public function CharConvert(&$array, $encoding) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // identical encoding - end here&nbsp;</div></li><li><div>        if ($encoding == $this-&gt;encoding) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // loop thru array&nbsp;</div></li><li><div>        foreach ($array as $key =&gt; $value) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // go recursive&nbsp;</div></li><li><div>            if (is_array($value)) {&nbsp;</div></li><li><div>                $this-&gt;CharConvert($array[$key], $encoding);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // convert string&nbsp;</div></li><li><div>            elseif (is_string($value)) {&nbsp;</div></li><li><div>                $array[$key] = trim(getid3_lib::iconv_fallback($encoding, $this-&gt;encoding, $value));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function HandleAllTags() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // key name =&gt; array (tag name, character encoding)&nbsp;</div></li><li><div>        static $tags;&nbsp;</div></li><li><div>        if (empty($tags)) {&nbsp;</div></li><li><div>            $tags = array(&nbsp;</div></li><li><div>                'asf' =&gt; array('asf' , 'UTF-16LE'), &nbsp;</div></li><li><div>                'midi' =&gt; array('midi' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'nsv' =&gt; array('nsv' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'ogg' =&gt; array('vorbiscomment' , 'UTF-8'), &nbsp;</div></li><li><div>                'png' =&gt; array('png' , 'UTF-8'), &nbsp;</div></li><li><div>                'tiff' =&gt; array('tiff' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'quicktime' =&gt; array('quicktime' , 'UTF-8'), &nbsp;</div></li><li><div>                'real' =&gt; array('real' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'vqf' =&gt; array('vqf' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'zip' =&gt; array('zip' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'riff' =&gt; array('riff' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'lyrics3' =&gt; array('lyrics3' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'id3v1' =&gt; array('id3v1' , $this-&gt;encoding_id3v1), &nbsp;</div></li><li><div>                'id3v2' =&gt; array('id3v2' , 'UTF-8'), // not according to the specs (every frame can have a different encoding), but getID3() force-converts all encodings to UTF-8&nbsp;</div></li><li><div>                'ape' =&gt; array('ape' , 'UTF-8'), &nbsp;</div></li><li><div>                'cue' =&gt; array('cue' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'matroska' =&gt; array('matroska' , 'UTF-8'), &nbsp;</div></li><li><div>                'flac' =&gt; array('vorbiscomment' , 'UTF-8'), &nbsp;</div></li><li><div>                'divxtag' =&gt; array('divx' , 'ISO-8859-1'), &nbsp;</div></li><li><div>                'iptc' =&gt; array('iptc' , 'ISO-8859-1'), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // loop through comments array&nbsp;</div></li><li><div>        foreach ($tags as $comment_name =&gt; $tagname_encoding_array) {&nbsp;</div></li><li><div>            list($tag_name, $encoding) = $tagname_encoding_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // fill in default encoding type if not already present&nbsp;</div></li><li><div>            if (isset($this-&gt;info[$comment_name]) && !isset($this-&gt;info[$comment_name]['encoding'])) {&nbsp;</div></li><li><div>                $this-&gt;info[$comment_name]['encoding'] = $encoding;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // copy comments if key name set&nbsp;</div></li><li><div>            if (!empty($this-&gt;info[$comment_name]['comments'])) {&nbsp;</div></li><li><div>                foreach ($this-&gt;info[$comment_name]['comments'] as $tag_key =&gt; $valuearray) {&nbsp;</div></li><li><div>                    foreach ($valuearray as $key =&gt; $value) {&nbsp;</div></li><li><div>                        if (is_string($value)) {&nbsp;</div></li><li><div>                            $value = trim($value, &quot; \r\n\t&quot;); // do not trim nulls from $value!! Unicode characters will get mangled if trailing nulls are removed!&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($value) {&nbsp;</div></li><li><div>                            if (!is_numeric($key)) {&nbsp;</div></li><li><div>                                $this-&gt;info['tags'][trim($tag_name)][trim($tag_key)][$key] = $value;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $this-&gt;info['tags'][trim($tag_name)][trim($tag_key)][] = $value;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($tag_key == 'picture') {&nbsp;</div></li><li><div>                        unset($this-&gt;info[$comment_name]['comments'][$tag_key]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (!isset($this-&gt;info['tags'][$tag_name])) {&nbsp;</div></li><li><div>                    // comments are set but contain nothing but empty strings, so skip&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($this-&gt;option_tags_html) {&nbsp;</div></li><li><div>                    foreach ($this-&gt;info['tags'][$tag_name] as $tag_key =&gt; $valuearray) {&nbsp;</div></li><li><div>                        $this-&gt;info['tags_html'][$tag_name][$tag_key] = getid3_lib::recursiveMultiByteCharString2HTML($valuearray, $encoding);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;CharConvert($this-&gt;info['tags'][$tag_name], $encoding);           // only copy gets converted!&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // pictures can take up a lot of space, and we don't need multiple copies of them&nbsp;</div></li><li><div>        // let there be a single copy in [comments][picture], and not elsewhere&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['tags'])) {&nbsp;</div></li><li><div>            $unset_keys = array('tags', 'tags_html');&nbsp;</div></li><li><div>            foreach ($this-&gt;info['tags'] as $tagtype =&gt; $tagarray) {&nbsp;</div></li><li><div>                foreach ($tagarray as $tagname =&gt; $tagdata) {&nbsp;</div></li><li><div>                    if ($tagname == 'picture') {&nbsp;</div></li><li><div>                        foreach ($tagdata as $key =&gt; $tagarray) {&nbsp;</div></li><li><div>                            $this-&gt;info['comments']['picture'][] = $tagarray;&nbsp;</div></li><li><div>                            if (isset($tagarray['data']) && isset($tagarray['image_mime'])) {&nbsp;</div></li><li><div>                                if (isset($this-&gt;info['tags'][$tagtype][$tagname][$key])) {&nbsp;</div></li><li><div>                                    unset($this-&gt;info['tags'][$tagtype][$tagname][$key]);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                if (isset($this-&gt;info['tags_html'][$tagtype][$tagname][$key])) {&nbsp;</div></li><li><div>                                    unset($this-&gt;info['tags_html'][$tagtype][$tagname][$key]);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                foreach ($unset_keys as $unset_key) {&nbsp;</div></li><li><div>                    // remove possible empty keys from (e.g. [tags][id3v2][picture])&nbsp;</div></li><li><div>                    if (empty($this-&gt;info[$unset_key][$tagtype]['picture'])) {&nbsp;</div></li><li><div>                        unset($this-&gt;info[$unset_key][$tagtype]['picture']);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (empty($this-&gt;info[$unset_key][$tagtype])) {&nbsp;</div></li><li><div>                        unset($this-&gt;info[$unset_key][$tagtype]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (empty($this-&gt;info[$unset_key])) {&nbsp;</div></li><li><div>                        unset($this-&gt;info[$unset_key]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // remove duplicate copy of picture data from (e.g. [id3v2][comments][picture])&nbsp;</div></li><li><div>                if (isset($this-&gt;info[$tagtype]['comments']['picture'])) {&nbsp;</div></li><li><div>                    unset($this-&gt;info[$tagtype]['comments']['picture']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (empty($this-&gt;info[$tagtype]['comments'])) {&nbsp;</div></li><li><div>                    unset($this-&gt;info[$tagtype]['comments']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (empty($this-&gt;info[$tagtype])) {&nbsp;</div></li><li><div>                    unset($this-&gt;info[$tagtype]);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getHashdata($algorithm) {&nbsp;</div></li><li><div>        switch ($algorithm) {&nbsp;</div></li><li><div>            case 'md5':&nbsp;</div></li><li><div>            case 'sha1':&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                return $this-&gt;error('bad algorithm &quot;'.$algorithm.'&quot; in getHashdata()');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['fileformat']) && !empty($this-&gt;info['dataformat']) && ($this-&gt;info['fileformat'] == 'ogg') && ($this-&gt;info['audio']['dataformat'] == 'vorbis')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // We cannot get an identical md5_data value for Ogg files where the comments&nbsp;</div></li><li><div>            // span more than 1 Ogg page (compared to the same audio data with smaller&nbsp;</div></li><li><div>            // comments) using the normal getID3() method of MD5'ing the data between the&nbsp;</div></li><li><div>            // end of the comments and the end of the file (minus any trailing tags), &nbsp;</div></li><li><div>            // because the page sequence numbers of the pages that the audio data is on&nbsp;</div></li><li><div>            // do not match. Under normal circumstances, where comments are smaller than&nbsp;</div></li><li><div>            // the nominal 4-8kB page size, then this is not a problem, but if there are&nbsp;</div></li><li><div>            // very large comments, the only way around it is to strip off the comment&nbsp;</div></li><li><div>            // tags with vorbiscomment and MD5 that file.&nbsp;</div></li><li><div>            // This procedure must be applied to ALL Ogg files, not just the ones with&nbsp;</div></li><li><div>            // comments larger than 1 page, because the below method simply MD5's the&nbsp;</div></li><li><div>            // whole file with the comments stripped, not just the portion after the&nbsp;</div></li><li><div>            // comments block (which is the standard getID3() method.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // The above-mentioned problem of comments spanning multiple pages and changing&nbsp;</div></li><li><div>            // page sequence numbers likely happens for OggSpeex and OggFLAC as well, but&nbsp;</div></li><li><div>            // currently vorbiscomment only works on OggVorbis files.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (preg_match('#(1|ON)#i', ini_get('safe_mode'))) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;warning('Failed making system call to vorbiscomment.exe - '.$algorithm.'_data is incorrect - error returned: PHP running in Safe Mode (backtick operator not available)');&nbsp;</div></li><li><div>                $this-&gt;info[$algorithm.'_data'] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Prevent user from aborting script&nbsp;</div></li><li><div>                $old_abort = ignore_user_abort(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Create empty file&nbsp;</div></li><li><div>                $empty = tempnam(GETID3_TEMP_DIR, 'getID3');&nbsp;</div></li><li><div>                touch($empty);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Use vorbiscomment to make temp file without comments&nbsp;</div></li><li><div>                $temp = tempnam(GETID3_TEMP_DIR, 'getID3');&nbsp;</div></li><li><div>                $file = $this-&gt;info['filenamepath'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (GETID3_OS_ISWINDOWS) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (file_exists(GETID3_HELPERAPPSDIR.'vorbiscomment.exe')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $commandline = '&quot;'.GETID3_HELPERAPPSDIR.'vorbiscomment.exe&quot; -w -c &quot;'.$empty.'&quot; &quot;'.$file.'&quot; &quot;'.$temp.'&quot;';&nbsp;</div></li><li><div>                        $VorbisCommentError = `$commandline`;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $VorbisCommentError = 'vorbiscomment.exe not found in '.GETID3_HELPERAPPSDIR;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $commandline = 'vorbiscomment -w -c &quot;'.$empty.'&quot; &quot;'.$file.'&quot; &quot;'.$temp.'&quot; 2&gt;&1';&nbsp;</div></li><li><div>                    $commandline = 'vorbiscomment -w -c '.escapeshellarg($empty).' '.escapeshellarg($file).' '.escapeshellarg($temp).' 2&gt;&1';&nbsp;</div></li><li><div>                    $VorbisCommentError = `$commandline`;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (!empty($VorbisCommentError)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;info['warning'][] = 'Failed making system call to vorbiscomment(.exe) - '.$algorithm.'_data will be incorrect. If vorbiscomment is unavailable, please download from http://www.vorbis.com/download.psp and put in the getID3() directory. Error returned: '.$VorbisCommentError;&nbsp;</div></li><li><div>                    $this-&gt;info[$algorithm.'_data'] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Get hash of newly created file&nbsp;</div></li><li><div>                    switch ($algorithm) {&nbsp;</div></li><li><div>                        case 'md5':&nbsp;</div></li><li><div>                            $this-&gt;info[$algorithm.'_data'] = md5_file($temp);&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        case 'sha1':&nbsp;</div></li><li><div>                            $this-&gt;info[$algorithm.'_data'] = sha1_file($temp);&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Clean up&nbsp;</div></li><li><div>                unlink($empty);&nbsp;</div></li><li><div>                unlink($temp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Reset abort setting&nbsp;</div></li><li><div>                ignore_user_abort($old_abort);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!empty($this-&gt;info['avdataoffset']) || (isset($this-&gt;info['avdataend']) && ($this-&gt;info['avdataend'] &lt; $this-&gt;info['filesize']))) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // get hash from part of file&nbsp;</div></li><li><div>                $this-&gt;info[$algorithm.'_data'] = getid3_lib::hash_data($this-&gt;info['filenamepath'], $this-&gt;info['avdataoffset'], $this-&gt;info['avdataend'], $algorithm);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // get hash from whole file&nbsp;</div></li><li><div>                switch ($algorithm) {&nbsp;</div></li><li><div>                    case 'md5':&nbsp;</div></li><li><div>                        $this-&gt;info[$algorithm.'_data'] = md5_file($this-&gt;info['filenamepath']);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'sha1':&nbsp;</div></li><li><div>                        $this-&gt;info[$algorithm.'_data'] = sha1_file($this-&gt;info['filenamepath']);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function ChannelsBitratePlaytimeCalculations() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set channelmode on audio&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['audio']['channelmode']) || !isset($this-&gt;info['audio']['channels'])) {&nbsp;</div></li><li><div>            // ignore&nbsp;</div></li><li><div>        } elseif ($this-&gt;info['audio']['channels'] == 1) {&nbsp;</div></li><li><div>            $this-&gt;info['audio']['channelmode'] = 'mono';&nbsp;</div></li><li><div>        } elseif ($this-&gt;info['audio']['channels'] == 2) {&nbsp;</div></li><li><div>            $this-&gt;info['audio']['channelmode'] = 'stereo';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Calculate combined bitrate - audio + video&nbsp;</div></li><li><div>        $CombinedBitrate = 0;&nbsp;</div></li><li><div>        $CombinedBitrate += (isset($this-&gt;info['audio']['bitrate']) ? $this-&gt;info['audio']['bitrate'] : 0);&nbsp;</div></li><li><div>        $CombinedBitrate += (isset($this-&gt;info['video']['bitrate']) ? $this-&gt;info['video']['bitrate'] : 0);&nbsp;</div></li><li><div>        if (($CombinedBitrate &gt; 0) && empty($this-&gt;info['bitrate'])) {&nbsp;</div></li><li><div>            $this-&gt;info['bitrate'] = $CombinedBitrate;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        //if ((isset($this-&gt;info['video']) && !isset($this-&gt;info['video']['bitrate'])) || (isset($this-&gt;info['audio']) && !isset($this-&gt;info['audio']['bitrate']))) {&nbsp;</div></li><li><div>        //    // for example, VBR MPEG video files cannot determine video bitrate:&nbsp;</div></li><li><div>        //    // should not set overall bitrate and playtime from audio bitrate only&nbsp;</div></li><li><div>        //    unset($this-&gt;info['bitrate']);&nbsp;</div></li><li><div>        //}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // video bitrate undetermined, but calculable&nbsp;</div></li><li><div>        if (isset($this-&gt;info['video']['dataformat']) && $this-&gt;info['video']['dataformat'] && (!isset($this-&gt;info['video']['bitrate']) || ($this-&gt;info['video']['bitrate'] == 0))) {&nbsp;</div></li><li><div>            // if video bitrate not set&nbsp;</div></li><li><div>            if (isset($this-&gt;info['audio']['bitrate']) && ($this-&gt;info['audio']['bitrate'] &gt; 0) && ($this-&gt;info['audio']['bitrate'] == $this-&gt;info['bitrate'])) {&nbsp;</div></li><li><div>                // AND if audio bitrate is set to same as overall bitrate&nbsp;</div></li><li><div>                if (isset($this-&gt;info['playtime_seconds']) && ($this-&gt;info['playtime_seconds'] &gt; 0)) {&nbsp;</div></li><li><div>                    // AND if playtime is set&nbsp;</div></li><li><div>                    if (isset($this-&gt;info['avdataend']) && isset($this-&gt;info['avdataoffset'])) {&nbsp;</div></li><li><div>                        // AND if AV data offset start/end is known&nbsp;</div></li><li><div>                        // THEN we can calculate the video bitrate&nbsp;</div></li><li><div>                        $this-&gt;info['bitrate'] = round((($this-&gt;info['avdataend'] - $this-&gt;info['avdataoffset']) * 8) / $this-&gt;info['playtime_seconds']);&nbsp;</div></li><li><div>                        $this-&gt;info['video']['bitrate'] = $this-&gt;info['bitrate'] - $this-&gt;info['audio']['bitrate'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ((!isset($this-&gt;info['playtime_seconds']) || ($this-&gt;info['playtime_seconds'] &lt;= 0)) && !empty($this-&gt;info['bitrate'])) {&nbsp;</div></li><li><div>            $this-&gt;info['playtime_seconds'] = (($this-&gt;info['avdataend'] - $this-&gt;info['avdataoffset']) * 8) / $this-&gt;info['bitrate'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!isset($this-&gt;info['bitrate']) && !empty($this-&gt;info['playtime_seconds'])) {&nbsp;</div></li><li><div>            $this-&gt;info['bitrate'] = (($this-&gt;info['avdataend'] - $this-&gt;info['avdataoffset']) * 8) / $this-&gt;info['playtime_seconds'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($this-&gt;info['bitrate']) && empty($this-&gt;info['audio']['bitrate']) && empty($this-&gt;info['video']['bitrate'])) {&nbsp;</div></li><li><div>            if (isset($this-&gt;info['audio']['dataformat']) && empty($this-&gt;info['video']['resolution_x'])) {&nbsp;</div></li><li><div>                // audio only&nbsp;</div></li><li><div>                $this-&gt;info['audio']['bitrate'] = $this-&gt;info['bitrate'];&nbsp;</div></li><li><div>            } elseif (isset($this-&gt;info['video']['resolution_x']) && empty($this-&gt;info['audio']['dataformat'])) {&nbsp;</div></li><li><div>                // video only&nbsp;</div></li><li><div>                $this-&gt;info['video']['bitrate'] = $this-&gt;info['bitrate'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set playtime string&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['playtime_seconds']) && empty($this-&gt;info['playtime_string'])) {&nbsp;</div></li><li><div>            $this-&gt;info['playtime_string'] = getid3_lib::PlaytimeString($this-&gt;info['playtime_seconds']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function CalculateCompressionRatioVideo() {&nbsp;</div></li><li><div>        if (empty($this-&gt;info['video'])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (empty($this-&gt;info['video']['resolution_x']) || empty($this-&gt;info['video']['resolution_y'])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (empty($this-&gt;info['video']['bits_per_sample'])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ($this-&gt;info['video']['dataformat']) {&nbsp;</div></li><li><div>            case 'bmp':&nbsp;</div></li><li><div>            case 'gif':&nbsp;</div></li><li><div>            case 'jpeg':&nbsp;</div></li><li><div>            case 'jpg':&nbsp;</div></li><li><div>            case 'png':&nbsp;</div></li><li><div>            case 'tiff':&nbsp;</div></li><li><div>                $FrameRate = 1;&nbsp;</div></li><li><div>                $PlaytimeSeconds = 1;&nbsp;</div></li><li><div>                $BitrateCompressed = $this-&gt;info['filesize'] * 8;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                if (!empty($this-&gt;info['video']['frame_rate'])) {&nbsp;</div></li><li><div>                    $FrameRate = $this-&gt;info['video']['frame_rate'];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!empty($this-&gt;info['playtime_seconds'])) {&nbsp;</div></li><li><div>                    $PlaytimeSeconds = $this-&gt;info['playtime_seconds'];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!empty($this-&gt;info['video']['bitrate'])) {&nbsp;</div></li><li><div>                    $BitrateCompressed = $this-&gt;info['video']['bitrate'];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $BitrateUncompressed = $this-&gt;info['video']['resolution_x'] * $this-&gt;info['video']['resolution_y'] * $this-&gt;info['video']['bits_per_sample'] * $FrameRate;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;info['video']['compression_ratio'] = $BitrateCompressed / $BitrateUncompressed;&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function CalculateCompressionRatioAudio() {&nbsp;</div></li><li><div>        if (empty($this-&gt;info['audio']['bitrate']) || empty($this-&gt;info['audio']['channels']) || empty($this-&gt;info['audio']['sample_rate']) || !is_numeric($this-&gt;info['audio']['sample_rate'])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;info['audio']['compression_ratio'] = $this-&gt;info['audio']['bitrate'] / ($this-&gt;info['audio']['channels'] * $this-&gt;info['audio']['sample_rate'] * (!empty($this-&gt;info['audio']['bits_per_sample']) ? $this-&gt;info['audio']['bits_per_sample'] : 16));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['audio']['streams'])) {&nbsp;</div></li><li><div>            foreach ($this-&gt;info['audio']['streams'] as $streamnumber =&gt; $streamdata) {&nbsp;</div></li><li><div>                if (!empty($streamdata['bitrate']) && !empty($streamdata['channels']) && !empty($streamdata['sample_rate'])) {&nbsp;</div></li><li><div>                    $this-&gt;info['audio']['streams'][$streamnumber]['compression_ratio'] = $streamdata['bitrate'] / ($streamdata['channels'] * $streamdata['sample_rate'] * (!empty($streamdata['bits_per_sample']) ? $streamdata['bits_per_sample'] : 16));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function CalculateReplayGain() {&nbsp;</div></li><li><div>        if (isset($this-&gt;info['replay_gain'])) {&nbsp;</div></li><li><div>            if (!isset($this-&gt;info['replay_gain']['reference_volume'])) {&nbsp;</div></li><li><div>                $this-&gt;info['replay_gain']['reference_volume'] = (double) 89.0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($this-&gt;info['replay_gain']['track']['adjustment'])) {&nbsp;</div></li><li><div>                $this-&gt;info['replay_gain']['track']['volume'] = $this-&gt;info['replay_gain']['reference_volume'] - $this-&gt;info['replay_gain']['track']['adjustment'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($this-&gt;info['replay_gain']['album']['adjustment'])) {&nbsp;</div></li><li><div>                $this-&gt;info['replay_gain']['album']['volume'] = $this-&gt;info['replay_gain']['reference_volume'] - $this-&gt;info['replay_gain']['album']['adjustment'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($this-&gt;info['replay_gain']['track']['peak'])) {&nbsp;</div></li><li><div>                $this-&gt;info['replay_gain']['track']['max_noclip_gain'] = 0 - getid3_lib::RGADamplitude2dB($this-&gt;info['replay_gain']['track']['peak']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($this-&gt;info['replay_gain']['album']['peak'])) {&nbsp;</div></li><li><div>                $this-&gt;info['replay_gain']['album']['max_noclip_gain'] = 0 - getid3_lib::RGADamplitude2dB($this-&gt;info['replay_gain']['album']['peak']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function ProcessAudioStreams() {&nbsp;</div></li><li><div>        if (!empty($this-&gt;info['audio']['bitrate']) || !empty($this-&gt;info['audio']['channels']) || !empty($this-&gt;info['audio']['sample_rate'])) {&nbsp;</div></li><li><div>            if (!isset($this-&gt;info['audio']['streams'])) {&nbsp;</div></li><li><div>                foreach ($this-&gt;info['audio'] as $key =&gt; $value) {&nbsp;</div></li><li><div>                    if ($key != 'streams') {&nbsp;</div></li><li><div>                        $this-&gt;info['audio']['streams'][0][$key] = $value;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getid3_tempnam() {&nbsp;</div></li><li><div>        return tempnam($this-&gt;tempdir, 'gI3');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function include_module($name) {&nbsp;</div></li><li><div>        //if (!file_exists($this-&gt;include_path.'module.'.$name.'.php')) {&nbsp;</div></li><li><div>        if (!file_exists(GETID3_INCLUDEPATH.'module.'.$name.'.php')) {&nbsp;</div></li><li><div>            throw new getid3_exception('Required module.'.$name.'.php is missing.');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        include_once(GETID3_INCLUDEPATH.'module.'.$name.'.php');&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.7</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/get_id3/" class="">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/get_id3/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/get_id3/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/get_id3/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/get_id3/" class="active">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>getID3</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>