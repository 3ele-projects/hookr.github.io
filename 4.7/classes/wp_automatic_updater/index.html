<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-version="4.7" data-type="class" data-id="5239"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp_automatic_updater | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WP_Automatic_Updater, class, wordpress, 4.7" /><meta name="description" content="Core class used for handling automatic background updates." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=46f80ed07aba301a9b86e1b5a49af823' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wp_automatic_updater/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwp_automatic_updater%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwp_automatic_updater%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-class-wp_automatic_updater","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp_automatic_updater" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp_automatic_updater</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WP_Automatic_Updater</strong></h1><p>Core class used for handling automatic background updates.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7/files/wp-admin-includes-class-wp-automatic-updater/" class="file">/wp-admin/includes/class-wp-automatic-updater.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="16" class="block" start="16"><li><div>class WP_Automatic_Updater {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Tracks update results during processing.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $update_results = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether the entire automatic updater is disabled.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_disabled() {&nbsp;</div></li><li><div>        // Background updates are disabled if you don't want file changes.&nbsp;</div></li><li><div>        if ( defined( 'DISALLOW_FILE_MODS' ) && DISALLOW_FILE_MODS )&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( wp_installing() )&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // More fine grained control can be done through the WP_AUTO_UPDATE_CORE constant and filters.&nbsp;</div></li><li><div>        $disabled = defined( 'AUTOMATIC_UPDATER_DISABLED' ) && AUTOMATIC_UPDATER_DISABLED;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether to entirely disable background updates.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * There are more fine-grained filters and controls for selective disabling.&nbsp;</div></li><li><div>         * This filter parallels the AUTOMATIC_UPDATER_DISABLED constant in name.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * This also disables update notification emails. That may change in the future.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.7.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool $disabled Whether the updater should be disabled.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'automatic_updater_disabled', $disabled );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check for version control checkouts.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Checks for Subversion, Git, Mercurial, and Bazaar. It recursively looks up the&nbsp;</div></li><li><div>     * filesystem to the top of the drive, erring on the side of detecting a VCS&nbsp;</div></li><li><div>     * checkout somewhere.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * ABSPATH is always checked in addition to whatever $context is (which may be the&nbsp;</div></li><li><div>     * wp-content directory, for example). The underlying assumption is that if you are&nbsp;</div></li><li><div>     * using version control *anywhere*, then you should be making decisions for&nbsp;</div></li><li><div>     * how things get updated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $context The filesystem path to check, in addition to ABSPATH.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_vcs_checkout( $context ) {&nbsp;</div></li><li><div>        $context_dirs = array( untrailingslashit( $context ) );&nbsp;</div></li><li><div>        if ( $context !== ABSPATH )&nbsp;</div></li><li><div>            $context_dirs[] = untrailingslashit( ABSPATH );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $vcs_dirs = array( '.svn', '.git', '.hg', '.bzr' );&nbsp;</div></li><li><div>        $check_dirs = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $context_dirs as $context_dir ) {&nbsp;</div></li><li><div>            // Walk up from $context_dir to the root.&nbsp;</div></li><li><div>            do {&nbsp;</div></li><li><div>                $check_dirs[] = $context_dir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Once we've hit '/' or 'C:\', we need to stop. dirname will keep returning the input here.&nbsp;</div></li><li><div>                if ( $context_dir == dirname( $context_dir ) )&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Continue one level at a time.&nbsp;</div></li><li><div>            } while ( $context_dir = dirname( $context_dir ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $check_dirs = array_unique( $check_dirs );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Search all directories we've found for evidence of version control.&nbsp;</div></li><li><div>        foreach ( $vcs_dirs as $vcs_dir ) {&nbsp;</div></li><li><div>            foreach ( $check_dirs as $check_dir ) {&nbsp;</div></li><li><div>                if ( $checkout = @is_dir( rtrim( $check_dir, '\\/' ) . &quot;/$vcs_dir&quot; ) )&nbsp;</div></li><li><div>                    break 2;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether the automatic updater should consider a filesystem&nbsp;</div></li><li><div>         * location to be potentially managed by a version control system.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.7.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool $checkout  Whether a VCS checkout was discovered at $context&nbsp;</div></li><li><div>         *                        or ABSPATH, or anywhere higher.&nbsp;</div></li><li><div>         * @param string $context The filesystem context (a path) against which&nbsp;</div></li><li><div>         *                        filesystem status should be checked.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'automatic_updates_is_vcs_checkout', $checkout, $context );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Tests to see if we can and should update a specific item.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global wpdb $wpdb WordPress database abstraction object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $type    The type of update being checked: 'core', 'theme', &nbsp;</div></li><li><div>     *                        'plugin', 'translation'.&nbsp;</div></li><li><div>     * @param object $item    The update offer.&nbsp;</div></li><li><div>     * @param string $context The filesystem context (a path) against which filesystem&nbsp;</div></li><li><div>     *                        access and status should be checked.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function should_update( $type, $item, $context ) {&nbsp;</div></li><li><div>        // Used to see if WP_Filesystem is set up to allow unattended updates.&nbsp;</div></li><li><div>        $skin = new Automatic_Upgrader_Skin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;is_disabled() )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only relax the filesystem checks when the update doesn't include new files&nbsp;</div></li><li><div>        $allow_relaxed_file_ownership = false;&nbsp;</div></li><li><div>        if ( 'core' == $type && isset( $item-&gt;new_files ) && ! $item-&gt;new_files ) {&nbsp;</div></li><li><div>            $allow_relaxed_file_ownership = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we can't do an auto core update, we may still be able to email the user.&nbsp;</div></li><li><div>        if ( ! $skin-&gt;request_filesystem_credentials( false, $context, $allow_relaxed_file_ownership ) || $this-&gt;is_vcs_checkout( $context ) ) {&nbsp;</div></li><li><div>            if ( 'core' == $type )&nbsp;</div></li><li><div>                $this-&gt;send_core_update_notification_email( $item );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Next up, is this an item we can update?&nbsp;</div></li><li><div>        if ( 'core' == $type )&nbsp;</div></li><li><div>            $update = Core_Upgrader::should_update_to_version( $item-&gt;current );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $update = ! empty( $item-&gt;autoupdate );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether to automatically update core, a plugin, a theme, or a language.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * The dynamic portion of the hook name, `$type`, refers to the type of update&nbsp;</div></li><li><div>         * being checked. Can be 'core', 'theme', 'plugin', or 'translation'.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Generally speaking, plugins, themes, and major core versions are not updated&nbsp;</div></li><li><div>         * by default, while translations and minor and development versions for core&nbsp;</div></li><li><div>         * are updated by default.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * See the {@see 'allow_dev_auto_core_updates', {@see 'allow_minor_auto_core_updates'}, &nbsp;</div></li><li><div>         * and {@see 'allow_major_auto_core_updates'} filters for a more straightforward way to&nbsp;</div></li><li><div>         * adjust core updates.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.7.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool   $update Whether to update.&nbsp;</div></li><li><div>         * @param object $item   The update offer.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $update = apply_filters( &quot;auto_update_{$type}&quot;, $update, $item );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $update ) {&nbsp;</div></li><li><div>            if ( 'core' == $type )&nbsp;</div></li><li><div>                $this-&gt;send_core_update_notification_email( $item );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If it's a core update, are we actually compatible with its requirements?&nbsp;</div></li><li><div>        if ( 'core' == $type ) {&nbsp;</div></li><li><div>            global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $php_compat = version_compare( phpversion(), $item-&gt;php_version, '&gt;=' );&nbsp;</div></li><li><div>            if ( file_exists( WP_CONTENT_DIR . '/db.php' ) && empty( $wpdb-&gt;is_mysql ) )&nbsp;</div></li><li><div>                $mysql_compat = true;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $mysql_compat = version_compare( $wpdb-&gt;db_version(), $item-&gt;mysql_version, '&gt;=' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! $php_compat || ! $mysql_compat )&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Notifies an administrator of a core update.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $item The update offer.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function send_core_update_notification_email( $item ) {&nbsp;</div></li><li><div>        $notified = get_site_option( 'auto_core_update_notified' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Don't notify if we've already notified the same email address of the same version.&nbsp;</div></li><li><div>        if ( $notified && $notified['email'] == get_site_option( 'admin_email' ) && $notified['version'] == $item-&gt;current )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // See if we need to notify users of a core update.&nbsp;</div></li><li><div>        $notify = ! empty( $item-&gt;notify_email );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether to notify the site administrator of a new core update.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * By default, administrators are notified when the update offer received&nbsp;</div></li><li><div>         * from WordPress.org sets a particular flag. This allows some discretion&nbsp;</div></li><li><div>         * in if and when to notify.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * This filter is only evaluated once per release. If the same email address&nbsp;</div></li><li><div>         * was already notified of the same new version, WordPress won't repeatedly&nbsp;</div></li><li><div>         * email the administrator.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * This filter is also used on about.php to check if a plugin has disabled&nbsp;</div></li><li><div>         * these notifications.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.7.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool   $notify Whether the site administrator is notified.&nbsp;</div></li><li><div>         * @param object $item   The update offer.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( ! apply_filters( 'send_core_update_notification_email', $notify, $item ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;send_email( 'manual', $item );&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update an item, if appropriate.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $type The type of update being checked: 'core', 'theme', 'plugin', 'translation'.&nbsp;</div></li><li><div>     * @param object $item The update offer.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null|WP_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function update( $type, $item ) {&nbsp;</div></li><li><div>        $skin = new Automatic_Upgrader_Skin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $type ) {&nbsp;</div></li><li><div>            case 'core':&nbsp;</div></li><li><div>                // The Core upgrader doesn't use the Upgrader's skin during the actual main part of the upgrade, instead, firing a filter.&nbsp;</div></li><li><div>                add_filter( 'update_feedback', array( $skin, 'feedback' ) );&nbsp;</div></li><li><div>                $upgrader = new Core_Upgrader( $skin );&nbsp;</div></li><li><div>                $context = ABSPATH;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'plugin':&nbsp;</div></li><li><div>                $upgrader = new Plugin_Upgrader( $skin );&nbsp;</div></li><li><div>                $context = WP_PLUGIN_DIR; // We don't support custom Plugin directories, or updates for WPMU_PLUGIN_DIR&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'theme':&nbsp;</div></li><li><div>                $upgrader = new Theme_Upgrader( $skin );&nbsp;</div></li><li><div>                $context = get_theme_root( $item-&gt;theme );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'translation':&nbsp;</div></li><li><div>                $upgrader = new Language_Pack_Upgrader( $skin );&nbsp;</div></li><li><div>                $context = WP_CONTENT_DIR; // WP_LANG_DIR;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Determine whether we can and should perform this update.&nbsp;</div></li><li><div>        if ( ! $this-&gt;should_update( $type, $item, $context ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires immediately prior to an auto-update.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 4.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param string $type    The type of update being checked: 'core', 'theme', 'plugin', or 'translation'.&nbsp;</div></li><li><div>         * @param object $item    The update offer.&nbsp;</div></li><li><div>         * @param string $context The filesystem context (a path) against which filesystem access and status&nbsp;</div></li><li><div>         *                        should be checked.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'pre_auto_update', $type, $item, $context );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $upgrader_item = $item;&nbsp;</div></li><li><div>        switch ( $type ) {&nbsp;</div></li><li><div>            case 'core':&nbsp;</div></li><li><div>                $skin-&gt;feedback( __( 'Updating to WordPress %s' ), $item-&gt;version );&nbsp;</div></li><li><div>                $item_name = sprintf( __( 'WordPress %s' ), $item-&gt;version );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'theme':&nbsp;</div></li><li><div>                $upgrader_item = $item-&gt;theme;&nbsp;</div></li><li><div>                $theme = wp_get_theme( $upgrader_item );&nbsp;</div></li><li><div>                $item_name = $theme-&gt;Get( 'Name' );&nbsp;</div></li><li><div>                $skin-&gt;feedback( __( 'Updating theme: %s' ), $item_name );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'plugin':&nbsp;</div></li><li><div>                $upgrader_item = $item-&gt;plugin;&nbsp;</div></li><li><div>                $plugin_data = get_plugin_data( $context . '/' . $upgrader_item );&nbsp;</div></li><li><div>                $item_name = $plugin_data['Name'];&nbsp;</div></li><li><div>                $skin-&gt;feedback( __( 'Updating plugin: %s' ), $item_name );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'translation':&nbsp;</div></li><li><div>                $language_item_name = $upgrader-&gt;get_name_for_update( $item );&nbsp;</div></li><li><div>                $item_name = sprintf( __( 'Translations for %s' ), $language_item_name );&nbsp;</div></li><li><div>                $skin-&gt;feedback( sprintf( __( 'Updating translations for %1$s (%2$s)&#8230;' ), $language_item_name, $item-&gt;language ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $allow_relaxed_file_ownership = false;&nbsp;</div></li><li><div>        if ( 'core' == $type && isset( $item-&gt;new_files ) && ! $item-&gt;new_files ) {&nbsp;</div></li><li><div>            $allow_relaxed_file_ownership = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Boom, This sites about to get a whole new splash of paint!&nbsp;</div></li><li><div>        $upgrade_result = $upgrader-&gt;upgrade( $upgrader_item, array(&nbsp;</div></li><li><div>            'clear_update_cache' =&gt; false, &nbsp;</div></li><li><div>            // Always use partial builds if possible for core updates.&nbsp;</div></li><li><div>            'pre_check_md5' =&gt; false, &nbsp;</div></li><li><div>            // Only available for core updates.&nbsp;</div></li><li><div>            'attempt_rollback' =&gt; true, &nbsp;</div></li><li><div>            // Allow relaxed file ownership in some scenarios&nbsp;</div></li><li><div>            'allow_relaxed_file_ownership' =&gt; $allow_relaxed_file_ownership, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If the filesystem is unavailable, false is returned.&nbsp;</div></li><li><div>        if ( false === $upgrade_result ) {&nbsp;</div></li><li><div>            $upgrade_result = new WP_Error( 'fs_unavailable', __( 'Could not access filesystem.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'core' == $type ) {&nbsp;</div></li><li><div>            if ( is_wp_error( $upgrade_result ) && ( 'up_to_date' == $upgrade_result-&gt;get_error_code() || 'locked' == $upgrade_result-&gt;get_error_code() ) ) {&nbsp;</div></li><li><div>                // These aren't actual errors, treat it as a skipped-update instead to avoid triggering the post-core update failure routines.&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Core doesn't output this, so let's append it so we don't get confused.&nbsp;</div></li><li><div>            if ( is_wp_error( $upgrade_result ) ) {&nbsp;</div></li><li><div>                $skin-&gt;error( __( 'Installation Failed' ), $upgrade_result );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $skin-&gt;feedback( __( 'WordPress updated successfully' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;update_results[ $type ][] = (object) array(&nbsp;</div></li><li><div>            'item' =&gt; $item, &nbsp;</div></li><li><div>            'result' =&gt; $upgrade_result, &nbsp;</div></li><li><div>            'name' =&gt; $item_name, &nbsp;</div></li><li><div>            'messages' =&gt; $skin-&gt;get_upgrade_messages()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $upgrade_result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Kicks off the background update process, looping through all pending updates.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function run() {&nbsp;</div></li><li><div>        if ( $this-&gt;is_disabled() )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_main_network() || ! is_main_site() )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! WP_Upgrader::create_lock( 'auto_updater' ) )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Don't automatically run these thins, as we'll handle it ourselves&nbsp;</div></li><li><div>        remove_action( 'upgrader_process_complete', array( 'Language_Pack_Upgrader', 'async_upgrade' ), 20 );&nbsp;</div></li><li><div>        remove_action( 'upgrader_process_complete', 'wp_version_check' );&nbsp;</div></li><li><div>        remove_action( 'upgrader_process_complete', 'wp_update_plugins' );&nbsp;</div></li><li><div>        remove_action( 'upgrader_process_complete', 'wp_update_themes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Next, Plugins&nbsp;</div></li><li><div>        wp_update_plugins(); // Check for Plugin updates&nbsp;</div></li><li><div>        $plugin_updates = get_site_transient( 'update_plugins' );&nbsp;</div></li><li><div>        if ( $plugin_updates && !empty( $plugin_updates-&gt;response ) ) {&nbsp;</div></li><li><div>            foreach ( $plugin_updates-&gt;response as $plugin ) {&nbsp;</div></li><li><div>                $this-&gt;update( 'plugin', $plugin );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Force refresh of plugin update information&nbsp;</div></li><li><div>            wp_clean_plugins_cache();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Next, those themes we all love&nbsp;</div></li><li><div>        wp_update_themes();  // Check for Theme updates&nbsp;</div></li><li><div>        $theme_updates = get_site_transient( 'update_themes' );&nbsp;</div></li><li><div>        if ( $theme_updates && !empty( $theme_updates-&gt;response ) ) {&nbsp;</div></li><li><div>            foreach ( $theme_updates-&gt;response as $theme ) {&nbsp;</div></li><li><div>                $this-&gt;update( 'theme', (object) $theme );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Force refresh of theme update information&nbsp;</div></li><li><div>            wp_clean_themes_cache();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Next, Process any core update&nbsp;</div></li><li><div>        wp_version_check(); // Check for Core updates&nbsp;</div></li><li><div>        $core_update = find_core_auto_update();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $core_update )&nbsp;</div></li><li><div>            $this-&gt;update( 'core', $core_update );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Clean up, and check for any pending translations&nbsp;</div></li><li><div>        // (Core_Upgrader checks for core updates)&nbsp;</div></li><li><div>        $theme_stats = array();&nbsp;</div></li><li><div>        if ( isset( $this-&gt;update_results['theme'] ) ) {&nbsp;</div></li><li><div>            foreach ( $this-&gt;update_results['theme'] as $upgrade ) {&nbsp;</div></li><li><div>                $theme_stats[ $upgrade-&gt;item-&gt;theme ] = ( true === $upgrade-&gt;result );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_update_themes( $theme_stats );  // Check for Theme updates&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $plugin_stats = array();&nbsp;</div></li><li><div>        if ( isset( $this-&gt;update_results['plugin'] ) ) {&nbsp;</div></li><li><div>            foreach ( $this-&gt;update_results['plugin'] as $upgrade ) {&nbsp;</div></li><li><div>                $plugin_stats[ $upgrade-&gt;item-&gt;plugin ] = ( true === $upgrade-&gt;result );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_update_plugins( $plugin_stats ); // Check for Plugin updates&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Finally, Process any new translations&nbsp;</div></li><li><div>        $language_updates = wp_get_translation_updates();&nbsp;</div></li><li><div>        if ( $language_updates ) {&nbsp;</div></li><li><div>            foreach ( $language_updates as $update ) {&nbsp;</div></li><li><div>                $this-&gt;update( 'translation', $update );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Clear existing caches&nbsp;</div></li><li><div>            wp_clean_update_cache();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_version_check();  // check for Core updates&nbsp;</div></li><li><div>            wp_update_themes();  // Check for Theme updates&nbsp;</div></li><li><div>            wp_update_plugins(); // Check for Plugin updates&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Send debugging email to all development installs.&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;update_results ) ) {&nbsp;</div></li><li><div>            $development_version = false !== strpos( get_bloginfo( 'version' ), '-' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters whether to send a debugging email for each automatic background update.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.7.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param bool $development_version By default, emails are sent if the&nbsp;</div></li><li><div>             *                                  install is a development version.&nbsp;</div></li><li><div>             *                                  Return false to avoid the email.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            if ( apply_filters( 'automatic_updates_send_debug_email', $development_version ) )&nbsp;</div></li><li><div>                $this-&gt;send_debug_email();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;update_results['core'] ) )&nbsp;</div></li><li><div>                $this-&gt;after_core_update( $this-&gt;update_results['core'][0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Fires after all automatic updates have run.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.8.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array $update_results The results of all attempted updates.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            do_action( 'automatic_updates_complete', $this-&gt;update_results );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        WP_Upgrader::release_lock( 'auto_updater' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * If we tried to perform a core update, check if we should send an email, &nbsp;</div></li><li><div>     * and if we need to avoid processing future updates.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since Unknown&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $update_result The result of the core update. Includes the update offer and result.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function after_core_update( $update_result ) {&nbsp;</div></li><li><div>        $wp_version = get_bloginfo( 'version' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $core_update = $update_result-&gt;item;&nbsp;</div></li><li><div>        $result = $update_result-&gt;result;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_wp_error( $result ) ) {&nbsp;</div></li><li><div>            $this-&gt;send_email( 'success', $core_update );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $error_code = $result-&gt;get_error_code();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Any of these WP_Error codes are critical failures, as in they occurred after we started to copy core files.&nbsp;</div></li><li><div>        // We should not try to perform a background update again until there is a successful one-click update performed by the user.&nbsp;</div></li><li><div>        $critical = false;&nbsp;</div></li><li><div>        if ( $error_code === 'disk_full' || false !== strpos( $error_code, '__copy_dir' ) ) {&nbsp;</div></li><li><div>            $critical = true;&nbsp;</div></li><li><div>        } elseif ( $error_code === 'rollback_was_required' && is_wp_error( $result-&gt;get_error_data()-&gt;rollback ) ) {&nbsp;</div></li><li><div>            // A rollback is only critical if it failed too.&nbsp;</div></li><li><div>            $critical = true;&nbsp;</div></li><li><div>            $rollback_result = $result-&gt;get_error_data()-&gt;rollback;&nbsp;</div></li><li><div>        } elseif ( false !== strpos( $error_code, 'do_rollback' ) ) {&nbsp;</div></li><li><div>            $critical = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $critical ) {&nbsp;</div></li><li><div>            $critical_data = array(&nbsp;</div></li><li><div>                'attempted' =&gt; $core_update-&gt;current, &nbsp;</div></li><li><div>                'current' =&gt; $wp_version, &nbsp;</div></li><li><div>                'error_code' =&gt; $error_code, &nbsp;</div></li><li><div>                'error_data' =&gt; $result-&gt;get_error_data(), &nbsp;</div></li><li><div>                'timestamp' =&gt; time(), &nbsp;</div></li><li><div>                'critical' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            if ( isset( $rollback_result ) ) {&nbsp;</div></li><li><div>                $critical_data['rollback_code'] = $rollback_result-&gt;get_error_code();&nbsp;</div></li><li><div>                $critical_data['rollback_data'] = $rollback_result-&gt;get_error_data();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            update_site_option( 'auto_core_update_failed', $critical_data );&nbsp;</div></li><li><div>            $this-&gt;send_email( 'critical', $core_update, $result );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Any other WP_Error code (like download_failed or files_not_writable) occurs before&nbsp;</div></li><li><div>         * we tried to copy over core files. Thus, the failures are early and graceful.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * We should avoid trying to perform a background update again for the same version.&nbsp;</div></li><li><div>         * But we can try again if another version is released.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * For certain 'transient' failures, like download_failed, we should allow retries.&nbsp;</div></li><li><div>         * In fact, let's schedule a special update for an hour from now. (It's possible&nbsp;</div></li><li><div>         * the issue could actually be on WordPress.org's side.) If that one fails, then email.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $send = true;&nbsp;</div></li><li><div>          $transient_failures = array( 'incompatible_archive', 'download_failed', 'insane_distro', 'locked' );&nbsp;</div></li><li><div>          if ( in_array( $error_code, $transient_failures ) && ! get_site_option( 'auto_core_update_failed' ) ) {&nbsp;</div></li><li><div>              wp_schedule_single_event( time() + HOUR_IN_SECONDS, 'wp_maybe_auto_update' );&nbsp;</div></li><li><div>              $send = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $n = get_site_option( 'auto_core_update_notified' );&nbsp;</div></li><li><div>        // Don't notify if we've already notified the same email address of the same version of the same notification type.&nbsp;</div></li><li><div>        if ( $n && 'fail' == $n['type'] && $n['email'] == get_site_option( 'admin_email' ) && $n['version'] == $core_update-&gt;current )&nbsp;</div></li><li><div>            $send = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        update_site_option( 'auto_core_update_failed', array(&nbsp;</div></li><li><div>            'attempted' =&gt; $core_update-&gt;current, &nbsp;</div></li><li><div>            'current' =&gt; $wp_version, &nbsp;</div></li><li><div>            'error_code' =&gt; $error_code, &nbsp;</div></li><li><div>            'error_data' =&gt; $result-&gt;get_error_data(), &nbsp;</div></li><li><div>            'timestamp' =&gt; time(), &nbsp;</div></li><li><div>            'retry' =&gt; in_array( $error_code, $transient_failures ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $send )&nbsp;</div></li><li><div>            $this-&gt;send_email( 'fail', $core_update, $result );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sends an email upon the completion or failure of a background core update.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $type        The type of email to send. Can be one of 'success', 'fail', 'manual', 'critical'.&nbsp;</div></li><li><div>     * @param object $core_update The update offer that was attempted.&nbsp;</div></li><li><div>     * @param mixed  $result      Optional. The result for the core update. Can be WP_Error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function send_email( $type, $core_update, $result = null ) {&nbsp;</div></li><li><div>        update_site_option( 'auto_core_update_notified', array(&nbsp;</div></li><li><div>            'type' =&gt; $type, &nbsp;</div></li><li><div>            'email' =&gt; get_site_option( 'admin_email' ), &nbsp;</div></li><li><div>            'version' =&gt; $core_update-&gt;current, &nbsp;</div></li><li><div>            'timestamp' =&gt; time(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $next_user_core_update = get_preferred_from_update_core();&nbsp;</div></li><li><div>        // If the update transient is empty, use the update we just performed&nbsp;</div></li><li><div>        if ( ! $next_user_core_update )&nbsp;</div></li><li><div>            $next_user_core_update = $core_update;&nbsp;</div></li><li><div>        $newer_version_available = ( 'upgrade' == $next_user_core_update-&gt;response && version_compare( $next_user_core_update-&gt;version, $core_update-&gt;version, '&gt;' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether to send an email following an automatic background core update.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.7.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool   $send        Whether to send the email. Default true.&nbsp;</div></li><li><div>         * @param string $type        The type of email to send. Can be one of&nbsp;</div></li><li><div>         *                            'success', 'fail', 'critical'.&nbsp;</div></li><li><div>         * @param object $core_update The update offer that was attempted.&nbsp;</div></li><li><div>         * @param mixed  $result      The result for the core update. Can be WP_Error.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( 'manual' !== $type && ! apply_filters( 'auto_core_update_send_email', true, $type, $core_update, $result ) )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $type ) {&nbsp;</div></li><li><div>            case 'success' : // We updated.&nbsp;</div></li><li><div>                /** translators: 1: Site name, 2: WordPress version number. */&nbsp;</div></li><li><div>                $subject = __( '[%1$s] Your site has updated to WordPress %2$s' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'fail' :   // We tried to update but couldn't.&nbsp;</div></li><li><div>            case 'manual' : // We can't update (and made no attempt).&nbsp;</div></li><li><div>                /** translators: 1: Site name, 2: WordPress version number. */&nbsp;</div></li><li><div>                $subject = __( '[%1$s] WordPress %2$s is available. Please update!' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'critical' : // We tried to update, started to copy files, then things went wrong.&nbsp;</div></li><li><div>                /** translators: 1: Site name. */&nbsp;</div></li><li><div>                $subject = __( '[%1$s] URGENT: Your site may be down due to a failed update' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default :&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If the auto update is not to the latest version, say that the current version of WP is available instead.&nbsp;</div></li><li><div>        $version = 'success' === $type ? $core_update-&gt;current : $next_user_core_update-&gt;current;&nbsp;</div></li><li><div>        $subject = sprintf( $subject, wp_specialchars_decode( get_option( 'blogname' ), ENT_QUOTES ), $version );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $type ) {&nbsp;</div></li><li><div>            case 'success' :&nbsp;</div></li><li><div>                $body .= sprintf( __( 'Howdy! Your site at %1$s has been updated automatically to WordPress %2$s.' ), home_url(), $core_update-&gt;current );&nbsp;</div></li><li><div>                $body .= &quot;\n\n&quot;;&nbsp;</div></li><li><div>                if ( ! $newer_version_available )&nbsp;</div></li><li><div>                    $body .= __( 'No further action is needed on your part.' ) . ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Can only reference the About screen if their update was successful.&nbsp;</div></li><li><div>                list( $about_version ) = explode( '-', $core_update-&gt;current, 2 );&nbsp;</div></li><li><div>                $body .= sprintf( __( &quot;For more on version %s, see the About WordPress screen:&quot; ), $about_version );&nbsp;</div></li><li><div>                $body .= &quot;\n&quot; . admin_url( 'about.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $newer_version_available ) {&nbsp;</div></li><li><div>                    $body .= &quot;\n\n&quot; . sprintf( __( 'WordPress %s is also now available.' ), $next_user_core_update-&gt;current ) . ' ';&nbsp;</div></li><li><div>                    $body .= __( 'Updating is easy and only takes a few moments:' );&nbsp;</div></li><li><div>                    $body .= &quot;\n&quot; . network_admin_url( 'update-core.php' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'fail' :&nbsp;</div></li><li><div>            case 'manual' :&nbsp;</div></li><li><div>                $body .= sprintf( __( 'Please update your site at %1$s to WordPress %2$s.' ), home_url(), $next_user_core_update-&gt;current );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $body .= &quot;\n\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Don't show this message if there is a newer version available.&nbsp;</div></li><li><div>                // Potential for confusion, and also not useful for them to know at this point.&nbsp;</div></li><li><div>                if ( 'fail' == $type && ! $newer_version_available )&nbsp;</div></li><li><div>                    $body .= __( 'We tried but were unable to update your site automatically.' ) . ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $body .= __( 'Updating is easy and only takes a few moments:' );&nbsp;</div></li><li><div>                $body .= &quot;\n&quot; . network_admin_url( 'update-core.php' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'critical' :&nbsp;</div></li><li><div>                if ( $newer_version_available )&nbsp;</div></li><li><div>                    $body .= sprintf( __( 'Your site at %1$s experienced a critical failure while trying to update WordPress to version %2$s.' ), home_url(), $core_update-&gt;current );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $body .= sprintf( __( 'Your site at %1$s experienced a critical failure while trying to update to the latest version of WordPress, %2$s.' ), home_url(), $core_update-&gt;current );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $body .= &quot;\n\n&quot; . __( &quot;This means your site may be offline or broken. Don't panic; this can be fixed.&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $body .= &quot;\n\n&quot; . __( &quot;Please check out your site now. It's possible that everything is working. If it says you need to update, you should do so:&quot; );&nbsp;</div></li><li><div>                $body .= &quot;\n&quot; . network_admin_url( 'update-core.php' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $critical_support = 'critical' === $type && ! empty( $core_update-&gt;support_email );&nbsp;</div></li><li><div>        if ( $critical_support ) {&nbsp;</div></li><li><div>            // Support offer if available.&nbsp;</div></li><li><div>            $body .= &quot;\n\n&quot; . sprintf( __( &quot;The WordPress team is willing to help you. Forward this email to %s and the team will work with you to make sure your site is working.&quot; ), $core_update-&gt;support_email );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // Add a note about the support forums.&nbsp;</div></li><li><div>            $body .= &quot;\n\n&quot; . __( 'If you experience any issues or need support, the volunteers in the WordPress.org support forums may be able to help.' );&nbsp;</div></li><li><div>            $body .= &quot;\n&quot; . __( 'https://wordpress.org/support/' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Updates are important!&nbsp;</div></li><li><div>        if ( $type != 'success' || $newer_version_available ) {&nbsp;</div></li><li><div>            $body .= &quot;\n\n&quot; . __( 'Keeping your site updated is important for security. It also makes the internet a safer place for you and your readers.' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $critical_support ) {&nbsp;</div></li><li><div>            $body .= &quot; &quot; . __( &quot;If you reach out to us, we'll also ensure you'll never have this problem again.&quot; );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If things are successful and we're now on the latest, mention plugins and themes if any are out of date.&nbsp;</div></li><li><div>        if ( $type == 'success' && ! $newer_version_available && ( get_plugin_updates() || get_theme_updates() ) ) {&nbsp;</div></li><li><div>            $body .= &quot;\n\n&quot; . __( 'You also have some plugins or themes with updates available. Update them now:' );&nbsp;</div></li><li><div>            $body .= &quot;\n&quot; . network_admin_url();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body .= &quot;\n\n&quot; . __( 'The WordPress Team' ) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'critical' == $type && is_wp_error( $result ) ) {&nbsp;</div></li><li><div>            $body .= &quot;\n***\n\n&quot;;&nbsp;</div></li><li><div>            $body .= sprintf( __( 'Your site was running version %s.' ), get_bloginfo( 'version' ) );&nbsp;</div></li><li><div>            $body .= ' ' . __( 'We have some data that describes the error your site encountered.' );&nbsp;</div></li><li><div>            $body .= ' ' . __( 'Your hosting company, support forum volunteers, or a friendly developer may be able to use this information to help you:' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If we had a rollback and we're still critical, then the rollback failed too.&nbsp;</div></li><li><div>            // Loop through all errors (the main WP_Error, the update result, the rollback result) for code, data, etc.&nbsp;</div></li><li><div>            if ( 'rollback_was_required' == $result-&gt;get_error_code() )&nbsp;</div></li><li><div>                $errors = array( $result, $result-&gt;get_error_data()-&gt;update, $result-&gt;get_error_data()-&gt;rollback );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $errors = array( $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $errors as $error ) {&nbsp;</div></li><li><div>                if ( ! is_wp_error( $error ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                $error_code = $error-&gt;get_error_code();&nbsp;</div></li><li><div>                $body .= &quot;\n\n&quot; . sprintf( __( &quot;Error code: %s&quot; ), $error_code );&nbsp;</div></li><li><div>                if ( 'rollback_was_required' == $error_code )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                if ( $error-&gt;get_error_message() )&nbsp;</div></li><li><div>                    $body .= &quot;\n&quot; . $error-&gt;get_error_message();&nbsp;</div></li><li><div>                $error_data = $error-&gt;get_error_data();&nbsp;</div></li><li><div>                if ( $error_data )&nbsp;</div></li><li><div>                    $body .= &quot;\n&quot; . implode( ', ', (array) $error_data );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $body .= &quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $to = get_site_option( 'admin_email' );&nbsp;</div></li><li><div>        $headers = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $email = compact( 'to', 'subject', 'body', 'headers' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the email sent following an automatic background core update.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.7.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $email {&nbsp;</div></li><li><div>         *     Array of email arguments that will be passed to wp_mail().&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         *     @type string $to      The email recipient. An array of emails&nbsp;</div></li><li><div>         *                            can be returned, as handled by wp_mail().&nbsp;</div></li><li><div>         *     @type string $subject The email's subject.&nbsp;</div></li><li><div>         *     @type string $body    The email message body.&nbsp;</div></li><li><div>         *     @type string $headers Any email headers, defaults to no headers.&nbsp;</div></li><li><div>         * }&nbsp;</div></li><li><div>         * @param string $type        The type of email being sent. Can be one of&nbsp;</div></li><li><div>         *                            'success', 'fail', 'manual', 'critical'.&nbsp;</div></li><li><div>         * @param object $core_update The update offer that was attempted.&nbsp;</div></li><li><div>         * @param mixed  $result      The result for the core update. Can be WP_Error.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $email = apply_filters( 'auto_core_update_email', $email, $type, $core_update, $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_mail( $email['to'], wp_specialchars_decode( $email['subject'] ), $email['body'], $email['headers'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares and sends an email of a full log of background update results, useful for debugging and geekery.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.7.0&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function send_debug_email() {&nbsp;</div></li><li><div>        $update_count = 0;&nbsp;</div></li><li><div>        foreach ( $this-&gt;update_results as $type =&gt; $updates )&nbsp;</div></li><li><div>            $update_count += count( $updates );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body = array();&nbsp;</div></li><li><div>        $failures = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body[] = sprintf( __( 'WordPress site: %s' ), network_home_url( '/' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Core&nbsp;</div></li><li><div>        if ( isset( $this-&gt;update_results['core'] ) ) {&nbsp;</div></li><li><div>            $result = $this-&gt;update_results['core'][0];&nbsp;</div></li><li><div>            if ( $result-&gt;result && ! is_wp_error( $result-&gt;result ) ) {&nbsp;</div></li><li><div>                $body[] = sprintf( __( 'SUCCESS: WordPress was successfully updated to %s' ), $result-&gt;name );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $body[] = sprintf( __( 'FAILED: WordPress failed to update to %s' ), $result-&gt;name );&nbsp;</div></li><li><div>                $failures++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $body[] = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugins, Themes, Translations&nbsp;</div></li><li><div>        foreach ( array( 'plugin', 'theme', 'translation' ) as $type ) {&nbsp;</div></li><li><div>            if ( ! isset( $this-&gt;update_results[ $type ] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            $success_items = wp_list_filter( $this-&gt;update_results[ $type ], array( 'result' =&gt; true ) );&nbsp;</div></li><li><div>            if ( $success_items ) {&nbsp;</div></li><li><div>                $messages = array(&nbsp;</div></li><li><div>                    'plugin' =&gt; __( 'The following plugins were successfully updated:' ), &nbsp;</div></li><li><div>                    'theme' =&gt; __( 'The following themes were successfully updated:' ), &nbsp;</div></li><li><div>                    'translation' =&gt; __( 'The following translations were successfully updated:' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $body[] = $messages[ $type ];&nbsp;</div></li><li><div>                foreach ( wp_list_pluck( $success_items, 'name' ) as $name ) {&nbsp;</div></li><li><div>                    $body[] = ' * ' . sprintf( __( 'SUCCESS: %s' ), $name );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $success_items != $this-&gt;update_results[ $type ] ) {&nbsp;</div></li><li><div>                // Failed updates&nbsp;</div></li><li><div>                $messages = array(&nbsp;</div></li><li><div>                    'plugin' =&gt; __( 'The following plugins failed to update:' ), &nbsp;</div></li><li><div>                    'theme' =&gt; __( 'The following themes failed to update:' ), &nbsp;</div></li><li><div>                    'translation' =&gt; __( 'The following translations failed to update:' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $body[] = $messages[ $type ];&nbsp;</div></li><li><div>                foreach ( $this-&gt;update_results[ $type ] as $item ) {&nbsp;</div></li><li><div>                    if ( ! $item-&gt;result || is_wp_error( $item-&gt;result ) ) {&nbsp;</div></li><li><div>                        $body[] = ' * ' . sprintf( __( 'FAILED: %s' ), $item-&gt;name );&nbsp;</div></li><li><div>                        $failures++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $body[] = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $site_title = wp_specialchars_decode( get_bloginfo( 'name' ), ENT_QUOTES );&nbsp;</div></li><li><div>        if ( $failures ) {&nbsp;</div></li><li><div>            $body[] = trim( __(&nbsp;</div></li><li><div>&quot;BETA TESTING?&nbsp;</div></li><li><div>=============&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>This debugging email is sent when you are using a development version of WordPress.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>If you think these failures might be due to a bug in WordPress, could you report it?&nbsp;</div></li><li><div> * Open a thread in the support forums: https://wordpress.org/support/forum/alphabeta&nbsp;</div></li><li><div> * Or, if you're comfortable writing a bug report: https://core.trac.wordpress.org/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>Thanks! -- The WordPress Team&quot; ) );&nbsp;</div></li><li><div>            $body[] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $subject = sprintf( __( '[%s] There were failures during background updates' ), $site_title );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $subject = sprintf( __( '[%s] Background updates have finished' ), $site_title );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body[] = trim( __(&nbsp;</div></li><li><div>'UPDATE LOG&nbsp;</div></li><li><div>==========' ) );&nbsp;</div></li><li><div>        $body[] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( array( 'core', 'plugin', 'theme', 'translation' ) as $type ) {&nbsp;</div></li><li><div>            if ( ! isset( $this-&gt;update_results[ $type ] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            foreach ( $this-&gt;update_results[ $type ] as $update ) {&nbsp;</div></li><li><div>                $body[] = $update-&gt;name;&nbsp;</div></li><li><div>                $body[] = str_repeat( '-', strlen( $update-&gt;name ) );&nbsp;</div></li><li><div>                foreach ( $update-&gt;messages as $message )&nbsp;</div></li><li><div>                    $body[] = &quot;  &quot; . html_entity_decode( str_replace( '&#8230;', '...', $message ) );&nbsp;</div></li><li><div>                if ( is_wp_error( $update-&gt;result ) ) {&nbsp;</div></li><li><div>                    $results = array( 'update' =&gt; $update-&gt;result );&nbsp;</div></li><li><div>                    // If we rolled back, we want to know an error that occurred then too.&nbsp;</div></li><li><div>                    if ( 'rollback_was_required' === $update-&gt;result-&gt;get_error_code() )&nbsp;</div></li><li><div>                        $results = (array) $update-&gt;result-&gt;get_error_data();&nbsp;</div></li><li><div>                    foreach ( $results as $result_type =&gt; $result ) {&nbsp;</div></li><li><div>                        if ( ! is_wp_error( $result ) )&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( 'rollback' === $result_type ) {&nbsp;</div></li><li><div>                            /** translators: 1: Error code, 2: Error message. */&nbsp;</div></li><li><div>                            $body[] = '  ' . sprintf( __( 'Rollback Error: [%1$s] %2$s' ), $result-&gt;get_error_code(), $result-&gt;get_error_message() );&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            /** translators: 1: Error code, 2: Error message. */&nbsp;</div></li><li><div>                            $body[] = '  ' . sprintf( __( 'Error: [%1$s] %2$s' ), $result-&gt;get_error_code(), $result-&gt;get_error_message() );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( $result-&gt;get_error_data() )&nbsp;</div></li><li><div>                            $body[] = '         ' . implode( ', ', (array) $result-&gt;get_error_data() );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $body[] = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $email = array(&nbsp;</div></li><li><div>            'to' =&gt; get_site_option( 'admin_email' ), &nbsp;</div></li><li><div>            'subject' =&gt; $subject, &nbsp;</div></li><li><div>            'body' =&gt; implode( &quot;\n&quot;, $body ), &nbsp;</div></li><li><div>            'headers' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the debug email that can be sent following an automatic&nbsp;</div></li><li><div>         * background core update.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.8.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $email {&nbsp;</div></li><li><div>         *     Array of email arguments that will be passed to wp_mail().&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         *     @type string $to      The email recipient. An array of emails&nbsp;</div></li><li><div>         *                           can be returned, as handled by wp_mail().&nbsp;</div></li><li><div>         *     @type string $subject Email subject.&nbsp;</div></li><li><div>         *     @type string $body    Email message body.&nbsp;</div></li><li><div>         *     @type string $headers Any email headers. Default empty.&nbsp;</div></li><li><div>         * }&nbsp;</div></li><li><div>         * @param int   $failures The number of failures encountered while upgrading.&nbsp;</div></li><li><div>         * @param mixed $results  The results of all attempted updates.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $email = apply_filters( 'automatic_updates_debug_email', $email, $failures, $this-&gt;update_results );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_mail( $email['to'], wp_specialchars_decode( $email['subject'] ), $email['body'], $email['headers'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.7.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/wp_automatic_updater/" class="">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/wp_automatic_updater/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/wp_automatic_updater/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/wp_automatic_updater/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/wp_automatic_updater/" class="active">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>WP_Automatic_Updater</li><li><span></span>wp-admin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>