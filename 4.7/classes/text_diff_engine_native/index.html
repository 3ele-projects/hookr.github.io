<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-version="4.7" data-type="class" data-id="3899"><head xmlns="http://www.w3.org/1999/xhtml"><title> text_diff_engine_native | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Text_Diff_Engine_native, class, wordpress, 4.7" /><meta name="description" content="Class used internally by Text_Diff to actually compute the diffs." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=3b4b64014820d5f50cafcdf2e356d2c6' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/text_diff_engine_native/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftext_diff_engine_native%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftext_diff_engine_native%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-class-text_diff_engine_native","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="text_diff_engine_native" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">text_diff_engine_native</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Text_Diff_Engine_native</strong></h1><p>Class used internally by Text_Diff to actually compute the diffs.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7/files/wp-includes-text-diff-engine-native/" class="file">/wp-includes/Text/Diff/Engine/native.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="29" class="block" start="29"><li><div>class Text_Diff_Engine_native {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function diff($from_lines, $to_lines)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        array_walk($from_lines, array('Text_Diff', 'trimNewlines'));&nbsp;</div></li><li><div>        array_walk($to_lines, array('Text_Diff', 'trimNewlines'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $n_from = count($from_lines);&nbsp;</div></li><li><div>        $n_to = count($to_lines);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;xchanged = $this-&gt;ychanged = array();&nbsp;</div></li><li><div>        $this-&gt;xv = $this-&gt;yv = array();&nbsp;</div></li><li><div>        $this-&gt;xind = $this-&gt;yind = array();&nbsp;</div></li><li><div>        unset($this-&gt;seq);&nbsp;</div></li><li><div>        unset($this-&gt;in_seq);&nbsp;</div></li><li><div>        unset($this-&gt;lcs);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Skip leading common lines.&nbsp;</div></li><li><div>        for ($skip = 0; $skip &lt; $n_from && $skip &lt; $n_to; $skip++) {&nbsp;</div></li><li><div>            if ($from_lines[$skip] !== $to_lines[$skip]) {&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;xchanged[$skip] = $this-&gt;ychanged[$skip] = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Skip trailing common lines.&nbsp;</div></li><li><div>        $xi = $n_from; $yi = $n_to;&nbsp;</div></li><li><div>        for ($endskip = 0; --$xi &gt; $skip && --$yi &gt; $skip; $endskip++) {&nbsp;</div></li><li><div>            if ($from_lines[$xi] !== $to_lines[$yi]) {&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;xchanged[$xi] = $this-&gt;ychanged[$yi] = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Ignore lines which do not exist in both files.&nbsp;</div></li><li><div>        for ($xi = $skip; $xi &lt; $n_from - $endskip; $xi++) {&nbsp;</div></li><li><div>            $xhash[$from_lines[$xi]] = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($yi = $skip; $yi &lt; $n_to - $endskip; $yi++) {&nbsp;</div></li><li><div>            $line = $to_lines[$yi];&nbsp;</div></li><li><div>            if (($this-&gt;ychanged[$yi] = empty($xhash[$line]))) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $yhash[$line] = 1;&nbsp;</div></li><li><div>            $this-&gt;yv[] = $line;&nbsp;</div></li><li><div>            $this-&gt;yind[] = $yi;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($xi = $skip; $xi &lt; $n_from - $endskip; $xi++) {&nbsp;</div></li><li><div>            $line = $from_lines[$xi];&nbsp;</div></li><li><div>            if (($this-&gt;xchanged[$xi] = empty($yhash[$line]))) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;xv[] = $line;&nbsp;</div></li><li><div>            $this-&gt;xind[] = $xi;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Find the LCS.&nbsp;</div></li><li><div>        $this-&gt;_compareseq(0, count($this-&gt;xv), 0, count($this-&gt;yv));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Merge edits when possible.&nbsp;</div></li><li><div>        $this-&gt;_shiftBoundaries($from_lines, $this-&gt;xchanged, $this-&gt;ychanged);&nbsp;</div></li><li><div>        $this-&gt;_shiftBoundaries($to_lines, $this-&gt;ychanged, $this-&gt;xchanged);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Compute the edit operations.&nbsp;</div></li><li><div>        $edits = array();&nbsp;</div></li><li><div>        $xi = $yi = 0;&nbsp;</div></li><li><div>        while ($xi &lt; $n_from || $yi &lt; $n_to) {&nbsp;</div></li><li><div>            assert($yi &lt; $n_to || $this-&gt;xchanged[$xi]);&nbsp;</div></li><li><div>            assert($xi &lt; $n_from || $this-&gt;ychanged[$yi]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Skip matching &quot;snake&quot;.&nbsp;</div></li><li><div>            $copy = array();&nbsp;</div></li><li><div>            while ($xi &lt; $n_from && $yi &lt; $n_to&nbsp;</div></li><li><div>                   && !$this-&gt;xchanged[$xi] && !$this-&gt;ychanged[$yi]) {&nbsp;</div></li><li><div>                $copy[] = $from_lines[$xi++];&nbsp;</div></li><li><div>                ++$yi;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($copy) {&nbsp;</div></li><li><div>                $edits[] = new Text_Diff_Op_copy($copy);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Find deletes & adds.&nbsp;</div></li><li><div>            $delete = array();&nbsp;</div></li><li><div>            while ($xi &lt; $n_from && $this-&gt;xchanged[$xi]) {&nbsp;</div></li><li><div>                $delete[] = $from_lines[$xi++];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $add = array();&nbsp;</div></li><li><div>            while ($yi &lt; $n_to && $this-&gt;ychanged[$yi]) {&nbsp;</div></li><li><div>                $add[] = $to_lines[$yi++];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($delete && $add) {&nbsp;</div></li><li><div>                $edits[] = new Text_Diff_Op_change($delete, $add);&nbsp;</div></li><li><div>            } elseif ($delete) {&nbsp;</div></li><li><div>                $edits[] = new Text_Diff_Op_delete($delete);&nbsp;</div></li><li><div>            } elseif ($add) {&nbsp;</div></li><li><div>                $edits[] = new Text_Diff_Op_add($add);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $edits;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Divides the Largest Common Subsequence (LCS) of the sequences (XOFF, &nbsp;</div></li><li><div>     * XLIM) and (YOFF, YLIM) into NCHUNKS approximately equally sized&nbsp;</div></li><li><div>     * segments.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Returns (LCS, PTS).  LCS is the length of the LCS. PTS is an array of&nbsp;</div></li><li><div>     * NCHUNKS+1 (X, Y) indexes giving the diving points between sub&nbsp;</div></li><li><div>     * sequences.  The first sub-sequence is contained in (X0, X1), (Y0, Y1), &nbsp;</div></li><li><div>     * the second in (X1, X2), (Y1, Y2) and so on.  Note that (X0, Y0) ==&nbsp;</div></li><li><div>     * (XOFF, YOFF) and (X[NCHUNKS], Y[NCHUNKS]) == (XLIM, YLIM).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This function assumes that the first lines of the specified portions of&nbsp;</div></li><li><div>     * the two files do not match, and likewise that the last lines do not&nbsp;</div></li><li><div>     * match.  The caller must trim matching lines from the beginning and end&nbsp;</div></li><li><div>     * of the portions it is going to specify.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _diag ($xoff, $xlim, $yoff, $ylim, $nchunks)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $flip = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($xlim - $xoff &gt; $ylim - $yoff) {&nbsp;</div></li><li><div>            /** Things seems faster (I'm not sure I understand why) when the&nbsp;</div></li><li><div>             * shortest sequence is in X. */&nbsp;</div></li><li><div>            $flip = true;&nbsp;</div></li><li><div>            list ($xoff, $xlim, $yoff, $ylim)&nbsp;</div></li><li><div> = array($yoff, $ylim, $xoff, $xlim);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($flip) {&nbsp;</div></li><li><div>            for ($i = $ylim - 1; $i &gt;= $yoff; $i--) {&nbsp;</div></li><li><div>                $ymatches[$this-&gt;xv[$i]][] = $i;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            for ($i = $ylim - 1; $i &gt;= $yoff; $i--) {&nbsp;</div></li><li><div>                $ymatches[$this-&gt;yv[$i]][] = $i;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;lcs = 0;&nbsp;</div></li><li><div>        $this-&gt;seq[0]= $yoff - 1;&nbsp;</div></li><li><div>        $this-&gt;in_seq = array();&nbsp;</div></li><li><div>        $ymids[0] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $numer = $xlim - $xoff + $nchunks - 1;&nbsp;</div></li><li><div>        $x = $xoff;&nbsp;</div></li><li><div>        for ($chunk = 0; $chunk &lt; $nchunks; $chunk++) {&nbsp;</div></li><li><div>            if ($chunk &gt; 0) {&nbsp;</div></li><li><div>                for ($i = 0; $i &lt;= $this-&gt;lcs; $i++) {&nbsp;</div></li><li><div>                    $ymids[$i][$chunk - 1] = $this-&gt;seq[$i];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $x1 = $xoff + (int)(($numer + ($xlim - $xoff) * $chunk) / $nchunks);&nbsp;</div></li><li><div>            for (; $x &lt; $x1; $x++) {&nbsp;</div></li><li><div>                $line = $flip ? $this-&gt;yv[$x] : $this-&gt;xv[$x];&nbsp;</div></li><li><div>                if (empty($ymatches[$line])) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $matches = $ymatches[$line];&nbsp;</div></li><li><div>                reset($matches);&nbsp;</div></li><li><div>                while (list(, $y) = each($matches)) {&nbsp;</div></li><li><div>                    if (empty($this-&gt;in_seq[$y])) {&nbsp;</div></li><li><div>                        $k = $this-&gt;_lcsPos($y);&nbsp;</div></li><li><div>                        assert($k &gt; 0);&nbsp;</div></li><li><div>                        $ymids[$k] = $ymids[$k - 1];&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                while (list(, $y) = each($matches)) {&nbsp;</div></li><li><div>                    if ($y &gt; $this-&gt;seq[$k - 1]) {&nbsp;</div></li><li><div>                        assert($y &lt;= $this-&gt;seq[$k]);&nbsp;</div></li><li><div>                        /** Optimization: this is a common case: next match is&nbsp;</div></li><li><div>                         * just replacing previous match. */&nbsp;</div></li><li><div>                        $this-&gt;in_seq[$this-&gt;seq[$k]] = false;&nbsp;</div></li><li><div>                        $this-&gt;seq[$k] = $y;&nbsp;</div></li><li><div>                        $this-&gt;in_seq[$y] = 1;&nbsp;</div></li><li><div>                    } elseif (empty($this-&gt;in_seq[$y])) {&nbsp;</div></li><li><div>                        $k = $this-&gt;_lcsPos($y);&nbsp;</div></li><li><div>                        assert($k &gt; 0);&nbsp;</div></li><li><div>                        $ymids[$k] = $ymids[$k - 1];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $seps[] = $flip ? array($yoff, $xoff) : array($xoff, $yoff);&nbsp;</div></li><li><div>        $ymid = $ymids[$this-&gt;lcs];&nbsp;</div></li><li><div>        for ($n = 0; $n &lt; $nchunks - 1; $n++) {&nbsp;</div></li><li><div>            $x1 = $xoff + (int)(($numer + ($xlim - $xoff) * $n) / $nchunks);&nbsp;</div></li><li><div>            $y1 = $ymid[$n] + 1;&nbsp;</div></li><li><div>            $seps[] = $flip ? array($y1, $x1) : array($x1, $y1);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seps[] = $flip ? array($ylim, $xlim) : array($xlim, $ylim);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array($this-&gt;lcs, $seps);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _lcsPos($ypos)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $end = $this-&gt;lcs;&nbsp;</div></li><li><div>        if ($end == 0 || $ypos &gt; $this-&gt;seq[$end]) {&nbsp;</div></li><li><div>            $this-&gt;seq[++$this-&gt;lcs] = $ypos;&nbsp;</div></li><li><div>            $this-&gt;in_seq[$ypos] = 1;&nbsp;</div></li><li><div>            return $this-&gt;lcs;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $beg = 1;&nbsp;</div></li><li><div>        while ($beg &lt; $end) {&nbsp;</div></li><li><div>            $mid = (int)(($beg + $end) / 2);&nbsp;</div></li><li><div>            if ($ypos &gt; $this-&gt;seq[$mid]) {&nbsp;</div></li><li><div>                $beg = $mid + 1;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $end = $mid;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        assert($ypos != $this-&gt;seq[$end]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;in_seq[$this-&gt;seq[$end]] = false;&nbsp;</div></li><li><div>        $this-&gt;seq[$end] = $ypos;&nbsp;</div></li><li><div>        $this-&gt;in_seq[$ypos] = 1;&nbsp;</div></li><li><div>        return $end;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Finds LCS of two sequences.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The results are recorded in the vectors $this-&gt;{x, y}changed[], by&nbsp;</div></li><li><div>     * storing a 1 in the element for each line that is an insertion or&nbsp;</div></li><li><div>     * deletion (ie. is not in the LCS).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The subsequence of file 0 is (XOFF, XLIM) and likewise for file 1.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Note that XLIM, YLIM are exclusive bounds.  All line numbers are&nbsp;</div></li><li><div>     * origin-0 and discarded lines are not counted.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _compareseq ($xoff, $xlim, $yoff, $ylim)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        /** Slide down the bottom initial diagonal. */&nbsp;</div></li><li><div>        while ($xoff &lt; $xlim && $yoff &lt; $ylim&nbsp;</div></li><li><div>               && $this-&gt;xv[$xoff] == $this-&gt;yv[$yoff]) {&nbsp;</div></li><li><div>            ++$xoff;&nbsp;</div></li><li><div>            ++$yoff;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Slide up the top initial diagonal. */&nbsp;</div></li><li><div>        while ($xlim &gt; $xoff && $ylim &gt; $yoff&nbsp;</div></li><li><div>               && $this-&gt;xv[$xlim - 1] == $this-&gt;yv[$ylim - 1]) {&nbsp;</div></li><li><div>            --$xlim;&nbsp;</div></li><li><div>            --$ylim;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($xoff == $xlim || $yoff == $ylim) {&nbsp;</div></li><li><div>            $lcs = 0;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** This is ad hoc but seems to work well.  $nchunks =&nbsp;</div></li><li><div>             * sqrt(min($xlim - $xoff, $ylim - $yoff) / 2.5); $nchunks =&nbsp;</div></li><li><div>             * max(2, min(8, (int)$nchunks)); */&nbsp;</div></li><li><div>            $nchunks = min(7, $xlim - $xoff, $ylim - $yoff) + 1;&nbsp;</div></li><li><div>            list($lcs, $seps)&nbsp;</div></li><li><div> = $this-&gt;_diag($xoff, $xlim, $yoff, $ylim, $nchunks);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($lcs == 0) {&nbsp;</div></li><li><div>            /** X and Y sequences have no common subsequence: mark all&nbsp;</div></li><li><div>             * changed. */&nbsp;</div></li><li><div>            while ($yoff &lt; $ylim) {&nbsp;</div></li><li><div>                $this-&gt;ychanged[$this-&gt;yind[$yoff++]] = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            while ($xoff &lt; $xlim) {&nbsp;</div></li><li><div>                $this-&gt;xchanged[$this-&gt;xind[$xoff++]] = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** Use the partitions to split this problem into subproblems. */&nbsp;</div></li><li><div>            reset($seps);&nbsp;</div></li><li><div>            $pt1 = $seps[0];&nbsp;</div></li><li><div>            while ($pt2 = next($seps)) {&nbsp;</div></li><li><div>                $this-&gt;_compareseq ($pt1[0], $pt2[0], $pt1[1], $pt2[1]);&nbsp;</div></li><li><div>                $pt1 = $pt2;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adjusts inserts/deletes of identical lines to join changes as much as&nbsp;</div></li><li><div>     * possible.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * We do something when a run of changed lines include a line at one end&nbsp;</div></li><li><div>     * and has an excluded, identical line at the other.  We are free to&nbsp;</div></li><li><div>     * choose which identical line is included.  `compareseq' usually chooses&nbsp;</div></li><li><div>     * the one at the beginning, but usually it is cleaner to consider the&nbsp;</div></li><li><div>     * following identical line to be the &quot;change&quot;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This is extracted verbatim from analyze.c (GNU diffutils-2.7).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _shiftBoundaries($lines, &$changed, $other_changed)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $i = 0;&nbsp;</div></li><li><div>        $j = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        assert('count($lines) == count($changed)');&nbsp;</div></li><li><div>        $len = count($lines);&nbsp;</div></li><li><div>        $other_len = count($other_changed);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (1) {&nbsp;</div></li><li><div>            /** Scan forward to find the beginning of another run of&nbsp;</div></li><li><div>             * changes. Also keep track of the corresponding point in the&nbsp;</div></li><li><div>             * other file.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * Throughout this code, $i and $j are adjusted together so that&nbsp;</div></li><li><div>             * the first $i elements of $changed and the first $j elements of&nbsp;</div></li><li><div>             * $other_changed both contain the same number of zeros (unchanged&nbsp;</div></li><li><div>             * lines).&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * Furthermore, $j is always kept so that $j == $other_len or&nbsp;</div></li><li><div>             * $other_changed[$j] == false. */&nbsp;</div></li><li><div>            while ($j &lt; $other_len && $other_changed[$j]) {&nbsp;</div></li><li><div>                $j++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            while ($i &lt; $len && ! $changed[$i]) {&nbsp;</div></li><li><div>                assert('$j &lt; $other_len && ! $other_changed[$j]');&nbsp;</div></li><li><div>                $i++; $j++;&nbsp;</div></li><li><div>                while ($j &lt; $other_len && $other_changed[$j]) {&nbsp;</div></li><li><div>                    $j++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($i == $len) {&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $start = $i;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /** Find the end of this run of changes. */&nbsp;</div></li><li><div>            while (++$i &lt; $len && $changed[$i]) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            do {&nbsp;</div></li><li><div>                /** Record the length of this run of changes, so that we can&nbsp;</div></li><li><div>                 * later determine whether the run has grown. */&nbsp;</div></li><li><div>                $runlength = $i - $start;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Move the changed region back, so long as the previous&nbsp;</div></li><li><div>                 * unchanged line matches the last changed one.  This merges&nbsp;</div></li><li><div>                 * with previous changed regions. */&nbsp;</div></li><li><div>                while ($start &gt; 0 && $lines[$start - 1] == $lines[$i - 1]) {&nbsp;</div></li><li><div>                    $changed[--$start] = 1;&nbsp;</div></li><li><div>                    $changed[--$i] = false;&nbsp;</div></li><li><div>                    while ($start &gt; 0 && $changed[$start - 1]) {&nbsp;</div></li><li><div>                        $start--;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    assert('$j &gt; 0');&nbsp;</div></li><li><div>                    while ($other_changed[--$j]) {&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    assert('$j &gt;= 0 && !$other_changed[$j]');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Set CORRESPONDING to the end of the changed run, at the&nbsp;</div></li><li><div>                 * last point where it corresponds to a changed run in the&nbsp;</div></li><li><div>                 * other file. CORRESPONDING == LEN means no such point has&nbsp;</div></li><li><div>                 * been found. */&nbsp;</div></li><li><div>                $corresponding = $j &lt; $other_len ? $i : $len;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Move the changed region forward, so long as the first&nbsp;</div></li><li><div>                 * changed line matches the following unchanged one.  This&nbsp;</div></li><li><div>                 * merges with following changed regions.  Do this second, so&nbsp;</div></li><li><div>                 * that if there are no merges, the changed region is moved&nbsp;</div></li><li><div>                 * forward as far as possible. */&nbsp;</div></li><li><div>                while ($i &lt; $len && $lines[$start] == $lines[$i]) {&nbsp;</div></li><li><div>                    $changed[$start++] = false;&nbsp;</div></li><li><div>                    $changed[$i++] = 1;&nbsp;</div></li><li><div>                    while ($i &lt; $len && $changed[$i]) {&nbsp;</div></li><li><div>                        $i++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    assert('$j &lt; $other_len && ! $other_changed[$j]');&nbsp;</div></li><li><div>                    $j++;&nbsp;</div></li><li><div>                    if ($j &lt; $other_len && $other_changed[$j]) {&nbsp;</div></li><li><div>                        $corresponding = $i;&nbsp;</div></li><li><div>                        while ($j &lt; $other_len && $other_changed[$j]) {&nbsp;</div></li><li><div>                            $j++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } while ($runlength != $i - $start);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /** If possible, move the fully-merged run of changes back to a&nbsp;</div></li><li><div>             * corresponding run in the other file. */&nbsp;</div></li><li><div>            while ($corresponding &lt; $i) {&nbsp;</div></li><li><div>                $changed[--$start] = 1;&nbsp;</div></li><li><div>                $changed[--$i] = 0;&nbsp;</div></li><li><div>                assert('$j &gt; 0');&nbsp;</div></li><li><div>                while ($other_changed[--$j]) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                assert('$j &gt;= 0 && !$other_changed[$j]');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.7</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/text_diff_engine_native/" class="">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/text_diff_engine_native/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/text_diff_engine_native/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/text_diff_engine_native/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/text_diff_engine_native/" class="active">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>Text_Diff_Engine_native</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>