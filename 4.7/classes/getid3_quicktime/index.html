<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-version="4.7" data-type="class" data-id="1325"><head xmlns="http://www.w3.org/1999/xhtml"><title> getid3_quicktime | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="getid3_quicktime, class, wordpress, 4.7" /><meta name="description" content="The WordPress Core getid3 quicktime class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=7a02c030a6e476eaa3a9967827c53a5d' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/getid3_quicktime/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgetid3_quicktime%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgetid3_quicktime%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7-class-getid3_quicktime","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="getid3_quicktime" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7." href="http://hookr.io/4.7/" class="H_VERSION"><span property="name">4.7</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">getid3_quicktime</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6307"><a href="http://hookr.io/4.7/all/" title="All">All <span class="count badge">6307</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2851"><a href="http://hookr.io/4.7/functions/" title="Functions">Functions <span class="count badge">2851</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>getid3_quicktime</strong></h1><p>The WordPress Core <strong>getid3 quicktime</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7/files/wp-includes-id3-module-audio-video-quicktime/" class="file">/wp-includes/ID3/module.audio-video.quicktime.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="21" class="block" start="21"><li><div>class getid3_quicktime extends getid3_handler&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public $ReturnAtomData = true;&nbsp;</div></li><li><div>    public $ParseAllPossibleAtoms = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function Analyze() {&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info['fileformat'] = 'quicktime';&nbsp;</div></li><li><div>        $info['quicktime']['hinting'] = false;&nbsp;</div></li><li><div>        $info['quicktime']['controller'] = 'standard'; // may be overridden if 'ctyp' atom is present&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;fseek($info['avdataoffset']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $offset = 0;&nbsp;</div></li><li><div>        $atomcounter = 0;&nbsp;</div></li><li><div>        $atom_data_read_buffer_size = ($info['php_memory_limit'] ? round($info['php_memory_limit'] / 2) : $this-&gt;getid3-&gt;option_fread_buffer_size * 1024); // allow [default: 32MB] if PHP configured with no memory_limit&nbsp;</div></li><li><div>        while ($offset &lt; $info['avdataend']) {&nbsp;</div></li><li><div>            if (!getid3_lib::intValueSupported($offset)) {&nbsp;</div></li><li><div>                $info['error'][] = 'Unable to parse atom at offset '.$offset.' because beyond '.round(PHP_INT_MAX / 1073741824).'GB limit of PHP filesystem functions';&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;fseek($offset);&nbsp;</div></li><li><div>            $AtomHeader = $this-&gt;fread(8);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $atomsize = getid3_lib::BigEndian2Int(substr($AtomHeader, 0, 4));&nbsp;</div></li><li><div>            $atomname = substr($AtomHeader, 4, 4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // 64-bit MOV patch by jlegatektnc*com&nbsp;</div></li><li><div>            if ($atomsize == 1) {&nbsp;</div></li><li><div>                $atomsize = getid3_lib::BigEndian2Int($this-&gt;fread(8));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info['quicktime'][$atomname]['name'] = $atomname;&nbsp;</div></li><li><div>            $info['quicktime'][$atomname]['size'] = $atomsize;&nbsp;</div></li><li><div>            $info['quicktime'][$atomname]['offset'] = $offset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (($offset + $atomsize) &gt; $info['avdataend']) {&nbsp;</div></li><li><div>                $info['error'][] = 'Atom at offset '.$offset.' claims to go beyond end-of-file (length: '.$atomsize.' bytes)';&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($atomsize == 0) {&nbsp;</div></li><li><div>                // Furthermore, for historical reasons the list of atoms is optionally&nbsp;</div></li><li><div>                // terminated by a 32-bit integer set to 0. If you are writing a program&nbsp;</div></li><li><div>                // to read user data atoms, you should allow for the terminating 0.&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $atomHierarchy = array();&nbsp;</div></li><li><div>            $info['quicktime'][$atomname] = $this-&gt;QuicktimeParseAtom($atomname, $atomsize, $this-&gt;fread(min($atomsize, $atom_data_read_buffer_size)), $offset, $atomHierarchy, $this-&gt;ParseAllPossibleAtoms);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $offset += $atomsize;&nbsp;</div></li><li><div>            $atomcounter++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($info['avdataend_tmp'])) {&nbsp;</div></li><li><div>            // this value is assigned to a temp value and then erased because&nbsp;</div></li><li><div>            // otherwise any atoms beyond the 'mdat' atom would not get parsed&nbsp;</div></li><li><div>            $info['avdataend'] = $info['avdataend_tmp'];&nbsp;</div></li><li><div>            unset($info['avdataend_tmp']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!isset($info['bitrate']) && isset($info['playtime_seconds'])) {&nbsp;</div></li><li><div>            $info['bitrate'] = (($info['avdataend'] - $info['avdataoffset']) * 8) / $info['playtime_seconds'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($info['bitrate']) && !isset($info['audio']['bitrate']) && !isset($info['quicktime']['video'])) {&nbsp;</div></li><li><div>            $info['audio']['bitrate'] = $info['bitrate'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!empty($info['playtime_seconds']) && !isset($info['video']['frame_rate']) && !empty($info['quicktime']['stts_framecount'])) {&nbsp;</div></li><li><div>            foreach ($info['quicktime']['stts_framecount'] as $key =&gt; $samples_count) {&nbsp;</div></li><li><div>                $samples_per_second = $samples_count / $info['playtime_seconds'];&nbsp;</div></li><li><div>                if ($samples_per_second &gt; 240) {&nbsp;</div></li><li><div>                    // has to be audio samples&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $info['video']['frame_rate'] = $samples_per_second;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (($info['audio']['dataformat'] == 'mp4') && empty($info['video']['resolution_x'])) {&nbsp;</div></li><li><div>            $info['fileformat'] = 'mp4';&nbsp;</div></li><li><div>            $info['mime_type'] = 'audio/mp4';&nbsp;</div></li><li><div>            unset($info['video']['dataformat']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$this-&gt;ReturnAtomData) {&nbsp;</div></li><li><div>            unset($info['quicktime']['moov']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (empty($info['audio']['dataformat']) && !empty($info['quicktime']['audio'])) {&nbsp;</div></li><li><div>            $info['audio']['dataformat'] = 'quicktime';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (empty($info['video']['dataformat']) && !empty($info['quicktime']['video'])) {&nbsp;</div></li><li><div>            $info['video']['dataformat'] = 'quicktime';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeParseAtom($atomname, $atomsize, $atom_data, $baseoffset, &$atomHierarchy, $ParseAllPossibleAtoms) {&nbsp;</div></li><li><div>        // http://developer.apple.com/techpubs/quicktime/qtdevdocs/APIREF/INDEX/atomalphaindex.htm&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $atom_parent = end($atomHierarchy); // not array_pop($atomHierarchy); see http://www.getid3.org/phpBB3/viewtopic.php?t=1717&nbsp;</div></li><li><div>        array_push($atomHierarchy, $atomname);&nbsp;</div></li><li><div>        $atom_structure['hierarchy'] = implode(' ', $atomHierarchy);&nbsp;</div></li><li><div>        $atom_structure['name'] = $atomname;&nbsp;</div></li><li><div>        $atom_structure['size'] = $atomsize;&nbsp;</div></li><li><div>        $atom_structure['offset'] = $baseoffset;&nbsp;</div></li><li><div>        switch ($atomname) {&nbsp;</div></li><li><div>            case 'moov': // MOVie container atom&nbsp;</div></li><li><div>            case 'trak': // TRAcK container atom&nbsp;</div></li><li><div>            case 'clip': // CLIPping container atom&nbsp;</div></li><li><div>            case 'matt': // track MATTe container atom&nbsp;</div></li><li><div>            case 'edts': // EDiTS container atom&nbsp;</div></li><li><div>            case 'tref': // Track REFerence container atom&nbsp;</div></li><li><div>            case 'mdia': // MeDIA container atom&nbsp;</div></li><li><div>            case 'minf': // Media INFormation container atom&nbsp;</div></li><li><div>            case 'dinf': // Data INFormation container atom&nbsp;</div></li><li><div>            case 'udta': // User DaTA container atom&nbsp;</div></li><li><div>            case 'cmov': // Compressed MOVie container atom&nbsp;</div></li><li><div>            case 'rmra': // Reference Movie Record Atom&nbsp;</div></li><li><div>            case 'rmda': // Reference Movie Descriptor Atom&nbsp;</div></li><li><div>            case 'gmhd': // Generic Media info HeaDer atom (seen on QTVR)&nbsp;</div></li><li><div>                $atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($atom_data, $baseoffset + 8, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'ilst': // Item LiST container atom&nbsp;</div></li><li><div>                if ($atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($atom_data, $baseoffset + 8, $atomHierarchy, $ParseAllPossibleAtoms)) {&nbsp;</div></li><li><div>                    // some &quot;ilst&quot; atoms contain data atoms that have a numeric name, and the data is far more accessible if the returned array is compacted&nbsp;</div></li><li><div>                    $allnumericnames = true;&nbsp;</div></li><li><div>                    foreach ($atom_structure['subatoms'] as $subatomarray) {&nbsp;</div></li><li><div>                        if (!is_integer($subatomarray['name']) || (count($subatomarray['subatoms']) != 1)) {&nbsp;</div></li><li><div>                            $allnumericnames = false;&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ($allnumericnames) {&nbsp;</div></li><li><div>                        $newData = array();&nbsp;</div></li><li><div>                        foreach ($atom_structure['subatoms'] as $subatomarray) {&nbsp;</div></li><li><div>                            foreach ($subatomarray['subatoms'] as $newData_subatomarray) {&nbsp;</div></li><li><div>                                unset($newData_subatomarray['hierarchy'], $newData_subatomarray['name']);&nbsp;</div></li><li><div>                                $newData[$subatomarray['name']] = $newData_subatomarray;&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $atom_structure['data'] = $newData;&nbsp;</div></li><li><div>                        unset($atom_structure['subatoms']);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case &quot;\x00\x00\x00\x01&quot;:&nbsp;</div></li><li><div>            case &quot;\x00\x00\x00\x02&quot;:&nbsp;</div></li><li><div>            case &quot;\x00\x00\x00\x03&quot;:&nbsp;</div></li><li><div>            case &quot;\x00\x00\x00\x04&quot;:&nbsp;</div></li><li><div>            case &quot;\x00\x00\x00\x05&quot;:&nbsp;</div></li><li><div>                $atomname = getid3_lib::BigEndian2Int($atomname);&nbsp;</div></li><li><div>                $atom_structure['name'] = $atomname;&nbsp;</div></li><li><div>                $atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($atom_data, $baseoffset + 8, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stbl': // Sample TaBLe container atom&nbsp;</div></li><li><div>                $atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($atom_data, $baseoffset + 8, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>                $isVideo = false;&nbsp;</div></li><li><div>                $framerate = 0;&nbsp;</div></li><li><div>                $framecount = 0;&nbsp;</div></li><li><div>                foreach ($atom_structure['subatoms'] as $key =&gt; $value_array) {&nbsp;</div></li><li><div>                    if (isset($value_array['sample_description_table'])) {&nbsp;</div></li><li><div>                        foreach ($value_array['sample_description_table'] as $key2 =&gt; $value_array2) {&nbsp;</div></li><li><div>                            if (isset($value_array2['data_format'])) {&nbsp;</div></li><li><div>                                switch ($value_array2['data_format']) {&nbsp;</div></li><li><div>                                    case 'avc1':&nbsp;</div></li><li><div>                                    case 'mp4v':&nbsp;</div></li><li><div>                                        // video data&nbsp;</div></li><li><div>                                        $isVideo = true;&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    case 'mp4a':&nbsp;</div></li><li><div>                                        // audio data&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } elseif (isset($value_array['time_to_sample_table'])) {&nbsp;</div></li><li><div>                        foreach ($value_array['time_to_sample_table'] as $key2 =&gt; $value_array2) {&nbsp;</div></li><li><div>                            if (isset($value_array2['sample_count']) && isset($value_array2['sample_duration']) && ($value_array2['sample_duration'] &gt; 0)) {&nbsp;</div></li><li><div>                                $framerate = round($info['quicktime']['time_scale'] / $value_array2['sample_duration'], 3);&nbsp;</div></li><li><div>                                $framecount = $value_array2['sample_count'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($isVideo && $framerate) {&nbsp;</div></li><li><div>                    $info['quicktime']['video']['frame_rate'] = $framerate;&nbsp;</div></li><li><div>                    $info['video']['frame_rate'] = $info['quicktime']['video']['frame_rate'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($isVideo && $framecount) {&nbsp;</div></li><li><div>                    $info['quicktime']['video']['frame_count'] = $framecount;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'aART': // Album ARTist&nbsp;</div></li><li><div>            case 'catg': // CaTeGory&nbsp;</div></li><li><div>            case 'covr': // COVeR artwork&nbsp;</div></li><li><div>            case 'cpil': // ComPILation&nbsp;</div></li><li><div>            case 'cprt': // CoPyRighT&nbsp;</div></li><li><div>            case 'desc': // DESCription&nbsp;</div></li><li><div>            case 'disk': // DISK number&nbsp;</div></li><li><div>            case 'egid': // Episode Global ID&nbsp;</div></li><li><div>            case 'gnre': // GeNRE&nbsp;</div></li><li><div>            case 'keyw': // KEYWord&nbsp;</div></li><li><div>            case 'ldes':&nbsp;</div></li><li><div>            case 'pcst': // PodCaST&nbsp;</div></li><li><div>            case 'pgap': // GAPless Playback&nbsp;</div></li><li><div>            case 'purd': // PURchase Date&nbsp;</div></li><li><div>            case 'purl': // Podcast URL&nbsp;</div></li><li><div>            case 'rati':&nbsp;</div></li><li><div>            case 'rndu':&nbsp;</div></li><li><div>            case 'rpdu':&nbsp;</div></li><li><div>            case 'rtng': // RaTiNG&nbsp;</div></li><li><div>            case 'stik':&nbsp;</div></li><li><div>            case 'tmpo': // TeMPO (BPM)&nbsp;</div></li><li><div>            case 'trkn': // TRacK Number&nbsp;</div></li><li><div>            case 'tves': // TV EpiSode&nbsp;</div></li><li><div>            case 'tvnn': // TV Network Name&nbsp;</div></li><li><div>            case 'tvsh': // TV SHow Name&nbsp;</div></li><li><div>            case 'tvsn': // TV SeasoN&nbsp;</div></li><li><div>            case 'akID': // iTunes store account type&nbsp;</div></li><li><div>            case 'apID':&nbsp;</div></li><li><div>            case 'atID':&nbsp;</div></li><li><div>            case 'cmID':&nbsp;</div></li><li><div>            case 'cnID':&nbsp;</div></li><li><div>            case 'geID':&nbsp;</div></li><li><div>            case 'plID':&nbsp;</div></li><li><div>            case 'sfID': // iTunes store country&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'alb': // ALBum&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'art': // ARTist&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ART':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'aut':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'cmt': // CoMmenT&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'com': // COMposer&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'cpy':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'day': // content created year&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'dir':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed1':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed2':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed3':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed4':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed5':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed6':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed7':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed8':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ed9':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'enc':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'fmt':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'gen': // GENre&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'grp': // GRouPing&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'hst':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'inf':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'lyr': // LYRics&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'mak':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'mod':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'nam': // full NAMe&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'ope':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'PRD':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'prd':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'prf':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'req':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'src':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'swr':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'too': // encoder&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'trk': // TRacK&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'url':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'wrn':&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'wrt': // WRiTer&nbsp;</div></li><li><div>            case '----': // itunes specific&nbsp;</div></li><li><div>                if ($atom_parent == 'udta') {&nbsp;</div></li><li><div>                    // User data atom handler&nbsp;</div></li><li><div>                    $atom_structure['data_length'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 2));&nbsp;</div></li><li><div>                    $atom_structure['language_id'] = getid3_lib::BigEndian2Int(substr($atom_data, 2, 2));&nbsp;</div></li><li><div>                    $atom_structure['data'] =                           substr($atom_data, 4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $atom_structure['language'] = $this-&gt;QuicktimeLanguageLookup($atom_structure['language_id']);&nbsp;</div></li><li><div>                    if (empty($info['comments']['language']) || (!in_array($atom_structure['language'], $info['comments']['language']))) {&nbsp;</div></li><li><div>                        $info['comments']['language'][] = $atom_structure['language'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // Apple item list box atom handler&nbsp;</div></li><li><div>                    $atomoffset = 0;&nbsp;</div></li><li><div>                    if (substr($atom_data, 2, 2) == &quot;\x10\xB5&quot;) {&nbsp;</div></li><li><div>                        // not sure what it means, but observed on iPhone4 data.&nbsp;</div></li><li><div>                        // Each $atom_data has 2 bytes of datasize, plus 0x10B5, then data&nbsp;</div></li><li><div>                        while ($atomoffset &lt; strlen($atom_data)) {&nbsp;</div></li><li><div>                            $boxsmallsize = getid3_lib::BigEndian2Int(substr($atom_data, $atomoffset, 2));&nbsp;</div></li><li><div>                            $boxsmalltype =                           substr($atom_data, $atomoffset + 2, 2);&nbsp;</div></li><li><div>                            $boxsmalldata =                           substr($atom_data, $atomoffset + 4, $boxsmallsize);&nbsp;</div></li><li><div>                            if ($boxsmallsize &lt;= 1) {&nbsp;</div></li><li><div>                                $info['warning'][] = 'Invalid QuickTime atom smallbox size &quot;'.$boxsmallsize.'&quot; in atom &quot;'.preg_replace('#[^a-zA-Z0-9 _\\-]#', '?', $atomname).'&quot; at offset: '.($atom_structure['offset'] + $atomoffset);&nbsp;</div></li><li><div>                                $atom_structure['data'] = null;&nbsp;</div></li><li><div>                                $atomoffset = strlen($atom_data);&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            switch ($boxsmalltype) {&nbsp;</div></li><li><div>                                case &quot;\x10\xB5&quot;:&nbsp;</div></li><li><div>                                    $atom_structure['data'] = $boxsmalldata;&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>                                default:&nbsp;</div></li><li><div>                                    $info['warning'][] = 'Unknown QuickTime smallbox type: &quot;'.preg_replace('#[^a-zA-Z0-9 _\\-]#', '?', $boxsmalltype).'&quot; ('.trim(getid3_lib::PrintHexBytes($boxsmalltype)).') at offset '.$baseoffset;&nbsp;</div></li><li><div>                                    $atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $atomoffset += (4 + $boxsmallsize);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        while ($atomoffset &lt; strlen($atom_data)) {&nbsp;</div></li><li><div>                            $boxsize = getid3_lib::BigEndian2Int(substr($atom_data, $atomoffset, 4));&nbsp;</div></li><li><div>                            $boxtype =                           substr($atom_data, $atomoffset + 4, 4);&nbsp;</div></li><li><div>                            $boxdata =                           substr($atom_data, $atomoffset + 8, $boxsize - 8);&nbsp;</div></li><li><div>                            if ($boxsize &lt;= 1) {&nbsp;</div></li><li><div>                                $info['warning'][] = 'Invalid QuickTime atom box size &quot;'.$boxsize.'&quot; in atom &quot;'.preg_replace('#[^a-zA-Z0-9 _\\-]#', '?', $atomname).'&quot; at offset: '.($atom_structure['offset'] + $atomoffset);&nbsp;</div></li><li><div>                                $atom_structure['data'] = null;&nbsp;</div></li><li><div>                                $atomoffset = strlen($atom_data);&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $atomoffset += $boxsize;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            switch ($boxtype) {&nbsp;</div></li><li><div>                                case 'mean':&nbsp;</div></li><li><div>                                case 'name':&nbsp;</div></li><li><div>                                    $atom_structure[$boxtype] = substr($boxdata, 4);&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                case 'data':&nbsp;</div></li><li><div>                                    $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($boxdata, 0, 1));&nbsp;</div></li><li><div>                                    $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($boxdata, 1, 3));&nbsp;</div></li><li><div>                                    switch ($atom_structure['flags_raw']) {&nbsp;</div></li><li><div>                                        case  0: // data flag&nbsp;</div></li><li><div>                                        case 21: // tmpo/cpil flag&nbsp;</div></li><li><div>                                            switch ($atomname) {&nbsp;</div></li><li><div>                                                case 'cpil':&nbsp;</div></li><li><div>                                                case 'pcst':&nbsp;</div></li><li><div>                                                case 'pgap':&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = getid3_lib::BigEndian2Int(substr($boxdata, 8, 1));&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                case 'tmpo':&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = getid3_lib::BigEndian2Int(substr($boxdata, 8, 2));&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                case 'disk':&nbsp;</div></li><li><div>                                                case 'trkn':&nbsp;</div></li><li><div>                                                    $num = getid3_lib::BigEndian2Int(substr($boxdata, 10, 2));&nbsp;</div></li><li><div>                                                    $num_total = getid3_lib::BigEndian2Int(substr($boxdata, 12, 2));&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = empty($num) ? '' : $num;&nbsp;</div></li><li><div>                                                    $atom_structure['data'] .= empty($num_total) ? '' : '/'.$num_total;&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                case 'gnre':&nbsp;</div></li><li><div>                                                    $GenreID = getid3_lib::BigEndian2Int(substr($boxdata, 8, 4));&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = getid3_id3v1::LookupGenreName($GenreID - 1);&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                case 'rtng':&nbsp;</div></li><li><div>                                                    $atom_structure[$atomname] = getid3_lib::BigEndian2Int(substr($boxdata, 8, 1));&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = $this-&gt;QuicktimeContentRatingLookup($atom_structure[$atomname]);&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                case 'stik':&nbsp;</div></li><li><div>                                                    $atom_structure[$atomname] = getid3_lib::BigEndian2Int(substr($boxdata, 8, 1));&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = $this-&gt;QuicktimeSTIKLookup($atom_structure[$atomname]);&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                case 'sfID':&nbsp;</div></li><li><div>                                                    $atom_structure[$atomname] = getid3_lib::BigEndian2Int(substr($boxdata, 8, 4));&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = $this-&gt;QuicktimeStoreFrontCodeLookup($atom_structure[$atomname]);&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                case 'egid':&nbsp;</div></li><li><div>                                                case 'purl':&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = substr($boxdata, 8);&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                default:&nbsp;</div></li><li><div>                                                    $atom_structure['data'] = getid3_lib::BigEndian2Int(substr($boxdata, 8, 4));&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        case  1: // text flag&nbsp;</div></li><li><div>                                        case 13: // image flag&nbsp;</div></li><li><div>                                        default:&nbsp;</div></li><li><div>                                            $atom_structure['data'] = substr($boxdata, 8);&nbsp;</div></li><li><div>                                            if ($atomname == 'covr') {&nbsp;</div></li><li><div>                                                // not a foolproof check, but better than nothing&nbsp;</div></li><li><div>                                                if (preg_match('#^\xFF\xD8\xFF#', $atom_structure['data'])) {&nbsp;</div></li><li><div>                                                    $atom_structure['image_mime'] = 'image/jpeg';&nbsp;</div></li><li><div>                                                } elseif (preg_match('#^\x89\x50\x4E\x47\x0D\x0A\x1A\x0A#', $atom_structure['data'])) {&nbsp;</div></li><li><div>                                                    $atom_structure['image_mime'] = 'image/png';&nbsp;</div></li><li><div>                                                } elseif (preg_match('#^GIF#', $atom_structure['data'])) {&nbsp;</div></li><li><div>                                                    $atom_structure['image_mime'] = 'image/gif';&nbsp;</div></li><li><div>                                                }&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                default:&nbsp;</div></li><li><div>                                    $info['warning'][] = 'Unknown QuickTime box type: &quot;'.preg_replace('#[^a-zA-Z0-9 _\\-]#', '?', $boxtype).'&quot; ('.trim(getid3_lib::PrintHexBytes($boxtype)).') at offset '.$baseoffset;&nbsp;</div></li><li><div>                                    $atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;CopyToAppropriateCommentsSection($atomname, $atom_structure['data'], $atom_structure['name']);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'play': // auto-PLAY atom&nbsp;</div></li><li><div>                $atom_structure['autoplay'] = (bool) getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info['quicktime']['autoplay'] = $atom_structure['autoplay'];&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'WLOC': // Window LOCation atom&nbsp;</div></li><li><div>                $atom_structure['location_x'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 2));&nbsp;</div></li><li><div>                $atom_structure['location_y'] = getid3_lib::BigEndian2Int(substr($atom_data, 2, 2));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'LOOP': // LOOPing atom&nbsp;</div></li><li><div>            case 'SelO': // play SELection Only atom&nbsp;</div></li><li><div>            case 'AllF': // play ALL Frames atom&nbsp;</div></li><li><div>                $atom_structure['data'] = getid3_lib::BigEndian2Int($atom_data);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'name': //&nbsp;</div></li><li><div>            case 'MCPS': // Media Cleaner PRo&nbsp;</div></li><li><div>            case '@PRM': // adobe PReMiere version&nbsp;</div></li><li><div>            case '@PRQ': // adobe PRemiere Quicktime version&nbsp;</div></li><li><div>                $atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'cmvd': // Compressed MooV Data atom&nbsp;</div></li><li><div>                // Code by ubergeekubergeek*tv based on information from&nbsp;</div></li><li><div>                // http://developer.apple.com/quicktime/icefloe/dispatch012.html&nbsp;</div></li><li><div>                $atom_structure['unCompressedSize'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 4));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $CompressedFileData = substr($atom_data, 4);&nbsp;</div></li><li><div>                if ($UncompressedHeader = @gzuncompress($CompressedFileData)) {&nbsp;</div></li><li><div>                    $atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($UncompressedHeader, 0, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $info['warning'][] = 'Error decompressing compressed MOV atom at offset '.$atom_structure['offset'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'dcom': // Data COMpression atom&nbsp;</div></li><li><div>                $atom_structure['compression_id'] = $atom_data;&nbsp;</div></li><li><div>                $atom_structure['compression_text'] = $this-&gt;QuicktimeDCOMLookup($atom_data);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rdrf': // Reference movie Data ReFerence atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3));&nbsp;</div></li><li><div>                $atom_structure['flags']['internal_data'] = (bool) ($atom_structure['flags_raw'] & 0x000001);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['reference_type_name'] =                           substr($atom_data, 4, 4);&nbsp;</div></li><li><div>                $atom_structure['reference_length'] = getid3_lib::BigEndian2Int(substr($atom_data, 8, 4));&nbsp;</div></li><li><div>                switch ($atom_structure['reference_type_name']) {&nbsp;</div></li><li><div>                    case 'url ':&nbsp;</div></li><li><div>                        $atom_structure['url'] =       $this-&gt;NoNullString(substr($atom_data, 12));&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'alis':&nbsp;</div></li><li><div>                        $atom_structure['file_alias'] =                           substr($atom_data, 12);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    case 'rsrc':&nbsp;</div></li><li><div>                        $atom_structure['resource_alias'] =                           substr($atom_data, 12);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $atom_structure['data'] =                           substr($atom_data, 12);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rmqu': // Reference Movie QUality atom&nbsp;</div></li><li><div>                $atom_structure['movie_quality'] = getid3_lib::BigEndian2Int($atom_data);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rmcs': // Reference Movie Cpu Speed atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['cpu_speed_rating'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rmvc': // Reference Movie Version Check atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['gestalt_selector'] =                           substr($atom_data, 4, 4);&nbsp;</div></li><li><div>                $atom_structure['gestalt_value_mask'] = getid3_lib::BigEndian2Int(substr($atom_data, 8, 4));&nbsp;</div></li><li><div>                $atom_structure['gestalt_value'] = getid3_lib::BigEndian2Int(substr($atom_data, 12, 4));&nbsp;</div></li><li><div>                $atom_structure['gestalt_check_type'] = getid3_lib::BigEndian2Int(substr($atom_data, 14, 2));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rmcd': // Reference Movie Component check atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['component_type'] =                           substr($atom_data, 4, 4);&nbsp;</div></li><li><div>                $atom_structure['component_subtype'] =                           substr($atom_data, 8, 4);&nbsp;</div></li><li><div>                $atom_structure['component_manufacturer'] =                           substr($atom_data, 12, 4);&nbsp;</div></li><li><div>                $atom_structure['component_flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 16, 4));&nbsp;</div></li><li><div>                $atom_structure['component_flags_mask'] = getid3_lib::BigEndian2Int(substr($atom_data, 20, 4));&nbsp;</div></li><li><div>                $atom_structure['component_min_version'] = getid3_lib::BigEndian2Int(substr($atom_data, 24, 4));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rmdr': // Reference Movie Data Rate atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['data_rate'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['data_rate_bps'] = $atom_structure['data_rate'] * 10;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rmla': // Reference Movie Language Atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['language_id'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['language'] = $this-&gt;QuicktimeLanguageLookup($atom_structure['language_id']);&nbsp;</div></li><li><div>                if (empty($info['comments']['language']) || (!in_array($atom_structure['language'], $info['comments']['language']))) {&nbsp;</div></li><li><div>                    $info['comments']['language'][] = $atom_structure['language'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'rmla': // Reference Movie Language Atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['track_id'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'ptv ': // Print To Video - defines a movie's full screen mode&nbsp;</div></li><li><div>                // http://developer.apple.com/documentation/QuickTime/APIREF/SOURCESIV/at_ptv-_pg.htm&nbsp;</div></li><li><div>                $atom_structure['display_size_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 2));&nbsp;</div></li><li><div>                $atom_structure['reserved_1'] = getid3_lib::BigEndian2Int(substr($atom_data, 2, 2)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['reserved_2'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['slide_show_flag'] = getid3_lib::BigEndian2Int(substr($atom_data, 6, 1));&nbsp;</div></li><li><div>                $atom_structure['play_on_open_flag'] = getid3_lib::BigEndian2Int(substr($atom_data, 7, 1));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['flags']['play_on_open'] = (bool) $atom_structure['play_on_open_flag'];&nbsp;</div></li><li><div>                $atom_structure['flags']['slide_show'] = (bool) $atom_structure['slide_show_flag'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $ptv_lookup[0] = 'normal';&nbsp;</div></li><li><div>                $ptv_lookup[1] = 'double';&nbsp;</div></li><li><div>                $ptv_lookup[2] = 'half';&nbsp;</div></li><li><div>                $ptv_lookup[3] = 'full';&nbsp;</div></li><li><div>                $ptv_lookup[4] = 'current';&nbsp;</div></li><li><div>                if (isset($ptv_lookup[$atom_structure['display_size_raw']])) {&nbsp;</div></li><li><div>                    $atom_structure['display_size'] = $ptv_lookup[$atom_structure['display_size_raw']];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $info['warning'][] = 'unknown &quot;ptv &quot; display constant ('.$atom_structure['display_size_raw'].')';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stsd': // Sample Table Sample Description atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $stsdEntriesDataOffset = 8;&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++) {&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['size'] = getid3_lib::BigEndian2Int(substr($atom_data, $stsdEntriesDataOffset, 4));&nbsp;</div></li><li><div>                    $stsdEntriesDataOffset += 4;&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['data_format'] =                           substr($atom_data, $stsdEntriesDataOffset, 4);&nbsp;</div></li><li><div>                    $stsdEntriesDataOffset += 4;&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['reserved'] = getid3_lib::BigEndian2Int(substr($atom_data, $stsdEntriesDataOffset, 6));&nbsp;</div></li><li><div>                    $stsdEntriesDataOffset += 6;&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['reference_index'] = getid3_lib::BigEndian2Int(substr($atom_data, $stsdEntriesDataOffset, 2));&nbsp;</div></li><li><div>                    $stsdEntriesDataOffset += 2;&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['data'] =                           substr($atom_data, $stsdEntriesDataOffset, ($atom_structure['sample_description_table'][$i]['size'] - 4 - 4 - 6 - 2));&nbsp;</div></li><li><div>                    $stsdEntriesDataOffset += ($atom_structure['sample_description_table'][$i]['size'] - 4 - 4 - 6 - 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['encoder_version'] = getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 0, 2));&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['encoder_revision'] = getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 2, 2));&nbsp;</div></li><li><div>                    $atom_structure['sample_description_table'][$i]['encoder_vendor'] =                           substr($atom_structure['sample_description_table'][$i]['data'], 4, 4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    switch ($atom_structure['sample_description_table'][$i]['encoder_vendor']) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        case &quot;\x00\x00\x00\x00&quot;:&nbsp;</div></li><li><div>                            // audio tracks&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['audio_channels'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 8, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['audio_bit_depth'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 10, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['audio_compression_id'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 12, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['audio_packet_size'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 14, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['audio_sample_rate'] = getid3_lib::FixedPoint16_16(substr($atom_structure['sample_description_table'][$i]['data'], 16, 4));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // video tracks&nbsp;</div></li><li><div>                            // http://developer.apple.com/library/mac/#documentation/QuickTime/QTFF/QTFFChap3/qtff3.html&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['temporal_quality'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 8, 4));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['spatial_quality'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 12, 4));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['width'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 16, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['height'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 18, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['resolution_x'] = getid3_lib::FixedPoint16_16(substr($atom_structure['sample_description_table'][$i]['data'], 24, 4));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['resolution_y'] = getid3_lib::FixedPoint16_16(substr($atom_structure['sample_description_table'][$i]['data'], 28, 4));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['data_size'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 32, 4));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['frame_count'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 36, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['compressor_name'] =                             substr($atom_structure['sample_description_table'][$i]['data'], 38, 4);&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['pixel_depth'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 42, 2));&nbsp;</div></li><li><div>                            $atom_structure['sample_description_table'][$i]['color_table_id'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 44, 2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            switch ($atom_structure['sample_description_table'][$i]['data_format']) {&nbsp;</div></li><li><div>                                case '2vuY':&nbsp;</div></li><li><div>                                case 'avc1':&nbsp;</div></li><li><div>                                case 'cvid':&nbsp;</div></li><li><div>                                case 'dvc ':&nbsp;</div></li><li><div>                                case 'dvcp':&nbsp;</div></li><li><div>                                case 'gif ':&nbsp;</div></li><li><div>                                case 'h263':&nbsp;</div></li><li><div>                                case 'jpeg':&nbsp;</div></li><li><div>                                case 'kpcd':&nbsp;</div></li><li><div>                                case 'mjpa':&nbsp;</div></li><li><div>                                case 'mjpb':&nbsp;</div></li><li><div>                                case 'mp4v':&nbsp;</div></li><li><div>                                case 'png ':&nbsp;</div></li><li><div>                                case 'raw ':&nbsp;</div></li><li><div>                                case 'rle ':&nbsp;</div></li><li><div>                                case 'rpza':&nbsp;</div></li><li><div>                                case 'smc ':&nbsp;</div></li><li><div>                                case 'SVQ1':&nbsp;</div></li><li><div>                                case 'SVQ3':&nbsp;</div></li><li><div>                                case 'tiff':&nbsp;</div></li><li><div>                                case 'v210':&nbsp;</div></li><li><div>                                case 'v216':&nbsp;</div></li><li><div>                                case 'v308':&nbsp;</div></li><li><div>                                case 'v408':&nbsp;</div></li><li><div>                                case 'v410':&nbsp;</div></li><li><div>                                case 'yuv2':&nbsp;</div></li><li><div>                                    $info['fileformat'] = 'mp4';&nbsp;</div></li><li><div>                                    $info['video']['fourcc'] = $atom_structure['sample_description_table'][$i]['data_format'];&nbsp;</div></li><li><div>// http://www.getid3.org/phpBB3/viewtopic.php?t=1550&nbsp;</div></li><li><div>//if ((!empty($atom_structure['sample_description_table'][$i]['width']) && !empty($atom_structure['sample_description_table'][$i]['width'])) && (empty($info['video']['resolution_x']) || empty($info['video']['resolution_y']) || (number_format($info['video']['resolution_x'], 6) != number_format(round($info['video']['resolution_x']), 6)) || (number_format($info['video']['resolution_y'], 6) != number_format(round($info['video']['resolution_y']), 6)))) { // ugly check for floating point numbers&nbsp;</div></li><li><div>if (!empty($atom_structure['sample_description_table'][$i]['width']) && !empty($atom_structure['sample_description_table'][$i]['height'])) {&nbsp;</div></li><li><div>    // assume that values stored here are more important than values stored in [tkhd] atom&nbsp;</div></li><li><div>    $info['video']['resolution_x'] = $atom_structure['sample_description_table'][$i]['width'];&nbsp;</div></li><li><div>    $info['video']['resolution_y'] = $atom_structure['sample_description_table'][$i]['height'];&nbsp;</div></li><li><div>    $info['quicktime']['video']['resolution_x'] = $info['video']['resolution_x'];&nbsp;</div></li><li><div>    $info['quicktime']['video']['resolution_y'] = $info['video']['resolution_y'];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                case 'qtvr':&nbsp;</div></li><li><div>                                    $info['video']['dataformat'] = 'quicktimevr';&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                case 'mp4a':&nbsp;</div></li><li><div>                                default:&nbsp;</div></li><li><div>                                    $info['quicktime']['audio']['codec'] = $this-&gt;QuicktimeAudioCodecLookup($atom_structure['sample_description_table'][$i]['data_format']);&nbsp;</div></li><li><div>                                    $info['quicktime']['audio']['sample_rate'] = $atom_structure['sample_description_table'][$i]['audio_sample_rate'];&nbsp;</div></li><li><div>                                    $info['quicktime']['audio']['channels'] = $atom_structure['sample_description_table'][$i]['audio_channels'];&nbsp;</div></li><li><div>                                    $info['quicktime']['audio']['bit_depth'] = $atom_structure['sample_description_table'][$i]['audio_bit_depth'];&nbsp;</div></li><li><div>                                    $info['audio']['codec'] = $info['quicktime']['audio']['codec'];&nbsp;</div></li><li><div>                                    $info['audio']['sample_rate'] = $info['quicktime']['audio']['sample_rate'];&nbsp;</div></li><li><div>                                    $info['audio']['channels'] = $info['quicktime']['audio']['channels'];&nbsp;</div></li><li><div>                                    $info['audio']['bits_per_sample'] = $info['quicktime']['audio']['bit_depth'];&nbsp;</div></li><li><div>                                    switch ($atom_structure['sample_description_table'][$i]['data_format']) {&nbsp;</div></li><li><div>                                        case 'raw ': // PCM&nbsp;</div></li><li><div>                                        case 'alac': // Apple Lossless Audio Codec&nbsp;</div></li><li><div>                                            $info['audio']['lossless'] = true;&nbsp;</div></li><li><div>                                            break;&nbsp;</div></li><li><div>                                        default:&nbsp;</div></li><li><div>                                            $info['audio']['lossless'] = false;&nbsp;</div></li><li><div>                                            break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        default:&nbsp;</div></li><li><div>                            switch ($atom_structure['sample_description_table'][$i]['data_format']) {&nbsp;</div></li><li><div>                                case 'mp4s':&nbsp;</div></li><li><div>                                    $info['fileformat'] = 'mp4';&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                default:&nbsp;</div></li><li><div>                                    // video atom&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_temporal_quality'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 8, 4));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_spatial_quality'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 12, 4));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_frame_width'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 16, 2));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_frame_height'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 18, 2));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_resolution_x'] = getid3_lib::FixedPoint16_16(substr($atom_structure['sample_description_table'][$i]['data'], 20, 4));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_resolution_y'] = getid3_lib::FixedPoint16_16(substr($atom_structure['sample_description_table'][$i]['data'], 24, 4));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_data_size'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 28, 4));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_frame_count'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 32, 2));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_encoder_name_len'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 34, 1));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_encoder_name'] =                             substr($atom_structure['sample_description_table'][$i]['data'], 35, $atom_structure['sample_description_table'][$i]['video_encoder_name_len']);&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_pixel_color_depth'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 66, 2));&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_color_table_id'] =   getid3_lib::BigEndian2Int(substr($atom_structure['sample_description_table'][$i]['data'], 68, 2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_pixel_color_type'] = (($atom_structure['sample_description_table'][$i]['video_pixel_color_depth'] &gt; 32) ? 'grayscale' : 'color');&nbsp;</div></li><li><div>                                    $atom_structure['sample_description_table'][$i]['video_pixel_color_name'] = $this-&gt;QuicktimeColorNameLookup($atom_structure['sample_description_table'][$i]['video_pixel_color_depth']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ($atom_structure['sample_description_table'][$i]['video_pixel_color_name'] != 'invalid') {&nbsp;</div></li><li><div>                                        $info['quicktime']['video']['codec_fourcc'] = $atom_structure['sample_description_table'][$i]['data_format'];&nbsp;</div></li><li><div>                                        $info['quicktime']['video']['codec_fourcc_lookup'] = $this-&gt;QuicktimeVideoCodecLookup($atom_structure['sample_description_table'][$i]['data_format']);&nbsp;</div></li><li><div>                                        $info['quicktime']['video']['codec'] = (($atom_structure['sample_description_table'][$i]['video_encoder_name_len'] &gt; 0) ? $atom_structure['sample_description_table'][$i]['video_encoder_name'] : $atom_structure['sample_description_table'][$i]['data_format']);&nbsp;</div></li><li><div>                                        $info['quicktime']['video']['color_depth'] = $atom_structure['sample_description_table'][$i]['video_pixel_color_depth'];&nbsp;</div></li><li><div>                                        $info['quicktime']['video']['color_depth_name'] = $atom_structure['sample_description_table'][$i]['video_pixel_color_name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $info['video']['codec'] = $info['quicktime']['video']['codec'];&nbsp;</div></li><li><div>                                        $info['video']['bits_per_sample'] = $info['quicktime']['video']['color_depth'];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    $info['video']['lossless'] = false;&nbsp;</div></li><li><div>                                    $info['video']['pixel_aspect_ratio'] = (float) 1;&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    switch (strtolower($atom_structure['sample_description_table'][$i]['data_format'])) {&nbsp;</div></li><li><div>                        case 'mp4a':&nbsp;</div></li><li><div>                            $info['audio']['dataformat'] = 'mp4';&nbsp;</div></li><li><div>                            $info['quicktime']['audio']['codec'] = 'mp4';&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        case '3ivx':&nbsp;</div></li><li><div>                        case '3iv1':&nbsp;</div></li><li><div>                        case '3iv2':&nbsp;</div></li><li><div>                            $info['video']['dataformat'] = '3ivx';&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        case 'xvid':&nbsp;</div></li><li><div>                            $info['video']['dataformat'] = 'xvid';&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        case 'mp4v':&nbsp;</div></li><li><div>                            $info['video']['dataformat'] = 'mpeg4';&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        case 'divx':&nbsp;</div></li><li><div>                        case 'div1':&nbsp;</div></li><li><div>                        case 'div2':&nbsp;</div></li><li><div>                        case 'div3':&nbsp;</div></li><li><div>                        case 'div4':&nbsp;</div></li><li><div>                        case 'div5':&nbsp;</div></li><li><div>                        case 'div6':&nbsp;</div></li><li><div>                            $info['video']['dataformat'] = 'divx';&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        default:&nbsp;</div></li><li><div>                            // do nothing&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    unset($atom_structure['sample_description_table'][$i]['data']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stts': // Sample Table Time-to-Sample atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $sttsEntriesDataOffset = 8;&nbsp;</div></li><li><div>                //$FrameRateCalculatorArray = array();&nbsp;</div></li><li><div>                $frames_count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $max_stts_entries_to_scan = ($info['php_memory_limit'] ? min(floor($this-&gt;getid3-&gt;memory_limit / 10000), $atom_structure['number_entries']) : $atom_structure['number_entries']);&nbsp;</div></li><li><div>                if ($max_stts_entries_to_scan &lt; $atom_structure['number_entries']) {&nbsp;</div></li><li><div>                    $info['warning'][] = 'QuickTime atom &quot;stts&quot; has '.$atom_structure['number_entries'].' but only scanning the first '.$max_stts_entries_to_scan.' entries due to limited PHP memory available ('.floor($atom_structure['number_entries'] / 1048576).'MB).';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $max_stts_entries_to_scan; $i++) {&nbsp;</div></li><li><div>                    $atom_structure['time_to_sample_table'][$i]['sample_count'] = getid3_lib::BigEndian2Int(substr($atom_data, $sttsEntriesDataOffset, 4));&nbsp;</div></li><li><div>                    $sttsEntriesDataOffset += 4;&nbsp;</div></li><li><div>                    $atom_structure['time_to_sample_table'][$i]['sample_duration'] = getid3_lib::BigEndian2Int(substr($atom_data, $sttsEntriesDataOffset, 4));&nbsp;</div></li><li><div>                    $sttsEntriesDataOffset += 4;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $frames_count += $atom_structure['time_to_sample_table'][$i]['sample_count'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // THIS SECTION REPLACED WITH CODE IN &quot;stbl&quot; ATOM&nbsp;</div></li><li><div>                    //if (!empty($info['quicktime']['time_scale']) && ($atom_structure['time_to_sample_table'][$i]['sample_duration'] &gt; 0)) {&nbsp;</div></li><li><div>                    //    $stts_new_framerate = $info['quicktime']['time_scale'] / $atom_structure['time_to_sample_table'][$i]['sample_duration'];&nbsp;</div></li><li><div>                    //    if ($stts_new_framerate &lt;= 60) {&nbsp;</div></li><li><div>                    //        // some atoms have durations of &quot;1&quot; giving a very large framerate, which probably is not right&nbsp;</div></li><li><div>                    //        $info['video']['frame_rate'] = max($info['video']['frame_rate'], $stts_new_framerate);&nbsp;</div></li><li><div>                    //    }&nbsp;</div></li><li><div>                    //}&nbsp;</div></li><li><div>                    //&nbsp;</div></li><li><div>                    //$FrameRateCalculatorArray[($info['quicktime']['time_scale'] / $atom_structure['time_to_sample_table'][$i]['sample_duration'])] += $atom_structure['time_to_sample_table'][$i]['sample_count'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $info['quicktime']['stts_framecount'][] = $frames_count;&nbsp;</div></li><li><div>                //$sttsFramesTotal = 0;&nbsp;</div></li><li><div>                //$sttsSecondsTotal = 0;&nbsp;</div></li><li><div>                //foreach ($FrameRateCalculatorArray as $frames_per_second =&gt; $frame_count) {&nbsp;</div></li><li><div>                //    if (($frames_per_second &gt; 60) || ($frames_per_second &lt; 1)) {&nbsp;</div></li><li><div>                //        // not video FPS information, probably audio information&nbsp;</div></li><li><div>                //        $sttsFramesTotal = 0;&nbsp;</div></li><li><div>                //        $sttsSecondsTotal = 0;&nbsp;</div></li><li><div>                //        break;&nbsp;</div></li><li><div>                //    }&nbsp;</div></li><li><div>                //    $sttsFramesTotal  += $frame_count;&nbsp;</div></li><li><div>                //    $sttsSecondsTotal += $frame_count / $frames_per_second;&nbsp;</div></li><li><div>                //}&nbsp;</div></li><li><div>                //if (($sttsFramesTotal &gt; 0) && ($sttsSecondsTotal &gt; 0)) {&nbsp;</div></li><li><div>                //    if (($sttsFramesTotal / $sttsSecondsTotal) &gt; $info['video']['frame_rate']) {&nbsp;</div></li><li><div>                //        $info['video']['frame_rate'] = $sttsFramesTotal / $sttsSecondsTotal;&nbsp;</div></li><li><div>                //    }&nbsp;</div></li><li><div>                //}&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stss': // Sample Table Sync Sample (key frames) atom&nbsp;</div></li><li><div>                if ($ParseAllPossibleAtoms) {&nbsp;</div></li><li><div>                    $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                    $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                    $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                    $stssEntriesDataOffset = 8;&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++) {&nbsp;</div></li><li><div>                        $atom_structure['time_to_sample_table'][$i] = getid3_lib::BigEndian2Int(substr($atom_data, $stssEntriesDataOffset, 4));&nbsp;</div></li><li><div>                        $stssEntriesDataOffset += 4;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stsc': // Sample Table Sample-to-Chunk atom&nbsp;</div></li><li><div>                if ($ParseAllPossibleAtoms) {&nbsp;</div></li><li><div>                    $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                    $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                    $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                    $stscEntriesDataOffset = 8;&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++) {&nbsp;</div></li><li><div>                        $atom_structure['sample_to_chunk_table'][$i]['first_chunk'] = getid3_lib::BigEndian2Int(substr($atom_data, $stscEntriesDataOffset, 4));&nbsp;</div></li><li><div>                        $stscEntriesDataOffset += 4;&nbsp;</div></li><li><div>                        $atom_structure['sample_to_chunk_table'][$i]['samples_per_chunk'] = getid3_lib::BigEndian2Int(substr($atom_data, $stscEntriesDataOffset, 4));&nbsp;</div></li><li><div>                        $stscEntriesDataOffset += 4;&nbsp;</div></li><li><div>                        $atom_structure['sample_to_chunk_table'][$i]['sample_description'] = getid3_lib::BigEndian2Int(substr($atom_data, $stscEntriesDataOffset, 4));&nbsp;</div></li><li><div>                        $stscEntriesDataOffset += 4;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stsz': // Sample Table SiZe atom&nbsp;</div></li><li><div>                if ($ParseAllPossibleAtoms) {&nbsp;</div></li><li><div>                    $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                    $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                    $atom_structure['sample_size'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                    $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 8, 4));&nbsp;</div></li><li><div>                    $stszEntriesDataOffset = 12;&nbsp;</div></li><li><div>                    if ($atom_structure['sample_size'] == 0) {&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++) {&nbsp;</div></li><li><div>                            $atom_structure['sample_size_table'][$i] = getid3_lib::BigEndian2Int(substr($atom_data, $stszEntriesDataOffset, 4));&nbsp;</div></li><li><div>                            $stszEntriesDataOffset += 4;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stco': // Sample Table Chunk Offset atom&nbsp;</div></li><li><div>                if ($ParseAllPossibleAtoms) {&nbsp;</div></li><li><div>                    $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                    $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                    $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                    $stcoEntriesDataOffset = 8;&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++) {&nbsp;</div></li><li><div>                        $atom_structure['chunk_offset_table'][$i] = getid3_lib::BigEndian2Int(substr($atom_data, $stcoEntriesDataOffset, 4));&nbsp;</div></li><li><div>                        $stcoEntriesDataOffset += 4;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'co64': // Chunk Offset 64-bit (version of &quot;stco&quot; that supports &gt; 2GB files)&nbsp;</div></li><li><div>                if ($ParseAllPossibleAtoms) {&nbsp;</div></li><li><div>                    $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                    $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                    $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                    $stcoEntriesDataOffset = 8;&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++) {&nbsp;</div></li><li><div>                        $atom_structure['chunk_offset_table'][$i] = getid3_lib::BigEndian2Int(substr($atom_data, $stcoEntriesDataOffset, 8));&nbsp;</div></li><li><div>                        $stcoEntriesDataOffset += 8;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'dref': // Data REFerence atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $drefDataOffset = 8;&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++) {&nbsp;</div></li><li><div>                    $atom_structure['data_references'][$i]['size'] = getid3_lib::BigEndian2Int(substr($atom_data, $drefDataOffset, 4));&nbsp;</div></li><li><div>                    $drefDataOffset += 4;&nbsp;</div></li><li><div>                    $atom_structure['data_references'][$i]['type'] =               substr($atom_data, $drefDataOffset, 4);&nbsp;</div></li><li><div>                    $drefDataOffset += 4;&nbsp;</div></li><li><div>                    $atom_structure['data_references'][$i]['version'] = getid3_lib::BigEndian2Int(substr($atom_data, $drefDataOffset, 1));&nbsp;</div></li><li><div>                    $drefDataOffset += 1;&nbsp;</div></li><li><div>                    $atom_structure['data_references'][$i]['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, $drefDataOffset, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                    $drefDataOffset += 3;&nbsp;</div></li><li><div>                    $atom_structure['data_references'][$i]['data'] =               substr($atom_data, $drefDataOffset, ($atom_structure['data_references'][$i]['size'] - 4 - 4 - 1 - 3));&nbsp;</div></li><li><div>                    $drefDataOffset += ($atom_structure['data_references'][$i]['size'] - 4 - 4 - 1 - 3);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $atom_structure['data_references'][$i]['flags']['self_reference'] = (bool) ($atom_structure['data_references'][$i]['flags_raw'] & 0x001);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'gmin': // base Media INformation atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['graphics_mode'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2));&nbsp;</div></li><li><div>                $atom_structure['opcolor_red'] = getid3_lib::BigEndian2Int(substr($atom_data, 6, 2));&nbsp;</div></li><li><div>                $atom_structure['opcolor_green'] = getid3_lib::BigEndian2Int(substr($atom_data, 8, 2));&nbsp;</div></li><li><div>                $atom_structure['opcolor_blue'] = getid3_lib::BigEndian2Int(substr($atom_data, 10, 2));&nbsp;</div></li><li><div>                $atom_structure['balance'] = getid3_lib::BigEndian2Int(substr($atom_data, 12, 2));&nbsp;</div></li><li><div>                $atom_structure['reserved'] = getid3_lib::BigEndian2Int(substr($atom_data, 14, 2));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'smhd': // Sound Media information HeaDer atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['balance'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2));&nbsp;</div></li><li><div>                $atom_structure['reserved'] = getid3_lib::BigEndian2Int(substr($atom_data, 6, 2));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'vmhd': // Video Media information HeaDer atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3));&nbsp;</div></li><li><div>                $atom_structure['graphics_mode'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2));&nbsp;</div></li><li><div>                $atom_structure['opcolor_red'] = getid3_lib::BigEndian2Int(substr($atom_data, 6, 2));&nbsp;</div></li><li><div>                $atom_structure['opcolor_green'] = getid3_lib::BigEndian2Int(substr($atom_data, 8, 2));&nbsp;</div></li><li><div>                $atom_structure['opcolor_blue'] = getid3_lib::BigEndian2Int(substr($atom_data, 10, 2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['flags']['no_lean_ahead'] = (bool) ($atom_structure['flags_raw'] & 0x001);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'hdlr': // HanDLeR reference atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['component_type'] =                           substr($atom_data, 4, 4);&nbsp;</div></li><li><div>                $atom_structure['component_subtype'] =                           substr($atom_data, 8, 4);&nbsp;</div></li><li><div>                $atom_structure['component_manufacturer'] =                           substr($atom_data, 12, 4);&nbsp;</div></li><li><div>                $atom_structure['component_flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 16, 4));&nbsp;</div></li><li><div>                $atom_structure['component_flags_mask'] = getid3_lib::BigEndian2Int(substr($atom_data, 20, 4));&nbsp;</div></li><li><div>                $atom_structure['component_name'] =      $this-&gt;Pascal2String(substr($atom_data, 24));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (($atom_structure['component_subtype'] == 'STpn') && ($atom_structure['component_manufacturer'] == 'zzzz')) {&nbsp;</div></li><li><div>                    $info['video']['dataformat'] = 'quicktimevr';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'mdhd': // MeDia HeaDer atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['creation_time'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $atom_structure['modify_time'] = getid3_lib::BigEndian2Int(substr($atom_data, 8, 4));&nbsp;</div></li><li><div>                $atom_structure['time_scale'] = getid3_lib::BigEndian2Int(substr($atom_data, 12, 4));&nbsp;</div></li><li><div>                $atom_structure['duration'] = getid3_lib::BigEndian2Int(substr($atom_data, 16, 4));&nbsp;</div></li><li><div>                $atom_structure['language_id'] = getid3_lib::BigEndian2Int(substr($atom_data, 20, 2));&nbsp;</div></li><li><div>                $atom_structure['quality'] = getid3_lib::BigEndian2Int(substr($atom_data, 22, 2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($atom_structure['time_scale'] == 0) {&nbsp;</div></li><li><div>                    $info['error'][] = 'Corrupt Quicktime file: mdhd.time_scale == zero';&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $info['quicktime']['time_scale'] = (isset($info['quicktime']['time_scale']) ? max($info['quicktime']['time_scale'], $atom_structure['time_scale']) : $atom_structure['time_scale']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['creation_time_unix'] = getid3_lib::DateMac2Unix($atom_structure['creation_time']);&nbsp;</div></li><li><div>                $atom_structure['modify_time_unix'] = getid3_lib::DateMac2Unix($atom_structure['modify_time']);&nbsp;</div></li><li><div>                $atom_structure['playtime_seconds'] = $atom_structure['duration'] / $atom_structure['time_scale'];&nbsp;</div></li><li><div>                $atom_structure['language'] = $this-&gt;QuicktimeLanguageLookup($atom_structure['language_id']);&nbsp;</div></li><li><div>                if (empty($info['comments']['language']) || (!in_array($atom_structure['language'], $info['comments']['language']))) {&nbsp;</div></li><li><div>                    $info['comments']['language'][] = $atom_structure['language'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'pnot': // Preview atom&nbsp;</div></li><li><div>                $atom_structure['modification_date'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 4)); // &quot;standard Macintosh format&quot;&nbsp;</div></li><li><div>                $atom_structure['version_number'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2)); // hardcoded: 0x00&nbsp;</div></li><li><div>                $atom_structure['atom_type'] =               substr($atom_data, 6, 4);        // usually: 'PICT'&nbsp;</div></li><li><div>                $atom_structure['atom_index'] = getid3_lib::BigEndian2Int(substr($atom_data, 10, 2)); // usually: 0x01&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['modification_date_unix'] = getid3_lib::DateMac2Unix($atom_structure['modification_date']);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'crgn': // Clipping ReGioN atom&nbsp;</div></li><li><div>                $atom_structure['region_size'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 2)); // The Region size, Region boundary box, &nbsp;</div></li><li><div>                $atom_structure['boundary_box'] = getid3_lib::BigEndian2Int(substr($atom_data, 2, 8)); // and Clipping region data fields&nbsp;</div></li><li><div>                $atom_structure['clipping_data'] =               substr($atom_data, 10);           // constitute a QuickDraw region.&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'load': // track LOAD settings atom&nbsp;</div></li><li><div>                $atom_structure['preload_start_time'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 4));&nbsp;</div></li><li><div>                $atom_structure['preload_duration'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $atom_structure['preload_flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 8, 4));&nbsp;</div></li><li><div>                $atom_structure['default_hints_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 12, 4));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['default_hints']['double_buffer'] = (bool) ($atom_structure['default_hints_raw'] & 0x0020);&nbsp;</div></li><li><div>                $atom_structure['default_hints']['high_quality'] = (bool) ($atom_structure['default_hints_raw'] & 0x0100);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'tmcd': // TiMe CoDe atom&nbsp;</div></li><li><div>            case 'chap': // CHAPter list atom&nbsp;</div></li><li><div>            case 'sync': // SYNChronization atom&nbsp;</div></li><li><div>            case 'scpt': // tranSCriPT atom&nbsp;</div></li><li><div>            case 'ssrc': // non-primary SouRCe atom&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; strlen($atom_data); $i += 4) {&nbsp;</div></li><li><div>                    @$atom_structure['track_id'][] = getid3_lib::BigEndian2Int(substr($atom_data, $i, 4));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'elst': // Edit LiST atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['number_entries'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $atom_structure['number_entries']; $i++ ) {&nbsp;</div></li><li><div>                    $atom_structure['edit_list'][$i]['track_duration'] =   getid3_lib::BigEndian2Int(substr($atom_data, 8 + ($i * 12) + 0, 4));&nbsp;</div></li><li><div>                    $atom_structure['edit_list'][$i]['media_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 8 + ($i * 12) + 4, 4));&nbsp;</div></li><li><div>                    $atom_structure['edit_list'][$i]['media_rate'] = getid3_lib::FixedPoint16_16(substr($atom_data, 8 + ($i * 12) + 8, 4));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'kmat': // compressed MATte atom&nbsp;</div></li><li><div>                $atom_structure['version'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atom_data, 1, 3)); // hardcoded: 0x0000&nbsp;</div></li><li><div>                $atom_structure['matte_data_raw'] =               substr($atom_data, 4);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'ctab': // Color TABle atom&nbsp;</div></li><li><div>                $atom_structure['color_table_seed'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 4)); // hardcoded: 0x00000000&nbsp;</div></li><li><div>                $atom_structure['color_table_flags'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 2)); // hardcoded: 0x8000&nbsp;</div></li><li><div>                $atom_structure['color_table_size'] = getid3_lib::BigEndian2Int(substr($atom_data, 6, 2)) + 1;&nbsp;</div></li><li><div>                for ($colortableentry = 0; $colortableentry &lt; $atom_structure['color_table_size']; $colortableentry++) {&nbsp;</div></li><li><div>                    $atom_structure['color_table'][$colortableentry]['alpha'] = getid3_lib::BigEndian2Int(substr($atom_data, 8 + ($colortableentry * 8) + 0, 2));&nbsp;</div></li><li><div>                    $atom_structure['color_table'][$colortableentry]['red'] = getid3_lib::BigEndian2Int(substr($atom_data, 8 + ($colortableentry * 8) + 2, 2));&nbsp;</div></li><li><div>                    $atom_structure['color_table'][$colortableentry]['green'] = getid3_lib::BigEndian2Int(substr($atom_data, 8 + ($colortableentry * 8) + 4, 2));&nbsp;</div></li><li><div>                    $atom_structure['color_table'][$colortableentry]['blue'] = getid3_lib::BigEndian2Int(substr($atom_data, 8 + ($colortableentry * 8) + 6, 2));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'mvhd': // MoVie HeaDer atom&nbsp;</div></li><li><div>                $atom_structure['version'] =   getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] =   getid3_lib::BigEndian2Int(substr($atom_data, 1, 3));&nbsp;</div></li><li><div>                $atom_structure['creation_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $atom_structure['modify_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 8, 4));&nbsp;</div></li><li><div>                $atom_structure['time_scale'] =   getid3_lib::BigEndian2Int(substr($atom_data, 12, 4));&nbsp;</div></li><li><div>                $atom_structure['duration'] =   getid3_lib::BigEndian2Int(substr($atom_data, 16, 4));&nbsp;</div></li><li><div>                $atom_structure['preferred_rate'] = getid3_lib::FixedPoint16_16(substr($atom_data, 20, 4));&nbsp;</div></li><li><div>                $atom_structure['preferred_volume'] =   getid3_lib::FixedPoint8_8(substr($atom_data, 24, 2));&nbsp;</div></li><li><div>                $atom_structure['reserved'] =                             substr($atom_data, 26, 10);&nbsp;</div></li><li><div>                $atom_structure['matrix_a'] = getid3_lib::FixedPoint16_16(substr($atom_data, 36, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_b'] = getid3_lib::FixedPoint16_16(substr($atom_data, 40, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_u'] =  getid3_lib::FixedPoint2_30(substr($atom_data, 44, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_c'] = getid3_lib::FixedPoint16_16(substr($atom_data, 48, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_d'] = getid3_lib::FixedPoint16_16(substr($atom_data, 52, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_v'] =  getid3_lib::FixedPoint2_30(substr($atom_data, 56, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_x'] = getid3_lib::FixedPoint16_16(substr($atom_data, 60, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_y'] = getid3_lib::FixedPoint16_16(substr($atom_data, 64, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_w'] =  getid3_lib::FixedPoint2_30(substr($atom_data, 68, 4));&nbsp;</div></li><li><div>                $atom_structure['preview_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 72, 4));&nbsp;</div></li><li><div>                $atom_structure['preview_duration'] =   getid3_lib::BigEndian2Int(substr($atom_data, 76, 4));&nbsp;</div></li><li><div>                $atom_structure['poster_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 80, 4));&nbsp;</div></li><li><div>                $atom_structure['selection_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 84, 4));&nbsp;</div></li><li><div>                $atom_structure['selection_duration'] =   getid3_lib::BigEndian2Int(substr($atom_data, 88, 4));&nbsp;</div></li><li><div>                $atom_structure['current_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 92, 4));&nbsp;</div></li><li><div>                $atom_structure['next_track_id'] =   getid3_lib::BigEndian2Int(substr($atom_data, 96, 4));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($atom_structure['time_scale'] == 0) {&nbsp;</div></li><li><div>                    $info['error'][] = 'Corrupt Quicktime file: mvhd.time_scale == zero';&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $atom_structure['creation_time_unix'] = getid3_lib::DateMac2Unix($atom_structure['creation_time']);&nbsp;</div></li><li><div>                $atom_structure['modify_time_unix'] = getid3_lib::DateMac2Unix($atom_structure['modify_time']);&nbsp;</div></li><li><div>                $info['quicktime']['time_scale'] = (isset($info['quicktime']['time_scale']) ? max($info['quicktime']['time_scale'], $atom_structure['time_scale']) : $atom_structure['time_scale']);&nbsp;</div></li><li><div>                $info['quicktime']['display_scale'] = $atom_structure['matrix_a'];&nbsp;</div></li><li><div>                $info['playtime_seconds'] = $atom_structure['duration'] / $atom_structure['time_scale'];&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'tkhd': // TracK HeaDer atom&nbsp;</div></li><li><div>                $atom_structure['version'] =   getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] =   getid3_lib::BigEndian2Int(substr($atom_data, 1, 3));&nbsp;</div></li><li><div>                $atom_structure['creation_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $atom_structure['modify_time'] =   getid3_lib::BigEndian2Int(substr($atom_data, 8, 4));&nbsp;</div></li><li><div>                $atom_structure['trackid'] =   getid3_lib::BigEndian2Int(substr($atom_data, 12, 4));&nbsp;</div></li><li><div>                $atom_structure['reserved1'] =   getid3_lib::BigEndian2Int(substr($atom_data, 16, 4));&nbsp;</div></li><li><div>                $atom_structure['duration'] =   getid3_lib::BigEndian2Int(substr($atom_data, 20, 4));&nbsp;</div></li><li><div>                $atom_structure['reserved2'] =   getid3_lib::BigEndian2Int(substr($atom_data, 24, 8));&nbsp;</div></li><li><div>                $atom_structure['layer'] =   getid3_lib::BigEndian2Int(substr($atom_data, 32, 2));&nbsp;</div></li><li><div>                $atom_structure['alternate_group'] =   getid3_lib::BigEndian2Int(substr($atom_data, 34, 2));&nbsp;</div></li><li><div>                $atom_structure['volume'] =   getid3_lib::FixedPoint8_8(substr($atom_data, 36, 2));&nbsp;</div></li><li><div>                $atom_structure['reserved3'] =   getid3_lib::BigEndian2Int(substr($atom_data, 38, 2));&nbsp;</div></li><li><div>// http://developer.apple.com/library/mac/#documentation/QuickTime/RM/MovieBasics/MTEditing/K-Chapter/11MatrixFunctions.html&nbsp;</div></li><li><div>// http://developer.apple.com/library/mac/#documentation/QuickTime/qtff/QTFFChap4/qtff4.html#//apple_ref/doc/uid/TP40000939-CH206-18737&nbsp;</div></li><li><div>                $atom_structure['matrix_a'] = getid3_lib::FixedPoint16_16(substr($atom_data, 40, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_b'] = getid3_lib::FixedPoint16_16(substr($atom_data, 44, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_u'] =  getid3_lib::FixedPoint2_30(substr($atom_data, 48, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_c'] = getid3_lib::FixedPoint16_16(substr($atom_data, 52, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_d'] = getid3_lib::FixedPoint16_16(substr($atom_data, 56, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_v'] =  getid3_lib::FixedPoint2_30(substr($atom_data, 60, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_x'] = getid3_lib::FixedPoint16_16(substr($atom_data, 64, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_y'] = getid3_lib::FixedPoint16_16(substr($atom_data, 68, 4));&nbsp;</div></li><li><div>                $atom_structure['matrix_w'] =  getid3_lib::FixedPoint2_30(substr($atom_data, 72, 4));&nbsp;</div></li><li><div>                $atom_structure['width'] = getid3_lib::FixedPoint16_16(substr($atom_data, 76, 4));&nbsp;</div></li><li><div>                $atom_structure['height'] = getid3_lib::FixedPoint16_16(substr($atom_data, 80, 4));&nbsp;</div></li><li><div>                $atom_structure['flags']['enabled'] = (bool) ($atom_structure['flags_raw'] & 0x0001);&nbsp;</div></li><li><div>                $atom_structure['flags']['in_movie'] = (bool) ($atom_structure['flags_raw'] & 0x0002);&nbsp;</div></li><li><div>                $atom_structure['flags']['in_preview'] = (bool) ($atom_structure['flags_raw'] & 0x0004);&nbsp;</div></li><li><div>                $atom_structure['flags']['in_poster'] = (bool) ($atom_structure['flags_raw'] & 0x0008);&nbsp;</div></li><li><div>                $atom_structure['creation_time_unix'] = getid3_lib::DateMac2Unix($atom_structure['creation_time']);&nbsp;</div></li><li><div>                $atom_structure['modify_time_unix'] = getid3_lib::DateMac2Unix($atom_structure['modify_time']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($atom_structure['flags']['enabled'] == 1) {&nbsp;</div></li><li><div>                    if (!isset($info['video']['resolution_x']) || !isset($info['video']['resolution_y'])) {&nbsp;</div></li><li><div>                        $info['video']['resolution_x'] = $atom_structure['width'];&nbsp;</div></li><li><div>                        $info['video']['resolution_y'] = $atom_structure['height'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $info['video']['resolution_x'] = max($info['video']['resolution_x'], $atom_structure['width']);&nbsp;</div></li><li><div>                    $info['video']['resolution_y'] = max($info['video']['resolution_y'], $atom_structure['height']);&nbsp;</div></li><li><div>                    $info['quicktime']['video']['resolution_x'] = $info['video']['resolution_x'];&nbsp;</div></li><li><div>                    $info['quicktime']['video']['resolution_y'] = $info['video']['resolution_y'];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // see: http://www.getid3.org/phpBB3/viewtopic.php?t=1295&nbsp;</div></li><li><div>                    //if (isset($info['video']['resolution_x'])) { unset($info['video']['resolution_x']); }&nbsp;</div></li><li><div>                    //if (isset($info['video']['resolution_y'])) { unset($info['video']['resolution_y']); }&nbsp;</div></li><li><div>                    //if (isset($info['quicktime']['video']))    { unset($info['quicktime']['video']);    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'iods': // Initial Object DeScriptor atom&nbsp;</div></li><li><div>                // http://www.koders.com/c/fid1FAB3E762903DC482D8A246D4A4BF9F28E049594.aspx?s=windows.h&nbsp;</div></li><li><div>                // http://libquicktime.sourcearchive.com/documentation/1.0.2plus-pdebian/iods_8c-source.html&nbsp;</div></li><li><div>                $offset = 0;&nbsp;</div></li><li><div>                $atom_structure['version'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 3));&nbsp;</div></li><li><div>                $offset += 3;&nbsp;</div></li><li><div>                $atom_structure['mp4_iod_tag'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>                $atom_structure['length'] = $this-&gt;quicktime_read_mp4_descr_length($atom_data, $offset);&nbsp;</div></li><li><div>                //$offset already adjusted by quicktime_read_mp4_descr_length()&nbsp;</div></li><li><div>                $atom_structure['object_descriptor_id'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 2));&nbsp;</div></li><li><div>                $offset += 2;&nbsp;</div></li><li><div>                $atom_structure['od_profile_level'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>                $atom_structure['scene_profile_level'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>                $atom_structure['audio_profile_id'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>                $atom_structure['video_profile_id'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>                $atom_structure['graphics_profile_level'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                $offset += 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['num_iods_tracks'] = ($atom_structure['length'] - 7) / 6; // 6 bytes would only be right if all tracks use 1-byte length fields&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; $atom_structure['num_iods_tracks']; $i++) {&nbsp;</div></li><li><div>                    $atom_structure['track'][$i]['ES_ID_IncTag'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 1));&nbsp;</div></li><li><div>                    $offset += 1;&nbsp;</div></li><li><div>                    $atom_structure['track'][$i]['length'] = $this-&gt;quicktime_read_mp4_descr_length($atom_data, $offset);&nbsp;</div></li><li><div>                    //$offset already adjusted by quicktime_read_mp4_descr_length()&nbsp;</div></li><li><div>                    $atom_structure['track'][$i]['track_id'] =       getid3_lib::BigEndian2Int(substr($atom_data, $offset, 4));&nbsp;</div></li><li><div>                    $offset += 4;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['audio_profile_name'] = $this-&gt;QuicktimeIODSaudioProfileName($atom_structure['audio_profile_id']);&nbsp;</div></li><li><div>                $atom_structure['video_profile_name'] = $this-&gt;QuicktimeIODSvideoProfileName($atom_structure['video_profile_id']);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'ftyp': // FileTYPe (?) atom (for MP4 it seems)&nbsp;</div></li><li><div>                $atom_structure['signature'] =                           substr($atom_data, 0, 4);&nbsp;</div></li><li><div>                $atom_structure['unknown_1'] = getid3_lib::BigEndian2Int(substr($atom_data, 4, 4));&nbsp;</div></li><li><div>                $atom_structure['fourcc'] =                           substr($atom_data, 8, 4);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'mdat': // Media DATa atom&nbsp;</div></li><li><div>                // 'mdat' contains the actual data for the audio/video, possibly also subtitles&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/** due to lack of known documentation, this is a kludge implementation. If you know of documentation on how mdat is properly structed, please send it to info@getid3.org */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // first, skip any 'wide' padding, and second 'mdat' header (with specified size of zero?)&nbsp;</div></li><li><div>                $mdat_offset = 0;&nbsp;</div></li><li><div>                while (true) {&nbsp;</div></li><li><div>                    if (substr($atom_data, $mdat_offset, 8) == &quot;\x00\x00\x00\x08&quot;.'wide') {&nbsp;</div></li><li><div>                        $mdat_offset += 8;&nbsp;</div></li><li><div>                    } elseif (substr($atom_data, $mdat_offset, 8) == &quot;\x00\x00\x00\x00&quot;.'mdat') {&nbsp;</div></li><li><div>                        $mdat_offset += 8;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // check to see if it looks like chapter titles, in the form of unterminated strings with a leading 16-bit size field&nbsp;</div></li><li><div>                while  (($chapter_string_length = getid3_lib::BigEndian2Int(substr($atom_data, $mdat_offset, 2)))&nbsp;</div></li><li><div>                    && ($chapter_string_length &lt; 1000)&nbsp;</div></li><li><div>                    && ($chapter_string_length &lt;= (strlen($atom_data) - $mdat_offset - 2))&nbsp;</div></li><li><div>                    && preg_match('#^[\x20-\xFF]+$#', substr($atom_data, $mdat_offset + 2, $chapter_string_length), $chapter_matches)) {&nbsp;</div></li><li><div>                        $mdat_offset += (2 + $chapter_string_length);&nbsp;</div></li><li><div>                        @$info['quicktime']['comments']['chapters'][] = $chapter_matches[0];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (($atomsize &gt; 8) && (!isset($info['avdataend_tmp']) || ($info['quicktime'][$atomname]['size'] &gt; ($info['avdataend_tmp'] - $info['avdataoffset'])))) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $info['avdataoffset'] = $atom_structure['offset'] + 8;                       // $info['quicktime'][$atomname]['offset'] + 8;&nbsp;</div></li><li><div>                    $OldAVDataEnd = $info['avdataend'];&nbsp;</div></li><li><div>                    $info['avdataend'] = $atom_structure['offset'] + $atom_structure['size']; // $info['quicktime'][$atomname]['offset'] + $info['quicktime'][$atomname]['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $getid3_temp = new getID3();&nbsp;</div></li><li><div>                    $getid3_temp-&gt;openfile($this-&gt;getid3-&gt;filename);&nbsp;</div></li><li><div>                    $getid3_temp-&gt;info['avdataoffset'] = $info['avdataoffset'];&nbsp;</div></li><li><div>                    $getid3_temp-&gt;info['avdataend'] = $info['avdataend'];&nbsp;</div></li><li><div>                    $getid3_mp3 = new getid3_mp3($getid3_temp);&nbsp;</div></li><li><div>                    if ($getid3_mp3-&gt;MPEGaudioHeaderValid($getid3_mp3-&gt;MPEGaudioHeaderDecode($this-&gt;fread(4)))) {&nbsp;</div></li><li><div>                        $getid3_mp3-&gt;getOnlyMPEGaudioInfo($getid3_temp-&gt;info['avdataoffset'], false);&nbsp;</div></li><li><div>                        if (!empty($getid3_temp-&gt;info['warning'])) {&nbsp;</div></li><li><div>                            foreach ($getid3_temp-&gt;info['warning'] as $value) {&nbsp;</div></li><li><div>                                $info['warning'][] = $value;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (!empty($getid3_temp-&gt;info['mpeg'])) {&nbsp;</div></li><li><div>                            $info['mpeg'] = $getid3_temp-&gt;info['mpeg'];&nbsp;</div></li><li><div>                            if (isset($info['mpeg']['audio'])) {&nbsp;</div></li><li><div>                                $info['audio']['dataformat'] = 'mp3';&nbsp;</div></li><li><div>                                $info['audio']['codec'] = (!empty($info['mpeg']['audio']['encoder']) ? $info['mpeg']['audio']['encoder'] : (!empty($info['mpeg']['audio']['codec']) ? $info['mpeg']['audio']['codec'] : (!empty($info['mpeg']['audio']['LAME']) ? 'LAME' :'mp3')));&nbsp;</div></li><li><div>                                $info['audio']['sample_rate'] = $info['mpeg']['audio']['sample_rate'];&nbsp;</div></li><li><div>                                $info['audio']['channels'] = $info['mpeg']['audio']['channels'];&nbsp;</div></li><li><div>                                $info['audio']['bitrate'] = $info['mpeg']['audio']['bitrate'];&nbsp;</div></li><li><div>                                $info['audio']['bitrate_mode'] = strtolower($info['mpeg']['audio']['bitrate_mode']);&nbsp;</div></li><li><div>                                $info['bitrate'] = $info['audio']['bitrate'];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    unset($getid3_mp3, $getid3_temp);&nbsp;</div></li><li><div>                    $info['avdataend'] = $OldAVDataEnd;&nbsp;</div></li><li><div>                    unset($OldAVDataEnd);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                unset($mdat_offset, $chapter_string_length, $chapter_matches);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'free': // FREE space atom&nbsp;</div></li><li><div>            case 'skip': // SKIP atom&nbsp;</div></li><li><div>            case 'wide': // 64-bit expansion placeholder atom&nbsp;</div></li><li><div>                // 'free', 'skip' and 'wide' are just padding, contains no useful data at all&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // When writing QuickTime files, it is sometimes necessary to update an atom's size.&nbsp;</div></li><li><div>                // It is impossible to update a 32-bit atom to a 64-bit atom since the 32-bit atom&nbsp;</div></li><li><div>                // is only 8 bytes in size, and the 64-bit atom requires 16 bytes. Therefore, QuickTime&nbsp;</div></li><li><div>                // puts an 8-byte placeholder atom before any atoms it may have to update the size of.&nbsp;</div></li><li><div>                // In this way, if the atom needs to be converted from a 32-bit to a 64-bit atom, the&nbsp;</div></li><li><div>                // placeholder atom can be overwritten to obtain the necessary 8 extra bytes.&nbsp;</div></li><li><div>                // The placeholder atom has a type of kWideAtomPlaceholderType ( 'wide' ).&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'nsav': // NoSAVe atom&nbsp;</div></li><li><div>                // http://developer.apple.com/technotes/tn/tn2038.html&nbsp;</div></li><li><div>                $atom_structure['data'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 4));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'ctyp': // Controller TYPe atom (seen on QTVR)&nbsp;</div></li><li><div>                // http://homepages.slingshot.co.nz/~helmboy/quicktime/formats/qtm-layout.txt&nbsp;</div></li><li><div>                // some controller names are:&nbsp;</div></li><li><div>                //   0x00 + 'std' for linear movie&nbsp;</div></li><li><div>                //   'none' for no controls&nbsp;</div></li><li><div>                $atom_structure['ctyp'] = substr($atom_data, 0, 4);&nbsp;</div></li><li><div>                $info['quicktime']['controller'] = $atom_structure['ctyp'];&nbsp;</div></li><li><div>                switch ($atom_structure['ctyp']) {&nbsp;</div></li><li><div>                    case 'qtvr':&nbsp;</div></li><li><div>                        $info['video']['dataformat'] = 'quicktimevr';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'pano': // PANOrama track (seen on QTVR)&nbsp;</div></li><li><div>                $atom_structure['pano'] = getid3_lib::BigEndian2Int(substr($atom_data, 0, 4));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'hint': // HINT track&nbsp;</div></li><li><div>            case 'hinf': //&nbsp;</div></li><li><div>            case 'hinv': //&nbsp;</div></li><li><div>            case 'hnti': //&nbsp;</div></li><li><div>                $info['quicktime']['hinting'] = true;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'imgt': // IMaGe Track reference (kQTVRImageTrackRefType) (seen on QTVR)&nbsp;</div></li><li><div>                for ($i = 0; $i &lt; ($atom_structure['size'] - 8); $i += 4) {&nbsp;</div></li><li><div>                    $atom_structure['imgt'][] = getid3_lib::BigEndian2Int(substr($atom_data, $i, 4));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Observed-but-not-handled atom types are just listed here to prevent warnings being generated&nbsp;</div></li><li><div>            case 'FXTC': // Something to do with Adobe After Effects (?)&nbsp;</div></li><li><div>            case 'PrmA':&nbsp;</div></li><li><div>            case 'code':&nbsp;</div></li><li><div>            case 'FIEL': // this is NOT &quot;fiel&quot; (Field Ordering) as describe here: http://developer.apple.com/documentation/QuickTime/QTFF/QTFFChap3/chapter_4_section_2.html&nbsp;</div></li><li><div>            case 'tapt': // TrackApertureModeDimensionsAID - http://developer.apple.com/documentation/QuickTime/Reference/QT7-1_Update_Reference/Constants/Constants.html&nbsp;</div></li><li><div>                        // tapt seems to be used to compute the video size [http://www.getid3.org/phpBB3/viewtopic.php?t=838]&nbsp;</div></li><li><div>                        // * http://lists.apple.com/archives/quicktime-api/2006/Aug/msg00014.html&nbsp;</div></li><li><div>                        // * http://handbrake.fr/irclogs/handbrake-dev/handbrake-dev20080128_pg2.html&nbsp;</div></li><li><div>            case 'ctts'://  STCompositionOffsetAID             - http://developer.apple.com/documentation/QuickTime/Reference/QTRef_Constants/Reference/reference.html&nbsp;</div></li><li><div>            case 'cslg'://  STCompositionShiftLeastGreatestAID - http://developer.apple.com/documentation/QuickTime/Reference/QTRef_Constants/Reference/reference.html&nbsp;</div></li><li><div>            case 'sdtp'://  STSampleDependencyAID              - http://developer.apple.com/documentation/QuickTime/Reference/QTRef_Constants/Reference/reference.html&nbsp;</div></li><li><div>            case 'stps'://  STPartialSyncSampleAID             - http://developer.apple.com/documentation/QuickTime/Reference/QTRef_Constants/Reference/reference.html&nbsp;</div></li><li><div>                //$atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case &quot;\xA9&quot;.'xyz':  // GPS latitude+longitude+altitude&nbsp;</div></li><li><div>                $atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>                if (preg_match('#([\\+\\-][0-9\\.]+)([\\+\\-][0-9\\.]+)([\\+\\-][0-9\\.]+)?/$#i', $atom_data, $matches)) {&nbsp;</div></li><li><div>                    @list($all, $latitude, $longitude, $altitude) = $matches;&nbsp;</div></li><li><div>                    $info['quicktime']['comments']['gps_latitude'][] = floatval($latitude);&nbsp;</div></li><li><div>                    $info['quicktime']['comments']['gps_longitude'][] = floatval($longitude);&nbsp;</div></li><li><div>                    if (!empty($altitude)) {&nbsp;</div></li><li><div>                        $info['quicktime']['comments']['gps_altitude'][] = floatval($altitude);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $info['warning'][] = 'QuickTime atom &quot;xyz&quot; data does not match expected data pattern at offset '.$baseoffset.'. Please report as getID3() bug.';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'NCDT':&nbsp;</div></li><li><div>                // http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html&nbsp;</div></li><li><div>                // Nikon-specific QuickTime tags found in the NCDT atom of MOV videos from some Nikon cameras such as the Coolpix S8000 and D5100&nbsp;</div></li><li><div>                $atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($atom_data, $baseoffset + 4, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'NCTH': // Nikon Camera THumbnail image&nbsp;</div></li><li><div>            case 'NCVW': // Nikon Camera preVieW image&nbsp;</div></li><li><div>                // http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html&nbsp;</div></li><li><div>                if (preg_match('/^\xFF\xD8\xFF/', $atom_data)) {&nbsp;</div></li><li><div>                    $atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>                    $atom_structure['image_mime'] = 'image/jpeg';&nbsp;</div></li><li><div>                    $atom_structure['description'] = (($atomname == 'NCTH') ? 'Nikon Camera Thumbnail Image' : (($atomname == 'NCVW') ? 'Nikon Camera Preview Image' : 'Nikon preview image'));&nbsp;</div></li><li><div>                    $info['quicktime']['comments']['picture'][] = array('image_mime'=&gt;$atom_structure['image_mime'], 'data'=&gt;$atom_data, 'description'=&gt;$atom_structure['description']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'NCTG': // Nikon - http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html#NCTG&nbsp;</div></li><li><div>                $atom_structure['data'] = $this-&gt;QuicktimeParseNikonNCTG($atom_data);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'NCHD': // Nikon:MakerNoteVersion  - http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html&nbsp;</div></li><li><div>            case 'NCDB': // Nikon                   - http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html&nbsp;</div></li><li><div>            case 'CNCV': // Canon:CompressorVersion - http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Canon.html&nbsp;</div></li><li><div>                $atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case &quot;\x00\x00\x00\x00&quot;:&nbsp;</div></li><li><div>            case 'meta': // METAdata atom&nbsp;</div></li><li><div>                // some kind of metacontainer, may contain a big data dump such as:&nbsp;</div></li><li><div>                // mdta keys \005 mdtacom.apple.quicktime.make (mdtacom.apple.quicktime.creationdate , mdtacom.apple.quicktime.location.ISO6709 $mdtacom.apple.quicktime.software !mdtacom.apple.quicktime.model ilst \01D \001 \015data \001DE\010Apple 0 \002 (data \001DE\0102011-05-11T17:54:04+0200 2 \003 *data \001DE\010+52.4936+013.3897+040.247/ \01D \004 \015data \001DE\0104.3.1 \005 \018data \001DE\010iPhone 4&nbsp;</div></li><li><div>                // http://www.geocities.com/xhelmboyx/quicktime/formats/qti-layout.txt&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $atom_structure['version'] =          getid3_lib::BigEndian2Int(substr($atom_data, 0, 1));&nbsp;</div></li><li><div>                $atom_structure['flags_raw'] =          getid3_lib::BigEndian2Int(substr($atom_data, 1, 3));&nbsp;</div></li><li><div>                $atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom(substr($atom_data, 4), $baseoffset + 8, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>                //$atom_structure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($atom_data, $baseoffset + 8, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'data': // metaDATA atom&nbsp;</div></li><li><div>                // seems to be 2 bytes language code (ASCII), 2 bytes unknown (set to 0x10B5 in sample I have), remainder is useful data&nbsp;</div></li><li><div>                $atom_structure['language'] =                           substr($atom_data, 4 + 0, 2);&nbsp;</div></li><li><div>                $atom_structure['unknown'] = getid3_lib::BigEndian2Int(substr($atom_data, 4 + 2, 2));&nbsp;</div></li><li><div>                $atom_structure['data'] =                           substr($atom_data, 4 + 4);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                $info['warning'][] = 'Unknown QuickTime atom type: &quot;'.preg_replace('#[^a-zA-Z0-9 _\\-]#', '?', $atomname).'&quot; ('.trim(getid3_lib::PrintHexBytes($atomname)).') at offset '.$baseoffset;&nbsp;</div></li><li><div>                $atom_structure['data'] = $atom_data;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        array_pop($atomHierarchy);&nbsp;</div></li><li><div>        return $atom_structure;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeParseContainerAtom($atom_data, $baseoffset, &$atomHierarchy, $ParseAllPossibleAtoms) {&nbsp;</div></li><li><div>//echo 'QuicktimeParseContainerAtom('.substr($atom_data, 4, 4).') @ '.$baseoffset.'&lt;br&gt;&lt;br&gt;';&nbsp;</div></li><li><div>        $atom_structure = false;&nbsp;</div></li><li><div>        $subatomoffset = 0;&nbsp;</div></li><li><div>        $subatomcounter = 0;&nbsp;</div></li><li><div>        if ((strlen($atom_data) == 4) && (getid3_lib::BigEndian2Int($atom_data) == 0x00000000)) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        while ($subatomoffset &lt; strlen($atom_data)) {&nbsp;</div></li><li><div>            $subatomsize = getid3_lib::BigEndian2Int(substr($atom_data, $subatomoffset + 0, 4));&nbsp;</div></li><li><div>            $subatomname =                           substr($atom_data, $subatomoffset + 4, 4);&nbsp;</div></li><li><div>            $subatomdata =                           substr($atom_data, $subatomoffset + 8, $subatomsize - 8);&nbsp;</div></li><li><div>            if ($subatomsize == 0) {&nbsp;</div></li><li><div>                // Furthermore, for historical reasons the list of atoms is optionally&nbsp;</div></li><li><div>                // terminated by a 32-bit integer set to 0. If you are writing a program&nbsp;</div></li><li><div>                // to read user data atoms, you should allow for the terminating 0.&nbsp;</div></li><li><div>                return $atom_structure;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $atom_structure[$subatomcounter] = $this-&gt;QuicktimeParseAtom($subatomname, $subatomsize, $subatomdata, $baseoffset + $subatomoffset, $atomHierarchy, $ParseAllPossibleAtoms);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $subatomoffset += $subatomsize;&nbsp;</div></li><li><div>            $subatomcounter++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $atom_structure;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function quicktime_read_mp4_descr_length($data, &$offset) {&nbsp;</div></li><li><div>        // http://libquicktime.sourcearchive.com/documentation/2:1.0.2plus-pdebian-2build1/esds_8c-source.html&nbsp;</div></li><li><div>        $num_bytes = 0;&nbsp;</div></li><li><div>        $length = 0;&nbsp;</div></li><li><div>        do {&nbsp;</div></li><li><div>            $b = ord(substr($data, $offset++, 1));&nbsp;</div></li><li><div>            $length = ($length &lt;&lt; 7) | ($b & 0x7F);&nbsp;</div></li><li><div>        } while (($b & 0x80) && ($num_bytes++ &lt; 4));&nbsp;</div></li><li><div>        return $length;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeLanguageLookup($languageid) {&nbsp;</div></li><li><div>        // http://developer.apple.com/library/mac/#documentation/QuickTime/QTFF/QTFFChap4/qtff4.html#//apple_ref/doc/uid/TP40000939-CH206-34353&nbsp;</div></li><li><div>        static $QuicktimeLanguageLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeLanguageLookup)) {&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[0] = 'English';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[1] = 'French';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[2] = 'German';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[3] = 'Italian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[4] = 'Dutch';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[5] = 'Swedish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[6] = 'Spanish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[7] = 'Danish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[8] = 'Portuguese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[9] = 'Norwegian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[10] = 'Hebrew';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[11] = 'Japanese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[12] = 'Arabic';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[13] = 'Finnish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[14] = 'Greek';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[15] = 'Icelandic';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[16] = 'Maltese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[17] = 'Turkish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[18] = 'Croatian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[19] = 'Chinese (Traditional)';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[20] = 'Urdu';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[21] = 'Hindi';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[22] = 'Thai';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[23] = 'Korean';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[24] = 'Lithuanian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[25] = 'Polish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[26] = 'Hungarian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[27] = 'Estonian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[28] = 'Lettish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[28] = 'Latvian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[29] = 'Saamisk';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[29] = 'Lappish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[30] = 'Faeroese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[31] = 'Farsi';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[31] = 'Persian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[32] = 'Russian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[33] = 'Chinese (Simplified)';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[34] = 'Flemish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[35] = 'Irish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[36] = 'Albanian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[37] = 'Romanian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[38] = 'Czech';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[39] = 'Slovak';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[40] = 'Slovenian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[41] = 'Yiddish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[42] = 'Serbian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[43] = 'Macedonian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[44] = 'Bulgarian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[45] = 'Ukrainian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[46] = 'Byelorussian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[47] = 'Uzbek';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[48] = 'Kazakh';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[49] = 'Azerbaijani';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[50] = 'AzerbaijanAr';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[51] = 'Armenian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[52] = 'Georgian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[53] = 'Moldavian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[54] = 'Kirghiz';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[55] = 'Tajiki';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[56] = 'Turkmen';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[57] = 'Mongolian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[58] = 'MongolianCyr';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[59] = 'Pashto';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[60] = 'Kurdish';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[61] = 'Kashmiri';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[62] = 'Sindhi';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[63] = 'Tibetan';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[64] = 'Nepali';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[65] = 'Sanskrit';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[66] = 'Marathi';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[67] = 'Bengali';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[68] = 'Assamese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[69] = 'Gujarati';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[70] = 'Punjabi';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[71] = 'Oriya';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[72] = 'Malayalam';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[73] = 'Kannada';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[74] = 'Tamil';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[75] = 'Telugu';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[76] = 'Sinhalese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[77] = 'Burmese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[78] = 'Khmer';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[79] = 'Lao';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[80] = 'Vietnamese';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[81] = 'Indonesian';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[82] = 'Tagalog';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[83] = 'MalayRoman';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[84] = 'MalayArabic';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[85] = 'Amharic';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[86] = 'Tigrinya';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[87] = 'Galla';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[87] = 'Oromo';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[88] = 'Somali';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[89] = 'Swahili';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[90] = 'Ruanda';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[91] = 'Rundi';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[92] = 'Chewa';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[93] = 'Malagasy';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[94] = 'Esperanto';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[128] = 'Welsh';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[129] = 'Basque';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[130] = 'Catalan';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[131] = 'Latin';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[132] = 'Quechua';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[133] = 'Guarani';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[134] = 'Aymara';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[135] = 'Tatar';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[136] = 'Uighur';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[137] = 'Dzongkha';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[138] = 'JavaneseRom';&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[32767] = 'Unspecified';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (($languageid &gt; 138) && ($languageid &lt; 32767)) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>            ISO Language Codes - http://www.loc.gov/standards/iso639-2/php/code_list.php&nbsp;</div></li><li><div>            Because the language codes specified by ISO 639-2/T are three characters long, they must be packed to fit into a 16-bit field.&nbsp;</div></li><li><div>            The packing algorithm must map each of the three characters, which are always lowercase, into a 5-bit integer and then concatenate&nbsp;</div></li><li><div>            these integers into the least significant 15 bits of a 16-bit integer, leaving the 16-bit integer's most significant bit set to zero.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>            One algorithm for performing this packing is to treat each ISO character as a 16-bit integer. Subtract 0x60 from the first character&nbsp;</div></li><li><div>            and multiply by 2^10 (0x400), subtract 0x60 from the second character and multiply by 2^5 (0x20), subtract 0x60 from the third character, &nbsp;</div></li><li><div>            and add the three 16-bit values. This will result in a single 16-bit value with the three codes correctly packed into the 15 least&nbsp;</div></li><li><div>            significant bits and the most significant bit set to zero.&nbsp;</div></li><li><div>            */&nbsp;</div></li><li><div>            $iso_language_id = '';&nbsp;</div></li><li><div>            $iso_language_id .= chr((($languageid & 0x7C00) &gt;&gt; 10) + 0x60);&nbsp;</div></li><li><div>            $iso_language_id .= chr((($languageid & 0x03E0) &gt;&gt;  5) + 0x60);&nbsp;</div></li><li><div>            $iso_language_id .= chr((($languageid & 0x001F) &gt;&gt;  0) + 0x60);&nbsp;</div></li><li><div>            $QuicktimeLanguageLookup[$languageid] = getid3_id3v2::LanguageLookup($iso_language_id);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeLanguageLookup[$languageid]) ? $QuicktimeLanguageLookup[$languageid] : 'invalid');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeVideoCodecLookup($codecid) {&nbsp;</div></li><li><div>        static $QuicktimeVideoCodecLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeVideoCodecLookup)) {&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['.SGI'] = 'SGI';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['3IV1'] = '3ivx MPEG-4 v1';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['3IV2'] = '3ivx MPEG-4 v2';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['3IVX'] = '3ivx MPEG-4';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['8BPS'] = 'Planar RGB';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['avc1'] = 'H.264/MPEG-4 AVC';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['avr '] = 'AVR-JPEG';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['b16g'] = '16Gray';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['b32a'] = '32AlphaGray';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['b48r'] = '48RGB';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['b64a'] = '64ARGB';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['base'] = 'Base';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['clou'] = 'Cloud';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['cmyk'] = 'CMYK';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['cvid'] = 'Cinepak';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['dmb1'] = 'OpenDML JPEG';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['dvc '] = 'DVC-NTSC';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['dvcp'] = 'DVC-PAL';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['dvpn'] = 'DVCPro-NTSC';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['dvpp'] = 'DVCPro-PAL';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['fire'] = 'Fire';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['flic'] = 'FLC';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['gif '] = 'GIF';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['h261'] = 'H261';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['h263'] = 'H263';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['IV41'] = 'Indeo4';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['jpeg'] = 'JPEG';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['kpcd'] = 'PhotoCD';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['mjpa'] = 'Motion JPEG-A';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['mjpb'] = 'Motion JPEG-B';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['msvc'] = 'Microsoft Video1';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['myuv'] = 'MPEG YUV420';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['path'] = 'Vector';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['png '] = 'PNG';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['PNTG'] = 'MacPaint';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['qdgx'] = 'QuickDrawGX';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['qdrw'] = 'QuickDraw';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['raw '] = 'RAW';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['ripl'] = 'WaterRipple';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['rpza'] = 'Video';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['smc '] = 'Graphics';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['SVQ1'] = 'Sorenson Video 1';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['SVQ1'] = 'Sorenson Video 3';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['syv9'] = 'Sorenson YUV9';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['tga '] = 'Targa';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['tiff'] = 'TIFF';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['WRAW'] = 'Windows RAW';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['WRLE'] = 'BMP';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['y420'] = 'YUV420';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['yuv2'] = 'ComponentVideo';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['yuvs'] = 'ComponentVideoUnsigned';&nbsp;</div></li><li><div>            $QuicktimeVideoCodecLookup['yuvu'] = 'ComponentVideoSigned';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeVideoCodecLookup[$codecid]) ? $QuicktimeVideoCodecLookup[$codecid] : '');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeAudioCodecLookup($codecid) {&nbsp;</div></li><li><div>        static $QuicktimeAudioCodecLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeAudioCodecLookup)) {&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['.mp3'] = 'Fraunhofer MPEG Layer-III alias';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['aac '] = 'ISO/IEC 14496-3 AAC';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['agsm'] = 'Apple GSM 10:1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['alac'] = 'Apple Lossless Audio Codec';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['alaw'] = 'A-law 2:1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['conv'] = 'Sample Format';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['dvca'] = 'DV';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['dvi '] = 'DV 4:1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['eqal'] = 'Frequency Equalizer';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['fl32'] = '32-bit Floating Point';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['fl64'] = '64-bit Floating Point';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['ima4'] = 'Interactive Multimedia Association 4:1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['in24'] = '24-bit Integer';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['in32'] = '32-bit Integer';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['lpc '] = 'LPC 23:1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['MAC3'] = 'Macintosh Audio Compression/Expansion (MACE) 3:1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['MAC6'] = 'Macintosh Audio Compression/Expansion (MACE) 6:1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['mixb'] = '8-bit Mixer';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['mixw'] = '16-bit Mixer';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['mp4a'] = 'ISO/IEC 14496-3 AAC';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['MS'.&quot;\x00\x02&quot;] = 'Microsoft ADPCM';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['MS'.&quot;\x00\x11&quot;] = 'DV IMA';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['MS'.&quot;\x00\x55&quot;] = 'Fraunhofer MPEG Layer III';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['NONE'] = 'No Encoding';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['Qclp'] = 'Qualcomm PureVoice';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['QDM2'] = 'QDesign Music 2';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['QDMC'] = 'QDesign Music 1';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['ratb'] = '8-bit Rate';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['ratw'] = '16-bit Rate';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['raw '] = 'raw PCM';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['sour'] = 'Sound Source';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['sowt'] = 'signed/two\'s complement (Little Endian)';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['str1'] = 'Iomega MPEG layer II';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['str2'] = 'Iomega MPEG *layer II';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['str3'] = 'Iomega MPEG **layer II';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['str4'] = 'Iomega MPEG ***layer II';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['twos'] = 'signed/two\'s complement (Big Endian)';&nbsp;</div></li><li><div>            $QuicktimeAudioCodecLookup['ulaw'] = 'mu-law 2:1';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeAudioCodecLookup[$codecid]) ? $QuicktimeAudioCodecLookup[$codecid] : '');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeDCOMLookup($compressionid) {&nbsp;</div></li><li><div>        static $QuicktimeDCOMLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeDCOMLookup)) {&nbsp;</div></li><li><div>            $QuicktimeDCOMLookup['zlib'] = 'ZLib Deflate';&nbsp;</div></li><li><div>            $QuicktimeDCOMLookup['adec'] = 'Apple Compression';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeDCOMLookup[$compressionid]) ? $QuicktimeDCOMLookup[$compressionid] : '');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeColorNameLookup($colordepthid) {&nbsp;</div></li><li><div>        static $QuicktimeColorNameLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeColorNameLookup)) {&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[1] = '2-color (monochrome)';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[2] = '4-color';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[4] = '16-color';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[8] = '256-color';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[16] = 'thousands (16-bit color)';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[24] = 'millions (24-bit color)';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[32] = 'millions+ (32-bit color)';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[33] = 'black & white';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[34] = '4-gray';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[36] = '16-gray';&nbsp;</div></li><li><div>            $QuicktimeColorNameLookup[40] = '256-gray';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeColorNameLookup[$colordepthid]) ? $QuicktimeColorNameLookup[$colordepthid] : 'invalid');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeSTIKLookup($stik) {&nbsp;</div></li><li><div>        static $QuicktimeSTIKLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeSTIKLookup)) {&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[0] = 'Movie';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[1] = 'Normal';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[2] = 'Audiobook';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[5] = 'Whacked Bookmark';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[6] = 'Music Video';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[9] = 'Short Film';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[10] = 'TV Show';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[11] = 'Booklet';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[14] = 'Ringtone';&nbsp;</div></li><li><div>            $QuicktimeSTIKLookup[21] = 'Podcast';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeSTIKLookup[$stik]) ? $QuicktimeSTIKLookup[$stik] : 'invalid');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeIODSaudioProfileName($audio_profile_id) {&nbsp;</div></li><li><div>        static $QuicktimeIODSaudioProfileNameLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeIODSaudioProfileNameLookup)) {&nbsp;</div></li><li><div>            $QuicktimeIODSaudioProfileNameLookup = array(&nbsp;</div></li><li><div>                0x00 =&gt; 'ISO Reserved (0x00)', &nbsp;</div></li><li><div>                0x01 =&gt; 'Main Audio Profile @ Level 1', &nbsp;</div></li><li><div>                0x02 =&gt; 'Main Audio Profile @ Level 2', &nbsp;</div></li><li><div>                0x03 =&gt; 'Main Audio Profile @ Level 3', &nbsp;</div></li><li><div>                0x04 =&gt; 'Main Audio Profile @ Level 4', &nbsp;</div></li><li><div>                0x05 =&gt; 'Scalable Audio Profile @ Level 1', &nbsp;</div></li><li><div>                0x06 =&gt; 'Scalable Audio Profile @ Level 2', &nbsp;</div></li><li><div>                0x07 =&gt; 'Scalable Audio Profile @ Level 3', &nbsp;</div></li><li><div>                0x08 =&gt; 'Scalable Audio Profile @ Level 4', &nbsp;</div></li><li><div>                0x09 =&gt; 'Speech Audio Profile @ Level 1', &nbsp;</div></li><li><div>                0x0A =&gt; 'Speech Audio Profile @ Level 2', &nbsp;</div></li><li><div>                0x0B =&gt; 'Synthetic Audio Profile @ Level 1', &nbsp;</div></li><li><div>                0x0C =&gt; 'Synthetic Audio Profile @ Level 2', &nbsp;</div></li><li><div>                0x0D =&gt; 'Synthetic Audio Profile @ Level 3', &nbsp;</div></li><li><div>                0x0E =&gt; 'High Quality Audio Profile @ Level 1', &nbsp;</div></li><li><div>                0x0F =&gt; 'High Quality Audio Profile @ Level 2', &nbsp;</div></li><li><div>                0x10 =&gt; 'High Quality Audio Profile @ Level 3', &nbsp;</div></li><li><div>                0x11 =&gt; 'High Quality Audio Profile @ Level 4', &nbsp;</div></li><li><div>                0x12 =&gt; 'High Quality Audio Profile @ Level 5', &nbsp;</div></li><li><div>                0x13 =&gt; 'High Quality Audio Profile @ Level 6', &nbsp;</div></li><li><div>                0x14 =&gt; 'High Quality Audio Profile @ Level 7', &nbsp;</div></li><li><div>                0x15 =&gt; 'High Quality Audio Profile @ Level 8', &nbsp;</div></li><li><div>                0x16 =&gt; 'Low Delay Audio Profile @ Level 1', &nbsp;</div></li><li><div>                0x17 =&gt; 'Low Delay Audio Profile @ Level 2', &nbsp;</div></li><li><div>                0x18 =&gt; 'Low Delay Audio Profile @ Level 3', &nbsp;</div></li><li><div>                0x19 =&gt; 'Low Delay Audio Profile @ Level 4', &nbsp;</div></li><li><div>                0x1A =&gt; 'Low Delay Audio Profile @ Level 5', &nbsp;</div></li><li><div>                0x1B =&gt; 'Low Delay Audio Profile @ Level 6', &nbsp;</div></li><li><div>                0x1C =&gt; 'Low Delay Audio Profile @ Level 7', &nbsp;</div></li><li><div>                0x1D =&gt; 'Low Delay Audio Profile @ Level 8', &nbsp;</div></li><li><div>                0x1E =&gt; 'Natural Audio Profile @ Level 1', &nbsp;</div></li><li><div>                0x1F =&gt; 'Natural Audio Profile @ Level 2', &nbsp;</div></li><li><div>                0x20 =&gt; 'Natural Audio Profile @ Level 3', &nbsp;</div></li><li><div>                0x21 =&gt; 'Natural Audio Profile @ Level 4', &nbsp;</div></li><li><div>                0x22 =&gt; 'Mobile Audio Internetworking Profile @ Level 1', &nbsp;</div></li><li><div>                0x23 =&gt; 'Mobile Audio Internetworking Profile @ Level 2', &nbsp;</div></li><li><div>                0x24 =&gt; 'Mobile Audio Internetworking Profile @ Level 3', &nbsp;</div></li><li><div>                0x25 =&gt; 'Mobile Audio Internetworking Profile @ Level 4', &nbsp;</div></li><li><div>                0x26 =&gt; 'Mobile Audio Internetworking Profile @ Level 5', &nbsp;</div></li><li><div>                0x27 =&gt; 'Mobile Audio Internetworking Profile @ Level 6', &nbsp;</div></li><li><div>                0x28 =&gt; 'AAC Profile @ Level 1', &nbsp;</div></li><li><div>                0x29 =&gt; 'AAC Profile @ Level 2', &nbsp;</div></li><li><div>                0x2A =&gt; 'AAC Profile @ Level 4', &nbsp;</div></li><li><div>                0x2B =&gt; 'AAC Profile @ Level 5', &nbsp;</div></li><li><div>                0x2C =&gt; 'High Efficiency AAC Profile @ Level 2', &nbsp;</div></li><li><div>                0x2D =&gt; 'High Efficiency AAC Profile @ Level 3', &nbsp;</div></li><li><div>                0x2E =&gt; 'High Efficiency AAC Profile @ Level 4', &nbsp;</div></li><li><div>                0x2F =&gt; 'High Efficiency AAC Profile @ Level 5', &nbsp;</div></li><li><div>                0xFE =&gt; 'Not part of MPEG-4 audio profiles', &nbsp;</div></li><li><div>                0xFF =&gt; 'No audio capability required', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeIODSaudioProfileNameLookup[$audio_profile_id]) ? $QuicktimeIODSaudioProfileNameLookup[$audio_profile_id] : 'ISO Reserved / User Private');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeIODSvideoProfileName($video_profile_id) {&nbsp;</div></li><li><div>        static $QuicktimeIODSvideoProfileNameLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeIODSvideoProfileNameLookup)) {&nbsp;</div></li><li><div>            $QuicktimeIODSvideoProfileNameLookup = array(&nbsp;</div></li><li><div>                0x00 =&gt; 'Reserved (0x00) Profile', &nbsp;</div></li><li><div>                0x01 =&gt; 'Simple Profile @ Level 1', &nbsp;</div></li><li><div>                0x02 =&gt; 'Simple Profile @ Level 2', &nbsp;</div></li><li><div>                0x03 =&gt; 'Simple Profile @ Level 3', &nbsp;</div></li><li><div>                0x08 =&gt; 'Simple Profile @ Level 0', &nbsp;</div></li><li><div>                0x10 =&gt; 'Simple Scalable Profile @ Level 0', &nbsp;</div></li><li><div>                0x11 =&gt; 'Simple Scalable Profile @ Level 1', &nbsp;</div></li><li><div>                0x12 =&gt; 'Simple Scalable Profile @ Level 2', &nbsp;</div></li><li><div>                0x15 =&gt; 'AVC/H264 Profile', &nbsp;</div></li><li><div>                0x21 =&gt; 'Core Profile @ Level 1', &nbsp;</div></li><li><div>                0x22 =&gt; 'Core Profile @ Level 2', &nbsp;</div></li><li><div>                0x32 =&gt; 'Main Profile @ Level 2', &nbsp;</div></li><li><div>                0x33 =&gt; 'Main Profile @ Level 3', &nbsp;</div></li><li><div>                0x34 =&gt; 'Main Profile @ Level 4', &nbsp;</div></li><li><div>                0x42 =&gt; 'N-bit Profile @ Level 2', &nbsp;</div></li><li><div>                0x51 =&gt; 'Scalable Texture Profile @ Level 1', &nbsp;</div></li><li><div>                0x61 =&gt; 'Simple Face Animation Profile @ Level 1', &nbsp;</div></li><li><div>                0x62 =&gt; 'Simple Face Animation Profile @ Level 2', &nbsp;</div></li><li><div>                0x63 =&gt; 'Simple FBA Profile @ Level 1', &nbsp;</div></li><li><div>                0x64 =&gt; 'Simple FBA Profile @ Level 2', &nbsp;</div></li><li><div>                0x71 =&gt; 'Basic Animated Texture Profile @ Level 1', &nbsp;</div></li><li><div>                0x72 =&gt; 'Basic Animated Texture Profile @ Level 2', &nbsp;</div></li><li><div>                0x81 =&gt; 'Hybrid Profile @ Level 1', &nbsp;</div></li><li><div>                0x82 =&gt; 'Hybrid Profile @ Level 2', &nbsp;</div></li><li><div>                0x91 =&gt; 'Advanced Real Time Simple Profile @ Level 1', &nbsp;</div></li><li><div>                0x92 =&gt; 'Advanced Real Time Simple Profile @ Level 2', &nbsp;</div></li><li><div>                0x93 =&gt; 'Advanced Real Time Simple Profile @ Level 3', &nbsp;</div></li><li><div>                0x94 =&gt; 'Advanced Real Time Simple Profile @ Level 4', &nbsp;</div></li><li><div>                0xA1 =&gt; 'Core Scalable Profile @ Level1', &nbsp;</div></li><li><div>                0xA2 =&gt; 'Core Scalable Profile @ Level2', &nbsp;</div></li><li><div>                0xA3 =&gt; 'Core Scalable Profile @ Level3', &nbsp;</div></li><li><div>                0xB1 =&gt; 'Advanced Coding Efficiency Profile @ Level 1', &nbsp;</div></li><li><div>                0xB2 =&gt; 'Advanced Coding Efficiency Profile @ Level 2', &nbsp;</div></li><li><div>                0xB3 =&gt; 'Advanced Coding Efficiency Profile @ Level 3', &nbsp;</div></li><li><div>                0xB4 =&gt; 'Advanced Coding Efficiency Profile @ Level 4', &nbsp;</div></li><li><div>                0xC1 =&gt; 'Advanced Core Profile @ Level 1', &nbsp;</div></li><li><div>                0xC2 =&gt; 'Advanced Core Profile @ Level 2', &nbsp;</div></li><li><div>                0xD1 =&gt; 'Advanced Scalable Texture @ Level1', &nbsp;</div></li><li><div>                0xD2 =&gt; 'Advanced Scalable Texture @ Level2', &nbsp;</div></li><li><div>                0xE1 =&gt; 'Simple Studio Profile @ Level 1', &nbsp;</div></li><li><div>                0xE2 =&gt; 'Simple Studio Profile @ Level 2', &nbsp;</div></li><li><div>                0xE3 =&gt; 'Simple Studio Profile @ Level 3', &nbsp;</div></li><li><div>                0xE4 =&gt; 'Simple Studio Profile @ Level 4', &nbsp;</div></li><li><div>                0xE5 =&gt; 'Core Studio Profile @ Level 1', &nbsp;</div></li><li><div>                0xE6 =&gt; 'Core Studio Profile @ Level 2', &nbsp;</div></li><li><div>                0xE7 =&gt; 'Core Studio Profile @ Level 3', &nbsp;</div></li><li><div>                0xE8 =&gt; 'Core Studio Profile @ Level 4', &nbsp;</div></li><li><div>                0xF0 =&gt; 'Advanced Simple Profile @ Level 0', &nbsp;</div></li><li><div>                0xF1 =&gt; 'Advanced Simple Profile @ Level 1', &nbsp;</div></li><li><div>                0xF2 =&gt; 'Advanced Simple Profile @ Level 2', &nbsp;</div></li><li><div>                0xF3 =&gt; 'Advanced Simple Profile @ Level 3', &nbsp;</div></li><li><div>                0xF4 =&gt; 'Advanced Simple Profile @ Level 4', &nbsp;</div></li><li><div>                0xF5 =&gt; 'Advanced Simple Profile @ Level 5', &nbsp;</div></li><li><div>                0xF7 =&gt; 'Advanced Simple Profile @ Level 3b', &nbsp;</div></li><li><div>                0xF8 =&gt; 'Fine Granularity Scalable Profile @ Level 0', &nbsp;</div></li><li><div>                0xF9 =&gt; 'Fine Granularity Scalable Profile @ Level 1', &nbsp;</div></li><li><div>                0xFA =&gt; 'Fine Granularity Scalable Profile @ Level 2', &nbsp;</div></li><li><div>                0xFB =&gt; 'Fine Granularity Scalable Profile @ Level 3', &nbsp;</div></li><li><div>                0xFC =&gt; 'Fine Granularity Scalable Profile @ Level 4', &nbsp;</div></li><li><div>                0xFD =&gt; 'Fine Granularity Scalable Profile @ Level 5', &nbsp;</div></li><li><div>                0xFE =&gt; 'Not part of MPEG-4 Visual profiles', &nbsp;</div></li><li><div>                0xFF =&gt; 'No visual capability required', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeIODSvideoProfileNameLookup[$video_profile_id]) ? $QuicktimeIODSvideoProfileNameLookup[$video_profile_id] : 'ISO Reserved Profile');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeContentRatingLookup($rtng) {&nbsp;</div></li><li><div>        static $QuicktimeContentRatingLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeContentRatingLookup)) {&nbsp;</div></li><li><div>            $QuicktimeContentRatingLookup[0] = 'None';&nbsp;</div></li><li><div>            $QuicktimeContentRatingLookup[2] = 'Clean';&nbsp;</div></li><li><div>            $QuicktimeContentRatingLookup[4] = 'Explicit';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeContentRatingLookup[$rtng]) ? $QuicktimeContentRatingLookup[$rtng] : 'invalid');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeStoreAccountTypeLookup($akid) {&nbsp;</div></li><li><div>        static $QuicktimeStoreAccountTypeLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeStoreAccountTypeLookup)) {&nbsp;</div></li><li><div>            $QuicktimeStoreAccountTypeLookup[0] = 'iTunes';&nbsp;</div></li><li><div>            $QuicktimeStoreAccountTypeLookup[1] = 'AOL';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeStoreAccountTypeLookup[$akid]) ? $QuicktimeStoreAccountTypeLookup[$akid] : 'invalid');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeStoreFrontCodeLookup($sfid) {&nbsp;</div></li><li><div>        static $QuicktimeStoreFrontCodeLookup = array();&nbsp;</div></li><li><div>        if (empty($QuicktimeStoreFrontCodeLookup)) {&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143460] = 'Australia';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143445] = 'Austria';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143446] = 'Belgium';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143455] = 'Canada';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143458] = 'Denmark';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143447] = 'Finland';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143442] = 'France';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143443] = 'Germany';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143448] = 'Greece';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143449] = 'Ireland';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143450] = 'Italy';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143462] = 'Japan';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143451] = 'Luxembourg';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143452] = 'Netherlands';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143461] = 'New Zealand';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143457] = 'Norway';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143453] = 'Portugal';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143454] = 'Spain';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143456] = 'Sweden';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143459] = 'Switzerland';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143444] = 'United Kingdom';&nbsp;</div></li><li><div>            $QuicktimeStoreFrontCodeLookup[143441] = 'United States';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return (isset($QuicktimeStoreFrontCodeLookup[$sfid]) ? $QuicktimeStoreFrontCodeLookup[$sfid] : 'invalid');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function QuicktimeParseNikonNCTG($atom_data) {&nbsp;</div></li><li><div>        // http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html#NCTG&nbsp;</div></li><li><div>        // Nikon-specific QuickTime tags found in the NCDT atom of MOV videos from some Nikon cameras such as the Coolpix S8000 and D5100&nbsp;</div></li><li><div>        // Data is stored as records of:&nbsp;</div></li><li><div>        // * 4 bytes record type&nbsp;</div></li><li><div>        // * 2 bytes size of data field type:&nbsp;</div></li><li><div>        //     0x0001 = flag   (size field *= 1-byte)&nbsp;</div></li><li><div>        //     0x0002 = char   (size field *= 1-byte)&nbsp;</div></li><li><div>        //     0x0003 = DWORD+ (size field *= 2-byte), values are stored CDAB&nbsp;</div></li><li><div>        //     0x0004 = QWORD+ (size field *= 4-byte), values are stored EFGHABCD&nbsp;</div></li><li><div>        //     0x0005 = float  (size field *= 8-byte), values are stored aaaabbbb where value is aaaa/bbbb; possibly multiple sets of values appended together&nbsp;</div></li><li><div>        //     0x0007 = bytes  (size field *= 1-byte), values are stored as ??????&nbsp;</div></li><li><div>        //     0x0008 = ?????  (size field *= 2-byte), values are stored as ??????&nbsp;</div></li><li><div>        // * 2 bytes data size field&nbsp;</div></li><li><div>        // * ? bytes data (string data may be null-padded; datestamp fields are in the format &quot;2011:05:25 20:24:15&quot;)&nbsp;</div></li><li><div>        // all integers are stored BigEndian&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $NCTGtagName = array(&nbsp;</div></li><li><div>            0x00000001 =&gt; 'Make', &nbsp;</div></li><li><div>            0x00000002 =&gt; 'Model', &nbsp;</div></li><li><div>            0x00000003 =&gt; 'Software', &nbsp;</div></li><li><div>            0x00000011 =&gt; 'CreateDate', &nbsp;</div></li><li><div>            0x00000012 =&gt; 'DateTimeOriginal', &nbsp;</div></li><li><div>            0x00000013 =&gt; 'FrameCount', &nbsp;</div></li><li><div>            0x00000016 =&gt; 'FrameRate', &nbsp;</div></li><li><div>            0x00000022 =&gt; 'FrameWidth', &nbsp;</div></li><li><div>            0x00000023 =&gt; 'FrameHeight', &nbsp;</div></li><li><div>            0x00000032 =&gt; 'AudioChannels', &nbsp;</div></li><li><div>            0x00000033 =&gt; 'AudioBitsPerSample', &nbsp;</div></li><li><div>            0x00000034 =&gt; 'AudioSampleRate', &nbsp;</div></li><li><div>            0x02000001 =&gt; 'MakerNoteVersion', &nbsp;</div></li><li><div>            0x02000005 =&gt; 'WhiteBalance', &nbsp;</div></li><li><div>            0x0200000b =&gt; 'WhiteBalanceFineTune', &nbsp;</div></li><li><div>            0x0200001e =&gt; 'ColorSpace', &nbsp;</div></li><li><div>            0x02000023 =&gt; 'PictureControlData', &nbsp;</div></li><li><div>            0x02000024 =&gt; 'WorldTime', &nbsp;</div></li><li><div>            0x02000032 =&gt; 'UnknownInfo', &nbsp;</div></li><li><div>            0x02000083 =&gt; 'LensType', &nbsp;</div></li><li><div>            0x02000084 =&gt; 'Lens', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $offset = 0;&nbsp;</div></li><li><div>        $datalength = strlen($atom_data);&nbsp;</div></li><li><div>        $parsed = array();&nbsp;</div></li><li><div>        while ($offset &lt; $datalength) {&nbsp;</div></li><li><div>//echo getid3_lib::PrintHexBytes(substr($atom_data, $offset, 4)).'&lt;br&gt;';&nbsp;</div></li><li><div>            $record_type = getid3_lib::BigEndian2Int(substr($atom_data, $offset, 4));  $offset += 4;&nbsp;</div></li><li><div>            $data_size_type = getid3_lib::BigEndian2Int(substr($atom_data, $offset, 2));  $offset += 2;&nbsp;</div></li><li><div>            $data_size = getid3_lib::BigEndian2Int(substr($atom_data, $offset, 2));  $offset += 2;&nbsp;</div></li><li><div>            switch ($data_size_type) {&nbsp;</div></li><li><div>                case 0x0001: // 0x0001 = flag   (size field *= 1-byte)&nbsp;</div></li><li><div>                    $data = getid3_lib::BigEndian2Int(substr($atom_data, $offset, $data_size * 1));&nbsp;</div></li><li><div>                    $offset += ($data_size * 1);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x0002: // 0x0002 = char   (size field *= 1-byte)&nbsp;</div></li><li><div>                    $data = substr($atom_data, $offset, $data_size * 1);&nbsp;</div></li><li><div>                    $offset += ($data_size * 1);&nbsp;</div></li><li><div>                    $data = rtrim($data, &quot;\x00&quot;);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x0003: // 0x0003 = DWORD+ (size field *= 2-byte), values are stored CDAB&nbsp;</div></li><li><div>                    $data = '';&nbsp;</div></li><li><div>                    for ($i = $data_size - 1; $i &gt;= 0; $i--) {&nbsp;</div></li><li><div>                        $data .= substr($atom_data, $offset + ($i * 2), 2);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $data = getid3_lib::BigEndian2Int($data);&nbsp;</div></li><li><div>                    $offset += ($data_size * 2);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x0004: // 0x0004 = QWORD+ (size field *= 4-byte), values are stored EFGHABCD&nbsp;</div></li><li><div>                    $data = '';&nbsp;</div></li><li><div>                    for ($i = $data_size - 1; $i &gt;= 0; $i--) {&nbsp;</div></li><li><div>                        $data .= substr($atom_data, $offset + ($i * 4), 4);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $data = getid3_lib::BigEndian2Int($data);&nbsp;</div></li><li><div>                    $offset += ($data_size * 4);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x0005: // 0x0005 = float  (size field *= 8-byte), values are stored aaaabbbb where value is aaaa/bbbb; possibly multiple sets of values appended together&nbsp;</div></li><li><div>                    $data = array();&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $data_size; $i++) {&nbsp;</div></li><li><div>                        $numerator = getid3_lib::BigEndian2Int(substr($atom_data, $offset + ($i * 8) + 0, 4));&nbsp;</div></li><li><div>                        $denomninator = getid3_lib::BigEndian2Int(substr($atom_data, $offset + ($i * 8) + 4, 4));&nbsp;</div></li><li><div>                        if ($denomninator == 0) {&nbsp;</div></li><li><div>                            $data[$i] = false;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $data[$i] = (double) $numerator / $denomninator;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $offset += (8 * $data_size);&nbsp;</div></li><li><div>                    if (count($data) == 1) {&nbsp;</div></li><li><div>                        $data = $data[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x0007: // 0x0007 = bytes  (size field *= 1-byte), values are stored as ??????&nbsp;</div></li><li><div>                    $data = substr($atom_data, $offset, $data_size * 1);&nbsp;</div></li><li><div>                    $offset += ($data_size * 1);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x0008: // 0x0008 = ?????  (size field *= 2-byte), values are stored as ??????&nbsp;</div></li><li><div>                    $data = substr($atom_data, $offset, $data_size * 2);&nbsp;</div></li><li><div>                    $offset += ($data_size * 2);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>echo 'QuicktimeParseNikonNCTG()::unknown $data_size_type: '.$data_size_type.'&lt;br&gt;';&nbsp;</div></li><li><div>                    break 2;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch ($record_type) {&nbsp;</div></li><li><div>                case 0x00000011: // CreateDate&nbsp;</div></li><li><div>                case 0x00000012: // DateTimeOriginal&nbsp;</div></li><li><div>                    $data = strtotime($data);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x0200001e: // ColorSpace&nbsp;</div></li><li><div>                    switch ($data) {&nbsp;</div></li><li><div>                        case 1:&nbsp;</div></li><li><div>                            $data = 'sRGB';&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        case 2:&nbsp;</div></li><li><div>                            $data = 'Adobe RGB';&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x02000023: // PictureControlData&nbsp;</div></li><li><div>                    $PictureControlAdjust = array(0=&gt;'default', 1=&gt;'quick', 2=&gt;'full');&nbsp;</div></li><li><div>                    $FilterEffect = array(0x80=&gt;'off', 0x81=&gt;'yellow', 0x82=&gt;'orange', 0x83=&gt;'red', 0x84=&gt;'green', 0xff=&gt;'n/a');&nbsp;</div></li><li><div>                    $ToningEffect = array(0x80=&gt;'b&w', 0x81=&gt;'sepia', 0x82=&gt;'cyanotype', 0x83=&gt;'red', 0x84=&gt;'yellow', 0x85=&gt;'green', 0x86=&gt;'blue-green', 0x87=&gt;'blue', 0x88=&gt;'purple-blue', 0x89=&gt;'red-purple', 0xff=&gt;'n/a');&nbsp;</div></li><li><div>                    $data = array(&nbsp;</div></li><li><div>                        'PictureControlVersion' =&gt;                           substr($data, 0, 4), &nbsp;</div></li><li><div>                        'PictureControlName' =&gt;                     rtrim(substr($data, 4, 20), &quot;\x00&quot;), &nbsp;</div></li><li><div>                        'PictureControlBase' =&gt;                     rtrim(substr($data, 24, 20), &quot;\x00&quot;), &nbsp;</div></li><li><div>                        //'?' =&gt;                           substr($data, 44, 4), &nbsp;</div></li><li><div>                        'PictureControlAdjust' =&gt; $PictureControlAdjust[ord(substr($data, 48, 1))], &nbsp;</div></li><li><div>                        'PictureControlQuickAdjust' =&gt;                       ord(substr($data, 49, 1)), &nbsp;</div></li><li><div>                        'Sharpness' =&gt;                       ord(substr($data, 50, 1)), &nbsp;</div></li><li><div>                        'Contrast' =&gt;                       ord(substr($data, 51, 1)), &nbsp;</div></li><li><div>                        'Brightness' =&gt;                       ord(substr($data, 52, 1)), &nbsp;</div></li><li><div>                        'Saturation' =&gt;                       ord(substr($data, 53, 1)), &nbsp;</div></li><li><div>                        'HueAdjustment' =&gt;                       ord(substr($data, 54, 1)), &nbsp;</div></li><li><div>                        'FilterEffect' =&gt;         $FilterEffect[ord(substr($data, 55, 1))], &nbsp;</div></li><li><div>                        'ToningEffect' =&gt;         $ToningEffect[ord(substr($data, 56, 1))], &nbsp;</div></li><li><div>                        'ToningSaturation' =&gt;                       ord(substr($data, 57, 1)), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x02000024: // WorldTime&nbsp;</div></li><li><div>                    // http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Nikon.html#WorldTime&nbsp;</div></li><li><div>                    // timezone is stored as offset from GMT in minutes&nbsp;</div></li><li><div>                    $timezone = getid3_lib::BigEndian2Int(substr($data, 0, 2));&nbsp;</div></li><li><div>                    if ($timezone & 0x8000) {&nbsp;</div></li><li><div>                        $timezone = 0 - (0x10000 - $timezone);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $timezone /= 60;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $dst = (bool) getid3_lib::BigEndian2Int(substr($data, 2, 1));&nbsp;</div></li><li><div>                    switch (getid3_lib::BigEndian2Int(substr($data, 3, 1))) {&nbsp;</div></li><li><div>                        case 2:&nbsp;</div></li><li><div>                            $datedisplayformat = 'D/M/Y'; break;&nbsp;</div></li><li><div>                        case 1:&nbsp;</div></li><li><div>                            $datedisplayformat = 'M/D/Y'; break;&nbsp;</div></li><li><div>                        case 0:&nbsp;</div></li><li><div>                        default:&nbsp;</div></li><li><div>                            $datedisplayformat = 'Y/M/D'; break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $data = array('timezone'=&gt;floatval($timezone), 'dst'=&gt;$dst, 'display'=&gt;$datedisplayformat);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 0x02000083: // LensType&nbsp;</div></li><li><div>                    $data = array(&nbsp;</div></li><li><div>                        //'_' =&gt; $data, &nbsp;</div></li><li><div>                        'mf' =&gt; (bool) ($data & 0x01), &nbsp;</div></li><li><div>                        'd' =&gt; (bool) ($data & 0x02), &nbsp;</div></li><li><div>                        'g' =&gt; (bool) ($data & 0x04), &nbsp;</div></li><li><div>                        'vr' =&gt; (bool) ($data & 0x08), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $tag_name = (isset($NCTGtagName[$record_type]) ? $NCTGtagName[$record_type] : '0x'.str_pad(dechex($record_type), 8, '0', STR_PAD_LEFT));&nbsp;</div></li><li><div>            $parsed[$tag_name] = $data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $parsed;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function CopyToAppropriateCommentsSection($keyname, $data, $boxname='') {&nbsp;</div></li><li><div>        static $handyatomtranslatorarray = array();&nbsp;</div></li><li><div>        if (empty($handyatomtranslatorarray)) {&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'cpy'] = 'copyright';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'day'] = 'creation_date';    // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'dir'] = 'director';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed1'] = 'edit1';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed2'] = 'edit2';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed3'] = 'edit3';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed4'] = 'edit4';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed5'] = 'edit5';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed6'] = 'edit6';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed7'] = 'edit7';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed8'] = 'edit8';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ed9'] = 'edit9';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'fmt'] = 'format';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'inf'] = 'information';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'prd'] = 'producer';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'prf'] = 'performers';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'req'] = 'system_requirements';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'src'] = 'source_credit';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'wrt'] = 'writer';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // http://www.geocities.com/xhelmboyx/quicktime/formats/qtm-layout.txt&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'nam'] = 'title';           // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'cmt'] = 'comment';         // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'wrn'] = 'warning';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'hst'] = 'host_computer';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'mak'] = 'make';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'mod'] = 'model';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'PRD'] = 'product';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'swr'] = 'software';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'aut'] = 'author';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ART'] = 'artist';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'trk'] = 'track';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'alb'] = 'album';           // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'com'] = 'comment';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'gen'] = 'genre';           // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'ope'] = 'composer';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'url'] = 'url';&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'enc'] = 'encoder';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // http://atomicparsley.sourceforge.net/mpeg-4files.html&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'art'] = 'artist';           // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['aART'] = 'album_artist';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['trkn'] = 'track_number';     // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['disk'] = 'disc_number';      // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['gnre'] = 'genre';            // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'too'] = 'encoder';          // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['tmpo'] = 'bpm';              // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['cprt'] = 'copyright';        // iTunes 4.0?&nbsp;</div></li><li><div>            $handyatomtranslatorarray['cpil'] = 'compilation';      // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['covr'] = 'picture';          // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['rtng'] = 'rating';           // iTunes 4.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'grp'] = 'grouping';         // iTunes 4.2&nbsp;</div></li><li><div>            $handyatomtranslatorarray['stik'] = 'stik';             // iTunes 4.9&nbsp;</div></li><li><div>            $handyatomtranslatorarray['pcst'] = 'podcast';          // iTunes 4.9&nbsp;</div></li><li><div>            $handyatomtranslatorarray['catg'] = 'category';         // iTunes 4.9&nbsp;</div></li><li><div>            $handyatomtranslatorarray['keyw'] = 'keyword';          // iTunes 4.9&nbsp;</div></li><li><div>            $handyatomtranslatorarray['purl'] = 'podcast_url';      // iTunes 4.9&nbsp;</div></li><li><div>            $handyatomtranslatorarray['egid'] = 'episode_guid';     // iTunes 4.9&nbsp;</div></li><li><div>            $handyatomtranslatorarray['desc'] = 'description';      // iTunes 5.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray[&quot;\xA9&quot;.'lyr'] = 'lyrics';           // iTunes 5.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['tvnn'] = 'tv_network_name';  // iTunes 6.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['tvsh'] = 'tv_show_name';     // iTunes 6.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['tvsn'] = 'tv_season';        // iTunes 6.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['tves'] = 'tv_episode';       // iTunes 6.0&nbsp;</div></li><li><div>            $handyatomtranslatorarray['purd'] = 'purchase_date';    // iTunes 6.0.2&nbsp;</div></li><li><div>            $handyatomtranslatorarray['pgap'] = 'gapless_playback'; // iTunes 7.0&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // http://www.geocities.com/xhelmboyx/quicktime/formats/mp4-layout.txt&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // boxnames:&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>            $handyatomtranslatorarray['iTunSMPB'] = 'iTunSMPB';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['iTunNORM'] = 'iTunNORM';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['Encoding Params'] = 'Encoding Params';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['replaygain_track_gain'] = 'replaygain_track_gain';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['replaygain_track_peak'] = 'replaygain_track_peak';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['replaygain_track_minmax'] = 'replaygain_track_minmax';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['MusicIP PUID'] = 'MusicIP PUID';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['MusicBrainz Artist Id'] = 'MusicBrainz Artist Id';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['MusicBrainz Album Id'] = 'MusicBrainz Album Id';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['MusicBrainz Album Artist Id'] = 'MusicBrainz Album Artist Id';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['MusicBrainz Track Id'] = 'MusicBrainz Track Id';&nbsp;</div></li><li><div>            $handyatomtranslatorarray['MusicBrainz Disc Id'] = 'MusicBrainz Disc Id';&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>            // http://age.hobba.nl/audio/tag_frame_reference.html&nbsp;</div></li><li><div>            $handyatomtranslatorarray['PLAY_COUNTER'] = 'play_counter'; // Foobar2000 - http://www.getid3.org/phpBB3/viewtopic.php?t=1355&nbsp;</div></li><li><div>            $handyatomtranslatorarray['MEDIATYPE'] = 'mediatype';    // Foobar2000 - http://www.getid3.org/phpBB3/viewtopic.php?t=1355&nbsp;</div></li><li><div>            */&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $info = &$this-&gt;getid3-&gt;info;&nbsp;</div></li><li><div>        $comment_key = '';&nbsp;</div></li><li><div>        if ($boxname && ($boxname != $keyname)) {&nbsp;</div></li><li><div>            $comment_key = (isset($handyatomtranslatorarray[$boxname]) ? $handyatomtranslatorarray[$boxname] : $boxname);&nbsp;</div></li><li><div>        } elseif (isset($handyatomtranslatorarray[$keyname])) {&nbsp;</div></li><li><div>            $comment_key = $handyatomtranslatorarray[$keyname];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($comment_key) {&nbsp;</div></li><li><div>            if ($comment_key == 'picture') {&nbsp;</div></li><li><div>                if (!is_array($data)) {&nbsp;</div></li><li><div>                    $image_mime = '';&nbsp;</div></li><li><div>                    if (preg_match('#^\x89\x50\x4E\x47\x0D\x0A\x1A\x0A#', $data)) {&nbsp;</div></li><li><div>                        $image_mime = 'image/png';&nbsp;</div></li><li><div>                    } elseif (preg_match('#^\xFF\xD8\xFF#', $data)) {&nbsp;</div></li><li><div>                        $image_mime = 'image/jpeg';&nbsp;</div></li><li><div>                    } elseif (preg_match('#^GIF#', $data)) {&nbsp;</div></li><li><div>                        $image_mime = 'image/gif';&nbsp;</div></li><li><div>                    } elseif (preg_match('#^BM#', $data)) {&nbsp;</div></li><li><div>                        $image_mime = 'image/bmp';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $data = array('data'=&gt;$data, 'image_mime'=&gt;$image_mime);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $info['quicktime']['comments'][$comment_key][] = $data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function NoNullString($nullterminatedstring) {&nbsp;</div></li><li><div>        // remove the single null terminator on null terminated strings&nbsp;</div></li><li><div>        if (substr($nullterminatedstring, strlen($nullterminatedstring) - 1, 1) === &quot;\x00&quot;) {&nbsp;</div></li><li><div>            return substr($nullterminatedstring, 0, strlen($nullterminatedstring) - 1);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $nullterminatedstring;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function Pascal2String($pascalstring) {&nbsp;</div></li><li><div>        // Pascal strings have 1 unsigned byte at the beginning saying how many chars (1-255) are in the string&nbsp;</div></li><li><div>        return substr($pascalstring, 1);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.7</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/getid3_quicktime/" class="">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/getid3_quicktime/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/getid3_quicktime/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/getid3_quicktime/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/getid3_quicktime/" class="active">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>getid3_quicktime</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>