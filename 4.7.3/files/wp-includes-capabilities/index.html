<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.3" data-type="file" data-id="4629"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-capabilities | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.3" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=5dba8e512b993473dc8dff7504e27726' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-capabilities/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-capabilities%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-capabilities%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.3-file-wp-includes-capabilities","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-capabilities" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.3." href="http://hookr.io/4.7.3/" class="H_VERSION"><span property="name">4.7.3</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-capabilities</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6309"><a href="http://hookr.io/4.7.3/all/" title="All">All <span class="count badge">6309</span></a></li><li class="" data-id="new" data-count="1"><a href="http://hookr.io/4.7.3/new/" title="New">New <span class="count badge">1</span></a></li><li class="" data-id="hooks" data-count="2532"><a href="http://hookr.io/4.7.3/hooks/" title="Hooks">Hooks <span class="count badge">2532</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.3/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1668"><a href="http://hookr.io/4.7.3/filters/" title="Filters">Filters <span class="count badge">1668</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.3/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.3/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2852"><a href="http://hookr.io/4.7.3/functions/" title="Functions">Functions <span class="count badge">2852</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/capabilities.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Core User Role & Capabilities API</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Users</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Map meta capabilities to primitive capabilities.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This does not actually compare whether the user ID has the actual capability, </span>&nbsp;</div></li><li><div><span class="comment"> * just what the capability or capabilities are. Meta capability list value can</span>&nbsp;</div></li><li><div><span class="comment"> * be 'delete_user', 'edit_user', 'remove_user', 'promote_user', 'delete_post', </span>&nbsp;</div></li><li><div><span class="comment"> * 'delete_page', 'edit_post', 'edit_page', 'read_post', or 'read_page'.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $post_type_meta_caps Used to get post type meta capabilities.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $cap       Capability name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id   User ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $object_id Optional. ID of the specific object to check against if `$cap` is a &quot;meta&quot; cap.</span>&nbsp;</div></li><li><div><span class="comment"> *                          &quot;Meta&quot; capabilities, e.g. 'edit_post', 'edit_user', etc., are capabilities used</span>&nbsp;</div></li><li><div><span class="comment"> *                          by map_meta_cap() to map to other &quot;primitive&quot; capabilities, e.g. 'edit_posts', </span>&nbsp;</div></li><li><div><span class="comment"> *                          'edit_others_posts', etc. The parameter is accessed via func_get_args().</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Actual capabilities for meta capability.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function map_meta_cap( $cap, $user_id ) {&nbsp;</div></li><li><div>  $args = array_slice( func_get_args(), 2 );&nbsp;</div></li><li><div>  $caps = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $cap ) {&nbsp;</div></li><li><div>  case 'remove_user':&nbsp;</div></li><li><div>      $caps[] = 'remove_users';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'promote_user':&nbsp;</div></li><li><div>  case 'add_users':&nbsp;</div></li><li><div>      $caps[] = 'promote_users';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'edit_user':&nbsp;</div></li><li><div>  case 'edit_users':&nbsp;</div></li><li><div>      <span class="comment">// Allow user to edit itself</span>&nbsp;</div></li><li><div>      if ( 'edit_user' == $cap && isset( $args[0] ) && $user_id == $args[0] )&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// In multisite the user must have manage_network_users caps. If editing a super admin, the user must be a super admin.</span>&nbsp;</div></li><li><div>      if ( is_multisite() && ( ( ! is_super_admin( $user_id ) && 'edit_user' === $cap && is_super_admin( $args[0] ) ) || ! user_can( $user_id, 'manage_network_users' ) ) ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $caps[] = 'edit_users'; <span class="comment">// edit_user maps to edit_users.</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'delete_post':&nbsp;</div></li><li><div>  case 'delete_page':&nbsp;</div></li><li><div>      $post = get_post( $args[0] );&nbsp;</div></li><li><div>      if ( ! $post ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'revision' == $post-&gt;post_type ) {&nbsp;</div></li><li><div>          $post = get_post( $post-&gt;post_parent );&nbsp;</div></li><li><div>          if ( ! $post ) {&nbsp;</div></li><li><div>              $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( get_option( 'page_for_posts' ) == $post-&gt;ID ) || ( get_option( 'page_on_front' ) == $post-&gt;ID ) ) {&nbsp;</div></li><li><div>          $caps[] = 'manage_options';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_type = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>      if ( ! $post_type ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: post type, 2: capability name */</span></span></span></span>&nbsp;</div></li><li><div>          _doing_it_wrong( __FUNCTION__, sprintf( __( 'The post type %1$s is not registered, so it may not be reliable to check the capability &quot;%2$s&quot; against a post of that type.' ), $post-&gt;post_type, $cap ), '4.4.0' );&nbsp;</div></li><li><div>          $caps[] = 'edit_others_posts';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $post_type-&gt;map_meta_cap ) {&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;$cap;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Prior to 3.1 we would re-call map_meta_cap here.</span></span></span>&nbsp;</div></li><li><div>          if ( 'delete_post' == $cap )&nbsp;</div></li><li><div>              $cap = $post_type-&gt;cap-&gt;$cap;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If the post author is set and the user is the author...</span></span>&nbsp;</div></li><li><div>      if ( $post-&gt;post_author && $user_id == $post-&gt;post_author ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// If the post is published or scheduled...</span></span>&nbsp;</div></li><li><div>          if ( in_array( $post-&gt;post_status, array( 'publish', 'future' ), true ) ) {&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;delete_published_posts;&nbsp;</div></li><li><div>          } elseif ( 'trash' == $post-&gt;post_status ) {&nbsp;</div></li><li><div>              $status = get_post_meta( $post-&gt;ID, '_wp_trash_meta_status', true );&nbsp;</div></li><li><div>              if ( in_array( $status, array( 'publish', 'future' ), true ) ) {&nbsp;</div></li><li><div>                  $caps[] = $post_type-&gt;cap-&gt;delete_published_posts;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $caps[] = $post_type-&gt;cap-&gt;delete_posts;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// If the post is draft...</span></span>&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;delete_posts;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// The user is trying to edit someone else's post.</span></span>&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;delete_others_posts;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// The post is published or scheduled, extra cap required.</span></span>&nbsp;</div></li><li><div>          if ( in_array( $post-&gt;post_status, array( 'publish', 'future' ), true ) ) {&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;delete_published_posts;&nbsp;</div></li><li><div>          } elseif ( 'private' == $post-&gt;post_status ) {&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;delete_private_posts;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>      <span class="comment">// edit_post breaks down to edit_posts, edit_published_posts, or</span>&nbsp;</div></li><li><div>      <span class="comment">// edit_others_posts</span>&nbsp;</div></li><li><div>  case 'edit_post':&nbsp;</div></li><li><div>  case 'edit_page':&nbsp;</div></li><li><div>      $post = get_post( $args[0] );&nbsp;</div></li><li><div>      if ( ! $post ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'revision' == $post-&gt;post_type ) {&nbsp;</div></li><li><div>          $post = get_post( $post-&gt;post_parent );&nbsp;</div></li><li><div>          if ( ! $post ) {&nbsp;</div></li><li><div>              $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_type = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>      if ( ! $post_type ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: post type, 2: capability name */</span></span></span></span>&nbsp;</div></li><li><div>          _doing_it_wrong( __FUNCTION__, sprintf( __( 'The post type %1$s is not registered, so it may not be reliable to check the capability &quot;%2$s&quot; against a post of that type.' ), $post-&gt;post_type, $cap ), '4.4.0' );&nbsp;</div></li><li><div>          $caps[] = 'edit_others_posts';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $post_type-&gt;map_meta_cap ) {&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;$cap;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Prior to 3.1 we would re-call map_meta_cap here.</span></span></span>&nbsp;</div></li><li><div>          if ( 'edit_post' == $cap )&nbsp;</div></li><li><div>              $cap = $post_type-&gt;cap-&gt;$cap;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If the post author is set and the user is the author...</span></span>&nbsp;</div></li><li><div>      if ( $post-&gt;post_author && $user_id == $post-&gt;post_author ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// If the post is published or scheduled...</span></span>&nbsp;</div></li><li><div>          if ( in_array( $post-&gt;post_status, array( 'publish', 'future' ), true ) ) {&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;edit_published_posts;&nbsp;</div></li><li><div>          } elseif ( 'trash' == $post-&gt;post_status ) {&nbsp;</div></li><li><div>              $status = get_post_meta( $post-&gt;ID, '_wp_trash_meta_status', true );&nbsp;</div></li><li><div>              if ( in_array( $status, array( 'publish', 'future' ), true ) ) {&nbsp;</div></li><li><div>                  $caps[] = $post_type-&gt;cap-&gt;edit_published_posts;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $caps[] = $post_type-&gt;cap-&gt;edit_posts;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// If the post is draft...</span></span>&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;edit_posts;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// The user is trying to edit someone else's post.</span></span>&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;edit_others_posts;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// The post is published or scheduled, extra cap required.</span></span>&nbsp;</div></li><li><div>          if ( in_array( $post-&gt;post_status, array( 'publish', 'future' ), true ) ) {&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;edit_published_posts;&nbsp;</div></li><li><div>          } elseif ( 'private' == $post-&gt;post_status ) {&nbsp;</div></li><li><div>              $caps[] = $post_type-&gt;cap-&gt;edit_private_posts;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'read_post':&nbsp;</div></li><li><div>  case 'read_page':&nbsp;</div></li><li><div>      $post = get_post( $args[0] );&nbsp;</div></li><li><div>      if ( ! $post ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'revision' == $post-&gt;post_type ) {&nbsp;</div></li><li><div>          $post = get_post( $post-&gt;post_parent );&nbsp;</div></li><li><div>          if ( ! $post ) {&nbsp;</div></li><li><div>              $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_type = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>      if ( ! $post_type ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: post type, 2: capability name */</span></span></span></span>&nbsp;</div></li><li><div>          _doing_it_wrong( __FUNCTION__, sprintf( __( 'The post type %1$s is not registered, so it may not be reliable to check the capability &quot;%2$s&quot; against a post of that type.' ), $post-&gt;post_type, $cap ), '4.4.0' );&nbsp;</div></li><li><div>          $caps[] = 'edit_others_posts';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $post_type-&gt;map_meta_cap ) {&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;$cap;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Prior to 3.1 we would re-call map_meta_cap here.</span></span></span>&nbsp;</div></li><li><div>          if ( 'read_post' == $cap )&nbsp;</div></li><li><div>              $cap = $post_type-&gt;cap-&gt;$cap;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $status_obj = get_post_status_object( $post-&gt;post_status );&nbsp;</div></li><li><div>      if ( $status_obj-&gt;public ) {&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;read;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $post-&gt;post_author && $user_id == $post-&gt;post_author ) {&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;read;&nbsp;</div></li><li><div>      } elseif ( $status_obj-&gt;private ) {&nbsp;</div></li><li><div>          $caps[] = $post_type-&gt;cap-&gt;read_private_posts;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $caps = map_meta_cap( 'edit_post', $user_id, $post-&gt;ID );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'publish_post':&nbsp;</div></li><li><div>      $post = get_post( $args[0] );&nbsp;</div></li><li><div>      if ( ! $post ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_type = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>      if ( ! $post_type ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: post type, 2: capability name */</span></span></span></span>&nbsp;</div></li><li><div>          _doing_it_wrong( __FUNCTION__, sprintf( __( 'The post type %1$s is not registered, so it may not be reliable to check the capability &quot;%2$s&quot; against a post of that type.' ), $post-&gt;post_type, $cap ), '4.4.0' );&nbsp;</div></li><li><div>          $caps[] = 'edit_others_posts';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $caps[] = $post_type-&gt;cap-&gt;publish_posts;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'edit_post_meta':&nbsp;</div></li><li><div>  case 'delete_post_meta':&nbsp;</div></li><li><div>  case 'add_post_meta':&nbsp;</div></li><li><div>  case 'edit_comment_meta':&nbsp;</div></li><li><div>  case 'delete_comment_meta':&nbsp;</div></li><li><div>  case 'add_comment_meta':&nbsp;</div></li><li><div>  case 'edit_term_meta':&nbsp;</div></li><li><div>  case 'delete_term_meta':&nbsp;</div></li><li><div>  case 'add_term_meta':&nbsp;</div></li><li><div>  case 'edit_user_meta':&nbsp;</div></li><li><div>  case 'delete_user_meta':&nbsp;</div></li><li><div>  case 'add_user_meta':&nbsp;</div></li><li><div>      list( $_, $object_type, $_ ) = explode( '_', $cap );&nbsp;</div></li><li><div>      $object_id = (int) $args[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $object_type ) {&nbsp;</div></li><li><div>          case 'post':&nbsp;</div></li><li><div>              $post = get_post( $object_id );&nbsp;</div></li><li><div>              if ( ! $post ) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sub_type = get_post_type( $post );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'comment':&nbsp;</div></li><li><div>              $comment = get_comment( $object_id );&nbsp;</div></li><li><div>              if ( ! $comment ) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sub_type = empty( $comment-&gt;comment_type ) ? 'comment' : $comment-&gt;comment_type;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'term':&nbsp;</div></li><li><div>              $term = get_term( $object_id );&nbsp;</div></li><li><div>              if ( ! $term ) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sub_type = $term-&gt;taxonomy;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'user':&nbsp;</div></li><li><div>              $user = get_user_by( 'id', $object_id );&nbsp;</div></li><li><div>              if ( ! $user ) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sub_type = 'user';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $sub_type ) ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $caps = map_meta_cap( &quot;edit_{$object_type}&quot;, $user_id, $object_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta_key = isset( $args[1] ) ? $args[1] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $has_filter = has_filter( &quot;auth_{$object_type}_meta_{$meta_key}&quot; ) || has_filter( &quot;auth_{$object_type}_{$sub_type}_meta_{$meta_key}&quot; );&nbsp;</div></li><li><div>      if ( $meta_key && $has_filter ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** This filter is documented in wp-includes/meta.php */</span></span>&nbsp;</div></li><li><div>          $allowed = apply_filters( &quot;auth_{$object_type}_meta_{$meta_key}&quot;, false, $meta_key, $object_id, $user_id, $cap, $caps );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** This filter is documented in wp-includes/meta.php */</span></span>&nbsp;</div></li><li><div>          $allowed = apply_filters( &quot;auth_{$object_type}_{$sub_type}_meta_{$meta_key}&quot;, $allowed, $meta_key, $object_id, $user_id, $cap, $caps );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $allowed ) {&nbsp;</div></li><li><div>              $caps[] = $cap;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( $meta_key && is_protected_meta( $meta_key, $object_type ) ) {&nbsp;</div></li><li><div>          $caps[] = $cap;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'edit_comment':&nbsp;</div></li><li><div>      $comment = get_comment( $args[0] );&nbsp;</div></li><li><div>      if ( ! $comment ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post = get_post( $comment-&gt;comment_post_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * If the post doesn't exist, we have an orphaned comment.</span>&nbsp;</div></li><li><div><span class="comment">       * Fall back to the edit_posts capability, instead.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( $post ) {&nbsp;</div></li><li><div>          $caps = map_meta_cap( 'edit_post', $user_id, $post-&gt;ID );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $caps = map_meta_cap( 'edit_posts', $user_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'unfiltered_upload':&nbsp;</div></li><li><div>      if ( defined('ALLOW_UNFILTERED_UPLOADS') && ALLOW_UNFILTERED_UPLOADS && ( !is_multisite() || is_super_admin( $user_id ) ) )&nbsp;</div></li><li><div>          $caps[] = $cap;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'edit_css' :&nbsp;</div></li><li><div>  case 'unfiltered_html' :&nbsp;</div></li><li><div>      <span class="comment">// Disallow unfiltered_html for all users, even admins and super admins.</span>&nbsp;</div></li><li><div>      if ( defined( 'DISALLOW_UNFILTERED_HTML' ) && DISALLOW_UNFILTERED_HTML )&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      elseif ( is_multisite() && ! is_super_admin( $user_id ) )&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $caps[] = 'unfiltered_html';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'edit_files':&nbsp;</div></li><li><div>  case 'edit_plugins':&nbsp;</div></li><li><div>  case 'edit_themes':&nbsp;</div></li><li><div>      <span class="comment">// Disallow the file editors.</span>&nbsp;</div></li><li><div>      if ( defined( 'DISALLOW_FILE_EDIT' ) && DISALLOW_FILE_EDIT )&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      elseif ( defined( 'DISALLOW_FILE_MODS' ) && DISALLOW_FILE_MODS )&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      elseif ( is_multisite() && ! is_super_admin( $user_id ) )&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $caps[] = $cap;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'update_plugins':&nbsp;</div></li><li><div>  case 'delete_plugins':&nbsp;</div></li><li><div>  case 'install_plugins':&nbsp;</div></li><li><div>  case 'upload_plugins':&nbsp;</div></li><li><div>  case 'update_themes':&nbsp;</div></li><li><div>  case 'delete_themes':&nbsp;</div></li><li><div>  case 'install_themes':&nbsp;</div></li><li><div>  case 'upload_themes':&nbsp;</div></li><li><div>  case 'update_core':&nbsp;</div></li><li><div>      <span class="comment">// Disallow anything that creates, deletes, or updates core, plugin, or theme files.</span>&nbsp;</div></li><li><div>      <span class="comment">// Files in uploads are excepted.</span>&nbsp;</div></li><li><div>      if ( defined( 'DISALLOW_FILE_MODS' ) && DISALLOW_FILE_MODS ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      } elseif ( is_multisite() && ! is_super_admin( $user_id ) ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      } elseif ( 'upload_themes' === $cap ) {&nbsp;</div></li><li><div>          $caps[] = 'install_themes';&nbsp;</div></li><li><div>      } elseif ( 'upload_plugins' === $cap ) {&nbsp;</div></li><li><div>          $caps[] = 'install_plugins';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $caps[] = $cap;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'activate_plugins':&nbsp;</div></li><li><div>      $caps[] = $cap;&nbsp;</div></li><li><div>      if ( is_multisite() ) {&nbsp;</div></li><li><div>          <span class="comment">// update_, install_, and delete_ are handled above with is_super_admin().</span>&nbsp;</div></li><li><div>          $menu_perms = get_site_option( 'menu_items', array() );&nbsp;</div></li><li><div>          if ( empty( $menu_perms['plugins'] ) )&nbsp;</div></li><li><div>              $caps[] = 'manage_network_plugins';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'delete_user':&nbsp;</div></li><li><div>  case 'delete_users':&nbsp;</div></li><li><div>      <span class="comment">// If multisite only super admins can delete users.</span>&nbsp;</div></li><li><div>      if ( is_multisite() && ! is_super_admin( $user_id ) )&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $caps[] = 'delete_users'; <span class="comment">// delete_user maps to delete_users.</span>&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'create_users':&nbsp;</div></li><li><div>      if ( !is_multisite() )&nbsp;</div></li><li><div>          $caps[] = $cap;&nbsp;</div></li><li><div>      elseif ( is_super_admin( $user_id ) || get_site_option( 'add_new_users' ) )&nbsp;</div></li><li><div>          $caps[] = $cap;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'manage_links' :&nbsp;</div></li><li><div>      if ( get_option( 'link_manager_enabled' ) )&nbsp;</div></li><li><div>          $caps[] = $cap;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'customize' :&nbsp;</div></li><li><div>      $caps[] = 'edit_theme_options';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'delete_site':&nbsp;</div></li><li><div>      $caps[] = 'manage_options';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'edit_term':&nbsp;</div></li><li><div>  case 'delete_term':&nbsp;</div></li><li><div>  case 'assign_term':&nbsp;</div></li><li><div>      $term_id = (int) $args[0];&nbsp;</div></li><li><div>      $term = get_term( $term_id );&nbsp;</div></li><li><div>      if ( ! $term || is_wp_error( $term ) ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tax = get_taxonomy( $term-&gt;taxonomy );&nbsp;</div></li><li><div>      if ( ! $tax ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'delete_term' === $cap && ( $term-&gt;term_id == get_option( 'default_' . $term-&gt;taxonomy ) ) ) {&nbsp;</div></li><li><div>          $caps[] = 'do_not_allow';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $taxo_cap = $cap . 's';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $caps = map_meta_cap( $tax-&gt;cap-&gt;$taxo_cap, $user_id, $term_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'manage_post_tags':&nbsp;</div></li><li><div>  case 'edit_categories':&nbsp;</div></li><li><div>  case 'edit_post_tags':&nbsp;</div></li><li><div>  case 'delete_categories':&nbsp;</div></li><li><div>  case 'delete_post_tags':&nbsp;</div></li><li><div>      $caps[] = 'manage_categories';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'assign_categories':&nbsp;</div></li><li><div>  case 'assign_post_tags':&nbsp;</div></li><li><div>      $caps[] = 'edit_posts';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'create_sites':&nbsp;</div></li><li><div>  case 'delete_sites':&nbsp;</div></li><li><div>  case 'manage_network':&nbsp;</div></li><li><div>  case 'manage_sites':&nbsp;</div></li><li><div>  case 'manage_network_users':&nbsp;</div></li><li><div>  case 'manage_network_plugins':&nbsp;</div></li><li><div>  case 'manage_network_themes':&nbsp;</div></li><li><div>  case 'manage_network_options':&nbsp;</div></li><li><div>      $caps[] = $cap;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  default:&nbsp;</div></li><li><div>      <span class="comment">// Handle meta capabilities for custom post types.</span>&nbsp;</div></li><li><div>      global $post_type_meta_caps;&nbsp;</div></li><li><div>      if ( isset( $post_type_meta_caps[ $cap ] ) ) {&nbsp;</div></li><li><div>          $args = array_merge( array( $post_type_meta_caps[ $cap ], $user_id ), $args );&nbsp;</div></li><li><div>          return call_user_func_array( 'map_meta_cap', $args );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If no meta caps match, return the original cap.</span>&nbsp;</div></li><li><div>      $caps[] = $cap;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a user's capabilities depending on specific context and/or privilege.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $caps    Returns the user's actual capabilities.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $cap     Capability name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $user_id The user ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args    Adds the context to the cap. Typically the object ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'map_meta_cap', $caps, $cap, $user_id, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether the current user has a specific capability.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * While checking against particular roles in place of a capability is supported</span>&nbsp;</div></li><li><div><span class="comment"> * in part, this practice is discouraged as it may produce unreliable results.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Note: Will always return true if the current user is a super admin, unless specifically denied.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see WP_User::has_cap()</span>&nbsp;</div></li><li><div><span class="comment"> * @see map_meta_cap()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $capability Capability name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $object_id  Optional. ID of the specific object to check against if `$capability` is a &quot;meta&quot; cap.</span>&nbsp;</div></li><li><div><span class="comment"> *                           &quot;Meta&quot; capabilities, e.g. 'edit_post', 'edit_user', etc., are capabilities used</span>&nbsp;</div></li><li><div><span class="comment"> *                           by map_meta_cap() to map to other &quot;primitive&quot; capabilities, e.g. 'edit_posts', </span>&nbsp;</div></li><li><div><span class="comment"> *                           'edit_others_posts', etc. Accessed via func_get_args() and passed to WP_User::has_cap(), </span>&nbsp;</div></li><li><div><span class="comment"> *                           then map_meta_cap().</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether the current user has the given capability. If `$capability` is a meta cap and `$object_id` is</span>&nbsp;</div></li><li><div><span class="comment"> *              passed, whether the current user has the given meta capability for the given object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function current_user_can( $capability ) {&nbsp;</div></li><li><div>  $current_user = wp_get_current_user();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $current_user ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array_slice( func_get_args(), 1 );&nbsp;</div></li><li><div>  $args = array_merge( array( $capability ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return call_user_func_array( array( $current_user, 'has_cap' ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether current user has a capability or role for a given site.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $blog_id    Site ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $capability Capability or role name.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function current_user_can_for_blog( $blog_id, $capability ) {&nbsp;</div></li><li><div>  $switched = is_multisite() ? switch_to_blog( $blog_id ) : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_user = wp_get_current_user();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $current_user ) ) {&nbsp;</div></li><li><div>      if ( $switched ) {&nbsp;</div></li><li><div>          restore_current_blog();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array_slice( func_get_args(), 2 );&nbsp;</div></li><li><div>  $args = array_merge( array( $capability ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $can = call_user_func_array( array( $current_user, 'has_cap' ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $switched ) {&nbsp;</div></li><li><div>      restore_current_blog();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $can;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether author of supplied post has capability or role.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|object $post Post ID or post object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $capability Capability or role name.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function author_can( $post, $capability ) {&nbsp;</div></li><li><div>  if ( !$post = get_post($post) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $author = get_userdata( $post-&gt;post_author );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $author )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array_slice( func_get_args(), 2 );&nbsp;</div></li><li><div>  $args = array_merge( array( $capability ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return call_user_func_array( array( $author, 'has_cap' ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether a particular user has capability or role.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|object $user User ID or object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $capability Capability or role name.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function user_can( $user, $capability ) {&nbsp;</div></li><li><div>  if ( ! is_object( $user ) )&nbsp;</div></li><li><div>      $user = get_userdata( $user );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user || ! $user-&gt;exists() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array_slice( func_get_args(), 2 );&nbsp;</div></li><li><div>  $args = array_merge( array( $capability ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return call_user_func_array( array( $user, 'has_cap' ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the global WP_Roles instance and instantiates it if necessary.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Roles $wp_roles WP_Roles global instance.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Roles WP_Roles global instance if not already instantiated.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_roles() {&nbsp;</div></li><li><div>  global $wp_roles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $wp_roles ) ) {&nbsp;</div></li><li><div>      $wp_roles = new WP_Roles();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $wp_roles;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve role object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $role Role name.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Role|null WP_Role object if found, null if the role does not exist.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_role( $role ) {&nbsp;</div></li><li><div>  return wp_roles()-&gt;get_role( $role );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add role, if it does not exist.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $role Role name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $display_name Display name for role.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $capabilities List of capabilities, e.g. array( 'edit_posts' =&gt; true, 'delete_posts' =&gt; false );</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Role|null WP_Role object if role is added, null if already exists.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_role( $role, $display_name, $capabilities = array() ) {&nbsp;</div></li><li><div>  if ( empty( $role ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return wp_roles()-&gt;add_role( $role, $display_name, $capabilities );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove role, if it exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $role Role name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_role( $role ) {&nbsp;</div></li><li><div>  wp_roles()-&gt;remove_role( $role );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve a list of super admins.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $super_admins</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array List of super admin logins</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_super_admins() {&nbsp;</div></li><li><div>  global $super_admins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset($super_admins) )&nbsp;</div></li><li><div>      return $super_admins;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      return get_site_option( 'site_admins', array('admin') );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Determine if user is a site admin.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id (Optional) The ID of a user. Defaults to the current user.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the user is a site admin.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_super_admin( $user_id = false ) {&nbsp;</div></li><li><div>  if ( ! $user_id || $user_id == get_current_user_id() )&nbsp;</div></li><li><div>      $user = wp_get_current_user();&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $user = get_userdata( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user || ! $user-&gt;exists() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_multisite() ) {&nbsp;</div></li><li><div>      $super_admins = get_super_admins();&nbsp;</div></li><li><div>      if ( is_array( $super_admins ) && in_array( $user-&gt;user_login, $super_admins ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( $user-&gt;has_cap('delete_users') )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Grants Super Admin privileges.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $super_admins</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user to be granted Super Admin privileges.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure. This can fail when the user is</span>&nbsp;</div></li><li><div><span class="comment"> *              already a super admin or when the `$super_admins` global is defined.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function grant_super_admin( $user_id ) {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// If global super_admins override is defined, there is nothing to do here.</span></span>&nbsp;</div></li><li><div>  if ( isset( $GLOBALS['super_admins'] ) || ! is_multisite() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the user is granted Super Admin privileges.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id ID of the user that is about to be granted Super Admin privileges.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'grant_super_admin', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Directly fetch site_admins instead of using get_super_admins()</span></span>&nbsp;</div></li><li><div>  $super_admins = get_site_option( 'site_admins', array( 'admin' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user = get_userdata( $user_id );&nbsp;</div></li><li><div>  if ( $user && ! in_array( $user-&gt;user_login, $super_admins ) ) {&nbsp;</div></li><li><div>      $super_admins[] = $user-&gt;user_login;&nbsp;</div></li><li><div>      update_site_option( 'site_admins' , $super_admins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the user is granted Super Admin privileges.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $user_id ID of the user that was granted Super Admin privileges.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'granted_super_admin', $user_id );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Revokes Super Admin privileges.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $super_admins</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user Super Admin privileges to be revoked from.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure. This can fail when the user's email</span>&nbsp;</div></li><li><div><span class="comment"> *              is the network admin email or when the `$super_admins` global is defined.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function revoke_super_admin( $user_id ) {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// If global super_admins override is defined, there is nothing to do here.</span></span>&nbsp;</div></li><li><div>  if ( isset( $GLOBALS['super_admins'] ) || ! is_multisite() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the user's Super Admin privileges are revoked.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id ID of the user Super Admin privileges are being revoked from.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'revoke_super_admin', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Directly fetch site_admins instead of using get_super_admins()</span></span>&nbsp;</div></li><li><div>  $super_admins = get_site_option( 'site_admins', array( 'admin' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user = get_userdata( $user_id );&nbsp;</div></li><li><div>  if ( $user && 0 !== strcasecmp( $user-&gt;user_email, get_site_option( 'admin_email' ) ) ) {&nbsp;</div></li><li><div>      if ( false !== ( $key = array_search( $user-&gt;user_login, $super_admins ) ) ) {&nbsp;</div></li><li><div>          unset( $super_admins[$key] );&nbsp;</div></li><li><div>          update_site_option( 'site_admins', $super_admins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after the user's Super Admin privileges are revoked.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $user_id ID of the user Super Admin privileges were revoked from.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'revoked_super_admin', $user_id );&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>