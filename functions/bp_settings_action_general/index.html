<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr function lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr function lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr function lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr function ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr function gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr function" data-site="wordpress" data-id="53559"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp_settings_action_general | function | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="bp_settings_action_general, function, plugin, buddypress, 2.8.2" /><meta name="description" content="Handles the changing and saving of user email addresses and passwords." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=81c31bbf364225cbd34e2fd862e4a2e0' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/functions/bp_settings_action_general/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fbp_settings_action_general%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fbp_settings_action_general%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-2.8.2-function-bp_settings_action_general","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp_settings_action_general" class="single single-function single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to functions." href="http://hookr.io/plugins/buddypress/2.8.2/functions/" class=""><span property="name">functions</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp_settings_action_general</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="function"><ul role="navigation"><li class="" data-id="all" data-count="0"><a href="http://hookr.io/2.8.2/all/" title="All">All <span class="count badge">0</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/2.8.2/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/2.8.2/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="" data-id="class" data-count="0"><a href="http://hookr.io/2.8.2/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/2.8.2/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="active" data-id="function" data-count="0"><a href="http://hookr.io/2.8.2/functions/" title="Functions">Functions <span class="count badge">0</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>bp_settings_action_general</strong></h1><p>Handles the changing and saving of user email addresses and passwords.</p> </section> <section id="description"><h2>Description</h2><pre><div>bp_settings_action_general();&nbsp;</div></pre><p>We do quite a bit of logic and error handling here to make sure that users do not accidentally lock themselves out of their accounts. We also try to provide as accurate of feedback as possible without exposing anyone else's information to them.</p><p> Special considerations are made for super admins that are able to edit any users accounts already, without knowing their existing password.</p> </section><hr /> <section id="usage"><h2>Usage</h2><pre><ol><li><div>if ( !function_exists( '<span class="func">bp_settings_action_general</span>' ) ) {&nbsp;</div></li><li><div>    require_once '/bp-settings/bp-settings-actions.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// NOTICE! Understand what this does before running.</span>&nbsp;</div></li><li><div><span class="param">$result</span> = <span class="func">bp_settings_action_general</span>(<span class="param"></span>);&nbsp;</div></li><li><div>   &nbsp;</div></li></ol></pre></section><hr /> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The function is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/buddypress/2.8.2/files/bp-settings-bp-settings-actions/" class="file">/bp-settings/bp-settings-actions.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="26" class="block" start="29"><li><div>function bp_settings_action_general() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Bail if not a POST action.&nbsp;</div></li><li><div>    if ( 'POST' !== strtoupper( $_SERVER['REQUEST_METHOD'] ) )&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Bail if no submit action.&nbsp;</div></li><li><div>    if ( ! isset( $_POST['submit'] ) )&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Bail if not in settings.&nbsp;</div></li><li><div>    if ( ! bp_is_settings_component() || ! bp_is_current_action( 'general' ) )&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // 404 if there are any additional action variables attached&nbsp;</div></li><li><div>    if ( bp_action_variables() ) {&nbsp;</div></li><li><div>        bp_do_404();&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Define local defaults&nbsp;</div></li><li><div>    $bp = buddypress(); // The instance&nbsp;</div></li><li><div>    $email_error = false;        // invalid|blocked|taken|empty|nochange&nbsp;</div></li><li><div>    $pass_error = false;        // invalid|mismatch|empty|nochange&nbsp;</div></li><li><div>    $pass_changed = false;        // true if the user changes their password&nbsp;</div></li><li><div>    $email_changed = false;        // true if the user changes their email&nbsp;</div></li><li><div>    $feedback_type = 'error';      // success|error&nbsp;</div></li><li><div>    $feedback = array();      // array of strings for feedback.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Nonce check.&nbsp;</div></li><li><div>    check_admin_referer('bp_settings_general');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Validate the user again for the current password when making a big change.&nbsp;</div></li><li><div>    if ( ( is_super_admin() ) || ( !empty( $_POST['pwd'] ) && wp_check_password( $_POST['pwd'], $bp-&gt;displayed_user-&gt;userdata-&gt;user_pass, bp_displayed_user_id() ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $update_user = get_userdata( bp_displayed_user_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Email Change Attempt ******************************************/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $_POST['email'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // What is missing from the profile page vs signup -&nbsp;</div></li><li><div>            // let's double check the goodies.&nbsp;</div></li><li><div>            $user_email = sanitize_email( esc_html( trim( $_POST['email'] ) ) );&nbsp;</div></li><li><div>            $old_user_email = $bp-&gt;displayed_user-&gt;userdata-&gt;user_email;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // User is changing email address.&nbsp;</div></li><li><div>            if ( $old_user_email != $user_email ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Run some tests on the email address.&nbsp;</div></li><li><div>                $email_checks = bp_core_validate_email_address( $user_email );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( true !== $email_checks ) {&nbsp;</div></li><li><div>                    if ( isset( $email_checks['invalid'] ) ) {&nbsp;</div></li><li><div>                        $email_error = 'invalid';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $email_checks['domain_banned'] ) || isset( $email_checks['domain_not_allowed'] ) ) {&nbsp;</div></li><li><div>                        $email_error = 'blocked';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $email_checks['in_use'] ) ) {&nbsp;</div></li><li><div>                        $email_error = 'taken';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Store a hash to enable email validation.&nbsp;</div></li><li><div>                if ( false === $email_error ) {&nbsp;</div></li><li><div>                    $hash = wp_generate_password( 32, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pending_email = array(&nbsp;</div></li><li><div>                        'hash' =&gt; $hash, &nbsp;</div></li><li><div>                        'newemail' =&gt; $user_email, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    bp_update_user_meta( bp_displayed_user_id(), 'pending_email_change', $pending_email );&nbsp;</div></li><li><div>                    $verify_link = bp_displayed_user_domain() . bp_get_settings_slug() . '/?verify_email_change=' . $hash;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Send the verification email.&nbsp;</div></li><li><div>                    $args = array(&nbsp;</div></li><li><div>                        'tokens' =&gt; array(&nbsp;</div></li><li><div>                            'displayname' =&gt; bp_core_get_user_displayname( bp_displayed_user_id() ), &nbsp;</div></li><li><div>                            'old-user.email' =&gt; $old_user_email, &nbsp;</div></li><li><div>                            'user.email' =&gt; $user_email, &nbsp;</div></li><li><div>                            'verify.url' =&gt; esc_url( $verify_link ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    bp_send_email( 'settings-verify-email-change', bp_displayed_user_id(), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // We mark that the change has taken place so as to ensure a&nbsp;</div></li><li><div>                    // success message, even though verification is still required.&nbsp;</div></li><li><div>                    $_POST['email'] = $update_user-&gt;user_email;&nbsp;</div></li><li><div>                    $email_changed = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // No change.&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $email_error = false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Email address cannot be empty.&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $email_error = 'empty';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Password Change Attempt ***************************************/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $_POST['pass1'] ) && !empty( $_POST['pass2'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ( $_POST['pass1'] == $_POST['pass2'] ) && !strpos( &quot; &quot; . $_POST['pass1'], &quot;\\&quot; ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Password change attempt is successful.&nbsp;</div></li><li><div>                if ( ( ! empty( $_POST['pwd'] ) && $_POST['pwd'] != $_POST['pass1'] ) || is_super_admin() )  {&nbsp;</div></li><li><div>                    $update_user-&gt;user_pass = $_POST['pass1'];&nbsp;</div></li><li><div>                    $pass_changed = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // The new password is the same as the current password.&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $pass_error = 'same';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Password change attempt was unsuccessful.&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $pass_error = 'mismatch';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Both password fields were empty.&nbsp;</div></li><li><div>        } elseif ( empty( $_POST['pass1'] ) && empty( $_POST['pass2'] ) ) {&nbsp;</div></li><li><div>            $pass_error = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // One of the password boxes was left empty.&nbsp;</div></li><li><div>        } elseif ( ( empty( $_POST['pass1'] ) && !empty( $_POST['pass2'] ) ) || ( !empty( $_POST['pass1'] ) && empty( $_POST['pass2'] ) ) ) {&nbsp;</div></li><li><div>            $pass_error = 'empty';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The structure of the $update_user object changed in WP 3.3, but&nbsp;</div></li><li><div>        // wp_update_user() still expects the old format.&nbsp;</div></li><li><div>        if ( isset( $update_user-&gt;data ) && is_object( $update_user-&gt;data ) ) {&nbsp;</div></li><li><div>            $update_user = $update_user-&gt;data;&nbsp;</div></li><li><div>            $update_user = get_object_vars( $update_user );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Unset the password field to prevent it from emptying out the&nbsp;</div></li><li><div>            // user's user_pass field in the database.&nbsp;</div></li><li><div>            // @see wp_update_user().&nbsp;</div></li><li><div>            if ( false === $pass_changed ) {&nbsp;</div></li><li><div>                unset( $update_user['user_pass'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Clear cached data, so that the changed settings take effect&nbsp;</div></li><li><div>        // on the current page load.&nbsp;</div></li><li><div>        if ( ( false === $email_error ) && ( false === $pass_error ) && ( wp_update_user( $update_user ) ) ) {&nbsp;</div></li><li><div>            wp_cache_delete( 'bp_core_userdata_' . bp_displayed_user_id(), 'bp' );&nbsp;</div></li><li><div>            $bp-&gt;displayed_user-&gt;userdata = bp_core_get_core_userdata( bp_displayed_user_id() );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Password Error.&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $pass_error = 'invalid';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Email feedback.&nbsp;</div></li><li><div>    switch ( $email_error ) {&nbsp;</div></li><li><div>        case 'invalid' :&nbsp;</div></li><li><div>            $feedback['email_invalid'] = __( 'That email address is invalid. Check the formatting and try again.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case 'blocked' :&nbsp;</div></li><li><div>            $feedback['email_blocked'] = __( 'That email address is currently unavailable for use.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case 'taken' :&nbsp;</div></li><li><div>            $feedback['email_taken'] = __( 'That email address is already taken.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case 'empty' :&nbsp;</div></li><li><div>            $feedback['email_empty'] = __( 'Email address cannot be empty.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case false :&nbsp;</div></li><li><div>            // No change.&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Password feedback.&nbsp;</div></li><li><div>    switch ( $pass_error ) {&nbsp;</div></li><li><div>        case 'invalid' :&nbsp;</div></li><li><div>            $feedback['pass_error'] = __( 'Your current password is invalid.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case 'mismatch' :&nbsp;</div></li><li><div>            $feedback['pass_mismatch'] = __( 'The new password fields did not match.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case 'empty' :&nbsp;</div></li><li><div>            $feedback['pass_empty'] = __( 'One of the password fields was empty.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case 'same' :&nbsp;</div></li><li><div>            $feedback['pass_same'] = __( 'The new password must be different from the current password.', 'buddypress' );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        case false :&nbsp;</div></li><li><div>            // No change.&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // No errors so show a simple success message.&nbsp;</div></li><li><div>    if ( ( ( false === $email_error ) || ( false == $pass_error ) ) && ( ( true === $pass_changed ) || ( true === $email_changed ) ) ) {&nbsp;</div></li><li><div>        $feedback[] = __( 'Your settings have been saved.', 'buddypress' );&nbsp;</div></li><li><div>        $feedback_type = 'success';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Some kind of errors occurred.&nbsp;</div></li><li><div>    } elseif ( ( ( false === $email_error ) || ( false === $pass_error ) ) && ( ( false === $pass_changed ) || ( false === $email_changed ) ) ) {&nbsp;</div></li><li><div>        if ( bp_is_my_profile() ) {&nbsp;</div></li><li><div>            $feedback['nochange'] = __( 'No changes were made to your account.', 'buddypress' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $feedback['nochange'] = __( 'No changes were made to this account.', 'buddypress' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Set the feedback.&nbsp;</div></li><li><div>    bp_core_add_message( implode( &quot;\n&quot;, $feedback ), $feedback_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fires after the general settings have been saved, and before redirect.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    do_action( 'bp_core_general_settings_after_save' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Redirect to prevent issues with browser back button.&nbsp;</div></li><li><div>    bp_core_redirect( trailingslashit( bp_displayed_user_domain() . bp_get_settings_slug() . '/general' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.6.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/bp_settings_action_general/" class="active">2.8.2</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.1/functions/bp_settings_action_general/" class="">2.8.1</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.0/functions/bp_settings_action_general/" class="">2.8.0</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.5/functions/bp_settings_action_general/" class="">2.7.5</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.4/functions/bp_settings_action_general/" class="">2.7.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>function</li><li><span></span>bp_settings_action_general</li><li><span></span>wp-plugin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>