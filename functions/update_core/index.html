<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr function lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr function lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr function lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr function ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr function gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr function" data-site="wordpress" data-type="function" data-id="4156"><head xmlns="http://www.w3.org/1999/xhtml"><title> update_core | function | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="update_core, function, wordpress, 4.7.4" /><meta name="description" content="Upgrades the core of WordPress." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.24"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=dbc2727f7b9461c75dc10bfc16d4d242' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.24' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/functions/update_core/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fupdate_core%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fupdate_core%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-function-update_core","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="update_core" class="single single-function single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to functions." href="http://hookr.io/4.7.4/functions/" class=""><span property="name">functions</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">update_core</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="function"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="active" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>update_core</strong></h1><p>Upgrades the core of WordPress.</p> </section> <section id="description"><h2>Description</h2><pre><div><em>(WP_Error|null)</em> update_core( <span class="param">(string)</span> <a href="#" class="param" data-type="(string) " data-desc="New release unzipped path." data-depr="" data-opt="" title="New release unzipped path.">$from</a>, <span class="param">(string)</span> <a href="#" class="param" data-type="(string) " data-desc="Path to old WordPress<br />installation." data-depr="" data-opt="" title="Path to old WordPress<br />installation.">$to</a> );&nbsp;</div></pre><p>This will create a .maintenance file at the base of the WordPress directory to ensure that people can not access the web site, when the files are being copied to their locations.</p><p> The files in the <code>$_old_files</code> list will be removed and the new files copied from the zip file after the database is upgraded.</p><p> The files in the <code>$_new_bundled_files</code> list will be added to the installation if the version is greater than or equal to the old version being upgraded.</p><p> The steps for the upgrader for after the new release is downloaded and unzipped is: 1. Test unzipped location for select files to ensure that unzipped worked. 2. Create the .maintenance file in current WordPress base. 3. Copy new WordPress directory over old WordPress files. 4. Upgrade WordPress to new version. 5. Delete new WordPress directory path. 6. Delete .maintenance file. 7. Remove old files. 8. Delete update_core option.</p><p> There are several areas of failure. For instance if PHP times out before step 6, then you will not be able to access any portion of your site. Also, since the upgrade will not continue where it left off, you will not be able to automatically remove old files and remove the update_core option. This isn't that bad.</p><p> If the copy of the new WordPress over the old fails, then the worse is that the new WordPress directory will remain.</p><p> If it is assumed that every file will be copied over, including plugins and themes, then if you edit the default theme, you should rename it, so that your changes remain.</p> </section> <section id="returns"><h2>Returns <span class="count">(WP_Error<span>|</span>null)</span></h2><p>WP_Error on failure, null on success.</p> </section> <section id="params"><h2>Parameters <span class="count">(2)</span></h2><dl><dt> <span class="index">0.</span> <span class="param"> $from </span> <span class="type">(string)</span></dt><dd> New release unzipped path.</dd><dt> <span class="index">1.</span> <span class="param"> $to </span> <span class="type">(string)</span></dt><dd> Path to old WordPress installation.</dd></dl> </section><hr /> <section id="usage"><h2>Usage</h2><pre><ol><li><div>if ( !function_exists( '<span class="func">update_core</span>' ) ) {&nbsp;</div></li><li><div>    require_once ABSPATH . '/wp-admin/includes/update-core.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// New release unzipped path.</span>&nbsp;</div></li><li><div><span class="param">$from</span> = '';&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// Path to old WordPress installation.</span>&nbsp;</div></li><li><div><span class="param">$to</span> = '';&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// NOTICE! Understand what this does before running.</span>&nbsp;</div></li><li><div><span class="param">$result</span> = <span class="func">update_core</span>(<span class="param">$from</span>, <span class="param">$to</span>);&nbsp;</div></li><li><div>   &nbsp;</div></li></ol></pre></section><hr /> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The function is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7.4/files/wp-admin-includes-update-core/" class="file">/wp-admin/includes/update-core.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="26" class="block" start="799"><li><div>function update_core($from, $to) {&nbsp;</div></li><li><div>    global $wp_filesystem, $_old_files, $_new_bundled_files, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    @set_time_limit( 300 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filters feedback messages displayed during the core update process.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The filter is first evaluated after the zip file for the latest version&nbsp;</div></li><li><div>     * has been downloaded and unzipped. It is evaluated five more times during&nbsp;</div></li><li><div>     * the process:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * 1. Before WordPress begins the core upgrade process.&nbsp;</div></li><li><div>     * 2. Before Maintenance Mode is enabled.&nbsp;</div></li><li><div>     * 3. Before WordPress begins copying over the necessary files.&nbsp;</div></li><li><div>     * 4. Before Maintenance Mode is disabled.&nbsp;</div></li><li><div>     * 5. Before the database is upgraded.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $feedback The core update feedback messages.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/add_filter/update_feedback/" data-id="1417724" title="update_feedback" class="filter">'update_feedback'</a>, <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'Verifying the unpacked files&#8230;' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Sanity check the unzipped distribution.&nbsp;</div></li><li><div>    $distro = '';&nbsp;</div></li><li><div>    $roots = array( '/wordpress/', '/wordpress-mu/' );&nbsp;</div></li><li><div>    foreach ( $roots as $root ) {&nbsp;</div></li><li><div>        if ( $wp_filesystem-&gt;exists( $from . $root . 'readme.html' ) && $wp_filesystem-&gt;exists( $from . $root . 'wp-includes/version.php' ) ) {&nbsp;</div></li><li><div>            $distro = $root;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ( ! $distro ) {&nbsp;</div></li><li><div>        $wp_filesystem-&gt;delete( $from, true );&nbsp;</div></li><li><div>        return new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'insane_distro', <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>('The update could not be unpacked') );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Import $wp_version, $required_php_version, and $required_mysql_version from the new version&nbsp;</div></li><li><div>     * $wp_filesystem-&gt;wp_content_dir() returned unslashed pre-2.8&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global string $wp_version&nbsp;</div></li><li><div>     * @global string $required_php_version&nbsp;</div></li><li><div>     * @global string $required_mysql_version&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    global $wp_version, $required_php_version, $required_mysql_version;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $versions_file = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>( $wp_filesystem-&gt;wp_content_dir() ) . 'upgrade/version-current.php';&nbsp;</div></li><li><div>    if ( ! $wp_filesystem-&gt;copy( $from . $distro . 'wp-includes/version.php', $versions_file ) ) {&nbsp;</div></li><li><div>        $wp_filesystem-&gt;delete( $from, true );&nbsp;</div></li><li><div>        return new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'copy_failed_for_version_file', <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'The update cannot be installed because we will be unable to copy some files. This is usually due to inconsistent file permissions.' ), 'wp-includes/version.php' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $wp_filesystem-&gt;chmod( $versions_file, <a href="http://hookr.io/4.7.4/constants/fs_chmod_file/" data-id="1416552" title="FS_CHMOD_FILE" class="constant">FS_CHMOD_FILE</a> );&nbsp;</div></li><li><div>    require( <a href="http://hookr.io/4.7.4/constants/wp_content_dir/" data-id="1423153" title="WP_CONTENT_DIR" class="constant">WP_CONTENT_DIR</a> . '/upgrade/version-current.php' );&nbsp;</div></li><li><div>    $wp_filesystem-&gt;delete( $versions_file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $php_version = phpversion();&nbsp;</div></li><li><div>    $mysql_version = $wpdb-&gt;db_version();&nbsp;</div></li><li><div>    $old_wp_version = $wp_version; // The version of WordPress we're updating from&nbsp;</div></li><li><div>    $development_build = ( false !== strpos( $old_wp_version . $wp_version, '-' ) ); // a dash in the version indicates a Development release&nbsp;</div></li><li><div>    $php_compat = version_compare( $php_version, $required_php_version, '&gt;=' );&nbsp;</div></li><li><div>    if ( file_exists( <a href="http://hookr.io/4.7.4/constants/wp_content_dir/" data-id="1423153" title="WP_CONTENT_DIR" class="constant">WP_CONTENT_DIR</a> . '/db.php' ) && empty( $wpdb-&gt;is_mysql ) )&nbsp;</div></li><li><div>        $mysql_compat = true;&nbsp;</div></li><li><div>    else&nbsp;</div></li><li><div>        $mysql_compat = version_compare( $mysql_version, $required_mysql_version, '&gt;=' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( !$mysql_compat || !$php_compat )&nbsp;</div></li><li><div>        $wp_filesystem-&gt;delete($from, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( !$mysql_compat && !$php_compat )&nbsp;</div></li><li><div>        return new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'php_mysql_not_compatible', sprintf( <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>('The update cannot be installed because WordPress %1$s requires PHP version %2$s or higher and MySQL version %3$s or higher. You are running PHP version %4$s and MySQL version %5$s.'), $wp_version, $required_php_version, $required_mysql_version, $php_version, $mysql_version ) );&nbsp;</div></li><li><div>    elseif ( !$php_compat )&nbsp;</div></li><li><div>        return new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'php_not_compatible', sprintf( <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>('The update cannot be installed because WordPress %1$s requires PHP version %2$s or higher. You are running version %3$s.'), $wp_version, $required_php_version, $php_version ) );&nbsp;</div></li><li><div>    elseif ( !$mysql_compat )&nbsp;</div></li><li><div>        return new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'mysql_not_compatible', sprintf( <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>('The update cannot be installed because WordPress %1$s requires MySQL version %2$s or higher. You are running version %3$s.'), $wp_version, $required_mysql_version, $mysql_version ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** This filter is documented in wp-admin/includes/update-core.php */&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/add_filter/update_feedback/" data-id="1417724" title="update_feedback" class="filter">'update_feedback'</a>, <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'Preparing to install the latest version&#8230;' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Don't copy wp-content, we'll deal with that below&nbsp;</div></li><li><div>    // We also copy version.php last so failed updates report their old version&nbsp;</div></li><li><div>    $skip = array( 'wp-content', 'wp-includes/version.php' );&nbsp;</div></li><li><div>    $check_is_writable = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Check to see which files don't really need updating - only available for 3.7 and higher&nbsp;</div></li><li><div>    if ( function_exists( '<a href="http://hookr.io/4.7.4/functions/get_core_checksums/" data-id="1417244" title="get_core_checksums" class="function">get_core_checksums</a>' ) ) {&nbsp;</div></li><li><div>        // Find the local version of the working directory&nbsp;</div></li><li><div>        $working_dir_local = <a href="http://hookr.io/4.7.4/constants/wp_content_dir/" data-id="1423153" title="WP_CONTENT_DIR" class="constant">WP_CONTENT_DIR</a> . '/upgrade/' . basename( $from ) . $distro;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $checksums = <a href="http://hookr.io/4.7.4/functions/get_core_checksums/" data-id="1417244" title="get_core_checksums" class="function">get_core_checksums</a>( $wp_version, isset( $wp_local_package ) ? $wp_local_package : 'en_US' );&nbsp;</div></li><li><div>        if ( is_array( $checksums ) && isset( $checksums[ $wp_version ] ) )&nbsp;</div></li><li><div>            $checksums = $checksums[ $wp_version ]; // Compat code for 3.7-beta2&nbsp;</div></li><li><div>        if ( is_array( $checksums ) ) {&nbsp;</div></li><li><div>            foreach ( $checksums as $file =&gt; $checksum ) {&nbsp;</div></li><li><div>                if ( 'wp-content' == substr( $file, 0, 10 ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                if ( ! file_exists( <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> . $file ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                if ( ! file_exists( $working_dir_local . $file ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                if ( '.' === dirname( $file ) && in_array( pathinfo( $file, PATHINFO_EXTENSION ), array( 'html', 'txt' ) ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                if ( md5_file( <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> . $file ) === $checksum )&nbsp;</div></li><li><div>                    $skip[] = $file;&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $check_is_writable[ $file ] = <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> . $file;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // If we're using the direct method, we can predict write failures that are due to permissions.&nbsp;</div></li><li><div>    if ( $check_is_writable && 'direct' === $wp_filesystem-&gt;method ) {&nbsp;</div></li><li><div>        $files_writable = array_filter( $check_is_writable, array( $wp_filesystem, 'is_writable' ) );&nbsp;</div></li><li><div>        if ( $files_writable !== $check_is_writable ) {&nbsp;</div></li><li><div>            $files_not_writable = array_diff_key( $check_is_writable, $files_writable );&nbsp;</div></li><li><div>            foreach ( $files_not_writable as $relative_file_not_writable =&gt; $file_not_writable ) {&nbsp;</div></li><li><div>                // If the writable check failed, chmod file to 0644 and try again, same as <a href="http://hookr.io/4.7.4/functions/copy_dir/" data-id="1417249" title="copy_dir" class="function">copy_dir</a>().&nbsp;</div></li><li><div>                $wp_filesystem-&gt;chmod( $file_not_writable, <a href="http://hookr.io/4.7.4/constants/fs_chmod_file/" data-id="1416552" title="FS_CHMOD_FILE" class="constant">FS_CHMOD_FILE</a> );&nbsp;</div></li><li><div>                if ( $wp_filesystem-&gt;is_writable( $file_not_writable ) )&nbsp;</div></li><li><div>                    unset( $files_not_writable[ $relative_file_not_writable ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Store package-relative paths (the key) of non-writable files in the <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a> object.&nbsp;</div></li><li><div>            $error_data = version_compare( $old_wp_version, '3.7-beta2', '&gt;' ) ? array_keys( $files_not_writable ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $files_not_writable )&nbsp;</div></li><li><div>                return new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'files_not_writable', <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'The update cannot be installed because we will be unable to copy some files. This is usually due to inconsistent file permissions.' ), implode( ', ', $error_data ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** This filter is documented in wp-admin/includes/update-core.php */&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/add_filter/update_feedback/" data-id="1417724" title="update_feedback" class="filter">'update_feedback'</a>, <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'Enabling Maintenance mode&#8230;' ) );&nbsp;</div></li><li><div>    // Create maintenance file to signal that we are upgrading&nbsp;</div></li><li><div>    $maintenance_string = '&lt;?php $upgrading = ' . time() . '; ?&gt;';&nbsp;</div></li><li><div>    $maintenance_file = $to . '.maintenance';&nbsp;</div></li><li><div>    $wp_filesystem-&gt;delete($maintenance_file);&nbsp;</div></li><li><div>    $wp_filesystem-&gt;put_contents($maintenance_file, $maintenance_string, <a href="http://hookr.io/4.7.4/constants/fs_chmod_file/" data-id="1416552" title="FS_CHMOD_FILE" class="constant">FS_CHMOD_FILE</a>);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** This filter is documented in wp-admin/includes/update-core.php */&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/add_filter/update_feedback/" data-id="1417724" title="update_feedback" class="filter">'update_feedback'</a>, <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'Copying the required files&#8230;' ) );&nbsp;</div></li><li><div>    // Copy new versions of <a href="http://hookr.io/4.7.4/classes/wp/" data-id="1418598" title="WP" class="class">WP</a> files into place.&nbsp;</div></li><li><div>    $result = <a href="http://hookr.io/4.7.4/functions/copy_dir/" data-id="1417249" title="copy_dir" class="function">_copy_dir</a>( $from . $distro, $to, $skip );&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>( $result ) )&nbsp;</div></li><li><div>        $result = new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( $result-&gt;get_error_code(), $result-&gt;get_error_message(), substr( $result-&gt;get_error_data(), strlen( $to ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Since we know the core files have copied over, we can now copy the version file&nbsp;</div></li><li><div>    if ( ! <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>( $result ) ) {&nbsp;</div></li><li><div>        if ( ! $wp_filesystem-&gt;copy( $from . $distro . 'wp-includes/version.php', $to . 'wp-includes/version.php', true /** overwrite */ ) ) {&nbsp;</div></li><li><div>            $wp_filesystem-&gt;delete( $from, true );&nbsp;</div></li><li><div>            $result = new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'copy_failed_for_version_file', <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'The update cannot be installed because we will be unable to copy some files. This is usually due to inconsistent file permissions.' ), 'wp-includes/version.php' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $wp_filesystem-&gt;chmod( $to . 'wp-includes/version.php', <a href="http://hookr.io/4.7.4/constants/fs_chmod_file/" data-id="1416552" title="FS_CHMOD_FILE" class="constant">FS_CHMOD_FILE</a> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Check to make sure everything copied correctly, ignoring the contents of wp-content&nbsp;</div></li><li><div>    $skip = array( 'wp-content' );&nbsp;</div></li><li><div>    $failed = array();&nbsp;</div></li><li><div>    if ( isset( $checksums ) && is_array( $checksums ) ) {&nbsp;</div></li><li><div>        foreach ( $checksums as $file =&gt; $checksum ) {&nbsp;</div></li><li><div>            if ( 'wp-content' == substr( $file, 0, 10 ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            if ( ! file_exists( $working_dir_local . $file ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            if ( '.' === dirname( $file ) && in_array( pathinfo( $file, PATHINFO_EXTENSION ), array( 'html', 'txt' ) ) ) {&nbsp;</div></li><li><div>                $skip[] = $file;&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( file_exists( <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> . $file ) && md5_file( <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> . $file ) == $checksum )&nbsp;</div></li><li><div>                $skip[] = $file;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $failed[] = $file;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Some files didn't copy properly&nbsp;</div></li><li><div>    if ( ! empty( $failed ) ) {&nbsp;</div></li><li><div>        $total_size = 0;&nbsp;</div></li><li><div>        foreach ( $failed as $file ) {&nbsp;</div></li><li><div>            if ( file_exists( $working_dir_local . $file ) )&nbsp;</div></li><li><div>                $total_size += filesize( $working_dir_local . $file );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we don't have enough free space, it isn't worth trying again.&nbsp;</div></li><li><div>        // Unlikely to be hit due to the check in <a href="http://hookr.io/4.7.4/functions/unzip_file/" data-id="1416619" title="unzip_file" class="function">unzip_file</a>().&nbsp;</div></li><li><div>        $available_space = @disk_free_space( <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> );&nbsp;</div></li><li><div>        if ( $available_space && $total_size &gt;= $available_space ) {&nbsp;</div></li><li><div>            $result = new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( 'disk_full', <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'There is not enough free disk space to complete the update.' ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $result = <a href="http://hookr.io/4.7.4/functions/copy_dir/" data-id="1417249" title="copy_dir" class="function">_copy_dir</a>( $from . $distro, $to, $skip );&nbsp;</div></li><li><div>            if ( <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>( $result ) )&nbsp;</div></li><li><div>                $result = new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( $result-&gt;get_error_code() . '_retry', $result-&gt;get_error_message(), substr( $result-&gt;get_error_data(), strlen( $to ) ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Custom Content Directory needs updating now.&nbsp;</div></li><li><div>    // Copy Languages&nbsp;</div></li><li><div>    if ( !is_wp_error($result) && $wp_filesystem-&gt;is_dir($from . $distro . 'wp-content/languages') ) {&nbsp;</div></li><li><div>        if ( <a href="http://hookr.io/4.7.4/constants/wp_lang_dir/" data-id="1420596" title="WP_LANG_DIR" class="constant">WP_LANG_DIR</a> != <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> . <a href="http://hookr.io/4.7.4/constants/wpinc/" data-id="1423195" title="WPINC" class="constant">WPINC</a> . '/languages' || @is_dir(<a href="http://hookr.io/4.7.4/constants/wp_lang_dir/" data-id="1420596" title="WP_LANG_DIR" class="constant">WP_LANG_DIR</a>) )&nbsp;</div></li><li><div>            $lang_dir = <a href="http://hookr.io/4.7.4/constants/wp_lang_dir/" data-id="1420596" title="WP_LANG_DIR" class="constant">WP_LANG_DIR</a>;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $lang_dir = <a href="http://hookr.io/4.7.4/constants/wp_content_dir/" data-id="1423153" title="WP_CONTENT_DIR" class="constant">WP_CONTENT_DIR</a> . '/languages';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !@is_dir($lang_dir) && 0 === strpos($lang_dir, <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a>) ) { // Check the language directory exists first&nbsp;</div></li><li><div>            $wp_filesystem-&gt;mkdir($to . str_replace(<a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a>, '', $lang_dir), <a href="http://hookr.io/4.7.4/constants/fs_chmod_dir/" data-id="1416550" title="FS_CHMOD_DIR" class="constant">FS_CHMOD_DIR</a>); // If it's within the <a href="http://hookr.io/4.7.4/constants/abspath/" data-id="1423150" title="ABSPATH" class="constant">ABSPATH</a> we can handle it here, otherwise they're out of luck.&nbsp;</div></li><li><div>            clearstatcache(); // for FTP, Need to clear the stat cache&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( @is_dir($lang_dir) ) {&nbsp;</div></li><li><div>            $wp_lang_dir = $wp_filesystem-&gt;find_folder($lang_dir);&nbsp;</div></li><li><div>            if ( $wp_lang_dir ) {&nbsp;</div></li><li><div>                $result = <a href="http://hookr.io/4.7.4/functions/copy_dir/" data-id="1417249" title="copy_dir" class="function">copy_dir</a>($from . $distro . 'wp-content/languages/', $wp_lang_dir);&nbsp;</div></li><li><div>                if ( <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>( $result ) )&nbsp;</div></li><li><div>                    $result = new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( $result-&gt;get_error_code() . '_languages', $result-&gt;get_error_message(), substr( $result-&gt;get_error_data(), strlen( $wp_lang_dir ) ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** This filter is documented in wp-admin/includes/update-core.php */&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/add_filter/update_feedback/" data-id="1417724" title="update_feedback" class="filter">'update_feedback'</a>, <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'Disabling Maintenance mode&#8230;' ) );&nbsp;</div></li><li><div>    // Remove maintenance file, we're done with potential site-breaking changes&nbsp;</div></li><li><div>    $wp_filesystem-&gt;delete( $maintenance_file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // 3.5 -&gt; 3.5+ - an empty twentytwelve directory was created upon upgrade to 3.5 for some users, preventing installation of Twenty Twelve.&nbsp;</div></li><li><div>    if ( '3.5' == $old_wp_version ) {&nbsp;</div></li><li><div>        if ( is_dir( <a href="http://hookr.io/4.7.4/constants/wp_content_dir/" data-id="1423153" title="WP_CONTENT_DIR" class="constant">WP_CONTENT_DIR</a> . '/themes/twentytwelve' ) && ! file_exists( <a href="http://hookr.io/4.7.4/constants/wp_content_dir/" data-id="1423153" title="WP_CONTENT_DIR" class="constant">WP_CONTENT_DIR</a> . '/themes/twentytwelve/style.css' ) ) {&nbsp;</div></li><li><div>            $wp_filesystem-&gt;delete( $wp_filesystem-&gt;wp_themes_dir() . 'twentytwelve/' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Copy New bundled plugins & themes&nbsp;</div></li><li><div>    // This gives us the ability to install new plugins & themes bundled with future versions of WordPress whilst avoiding the re-install upon upgrade issue.&nbsp;</div></li><li><div>    // $development_build controls us overwriting bundled themes and plugins when a non-stable release is being updated&nbsp;</div></li><li><div>    if ( !is_wp_error($result) && ( ! defined('CORE_UPGRADE_SKIP_NEW_BUNDLED') || ! CORE_UPGRADE_SKIP_NEW_BUNDLED ) ) {&nbsp;</div></li><li><div>        foreach ( (array) $_new_bundled_files as $file =&gt; $introduced_version ) {&nbsp;</div></li><li><div>            // If a $development_build or if $introduced version is greater than what the site was previously running&nbsp;</div></li><li><div>            if ( $development_build || version_compare( $introduced_version, $old_wp_version, '&gt;' ) ) {&nbsp;</div></li><li><div>                $directory = ('/' == $file[ strlen($file)-1 ]);&nbsp;</div></li><li><div>                list($type, $filename) = explode('/', $file, 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Check to see if the bundled items exist before attempting to copy them&nbsp;</div></li><li><div>                if ( ! $wp_filesystem-&gt;exists( $from . $distro . 'wp-content/' . $file ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'plugins' == $type )&nbsp;</div></li><li><div>                    $dest = $wp_filesystem-&gt;wp_plugins_dir();&nbsp;</div></li><li><div>                elseif ( 'themes' == $type )&nbsp;</div></li><li><div>                    $dest = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($wp_filesystem-&gt;wp_themes_dir()); // Back-compat, ::wp_themes_dir() did not return trailingslash'd pre-3.2&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! $directory ) {&nbsp;</div></li><li><div>                    if ( ! $development_build && $wp_filesystem-&gt;exists( $dest . $filename ) )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( ! $wp_filesystem-&gt;copy($from . $distro . 'wp-content/' . $file, $dest . $filename, <a href="http://hookr.io/4.7.4/constants/fs_chmod_file/" data-id="1416552" title="FS_CHMOD_FILE" class="constant">FS_CHMOD_FILE</a>) )&nbsp;</div></li><li><div>                        $result = new <a href="http://hookr.io/4.7.4/classes/wp_error/" data-id="1418158" title="WP_Error" class="class">WP_Error</a>( &quot;copy_failed_for_new_bundled_$type&quot;, <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'Could not copy file.' ), $dest . $filename );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    if ( ! $development_build && $wp_filesystem-&gt;is_dir( $dest . $filename ) )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $wp_filesystem-&gt;mkdir($dest . $filename, <a href="http://hookr.io/4.7.4/constants/fs_chmod_dir/" data-id="1416550" title="FS_CHMOD_DIR" class="constant">FS_CHMOD_DIR</a>);&nbsp;</div></li><li><div>                    $_result = <a href="http://hookr.io/4.7.4/functions/copy_dir/" data-id="1417249" title="copy_dir" class="function">copy_dir</a>( $from . $distro . 'wp-content/' . $file, $dest . $filename);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // If aerroroccurs partway through this final step, keep theerrorflowing through, but keep process going.&nbsp;</div></li><li><div>                    if ( <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>( $_result ) ) {&nbsp;</div></li><li><div>                        if ( ! <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>( $result ) )&nbsp;</div></li><li><div>                            $result = new WP_Error;&nbsp;</div></li><li><div>                        $result-&gt;add( $_result-&gt;get_error_code() . &quot;_$type&quot;, $_result-&gt;get_error_message(), substr( $_result-&gt;get_error_data(), strlen( $dest ) ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } //end foreach&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Handle $resulterrorfrom the above blocks&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>($result) ) {&nbsp;</div></li><li><div>        $wp_filesystem-&gt;delete($from, true);&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Remove old files&nbsp;</div></li><li><div>    foreach ( $_old_files as $old_file ) {&nbsp;</div></li><li><div>        $old_file = $to . $old_file;&nbsp;</div></li><li><div>        if ( !$wp_filesystem-&gt;exists($old_file) )&nbsp;</div></li><li><div>            continue;&nbsp;</div></li><li><div>        $wp_filesystem-&gt;delete($old_file, true);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Remove any Genericons example.html's from the filesystem&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/upgrade_422_remove_genericons/" data-id="1417254" title="_upgrade_422_remove_genericons" class="function">_upgrade_422_remove_genericons</a>();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Remove the REST API plugin if its version is Beta 4 or lower&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/upgrade_440_force_deactivate_incompatible_plugins/" data-id="1417258" title="_upgrade_440_force_deactivate_incompatible_plugins" class="function">_upgrade_440_force_deactivate_incompatible_plugins</a>();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Upgrade DB with separate request&nbsp;</div></li><li><div>    /** This filter is documented in wp-admin/includes/update-core.php */&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/add_filter/update_feedback/" data-id="1417724" title="update_feedback" class="filter">'update_feedback'</a>, <a href="http://hookr.io/4.7.4/functions/__/" data-id="1420645" title="__" class="function">__</a>( 'Upgrading database&#8230;' ) );&nbsp;</div></li><li><div>    $db_upgrade_url = <a href="http://hookr.io/4.7.4/functions/admin_url/" data-id="1421448" title="admin_url" class="function">admin_url</a>('upgrade.php?step=upgrade_db');&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/wp_remote_post/" data-id="1419721" title="wp_remote_post" class="function">wp_remote_post</a>($db_upgrade_url, array('timeout' =&gt; 60));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Clear the cache to prevent an <a href="http://hookr.io/4.7.4/functions/update_option/" data-id="1421289" title="update_option" class="function">update_option</a>() from saving a stale db_version to the cache&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/wp_cache_flush/" data-id="1417837" title="wp_cache_flush" class="function">wp_cache_flush</a>();&nbsp;</div></li><li><div>    // (Not all cache back ends listen to 'flush')&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/wp_cache_delete/" data-id="1417836" title="wp_cache_delete" class="function">wp_cache_delete</a>( 'alloptions', 'options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Remove working directory&nbsp;</div></li><li><div>    $wp_filesystem-&gt;delete($from, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Force refresh of update information&nbsp;</div></li><li><div>    if ( function_exists('delete_site_transient') )&nbsp;</div></li><li><div>        <a href="http://hookr.io/4.7.4/functions/delete_site_transient/" data-id="1421319" title="delete_site_transient" class="function">delete_site_transient</a>('update_core');&nbsp;</div></li><li><div>    else&nbsp;</div></li><li><div>        <a href="http://hookr.io/4.7.4/functions/delete_option/" data-id="1421293" title="delete_option" class="function">delete_option</a>('update_core');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fires after WordPress core has been successfully updated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $wp_version The current WordPress version.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    <a href="http://hookr.io/4.7.4/functions/do_action/" data-id="1421373" title="do_action" class="function">do_action</a>( <a href="http://hookr.io/4.7.4/actions/core_updated_successfully/" data-id="1417278" title="core_updated_successfully" class="action">'_core_updated_successfully'</a>, $wp_version );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Clear the option that blocks auto updates after failures, now that we've been successful.&nbsp;</div></li><li><div>    if ( function_exists( '<a href="http://hookr.io/4.7.4/functions/delete_site_option/" data-id="1421308" title="delete_site_option" class="function">delete_site_option</a>' ) )&nbsp;</div></li><li><div>        <a href="http://hookr.io/4.7.4/functions/delete_site_option/" data-id="1421308" title="delete_site_option" class="function">delete_site_option</a>( 'auto_core_update_failed' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $wp_version;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/functions/update_core/" class="active">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/functions/update_core/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/functions/update_core/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/functions/update_core/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/functions/update_core/" class="">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>function</li><li><span></span>update_core</li><li><span></span>wp-admin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>