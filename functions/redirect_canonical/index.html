<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr function lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr function lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr function lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr function ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr function gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr function" data-site="wordpress" data-type="function" data-id="3183"><head xmlns="http://www.w3.org/1999/xhtml"><title> redirect_canonical | function | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="redirect_canonical, function, wordpress, 4.7.4" /><meta name="description" content="Redirects incoming links to the proper URL based on the site url." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=8c0b264f993051d404cc8c9f9bd6a425' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/functions/redirect_canonical/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fredirect_canonical%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fredirect_canonical%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-function-redirect_canonical","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="redirect_canonical" class="single single-function single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to functions." href="http://hookr.io/4.7.4/functions/" class=""><span property="name">functions</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">redirect_canonical</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="function"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="active" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>redirect_canonical</strong></h1><p>Redirects incoming links to the proper URL based on the site url.</p> </section> <section id="description"><h2>Description</h2><pre><div><em>(string|void)</em> redirect_canonical( <span class="param">(constant)</span> <a href="#" class="param" data-type="(constant) " data-desc="The URL that was requested,<br />used to figure if redirect is<br />needed." data-depr="" data-opt="1" title="The URL that was requested,<br />used to figure if redirect is<br />needed.">$requested_url = null</a>, <span class="param">(bool)</span> <a href="#" class="param" data-type="(bool) " data-desc="Redirect to the new URL." data-depr="" data-opt="1" title="Redirect to the new URL.">$do_redirect = true</a> );&nbsp;</div></pre><p>Search engines consider www.somedomain.com and somedomain.com to be two different URLs when they both go to the same location. This SEO enhancement prevents penalty for duplicate content by redirecting all incoming links to one or the other.</p><p> Prevents redirection for feeds, trackbacks, searches, and admin URLs. Does not redirect on non-pretty-permalink-supporting IIS 7+, page/post previews, <a href="http://hookr.io/classes/WP" title="WP" class="code class"><code>WP</code></a> admin, Trackbacks, robots.txt, searches, or on POST <a href="http://hookr.io/classes/requests" title="requests" class="code class"><code>requests</code></a>.</p><p> Will also attempt to find the correct link when a user enters a URL that does not exist based on exact WordPress query. Will instead try to parse the URL or query in an attempt to figure the correct page to go to.</p> </section> <section id="returns"><h2>Returns <span class="count">(string<span>|</span>void)</span></h2><p>The string of the URL, if redirect needed.</p> </section> <section id="params"><h2>Parameters <span class="count">(2)</span></h2><dl><dt> <span class="index">0.</span> <span class="param"> $requested_url </span> &mdash; Optional. <span class="type">(constant)</span> => <code>null</code></dt><dd> The URL that was requested, used to figure if redirect is needed.</dd><dt> <span class="index">1.</span> <span class="param"> $do_redirect </span> &mdash; Optional. <span class="type">(bool)</span> => <code>true</code></dt><dd> Redirect to the new URL.</dd></dl> </section><hr /> <section id="usage"><h2>Usage</h2><pre><ol><li><div>if ( !function_exists( '<span class="func">redirect_canonical</span>' ) ) {&nbsp;</div></li><li><div>    require_once ABSPATH . WPINC . '/canonical.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// Optional. The URL that was requested, used to</span>&nbsp;</div></li><li><div><span class="comment">// figure if redirect is needed.</span>&nbsp;</div></li><li><div><span class="param">$requested_url</span> = null;&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// Optional. Redirect to the new URL.</span>&nbsp;</div></li><li><div><span class="param">$do_redirect</span> = true;&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// NOTICE! Understand what this does before running.</span>&nbsp;</div></li><li><div><span class="param">$result</span> = <span class="func">redirect_canonical</span>(<span class="param">$requested_url</span>, <span class="param">$do_redirect</span>);&nbsp;</div></li><li><div>   &nbsp;</div></li></ol></pre></section><hr /> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The function is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7.4/files/wp-includes-canonical/" class="file">/wp-includes/canonical.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="26" class="block" start="41"><li><div>function redirect_canonical( $requested_url = null, $do_redirect = true ) {&nbsp;</div></li><li><div>    global $wp_rewrite, $is_IIS, $wp_query, $wpdb, $wp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( isset( $_SERVER['REQUEST_METHOD'] ) && ! in_array( strtoupper( $_SERVER['REQUEST_METHOD'] ), array( 'GET', 'HEAD' ) ) ) {&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // If we're not in wp-admin and the post has been published and preview nonce&nbsp;</div></li><li><div>    // is non-existent or invalid then no need for preview in query&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/is_preview/" data-id="1421892" title="is_preview" class="function">is_preview</a>() && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'p' ) && 'publish' == <a href="http://hookr.io/4.7.4/functions/get_post_status/" data-id="1422535" title="get_post_status" class="function">get_post_status</a>( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'p' ) ) ) {&nbsp;</div></li><li><div>        if ( ! isset( $_GET['preview_id'] )&nbsp;</div></li><li><div>            || ! isset( $_GET['preview_nonce'] )&nbsp;</div></li><li><div>            || ! <a href="http://hookr.io/4.7.4/functions/wp_verify_nonce/" data-id="1421563" title="wp_verify_nonce" class="function">wp_verify_nonce</a>( $_GET['preview_nonce'], 'post_preview_' . (int) $_GET['preview_id'] ) ) {&nbsp;</div></li><li><div>            $wp_query-&gt;is_preview = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/is_trackback/" data-id="1421900" title="is_trackback" class="function">is_trackback</a>() || <a href="http://hookr.io/4.7.4/functions/is_search/" data-id="1421895" title="is_search" class="function">is_search</a>() || <a href="http://hookr.io/4.7.4/functions/is_admin/" data-id="1420711" title="is_admin" class="function">is_admin</a>() || <a href="http://hookr.io/4.7.4/functions/is_preview/" data-id="1421892" title="is_preview" class="function">is_preview</a>() || <a href="http://hookr.io/4.7.4/functions/is_robots/" data-id="1421893" title="is_robots" class="function">is_robots</a>() || ( $is_IIS && !iis7_supports_permalinks() ) ) {&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( ! $requested_url && isset( $_SERVER['HTTP_HOST'] ) ) {&nbsp;</div></li><li><div>        // build the URL in the address bar&nbsp;</div></li><li><div>        $requested_url = <a href="http://hookr.io/4.7.4/functions/is_ssl/" data-id="1420723" title="is_ssl" class="function">is_ssl</a>() ? 'https://' : 'http://';&nbsp;</div></li><li><div>        $requested_url .= $_SERVER['HTTP_HOST'];&nbsp;</div></li><li><div>        $requested_url .= $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $original = @parse_url($requested_url);&nbsp;</div></li><li><div>    if ( false === $original ) {&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $redirect = $original;&nbsp;</div></li><li><div>    $redirect_url = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Notice fixing&nbsp;</div></li><li><div>    if ( !isset($redirect['path']) )&nbsp;</div></li><li><div>        $redirect['path'] = '';&nbsp;</div></li><li><div>    if ( !isset($redirect['query']) )&nbsp;</div></li><li><div>        $redirect['query'] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // If the original URL ended with non-breaking spaces, they were almost&nbsp;</div></li><li><div>    // certainly inserted by accident. Let's remove them, so the reader doesn't&nbsp;</div></li><li><div>    // see a 404errorwith no obvious cause.&nbsp;</div></li><li><div>    $redirect['path'] = preg_replace( '|(%C2%A0)+$|i', '', $redirect['path'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // It's not a preview, so remove it from URL&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'preview' ) ) {&nbsp;</div></li><li><div>        $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>( 'preview', $redirect['query'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/is_feed/" data-id="1421883" title="is_feed" class="function">is_feed</a>() && ( $id = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'p' ) ) ) {&nbsp;</div></li><li><div>        if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_post_comments_feed_link/" data-id="1421336" title="get_post_comments_feed_link" class="function">get_post_comments_feed_link</a>( $id, <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'feed' ) ) ) {&nbsp;</div></li><li><div>            $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_qs_args_if_not_in_url/" data-id="1417879" title="_remove_qs_args_if_not_in_url" class="function">_remove_qs_args_if_not_in_url</a>( $redirect['query'], array( 'p', 'page_id', 'attachment_id', 'pagename', 'name', 'post_type', 'feed'), $redirect_url );&nbsp;</div></li><li><div>            $redirect['path'] = parse_url( $redirect_url, PHP_URL_PATH );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/is_singular/" data-id="1421897" title="is_singular" class="function">is_singular</a>() && 1 &gt; $wp_query-&gt;post_count && ($id = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('p')) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $vars = $wpdb-&gt;get_results( $wpdb-&gt;prepare(&quot;SELECT post_type, post_parent FROM $wpdb-&gt;posts WHERE ID = %d&quot;, $id) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($vars[0]) && $vars = $vars[0] ) {&nbsp;</div></li><li><div>            if ( 'revision' == $vars-&gt;post_type && $vars-&gt;post_parent &gt; 0 )&nbsp;</div></li><li><div>                $id = $vars-&gt;post_parent;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>($id) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_qs_args_if_not_in_url/" data-id="1417879" title="_remove_qs_args_if_not_in_url" class="function">_remove_qs_args_if_not_in_url</a>( $redirect['query'], array( 'p', 'page_id', 'attachment_id', 'pagename', 'name', 'post_type' ), $redirect_url );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // These tests give us a WP-generated permalink&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/is_404/" data-id="1421903" title="is_404" class="function">is_404</a>() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Redirect ?page_id, ?p=, ?attachment_id= to their respective url's&nbsp;</div></li><li><div>        $id = max( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('p'), <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('page_id'), <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('attachment_id') );&nbsp;</div></li><li><div>        if ( $id && $redirect_post = <a href="http://hookr.io/4.7.4/functions/get_post/" data-id="1422530" title="get_post" class="function">get_post</a>($id) ) {&nbsp;</div></li><li><div>            $post_type_obj = <a href="http://hookr.io/4.7.4/functions/get_post_type_object/" data-id="1422544" title="get_post_type_object" class="function">get_post_type_object</a>($redirect_post-&gt;post_type);&nbsp;</div></li><li><div>            if ( $post_type_obj-&gt;public && 'auto-draft' != $redirect_post-&gt;post_status ) {&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>($redirect_post);&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_qs_args_if_not_in_url/" data-id="1417879" title="_remove_qs_args_if_not_in_url" class="function">_remove_qs_args_if_not_in_url</a>( $redirect['query'], array( 'p', 'page_id', 'attachment_id', 'pagename', 'name', 'post_type' ), $redirect_url );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'day' ) && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'monthnum' ) && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'year' ) ) {&nbsp;</div></li><li><div>            $year = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'year' );&nbsp;</div></li><li><div>            $month = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'monthnum' );&nbsp;</div></li><li><div>            $day = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'day' );&nbsp;</div></li><li><div>            $date = sprintf( '%04d-%02d-%02d', $year, $month, $day );&nbsp;</div></li><li><div>            if ( ! <a href="http://hookr.io/4.7.4/functions/wp_checkdate/" data-id="1420414" title="wp_checkdate" class="function">wp_checkdate</a>( $month, $day, $year, $date ) ) {&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_month_link/" data-id="1421331" title="get_month_link" class="function">get_month_link</a>( $year, $month );&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_qs_args_if_not_in_url/" data-id="1417879" title="_remove_qs_args_if_not_in_url" class="function">_remove_qs_args_if_not_in_url</a>( $redirect['query'], array( 'year', 'monthnum', 'day' ), $redirect_url );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'monthnum' ) && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'year' ) && 12 &lt; <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'monthnum' ) ) {&nbsp;</div></li><li><div>            $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_year_link/" data-id="1421328" title="get_year_link" class="function">get_year_link</a>( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'year' ) );&nbsp;</div></li><li><div>            $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_qs_args_if_not_in_url/" data-id="1417879" title="_remove_qs_args_if_not_in_url" class="function">_remove_qs_args_if_not_in_url</a>( $redirect['query'], array( 'year', 'monthnum' ), $redirect_url );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $redirect_url ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/redirect_guess_404_permalink/" data-id="1417881" title="redirect_guess_404_permalink" class="function">redirect_guess_404_permalink</a>() ) {&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_qs_args_if_not_in_url/" data-id="1417879" title="_remove_qs_args_if_not_in_url" class="function">_remove_qs_args_if_not_in_url</a>( $redirect['query'], array( 'page', 'feed', 'p', 'page_id', 'attachment_id', 'pagename', 'name', 'post_type' ), $redirect_url );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'page' ) && $wp_query-&gt;post &&&nbsp;</div></li><li><div>            false !== strpos( $wp_query-&gt;post-&gt;post_content, '&lt;!--nextpage--&gt;' ) ) {&nbsp;</div></li><li><div>            $redirect['path'] = rtrim( $redirect['path'], (int) <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'page' ) . '/' );&nbsp;</div></li><li><div>            $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>( 'page', $redirect['query'] );&nbsp;</div></li><li><div>            $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>( $wp_query-&gt;post-&gt;ID );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    } elseif ( is_object($wp_rewrite) && $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>        // rewriting of old ?p=X, ?m=2004, ?m=200401, ?m=20040101&nbsp;</div></li><li><div>        if ( <a href="http://hookr.io/4.7.4/functions/is_attachment/" data-id="1421876" title="is_attachment" class="function">is_attachment</a>() &&&nbsp;</div></li><li><div>            ! array_diff( array_keys( $wp-&gt;query_vars ), array( 'attachment', 'attachment_id' ) ) &&&nbsp;</div></li><li><div>            ! $redirect_url ) {&nbsp;</div></li><li><div>            if ( ! empty( $_GET['attachment_id'] ) ) {&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_attachment_link/" data-id="1421326" title="get_attachment_link" class="function">get_attachment_link</a>( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'attachment_id' ) );&nbsp;</div></li><li><div>                if ( $redirect_url ) {&nbsp;</div></li><li><div>                    $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>( 'attachment_id', $redirect['query'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_attachment_link/" data-id="1421326" title="get_attachment_link" class="function">get_attachment_link</a>();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_single/" data-id="1421896" title="is_single" class="function">is_single</a>() && !empty($_GET['p']) && ! $redirect_url ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>(get_query_var('p')) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>(array('p', 'post_type'), $redirect['query']);&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_single/" data-id="1421896" title="is_single" class="function">is_single</a>() && !empty($_GET['name'])  && ! $redirect_url ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>( $wp_query-&gt;get_queried_object_id() ) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>('name', $redirect['query']);&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_page/" data-id="1421889" title="is_page" class="function">is_page</a>() && !empty($_GET['page_id']) && ! $redirect_url ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>(get_query_var('page_id')) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>('page_id', $redirect['query']);&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_page/" data-id="1421889" title="is_page" class="function">is_page</a>() && !is_feed() && 'page' == <a href="http://hookr.io/4.7.4/functions/get_option/" data-id="1421280" title="get_option" class="function">get_option</a>('show_on_front') && <a href="http://hookr.io/4.7.4/functions/get_queried_object_id/" data-id="1421869" title="get_queried_object_id" class="function">get_queried_object_id</a>() == <a href="http://hookr.io/4.7.4/functions/get_option/" data-id="1421280" title="get_option" class="function">get_option</a>('page_on_front')  && ! $redirect_url ) {&nbsp;</div></li><li><div>            $redirect_url = <a href="http://hookr.io/4.7.4/functions/home_url/" data-id="1421439" title="home_url" class="function">home_url</a>('/');&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_home/" data-id="1421886" title="is_home" class="function">is_home</a>() && !empty($_GET['page_id']) && 'page' == <a href="http://hookr.io/4.7.4/functions/get_option/" data-id="1421280" title="get_option" class="function">get_option</a>('show_on_front') && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('page_id') == <a href="http://hookr.io/4.7.4/functions/get_option/" data-id="1421280" title="get_option" class="function">get_option</a>('page_for_posts')  && ! $redirect_url ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>(get_option('page_for_posts')) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>('page_id', $redirect['query']);&nbsp;</div></li><li><div>        } elseif ( !empty($_GET['m']) && ( <a href="http://hookr.io/4.7.4/functions/is_year/" data-id="1421901" title="is_year" class="function">is_year</a>() || <a href="http://hookr.io/4.7.4/functions/is_month/" data-id="1421888" title="is_month" class="function">is_month</a>() || <a href="http://hookr.io/4.7.4/functions/is_day/" data-id="1421882" title="is_day" class="function">is_day</a>() ) ) {&nbsp;</div></li><li><div>            $m = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('m');&nbsp;</div></li><li><div>            switch ( strlen($m) ) {&nbsp;</div></li><li><div>                case 4: // Yearly&nbsp;</div></li><li><div>                    $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_year_link/" data-id="1421328" title="get_year_link" class="function">get_year_link</a>($m);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 6: // Monthly&nbsp;</div></li><li><div>                    $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_month_link/" data-id="1421331" title="get_month_link" class="function">get_month_link</a>( substr($m, 0, 4), substr($m, 4, 2) );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 8: // Daily&nbsp;</div></li><li><div>                    $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_day_link/" data-id="1421333" title="get_day_link" class="function">get_day_link</a>(substr($m, 0, 4), substr($m, 4, 2), substr($m, 6, 2));&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $redirect_url )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>('m', $redirect['query']);&nbsp;</div></li><li><div>        // now moving on to non ?m=X year/month/day links&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_day/" data-id="1421882" title="is_day" class="function">is_day</a>() && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('year') && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('monthnum') && !empty($_GET['day']) ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_day_link/" data-id="1421333" title="get_day_link" class="function">get_day_link</a>(get_query_var('year'), <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('monthnum'), <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('day')) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>(array('year', 'monthnum', 'day'), $redirect['query']);&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_month/" data-id="1421888" title="is_month" class="function">is_month</a>() && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('year') && !empty($_GET['monthnum']) ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_month_link/" data-id="1421331" title="get_month_link" class="function">get_month_link</a>(get_query_var('year'), <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('monthnum')) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>(array('year', 'monthnum'), $redirect['query']);&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_year/" data-id="1421901" title="is_year" class="function">is_year</a>() && !empty($_GET['year']) ) {&nbsp;</div></li><li><div>            if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_year_link/" data-id="1421328" title="get_year_link" class="function">get_year_link</a>(get_query_var('year')) )&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>('year', $redirect['query']);&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_author/" data-id="1421877" title="is_author" class="function">is_author</a>() && !empty($_GET['author']) && preg_match( '|^[0-9]+$|', $_GET['author'] ) ) {&nbsp;</div></li><li><div>            $author = <a href="http://hookr.io/4.7.4/functions/get_userdata/" data-id="1421537" title="get_userdata" class="function">get_userdata</a>(get_query_var('author'));&nbsp;</div></li><li><div>            if ( ( false !== $author ) && $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT ID FROM $wpdb-&gt;posts WHERE $wpdb-&gt;posts.post_author = %d AND $wpdb-&gt;posts.post_status = 'publish' LIMIT 1&quot;, $author-&gt;ID ) ) ) {&nbsp;</div></li><li><div>                if ( $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_author_posts_url/" data-id="1417822" title="get_author_posts_url" class="function">get_author_posts_url</a>($author-&gt;ID, $author-&gt;user_nicename) )&nbsp;</div></li><li><div>                    $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>('author', $redirect['query']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_category/" data-id="1421878" title="is_category" class="function">is_category</a>() || <a href="http://hookr.io/4.7.4/functions/is_tag/" data-id="1421879" title="is_tag" class="function">is_tag</a>() || <a href="http://hookr.io/4.7.4/functions/is_tax/" data-id="1421880" title="is_tax" class="function">is_tax</a>() ) { // Terms (Tags/categories)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $term_count = 0;&nbsp;</div></li><li><div>            foreach ( $wp_query-&gt;tax_query-&gt;queried_terms as $tax_query )&nbsp;</div></li><li><div>                $term_count += count( $tax_query['terms'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $obj = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>            if ( $term_count &lt;= 1 && !empty($obj-&gt;term_id) && ( $tax_url = <a href="http://hookr.io/4.7.4/functions/get_term_link/" data-id="1422944" title="get_term_link" class="function">get_term_link</a>((int)$obj-&gt;term_id, $obj-&gt;taxonomy) ) && !is_wp_error($tax_url) ) {&nbsp;</div></li><li><div>                if ( !empty($redirect['query']) ) {&nbsp;</div></li><li><div>                    // Strip taxonomy query vars off the url.&nbsp;</div></li><li><div>                    $qv_remove = array( 'term', 'taxonomy');&nbsp;</div></li><li><div>                    if ( <a href="http://hookr.io/4.7.4/functions/is_category/" data-id="1421878" title="is_category" class="function">is_category</a>() ) {&nbsp;</div></li><li><div>                        $qv_remove[] = 'category_name';&nbsp;</div></li><li><div>                        $qv_remove[] = 'cat';&nbsp;</div></li><li><div>                    } elseif ( <a href="http://hookr.io/4.7.4/functions/is_tag/" data-id="1421879" title="is_tag" class="function">is_tag</a>() ) {&nbsp;</div></li><li><div>                        $qv_remove[] = 'tag';&nbsp;</div></li><li><div>                        $qv_remove[] = 'tag_id';&nbsp;</div></li><li><div>                    } else { // Custom taxonomies will have a custom query var, remove those too:&nbsp;</div></li><li><div>                        $tax_obj = <a href="http://hookr.io/4.7.4/functions/get_taxonomy/" data-id="1422883" title="get_taxonomy" class="function">get_taxonomy</a>( $obj-&gt;taxonomy );&nbsp;</div></li><li><div>                        if ( false !== $tax_obj-&gt;query_var )&nbsp;</div></li><li><div>                            $qv_remove[] = $tax_obj-&gt;query_var;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $rewrite_vars = array_diff( array_keys($wp_query-&gt;query), array_keys($_GET) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !array_diff($rewrite_vars, array_keys($_GET)) ) { // Check to see if all the Query vars are coming from the rewrite, none are set via $_GET&nbsp;</div></li><li><div>                        $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>($qv_remove, $redirect['query']); //Remove all of the per-tax qv's&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Create the destination url for this taxonomy&nbsp;</div></li><li><div>                        $tax_url = parse_url($tax_url);&nbsp;</div></li><li><div>                        if ( ! empty($tax_url['query']) ) { // Taxonomy accessible via ?taxonomy=..&term=.. or any custom qv..&nbsp;</div></li><li><div>                            parse_str($tax_url['query'], $query_vars);&nbsp;</div></li><li><div>                            $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/add_query_arg/" data-id="1420259" title="add_query_arg" class="function">add_query_arg</a>($query_vars, $redirect['query']);&nbsp;</div></li><li><div>                        } else { // Taxonomy is accessible via a &quot;pretty-URL&quot;&nbsp;</div></li><li><div>                            $redirect['path'] = $tax_url['path'];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    } else { // Some query vars are set via $_GET. Unset those from $_GET that exist via the rewrite&nbsp;</div></li><li><div>                        foreach ( $qv_remove as $_qv ) {&nbsp;</div></li><li><div>                            if ( isset($rewrite_vars[$_qv]) )&nbsp;</div></li><li><div>                                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>($_qv, $redirect['query']);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( <a href="http://hookr.io/4.7.4/functions/is_single/" data-id="1421896" title="is_single" class="function">is_single</a>() && strpos($wp_rewrite-&gt;permalink_structure, '%category%') !== false && $cat = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'category_name' ) ) {&nbsp;</div></li><li><div>            $category = <a href="http://hookr.io/4.7.4/functions/get_category_by_path/" data-id="1417909" title="get_category_by_path" class="function">get_category_by_path</a>( $cat );&nbsp;</div></li><li><div>            if ( ( ! $category || <a href="http://hookr.io/4.7.4/functions/is_wp_error/" data-id="1420728" title="is_wp_error" class="function">is_wp_error</a>( $category ) ) || ! <a href="http://hookr.io/4.7.4/functions/has_term/" data-id="1417986" title="has_term" class="function">has_term</a>( $category-&gt;term_id, 'category', $wp_query-&gt;get_queried_object_id() ) ) {&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>($wp_query-&gt;get_queried_object_id());&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Post Paging&nbsp;</div></li><li><div>        if ( <a href="http://hookr.io/4.7.4/functions/is_singular/" data-id="1421897" title="is_singular" class="function">is_singular</a>() && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('page') ) {&nbsp;</div></li><li><div>            if ( !$redirect_url )&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_permalink/" data-id="1421317" title="get_permalink" class="function">get_permalink</a>( <a href="http://hookr.io/4.7.4/functions/get_queried_object_id/" data-id="1421869" title="get_queried_object_id" class="function">get_queried_object_id</a>() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $page = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'page' );&nbsp;</div></li><li><div>            if ( $page &gt; 1 ) {&nbsp;</div></li><li><div>                if ( <a href="http://hookr.io/4.7.4/functions/is_front_page/" data-id="1421885" title="is_front_page" class="function">is_front_page</a>() ) {&nbsp;</div></li><li><div>                    $redirect_url = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>( $redirect_url ) . <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>( &quot;$wp_rewrite-&gt;pagination_base/$page&quot;, 'paged' );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $redirect_url = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>( $redirect_url ) . <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>( $page, 'single_paged' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>( 'page', $redirect['query'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // paging and feeds&nbsp;</div></li><li><div>        if ( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('paged') || <a href="http://hookr.io/4.7.4/functions/is_feed/" data-id="1421883" title="is_feed" class="function">is_feed</a>() || <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('cpage') ) {&nbsp;</div></li><li><div>            while ( preg_match( &quot;#/$wp_rewrite-&gt;pagination_base/?[0-9]+?(/+)?$#&quot;, $redirect['path'] ) || preg_match( '#/(comments/?)?(feed|rss|rdf|atom|rss2)(/+)?$#', $redirect['path'] ) || preg_match( &quot;#/{$wp_rewrite-&gt;comments_pagination_base}-[0-9]+(/+)?$#&quot;, $redirect['path'] ) ) {&nbsp;</div></li><li><div>                // Strip off paging and feed&nbsp;</div></li><li><div>                $redirect['path'] = preg_replace(&quot;#/$wp_rewrite-&gt;pagination_base/?[0-9]+?(/+)?$#&quot;, '/', $redirect['path']); // strip off any existing paging&nbsp;</div></li><li><div>                $redirect['path'] = preg_replace('#/(comments/?)?(feed|rss2?|rdf|atom)(/+|$)#', '/', $redirect['path']); // strip off feed endings&nbsp;</div></li><li><div>                $redirect['path'] = preg_replace(&quot;#/{$wp_rewrite-&gt;comments_pagination_base}-[0-9]+?(/+)?$#&quot;, '/', $redirect['path']); // strip off any existing comment paging&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $addl_path = '';&nbsp;</div></li><li><div>            if ( <a href="http://hookr.io/4.7.4/functions/is_feed/" data-id="1421883" title="is_feed" class="function">is_feed</a>() && in_array( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('feed'), $wp_rewrite-&gt;feeds ) ) {&nbsp;</div></li><li><div>                $addl_path = !empty( $addl_path ) ? <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($addl_path) : '';&nbsp;</div></li><li><div>                if ( !is_singular() && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'withcomments' ) )&nbsp;</div></li><li><div>                    $addl_path .= 'comments/';&nbsp;</div></li><li><div>                if ( ( 'rss' == <a href="http://hookr.io/4.7.4/functions/get_default_feed/" data-id="1419224" title="get_default_feed" class="function">get_default_feed</a>() && 'feed' == <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('feed') ) || 'rss' == <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('feed') )&nbsp;</div></li><li><div>                    $addl_path .= <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>( 'feed/' . ( ( <a href="http://hookr.io/4.7.4/functions/get_default_feed/" data-id="1419224" title="get_default_feed" class="function">get_default_feed</a>() == 'rss2' ) ? '' : 'rss2' ), 'feed' );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $addl_path .= <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>( 'feed/' . ( ( <a href="http://hookr.io/4.7.4/functions/get_default_feed/" data-id="1419224" title="get_default_feed" class="function">get_default_feed</a>() ==  <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('feed') || 'feed' == <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('feed') ) ? '' : <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('feed') ), 'feed' );&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>( 'feed', $redirect['query'] );&nbsp;</div></li><li><div>            } elseif ( <a href="http://hookr.io/4.7.4/functions/is_feed/" data-id="1421883" title="is_feed" class="function">is_feed</a>() && 'old' == <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('feed') ) {&nbsp;</div></li><li><div>                $old_feed_files = array(&nbsp;</div></li><li><div>                    'wp-atom.php' =&gt; 'atom', &nbsp;</div></li><li><div>                    'wp-commentsrss2.php' =&gt; 'comments_rss2', &nbsp;</div></li><li><div>                    'wp-feed.php' =&gt; <a href="http://hookr.io/4.7.4/functions/get_default_feed/" data-id="1419224" title="get_default_feed" class="function">get_default_feed</a>(), &nbsp;</div></li><li><div>                    'wp-rdf.php' =&gt; 'rdf', &nbsp;</div></li><li><div>                    'wp-rss.php' =&gt; 'rss2', &nbsp;</div></li><li><div>                    'wp-rss2.php' =&gt; 'rss2', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                if ( isset( $old_feed_files[ basename( $redirect['path'] ) ] ) ) {&nbsp;</div></li><li><div>                    $redirect_url = <a href="http://hookr.io/4.7.4/functions/get_feed_link/" data-id="1421335" title="get_feed_link" class="function">get_feed_link</a>( $old_feed_files[ basename( $redirect['path'] ) ] );&nbsp;</div></li><li><div>                    <a href="http://hookr.io/4.7.4/functions/wp_redirect/" data-id="1421552" title="wp_redirect" class="function">wp_redirect</a>( $redirect_url, 301 );&nbsp;</div></li><li><div>                    die();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('paged') &gt; 0 ) {&nbsp;</div></li><li><div>                $paged = <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('paged');&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>( 'paged', $redirect['query'] );&nbsp;</div></li><li><div>                if ( !is_feed() ) {&nbsp;</div></li><li><div>                    if ( $paged &gt; 1 && !is_single() ) {&nbsp;</div></li><li><div>                        $addl_path = ( !empty( $addl_path ) ? <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($addl_path) : '' ) . <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>(&quot;$wp_rewrite-&gt;pagination_base/$paged&quot;, 'paged');&nbsp;</div></li><li><div>                    } elseif ( !is_single() ) {&nbsp;</div></li><li><div>                        $addl_path = !empty( $addl_path ) ? <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($addl_path) : '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } elseif ( $paged &gt; 1 ) {&nbsp;</div></li><li><div>                    $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/add_query_arg/" data-id="1420259" title="add_query_arg" class="function">add_query_arg</a>( 'paged', $paged, $redirect['query'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( <a href="http://hookr.io/4.7.4/functions/get_option/" data-id="1421280" title="get_option" class="function">get_option</a>( 'page_comments' ) && (&nbsp;</div></li><li><div>                ( 'newest' == <a href="http://hookr.io/4.7.4/functions/get_option/" data-id="1421280" title="get_option" class="function">get_option</a>( 'default_comments_page' ) && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'cpage' ) &gt; 0 ) ||&nbsp;</div></li><li><div>                ( 'newest' != <a href="http://hookr.io/4.7.4/functions/get_option/" data-id="1421280" title="get_option" class="function">get_option</a>( 'default_comments_page' ) && <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>( 'cpage' ) &gt; 1 )&nbsp;</div></li><li><div> ) ) {&nbsp;</div></li><li><div>                $addl_path = ( !empty( $addl_path ) ? <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($addl_path) : '' ) . <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>( $wp_rewrite-&gt;comments_pagination_base . '-' . <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('cpage'), 'commentpaged' );&nbsp;</div></li><li><div>                $redirect['query'] = <a href="http://hookr.io/4.7.4/functions/remove_query_arg/" data-id="1420261" title="remove_query_arg" class="function">remove_query_arg</a>( 'cpage', $redirect['query'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $redirect['path'] = <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>( preg_replace('|/' . preg_quote( $wp_rewrite-&gt;index, '|' ) . '/?$|', '/', $redirect['path']) ); // strip off trailing /index.php/&nbsp;</div></li><li><div>            if ( !empty( $addl_path ) && $wp_rewrite-&gt;using_index_permalinks() && strpos($redirect['path'], '/' . $wp_rewrite-&gt;index . '/') === false )&nbsp;</div></li><li><div>                $redirect['path'] = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($redirect['path']) . $wp_rewrite-&gt;index . '/';&nbsp;</div></li><li><div>            if ( !empty( $addl_path ) )&nbsp;</div></li><li><div>                $redirect['path'] = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($redirect['path']) . $addl_path;&nbsp;</div></li><li><div>            $redirect_url = $redirect['scheme'] . '://' . $redirect['host'] . $redirect['path'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'wp-register.php' == basename( $redirect['path'] ) ) {&nbsp;</div></li><li><div>            if ( <a href="http://hookr.io/4.7.4/functions/is_multisite/" data-id="1420717" title="is_multisite" class="function">is_multisite</a>() ) {&nbsp;</div></li><li><div>                /** This filter is documented in wp-login.php */&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/wp_signup_location/" data-id="1423347" title="wp_signup_location" class="filter">'wp_signup_location'</a>, <a href="http://hookr.io/4.7.4/functions/network_site_url/" data-id="1421459" title="network_site_url" class="function">network_site_url</a>( 'wp-signup.php' ) );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $redirect_url = <a href="http://hookr.io/4.7.4/functions/wp_registration_url/" data-id="1419907" title="wp_registration_url" class="function">wp_registration_url</a>();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            <a href="http://hookr.io/4.7.4/functions/wp_redirect/" data-id="1421552" title="wp_redirect" class="function">wp_redirect</a>( $redirect_url, 301 );&nbsp;</div></li><li><div>            die();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // tack on any additional query vars&nbsp;</div></li><li><div>    $redirect['query'] = preg_replace( '#^\??&*?#', '', $redirect['query'] );&nbsp;</div></li><li><div>    if ( $redirect_url && !empty($redirect['query']) ) {&nbsp;</div></li><li><div>        parse_str( $redirect['query'], $_parsed_query );&nbsp;</div></li><li><div>        $redirect = @parse_url($redirect_url);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $_parsed_query['name'] ) && ! empty( $redirect['query'] ) ) {&nbsp;</div></li><li><div>            parse_str( $redirect['query'], $_parsed_redirect_query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $_parsed_redirect_query['name'] ) )&nbsp;</div></li><li><div>                unset( $_parsed_query['name'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_parsed_query = <a href="http://hookr.io/4.7.4/functions/rawurlencode_deep/" data-id="1420101" title="rawurlencode_deep" class="function">rawurlencode_deep</a>( $_parsed_query );&nbsp;</div></li><li><div>        $redirect_url = <a href="http://hookr.io/4.7.4/functions/add_query_arg/" data-id="1420259" title="add_query_arg" class="function">add_query_arg</a>( $_parsed_query, $redirect_url );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( $redirect_url )&nbsp;</div></li><li><div>        $redirect = @parse_url($redirect_url);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // www.example.com vs example.com&nbsp;</div></li><li><div>    $user_home = @parse_url(home_url());&nbsp;</div></li><li><div>    if ( !empty($user_home['host']) )&nbsp;</div></li><li><div>        $redirect['host'] = $user_home['host'];&nbsp;</div></li><li><div>    if ( empty($user_home['path']) )&nbsp;</div></li><li><div>        $user_home['path'] = '/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Handle ports&nbsp;</div></li><li><div>    if ( !empty($user_home['port']) )&nbsp;</div></li><li><div>        $redirect['port'] = $user_home['port'];&nbsp;</div></li><li><div>    else&nbsp;</div></li><li><div>        unset($redirect['port']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // trailing /index.php&nbsp;</div></li><li><div>    $redirect['path'] = preg_replace('|/' . preg_quote( $wp_rewrite-&gt;index, '|' ) . '/*?$|', '/', $redirect['path']);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    // Remove trailing spaces from the path&nbsp;</div></li><li><div>    $redirect['path'] = preg_replace( '#(%20| )+$#', '', $redirect['path'] );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    if ( !empty( $redirect['query'] ) ) {&nbsp;</div></li><li><div>        // Remove trailing spaces from certain terminating query string args&nbsp;</div></li><li><div>        $redirect['query'] = preg_replace( '#((p|page_id|cat|tag)=[^&]*?)(%20| )+$#', '$1', $redirect['query'] );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        // Clean up empty query strings&nbsp;</div></li><li><div>        $redirect['query'] = trim(preg_replace( '#(^|&)(p|page_id|cat|tag)=?(&|$)#', '&', $redirect['query']), '&');&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        // Redirect obsolete feeds&nbsp;</div></li><li><div>        $redirect['query'] = preg_replace( '#(^|&)feed=rss(&|$)#', '$1feed=rss2$2', $redirect['query'] );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        // Remove redundant leading ampersands&nbsp;</div></li><li><div>        $redirect['query'] = preg_replace( '#^\??&*?#', '', $redirect['query'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    // strip /index.php/ when we're not using PATHINFO permalinks&nbsp;</div></li><li><div>    if ( !$wp_rewrite-&gt;using_index_permalinks() )&nbsp;</div></li><li><div>        $redirect['path'] = str_replace( '/' . $wp_rewrite-&gt;index . '/', '/', $redirect['path'] );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    // trailing slashes&nbsp;</div></li><li><div>    if ( is_object($wp_rewrite) && $wp_rewrite-&gt;using_permalinks() && !is_404() && (!is_front_page() || ( <a href="http://hookr.io/4.7.4/functions/is_front_page/" data-id="1421885" title="is_front_page" class="function">is_front_page</a>() && (get_query_var('paged') &gt; 1) ) ) ) {&nbsp;</div></li><li><div>        $user_ts_type = '';&nbsp;</div></li><li><div>        if ( <a href="http://hookr.io/4.7.4/functions/get_query_var/" data-id="1421867" title="get_query_var" class="function">get_query_var</a>('paged') &gt; 0 ) {&nbsp;</div></li><li><div>            $user_ts_type = 'paged';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            foreach ( array('single', 'category', 'page', 'day', 'month', 'year', 'home') as $type ) {&nbsp;</div></li><li><div>                $func = 'is_' . $type;&nbsp;</div></li><li><div>                if ( call_user_func($func) ) {&nbsp;</div></li><li><div>                    $user_ts_type = $type;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $redirect['path'] = <a href="http://hookr.io/4.7.4/functions/user_trailingslashit/" data-id="1421311" title="user_trailingslashit" class="function">user_trailingslashit</a>($redirect['path'], $user_ts_type);&nbsp;</div></li><li><div>    } elseif ( <a href="http://hookr.io/4.7.4/functions/is_front_page/" data-id="1421885" title="is_front_page" class="function">is_front_page</a>() ) {&nbsp;</div></li><li><div>        $redirect['path'] = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($redirect['path']);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    // Strip multiple slashes out of the URL&nbsp;</div></li><li><div>    if ( strpos($redirect['path'], '//') &gt; -1 )&nbsp;</div></li><li><div>        $redirect['path'] = preg_replace('|/+|', '/', $redirect['path']);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    // Always trailing slash the Front Page URL&nbsp;</div></li><li><div>    if ( <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>( $redirect['path'] ) == <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>( $user_home['path'] ) )&nbsp;</div></li><li><div>        $redirect['path'] = <a href="http://hookr.io/4.7.4/functions/trailingslashit/" data-id="1420095" title="trailingslashit" class="function">trailingslashit</a>($redirect['path']);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    // Ignore differences in host capitalization, as this can lead to infinite redirects&nbsp;</div></li><li><div>    // Only redirect no-www &lt;=&gt; yes-www&nbsp;</div></li><li><div>    if ( strtolower($original['host']) == strtolower($redirect['host']) ||&nbsp;</div></li><li><div>        ( strtolower($original['host']) != 'www.' . strtolower($redirect['host']) && 'www.' . strtolower($original['host']) != strtolower($redirect['host']) ) )&nbsp;</div></li><li><div>        $redirect['host'] = $original['host'];&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    $compare_original = array( $original['host'], $original['path'] );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    if ( !empty( $original['port'] ) )&nbsp;</div></li><li><div>        $compare_original[] = $original['port'];&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    if ( !empty( $original['query'] ) )&nbsp;</div></li><li><div>        $compare_original[] = $original['query'];&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    $compare_redirect = array( $redirect['host'], $redirect['path'] );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    if ( !empty( $redirect['port'] ) )&nbsp;</div></li><li><div>        $compare_redirect[] = $redirect['port'];&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    if ( !empty( $redirect['query'] ) )&nbsp;</div></li><li><div>        $compare_redirect[] = $redirect['query'];&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    if ( $compare_original !== $compare_redirect ) {&nbsp;</div></li><li><div>        $redirect_url = $redirect['scheme'] . '://' . $redirect['host'];&nbsp;</div></li><li><div>        if ( !empty($redirect['port']) )&nbsp;</div></li><li><div>            $redirect_url .= ':' . $redirect['port'];&nbsp;</div></li><li><div>        $redirect_url .= $redirect['path'];&nbsp;</div></li><li><div>        if ( !empty($redirect['query']) )&nbsp;</div></li><li><div>            $redirect_url .= '?' . $redirect['query'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    if ( ! $redirect_url || $redirect_url == $requested_url ) {&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    // Hex encoded octets are case-insensitive.&nbsp;</div></li><li><div>    if ( false !== strpos($requested_url, '%') ) {&nbsp;</div></li><li><div>        if ( !function_exists('lowercase_octets') ) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Converts the first hex-encoded octet match to lowercase.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.1.0&nbsp;</div></li><li><div>             * @ignore&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array $matches Hex-encoded octet matches for the requested URL.&nbsp;</div></li><li><div>             * @return string Lowercased version of the first match.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            function lowercase_octets($matches) {&nbsp;</div></li><li><div>                return strtolower( $matches[0] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $requested_url = preg_replace_callback('|%[a-fA-F0-9][a-fA-F0-9]|', 'lowercase_octets', $requested_url);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filters the canonical redirect URL.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Returning false to this filter will cancel the redirect.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $redirect_url  The redirect URL.&nbsp;</div></li><li><div>     * @param string $requested_url The requested URL.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    $redirect_url = <a href="http://hookr.io/4.7.4/functions/apply_filters/" data-id="1421358" title="apply_filters" class="function">apply_filters</a>( <a href="http://hookr.io/4.7.4/filters/redirect_canonical/" data-id="1417887" title="redirect_canonical" class="filter">'redirect_canonical'</a>, $redirect_url, $requested_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // yes, again -- in case the filter aborted the request&nbsp;</div></li><li><div>    if ( ! $redirect_url || <a href="http://hookr.io/4.7.4/functions/strip_fragment_from_url/" data-id="1417880" title="strip_fragment_from_url" class="function">strip_fragment_from_url</a>( $redirect_url ) == <a href="http://hookr.io/4.7.4/functions/strip_fragment_from_url/" data-id="1417880" title="strip_fragment_from_url" class="function">strip_fragment_from_url</a>( $requested_url ) ) {&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ( $do_redirect ) {&nbsp;</div></li><li><div>        // protect against chained redirects&nbsp;</div></li><li><div>        if ( !redirect_canonical($redirect_url, false) ) {&nbsp;</div></li><li><div>            <a href="http://hookr.io/4.7.4/functions/wp_redirect/" data-id="1421552" title="wp_redirect" class="function">wp_redirect</a>($redirect_url, 301);&nbsp;</div></li><li><div>            exit();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // Debug&nbsp;</div></li><li><div>            // die(&quot;1: $redirect_url&lt;br /&gt;2: &quot; . redirect_canonical( $redirect_url, false ) );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        return $redirect_url;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.3.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/functions/redirect_canonical/" class="active">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/functions/redirect_canonical/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/functions/redirect_canonical/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/functions/redirect_canonical/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/functions/redirect_canonical/" class="">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>function</li><li><span></span>redirect_canonical</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>