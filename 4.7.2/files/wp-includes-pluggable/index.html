<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.2" data-type="file" data-id="4819"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-pluggable | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=738f1ec51eba56aa8e62064e7da29f4f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-pluggable/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-pluggable%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-pluggable%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.2-file-wp-includes-pluggable","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-pluggable" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.2." href="http://hookr.io/4.7.2/" class="H_VERSION"><span property="name">4.7.2</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-pluggable</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6308"><a href="http://hookr.io/4.7.2/all/" title="All">All <span class="count badge">6308</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/4.7.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7.2/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.2/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7.2/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.2/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.2/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2852"><a href="http://hookr.io/4.7.2/functions/" title="Functions">Functions <span class="count badge">2852</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/pluggable.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * These functions can be replaced via plugins. If plugins do not redefine these</span>&nbsp;</div></li><li><div><span class="comment"> * functions, then these will be used instead.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_set_current_user') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Changes the current user by ID or name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Set $id to null and specify a name if you do not know a user's ID.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Some WordPress functionality is based on the current user and not based on</span>&nbsp;</div></li><li><div><span class="comment"> * the signed in user. Therefore, it opens the ability to edit and perform</span>&nbsp;</div></li><li><div><span class="comment"> * actions on users who aren't signed in.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.3</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_User $current_user The current user object which holds the user data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $id   User ID</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name User's username</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_User Current user User object</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_set_current_user($id, $name = '') {&nbsp;</div></li><li><div>  global $current_user;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If `$id` matches the user who's already current, there's nothing to do.</span>&nbsp;</div></li><li><div>  if ( isset( $current_user )&nbsp;</div></li><li><div>      && ( $current_user instanceof WP_User )&nbsp;</div></li><li><div>      && ( $id == $current_user-&gt;ID )&nbsp;</div></li><li><div>      && ( null !== $id )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>      return $current_user;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_user = new WP_User( $id, $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  setup_userdata( $current_user-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the current user is set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.1</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'set_current_user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $current_user;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_get_current_user') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the current user object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Will set the current user, if the current user is not set. The current user</span>&nbsp;</div></li><li><div><span class="comment"> * will be set to the logged-in person. If no user is logged-in, then it will</span>&nbsp;</div></li><li><div><span class="comment"> * set the current user to 0, which is invalid and won't have any permissions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see _wp_get_current_user()</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_User $current_user Checks if the current user is set.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_User Current WP_User instance.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_current_user() {&nbsp;</div></li><li><div>  return _wp_get_current_user();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('get_userdata') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve user info by user ID.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.71</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id User ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_User|false WP_User object on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_userdata( $user_id ) {&nbsp;</div></li><li><div>  return get_user_by( 'id', $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('get_user_by') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve user info by a given field</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Added 'ID' as an alias of 'id' for the `$field` parameter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $field The field to retrieve the user with. id | ID | slug | email | login.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|string $value A value for $field. A user ID, slug, email address, or login name.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_User|false WP_User object on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_user_by( $field, $value ) {&nbsp;</div></li><li><div>  $userdata = WP_User::get_data_by( $field, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$userdata )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user = new WP_User;&nbsp;</div></li><li><div>  $user-&gt;init( $userdata );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $user;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('cache_users') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve info for user lists to prevent multiple queries by get_userdata()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $user_ids User ID numbers list</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function cache_users( $user_ids ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $clean = _get_non_cached_ids( $user_ids, 'users' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $clean ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $list = implode( ', ', $clean );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $users = $wpdb-&gt;get_results( &quot;SELECT * FROM $wpdb-&gt;users WHERE ID IN ($list)&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $ids = array();&nbsp;</div></li><li><div>  foreach ( $users as $user ) {&nbsp;</div></li><li><div>      update_user_caches( $user );&nbsp;</div></li><li><div>      $ids[] = $user-&gt;ID;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  update_meta_cache( 'user', $ids );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'wp_mail' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Send mail, similar to PHP's mail</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A true return value does not automatically mean that the user received the</span>&nbsp;</div></li><li><div><span class="comment"> * email successfully. It just only means that the method used was able to</span>&nbsp;</div></li><li><div><span class="comment"> * process the request without any errors.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Using the two 'wp_mail_from' and 'wp_mail_from_name' hooks allow from</span>&nbsp;</div></li><li><div><span class="comment"> * creating a from address like 'Name &lt;email@address.com&gt;' when both are set. If</span>&nbsp;</div></li><li><div><span class="comment"> * just 'wp_mail_from' is set, then just the email address will be used with no</span>&nbsp;</div></li><li><div><span class="comment"> * name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The default content type is 'text/plain' which does not allow using HTML.</span>&nbsp;</div></li><li><div><span class="comment"> * However, you can set the content type of the email by using the</span>&nbsp;</div></li><li><div><span class="comment"> * {@see 'wp_mail_content_type'} filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The default charset is based on the charset used on the blog. The charset can</span>&nbsp;</div></li><li><div><span class="comment"> * be set using the {@see 'wp_mail_charset'} filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global PHPMailer $phpmailer</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $to          Array or comma-separated list of email addresses to send message.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $subject     Email subject</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $message     Message contents</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $headers     Optional. Additional headers.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $attachments Optional. Files to attach.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether the email contents were sent successfully.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_mail( $to, $subject, $message, $headers = '', $attachments = array() ) {&nbsp;</div></li><li><div>  <span class="comment">// Compact the input, apply the filters, and extract them back out</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the wp_mail() arguments.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args A compacted array of wp_mail() arguments, including the &quot;to&quot; email, </span>&nbsp;</div></li><li><div><span class="comment">   *                    subject, message, headers, and attachments values.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $atts = apply_filters( 'wp_mail', compact( 'to', 'subject', 'message', 'headers', 'attachments' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $atts['to'] ) ) {&nbsp;</div></li><li><div>      $to = $atts['to'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $atts['subject'] ) ) {&nbsp;</div></li><li><div>      $subject = $atts['subject'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $atts['message'] ) ) {&nbsp;</div></li><li><div>      $message = $atts['message'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $atts['headers'] ) ) {&nbsp;</div></li><li><div>      $headers = $atts['headers'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $atts['attachments'] ) ) {&nbsp;</div></li><li><div>      $attachments = $atts['attachments'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $attachments ) ) {&nbsp;</div></li><li><div>      $attachments = explode( &quot;\n&quot;, str_replace( &quot;\r\n&quot;, &quot;\n&quot;, $attachments ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  global $phpmailer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// (Re)create it, if it's gone missing</span>&nbsp;</div></li><li><div>  if ( ! ( $phpmailer instanceof PHPMailer ) ) {&nbsp;</div></li><li><div>      require_once ABSPATH . WPINC . '/class-phpmailer.php';&nbsp;</div></li><li><div>      require_once ABSPATH . WPINC . '/class-smtp.php';&nbsp;</div></li><li><div>      $phpmailer = new PHPMailer( true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Headers</span>&nbsp;</div></li><li><div>  $cc = $bcc = $reply_to = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $headers ) ) {&nbsp;</div></li><li><div>      $headers = array();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( !is_array( $headers ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Explode the headers out, so this function can take both</span>&nbsp;</div></li><li><div>          <span class="comment">// string headers and an array of headers.</span>&nbsp;</div></li><li><div>          $tempheaders = explode( &quot;\n&quot;, str_replace( &quot;\r\n&quot;, &quot;\n&quot;, $headers ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tempheaders = $headers;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $headers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If it's actually got contents</span>&nbsp;</div></li><li><div>      if ( !empty( $tempheaders ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Iterate through the raw headers</span>&nbsp;</div></li><li><div>          foreach ( (array) $tempheaders as $header ) {&nbsp;</div></li><li><div>              if ( strpos($header, ':') === false ) {&nbsp;</div></li><li><div>                  if ( false !== stripos( $header, 'boundary=' ) ) {&nbsp;</div></li><li><div>                      $parts = preg_split('/boundary=/i', trim( $header ) );&nbsp;</div></li><li><div>                      $boundary = trim( str_replace( array( &quot;'&quot;, '&quot;' ), '', $parts[1] ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Explode them out</span>&nbsp;</div></li><li><div>              list( $name, $content ) = explode( ':', trim( $header ), 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Cleanup crew</span>&nbsp;</div></li><li><div>              $name = trim( $name );&nbsp;</div></li><li><div>              $content = trim( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              switch ( strtolower( $name ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// Mainly for legacy -- process a From: header if it's there</span>&nbsp;</div></li><li><div>                  case 'from':&nbsp;</div></li><li><div>                      $bracket_pos = strpos( $content, '&lt;' );&nbsp;</div></li><li><div>                      if ( $bracket_pos !== false ) {&nbsp;</div></li><li><div>                          <span class="comment">// Text before the bracketed email is the &quot;From&quot; name.</span>&nbsp;</div></li><li><div>                          if ( $bracket_pos &gt; 0 ) {&nbsp;</div></li><li><div>                              $from_name = substr( $content, 0, $bracket_pos - 1 );&nbsp;</div></li><li><div>                              $from_name = str_replace( '&quot;', '', $from_name );&nbsp;</div></li><li><div>                              $from_name = trim( $from_name );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $from_email = substr( $content, $bracket_pos + 1 );&nbsp;</div></li><li><div>                          $from_email = str_replace( '&gt;', '', $from_email );&nbsp;</div></li><li><div>                          $from_email = trim( $from_email );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Avoid setting an empty $from_email.</span>&nbsp;</div></li><li><div>                      } elseif ( '' !== trim( $content ) ) {&nbsp;</div></li><li><div>                          $from_email = trim( $content );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'content-type':&nbsp;</div></li><li><div>                      if ( strpos( $content, ';' ) !== false ) {&nbsp;</div></li><li><div>                          list( $type, $charset_content ) = explode( ';', $content );&nbsp;</div></li><li><div>                          $content_type = trim( $type );&nbsp;</div></li><li><div>                          if ( false !== stripos( $charset_content, 'charset=' ) ) {&nbsp;</div></li><li><div>                              $charset = trim( str_replace( array( 'charset=', '&quot;' ), '', $charset_content ) );&nbsp;</div></li><li><div>                          } elseif ( false !== stripos( $charset_content, 'boundary=' ) ) {&nbsp;</div></li><li><div>                              $boundary = trim( str_replace( array( 'BOUNDARY=', 'boundary=', '&quot;' ), '', $charset_content ) );&nbsp;</div></li><li><div>                              $charset = '';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Avoid setting an empty $content_type.</span>&nbsp;</div></li><li><div>                      } elseif ( '' !== trim( $content ) ) {&nbsp;</div></li><li><div>                          $content_type = trim( $content );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'cc':&nbsp;</div></li><li><div>                      $cc = array_merge( (array) $cc, explode( ', ', $content ) );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'bcc':&nbsp;</div></li><li><div>                      $bcc = array_merge( (array) $bcc, explode( ', ', $content ) );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'reply-to':&nbsp;</div></li><li><div>                      $reply_to = array_merge( (array) $reply_to, explode( ', ', $content ) );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  default:&nbsp;</div></li><li><div>                      <span class="comment">// Add it to our grand headers array</span>&nbsp;</div></li><li><div>                      $headers[trim( $name )] = trim( $content );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Empty out the values that may be set</span>&nbsp;</div></li><li><div>  $phpmailer-&gt;ClearAllRecipients();&nbsp;</div></li><li><div>  $phpmailer-&gt;ClearAttachments();&nbsp;</div></li><li><div>  $phpmailer-&gt;ClearCustomHeaders();&nbsp;</div></li><li><div>  $phpmailer-&gt;ClearReplyTos();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// From email and name</span>&nbsp;</div></li><li><div>  <span class="comment">// If we don't have a name from the input headers</span>&nbsp;</div></li><li><div>  if ( !isset( $from_name ) )&nbsp;</div></li><li><div>      $from_name = 'WordPress';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** If we don't have an email from the input headers default to wordpress@$sitename</span>&nbsp;</div></li><li><div><span class="comment">   * Some hosts will block outgoing mail from this address if it doesn't exist but</span>&nbsp;</div></li><li><div><span class="comment">   * there's no easy alternative. Defaulting to admin_email might appear to be another</span>&nbsp;</div></li><li><div><span class="comment">   * option but some hosts may refuse to relay mail from an unknown domain. See</span>&nbsp;</div></li><li><div><span class="comment">   * https://core.trac.wordpress.org/ticket/5007.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !isset( $from_email ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Get the site domain and get rid of www.</span>&nbsp;</div></li><li><div>      $sitename = strtolower( $_SERVER['SERVER_NAME'] );&nbsp;</div></li><li><div>      if ( substr( $sitename, 0, 4 ) == 'www.' ) {&nbsp;</div></li><li><div>          $sitename = substr( $sitename, 4 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $from_email = 'wordpress@' . $sitename;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the email address to send from.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $from_email Email address to send from.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $from_email = apply_filters( 'wp_mail_from', $from_email );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the name to associate with the &quot;from&quot; email address.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $from_name Name associated with the &quot;from&quot; email address.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $from_name = apply_filters( 'wp_mail_from_name', $from_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $phpmailer-&gt;setFrom( $from_email, $from_name, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set destination addresses</span>&nbsp;</div></li><li><div>  if ( !is_array( $to ) )&nbsp;</div></li><li><div>      $to = explode( ', ', $to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set mail's subject and body</span>&nbsp;</div></li><li><div>  $phpmailer-&gt;Subject = $subject;&nbsp;</div></li><li><div>  $phpmailer-&gt;Body = $message;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Use appropriate methods for handling addresses, rather than treating them as generic headers</span>&nbsp;</div></li><li><div>  $address_headers = compact( 'to', 'cc', 'bcc', 'reply_to' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $address_headers as $address_header =&gt; $addresses ) {&nbsp;</div></li><li><div>      if ( empty( $addresses ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( (array) $addresses as $address ) {&nbsp;</div></li><li><div>          try {&nbsp;</div></li><li><div>              <span class="comment">// Break $recipient into name and address parts if in the format &quot;Foo &lt;bar@baz.com&gt;&quot;</span>&nbsp;</div></li><li><div>              $recipient_name = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( preg_match( '/(.*)&lt;(.+)&gt;/', $address, $matches ) ) {&nbsp;</div></li><li><div>                  if ( count( $matches ) == 3 ) {&nbsp;</div></li><li><div>                      $recipient_name = $matches[1];&nbsp;</div></li><li><div>                      $address = $matches[2];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              switch ( $address_header ) {&nbsp;</div></li><li><div>                  case 'to':&nbsp;</div></li><li><div>                      $phpmailer-&gt;addAddress( $address, $recipient_name );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'cc':&nbsp;</div></li><li><div>                      $phpmailer-&gt;addCc( $address, $recipient_name );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'bcc':&nbsp;</div></li><li><div>                      $phpmailer-&gt;addBcc( $address, $recipient_name );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'reply_to':&nbsp;</div></li><li><div>                      $phpmailer-&gt;addReplyTo( $address, $recipient_name );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } catch ( phpmailerException $e ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set to use PHP's mail()</span>&nbsp;</div></li><li><div>  $phpmailer-&gt;IsMail();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set Content-Type and charset</span>&nbsp;</div></li><li><div>  <span class="comment">// If we don't have a content-type from the input headers</span>&nbsp;</div></li><li><div>  if ( !isset( $content_type ) )&nbsp;</div></li><li><div>      $content_type = 'text/plain';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the wp_mail() content type.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content_type Default wp_mail() content type.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $content_type = apply_filters( 'wp_mail_content_type', $content_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $phpmailer-&gt;ContentType = $content_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set whether it's plaintext, depending on $content_type</span>&nbsp;</div></li><li><div>  if ( 'text/html' == $content_type )&nbsp;</div></li><li><div>      $phpmailer-&gt;IsHTML( true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If we don't have a charset from the input headers</span>&nbsp;</div></li><li><div>  if ( !isset( $charset ) )&nbsp;</div></li><li><div>      $charset = get_bloginfo( 'charset' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set the content-type and charset</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default wp_mail() charset.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $charset Default email charset.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $phpmailer-&gt;CharSet = apply_filters( 'wp_mail_charset', $charset );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set custom headers</span>&nbsp;</div></li><li><div>  if ( !empty( $headers ) ) {&nbsp;</div></li><li><div>      foreach ( (array) $headers as $name =&gt; $content ) {&nbsp;</div></li><li><div>          $phpmailer-&gt;AddCustomHeader( sprintf( '%1$s: %2$s', $name, $content ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( false !== stripos( $content_type, 'multipart' ) && ! empty($boundary) )&nbsp;</div></li><li><div>          $phpmailer-&gt;AddCustomHeader( sprintf( &quot;Content-Type: %s;\n\t boundary=\&quot;%s\&quot;&quot;, $content_type, $boundary ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $attachments ) ) {&nbsp;</div></li><li><div>      foreach ( $attachments as $attachment ) {&nbsp;</div></li><li><div>          try {&nbsp;</div></li><li><div>              $phpmailer-&gt;AddAttachment($attachment);&nbsp;</div></li><li><div>          } catch ( phpmailerException $e ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after PHPMailer is initialized.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param PHPMailer &$phpmailer The PHPMailer instance, passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action_ref_array( 'phpmailer_init', array( &$phpmailer ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Send!</span>&nbsp;</div></li><li><div>  try {&nbsp;</div></li><li><div>      return $phpmailer-&gt;Send();&nbsp;</div></li><li><div>  } catch ( phpmailerException $e ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $mail_error_data = compact( 'to', 'subject', 'message', 'headers', 'attachments' );&nbsp;</div></li><li><div>      $mail_error_data['phpmailer_exception_code'] = $e-&gt;getCode();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a phpmailerException is caught.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param WP_Error $error A WP_Error object with the phpmailerException message, and an array</span>&nbsp;</div></li><li><div><span class="comment">       *                        containing the mail recipient, subject, message, headers, and attachments.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'wp_mail_failed', new WP_Error( 'wp_mail_failed', $e-&gt;getMessage(), $mail_error_data ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_authenticate') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Authenticate a user, confirming the login credentials are valid.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.5.0 `$username` now accepts an email address.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $username User's username or email address.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $password User's password.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_User|WP_Error WP_User object if the credentials are valid, </span>&nbsp;</div></li><li><div><span class="comment"> *                          otherwise WP_Error.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_authenticate($username, $password) {&nbsp;</div></li><li><div>  $username = sanitize_user($username);&nbsp;</div></li><li><div>  $password = trim($password);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether a set of user login credentials are valid.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * A WP_User object is returned if the credentials authenticate a user.</span>&nbsp;</div></li><li><div><span class="comment">   * WP_Error or null otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.5.0 `$username` now accepts an email address.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param null|WP_User|WP_Error $user     WP_User if the user is authenticated.</span>&nbsp;</div></li><li><div><span class="comment">   *                                        WP_Error or null otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string                $username Username or email address.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string                $password User password</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $user = apply_filters( 'authenticate', null, $username, $password );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $user == null ) {&nbsp;</div></li><li><div>      <span class="comment">// TODO what should the error message be? (Or would these even happen?)</span>&nbsp;</div></li><li><div>      <span class="comment">// Only needed if all authentication handlers fail to return anything.</span>&nbsp;</div></li><li><div>      $user = new WP_Error( 'authentication_failed', __( '&lt;strong&gt;ERROR&lt;/strong&gt;: Invalid username, email address or incorrect password.' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $ignore_codes = array('empty_username', 'empty_password');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (is_wp_error($user) && !in_array($user-&gt;get_error_code(), $ignore_codes) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a user login has failed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.5.0 The value of `$username` can now be an email address.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $username Username or email address.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'wp_login_failed', $username );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $user;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_logout') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Log the current user out.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_logout() {&nbsp;</div></li><li><div>  wp_destroy_current_session();&nbsp;</div></li><li><div>  wp_clear_auth_cookie();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a user is logged-out.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'wp_logout' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_validate_auth_cookie') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Validates authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The checks include making sure that the authentication cookie is set and</span>&nbsp;</div></li><li><div><span class="comment"> * pulling in the contents (if $cookie is not used).</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Makes sure the cookie is not expired. Verifies the hash in cookie is what is</span>&nbsp;</div></li><li><div><span class="comment"> * should be and compares the two.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global int $login_grace_period</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $cookie Optional. If used, will validate contents instead of cookie's</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $scheme Optional. The cookie scheme to use: auth, secure_auth, or logged_in</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|int False if invalid cookie, User ID if valid.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_validate_auth_cookie($cookie = '', $scheme = '') {&nbsp;</div></li><li><div>  if ( ! $cookie_elements = wp_parse_auth_cookie($cookie, $scheme) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires if an authentication cookie is malformed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $cookie Malformed auth cookie.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $scheme Authentication scheme. Values include 'auth', 'secure_auth', </span>&nbsp;</div></li><li><div><span class="comment">       *                       or 'logged_in'.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'auth_cookie_malformed', $cookie, $scheme );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $scheme = $cookie_elements['scheme'];&nbsp;</div></li><li><div>  $username = $cookie_elements['username'];&nbsp;</div></li><li><div>  $hmac = $cookie_elements['hmac'];&nbsp;</div></li><li><div>  $token = $cookie_elements['token'];&nbsp;</div></li><li><div>  $expired = $expiration = $cookie_elements['expiration'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Allow a grace period for POST and Ajax requests</span>&nbsp;</div></li><li><div>  if ( wp_doing_ajax() || 'POST' == $_SERVER['REQUEST_METHOD'] ) {&nbsp;</div></li><li><div>      $expired += HOUR_IN_SECONDS;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Quick check to see if an honest cookie has expired</span>&nbsp;</div></li><li><div>  if ( $expired &lt; time() ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires once an authentication cookie has expired.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $cookie_elements An array of data for the authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'auth_cookie_expired', $cookie_elements );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user = get_user_by('login', $username);&nbsp;</div></li><li><div>  if ( ! $user ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires if a bad username is entered in the user authentication process.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $cookie_elements An array of data for the authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'auth_cookie_bad_username', $cookie_elements );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pass_frag = substr($user-&gt;user_pass, 8, 4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $key = wp_hash( $username . '|' . $pass_frag . '|' . $expiration . '|' . $token, $scheme );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// If ext/hash is not present, compat.php's hash_hmac() does not support sha256.</span></span>&nbsp;</div></li><li><div>  $algo = function_exists( 'hash' ) ? 'sha256' : 'sha1';&nbsp;</div></li><li><div>  $hash = hash_hmac( $algo, $username . '|' . $expiration . '|' . $token, $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! hash_equals( $hash, $hmac ) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires if a bad authentication cookie hash is encountered.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $cookie_elements An array of data for the authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'auth_cookie_bad_hash', $cookie_elements );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $manager = WP_Session_Tokens::get_instance( $user-&gt;ID );&nbsp;</div></li><li><div>  if ( ! $manager-&gt;verify( $token ) ) {&nbsp;</div></li><li><div>      do_action( 'auth_cookie_bad_session_token', $cookie_elements );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Ajax/POST grace period set above</span>&nbsp;</div></li><li><div>  if ( $expiration &lt; time() ) {&nbsp;</div></li><li><div>      $GLOBALS['login_grace_period'] = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires once an authentication cookie has been validated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array   $cookie_elements An array of data for the authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_User $user            User object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'auth_cookie_valid', $cookie_elements, $user );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $user-&gt;ID;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_generate_auth_cookie') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Generate authentication cookie contents.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id    User ID</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $expiration The time the cookie expires as a UNIX timestamp.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $scheme     Optional. The cookie scheme to use: auth, secure_auth, or logged_in</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $token      User's session token to use for this cookie</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Authentication cookie contents. Empty string if user does not exist.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_generate_auth_cookie( $user_id, $expiration, $scheme = 'auth', $token = '' ) {&nbsp;</div></li><li><div>  $user = get_userdata($user_id);&nbsp;</div></li><li><div>  if ( ! $user ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $token ) {&nbsp;</div></li><li><div>      $manager = WP_Session_Tokens::get_instance( $user_id );&nbsp;</div></li><li><div>      $token = $manager-&gt;create( $expiration );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pass_frag = substr($user-&gt;user_pass, 8, 4);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $key = wp_hash( $user-&gt;user_login . '|' . $pass_frag . '|' . $expiration . '|' . $token, $scheme );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// If ext/hash is not present, compat.php's hash_hmac() does not support sha256.</span></span>&nbsp;</div></li><li><div>  $algo = function_exists( 'hash' ) ? 'sha256' : 'sha1';&nbsp;</div></li><li><div>  $hash = hash_hmac( $algo, $user-&gt;user_login . '|' . $expiration . '|' . $token, $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cookie = $user-&gt;user_login . '|' . $expiration . '|' . $token . '|' . $hash;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $cookie     Authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $user_id    User ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expiration The time the cookie expires as a UNIX timestamp.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $scheme     Cookie scheme used. Accepts 'auth', 'secure_auth', or 'logged_in'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $token      User's session token used.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'auth_cookie', $cookie, $user_id, $expiration, $scheme, $token );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_parse_auth_cookie') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Parse a cookie into its components</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $cookie</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $scheme Optional. The cookie scheme to use: auth, secure_auth, or logged_in</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|false Authentication cookie components</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_parse_auth_cookie($cookie = '', $scheme = '') {&nbsp;</div></li><li><div>  if ( empty($cookie) ) {&nbsp;</div></li><li><div>      switch ($scheme) {&nbsp;</div></li><li><div>          case 'auth':&nbsp;</div></li><li><div>              $cookie_name = AUTH_COOKIE;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'secure_auth':&nbsp;</div></li><li><div>              $cookie_name = SECURE_AUTH_COOKIE;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case &quot;logged_in&quot;:&nbsp;</div></li><li><div>              $cookie_name = LOGGED_IN_COOKIE;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              if ( is_ssl() ) {&nbsp;</div></li><li><div>                  $cookie_name = SECURE_AUTH_COOKIE;&nbsp;</div></li><li><div>                  $scheme = 'secure_auth';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $cookie_name = AUTH_COOKIE;&nbsp;</div></li><li><div>                  $scheme = 'auth';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty($_COOKIE[$cookie_name]) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      $cookie = $_COOKIE[$cookie_name];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cookie_elements = explode('|', $cookie);&nbsp;</div></li><li><div>  if ( count( $cookie_elements ) !== 4 ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  list( $username, $expiration, $token, $hmac ) = $cookie_elements;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return compact( 'username', 'expiration', 'token', 'hmac', 'scheme' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_set_auth_cookie') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Log in a user by setting authentication cookies.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The $remember parameter increases the time that the cookie will be kept. The</span>&nbsp;</div></li><li><div><span class="comment"> * default the cookie is kept without remembering is two days. When $remember is</span>&nbsp;</div></li><li><div><span class="comment"> * set, the cookies will be kept for 14 days or two weeks.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0 Added the `$token` parameter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id  User ID</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $remember Whether to remember the user</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $secure   Whether the admin cookies should only be sent over HTTPS.</span>&nbsp;</div></li><li><div><span class="comment"> *                         Default is_ssl().</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $token    Optional. User's session token to use for this cookie.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_set_auth_cookie( $user_id, $remember = false, $secure = '', $token = '' ) {&nbsp;</div></li><li><div>  if ( $remember ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the duration of the authentication cookie expiration period.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int  $length   Duration of the expiration period in seconds.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int  $user_id  User ID.</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool $remember Whether to remember the user login. Default false.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $expiration = time() + apply_filters( 'auth_cookie_expiration', 14 * DAY_IN_SECONDS, $user_id, $remember );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Ensure the browser will continue to send the cookie after the expiration time is reached.</span>&nbsp;</div></li><li><div><span class="comment">       * Needed for the login grace period in wp_validate_auth_cookie().</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $expire = $expiration + ( 12 * HOUR_IN_SECONDS );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/pluggable.php */</span></span></span></span></span>&nbsp;</div></li><li><div>      $expiration = time() + apply_filters( 'auth_cookie_expiration', 2 * DAY_IN_SECONDS, $user_id, $remember );&nbsp;</div></li><li><div>      $expire = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' === $secure ) {&nbsp;</div></li><li><div>      $secure = is_ssl();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Front-end cookie is secure when the auth cookie is secure and the site's home URL is forced HTTPS.</span>&nbsp;</div></li><li><div>  $secure_logged_in_cookie = $secure && 'https' === parse_url( get_option( 'home' ), PHP_URL_SCHEME );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether the connection is secure.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $secure  Whether the connection is secure.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $user_id User ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $secure = apply_filters( 'secure_auth_cookie', $secure, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to use a secure cookie when logged-in.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $secure_logged_in_cookie Whether to use a secure cookie when logged-in.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $user_id                 User ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $secure                  Whether the connection is secure.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $secure_logged_in_cookie = apply_filters( 'secure_logged_in_cookie', $secure_logged_in_cookie, $user_id, $secure );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $secure ) {&nbsp;</div></li><li><div>      $auth_cookie_name = SECURE_AUTH_COOKIE;&nbsp;</div></li><li><div>      $scheme = 'secure_auth';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $auth_cookie_name = AUTH_COOKIE;&nbsp;</div></li><li><div>      $scheme = 'auth';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' === $token ) {&nbsp;</div></li><li><div>      $manager = WP_Session_Tokens::get_instance( $user_id );&nbsp;</div></li><li><div>      $token = $manager-&gt;create( $expiration );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $auth_cookie = wp_generate_auth_cookie( $user_id, $expiration, $scheme, $token );&nbsp;</div></li><li><div>  $logged_in_cookie = wp_generate_auth_cookie( $user_id, $expiration, 'logged_in', $token );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires immediately before the authentication cookie is set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $auth_cookie Authentication cookie.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expire      The time the login grace period expires as a UNIX timestamp.</span>&nbsp;</div></li><li><div><span class="comment">   *                            Default is 12 hours past the cookie's expiration time.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expiration  The time when the authentication cookie expires as a UNIX timestamp.</span>&nbsp;</div></li><li><div><span class="comment">   *                            Default is 14 days from now.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $user_id     User ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $scheme      Authentication scheme. Values include 'auth', 'secure_auth', or 'logged_in'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'set_auth_cookie', $auth_cookie, $expire, $expiration, $user_id, $scheme );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires immediately before the logged-in authentication cookie is set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $logged_in_cookie The logged-in cookie.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expire           The time the login grace period expires as a UNIX timestamp.</span>&nbsp;</div></li><li><div><span class="comment">   *                                 Default is 12 hours past the cookie's expiration time.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expiration       The time when the logged-in authentication cookie expires as a UNIX timestamp.</span>&nbsp;</div></li><li><div><span class="comment">   *                                 Default is 14 days from now.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $user_id          User ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $scheme           Authentication scheme. Default 'logged_in'.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'set_logged_in_cookie', $logged_in_cookie, $expire, $expiration, $user_id, 'logged_in' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  setcookie($auth_cookie_name, $auth_cookie, $expire, PLUGINS_COOKIE_PATH, COOKIE_DOMAIN, $secure, true);&nbsp;</div></li><li><div>  setcookie($auth_cookie_name, $auth_cookie, $expire, ADMIN_COOKIE_PATH, COOKIE_DOMAIN, $secure, true);&nbsp;</div></li><li><div>  setcookie(LOGGED_IN_COOKIE, $logged_in_cookie, $expire, COOKIEPATH, COOKIE_DOMAIN, $secure_logged_in_cookie, true);&nbsp;</div></li><li><div>  if ( COOKIEPATH != SITECOOKIEPATH )&nbsp;</div></li><li><div>      setcookie(LOGGED_IN_COOKIE, $logged_in_cookie, $expire, SITECOOKIEPATH, COOKIE_DOMAIN, $secure_logged_in_cookie, true);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_clear_auth_cookie') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes all of the cookies associated with authentication.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_clear_auth_cookie() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires just before the authentication cookies are cleared.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'clear_auth_cookie' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  setcookie( AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, ADMIN_COOKIE_PATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( SECURE_AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, ADMIN_COOKIE_PATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, PLUGINS_COOKIE_PATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( SECURE_AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, PLUGINS_COOKIE_PATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( LOGGED_IN_COOKIE, ' ', time() - YEAR_IN_SECONDS, COOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( LOGGED_IN_COOKIE, ' ', time() - YEAR_IN_SECONDS, SITECOOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Old cookies</span>&nbsp;</div></li><li><div>  setcookie( AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, COOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, SITECOOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( SECURE_AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, COOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( SECURE_AUTH_COOKIE, ' ', time() - YEAR_IN_SECONDS, SITECOOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Even older cookies</span>&nbsp;</div></li><li><div>  setcookie( USER_COOKIE, ' ', time() - YEAR_IN_SECONDS, COOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( PASS_COOKIE, ' ', time() - YEAR_IN_SECONDS, COOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( USER_COOKIE, ' ', time() - YEAR_IN_SECONDS, SITECOOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>  setcookie( PASS_COOKIE, ' ', time() - YEAR_IN_SECONDS, SITECOOKIEPATH, COOKIE_DOMAIN );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('is_user_logged_in') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if the current visitor is a logged in user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if user is logged in, false if not logged in.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_user_logged_in() {&nbsp;</div></li><li><div>  $user = wp_get_current_user();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $user-&gt;exists();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('auth_redirect') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if a user is logged in, if not it redirects them to the login page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function auth_redirect() {&nbsp;</div></li><li><div>  <span class="comment">// Checks if a user is logged in, if not redirects them to the login page</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $secure = ( is_ssl() || force_ssl_admin() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to use a secure authentication redirect.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $secure Whether to use a secure authentication redirect. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $secure = apply_filters( 'secure_auth_redirect', $secure );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If https is required and request is http, redirect</span>&nbsp;</div></li><li><div>  if ( $secure && !is_ssl() && false !== strpos($_SERVER['REQUEST_URI'], 'wp-admin') ) {&nbsp;</div></li><li><div>      if ( 0 === strpos( $_SERVER['REQUEST_URI'], 'http' ) ) {&nbsp;</div></li><li><div>          wp_redirect( set_url_scheme( $_SERVER['REQUEST_URI'], 'https' ) );&nbsp;</div></li><li><div>          exit();&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_redirect( 'https:<span class="comment"><span class="comment"><span class="comment">//' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] );</span></span></span>&nbsp;</div></li><li><div>          exit();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the authentication redirect scheme.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $scheme Authentication redirect scheme. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $scheme = apply_filters( 'auth_redirect_scheme', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $user_id = wp_validate_auth_cookie( '', $scheme) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the authentication redirect.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $user_id User ID.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'auth_redirect', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If the user wants ssl but the session is not ssl, redirect.</span>&nbsp;</div></li><li><div>      if ( !$secure && get_user_option('use_ssl', $user_id) && false !== strpos($_SERVER['REQUEST_URI'], 'wp-admin') ) {&nbsp;</div></li><li><div>          if ( 0 === strpos( $_SERVER['REQUEST_URI'], 'http' ) ) {&nbsp;</div></li><li><div>              wp_redirect( set_url_scheme( $_SERVER['REQUEST_URI'], 'https' ) );&nbsp;</div></li><li><div>              exit();&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              wp_redirect( 'https:<span class="comment"><span class="comment"><span class="comment">//' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] );</span></span></span>&nbsp;</div></li><li><div>              exit();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return;  <span class="comment">// The cookie is good so we're done</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The cookie is no good so force login</span>&nbsp;</div></li><li><div>  nocache_headers();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $redirect = ( strpos( $_SERVER['REQUEST_URI'], '/options.php' ) && wp_get_referer() ) ? wp_get_referer() : set_url_scheme( 'http:<span class="comment"><span class="comment"><span class="comment">//' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] );</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $login_url = wp_login_url($redirect, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_redirect($login_url);&nbsp;</div></li><li><div>  exit();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('check_admin_referer') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Makes sure that a user was referred from another admin page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * To avoid security exploits.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|string $action    Action nonce.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $query_arg Optional. Key to check for nonce in `$_REQUEST` (since 2.5).</span>&nbsp;</div></li><li><div><span class="comment"> *                              Default '_wpnonce'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|int False if the nonce is invalid, 1 if the nonce is valid and generated between</span>&nbsp;</div></li><li><div><span class="comment"> *                   0-12 hours ago, 2 if the nonce is valid and generated between 12-24 hours ago.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function check_admin_referer( $action = -1, $query_arg = '_wpnonce' ) {&nbsp;</div></li><li><div>  if ( -1 == $action )&nbsp;</div></li><li><div>      _doing_it_wrong( __FUNCTION__, __( 'You should specify a nonce action to be verified by using the first parameter.' ), '3.2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $adminurl = strtolower(admin_url());&nbsp;</div></li><li><div>  $referer = strtolower(wp_get_referer());&nbsp;</div></li><li><div>  $result = isset($_REQUEST[$query_arg]) ? wp_verify_nonce($_REQUEST[$query_arg], $action) : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires once the admin request has been validated or not.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.1</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string    $action The nonce action.</span>&nbsp;</div></li><li><div><span class="comment">   * @param false|int $result False if the nonce is invalid, 1 if the nonce is valid and generated between</span>&nbsp;</div></li><li><div><span class="comment">   *                          0-12 hours ago, 2 if the nonce is valid and generated between 12-24 hours ago.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'check_admin_referer', $action, $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $result && ! ( -1 == $action && strpos( $referer, $adminurl ) === 0 ) ) {&nbsp;</div></li><li><div>      wp_nonce_ays( $action );&nbsp;</div></li><li><div>      die();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('check_ajax_referer') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Verifies the Ajax request to prevent processing requests external of the blog.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|string   $action    Action nonce.</span>&nbsp;</div></li><li><div><span class="comment"> * @param false|string $query_arg Optional. Key to check for the nonce in `$_REQUEST` (since 2.5). If false, </span>&nbsp;</div></li><li><div><span class="comment"> *                                `$_REQUEST` values will be evaluated for '_ajax_nonce', and '_wpnonce'</span>&nbsp;</div></li><li><div><span class="comment"> *                                (in that order). Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $die       Optional. Whether to die early when the nonce cannot be verified.</span>&nbsp;</div></li><li><div><span class="comment"> *                                Default true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|int False if the nonce is invalid, 1 if the nonce is valid and generated between</span>&nbsp;</div></li><li><div><span class="comment"> *                   0-12 hours ago, 2 if the nonce is valid and generated between 12-24 hours ago.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function check_ajax_referer( $action = -1, $query_arg = false, $die = true ) {&nbsp;</div></li><li><div>  if ( -1 == $action ) {&nbsp;</div></li><li><div>      _doing_it_wrong( __FUNCTION__, __( 'You should specify a nonce action to be verified by using the first parameter.' ), '4.7' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $nonce = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $query_arg && isset( $_REQUEST[ $query_arg ] ) )&nbsp;</div></li><li><div>      $nonce = $_REQUEST[ $query_arg ];&nbsp;</div></li><li><div>  elseif ( isset( $_REQUEST['_ajax_nonce'] ) )&nbsp;</div></li><li><div>      $nonce = $_REQUEST['_ajax_nonce'];&nbsp;</div></li><li><div>  elseif ( isset( $_REQUEST['_wpnonce'] ) )&nbsp;</div></li><li><div>      $nonce = $_REQUEST['_wpnonce'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = wp_verify_nonce( $nonce, $action );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires once the Ajax request has been validated or not.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string    $action The Ajax nonce action.</span>&nbsp;</div></li><li><div><span class="comment">   * @param false|int $result False if the nonce is invalid, 1 if the nonce is valid and generated between</span>&nbsp;</div></li><li><div><span class="comment">   *                          0-12 hours ago, 2 if the nonce is valid and generated between 12-24 hours ago.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'check_ajax_referer', $action, $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $die && false === $result ) {&nbsp;</div></li><li><div>      if ( wp_doing_ajax() ) {&nbsp;</div></li><li><div>          wp_die( -1, 403 );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          die( '-1' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_redirect') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Redirects to another page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Note: wp_redirect() does not exit automatically, and should almost always be</span>&nbsp;</div></li><li><div><span class="comment"> * followed by a call to `exit;`:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     wp_redirect( $url );</span>&nbsp;</div></li><li><div><span class="comment"> *     exit;</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Exiting can also be selectively manipulated by using wp_redirect() as a conditional</span>&nbsp;</div></li><li><div><span class="comment"> * in conjunction with the {@see 'wp_redirect'} and {@see 'wp_redirect_location'} hooks:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     if ( wp_redirect( $url ) ) {</span>&nbsp;</div></li><li><div><span class="comment"> *         exit;</span>&nbsp;</div></li><li><div><span class="comment"> *     }</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global bool $is_IIS</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $location The path to redirect to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $status   Status code to use.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if $location is not provided, true otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_redirect($location, $status = 302) {&nbsp;</div></li><li><div>  global $is_IIS;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the redirect location.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $location The path to redirect to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $status   Status code to use.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $location = apply_filters( 'wp_redirect', $location, $status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the redirect status code.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $status   Status code to use.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $location The path to redirect to.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $status = apply_filters( 'wp_redirect_status', $status, $location );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $location )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $location = wp_sanitize_redirect($location);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$is_IIS && PHP_SAPI != 'cgi-fcgi' )&nbsp;</div></li><li><div>      status_header($status); <span class="comment">// This causes problems on IIS and some FastCGI setups</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  header(&quot;Location: $location&quot;, true, $status);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_sanitize_redirect') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sanitizes a URL for use in a redirect.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $location The path to redirect to.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Redirect-sanitized URL.</span>&nbsp;</div></li><li><div><span class="comment"> **/</span>&nbsp;</div></li><li><div>function wp_sanitize_redirect($location) {&nbsp;</div></li><li><div>  $regex = '/&nbsp;</div></li><li><div>      (&nbsp;</div></li><li><div>          (?: [\xC2-\xDF][\x80-\xBF]        # double-byte sequences   110xxxxx 10xxxxxx&nbsp;</div></li><li><div>          |   \xE0[\xA0-\xBF][\x80-\xBF]    # triple-byte sequences   1110xxxx 10xxxxxx * 2&nbsp;</div></li><li><div>          |   [\xE1-\xEC][\x80-\xBF]{2}&nbsp;</div></li><li><div>          |   \xED[\x80-\x9F][\x80-\xBF]&nbsp;</div></li><li><div>          |   [\xEE-\xEF][\x80-\xBF]{2}&nbsp;</div></li><li><div>          |   \xF0[\x90-\xBF][\x80-\xBF]{2} # four-byte sequences   11110xxx 10xxxxxx * 3&nbsp;</div></li><li><div>          |   [\xF1-\xF3][\x80-\xBF]{3}&nbsp;</div></li><li><div>          |   \xF4[\x80-\x8F][\x80-\xBF]{2}&nbsp;</div></li><li><div> ) {1, 40}                              # ...one or more times&nbsp;</div></li><li><div> )/x';&nbsp;</div></li><li><div>  $location = preg_replace_callback( $regex, '_wp_sanitize_utf8_in_redirect', $location );&nbsp;</div></li><li><div>  $location = preg_replace('|[^a-z0-9-~+_.?#=&;, /:%!*\[\]()@]|i', '', $location);&nbsp;</div></li><li><div>  $location = wp_kses_no_null($location);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// remove %0d and %0a from location</span>&nbsp;</div></li><li><div>  $strip = array('%0d', '%0a', '%0D', '%0A');&nbsp;</div></li><li><div>  return _deep_replace( $strip, $location );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * URL encode UTF-8 characters in a URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @ignore</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_sanitize_redirect()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $matches RegEx matches against the redirect location.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string URL-encoded version of the first RegEx match.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_sanitize_utf8_in_redirect( $matches ) {&nbsp;</div></li><li><div>  return urlencode( $matches[0] );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_safe_redirect') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Performs a safe (local) redirect, using wp_redirect().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Checks whether the $location is using an allowed host, if it has an absolute</span>&nbsp;</div></li><li><div><span class="comment"> * path. A plugin can therefore set or remove allowed host(s) to or from the</span>&nbsp;</div></li><li><div><span class="comment"> * list.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the host is not allowed, then the redirect defaults to wp-admin on the siteurl</span>&nbsp;</div></li><li><div><span class="comment"> * instead. This prevents malicious redirects which redirect to another host, </span>&nbsp;</div></li><li><div><span class="comment"> * but only used in a few places.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $location The path to redirect to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $status   Status code to use.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_safe_redirect($location, $status = 302) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Need to look at the URL the way it will end up in wp_redirect()</span>&nbsp;</div></li><li><div>  $location = wp_sanitize_redirect($location);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the redirect fallback URL for when the provided redirect is not safe (local).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $fallback_url The fallback URL to use by default.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $status       The redirect status.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $location = wp_validate_redirect( $location, apply_filters( 'wp_safe_redirect_fallback', admin_url(), $status ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_redirect($location, $status);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_validate_redirect') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Validates a URL for use in a redirect.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Checks whether the $location is using an allowed host, if it has an absolute</span>&nbsp;</div></li><li><div><span class="comment"> * path. A plugin can therefore set or remove allowed host(s) to or from the</span>&nbsp;</div></li><li><div><span class="comment"> * list.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the host is not allowed, then the redirect is to $default supplied</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $location The redirect to validate</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $default  The value to return if $location is not allowed</span>&nbsp;</div></li><li><div><span class="comment"> * @return string redirect-sanitized URL</span>&nbsp;</div></li><li><div><span class="comment"> **/</span>&nbsp;</div></li><li><div>function wp_validate_redirect($location, $default = '') {&nbsp;</div></li><li><div>  $location = trim( $location );&nbsp;</div></li><li><div>  <span class="comment">// browsers will assume 'http' is your protocol, and will obey a redirect to a URL starting with '//'</span>&nbsp;</div></li><li><div>  if ( substr($location, 0, 2) == '<span class="comment">//' )</span>&nbsp;</div></li><li><div>      $location = 'http:' . $location;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// In php 5 parse_url may fail if the URL query part contains http://, bug #38143</span>&nbsp;</div></li><li><div>  $test = ( $cut = strpos($location, '?') ) ? substr( $location, 0, $cut ) : $location;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// @-operator is used to prevent possible warnings in PHP &lt; 5.3.3.</span>&nbsp;</div></li><li><div>  $lp = @parse_url($test);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Give up if malformed URL</span>&nbsp;</div></li><li><div>  if ( false === $lp )&nbsp;</div></li><li><div>      return $default;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Allow only http and https schemes. No data:, etc.</span>&nbsp;</div></li><li><div>  if ( isset($lp['scheme']) && !('http' == $lp['scheme'] || 'https' == $lp['scheme']) )&nbsp;</div></li><li><div>      return $default;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Reject if certain components are set but host is not. This catches urls like https:host.com for which parse_url does not set the host field.</span>&nbsp;</div></li><li><div>  if ( ! isset( $lp['host'] ) && ( isset( $lp['scheme'] ) || isset( $lp['user'] ) || isset( $lp['pass'] ) || isset( $lp['port'] ) ) ) {&nbsp;</div></li><li><div>      return $default;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Reject malformed components parse_url() can return on odd inputs.</span>&nbsp;</div></li><li><div>  foreach ( array( 'user', 'pass', 'host' ) as $component ) {&nbsp;</div></li><li><div>      if ( isset( $lp[ $component ] ) && strpbrk( $lp[ $component ], ':/?#@' ) ) {&nbsp;</div></li><li><div>          return $default;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wpp = parse_url(home_url());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the whitelist of hosts to redirect to.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array       $hosts An array of allowed hosts.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool|string $host  The parsed host; empty if not isset.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $allowed_hosts = (array) apply_filters( 'allowed_redirect_hosts', array($wpp['host']), isset($lp['host']) ? $lp['host'] : '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset($lp['host']) && ( !in_array($lp['host'], $allowed_hosts) && $lp['host'] != strtolower($wpp['host'])) )&nbsp;</div></li><li><div>      $location = $default;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $location;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! function_exists('wp_notify_postauthor') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Notify an author (and/or others) of a comment/trackback/pingback on a post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|WP_Comment  $comment_id Comment ID or WP_Comment object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $deprecated Not used</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on completion. False if no email addresses were specified.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_notify_postauthor( $comment_id, $deprecated = null ) {&nbsp;</div></li><li><div>  if ( null !== $deprecated ) {&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '3.8.0' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $comment = get_comment( $comment_id );&nbsp;</div></li><li><div>  if ( empty( $comment ) || empty( $comment-&gt;comment_post_ID ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post = get_post( $comment-&gt;comment_post_ID );&nbsp;</div></li><li><div>  $author = get_userdata( $post-&gt;post_author );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Who to notify? By default, just the post author, but others can be added.</span>&nbsp;</div></li><li><div>  $emails = array();&nbsp;</div></li><li><div>  if ( $author ) {&nbsp;</div></li><li><div>      $emails[] = $author-&gt;user_email;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of email addresses to receive a comment notification.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * By default, only post authors are notified of comments. This filter allows</span>&nbsp;</div></li><li><div><span class="comment">   * others to be added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $emails     An array of email addresses to receive a comment notification.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $comment_id The comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $emails = apply_filters( 'comment_notification_recipients', $emails, $comment-&gt;comment_ID );&nbsp;</div></li><li><div>  $emails = array_filter( $emails );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If there are no addresses to send the comment to, bail.</span>&nbsp;</div></li><li><div>  if ( ! count( $emails ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Facilitate unsetting below without knowing the keys.</span>&nbsp;</div></li><li><div>  $emails = array_flip( $emails );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to notify comment authors of their comments on their own posts.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * By default, comment authors aren't notified of their comments on their own</span>&nbsp;</div></li><li><div><span class="comment">   * posts. This filter allows you to override that.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.8.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $notify     Whether to notify the post author of their own comment.</span>&nbsp;</div></li><li><div><span class="comment">   *                         Default false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $comment_id The comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $notify_author = apply_filters( 'comment_notification_notify_author', false, $comment-&gt;comment_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The comment was left by the author</span>&nbsp;</div></li><li><div>  if ( $author && ! $notify_author && $comment-&gt;user_id == $post-&gt;post_author ) {&nbsp;</div></li><li><div>      unset( $emails[ $author-&gt;user_email ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The author moderated a comment on their own post</span>&nbsp;</div></li><li><div>  if ( $author && ! $notify_author && $post-&gt;post_author == get_current_user_id() ) {&nbsp;</div></li><li><div>      unset( $emails[ $author-&gt;user_email ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The post author is no longer a member of the blog</span>&nbsp;</div></li><li><div>  if ( $author && ! $notify_author && ! user_can( $post-&gt;post_author, 'read_post', $post-&gt;ID ) ) {&nbsp;</div></li><li><div>      unset( $emails[ $author-&gt;user_email ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If there's no email to send the comment to, bail, otherwise flip array back around for use below</span>&nbsp;</div></li><li><div>  if ( ! count( $emails ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $emails = array_flip( $emails );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $switched_locale = switch_to_locale( get_locale() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $comment_author_domain = @gethostbyaddr($comment-&gt;comment_author_IP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// The blogname option is escaped with esc_html on the way into the database in sanitize_option</span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// we want to reverse this for the plain text arena of emails.</span></span></span></span>&nbsp;</div></li><li><div>  $blogname = wp_specialchars_decode(get_option('blogname'), ENT_QUOTES);&nbsp;</div></li><li><div>  $comment_content = wp_specialchars_decode( $comment-&gt;comment_content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $comment-&gt;comment_type ) {&nbsp;</div></li><li><div>      case 'trackback':&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Post title */</span></span></span></span></span>&nbsp;</div></li><li><div>          $notify_message = sprintf( __( 'New trackback on your post &quot;%s&quot;' ), $post-&gt;post_title ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Trackback/pingback website name, 2: website IP, 3: website hostname */</span></span></span></span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __('Website: %1$s (IP: %2$s, %3$s)'), $comment-&gt;comment_author, $comment-&gt;comment_author_IP, $comment_author_domain ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'URL: %s' ), $comment-&gt;comment_author_url ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Comment: %s' ), &quot;\r\n&quot; . $comment_content ) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= __( 'You can see all trackbacks on this post here:' ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** translators: 1: blog name, 2: post title */</span></span></span>&nbsp;</div></li><li><div>          $subject = sprintf( __('[%1$s] Trackback: &quot;%2$s&quot;'), $blogname, $post-&gt;post_title );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'pingback':&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Post title */</span></span></span></span></span>&nbsp;</div></li><li><div>          $notify_message = sprintf( __( 'New pingback on your post &quot;%s&quot;' ), $post-&gt;post_title ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Trackback/pingback website name, 2: website IP, 3: website hostname */</span></span></span></span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __('Website: %1$s (IP: %2$s, %3$s)'), $comment-&gt;comment_author, $comment-&gt;comment_author_IP, $comment_author_domain ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'URL: %s' ), $comment-&gt;comment_author_url ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Comment: %s' ), &quot;\r\n&quot; . $comment_content ) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= __( 'You can see all pingbacks on this post here:' ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** translators: 1: blog name, 2: post title */</span></span></span>&nbsp;</div></li><li><div>          $subject = sprintf( __('[%1$s] Pingback: &quot;%2$s&quot;'), $blogname, $post-&gt;post_title );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      default: <span class="comment"><span class="comment">// Comments</span></span>&nbsp;</div></li><li><div>          $notify_message = sprintf( __( 'New comment on your post &quot;%s&quot;' ), $post-&gt;post_title ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: comment author, 2: author IP, 3: author domain */</span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Author: %1$s (IP: %2$s, %3$s)' ), $comment-&gt;comment_author, $comment-&gt;comment_author_IP, $comment_author_domain ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Email: %s' ), $comment-&gt;comment_author_email ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'URL: %s' ), $comment-&gt;comment_author_url ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= sprintf( __('Comment: %s' ), &quot;\r\n&quot; . $comment_content ) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= __( 'You can see all comments on this post here:' ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** translators: 1: blog name, 2: post title */</span></span></span>&nbsp;</div></li><li><div>          $subject = sprintf( __('[%1$s] Comment: &quot;%2$s&quot;'), $blogname, $post-&gt;post_title );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $notify_message .= get_permalink($comment-&gt;comment_post_ID) . &quot;#comments\r\n\r\n&quot;;&nbsp;</div></li><li><div>  $notify_message .= sprintf( __('Permalink: %s'), get_comment_link( $comment ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( user_can( $post-&gt;post_author, 'edit_comment', $comment-&gt;comment_ID ) ) {&nbsp;</div></li><li><div>      if ( EMPTY_TRASH_DAYS ) {&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Trash it: %s' ), admin_url( &quot;comment.php?action=trash&c={$comment-&gt;comment_ID}#wpbody-content&quot; ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Delete it: %s' ), admin_url( &quot;comment.php?action=delete&c={$comment-&gt;comment_ID}#wpbody-content&quot; ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $notify_message .= sprintf( __( 'Spam it: %s' ), admin_url( &quot;comment.php?action=spam&c={$comment-&gt;comment_ID}#wpbody-content&quot; ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_email = 'wordpress@' . preg_replace('#^www\.#', '', strtolower($_SERVER['SERVER_NAME']));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' == $comment-&gt;comment_author ) {&nbsp;</div></li><li><div>      $from = &quot;From: \&quot;$blogname\&quot; &lt;$wp_email&gt;&quot;;&nbsp;</div></li><li><div>      if ( '' != $comment-&gt;comment_author_email )&nbsp;</div></li><li><div>          $reply_to = &quot;Reply-To: $comment-&gt;comment_author_email&quot;;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $from = &quot;From: \&quot;$comment-&gt;comment_author\&quot; &lt;$wp_email&gt;&quot;;&nbsp;</div></li><li><div>      if ( '' != $comment-&gt;comment_author_email )&nbsp;</div></li><li><div>          $reply_to = &quot;Reply-To: \&quot;$comment-&gt;comment_author_email\&quot; &lt;$comment-&gt;comment_author_email&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $message_headers = &quot;$from\n&quot;&nbsp;</div></li><li><div>      . &quot;Content-Type: text/plain; charset=\&quot;&quot; . get_option('blog_charset') . &quot;\&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset($reply_to) )&nbsp;</div></li><li><div>      $message_headers .= $reply_to . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the comment notification email text.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $notify_message The comment notification email text.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $comment_id     Comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $notify_message = apply_filters( 'comment_notification_text', $notify_message, $comment-&gt;comment_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the comment notification email subject.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $subject    The comment notification email subject.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $comment_id Comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $subject = apply_filters( 'comment_notification_subject', $subject, $comment-&gt;comment_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the comment notification email headers.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $message_headers Headers for the comment notification email.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $comment_id      Comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $message_headers = apply_filters( 'comment_notification_headers', $message_headers, $comment-&gt;comment_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $emails as $email ) {&nbsp;</div></li><li><div>      @wp_mail( $email, wp_specialchars_decode( $subject ), $notify_message, $message_headers );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $switched_locale ) {&nbsp;</div></li><li><div>      restore_previous_locale();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_notify_moderator') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Notifies the moderator of the site about a new comment that is awaiting approval.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Uses the {@see 'notify_moderator'} filter to determine whether the site moderator</span>&nbsp;</div></li><li><div><span class="comment"> * should be notified, overriding the site setting.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $comment_id Comment ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @return true Always returns true.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_notify_moderator($comment_id) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $maybe_notify = get_option( 'moderation_notify' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to send the site moderator email notifications, overriding the site setting.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $maybe_notify Whether to notify blog moderator.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $comment_ID   The id of the comment for the notification.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $maybe_notify = apply_filters( 'notify_moderator', $maybe_notify, $comment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $maybe_notify ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $comment = get_comment($comment_id);&nbsp;</div></li><li><div>  $post = get_post($comment-&gt;comment_post_ID);&nbsp;</div></li><li><div>  $user = get_userdata( $post-&gt;post_author );&nbsp;</div></li><li><div>  <span class="comment">// Send to the administration and to the post author if the author can modify the comment.</span>&nbsp;</div></li><li><div>  $emails = array( get_option( 'admin_email' ) );&nbsp;</div></li><li><div>  if ( $user && user_can( $user-&gt;ID, 'edit_comment', $comment_id ) && ! empty( $user-&gt;user_email ) ) {&nbsp;</div></li><li><div>      if ( 0 !== strcasecmp( $user-&gt;user_email, get_option( 'admin_email' ) ) )&nbsp;</div></li><li><div>          $emails[] = $user-&gt;user_email;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $switched_locale = switch_to_locale( get_locale() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $comment_author_domain = @gethostbyaddr($comment-&gt;comment_author_IP);&nbsp;</div></li><li><div>  $comments_waiting = $wpdb-&gt;get_var(&quot;SELECT count(comment_ID) FROM $wpdb-&gt;comments WHERE comment_approved = '0'&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// The blogname option is escaped with esc_html on the way into the database in sanitize_option</span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// we want to reverse this for the plain text arena of emails.</span></span></span></span>&nbsp;</div></li><li><div>  $blogname = wp_specialchars_decode(get_option('blogname'), ENT_QUOTES);&nbsp;</div></li><li><div>  $comment_content = wp_specialchars_decode( $comment-&gt;comment_content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $comment-&gt;comment_type ) {&nbsp;</div></li><li><div>      case 'trackback':&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Post title */</span></span></span></span></span>&nbsp;</div></li><li><div>          $notify_message = sprintf( __('A new trackback on the post &quot;%s&quot; is waiting for your approval'), $post-&gt;post_title ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= get_permalink($comment-&gt;comment_post_ID) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Trackback/pingback website name, 2: website IP, 3: website hostname */</span></span></span></span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Website: %1$s (IP: %2$s, %3$s)' ), $comment-&gt;comment_author, $comment-&gt;comment_author_IP, $comment_author_domain ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** translators: 1: Trackback/pingback/comment author URL */</span></span></span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'URL: %s' ), $comment-&gt;comment_author_url ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= __('Trackback excerpt: ') . &quot;\r\n&quot; . $comment_content . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'pingback':&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Post title */</span></span></span></span></span>&nbsp;</div></li><li><div>          $notify_message = sprintf( __('A new pingback on the post &quot;%s&quot; is waiting for your approval'), $post-&gt;post_title ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= get_permalink($comment-&gt;comment_post_ID) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Trackback/pingback website name, 2: website IP, 3: website hostname */</span></span></span></span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Website: %1$s (IP: %2$s, %3$s)' ), $comment-&gt;comment_author, $comment-&gt;comment_author_IP, $comment_author_domain ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** translators: 1: Trackback/pingback/comment author URL */</span></span></span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'URL: %s' ), $comment-&gt;comment_author_url ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= __('Pingback excerpt: ') . &quot;\r\n&quot; . $comment_content . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      default: <span class="comment"><span class="comment">// Comments</span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: Post title */</span></span></span></span></span>&nbsp;</div></li><li><div>          $notify_message = sprintf( __('A new comment on the post &quot;%s&quot; is waiting for your approval'), $post-&gt;post_title ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          $notify_message .= get_permalink($comment-&gt;comment_post_ID) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: Comment author name, 2: comment author's IP, 3: comment author IP's hostname */</span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Author: %1$s (IP: %2$s, %3$s)' ), $comment-&gt;comment_author, $comment-&gt;comment_author_IP, $comment_author_domain ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: Comment author URL */</span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Email: %s' ), $comment-&gt;comment_author_email ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** translators: 1: Trackback/pingback/comment author URL */</span></span></span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'URL: %s' ), $comment-&gt;comment_author_url ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: Comment text */</span>&nbsp;</div></li><li><div>          $notify_message .= sprintf( __( 'Comment: %s' ), &quot;\r\n&quot; . $comment_content ) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: Comment moderation. 1: Comment action URL */</span></span></span></span>&nbsp;</div></li><li><div>  $notify_message .= sprintf( __( 'Approve it: %s' ), admin_url( &quot;comment.php?action=approve&c={$comment_id}#wpbody-content&quot; ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( EMPTY_TRASH_DAYS ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: Comment moderation. 1: Comment action URL */</span></span></span></span>&nbsp;</div></li><li><div>      $notify_message .= sprintf( __( 'Trash it: %s' ), admin_url( &quot;comment.php?action=trash&c={$comment_id}#wpbody-content&quot; ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: Comment moderation. 1: Comment action URL */</span></span></span></span>&nbsp;</div></li><li><div>      $notify_message .= sprintf( __( 'Delete it: %s' ), admin_url( &quot;comment.php?action=delete&c={$comment_id}#wpbody-content&quot; ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: Comment moderation. 1: Comment action URL */</span></span></span></span>&nbsp;</div></li><li><div>  $notify_message .= sprintf( __( 'Spam it: %s' ), admin_url( &quot;comment.php?action=spam&c={$comment_id}#wpbody-content&quot; ) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** translators: Comment moderation. 1: Number of comments awaiting approval */</span>&nbsp;</div></li><li><div>  $notify_message .= sprintf( _n('Currently %s comment is waiting for approval. Please visit the moderation panel:', &nbsp;</div></li><li><div>       'Currently %s comments are waiting for approval. Please visit the moderation panel:', $comments_waiting), number_format_i18n($comments_waiting) ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>  $notify_message .= admin_url( &quot;edit-comments.php?comment_status=moderated#wpbody-content&quot; ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** translators: Comment moderation notification email subject. 1: Site name, 2: Post title */</span>&nbsp;</div></li><li><div>  $subject = sprintf( __('[%1$s] Please moderate: &quot;%2$s&quot;'), $blogname, $post-&gt;post_title );&nbsp;</div></li><li><div>  $message_headers = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of recipients for comment moderation emails.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $emails     List of email addresses to notify for comment moderation.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $comment_id Comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $emails = apply_filters( 'comment_moderation_recipients', $emails, $comment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the comment moderation email text.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $notify_message Text of the comment moderation email.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $comment_id     Comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $notify_message = apply_filters( 'comment_moderation_text', $notify_message, $comment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the comment moderation email subject.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $subject    Subject of the comment moderation email.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $comment_id Comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $subject = apply_filters( 'comment_moderation_subject', $subject, $comment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the comment moderation email headers.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $message_headers Headers for the comment moderation email.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $comment_id      Comment ID.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $message_headers = apply_filters( 'comment_moderation_headers', $message_headers, $comment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $emails as $email ) {&nbsp;</div></li><li><div>      @wp_mail( $email, wp_specialchars_decode( $subject ), $notify_message, $message_headers );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $switched_locale ) {&nbsp;</div></li><li><div>      restore_previous_locale();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_password_change_notification') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Notify the blog admin of a user changing password, normally via email.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_User $user User object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_password_change_notification( $user ) {&nbsp;</div></li><li><div>  <span class="comment">// send a copy of password change notification to the admin</span>&nbsp;</div></li><li><div>  <span class="comment">// but check to see if it's the admin whose password we're changing, and skip this</span>&nbsp;</div></li><li><div>  if ( 0 !== strcasecmp( $user-&gt;user_email, get_option( 'admin_email' ) ) ) {&nbsp;</div></li><li><div>      <span class="comment">/** translators: %s: user name */</span>&nbsp;</div></li><li><div>      $message = sprintf( __( 'Password changed for user: %s' ), $user-&gt;user_login ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// The blogname option is escaped with esc_html on the way into the database in sanitize_option</span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// we want to reverse this for the plain text arena of emails.</span></span></span></span>&nbsp;</div></li><li><div>      $blogname = wp_specialchars_decode(get_option('blogname'), ENT_QUOTES);&nbsp;</div></li><li><div>      <span class="comment">/** translators: %s: site title */</span>&nbsp;</div></li><li><div>      wp_mail( get_option( 'admin_email' ), sprintf( __( '[%s] Password Changed' ), $blogname ), $message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_new_user_notification') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Email login credentials to a newly-registered user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A new user registration notification is also sent to admin email.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0 The `$plaintext_pass` parameter was changed to `$notify`.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.1 The `$plaintext_pass` parameter was deprecated. `$notify` added as a third parameter.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.6.0 The `$notify` parameter accepts 'user' for sending notification only to the user created.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb         $wpdb      WordPress database object for queries.</span>&nbsp;</div></li><li><div><span class="comment"> * @global PasswordHash $wp_hasher Portable PHP password hashing framework instance.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id    User ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param null   $deprecated Not used (argument deprecated).</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $notify     Optional. Type of notification that should happen. Accepts 'admin' or an empty</span>&nbsp;</div></li><li><div><span class="comment"> *                           string (admin only), 'user', or 'both' (admin and user). Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_new_user_notification( $user_id, $deprecated = null, $notify = '' ) {&nbsp;</div></li><li><div>  if ( $deprecated !== null ) {&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '4.3.1' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wpdb, $wp_hasher;&nbsp;</div></li><li><div>  $user = get_userdata( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// The blogname option is escaped with esc_html on the way into the database in sanitize_option</span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// we want to reverse this for the plain text arena of emails.</span></span></span></span>&nbsp;</div></li><li><div>  $blogname = wp_specialchars_decode(get_option('blogname'), ENT_QUOTES);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'user' !== $notify ) {&nbsp;</div></li><li><div>      $switched_locale = switch_to_locale( get_locale() );&nbsp;</div></li><li><div>      $message = sprintf( __( 'New user registration on your site %s:' ), $blogname ) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>      $message .= sprintf( __( 'Username: %s' ), $user-&gt;user_login ) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>      $message .= sprintf( __( 'Email: %s' ), $user-&gt;user_email ) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      @wp_mail( get_option( 'admin_email' ), sprintf( __( '[%s] New User Registration' ), $blogname ), $message );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $switched_locale ) {&nbsp;</div></li><li><div>          restore_previous_locale();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// `$deprecated was pre-4.3 `$plaintext_pass`. An empty `$plaintext_pass` didn't sent a user notification.</span>&nbsp;</div></li><li><div>  if ( 'admin' === $notify || ( empty( $deprecated ) && empty( $notify ) ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Generate something random for a password reset key.</span>&nbsp;</div></li><li><div>  $key = wp_generate_password( 20, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** This action is documented in wp-login.php */</span>&nbsp;</div></li><li><div>  do_action( 'retrieve_password_key', $user-&gt;user_login, $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Now insert the key, hashed, into the DB.</span>&nbsp;</div></li><li><div>  if ( empty( $wp_hasher ) ) {&nbsp;</div></li><li><div>      $wp_hasher = new PasswordHash( 8, true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $hashed = time() . ':' . $wp_hasher-&gt;HashPassword( $key );&nbsp;</div></li><li><div>  $wpdb-&gt;update( $wpdb-&gt;users, array( 'user_activation_key' =&gt; $hashed ), array( 'user_login' =&gt; $user-&gt;user_login ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $switched_locale = switch_to_locale( get_user_locale( $user ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $message = sprintf(__('Username: %s'), $user-&gt;user_login) . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>  $message .= __('To set your password, visit the following address:') . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>  $message .= '&lt;' . network_site_url(&quot;wp-login.php?action=rp&key=$key&login=&quot; . rawurlencode($user-&gt;user_login), 'login') . &quot;&gt;\r\n\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $message .= wp_login_url() . &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_mail($user-&gt;user_email, sprintf(__('[%s] Your username and password info'), $blogname), $message);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $switched_locale ) {&nbsp;</div></li><li><div>      restore_previous_locale();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_nonce_tick') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the time-dependent variable for nonce creation.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A nonce has a lifespan of two ticks. Nonces in their second tick may be</span>&nbsp;</div></li><li><div><span class="comment"> * updated, e.g. by autosave.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return float Float value rounded up to the next highest integer.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_nonce_tick() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the lifespan of nonces in seconds.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $lifespan Lifespan of nonces in seconds. Default 86, 400 seconds, or one day.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $nonce_life = apply_filters( 'nonce_life', DAY_IN_SECONDS );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return ceil(time() / ( $nonce_life / 2 ));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_verify_nonce') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Verify that correct nonce was used with time limit.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The user is given an amount of time to use the token, so therefore, since the</span>&nbsp;</div></li><li><div><span class="comment"> * UID and $action remain the same, the independent variable is the time.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $nonce  Nonce that was used in the form to verify</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|int $action Should give context to what is taking place and be the same when nonce was created.</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|int False if the nonce is invalid, 1 if the nonce is valid and generated between</span>&nbsp;</div></li><li><div><span class="comment"> *                   0-12 hours ago, 2 if the nonce is valid and generated between 12-24 hours ago.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_verify_nonce( $nonce, $action = -1 ) {&nbsp;</div></li><li><div>  $nonce = (string) $nonce;&nbsp;</div></li><li><div>  $user = wp_get_current_user();&nbsp;</div></li><li><div>  $uid = (int) $user-&gt;ID;&nbsp;</div></li><li><div>  if ( ! $uid ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters whether the user who generated the nonce is logged out.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $uid    ID of the nonce-owning user.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $action The nonce action.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $uid = apply_filters( 'nonce_user_logged_out', $uid, $action );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $nonce ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $token = wp_get_session_token();&nbsp;</div></li><li><div>  $i = wp_nonce_tick();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Nonce generated 0-12 hours ago</span>&nbsp;</div></li><li><div>  $expected = substr( wp_hash( $i . '|' . $action . '|' . $uid . '|' . $token, 'nonce'), -12, 10 );&nbsp;</div></li><li><div>  if ( hash_equals( $expected, $nonce ) ) {&nbsp;</div></li><li><div>      return 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Nonce generated 12-24 hours ago</span>&nbsp;</div></li><li><div>  $expected = substr( wp_hash( ( $i - 1 ) . '|' . $action . '|' . $uid . '|' . $token, 'nonce' ), -12, 10 );&nbsp;</div></li><li><div>  if ( hash_equals( $expected, $nonce ) ) {&nbsp;</div></li><li><div>      return 2;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires when nonce verification fails.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string     $nonce  The invalid nonce.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|int $action The nonce action.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_User    $user   The current user object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string     $token  The user's session token.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'wp_verify_nonce_failed', $nonce, $action, $user, $token );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Invalid nonce</span>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_create_nonce') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates a cryptographic token tied to a specific action, user, user session, </span>&nbsp;</div></li><li><div><span class="comment"> * and window of time.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.3</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.0.0 Session tokens were integrated with nonce creation</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|int $action Scalar value to add context to the nonce.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The token.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_create_nonce($action = -1) {&nbsp;</div></li><li><div>  $user = wp_get_current_user();&nbsp;</div></li><li><div>  $uid = (int) $user-&gt;ID;&nbsp;</div></li><li><div>  if ( ! $uid ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/pluggable.php */</span></span></span></span></span>&nbsp;</div></li><li><div>      $uid = apply_filters( 'nonce_user_logged_out', $uid, $action );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $token = wp_get_session_token();&nbsp;</div></li><li><div>  $i = wp_nonce_tick();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return substr( wp_hash( $i . '|' . $action . '|' . $uid . '|' . $token, 'nonce' ), -12, 10 );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_salt') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get salt to add to hashes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Salts are created using secret keys. Secret keys are located in two places:</span>&nbsp;</div></li><li><div><span class="comment"> * in the database and in the wp-config.php file. The secret key in the database</span>&nbsp;</div></li><li><div><span class="comment"> * is randomly generated and will be appended to the secret keys in wp-config.php.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The secret keys in wp-config.php should be updated to strong, random keys to maximize</span>&nbsp;</div></li><li><div><span class="comment"> * security. Below is an example of how the secret key constants are defined.</span>&nbsp;</div></li><li><div><span class="comment"> * Do not paste this example directly into wp-config.php. Instead, have a</span>&nbsp;</div></li><li><div><span class="comment"> * {@link https://api.wordpress.org/secret-key/1.1/salt/ secret key created} just</span>&nbsp;</div></li><li><div><span class="comment"> * for you.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     define('AUTH_KEY', ' Xakm&lt;o xQy rw4EMsLKM-?!T+, PFF})H4lzcW57AF0U@N@&lt; &gt;M%G4Yt&gt;f`z]MON');</span>&nbsp;</div></li><li><div><span class="comment"> *     define('SECURE_AUTH_KEY', 'LzJ}op]mr|6+![P}Ak:uNdJCJZd&gt;(Hx.-Mh#Tz)pCIU#uGEnfFz|f ;;eU%/U^O~');</span>&nbsp;</div></li><li><div><span class="comment"> *     define('LOGGED_IN_KEY', '|i|Ux`9&lt;p-h$aFf(qnT:sDO:D1P^wZ$$/Ra@miTJi9G;ddp_&lt;q}6H1)o|a +&JCM');</span>&nbsp;</div></li><li><div><span class="comment"> *     define('NONCE_KEY', '%:R{[P|, s.KuMltH5}cI;/k&lt;Gx~j!f0I)m_sIyu+&NJZ)-iO&gt;z7X&gt;QYR0Z_XnZ@|');</span>&nbsp;</div></li><li><div><span class="comment"> *     define('AUTH_SALT', 'eZyT)-Naw]F8CwA*VaW#q*|.)g@o}||wf~@C-YSt}(dh_r6EbI#A, y|nU2{B#JBW');</span>&nbsp;</div></li><li><div><span class="comment"> *     define('SECURE_AUTH_SALT', '!=oLUTXh, QW=H `}`L|9/^4-3 STz}, T(w}W&lt;I`.JjPi)&lt;Bmf1v, HpGe}T1:Xt7n');</span>&nbsp;</div></li><li><div><span class="comment"> *     define('LOGGED_IN_SALT', '+XSqHc;@Q*K_b|Z?NC[3H!!EONbh.n&lt;+=uKR:&gt;*c(u`g~EJBf#8u#R{mUEZrozmm');</span>&nbsp;</div></li><li><div><span class="comment"> *     define('NONCE_SALT', 'h`GXHhD&gt;SLWVfg1(1(N{;.V!MoE(SfbA_ksP@&`+AycHcAV$+?@3q+rxV{%^VyKT');</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Salting passwords helps against tools which has stored hashed values of</span>&nbsp;</div></li><li><div><span class="comment"> * common dictionary strings. The added values makes it harder to crack.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @link https://api.wordpress.org/secret-key/1.1/salt/ Create secrets for wp-config.php</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar array $cached_salts</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar array $duplicated_keys</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $scheme Authentication scheme (auth, secure_auth, logged_in, nonce)</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Salt value</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_salt( $scheme = 'auth' ) {&nbsp;</div></li><li><div>  static $cached_salts = array();&nbsp;</div></li><li><div>  if ( isset( $cached_salts[ $scheme ] ) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the WordPress salt.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $cached_salt Cached salt for the given scheme.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $scheme      Authentication scheme. Values include 'auth', </span>&nbsp;</div></li><li><div><span class="comment">       *                            'secure_auth', 'logged_in', and 'nonce'.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      return apply_filters( 'salt', $cached_salts[ $scheme ], $scheme );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  static $duplicated_keys;&nbsp;</div></li><li><div>  if ( null === $duplicated_keys ) {&nbsp;</div></li><li><div>      $duplicated_keys = array( 'put your unique phrase here' =&gt; true );&nbsp;</div></li><li><div>      foreach ( array( 'AUTH', 'SECURE_AUTH', 'LOGGED_IN', 'NONCE', 'SECRET' ) as $first ) {&nbsp;</div></li><li><div>          foreach ( array( 'KEY', 'SALT' ) as $second ) {&nbsp;</div></li><li><div>              if ( ! defined( &quot;{$first}_{$second}&quot; ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $value = constant( &quot;{$first}_{$second}&quot; );&nbsp;</div></li><li><div>              $duplicated_keys[ $value ] = isset( $duplicated_keys[ $value ] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $values = array(&nbsp;</div></li><li><div>      'key' =&gt; '', &nbsp;</div></li><li><div>      'salt' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( defined( 'SECRET_KEY' ) && SECRET_KEY && empty( $duplicated_keys[ SECRET_KEY ] ) ) {&nbsp;</div></li><li><div>      $values['key'] = SECRET_KEY;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( 'auth' == $scheme && defined( 'SECRET_SALT' ) && SECRET_SALT && empty( $duplicated_keys[ SECRET_SALT ] ) ) {&nbsp;</div></li><li><div>      $values['salt'] = SECRET_SALT;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( in_array( $scheme, array( 'auth', 'secure_auth', 'logged_in', 'nonce' ) ) ) {&nbsp;</div></li><li><div>      foreach ( array( 'key', 'salt' ) as $type ) {&nbsp;</div></li><li><div>          $const = strtoupper( &quot;{$scheme}_{$type}&quot; );&nbsp;</div></li><li><div>          if ( defined( $const ) && constant( $const ) && empty( $duplicated_keys[ constant( $const ) ] ) ) {&nbsp;</div></li><li><div>              $values[ $type ] = constant( $const );&nbsp;</div></li><li><div>          } elseif ( ! $values[ $type ] ) {&nbsp;</div></li><li><div>              $values[ $type ] = get_site_option( &quot;{$scheme}_{$type}&quot; );&nbsp;</div></li><li><div>              if ( ! $values[ $type ] ) {&nbsp;</div></li><li><div>                  $values[ $type ] = wp_generate_password( 64, true, true );&nbsp;</div></li><li><div>                  update_site_option( &quot;{$scheme}_{$type}&quot;, $values[ $type ] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( ! $values['key'] ) {&nbsp;</div></li><li><div>          $values['key'] = get_site_option( 'secret_key' );&nbsp;</div></li><li><div>          if ( ! $values['key'] ) {&nbsp;</div></li><li><div>              $values['key'] = wp_generate_password( 64, true, true );&nbsp;</div></li><li><div>              update_site_option( 'secret_key', $values['key'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $values['salt'] = hash_hmac( 'md5', $scheme, $values['key'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cached_salts[ $scheme ] = $values['key'] . $values['salt'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/pluggable.php */</span></span></span></span></span>&nbsp;</div></li><li><div>  return apply_filters( 'salt', $cached_salts[ $scheme ], $scheme );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_hash') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get hash of given string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $data   Plain text to hash</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $scheme Authentication scheme (auth, secure_auth, logged_in, nonce)</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Hash of $data</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_hash($data, $scheme = 'auth') {&nbsp;</div></li><li><div>  $salt = wp_salt($scheme);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return hash_hmac('md5', $data, $salt);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_hash_password') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create a hash (encrypt) of a plain text password.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * For integration with other applications, this function can be overwritten to</span>&nbsp;</div></li><li><div><span class="comment"> * instead use the other package password checking algorithm.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global PasswordHash $wp_hasher PHPass object</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $password Plain text user password to hash</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The hash string of the password</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_hash_password($password) {&nbsp;</div></li><li><div>  global $wp_hasher;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty($wp_hasher) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// By default, use the portable hash from phpass</span></span>&nbsp;</div></li><li><div>      $wp_hasher = new PasswordHash(8, true);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $wp_hasher-&gt;HashPassword( trim( $password ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_check_password') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks the plaintext password against the encrypted Password.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Maintains compatibility between old version and the new cookie authentication</span>&nbsp;</div></li><li><div><span class="comment"> * protocol using PHPass library. The $hash parameter is the encrypted password</span>&nbsp;</div></li><li><div><span class="comment"> * and the function compares the plain text password when encrypted similarly</span>&nbsp;</div></li><li><div><span class="comment"> * against the already encrypted password to see if they match.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * For integration with other applications, this function can be overwritten to</span>&nbsp;</div></li><li><div><span class="comment"> * instead use the other package password checking algorithm.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global PasswordHash $wp_hasher PHPass object used for checking the password</span>&nbsp;</div></li><li><div><span class="comment"> *    against the $hash + $password</span>&nbsp;</div></li><li><div><span class="comment"> * @uses PasswordHash::CheckPassword</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $password Plaintext user's password</span>&nbsp;</div></li><li><div><span class="comment"> * @param string     $hash     Hash of the user's password to check against.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|int $user_id  Optional. User ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False, if the $password does not match the hashed password</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_check_password($password, $hash, $user_id = '') {&nbsp;</div></li><li><div>  global $wp_hasher;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the hash is still md5...</span>&nbsp;</div></li><li><div>  if ( strlen($hash) &lt;= 32 ) {&nbsp;</div></li><li><div>      $check = hash_equals( $hash, md5( $password ) );&nbsp;</div></li><li><div>      if ( $check && $user_id ) {&nbsp;</div></li><li><div>          <span class="comment">// Rehash using new hash.</span>&nbsp;</div></li><li><div>          wp_set_password($password, $user_id);&nbsp;</div></li><li><div>          $hash = wp_hash_password($password);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters whether the plaintext password matches the encrypted password.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool       $check    Whether the passwords match.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string     $password The plaintext password.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string     $hash     The hashed password.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string|int $user_id  User ID. Can be empty.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      return apply_filters( 'check_password', $check, $password, $hash, $user_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the stored hash is longer than an MD5, presume the</span>&nbsp;</div></li><li><div>  <span class="comment">// new style phpass portable hash.</span>&nbsp;</div></li><li><div>  if ( empty($wp_hasher) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// By default, use the portable hash from phpass</span></span>&nbsp;</div></li><li><div>      $wp_hasher = new PasswordHash(8, true);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $check = $wp_hasher-&gt;CheckPassword($password, $hash);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/pluggable.php */</span></span></span></span></span>&nbsp;</div></li><li><div>  return apply_filters( 'check_password', $check, $password, $hash, $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_generate_password') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Generates a random password drawn from the defined set of characters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int  $length              Optional. The length of password to generate. Default 12.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $special_chars       Optional. Whether to include standard special characters.</span>&nbsp;</div></li><li><div><span class="comment"> *                                  Default true.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $extra_special_chars Optional. Whether to include other special characters.</span>&nbsp;</div></li><li><div><span class="comment"> *                                  Used when generating secret keys and salts. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The random password.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_generate_password( $length = 12, $special_chars = true, $extra_special_chars = false ) {&nbsp;</div></li><li><div>  $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';&nbsp;</div></li><li><div>  if ( $special_chars )&nbsp;</div></li><li><div>      $chars .= '!@#$%^&*()';&nbsp;</div></li><li><div>  if ( $extra_special_chars )&nbsp;</div></li><li><div>      $chars .= '-_ []{}&lt;&gt;~`+=, .;:/?|';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $password = '';&nbsp;</div></li><li><div>  for ( $i = 0; $i &lt; $length; $i++ ) {&nbsp;</div></li><li><div>      $password .= substr($chars, wp_rand(0, strlen($chars) - 1), 1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the randomly-generated password.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $password The generated password.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'random_password', $password );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_rand') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Generates a random number</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.2</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Uses PHP7 random_int() or the random_compat library if available.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global string $rnd_value</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar string $seed</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar bool $external_rand_source_available</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $min Lower limit for the generated number</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $max Upper limit for the generated number</span>&nbsp;</div></li><li><div><span class="comment"> * @return int A random number between min and max</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_rand( $min = 0, $max = 0 ) {&nbsp;</div></li><li><div>  global $rnd_value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Some misconfigured 32bit environments (Entropy PHP, for example) truncate integers larger than PHP_INT_MAX to PHP_INT_MAX rather than overflowing them to floats.</span>&nbsp;</div></li><li><div>  $max_random_number = 3000000000 === 2147483647 ? (float) &quot;4294967295&quot; : 4294967295; <span class="comment">// 4294967295 = 0xffffffff</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// We only handle Ints, floats are truncated to their integer value.</span>&nbsp;</div></li><li><div>  $min = (int) $min;&nbsp;</div></li><li><div>  $max = (int) $max;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Use PHP's CSPRNG, or a compatible method</span>&nbsp;</div></li><li><div>  static $use_random_int_functionality = true;&nbsp;</div></li><li><div>  if ( $use_random_int_functionality ) {&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          $_max = ( 0 != $max ) ? $max : $max_random_number;&nbsp;</div></li><li><div>          <span class="comment">// wp_rand() can accept arguments in either order, PHP cannot.</span>&nbsp;</div></li><li><div>          $_max = max( $min, $_max );&nbsp;</div></li><li><div>          $_min = min( $min, $_max );&nbsp;</div></li><li><div>          $val = random_int( $_min, $_max );&nbsp;</div></li><li><div>          if ( false !== $val ) {&nbsp;</div></li><li><div>              return absint( $val );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $use_random_int_functionality = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } catch ( Error $e ) {&nbsp;</div></li><li><div>          $use_random_int_functionality = false;&nbsp;</div></li><li><div>      } catch ( Exception $e ) {&nbsp;</div></li><li><div>          $use_random_int_functionality = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Reset $rnd_value after 14 uses</span>&nbsp;</div></li><li><div>  <span class="comment">// 32(md5) + 40(sha1) + 40(sha1) / 8 = 14 random numbers from $rnd_value</span>&nbsp;</div></li><li><div>  if ( strlen($rnd_value) &lt; 8 ) {&nbsp;</div></li><li><div>      if ( defined( 'WP_SETUP_CONFIG' ) )&nbsp;</div></li><li><div>          static $seed = '';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $seed = get_transient('random_seed');&nbsp;</div></li><li><div>      $rnd_value = md5( uniqid(microtime() . mt_rand(), true ) . $seed );&nbsp;</div></li><li><div>      $rnd_value .= sha1($rnd_value);&nbsp;</div></li><li><div>      $rnd_value .= sha1($rnd_value . $seed);&nbsp;</div></li><li><div>      $seed = md5($seed . $rnd_value);&nbsp;</div></li><li><div>      if ( ! defined( 'WP_SETUP_CONFIG' ) && ! defined( 'WP_INSTALLING' ) ) {&nbsp;</div></li><li><div>          set_transient( 'random_seed', $seed );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Take the first 8 digits for our value</span>&nbsp;</div></li><li><div>  $value = substr($rnd_value, 0, 8);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Strip the first eight, leaving the remainder for the next call to wp_rand().</span>&nbsp;</div></li><li><div>  $rnd_value = substr($rnd_value, 8);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $value = abs(hexdec($value));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Reduce the value to be within the min - max range</span>&nbsp;</div></li><li><div>  if ( $max != 0 )&nbsp;</div></li><li><div>      $value = $min + ( $max - $min + 1 ) * $value / ( $max_random_number + 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return abs(intval($value));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_set_password') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updates the user's password with a new encrypted one.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * For integration with other applications, this function can be overwritten to</span>&nbsp;</div></li><li><div><span class="comment"> * instead use the other package password checking algorithm.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Please note: This function should be used sparingly and is really only meant for single-time</span>&nbsp;</div></li><li><div><span class="comment"> * application. Leveraging this improperly in a plugin or theme could result in an endless loop</span>&nbsp;</div></li><li><div><span class="comment"> * of password resets if precautions are not taken to ensure it does not execute on every page load.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $password The plaintext new user password</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id  User ID</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_set_password( $password, $user_id ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $hash = wp_hash_password( $password );&nbsp;</div></li><li><div>  $wpdb-&gt;update($wpdb-&gt;users, array('user_pass' =&gt; $hash, 'user_activation_key' =&gt; ''), array('ID' =&gt; $user_id) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_cache_delete($user_id, 'users');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'get_avatar' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the avatar `&lt;img&gt;` tag for a user, email address, MD5 hash, comment, or post.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0 Optional `$args` parameter added.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $id_or_email The Gravatar to retrieve. Accepts a user_id, gravatar md5 hash, </span>&nbsp;</div></li><li><div><span class="comment"> *                           user email, WP_User object, WP_Post object, or WP_Comment object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $size       Optional. Height and width of the avatar image file in pixels. Default 96.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $default    Optional. URL for the default image or a default type. Accepts '404'</span>&nbsp;</div></li><li><div><span class="comment"> *                           (return a 404 instead of a default image), 'retro' (8bit), 'monsterid'</span>&nbsp;</div></li><li><div><span class="comment"> *                           (monster), 'wavatar' (cartoon face), 'indenticon' (the &quot;quilt&quot;), </span>&nbsp;</div></li><li><div><span class="comment"> *                           'mystery', 'mm', or 'mysteryman' (The Oyster Man), 'blank' (transparent GIF), </span>&nbsp;</div></li><li><div><span class="comment"> *                           or 'gravatar_default' (the Gravatar logo). Default is the value of the</span>&nbsp;</div></li><li><div><span class="comment"> *                           'avatar_default' option, with a fallback of 'mystery'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $alt        Optional. Alternative text to use in &lt;img&gt; tag. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $args       {</span>&nbsp;</div></li><li><div><span class="comment"> *     Optional. Extra arguments to retrieve the avatar.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int          $height        Display height of the avatar in pixels. Defaults to $size.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int          $width         Display width of the avatar in pixels. Defaults to $size.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool         $force_default Whether to always show the default image, never the Gravatar. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $rating        What rating to display avatars up to. Accepts 'G', 'PG', 'R', 'X', and are</span>&nbsp;</div></li><li><div><span class="comment"> *                                       judged in that order. Default is the value of the 'avatar_rating' option.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $scheme        URL scheme to use. See set_url_scheme() for accepted values.</span>&nbsp;</div></li><li><div><span class="comment"> *                                       Default null.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type array|string $class         Array or string of additional classes to add to the &lt;img&gt; element.</span>&nbsp;</div></li><li><div><span class="comment"> *                                       Default null.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool         $force_display Whether to always show the avatar - ignores the show_avatars option.</span>&nbsp;</div></li><li><div><span class="comment"> *                                       Default false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string       $extra_attr    HTML attributes to insert in the IMG element. Is not sanitized. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return false|string `&lt;img&gt;` tag for the user's avatar. False on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_avatar( $id_or_email, $size = 96, $default = '', $alt = '', $args = null ) {&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      <span class="comment">// get_avatar_data() args.</span>&nbsp;</div></li><li><div>      'size' =&gt; 96, &nbsp;</div></li><li><div>      'height' =&gt; null, &nbsp;</div></li><li><div>      'width' =&gt; null, &nbsp;</div></li><li><div>      'default' =&gt; get_option( 'avatar_default', 'mystery' ), &nbsp;</div></li><li><div>      'force_default' =&gt; false, &nbsp;</div></li><li><div>      'rating' =&gt; get_option( 'avatar_rating' ), &nbsp;</div></li><li><div>      'scheme' =&gt; null, &nbsp;</div></li><li><div>      'alt' =&gt; '', &nbsp;</div></li><li><div>      'class' =&gt; null, &nbsp;</div></li><li><div>      'force_display' =&gt; false, &nbsp;</div></li><li><div>      'extra_attr' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $args ) ) {&nbsp;</div></li><li><div>      $args = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args['size'] = (int) $size;&nbsp;</div></li><li><div>  $args['default'] = $default;&nbsp;</div></li><li><div>  $args['alt'] = $alt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $args['height'] ) ) {&nbsp;</div></li><li><div>      $args['height'] = $args['size'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( empty( $args['width'] ) ) {&nbsp;</div></li><li><div>      $args['width'] = $args['size'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_object( $id_or_email ) && isset( $id_or_email-&gt;comment_ID ) ) {&nbsp;</div></li><li><div>      $id_or_email = get_comment( $id_or_email );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to retrieve the avatar URL early.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a non-null value will effectively short-circuit get_avatar(), passing</span>&nbsp;</div></li><li><div><span class="comment">   * the value through the {@see 'get_avatar'} filter and returning early.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $avatar      HTML for the user's avatar. Default null.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $id_or_email The Gravatar to retrieve. Accepts a user_id, gravatar md5 hash, </span>&nbsp;</div></li><li><div><span class="comment">   *                            user email, WP_User object, WP_Post object, or WP_Comment object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args        Arguments passed to get_avatar_url(), after processing.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $avatar = apply_filters( 'pre_get_avatar', null, $id_or_email, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_null( $avatar ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/pluggable.php */</span></span></span></span></span>&nbsp;</div></li><li><div>      return apply_filters( 'get_avatar', $avatar, $id_or_email, $args['size'], $args['default'], $args['alt'], $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $args['force_display'] && ! get_option( 'show_avatars' ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url2x = get_avatar_url( $id_or_email, array_merge( $args, array( 'size' =&gt; $args['size'] * 2 ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = get_avatar_data( $id_or_email, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url = $args['url'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $url || is_wp_error( $url ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $class = array( 'avatar', 'avatar-' . (int) $args['size'], 'photo' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $args['found_avatar'] || $args['force_default'] ) {&nbsp;</div></li><li><div>      $class[] = 'avatar-default';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $args['class'] ) {&nbsp;</div></li><li><div>      if ( is_array( $args['class'] ) ) {&nbsp;</div></li><li><div>          $class = array_merge( $class, $args['class'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $class[] = $args['class'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $avatar = sprintf(&nbsp;</div></li><li><div>      &quot;&lt;img alt='%s' src='%s' srcset='%s' class='%s' height='%d' width='%d' %s/&gt;&quot;, &nbsp;</div></li><li><div>      esc_attr( $args['alt'] ), &nbsp;</div></li><li><div>      esc_url( $url ), &nbsp;</div></li><li><div>      esc_attr( &quot;$url2x 2x&quot; ), &nbsp;</div></li><li><div>      esc_attr( join( ' ', $class ) ), &nbsp;</div></li><li><div>      (int) $args['height'], &nbsp;</div></li><li><div>      (int) $args['width'], &nbsp;</div></li><li><div>      $args['extra_attr']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the avatar to retrieve.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0 The `$args` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $avatar      &lt;img&gt; tag for the user's avatar.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $id_or_email The Gravatar to retrieve. Accepts a user_id, gravatar md5 hash, </span>&nbsp;</div></li><li><div><span class="comment">   *                            user email, WP_User object, WP_Post object, or WP_Comment object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $size        Square avatar width and height in pixels to retrieve.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $alt         Alternative text to use in the avatar image tag.</span>&nbsp;</div></li><li><div><span class="comment">   *                                       Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args        Arguments passed to get_avatar_data(), after processing.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'get_avatar', $avatar, $id_or_email, $args['size'], $args['default'], $args['alt'], $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'wp_text_diff' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays a human readable HTML representation of the difference between two strings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The Diff is available for getting the changes between versions. The output is</span>&nbsp;</div></li><li><div><span class="comment"> * HTML, so the primary use is for displaying the changes. If the two strings</span>&nbsp;</div></li><li><div><span class="comment"> * are equivalent, then an empty string will be returned.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The arguments supported and can be changed are listed below.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * 'title' : Default is an empty string. Titles the diff in a manner compatible</span>&nbsp;</div></li><li><div><span class="comment"> *        with the output.</span>&nbsp;</div></li><li><div><span class="comment"> * 'title_left' : Default is an empty string. Change the HTML to the left of the</span>&nbsp;</div></li><li><div><span class="comment"> *        title.</span>&nbsp;</div></li><li><div><span class="comment"> * 'title_right' : Default is an empty string. Change the HTML to the right of</span>&nbsp;</div></li><li><div><span class="comment"> *        the title.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_parse_args() Used to change defaults to user defined settings.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses Text_Diff</span>&nbsp;</div></li><li><div><span class="comment"> * @uses WP_Text_Diff_Renderer_Table</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $left_string  &quot;old&quot; (left) version of string</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $right_string &quot;new&quot; (right) version of string</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $args         Optional. Change 'title', 'title_left', and 'title_right' defaults.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Empty string if strings are equivalent or HTML with differences.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_text_diff( $left_string, $right_string, $args = null ) {&nbsp;</div></li><li><div>  $defaults = array( 'title' =&gt; '', 'title_left' =&gt; '', 'title_right' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! class_exists( 'WP_Text_Diff_Renderer_Table', false ) )&nbsp;</div></li><li><div>      require( ABSPATH . WPINC . '/wp-diff.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $left_string = normalize_whitespace($left_string);&nbsp;</div></li><li><div>  $right_string = normalize_whitespace($right_string);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $left_lines = explode(&quot;\n&quot;, $left_string);&nbsp;</div></li><li><div>  $right_lines = explode(&quot;\n&quot;, $right_string);&nbsp;</div></li><li><div>  $text_diff = new Text_Diff($left_lines, $right_lines);&nbsp;</div></li><li><div>  $renderer = new WP_Text_Diff_Renderer_Table( $args );&nbsp;</div></li><li><div>  $diff = $renderer-&gt;render($text_diff);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$diff )&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = &quot;&lt;table class='diff'&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $args[ 'show_split_view' ] ) ) {&nbsp;</div></li><li><div>      $r .= &quot;&lt;col class='content diffsplit left' /&gt;&lt;col class='content diffsplit middle' /&gt;&lt;col class='content diffsplit right' /&gt;&quot;;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $r .= &quot;&lt;col class='content' /&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $args['title'] || $args['title_left'] || $args['title_right'] )&nbsp;</div></li><li><div>      $r .= &quot;&lt;thead&gt;&quot;;&nbsp;</div></li><li><div>  if ( $args['title'] )&nbsp;</div></li><li><div>      $r .= &quot;&lt;tr class='diff-title'&gt;&lt;th colspan='4'&gt;$args[title]&lt;/th&gt;&lt;/tr&gt;\n&quot;;&nbsp;</div></li><li><div>  if ( $args['title_left'] || $args['title_right'] ) {&nbsp;</div></li><li><div>      $r .= &quot;&lt;tr class='diff-sub-title'&gt;\n&quot;;&nbsp;</div></li><li><div>      $r .= &quot;\t&lt;td&gt;&lt;/td&gt;&lt;th&gt;$args[title_left]&lt;/th&gt;\n&quot;;&nbsp;</div></li><li><div>      $r .= &quot;\t&lt;td&gt;&lt;/td&gt;&lt;th&gt;$args[title_right]&lt;/th&gt;\n&quot;;&nbsp;</div></li><li><div>      $r .= &quot;&lt;/tr&gt;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $args['title'] || $args['title_left'] || $args['title_right'] )&nbsp;</div></li><li><div>      $r .= &quot;&lt;/thead&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r .= &quot;&lt;tbody&gt;\n$diff\n&lt;/tbody&gt;\n&quot;;&nbsp;</div></li><li><div>  $r .= &quot;&lt;/table&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>