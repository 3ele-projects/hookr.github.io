<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-version="4.7.1" data-type="class" data-id="3791"><head xmlns="http://www.w3.org/1999/xhtml"><title> snoopy | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Snoopy, class, wordpress, 4.7.1" /><meta name="description" content="The WordPress Core Snoopy class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=981d61595de5a146c351b9023be25059' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/snoopy/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fsnoopy%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fsnoopy%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.1-class-snoopy","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="snoopy" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.1." href="http://hookr.io/4.7.1/" class="H_VERSION"><span property="name">4.7.1</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">snoopy</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6308"><a href="http://hookr.io/4.7.1/all/" title="All">All <span class="count badge">6308</span></a></li><li class="" data-id="new" data-count="1"><a href="http://hookr.io/4.7.1/new/" title="New">New <span class="count badge">1</span></a></li><li class="" data-id="hooks" data-count="2531"><a href="http://hookr.io/4.7.1/hooks/" title="Hooks">Hooks <span class="count badge">2531</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.1/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1667"><a href="http://hookr.io/4.7.1/filters/" title="Filters">Filters <span class="count badge">1667</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7.1/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.1/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2852"><a href="http://hookr.io/4.7.1/functions/" title="Functions">Functions <span class="count badge">2852</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Snoopy</strong></h1><p>The WordPress Core <strong>Snoopy</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7.1/files/wp-includes-class-snoopy/" class="file">/wp-includes/class-snoopy.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="38" class="block" start="38"><li><div>class Snoopy&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    /**** Public variables ****/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** user definable vars */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $host =    &quot;www.php.net&quot;;        // host name we are connecting to&nbsp;</div></li><li><div>    var $port =    80;                    // port we are connecting to&nbsp;</div></li><li><div>    var $proxy_host =    &quot;&quot;;                    // proxy host to use&nbsp;</div></li><li><div>    var $proxy_port =    &quot;&quot;;                    // proxy port to use&nbsp;</div></li><li><div>    var $proxy_user =    &quot;&quot;;                    // proxy user to use&nbsp;</div></li><li><div>    var $proxy_pass =    &quot;&quot;;                    // proxy password to use&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $agent =    &quot;Snoopy v1.2.4&quot;;    // agent we masquerade as&nbsp;</div></li><li><div>    var    $referer =    &quot;&quot;;                    // referer info to pass&nbsp;</div></li><li><div>    var $cookies =    array();            // array of cookies to pass&nbsp;</div></li><li><div>                                                // $cookies[&quot;username&quot;]=&quot;joe&quot;;&nbsp;</div></li><li><div>    var    $rawheaders =    array();            // array of raw headers to send&nbsp;</div></li><li><div>                                                // $rawheaders[&quot;Content-type&quot;]=&quot;text/html&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $maxredirs =    5;                    // http redirection depth maximum. 0 = disallow&nbsp;</div></li><li><div>    var $lastredirectaddr =    &quot;&quot;;                // contains address of last redirected address&nbsp;</div></li><li><div>    var    $offsiteok =    true;                // allows redirection off-site&nbsp;</div></li><li><div>    var $maxframes =    0;                    // frame content depth maximum. 0 = disallow&nbsp;</div></li><li><div>    var $expandlinks =    true;                // expand links to fully qualified URLs.&nbsp;</div></li><li><div>                                                // this only applies to fetchlinks()&nbsp;</div></li><li><div>                                                // submitlinks(), and submittext()&nbsp;</div></li><li><div>    var $passcookies =    true;                // pass set cookies back through redirects&nbsp;</div></li><li><div>                                                // NOTE: this currently does not respect&nbsp;</div></li><li><div>                                                // dates, domains or paths.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var    $user =    &quot;&quot;;                    // user for http authentication&nbsp;</div></li><li><div>    var    $pass =    &quot;&quot;;                    // password for http authentication&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // http accept types&nbsp;</div></li><li><div>    var $accept =    &quot;image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*&quot;;&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    var $results =    &quot;&quot;;                    // where the content is put&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    var $error =    &quot;&quot;;                    // error messages sent here&nbsp;</div></li><li><div>    var    $response_code =    &quot;&quot;;                    // response code returned from server&nbsp;</div></li><li><div>    var    $headers =    array();            // headers returned from server sent here&nbsp;</div></li><li><div>    var    $maxlength =    500000;                // max return data length (body)&nbsp;</div></li><li><div>    var $read_timeout =    0;                    // timeout on read operations, in seconds&nbsp;</div></li><li><div>                                                // supported only since PHP 4 Beta 4&nbsp;</div></li><li><div>                                                // set to 0 to disallow timeouts&nbsp;</div></li><li><div>    var $timed_out =    false;                // if a read operation timed out&nbsp;</div></li><li><div>    var    $status =    0;                    // http request status&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    var $temp_dir =    &quot;/tmp&quot;;                // temporary directory that the webserver&nbsp;</div></li><li><div>                                                // has permission to write to.&nbsp;</div></li><li><div>                                                // under Windows, this should be C:\temp&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    var    $curl_path =    &quot;/usr/local/bin/curl&quot;;&nbsp;</div></li><li><div>                                                // Snoopy will use cURL for fetching&nbsp;</div></li><li><div>                                                // SSL content if a full system path to&nbsp;</div></li><li><div>                                                // the cURL binary is supplied here.&nbsp;</div></li><li><div>                                                // set to false if you do not have&nbsp;</div></li><li><div>                                                // cURL installed. See http://curl.haxx.se&nbsp;</div></li><li><div>                                                // for details on installing cURL.&nbsp;</div></li><li><div>                                                // Snoopy does *not* use the cURL&nbsp;</div></li><li><div>                                                // library functions built into php, &nbsp;</div></li><li><div>                                                // as these functions are not stable&nbsp;</div></li><li><div>                                                // as of this Snoopy release.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    /**** Private variables ****/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var    $_maxlinelen =    4096;                // max line length (headers)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $_httpmethod =    &quot;GET&quot;;                // default http request method&nbsp;</div></li><li><div>    var $_httpversion =    &quot;HTTP/1.0&quot;;            // default http request version&nbsp;</div></li><li><div>    var $_submit_method =    &quot;POST&quot;;                // default submit method&nbsp;</div></li><li><div>    var $_submit_type =    &quot;application/x-www-form-urlencoded&quot;;    // default submit type&nbsp;</div></li><li><div>    var $_mime_boundary =   &quot;&quot;;                    // MIME boundary for multipart/form-data submit type&nbsp;</div></li><li><div>    var $_redirectaddr =    false;                // will be set if page fetched is a redirect&nbsp;</div></li><li><div>    var $_redirectdepth =    0;                    // increments on an http redirect&nbsp;</div></li><li><div>    var $_frameurls =     array();            // frame src urls&nbsp;</div></li><li><div>    var $_framedepth =    0;                    // increments on frame depth&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $_isproxy =    false;                // set if using a proxy server&nbsp;</div></li><li><div>    var $_fp_timeout =    30;                    // timeout for socket connection&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    fetch&nbsp;</div></li><li><div>    Purpose:    fetch the contents of a web page&nbsp;</div></li><li><div>                (and possibly other protocols in the&nbsp;</div></li><li><div>                future like ftp, nntp, gopher, etc.)&nbsp;</div></li><li><div>    Input:        $URI    the location of the page to fetch&nbsp;</div></li><li><div>    Output:        $this-&gt;results    the output text from the fetch&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fetch($URI)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //preg_match(&quot;|^([^:]+)://([^:/]+)(:[\d]+)*(.*)|&quot;, $URI, $URI_PARTS);&nbsp;</div></li><li><div>        $URI_PARTS = parse_url($URI);&nbsp;</div></li><li><div>        if (!empty($URI_PARTS[&quot;user&quot;]))&nbsp;</div></li><li><div>            $this-&gt;user = $URI_PARTS[&quot;user&quot;];&nbsp;</div></li><li><div>        if (!empty($URI_PARTS[&quot;pass&quot;]))&nbsp;</div></li><li><div>            $this-&gt;pass = $URI_PARTS[&quot;pass&quot;];&nbsp;</div></li><li><div>        if (empty($URI_PARTS[&quot;query&quot;]))&nbsp;</div></li><li><div>            $URI_PARTS[&quot;query&quot;] = '';&nbsp;</div></li><li><div>        if (empty($URI_PARTS[&quot;path&quot;]))&nbsp;</div></li><li><div>            $URI_PARTS[&quot;path&quot;] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch(strtolower($URI_PARTS[&quot;scheme&quot;]))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            case &quot;http&quot;:&nbsp;</div></li><li><div>                $this-&gt;host = $URI_PARTS[&quot;host&quot;];&nbsp;</div></li><li><div>                if(!empty($URI_PARTS[&quot;port&quot;]))&nbsp;</div></li><li><div>                    $this-&gt;port = $URI_PARTS[&quot;port&quot;];&nbsp;</div></li><li><div>                if($this-&gt;_connect($fp))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    if($this-&gt;_isproxy)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // using proxy, send entire URI&nbsp;</div></li><li><div>                        $this-&gt;_httprequest($URI, $fp, $URI, $this-&gt;_httpmethod);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $path = $URI_PARTS[&quot;path&quot;].($URI_PARTS[&quot;query&quot;] ? &quot;?&quot;.$URI_PARTS[&quot;query&quot;] : &quot;&quot;);&nbsp;</div></li><li><div>                        // no proxy, send only the path&nbsp;</div></li><li><div>                        $this-&gt;_httprequest($path, $fp, $URI, $this-&gt;_httpmethod);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;_disconnect($fp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if($this-&gt;_redirectaddr)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        /** url was redirected, check if we've hit the max depth */&nbsp;</div></li><li><div>                        if($this-&gt;maxredirs &gt; $this-&gt;_redirectdepth)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            // only follow redirect if it's on this site, or offsiteok is true&nbsp;</div></li><li><div>                            if(preg_match(&quot;|^http://&quot;.preg_quote($this-&gt;host).&quot;|i&quot;, $this-&gt;_redirectaddr) || $this-&gt;offsiteok)&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                /** follow the redirect */&nbsp;</div></li><li><div>                                $this-&gt;_redirectdepth++;&nbsp;</div></li><li><div>                                $this-&gt;lastredirectaddr=$this-&gt;_redirectaddr;&nbsp;</div></li><li><div>                                $this-&gt;fetch($this-&gt;_redirectaddr);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if($this-&gt;_framedepth &lt; $this-&gt;maxframes && count($this-&gt;_frameurls) &gt; 0)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $frameurls = $this-&gt;_frameurls;&nbsp;</div></li><li><div>                        $this-&gt;_frameurls = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        while(list(, $frameurl) = each($frameurls))&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            if($this-&gt;_framedepth &lt; $this-&gt;maxframes)&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                $this-&gt;fetch($frameurl);&nbsp;</div></li><li><div>                                $this-&gt;_framedepth++;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case &quot;https&quot;:&nbsp;</div></li><li><div>                if(!$this-&gt;curl_path)&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                if(function_exists(&quot;is_executable&quot;))&nbsp;</div></li><li><div>                    if (!is_executable($this-&gt;curl_path))&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                $this-&gt;host = $URI_PARTS[&quot;host&quot;];&nbsp;</div></li><li><div>                if(!empty($URI_PARTS[&quot;port&quot;]))&nbsp;</div></li><li><div>                    $this-&gt;port = $URI_PARTS[&quot;port&quot;];&nbsp;</div></li><li><div>                if($this-&gt;_isproxy)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    // using proxy, send entire URI&nbsp;</div></li><li><div>                    $this-&gt;_httpsrequest($URI, $URI, $this-&gt;_httpmethod);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $path = $URI_PARTS[&quot;path&quot;].($URI_PARTS[&quot;query&quot;] ? &quot;?&quot;.$URI_PARTS[&quot;query&quot;] : &quot;&quot;);&nbsp;</div></li><li><div>                    // no proxy, send only the path&nbsp;</div></li><li><div>                    $this-&gt;_httpsrequest($path, $URI, $this-&gt;_httpmethod);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($this-&gt;_redirectaddr)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    /** url was redirected, check if we've hit the max depth */&nbsp;</div></li><li><div>                    if($this-&gt;maxredirs &gt; $this-&gt;_redirectdepth)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // only follow redirect if it's on this site, or offsiteok is true&nbsp;</div></li><li><div>                        if(preg_match(&quot;|^http://&quot;.preg_quote($this-&gt;host).&quot;|i&quot;, $this-&gt;_redirectaddr) || $this-&gt;offsiteok)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            /** follow the redirect */&nbsp;</div></li><li><div>                            $this-&gt;_redirectdepth++;&nbsp;</div></li><li><div>                            $this-&gt;lastredirectaddr=$this-&gt;_redirectaddr;&nbsp;</div></li><li><div>                            $this-&gt;fetch($this-&gt;_redirectaddr);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($this-&gt;_framedepth &lt; $this-&gt;maxframes && count($this-&gt;_frameurls) &gt; 0)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $frameurls = $this-&gt;_frameurls;&nbsp;</div></li><li><div>                    $this-&gt;_frameurls = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    while(list(, $frameurl) = each($frameurls))&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        if($this-&gt;_framedepth &lt; $this-&gt;maxframes)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $this-&gt;fetch($frameurl);&nbsp;</div></li><li><div>                            $this-&gt;_framedepth++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                // not a valid protocol&nbsp;</div></li><li><div>                $this-&gt;error =    'Invalid protocol &quot;'.$URI_PARTS[&quot;scheme&quot;].'&quot;\n';&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    submit&nbsp;</div></li><li><div>    Purpose:    submit an http form&nbsp;</div></li><li><div>    Input:        $URI    the location to post the data&nbsp;</div></li><li><div>                $formvars    the formvars to use.&nbsp;</div></li><li><div>                    format: $formvars[&quot;var&quot;] = &quot;val&quot;;&nbsp;</div></li><li><div>                $formfiles  an array of files to submit&nbsp;</div></li><li><div>                    format: $formfiles[&quot;var&quot;] = &quot;/dir/filename.ext&quot;;&nbsp;</div></li><li><div>    Output:        $this-&gt;results    the text output from the post&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function submit($URI, $formvars=&quot;&quot;, $formfiles=&quot;&quot;)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        unset($postdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postdata = $this-&gt;_prepare_post_body($formvars, $formfiles);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $URI_PARTS = parse_url($URI);&nbsp;</div></li><li><div>        if (!empty($URI_PARTS[&quot;user&quot;]))&nbsp;</div></li><li><div>            $this-&gt;user = $URI_PARTS[&quot;user&quot;];&nbsp;</div></li><li><div>        if (!empty($URI_PARTS[&quot;pass&quot;]))&nbsp;</div></li><li><div>            $this-&gt;pass = $URI_PARTS[&quot;pass&quot;];&nbsp;</div></li><li><div>        if (empty($URI_PARTS[&quot;query&quot;]))&nbsp;</div></li><li><div>            $URI_PARTS[&quot;query&quot;] = '';&nbsp;</div></li><li><div>        if (empty($URI_PARTS[&quot;path&quot;]))&nbsp;</div></li><li><div>            $URI_PARTS[&quot;path&quot;] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch(strtolower($URI_PARTS[&quot;scheme&quot;]))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            case &quot;http&quot;:&nbsp;</div></li><li><div>                $this-&gt;host = $URI_PARTS[&quot;host&quot;];&nbsp;</div></li><li><div>                if(!empty($URI_PARTS[&quot;port&quot;]))&nbsp;</div></li><li><div>                    $this-&gt;port = $URI_PARTS[&quot;port&quot;];&nbsp;</div></li><li><div>                if($this-&gt;_connect($fp))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    if($this-&gt;_isproxy)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // using proxy, send entire URI&nbsp;</div></li><li><div>                        $this-&gt;_httprequest($URI, $fp, $URI, $this-&gt;_submit_method, $this-&gt;_submit_type, $postdata);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $path = $URI_PARTS[&quot;path&quot;].($URI_PARTS[&quot;query&quot;] ? &quot;?&quot;.$URI_PARTS[&quot;query&quot;] : &quot;&quot;);&nbsp;</div></li><li><div>                        // no proxy, send only the path&nbsp;</div></li><li><div>                        $this-&gt;_httprequest($path, $fp, $URI, $this-&gt;_submit_method, $this-&gt;_submit_type, $postdata);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;_disconnect($fp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if($this-&gt;_redirectaddr)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        /** url was redirected, check if we've hit the max depth */&nbsp;</div></li><li><div>                        if($this-&gt;maxredirs &gt; $this-&gt;_redirectdepth)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            if(!preg_match(&quot;|^&quot;.$URI_PARTS[&quot;scheme&quot;].&quot;://|&quot;, $this-&gt;_redirectaddr))&nbsp;</div></li><li><div>                                $this-&gt;_redirectaddr = $this-&gt;_expandlinks($this-&gt;_redirectaddr, $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$URI_PARTS[&quot;host&quot;]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // only follow redirect if it's on this site, or offsiteok is true&nbsp;</div></li><li><div>                            if(preg_match(&quot;|^http://&quot;.preg_quote($this-&gt;host).&quot;|i&quot;, $this-&gt;_redirectaddr) || $this-&gt;offsiteok)&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                /** follow the redirect */&nbsp;</div></li><li><div>                                $this-&gt;_redirectdepth++;&nbsp;</div></li><li><div>                                $this-&gt;lastredirectaddr=$this-&gt;_redirectaddr;&nbsp;</div></li><li><div>                                if( strpos( $this-&gt;_redirectaddr, &quot;?&quot; ) &gt; 0 )&nbsp;</div></li><li><div>                                    $this-&gt;fetch($this-&gt;_redirectaddr); // the redirect has changed the request method from post to get&nbsp;</div></li><li><div>                                else&nbsp;</div></li><li><div>                                    $this-&gt;submit($this-&gt;_redirectaddr, $formvars, $formfiles);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if($this-&gt;_framedepth &lt; $this-&gt;maxframes && count($this-&gt;_frameurls) &gt; 0)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $frameurls = $this-&gt;_frameurls;&nbsp;</div></li><li><div>                        $this-&gt;_frameurls = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        while(list(, $frameurl) = each($frameurls))&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            if($this-&gt;_framedepth &lt; $this-&gt;maxframes)&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                $this-&gt;fetch($frameurl);&nbsp;</div></li><li><div>                                $this-&gt;_framedepth++;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case &quot;https&quot;:&nbsp;</div></li><li><div>                if(!$this-&gt;curl_path)&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                if(function_exists(&quot;is_executable&quot;))&nbsp;</div></li><li><div>                    if (!is_executable($this-&gt;curl_path))&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                $this-&gt;host = $URI_PARTS[&quot;host&quot;];&nbsp;</div></li><li><div>                if(!empty($URI_PARTS[&quot;port&quot;]))&nbsp;</div></li><li><div>                    $this-&gt;port = $URI_PARTS[&quot;port&quot;];&nbsp;</div></li><li><div>                if($this-&gt;_isproxy)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    // using proxy, send entire URI&nbsp;</div></li><li><div>                    $this-&gt;_httpsrequest($URI, $URI, $this-&gt;_submit_method, $this-&gt;_submit_type, $postdata);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $path = $URI_PARTS[&quot;path&quot;].($URI_PARTS[&quot;query&quot;] ? &quot;?&quot;.$URI_PARTS[&quot;query&quot;] : &quot;&quot;);&nbsp;</div></li><li><div>                    // no proxy, send only the path&nbsp;</div></li><li><div>                    $this-&gt;_httpsrequest($path, $URI, $this-&gt;_submit_method, $this-&gt;_submit_type, $postdata);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($this-&gt;_redirectaddr)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    /** url was redirected, check if we've hit the max depth */&nbsp;</div></li><li><div>                    if($this-&gt;maxredirs &gt; $this-&gt;_redirectdepth)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        if(!preg_match(&quot;|^&quot;.$URI_PARTS[&quot;scheme&quot;].&quot;://|&quot;, $this-&gt;_redirectaddr))&nbsp;</div></li><li><div>                            $this-&gt;_redirectaddr = $this-&gt;_expandlinks($this-&gt;_redirectaddr, $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$URI_PARTS[&quot;host&quot;]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // only follow redirect if it's on this site, or offsiteok is true&nbsp;</div></li><li><div>                        if(preg_match(&quot;|^http://&quot;.preg_quote($this-&gt;host).&quot;|i&quot;, $this-&gt;_redirectaddr) || $this-&gt;offsiteok)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            /** follow the redirect */&nbsp;</div></li><li><div>                            $this-&gt;_redirectdepth++;&nbsp;</div></li><li><div>                            $this-&gt;lastredirectaddr=$this-&gt;_redirectaddr;&nbsp;</div></li><li><div>                            if( strpos( $this-&gt;_redirectaddr, &quot;?&quot; ) &gt; 0 )&nbsp;</div></li><li><div>                                $this-&gt;fetch($this-&gt;_redirectaddr); // the redirect has changed the request method from post to get&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $this-&gt;submit($this-&gt;_redirectaddr, $formvars, $formfiles);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($this-&gt;_framedepth &lt; $this-&gt;maxframes && count($this-&gt;_frameurls) &gt; 0)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $frameurls = $this-&gt;_frameurls;&nbsp;</div></li><li><div>                    $this-&gt;_frameurls = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    while(list(, $frameurl) = each($frameurls))&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        if($this-&gt;_framedepth &lt; $this-&gt;maxframes)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $this-&gt;fetch($frameurl);&nbsp;</div></li><li><div>                            $this-&gt;_framedepth++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                // not a valid protocol&nbsp;</div></li><li><div>                $this-&gt;error =    'Invalid protocol &quot;'.$URI_PARTS[&quot;scheme&quot;].'&quot;\n';&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    fetchlinks&nbsp;</div></li><li><div>    Purpose:    fetch the links from a web page&nbsp;</div></li><li><div>    Input:        $URI    where you are fetching from&nbsp;</div></li><li><div>    Output:        $this-&gt;results    an array of the URLs&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fetchlinks($URI)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;fetch($URI))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($this-&gt;lastredirectaddr)&nbsp;</div></li><li><div>                $URI = $this-&gt;lastredirectaddr;&nbsp;</div></li><li><div>            if(is_array($this-&gt;results))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                for($x=0;$x&lt;count($this-&gt;results);$x++)&nbsp;</div></li><li><div>                    $this-&gt;results[$x] = $this-&gt;_striplinks($this-&gt;results[$x]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $this-&gt;results = $this-&gt;_striplinks($this-&gt;results);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($this-&gt;expandlinks)&nbsp;</div></li><li><div>                $this-&gt;results = $this-&gt;_expandlinks($this-&gt;results, $URI);&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    fetchform&nbsp;</div></li><li><div>    Purpose:    fetch the form elements from a web page&nbsp;</div></li><li><div>    Input:        $URI    where you are fetching from&nbsp;</div></li><li><div>    Output:        $this-&gt;results    the resulting html form&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fetchform($URI)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;fetch($URI))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(is_array($this-&gt;results))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                for($x=0;$x&lt;count($this-&gt;results);$x++)&nbsp;</div></li><li><div>                    $this-&gt;results[$x] = $this-&gt;_stripform($this-&gt;results[$x]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $this-&gt;results = $this-&gt;_stripform($this-&gt;results);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    fetchtext&nbsp;</div></li><li><div>    Purpose:    fetch the text from a web page, stripping the links&nbsp;</div></li><li><div>    Input:        $URI    where you are fetching from&nbsp;</div></li><li><div>    Output:        $this-&gt;results    the text from the web page&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fetchtext($URI)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if($this-&gt;fetch($URI))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(is_array($this-&gt;results))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                for($x=0;$x&lt;count($this-&gt;results);$x++)&nbsp;</div></li><li><div>                    $this-&gt;results[$x] = $this-&gt;_striptext($this-&gt;results[$x]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $this-&gt;results = $this-&gt;_striptext($this-&gt;results);&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    submitlinks&nbsp;</div></li><li><div>    Purpose:    grab links from a form submission&nbsp;</div></li><li><div>    Input:        $URI    where you are submitting from&nbsp;</div></li><li><div>    Output:        $this-&gt;results    an array of the links from the post&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function submitlinks($URI, $formvars=&quot;&quot;, $formfiles=&quot;&quot;)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if($this-&gt;submit($URI, $formvars, $formfiles))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($this-&gt;lastredirectaddr)&nbsp;</div></li><li><div>                $URI = $this-&gt;lastredirectaddr;&nbsp;</div></li><li><div>            if(is_array($this-&gt;results))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                for($x=0;$x&lt;count($this-&gt;results);$x++)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $this-&gt;results[$x] = $this-&gt;_striplinks($this-&gt;results[$x]);&nbsp;</div></li><li><div>                    if($this-&gt;expandlinks)&nbsp;</div></li><li><div>                        $this-&gt;results[$x] = $this-&gt;_expandlinks($this-&gt;results[$x], $URI);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;results = $this-&gt;_striplinks($this-&gt;results);&nbsp;</div></li><li><div>                if($this-&gt;expandlinks)&nbsp;</div></li><li><div>                    $this-&gt;results = $this-&gt;_expandlinks($this-&gt;results, $URI);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    submittext&nbsp;</div></li><li><div>    Purpose:    grab text from a form submission&nbsp;</div></li><li><div>    Input:        $URI    where you are submitting from&nbsp;</div></li><li><div>    Output:        $this-&gt;results    the text from the web page&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function submittext($URI, $formvars = &quot;&quot;, $formfiles = &quot;&quot;)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if($this-&gt;submit($URI, $formvars, $formfiles))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if($this-&gt;lastredirectaddr)&nbsp;</div></li><li><div>                $URI = $this-&gt;lastredirectaddr;&nbsp;</div></li><li><div>            if(is_array($this-&gt;results))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                for($x=0;$x&lt;count($this-&gt;results);$x++)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $this-&gt;results[$x] = $this-&gt;_striptext($this-&gt;results[$x]);&nbsp;</div></li><li><div>                    if($this-&gt;expandlinks)&nbsp;</div></li><li><div>                        $this-&gt;results[$x] = $this-&gt;_expandlinks($this-&gt;results[$x], $URI);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;results = $this-&gt;_striptext($this-&gt;results);&nbsp;</div></li><li><div>                if($this-&gt;expandlinks)&nbsp;</div></li><li><div>                    $this-&gt;results = $this-&gt;_expandlinks($this-&gt;results, $URI);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    set_submit_multipart&nbsp;</div></li><li><div>    Purpose:    Set the form submission content type to&nbsp;</div></li><li><div>                multipart/form-data&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>    function set_submit_multipart()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_submit_type = &quot;multipart/form-data&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    set_submit_normal&nbsp;</div></li><li><div>    Purpose:    Set the form submission content type to&nbsp;</div></li><li><div>                application/x-www-form-urlencoded&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>    function set_submit_normal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_submit_type = &quot;application/x-www-form-urlencoded&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Private functions&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _striplinks&nbsp;</div></li><li><div>    Purpose:    strip the hyperlinks from an html document&nbsp;</div></li><li><div>    Input:        $document    document to strip.&nbsp;</div></li><li><div>    Output:        $match        an array of the links&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _striplinks($document)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        preg_match_all(&quot;'&lt;\s*a\s.*?href\s*=\s*            # find &lt;a href=&nbsp;</div></li><li><div>                        ([\&quot;\'])?                    # find single or double quote&nbsp;</div></li><li><div>                        (?(1) (.*?)\\1 | ([^\s\&gt;]+))        # if quote found, match up to next matching&nbsp;</div></li><li><div>                                                    # quote, otherwise match up to next space&nbsp;</div></li><li><div>                        'isx&quot;, $document, $links);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // catenate the non-empty matches from the conditional subpattern&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while(list($key, $val) = each($links[2]))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(!empty($val))&nbsp;</div></li><li><div>                $match[] = $val;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while(list($key, $val) = each($links[3]))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(!empty($val))&nbsp;</div></li><li><div>                $match[] = $val;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // return the links&nbsp;</div></li><li><div>        return $match;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _stripform&nbsp;</div></li><li><div>    Purpose:    strip the form elements from an html document&nbsp;</div></li><li><div>    Input:        $document    document to strip.&nbsp;</div></li><li><div>    Output:        $match        an array of the links&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _stripform($document)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        preg_match_all(&quot;'&lt;\/?(FORM|INPUT|SELECT|TEXTAREA|(OPTION))[^&lt;&gt;]*&gt;(?(2)(.*(?=&lt;\/?(option|select)[^&lt;&gt;]*&gt;[\r\n]*)|(?=[\r\n]*))|(?=[\r\n]*))'Usi&quot;, $document, $elements);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // catenate the matches&nbsp;</div></li><li><div>        $match = implode(&quot;\r\n&quot;, $elements[0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // return the links&nbsp;</div></li><li><div>        return $match;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _striptext&nbsp;</div></li><li><div>    Purpose:    strip the text from an html document&nbsp;</div></li><li><div>    Input:        $document    document to strip.&nbsp;</div></li><li><div>    Output:        $text        the resulting text&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _striptext($document)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // I didn't use preg eval (//e) since that is only available in PHP 4.0.&nbsp;</div></li><li><div>        // so, list your entities one by one here. I included some of the&nbsp;</div></li><li><div>        // more common ones.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $search = array(&quot;'&lt;script[^&gt;]*?&gt;.*?&lt;/script&gt;'si&quot;, // strip out javascript&nbsp;</div></li><li><div>                        &quot;'&lt;[\/\!]*?[^&lt;&gt;]*?&gt;'si&quot;, // strip out html tags&nbsp;</div></li><li><div>                        &quot;'([\r\n])[\s]+'&quot;, // strip out white space&nbsp;</div></li><li><div>                        &quot;'&(quot|#34|#034|#x22);'i&quot;, // replace html entities&nbsp;</div></li><li><div>                        &quot;'&(amp|#38|#038|#x26);'i&quot;, // added hexadecimal values&nbsp;</div></li><li><div>                        &quot;'&(lt|#60|#060|#x3c);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(gt|#62|#062|#x3e);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(nbsp|#160|#xa0);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(iexcl|#161);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(cent|#162);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(pound|#163);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(copy|#169);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(reg|#174);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(deg|#176);'i&quot;, &nbsp;</div></li><li><div>                        &quot;'&(#39|#039|#x27);'&quot;, &nbsp;</div></li><li><div>                        &quot;'&(euro|#8364);'i&quot;, // europe&nbsp;</div></li><li><div>                        &quot;'&a(uml|UML);'&quot;, // german&nbsp;</div></li><li><div>                        &quot;'&o(uml|UML);'&quot;, &nbsp;</div></li><li><div>                        &quot;'&u(uml|UML);'&quot;, &nbsp;</div></li><li><div>                        &quot;'&A(uml|UML);'&quot;, &nbsp;</div></li><li><div>                        &quot;'&O(uml|UML);'&quot;, &nbsp;</div></li><li><div>                        &quot;'&U(uml|UML);'&quot;, &nbsp;</div></li><li><div>                        &quot;'&szlig;'i&quot;, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $replace = array(    &quot;&quot;, &nbsp;</div></li><li><div>                            &quot;&quot;, &nbsp;</div></li><li><div>                            &quot;\\1&quot;, &nbsp;</div></li><li><div>                            &quot;\&quot;&quot;, &nbsp;</div></li><li><div>                            &quot;&&quot;, &nbsp;</div></li><li><div>                            &quot;&lt;&quot;, &nbsp;</div></li><li><div>                            &quot;&gt;&quot;, &nbsp;</div></li><li><div>                            &quot; &quot;, &nbsp;</div></li><li><div>                            chr(161), &nbsp;</div></li><li><div>                            chr(162), &nbsp;</div></li><li><div>                            chr(163), &nbsp;</div></li><li><div>                            chr(169), &nbsp;</div></li><li><div>                            chr(174), &nbsp;</div></li><li><div>                            chr(176), &nbsp;</div></li><li><div>                            chr(39), &nbsp;</div></li><li><div>                            chr(128), &nbsp;</div></li><li><div>                            chr(0xE4), // ANSI &auml;&nbsp;</div></li><li><div>                            chr(0xF6), // ANSI &ouml;&nbsp;</div></li><li><div>                            chr(0xFC), // ANSI &uuml;&nbsp;</div></li><li><div>                            chr(0xC4), // ANSI &Auml;&nbsp;</div></li><li><div>                            chr(0xD6), // ANSI &Ouml;&nbsp;</div></li><li><div>                            chr(0xDC), // ANSI &Uuml;&nbsp;</div></li><li><div>                            chr(0xDF), // ANSI &szlig;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $text = preg_replace($search, $replace, $document);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $text;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _expandlinks&nbsp;</div></li><li><div>    Purpose:    expand each link into a fully qualified URL&nbsp;</div></li><li><div>    Input:        $links            the links to qualify&nbsp;</div></li><li><div>                $URI            the full URI to get the base from&nbsp;</div></li><li><div>    Output:        $expandedLinks    the expanded links&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _expandlinks($links, $URI)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        preg_match(&quot;/^[^\?]+/&quot;, $URI, $match);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $match = preg_replace(&quot;|/[^\/\.]+\.[^\/\.]+$|&quot;, &quot;&quot;, $match[0]);&nbsp;</div></li><li><div>        $match = preg_replace(&quot;|/$|&quot;, &quot;&quot;, $match);&nbsp;</div></li><li><div>        $match_part = parse_url($match);&nbsp;</div></li><li><div>        $match_root =&nbsp;</div></li><li><div>        $match_part[&quot;scheme&quot;].&quot;://&quot;.$match_part[&quot;host&quot;];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $search = array(     &quot;|^http://&quot;.preg_quote($this-&gt;host).&quot;|i&quot;, &nbsp;</div></li><li><div>                            &quot;|^(\/)|i&quot;, &nbsp;</div></li><li><div>                            &quot;|^(?!http://)(?!mailto:)|i&quot;, &nbsp;</div></li><li><div>                            &quot;|/\./|&quot;, &nbsp;</div></li><li><div>                            &quot;|/[^\/]+/\.\./|&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $replace = array(    &quot;&quot;, &nbsp;</div></li><li><div>                            $match_root.&quot;/&quot;, &nbsp;</div></li><li><div>                            $match.&quot;/&quot;, &nbsp;</div></li><li><div>                            &quot;/&quot;, &nbsp;</div></li><li><div>                            &quot;/&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $expandedLinks = preg_replace($search, $replace, $links);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $expandedLinks;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _httprequest&nbsp;</div></li><li><div>    Purpose:    go get the http data from the server&nbsp;</div></li><li><div>    Input:        $url        the url to fetch&nbsp;</div></li><li><div>                $fp            the current open file pointer&nbsp;</div></li><li><div>                $URI        the full URI&nbsp;</div></li><li><div>                $body        body contents to send if any (POST)&nbsp;</div></li><li><div>    Output:&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _httprequest($url, $fp, $URI, $http_method, $content_type=&quot;&quot;, $body=&quot;&quot;)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $cookie_headers = '';&nbsp;</div></li><li><div>        if($this-&gt;passcookies && $this-&gt;_redirectaddr)&nbsp;</div></li><li><div>            $this-&gt;setcookies();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $URI_PARTS = parse_url($URI);&nbsp;</div></li><li><div>        if(empty($url))&nbsp;</div></li><li><div>            $url = &quot;/&quot;;&nbsp;</div></li><li><div>        $headers = $http_method.&quot; &quot;.$url.&quot; &quot;.$this-&gt;_httpversion.&quot;\r\n&quot;;&nbsp;</div></li><li><div>        if(!empty($this-&gt;agent))&nbsp;</div></li><li><div>            $headers .= &quot;User-Agent: &quot;.$this-&gt;agent.&quot;\r\n&quot;;&nbsp;</div></li><li><div>        if(!empty($this-&gt;host) && !isset($this-&gt;rawheaders['Host'])) {&nbsp;</div></li><li><div>            $headers .= &quot;Host: &quot;.$this-&gt;host;&nbsp;</div></li><li><div>            if(!empty($this-&gt;port) && $this-&gt;port != 80)&nbsp;</div></li><li><div>                $headers .= &quot;:&quot;.$this-&gt;port;&nbsp;</div></li><li><div>            $headers .= &quot;\r\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!empty($this-&gt;accept))&nbsp;</div></li><li><div>            $headers .= &quot;Accept: &quot;.$this-&gt;accept.&quot;\r\n&quot;;&nbsp;</div></li><li><div>        if(!empty($this-&gt;referer))&nbsp;</div></li><li><div>            $headers .= &quot;Referer: &quot;.$this-&gt;referer.&quot;\r\n&quot;;&nbsp;</div></li><li><div>        if(!empty($this-&gt;cookies))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(!is_array($this-&gt;cookies))&nbsp;</div></li><li><div>                $this-&gt;cookies = (array)$this-&gt;cookies;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            reset($this-&gt;cookies);&nbsp;</div></li><li><div>            if ( count($this-&gt;cookies) &gt; 0 ) {&nbsp;</div></li><li><div>                $cookie_headers .= 'Cookie: ';&nbsp;</div></li><li><div>                foreach ( $this-&gt;cookies as $cookieKey =&gt; $cookieVal ) {&nbsp;</div></li><li><div>                $cookie_headers .= $cookieKey.&quot;=&quot;.urlencode($cookieVal).&quot;; &quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $headers .= substr($cookie_headers, 0, -2) . &quot;\r\n&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!empty($this-&gt;rawheaders))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(!is_array($this-&gt;rawheaders))&nbsp;</div></li><li><div>                $this-&gt;rawheaders = (array)$this-&gt;rawheaders;&nbsp;</div></li><li><div>            while(list($headerKey, $headerVal) = each($this-&gt;rawheaders))&nbsp;</div></li><li><div>                $headers .= $headerKey.&quot;: &quot;.$headerVal.&quot;\r\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!empty($content_type)) {&nbsp;</div></li><li><div>            $headers .= &quot;Content-type: $content_type&quot;;&nbsp;</div></li><li><div>            if ($content_type == &quot;multipart/form-data&quot;)&nbsp;</div></li><li><div>                $headers .= &quot;; boundary=&quot;.$this-&gt;_mime_boundary;&nbsp;</div></li><li><div>            $headers .= &quot;\r\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!empty($body))&nbsp;</div></li><li><div>            $headers .= &quot;Content-length: &quot;.strlen($body).&quot;\r\n&quot;;&nbsp;</div></li><li><div>        if(!empty($this-&gt;user) || !empty($this-&gt;pass))&nbsp;</div></li><li><div>            $headers .= &quot;Authorization: Basic &quot;.base64_encode($this-&gt;user.&quot;:&quot;.$this-&gt;pass).&quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //add proxy auth headers&nbsp;</div></li><li><div>        if(!empty($this-&gt;proxy_user))&nbsp;</div></li><li><div>            $headers .= 'Proxy-Authorization: ' . 'Basic ' . base64_encode($this-&gt;proxy_user . ':' . $this-&gt;proxy_pass).&quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $headers .= &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set the read timeout if needed&nbsp;</div></li><li><div>        if ($this-&gt;read_timeout &gt; 0)&nbsp;</div></li><li><div>            socket_set_timeout($fp, $this-&gt;read_timeout);&nbsp;</div></li><li><div>        $this-&gt;timed_out = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        fwrite($fp, $headers.$body, strlen($headers.$body));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_redirectaddr = false;&nbsp;</div></li><li><div>        unset($this-&gt;headers);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while($currentHeader = fgets($fp, $this-&gt;_maxlinelen))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if ($this-&gt;read_timeout &gt; 0 && $this-&gt;_check_timeout($fp))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;status=-100;&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($currentHeader == &quot;\r\n&quot;)&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if a header begins with Location: or URI:, set the redirect&nbsp;</div></li><li><div>            if(preg_match(&quot;/^(Location:|URI:)/i&quot;, $currentHeader))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // get URL portion of the redirect&nbsp;</div></li><li><div>                preg_match(&quot;/^(Location:|URI:)[ ]+(.*)/i&quot;, chop($currentHeader), $matches);&nbsp;</div></li><li><div>                // look for :// in the Location header to see if hostname is included&nbsp;</div></li><li><div>                if(!preg_match(&quot;|\:\/\/|&quot;, $matches[2]))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    // no host in the path, so prepend&nbsp;</div></li><li><div>                    $this-&gt;_redirectaddr = $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host.&quot;:&quot;.$this-&gt;port;&nbsp;</div></li><li><div>                    // eliminate double slash&nbsp;</div></li><li><div>                    if(!preg_match(&quot;|^/|&quot;, $matches[2]))&nbsp;</div></li><li><div>                            $this-&gt;_redirectaddr .= &quot;/&quot;.$matches[2];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                            $this-&gt;_redirectaddr .= $matches[2];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;_redirectaddr = $matches[2];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(preg_match(&quot;|^HTTP/|&quot;, $currentHeader))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                if(preg_match(&quot;|^HTTP/[^\s]*\s(.*?)\s|&quot;, $currentHeader, $status))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $this-&gt;status= $status[1];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;response_code = $currentHeader;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;headers[] = $currentHeader;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = '';&nbsp;</div></li><li><div>        do {&nbsp;</div></li><li><div>            $_data = fread($fp, $this-&gt;maxlength);&nbsp;</div></li><li><div>            if (strlen($_data) == 0) {&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $results .= $_data;&nbsp;</div></li><li><div>        } while(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;read_timeout &gt; 0 && $this-&gt;_check_timeout($fp))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;status=-100;&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check if there is a redirect meta tag&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(preg_match(&quot;'&lt;meta[\s]*http-equiv[^&gt;]*?content[\s]*=[\s]*[\&quot;\']?\d+;[\s]*URL[\s]*=[\s]*([^\&quot;\']*?)[\&quot;\']?&gt;'i&quot;, $results, $match))&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;_redirectaddr = $this-&gt;_expandlinks($match[1], $URI);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // have we hit our frame depth and is there frame src to fetch?&nbsp;</div></li><li><div>        if(($this-&gt;_framedepth &lt; $this-&gt;maxframes) && preg_match_all(&quot;'&lt;frame\s+.*src[\s]*=[\'\&quot;]?([^\'\&quot;\&gt;]+)'i&quot;, $results, $match))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;results[] = $results;&nbsp;</div></li><li><div>            for($x=0; $x&lt;count($match[1]); $x++)&nbsp;</div></li><li><div>                $this-&gt;_frameurls[] = $this-&gt;_expandlinks($match[1][$x], $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // have we already fetched framed content?&nbsp;</div></li><li><div>        elseif(is_array($this-&gt;results))&nbsp;</div></li><li><div>            $this-&gt;results[] = $results;&nbsp;</div></li><li><div>        // no framed content&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $this-&gt;results = $results;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _httpsrequest&nbsp;</div></li><li><div>    Purpose:    go get the https data from the server using curl&nbsp;</div></li><li><div>    Input:        $url        the url to fetch&nbsp;</div></li><li><div>                $URI        the full URI&nbsp;</div></li><li><div>                $body        body contents to send if any (POST)&nbsp;</div></li><li><div>    Output:&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _httpsrequest($url, $URI, $http_method, $content_type=&quot;&quot;, $body=&quot;&quot;)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if($this-&gt;passcookies && $this-&gt;_redirectaddr)&nbsp;</div></li><li><div>            $this-&gt;setcookies();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $headers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $URI_PARTS = parse_url($URI);&nbsp;</div></li><li><div>        if(empty($url))&nbsp;</div></li><li><div>            $url = &quot;/&quot;;&nbsp;</div></li><li><div>        // GET ... header not needed for curl&nbsp;</div></li><li><div>        //$headers[] = $http_method.&quot; &quot;.$url.&quot; &quot;.$this-&gt;_httpversion;&nbsp;</div></li><li><div>        if(!empty($this-&gt;agent))&nbsp;</div></li><li><div>            $headers[] = &quot;User-Agent: &quot;.$this-&gt;agent;&nbsp;</div></li><li><div>        if(!empty($this-&gt;host))&nbsp;</div></li><li><div>            if(!empty($this-&gt;port))&nbsp;</div></li><li><div>                $headers[] = &quot;Host: &quot;.$this-&gt;host.&quot;:&quot;.$this-&gt;port;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $headers[] = &quot;Host: &quot;.$this-&gt;host;&nbsp;</div></li><li><div>        if(!empty($this-&gt;accept))&nbsp;</div></li><li><div>            $headers[] = &quot;Accept: &quot;.$this-&gt;accept;&nbsp;</div></li><li><div>        if(!empty($this-&gt;referer))&nbsp;</div></li><li><div>            $headers[] = &quot;Referer: &quot;.$this-&gt;referer;&nbsp;</div></li><li><div>        if(!empty($this-&gt;cookies))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(!is_array($this-&gt;cookies))&nbsp;</div></li><li><div>                $this-&gt;cookies = (array)$this-&gt;cookies;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            reset($this-&gt;cookies);&nbsp;</div></li><li><div>            if ( count($this-&gt;cookies) &gt; 0 ) {&nbsp;</div></li><li><div>                $cookie_str = 'Cookie: ';&nbsp;</div></li><li><div>                foreach ( $this-&gt;cookies as $cookieKey =&gt; $cookieVal ) {&nbsp;</div></li><li><div>                $cookie_str .= $cookieKey.&quot;=&quot;.urlencode($cookieVal).&quot;; &quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $headers[] = substr($cookie_str, 0, -2);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!empty($this-&gt;rawheaders))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(!is_array($this-&gt;rawheaders))&nbsp;</div></li><li><div>                $this-&gt;rawheaders = (array)$this-&gt;rawheaders;&nbsp;</div></li><li><div>            while(list($headerKey, $headerVal) = each($this-&gt;rawheaders))&nbsp;</div></li><li><div>                $headers[] = $headerKey.&quot;: &quot;.$headerVal;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!empty($content_type)) {&nbsp;</div></li><li><div>            if ($content_type == &quot;multipart/form-data&quot;)&nbsp;</div></li><li><div>                $headers[] = &quot;Content-type: $content_type; boundary=&quot;.$this-&gt;_mime_boundary;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $headers[] = &quot;Content-type: $content_type&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!empty($body))&nbsp;</div></li><li><div>            $headers[] = &quot;Content-length: &quot;.strlen($body);&nbsp;</div></li><li><div>        if(!empty($this-&gt;user) || !empty($this-&gt;pass))&nbsp;</div></li><li><div>            $headers[] = &quot;Authorization: BASIC &quot;.base64_encode($this-&gt;user.&quot;:&quot;.$this-&gt;pass);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $headerfile = tempnam( $this-&gt;temp_dir, &quot;sno&quot; );&nbsp;</div></li><li><div>        $cmdline_params = '-k -D ' . escapeshellarg( $headerfile );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $headers as $header ) {&nbsp;</div></li><li><div>            $cmdline_params .= ' -H ' . escapeshellarg( $header );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $body ) ) {&nbsp;</div></li><li><div>            $cmdline_params .= ' -d ' . escapeshellarg( $body );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;read_timeout &gt; 0 ) {&nbsp;</div></li><li><div>            $cmdline_params .= ' -m ' . escapeshellarg( $this-&gt;read_timeout );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        exec( $this-&gt;curl_path . ' ' . $cmdline_params . ' ' . escapeshellarg( $URI ), $results, $return );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($return)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;error = &quot;Error: cURL could not retrieve the document, error $return.&quot;;&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = implode(&quot;\r\n&quot;, $results);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result_headers = file(&quot;$headerfile&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_redirectaddr = false;&nbsp;</div></li><li><div>        unset($this-&gt;headers);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for($currentHeader = 0; $currentHeader &lt; count($result_headers); $currentHeader++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if a header begins with Location: or URI:, set the redirect&nbsp;</div></li><li><div>            if(preg_match(&quot;/^(Location: |URI: )/i&quot;, $result_headers[$currentHeader]))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // get URL portion of the redirect&nbsp;</div></li><li><div>                preg_match(&quot;/^(Location: |URI:)\s+(.*)/&quot;, chop($result_headers[$currentHeader]), $matches);&nbsp;</div></li><li><div>                // look for :// in the Location header to see if hostname is included&nbsp;</div></li><li><div>                if(!preg_match(&quot;|\:\/\/|&quot;, $matches[2]))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    // no host in the path, so prepend&nbsp;</div></li><li><div>                    $this-&gt;_redirectaddr = $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host.&quot;:&quot;.$this-&gt;port;&nbsp;</div></li><li><div>                    // eliminate double slash&nbsp;</div></li><li><div>                    if(!preg_match(&quot;|^/|&quot;, $matches[2]))&nbsp;</div></li><li><div>                            $this-&gt;_redirectaddr .= &quot;/&quot;.$matches[2];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                            $this-&gt;_redirectaddr .= $matches[2];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;_redirectaddr = $matches[2];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(preg_match(&quot;|^HTTP/|&quot;, $result_headers[$currentHeader]))&nbsp;</div></li><li><div>                $this-&gt;response_code = $result_headers[$currentHeader];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;headers[] = $result_headers[$currentHeader];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check if there is a redirect meta tag&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(preg_match(&quot;'&lt;meta[\s]*http-equiv[^&gt;]*?content[\s]*=[\s]*[\&quot;\']?\d+;[\s]*URL[\s]*=[\s]*([^\&quot;\']*?)[\&quot;\']?&gt;'i&quot;, $results, $match))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;_redirectaddr = $this-&gt;_expandlinks($match[1], $URI);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // have we hit our frame depth and is there frame src to fetch?&nbsp;</div></li><li><div>        if(($this-&gt;_framedepth &lt; $this-&gt;maxframes) && preg_match_all(&quot;'&lt;frame\s+.*src[\s]*=[\'\&quot;]?([^\'\&quot;\&gt;]+)'i&quot;, $results, $match))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;results[] = $results;&nbsp;</div></li><li><div>            for($x=0; $x&lt;count($match[1]); $x++)&nbsp;</div></li><li><div>                $this-&gt;_frameurls[] = $this-&gt;_expandlinks($match[1][$x], $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // have we already fetched framed content?&nbsp;</div></li><li><div>        elseif(is_array($this-&gt;results))&nbsp;</div></li><li><div>            $this-&gt;results[] = $results;&nbsp;</div></li><li><div>        // no framed content&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $this-&gt;results = $results;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unlink(&quot;$headerfile&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    setcookies()&nbsp;</div></li><li><div>    Purpose:    set cookies for a redirection&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setcookies()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        for($x=0; $x&lt;count($this-&gt;headers); $x++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>        if(preg_match('/^set-cookie:[\s]+([^=]+)=([^;]+)/i', $this-&gt;headers[$x], $match))&nbsp;</div></li><li><div>            $this-&gt;cookies[$match[1]] = urldecode($match[2]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _check_timeout&nbsp;</div></li><li><div>    Purpose:    checks whether timeout has occurred&nbsp;</div></li><li><div>    Input:        $fp    file pointer&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _check_timeout($fp)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;read_timeout &gt; 0) {&nbsp;</div></li><li><div>            $fp_status = socket_get_status($fp);&nbsp;</div></li><li><div>            if ($fp_status[&quot;timed_out&quot;]) {&nbsp;</div></li><li><div>                $this-&gt;timed_out = true;&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _connect&nbsp;</div></li><li><div>    Purpose:    make a socket connection&nbsp;</div></li><li><div>    Input:        $fp    file pointer&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _connect(&$fp)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if(!empty($this-&gt;proxy_host) && !empty($this-&gt;proxy_port))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;_isproxy = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $host = $this-&gt;proxy_host;&nbsp;</div></li><li><div>                $port = $this-&gt;proxy_port;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $host = $this-&gt;host;&nbsp;</div></li><li><div>            $port = $this-&gt;port;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;status = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($fp = fsockopen(&nbsp;</div></li><li><div>                    $host, &nbsp;</div></li><li><div>                    $port, &nbsp;</div></li><li><div>                    $errno, &nbsp;</div></li><li><div>                    $errstr, &nbsp;</div></li><li><div>                    $this-&gt;_fp_timeout&nbsp;</div></li><li><div> ))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // socket connection succeeded&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // socket connection failed&nbsp;</div></li><li><div>            $this-&gt;status = $errno;&nbsp;</div></li><li><div>            switch($errno)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                case -3:&nbsp;</div></li><li><div>                    $this-&gt;error=&quot;socket creation failed (-3)&quot;;&nbsp;</div></li><li><div>                case -4:&nbsp;</div></li><li><div>                    $this-&gt;error=&quot;dns lookup failure (-4)&quot;;&nbsp;</div></li><li><div>                case -5:&nbsp;</div></li><li><div>                    $this-&gt;error=&quot;connection refused or timed out (-5)&quot;;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    $this-&gt;error=&quot;connection failed (&quot;.$errno.&quot;)&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _disconnect&nbsp;</div></li><li><div>    Purpose:    disconnect a socket connection&nbsp;</div></li><li><div>    Input:        $fp    file pointer&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _disconnect($fp)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return(fclose($fp));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**======================================================================*\&nbsp;</div></li><li><div>    Function:    _prepare_post_body&nbsp;</div></li><li><div>    Purpose:    Prepare post body according to encoding type&nbsp;</div></li><li><div>    Input:        $formvars  - form variables&nbsp;</div></li><li><div>                $formfiles - form upload files&nbsp;</div></li><li><div>    Output:        post body&nbsp;</div></li><li><div>\*======================================================================*/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _prepare_post_body($formvars, $formfiles)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        settype($formvars, &quot;array&quot;);&nbsp;</div></li><li><div>        settype($formfiles, &quot;array&quot;);&nbsp;</div></li><li><div>        $postdata = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (count($formvars) == 0 && count($formfiles) == 0)&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ($this-&gt;_submit_type) {&nbsp;</div></li><li><div>            case &quot;application/x-www-form-urlencoded&quot;:&nbsp;</div></li><li><div>                reset($formvars);&nbsp;</div></li><li><div>                while(list($key, $val) = each($formvars)) {&nbsp;</div></li><li><div>                    if (is_array($val) || is_object($val)) {&nbsp;</div></li><li><div>                        while (list($cur_key, $cur_val) = each($val)) {&nbsp;</div></li><li><div>                            $postdata .= urlencode($key).&quot;[]=&quot;.urlencode($cur_val).&quot;&&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else&nbsp;</div></li><li><div>                        $postdata .= urlencode($key).&quot;=&quot;.urlencode($val).&quot;&&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case &quot;multipart/form-data&quot;:&nbsp;</div></li><li><div>                $this-&gt;_mime_boundary = &quot;Snoopy&quot;.md5(uniqid(microtime()));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                reset($formvars);&nbsp;</div></li><li><div>                while(list($key, $val) = each($formvars)) {&nbsp;</div></li><li><div>                    if (is_array($val) || is_object($val)) {&nbsp;</div></li><li><div>                        while (list($cur_key, $cur_val) = each($val)) {&nbsp;</div></li><li><div>                            $postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;\r\n&quot;;&nbsp;</div></li><li><div>                            $postdata .= &quot;Content-Disposition: form-data; name=\&quot;$key\[\]\&quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>                            $postdata .= &quot;$cur_val\r\n&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;\r\n&quot;;&nbsp;</div></li><li><div>                        $postdata .= &quot;Content-Disposition: form-data; name=\&quot;$key\&quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>                        $postdata .= &quot;$val\r\n&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                reset($formfiles);&nbsp;</div></li><li><div>                while (list($field_name, $file_names) = each($formfiles)) {&nbsp;</div></li><li><div>                    settype($file_names, &quot;array&quot;);&nbsp;</div></li><li><div>                    while (list(, $file_name) = each($file_names)) {&nbsp;</div></li><li><div>                        if (!is_readable($file_name)) continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $fp = fopen($file_name, &quot;r&quot;);&nbsp;</div></li><li><div>                        $file_content = fread($fp, filesize($file_name));&nbsp;</div></li><li><div>                        fclose($fp);&nbsp;</div></li><li><div>                        $base_name = basename($file_name);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;\r\n&quot;;&nbsp;</div></li><li><div>                        $postdata .= &quot;Content-Disposition: form-data; name=\&quot;$field_name\&quot;; filename=\&quot;$base_name\&quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>                        $postdata .= &quot;$file_content\r\n&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;--\r\n&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $postdata;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.7</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/snoopy/" class="">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/snoopy/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/snoopy/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/snoopy/" class="active">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/snoopy/" class="">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>Snoopy</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>