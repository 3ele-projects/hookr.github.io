<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="wordpress" data-version="4.7.4" data-type="class" data-id="6383"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp_xmlrpc_server | class | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="wp_xmlrpc_server, class, wordpress, 4.7.4" /><meta name="description" content="WordPress XMLRPC server implementation." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=4075a5025b622df971998a7f806462e6' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wp_xmlrpc_server/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwp_xmlrpc_server%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwp_xmlrpc_server%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-class-wp_xmlrpc_server","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp_xmlrpc_server" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/4.7.4/classes/" class=""><span property="name">classes</span></a><meta property="position" content="3"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp_xmlrpc_server</span><meta property="position" content="4"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="active" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>wp_xmlrpc_server</strong></h1><p>WordPress XMLRPC server implementation.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/4.7.4/files/wp-includes-class-wp-xmlrpc-server/" class="file">/wp-includes/class-wp-xmlrpc-server.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="23" class="block" start="23"><li><div>class wp_xmlrpc_server extends IXR_Server {&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Methods.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $methods;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Blog options.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $blog_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * IXR_Error instance.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flags that the user authentication has failed in this instance of wp_xmlrpc_server.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $auth_failed = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Registers all of the XMLRPC methods that XMLRPC server understands.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Sets up server and method property. Passes XMLRPC&nbsp;</div></li><li><div>     * methods through the {@see 'xmlrpc_methods'} filter to allow plugins to extend&nbsp;</div></li><li><div>     * or replace XML-RPC methods.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct() {&nbsp;</div></li><li><div>        $this-&gt;methods = array(&nbsp;</div></li><li><div>            // WordPress API&nbsp;</div></li><li><div>            'wp.getUsersBlogs' =&gt; 'this:wp_getUsersBlogs', &nbsp;</div></li><li><div>            'wp.newPost' =&gt; 'this:wp_newPost', &nbsp;</div></li><li><div>            'wp.editPost' =&gt; 'this:wp_editPost', &nbsp;</div></li><li><div>            'wp.deletePost' =&gt; 'this:wp_deletePost', &nbsp;</div></li><li><div>            'wp.getPost' =&gt; 'this:wp_getPost', &nbsp;</div></li><li><div>            'wp.getPosts' =&gt; 'this:wp_getPosts', &nbsp;</div></li><li><div>            'wp.newTerm' =&gt; 'this:wp_newTerm', &nbsp;</div></li><li><div>            'wp.editTerm' =&gt; 'this:wp_editTerm', &nbsp;</div></li><li><div>            'wp.deleteTerm' =&gt; 'this:wp_deleteTerm', &nbsp;</div></li><li><div>            'wp.getTerm' =&gt; 'this:wp_getTerm', &nbsp;</div></li><li><div>            'wp.getTerms' =&gt; 'this:wp_getTerms', &nbsp;</div></li><li><div>            'wp.getTaxonomy' =&gt; 'this:wp_getTaxonomy', &nbsp;</div></li><li><div>            'wp.getTaxonomies' =&gt; 'this:wp_getTaxonomies', &nbsp;</div></li><li><div>            'wp.getUser' =&gt; 'this:wp_getUser', &nbsp;</div></li><li><div>            'wp.getUsers' =&gt; 'this:wp_getUsers', &nbsp;</div></li><li><div>            'wp.getProfile' =&gt; 'this:wp_getProfile', &nbsp;</div></li><li><div>            'wp.editProfile' =&gt; 'this:wp_editProfile', &nbsp;</div></li><li><div>            'wp.getPage' =&gt; 'this:wp_getPage', &nbsp;</div></li><li><div>            'wp.getPages' =&gt; 'this:wp_getPages', &nbsp;</div></li><li><div>            'wp.newPage' =&gt; 'this:wp_newPage', &nbsp;</div></li><li><div>            'wp.deletePage' =&gt; 'this:wp_deletePage', &nbsp;</div></li><li><div>            'wp.editPage' =&gt; 'this:wp_editPage', &nbsp;</div></li><li><div>            'wp.getPageList' =&gt; 'this:wp_getPageList', &nbsp;</div></li><li><div>            'wp.getAuthors' =&gt; 'this:wp_getAuthors', &nbsp;</div></li><li><div>            'wp.getCategories' =&gt; 'this:mw_getCategories', // Alias&nbsp;</div></li><li><div>            'wp.getTags' =&gt; 'this:wp_getTags', &nbsp;</div></li><li><div>            'wp.newCategory' =&gt; 'this:wp_newCategory', &nbsp;</div></li><li><div>            'wp.deleteCategory' =&gt; 'this:wp_deleteCategory', &nbsp;</div></li><li><div>            'wp.suggestCategories' =&gt; 'this:wp_suggestCategories', &nbsp;</div></li><li><div>            'wp.uploadFile' =&gt; 'this:mw_newMediaObject', // Alias&nbsp;</div></li><li><div>            'wp.deleteFile' =&gt; 'this:wp_deletePost', // Alias&nbsp;</div></li><li><div>            'wp.getCommentCount' =&gt; 'this:wp_getCommentCount', &nbsp;</div></li><li><div>            'wp.getPostStatusList' =&gt; 'this:wp_getPostStatusList', &nbsp;</div></li><li><div>            'wp.getPageStatusList' =&gt; 'this:wp_getPageStatusList', &nbsp;</div></li><li><div>            'wp.getPageTemplates' =&gt; 'this:wp_getPageTemplates', &nbsp;</div></li><li><div>            'wp.getOptions' =&gt; 'this:wp_getOptions', &nbsp;</div></li><li><div>            'wp.setOptions' =&gt; 'this:wp_setOptions', &nbsp;</div></li><li><div>            'wp.getComment' =&gt; 'this:wp_getComment', &nbsp;</div></li><li><div>            'wp.getComments' =&gt; 'this:wp_getComments', &nbsp;</div></li><li><div>            'wp.deleteComment' =&gt; 'this:wp_deleteComment', &nbsp;</div></li><li><div>            'wp.editComment' =&gt; 'this:wp_editComment', &nbsp;</div></li><li><div>            'wp.newComment' =&gt; 'this:wp_newComment', &nbsp;</div></li><li><div>            'wp.getCommentStatusList' =&gt; 'this:wp_getCommentStatusList', &nbsp;</div></li><li><div>            'wp.getMediaItem' =&gt; 'this:wp_getMediaItem', &nbsp;</div></li><li><div>            'wp.getMediaLibrary' =&gt; 'this:wp_getMediaLibrary', &nbsp;</div></li><li><div>            'wp.getPostFormats' =&gt; 'this:wp_getPostFormats', &nbsp;</div></li><li><div>            'wp.getPostType' =&gt; 'this:wp_getPostType', &nbsp;</div></li><li><div>            'wp.getPostTypes' =&gt; 'this:wp_getPostTypes', &nbsp;</div></li><li><div>            'wp.getRevisions' =&gt; 'this:wp_getRevisions', &nbsp;</div></li><li><div>            'wp.restoreRevision' =&gt; 'this:wp_restoreRevision', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Blogger API&nbsp;</div></li><li><div>            'blogger.getUsersBlogs' =&gt; 'this:blogger_getUsersBlogs', &nbsp;</div></li><li><div>            'blogger.getUserInfo' =&gt; 'this:blogger_getUserInfo', &nbsp;</div></li><li><div>            'blogger.getPost' =&gt; 'this:blogger_getPost', &nbsp;</div></li><li><div>            'blogger.getRecentPosts' =&gt; 'this:blogger_getRecentPosts', &nbsp;</div></li><li><div>            'blogger.newPost' =&gt; 'this:blogger_newPost', &nbsp;</div></li><li><div>            'blogger.editPost' =&gt; 'this:blogger_editPost', &nbsp;</div></li><li><div>            'blogger.deletePost' =&gt; 'this:blogger_deletePost', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // MetaWeblog API (with MT extensions to structs)&nbsp;</div></li><li><div>            'metaWeblog.newPost' =&gt; 'this:mw_newPost', &nbsp;</div></li><li><div>            'metaWeblog.editPost' =&gt; 'this:mw_editPost', &nbsp;</div></li><li><div>            'metaWeblog.getPost' =&gt; 'this:mw_getPost', &nbsp;</div></li><li><div>            'metaWeblog.getRecentPosts' =&gt; 'this:mw_getRecentPosts', &nbsp;</div></li><li><div>            'metaWeblog.getCategories' =&gt; 'this:mw_getCategories', &nbsp;</div></li><li><div>            'metaWeblog.newMediaObject' =&gt; 'this:mw_newMediaObject', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // MetaWeblog API aliases for Blogger API&nbsp;</div></li><li><div>            // see http://www.xmlrpc.com/stories/storyReader$2460&nbsp;</div></li><li><div>            'metaWeblog.deletePost' =&gt; 'this:blogger_deletePost', &nbsp;</div></li><li><div>            'metaWeblog.getUsersBlogs' =&gt; 'this:blogger_getUsersBlogs', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // MovableType API&nbsp;</div></li><li><div>            'mt.getCategoryList' =&gt; 'this:mt_getCategoryList', &nbsp;</div></li><li><div>            'mt.getRecentPostTitles' =&gt; 'this:mt_getRecentPostTitles', &nbsp;</div></li><li><div>            'mt.getPostCategories' =&gt; 'this:mt_getPostCategories', &nbsp;</div></li><li><div>            'mt.setPostCategories' =&gt; 'this:mt_setPostCategories', &nbsp;</div></li><li><div>            'mt.supportedMethods' =&gt; 'this:mt_supportedMethods', &nbsp;</div></li><li><div>            'mt.supportedTextFilters' =&gt; 'this:mt_supportedTextFilters', &nbsp;</div></li><li><div>            'mt.getTrackbackPings' =&gt; 'this:mt_getTrackbackPings', &nbsp;</div></li><li><div>            'mt.publishPost' =&gt; 'this:mt_publishPost', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // PingBack&nbsp;</div></li><li><div>            'pingback.ping' =&gt; 'this:pingback_ping', &nbsp;</div></li><li><div>            'pingback.extensions.getPingbacks' =&gt; 'this:pingback_extensions_getPingbacks', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'demo.sayHello' =&gt; 'this:sayHello', &nbsp;</div></li><li><div>            'demo.addTwoNumbers' =&gt; 'this:addTwoNumbers'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;initialise_blog_option_info();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the methods exposed by the XML-RPC server.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * This filter can be used to add new methods, and remove built-in methods.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $methods An array of XML-RPC methods.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $this-&gt;methods = apply_filters( 'xmlrpc_methods', $this-&gt;methods );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Make private/protected methods readable for backward compatibility.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.0.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param callable $name      Method to call.&nbsp;</div></li><li><div>     * @param array    $arguments Arguments to pass when calling.&nbsp;</div></li><li><div>     * @return array|IXR_Error|false Return value of the callback, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __call( $name, $arguments ) {&nbsp;</div></li><li><div>        if ( '_multisite_getUsersBlogs' === $name ) {&nbsp;</div></li><li><div>            return call_user_func_array( array( $this, $name ), $arguments );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Serves the XML-RPC request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.9.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function serve_request() {&nbsp;</div></li><li><div>        $this-&gt;IXR_Server($this-&gt;methods);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Test XMLRPC API by saying, &quot;Hello!&quot; to client.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Hello string response.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function sayHello() {&nbsp;</div></li><li><div>        return 'Hello!';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Test XMLRPC API by adding two numbers for client.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int $number1 A number to add.&nbsp;</div></li><li><div>     *     @type int $number2 A second number to add.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int Sum of the two given numbers.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function addTwoNumbers( $args ) {&nbsp;</div></li><li><div>        $number1 = $args[0];&nbsp;</div></li><li><div>        $number2 = $args[1];&nbsp;</div></li><li><div>        return $number1 + $number2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Log user in.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.8.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $username User's username.&nbsp;</div></li><li><div>     * @param string $password User's password.&nbsp;</div></li><li><div>     * @return WP_User|bool WP_User object if authentication passed, false otherwise&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function login( $username, $password ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Respect old get_option() filters left for back-compat when the 'enable_xmlrpc'&nbsp;</div></li><li><div>         * option was deprecated in 3.5.0. Use the 'xmlrpc_enabled' hook instead.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $enabled = apply_filters( 'pre_option_enable_xmlrpc', false );&nbsp;</div></li><li><div>        if ( false === $enabled ) {&nbsp;</div></li><li><div>            $enabled = apply_filters( 'option_enable_xmlrpc', true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether XML-RPC methods requiring authentication are enabled.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Contrary to the way it's named, this filter does not control whether XML-RPC is *fully*&nbsp;</div></li><li><div>         * enabled, rather, it only controls whether XML-RPC methods requiring authentication - such&nbsp;</div></li><li><div>         * as for publishing purposes - are enabled.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Further, the filter does not control whether pingbacks or other custom endpoints that don't&nbsp;</div></li><li><div>         * require authentication are enabled. This behavior is expected, and due to how parity was matched&nbsp;</div></li><li><div>         * with the `enable_xmlrpc` UI option the filter replaced when it was introduced in 3.5.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * To disable XML-RPC methods that require authentication, use:&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         *     add_filter( 'xmlrpc_enabled', '__return_false' );&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * For more granular control over all XML-RPC methods and requests, see the {@see 'xmlrpc_methods'}&nbsp;</div></li><li><div>         * and {@see 'xmlrpc_element_limit'} hooks.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool $enabled Whether XML-RPC is enabled. Default true.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $enabled = apply_filters( 'xmlrpc_enabled', $enabled );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $enabled ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 405, sprintf( __( 'XML-RPC services are disabled on this site.' ) ) );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;auth_failed ) {&nbsp;</div></li><li><div>            $user = new WP_Error( 'login_prevented' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $user = wp_authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $user ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'Incorrect username or password.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Flag that authentication has failed once on this wp_xmlrpc_server instance&nbsp;</div></li><li><div>            $this-&gt;auth_failed = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters the XML-RPC user login error message.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.5.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param string  $error The XML-RPC error message.&nbsp;</div></li><li><div>             * @param WP_User $user  WP_User object.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $this-&gt;error = apply_filters( 'xmlrpc_login_error', $this-&gt;error, $user );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_set_current_user( $user-&gt;ID );&nbsp;</div></li><li><div>        return $user;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check user's credentials. Deprecated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     * @deprecated 2.8.0 Use wp_xmlrpc_server::login()&nbsp;</div></li><li><div>     * @see wp_xmlrpc_server::login()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $username User's username.&nbsp;</div></li><li><div>     * @param string $password User's password.&nbsp;</div></li><li><div>     * @return bool Whether authentication passed.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function login_pass_ok( $username, $password ) {&nbsp;</div></li><li><div>        return (bool) $this-&gt;login( $username, $password );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Escape string or array of strings for database.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.2&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $data Escape single string or array of strings.&nbsp;</div></li><li><div>     * @return string|void Returns with string is passed, alters by-reference&nbsp;</div></li><li><div>     *                     when array is passed.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function escape( &$data ) {&nbsp;</div></li><li><div>        if ( ! is_array( $data ) )&nbsp;</div></li><li><div>            return wp_slash( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $data as &$v ) {&nbsp;</div></li><li><div>            if ( is_array( $v ) )&nbsp;</div></li><li><div>                $this-&gt;escape( $v );&nbsp;</div></li><li><div>            elseif ( ! is_object( $v ) )&nbsp;</div></li><li><div>                $v = wp_slash( $v );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve custom fields for post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $post_id Post ID.&nbsp;</div></li><li><div>     * @return array Custom fields, if exist.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_custom_fields($post_id) {&nbsp;</div></li><li><div>        $post_id = (int) $post_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $custom_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( (array) has_meta($post_id) as $meta ) {&nbsp;</div></li><li><div>            // Don't expose protected fields.&nbsp;</div></li><li><div>            if ( ! current_user_can( 'edit_post_meta', $post_id , $meta['meta_key'] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $custom_fields[] = array(&nbsp;</div></li><li><div>                &quot;id&quot; =&gt; $meta['meta_id'], &nbsp;</div></li><li><div>                &quot;key&quot; =&gt; $meta['meta_key'], &nbsp;</div></li><li><div>                &quot;value&quot; =&gt; $meta['meta_value']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $custom_fields;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set custom fields for post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $post_id Post ID.&nbsp;</div></li><li><div>     * @param array $fields Custom fields.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_custom_fields($post_id, $fields) {&nbsp;</div></li><li><div>        $post_id = (int) $post_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( (array) $fields as $meta ) {&nbsp;</div></li><li><div>            if ( isset($meta['id']) ) {&nbsp;</div></li><li><div>                $meta['id'] = (int) $meta['id'];&nbsp;</div></li><li><div>                $pmeta = get_metadata_by_mid( 'post', $meta['id'] );&nbsp;</div></li><li><div>                if ( isset($meta['key']) ) {&nbsp;</div></li><li><div>                    $meta['key'] = wp_unslash( $meta['key'] );&nbsp;</div></li><li><div>                    if ( $meta['key'] !== $pmeta-&gt;meta_key )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    $meta['value'] = wp_unslash( $meta['value'] );&nbsp;</div></li><li><div>                    if ( current_user_can( 'edit_post_meta', $post_id, $meta['key'] ) )&nbsp;</div></li><li><div>                        update_metadata_by_mid( 'post', $meta['id'], $meta['value'] );&nbsp;</div></li><li><div>                } elseif ( current_user_can( 'delete_post_meta', $post_id, $pmeta-&gt;meta_key ) ) {&nbsp;</div></li><li><div>                    delete_metadata_by_mid( 'post', $meta['id'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } elseif ( current_user_can( 'add_post_meta', $post_id, wp_unslash( $meta['key'] ) ) ) {&nbsp;</div></li><li><div>                add_post_meta( $post_id, $meta['key'], $meta['value'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set up blog options property.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Passes property through {@see 'xmlrpc_blog_options'} filter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function initialise_blog_option_info() {&nbsp;</div></li><li><div>        $this-&gt;blog_options = array(&nbsp;</div></li><li><div>            // Read only options&nbsp;</div></li><li><div>            'software_name' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Software Name' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'value' =&gt; 'WordPress'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'software_version' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Software Version' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'value' =&gt; get_bloginfo( 'version' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'blog_url' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'WordPress Address (URL)' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'siteurl'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'home_url' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Site Address (URL)' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'home'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'login_url' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Login Address (URL)' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'value' =&gt; wp_login_url( )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'admin_url' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'The URL to the admin area' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'value' =&gt; get_admin_url( )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'image_default_link_type' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Image default link type' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'image_default_link_type'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'image_default_size' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Image default size' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'image_default_size'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'image_default_align' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Image default align' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'image_default_align'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'template' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Template' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'template'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'stylesheet' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Stylesheet' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'stylesheet'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'post_thumbnail' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __('Post Thumbnail'), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'value' =&gt; current_theme_supports( 'post-thumbnails' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Updatable options&nbsp;</div></li><li><div>            'time_zone' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Time Zone' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'gmt_offset'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'blog_title' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Site Title' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'blogname'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'blog_tagline' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Site Tagline' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'blogdescription'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'date_format' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Date Format' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'date_format'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'time_format' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Time Format' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'time_format'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'users_can_register' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Allow new users to sign up' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'users_can_register'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'thumbnail_size_w' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Thumbnail Width' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'thumbnail_size_w'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'thumbnail_size_h' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Thumbnail Height' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'thumbnail_size_h'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'thumbnail_crop' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Crop thumbnail to exact dimensions' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'thumbnail_crop'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'medium_size_w' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Medium size image width' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'medium_size_w'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'medium_size_h' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Medium size image height' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'medium_size_h'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'medium_large_size_w' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Medium-Large size image width' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'medium_large_size_w'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'medium_large_size_h' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Medium-Large size image height' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'medium_large_size_h'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'large_size_w' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Large size image width' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'large_size_w'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'large_size_h' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Large size image height' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'large_size_h'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'default_comment_status' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Allow people to post comments on new articles' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'default_comment_status'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'default_ping_status' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Allow link notifications from other blogs (pingbacks and trackbacks) on new articles' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'default_ping_status'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the XML-RPC blog options property.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.6.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $blog_options An array of XML-RPC blog options.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $this-&gt;blog_options = apply_filters( 'xmlrpc_blog_options', $this-&gt;blog_options );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the blogs of the user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Array contains:&nbsp;</div></li><li><div>     *  - 'isAdmin'&nbsp;</div></li><li><div>     *  - 'isPrimary' - whether the blog is the user's primary blog&nbsp;</div></li><li><div>     *  - 'url'&nbsp;</div></li><li><div>     *  - 'blogid'&nbsp;</div></li><li><div>     *  - 'blogName'&nbsp;</div></li><li><div>     *  - 'xmlrpc' - url of xmlrpc endpoint&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getUsersBlogs( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 2 ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If this isn't on WPMU then just use blogger_getUsersBlogs&nbsp;</div></li><li><div>        if ( !is_multisite() ) {&nbsp;</div></li><li><div>            array_unshift( $args, 1 );&nbsp;</div></li><li><div>            return $this-&gt;blogger_getUsersBlogs( $args );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after the XML-RPC user has been authenticated but before the rest of&nbsp;</div></li><li><div>         * the method logic begins.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * All built-in XML-RPC methods use the action xmlrpc_call, with a parameter&nbsp;</div></li><li><div>         * equal to the method's name, e.g., wp.getUsersBlogs, wp.newPost, etc.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param string $name The method name.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getUsersBlogs' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $blogs = (array) get_blogs_of_user( $user-&gt;ID );&nbsp;</div></li><li><div>        $struct = array();&nbsp;</div></li><li><div>        $primary_blog_id = 0;&nbsp;</div></li><li><div>        $active_blog = get_active_blog_for_user( $user-&gt;ID );&nbsp;</div></li><li><div>        if ( $active_blog ) {&nbsp;</div></li><li><div>            $primary_blog_id = (int) $active_blog-&gt;blog_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $blogs as $blog ) {&nbsp;</div></li><li><div>            // Don't include blogs that aren't hosted at this site.&nbsp;</div></li><li><div>            if ( $blog-&gt;site_id != get_current_network_id() )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $blog_id = $blog-&gt;userblog_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch_to_blog( $blog_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $is_admin = current_user_can( 'manage_options' );&nbsp;</div></li><li><div>            $is_primary = ( (int) $blog_id === $primary_blog_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $struct[] = array(&nbsp;</div></li><li><div>                'isAdmin' =&gt; $is_admin, &nbsp;</div></li><li><div>                'isPrimary' =&gt; $is_primary, &nbsp;</div></li><li><div>                'url' =&gt; home_url( '/' ), &nbsp;</div></li><li><div>                'blogid' =&gt; (string) $blog_id, &nbsp;</div></li><li><div>                'blogName' =&gt; get_option( 'blogname' ), &nbsp;</div></li><li><div>                'xmlrpc' =&gt; site_url( 'xmlrpc.php', 'rpc' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            restore_current_blog();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if the method received at least the minimum number of arguments.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $args Sanitize single string or array of strings.&nbsp;</div></li><li><div>     * @param int $count         Minimum number of arguments.&nbsp;</div></li><li><div>     * @return bool if `$args` contains at least $count arguments.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function minimum_args( $args, $count ) {&nbsp;</div></li><li><div>        if ( count( $args ) &lt; $count ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'Insufficient arguments passed to this XML-RPC method.' ) );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares taxonomy data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $taxonomy The unprepared taxonomy data.&nbsp;</div></li><li><div>     * @param array $fields    The subset of taxonomy fields to return.&nbsp;</div></li><li><div>     * @return array The prepared taxonomy data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_taxonomy( $taxonomy, $fields ) {&nbsp;</div></li><li><div>        $_taxonomy = array(&nbsp;</div></li><li><div>            'name' =&gt; $taxonomy-&gt;name, &nbsp;</div></li><li><div>            'label' =&gt; $taxonomy-&gt;label, &nbsp;</div></li><li><div>            'hierarchical' =&gt; (bool) $taxonomy-&gt;hierarchical, &nbsp;</div></li><li><div>            'public' =&gt; (bool) $taxonomy-&gt;public, &nbsp;</div></li><li><div>            'show_ui' =&gt; (bool) $taxonomy-&gt;show_ui, &nbsp;</div></li><li><div>            '_builtin' =&gt; (bool) $taxonomy-&gt;_builtin, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'labels', $fields ) )&nbsp;</div></li><li><div>            $_taxonomy['labels'] = (array) $taxonomy-&gt;labels;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'cap', $fields ) )&nbsp;</div></li><li><div>            $_taxonomy['cap'] = (array) $taxonomy-&gt;cap;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'menu', $fields ) )&nbsp;</div></li><li><div>            $_taxonomy['show_in_menu'] = (bool) $_taxonomy-&gt;show_in_menu;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'object_type', $fields ) )&nbsp;</div></li><li><div>            $_taxonomy['object_type'] = array_unique( (array) $taxonomy-&gt;object_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared data for the given taxonomy.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array       $_taxonomy An array of taxonomy data.&nbsp;</div></li><li><div>         * @param WP_Taxonomy $taxonomy  Taxonomy object.&nbsp;</div></li><li><div>         * @param array       $fields    The subset of taxonomy fields to return.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_taxonomy', $_taxonomy, $taxonomy, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares term data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $term The unprepared term data.&nbsp;</div></li><li><div>     * @return array The prepared term data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_term( $term ) {&nbsp;</div></li><li><div>        $_term = $term;&nbsp;</div></li><li><div>        if ( ! is_array( $_term ) )&nbsp;</div></li><li><div>            $_term = get_object_vars( $_term );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // For integers which may be larger than XML-RPC supports ensure we return strings.&nbsp;</div></li><li><div>        $_term['term_id'] = strval( $_term['term_id'] );&nbsp;</div></li><li><div>        $_term['term_group'] = strval( $_term['term_group'] );&nbsp;</div></li><li><div>        $_term['term_taxonomy_id'] = strval( $_term['term_taxonomy_id'] );&nbsp;</div></li><li><div>        $_term['parent'] = strval( $_term['parent'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Count we are happy to return as an integer because people really shouldn't use terms that much.&nbsp;</div></li><li><div>        $_term['count'] = intval( $_term['count'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared data for the given term.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array        $_term An array of term data.&nbsp;</div></li><li><div>         * @param array|object $term  Term object or array.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_term', $_term, $term );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert a WordPress date string to an IXR_Date object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $date Date string to convert.&nbsp;</div></li><li><div>     * @return IXR_Date IXR_Date object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _convert_date( $date ) {&nbsp;</div></li><li><div>        if ( $date === '0000-00-00 00:00:00' ) {&nbsp;</div></li><li><div>            return new IXR_Date( '00000000T00:00:00Z' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return new IXR_Date( mysql2date( 'Ymd\TH:i:s', $date, false ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert a WordPress GMT date string to an IXR_Date object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $date_gmt WordPress GMT date string.&nbsp;</div></li><li><div>     * @param string $date     Date string.&nbsp;</div></li><li><div>     * @return IXR_Date IXR_Date object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _convert_date_gmt( $date_gmt, $date ) {&nbsp;</div></li><li><div>        if ( $date !== '0000-00-00 00:00:00' && $date_gmt === '0000-00-00 00:00:00' ) {&nbsp;</div></li><li><div>            return new IXR_Date( get_gmt_from_date( mysql2date( 'Y-m-d H:i:s', $date, false ), 'Ymd\TH:i:s' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $this-&gt;_convert_date( $date_gmt );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares post data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $post   The unprepared post data.&nbsp;</div></li><li><div>     * @param array $fields The subset of post type fields to return.&nbsp;</div></li><li><div>     * @return array The prepared post data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_post( $post, $fields ) {&nbsp;</div></li><li><div>        // Holds the data for this post. built up based on $fields.&nbsp;</div></li><li><div>        $_post = array( 'post_id' =&gt; strval( $post['ID'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Prepare common post fields.&nbsp;</div></li><li><div>        $post_fields = array(&nbsp;</div></li><li><div>            'post_title' =&gt; $post['post_title'], &nbsp;</div></li><li><div>            'post_date' =&gt; $this-&gt;_convert_date( $post['post_date'] ), &nbsp;</div></li><li><div>            'post_date_gmt' =&gt; $this-&gt;_convert_date_gmt( $post['post_date_gmt'], $post['post_date'] ), &nbsp;</div></li><li><div>            'post_modified' =&gt; $this-&gt;_convert_date( $post['post_modified'] ), &nbsp;</div></li><li><div>            'post_modified_gmt' =&gt; $this-&gt;_convert_date_gmt( $post['post_modified_gmt'], $post['post_modified'] ), &nbsp;</div></li><li><div>            'post_status' =&gt; $post['post_status'], &nbsp;</div></li><li><div>            'post_type' =&gt; $post['post_type'], &nbsp;</div></li><li><div>            'post_name' =&gt; $post['post_name'], &nbsp;</div></li><li><div>            'post_author' =&gt; $post['post_author'], &nbsp;</div></li><li><div>            'post_password' =&gt; $post['post_password'], &nbsp;</div></li><li><div>            'post_excerpt' =&gt; $post['post_excerpt'], &nbsp;</div></li><li><div>            'post_content' =&gt; $post['post_content'], &nbsp;</div></li><li><div>            'post_parent' =&gt; strval( $post['post_parent'] ), &nbsp;</div></li><li><div>            'post_mime_type' =&gt; $post['post_mime_type'], &nbsp;</div></li><li><div>            'link' =&gt; get_permalink( $post['ID'] ), &nbsp;</div></li><li><div>            'guid' =&gt; $post['guid'], &nbsp;</div></li><li><div>            'menu_order' =&gt; intval( $post['menu_order'] ), &nbsp;</div></li><li><div>            'comment_status' =&gt; $post['comment_status'], &nbsp;</div></li><li><div>            'ping_status' =&gt; $post['ping_status'], &nbsp;</div></li><li><div>            'sticky' =&gt; ( $post['post_type'] === 'post' && is_sticky( $post['ID'] ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Thumbnail.&nbsp;</div></li><li><div>        $post_fields['post_thumbnail'] = array();&nbsp;</div></li><li><div>        $thumbnail_id = get_post_thumbnail_id( $post['ID'] );&nbsp;</div></li><li><div>        if ( $thumbnail_id ) {&nbsp;</div></li><li><div>            $thumbnail_size = current_theme_supports('post-thumbnail') ? 'post-thumbnail' : 'thumbnail';&nbsp;</div></li><li><div>            $post_fields['post_thumbnail'] = $this-&gt;_prepare_media_item( get_post( $thumbnail_id ), $thumbnail_size );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Consider future posts as published.&nbsp;</div></li><li><div>        if ( $post_fields['post_status'] === 'future' )&nbsp;</div></li><li><div>            $post_fields['post_status'] = 'publish';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fill in blank post format.&nbsp;</div></li><li><div>        $post_fields['post_format'] = get_post_format( $post['ID'] );&nbsp;</div></li><li><div>        if ( empty( $post_fields['post_format'] ) )&nbsp;</div></li><li><div>            $post_fields['post_format'] = 'standard';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Merge requested $post_fields fields into $_post.&nbsp;</div></li><li><div>        if ( in_array( 'post', $fields ) ) {&nbsp;</div></li><li><div>            $_post = array_merge( $_post, $post_fields );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $requested_fields = array_intersect_key( $post_fields, array_flip( $fields ) );&nbsp;</div></li><li><div>            $_post = array_merge( $_post, $requested_fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $all_taxonomy_fields = in_array( 'taxonomies', $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $all_taxonomy_fields || in_array( 'terms', $fields ) ) {&nbsp;</div></li><li><div>            $post_type_taxonomies = get_object_taxonomies( $post['post_type'], 'names' );&nbsp;</div></li><li><div>            $terms = wp_get_object_terms( $post['ID'], $post_type_taxonomies );&nbsp;</div></li><li><div>            $_post['terms'] = array();&nbsp;</div></li><li><div>            foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                $_post['terms'][] = $this-&gt;_prepare_term( $term );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'custom_fields', $fields ) )&nbsp;</div></li><li><div>            $_post['custom_fields'] = $this-&gt;get_custom_fields( $post['ID'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'enclosure', $fields ) ) {&nbsp;</div></li><li><div>            $_post['enclosure'] = array();&nbsp;</div></li><li><div>            $enclosures = (array) get_post_meta( $post['ID'], 'enclosure' );&nbsp;</div></li><li><div>            if ( ! empty( $enclosures ) ) {&nbsp;</div></li><li><div>                $encdata = explode( &quot;\n&quot;, $enclosures[0] );&nbsp;</div></li><li><div>                $_post['enclosure']['url'] = trim( htmlspecialchars( $encdata[0] ) );&nbsp;</div></li><li><div>                $_post['enclosure']['length'] = (int) trim( $encdata[1] );&nbsp;</div></li><li><div>                $_post['enclosure']['type'] = trim( $encdata[2] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared date for the given post.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $_post  An array of modified post data.&nbsp;</div></li><li><div>         * @param array $post   An array of post data.&nbsp;</div></li><li><div>         * @param array $fields An array of post fields.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_post', $_post, $post, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares post data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @since 4.6.0 Converted the `$post_type` parameter to accept a WP_Post_Type object.&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_Post_Type $post_type Post type object.&nbsp;</div></li><li><div>     * @param array        $fields    The subset of post fields to return.&nbsp;</div></li><li><div>     * @return array The prepared post type data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_post_type( $post_type, $fields ) {&nbsp;</div></li><li><div>        $_post_type = array(&nbsp;</div></li><li><div>            'name' =&gt; $post_type-&gt;name, &nbsp;</div></li><li><div>            'label' =&gt; $post_type-&gt;label, &nbsp;</div></li><li><div>            'hierarchical' =&gt; (bool) $post_type-&gt;hierarchical, &nbsp;</div></li><li><div>            'public' =&gt; (bool) $post_type-&gt;public, &nbsp;</div></li><li><div>            'show_ui' =&gt; (bool) $post_type-&gt;show_ui, &nbsp;</div></li><li><div>            '_builtin' =&gt; (bool) $post_type-&gt;_builtin, &nbsp;</div></li><li><div>            'has_archive' =&gt; (bool) $post_type-&gt;has_archive, &nbsp;</div></li><li><div>            'supports' =&gt; get_all_post_type_supports( $post_type-&gt;name ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'labels', $fields ) ) {&nbsp;</div></li><li><div>            $_post_type['labels'] = (array) $post_type-&gt;labels;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'cap', $fields ) ) {&nbsp;</div></li><li><div>            $_post_type['cap'] = (array) $post_type-&gt;cap;&nbsp;</div></li><li><div>            $_post_type['map_meta_cap'] = (bool) $post_type-&gt;map_meta_cap;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'menu', $fields ) ) {&nbsp;</div></li><li><div>            $_post_type['menu_position'] = (int) $post_type-&gt;menu_position;&nbsp;</div></li><li><div>            $_post_type['menu_icon'] = $post_type-&gt;menu_icon;&nbsp;</div></li><li><div>            $_post_type['show_in_menu'] = (bool) $post_type-&gt;show_in_menu;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'taxonomies', $fields ) )&nbsp;</div></li><li><div>            $_post_type['taxonomies'] = get_object_taxonomies( $post_type-&gt;name, 'names' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared date for the given post type.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         * @since 4.6.0 Converted the `$post_type` parameter to accept a WP_Post_Type object.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array        $_post_type An array of post type data.&nbsp;</div></li><li><div>         * @param WP_Post_Type $post_type  Post type object.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_post_type', $_post_type, $post_type );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares media item data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $media_item     The unprepared media item data.&nbsp;</div></li><li><div>     * @param string $thumbnail_size The image size to use for the thumbnail URL.&nbsp;</div></li><li><div>     * @return array The prepared media item data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_media_item( $media_item, $thumbnail_size = 'thumbnail' ) {&nbsp;</div></li><li><div>        $_media_item = array(&nbsp;</div></li><li><div>            'attachment_id' =&gt; strval( $media_item-&gt;ID ), &nbsp;</div></li><li><div>            'date_created_gmt' =&gt; $this-&gt;_convert_date_gmt( $media_item-&gt;post_date_gmt, $media_item-&gt;post_date ), &nbsp;</div></li><li><div>            'parent' =&gt; $media_item-&gt;post_parent, &nbsp;</div></li><li><div>            'link' =&gt; wp_get_attachment_url( $media_item-&gt;ID ), &nbsp;</div></li><li><div>            'title' =&gt; $media_item-&gt;post_title, &nbsp;</div></li><li><div>            'caption' =&gt; $media_item-&gt;post_excerpt, &nbsp;</div></li><li><div>            'description' =&gt; $media_item-&gt;post_content, &nbsp;</div></li><li><div>            'metadata' =&gt; wp_get_attachment_metadata( $media_item-&gt;ID ), &nbsp;</div></li><li><div>            'type' =&gt; $media_item-&gt;post_mime_type&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $thumbnail_src = image_downsize( $media_item-&gt;ID, $thumbnail_size );&nbsp;</div></li><li><div>        if ( $thumbnail_src )&nbsp;</div></li><li><div>            $_media_item['thumbnail'] = $thumbnail_src[0];&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $_media_item['thumbnail'] = $_media_item['link'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared data for the given media item.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array  $_media_item    An array of media item data.&nbsp;</div></li><li><div>         * @param object $media_item     Media item object.&nbsp;</div></li><li><div>         * @param string $thumbnail_size Image size.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_media_item', $_media_item, $media_item, $thumbnail_size );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares page data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $page The unprepared page data.&nbsp;</div></li><li><div>     * @return array The prepared page data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_page( $page ) {&nbsp;</div></li><li><div>        // Get all of the page content and link.&nbsp;</div></li><li><div>        $full_page = get_extended( $page-&gt;post_content );&nbsp;</div></li><li><div>        $link = get_permalink( $page-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get info the page parent if there is one.&nbsp;</div></li><li><div>        $parent_title = &quot;&quot;;&nbsp;</div></li><li><div>        if ( ! empty( $page-&gt;post_parent ) ) {&nbsp;</div></li><li><div>            $parent = get_post( $page-&gt;post_parent );&nbsp;</div></li><li><div>            $parent_title = $parent-&gt;post_title;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Determine comment and ping settings.&nbsp;</div></li><li><div>        $allow_comments = comments_open( $page-&gt;ID ) ? 1 : 0;&nbsp;</div></li><li><div>        $allow_pings = pings_open( $page-&gt;ID ) ? 1 : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Format page date.&nbsp;</div></li><li><div>        $page_date = $this-&gt;_convert_date( $page-&gt;post_date );&nbsp;</div></li><li><div>        $page_date_gmt = $this-&gt;_convert_date_gmt( $page-&gt;post_date_gmt, $page-&gt;post_date );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Pull the categories info together.&nbsp;</div></li><li><div>        $categories = array();&nbsp;</div></li><li><div>        if ( is_object_in_taxonomy( 'page', 'category' ) ) {&nbsp;</div></li><li><div>            foreach ( wp_get_post_categories( $page-&gt;ID ) as $cat_id ) {&nbsp;</div></li><li><div>                $categories[] = get_cat_name( $cat_id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the author info.&nbsp;</div></li><li><div>        $author = get_userdata( $page-&gt;post_author );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $page_template = get_page_template_slug( $page-&gt;ID );&nbsp;</div></li><li><div>        if ( empty( $page_template ) )&nbsp;</div></li><li><div>            $page_template = 'default';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_page = array(&nbsp;</div></li><li><div>            'dateCreated' =&gt; $page_date, &nbsp;</div></li><li><div>            'userid' =&gt; $page-&gt;post_author, &nbsp;</div></li><li><div>            'page_id' =&gt; $page-&gt;ID, &nbsp;</div></li><li><div>            'page_status' =&gt; $page-&gt;post_status, &nbsp;</div></li><li><div>            'description' =&gt; $full_page['main'], &nbsp;</div></li><li><div>            'title' =&gt; $page-&gt;post_title, &nbsp;</div></li><li><div>            'link' =&gt; $link, &nbsp;</div></li><li><div>            'permaLink' =&gt; $link, &nbsp;</div></li><li><div>            'categories' =&gt; $categories, &nbsp;</div></li><li><div>            'excerpt' =&gt; $page-&gt;post_excerpt, &nbsp;</div></li><li><div>            'text_more' =&gt; $full_page['extended'], &nbsp;</div></li><li><div>            'mt_allow_comments' =&gt; $allow_comments, &nbsp;</div></li><li><div>            'mt_allow_pings' =&gt; $allow_pings, &nbsp;</div></li><li><div>            'wp_slug' =&gt; $page-&gt;post_name, &nbsp;</div></li><li><div>            'wp_password' =&gt; $page-&gt;post_password, &nbsp;</div></li><li><div>            'wp_author' =&gt; $author-&gt;display_name, &nbsp;</div></li><li><div>            'wp_page_parent_id' =&gt; $page-&gt;post_parent, &nbsp;</div></li><li><div>            'wp_page_parent_title' =&gt; $parent_title, &nbsp;</div></li><li><div>            'wp_page_order' =&gt; $page-&gt;menu_order, &nbsp;</div></li><li><div>            'wp_author_id' =&gt; (string) $author-&gt;ID, &nbsp;</div></li><li><div>            'wp_author_display_name' =&gt; $author-&gt;display_name, &nbsp;</div></li><li><div>            'date_created_gmt' =&gt; $page_date_gmt, &nbsp;</div></li><li><div>            'custom_fields' =&gt; $this-&gt;get_custom_fields( $page-&gt;ID ), &nbsp;</div></li><li><div>            'wp_page_template' =&gt; $page_template&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared data for the given page.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array   $_page An array of page data.&nbsp;</div></li><li><div>         * @param WP_Post $page  Page object.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_page', $_page, $page );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares comment data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $comment The unprepared comment data.&nbsp;</div></li><li><div>     * @return array The prepared comment data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_comment( $comment ) {&nbsp;</div></li><li><div>        // Format page date.&nbsp;</div></li><li><div>        $comment_date_gmt = $this-&gt;_convert_date_gmt( $comment-&gt;comment_date_gmt, $comment-&gt;comment_date );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( '0' == $comment-&gt;comment_approved ) {&nbsp;</div></li><li><div>            $comment_status = 'hold';&nbsp;</div></li><li><div>        } elseif ( 'spam' == $comment-&gt;comment_approved ) {&nbsp;</div></li><li><div>            $comment_status = 'spam';&nbsp;</div></li><li><div>        } elseif ( '1' == $comment-&gt;comment_approved ) {&nbsp;</div></li><li><div>            $comment_status = 'approve';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $comment_status = $comment-&gt;comment_approved;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $_comment = array(&nbsp;</div></li><li><div>            'date_created_gmt' =&gt; $comment_date_gmt, &nbsp;</div></li><li><div>            'user_id' =&gt; $comment-&gt;user_id, &nbsp;</div></li><li><div>            'comment_id' =&gt; $comment-&gt;comment_ID, &nbsp;</div></li><li><div>            'parent' =&gt; $comment-&gt;comment_parent, &nbsp;</div></li><li><div>            'status' =&gt; $comment_status, &nbsp;</div></li><li><div>            'content' =&gt; $comment-&gt;comment_content, &nbsp;</div></li><li><div>            'link' =&gt; get_comment_link($comment), &nbsp;</div></li><li><div>            'post_id' =&gt; $comment-&gt;comment_post_ID, &nbsp;</div></li><li><div>            'post_title' =&gt; get_the_title($comment-&gt;comment_post_ID), &nbsp;</div></li><li><div>            'author' =&gt; $comment-&gt;comment_author, &nbsp;</div></li><li><div>            'author_url' =&gt; $comment-&gt;comment_author_url, &nbsp;</div></li><li><div>            'author_email' =&gt; $comment-&gt;comment_author_email, &nbsp;</div></li><li><div>            'author_ip' =&gt; $comment-&gt;comment_author_IP, &nbsp;</div></li><li><div>            'type' =&gt; $comment-&gt;comment_type, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared data for the given comment.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array      $_comment An array of prepared comment data.&nbsp;</div></li><li><div>         * @param WP_Comment $comment  Comment object.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_comment', $_comment, $comment );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares user data for return in an XML-RPC object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_User $user   The unprepared user object.&nbsp;</div></li><li><div>     * @param array   $fields The subset of user fields to return.&nbsp;</div></li><li><div>     * @return array The prepared user data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _prepare_user( $user, $fields ) {&nbsp;</div></li><li><div>        $_user = array( 'user_id' =&gt; strval( $user-&gt;ID ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $user_fields = array(&nbsp;</div></li><li><div>            'username' =&gt; $user-&gt;user_login, &nbsp;</div></li><li><div>            'first_name' =&gt; $user-&gt;user_firstname, &nbsp;</div></li><li><div>            'last_name' =&gt; $user-&gt;user_lastname, &nbsp;</div></li><li><div>            'registered' =&gt; $this-&gt;_convert_date( $user-&gt;user_registered ), &nbsp;</div></li><li><div>            'bio' =&gt; $user-&gt;user_description, &nbsp;</div></li><li><div>            'email' =&gt; $user-&gt;user_email, &nbsp;</div></li><li><div>            'nickname' =&gt; $user-&gt;nickname, &nbsp;</div></li><li><div>            'nicename' =&gt; $user-&gt;user_nicename, &nbsp;</div></li><li><div>            'url' =&gt; $user-&gt;user_url, &nbsp;</div></li><li><div>            'display_name' =&gt; $user-&gt;display_name, &nbsp;</div></li><li><div>            'roles' =&gt; $user-&gt;roles, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( 'all', $fields ) ) {&nbsp;</div></li><li><div>            $_user = array_merge( $_user, $user_fields );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( in_array( 'basic', $fields ) ) {&nbsp;</div></li><li><div>                $basic_fields = array( 'username', 'email', 'registered', 'display_name', 'nicename' );&nbsp;</div></li><li><div>                $fields = array_merge( $fields, $basic_fields );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $requested_fields = array_intersect_key( $user_fields, array_flip( $fields ) );&nbsp;</div></li><li><div>            $_user = array_merge( $_user, $requested_fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters XML-RPC-prepared data for the given user.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array   $_user  An array of user data.&nbsp;</div></li><li><div>         * @param WP_User $user   User object.&nbsp;</div></li><li><div>         * @param array   $fields An array of user fields.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_prepare_user', $_user, $user, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create a new post for any registered post type.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @link https://en.wikipedia.org/wiki/RSS_enclosure for information on RSS enclosures.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: top-level arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id        Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username       Username.&nbsp;</div></li><li><div>     *     @type string $password       Password.&nbsp;</div></li><li><div>     *     @type array  $content_struct {&nbsp;</div></li><li><div>     *         Content struct for adding a new post. See wp_insert_post() for information on&nbsp;</div></li><li><div>     *         additional post fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *         @type string $post_type      Post type. Default 'post'.&nbsp;</div></li><li><div>     *         @type string $post_status    Post status. Default 'draft'&nbsp;</div></li><li><div>     *         @type string $post_title     Post title.&nbsp;</div></li><li><div>     *         @type int    $post_author    Post author ID.&nbsp;</div></li><li><div>     *         @type string $post_excerpt   Post excerpt.&nbsp;</div></li><li><div>     *         @type string $post_content   Post content.&nbsp;</div></li><li><div>     *         @type string $post_date_gmt  Post date in GMT.&nbsp;</div></li><li><div>     *         @type string $post_date      Post date.&nbsp;</div></li><li><div>     *         @type string $post_password  Post password (20-character limit).&nbsp;</div></li><li><div>     *         @type string $comment_status Post comment enabled status. Accepts 'open' or 'closed'.&nbsp;</div></li><li><div>     *         @type string $ping_status    Post ping status. Accepts 'open' or 'closed'.&nbsp;</div></li><li><div>     *         @type bool   $sticky         Whether the post should be sticky. Automatically false if&nbsp;</div></li><li><div>     *                                      `$post_status` is 'private'.&nbsp;</div></li><li><div>     *         @type int    $post_thumbnail ID of an image to use as the post thumbnail/featured image.&nbsp;</div></li><li><div>     *         @type array  $custom_fields  Array of meta key/value pairs to add to the post.&nbsp;</div></li><li><div>     *         @type array  $terms          Associative array with taxonomy names as keys and arrays&nbsp;</div></li><li><div>     *                                      of term IDs as values.&nbsp;</div></li><li><div>     *         @type array  $terms_names    Associative array with taxonomy names as keys and arrays&nbsp;</div></li><li><div>     *                                      of term names as values.&nbsp;</div></li><li><div>     *         @type array  $enclosure      {&nbsp;</div></li><li><div>     *             Array of feed enclosure data to add to post meta.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *             @type string $url    URL for the feed enclosure.&nbsp;</div></li><li><div>     *             @type int    $length Size in bytes of the enclosure.&nbsp;</div></li><li><div>     *             @type string $type   Mime-type for the enclosure.&nbsp;</div></li><li><div>     *         }&nbsp;</div></li><li><div>     *     }&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error Post ID on success, IXR_Error instance otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_newPost( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $content_struct = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // convert the date field back to IXR form&nbsp;</div></li><li><div>        if ( isset( $content_struct['post_date'] ) && ! ( $content_struct['post_date'] instanceof IXR_Date ) ) {&nbsp;</div></li><li><div>            $content_struct['post_date'] = $this-&gt;_convert_date( $content_struct['post_date'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // ignore the existing GMT date if it is empty or a non-GMT date was supplied in $content_struct, &nbsp;</div></li><li><div>        // since _insert_post will ignore the non-GMT date if the GMT date is set&nbsp;</div></li><li><div>        if ( isset( $content_struct['post_date_gmt'] ) && ! ( $content_struct['post_date_gmt'] instanceof IXR_Date ) ) {&nbsp;</div></li><li><div>            if ( $content_struct['post_date_gmt'] == '0000-00-00 00:00:00' || isset( $content_struct['post_date'] ) ) {&nbsp;</div></li><li><div>                unset( $content_struct['post_date_gmt'] );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $content_struct['post_date_gmt'] = $this-&gt;_convert_date( $content_struct['post_date_gmt'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.newPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $content_struct['ID'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_insert_post( $user, $content_struct );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Helper method for filtering out elements from an array.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $count Number to compare to one.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function _is_greater_than_one( $count ) {&nbsp;</div></li><li><div>        return $count &gt; 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Encapsulate the logic for sticking a post&nbsp;</div></li><li><div>     * and determining if the user has permission to do so&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 4.3.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $post_data&nbsp;</div></li><li><div>     * @param bool  $update&nbsp;</div></li><li><div>     * @return void|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function _toggle_sticky( $post_data, $update = false ) {&nbsp;</div></li><li><div>        $post_type = get_post_type_object( $post_data['post_type'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Private and password-protected posts cannot be stickied.&nbsp;</div></li><li><div>        if ( 'private' === $post_data['post_status'] || ! empty( $post_data['post_password'] ) ) {&nbsp;</div></li><li><div>            // Error if the client tried to stick the post, otherwise, silently unstick.&nbsp;</div></li><li><div>            if ( ! empty( $post_data['sticky'] ) ) {&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you cannot stick a private post.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $update ) {&nbsp;</div></li><li><div>                unstick_post( $post_data['ID'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( isset( $post_data['sticky'] ) )  {&nbsp;</div></li><li><div>            if ( ! current_user_can( $post_type-&gt;cap-&gt;edit_others_posts ) ) {&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you are not allowed to make posts sticky.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sticky = wp_validate_boolean( $post_data['sticky'] );&nbsp;</div></li><li><div>            if ( $sticky ) {&nbsp;</div></li><li><div>                stick_post( $post_data['ID'] );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                unstick_post( $post_data['ID'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Helper method for wp_newPost() and wp_editPost(), containing shared logic.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wp_insert_post()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param WP_User         $user           The post author if post_author isn't set in $content_struct.&nbsp;</div></li><li><div>     * @param array|IXR_Error $content_struct Post data to insert.&nbsp;</div></li><li><div>     * @return IXR_Error|string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _insert_post( $user, $content_struct ) {&nbsp;</div></li><li><div>        $defaults = array( 'post_status' =&gt; 'draft', 'post_type' =&gt; 'post', 'post_author' =&gt; 0, &nbsp;</div></li><li><div>            'post_password' =&gt; '', 'post_excerpt' =&gt; '', 'post_content' =&gt; '', 'post_title' =&gt; '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_data = wp_parse_args( $content_struct, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_type = get_post_type_object( $post_data['post_type'] );&nbsp;</div></li><li><div>        if ( ! $post_type )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $update = ! empty( $post_data['ID'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $update ) {&nbsp;</div></li><li><div>            if ( ! get_post( $post_data['ID'] ) )&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>            if ( ! current_user_can( 'edit_post', $post_data['ID'] ) )&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>            if ( $post_data['post_type'] != get_post_type( $post_data['ID'] ) )&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'The post type may not be changed.' ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( ! current_user_can( $post_type-&gt;cap-&gt;create_posts ) || ! current_user_can( $post_type-&gt;cap-&gt;edit_posts ) )&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you are not allowed to post on this site.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $post_data['post_status'] ) {&nbsp;</div></li><li><div>            case 'draft':&nbsp;</div></li><li><div>            case 'pending':&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'private':&nbsp;</div></li><li><div>                if ( ! current_user_can( $post_type-&gt;cap-&gt;publish_posts ) )&nbsp;</div></li><li><div>                    return new IXR_Error( 401, __( 'Sorry, you are not allowed to create private posts in this post type.' ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'publish':&nbsp;</div></li><li><div>            case 'future':&nbsp;</div></li><li><div>                if ( ! current_user_can( $post_type-&gt;cap-&gt;publish_posts ) )&nbsp;</div></li><li><div>                    return new IXR_Error( 401, __( 'Sorry, you are not allowed to publish posts in this post type.' ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                if ( ! get_post_status_object( $post_data['post_status'] ) )&nbsp;</div></li><li><div>                    $post_data['post_status'] = 'draft';&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $post_data['post_password'] ) && ! current_user_can( $post_type-&gt;cap-&gt;publish_posts ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to create password protected posts in this post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_data['post_author'] = absint( $post_data['post_author'] );&nbsp;</div></li><li><div>        if ( ! empty( $post_data['post_author'] ) && $post_data['post_author'] != $user-&gt;ID ) {&nbsp;</div></li><li><div>            if ( ! current_user_can( $post_type-&gt;cap-&gt;edit_others_posts ) )&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you are not allowed to create posts as this user.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $author = get_userdata( $post_data['post_author'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! $author )&nbsp;</div></li><li><div>                return new IXR_Error( 404, __( 'Invalid author ID.' ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post_data['post_author'] = $user-&gt;ID;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $post_data['comment_status'] ) && $post_data['comment_status'] != 'open' && $post_data['comment_status'] != 'closed' )&nbsp;</div></li><li><div>            unset( $post_data['comment_status'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $post_data['ping_status'] ) && $post_data['ping_status'] != 'open' && $post_data['ping_status'] != 'closed' )&nbsp;</div></li><li><div>            unset( $post_data['ping_status'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do some timestamp voodoo.&nbsp;</div></li><li><div>        if ( ! empty( $post_data['post_date_gmt'] ) ) {&nbsp;</div></li><li><div>            // We know this is supposed to be GMT, so we're going to slap that Z on there by force.&nbsp;</div></li><li><div>            $dateCreated = rtrim( $post_data['post_date_gmt']-&gt;getIso(), 'Z' ) . 'Z';&nbsp;</div></li><li><div>        } elseif ( ! empty( $post_data['post_date'] ) ) {&nbsp;</div></li><li><div>            $dateCreated = $post_data['post_date']-&gt;getIso();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Default to not flagging the post date to be edited unless it's intentional.&nbsp;</div></li><li><div>        $post_data['edit_date'] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $dateCreated ) ) {&nbsp;</div></li><li><div>            $post_data['post_date'] = get_date_from_gmt( iso8601_to_datetime( $dateCreated ) );&nbsp;</div></li><li><div>            $post_data['post_date_gmt'] = iso8601_to_datetime( $dateCreated, 'GMT' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Flag the post date to be edited.&nbsp;</div></li><li><div>            $post_data['edit_date'] = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $post_data['ID'] ) )&nbsp;</div></li><li><div>            $post_data['ID'] = get_default_post_to_edit( $post_data['post_type'], true )-&gt;ID;&nbsp;</div></li><li><div>        $post_ID = $post_data['ID'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $post_data['post_type'] == 'post' ) {&nbsp;</div></li><li><div>            $error = $this-&gt;_toggle_sticky( $post_data, $update );&nbsp;</div></li><li><div>            if ( $error ) {&nbsp;</div></li><li><div>                return $error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $post_data['post_thumbnail'] ) ) {&nbsp;</div></li><li><div>            // empty value deletes, non-empty value adds/updates.&nbsp;</div></li><li><div>            if ( ! $post_data['post_thumbnail'] )&nbsp;</div></li><li><div>                delete_post_thumbnail( $post_ID );&nbsp;</div></li><li><div>            elseif ( ! get_post( absint( $post_data['post_thumbnail'] ) ) )&nbsp;</div></li><li><div>                return new IXR_Error( 404, __( 'Invalid attachment ID.' ) );&nbsp;</div></li><li><div>            set_post_thumbnail( $post_ID, $post_data['post_thumbnail'] );&nbsp;</div></li><li><div>            unset( $content_struct['post_thumbnail'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $post_data['custom_fields'] ) )&nbsp;</div></li><li><div>            $this-&gt;set_custom_fields( $post_ID, $post_data['custom_fields'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $post_data['terms'] ) || isset( $post_data['terms_names'] ) ) {&nbsp;</div></li><li><div>            $post_type_taxonomies = get_object_taxonomies( $post_data['post_type'], 'objects' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Accumulate term IDs from terms and terms_names.&nbsp;</div></li><li><div>            $terms = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // First validate the terms specified by ID.&nbsp;</div></li><li><div>            if ( isset( $post_data['terms'] ) && is_array( $post_data['terms'] ) ) {&nbsp;</div></li><li><div>                $taxonomies = array_keys( $post_data['terms'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Validating term ids.&nbsp;</div></li><li><div>                foreach ( $taxonomies as $taxonomy ) {&nbsp;</div></li><li><div>                    if ( ! array_key_exists( $taxonomy , $post_type_taxonomies ) )&nbsp;</div></li><li><div>                        return new IXR_Error( 401, __( 'Sorry, one of the given taxonomies is not supported by the post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( ! current_user_can( $post_type_taxonomies[$taxonomy]-&gt;cap-&gt;assign_terms ) )&nbsp;</div></li><li><div>                        return new IXR_Error( 401, __( 'Sorry, you are not allowed to assign a term to one of the given taxonomies.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $term_ids = $post_data['terms'][$taxonomy];&nbsp;</div></li><li><div>                    $terms[ $taxonomy ] = array();&nbsp;</div></li><li><div>                    foreach ( $term_ids as $term_id ) {&nbsp;</div></li><li><div>                        $term = get_term_by( 'id', $term_id, $taxonomy );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( ! $term )&nbsp;</div></li><li><div>                            return new IXR_Error( 403, __( 'Invalid term ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $terms[$taxonomy][] = (int) $term_id;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Now validate terms specified by name.&nbsp;</div></li><li><div>            if ( isset( $post_data['terms_names'] ) && is_array( $post_data['terms_names'] ) ) {&nbsp;</div></li><li><div>                $taxonomies = array_keys( $post_data['terms_names'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $taxonomies as $taxonomy ) {&nbsp;</div></li><li><div>                    if ( ! array_key_exists( $taxonomy , $post_type_taxonomies ) )&nbsp;</div></li><li><div>                        return new IXR_Error( 401, __( 'Sorry, one of the given taxonomies is not supported by the post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( ! current_user_can( $post_type_taxonomies[$taxonomy]-&gt;cap-&gt;assign_terms ) )&nbsp;</div></li><li><div>                        return new IXR_Error( 401, __( 'Sorry, you are not allowed to assign a term to one of the given taxonomies.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    /**&nbsp;</div></li><li><div>                     * For hierarchical taxonomies, we can't assign a term when multiple terms&nbsp;</div></li><li><div>                     * in the hierarchy share the same name.&nbsp;</div></li><li><div>                     */&nbsp;</div></li><li><div>                    $ambiguous_terms = array();&nbsp;</div></li><li><div>                    if ( is_taxonomy_hierarchical( $taxonomy ) ) {&nbsp;</div></li><li><div>                        $tax_term_names = get_terms( $taxonomy, array( 'fields' =&gt; 'names', 'hide_empty' =&gt; false ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Count the number of terms with the same name.&nbsp;</div></li><li><div>                        $tax_term_names_count = array_count_values( $tax_term_names );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Filter out non-ambiguous term names.&nbsp;</div></li><li><div>                        $ambiguous_tax_term_counts = array_filter( $tax_term_names_count, array( $this, '_is_greater_than_one') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $ambiguous_terms = array_keys( $ambiguous_tax_term_counts );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $term_names = $post_data['terms_names'][$taxonomy];&nbsp;</div></li><li><div>                    foreach ( $term_names as $term_name ) {&nbsp;</div></li><li><div>                        if ( in_array( $term_name, $ambiguous_terms ) )&nbsp;</div></li><li><div>                            return new IXR_Error( 401, __( 'Ambiguous term name used in a hierarchical taxonomy. Please use term ID instead.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $term = get_term_by( 'name', $term_name, $taxonomy );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( ! $term ) {&nbsp;</div></li><li><div>                            // Term doesn't exist, so check that the user is allowed to create new terms.&nbsp;</div></li><li><div>                            if ( ! current_user_can( $post_type_taxonomies[$taxonomy]-&gt;cap-&gt;edit_terms ) )&nbsp;</div></li><li><div>                                return new IXR_Error( 401, __( 'Sorry, you are not allowed to add a term to one of the given taxonomies.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Create the new term.&nbsp;</div></li><li><div>                            $term_info = wp_insert_term( $term_name, $taxonomy );&nbsp;</div></li><li><div>                            if ( is_wp_error( $term_info ) )&nbsp;</div></li><li><div>                                return new IXR_Error( 500, $term_info-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $terms[$taxonomy][] = (int) $term_info['term_id'];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $terms[$taxonomy][] = (int) $term-&gt;term_id;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_data['tax_input'] = $terms;&nbsp;</div></li><li><div>            unset( $post_data['terms'], $post_data['terms_names'] );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // Do not allow direct submission of 'tax_input', clients must use 'terms' and/or 'terms_names'.&nbsp;</div></li><li><div>            unset( $post_data['tax_input'], $post_data['post_category'], $post_data['tags_input'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $post_data['post_format'] ) ) {&nbsp;</div></li><li><div>            $format = set_post_format( $post_ID, $post_data['post_format'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_wp_error( $format ) )&nbsp;</div></li><li><div>                return new IXR_Error( 500, $format-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $post_data['post_format'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle enclosures.&nbsp;</div></li><li><div>        $enclosure = isset( $post_data['enclosure'] ) ? $post_data['enclosure'] : null;&nbsp;</div></li><li><div>        $this-&gt;add_enclosure_if_new( $post_ID, $enclosure );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;attach_uploads( $post_ID, $post_data['post_content'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters post data array to be inserted via XML-RPC.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $post_data      Parsed array of post data.&nbsp;</div></li><li><div>         * @param array $content_struct Post data array.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $post_data = apply_filters( 'xmlrpc_wp_insert_post_data', $post_data, $content_struct );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = $update ? wp_update_post( $post_data, true ) : wp_insert_post( $post_data, true );&nbsp;</div></li><li><div>        if ( is_wp_error( $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $post_ID-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $post_ID )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, your entry could not be posted.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return strval( $post_ID );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edit a post for any registered post type.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The $content_struct parameter only needs to contain fields that&nbsp;</div></li><li><div>     * should be changed. All other fields will retain their existing values.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id        Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username       Username.&nbsp;</div></li><li><div>     *     @type string $password       Password.&nbsp;</div></li><li><div>     *     @type int    $post_id        Post ID.&nbsp;</div></li><li><div>     *     @type array  $content_struct Extra content arguments.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True on success, IXR_Error on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_editPost( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 5 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $post_id = (int) $args[3];&nbsp;</div></li><li><div>        $content_struct = $args[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.editPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post = get_post( $post_id, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $post['ID'] ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['if_not_modified_since'] ) ) {&nbsp;</div></li><li><div>            // If the post has been modified since the date provided, return an error.&nbsp;</div></li><li><div>            if ( mysql2date( 'U', $post['post_modified_gmt'] ) &gt; $content_struct['if_not_modified_since']-&gt;getTimestamp() ) {&nbsp;</div></li><li><div>                return new IXR_Error( 409, __( 'There is a revision of this post that is more recent.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Convert the date field back to IXR form.&nbsp;</div></li><li><div>        $post['post_date'] = $this-&gt;_convert_date( $post['post_date'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Ignore the existing GMT date if it is empty or a non-GMT date was supplied in $content_struct, &nbsp;</div></li><li><div>         * since _insert_post() will ignore the non-GMT date if the GMT date is set.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( $post['post_date_gmt'] == '0000-00-00 00:00:00' || isset( $content_struct['post_date'] ) )&nbsp;</div></li><li><div>            unset( $post['post_date_gmt'] );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $post['post_date_gmt'] = $this-&gt;_convert_date( $post['post_date_gmt'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $post );&nbsp;</div></li><li><div>        $merged_content_struct = array_merge( $post, $content_struct );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $retval = $this-&gt;_insert_post( $user, $merged_content_struct );&nbsp;</div></li><li><div>        if ( $retval instanceof IXR_Error )&nbsp;</div></li><li><div>            return $retval;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete a post for any registered post type.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wp_delete_post()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id  Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     *     @type int    $post_id  Post ID.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True on success, IXR_Error instance on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_deletePost( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $post_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.deletePost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post = get_post( $post_id, ARRAY_A );&nbsp;</div></li><li><div>        if ( empty( $post['ID'] ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'delete_post', $post_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to delete this post.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = wp_delete_post( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $result ) {&nbsp;</div></li><li><div>            return new IXR_Error( 500, __( 'The post cannot be deleted.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The optional $fields parameter specifies what fields will be included&nbsp;</div></li><li><div>     * in the response array. This should be a list of field names. 'post_id' will&nbsp;</div></li><li><div>     * always be included in the response regardless of the value of $fields.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Instead of, or in addition to, individual field names, conceptual group&nbsp;</div></li><li><div>     * names can be used to specify multiple fields. The available conceptual&nbsp;</div></li><li><div>     * groups are 'post' (all basic fields), 'taxonomies', 'custom_fields', &nbsp;</div></li><li><div>     * and 'enclosure'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see get_post()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id  Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     *     @type int    $post_id  Post ID.&nbsp;</div></li><li><div>     *     @type array  $fields   The subset of post type fields to return.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Array contains (based on $fields parameter):&nbsp;</div></li><li><div>     *  - 'post_id'&nbsp;</div></li><li><div>     *  - 'post_title'&nbsp;</div></li><li><div>     *  - 'post_date'&nbsp;</div></li><li><div>     *  - 'post_date_gmt'&nbsp;</div></li><li><div>     *  - 'post_modified'&nbsp;</div></li><li><div>     *  - 'post_modified_gmt'&nbsp;</div></li><li><div>     *  - 'post_status'&nbsp;</div></li><li><div>     *  - 'post_type'&nbsp;</div></li><li><div>     *  - 'post_name'&nbsp;</div></li><li><div>     *  - 'post_author'&nbsp;</div></li><li><div>     *  - 'post_password'&nbsp;</div></li><li><div>     *  - 'post_excerpt'&nbsp;</div></li><li><div>     *  - 'post_content'&nbsp;</div></li><li><div>     *  - 'link'&nbsp;</div></li><li><div>     *  - 'comment_status'&nbsp;</div></li><li><div>     *  - 'ping_status'&nbsp;</div></li><li><div>     *  - 'sticky'&nbsp;</div></li><li><div>     *  - 'custom_fields'&nbsp;</div></li><li><div>     *  - 'terms'&nbsp;</div></li><li><div>     *  - 'categories'&nbsp;</div></li><li><div>     *  - 'tags'&nbsp;</div></li><li><div>     *  - 'enclosure'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPost( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $post_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters the list of post query fields used by the given XML-RPC method.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.4.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array  $fields Array of post fields. Default array contains 'post', 'terms', and 'custom_fields'.&nbsp;</div></li><li><div>             * @param string $method Method name.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_post_fields', array( 'post', 'terms', 'custom_fields' ), 'wp.getPost' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post = get_post( $post_id, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $post['ID'] ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_post', $post_id ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_post( $post, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve posts.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wp_get_recent_posts()&nbsp;</div></li><li><div>     * @see wp_getPost() for more on `$fields`&nbsp;</div></li><li><div>     * @see get_posts() for more on `$filter` values&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id  Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     *     @type array  $filter   Optional. Modifies the query used to retrieve posts. Accepts 'post_type', &nbsp;</div></li><li><div>     *                            'post_status', 'number', 'offset', 'orderby', 's', and 'order'.&nbsp;</div></li><li><div>     *                            Default empty array.&nbsp;</div></li><li><div>     *     @type array  $fields   Optional. The subset of post type fields to return in the response array.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Array contains a collection of posts.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPosts( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 3 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $filter = isset( $args[3] ) ? $args[3] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_post_fields', array( 'post', 'terms', 'custom_fields' ), 'wp.getPosts' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPosts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $query = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['post_type'] ) ) {&nbsp;</div></li><li><div>            $post_type = get_post_type_object( $filter['post_type'] );&nbsp;</div></li><li><div>            if ( ! ( (bool) $post_type ) )&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post_type = get_post_type_object( 'post' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( $post_type-&gt;cap-&gt;edit_posts ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit posts in this post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $query['post_type'] = $post_type-&gt;name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['post_status'] ) )&nbsp;</div></li><li><div>            $query['post_status'] = $filter['post_status'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['number'] ) )&nbsp;</div></li><li><div>            $query['numberposts'] = absint( $filter['number'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['offset'] ) )&nbsp;</div></li><li><div>            $query['offset'] = absint( $filter['offset'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['orderby'] ) ) {&nbsp;</div></li><li><div>            $query['orderby'] = $filter['orderby'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $filter['order'] ) )&nbsp;</div></li><li><div>                $query['order'] = $filter['order'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['s'] ) ) {&nbsp;</div></li><li><div>            $query['s'] = $filter['s'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $posts_list = wp_get_recent_posts( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $posts_list )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Holds all the posts data.&nbsp;</div></li><li><div>        $struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $posts_list as $post ) {&nbsp;</div></li><li><div>            if ( ! current_user_can( 'edit_post', $post['ID'] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $struct[] = $this-&gt;_prepare_post( $post, $fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create a new term.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wp_insert_term()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id        Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username       Username.&nbsp;</div></li><li><div>     *     @type string $password       Password.&nbsp;</div></li><li><div>     *     @type array  $content_struct Content struct for adding a new term. The struct must contain&nbsp;</div></li><li><div>     *                                  the term 'name' and 'taxonomy'. Optional accepted values include&nbsp;</div></li><li><div>     *                                  'parent', 'description', and 'slug'.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error The term ID on success, or an IXR_Error object on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_newTerm( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $content_struct = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.newTerm' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! taxonomy_exists( $content_struct['taxonomy'] ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = get_taxonomy( $content_struct['taxonomy'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( $taxonomy-&gt;cap-&gt;edit_terms ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to create terms in this taxonomy.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = (array) $taxonomy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // hold the data of the term&nbsp;</div></li><li><div>        $term_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $term_data['name'] = trim( $content_struct['name'] );&nbsp;</div></li><li><div>        if ( empty( $term_data['name'] ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'The term name cannot be empty.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['parent'] ) ) {&nbsp;</div></li><li><div>            if ( ! $taxonomy['hierarchical'] )&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( 'This taxonomy is not hierarchical.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $parent_term_id = (int) $content_struct['parent'];&nbsp;</div></li><li><div>            $parent_term = get_term( $parent_term_id , $taxonomy['name'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_wp_error( $parent_term ) )&nbsp;</div></li><li><div>                return new IXR_Error( 500, $parent_term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! $parent_term )&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( 'Parent term does not exist.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $term_data['parent'] = $content_struct['parent'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['description'] ) )&nbsp;</div></li><li><div>            $term_data['description'] = $content_struct['description'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['slug'] ) )&nbsp;</div></li><li><div>            $term_data['slug'] = $content_struct['slug'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $term = wp_insert_term( $term_data['name'] , $taxonomy['name'] , $term_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $term ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $term )&nbsp;</div></li><li><div>            return new IXR_Error( 500, __( 'Sorry, your term could not be created.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return strval( $term['term_id'] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edit a term.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wp_update_term()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id        Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username       Username.&nbsp;</div></li><li><div>     *     @type string $password       Password.&nbsp;</div></li><li><div>     *     @type int    $term_id        Term ID.&nbsp;</div></li><li><div>     *     @type array  $content_struct Content struct for editing a term. The struct must contain the&nbsp;</div></li><li><div>     *                                  term ''taxonomy'. Optional accepted values include 'name', 'parent', &nbsp;</div></li><li><div>     *                                  'description', and 'slug'.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True on success, IXR_Error instance on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_editTerm( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 5 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $term_id = (int) $args[3];&nbsp;</div></li><li><div>        $content_struct = $args[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.editTerm' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! taxonomy_exists( $content_struct['taxonomy'] ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = get_taxonomy( $content_struct['taxonomy'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = (array) $taxonomy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // hold the data of the term&nbsp;</div></li><li><div>        $term_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $term = get_term( $term_id , $content_struct['taxonomy'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $term ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $term )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid term ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_term', $term_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this term.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['name'] ) ) {&nbsp;</div></li><li><div>            $term_data['name'] = trim( $content_struct['name'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $term_data['name'] ) )&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( 'The term name cannot be empty.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $content_struct['parent'] ) ) {&nbsp;</div></li><li><div>            if ( ! $taxonomy['hierarchical'] )&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( &quot;This taxonomy is not hierarchical so you can't set a parent.&quot; ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $parent_term_id = (int) $content_struct['parent'];&nbsp;</div></li><li><div>            $parent_term = get_term( $parent_term_id , $taxonomy['name'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_wp_error( $parent_term ) )&nbsp;</div></li><li><div>                return new IXR_Error( 500, $parent_term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! $parent_term )&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( 'Parent term does not exist.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $term_data['parent'] = $content_struct['parent'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['description'] ) )&nbsp;</div></li><li><div>            $term_data['description'] = $content_struct['description'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['slug'] ) )&nbsp;</div></li><li><div>            $term_data['slug'] = $content_struct['slug'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $term = wp_update_term( $term_id , $taxonomy['name'] , $term_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $term ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $term )&nbsp;</div></li><li><div>            return new IXR_Error( 500, __( 'Sorry, editing the term failed.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete a term.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wp_delete_term()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id      Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username     Username.&nbsp;</div></li><li><div>     *     @type string $password     Password.&nbsp;</div></li><li><div>     *     @type string $taxnomy_name Taxonomy name.&nbsp;</div></li><li><div>     *     @type int    $term_id      Term ID.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return bool|IXR_Error True on success, IXR_Error instance on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_deleteTerm( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 5 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $taxonomy = $args[3];&nbsp;</div></li><li><div>        $term_id = (int) $args[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.deleteTerm' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! taxonomy_exists( $taxonomy ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = get_taxonomy( $taxonomy );&nbsp;</div></li><li><div>        $term = get_term( $term_id, $taxonomy-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $term ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $term )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid term ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'delete_term', $term_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to delete this term.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = wp_delete_term( $term_id, $taxonomy-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $result ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $result )&nbsp;</div></li><li><div>            return new IXR_Error( 500, __( 'Sorry, deleting the term failed.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a term.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see get_term()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id  Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     *     @type string $taxnomy  Taxonomy name.&nbsp;</div></li><li><div>     *     @type string $term_id  Term ID.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error IXR_Error on failure, array on success, containing:&nbsp;</div></li><li><div>     *  - 'term_id'&nbsp;</div></li><li><div>     *  - 'name'&nbsp;</div></li><li><div>     *  - 'slug'&nbsp;</div></li><li><div>     *  - 'term_group'&nbsp;</div></li><li><div>     *  - 'term_taxonomy_id'&nbsp;</div></li><li><div>     *  - 'taxonomy'&nbsp;</div></li><li><div>     *  - 'description'&nbsp;</div></li><li><div>     *  - 'parent'&nbsp;</div></li><li><div>     *  - 'count'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getTerm( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 5 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $taxonomy = $args[3];&nbsp;</div></li><li><div>        $term_id = (int) $args[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getTerm' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! taxonomy_exists( $taxonomy ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = get_taxonomy( $taxonomy );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $term = get_term( $term_id , $taxonomy-&gt;name, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $term ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $term-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $term )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid term ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'assign_term', $term_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to assign this term.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_term( $term );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve all terms for a taxonomy.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The optional $filter parameter modifies the query used to retrieve terms.&nbsp;</div></li><li><div>     * Accepted keys are 'number', 'offset', 'orderby', 'order', 'hide_empty', and 'search'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see get_terms()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id  Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     *     @type string $taxnomy  Taxonomy name.&nbsp;</div></li><li><div>     *     @type array  $filter   Optional. Modifies the query used to retrieve posts. Accepts 'number', &nbsp;</div></li><li><div>     *                            'offset', 'orderby', 'order', 'hide_empty', and 'search'. Default empty array.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error An associative array of terms data on success, IXR_Error instance otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getTerms( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $taxonomy = $args[3];&nbsp;</div></li><li><div>        $filter = isset( $args[4] ) ? $args[4] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getTerms' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! taxonomy_exists( $taxonomy ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = get_taxonomy( $taxonomy );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( $taxonomy-&gt;cap-&gt;assign_terms ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to assign terms in this taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $query = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['number'] ) )&nbsp;</div></li><li><div>            $query['number'] = absint( $filter['number'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['offset'] ) )&nbsp;</div></li><li><div>            $query['offset'] = absint( $filter['offset'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['orderby'] ) ) {&nbsp;</div></li><li><div>            $query['orderby'] = $filter['orderby'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $filter['order'] ) )&nbsp;</div></li><li><div>                $query['order'] = $filter['order'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['hide_empty'] ) )&nbsp;</div></li><li><div>            $query['hide_empty'] = $filter['hide_empty'];&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $query['get'] = 'all';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['search'] ) )&nbsp;</div></li><li><div>            $query['search'] = $filter['search'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $terms = get_terms( $taxonomy-&gt;name, $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $terms ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $terms-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $terms as $term ) {&nbsp;</div></li><li><div>            $struct[] = $this-&gt;_prepare_term( $term );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a taxonomy.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see get_taxonomy()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id  Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     *     @type string $taxnomy  Taxonomy name.&nbsp;</div></li><li><div>     *     @type array  $fields   Optional. Array of taxonomy fields to limit to in the return.&nbsp;</div></li><li><div>     *                            Accepts 'labels', 'cap', 'menu', and 'object_type'.&nbsp;</div></li><li><div>     *                            Default empty array.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error An array of taxonomy data on success, IXR_Error instance otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getTaxonomy( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $taxonomy = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters the taxonomy query fields used by the given XML-RPC method.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.4.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array  $fields An array of taxonomy fields to retrieve.&nbsp;</div></li><li><div>             * @param string $method The method name.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_taxonomy_fields', array( 'labels', 'cap', 'object_type' ), 'wp.getTaxonomy' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getTaxonomy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! taxonomy_exists( $taxonomy ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomy = get_taxonomy( $taxonomy );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( $taxonomy-&gt;cap-&gt;assign_terms ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to assign terms in this taxonomy.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_taxonomy( $taxonomy, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve all taxonomies.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see get_taxonomies()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id  Blog ID (unused).&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     *     @type array  $filter   Optional. An array of arguments for retrieving taxonomies.&nbsp;</div></li><li><div>     *     @type array  $fields   Optional. The subset of taxonomy fields to return.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error An associative array of taxonomy data with returned fields determined&nbsp;</div></li><li><div>     *                         by `$fields`, or an IXR_Error instance on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getTaxonomies( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 3 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $filter = isset( $args[3] ) ? $args[3] : array( 'public' =&gt; true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_taxonomy_fields', array( 'labels', 'cap', 'object_type' ), 'wp.getTaxonomies' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getTaxonomies' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxonomies = get_taxonomies( $filter, 'objects' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // holds all the taxonomy data&nbsp;</div></li><li><div>        $struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $taxonomies as $taxonomy ) {&nbsp;</div></li><li><div>            // capability check for post_types&nbsp;</div></li><li><div>            if ( ! current_user_can( $taxonomy-&gt;cap-&gt;assign_terms ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $struct[] = $this-&gt;_prepare_taxonomy( $taxonomy, $fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The optional $fields parameter specifies what fields will be included&nbsp;</div></li><li><div>     * in the response array. This should be a list of field names. 'user_id' will&nbsp;</div></li><li><div>     * always be included in the response regardless of the value of $fields.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Instead of, or in addition to, individual field names, conceptual group&nbsp;</div></li><li><div>     * names can be used to specify multiple fields. The available conceptual&nbsp;</div></li><li><div>     * groups are 'basic' and 'all'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses get_userdata()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $user_id&nbsp;</div></li><li><div>     *     @type array  $fields (optional)&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Array contains (based on $fields parameter):&nbsp;</div></li><li><div>     *  - 'user_id'&nbsp;</div></li><li><div>     *  - 'username'&nbsp;</div></li><li><div>     *  - 'first_name'&nbsp;</div></li><li><div>     *  - 'last_name'&nbsp;</div></li><li><div>     *  - 'registered'&nbsp;</div></li><li><div>     *  - 'bio'&nbsp;</div></li><li><div>     *  - 'email'&nbsp;</div></li><li><div>     *  - 'nickname'&nbsp;</div></li><li><div>     *  - 'nicename'&nbsp;</div></li><li><div>     *  - 'url'&nbsp;</div></li><li><div>     *  - 'display_name'&nbsp;</div></li><li><div>     *  - 'roles'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getUser( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $user_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters the default user query fields used by the given XML-RPC method.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.5.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array  $fields User query fields for given method. Default 'all'.&nbsp;</div></li><li><div>             * @param string $method The method name.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_user_fields', array( 'all' ), 'wp.getUser' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getUser' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_user', $user_id ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this user.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $user_data = get_userdata( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user_data )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid user ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_user( $user_data, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve users.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The optional $filter parameter modifies the query used to retrieve users.&nbsp;</div></li><li><div>     * Accepted keys are 'number' (default: 50), 'offset' (default: 0), 'role', &nbsp;</div></li><li><div>     * 'who', 'orderby', and 'order'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The optional $fields parameter specifies what fields will be included&nbsp;</div></li><li><div>     * in the response array.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses get_users()&nbsp;</div></li><li><div>     * @see wp_getUser() for more on $fields and return values&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $filter (optional)&nbsp;</div></li><li><div>     *     @type array  $fields (optional)&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error users data&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getUsers( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 3 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $filter = isset( $args[3] ) ? $args[3] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_user_fields', array( 'all' ), 'wp.getUsers' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getUsers' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'list_users' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to list users.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $query = array( 'fields' =&gt; 'all_with_meta' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $query['number'] = ( isset( $filter['number'] ) ) ? absint( $filter['number'] ) : 50;&nbsp;</div></li><li><div>        $query['offset'] = ( isset( $filter['offset'] ) ) ? absint( $filter['offset'] ) : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['orderby'] ) ) {&nbsp;</div></li><li><div>            $query['orderby'] = $filter['orderby'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $filter['order'] ) )&nbsp;</div></li><li><div>                $query['order'] = $filter['order'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['role'] ) ) {&nbsp;</div></li><li><div>            if ( get_role( $filter['role'] ) === null )&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( 'Invalid role.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $query['role'] = $filter['role'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $filter['who'] ) ) {&nbsp;</div></li><li><div>            $query['who'] = $filter['who'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $users = get_users( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_users = array();&nbsp;</div></li><li><div>        foreach ( $users as $user_data ) {&nbsp;</div></li><li><div>            if ( current_user_can( 'edit_user', $user_data-&gt;ID ) )&nbsp;</div></li><li><div>                $_users[] = $this-&gt;_prepare_user( $user_data, $fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $_users;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve information about the requesting user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses get_userdata()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $fields (optional)&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error (@see wp_getUser)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getProfile( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 3 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[3] ) ) {&nbsp;</div></li><li><div>            $fields = $args[3];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_user_fields', array( 'all' ), 'wp.getProfile' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getProfile' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_user', $user-&gt;ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit your profile.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $user_data = get_userdata( $user-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_user( $user_data, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edit user's profile.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses wp_update_user()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $content_struct It can optionally contain:&nbsp;</div></li><li><div>     *      - 'first_name'&nbsp;</div></li><li><div>     *      - 'last_name'&nbsp;</div></li><li><div>     *      - 'website'&nbsp;</div></li><li><div>     *      - 'display_name'&nbsp;</div></li><li><div>     *      - 'nickname'&nbsp;</div></li><li><div>     *      - 'nicename'&nbsp;</div></li><li><div>     *      - 'bio'&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True, on success.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_editProfile( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $content_struct = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.editProfile' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_user', $user-&gt;ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit your profile.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // holds data of the user&nbsp;</div></li><li><div>        $user_data = array();&nbsp;</div></li><li><div>        $user_data['ID'] = $user-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // only set the user details if it was given&nbsp;</div></li><li><div>        if ( isset( $content_struct['first_name'] ) )&nbsp;</div></li><li><div>            $user_data['first_name'] = $content_struct['first_name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['last_name'] ) )&nbsp;</div></li><li><div>            $user_data['last_name'] = $content_struct['last_name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['url'] ) )&nbsp;</div></li><li><div>            $user_data['user_url'] = $content_struct['url'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['display_name'] ) )&nbsp;</div></li><li><div>            $user_data['display_name'] = $content_struct['display_name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['nickname'] ) )&nbsp;</div></li><li><div>            $user_data['nickname'] = $content_struct['nickname'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['nicename'] ) )&nbsp;</div></li><li><div>            $user_data['user_nicename'] = $content_struct['nicename'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['bio'] ) )&nbsp;</div></li><li><div>            $user_data['description'] = $content_struct['bio'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = wp_update_user( $user_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $result ) )&nbsp;</div></li><li><div>            return new IXR_Error( 500, $result-&gt;get_error_message() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $result )&nbsp;</div></li><li><div>            return new IXR_Error( 500, __( 'Sorry, the user cannot be updated.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type int    $page_id&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPage( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $page_id = (int) $args[1];&nbsp;</div></li><li><div>        $username = $args[2];&nbsp;</div></li><li><div>        $password = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $page = get_post($page_id);&nbsp;</div></li><li><div>        if ( ! $page )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_page', $page_id ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this page.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPage' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we found the page then format the data.&nbsp;</div></li><li><div>        if ( $page-&gt;ID && ($page-&gt;post_type == 'page') ) {&nbsp;</div></li><li><div>            return $this-&gt;_prepare_page( $page );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // If the page doesn't exist indicate that.&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Sorry, no such page.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve Pages.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $num_pages&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPages( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $num_pages = isset($args[3]) ? (int) $args[3] : 10;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_pages' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit pages.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPages' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pages = get_posts( array('post_type' =&gt; 'page', 'post_status' =&gt; 'any', 'numberposts' =&gt; $num_pages) );&nbsp;</div></li><li><div>        $num_pages = count($pages);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we have pages, put together their info.&nbsp;</div></li><li><div>        if ( $num_pages &gt;= 1 ) {&nbsp;</div></li><li><div>            $pages_struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ($pages as $page) {&nbsp;</div></li><li><div>                if ( current_user_can( 'edit_page', $page-&gt;ID ) )&nbsp;</div></li><li><div>                    $pages_struct[] = $this-&gt;_prepare_page( $page );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $pages_struct;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create new page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wp_xmlrpc_server::mw_newPost()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $content_struct&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_newPage( $args ) {&nbsp;</div></li><li><div>        // Items not escaped here will be escaped in newPost.&nbsp;</div></li><li><div>        $username = $this-&gt;escape( $args[1] );&nbsp;</div></li><li><div>        $password = $this-&gt;escape( $args[2] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.newPage' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Mark this as content for a page.&nbsp;</div></li><li><div>        $args[3][&quot;post_type&quot;] = 'page';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let mw_newPost do all of the heavy lifting.&nbsp;</div></li><li><div>        return $this-&gt;mw_newPost( $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $page_id&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True, if success.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_deletePage( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $page_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.deletePage' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the current page based on the page_id and&nbsp;</div></li><li><div>        // make sure it is a page and not a post.&nbsp;</div></li><li><div>        $actual_page = get_post($page_id, ARRAY_A);&nbsp;</div></li><li><div>        if ( !$actual_page || ($actual_page['post_type'] != 'page') )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Sorry, no such page.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure the user can delete pages.&nbsp;</div></li><li><div>        if ( !current_user_can('delete_page', $page_id) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to delete this page.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Attempt to delete the page.&nbsp;</div></li><li><div>        $result = wp_delete_post($page_id);&nbsp;</div></li><li><div>        if ( !$result )&nbsp;</div></li><li><div>            return new IXR_Error( 500, __( 'Failed to delete the page.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a page has been successfully deleted via XML-RPC.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $page_id ID of the deleted page.&nbsp;</div></li><li><div>         * @param array $args    An array of arguments to delete the page.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_wp_deletePage', $page_id, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edit page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type int    $page_id&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type string $content&nbsp;</div></li><li><div>     *     @type string $publish&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_editPage( $args ) {&nbsp;</div></li><li><div>        // Items will be escaped in mw_editPost.&nbsp;</div></li><li><div>        $page_id = (int) $args[1];&nbsp;</div></li><li><div>        $username = $args[2];&nbsp;</div></li><li><div>        $password = $args[3];&nbsp;</div></li><li><div>        $content = $args[4];&nbsp;</div></li><li><div>        $publish = $args[5];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $escaped_username = $this-&gt;escape( $username );&nbsp;</div></li><li><div>        $escaped_password = $this-&gt;escape( $password );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login( $escaped_username, $escaped_password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.editPage' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the page data and make sure it is a page.&nbsp;</div></li><li><div>        $actual_page = get_post($page_id, ARRAY_A);&nbsp;</div></li><li><div>        if ( !$actual_page || ($actual_page['post_type'] != 'page') )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Sorry, no such page.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure the user is allowed to edit pages.&nbsp;</div></li><li><div>        if ( !current_user_can('edit_page', $page_id) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this page.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Mark this as content for a page.&nbsp;</div></li><li><div>        $content['post_type'] = 'page';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Arrange args in the way mw_editPost understands.&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>            $page_id, &nbsp;</div></li><li><div>            $username, &nbsp;</div></li><li><div>            $password, &nbsp;</div></li><li><div>            $content, &nbsp;</div></li><li><div>            $publish&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let mw_editPost do all of the heavy lifting.&nbsp;</div></li><li><div>        return $this-&gt;mw_editPost( $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve page list.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global wpdb $wpdb WordPress database abstraction object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPageList( $args ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_pages' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit pages.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPageList' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get list of pages ids and titles&nbsp;</div></li><li><div>        $page_list = $wpdb-&gt;get_results(&quot;&nbsp;</div></li><li><div>            SELECT ID page_id, &nbsp;</div></li><li><div>                post_title page_title, &nbsp;</div></li><li><div>                post_parent page_parent_id, &nbsp;</div></li><li><div>                post_date_gmt, &nbsp;</div></li><li><div>                post_date, &nbsp;</div></li><li><div>                post_status&nbsp;</div></li><li><div>            FROM {$wpdb-&gt;posts}&nbsp;</div></li><li><div>            WHERE post_type = 'page'&nbsp;</div></li><li><div>            ORDER BY ID&nbsp;</div></li><li><div>        &quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The date needs to be formatted properly.&nbsp;</div></li><li><div>        $num_pages = count($page_list);&nbsp;</div></li><li><div>        for ( $i = 0; $i &lt; $num_pages; $i++ ) {&nbsp;</div></li><li><div>            $page_list[$i]-&gt;dateCreated = $this-&gt;_convert_date(  $page_list[$i]-&gt;post_date );&nbsp;</div></li><li><div>            $page_list[$i]-&gt;date_created_gmt = $this-&gt;_convert_date_gmt( $page_list[$i]-&gt;post_date_gmt, $page_list[$i]-&gt;post_date );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset($page_list[$i]-&gt;post_date_gmt);&nbsp;</div></li><li><div>            unset($page_list[$i]-&gt;post_date);&nbsp;</div></li><li><div>            unset($page_list[$i]-&gt;post_status);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $page_list;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve authors list.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getAuthors( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can('edit_posts') )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit posts.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getAuthors' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $authors = array();&nbsp;</div></li><li><div>        foreach ( get_users( array( 'fields' =&gt; array('ID', 'user_login', 'display_name') ) ) as $user ) {&nbsp;</div></li><li><div>            $authors[] = array(&nbsp;</div></li><li><div>                'user_id' =&gt; $user-&gt;ID, &nbsp;</div></li><li><div>                'user_login' =&gt; $user-&gt;user_login, &nbsp;</div></li><li><div>                'display_name' =&gt; $user-&gt;display_name&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $authors;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get list of all tags&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.7.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getTags( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you must be able to edit posts on this site in order to view tags.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getKeywords' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tags = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $all_tags = get_tags() ) {&nbsp;</div></li><li><div>            foreach ( (array) $all_tags as $tag ) {&nbsp;</div></li><li><div>                $struct = array();&nbsp;</div></li><li><div>                $struct['tag_id'] = $tag-&gt;term_id;&nbsp;</div></li><li><div>                $struct['name'] = $tag-&gt;name;&nbsp;</div></li><li><div>                $struct['count'] = $tag-&gt;count;&nbsp;</div></li><li><div>                $struct['slug'] = $tag-&gt;slug;&nbsp;</div></li><li><div>                $struct['html_url'] = esc_html( get_tag_link( $tag-&gt;term_id ) );&nbsp;</div></li><li><div>                $struct['rss_url'] = esc_html( get_tag_feed_link( $tag-&gt;term_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $tags[] = $struct;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $tags;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create new category.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $category&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error Category ID.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_newCategory( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $category = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.newCategory' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure the user is allowed to add a category.&nbsp;</div></li><li><div>        if ( !current_user_can('manage_categories') )&nbsp;</div></li><li><div>            return new IXR_Error(401, __('Sorry, you are not allowed to add a category.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If no slug was provided make it empty so that&nbsp;</div></li><li><div>        // WordPress will generate one.&nbsp;</div></li><li><div>        if ( empty($category['slug']) )&nbsp;</div></li><li><div>            $category['slug'] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If no parent_id was provided make it empty&nbsp;</div></li><li><div>        // so that it will be a top level page (no parent).&nbsp;</div></li><li><div>        if ( !isset($category['parent_id']) )&nbsp;</div></li><li><div>            $category['parent_id'] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If no description was provided make it empty.&nbsp;</div></li><li><div>        if ( empty($category[&quot;description&quot;]) )&nbsp;</div></li><li><div>            $category[&quot;description&quot;] = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $new_category = array(&nbsp;</div></li><li><div>            'cat_name' =&gt; $category['name'], &nbsp;</div></li><li><div>            'category_nicename' =&gt; $category['slug'], &nbsp;</div></li><li><div>            'category_parent' =&gt; $category['parent_id'], &nbsp;</div></li><li><div>            'category_description' =&gt; $category['description']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cat_id = wp_insert_category($new_category, true);&nbsp;</div></li><li><div>        if ( is_wp_error( $cat_id ) ) {&nbsp;</div></li><li><div>            if ( 'term_exists' == $cat_id-&gt;get_error_code() )&nbsp;</div></li><li><div>                return (int) $cat_id-&gt;get_error_data();&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                return new IXR_Error(500, __('Sorry, the new category failed.'));&nbsp;</div></li><li><div>        } elseif ( ! $cat_id ) {&nbsp;</div></li><li><div>            return new IXR_Error(500, __('Sorry, the new category failed.'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a new category has been successfully created via XML-RPC.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $cat_id ID of the new category.&nbsp;</div></li><li><div>         * @param array $args   An array of new category arguments.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_wp_newCategory', $cat_id, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $cat_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove category.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $category_id&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return bool|IXR_Error See wp_delete_term() for return info.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_deleteCategory( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $category_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.deleteCategory' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can('manage_categories') )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to delete a category.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $status = wp_delete_term( $category_id, 'category' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true == $status ) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Fires after a category has been successfully deleted via XML-RPC.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.4.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param int   $category_id ID of the deleted category.&nbsp;</div></li><li><div>             * @param array $args        An array of arguments to delete the category.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            do_action( 'xmlrpc_call_success_wp_deleteCategory', $category_id, $args );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $status;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve category list.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $category&nbsp;</div></li><li><div>     *     @type int    $max_results&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_suggestCategories( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $category = $args[3];&nbsp;</div></li><li><div>        $max_results = (int) $args[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you must be able to edit posts on this site in order to view categories.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.suggestCategories' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $category_suggestions = array();&nbsp;</div></li><li><div>        $args = array('get' =&gt; 'all', 'number' =&gt; $max_results, 'name__like' =&gt; $category);&nbsp;</div></li><li><div>        foreach ( (array) get_categories($args) as $cat ) {&nbsp;</div></li><li><div>            $category_suggestions[] = array(&nbsp;</div></li><li><div>                'category_id' =&gt; $cat-&gt;term_id, &nbsp;</div></li><li><div>                'category_name' =&gt; $cat-&gt;name&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $category_suggestions;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve comment.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.7.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $comment_id&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getComment($args) {&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $comment_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getComment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $comment = get_comment( $comment_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid comment ID.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_comment', $comment_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed to moderate or edit this comment.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_comment( $comment );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve comments.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Besides the common blog_id (unused), username, and password arguments, it takes a filter&nbsp;</div></li><li><div>     * array as last argument.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Accepted 'filter' keys are 'status', 'post_id', 'offset', and 'number'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The defaults are as follows:&nbsp;</div></li><li><div>     * - 'status' - Default is ''. Filter by status (e.g., 'approve', 'hold')&nbsp;</div></li><li><div>     * - 'post_id' - Default is ''. The post where the comment is posted. Empty string shows all comments.&nbsp;</div></li><li><div>     * - 'number' - Default is 10. Total number of media items to retrieve.&nbsp;</div></li><li><div>     * - 'offset' - Default is 0. See WP_Query::query() for more.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.7.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $struct&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Contains a collection of comments. See wp_xmlrpc_server::wp_getComment() for a description of each item contents&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getComments( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $struct = isset( $args[3] ) ? $args[3] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getComments' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $struct['status'] ) ) {&nbsp;</div></li><li><div>            $status = $struct['status'];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $status = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'moderate_comments' ) && 'approve' !== $status ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Invalid comment status.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_id = '';&nbsp;</div></li><li><div>        if ( isset( $struct['post_id'] ) ) {&nbsp;</div></li><li><div>            $post_id = absint( $struct['post_id'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_type = '';&nbsp;</div></li><li><div>        if ( isset( $struct['post_type'] ) ) {&nbsp;</div></li><li><div>            $post_type_object = get_post_type_object( $struct['post_type'] );&nbsp;</div></li><li><div>            if ( ! $post_type_object || ! post_type_supports( $post_type_object-&gt;name, 'comments' ) ) {&nbsp;</div></li><li><div>                return new IXR_Error( 404, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $post_type = $struct['post_type'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $offset = 0;&nbsp;</div></li><li><div>        if ( isset( $struct['offset'] ) ) {&nbsp;</div></li><li><div>            $offset = absint( $struct['offset'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $number = 10;&nbsp;</div></li><li><div>        if ( isset( $struct['number'] ) ) {&nbsp;</div></li><li><div>            $number = absint( $struct['number'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comments = get_comments( array(&nbsp;</div></li><li><div>            'status' =&gt; $status, &nbsp;</div></li><li><div>            'post_id' =&gt; $post_id, &nbsp;</div></li><li><div>            'offset' =&gt; $offset, &nbsp;</div></li><li><div>            'number' =&gt; $number, &nbsp;</div></li><li><div>            'post_type' =&gt; $post_type, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comments_struct = array();&nbsp;</div></li><li><div>        if ( is_array( $comments ) ) {&nbsp;</div></li><li><div>            foreach ( $comments as $comment ) {&nbsp;</div></li><li><div>                $comments_struct[] = $this-&gt;_prepare_comment( $comment );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $comments_struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete a comment.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * By default, the comment will be moved to the trash instead of deleted.&nbsp;</div></li><li><div>     * See wp_delete_comment() for more information on this behavior.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.7.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $comment_ID&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return bool|IXR_Error See wp_delete_comment().&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_deleteComment( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $comment_ID = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! get_comment( $comment_ID ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid comment ID.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_comment', $comment_ID ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed to moderate or edit this comment.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.deleteComment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $status = wp_delete_comment( $comment_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $status ) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Fires after a comment has been successfully deleted via XML-RPC.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.4.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param int   $comment_ID ID of the deleted comment.&nbsp;</div></li><li><div>             * @param array $args       An array of arguments to delete the comment.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            do_action( 'xmlrpc_call_success_wp_deleteComment', $comment_ID, $args );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $status;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edit comment.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Besides the common blog_id (unused), username, and password arguments, it takes a&nbsp;</div></li><li><div>     * comment_id integer and a content_struct array as last argument.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The allowed keys in the content_struct array are:&nbsp;</div></li><li><div>     *  - 'author'&nbsp;</div></li><li><div>     *  - 'author_url'&nbsp;</div></li><li><div>     *  - 'author_email'&nbsp;</div></li><li><div>     *  - 'content'&nbsp;</div></li><li><div>     *  - 'date_created_gmt'&nbsp;</div></li><li><div>     *  - 'status'. Common statuses are 'approve', 'hold', 'spam'. See get_comment_statuses() for more details&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.7.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $comment_ID&nbsp;</div></li><li><div>     *     @type array  $content_struct&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True, on success.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_editComment( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $comment_ID = (int) $args[3];&nbsp;</div></li><li><div>        $content_struct = $args[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! get_comment( $comment_ID ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid comment ID.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_comment', $comment_ID ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed to moderate or edit this comment.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.editComment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['status']) ) {&nbsp;</div></li><li><div>            $statuses = get_comment_statuses();&nbsp;</div></li><li><div>            $statuses = array_keys($statuses);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! in_array($content_struct['status'], $statuses) )&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Invalid comment status.' ) );&nbsp;</div></li><li><div>            $comment_approved = $content_struct['status'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do some timestamp voodoo&nbsp;</div></li><li><div>        if ( !empty( $content_struct['date_created_gmt'] ) ) {&nbsp;</div></li><li><div>            // We know this is supposed to be GMT, so we're going to slap that Z on there by force&nbsp;</div></li><li><div>            $dateCreated = rtrim( $content_struct['date_created_gmt']-&gt;getIso(), 'Z' ) . 'Z';&nbsp;</div></li><li><div>            $comment_date = get_date_from_gmt(iso8601_to_datetime($dateCreated));&nbsp;</div></li><li><div>            $comment_date_gmt = iso8601_to_datetime($dateCreated, 'GMT');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['content']) )&nbsp;</div></li><li><div>            $comment_content = $content_struct['content'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['author']) )&nbsp;</div></li><li><div>            $comment_author = $content_struct['author'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['author_url']) )&nbsp;</div></li><li><div>            $comment_author_url = $content_struct['author_url'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['author_email']) )&nbsp;</div></li><li><div>            $comment_author_email = $content_struct['author_email'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // We've got all the data -- post it:&nbsp;</div></li><li><div>        $comment = compact('comment_ID', 'comment_content', 'comment_approved', 'comment_date', 'comment_date_gmt', 'comment_author', 'comment_author_email', 'comment_author_url');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = wp_update_comment($comment);&nbsp;</div></li><li><div>        if ( is_wp_error( $result ) )&nbsp;</div></li><li><div>            return new IXR_Error(500, $result-&gt;get_error_message());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$result )&nbsp;</div></li><li><div>            return new IXR_Error(500, __('Sorry, the comment could not be edited.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a comment has been successfully updated via XML-RPC.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $comment_ID ID of the updated comment.&nbsp;</div></li><li><div>         * @param array $args       An array of arguments to update the comment.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_wp_editComment', $comment_ID, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create new comment.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.7.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int        $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string     $username&nbsp;</div></li><li><div>     *     @type string     $password&nbsp;</div></li><li><div>     *     @type string|int $post&nbsp;</div></li><li><div>     *     @type array      $content_struct&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error See wp_new_comment().&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_newComment($args) {&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $post = $args[3];&nbsp;</div></li><li><div>        $content_struct = $args[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether to allow anonymous comments over XML-RPC.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.7.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool $allow Whether to allow anonymous commenting via XML-RPC.&nbsp;</div></li><li><div>         *                    Default false.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $allow_anon = apply_filters( 'xmlrpc_allow_anonymous_comments', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $user = $this-&gt;login($username, $password);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user ) {&nbsp;</div></li><li><div>            $logged_in = false;&nbsp;</div></li><li><div>            if ( $allow_anon && get_option('comment_registration') ) {&nbsp;</div></li><li><div>                return new IXR_Error( 403, __( 'You must be registered to comment.' ) );&nbsp;</div></li><li><div>            } elseif ( ! $allow_anon ) {&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $logged_in = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_numeric($post) )&nbsp;</div></li><li><div>            $post_id = absint($post);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $post_id = url_to_postid($post);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $post_id ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! get_post( $post_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! comments_open( $post_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, comments are closed for this item.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $content_struct['content'] ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Comment is required.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comment = array(&nbsp;</div></li><li><div>            'comment_post_ID' =&gt; $post_id, &nbsp;</div></li><li><div>            'comment_content' =&gt; $content_struct['content'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $logged_in ) {&nbsp;</div></li><li><div>            $display_name = $user-&gt;display_name;&nbsp;</div></li><li><div>            $user_email = $user-&gt;user_email;&nbsp;</div></li><li><div>            $user_url = $user-&gt;user_url;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $comment['comment_author'] = $this-&gt;escape( $display_name );&nbsp;</div></li><li><div>            $comment['comment_author_email'] = $this-&gt;escape( $user_email );&nbsp;</div></li><li><div>            $comment['comment_author_url'] = $this-&gt;escape( $user_url );&nbsp;</div></li><li><div>            $comment['user_ID'] = $user-&gt;ID;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $comment['comment_author'] = '';&nbsp;</div></li><li><div>            if ( isset($content_struct['author']) )&nbsp;</div></li><li><div>                $comment['comment_author'] = $content_struct['author'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $comment['comment_author_email'] = '';&nbsp;</div></li><li><div>            if ( isset($content_struct['author_email']) )&nbsp;</div></li><li><div>                $comment['comment_author_email'] = $content_struct['author_email'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $comment['comment_author_url'] = '';&nbsp;</div></li><li><div>            if ( isset($content_struct['author_url']) )&nbsp;</div></li><li><div>                $comment['comment_author_url'] = $content_struct['author_url'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $comment['user_ID'] = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( get_option('require_name_email') ) {&nbsp;</div></li><li><div>                if ( 6 &gt; strlen($comment['comment_author_email']) || '' == $comment['comment_author'] )&nbsp;</div></li><li><div>                    return new IXR_Error( 403, __( 'Comment author name and email are required.' ) );&nbsp;</div></li><li><div>                elseif ( !is_email($comment['comment_author_email']) )&nbsp;</div></li><li><div>                    return new IXR_Error( 403, __( 'A valid email address is required.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comment['comment_parent'] = isset($content_struct['comment_parent']) ? absint($content_struct['comment_parent']) : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.newComment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comment_ID = wp_new_comment( $comment, true );&nbsp;</div></li><li><div>        if ( is_wp_error( $comment_ID ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, $comment_ID-&gt;get_error_message() );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $comment_ID ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'An unknown error occurred' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a new comment has been successfully created via XML-RPC.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $comment_ID ID of the new comment.&nbsp;</div></li><li><div>         * @param array $args       An array of new comment arguments.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_wp_newComment', $comment_ID, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $comment_ID;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve all of the comment status.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.7.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getCommentStatusList( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'publish_posts' ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed access to details about this site.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getCommentStatusList' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return get_comment_statuses();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve comment count.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $post_id&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getCommentCount( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $post_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post = get_post( $post_id, ARRAY_A );&nbsp;</div></li><li><div>        if ( empty( $post['ID'] ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_post', $post_id ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed access to details of this post.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getCommentCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $count = wp_count_comments( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array(&nbsp;</div></li><li><div>            'approved' =&gt; $count-&gt;approved, &nbsp;</div></li><li><div>            'awaiting_moderation' =&gt; $count-&gt;moderated, &nbsp;</div></li><li><div>            'spam' =&gt; $count-&gt;spam, &nbsp;</div></li><li><div>            'total_comments' =&gt; $count-&gt;total_comments&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve post statuses.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPostStatusList( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed access to details about this site.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPostStatusList' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return get_post_statuses();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve page statuses.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPageStatusList( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_pages' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed access to details about this site.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPageStatusList' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return get_page_statuses();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve page templates.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPageTemplates( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_pages' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed access to details about this site.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $templates = get_page_templates();&nbsp;</div></li><li><div>        $templates['Default'] = 'default';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $templates;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve blog options.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $options&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getOptions( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $options = isset( $args[3] ) ? (array) $args[3] : array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If no specific options where asked for, return all of them&nbsp;</div></li><li><div>        if ( count( $options ) == 0 )&nbsp;</div></li><li><div>            $options = array_keys($this-&gt;blog_options);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_getOptions($options);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve blog options value from list.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $options Options to retrieve.&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function _getOptions($options) {&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>        $can_manage = current_user_can( 'manage_options' );&nbsp;</div></li><li><div>        foreach ( $options as $option ) {&nbsp;</div></li><li><div>            if ( array_key_exists( $option, $this-&gt;blog_options ) ) {&nbsp;</div></li><li><div>                $data[$option] = $this-&gt;blog_options[$option];&nbsp;</div></li><li><div>                //Is the value static or dynamic?&nbsp;</div></li><li><div>                if ( isset( $data[$option]['option'] ) ) {&nbsp;</div></li><li><div>                    $data[$option]['value'] = get_option( $data[$option]['option'] );&nbsp;</div></li><li><div>                    unset($data[$option]['option']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! $can_manage )&nbsp;</div></li><li><div>                    $data[$option]['readonly'] = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update blog options.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $options&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_setOptions( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $options = (array) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'manage_options' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed to update options.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $option_names = array();&nbsp;</div></li><li><div>        foreach ( $options as $o_name =&gt; $o_value ) {&nbsp;</div></li><li><div>            $option_names[] = $o_name;&nbsp;</div></li><li><div>            if ( !array_key_exists( $o_name, $this-&gt;blog_options ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $this-&gt;blog_options[$o_name]['readonly'] == true )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            update_option( $this-&gt;blog_options[$o_name]['option'], wp_unslash( $o_value ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Now return the updated values&nbsp;</div></li><li><div>        return $this-&gt;_getOptions($option_names);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a media item by ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $attachment_id&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Associative array contains:&nbsp;</div></li><li><div>     *  - 'date_created_gmt'&nbsp;</div></li><li><div>     *  - 'parent'&nbsp;</div></li><li><div>     *  - 'link'&nbsp;</div></li><li><div>     *  - 'thumbnail'&nbsp;</div></li><li><div>     *  - 'title'&nbsp;</div></li><li><div>     *  - 'caption'&nbsp;</div></li><li><div>     *  - 'description'&nbsp;</div></li><li><div>     *  - 'metadata'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getMediaItem( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $attachment_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'upload_files' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed to upload files.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getMediaItem' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $attachment = get_post($attachment_id) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid attachment ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_media_item( $attachment );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a collection of media library items (or attachments)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Besides the common blog_id (unused), username, and password arguments, it takes a filter&nbsp;</div></li><li><div>     * array as last argument.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Accepted 'filter' keys are 'parent_id', 'mime_type', 'offset', and 'number'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The defaults are as follows:&nbsp;</div></li><li><div>     * - 'number' - Default is 5. Total number of media items to retrieve.&nbsp;</div></li><li><div>     * - 'offset' - Default is 0. See WP_Query::query() for more.&nbsp;</div></li><li><div>     * - 'parent_id' - Default is ''. The post where the media item is attached. Empty string shows all media items. 0 shows unattached media items.&nbsp;</div></li><li><div>     * - 'mime_type' - Default is ''. Filter by mime type (e.g., 'image/jpeg', 'application/pdf')&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $struct&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Contains a collection of media items. See wp_xmlrpc_server::wp_getMediaItem() for a description of each item contents&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getMediaLibrary($args) {&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $struct = isset( $args[3] ) ? $args[3] : array() ;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'upload_files' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to upload files.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getMediaLibrary' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $parent_id = ( isset($struct['parent_id']) ) ? absint($struct['parent_id']) : '' ;&nbsp;</div></li><li><div>        $mime_type = ( isset($struct['mime_type']) ) ? $struct['mime_type'] : '' ;&nbsp;</div></li><li><div>        $offset = ( isset($struct['offset']) ) ? absint($struct['offset']) : 0 ;&nbsp;</div></li><li><div>        $number = ( isset($struct['number']) ) ? absint($struct['number']) : -1 ;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $attachments = get_posts( array('post_type' =&gt; 'attachment', 'post_parent' =&gt; $parent_id, 'offset' =&gt; $offset, 'numberposts' =&gt; $number, 'post_mime_type' =&gt; $mime_type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $attachments_struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($attachments as $attachment )&nbsp;</div></li><li><div>            $attachments_struct[] = $this-&gt;_prepare_media_item( $attachment );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $attachments_struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a list of post formats used by the site.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error List of post formats, otherwise IXR_Error object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPostFormats( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Sorry, you are not allowed access to details about this site.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPostFormats' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $formats = get_post_format_strings();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // find out if they want a list of currently supports formats&nbsp;</div></li><li><div>        if ( isset( $args[3] ) && is_array( $args[3] ) ) {&nbsp;</div></li><li><div>            if ( $args[3]['show-supported'] ) {&nbsp;</div></li><li><div>                if ( current_theme_supports( 'post-formats' ) ) {&nbsp;</div></li><li><div>                    $supported = get_theme_support( 'post-formats' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $data = array();&nbsp;</div></li><li><div>                    $data['all'] = $formats;&nbsp;</div></li><li><div>                    $data['supported'] = $supported[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $formats = $data;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $formats;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a post type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see get_post_type_object()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type string $post_type_name&nbsp;</div></li><li><div>     *     @type array  $fields (optional)&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error Array contains:&nbsp;</div></li><li><div>     *  - 'labels'&nbsp;</div></li><li><div>     *  - 'description'&nbsp;</div></li><li><div>     *  - 'capability_type'&nbsp;</div></li><li><div>     *  - 'cap'&nbsp;</div></li><li><div>     *  - 'map_meta_cap'&nbsp;</div></li><li><div>     *  - 'hierarchical'&nbsp;</div></li><li><div>     *  - 'menu_position'&nbsp;</div></li><li><div>     *  - 'taxonomies'&nbsp;</div></li><li><div>     *  - 'supports'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPostType( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $post_type_name = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters the default query fields used by the given XML-RPC method.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.4.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array  $fields An array of post type query fields for the given method.&nbsp;</div></li><li><div>             * @param string $method The method name.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_posttype_fields', array( 'labels', 'cap', 'taxonomies' ), 'wp.getPostType' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPostType' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! post_type_exists( $post_type_name ) )&nbsp;</div></li><li><div>            return new IXR_Error( 403, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_type = get_post_type_object( $post_type_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( $post_type-&gt;cap-&gt;edit_posts ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit posts in this post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_prepare_post_type( $post_type, $fields );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a post types&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see get_post_types()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $filter (optional)&nbsp;</div></li><li><div>     *     @type array  $fields (optional)&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getPostTypes( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 3 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $filter = isset( $args[3] ) ? $args[3] : array( 'public' =&gt; true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_posttype_fields', array( 'labels', 'cap', 'taxonomies' ), 'wp.getPostTypes' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getPostTypes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_types = get_post_types( $filter, 'objects' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $post_types as $post_type ) {&nbsp;</div></li><li><div>            if ( ! current_user_can( $post_type-&gt;cap-&gt;edit_posts ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $struct[$post_type-&gt;name] = $this-&gt;_prepare_post_type( $post_type, $fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve revisions for a specific post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The optional $fields parameter specifies what fields will be included&nbsp;</div></li><li><div>     * in the response array.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses wp_get_post_revisions()&nbsp;</div></li><li><div>     * @see wp_getPost() for more on $fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $post_id&nbsp;</div></li><li><div>     *     @type array  $fields (optional)&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error contains a collection of posts.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_getRevisions( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 4 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $post_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $args[4] ) ) {&nbsp;</div></li><li><div>            $fields = $args[4];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Filters the default revision query fields used by the given XML-RPC method.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.5.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param array  $field  An array of revision query fields.&nbsp;</div></li><li><div>             * @param string $method The method name.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $fields = apply_filters( 'xmlrpc_default_revision_fields', array( 'post_date', 'post_date_gmt' ), 'wp.getRevisions' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.getRevisions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $post = get_post( $post_id ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_post', $post_id ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit posts.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if revisions are enabled.&nbsp;</div></li><li><div>        if ( ! wp_revisions_enabled( $post ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, revisions are disabled.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $revisions = wp_get_post_revisions( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $revisions )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $revisions as $revision ) {&nbsp;</div></li><li><div>            if ( ! current_user_can( 'read_post', $revision-&gt;ID ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Skip autosaves&nbsp;</div></li><li><div>            if ( wp_is_post_autosave( $revision ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $struct[] = $this-&gt;_prepare_post( get_object_vars( $revision ), $fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Restore a post revision&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses wp_restore_post_revision()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $revision_id&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return bool|IXR_Error false if there was an error restoring, true if success.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_restoreRevision( $args ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 3 ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $revision_id = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'wp.restoreRevision' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $revision = wp_get_post_revision( $revision_id ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( wp_is_post_autosave( $revision ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $post = get_post( $revision-&gt;post_parent ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_post', $revision-&gt;post_parent ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if revisions are disabled.&nbsp;</div></li><li><div>        if ( ! wp_revisions_enabled( $post ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, revisions are disabled.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post = wp_restore_post_revision( $revision_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return (bool) $post;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Blogger API functions.&nbsp;</div></li><li><div>     * specs on http://plant.blogger.com/api and https://groups.yahoo.com/group/bloggerDev/&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve blogs that user owns.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Will make more sense once we support multiple blogs.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_getUsersBlogs($args) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;minimum_args( $args, 3 ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_multisite() ) {&nbsp;</div></li><li><div>            return $this-&gt;_multisite_getUsersBlogs($args);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'blogger.getUsersBlogs' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $is_admin = current_user_can('manage_options');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $struct = array(&nbsp;</div></li><li><div>            'isAdmin' =&gt; $is_admin, &nbsp;</div></li><li><div>            'url' =&gt; get_option('home') . '/', &nbsp;</div></li><li><div>            'blogid' =&gt; '1', &nbsp;</div></li><li><div>            'blogName' =&gt; get_option('blogname'), &nbsp;</div></li><li><div>            'xmlrpc' =&gt; site_url( 'xmlrpc.php', 'rpc' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array($struct);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Private function for retrieving a users blogs for multisite setups&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.0.0&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type string $username Username.&nbsp;</div></li><li><div>     *     @type string $password Password.&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _multisite_getUsersBlogs( $args ) {&nbsp;</div></li><li><div>        $current_blog = get_site();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $domain = $current_blog-&gt;domain;&nbsp;</div></li><li><div>        $path = $current_blog-&gt;path . 'xmlrpc.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $rpc = new IXR_Client( set_url_scheme( &quot;http://{$domain}{$path}&quot; ) );&nbsp;</div></li><li><div>        $rpc-&gt;query('wp.getUsersBlogs', $args[1], $args[2]);&nbsp;</div></li><li><div>        $blogs = $rpc-&gt;getResponse();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($blogs['faultCode']) )&nbsp;</div></li><li><div>            return new IXR_Error($blogs['faultCode'], $blogs['faultString']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $_SERVER['HTTP_HOST'] == $domain && $_SERVER['REQUEST_URI'] == $path ) {&nbsp;</div></li><li><div>            return $blogs;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            foreach ( (array) $blogs as $blog ) {&nbsp;</div></li><li><div>                if ( strpos($blog['url'], $_SERVER['HTTP_HOST']) )&nbsp;</div></li><li><div>                    return array($blog);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve user's data.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Gives your client some info about you, so you don't have to.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_getUserInfo( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to access user data on this site.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'blogger.getUserInfo' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $struct = array(&nbsp;</div></li><li><div>            'nickname' =&gt; $user-&gt;nickname, &nbsp;</div></li><li><div>            'userid' =&gt; $user-&gt;ID, &nbsp;</div></li><li><div>            'url' =&gt; $user-&gt;user_url, &nbsp;</div></li><li><div>            'lastname' =&gt; $user-&gt;last_name, &nbsp;</div></li><li><div>            'firstname' =&gt; $user-&gt;first_name&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type int    $post_ID&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_getPost( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[1];&nbsp;</div></li><li><div>        $username = $args[2];&nbsp;</div></li><li><div>        $password = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_data = get_post($post_ID, ARRAY_A);&nbsp;</div></li><li><div>        if ( ! $post_data )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_post', $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'blogger.getPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $categories = implode(', ', wp_get_post_categories($post_ID));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $content = '&lt;title&gt;'.wp_unslash($post_data['post_title']).'&lt;/title&gt;';&nbsp;</div></li><li><div>        $content .= '&lt;category&gt;'.$categories.'&lt;/category&gt;';&nbsp;</div></li><li><div>        $content .= wp_unslash($post_data['post_content']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $struct = array(&nbsp;</div></li><li><div>            'userid' =&gt; $post_data['post_author'], &nbsp;</div></li><li><div>            'dateCreated' =&gt; $this-&gt;_convert_date( $post_data['post_date'] ), &nbsp;</div></li><li><div>            'content' =&gt; $content, &nbsp;</div></li><li><div>            'postid' =&gt; (string) $post_data['ID']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve list of recent posts.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type string $appkey (unused)&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $numberposts (optional)&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_getRecentPosts( $args ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // $args[0] = appkey - ignored&nbsp;</div></li><li><div>        $username = $args[2];&nbsp;</div></li><li><div>        $password = $args[3];&nbsp;</div></li><li><div>        if ( isset( $args[4] ) )&nbsp;</div></li><li><div>            $query = array( 'numberposts' =&gt; absint( $args[4] ) );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $query = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit posts.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'blogger.getRecentPosts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $posts_list = wp_get_recent_posts( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$posts_list ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error(500, __('Either there are no posts, or something went wrong.'));&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $recent_posts = array();&nbsp;</div></li><li><div>        foreach ($posts_list as $entry) {&nbsp;</div></li><li><div>            if ( !current_user_can( 'edit_post', $entry['ID'] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_date = $this-&gt;_convert_date( $entry['post_date'] );&nbsp;</div></li><li><div>            $categories = implode(', ', wp_get_post_categories($entry['ID']));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $content = '&lt;title&gt;'.wp_unslash($entry['post_title']).'&lt;/title&gt;';&nbsp;</div></li><li><div>            $content .= '&lt;category&gt;'.$categories.'&lt;/category&gt;';&nbsp;</div></li><li><div>            $content .= wp_unslash($entry['post_content']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $recent_posts[] = array(&nbsp;</div></li><li><div>                'userid' =&gt; $entry['post_author'], &nbsp;</div></li><li><div>                'dateCreated' =&gt; $post_date, &nbsp;</div></li><li><div>                'content' =&gt; $content, &nbsp;</div></li><li><div>                'postid' =&gt; (string) $entry['ID'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $recent_posts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deprecated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     * @deprecated 3.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args Unused.&nbsp;</div></li><li><div>     * @return IXR_Error Error object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_getTemplate($args) {&nbsp;</div></li><li><div>        return new IXR_Error( 403, __('Sorry, that file cannot be edited.' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deprecated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     * @deprecated 3.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args Unused.&nbsp;</div></li><li><div>     * @return IXR_Error Error object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_setTemplate($args) {&nbsp;</div></li><li><div>        return new IXR_Error( 403, __('Sorry, that file cannot be edited.' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Creates new post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type string $appkey (unused)&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type string $content&nbsp;</div></li><li><div>     *     @type string $publish&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_newPost( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[2];&nbsp;</div></li><li><div>        $password = $args[3];&nbsp;</div></li><li><div>        $content = $args[4];&nbsp;</div></li><li><div>        $publish = $args[5];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'blogger.newPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cap = ($publish) ? 'publish_posts' : 'edit_posts';&nbsp;</div></li><li><div>        if ( ! current_user_can( get_post_type_object( 'post' )-&gt;cap-&gt;create_posts ) || !current_user_can($cap) )&nbsp;</div></li><li><div>            return new IXR_Error(401, __('Sorry, you are not allowed to post on this site.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_status = ($publish) ? 'publish' : 'draft';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_author = $user-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_title = xmlrpc_getposttitle($content);&nbsp;</div></li><li><div>        $post_category = xmlrpc_getpostcategory($content);&nbsp;</div></li><li><div>        $post_content = xmlrpc_removepostdata($content);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_date = current_time('mysql');&nbsp;</div></li><li><div>        $post_date_gmt = current_time('mysql', 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_data = compact('post_author', 'post_date', 'post_date_gmt', 'post_content', 'post_title', 'post_category', 'post_status');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = wp_insert_post($post_data);&nbsp;</div></li><li><div>        if ( is_wp_error( $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error(500, $post_ID-&gt;get_error_message());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$post_ID )&nbsp;</div></li><li><div>            return new IXR_Error(500, __('Sorry, your entry could not be posted.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;attach_uploads( $post_ID, $post_content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a new post has been successfully created via the XML-RPC Blogger API.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $post_ID ID of the new post.&nbsp;</div></li><li><div>         * @param array $args    An array of new post arguments.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_blogger_newPost', $post_ID, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $post_ID;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edit a post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type int    $post_ID&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type string $content&nbsp;</div></li><li><div>     *     @type bool   $publish&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error true when done.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_editPost( $args ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[1];&nbsp;</div></li><li><div>        $username = $args[2];&nbsp;</div></li><li><div>        $password = $args[3];&nbsp;</div></li><li><div>        $content = $args[4];&nbsp;</div></li><li><div>        $publish = $args[5];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'blogger.editPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $actual_post = get_post( $post_ID, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $actual_post || $actual_post['post_type'] != 'post' ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Sorry, no such post.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape($actual_post);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_post', $post_ID ) ) {&nbsp;</div></li><li><div>            return new IXR_Error(401, __('Sorry, you are not allowed to edit this post.'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( 'publish' == $actual_post['post_status'] && ! current_user_can( 'publish_posts' ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to publish this post.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postdata = array();&nbsp;</div></li><li><div>        $postdata['ID'] = $actual_post['ID'];&nbsp;</div></li><li><div>        $postdata['post_content'] = xmlrpc_removepostdata( $content );&nbsp;</div></li><li><div>        $postdata['post_title'] = xmlrpc_getposttitle( $content );&nbsp;</div></li><li><div>        $postdata['post_category'] = xmlrpc_getpostcategory( $content );&nbsp;</div></li><li><div>        $postdata['post_status'] = $actual_post['post_status'];&nbsp;</div></li><li><div>        $postdata['post_excerpt'] = $actual_post['post_excerpt'];&nbsp;</div></li><li><div>        $postdata['post_status'] = $publish ? 'publish' : 'draft';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = wp_update_post( $postdata );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $result ) {&nbsp;</div></li><li><div>            return new IXR_Error(500, __('For some strange yet very annoying reason, this post could not be edited.'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;attach_uploads( $actual_post['ID'], $postdata['post_content'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a post has been successfully updated via the XML-RPC Blogger API.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $post_ID ID of the updated post.&nbsp;</div></li><li><div>         * @param array $args    An array of arguments for the post to edit.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_blogger_editPost', $post_ID, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove a post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type int    $post_ID&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True when post is deleted.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function blogger_deletePost( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[1];&nbsp;</div></li><li><div>        $username = $args[2];&nbsp;</div></li><li><div>        $password = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'blogger.deletePost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $actual_post = get_post( $post_ID, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $actual_post || $actual_post['post_type'] != 'post' ) {&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Sorry, no such post.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'delete_post', $post_ID ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to delete this post.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = wp_delete_post( $post_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $result ) {&nbsp;</div></li><li><div>            return new IXR_Error( 500, __( 'The post cannot be deleted.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a post has been successfully deleted via the XML-RPC Blogger API.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $post_ID ID of the deleted post.&nbsp;</div></li><li><div>         * @param array $args    An array of arguments to delete the post.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_blogger_deletePost', $post_ID, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** MetaWeblog API functions&nbsp;</div></li><li><div>     * specs on wherever Dave Winer wants them to be&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create a new post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The 'content_struct' argument must contain:&nbsp;</div></li><li><div>     *  - title&nbsp;</div></li><li><div>     *  - description&nbsp;</div></li><li><div>     *  - mt_excerpt&nbsp;</div></li><li><div>     *  - mt_text_more&nbsp;</div></li><li><div>     *  - mt_keywords&nbsp;</div></li><li><div>     *  - mt_tb_ping_urls&nbsp;</div></li><li><div>     *  - categories&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Also, it can optionally contain:&nbsp;</div></li><li><div>     *  - wp_slug&nbsp;</div></li><li><div>     *  - wp_password&nbsp;</div></li><li><div>     *  - wp_page_parent_id&nbsp;</div></li><li><div>     *  - wp_page_order&nbsp;</div></li><li><div>     *  - wp_author_id&nbsp;</div></li><li><div>     *  - post_status | page_status - can be 'draft', 'private', 'publish', or 'pending'&nbsp;</div></li><li><div>     *  - mt_allow_comments - can be 'open' or 'closed'&nbsp;</div></li><li><div>     *  - mt_allow_pings - can be 'open' or 'closed'&nbsp;</div></li><li><div>     *  - date_created_gmt&nbsp;</div></li><li><div>     *  - dateCreated&nbsp;</div></li><li><div>     *  - wp_post_thumbnail&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $content_struct&nbsp;</div></li><li><div>     *     @type int    $publish&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mw_newPost($args) {&nbsp;</div></li><li><div>        $this-&gt;escape($args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $content_struct = $args[3];&nbsp;</div></li><li><div>        $publish = isset( $args[4] ) ? $args[4] : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'metaWeblog.newPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $page_template = '';&nbsp;</div></li><li><div>        if ( !empty( $content_struct['post_type'] ) ) {&nbsp;</div></li><li><div>            if ( $content_struct['post_type'] == 'page' ) {&nbsp;</div></li><li><div>                if ( $publish )&nbsp;</div></li><li><div>                    $cap = 'publish_pages';&nbsp;</div></li><li><div>                elseif ( isset( $content_struct['page_status'] ) && 'publish' == $content_struct['page_status'] )&nbsp;</div></li><li><div>                    $cap = 'publish_pages';&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $cap = 'edit_pages';&nbsp;</div></li><li><div>                $error_message = __( 'Sorry, you are not allowed to publish pages on this site.' );&nbsp;</div></li><li><div>                $post_type = 'page';&nbsp;</div></li><li><div>                if ( !empty( $content_struct['wp_page_template'] ) )&nbsp;</div></li><li><div>                    $page_template = $content_struct['wp_page_template'];&nbsp;</div></li><li><div>            } elseif ( $content_struct['post_type'] == 'post' ) {&nbsp;</div></li><li><div>                if ( $publish )&nbsp;</div></li><li><div>                    $cap = 'publish_posts';&nbsp;</div></li><li><div>                elseif ( isset( $content_struct['post_status'] ) && 'publish' == $content_struct['post_status'] )&nbsp;</div></li><li><div>                    $cap = 'publish_posts';&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $cap = 'edit_posts';&nbsp;</div></li><li><div>                $error_message = __( 'Sorry, you are not allowed to publish posts on this site.' );&nbsp;</div></li><li><div>                $post_type = 'post';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // No other post_type values are allowed here&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( $publish )&nbsp;</div></li><li><div>                $cap = 'publish_posts';&nbsp;</div></li><li><div>            elseif ( isset( $content_struct['post_status'] ) && 'publish' == $content_struct['post_status'])&nbsp;</div></li><li><div>                $cap = 'publish_posts';&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $cap = 'edit_posts';&nbsp;</div></li><li><div>            $error_message = __( 'Sorry, you are not allowed to publish posts on this site.' );&nbsp;</div></li><li><div>            $post_type = 'post';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( get_post_type_object( $post_type )-&gt;cap-&gt;create_posts ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to publish posts on this site.' ) );&nbsp;</div></li><li><div>        if ( !current_user_can( $cap ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, $error_message );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for a valid post format if one was given&nbsp;</div></li><li><div>        if ( isset( $content_struct['wp_post_format'] ) ) {&nbsp;</div></li><li><div>            $content_struct['wp_post_format'] = sanitize_key( $content_struct['wp_post_format'] );&nbsp;</div></li><li><div>            if ( !array_key_exists( $content_struct['wp_post_format'], get_post_format_strings() ) ) {&nbsp;</div></li><li><div>                return new IXR_Error( 404, __( 'Invalid post format.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let WordPress generate the post_name (slug) unless&nbsp;</div></li><li><div>        // one has been provided.&nbsp;</div></li><li><div>        $post_name = &quot;&quot;;&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_slug']) )&nbsp;</div></li><li><div>            $post_name = $content_struct['wp_slug'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only use a password if one was given.&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_password']) )&nbsp;</div></li><li><div>            $post_password = $content_struct['wp_password'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only set a post parent if one was provided.&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_page_parent_id']) )&nbsp;</div></li><li><div>            $post_parent = $content_struct['wp_page_parent_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only set the menu_order if it was provided.&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_page_order']) )&nbsp;</div></li><li><div>            $menu_order = $content_struct['wp_page_order'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_author = $user-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an author id was provided then use it instead.&nbsp;</div></li><li><div>        if ( isset( $content_struct['wp_author_id'] ) && ( $user-&gt;ID != $content_struct['wp_author_id'] ) ) {&nbsp;</div></li><li><div>            switch ( $post_type ) {&nbsp;</div></li><li><div>                case &quot;post&quot;:&nbsp;</div></li><li><div>                    if ( !current_user_can( 'edit_others_posts' ) )&nbsp;</div></li><li><div>                        return new IXR_Error( 401, __( 'Sorry, you are not allowed to create posts as this user.' ) );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case &quot;page&quot;:&nbsp;</div></li><li><div>                    if ( !current_user_can( 'edit_others_pages' ) )&nbsp;</div></li><li><div>                        return new IXR_Error( 401, __( 'Sorry, you are not allowed to create pages as this user.' ) );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    return new IXR_Error( 401, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $author = get_userdata( $content_struct['wp_author_id'] );&nbsp;</div></li><li><div>            if ( ! $author )&nbsp;</div></li><li><div>                return new IXR_Error( 404, __( 'Invalid author ID.' ) );&nbsp;</div></li><li><div>            $post_author = $content_struct['wp_author_id'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_title = isset( $content_struct['title'] ) ? $content_struct['title'] : null;&nbsp;</div></li><li><div>        $post_content = isset( $content_struct['description'] ) ? $content_struct['description'] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_status = $publish ? 'publish' : 'draft';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct[&quot;{$post_type}_status&quot;] ) ) {&nbsp;</div></li><li><div>            switch ( $content_struct[&quot;{$post_type}_status&quot;] ) {&nbsp;</div></li><li><div>                case 'draft':&nbsp;</div></li><li><div>                case 'pending':&nbsp;</div></li><li><div>                case 'private':&nbsp;</div></li><li><div>                case 'publish':&nbsp;</div></li><li><div>                    $post_status = $content_struct[&quot;{$post_type}_status&quot;];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    $post_status = $publish ? 'publish' : 'draft';&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_excerpt = isset($content_struct['mt_excerpt']) ? $content_struct['mt_excerpt'] : null;&nbsp;</div></li><li><div>        $post_more = isset($content_struct['mt_text_more']) ? $content_struct['mt_text_more'] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tags_input = isset($content_struct['mt_keywords']) ? $content_struct['mt_keywords'] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['mt_allow_comments']) ) {&nbsp;</div></li><li><div>            if ( !is_numeric($content_struct['mt_allow_comments']) ) {&nbsp;</div></li><li><div>                switch ( $content_struct['mt_allow_comments'] ) {&nbsp;</div></li><li><div>                    case 'closed':&nbsp;</div></li><li><div>                        $comment_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'open':&nbsp;</div></li><li><div>                        $comment_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $comment_status = get_default_comment_status( $post_type );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                switch ( (int) $content_struct['mt_allow_comments'] ) {&nbsp;</div></li><li><div>                    case 0:&nbsp;</div></li><li><div>                    case 2:&nbsp;</div></li><li><div>                        $comment_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 1:&nbsp;</div></li><li><div>                        $comment_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $comment_status = get_default_comment_status( $post_type );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $comment_status = get_default_comment_status( $post_type );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['mt_allow_pings']) ) {&nbsp;</div></li><li><div>            if ( !is_numeric($content_struct['mt_allow_pings']) ) {&nbsp;</div></li><li><div>                switch ( $content_struct['mt_allow_pings'] ) {&nbsp;</div></li><li><div>                    case 'closed':&nbsp;</div></li><li><div>                        $ping_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'open':&nbsp;</div></li><li><div>                        $ping_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $ping_status = get_default_comment_status( $post_type, 'pingback' );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                switch ( (int) $content_struct['mt_allow_pings'] ) {&nbsp;</div></li><li><div>                    case 0:&nbsp;</div></li><li><div>                        $ping_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 1:&nbsp;</div></li><li><div>                        $ping_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $ping_status = get_default_comment_status( $post_type, 'pingback' );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $ping_status = get_default_comment_status( $post_type, 'pingback' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $post_more )&nbsp;</div></li><li><div>            $post_content = $post_content . '&lt;!--more--&gt;' . $post_more;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $to_ping = null;&nbsp;</div></li><li><div>        if ( isset( $content_struct['mt_tb_ping_urls'] ) ) {&nbsp;</div></li><li><div>            $to_ping = $content_struct['mt_tb_ping_urls'];&nbsp;</div></li><li><div>            if ( is_array($to_ping) )&nbsp;</div></li><li><div>                $to_ping = implode(' ', $to_ping);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do some timestamp voodoo&nbsp;</div></li><li><div>        if ( !empty( $content_struct['date_created_gmt'] ) )&nbsp;</div></li><li><div>            // We know this is supposed to be GMT, so we're going to slap that Z on there by force&nbsp;</div></li><li><div>            $dateCreated = rtrim( $content_struct['date_created_gmt']-&gt;getIso(), 'Z' ) . 'Z';&nbsp;</div></li><li><div>        elseif ( !empty( $content_struct['dateCreated']) )&nbsp;</div></li><li><div>            $dateCreated = $content_struct['dateCreated']-&gt;getIso();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $dateCreated ) ) {&nbsp;</div></li><li><div>            $post_date = get_date_from_gmt(iso8601_to_datetime($dateCreated));&nbsp;</div></li><li><div>            $post_date_gmt = iso8601_to_datetime($dateCreated, 'GMT');&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post_date = '';&nbsp;</div></li><li><div>            $post_date_gmt = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_category = array();&nbsp;</div></li><li><div>        if ( isset( $content_struct['categories'] ) ) {&nbsp;</div></li><li><div>            $catnames = $content_struct['categories'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array($catnames) ) {&nbsp;</div></li><li><div>                foreach ($catnames as $cat) {&nbsp;</div></li><li><div>                    $post_category[] = get_cat_ID($cat);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postdata = compact('post_author', 'post_date', 'post_date_gmt', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt', 'comment_status', 'ping_status', 'to_ping', 'post_type', 'post_name', 'post_password', 'post_parent', 'menu_order', 'tags_input', 'page_template');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = $postdata['ID'] = get_default_post_to_edit( $post_type, true )-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only posts can be sticky&nbsp;</div></li><li><div>        if ( $post_type == 'post' && isset( $content_struct['sticky'] ) ) {&nbsp;</div></li><li><div>            $data = $postdata;&nbsp;</div></li><li><div>            $data['sticky'] = $content_struct['sticky'];&nbsp;</div></li><li><div>            $error = $this-&gt;_toggle_sticky( $data );&nbsp;</div></li><li><div>            if ( $error ) {&nbsp;</div></li><li><div>                return $error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['custom_fields']) )&nbsp;</div></li><li><div>            $this-&gt;set_custom_fields($post_ID, $content_struct['custom_fields']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset ( $content_struct['wp_post_thumbnail'] ) ) {&nbsp;</div></li><li><div>            if ( set_post_thumbnail( $post_ID, $content_struct['wp_post_thumbnail'] ) === false )&nbsp;</div></li><li><div>                return new IXR_Error( 404, __( 'Invalid attachment ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $content_struct['wp_post_thumbnail'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle enclosures&nbsp;</div></li><li><div>        $thisEnclosure = isset($content_struct['enclosure']) ? $content_struct['enclosure'] : null;&nbsp;</div></li><li><div>        $this-&gt;add_enclosure_if_new($post_ID, $thisEnclosure);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;attach_uploads( $post_ID, $post_content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle post formats if assigned, value is validated earlier&nbsp;</div></li><li><div>        // in this function&nbsp;</div></li><li><div>        if ( isset( $content_struct['wp_post_format'] ) )&nbsp;</div></li><li><div>            set_post_format( $post_ID, $content_struct['wp_post_format'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = wp_insert_post( $postdata, true );&nbsp;</div></li><li><div>        if ( is_wp_error( $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error(500, $post_ID-&gt;get_error_message());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$post_ID )&nbsp;</div></li><li><div>            return new IXR_Error(500, __('Sorry, your entry could not be posted.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a new post has been successfully created via the XML-RPC MovableType API.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $post_ID ID of the new post.&nbsp;</div></li><li><div>         * @param array $args    An array of arguments to create the new post.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_mw_newPost', $post_ID, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return strval($post_ID);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds an enclosure to a post if it's new.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.8.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param integer $post_ID   Post ID.&nbsp;</div></li><li><div>     * @param array   $enclosure Enclosure data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_enclosure_if_new( $post_ID, $enclosure ) {&nbsp;</div></li><li><div>        if ( is_array( $enclosure ) && isset( $enclosure['url'] ) && isset( $enclosure['length'] ) && isset( $enclosure['type'] ) ) {&nbsp;</div></li><li><div>            $encstring = $enclosure['url'] . &quot;\n&quot; . $enclosure['length'] . &quot;\n&quot; . $enclosure['type'] . &quot;\n&quot;;&nbsp;</div></li><li><div>            $found = false;&nbsp;</div></li><li><div>            if ( $enclosures = get_post_meta( $post_ID, 'enclosure' ) ) {&nbsp;</div></li><li><div>                foreach ( $enclosures as $enc ) {&nbsp;</div></li><li><div>                    // This method used to omit the trailing new line. #23219&nbsp;</div></li><li><div>                    if ( rtrim( $enc, &quot;\n&quot; ) == rtrim( $encstring, &quot;\n&quot; ) ) {&nbsp;</div></li><li><div>                        $found = true;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( ! $found )&nbsp;</div></li><li><div>                add_post_meta( $post_ID, 'enclosure', $encstring );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Attach upload to a post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global wpdb $wpdb WordPress database abstraction object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $post_ID Post ID.&nbsp;</div></li><li><div>     * @param string $post_content Post Content for attachment.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function attach_uploads( $post_ID, $post_content ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // find any unattached files&nbsp;</div></li><li><div>        $attachments = $wpdb-&gt;get_results( &quot;SELECT ID, guid FROM {$wpdb-&gt;posts} WHERE post_parent = '0' AND post_type = 'attachment'&quot; );&nbsp;</div></li><li><div>        if ( is_array( $attachments ) ) {&nbsp;</div></li><li><div>            foreach ( $attachments as $file ) {&nbsp;</div></li><li><div>                if ( ! empty( $file-&gt;guid ) && strpos( $post_content, $file-&gt;guid ) !== false )&nbsp;</div></li><li><div>                    $wpdb-&gt;update($wpdb-&gt;posts, array('post_parent' =&gt; $post_ID), array('ID' =&gt; $file-&gt;ID) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edit a post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $content_struct&nbsp;</div></li><li><div>     *     @type int    $publish&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return bool|IXR_Error True on success.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mw_editPost( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[0];&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $content_struct = $args[3];&nbsp;</div></li><li><div>        $publish = isset( $args[4] ) ? $args[4] : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'metaWeblog.editPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postdata = get_post( $post_ID, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * If there is no post data for the give post id, stop now and return an error.&nbsp;</div></li><li><div>         * Otherwise a new post will be created (which was the old behavior).&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( ! $postdata || empty( $postdata[ 'ID' ] ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_post', $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Use wp.editPost to edit post types other than post and page.&nbsp;</div></li><li><div>        if ( ! in_array( $postdata[ 'post_type' ], array( 'post', 'page' ) ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Thwart attempt to change the post type.&nbsp;</div></li><li><div>        if ( ! empty( $content_struct[ 'post_type' ] ) && ( $content_struct['post_type'] != $postdata[ 'post_type' ] ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'The post type may not be changed.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for a valid post format if one was given&nbsp;</div></li><li><div>        if ( isset( $content_struct['wp_post_format'] ) ) {&nbsp;</div></li><li><div>            $content_struct['wp_post_format'] = sanitize_key( $content_struct['wp_post_format'] );&nbsp;</div></li><li><div>            if ( !array_key_exists( $content_struct['wp_post_format'], get_post_format_strings() ) ) {&nbsp;</div></li><li><div>                return new IXR_Error( 404, __( 'Invalid post format.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape($postdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ID = $postdata['ID'];&nbsp;</div></li><li><div>        $post_content = $postdata['post_content'];&nbsp;</div></li><li><div>        $post_title = $postdata['post_title'];&nbsp;</div></li><li><div>        $post_excerpt = $postdata['post_excerpt'];&nbsp;</div></li><li><div>        $post_password = $postdata['post_password'];&nbsp;</div></li><li><div>        $post_parent = $postdata['post_parent'];&nbsp;</div></li><li><div>        $post_type = $postdata['post_type'];&nbsp;</div></li><li><div>        $menu_order = $postdata['menu_order'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let WordPress manage slug if none was provided.&nbsp;</div></li><li><div>        $post_name = $postdata['post_name'];&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_slug']) )&nbsp;</div></li><li><div>            $post_name = $content_struct['wp_slug'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only use a password if one was given.&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_password']) )&nbsp;</div></li><li><div>            $post_password = $content_struct['wp_password'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only set a post parent if one was given.&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_page_parent_id']) )&nbsp;</div></li><li><div>            $post_parent = $content_struct['wp_page_parent_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only set the menu_order if it was given.&nbsp;</div></li><li><div>        if ( isset($content_struct['wp_page_order']) )&nbsp;</div></li><li><div>            $menu_order = $content_struct['wp_page_order'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $page_template = null;&nbsp;</div></li><li><div>        if ( ! empty( $content_struct['wp_page_template'] ) && 'page' == $post_type )&nbsp;</div></li><li><div>            $page_template = $content_struct['wp_page_template'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_author = $postdata['post_author'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only set the post_author if one is set.&nbsp;</div></li><li><div>        if ( isset( $content_struct['wp_author_id'] ) ) {&nbsp;</div></li><li><div>            // Check permissions if attempting to switch author to or from another user.&nbsp;</div></li><li><div>            if ( $user-&gt;ID != $content_struct['wp_author_id'] || $user-&gt;ID != $post_author ) {&nbsp;</div></li><li><div>                switch ( $post_type ) {&nbsp;</div></li><li><div>                    case 'post':&nbsp;</div></li><li><div>                        if ( ! current_user_can( 'edit_others_posts' ) ) {&nbsp;</div></li><li><div>                            return new IXR_Error( 401, __( 'Sorry, you are not allowed to change the post author as this user.' ) );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'page':&nbsp;</div></li><li><div>                        if ( ! current_user_can( 'edit_others_pages' ) ) {&nbsp;</div></li><li><div>                            return new IXR_Error( 401, __( 'Sorry, you are not allowed to change the page author as this user.' ) );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        return new IXR_Error( 401, __( 'Invalid post type.' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $post_author = $content_struct['wp_author_id'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['mt_allow_comments']) ) {&nbsp;</div></li><li><div>            if ( !is_numeric($content_struct['mt_allow_comments']) ) {&nbsp;</div></li><li><div>                switch ( $content_struct['mt_allow_comments'] ) {&nbsp;</div></li><li><div>                    case 'closed':&nbsp;</div></li><li><div>                        $comment_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'open':&nbsp;</div></li><li><div>                        $comment_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $comment_status = get_default_comment_status( $post_type );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                switch ( (int) $content_struct['mt_allow_comments'] ) {&nbsp;</div></li><li><div>                    case 0:&nbsp;</div></li><li><div>                    case 2:&nbsp;</div></li><li><div>                        $comment_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 1:&nbsp;</div></li><li><div>                        $comment_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $comment_status = get_default_comment_status( $post_type );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['mt_allow_pings']) ) {&nbsp;</div></li><li><div>            if ( !is_numeric($content_struct['mt_allow_pings']) ) {&nbsp;</div></li><li><div>                switch ( $content_struct['mt_allow_pings'] ) {&nbsp;</div></li><li><div>                    case 'closed':&nbsp;</div></li><li><div>                        $ping_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'open':&nbsp;</div></li><li><div>                        $ping_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $ping_status = get_default_comment_status( $post_type, 'pingback' );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                switch ( (int) $content_struct[&quot;mt_allow_pings&quot;] ) {&nbsp;</div></li><li><div>                    case 0:&nbsp;</div></li><li><div>                        $ping_status = 'closed';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 1:&nbsp;</div></li><li><div>                        $ping_status = 'open';&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        $ping_status = get_default_comment_status( $post_type, 'pingback' );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['title'] ) )&nbsp;</div></li><li><div>            $post_title =  $content_struct['title'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['description'] ) )&nbsp;</div></li><li><div>            $post_content = $content_struct['description'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_category = array();&nbsp;</div></li><li><div>        if ( isset( $content_struct['categories'] ) ) {&nbsp;</div></li><li><div>            $catnames = $content_struct['categories'];&nbsp;</div></li><li><div>            if ( is_array($catnames) ) {&nbsp;</div></li><li><div>                foreach ($catnames as $cat) {&nbsp;</div></li><li><div>                    $post_category[] = get_cat_ID($cat);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $content_struct['mt_excerpt'] ) )&nbsp;</div></li><li><div>            $post_excerpt =  $content_struct['mt_excerpt'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_more = isset( $content_struct['mt_text_more'] ) ? $content_struct['mt_text_more'] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_status = $publish ? 'publish' : 'draft';&nbsp;</div></li><li><div>        if ( isset( $content_struct[&quot;{$post_type}_status&quot;] ) ) {&nbsp;</div></li><li><div>            switch( $content_struct[&quot;{$post_type}_status&quot;] ) {&nbsp;</div></li><li><div>                case 'draft':&nbsp;</div></li><li><div>                case 'pending':&nbsp;</div></li><li><div>                case 'private':&nbsp;</div></li><li><div>                case 'publish':&nbsp;</div></li><li><div>                    $post_status = $content_struct[&quot;{$post_type}_status&quot;];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    $post_status = $publish ? 'publish' : 'draft';&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tags_input = isset( $content_struct['mt_keywords'] ) ? $content_struct['mt_keywords'] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'publish' == $post_status || 'private' == $post_status ) {&nbsp;</div></li><li><div>            if ( 'page' == $post_type && ! current_user_can( 'publish_pages' ) ) {&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you are not allowed to publish this page.' ) );&nbsp;</div></li><li><div>            } elseif ( ! current_user_can( 'publish_posts' ) ) {&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you are not allowed to publish this post.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $post_more )&nbsp;</div></li><li><div>            $post_content = $post_content . &quot;&lt;!--more--&gt;&quot; . $post_more;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $to_ping = null;&nbsp;</div></li><li><div>        if ( isset( $content_struct['mt_tb_ping_urls'] ) ) {&nbsp;</div></li><li><div>            $to_ping = $content_struct['mt_tb_ping_urls'];&nbsp;</div></li><li><div>            if ( is_array($to_ping) )&nbsp;</div></li><li><div>                $to_ping = implode(' ', $to_ping);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do some timestamp voodoo.&nbsp;</div></li><li><div>        if ( !empty( $content_struct['date_created_gmt'] ) )&nbsp;</div></li><li><div>            // We know this is supposed to be GMT, so we're going to slap that Z on there by force.&nbsp;</div></li><li><div>            $dateCreated = rtrim( $content_struct['date_created_gmt']-&gt;getIso(), 'Z' ) . 'Z';&nbsp;</div></li><li><div>        elseif ( !empty( $content_struct['dateCreated']) )&nbsp;</div></li><li><div>            $dateCreated = $content_struct['dateCreated']-&gt;getIso();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Default to not flagging the post date to be edited unless it's intentional.&nbsp;</div></li><li><div>        $edit_date = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $dateCreated ) ) {&nbsp;</div></li><li><div>            $post_date = get_date_from_gmt(iso8601_to_datetime($dateCreated));&nbsp;</div></li><li><div>            $post_date_gmt = iso8601_to_datetime($dateCreated, 'GMT');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Flag the post date to be edited.&nbsp;</div></li><li><div>            $edit_date = true;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post_date = $postdata['post_date'];&nbsp;</div></li><li><div>            $post_date_gmt = $postdata['post_date_gmt'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // We've got all the data -- post it.&nbsp;</div></li><li><div>        $newpost = compact('ID', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt', 'comment_status', 'ping_status', 'edit_date', 'post_date', 'post_date_gmt', 'to_ping', 'post_name', 'post_password', 'post_parent', 'menu_order', 'post_author', 'tags_input', 'page_template');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = wp_update_post($newpost, true);&nbsp;</div></li><li><div>        if ( is_wp_error( $result ) )&nbsp;</div></li><li><div>            return new IXR_Error(500, $result-&gt;get_error_message());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$result )&nbsp;</div></li><li><div>            return new IXR_Error(500, __('Sorry, your entry could not be edited.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only posts can be sticky&nbsp;</div></li><li><div>        if ( $post_type == 'post' && isset( $content_struct['sticky'] ) ) {&nbsp;</div></li><li><div>            $data = $newpost;&nbsp;</div></li><li><div>            $data['sticky'] = $content_struct['sticky'];&nbsp;</div></li><li><div>            $data['post_type'] = 'post';&nbsp;</div></li><li><div>            $error = $this-&gt;_toggle_sticky( $data, true );&nbsp;</div></li><li><div>            if ( $error ) {&nbsp;</div></li><li><div>                return $error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset($content_struct['custom_fields']) )&nbsp;</div></li><li><div>            $this-&gt;set_custom_fields($post_ID, $content_struct['custom_fields']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset ( $content_struct['wp_post_thumbnail'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Empty value deletes, non-empty value adds/updates.&nbsp;</div></li><li><div>            if ( empty( $content_struct['wp_post_thumbnail'] ) ) {&nbsp;</div></li><li><div>                delete_post_thumbnail( $post_ID );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( set_post_thumbnail( $post_ID, $content_struct['wp_post_thumbnail'] ) === false )&nbsp;</div></li><li><div>                    return new IXR_Error( 404, __( 'Invalid attachment ID.' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            unset( $content_struct['wp_post_thumbnail'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle enclosures.&nbsp;</div></li><li><div>        $thisEnclosure = isset($content_struct['enclosure']) ? $content_struct['enclosure'] : null;&nbsp;</div></li><li><div>        $this-&gt;add_enclosure_if_new($post_ID, $thisEnclosure);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;attach_uploads( $ID, $post_content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle post formats if assigned, validation is handled earlier in this function.&nbsp;</div></li><li><div>        if ( isset( $content_struct['wp_post_format'] ) )&nbsp;</div></li><li><div>            set_post_format( $post_ID, $content_struct['wp_post_format'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a post has been successfully updated via the XML-RPC MovableType API.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $post_ID ID of the updated post.&nbsp;</div></li><li><div>         * @param array $args    An array of arguments to update the post.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_mw_editPost', $post_ID, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type int    $post_ID&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mw_getPost( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[0];&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postdata = get_post($post_ID, ARRAY_A);&nbsp;</div></li><li><div>        if ( ! $postdata )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_post', $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'metaWeblog.getPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($postdata['post_date'] != '') {&nbsp;</div></li><li><div>            $post_date = $this-&gt;_convert_date( $postdata['post_date'] );&nbsp;</div></li><li><div>            $post_date_gmt = $this-&gt;_convert_date_gmt( $postdata['post_date_gmt'], $postdata['post_date'] );&nbsp;</div></li><li><div>            $post_modified = $this-&gt;_convert_date( $postdata['post_modified'] );&nbsp;</div></li><li><div>            $post_modified_gmt = $this-&gt;_convert_date_gmt( $postdata['post_modified_gmt'], $postdata['post_modified'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $categories = array();&nbsp;</div></li><li><div>            $catids = wp_get_post_categories($post_ID);&nbsp;</div></li><li><div>            foreach ($catids as $catid)&nbsp;</div></li><li><div>                $categories[] = get_cat_name($catid);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tagnames = array();&nbsp;</div></li><li><div>            $tags = wp_get_post_tags( $post_ID );&nbsp;</div></li><li><div>            if ( !empty( $tags ) ) {&nbsp;</div></li><li><div>                foreach ( $tags as $tag )&nbsp;</div></li><li><div>                    $tagnames[] = $tag-&gt;name;&nbsp;</div></li><li><div>                $tagnames = implode( ', ', $tagnames );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tagnames = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post = get_extended($postdata['post_content']);&nbsp;</div></li><li><div>            $link = get_permalink($postdata['ID']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get the author info.&nbsp;</div></li><li><div>            $author = get_userdata($postdata['post_author']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $allow_comments = ('open' == $postdata['comment_status']) ? 1 : 0;&nbsp;</div></li><li><div>            $allow_pings = ('open' == $postdata['ping_status']) ? 1 : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Consider future posts as published&nbsp;</div></li><li><div>            if ( $postdata['post_status'] === 'future' )&nbsp;</div></li><li><div>                $postdata['post_status'] = 'publish';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get post format&nbsp;</div></li><li><div>            $post_format = get_post_format( $post_ID );&nbsp;</div></li><li><div>            if ( empty( $post_format ) )&nbsp;</div></li><li><div>                $post_format = 'standard';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sticky = false;&nbsp;</div></li><li><div>            if ( is_sticky( $post_ID ) )&nbsp;</div></li><li><div>                $sticky = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $enclosure = array();&nbsp;</div></li><li><div>            foreach ( (array) get_post_custom($post_ID) as $key =&gt; $val) {&nbsp;</div></li><li><div>                if ($key == 'enclosure') {&nbsp;</div></li><li><div>                    foreach ( (array) $val as $enc ) {&nbsp;</div></li><li><div>                        $encdata = explode(&quot;\n&quot;, $enc);&nbsp;</div></li><li><div>                        $enclosure['url'] = trim(htmlspecialchars($encdata[0]));&nbsp;</div></li><li><div>                        $enclosure['length'] = (int) trim($encdata[1]);&nbsp;</div></li><li><div>                        $enclosure['type'] = trim($encdata[2]);&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $resp = array(&nbsp;</div></li><li><div>                'dateCreated' =&gt; $post_date, &nbsp;</div></li><li><div>                'userid' =&gt; $postdata['post_author'], &nbsp;</div></li><li><div>                'postid' =&gt; $postdata['ID'], &nbsp;</div></li><li><div>                'description' =&gt; $post['main'], &nbsp;</div></li><li><div>                'title' =&gt; $postdata['post_title'], &nbsp;</div></li><li><div>                'link' =&gt; $link, &nbsp;</div></li><li><div>                'permaLink' =&gt; $link, &nbsp;</div></li><li><div>                // commented out because no other tool seems to use this&nbsp;</div></li><li><div>                //          'content' =&gt; $entry['post_content'], &nbsp;</div></li><li><div>                'categories' =&gt; $categories, &nbsp;</div></li><li><div>                'mt_excerpt' =&gt; $postdata['post_excerpt'], &nbsp;</div></li><li><div>                'mt_text_more' =&gt; $post['extended'], &nbsp;</div></li><li><div>                'wp_more_text' =&gt; $post['more_text'], &nbsp;</div></li><li><div>                'mt_allow_comments' =&gt; $allow_comments, &nbsp;</div></li><li><div>                'mt_allow_pings' =&gt; $allow_pings, &nbsp;</div></li><li><div>                'mt_keywords' =&gt; $tagnames, &nbsp;</div></li><li><div>                'wp_slug' =&gt; $postdata['post_name'], &nbsp;</div></li><li><div>                'wp_password' =&gt; $postdata['post_password'], &nbsp;</div></li><li><div>                'wp_author_id' =&gt; (string) $author-&gt;ID, &nbsp;</div></li><li><div>                'wp_author_display_name' =&gt; $author-&gt;display_name, &nbsp;</div></li><li><div>                'date_created_gmt' =&gt; $post_date_gmt, &nbsp;</div></li><li><div>                'post_status' =&gt; $postdata['post_status'], &nbsp;</div></li><li><div>                'custom_fields' =&gt; $this-&gt;get_custom_fields($post_ID), &nbsp;</div></li><li><div>                'wp_post_format' =&gt; $post_format, &nbsp;</div></li><li><div>                'sticky' =&gt; $sticky, &nbsp;</div></li><li><div>                'date_modified' =&gt; $post_modified, &nbsp;</div></li><li><div>                'date_modified_gmt' =&gt; $post_modified_gmt&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty($enclosure) ) $resp['enclosure'] = $enclosure;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $resp['wp_post_thumbnail'] = get_post_thumbnail_id( $postdata['ID'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $resp;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return new IXR_Error(404, __('Sorry, no such post.'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve list of recent posts.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $numberposts&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mw_getRecentPosts( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        if ( isset( $args[3] ) )&nbsp;</div></li><li><div>            $query = array( 'numberposts' =&gt; absint( $args[3] ) );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $query = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit posts.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'metaWeblog.getRecentPosts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $posts_list = wp_get_recent_posts( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$posts_list )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $recent_posts = array();&nbsp;</div></li><li><div>        foreach ($posts_list as $entry) {&nbsp;</div></li><li><div>            if ( !current_user_can( 'edit_post', $entry['ID'] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_date = $this-&gt;_convert_date( $entry['post_date'] );&nbsp;</div></li><li><div>            $post_date_gmt = $this-&gt;_convert_date_gmt( $entry['post_date_gmt'], $entry['post_date'] );&nbsp;</div></li><li><div>            $post_modified = $this-&gt;_convert_date( $entry['post_modified'] );&nbsp;</div></li><li><div>            $post_modified_gmt = $this-&gt;_convert_date_gmt( $entry['post_modified_gmt'], $entry['post_modified'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $categories = array();&nbsp;</div></li><li><div>            $catids = wp_get_post_categories($entry['ID']);&nbsp;</div></li><li><div>            foreach ( $catids as $catid )&nbsp;</div></li><li><div>                $categories[] = get_cat_name($catid);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $tagnames = array();&nbsp;</div></li><li><div>            $tags = wp_get_post_tags( $entry['ID'] );&nbsp;</div></li><li><div>            if ( !empty( $tags ) ) {&nbsp;</div></li><li><div>                foreach ( $tags as $tag ) {&nbsp;</div></li><li><div>                    $tagnames[] = $tag-&gt;name;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $tagnames = implode( ', ', $tagnames );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tagnames = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post = get_extended($entry['post_content']);&nbsp;</div></li><li><div>            $link = get_permalink($entry['ID']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get the post author info.&nbsp;</div></li><li><div>            $author = get_userdata($entry['post_author']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $allow_comments = ('open' == $entry['comment_status']) ? 1 : 0;&nbsp;</div></li><li><div>            $allow_pings = ('open' == $entry['ping_status']) ? 1 : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Consider future posts as published&nbsp;</div></li><li><div>            if ( $entry['post_status'] === 'future' )&nbsp;</div></li><li><div>                $entry['post_status'] = 'publish';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get post format&nbsp;</div></li><li><div>            $post_format = get_post_format( $entry['ID'] );&nbsp;</div></li><li><div>            if ( empty( $post_format ) )&nbsp;</div></li><li><div>                $post_format = 'standard';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $recent_posts[] = array(&nbsp;</div></li><li><div>                'dateCreated' =&gt; $post_date, &nbsp;</div></li><li><div>                'userid' =&gt; $entry['post_author'], &nbsp;</div></li><li><div>                'postid' =&gt; (string) $entry['ID'], &nbsp;</div></li><li><div>                'description' =&gt; $post['main'], &nbsp;</div></li><li><div>                'title' =&gt; $entry['post_title'], &nbsp;</div></li><li><div>                'link' =&gt; $link, &nbsp;</div></li><li><div>                'permaLink' =&gt; $link, &nbsp;</div></li><li><div>                // commented out because no other tool seems to use this&nbsp;</div></li><li><div>                // 'content' =&gt; $entry['post_content'], &nbsp;</div></li><li><div>                'categories' =&gt; $categories, &nbsp;</div></li><li><div>                'mt_excerpt' =&gt; $entry['post_excerpt'], &nbsp;</div></li><li><div>                'mt_text_more' =&gt; $post['extended'], &nbsp;</div></li><li><div>                'wp_more_text' =&gt; $post['more_text'], &nbsp;</div></li><li><div>                'mt_allow_comments' =&gt; $allow_comments, &nbsp;</div></li><li><div>                'mt_allow_pings' =&gt; $allow_pings, &nbsp;</div></li><li><div>                'mt_keywords' =&gt; $tagnames, &nbsp;</div></li><li><div>                'wp_slug' =&gt; $entry['post_name'], &nbsp;</div></li><li><div>                'wp_password' =&gt; $entry['post_password'], &nbsp;</div></li><li><div>                'wp_author_id' =&gt; (string) $author-&gt;ID, &nbsp;</div></li><li><div>                'wp_author_display_name' =&gt; $author-&gt;display_name, &nbsp;</div></li><li><div>                'date_created_gmt' =&gt; $post_date_gmt, &nbsp;</div></li><li><div>                'post_status' =&gt; $entry['post_status'], &nbsp;</div></li><li><div>                'custom_fields' =&gt; $this-&gt;get_custom_fields($entry['ID']), &nbsp;</div></li><li><div>                'wp_post_format' =&gt; $post_format, &nbsp;</div></li><li><div>                'date_modified' =&gt; $post_modified, &nbsp;</div></li><li><div>                'date_modified_gmt' =&gt; $post_modified_gmt, &nbsp;</div></li><li><div>                'sticky' =&gt; ( $entry['post_type'] === 'post' && is_sticky( $entry['ID'] ) ), &nbsp;</div></li><li><div>                'wp_post_thumbnail' =&gt; get_post_thumbnail_id( $entry['ID'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $recent_posts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the list of categories on a given blog.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mw_getCategories( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you must be able to edit posts on this site in order to view categories.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'metaWeblog.getCategories' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $categories_struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $cats = get_categories(array('get' =&gt; 'all')) ) {&nbsp;</div></li><li><div>            foreach ( $cats as $cat ) {&nbsp;</div></li><li><div>                $struct = array();&nbsp;</div></li><li><div>                $struct['categoryId'] = $cat-&gt;term_id;&nbsp;</div></li><li><div>                $struct['parentId'] = $cat-&gt;parent;&nbsp;</div></li><li><div>                $struct['description'] = $cat-&gt;name;&nbsp;</div></li><li><div>                $struct['categoryDescription'] = $cat-&gt;description;&nbsp;</div></li><li><div>                $struct['categoryName'] = $cat-&gt;name;&nbsp;</div></li><li><div>                $struct['htmlUrl'] = esc_html(get_category_link($cat-&gt;term_id));&nbsp;</div></li><li><div>                $struct['rssUrl'] = esc_html(get_category_feed_link($cat-&gt;term_id, 'rss2'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $categories_struct[] = $struct;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $categories_struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Uploads a file, following your settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Adapted from a patch by Johann Richard.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @link http://mycvs.org/archives/2004/06/30/file-upload-to-wordpress-in-ecto/&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global wpdb $wpdb WordPress database abstraction object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $data&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mw_newMediaObject( $args ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $this-&gt;escape( $args[1] );&nbsp;</div></li><li><div>        $password = $this-&gt;escape( $args[2] );&nbsp;</div></li><li><div>        $data = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = sanitize_file_name( $data['name'] );&nbsp;</div></li><li><div>        $type = $data['type'];&nbsp;</div></li><li><div>        $bits = $data['bits'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'metaWeblog.newMediaObject' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can('upload_files') ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 401, __( 'Sorry, you are not allowed to upload files.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_multisite() && upload_is_user_over_quota( false ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 401, __( 'Sorry, you have used your space allocation.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters whether to preempt the XML-RPC media upload.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Passing a truthy value will effectively short-circuit the media upload, &nbsp;</div></li><li><div>         * returning that value as a 500 error instead.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.1.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool $error Whether to pre-empt the media upload. Default false.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( $upload_err = apply_filters( 'pre_upload_error', false ) ) {&nbsp;</div></li><li><div>            return new IXR_Error( 500, $upload_err );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $upload = wp_upload_bits($name, null, $bits);&nbsp;</div></li><li><div>        if ( ! empty($upload['error']) ) {&nbsp;</div></li><li><div>            /** translators: 1: file name, 2: error message */&nbsp;</div></li><li><div>            $errorString = sprintf( __( 'Could not write file %1$s (%2$s).' ), $name, $upload['error'] );&nbsp;</div></li><li><div>            return new IXR_Error( 500, $errorString );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Construct the attachment array&nbsp;</div></li><li><div>        $post_id = 0;&nbsp;</div></li><li><div>        if ( ! empty( $data['post_id'] ) ) {&nbsp;</div></li><li><div>            $post_id = (int) $data['post_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! current_user_can( 'edit_post', $post_id ) )&nbsp;</div></li><li><div>                return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $attachment = array(&nbsp;</div></li><li><div>            'post_title' =&gt; $name, &nbsp;</div></li><li><div>            'post_content' =&gt; '', &nbsp;</div></li><li><div>            'post_type' =&gt; 'attachment', &nbsp;</div></li><li><div>            'post_parent' =&gt; $post_id, &nbsp;</div></li><li><div>            'post_mime_type' =&gt; $type, &nbsp;</div></li><li><div>            'guid' =&gt; $upload[ 'url' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save the data&nbsp;</div></li><li><div>        $id = wp_insert_attachment( $attachment, $upload[ 'file' ], $post_id );&nbsp;</div></li><li><div>        wp_update_attachment_metadata( $id, wp_generate_attachment_metadata( $id, $upload['file'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a new attachment has been added via the XML-RPC MovableType API.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.4.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int   $id   ID of the new attachment.&nbsp;</div></li><li><div>         * @param array $args An array of arguments to add the attachment.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call_success_mw_newMediaObject', $id, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $struct = $this-&gt;_prepare_media_item( get_post( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Deprecated values&nbsp;</div></li><li><div>        $struct['id'] = $struct['attachment_id'];&nbsp;</div></li><li><div>        $struct['file'] = $struct['title'];&nbsp;</div></li><li><div>        $struct['url'] = $struct['link'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** MovableType API functions&nbsp;</div></li><li><div>     * specs on http://www.movabletype.org/docs/mtmanual_programmatic.html&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post titles of recent posts.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type int    $numberposts&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_getRecentPostTitles( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        if ( isset( $args[3] ) )&nbsp;</div></li><li><div>            $query = array( 'numberposts' =&gt; absint( $args[3] ) );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $query = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.getRecentPostTitles' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $posts_list = wp_get_recent_posts( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$posts_list ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error(500, __('Either there are no posts, or something went wrong.'));&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $recent_posts = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($posts_list as $entry) {&nbsp;</div></li><li><div>            if ( !current_user_can( 'edit_post', $entry['ID'] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_date = $this-&gt;_convert_date( $entry['post_date'] );&nbsp;</div></li><li><div>            $post_date_gmt = $this-&gt;_convert_date_gmt( $entry['post_date_gmt'], $entry['post_date'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $recent_posts[] = array(&nbsp;</div></li><li><div>                'dateCreated' =&gt; $post_date, &nbsp;</div></li><li><div>                'userid' =&gt; $entry['post_author'], &nbsp;</div></li><li><div>                'postid' =&gt; (string) $entry['ID'], &nbsp;</div></li><li><div>                'title' =&gt; $entry['post_title'], &nbsp;</div></li><li><div>                'post_status' =&gt; $entry['post_status'], &nbsp;</div></li><li><div>                'date_created_gmt' =&gt; $post_date_gmt&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $recent_posts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve list of all categories on blog.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $blog_id (unused)&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_getCategoryList( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_posts' ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you must be able to edit posts on this site in order to view categories.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.getCategoryList' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $categories_struct = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $cats = get_categories(array('hide_empty' =&gt; 0, 'hierarchical' =&gt; 0)) ) {&nbsp;</div></li><li><div>            foreach ( $cats as $cat ) {&nbsp;</div></li><li><div>                $struct = array();&nbsp;</div></li><li><div>                $struct['categoryId'] = $cat-&gt;term_id;&nbsp;</div></li><li><div>                $struct['categoryName'] = $cat-&gt;name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $categories_struct[] = $struct;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $categories_struct;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve post categories.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $post_ID&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_getPostCategories( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[0];&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! get_post( $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can( 'edit_post', $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 401, __( 'Sorry, you are not allowed to edit this post.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.getPostCategories' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $categories = array();&nbsp;</div></li><li><div>        $catids = wp_get_post_categories(intval($post_ID));&nbsp;</div></li><li><div>        // first listed category will be the primary category&nbsp;</div></li><li><div>        $isPrimary = true;&nbsp;</div></li><li><div>        foreach ( $catids as $catid ) {&nbsp;</div></li><li><div>            $categories[] = array(&nbsp;</div></li><li><div>                'categoryName' =&gt; get_cat_name($catid), &nbsp;</div></li><li><div>                'categoryId' =&gt; (string) $catid, &nbsp;</div></li><li><div>                'isPrimary' =&gt; $isPrimary&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $isPrimary = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $categories;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets categories for a post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $post_ID&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     *     @type array  $categories&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return true|IXR_Error True on success.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_setPostCategories( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[0];&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>        $categories = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.setPostCategories' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! get_post( $post_ID ) )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can('edit_post', $post_ID) )&nbsp;</div></li><li><div>            return new IXR_Error(401, __('Sorry, you are not allowed to edit this post.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $catids = array();&nbsp;</div></li><li><div>        foreach ( $categories as $cat ) {&nbsp;</div></li><li><div>            $catids[] = $cat['categoryId'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_set_post_categories($post_ID, $catids);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve an array of methods supported by this server.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_supportedMethods() {&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.supportedMethods' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array_keys( $this-&gt;methods );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve an empty array because we don't support per-post text filters.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_supportedTextFilters() {&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.supportedTextFilters' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the MoveableType text filters list for XML-RPC.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.2.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $filters An array of text filters.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_text_filters', array() );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve trackbacks sent to a given post.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global wpdb $wpdb WordPress database abstraction object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $post_ID&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_getTrackbackPings( $post_ID ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.getTrackbackPings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $actual_post = get_post($post_ID, ARRAY_A);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$actual_post )&nbsp;</div></li><li><div>            return new IXR_Error(404, __('Sorry, no such post.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comments = $wpdb-&gt;get_results( $wpdb-&gt;prepare(&quot;SELECT comment_author_url, comment_content, comment_author_IP, comment_type FROM $wpdb-&gt;comments WHERE comment_post_ID = %d&quot;, $post_ID) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$comments )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $trackback_pings = array();&nbsp;</div></li><li><div>        foreach ( $comments as $comment ) {&nbsp;</div></li><li><div>            if ( 'trackback' == $comment-&gt;comment_type ) {&nbsp;</div></li><li><div>                $content = $comment-&gt;comment_content;&nbsp;</div></li><li><div>                $title = substr($content, 8, (strpos($content, '&lt;/strong&gt;') - 8));&nbsp;</div></li><li><div>                $trackback_pings[] = array(&nbsp;</div></li><li><div>                    'pingTitle' =&gt; $title, &nbsp;</div></li><li><div>                    'pingURL' =&gt; $comment-&gt;comment_author_url, &nbsp;</div></li><li><div>                    'pingIP' =&gt; $comment-&gt;comment_author_IP&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $trackback_pings;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets a post's publish status to 'publish'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type int    $post_ID&nbsp;</div></li><li><div>     *     @type string $username&nbsp;</div></li><li><div>     *     @type string $password&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return int|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function mt_publishPost( $args ) {&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = (int) $args[0];&nbsp;</div></li><li><div>        $username = $args[1];&nbsp;</div></li><li><div>        $password = $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$user = $this-&gt;login($username, $password) )&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'mt.publishPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postdata = get_post($post_ID, ARRAY_A);&nbsp;</div></li><li><div>        if ( ! $postdata )&nbsp;</div></li><li><div>            return new IXR_Error( 404, __( 'Invalid post ID.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !current_user_can('publish_posts') || !current_user_can('edit_post', $post_ID) )&nbsp;</div></li><li><div>            return new IXR_Error(401, __('Sorry, you are not allowed to publish this post.'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postdata['post_status'] = 'publish';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // retain old cats&nbsp;</div></li><li><div>        $cats = wp_get_post_categories($post_ID);&nbsp;</div></li><li><div>        $postdata['post_category'] = $cats;&nbsp;</div></li><li><div>        $this-&gt;escape($postdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return wp_update_post( $postdata );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** PingBack functions&nbsp;</div></li><li><div>     * specs on www.hixie.ch/specs/pingback/pingback&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a pingback and registers it.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $args {&nbsp;</div></li><li><div>     *     Method arguments. Note: arguments must be ordered as documented.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *     @type string $pagelinkedfrom&nbsp;</div></li><li><div>     *     @type string $pagelinkedto&nbsp;</div></li><li><div>     * }&nbsp;</div></li><li><div>     * @return string|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function pingback_ping( $args ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'pingback.ping' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pagelinkedfrom = str_replace( '&amp;', '&', $args[0] );&nbsp;</div></li><li><div>        $pagelinkedto = str_replace( '&amp;', '&', $args[1] );&nbsp;</div></li><li><div>        $pagelinkedto = str_replace( '&', '&amp;', $pagelinkedto );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the pingback source URI.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.6.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param string $pagelinkedfrom URI of the page linked from.&nbsp;</div></li><li><div>         * @param string $pagelinkedto   URI of the page linked to.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $pagelinkedfrom = apply_filters( 'pingback_ping_source_uri', $pagelinkedfrom, $pagelinkedto );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $pagelinkedfrom )&nbsp;</div></li><li><div>            return $this-&gt;pingback_error( 0, __( 'A valid URL was not provided.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if the page linked to is in our site&nbsp;</div></li><li><div>        $pos1 = strpos($pagelinkedto, str_replace(array('http://www.', 'http://', 'https://www.', 'https://'), '', get_option('home')));&nbsp;</div></li><li><div>        if ( !$pos1 )&nbsp;</div></li><li><div>            return $this-&gt;pingback_error( 0, __( 'Is there no link to us?' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // let's find which post is linked to&nbsp;</div></li><li><div>        // FIXME: does url_to_postid() cover all these cases already?&nbsp;</div></li><li><div>        //        if so, then let's use it and drop the old code.&nbsp;</div></li><li><div>        $urltest = parse_url($pagelinkedto);&nbsp;</div></li><li><div>        if ( $post_ID = url_to_postid($pagelinkedto) ) {&nbsp;</div></li><li><div>            // $way&nbsp;</div></li><li><div>        } elseif ( isset( $urltest['path'] ) && preg_match('#p/[0-9]{1, }#', $urltest['path'], $match) ) {&nbsp;</div></li><li><div>            // the path defines the post_ID (archives/p/XXXX)&nbsp;</div></li><li><div>            $blah = explode('/', $match[0]);&nbsp;</div></li><li><div>            $post_ID = (int) $blah[1];&nbsp;</div></li><li><div>        } elseif ( isset( $urltest['query'] ) && preg_match('#p=[0-9]{1, }#', $urltest['query'], $match) ) {&nbsp;</div></li><li><div>            // the querystring defines the post_ID (?p=XXXX)&nbsp;</div></li><li><div>            $blah = explode('=', $match[0]);&nbsp;</div></li><li><div>            $post_ID = (int) $blah[1];&nbsp;</div></li><li><div>        } elseif ( isset($urltest['fragment']) ) {&nbsp;</div></li><li><div>            // an #anchor is there, it's either...&nbsp;</div></li><li><div>            if ( intval($urltest['fragment']) ) {&nbsp;</div></li><li><div>                // ...an integer #XXXX (simplest case)&nbsp;</div></li><li><div>                $post_ID = (int) $urltest['fragment'];&nbsp;</div></li><li><div>            } elseif ( preg_match('/post-[0-9]+/', $urltest['fragment']) ) {&nbsp;</div></li><li><div>                // ...a post id in the form 'post-###'&nbsp;</div></li><li><div>                $post_ID = preg_replace('/[^0-9]+/', '', $urltest['fragment']);&nbsp;</div></li><li><div>            } elseif ( is_string($urltest['fragment']) ) {&nbsp;</div></li><li><div>                // ...or a string #title, a little more complicated&nbsp;</div></li><li><div>                $title = preg_replace('/[^a-z0-9]/i', '.', $urltest['fragment']);&nbsp;</div></li><li><div>                $sql = $wpdb-&gt;prepare(&quot;SELECT ID FROM $wpdb-&gt;posts WHERE post_title RLIKE %s&quot;, $title );&nbsp;</div></li><li><div>                if (! ($post_ID = $wpdb-&gt;get_var($sql)) ) {&nbsp;</div></li><li><div>                    // returning unknown error '0' is better than die()ing&nbsp;</div></li><li><div>                      return $this-&gt;pingback_error( 0, '' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // TODO: Attempt to extract a post ID from the given URL&nbsp;</div></li><li><div>              return $this-&gt;pingback_error( 33, __('The specified target URL cannot be used as a target. It either doesn&#8217;t exist, or it is not a pingback-enabled resource.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $post_ID = (int) $post_ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post = get_post($post_ID);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$post ) // Post_ID not found&nbsp;</div></li><li><div>              return $this-&gt;pingback_error( 33, __( 'The specified target URL cannot be used as a target. It either doesn&#8217;t exist, or it is not a pingback-enabled resource.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $post_ID == url_to_postid($pagelinkedfrom) )&nbsp;</div></li><li><div>            return $this-&gt;pingback_error( 0, __( 'The source URL and the target URL cannot both point to the same resource.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if pings are on&nbsp;</div></li><li><div>        if ( !pings_open($post) )&nbsp;</div></li><li><div>              return $this-&gt;pingback_error( 33, __( 'The specified target URL cannot be used as a target. It either doesn&#8217;t exist, or it is not a pingback-enabled resource.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let's check that the remote site didn't already pingback this entry&nbsp;</div></li><li><div>        if ( $wpdb-&gt;get_results( $wpdb-&gt;prepare(&quot;SELECT * FROM $wpdb-&gt;comments WHERE comment_post_ID = %d AND comment_author_url = %s&quot;, $post_ID, $pagelinkedfrom) ) )&nbsp;</div></li><li><div>            return $this-&gt;pingback_error( 48, __( 'The pingback has already been registered.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // very stupid, but gives time to the 'from' server to publish !&nbsp;</div></li><li><div>        sleep(1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $remote_ip = preg_replace( '/[^0-9a-fA-F:., ]/', '', $_SERVER['REMOTE_ADDR'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This filter is documented in wp-includes/class-http.php */&nbsp;</div></li><li><div>        $user_agent = apply_filters( 'http_headers_useragent', 'WordPress/' . get_bloginfo( 'version' ) . '; ' . get_bloginfo( 'url' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let's check the remote site&nbsp;</div></li><li><div>        $http_api_args = array(&nbsp;</div></li><li><div>            'timeout' =&gt; 10, &nbsp;</div></li><li><div>            'redirection' =&gt; 0, &nbsp;</div></li><li><div>            'limit_response_size' =&gt; 153600, // 150 KB&nbsp;</div></li><li><div>            'user-agent' =&gt; &quot;$user_agent; verifying pingback from $remote_ip&quot;, &nbsp;</div></li><li><div>            'headers' =&gt; array(&nbsp;</div></li><li><div>                'X-Pingback-Forwarded-For' =&gt; $remote_ip, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $request = wp_safe_remote_get( $pagelinkedfrom, $http_api_args );&nbsp;</div></li><li><div>        $remote_source = $remote_source_original = wp_remote_retrieve_body( $request );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $remote_source ) {&nbsp;</div></li><li><div>            return $this-&gt;pingback_error( 16, __( 'The source URL does not exist.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the pingback remote source.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param string $remote_source Response source for the page linked from.&nbsp;</div></li><li><div>         * @param string $pagelinkedto  URL of the page linked to.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $remote_source = apply_filters( 'pre_remote_source', $remote_source, $pagelinkedto );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Work around bug in strip_tags():&nbsp;</div></li><li><div>        $remote_source = str_replace( '&lt;!DOC', '&lt;DOC', $remote_source );&nbsp;</div></li><li><div>        $remote_source = preg_replace( '/[\r\n\t ]+/', ' ', $remote_source ); // normalize spaces&nbsp;</div></li><li><div>        $remote_source = preg_replace( &quot;/&lt;\/*(h1|h2|h3|h4|h5|h6|p|th|td|li|dt|dd|pre|caption|input|textarea|button|body)[^&gt;]*&gt;/&quot;, &quot;\n\n&quot;, $remote_source );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        preg_match( '|&lt;title&gt;([^&lt;]*?)&lt;/title&gt;|is', $remote_source, $matchtitle );&nbsp;</div></li><li><div>        $title = isset( $matchtitle[1] ) ? $matchtitle[1] : '';&nbsp;</div></li><li><div>        if ( empty( $title ) ) {&nbsp;</div></li><li><div>            return $this-&gt;pingback_error( 32, __( 'We cannot find a title on that page.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $remote_source = strip_tags( $remote_source, '&lt;a&gt;' ); // just keep the tag we need&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $p = explode( &quot;\n\n&quot;, $remote_source );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $preg_target = preg_quote($pagelinkedto, '|');&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        foreach ( $p as $para ) {&nbsp;</div></li><li><div>            if ( strpos($para, $pagelinkedto) !== false ) { // it exists, but is it a link?&nbsp;</div></li><li><div>                preg_match(&quot;|&lt;a[^&gt;]+?&quot;.$preg_target.&quot;[^&gt;]*&gt;([^&gt;]+?)&lt;/a&gt;|&quot;, $para, $context);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                // If the URL isn't in a link context, keep looking&nbsp;</div></li><li><div>                if ( empty($context) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                // We're going to use this fake tag to mark the context in a bit&nbsp;</div></li><li><div>                // the marker is needed in case the link text appears more than once in the paragraph&nbsp;</div></li><li><div>                $excerpt = preg_replace('|\&lt;/?wpcontext\&gt;|', '', $para);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                // prevent really long link text&nbsp;</div></li><li><div>                if ( strlen($context[1]) &gt; 100 )&nbsp;</div></li><li><div>                    $context[1] = substr($context[1], 0, 100) . '&#8230;';&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>                $marker = '&lt;wpcontext&gt;'.$context[1].'&lt;/wpcontext&gt;';    // set up our marker&nbsp;</div></li><li><div>                $excerpt= str_replace($context[0], $marker, $excerpt); // swap out the link for our marker&nbsp;</div></li><li><div>                $excerpt = strip_tags($excerpt, '&lt;wpcontext&gt;');        // strip all tags but our context marker&nbsp;</div></li><li><div>                $excerpt = trim($excerpt);&nbsp;</div></li><li><div>                $preg_marker = preg_quote($marker, '|');&nbsp;</div></li><li><div>                $excerpt = preg_replace(&quot;|.*?\s(.{0, 100}$preg_marker.{0, 100})\s.*|s&quot;, '$1', $excerpt);&nbsp;</div></li><li><div>                $excerpt = strip_tags($excerpt); // YES, again, to remove the marker wrapper&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        if ( empty($context) ) // Link to target not found&nbsp;</div></li><li><div>            return $this-&gt;pingback_error( 17, __( 'The source URL does not contain a link to the target URL, and so cannot be used as a source.' ) );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $pagelinkedfrom = str_replace('&', '&amp;', $pagelinkedfrom);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $context = '[&#8230;] ' . esc_html( $excerpt ) . ' [&#8230;]';&nbsp;</div></li><li><div>        $pagelinkedfrom = $this-&gt;escape( $pagelinkedfrom );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $comment_post_ID = (int) $post_ID;&nbsp;</div></li><li><div>        $comment_author = $title;&nbsp;</div></li><li><div>        $comment_author_email = '';&nbsp;</div></li><li><div>        $this-&gt;escape($comment_author);&nbsp;</div></li><li><div>        $comment_author_url = $pagelinkedfrom;&nbsp;</div></li><li><div>        $comment_content = $context;&nbsp;</div></li><li><div>        $this-&gt;escape($comment_content);&nbsp;</div></li><li><div>        $comment_type = 'pingback';&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $commentdata = compact(&nbsp;</div></li><li><div>            'comment_post_ID', 'comment_author', 'comment_author_url', 'comment_author_email', &nbsp;</div></li><li><div>            'comment_content', 'comment_type', 'remote_source', 'remote_source_original'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        $comment_ID = wp_new_comment($commentdata);&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires after a post pingback has been sent.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 0.71&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param int $comment_ID Comment ID.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'pingback_post', $comment_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** translators: 1: URL of the page linked from, 2: URL of the page linked to */&nbsp;</div></li><li><div>        return sprintf( __( 'Pingback from %1$s to %2$s registered. Keep the web talking! :-)' ), $pagelinkedfrom, $pagelinkedto );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve array of URLs that pingbacked the given URL.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Specs on http://www.aquarionics.com/misc/archives/blogite/0198.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global wpdb $wpdb WordPress database abstraction object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $url&nbsp;</div></li><li><div>     * @return array|IXR_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function pingback_extensions_getPingbacks( $url ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** This action is documented in wp-includes/class-wp-xmlrpc-server.php */&nbsp;</div></li><li><div>        do_action( 'xmlrpc_call', 'pingback.extensions.getPingbacks' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $url = $this-&gt;escape( $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_ID = url_to_postid($url);&nbsp;</div></li><li><div>        if ( !$post_ID ) {&nbsp;</div></li><li><div>            // We aren't sure that the resource is available and/or pingback enabled&nbsp;</div></li><li><div>              return $this-&gt;pingback_error( 33, __( 'The specified target URL cannot be used as a target. It either doesn&#8217;t exist, or it is not a pingback-enabled resource.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $actual_post = get_post($post_ID, ARRAY_A);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$actual_post ) {&nbsp;</div></li><li><div>            // No such post = resource not found&nbsp;</div></li><li><div>              return $this-&gt;pingback_error( 32, __('The specified target URL does not exist.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comments = $wpdb-&gt;get_results( $wpdb-&gt;prepare(&quot;SELECT comment_author_url, comment_content, comment_author_IP, comment_type FROM $wpdb-&gt;comments WHERE comment_post_ID = %d&quot;, $post_ID) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$comments )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pingbacks = array();&nbsp;</div></li><li><div>        foreach ( $comments as $comment ) {&nbsp;</div></li><li><div>            if ( 'pingback' == $comment-&gt;comment_type )&nbsp;</div></li><li><div>                $pingbacks[] = $comment-&gt;comment_author_url;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $pingbacks;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sends a pingback error based on the given error code and message.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 3.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int    $code    Error code.&nbsp;</div></li><li><div>     * @param string $message Error message.&nbsp;</div></li><li><div>     * @return IXR_Error Error object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function pingback_error( $code, $message ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the XML-RPC pingback error return.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.5.1&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param IXR_Error $error An IXR_Error object containing the error code and message.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'xmlrpc_pingback_error', new IXR_Error( $code, $message ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.5.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/4.7.4/classes/wp_xmlrpc_server/" class="active">4.7.4</a></li><li><a href="http://hookr.io/4.7.3/classes/wp_xmlrpc_server/" class="">4.7.3</a></li><li><a href="http://hookr.io/4.7.2/classes/wp_xmlrpc_server/" class="">4.7.2</a></li><li><a href="http://hookr.io/4.7.1/classes/wp_xmlrpc_server/" class="">4.7.1</a></li><li><a href="http://hookr.io/4.7/classes/wp_xmlrpc_server/" class="">4.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>class</li><li><span></span>wp_xmlrpc_server</li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>