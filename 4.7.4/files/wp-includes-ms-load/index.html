<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.4" data-type="file" data-id="4814"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-ms-load | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=b1f77d1d38e194616a94936dc1632782' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-ms-load/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-ms-load%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-ms-load%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-file-wp-includes-ms-load","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-ms-load" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-ms-load</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/ms-load.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * These functions are needed to load Multisite.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Multisite</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether a subdomain configuration is enabled.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if subdomain configuration is enabled, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_subdomain_install() {&nbsp;</div></li><li><div>  if ( defined('SUBDOMAIN_INSTALL') )&nbsp;</div></li><li><div>      return SUBDOMAIN_INSTALL;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return ( defined( 'VHOST' ) && VHOST == 'yes' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns array of network plugin files to be included in global scope.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The default directory is wp-content/plugins. To change the default directory</span>&nbsp;</div></li><li><div><span class="comment"> * manually, define `WP_PLUGIN_DIR` and `WP_PLUGIN_URL` in `wp-config.php`.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Files to include.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_active_network_plugins() {&nbsp;</div></li><li><div>  $active_plugins = (array) get_site_option( 'active_sitewide_plugins', array() );&nbsp;</div></li><li><div>  if ( empty( $active_plugins ) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $plugins = array();&nbsp;</div></li><li><div>  $active_plugins = array_keys( $active_plugins );&nbsp;</div></li><li><div>  sort( $active_plugins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $active_plugins as $plugin ) {&nbsp;</div></li><li><div>      if ( ! validate_file( $plugin ) <span class="comment">// $plugin must validate as file</span>&nbsp;</div></li><li><div>          && '.php' == substr( $plugin, -4 ) <span class="comment">// $plugin must end with '.php'</span>&nbsp;</div></li><li><div>          && file_exists( WP_PLUGIN_DIR . '/' . $plugin ) <span class="comment">// $plugin must exist</span>&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>      $plugins[] = WP_PLUGIN_DIR . '/' . $plugin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $plugins;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks status of current blog.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if the blog is deleted, inactive, archived, or spammed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Dies with a default message if the blog does not pass the check.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * To change the default message when a blog does not pass the check, </span>&nbsp;</div></li><li><div><span class="comment"> * use the wp-content/blog-deleted.php, blog-inactive.php and</span>&nbsp;</div></li><li><div><span class="comment"> * blog-suspended.php drop-ins.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return true|string Returns true on success, or drop-in file to include.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function ms_site_check() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters checking the status of the current blog.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool null Whether to skip the blog status check. Default null.</span>&nbsp;</div></li><li><div><span class="comment">  */</span>&nbsp;</div></li><li><div>  $check = apply_filters( 'ms_site_check', null );&nbsp;</div></li><li><div>  if ( null !== $check )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Allow super admins to see blocked sites</span>&nbsp;</div></li><li><div>  if ( is_super_admin() )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $blog = get_site();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '1' == $blog-&gt;deleted ) {&nbsp;</div></li><li><div>      if ( file_exists( WP_CONTENT_DIR . '/blog-deleted.php' ) )&nbsp;</div></li><li><div>          return WP_CONTENT_DIR . '/blog-deleted.php';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          wp_die( __( 'This site is no longer available.' ), '', array( 'response' =&gt; 410 ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '2' == $blog-&gt;deleted ) {&nbsp;</div></li><li><div>      if ( file_exists( WP_CONTENT_DIR . '/blog-inactive.php' ) ) {&nbsp;</div></li><li><div>          return WP_CONTENT_DIR . '/blog-inactive.php';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $admin_email = str_replace( '@', ' AT ', get_site_option( 'admin_email', 'support@' . get_network()-&gt;domain ) );&nbsp;</div></li><li><div>          wp_die(&nbsp;</div></li><li><div>              <span class="comment">/** translators: %s: admin email link */</span>&nbsp;</div></li><li><div>              sprintf( __( 'This site has not been activated yet. If you are having problems activating your site, please contact %s.' ), &nbsp;</div></li><li><div>                  sprintf( '&lt;a href=&quot;mailto:%s&quot;&gt;%s&lt;/a&gt;', $admin_email )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $blog-&gt;archived == '1' || $blog-&gt;spam == '1' ) {&nbsp;</div></li><li><div>      if ( file_exists( WP_CONTENT_DIR . '/blog-suspended.php' ) )&nbsp;</div></li><li><div>          return WP_CONTENT_DIR . '/blog-suspended.php';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          wp_die( __( 'This site has been archived or suspended.' ), '', array( 'response' =&gt; 410 ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the closest matching network for a domain and path.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal In 4.4.0, converted to a wrapper for WP_Network::get_by_path()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $domain   Domain to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $path     Path to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|null $segments Path segments to use. Defaults to null, or the full path.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Network|false Network object if successful. False when no network is found.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_network_by_path( $domain, $path, $segments = null ) {&nbsp;</div></li><li><div>  return WP_Network::get_by_path( $domain, $path, $segments );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the closest matching site object by its domain and path.</span>&nbsp;</div></li><li><div><span class="comment"> * </span>&nbsp;</div></li><li><div><span class="comment"> * This will not necessarily return an exact match for a domain and path. Instead, it</span>&nbsp;</div></li><li><div><span class="comment"> * breaks the domain and path into pieces that are then used to match the closest</span>&nbsp;</div></li><li><div><span class="comment"> * possibility from a query.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The intent of this method is to match a site object during bootstrap for a</span>&nbsp;</div></li><li><div><span class="comment"> * requested site address</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0 Updated to always return a `WP_Site` object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $domain   Domain to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $path     Path to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|null $segments Path segments to use. Defaults to null, or the full path.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Site|false Site object if successful. False when no site is found.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_site_by_path( $domain, $path, $segments = null ) {&nbsp;</div></li><li><div>  $path_segments = array_filter( explode( '/', trim( $path, '/' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the number of path segments to consider when searching for a site.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null $segments The number of path segments to consider. WordPress by default looks at</span>&nbsp;</div></li><li><div><span class="comment">   *                           one path segment following the network path. The function default of</span>&nbsp;</div></li><li><div><span class="comment">   *                           null only makes sense when you know the requested path should match a site.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string   $domain   The requested domain.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string   $path     The requested path, in full.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $segments = apply_filters( 'site_by_path_segments_count', $segments, $domain, $path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( null !== $segments && count( $path_segments ) &gt; $segments ) {&nbsp;</div></li><li><div>      $path_segments = array_slice( $path_segments, 0, $segments );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $paths = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  while ( count( $path_segments ) ) {&nbsp;</div></li><li><div>      $paths[] = '/' . implode( '/', $path_segments ) . '/';&nbsp;</div></li><li><div>      array_pop( $path_segments );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $paths[] = '/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determine a site by its domain and path.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This allows one to short-circuit the default logic, perhaps by</span>&nbsp;</div></li><li><div><span class="comment">   * replacing it with a routine that is more optimal for your setup.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Return null to avoid the short-circuit. Return false if no site</span>&nbsp;</div></li><li><div><span class="comment">   * can be found at the requested domain and path. Otherwise, return</span>&nbsp;</div></li><li><div><span class="comment">   * a site object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param null|bool|WP_Site $site     Site value to return by path.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string            $domain   The requested domain.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string            $path     The requested path, in full.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $segments The suggested number of paths to consult.</span>&nbsp;</div></li><li><div><span class="comment">   *                                    Default null, meaning the entire path was to be consulted.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array             $paths    The paths to search for, based on $path and $segments.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $pre = apply_filters( 'pre_get_site_by_path', null, $domain, $path, $segments, $paths );&nbsp;</div></li><li><div>  if ( null !== $pre ) {&nbsp;</div></li><li><div>      if ( false !== $pre && ! $pre instanceof WP_Site ) {&nbsp;</div></li><li><div>          $pre = new WP_Site( $pre );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $pre;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @todo</span>&nbsp;</div></li><li><div><span class="comment">   * caching, etc. Consider alternative optimization routes, </span>&nbsp;</div></li><li><div><span class="comment">   * perhaps as an opt-in for plugins, rather than using the pre_* filter.</span>&nbsp;</div></li><li><div><span class="comment">   * For example: The segments filter can expand or ignore paths.</span>&nbsp;</div></li><li><div><span class="comment">   * If persistent caching is enabled, we could query the DB for a path &lt;&gt; '/'</span>&nbsp;</div></li><li><div><span class="comment">   * then cache whether we can just always ignore paths.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Either www or non-www is supported, not both. If a www domain is requested, </span>&nbsp;</div></li><li><div>  <span class="comment">// query for both to provide the proper redirect.</span>&nbsp;</div></li><li><div>  $domains = array( $domain );&nbsp;</div></li><li><div>  if ( 'www.' === substr( $domain, 0, 4 ) ) {&nbsp;</div></li><li><div>      $domains[] = substr( $domain, 4 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array(&nbsp;</div></li><li><div>      'domain__in' =&gt; $domains, &nbsp;</div></li><li><div>      'path__in' =&gt; $paths, &nbsp;</div></li><li><div>      'number' =&gt; 1, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $domains ) &gt; 1 ) {&nbsp;</div></li><li><div>      $args['orderby']['domain_length'] = 'DESC';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $paths ) &gt; 1 ) {&nbsp;</div></li><li><div>      $args['orderby']['path_length'] = 'DESC';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = get_sites( $args );&nbsp;</div></li><li><div>  $site = array_shift( $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $site ) {&nbsp;</div></li><li><div>      return $site;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Identifies the network and site of a requested domain and path and populates the</span>&nbsp;</div></li><li><div><span class="comment"> * corresponding network and site global objects as part of the multisite bootstrap process.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Prior to 4.6.0, this was a procedural block in `ms-settings.php`. It was wrapped into</span>&nbsp;</div></li><li><div><span class="comment"> * a function to facilitate unit tests. It should not be used outside of core.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Usually, it's easier to query the site first, which then declares its network.</span>&nbsp;</div></li><li><div><span class="comment"> * In limited situations, we either can or must find the network first.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If a network and site are found, a `true` response will be returned so that the</span>&nbsp;</div></li><li><div><span class="comment"> * request can continue.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If neither a network or site is found, `false` or a URL string will be returned</span>&nbsp;</div></li><li><div><span class="comment"> * so that either an error can be shown or a redirect can occur.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.6.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb       $wpdb         WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Network $current_site The current network.</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Site    $current_blog The current site.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $domain    The requested domain.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $path      The requested path.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $subdomain Optional. Whether a subdomain (true) or subdirectory (false) configuration.</span>&nbsp;</div></li><li><div><span class="comment"> *                          Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|string True if bootstrap successfully populated `$current_blog` and `$current_site`.</span>&nbsp;</div></li><li><div><span class="comment"> *                     False if bootstrap could not be properly completed.</span>&nbsp;</div></li><li><div><span class="comment"> *                     Redirect URL if parts exist, but the request as a whole can not be fulfilled.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function ms_load_current_site_and_network( $domain, $path, $subdomain = false ) {&nbsp;</div></li><li><div>  global $wpdb, $current_site, $current_blog;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the network is defined in wp-config.php, we can simply use that.</span>&nbsp;</div></li><li><div>  if ( defined( 'DOMAIN_CURRENT_SITE' ) && defined( 'PATH_CURRENT_SITE' ) ) {&nbsp;</div></li><li><div>      $current_site = new stdClass;&nbsp;</div></li><li><div>      $current_site-&gt;id = defined( 'SITE_ID_CURRENT_SITE' ) ? SITE_ID_CURRENT_SITE : 1;&nbsp;</div></li><li><div>      $current_site-&gt;domain = DOMAIN_CURRENT_SITE;&nbsp;</div></li><li><div>      $current_site-&gt;path = PATH_CURRENT_SITE;&nbsp;</div></li><li><div>      if ( defined( 'BLOG_ID_CURRENT_SITE' ) ) {&nbsp;</div></li><li><div>          $current_site-&gt;blog_id = BLOG_ID_CURRENT_SITE;&nbsp;</div></li><li><div>      } elseif ( defined( 'BLOGID_CURRENT_SITE' ) ) { <span class="comment">// deprecated.</span>&nbsp;</div></li><li><div>          $current_site-&gt;blog_id = BLOGID_CURRENT_SITE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 0 === strcasecmp( $current_site-&gt;domain, $domain ) && 0 === strcasecmp( $current_site-&gt;path, $path ) ) {&nbsp;</div></li><li><div>          $current_blog = get_site_by_path( $domain, $path );&nbsp;</div></li><li><div>      } elseif ( '/' !== $current_site-&gt;path && 0 === strcasecmp( $current_site-&gt;domain, $domain ) && 0 === stripos( $path, $current_site-&gt;path ) ) {&nbsp;</div></li><li><div>          <span class="comment">// If the current network has a path and also matches the domain and path of the request, </span>&nbsp;</div></li><li><div>          <span class="comment">// we need to look for a site using the first path segment following the network's path.</span>&nbsp;</div></li><li><div>          $current_blog = get_site_by_path( $domain, $path, 1 + count( explode( '/', trim( $current_site-&gt;path, '/' ) ) ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// Otherwise, use the first path segment (as usual).</span>&nbsp;</div></li><li><div>          $current_blog = get_site_by_path( $domain, $path, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } elseif ( ! $subdomain ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * A &quot;subdomain&quot; install can be re-interpreted to mean &quot;can support any domain&quot;.</span>&nbsp;</div></li><li><div><span class="comment">       * If we're not dealing with one of these installs, then the important part is determining</span>&nbsp;</div></li><li><div><span class="comment">       * the network first, because we need the network's path to identify any sites.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( ! $current_site = wp_cache_get( 'current_network', 'site-options' ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Are there even two networks installed?</span>&nbsp;</div></li><li><div>          $one_network = $wpdb-&gt;get_row( &quot;SELECT * FROM $wpdb-&gt;site LIMIT 2&quot; ); <span class="comment">// [sic]</span>&nbsp;</div></li><li><div>          if ( 1 === $wpdb-&gt;num_rows ) {&nbsp;</div></li><li><div>              $current_site = new WP_Network( $one_network );&nbsp;</div></li><li><div>              wp_cache_add( 'current_network', $current_site, 'site-options' );&nbsp;</div></li><li><div>          } elseif ( 0 === $wpdb-&gt;num_rows ) {&nbsp;</div></li><li><div>              <span class="comment">// A network not found hook should fire here.</span>&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $current_site ) ) {&nbsp;</div></li><li><div>          $current_site = WP_Network::get_by_path( $domain, $path, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $current_site ) ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires when a network cannot be found based on the requested domain and path.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * At the time of this action, the only recourse is to redirect somewhere</span>&nbsp;</div></li><li><div><span class="comment">           * and exit. If you want to declare a particular network, do so earlier.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $domain       The domain used to search for a network.</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $path         The path used to search for a path.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'ms_network_not_found', $domain, $path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      } elseif ( $path === $current_site-&gt;path ) {&nbsp;</div></li><li><div>          $current_blog = get_site_by_path( $domain, $path );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// Search the network path + one more path segment (on top of the network path).</span>&nbsp;</div></li><li><div>          $current_blog = get_site_by_path( $domain, $path, substr_count( $current_site-&gt;path, '/' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Find the site by the domain and at most the first path segment.</span>&nbsp;</div></li><li><div>      $current_blog = get_site_by_path( $domain, $path, 1 );&nbsp;</div></li><li><div>      if ( $current_blog ) {&nbsp;</div></li><li><div>          $current_site = WP_Network::get_instance( $current_blog-&gt;site_id ? $current_blog-&gt;site_id : 1 );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// If you don't have a site with the same domain/path as a network, you're pretty screwed, but:</span>&nbsp;</div></li><li><div>          $current_site = WP_Network::get_by_path( $domain, $path, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The network declared by the site trumps any constants.</span>&nbsp;</div></li><li><div>  if ( $current_blog && $current_blog-&gt;site_id != $current_site-&gt;id ) {&nbsp;</div></li><li><div>      $current_site = WP_Network::get_instance( $current_blog-&gt;site_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// No network has been found, bail.</span>&nbsp;</div></li><li><div>  if ( empty( $current_site ) ) {&nbsp;</div></li><li><div>      <span class="comment">/** This action is documented in wp-includes/ms-settings.php */</span>&nbsp;</div></li><li><div>      do_action( 'ms_network_not_found', $domain, $path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// During activation of a new subdomain, the requested site does not yet exist.</span>&nbsp;</div></li><li><div>  if ( empty( $current_blog ) && wp_installing() ) {&nbsp;</div></li><li><div>      $current_blog = new stdClass;&nbsp;</div></li><li><div>      $current_blog-&gt;blog_id = $blog_id = 1;&nbsp;</div></li><li><div>      $current_blog-&gt;public = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// No site has been found, bail.</span>&nbsp;</div></li><li><div>  if ( empty( $current_blog ) ) {&nbsp;</div></li><li><div>      <span class="comment">// We're going to redirect to the network URL, with some possible modifications.</span>&nbsp;</div></li><li><div>      $scheme = is_ssl() ? 'https' : 'http';&nbsp;</div></li><li><div>      $destination = &quot;$scheme:<span class="comment">//{$current_site-&gt;domain}{$current_site-&gt;path}&quot;;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires when a network can be determined but a site cannot.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * At the time of this action, the only recourse is to redirect somewhere</span>&nbsp;</div></li><li><div><span class="comment">       * and exit. If you want to declare a particular site, do so earlier.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param object $current_site The network that had been determined.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $domain       The domain used to search for a site.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $path         The path used to search for a site.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'ms_site_not_found', $current_site, $domain, $path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $subdomain && ! defined( 'NOBLOGREDIRECT' ) ) {&nbsp;</div></li><li><div>          <span class="comment">// For a &quot;subdomain&quot; install, redirect to the signup form specifically.</span>&nbsp;</div></li><li><div>          $destination .= 'wp-signup.php?new=' . str_replace( '.' . $current_site-&gt;domain, '', $domain );&nbsp;</div></li><li><div>      } elseif ( $subdomain ) {&nbsp;</div></li><li><div>          <span class="comment">// For a &quot;subdomain&quot; install, the NOBLOGREDIRECT constant</span>&nbsp;</div></li><li><div>          <span class="comment">// can be used to avoid a redirect to the signup form.</span>&nbsp;</div></li><li><div>          <span class="comment">// Using the ms_site_not_found action is preferred to the constant.</span>&nbsp;</div></li><li><div>          if ( '%siteurl%' !== NOBLOGREDIRECT ) {&nbsp;</div></li><li><div>              $destination = NOBLOGREDIRECT;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ( 0 === strcasecmp( $current_site-&gt;domain, $domain ) ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * If the domain we were searching for matches the network's domain, </span>&nbsp;</div></li><li><div><span class="comment">           * it's no use redirecting back to ourselves -- it'll cause a loop.</span>&nbsp;</div></li><li><div><span class="comment">           * As we couldn't find a site, we're simply not installed.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $destination;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Figure out the current network's main site.</span>&nbsp;</div></li><li><div>  if ( empty( $current_site-&gt;blog_id ) ) {&nbsp;</div></li><li><div>      if ( $current_blog-&gt;domain === $current_site-&gt;domain && $current_blog-&gt;path === $current_site-&gt;path ) {&nbsp;</div></li><li><div>          $current_site-&gt;blog_id = $current_blog-&gt;blog_id;&nbsp;</div></li><li><div>      } elseif ( ! $current_site-&gt;blog_id = wp_cache_get( 'network:' . $current_site-&gt;id . ':main_site', 'site-options' ) ) {&nbsp;</div></li><li><div>          $current_site-&gt;blog_id = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT blog_id FROM $wpdb-&gt;blogs WHERE domain = %s AND path = %s&quot;, &nbsp;</div></li><li><div>              $current_site-&gt;domain, $current_site-&gt;path ) );&nbsp;</div></li><li><div>          wp_cache_add( 'network:' . $current_site-&gt;id . ':main_site', $current_site-&gt;blog_id, 'site-options' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays a failure message.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Used when a blog's tables do not exist. Checks for a missing $wpdb-&gt;site table as well.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 The `$domain` and `$path` parameters were added.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $domain The requested domain for the error to reference.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $path   The requested path for the error to reference.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function ms_not_installed( $domain, $path ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_admin() ) {&nbsp;</div></li><li><div>      dead_db();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_load_translations_early();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $title = __( 'Error establishing a database connection' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $msg = '&lt;h1&gt;' . $title . '&lt;/h1&gt;';&nbsp;</div></li><li><div>  $msg .= '&lt;p&gt;' . __( 'If your site does not display, please contact the owner of this network.' ) . '';&nbsp;</div></li><li><div>  $msg .= ' ' . __( 'If you are the owner of this network please check that MySQL is running properly and all tables are error free.' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  $query = $wpdb-&gt;prepare( &quot;SHOW TABLES LIKE %s&quot;, $wpdb-&gt;esc_like( $wpdb-&gt;site ) );&nbsp;</div></li><li><div>  if ( ! $wpdb-&gt;get_var( $query ) ) {&nbsp;</div></li><li><div>      $msg .= '&lt;p&gt;' . sprintf(&nbsp;</div></li><li><div>          <span class="comment">/** translators: %s: table name */</span>&nbsp;</div></li><li><div>          __( '&lt;strong&gt;Database tables are missing.&lt;/strong&gt; This means that MySQL is not running, WordPress was not installed properly, or someone deleted %s. You really should look at your database now.' ), &nbsp;</div></li><li><div>          '&lt;code&gt;' . $wpdb-&gt;site . '&lt;/code&gt;'&nbsp;</div></li><li><div> ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $msg .= '&lt;p&gt;' . sprintf(&nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: site url, 2: table name, 3: database name */</span>&nbsp;</div></li><li><div>          __( '&lt;strong&gt;Could not find site %1$s.&lt;/strong&gt; Searched for table %2$s in database %3$s. Is that right?' ), &nbsp;</div></li><li><div>          '&lt;code&gt;' . rtrim( $domain . $path, '/' ) . '&lt;/code&gt;', &nbsp;</div></li><li><div>          '&lt;code&gt;' . $wpdb-&gt;blogs . '&lt;/code&gt;', &nbsp;</div></li><li><div>          '&lt;code&gt;' . DB_NAME . '&lt;/code&gt;'&nbsp;</div></li><li><div> ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $msg .= '&lt;p&gt;&lt;strong&gt;' . __( 'What do I do now?' ) . '&lt;/strong&gt; ';&nbsp;</div></li><li><div>  <span class="comment">/** translators: %s: Codex URL */</span>&nbsp;</div></li><li><div>  $msg .= sprintf( __( 'Read the &lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;bug report&lt;/a&gt; page. Some of the guidelines there may help you figure out what went wrong.' ), &nbsp;</div></li><li><div>      __( 'https:<span class="comment">//codex.wordpress.org/Debugging_a_WordPress_Network' )</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $msg .= ' ' . __( 'If you&#8217;re still stuck with this message, then check that your database contains the following tables:' ) . '&lt;/p&gt;&lt;ul&gt;';&nbsp;</div></li><li><div>  foreach ( $wpdb-&gt;tables('global') as $t =&gt; $table ) {&nbsp;</div></li><li><div>      if ( 'sitecategories' == $t )&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      $msg .= '&lt;li&gt;' . $table . '&lt;/li&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $msg .= '&lt;/ul&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_die( $msg, $title, array( 'response' =&gt; 500 ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This deprecated function formerly set the site_name property of the $current_site object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function simply returns the object, as before.</span>&nbsp;</div></li><li><div><span class="comment"> * The bootstrap takes care of setting site_name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 3.9.0 Use get_current_site() instead.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $current_site</span>&nbsp;</div></li><li><div><span class="comment"> * @return object</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_current_site_name( $current_site ) {&nbsp;</div></li><li><div>  _deprecated_function( __FUNCTION__, '3.9.0', 'get_current_site()' );&nbsp;</div></li><li><div>  return $current_site;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This deprecated function managed much of the site and network loading in multisite.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The current bootstrap code is now responsible for parsing the site and network load as</span>&nbsp;</div></li><li><div><span class="comment"> * well as setting the global $current_site object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global object $current_site</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return object</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpmu_current_site() {&nbsp;</div></li><li><div>  global $current_site;&nbsp;</div></li><li><div>  _deprecated_function( __FUNCTION__, '3.9.0' );&nbsp;</div></li><li><div>  return $current_site;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve an object containing information about the requested network.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 4.7.0 Use `get_network()`</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_network()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal In 4.6.0, converted to use get_network()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object|int $network The network's database row or ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Network|false Object containing network information if found, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_network( $network ) {&nbsp;</div></li><li><div>  _deprecated_function( __FUNCTION__, '4.7.0', 'get_network()' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $network = get_network( $network );&nbsp;</div></li><li><div>  if ( null === $network ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $network;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>