<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.4" data-type="file" data-id="4818"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-option | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=4457bfb217d7ce9335be5a989fdb2043' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-option/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-option%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-option%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-file-wp-includes-option","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-option" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-option</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/option.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Option API</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Option</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves an option value based on an option name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the option does not exist or does not have a value, then the return value</span>&nbsp;</div></li><li><div><span class="comment"> * will be false. This is useful to check whether you need to install an option</span>&nbsp;</div></li><li><div><span class="comment"> * and is commonly used during installation of plugin options and to test</span>&nbsp;</div></li><li><div><span class="comment"> * whether upgrading is required.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the option was serialized then it will be unserialized when it is returned.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Any scalar values will be returned as strings. You may coerce the return type of</span>&nbsp;</div></li><li><div><span class="comment"> * a given option by registering an {@see 'option_$option'} filter callback.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option  Name of option to retrieve. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $default Optional. Default value to return if the option does not exist.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Value set for the option.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_option( $option, $default = false ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option = trim( $option );&nbsp;</div></li><li><div>  if ( empty( $option ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of an existing option before it is retrieved.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a truthy value to the filter will short-circuit retrieving</span>&nbsp;</div></li><li><div><span class="comment">   * the option value, returning the passed value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool|mixed $pre_option Value to return instead of the option value.</span>&nbsp;</div></li><li><div><span class="comment">   *                               Default false to skip it.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string     $option     Option name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $pre = apply_filters( &quot;pre_option_{$option}&quot;, false, $option );&nbsp;</div></li><li><div>  if ( false !== $pre )&nbsp;</div></li><li><div>      return $pre;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( defined( 'WP_SETUP_CONFIG' ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Distinguish between `false` as a default, and not passing one.</span>&nbsp;</div></li><li><div>  $passed_default = func_num_args() &gt; 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! wp_installing() ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// prevent non-existent options from triggering multiple queries</span></span>&nbsp;</div></li><li><div>      $notoptions = wp_cache_get( 'notoptions', 'options' );&nbsp;</div></li><li><div>      if ( isset( $notoptions[ $option ] ) ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the default value for an option.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.7.0 The `$passed_default` parameter was added to distinguish between a `false` value and the default parameter value.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param mixed  $default The default value to return if the option does not exist</span>&nbsp;</div></li><li><div><span class="comment">           *                        in the database.</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $option  Option name.</span>&nbsp;</div></li><li><div><span class="comment">           * @param bool   $passed_default Was `get_option()` passed a default value?</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          return apply_filters( &quot;default_option_{$option}&quot;, $default, $option, $passed_default );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $alloptions = wp_load_alloptions();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $alloptions[$option] ) ) {&nbsp;</div></li><li><div>          $value = $alloptions[$option];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $value = wp_cache_get( $option, 'options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( false === $value ) {&nbsp;</div></li><li><div>              $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, $option ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Has to be get_row instead of get_var because of funkiness with 0, false, null values</span></span>&nbsp;</div></li><li><div>              if ( is_object( $row ) ) {&nbsp;</div></li><li><div>                  $value = $row-&gt;option_value;&nbsp;</div></li><li><div>                  wp_cache_add( $option, $value, 'options' );&nbsp;</div></li><li><div>              } else { <span class="comment">// option does not exist, so we must cache its non-existence</span>&nbsp;</div></li><li><div>                  if ( ! is_array( $notoptions ) ) {&nbsp;</div></li><li><div>                       $notoptions = array();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $notoptions[$option] = true;&nbsp;</div></li><li><div>                  wp_cache_set( 'notoptions', $notoptions, 'options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/option.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  return apply_filters( 'default_option_' . $option, $default, $option, $passed_default );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $suppress = $wpdb-&gt;suppress_errors();&nbsp;</div></li><li><div>      $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT option_value FROM $wpdb-&gt;options WHERE option_name = %s LIMIT 1&quot;, $option ) );&nbsp;</div></li><li><div>      $wpdb-&gt;suppress_errors( $suppress );&nbsp;</div></li><li><div>      if ( is_object( $row ) ) {&nbsp;</div></li><li><div>          $value = $row-&gt;option_value;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/option.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          return apply_filters( 'default_option_' . $option, $default, $option, $passed_default );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If home is not set use siteurl.</span>&nbsp;</div></li><li><div>  if ( 'home' == $option && '' == $value )&nbsp;</div></li><li><div>      return get_option( 'siteurl' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( in_array( $option, array('siteurl', 'home', 'category_base', 'tag_base') ) )&nbsp;</div></li><li><div>      $value = untrailingslashit( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of an existing option.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0 As 'option_' . $setting</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value  Value of the option. If stored serialized, it will be</span>&nbsp;</div></li><li><div><span class="comment">   *                       unserialized prior to being returned.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option Option name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( &quot;option_{$option}&quot;, maybe_unserialize( $value ), $option );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Protect WordPress special option from being modified.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Will die if $option is in protected list. Protected options are 'alloptions'</span>&nbsp;</div></li><li><div><span class="comment"> * and 'notoptions' options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option Option name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_protect_special_option( $option ) {&nbsp;</div></li><li><div>  if ( 'alloptions' === $option || 'notoptions' === $option )&nbsp;</div></li><li><div>      wp_die( sprintf( __( '%s is a protected WP option and may not be modified' ), esc_html( $option ) ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Print option value after sanitizing for forms.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option Option name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function form_option( $option ) {&nbsp;</div></li><li><div>  echo esc_attr( get_option( $option ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Loads and caches all autoloaded options, if available or all options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array List of all options.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_load_alloptions() {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! wp_installing() || ! is_multisite() )&nbsp;</div></li><li><div>      $alloptions = wp_cache_get( 'alloptions', 'options' );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $alloptions = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$alloptions ) {&nbsp;</div></li><li><div>      $suppress = $wpdb-&gt;suppress_errors();&nbsp;</div></li><li><div>      if ( !$alloptions_db = $wpdb-&gt;get_results( &quot;SELECT option_name, option_value FROM $wpdb-&gt;options WHERE autoload = 'yes'&quot; ) )&nbsp;</div></li><li><div>          $alloptions_db = $wpdb-&gt;get_results( &quot;SELECT option_name, option_value FROM $wpdb-&gt;options&quot; );&nbsp;</div></li><li><div>      $wpdb-&gt;suppress_errors($suppress);&nbsp;</div></li><li><div>      $alloptions = array();&nbsp;</div></li><li><div>      foreach ( (array) $alloptions_db as $o ) {&nbsp;</div></li><li><div>          $alloptions[$o-&gt;option_name] = $o-&gt;option_value;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! wp_installing() || ! is_multisite() )&nbsp;</div></li><li><div>          wp_cache_add( 'alloptions', $alloptions, 'options' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $alloptions;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Loads and caches certain often requested site options if is_multisite() and a persistent cache is not being used.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $site_id Optional site ID for which to query the options. Defaults to the current site.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_load_core_site_options( $site_id = null ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_multisite() || wp_using_ext_object_cache() || wp_installing() )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty($site_id) )&nbsp;</div></li><li><div>      $site_id = $wpdb-&gt;siteid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $core_options = array('site_name', 'siteurl', 'active_sitewide_plugins', '_site_transient_timeout_theme_roots', '_site_transient_theme_roots', 'site_admins', 'can_compress_scripts', 'global_terms_enabled', 'ms_files_rewriting' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $core_options_in = &quot;'&quot; . implode(&quot;', '&quot;, $core_options) . &quot;'&quot;;&nbsp;</div></li><li><div>  $options = $wpdb-&gt;get_results( $wpdb-&gt;prepare(&quot;SELECT meta_key, meta_value FROM $wpdb-&gt;sitemeta WHERE meta_key IN ($core_options_in) AND site_id = %d&quot;, $site_id) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $options as $option ) {&nbsp;</div></li><li><div>      $key = $option-&gt;meta_key;&nbsp;</div></li><li><div>      $cache_key = &quot;{$site_id}:$key&quot;;&nbsp;</div></li><li><div>      $option-&gt;meta_value = maybe_unserialize( $option-&gt;meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_cache_set( $cache_key, $option-&gt;meta_value, 'site-options' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update the value of an option that was already added.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You do not need to serialize values. If the value needs to be serialized, then</span>&nbsp;</div></li><li><div><span class="comment"> * it will be serialized before it is inserted into the database. Remember, </span>&nbsp;</div></li><li><div><span class="comment"> * resources can not be serialized or added as an option.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the option does not exist, then the option will be added with the option value, </span>&nbsp;</div></li><li><div><span class="comment"> * with an `$autoload` value of 'yes'.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0 The `$autoload` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $option   Option name. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed       $value    Option value. Must be serializable if non-scalar. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|bool $autoload Optional. Whether to load the option when WordPress starts up. For existing options, </span>&nbsp;</div></li><li><div><span class="comment"> *                              `$autoload` can only be updated using `update_option()` if `$value` is also changed.</span>&nbsp;</div></li><li><div><span class="comment"> *                              Accepts 'yes'|true to enable or 'no'|false to disable. For non-existent options, </span>&nbsp;</div></li><li><div><span class="comment"> *                              the default value is 'yes'. Default null.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if value was not updated and true if value was updated.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_option( $option, $value, $autoload = null ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option = trim($option);&nbsp;</div></li><li><div>  if ( empty($option) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_protect_special_option( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_object( $value ) )&nbsp;</div></li><li><div>      $value = clone $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $value = sanitize_option( $option, $value );&nbsp;</div></li><li><div>  $old_value = get_option( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a specific option before its value is (maybe) serialized and updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     The new, unserialized option value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $old_value The old option value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option    Option name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $value = apply_filters( &quot;pre_update_option_{$option}&quot;, $value, $old_value, $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters an option before its value is (maybe) serialized and updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     The new, unserialized option value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option    Name of the option.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $old_value The old option value.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $value = apply_filters( 'pre_update_option', $value, $option, $old_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the new and old values are the same, no need to update.</span>&nbsp;</div></li><li><div>  if ( $value === $old_value )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/option.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>  if ( apply_filters( 'default_option_' . $option, false, $option, false ) === $old_value ) {&nbsp;</div></li><li><div>      <span class="comment">// Default setting for new options is 'yes'.</span>&nbsp;</div></li><li><div>      if ( null === $autoload ) {&nbsp;</div></li><li><div>          $autoload = 'yes';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return add_option( $option, $value, '', $autoload );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $serialized_value = maybe_serialize( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires immediately before an option value is updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option    Name of the option to update.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $old_value The old option value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     The new option value.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'update_option', $option, $old_value, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $update_args = array(&nbsp;</div></li><li><div>      'option_value' =&gt; $serialized_value, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( null !== $autoload ) {&nbsp;</div></li><li><div>      $update_args['autoload'] = ( 'no' === $autoload || false === $autoload ) ? 'no' : 'yes';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = $wpdb-&gt;update( $wpdb-&gt;options, $update_args, array( 'option_name' =&gt; $option ) );&nbsp;</div></li><li><div>  if ( ! $result )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $notoptions = wp_cache_get( 'notoptions', 'options' );&nbsp;</div></li><li><div>  if ( is_array( $notoptions ) && isset( $notoptions[$option] ) ) {&nbsp;</div></li><li><div>      unset( $notoptions[$option] );&nbsp;</div></li><li><div>      wp_cache_set( 'notoptions', $notoptions, 'options' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! wp_installing() ) {&nbsp;</div></li><li><div>      $alloptions = wp_load_alloptions();&nbsp;</div></li><li><div>      if ( isset( $alloptions[$option] ) ) {&nbsp;</div></li><li><div>          $alloptions[ $option ] = $serialized_value;&nbsp;</div></li><li><div>          wp_cache_set( 'alloptions', $alloptions, 'options' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_cache_set( $option, $serialized_value, 'options' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the value of a specific option has been successfully updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.1</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $old_value The old option value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     The new option value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option    Option name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( &quot;update_option_{$option}&quot;, $old_value, $value, $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the value of an option has been successfully updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option    Name of the updated option.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $old_value The old option value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     The new option value.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'updated_option', $option, $old_value, $value );&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a new option.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You do not need to serialize values. If the value needs to be serialized, then</span>&nbsp;</div></li><li><div><span class="comment"> * it will be serialized before it is inserted into the database. Remember, </span>&nbsp;</div></li><li><div><span class="comment"> * resources can not be serialized or added as an option.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You can create options without values and then update the values later.</span>&nbsp;</div></li><li><div><span class="comment"> * Existing options will not be updated and checks are performed to ensure that you</span>&nbsp;</div></li><li><div><span class="comment"> * aren't adding a protected WordPress option. Care should be taken to not name</span>&nbsp;</div></li><li><div><span class="comment"> * options the same as the ones which are protected.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string         $option      Name of option to add. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed          $value       Optional. Option value. Must be serializable if non-scalar. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string         $deprecated  Optional. Description. Not used anymore.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|bool    $autoload    Optional. Whether to load the option when WordPress starts up.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Default is enabled. Accepts 'no' to disable for legacy reasons.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if option was not added and true if option was added.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_option( $option, $value = '', $deprecated = '', $autoload = 'yes' ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $deprecated ) )&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '2.3.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option = trim($option);&nbsp;</div></li><li><div>  if ( empty($option) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_protect_special_option( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_object($value) )&nbsp;</div></li><li><div>      $value = clone $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $value = sanitize_option( $option, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Make sure the option doesn't already exist. We can check the 'notoptions' cache before we ask for a db query</span></span>&nbsp;</div></li><li><div>  $notoptions = wp_cache_get( 'notoptions', 'options' );&nbsp;</div></li><li><div>  if ( !is_array( $notoptions ) || !isset( $notoptions[$option] ) )&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/option.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( apply_filters( 'default_option_' . $option, false, $option, false ) !== get_option( $option ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $serialized_value = maybe_serialize( $value );&nbsp;</div></li><li><div>  $autoload = ( 'no' === $autoload || false === $autoload ) ? 'no' : 'yes';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before an option is added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option Name of the option to add.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value  Value of the option.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'add_option', $option, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = $wpdb-&gt;query( $wpdb-&gt;prepare( &quot;INSERT INTO `$wpdb-&gt;options` (`option_name`, `option_value`, `autoload`) VALUES (%s, %s, %s) ON DUPLICATE KEY UPDATE `option_name` = VALUES(`option_name`), `option_value` = VALUES(`option_value`), `autoload` = VALUES(`autoload`)&quot;, $option, $serialized_value, $autoload ) );&nbsp;</div></li><li><div>  if ( ! $result )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! wp_installing() ) {&nbsp;</div></li><li><div>      if ( 'yes' == $autoload ) {&nbsp;</div></li><li><div>          $alloptions = wp_load_alloptions();&nbsp;</div></li><li><div>          $alloptions[ $option ] = $serialized_value;&nbsp;</div></li><li><div>          wp_cache_set( 'alloptions', $alloptions, 'options' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_cache_set( $option, $serialized_value, 'options' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// This option exists now</span></span>&nbsp;</div></li><li><div>  $notoptions = wp_cache_get( 'notoptions', 'options' ); <span class="comment"><span class="comment">// yes, again... we need it to be fresh</span></span>&nbsp;</div></li><li><div>  if ( is_array( $notoptions ) && isset( $notoptions[$option] ) ) {&nbsp;</div></li><li><div>      unset( $notoptions[$option] );&nbsp;</div></li><li><div>      wp_cache_set( 'notoptions', $notoptions, 'options' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a specific option has been added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0 As &quot;add_option_{$name}&quot;</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option Name of the option to add.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value  Value of the option.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( &quot;add_option_{$option}&quot;, $option, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after an option has been added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option Name of the added option.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value  Value of the option.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'added_option', $option, $value );&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes option by name. Prevents removal of protected WordPress options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb WordPress database abstraction object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option Name of option to remove. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True, if option is successfully deleted. False on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_option( $option ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option = trim( $option );&nbsp;</div></li><li><div>  if ( empty( $option ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_protect_special_option( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the ID, if no ID then return</span>&nbsp;</div></li><li><div>  $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT autoload FROM $wpdb-&gt;options WHERE option_name = %s&quot;, $option ) );&nbsp;</div></li><li><div>  if ( is_null( $row ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires immediately before an option is deleted.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option Name of the option to delete.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'delete_option', $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = $wpdb-&gt;delete( $wpdb-&gt;options, array( 'option_name' =&gt; $option ) );&nbsp;</div></li><li><div>  if ( ! wp_installing() ) {&nbsp;</div></li><li><div>      if ( 'yes' == $row-&gt;autoload ) {&nbsp;</div></li><li><div>          $alloptions = wp_load_alloptions();&nbsp;</div></li><li><div>          if ( is_array( $alloptions ) && isset( $alloptions[$option] ) ) {&nbsp;</div></li><li><div>              unset( $alloptions[$option] );&nbsp;</div></li><li><div>              wp_cache_set( 'alloptions', $alloptions, 'options' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_cache_delete( $option, 'options' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a specific option has been deleted.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option Name of the deleted option.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( &quot;delete_option_{$option}&quot;, $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after an option has been deleted.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option Name of the deleted option.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'deleted_option', $option );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a transient.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient Transient name. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool true if successful, false otherwise</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_transient( $transient ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires immediately before a specific transient is deleted.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( &quot;delete_transient_{$transient}&quot;, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wp_using_ext_object_cache() ) {&nbsp;</div></li><li><div>      $result = wp_cache_delete( $transient, 'transient' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $option_timeout = '_transient_timeout_' . $transient;&nbsp;</div></li><li><div>      $option = '_transient_' . $transient;&nbsp;</div></li><li><div>      $result = delete_option( $option );&nbsp;</div></li><li><div>      if ( $result )&nbsp;</div></li><li><div>          delete_option( $option_timeout );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a transient is deleted.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $transient Deleted transient name.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'deleted_transient', $transient );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the value of a transient.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the transient does not exist, does not have a value, or has expired, </span>&nbsp;</div></li><li><div><span class="comment"> * then the return value will be false.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient Transient name. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Value of transient.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_transient( $transient ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of an existing transient.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a truthy value to the filter will effectively short-circuit retrieval</span>&nbsp;</div></li><li><div><span class="comment">   * of the transient, returning the passed value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$transient` parameter was added</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $pre_transient The default value to return if the transient does not exist.</span>&nbsp;</div></li><li><div><span class="comment">   *                              Any value other than false will short-circuit the retrieval</span>&nbsp;</div></li><li><div><span class="comment">   *                              of the transient, and return the returned value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient     Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $pre = apply_filters( &quot;pre_transient_{$transient}&quot;, false, $transient );&nbsp;</div></li><li><div>  if ( false !== $pre )&nbsp;</div></li><li><div>      return $pre;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wp_using_ext_object_cache() ) {&nbsp;</div></li><li><div>      $value = wp_cache_get( $transient, 'transient' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $transient_option = '_transient_' . $transient;&nbsp;</div></li><li><div>      if ( ! wp_installing() ) {&nbsp;</div></li><li><div>          <span class="comment">// If option is not in alloptions, it is not autoloaded and thus has a timeout</span>&nbsp;</div></li><li><div>          $alloptions = wp_load_alloptions();&nbsp;</div></li><li><div>          if ( !isset( $alloptions[$transient_option] ) ) {&nbsp;</div></li><li><div>              $transient_timeout = '_transient_timeout_' . $transient;&nbsp;</div></li><li><div>              $timeout = get_option( $transient_timeout );&nbsp;</div></li><li><div>              if ( false !== $timeout && $timeout &lt; time() ) {&nbsp;</div></li><li><div>                  delete_option( $transient_option );&nbsp;</div></li><li><div>                  delete_option( $transient_timeout );&nbsp;</div></li><li><div>                  $value = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $value ) )&nbsp;</div></li><li><div>          $value = get_option( $transient_option );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters an existing transient's value.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$transient` parameter was added</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     Value of transient.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( &quot;transient_{$transient}&quot;, $value, $transient );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set/update the value of a transient.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You do not need to serialize values. If the value needs to be serialized, then</span>&nbsp;</div></li><li><div><span class="comment"> * it will be serialized before it is set.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient  Transient name. Expected to not be SQL-escaped. Must be</span>&nbsp;</div></li><li><div><span class="comment"> *                           172 characters or fewer in length.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $value      Transient value. Must be serializable if non-scalar.</span>&nbsp;</div></li><li><div><span class="comment"> *                           Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $expiration Optional. Time until expiration in seconds. Default 0 (no expiration).</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if value was not set and true if value was set.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function set_transient( $transient, $value, $expiration = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $expiration = (int) $expiration;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a specific transient before its value is set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0 The `$expiration` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$transient` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value      New value of transient.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expiration Time until expiration in seconds.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient  Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $value = apply_filters( &quot;pre_set_transient_{$transient}&quot;, $value, $expiration, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the expiration for a transient before its value is set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expiration Time until expiration in seconds. Use 0 for no expiration.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value      New value of transient.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient  Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $expiration = apply_filters( &quot;expiration_of_transient_{$transient}&quot;, $expiration, $value, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wp_using_ext_object_cache() ) {&nbsp;</div></li><li><div>      $result = wp_cache_set( $transient, $value, 'transient', $expiration );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $transient_timeout = '_transient_timeout_' . $transient;&nbsp;</div></li><li><div>      $transient_option = '_transient_' . $transient;&nbsp;</div></li><li><div>      if ( false === get_option( $transient_option ) ) {&nbsp;</div></li><li><div>          $autoload = 'yes';&nbsp;</div></li><li><div>          if ( $expiration ) {&nbsp;</div></li><li><div>              $autoload = 'no';&nbsp;</div></li><li><div>              add_option( $transient_timeout, time() + $expiration, '', 'no' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $result = add_option( $transient_option, $value, '', $autoload );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// If expiration is requested, but the transient has no timeout option, </span>&nbsp;</div></li><li><div>          <span class="comment">// delete, then re-create transient rather than update.</span>&nbsp;</div></li><li><div>          $update = true;&nbsp;</div></li><li><div>          if ( $expiration ) {&nbsp;</div></li><li><div>              if ( false === get_option( $transient_timeout ) ) {&nbsp;</div></li><li><div>                  delete_option( $transient_option );&nbsp;</div></li><li><div>                  add_option( $transient_timeout, time() + $expiration, '', 'no' );&nbsp;</div></li><li><div>                  $result = add_option( $transient_option, $value, '', 'no' );&nbsp;</div></li><li><div>                  $update = false;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  update_option( $transient_timeout, time() + $expiration );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $update ) {&nbsp;</div></li><li><div>              $result = update_option( $transient_option, $value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the value for a specific transient has been set.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.6.0 The `$value` and `$expiration` parameters were added.</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.4.0 The `$transient` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Transient value.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $expiration Time until expiration in seconds.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $transient  The name of the transient.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( &quot;set_transient_{$transient}&quot;, $value, $expiration, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the value for a transient has been set.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.6.0 The `$value` and `$expiration` parameters were added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $transient  The name of the transient.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Transient value.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $expiration Time until expiration in seconds.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'setted_transient', $transient, $value, $expiration );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Saves and restores user interface settings stored in a cookie.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if the current user-settings cookie is updated and stores it. When no</span>&nbsp;</div></li><li><div><span class="comment"> * cookie exists (different browser used), adds the last saved cookie restoring</span>&nbsp;</div></li><li><div><span class="comment"> * the settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_user_settings() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_admin() || wp_doing_ajax() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user_id = get_current_user_id() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_super_admin() && ! is_user_member_of_blog() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = (string) get_user_option( 'user-settings', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_COOKIE['wp-settings-' . $user_id] ) ) {&nbsp;</div></li><li><div>      $cookie = preg_replace( '/[^A-Za-z0-9=&_]/', '', $_COOKIE['wp-settings-' . $user_id] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// No change or both empty</span>&nbsp;</div></li><li><div>      if ( $cookie == $settings )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $last_saved = (int) get_user_option( 'user-settings-time', $user_id );&nbsp;</div></li><li><div>      $current = isset( $_COOKIE['wp-settings-time-' . $user_id]) ? preg_replace( '/[^0-9]/', '', $_COOKIE['wp-settings-time-' . $user_id] ) : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// The cookie is newer than the saved value. Update the user_option and leave the cookie as-is</span>&nbsp;</div></li><li><div>      if ( $current &gt; $last_saved ) {&nbsp;</div></li><li><div>          update_user_option( $user_id, 'user-settings', $cookie, false );&nbsp;</div></li><li><div>          update_user_option( $user_id, 'user-settings-time', time() - 5, false );&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The cookie is not set in the current browser or the saved value is newer.</span>&nbsp;</div></li><li><div>  $secure = ( 'https' === parse_url( admin_url(), PHP_URL_SCHEME ) );&nbsp;</div></li><li><div>  setcookie( 'wp-settings-' . $user_id, $settings, time() + YEAR_IN_SECONDS, SITECOOKIEPATH, null, $secure );&nbsp;</div></li><li><div>  setcookie( 'wp-settings-time-' . $user_id, time(), time() + YEAR_IN_SECONDS, SITECOOKIEPATH, null, $secure );&nbsp;</div></li><li><div>  $_COOKIE['wp-settings-' . $user_id] = $settings;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve user interface setting value based on setting name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name    The name of the setting.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $default Optional default value to return when $name is not set.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed the last saved user setting or the default value/false if it doesn't exist.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_user_setting( $name, $default = false ) {&nbsp;</div></li><li><div>  $all_user_settings = get_all_user_settings();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return isset( $all_user_settings[$name] ) ? $all_user_settings[$name] : $default;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add or update user interface setting.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Both $name and $value can contain only ASCII letters, numbers and underscores.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function has to be used before any output has started as it calls setcookie().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name  The name of the setting.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $value The value for the setting.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|null True if set successfully, false if not. Null if the current user can't be established.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function set_user_setting( $name, $value ) {&nbsp;</div></li><li><div>  if ( headers_sent() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $all_user_settings = get_all_user_settings();&nbsp;</div></li><li><div>  $all_user_settings[$name] = $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return wp_set_all_user_settings( $all_user_settings );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete user interface settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Deleting settings would reset them to the defaults.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function has to be used before any output has started as it calls setcookie().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $names The name or array of names of the setting to be deleted.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|null True if deleted successfully, false if not. Null if the current user can't be established.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_user_setting( $names ) {&nbsp;</div></li><li><div>  if ( headers_sent() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $all_user_settings = get_all_user_settings();&nbsp;</div></li><li><div>  $names = (array) $names;&nbsp;</div></li><li><div>  $deleted = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $names as $name ) {&nbsp;</div></li><li><div>      if ( isset( $all_user_settings[$name] ) ) {&nbsp;</div></li><li><div>          unset( $all_user_settings[$name] );&nbsp;</div></li><li><div>          $deleted = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $deleted ) {&nbsp;</div></li><li><div>      return wp_set_all_user_settings( $all_user_settings );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve all user interface settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_updated_user_settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array the last saved user settings or empty array.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_all_user_settings() {&nbsp;</div></li><li><div>  global $_updated_user_settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user_id = get_current_user_id() ) {&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_updated_user_settings ) && is_array( $_updated_user_settings ) ) {&nbsp;</div></li><li><div>      return $_updated_user_settings;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_settings = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_COOKIE['wp-settings-' . $user_id] ) ) {&nbsp;</div></li><li><div>      $cookie = preg_replace( '/[^A-Za-z0-9=&_-]/', '', $_COOKIE['wp-settings-' . $user_id] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( strpos( $cookie, '=' ) ) { <span class="comment">// '=' cannot be 1st char</span>&nbsp;</div></li><li><div>          parse_str( $cookie, $user_settings );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $option = get_user_option( 'user-settings', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $option && is_string( $option ) ) {&nbsp;</div></li><li><div>          parse_str( $option, $user_settings );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_updated_user_settings = $user_settings;&nbsp;</div></li><li><div>  return $user_settings;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Private. Set all user interface settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_updated_user_settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $user_settings User settings.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|null False if the current user can't be found, null if the current</span>&nbsp;</div></li><li><div><span class="comment"> *                   user is not a super admin or a member of the site, otherwise true.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_set_all_user_settings( $user_settings ) {&nbsp;</div></li><li><div>  global $_updated_user_settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user_id = get_current_user_id() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_super_admin() && ! is_user_member_of_blog() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = '';&nbsp;</div></li><li><div>  foreach ( $user_settings as $name =&gt; $value ) {&nbsp;</div></li><li><div>      $_name = preg_replace( '/[^A-Za-z0-9_-]+/', '', $name );&nbsp;</div></li><li><div>      $_value = preg_replace( '/[^A-Za-z0-9_-]+/', '', $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $_name ) ) {&nbsp;</div></li><li><div>          $settings .= $_name . '=' . $_value . '&';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = rtrim( $settings, '&' );&nbsp;</div></li><li><div>  parse_str( $settings, $_updated_user_settings );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  update_user_option( $user_id, 'user-settings', $settings, false );&nbsp;</div></li><li><div>  update_user_option( $user_id, 'user-settings-time', time(), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete the user settings of the current user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_all_user_settings() {&nbsp;</div></li><li><div>  if ( ! $user_id = get_current_user_id() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  update_user_option( $user_id, 'user-settings', '', false );&nbsp;</div></li><li><div>  setcookie( 'wp-settings-' . $user_id, ' ', time() - YEAR_IN_SECONDS, SITECOOKIEPATH );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve an option value for the current network based on name of option.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 The `$use_cache` parameter was deprecated.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Modified into wrapper for get_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option     Name of option to retrieve. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $default    Optional value to return if option doesn't exist. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $deprecated Whether to use cache. Multisite only. Always set to true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Value set for the option.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_site_option( $option, $default = false, $deprecated = true ) {&nbsp;</div></li><li><div>  return get_network_option( null, $option, $default );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a new option for the current network.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Existing options will not be updated. Note that prior to 3.3 this wasn't the case.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Modified into wrapper for add_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see add_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option Name of option to add. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $value  Option value, can be anything. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if the option was not added. True if the option was added.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_site_option( $option, $value ) {&nbsp;</div></li><li><div>  return add_network_option( null, $option, $value );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes a option by name for the current network.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Modified into wrapper for delete_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see delete_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option Name of option to remove. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True, if succeed. False, if failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_site_option( $option ) {&nbsp;</div></li><li><div>  return delete_network_option( null, $option );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update the value of an option that was already added for the current network.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Modified into wrapper for update_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see update_network_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option Name of option. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $value  Option value. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if value was not updated. True if value was updated.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_site_option( $option, $value ) {&nbsp;</div></li><li><div>  return update_network_option( null, $option, $value );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve a network's option value based on the option name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int      $network_id ID of the network. Can be null to default to the current network ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $option     Name of option to retrieve. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed    $default    Optional. Value to return if the option doesn't exist. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Value set for the option.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_network_option( $network_id, $option, $default = false ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $network_id && ! is_numeric( $network_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $network_id = (int) $network_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Fallback to the current network if a network ID is not specified.</span></span></span></span>&nbsp;</div></li><li><div>  if ( ! $network_id ) {&nbsp;</div></li><li><div>      $network_id = get_current_network_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters an existing network option before it is retrieved.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a truthy value to the filter will effectively short-circuit retrieval, </span>&nbsp;</div></li><li><div><span class="comment">   * returning the passed value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0 As 'pre_site_option_' . $key</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $pre_option The default value to return if the option does not exist.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option     Option name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $pre = apply_filters( &quot;pre_site_option_{$option}&quot;, false, $option, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false !== $pre ) {&nbsp;</div></li><li><div>      return $pre;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// prevent non-existent options from triggering multiple queries</span></span>&nbsp;</div></li><li><div>  $notoptions_key = &quot;$network_id:notoptions&quot;;&nbsp;</div></li><li><div>  $notoptions = wp_cache_get( $notoptions_key, 'site-options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $notoptions[ $option ] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters a specific default network option.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $default    The value to return if the site option does not exist</span>&nbsp;</div></li><li><div><span class="comment">       *                           in the database.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option     Option name.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      return apply_filters( &quot;default_site_option_{$option}&quot;, $default, $option, $network_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_multisite() ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/option.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>      $default = apply_filters( 'default_site_option_' . $option, $default, $option, $network_id );&nbsp;</div></li><li><div>      $value = get_option( $option, $default );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $cache_key = &quot;$network_id:$option&quot;;&nbsp;</div></li><li><div>      $value = wp_cache_get( $cache_key, 'site-options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $value ) || false === $value ) {&nbsp;</div></li><li><div>          $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT meta_value FROM $wpdb-&gt;sitemeta WHERE meta_key = %s AND site_id = %d&quot;, $option, $network_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Has to be get_row instead of get_var because of funkiness with 0, false, null values</span></span>&nbsp;</div></li><li><div>          if ( is_object( $row ) ) {&nbsp;</div></li><li><div>              $value = $row-&gt;meta_value;&nbsp;</div></li><li><div>              $value = maybe_unserialize( $value );&nbsp;</div></li><li><div>              wp_cache_set( $cache_key, $value, 'site-options' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( ! is_array( $notoptions ) ) {&nbsp;</div></li><li><div>                  $notoptions = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $notoptions[ $option ] = true;&nbsp;</div></li><li><div>              wp_cache_set( $notoptions_key, $notoptions, 'site-options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This filter is documented in wp-includes/option.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $value = apply_filters( 'default_site_option_' . $option, $default, $option, $network_id );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of an existing network option.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0 As 'site_option_' . $key</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value      Value of network option.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option     Option name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( &quot;site_option_{$option}&quot;, $value, $option, $network_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a new network option.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Existing options will not be updated.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see add_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $network_id ID of the network. Can be null to default to the current network ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option     Name of option to add. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $value      Option value, can be anything. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if option was not added and true if option was added.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_network_option( $network_id, $option, $value ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $network_id && ! is_numeric( $network_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $network_id = (int) $network_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Fallback to the current network if a network ID is not specified.</span></span></span></span>&nbsp;</div></li><li><div>  if ( ! $network_id ) {&nbsp;</div></li><li><div>      $network_id = get_current_network_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_protect_special_option( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of a specific network option before it is added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0 As 'pre_add_site_option_' . $key</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value      Value of network option.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option     Option name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $value = apply_filters( &quot;pre_add_site_option_{$option}&quot;, $value, $option, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $notoptions_key = &quot;$network_id:notoptions&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_multisite() ) {&nbsp;</div></li><li><div>      $result = add_option( $option, $value, '', 'no' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $cache_key = &quot;$network_id:$option&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Make sure the option doesn't already exist. We can check the 'notoptions' cache before we ask for a db query</span></span>&nbsp;</div></li><li><div>      $notoptions = wp_cache_get( $notoptions_key, 'site-options' );&nbsp;</div></li><li><div>      if ( ! is_array( $notoptions ) || ! isset( $notoptions[ $option ] ) ) {&nbsp;</div></li><li><div>          if ( false !== get_network_option( $network_id, $option, false ) ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $value = sanitize_option( $option, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $serialized_value = maybe_serialize( $value );&nbsp;</div></li><li><div>      $result = $wpdb-&gt;insert( $wpdb-&gt;sitemeta, array( 'site_id' =&gt; $network_id, 'meta_key' =&gt; $option, 'meta_value' =&gt; $serialized_value ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $result ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_cache_set( $cache_key, $value, 'site-options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// This option exists now</span></span>&nbsp;</div></li><li><div>      $notoptions = wp_cache_get( $notoptions_key, 'site-options' ); <span class="comment"><span class="comment">// yes, again... we need it to be fresh</span></span>&nbsp;</div></li><li><div>      if ( is_array( $notoptions ) && isset( $notoptions[ $option ] ) ) {&nbsp;</div></li><li><div>          unset( $notoptions[ $option ] );&nbsp;</div></li><li><div>          wp_cache_set( $notoptions_key, $notoptions, 'site-options' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a specific network option has been successfully added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.9.0 As &quot;add_site_option_{$key}&quot;</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option     Name of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( &quot;add_site_option_{$option}&quot;, $option, $value, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a network option has been successfully added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option     Name of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'add_site_option', $option, $value, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes a network option by name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see delete_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $network_id ID of the network. Can be null to default to the current network ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option     Name of option to remove. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True, if succeed. False, if failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_network_option( $network_id, $option ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $network_id && ! is_numeric( $network_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $network_id = (int) $network_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Fallback to the current network if a network ID is not specified.</span></span></span></span>&nbsp;</div></li><li><div>  if ( ! $network_id ) {&nbsp;</div></li><li><div>      $network_id = get_current_network_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires immediately before a specific network option is deleted.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option     Option name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( &quot;pre_delete_site_option_{$option}&quot;, $option, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_multisite() ) {&nbsp;</div></li><li><div>      $result = delete_option( $option );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $row = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT meta_id FROM {$wpdb-&gt;sitemeta} WHERE meta_key = %s AND site_id = %d&quot;, $option, $network_id ) );&nbsp;</div></li><li><div>      if ( is_null( $row ) || ! $row-&gt;meta_id ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $cache_key = &quot;$network_id:$option&quot;;&nbsp;</div></li><li><div>      wp_cache_delete( $cache_key, 'site-options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $result = $wpdb-&gt;delete( $wpdb-&gt;sitemeta, array( 'meta_key' =&gt; $option, 'site_id' =&gt; $network_id ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a specific network option has been deleted.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.9.0 As &quot;delete_site_option_{$key}&quot;</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option     Name of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( &quot;delete_site_option_{$option}&quot;, $option, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a network option has been deleted.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option     Name of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'delete_site_option', $option, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update the value of a network option that was already added.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see update_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global wpdb $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int      $network_id ID of the network. Can be null to default to the current network ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $option     Name of option. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed    $value      Option value. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if value was not updated and true if value was updated.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_network_option( $network_id, $option, $value ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $network_id && ! is_numeric( $network_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $network_id = (int) $network_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Fallback to the current network if a network ID is not specified.</span></span></span></span>&nbsp;</div></li><li><div>  if ( ! $network_id ) {&nbsp;</div></li><li><div>      $network_id = get_current_network_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_protect_special_option( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $old_value = get_network_option( $network_id, $option, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a specific network option before its value is updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0 As 'pre_update_site_option_' . $key</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$option` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value      New value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $old_value  Old value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option     Option name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $value = apply_filters( &quot;pre_update_site_option_{$option}&quot;, $value, $old_value, $option, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $value === $old_value ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $old_value ) {&nbsp;</div></li><li><div>      return add_network_option( $network_id, $option, $value );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $notoptions_key = &quot;$network_id:notoptions&quot;;&nbsp;</div></li><li><div>  $notoptions = wp_cache_get( $notoptions_key, 'site-options' );&nbsp;</div></li><li><div>  if ( is_array( $notoptions ) && isset( $notoptions[ $option ] ) ) {&nbsp;</div></li><li><div>      unset( $notoptions[ $option ] );&nbsp;</div></li><li><div>      wp_cache_set( $notoptions_key, $notoptions, 'site-options' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_multisite() ) {&nbsp;</div></li><li><div>      $result = update_option( $option, $value, 'no' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $value = sanitize_option( $option, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $serialized_value = maybe_serialize( $value );&nbsp;</div></li><li><div>      $result = $wpdb-&gt;update( $wpdb-&gt;sitemeta, array( 'meta_value' =&gt; $serialized_value ), array( 'site_id' =&gt; $network_id, 'meta_key' =&gt; $option ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $result ) {&nbsp;</div></li><li><div>          $cache_key = &quot;$network_id:$option&quot;;&nbsp;</div></li><li><div>          wp_cache_set( $cache_key, $value, 'site-options' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the value of a specific network option has been successfully updated.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$option`, refers to the option name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.9.0 As &quot;update_site_option_{$key}&quot;</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option     Name of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Current value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $old_value  Old value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( &quot;update_site_option_{$option}&quot;, $option, $value, $old_value, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the value of a network option has been successfully updated.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.7.0 The `$network_id` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $option     Name of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Current value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $old_value  Old value of the network option.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $network_id ID of the network.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'update_site_option', $option, $value, $old_value, $network_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a site transient.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient Transient name. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if successful, false otherwise</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_site_transient( $transient ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires immediately before a specific site transient is deleted.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( &quot;delete_site_transient_{$transient}&quot;, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wp_using_ext_object_cache() ) {&nbsp;</div></li><li><div>      $result = wp_cache_delete( $transient, 'site-transient' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $option_timeout = '_site_transient_timeout_' . $transient;&nbsp;</div></li><li><div>      $option = '_site_transient_' . $transient;&nbsp;</div></li><li><div>      $result = delete_site_option( $option );&nbsp;</div></li><li><div>      if ( $result )&nbsp;</div></li><li><div>          delete_site_option( $option_timeout );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a transient is deleted.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $transient Deleted transient name.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'deleted_site_transient', $transient );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the value of a site transient.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the transient does not exist, does not have a value, or has expired, </span>&nbsp;</div></li><li><div><span class="comment"> * then the return value will be false.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_transient()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient Transient name. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Value of transient.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_site_transient( $transient ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of an existing site transient.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing a truthy value to the filter will effectively short-circuit retrieval, </span>&nbsp;</div></li><li><div><span class="comment">   * returning the passed value instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$transient` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $pre_site_transient The default value to return if the site transient does not exist.</span>&nbsp;</div></li><li><div><span class="comment">   *                                   Any value other than false will short-circuit the retrieval</span>&nbsp;</div></li><li><div><span class="comment">   *                                   of the transient, and return the returned value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient          Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $pre = apply_filters( &quot;pre_site_transient_{$transient}&quot;, false, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false !== $pre )&nbsp;</div></li><li><div>      return $pre;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wp_using_ext_object_cache() ) {&nbsp;</div></li><li><div>      $value = wp_cache_get( $transient, 'site-transient' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Core transients that do not have a timeout. Listed here so querying timeouts can be avoided.</span>&nbsp;</div></li><li><div>      $no_timeout = array('update_core', 'update_plugins', 'update_themes');&nbsp;</div></li><li><div>      $transient_option = '_site_transient_' . $transient;&nbsp;</div></li><li><div>      if ( ! in_array( $transient, $no_timeout ) ) {&nbsp;</div></li><li><div>          $transient_timeout = '_site_transient_timeout_' . $transient;&nbsp;</div></li><li><div>          $timeout = get_site_option( $transient_timeout );&nbsp;</div></li><li><div>          if ( false !== $timeout && $timeout &lt; time() ) {&nbsp;</div></li><li><div>              delete_site_option( $transient_option );&nbsp;</div></li><li><div>              delete_site_option( $transient_timeout );&nbsp;</div></li><li><div>              $value = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $value ) )&nbsp;</div></li><li><div>          $value = get_site_option( $transient_option );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of an existing site transient.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$transient` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     Value of site transient.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( &quot;site_transient_{$transient}&quot;, $value, $transient );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set/update the value of a site transient.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You do not need to serialize values, if the value needs to be serialize, then</span>&nbsp;</div></li><li><div><span class="comment"> * it will be serialized before it is set.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see set_transient()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient  Transient name. Expected to not be SQL-escaped. Must be</span>&nbsp;</div></li><li><div><span class="comment"> *                           40 characters or fewer in length.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $value      Transient value. Expected to not be SQL-escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $expiration Optional. Time until expiration in seconds. Default 0 (no expiration).</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if value was not set and true if value was set.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function set_site_transient( $transient, $value, $expiration = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the value of a specific site transient before it is set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0 The `$transient` parameter was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value     New value of site transient.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $value = apply_filters( &quot;pre_set_site_transient_{$transient}&quot;, $value, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $expiration = (int) $expiration;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the expiration for a site transient before its value is set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $expiration Time until expiration in seconds. Use 0 for no expiration.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value      New value of site transient.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient  Transient name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $expiration = apply_filters( &quot;expiration_of_site_transient_{$transient}&quot;, $expiration, $value, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wp_using_ext_object_cache() ) {&nbsp;</div></li><li><div>      $result = wp_cache_set( $transient, $value, 'site-transient', $expiration );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $transient_timeout = '_site_transient_timeout_' . $transient;&nbsp;</div></li><li><div>      $option = '_site_transient_' . $transient;&nbsp;</div></li><li><div>      if ( false === get_site_option( $option ) ) {&nbsp;</div></li><li><div>          if ( $expiration )&nbsp;</div></li><li><div>              add_site_option( $transient_timeout, time() + $expiration );&nbsp;</div></li><li><div>          $result = add_site_option( $option, $value );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( $expiration )&nbsp;</div></li><li><div>              update_site_option( $transient_timeout, time() + $expiration );&nbsp;</div></li><li><div>          $result = update_site_option( $option, $value );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $result ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the value for a specific site transient has been set.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$transient`, refers to the transient name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.4.0 The `$transient` parameter was added</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Site transient value.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $expiration Time until expiration in seconds.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $transient  Transient name.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( &quot;set_site_transient_{$transient}&quot;, $value, $expiration, $transient );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the value for a site transient has been set.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $transient  The name of the site transient.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value      Site transient value.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $expiration Time until expiration in seconds.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'setted_site_transient', $transient, $value, $expiration );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register default settings available in WordPress.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The settings registered here are primarily useful for the REST API, so this</span>&nbsp;</div></li><li><div><span class="comment"> * does not encompass all settings available in WordPress.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function register_initial_settings() {&nbsp;</div></li><li><div>  register_setting( 'general', 'blogname', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>          'name' =&gt; 'title', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Site title.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'general', 'blogdescription', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>          'name' =&gt; 'description', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Site tagline.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_multisite() ) {&nbsp;</div></li><li><div>      register_setting( 'general', 'siteurl', array(&nbsp;</div></li><li><div>          'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>              'name' =&gt; 'url', &nbsp;</div></li><li><div>              'schema' =&gt; array(&nbsp;</div></li><li><div>                  'format' =&gt; 'uri', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'type' =&gt; 'string', &nbsp;</div></li><li><div>          'description' =&gt; __( 'Site URL.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_multisite() ) {&nbsp;</div></li><li><div>      register_setting( 'general', 'admin_email', array(&nbsp;</div></li><li><div>          'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>              'name' =&gt; 'email', &nbsp;</div></li><li><div>              'schema' =&gt; array(&nbsp;</div></li><li><div>                  'format' =&gt; 'email', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'type' =&gt; 'string', &nbsp;</div></li><li><div>          'description' =&gt; __( 'This address is used for admin purposes, like new user notification.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'general', 'timezone_string', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>          'name' =&gt; 'timezone', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'A city in the same timezone as you.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'general', 'date_format', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; true, &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'A date format for all date strings.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'general', 'time_format', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; true, &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'A time format for all time strings.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'general', 'start_of_week', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; true, &nbsp;</div></li><li><div>      'type' =&gt; 'integer', &nbsp;</div></li><li><div>      'description' =&gt; __( 'A day number of the week that the week should start on.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'general', 'WPLANG', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>          'name' =&gt; 'language', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'WordPress locale code.' ), &nbsp;</div></li><li><div>      'default' =&gt; 'en_US', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'writing', 'use_smilies', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; true, &nbsp;</div></li><li><div>      'type' =&gt; 'boolean', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Convert emoticons like :-) and :-P to graphics on display.' ), &nbsp;</div></li><li><div>      'default' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'writing', 'default_category', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; true, &nbsp;</div></li><li><div>      'type' =&gt; 'integer', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Default post category.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'writing', 'default_post_format', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; true, &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Default post format.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'reading', 'posts_per_page', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; true, &nbsp;</div></li><li><div>      'type' =&gt; 'integer', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Blog pages show at most.' ), &nbsp;</div></li><li><div>      'default' =&gt; 10, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'discussion', 'default_ping_status', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>          'schema' =&gt; array(&nbsp;</div></li><li><div>              'enum' =&gt; array( 'open', 'closed' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Allow link notifications from other blogs (pingbacks and trackbacks) on new articles.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  register_setting( 'discussion', 'default_comment_status', array(&nbsp;</div></li><li><div>      'show_in_rest' =&gt; array(&nbsp;</div></li><li><div>          'schema' =&gt; array(&nbsp;</div></li><li><div>              'enum' =&gt; array( 'open', 'closed' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'description' =&gt; __( 'Allow people to post comments on new articles.' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register a setting and its data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0 `$args` can be passed to set flags on the setting, similar to `register_meta()`.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $new_whitelist_options</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_registered_settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option_group A settings group name. Should correspond to a whitelisted option key name.</span>&nbsp;</div></li><li><div><span class="comment"> *     Default whitelisted option key names include &quot;general, &quot; &quot;discussion, &quot; and &quot;reading, &quot; among others.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option_name The name of an option to sanitize and save.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Data used to describe the setting when registered.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $type              The type of data associated with this setting.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $description       A description of the data attached to this setting.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type callable $sanitize_callback A callback function that sanitizes the option's value.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool     $show_in_rest      Whether data associated with this setting should be included in the REST API.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type mixed    $default           Default value when calling `get_option()`.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function register_setting( $option_group, $option_name, $args = array() ) {&nbsp;</div></li><li><div>  global $new_whitelist_options, $wp_registered_settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'type' =&gt; 'string', &nbsp;</div></li><li><div>      'group' =&gt; $option_group, &nbsp;</div></li><li><div>      'description' =&gt; '', &nbsp;</div></li><li><div>      'sanitize_callback' =&gt; null, &nbsp;</div></li><li><div>      'show_in_rest' =&gt; false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Back-compat: old sanitize callback is added.</span>&nbsp;</div></li><li><div>  if ( is_callable( $args ) ) {&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          'sanitize_callback' =&gt; $args, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the registration arguments when registering a setting.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args         Array of setting registration arguments.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $defaults     Array of default arguments.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option_group Setting group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option_name  Setting name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $args = apply_filters( 'register_setting_args', $args, $defaults, $option_group, $option_name );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $wp_registered_settings ) ) {&nbsp;</div></li><li><div>      $wp_registered_settings = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'misc' == $option_group ) {&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '3.0.0', sprintf( __( 'The &quot;%s&quot; options group has been removed. Use another settings group.' ), 'misc' ) );&nbsp;</div></li><li><div>      $option_group = 'general';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'privacy' == $option_group ) {&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '3.5.0', sprintf( __( 'The &quot;%s&quot; options group has been removed. Use another settings group.' ), 'privacy' ) );&nbsp;</div></li><li><div>      $option_group = 'reading';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $new_whitelist_options[ $option_group ][] = $option_name;&nbsp;</div></li><li><div>  if ( ! empty( $args['sanitize_callback'] ) ) {&nbsp;</div></li><li><div>      add_filter( &quot;sanitize_option_{$option_name}&quot;, $args['sanitize_callback'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( array_key_exists( 'default', $args ) ) {&nbsp;</div></li><li><div>      add_filter( &quot;default_option_{$option_name}&quot;, 'filter_default_option', 10, 3 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_registered_settings[ $option_name ] = $args;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Unregister a setting.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0 `$sanitize_callback` was deprecated. The callback from `register_setting()` is now used instead.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $new_whitelist_options</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $option_group      The settings group name used during registration.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string   $option_name       The name of the option to unregister.</span>&nbsp;</div></li><li><div><span class="comment"> * @param callable $deprecated        Deprecated.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function unregister_setting( $option_group, $option_name, $deprecated = '' ) {&nbsp;</div></li><li><div>  global $new_whitelist_options, $wp_registered_settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'misc' == $option_group ) {&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '3.0.0', sprintf( __( 'The &quot;%s&quot; options group has been removed. Use another settings group.' ), 'misc' ) );&nbsp;</div></li><li><div>      $option_group = 'general';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'privacy' == $option_group ) {&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '3.5.0', sprintf( __( 'The &quot;%s&quot; options group has been removed. Use another settings group.' ), 'privacy' ) );&nbsp;</div></li><li><div>      $option_group = 'reading';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pos = array_search( $option_name, (array) $new_whitelist_options[ $option_group ] );&nbsp;</div></li><li><div>  if ( $pos !== false ) {&nbsp;</div></li><li><div>      unset( $new_whitelist_options[ $option_group ][ $pos ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( '' !== $deprecated ) {&nbsp;</div></li><li><div>      _deprecated_argument( __FUNCTION__, '4.7.0', __( '$sanitize_callback is deprecated. The callback from register_setting() is used instead.' ) );&nbsp;</div></li><li><div>      remove_filter( &quot;sanitize_option_{$option_name}&quot;, $deprecated );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $wp_registered_settings[ $option_name ] ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Remove the sanitize callback if one was set during registration.</span>&nbsp;</div></li><li><div>      if ( ! empty( $wp_registered_settings[ $option_name ]['sanitize_callback'] ) ) {&nbsp;</div></li><li><div>          remove_filter( &quot;sanitize_option_{$option_name}&quot;, $wp_registered_settings[ $option_name ]['sanitize_callback'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset( $wp_registered_settings[ $option_name ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves an array of registered settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array List of registered settings, keyed by option name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_registered_settings() {&nbsp;</div></li><li><div>  global $wp_registered_settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $wp_registered_settings ) ) {&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $wp_registered_settings;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filter the default value for the option.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * For settings which register a default setting in `register_setting()`, this</span>&nbsp;</div></li><li><div><span class="comment"> * function is added as a filter to `default_option_{$option}`.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $default Existing default value to return.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option Option name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $passed_default Was `get_option()` passed a default value?</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Filtered default value.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function filter_default_option( $default, $option, $passed_default ) {&nbsp;</div></li><li><div>  if ( $passed_default ) {&nbsp;</div></li><li><div>      return $default;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $registered = get_registered_settings();&nbsp;</div></li><li><div>  if ( empty( $registered[ $option ] ) ) {&nbsp;</div></li><li><div>      return $default;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $registered[ $option ]['default'];&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>