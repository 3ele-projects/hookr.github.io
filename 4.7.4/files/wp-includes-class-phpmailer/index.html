<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.4" data-type="file" data-id="4638"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-class-phpmailer | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=a757e087ea2e855b10253ead78ffdb4e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-class-phpmailer/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-class-phpmailer%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-class-phpmailer%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-file-wp-includes-class-phpmailer","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-class-phpmailer" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-class-phpmailer</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/class-phpmailer.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * PHPMailer - PHP email creation and transport class.</span>&nbsp;</div></li><li><div><span class="comment"> * PHP Version 5</span>&nbsp;</div></li><li><div><span class="comment"> * @package PHPMailer</span>&nbsp;</div></li><li><div><span class="comment"> * @link https://github.com/PHPMailer/PHPMailer/ The PHPMailer GitHub project</span>&nbsp;</div></li><li><div><span class="comment"> * @author Marcus Bointon (Synchro/coolbru) &lt;phpmailer@synchromedia.co.uk&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @author Jim Jagielski (jimjag) &lt;jimjag@gmail.com&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @author Andy Prevost (codeworxtech) &lt;codeworxtech@users.sourceforge.net&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @author Brent R. Matzelle (original founder)</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright 2012 - 2014 Marcus Bointon</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright 2010 - 2012 Jim Jagielski</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright 2004 - 2009 Andy Prevost</span>&nbsp;</div></li><li><div><span class="comment"> * @license http://www.gnu.org/copyleft/lesser.html GNU Lesser General Public License</span>&nbsp;</div></li><li><div><span class="comment"> * @note This program is distributed in the hope that it will be useful - WITHOUT</span>&nbsp;</div></li><li><div><span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>&nbsp;</div></li><li><div><span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * PHPMailer - PHP email creation and transport class.</span>&nbsp;</div></li><li><div><span class="comment"> * @package PHPMailer</span>&nbsp;</div></li><li><div><span class="comment"> * @author Marcus Bointon (Synchro/coolbru) &lt;phpmailer@synchromedia.co.uk&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @author Jim Jagielski (jimjag) &lt;jimjag@gmail.com&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @author Andy Prevost (codeworxtech) &lt;codeworxtech@users.sourceforge.net&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @author Brent R. Matzelle (original founder)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class PHPMailer&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The PHPMailer Version number.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Version = '5.2.22';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Email priority.</span>&nbsp;</div></li><li><div><span class="comment">   * Options: null (default), 1 = High, 3 = Normal, 5 = low.</span>&nbsp;</div></li><li><div><span class="comment">   * When null, the header is not set at all.</span>&nbsp;</div></li><li><div><span class="comment">   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Priority = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The character set of the message.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $CharSet = 'iso-8859-1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The MIME Content-type of the message.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $ContentType = 'text/plain';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The message encoding.</span>&nbsp;</div></li><li><div><span class="comment">   * Options: &quot;8bit&quot;, &quot;7bit&quot;, &quot;binary&quot;, &quot;base64&quot;, and &quot;quoted-printable&quot;.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Encoding = '8bit';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the most recent mailer error message.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $ErrorInfo = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The From email address for the message.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $From = 'root@localhost';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The From name of the message.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $FromName = 'Root User';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The Sender email (Return-Path) of the message.</span>&nbsp;</div></li><li><div><span class="comment">   * If not empty, will be sent via -f to sendmail or as 'MAIL FROM' in smtp mode.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Sender = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The Return-Path of the message.</span>&nbsp;</div></li><li><div><span class="comment">   * If empty, it will be set to either From or Sender.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated Email senders should never set a return-path header;</span>&nbsp;</div></li><li><div><span class="comment">   * it's the receiver's job (RFC5321 section 4.4), so this no longer does anything.</span>&nbsp;</div></li><li><div><span class="comment">   * @link https://tools.ietf.org/html/rfc5321#section-4.4 RFC5321 reference</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $ReturnPath = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The Subject of the message.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Subject = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * An HTML or plain text message body.</span>&nbsp;</div></li><li><div><span class="comment">   * If HTML then call isHTML(true).</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Body = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The plain-text message body.</span>&nbsp;</div></li><li><div><span class="comment">   * This body can be read by mail clients that do not have HTML email</span>&nbsp;</div></li><li><div><span class="comment">   * capability such as mutt & Eudora.</span>&nbsp;</div></li><li><div><span class="comment">   * Clients that can read HTML will view the normal Body.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $AltBody = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * An iCal message part body.</span>&nbsp;</div></li><li><div><span class="comment">   * Only supported in simple alt or alt_inline message types</span>&nbsp;</div></li><li><div><span class="comment">   * To generate iCal events, use the bundled extras/EasyPeasyICS.php class or iCalcreator</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://sprain.ch/blog/downloads/php-class-easypeasyics-create-ical-files-with-php/</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://kigkonsult.se/iCalcreator/</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Ical = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The complete compiled MIME message body.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $MIMEBody = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The complete compiled MIME message headers.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $MIMEHeader = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Extra headers that createHeader() doesn't fold in.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $mailHeader = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Word-wrap the message body to this number of chars.</span>&nbsp;</div></li><li><div><span class="comment">   * Set to 0 to not wrap. A useful value here is 78, for RFC2822 section 2.1.1 compliance.</span>&nbsp;</div></li><li><div><span class="comment">   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $WordWrap = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Which method to use to send mail.</span>&nbsp;</div></li><li><div><span class="comment">   * Options: &quot;mail&quot;, &quot;sendmail&quot;, or &quot;smtp&quot;.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Mailer = 'mail';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The path to the sendmail program.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Sendmail = '/usr/sbin/sendmail';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether mail() uses a fully sendmail-compatible MTA.</span>&nbsp;</div></li><li><div><span class="comment">   * One which supports sendmail's &quot;-oi -f&quot; options.</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $UseSendmailOptions = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Path to PHPMailer plugins.</span>&nbsp;</div></li><li><div><span class="comment">   * Useful if the SMTP class is not in the PHP include path.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated Should not be needed now there is an autoloader.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $PluginDir = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The email address that a reading confirmation should be sent to, also known as read receipt.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $ConfirmReadingTo = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The hostname to use in the Message-ID header and as default HELO string.</span>&nbsp;</div></li><li><div><span class="comment">   * If empty, PHPMailer attempts to find one with, in order, </span>&nbsp;</div></li><li><div><span class="comment">   * $_SERVER['SERVER_NAME'], gethostname(), php_uname('n'), or the value</span>&nbsp;</div></li><li><div><span class="comment">   * 'localhost.localdomain'.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Hostname = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * An ID to be used in the Message-ID header.</span>&nbsp;</div></li><li><div><span class="comment">   * If empty, a unique id will be generated.</span>&nbsp;</div></li><li><div><span class="comment">   * You can set your own, but it must be in the format &quot;&lt;id@domain&gt;&quot;, </span>&nbsp;</div></li><li><div><span class="comment">   * as defined in RFC5322 section 3.6.4 or it will be ignored.</span>&nbsp;</div></li><li><div><span class="comment">   * @see https://tools.ietf.org/html/rfc5322#section-3.6.4</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $MessageID = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The message Date to be used in the Date header.</span>&nbsp;</div></li><li><div><span class="comment">   * If empty, the current date will be added.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $MessageDate = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP hosts.</span>&nbsp;</div></li><li><div><span class="comment">   * Either a single hostname or multiple semicolon-delimited hostnames.</span>&nbsp;</div></li><li><div><span class="comment">   * You can also specify a different port</span>&nbsp;</div></li><li><div><span class="comment">   * for each host by using this format: [hostname:port]</span>&nbsp;</div></li><li><div><span class="comment">   * (e.g. &quot;smtp1.example.com:25;smtp2.example.com&quot;).</span>&nbsp;</div></li><li><div><span class="comment">   * You can also specify encryption type, for example:</span>&nbsp;</div></li><li><div><span class="comment">   * (e.g. &quot;tls://smtp1.example.com:587;ssl://smtp2.example.com:465&quot;).</span>&nbsp;</div></li><li><div><span class="comment">   * Hosts will be tried in order.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Host = 'localhost';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The default SMTP server port.</span>&nbsp;</div></li><li><div><span class="comment">   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">   * @TODO Why is this needed when the SMTP class takes care of it?</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Port = 25;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The SMTP HELO of the message.</span>&nbsp;</div></li><li><div><span class="comment">   * Default is $Hostname. If $Hostname is empty, PHPMailer attempts to find</span>&nbsp;</div></li><li><div><span class="comment">   * one with the same method described above for $Hostname.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$Hostname</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Helo = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * What kind of encryption to use on the SMTP connection.</span>&nbsp;</div></li><li><div><span class="comment">   * Options: '', 'ssl' or 'tls'</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SMTPSecure = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to enable TLS encryption automatically if a server supports it, </span>&nbsp;</div></li><li><div><span class="comment">   * even if `SMTPSecure` is not set to 'tls'.</span>&nbsp;</div></li><li><div><span class="comment">   * Be aware that in PHP &gt;= 5.6 this requires that the server's certificates are valid.</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SMTPAutoTLS = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to use SMTP authentication.</span>&nbsp;</div></li><li><div><span class="comment">   * Uses the Username and Password properties.</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$Username</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$Password</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SMTPAuth = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Options array passed to stream_context_create when connecting via SMTP.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SMTPOptions = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP username.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Username = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP password.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Password = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP auth type.</span>&nbsp;</div></li><li><div><span class="comment">   * Options are CRAM-MD5, LOGIN, PLAIN, attempted in that order if not specified</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $AuthType = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP realm.</span>&nbsp;</div></li><li><div><span class="comment">   * Used for NTLM auth</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Realm = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP workstation.</span>&nbsp;</div></li><li><div><span class="comment">   * Used for NTLM auth</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Workstation = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The SMTP server timeout in seconds.</span>&nbsp;</div></li><li><div><span class="comment">   * Default of 5 minutes (300sec) is from RFC2821 section 4.5.3.2</span>&nbsp;</div></li><li><div><span class="comment">   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Timeout = 300;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP class debug output mode.</span>&nbsp;</div></li><li><div><span class="comment">   * Debug output level.</span>&nbsp;</div></li><li><div><span class="comment">   * Options:</span>&nbsp;</div></li><li><div><span class="comment">   * * `0` No output</span>&nbsp;</div></li><li><div><span class="comment">   * * `1` Commands</span>&nbsp;</div></li><li><div><span class="comment">   * * `2` Data and commands</span>&nbsp;</div></li><li><div><span class="comment">   * * `3` As 2 plus connection status</span>&nbsp;</div></li><li><div><span class="comment">   * * `4` Low-level data output</span>&nbsp;</div></li><li><div><span class="comment">   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">   * @see SMTP::$do_debug</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SMTPDebug = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * How to handle debug output.</span>&nbsp;</div></li><li><div><span class="comment">   * Options:</span>&nbsp;</div></li><li><div><span class="comment">   * * `echo` Output plain-text as-is, appropriate for CLI</span>&nbsp;</div></li><li><div><span class="comment">   * * `html` Output escaped, line breaks converted to `&lt;br&gt;`, appropriate for browser output</span>&nbsp;</div></li><li><div><span class="comment">   * * `error_log` Output to error log as configured in php.ini</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Alternatively, you can provide a callable expecting two params: a message string and the debug level:</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * $mail-&gt;Debugoutput = function($str, $level) {echo &quot;debug level $level; message: $str&quot;;};</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * @var string|callable</span>&nbsp;</div></li><li><div><span class="comment">   * @see SMTP::$Debugoutput</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $Debugoutput = 'echo';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to keep SMTP connection open after each message.</span>&nbsp;</div></li><li><div><span class="comment">   * If this is set to true then to close the connection</span>&nbsp;</div></li><li><div><span class="comment">   * requires an explicit call to smtpClose().</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SMTPKeepAlive = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to split multiple to addresses into multiple messages</span>&nbsp;</div></li><li><div><span class="comment">   * or send them all in one message.</span>&nbsp;</div></li><li><div><span class="comment">   * Only supported in `mail` and `sendmail` transports, not in SMTP.</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SingleTo = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Storage for addresses when SingleTo is enabled.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @TODO This should really not be public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $SingleToArray = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to generate VERP addresses on send.</span>&nbsp;</div></li><li><div><span class="comment">   * Only applicable when sending via SMTP.</span>&nbsp;</div></li><li><div><span class="comment">   * @link https://en.wikipedia.org/wiki/Variable_envelope_return_path</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://www.postfix.org/VERP_README.html Postfix VERP info</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $do_verp = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to allow sending messages with an empty body.</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $AllowEmpty = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The default line ending.</span>&nbsp;</div></li><li><div><span class="comment">   * @note The default remains &quot;\n&quot;. We force CRLF where we know</span>&nbsp;</div></li><li><div><span class="comment">   *        it must be used via self::CRLF.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $LE = &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * DKIM selector.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $DKIM_selector = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * DKIM Identity.</span>&nbsp;</div></li><li><div><span class="comment">   * Usually the email address used as the source of the email.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $DKIM_identity = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * DKIM passphrase.</span>&nbsp;</div></li><li><div><span class="comment">   * Used if your key is encrypted.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $DKIM_passphrase = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * DKIM signing domain name.</span>&nbsp;</div></li><li><div><span class="comment">   * @example 'example.com'</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $DKIM_domain = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * DKIM private key file path.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $DKIM_private = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * DKIM private key string.</span>&nbsp;</div></li><li><div><span class="comment">   * If set, takes precedence over `$DKIM_private`.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $DKIM_private_string = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Callback Action function name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The function that handles the result of the send email action.</span>&nbsp;</div></li><li><div><span class="comment">   * It is called out by send() for each email sent.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Value can be any php callable: http://www.php.net/is_callable</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Parameters:</span>&nbsp;</div></li><li><div><span class="comment">   *   boolean $result        result of the send action</span>&nbsp;</div></li><li><div><span class="comment">   *   string  $to            email address of the recipient</span>&nbsp;</div></li><li><div><span class="comment">   *   string  $cc            cc email addresses</span>&nbsp;</div></li><li><div><span class="comment">   *   string  $bcc           bcc email addresses</span>&nbsp;</div></li><li><div><span class="comment">   *   string  $subject       the subject</span>&nbsp;</div></li><li><div><span class="comment">   *   string  $body          the email body</span>&nbsp;</div></li><li><div><span class="comment">   *   string  $from          email address of sender</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $action_function = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * What to put in the X-Mailer header.</span>&nbsp;</div></li><li><div><span class="comment">   * Options: An empty string for PHPMailer default, whitespace for none, or a string to use</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $XMailer = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Which validator to use by default when validating email addresses.</span>&nbsp;</div></li><li><div><span class="comment">   * May be a callable to inject your own validator, but there are several built-in validators.</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::validateAddress()</span>&nbsp;</div></li><li><div><span class="comment">   * @var string|callable</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $validator = 'auto';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * An instance of the SMTP sender class.</span>&nbsp;</div></li><li><div><span class="comment">   * @var SMTP</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $smtp = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of 'to' names and addresses.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $to = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of 'cc' names and addresses.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $cc = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of 'bcc' names and addresses.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $bcc = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of reply-to names and addresses.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $ReplyTo = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * An array of all kinds of addresses.</span>&nbsp;</div></li><li><div><span class="comment">   * Includes all of $to, $cc, $bcc</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$to @see PHPMailer::$cc @see PHPMailer::$bcc</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $all_recipients = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * An array of names and addresses queued for validation.</span>&nbsp;</div></li><li><div><span class="comment">   * In send(), valid and non duplicate entries are moved to $all_recipients</span>&nbsp;</div></li><li><div><span class="comment">   * and one of $to, $cc, or $bcc.</span>&nbsp;</div></li><li><div><span class="comment">   * This array is used only for addresses with IDN.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$to @see PHPMailer::$cc @see PHPMailer::$bcc</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$all_recipients</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $RecipientsQueue = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * An array of reply-to names and addresses queued for validation.</span>&nbsp;</div></li><li><div><span class="comment">   * In send(), valid and non duplicate entries are moved to $ReplyTo.</span>&nbsp;</div></li><li><div><span class="comment">   * This array is used only for addresses with IDN.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$ReplyTo</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $ReplyToQueue = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of attachments.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $attachment = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of custom headers.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $CustomHeader = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The most recent Message-ID (including angular brackets).</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $lastMessageID = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The message's MIME type.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $message_type = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of MIME boundary strings.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $boundary = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The array of available languages.</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $language = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The number of errors encountered.</span>&nbsp;</div></li><li><div><span class="comment">   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $error_count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The S/MIME certificate file path.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $sign_cert_file = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The S/MIME key file path.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $sign_key_file = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The optional S/MIME extra certificates (&quot;CA Chain&quot;) file path.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $sign_extracerts_file = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The S/MIME password for the key.</span>&nbsp;</div></li><li><div><span class="comment">   * Used only if the key is encrypted.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $sign_key_pass = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to throw exceptions for errors.</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $exceptions = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Unique ID used for message ID and boundaries.</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $uniqueid = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Error severity: message only, continue processing.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  const STOP_MESSAGE = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Error severity: message, likely ok to continue processing.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  const STOP_CONTINUE = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Error severity: message, plus full stop, critical error reached.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  const STOP_CRITICAL = 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * SMTP RFC standard line ending.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  const CRLF = &quot;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The maximum line length allowed by RFC 2822 section 2.1.1</span>&nbsp;</div></li><li><div><span class="comment">   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  const MAX_LINE_LENGTH = 998;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructor.</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $exceptions Should we throw external exceptions?</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct($exceptions = null)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($exceptions !== null) {&nbsp;</div></li><li><div>          $this-&gt;exceptions = (boolean)$exceptions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Destructor.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __destruct()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Close any open SMTP connection nicely</span>&nbsp;</div></li><li><div>      $this-&gt;smtpClose();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Call mail() in a safe_mode-aware fashion.</span>&nbsp;</div></li><li><div><span class="comment">   * Also, unless sendmail_path points to sendmail (or something that</span>&nbsp;</div></li><li><div><span class="comment">   * claims to be sendmail), don't pass params (not a perfect fix, </span>&nbsp;</div></li><li><div><span class="comment">   * but it will do)</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $to To</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $subject Subject</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $body Message Body</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $header Additional Header(s)</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $params Params</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function mailPassthru($to, $subject, $body, $header, $params)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Check overloading of mail function to avoid double-encoding</span>&nbsp;</div></li><li><div>      if (ini_get('mbstring.func_overload') & 1) {&nbsp;</div></li><li><div>          $subject = $this-&gt;secureHeader($subject);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $subject = $this-&gt;encodeHeader($this-&gt;secureHeader($subject));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Can't use additional_parameters in safe_mode, calling mail() with null params breaks</span>&nbsp;</div></li><li><div>      <span class="comment">//@link http://php.net/manual/en/function.mail.php</span>&nbsp;</div></li><li><div>      if (ini_get('safe_mode') or !$this-&gt;UseSendmailOptions or is_null($params)) {&nbsp;</div></li><li><div>          $result = @mail($to, $subject, $body, $header);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $result = @mail($to, $subject, $body, $header, $params);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output debugging info via user-defined method.</span>&nbsp;</div></li><li><div><span class="comment">   * Only generates output if SMTP debug output is enabled (@see SMTP::$do_debug).</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$Debugoutput</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$SMTPDebug</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function edebug($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;SMTPDebug &lt;= 0) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Avoid clash with built-in function names</span>&nbsp;</div></li><li><div>      if (!in_array($this-&gt;Debugoutput, array('error_log', 'html', 'echo')) and is_callable($this-&gt;Debugoutput)) {&nbsp;</div></li><li><div>          call_user_func($this-&gt;Debugoutput, $str, $this-&gt;SMTPDebug);&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      switch ($this-&gt;Debugoutput) {&nbsp;</div></li><li><div>          case 'error_log':&nbsp;</div></li><li><div>              <span class="comment">//Don't output, just log</span>&nbsp;</div></li><li><div>              error_log($str);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'html':&nbsp;</div></li><li><div>              <span class="comment">//Cleans up output a bit for a better looking, HTML-safe output</span>&nbsp;</div></li><li><div>              echo htmlentities(&nbsp;</div></li><li><div>                  preg_replace('/[\r\n]+/', '', $str), &nbsp;</div></li><li><div>                  ENT_QUOTES, &nbsp;</div></li><li><div>                  'UTF-8'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>              . &quot;&lt;br&gt;\n&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'echo':&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              <span class="comment">//Normalize line breaks</span>&nbsp;</div></li><li><div>              $str = preg_replace('/\r\n?/ms', &quot;\n&quot;, $str);&nbsp;</div></li><li><div>              echo gmdate('Y-m-d H:i:s') . &quot;\t&quot; . str_replace(&nbsp;</div></li><li><div>                  &quot;\n&quot;, &nbsp;</div></li><li><div>                  &quot;\n                   \t                  &quot;, &nbsp;</div></li><li><div>                  trim($str)&nbsp;</div></li><li><div> ) . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Sets message type to HTML or plain.</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $isHtml True for HTML mode.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function isHTML($isHtml = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($isHtml) {&nbsp;</div></li><li><div>          $this-&gt;ContentType = 'text/html';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;ContentType = 'text/plain';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send messages using SMTP.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function isSMTP()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Mailer = 'smtp';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send messages using PHP's mail() function.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function isMail()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Mailer = 'mail';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send messages using $Sendmail.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function isSendmail()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $ini_sendmail_path = ini_get('sendmail_path');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!stristr($ini_sendmail_path, 'sendmail')) {&nbsp;</div></li><li><div>          $this-&gt;Sendmail = '/usr/sbin/sendmail';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;Sendmail = $ini_sendmail_path;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;Mailer = 'sendmail';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send messages using qmail.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function isQmail()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $ini_sendmail_path = ini_get('sendmail_path');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!stristr($ini_sendmail_path, 'qmail')) {&nbsp;</div></li><li><div>          $this-&gt;Sendmail = '/var/qmail/bin/qmail-inject';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;Sendmail = $ini_sendmail_path;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;Mailer = 'qmail';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a &quot;To&quot; address.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to send to</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean true on success, false if address already used or invalid in some way</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addAddress($address, $name = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;addOrEnqueueAnAddress('to', $address, $name);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a &quot;CC&quot; address.</span>&nbsp;</div></li><li><div><span class="comment">   * @note: This function works with the SMTP mailer on win32, not with the &quot;mail&quot; mailer.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to send to</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean true on success, false if address already used or invalid in some way</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addCC($address, $name = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;addOrEnqueueAnAddress('cc', $address, $name);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a &quot;BCC&quot; address.</span>&nbsp;</div></li><li><div><span class="comment">   * @note: This function works with the SMTP mailer on win32, not with the &quot;mail&quot; mailer.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to send to</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean true on success, false if address already used or invalid in some way</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addBCC($address, $name = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;addOrEnqueueAnAddress('bcc', $address, $name);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a &quot;Reply-To&quot; address.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to reply to</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean true on success, false if address already used or invalid in some way</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addReplyTo($address, $name = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;addOrEnqueueAnAddress('Reply-To', $address, $name);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add an address to one of the recipient arrays or to the ReplyTo array. Because PHPMailer</span>&nbsp;</div></li><li><div><span class="comment">   * can't validate addresses with an IDN without knowing the PHPMailer::$CharSet (that can still</span>&nbsp;</div></li><li><div><span class="comment">   * be modified after calling this function), addition of such addresses is delayed until send().</span>&nbsp;</div></li><li><div><span class="comment">   * Addresses that have been added already return false, but do not throw exceptions.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $kind One of 'to', 'cc', 'bcc', or 'ReplyTo'</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to send, resp. to reply to</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean true on success, false if address already used or invalid in some way</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function addOrEnqueueAnAddress($kind, $address, $name)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $address = trim($address);&nbsp;</div></li><li><div>      $name = trim(preg_replace('/[\r\n]+/', '', $name)); <span class="comment"><span class="comment">//Strip breaks and trim</span></span>&nbsp;</div></li><li><div>      if (($pos = strrpos($address, '@')) === false) {&nbsp;</div></li><li><div>          <span class="comment">// At-sign is misssing.</span>&nbsp;</div></li><li><div>          $error_message = $this-&gt;lang('invalid_address') . &quot; (addAnAddress $kind): $address&quot;;&nbsp;</div></li><li><div>          $this-&gt;setError($error_message);&nbsp;</div></li><li><div>          $this-&gt;edebug($error_message);&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw new phpmailerException($error_message);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $params = array($kind, $address, $name);&nbsp;</div></li><li><div>      <span class="comment">// Enqueue addresses with IDN until we know the PHPMailer::$CharSet.</span>&nbsp;</div></li><li><div>      if ($this-&gt;has8bitChars(substr($address, ++$pos)) and $this-&gt;idnSupported()) {&nbsp;</div></li><li><div>          if ($kind != 'Reply-To') {&nbsp;</div></li><li><div>              if (!array_key_exists($address, $this-&gt;RecipientsQueue)) {&nbsp;</div></li><li><div>                  $this-&gt;RecipientsQueue[$address] = $params;&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if (!array_key_exists($address, $this-&gt;ReplyToQueue)) {&nbsp;</div></li><li><div>                  $this-&gt;ReplyToQueue[$address] = $params;&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Immediately add standard addresses without IDN.</span>&nbsp;</div></li><li><div>      return call_user_func_array(array($this, 'addAnAddress'), $params);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add an address to one of the recipient arrays or to the ReplyTo array.</span>&nbsp;</div></li><li><div><span class="comment">   * Addresses that have been added already return false, but do not throw exceptions.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $kind One of 'to', 'cc', 'bcc', or 'ReplyTo'</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to send, resp. to reply to</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean true on success, false if address already used or invalid in some way</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function addAnAddress($kind, $address, $name = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!in_array($kind, array('to', 'cc', 'bcc', 'Reply-To'))) {&nbsp;</div></li><li><div>          $error_message = $this-&gt;lang('Invalid recipient kind: ') . $kind;&nbsp;</div></li><li><div>          $this-&gt;setError($error_message);&nbsp;</div></li><li><div>          $this-&gt;edebug($error_message);&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw new phpmailerException($error_message);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;validateAddress($address)) {&nbsp;</div></li><li><div>          $error_message = $this-&gt;lang('invalid_address') . &quot; (addAnAddress $kind): $address&quot;;&nbsp;</div></li><li><div>          $this-&gt;setError($error_message);&nbsp;</div></li><li><div>          $this-&gt;edebug($error_message);&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw new phpmailerException($error_message);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($kind != 'Reply-To') {&nbsp;</div></li><li><div>          if (!array_key_exists(strtolower($address), $this-&gt;all_recipients)) {&nbsp;</div></li><li><div>              array_push($this-&gt;$kind, array($address, $name));&nbsp;</div></li><li><div>              $this-&gt;all_recipients[strtolower($address)] = true;&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (!array_key_exists(strtolower($address), $this-&gt;ReplyTo)) {&nbsp;</div></li><li><div>              $this-&gt;ReplyTo[strtolower($address)] = array($address, $name);&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Parse and validate a string containing one or more RFC822-style comma-separated email addresses</span>&nbsp;</div></li><li><div><span class="comment">   * of the form &quot;display name &lt;address&gt;&quot; into an array of name/address pairs.</span>&nbsp;</div></li><li><div><span class="comment">   * Uses the imap_rfc822_parse_adrlist function if the IMAP extension is available.</span>&nbsp;</div></li><li><div><span class="comment">   * Note that quotes in the name part are removed.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $addrstr The address list string</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $useimap Whether to use the IMAP extension to parse the list</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://www.andrew.cmu.edu/user/agreen1/testing/mrbs/web/Mail/RFC822.php A more careful implementation</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function parseAddresses($addrstr, $useimap = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $addresses = array();&nbsp;</div></li><li><div>      if ($useimap and function_exists('imap_rfc822_parse_adrlist')) {&nbsp;</div></li><li><div>          <span class="comment">//Use this built-in parser if it's available</span>&nbsp;</div></li><li><div>          $list = imap_rfc822_parse_adrlist($addrstr, '');&nbsp;</div></li><li><div>          foreach ($list as $address) {&nbsp;</div></li><li><div>              if ($address-&gt;host != '.SYNTAX-ERROR.') {&nbsp;</div></li><li><div>                  if ($this-&gt;validateAddress($address-&gt;mailbox . '@' . $address-&gt;host)) {&nbsp;</div></li><li><div>                      $addresses[] = array(&nbsp;</div></li><li><div>                          'name' =&gt; (property_exists($address, 'personal') ? $address-&gt;personal : ''), &nbsp;</div></li><li><div>                          'address' =&gt; $address-&gt;mailbox . '@' . $address-&gt;host&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">//Use this simpler parser</span>&nbsp;</div></li><li><div>          $list = explode(', ', $addrstr);&nbsp;</div></li><li><div>          foreach ($list as $address) {&nbsp;</div></li><li><div>              $address = trim($address);&nbsp;</div></li><li><div>              <span class="comment">//Is there a separate name part?</span>&nbsp;</div></li><li><div>              if (strpos($address, '&lt;') === false) {&nbsp;</div></li><li><div>                  <span class="comment">//No separate name, just use the whole thing</span>&nbsp;</div></li><li><div>                  if ($this-&gt;validateAddress($address)) {&nbsp;</div></li><li><div>                      $addresses[] = array(&nbsp;</div></li><li><div>                          'name' =&gt; '', &nbsp;</div></li><li><div>                          'address' =&gt; $address&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  list($name, $email) = explode('&lt;', $address);&nbsp;</div></li><li><div>                  $email = trim(str_replace('&gt;', '', $email));&nbsp;</div></li><li><div>                  if ($this-&gt;validateAddress($email)) {&nbsp;</div></li><li><div>                      $addresses[] = array(&nbsp;</div></li><li><div>                          'name' =&gt; trim(str_replace(array('&quot;', &quot;'&quot;), '', $name)), &nbsp;</div></li><li><div>                          'address' =&gt; $email&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $addresses;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set the From and FromName properties.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $auto Whether to also set the Sender address, defaults to true</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function setFrom($address, $name = '', $auto = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $address = trim($address);&nbsp;</div></li><li><div>      $name = trim(preg_replace('/[\r\n]+/', '', $name)); <span class="comment"><span class="comment">//Strip breaks and trim</span></span>&nbsp;</div></li><li><div>      <span class="comment">// Don't validate now addresses with IDN. Will be done in send().</span>&nbsp;</div></li><li><div>      if (($pos = strrpos($address, '@')) === false or&nbsp;</div></li><li><div>          (!$this-&gt;has8bitChars(substr($address, ++$pos)) or !$this-&gt;idnSupported()) and&nbsp;</div></li><li><div>          !$this-&gt;validateAddress($address)) {&nbsp;</div></li><li><div>          $error_message = $this-&gt;lang('invalid_address') . &quot; (setFrom) $address&quot;;&nbsp;</div></li><li><div>          $this-&gt;setError($error_message);&nbsp;</div></li><li><div>          $this-&gt;edebug($error_message);&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw new phpmailerException($error_message);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;From = $address;&nbsp;</div></li><li><div>      $this-&gt;FromName = $name;&nbsp;</div></li><li><div>      if ($auto) {&nbsp;</div></li><li><div>          if (empty($this-&gt;Sender)) {&nbsp;</div></li><li><div>              $this-&gt;Sender = $address;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the Message-ID header of the last email.</span>&nbsp;</div></li><li><div><span class="comment">   * Technically this is the value from the last time the headers were created, </span>&nbsp;</div></li><li><div><span class="comment">   * but it's also the message ID of the last sent message except in</span>&nbsp;</div></li><li><div><span class="comment">   * pathological cases.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getLastMessageID()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;lastMessageID;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check that a string looks like an email address.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to check</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|callable $patternselect A selector for the validation pattern to use :</span>&nbsp;</div></li><li><div><span class="comment">   * * `auto` Pick best pattern automatically;</span>&nbsp;</div></li><li><div><span class="comment">   * * `pcre8` Use the squiloople.com pattern, requires PCRE &gt; 8.0, PHP &gt;= 5.3.2, 5.2.14;</span>&nbsp;</div></li><li><div><span class="comment">   * * `pcre` Use old PCRE implementation;</span>&nbsp;</div></li><li><div><span class="comment">   * * `php` Use PHP built-in FILTER_VALIDATE_EMAIL;</span>&nbsp;</div></li><li><div><span class="comment">   * * `html5` Use the pattern given by the HTML5 spec for 'email' type form input elements.</span>&nbsp;</div></li><li><div><span class="comment">   * * `noregex` Don't use a regex: super fast, really dumb.</span>&nbsp;</div></li><li><div><span class="comment">   * Alternatively you may pass in a callable to inject your own validator, for example:</span>&nbsp;</div></li><li><div><span class="comment">   * PHPMailer::validateAddress('user@example.com', function($address) {</span>&nbsp;</div></li><li><div><span class="comment">   *     return (strpos($address, '@') !== false);</span>&nbsp;</div></li><li><div><span class="comment">   * });</span>&nbsp;</div></li><li><div><span class="comment">   * You can also set the PHPMailer::$validator static to a callable, allowing built-in methods to use your validator.</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function validateAddress($address, $patternselect = null)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_null($patternselect)) {&nbsp;</div></li><li><div>          $patternselect = self::$validator;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (is_callable($patternselect)) {&nbsp;</div></li><li><div>          return call_user_func($patternselect, $address);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Reject line breaks in addresses; it's valid RFC5322, but not RFC5321</span>&nbsp;</div></li><li><div>      if (strpos($address, &quot;\n&quot;) !== false or strpos($address, &quot;\r&quot;) !== false) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$patternselect or $patternselect == 'auto') {&nbsp;</div></li><li><div>          <span class="comment">//Check this constant first so it works when extension_loaded() is disabled by safe mode</span>&nbsp;</div></li><li><div>          <span class="comment">//Constant was added in PHP 5.2.4</span>&nbsp;</div></li><li><div>          if (defined('PCRE_VERSION')) {&nbsp;</div></li><li><div>              <span class="comment">//This pattern can get stuck in a recursive loop in PCRE &lt;= 8.0.2</span>&nbsp;</div></li><li><div>              if (version_compare(PCRE_VERSION, '8.0.3') &gt;= 0) {&nbsp;</div></li><li><div>                  $patternselect = 'pcre8';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $patternselect = 'pcre';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif (function_exists('extension_loaded') and extension_loaded('pcre')) {&nbsp;</div></li><li><div>              <span class="comment">//Fall back to older PCRE</span>&nbsp;</div></li><li><div>              $patternselect = 'pcre';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">//Filter_var appeared in PHP 5.2.0 and does not require the PCRE extension</span>&nbsp;</div></li><li><div>              if (version_compare(PHP_VERSION, '5.2.0') &gt;= 0) {&nbsp;</div></li><li><div>                  $patternselect = 'php';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $patternselect = 'noregex';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      switch ($patternselect) {&nbsp;</div></li><li><div>          case 'pcre8':&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Uses the same RFC5322 regex on which FILTER_VALIDATE_EMAIL is based, but allows dotless domains.</span>&nbsp;</div></li><li><div><span class="comment">               * @link http://squiloople.com/2009/12/20/email-address-validation/</span>&nbsp;</div></li><li><div><span class="comment">               * @copyright 2009-2010 Michael Rushton</span>&nbsp;</div></li><li><div><span class="comment">               * Feel free to use and redistribute this code. But please keep this copyright notice.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              return (boolean)preg_match(&nbsp;</div></li><li><div>                  '/^(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?(?1)) {255, })(?!(?&gt;(?1)&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?(?1)) {65, }@)' .&nbsp;</div></li><li><div>                  '((?&gt;(?&gt;(?&gt;((?&gt;(?&gt;(?&gt;\x0D\x0A)?[\t ])+|(?&gt;[\t ]*\x0D\x0A)?[\t ]+)?)(\((?&gt;(?2)' .&nbsp;</div></li><li><div>                  '(?&gt;[\x01-\x08\x0B\x0C\x0E-\'*-\[\]-\x7F]|\\\[\x00-\x7F]|(?3)))*(?2)\)))+(?2))|(?2))?)' .&nbsp;</div></li><li><div>                  '([!#-\'*+\/-9=?^-~-]+|&quot;(?&gt;(?2)(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]|\\\[\x00-\x7F]))*' .&nbsp;</div></li><li><div>                  '(?2)&quot;)(?&gt;(?1)\.(?1)(?4))*(?1)@(?!(?1)[a-z0-9-]{64, })(?1)(?&gt;([a-z0-9](?&gt;[a-z0-9-]*[a-z0-9])?)' .&nbsp;</div></li><li><div>                  '(?&gt;(?1)\.(?!(?1)[a-z0-9-]{64, })(?1)(?5)) {0, 126}|\[(?:(?&gt;IPv6:(?&gt;([a-f0-9]{1, 4})(?&gt;:(?6)) {7}' .&nbsp;</div></li><li><div>                  '|(?!(?:.*[a-f0-9][:\]]) {8, })((?6)(?&gt;:(?6)) {0, 6})?::(?7)?))|(?&gt;(?&gt;IPv6:(?&gt;(?6)(?&gt;:(?6)) {5}:' .&nbsp;</div></li><li><div>                  '|(?!(?:.*[a-f0-9]:) {6, })(?8)?::(?&gt;((?6)(?&gt;:(?6)) {0, 4}):)?))?(25[0-5]|2[0-4][0-9]|1[0-9]{2}' .&nbsp;</div></li><li><div>                  '|[1-9]?[0-9])(?&gt;\.(?9)) {3}))\])(?1)$/isD', &nbsp;</div></li><li><div>                  $address&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          case 'pcre':&nbsp;</div></li><li><div>              <span class="comment">//An older regex that doesn't need a recent PCRE</span>&nbsp;</div></li><li><div>              return (boolean)preg_match(&nbsp;</div></li><li><div>                  '/^(?!(?&gt;&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?) {255, })(?!(?&gt;&quot;?(?&gt;\\\[ -~]|[^&quot;])&quot;?) {65, }@)(?&gt;' .&nbsp;</div></li><li><div>                  '[!#-\'*+\/-9=?^-~-]+|&quot;(?&gt;(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]|\\\[\x00-\xFF]))*&quot;)' .&nbsp;</div></li><li><div>                  '(?&gt;\.(?&gt;[!#-\'*+\/-9=?^-~-]+|&quot;(?&gt;(?&gt;[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]|\\\[\x00-\xFF]))*&quot;))*' .&nbsp;</div></li><li><div>                  '@(?&gt;(?![a-z0-9-]{64, })(?&gt;[a-z0-9](?&gt;[a-z0-9-]*[a-z0-9])?)(?&gt;\.(?![a-z0-9-]{64, })' .&nbsp;</div></li><li><div>                  '(?&gt;[a-z0-9](?&gt;[a-z0-9-]*[a-z0-9])?)) {0, 126}|\[(?:(?&gt;IPv6:(?&gt;(?&gt;[a-f0-9]{1, 4})(?&gt;:' .&nbsp;</div></li><li><div>                  '[a-f0-9]{1, 4}) {7}|(?!(?:.*[a-f0-9][:\]]) {8, })(?&gt;[a-f0-9]{1, 4}(?&gt;:[a-f0-9]{1, 4}) {0, 6})?' .&nbsp;</div></li><li><div>                  '::(?&gt;[a-f0-9]{1, 4}(?&gt;:[a-f0-9]{1, 4}) {0, 6})?))|(?&gt;(?&gt;IPv6:(?&gt;[a-f0-9]{1, 4}(?&gt;:' .&nbsp;</div></li><li><div>                  '[a-f0-9]{1, 4}) {5}:|(?!(?:.*[a-f0-9]:) {6, })(?&gt;[a-f0-9]{1, 4}(?&gt;:[a-f0-9]{1, 4}) {0, 4})?' .&nbsp;</div></li><li><div>                  '::(?&gt;(?:[a-f0-9]{1, 4}(?&gt;:[a-f0-9]{1, 4}) {0, 4}):)?))?(?&gt;25[0-5]|2[0-4][0-9]|1[0-9]{2}' .&nbsp;</div></li><li><div>                  '|[1-9]?[0-9])(?&gt;\.(?&gt;25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])) {3}))\])$/isD', &nbsp;</div></li><li><div>                  $address&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          case 'html5':&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * This is the pattern used in the HTML5 spec for validation of 'email' type form input elements.</span>&nbsp;</div></li><li><div><span class="comment">               * @link http://www.whatwg.org/specs/web-apps/current-work/#e-mail-state-(type=email)</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              return (boolean)preg_match(&nbsp;</div></li><li><div>                  '/^[a-zA-Z0-9.!#$%&\'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0, 61}' .&nbsp;</div></li><li><div>                  '[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0, 61}[a-zA-Z0-9])?)*$/sD', &nbsp;</div></li><li><div>                  $address&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          case 'noregex':&nbsp;</div></li><li><div>              <span class="comment">//No PCRE! Do something _very_ approximate!</span>&nbsp;</div></li><li><div>              <span class="comment">//Check the address is 3 chars or longer and contains an @ that's not the first or last char</span>&nbsp;</div></li><li><div>              return (strlen($address) &gt;= 3&nbsp;</div></li><li><div>                  and strpos($address, '@') &gt;= 1&nbsp;</div></li><li><div>                  and strpos($address, '@') != strlen($address) - 1);&nbsp;</div></li><li><div>          case 'php':&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              return (boolean)filter_var($address, FILTER_VALIDATE_EMAIL);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Tells whether IDNs (Internationalized Domain Names) are supported or not. This requires the</span>&nbsp;</div></li><li><div><span class="comment">   * &quot;intl&quot; and &quot;mbstring&quot; PHP extensions.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool &quot;true&quot; if required functions for IDN support are present</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function idnSupported()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// @TODO: Write our own &quot;idn_to_ascii&quot; function for PHP &lt;= 5.2.</span>&nbsp;</div></li><li><div>      return function_exists('idn_to_ascii') and function_exists('mb_convert_encoding');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Converts IDN in given email address to its ASCII form, also known as punycode, if possible.</span>&nbsp;</div></li><li><div><span class="comment">   * Important: Address must be passed in same encoding as currently set in PHPMailer::$CharSet.</span>&nbsp;</div></li><li><div><span class="comment">   * This function silently returns unmodified address if:</span>&nbsp;</div></li><li><div><span class="comment">   * - No conversion is necessary (i.e. domain name is not an IDN, or is already in ASCII form)</span>&nbsp;</div></li><li><div><span class="comment">   * - Conversion to punycode is impossible (e.g. required PHP functions are not available)</span>&nbsp;</div></li><li><div><span class="comment">   *   or fails for any reason (e.g. domain has characters not allowed in an IDN)</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$CharSet</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $address The email address to convert</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The encoded address in ASCII form</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function punyencodeAddress($address)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Verify we have required functions, CharSet, and at-sign.</span>&nbsp;</div></li><li><div>      if ($this-&gt;idnSupported() and&nbsp;</div></li><li><div>          !empty($this-&gt;CharSet) and&nbsp;</div></li><li><div>          ($pos = strrpos($address, '@')) !== false) {&nbsp;</div></li><li><div>          $domain = substr($address, ++$pos);&nbsp;</div></li><li><div>          <span class="comment">// Verify CharSet string is a valid one, and domain properly encoded in this CharSet.</span>&nbsp;</div></li><li><div>          if ($this-&gt;has8bitChars($domain) and @mb_check_encoding($domain, $this-&gt;CharSet)) {&nbsp;</div></li><li><div>              $domain = mb_convert_encoding($domain, 'UTF-8', $this-&gt;CharSet);&nbsp;</div></li><li><div>              if (($punycode = defined('INTL_IDNA_VARIANT_UTS46') ?&nbsp;</div></li><li><div>                  idn_to_ascii($domain, 0, INTL_IDNA_VARIANT_UTS46) :&nbsp;</div></li><li><div>                  idn_to_ascii($domain)) !== false) {&nbsp;</div></li><li><div>                  return substr($address, 0, $pos) . $punycode;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $address;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Create a message and send it.</span>&nbsp;</div></li><li><div><span class="comment">   * Uses the sending method specified by $Mailer.</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean false on error - See the ErrorInfo property for details of the error.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function send()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          if (!$this-&gt;preSend()) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $this-&gt;postSend();&nbsp;</div></li><li><div>      } catch (phpmailerException $exc) {&nbsp;</div></li><li><div>          $this-&gt;mailHeader = '';&nbsp;</div></li><li><div>          $this-&gt;setError($exc-&gt;getMessage());&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw $exc;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Prepare a message for sending.</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function preSend()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          $this-&gt;error_count = 0; <span class="comment">// Reset errors</span>&nbsp;</div></li><li><div>          $this-&gt;mailHeader = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Dequeue recipient and Reply-To addresses with IDN</span>&nbsp;</div></li><li><div>          foreach (array_merge($this-&gt;RecipientsQueue, $this-&gt;ReplyToQueue) as $params) {&nbsp;</div></li><li><div>              $params[1] = $this-&gt;punyencodeAddress($params[1]);&nbsp;</div></li><li><div>              call_user_func_array(array($this, 'addAnAddress'), $params);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ((count($this-&gt;to) + count($this-&gt;cc) + count($this-&gt;bcc)) &lt; 1) {&nbsp;</div></li><li><div>              throw new phpmailerException($this-&gt;lang('provide_address'), self::STOP_CRITICAL);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Validate From, Sender, and ConfirmReadingTo addresses</span>&nbsp;</div></li><li><div>          foreach (array('From', 'Sender', 'ConfirmReadingTo') as $address_kind) {&nbsp;</div></li><li><div>              $this-&gt;$address_kind = trim($this-&gt;$address_kind);&nbsp;</div></li><li><div>              if (empty($this-&gt;$address_kind)) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;$address_kind = $this-&gt;punyencodeAddress($this-&gt;$address_kind);&nbsp;</div></li><li><div>              if (!$this-&gt;validateAddress($this-&gt;$address_kind)) {&nbsp;</div></li><li><div>                  $error_message = $this-&gt;lang('invalid_address') . ' (punyEncode) ' . $this-&gt;$address_kind;&nbsp;</div></li><li><div>                  $this-&gt;setError($error_message);&nbsp;</div></li><li><div>                  $this-&gt;edebug($error_message);&nbsp;</div></li><li><div>                  if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>                      throw new phpmailerException($error_message);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set whether the message is multipart/alternative</span>&nbsp;</div></li><li><div>          if ($this-&gt;alternativeExists()) {&nbsp;</div></li><li><div>              $this-&gt;ContentType = 'multipart/alternative';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;setMessageType();&nbsp;</div></li><li><div>          <span class="comment">// Refuse to send an empty message unless we are specifically allowing it</span>&nbsp;</div></li><li><div>          if (!$this-&gt;AllowEmpty and empty($this-&gt;Body)) {&nbsp;</div></li><li><div>              throw new phpmailerException($this-&gt;lang('empty_message'), self::STOP_CRITICAL);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Create body before headers in case body makes changes to headers (e.g. altering transfer encoding)</span>&nbsp;</div></li><li><div>          $this-&gt;MIMEHeader = '';&nbsp;</div></li><li><div>          $this-&gt;MIMEBody = $this-&gt;createBody();&nbsp;</div></li><li><div>          <span class="comment">// createBody may have added some headers, so retain them</span>&nbsp;</div></li><li><div>          $tempheaders = $this-&gt;MIMEHeader;&nbsp;</div></li><li><div>          $this-&gt;MIMEHeader = $this-&gt;createHeader();&nbsp;</div></li><li><div>          $this-&gt;MIMEHeader .= $tempheaders;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// To capture the complete message when using mail(), create</span>&nbsp;</div></li><li><div>          <span class="comment">// an extra header list which createHeader() doesn't fold in</span>&nbsp;</div></li><li><div>          if ($this-&gt;Mailer == 'mail') {&nbsp;</div></li><li><div>              if (count($this-&gt;to) &gt; 0) {&nbsp;</div></li><li><div>                  $this-&gt;mailHeader .= $this-&gt;addrAppend('To', $this-&gt;to);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;mailHeader .= $this-&gt;headerLine('To', 'undisclosed-recipients:;');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;mailHeader .= $this-&gt;headerLine(&nbsp;</div></li><li><div>                  'Subject', &nbsp;</div></li><li><div>                  $this-&gt;encodeHeader($this-&gt;secureHeader(trim($this-&gt;Subject)))&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Sign with DKIM if enabled</span>&nbsp;</div></li><li><div>          if (!empty($this-&gt;DKIM_domain)&nbsp;</div></li><li><div>              && !empty($this-&gt;DKIM_selector)&nbsp;</div></li><li><div>              && (!empty($this-&gt;DKIM_private_string)&nbsp;</div></li><li><div>                 || (!empty($this-&gt;DKIM_private) && file_exists($this-&gt;DKIM_private))&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>              $header_dkim = $this-&gt;DKIM_Add(&nbsp;</div></li><li><div>                  $this-&gt;MIMEHeader . $this-&gt;mailHeader, &nbsp;</div></li><li><div>                  $this-&gt;encodeHeader($this-&gt;secureHeader($this-&gt;Subject)), &nbsp;</div></li><li><div>                  $this-&gt;MIMEBody&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              $this-&gt;MIMEHeader = rtrim($this-&gt;MIMEHeader, &quot;\r\n &quot;) . self::CRLF .&nbsp;</div></li><li><div>                  str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $header_dkim) . self::CRLF;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } catch (phpmailerException $exc) {&nbsp;</div></li><li><div>          $this-&gt;setError($exc-&gt;getMessage());&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw $exc;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Actually send a message.</span>&nbsp;</div></li><li><div><span class="comment">   * Send the email via the selected mechanism</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function postSend()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          <span class="comment">// Choose the mailer and send through it</span>&nbsp;</div></li><li><div>          switch ($this-&gt;Mailer) {&nbsp;</div></li><li><div>              case 'sendmail':&nbsp;</div></li><li><div>              case 'qmail':&nbsp;</div></li><li><div>                  return $this-&gt;sendmailSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);&nbsp;</div></li><li><div>              case 'smtp':&nbsp;</div></li><li><div>                  return $this-&gt;smtpSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);&nbsp;</div></li><li><div>              case 'mail':&nbsp;</div></li><li><div>                  return $this-&gt;mailSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);&nbsp;</div></li><li><div>              default:&nbsp;</div></li><li><div>                  $sendMethod = $this-&gt;Mailer.'Send';&nbsp;</div></li><li><div>                  if (method_exists($this, $sendMethod)) {&nbsp;</div></li><li><div>                      return $this-&gt;$sendMethod($this-&gt;MIMEHeader, $this-&gt;MIMEBody);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return $this-&gt;mailSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } catch (phpmailerException $exc) {&nbsp;</div></li><li><div>          $this-&gt;setError($exc-&gt;getMessage());&nbsp;</div></li><li><div>          $this-&gt;edebug($exc-&gt;getMessage());&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw $exc;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send mail using the $Sendmail program.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $header The message headers</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $body The message body</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::$Sendmail</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function sendmailSend($header, $body)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// CVE-2016-10033, CVE-2016-10045: Don't pass -f if characters will be escaped.</span></span>&nbsp;</div></li><li><div>      if (!empty($this-&gt;Sender) and self::isShellSafe($this-&gt;Sender)) {&nbsp;</div></li><li><div>          if ($this-&gt;Mailer == 'qmail') {&nbsp;</div></li><li><div>              $sendmailFmt = '%s -f%s';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $sendmailFmt = '%s -oi -f%s -t';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ($this-&gt;Mailer == 'qmail') {&nbsp;</div></li><li><div>              $sendmailFmt = '%s';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $sendmailFmt = '%s -oi -t';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// TODO: If possible, this should be changed to escapeshellarg.  Needs thorough testing.</span>&nbsp;</div></li><li><div>      $sendmail = sprintf($sendmailFmt, escapeshellcmd($this-&gt;Sendmail), $this-&gt;Sender);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;SingleTo) {&nbsp;</div></li><li><div>          foreach ($this-&gt;SingleToArray as $toAddr) {&nbsp;</div></li><li><div>              if (!@$mail = popen($sendmail, 'w')) {&nbsp;</div></li><li><div>                  throw new phpmailerException($this-&gt;lang('execute') . $this-&gt;Sendmail, self::STOP_CRITICAL);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              fputs($mail, 'To: ' . $toAddr . &quot;\n&quot;);&nbsp;</div></li><li><div>              fputs($mail, $header);&nbsp;</div></li><li><div>              fputs($mail, $body);&nbsp;</div></li><li><div>              $result = pclose($mail);&nbsp;</div></li><li><div>              $this-&gt;doCallback(&nbsp;</div></li><li><div>                  ($result == 0), &nbsp;</div></li><li><div>                  array($toAddr), &nbsp;</div></li><li><div>                  $this-&gt;cc, &nbsp;</div></li><li><div>                  $this-&gt;bcc, &nbsp;</div></li><li><div>                  $this-&gt;Subject, &nbsp;</div></li><li><div>                  $body, &nbsp;</div></li><li><div>                  $this-&gt;From&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              if ($result != 0) {&nbsp;</div></li><li><div>                  throw new phpmailerException($this-&gt;lang('execute') . $this-&gt;Sendmail, self::STOP_CRITICAL);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (!@$mail = popen($sendmail, 'w')) {&nbsp;</div></li><li><div>              throw new phpmailerException($this-&gt;lang('execute') . $this-&gt;Sendmail, self::STOP_CRITICAL);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          fputs($mail, $header);&nbsp;</div></li><li><div>          fputs($mail, $body);&nbsp;</div></li><li><div>          $result = pclose($mail);&nbsp;</div></li><li><div>          $this-&gt;doCallback(&nbsp;</div></li><li><div>              ($result == 0), &nbsp;</div></li><li><div>              $this-&gt;to, &nbsp;</div></li><li><div>              $this-&gt;cc, &nbsp;</div></li><li><div>              $this-&gt;bcc, &nbsp;</div></li><li><div>              $this-&gt;Subject, &nbsp;</div></li><li><div>              $body, &nbsp;</div></li><li><div>              $this-&gt;From&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          if ($result != 0) {&nbsp;</div></li><li><div>              throw new phpmailerException($this-&gt;lang('execute') . $this-&gt;Sendmail, self::STOP_CRITICAL);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fix CVE-2016-10033 and CVE-2016-10045 by disallowing potentially unsafe shell characters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Note that escapeshellarg and escapeshellcmd are inadequate for our purposes, especially on Windows.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $string The string to be validated</span>&nbsp;</div></li><li><div><span class="comment">   * @see https://github.com/PHPMailer/PHPMailer/issues/924 CVE-2016-10045 bug report</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected static function isShellSafe($string)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Future-proof</span>&nbsp;</div></li><li><div>      if (escapeshellcmd($string) !== $string&nbsp;</div></li><li><div>          or !in_array(escapeshellarg($string), array(&quot;'$string'&quot;, &quot;\&quot;$string\&quot;&quot;))&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $length = strlen($string);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $length; $i++) {&nbsp;</div></li><li><div>          $c = $string[$i];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// All other characters have a special meaning in at least one common shell, including = and +.</span>&nbsp;</div></li><li><div>          <span class="comment">// Full stop (.) has a special meaning in cmd.exe, but its impact should be negligible here.</span>&nbsp;</div></li><li><div>          <span class="comment">// Note that this does permit non-Latin alphanumeric characters based on the current locale.</span>&nbsp;</div></li><li><div>          if (!ctype_alnum($c) && strpos('@_-.', $c) === false) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send mail using the PHP mail() function.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $header The message headers</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $body The message body</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://www.php.net/manual/en/book.mail.php</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function mailSend($header, $body)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $toArr = array();&nbsp;</div></li><li><div>      foreach ($this-&gt;to as $toaddr) {&nbsp;</div></li><li><div>          $toArr[] = $this-&gt;addrFormat($toaddr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $to = implode(', ', $toArr);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $params = null;&nbsp;</div></li><li><div>      <span class="comment">//This sets the SMTP envelope sender which gets turned into a return-path header by the receiver</span>&nbsp;</div></li><li><div>      if (!empty($this-&gt;Sender) and $this-&gt;validateAddress($this-&gt;Sender)) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// CVE-2016-10033, CVE-2016-10045: Don't pass -f if characters will be escaped.</span></span>&nbsp;</div></li><li><div>          if (self::isShellSafe($this-&gt;Sender)) {&nbsp;</div></li><li><div>              $params = sprintf('-f%s', $this-&gt;Sender);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!empty($this-&gt;Sender) and !ini_get('safe_mode') and $this-&gt;validateAddress($this-&gt;Sender)) {&nbsp;</div></li><li><div>          $old_from = ini_get('sendmail_from');&nbsp;</div></li><li><div>          ini_set('sendmail_from', $this-&gt;Sender);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $result = false;&nbsp;</div></li><li><div>      if ($this-&gt;SingleTo and count($toArr) &gt; 1) {&nbsp;</div></li><li><div>          foreach ($toArr as $toAddr) {&nbsp;</div></li><li><div>              $result = $this-&gt;mailPassthru($toAddr, $this-&gt;Subject, $body, $header, $params);&nbsp;</div></li><li><div>              $this-&gt;doCallback($result, array($toAddr), $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body, $this-&gt;From);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $result = $this-&gt;mailPassthru($to, $this-&gt;Subject, $body, $header, $params);&nbsp;</div></li><li><div>          $this-&gt;doCallback($result, $this-&gt;to, $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body, $this-&gt;From);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($old_from)) {&nbsp;</div></li><li><div>          ini_set('sendmail_from', $old_from);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$result) {&nbsp;</div></li><li><div>          throw new phpmailerException($this-&gt;lang('instantiate'), self::STOP_CRITICAL);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get an instance to use for SMTP operations.</span>&nbsp;</div></li><li><div><span class="comment">   * Override this function to load your own SMTP implementation</span>&nbsp;</div></li><li><div><span class="comment">   * @return SMTP</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getSMTPInstance()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!is_object($this-&gt;smtp)) {&nbsp;</div></li><li><div>          require_once( 'class-smtp.php' );&nbsp;</div></li><li><div>          $this-&gt;smtp = new SMTP;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $this-&gt;smtp;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send mail via SMTP.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns false if there is a bad MAIL FROM, RCPT, or DATA input.</span>&nbsp;</div></li><li><div><span class="comment">   * Uses the PHPMailerSMTP class by default.</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::getSMTPInstance() to use a different class.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $header The message headers</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $body The message body</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @uses SMTP</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function smtpSend($header, $body)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $bad_rcpt = array();&nbsp;</div></li><li><div>      if (!$this-&gt;smtpConnect($this-&gt;SMTPOptions)) {&nbsp;</div></li><li><div>          throw new phpmailerException($this-&gt;lang('smtp_connect_failed'), self::STOP_CRITICAL);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!empty($this-&gt;Sender) and $this-&gt;validateAddress($this-&gt;Sender)) {&nbsp;</div></li><li><div>          $smtp_from = $this-&gt;Sender;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $smtp_from = $this-&gt;From;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;smtp-&gt;mail($smtp_from)) {&nbsp;</div></li><li><div>          $this-&gt;setError($this-&gt;lang('from_failed') . $smtp_from . ' : ' . implode(', ', $this-&gt;smtp-&gt;getError()));&nbsp;</div></li><li><div>          throw new phpmailerException($this-&gt;ErrorInfo, self::STOP_CRITICAL);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Attempt to send to all recipients</span>&nbsp;</div></li><li><div>      foreach (array($this-&gt;to, $this-&gt;cc, $this-&gt;bcc) as $togroup) {&nbsp;</div></li><li><div>          foreach ($togroup as $to) {&nbsp;</div></li><li><div>              if (!$this-&gt;smtp-&gt;recipient($to[0])) {&nbsp;</div></li><li><div>                  $error = $this-&gt;smtp-&gt;getError();&nbsp;</div></li><li><div>                  $bad_rcpt[] = array('to' =&gt; $to[0], 'error' =&gt; $error['detail']);&nbsp;</div></li><li><div>                  $isSent = false;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $isSent = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;doCallback($isSent, array($to[0]), array(), array(), $this-&gt;Subject, $body, $this-&gt;From);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only send the DATA command if we have viable recipients</span>&nbsp;</div></li><li><div>      if ((count($this-&gt;all_recipients) &gt; count($bad_rcpt)) and !$this-&gt;smtp-&gt;data($header . $body)) {&nbsp;</div></li><li><div>          throw new phpmailerException($this-&gt;lang('data_not_accepted'), self::STOP_CRITICAL);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;SMTPKeepAlive) {&nbsp;</div></li><li><div>          $this-&gt;smtp-&gt;reset();&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;smtp-&gt;quit();&nbsp;</div></li><li><div>          $this-&gt;smtp-&gt;close();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Create error message for any bad addresses</span>&nbsp;</div></li><li><div>      if (count($bad_rcpt) &gt; 0) {&nbsp;</div></li><li><div>          $errstr = '';&nbsp;</div></li><li><div>          foreach ($bad_rcpt as $bad) {&nbsp;</div></li><li><div>              $errstr .= $bad['to'] . ': ' . $bad['error'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          throw new phpmailerException(&nbsp;</div></li><li><div>              $this-&gt;lang('recipients_failed') . $errstr, &nbsp;</div></li><li><div>              self::STOP_CONTINUE&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Initiate a connection to an SMTP server.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns false if the operation failed.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $options An array of options compatible with stream_context_create()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses SMTP</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function smtpConnect($options = null)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_null($this-&gt;smtp)) {&nbsp;</div></li><li><div>          $this-&gt;smtp = $this-&gt;getSMTPInstance();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//If no options are provided, use whatever is set in the instance</span>&nbsp;</div></li><li><div>      if (is_null($options)) {&nbsp;</div></li><li><div>          $options = $this-&gt;SMTPOptions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Already connected?</span>&nbsp;</div></li><li><div>      if ($this-&gt;smtp-&gt;connected()) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;setTimeout($this-&gt;Timeout);&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;setDebugLevel($this-&gt;SMTPDebug);&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;setDebugOutput($this-&gt;Debugoutput);&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;setVerp($this-&gt;do_verp);&nbsp;</div></li><li><div>      $hosts = explode(';', $this-&gt;Host);&nbsp;</div></li><li><div>      $lastexception = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($hosts as $hostentry) {&nbsp;</div></li><li><div>          $hostinfo = array();&nbsp;</div></li><li><div>          if (!preg_match('/^((ssl|tls):\/\/)*([a-zA-Z0-9\.-]*):?([0-9]*)$/', trim($hostentry), $hostinfo)) {&nbsp;</div></li><li><div>              <span class="comment">// Not a valid host entry</span>&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// $hostinfo[2]: optional ssl or tls prefix</span>&nbsp;</div></li><li><div>          <span class="comment">// $hostinfo[3]: the hostname</span>&nbsp;</div></li><li><div>          <span class="comment">// $hostinfo[4]: optional port number</span>&nbsp;</div></li><li><div>          <span class="comment">// The host string prefix can temporarily override the current setting for SMTPSecure</span>&nbsp;</div></li><li><div>          <span class="comment">// If it's not specified, the default value is used</span>&nbsp;</div></li><li><div>          $prefix = '';&nbsp;</div></li><li><div>          $secure = $this-&gt;SMTPSecure;&nbsp;</div></li><li><div>          $tls = ($this-&gt;SMTPSecure == 'tls');&nbsp;</div></li><li><div>          if ('ssl' == $hostinfo[2] or ('' == $hostinfo[2] and 'ssl' == $this-&gt;SMTPSecure)) {&nbsp;</div></li><li><div>              $prefix = 'ssl:<span class="comment">//';</span>&nbsp;</div></li><li><div>              $tls = false; <span class="comment">// Can't have SSL and TLS at the same time</span>&nbsp;</div></li><li><div>              $secure = 'ssl';&nbsp;</div></li><li><div>          } elseif ($hostinfo[2] == 'tls') {&nbsp;</div></li><li><div>              $tls = true;&nbsp;</div></li><li><div>              <span class="comment">// tls doesn't use a prefix</span>&nbsp;</div></li><li><div>              $secure = 'tls';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Do we need the OpenSSL extension?</span>&nbsp;</div></li><li><div>          $sslext = defined('OPENSSL_ALGO_SHA1');&nbsp;</div></li><li><div>          if ('tls' === $secure or 'ssl' === $secure) {&nbsp;</div></li><li><div>              <span class="comment">//Check for an OpenSSL constant rather than using extension_loaded, which is sometimes disabled</span>&nbsp;</div></li><li><div>              if (!$sslext) {&nbsp;</div></li><li><div>                  throw new phpmailerException($this-&gt;lang('extension_missing').'openssl', self::STOP_CRITICAL);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $host = $hostinfo[3];&nbsp;</div></li><li><div>          $port = $this-&gt;Port;&nbsp;</div></li><li><div>          $tport = (integer)$hostinfo[4];&nbsp;</div></li><li><div>          if ($tport &gt; 0 and $tport &lt; 65536) {&nbsp;</div></li><li><div>              $port = $tport;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;smtp-&gt;connect($prefix . $host, $port, $this-&gt;Timeout, $options)) {&nbsp;</div></li><li><div>              try {&nbsp;</div></li><li><div>                  if ($this-&gt;Helo) {&nbsp;</div></li><li><div>                      $hello = $this-&gt;Helo;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $hello = $this-&gt;serverHostname();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;smtp-&gt;hello($hello);&nbsp;</div></li><li><div>                  <span class="comment">//Automatically enable TLS encryption if:</span>&nbsp;</div></li><li><div>                  <span class="comment">// * it's not disabled</span>&nbsp;</div></li><li><div>                  <span class="comment">// * we have openssl extension</span>&nbsp;</div></li><li><div>                  <span class="comment">// * we are not already using SSL</span>&nbsp;</div></li><li><div>                  <span class="comment">// * the server offers STARTTLS</span>&nbsp;</div></li><li><div>                  if ($this-&gt;SMTPAutoTLS and $sslext and $secure != 'ssl' and $this-&gt;smtp-&gt;getServerExt('STARTTLS')) {&nbsp;</div></li><li><div>                      $tls = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($tls) {&nbsp;</div></li><li><div>                      if (!$this-&gt;smtp-&gt;startTLS()) {&nbsp;</div></li><li><div>                          throw new phpmailerException($this-&gt;lang('connect_host'));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// We must resend EHLO after TLS negotiation</span>&nbsp;</div></li><li><div>                      $this-&gt;smtp-&gt;hello($hello);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;SMTPAuth) {&nbsp;</div></li><li><div>                      if (!$this-&gt;smtp-&gt;authenticate(&nbsp;</div></li><li><div>                          $this-&gt;Username, &nbsp;</div></li><li><div>                          $this-&gt;Password, &nbsp;</div></li><li><div>                          $this-&gt;AuthType, &nbsp;</div></li><li><div>                          $this-&gt;Realm, &nbsp;</div></li><li><div>                          $this-&gt;Workstation&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                          throw new phpmailerException($this-&gt;lang('authenticate'));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              } catch (phpmailerException $exc) {&nbsp;</div></li><li><div>                  $lastexception = $exc;&nbsp;</div></li><li><div>                  $this-&gt;edebug($exc-&gt;getMessage());&nbsp;</div></li><li><div>                  <span class="comment">// We must have connected, but then failed TLS or Auth, so close connection nicely</span>&nbsp;</div></li><li><div>                  $this-&gt;smtp-&gt;quit();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// If we get here, all connection attempts have failed, so close connection hard</span>&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;close();&nbsp;</div></li><li><div>      <span class="comment">// As we've caught all exceptions, just report whatever the last one was</span>&nbsp;</div></li><li><div>      if ($this-&gt;exceptions and !is_null($lastexception)) {&nbsp;</div></li><li><div>          throw $lastexception;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Close the active SMTP session if one exists.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function smtpClose()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_a($this-&gt;smtp, 'SMTP')) {&nbsp;</div></li><li><div>          if ($this-&gt;smtp-&gt;connected()) {&nbsp;</div></li><li><div>              $this-&gt;smtp-&gt;quit();&nbsp;</div></li><li><div>              $this-&gt;smtp-&gt;close();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set the language for error messages.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns false if it cannot load the language file.</span>&nbsp;</div></li><li><div><span class="comment">   * The default language is English.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $langcode ISO 639-1 2-character language code (e.g. French is &quot;fr&quot;)</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $lang_path Path to the language file directory, with trailing separator (slash)</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function setLanguage($langcode = 'en', $lang_path = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Backwards compatibility for renamed language codes</span>&nbsp;</div></li><li><div>      $renamed_langcodes = array(&nbsp;</div></li><li><div>          'br' =&gt; 'pt_br', &nbsp;</div></li><li><div>          'cz' =&gt; 'cs', &nbsp;</div></li><li><div>          'dk' =&gt; 'da', &nbsp;</div></li><li><div>          'no' =&gt; 'nb', &nbsp;</div></li><li><div>          'se' =&gt; 'sv', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($renamed_langcodes[$langcode])) {&nbsp;</div></li><li><div>          $langcode = $renamed_langcodes[$langcode];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Define full set of translatable strings in English</span>&nbsp;</div></li><li><div>      $PHPMAILER_LANG = array(&nbsp;</div></li><li><div>          'authenticate' =&gt; 'SMTP Error: Could not authenticate.', &nbsp;</div></li><li><div>          'connect_host' =&gt; 'SMTP Error: Could not connect to SMTP host.', &nbsp;</div></li><li><div>          'data_not_accepted' =&gt; 'SMTP Error: data not accepted.', &nbsp;</div></li><li><div>          'empty_message' =&gt; 'Message body empty', &nbsp;</div></li><li><div>          'encoding' =&gt; 'Unknown encoding: ', &nbsp;</div></li><li><div>          'execute' =&gt; 'Could not execute: ', &nbsp;</div></li><li><div>          'file_access' =&gt; 'Could not access file: ', &nbsp;</div></li><li><div>          'file_open' =&gt; 'File Error: Could not open file: ', &nbsp;</div></li><li><div>          'from_failed' =&gt; 'The following From address failed: ', &nbsp;</div></li><li><div>          'instantiate' =&gt; 'Could not instantiate mail function.', &nbsp;</div></li><li><div>          'invalid_address' =&gt; 'Invalid address: ', &nbsp;</div></li><li><div>          'mailer_not_supported' =&gt; ' mailer is not supported.', &nbsp;</div></li><li><div>          'provide_address' =&gt; 'You must provide at least one recipient email address.', &nbsp;</div></li><li><div>          'recipients_failed' =&gt; 'SMTP Error: The following recipients failed: ', &nbsp;</div></li><li><div>          'signing' =&gt; 'Signing Error: ', &nbsp;</div></li><li><div>          'smtp_connect_failed' =&gt; 'SMTP connect() failed.', &nbsp;</div></li><li><div>          'smtp_error' =&gt; 'SMTP server error: ', &nbsp;</div></li><li><div>          'variable_set' =&gt; 'Cannot set or reset variable: ', &nbsp;</div></li><li><div>          'extension_missing' =&gt; 'Extension missing: '&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      if (empty($lang_path)) {&nbsp;</div></li><li><div>          <span class="comment">// Calculate an absolute path so it can work if CWD is not here</span>&nbsp;</div></li><li><div>          $lang_path = dirname(__FILE__). DIRECTORY_SEPARATOR . 'language'. DIRECTORY_SEPARATOR;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Validate $langcode</span>&nbsp;</div></li><li><div>      if (!preg_match('/^[a-z]{2}(?:_[a-zA-Z]{2})?$/', $langcode)) {&nbsp;</div></li><li><div>          $langcode = 'en';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $foundlang = true;&nbsp;</div></li><li><div>      $lang_file = $lang_path . 'phpmailer.lang-' . $langcode . '.php';&nbsp;</div></li><li><div>      <span class="comment">// There is no English translation file</span>&nbsp;</div></li><li><div>      if ($langcode != 'en') {&nbsp;</div></li><li><div>          <span class="comment">// Make sure language file path is readable</span>&nbsp;</div></li><li><div>          if (!is_readable($lang_file)) {&nbsp;</div></li><li><div>              $foundlang = false;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// Overwrite language-specific strings.</span>&nbsp;</div></li><li><div>              <span class="comment">// This way we'll never have missing translation keys.</span>&nbsp;</div></li><li><div>              $foundlang = include $lang_file;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;language = $PHPMAILER_LANG;&nbsp;</div></li><li><div>      return (boolean)$foundlang; <span class="comment">// Returns false if language not found</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the array of strings for the current language.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getTranslations()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;language;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Create recipient headers.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $addr An array of recipient, </span>&nbsp;</div></li><li><div><span class="comment">   * where each recipient is a 2-element indexed array with element 0 containing an address</span>&nbsp;</div></li><li><div><span class="comment">   * and element 1 containing a name, like:</span>&nbsp;</div></li><li><div><span class="comment">   * array(array('joe@example.com', 'Joe User'), array('zoe@example.com', 'Zoe User'))</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addrAppend($type, $addr)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $addresses = array();&nbsp;</div></li><li><div>      foreach ($addr as $address) {&nbsp;</div></li><li><div>          $addresses[] = $this-&gt;addrFormat($address);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $type . ': ' . implode(', ', $addresses) . $this-&gt;LE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Format an address for use in a message header.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $addr A 2-element indexed array, element 0 containing an address, element 1 containing a name</span>&nbsp;</div></li><li><div><span class="comment">   *      like array('joe@example.com', 'Joe User')</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addrFormat($addr)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (empty($addr[1])) { <span class="comment">// No name provided</span>&nbsp;</div></li><li><div>          return $this-&gt;secureHeader($addr[0]);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return $this-&gt;encodeHeader($this-&gt;secureHeader($addr[1]), 'phrase') . ' &lt;' . $this-&gt;secureHeader(&nbsp;</div></li><li><div>              $addr[0]&nbsp;</div></li><li><div> ) . '&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Word-wrap message.</span>&nbsp;</div></li><li><div><span class="comment">   * For use with mailers that do not automatically perform wrapping</span>&nbsp;</div></li><li><div><span class="comment">   * and for quoted-printable encoded messages.</span>&nbsp;</div></li><li><div><span class="comment">   * Original written by philippe.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $message The message to wrap</span>&nbsp;</div></li><li><div><span class="comment">   * @param integer $length The line length to wrap to</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $qp_mode Whether to run in Quoted-Printable mode</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function wrapText($message, $length, $qp_mode = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($qp_mode) {&nbsp;</div></li><li><div>          $soft_break = sprintf(' =%s', $this-&gt;LE);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $soft_break = $this-&gt;LE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// If utf-8 encoding is used, we will need to make sure we don't</span>&nbsp;</div></li><li><div>      <span class="comment">// split multibyte characters when we wrap</span>&nbsp;</div></li><li><div>      $is_utf8 = (strtolower($this-&gt;CharSet) == 'utf-8');&nbsp;</div></li><li><div>      $lelen = strlen($this-&gt;LE);&nbsp;</div></li><li><div>      $crlflen = strlen(self::CRLF);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $message = $this-&gt;fixEOL($message);&nbsp;</div></li><li><div>      <span class="comment">//Remove a trailing line break</span>&nbsp;</div></li><li><div>      if (substr($message, -$lelen) == $this-&gt;LE) {&nbsp;</div></li><li><div>          $message = substr($message, 0, -$lelen);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Split message into lines</span>&nbsp;</div></li><li><div>      $lines = explode($this-&gt;LE, $message);&nbsp;</div></li><li><div>      <span class="comment">//Message will be rebuilt in here</span>&nbsp;</div></li><li><div>      $message = '';&nbsp;</div></li><li><div>      foreach ($lines as $line) {&nbsp;</div></li><li><div>          $words = explode(' ', $line);&nbsp;</div></li><li><div>          $buf = '';&nbsp;</div></li><li><div>          $firstword = true;&nbsp;</div></li><li><div>          foreach ($words as $word) {&nbsp;</div></li><li><div>              if ($qp_mode and (strlen($word) &gt; $length)) {&nbsp;</div></li><li><div>                  $space_left = $length - strlen($buf) - $crlflen;&nbsp;</div></li><li><div>                  if (!$firstword) {&nbsp;</div></li><li><div>                      if ($space_left &gt; 20) {&nbsp;</div></li><li><div>                          $len = $space_left;&nbsp;</div></li><li><div>                          if ($is_utf8) {&nbsp;</div></li><li><div>                              $len = $this-&gt;utf8CharBoundary($word, $len);&nbsp;</div></li><li><div>                          } elseif (substr($word, $len - 1, 1) == '=') {&nbsp;</div></li><li><div>                              $len--;&nbsp;</div></li><li><div>                          } elseif (substr($word, $len - 2, 1) == '=') {&nbsp;</div></li><li><div>                              $len -= 2;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $part = substr($word, 0, $len);&nbsp;</div></li><li><div>                          $word = substr($word, $len);&nbsp;</div></li><li><div>                          $buf .= ' ' . $part;&nbsp;</div></li><li><div>                          $message .= $buf . sprintf('=%s', self::CRLF);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $message .= $buf . $soft_break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $buf = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  while (strlen($word) &gt; 0) {&nbsp;</div></li><li><div>                      if ($length &lt;= 0) {&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $len = $length;&nbsp;</div></li><li><div>                      if ($is_utf8) {&nbsp;</div></li><li><div>                          $len = $this-&gt;utf8CharBoundary($word, $len);&nbsp;</div></li><li><div>                      } elseif (substr($word, $len - 1, 1) == '=') {&nbsp;</div></li><li><div>                          $len--;&nbsp;</div></li><li><div>                      } elseif (substr($word, $len - 2, 1) == '=') {&nbsp;</div></li><li><div>                          $len -= 2;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $part = substr($word, 0, $len);&nbsp;</div></li><li><div>                      $word = substr($word, $len);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (strlen($word) &gt; 0) {&nbsp;</div></li><li><div>                          $message .= $part . sprintf('=%s', self::CRLF);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $buf = $part;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $buf_o = $buf;&nbsp;</div></li><li><div>                  if (!$firstword) {&nbsp;</div></li><li><div>                      $buf .= ' ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $buf .= $word;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (strlen($buf) &gt; $length and $buf_o != '') {&nbsp;</div></li><li><div>                      $message .= $buf_o . $soft_break;&nbsp;</div></li><li><div>                      $buf = $word;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $firstword = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $message .= $buf . self::CRLF;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $message;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Find the last character boundary prior to $maxLength in a utf-8</span>&nbsp;</div></li><li><div><span class="comment">   * quoted-printable encoded string.</span>&nbsp;</div></li><li><div><span class="comment">   * Original written by Colin Brown.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encodedText utf-8 QP text</span>&nbsp;</div></li><li><div><span class="comment">   * @param integer $maxLength Find the last character boundary prior to this length</span>&nbsp;</div></li><li><div><span class="comment">   * @return integer</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function utf8CharBoundary($encodedText, $maxLength)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $foundSplitPos = false;&nbsp;</div></li><li><div>      $lookBack = 3;&nbsp;</div></li><li><div>      while (!$foundSplitPos) {&nbsp;</div></li><li><div>          $lastChunk = substr($encodedText, $maxLength - $lookBack, $lookBack);&nbsp;</div></li><li><div>          $encodedCharPos = strpos($lastChunk, '=');&nbsp;</div></li><li><div>          if (false !== $encodedCharPos) {&nbsp;</div></li><li><div>              <span class="comment">// Found start of encoded character byte within $lookBack block.</span>&nbsp;</div></li><li><div>              <span class="comment">// Check the encoded byte value (the 2 chars after the '=')</span>&nbsp;</div></li><li><div>              $hex = substr($encodedText, $maxLength - $lookBack + $encodedCharPos + 1, 2);&nbsp;</div></li><li><div>              $dec = hexdec($hex);&nbsp;</div></li><li><div>              if ($dec &lt; 128) {&nbsp;</div></li><li><div>                  <span class="comment">// Single byte character.</span>&nbsp;</div></li><li><div>                  <span class="comment">// If the encoded char was found at pos 0, it will fit</span>&nbsp;</div></li><li><div>                  <span class="comment">// otherwise reduce maxLength to start of the encoded char</span>&nbsp;</div></li><li><div>                  if ($encodedCharPos &gt; 0) {&nbsp;</div></li><li><div>                      $maxLength = $maxLength - ($lookBack - $encodedCharPos);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $foundSplitPos = true;&nbsp;</div></li><li><div>              } elseif ($dec &gt;= 192) {&nbsp;</div></li><li><div>                  <span class="comment">// First byte of a multi byte character</span>&nbsp;</div></li><li><div>                  <span class="comment">// Reduce maxLength to split at start of character</span>&nbsp;</div></li><li><div>                  $maxLength = $maxLength - ($lookBack - $encodedCharPos);&nbsp;</div></li><li><div>                  $foundSplitPos = true;&nbsp;</div></li><li><div>              } elseif ($dec &lt; 192) {&nbsp;</div></li><li><div>                  <span class="comment">// Middle byte of a multi byte character, look further back</span>&nbsp;</div></li><li><div>                  $lookBack += 3;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// No encoded character found</span>&nbsp;</div></li><li><div>              $foundSplitPos = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $maxLength;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Apply word wrapping to the message body.</span>&nbsp;</div></li><li><div><span class="comment">   * Wraps the message body to the number of chars set in the WordWrap property.</span>&nbsp;</div></li><li><div><span class="comment">   * You should only do this to plain-text bodies as wrapping HTML tags may break them.</span>&nbsp;</div></li><li><div><span class="comment">   * This is called automatically by createBody(), so you don't need to call it yourself.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function setWordWrap()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;WordWrap &lt; 1) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ($this-&gt;message_type) {&nbsp;</div></li><li><div>          case 'alt':&nbsp;</div></li><li><div>          case 'alt_inline':&nbsp;</div></li><li><div>          case 'alt_attach':&nbsp;</div></li><li><div>          case 'alt_inline_attach':&nbsp;</div></li><li><div>              $this-&gt;AltBody = $this-&gt;wrapText($this-&gt;AltBody, $this-&gt;WordWrap);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              $this-&gt;Body = $this-&gt;wrapText($this-&gt;Body, $this-&gt;WordWrap);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Assemble message headers.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The assembled headers</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function createHeader()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $result = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;MessageDate == '') {&nbsp;</div></li><li><div>          $this-&gt;MessageDate = self::rfcDate();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $result .= $this-&gt;headerLine('Date', $this-&gt;MessageDate);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// To be created automatically by mail()</span>&nbsp;</div></li><li><div>      if ($this-&gt;SingleTo) {&nbsp;</div></li><li><div>          if ($this-&gt;Mailer != 'mail') {&nbsp;</div></li><li><div>              foreach ($this-&gt;to as $toaddr) {&nbsp;</div></li><li><div>                  $this-&gt;SingleToArray[] = $this-&gt;addrFormat($toaddr);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (count($this-&gt;to) &gt; 0) {&nbsp;</div></li><li><div>              if ($this-&gt;Mailer != 'mail') {&nbsp;</div></li><li><div>                  $result .= $this-&gt;addrAppend('To', $this-&gt;to);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif (count($this-&gt;cc) == 0) {&nbsp;</div></li><li><div>              $result .= $this-&gt;headerLine('To', 'undisclosed-recipients:;');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $result .= $this-&gt;addrAppend('From', array(array(trim($this-&gt;From), $this-&gt;FromName)));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// sendmail and mail() extract Cc from the header before sending</span>&nbsp;</div></li><li><div>      if (count($this-&gt;cc) &gt; 0) {&nbsp;</div></li><li><div>          $result .= $this-&gt;addrAppend('Cc', $this-&gt;cc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// sendmail and mail() extract Bcc from the header before sending</span>&nbsp;</div></li><li><div>      if ((&nbsp;</div></li><li><div>              $this-&gt;Mailer == 'sendmail' or $this-&gt;Mailer == 'qmail' or $this-&gt;Mailer == 'mail'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>          and count($this-&gt;bcc) &gt; 0&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>          $result .= $this-&gt;addrAppend('Bcc', $this-&gt;bcc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (count($this-&gt;ReplyTo) &gt; 0) {&nbsp;</div></li><li><div>          $result .= $this-&gt;addrAppend('Reply-To', $this-&gt;ReplyTo);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// mail() sets the subject itself</span>&nbsp;</div></li><li><div>      if ($this-&gt;Mailer != 'mail') {&nbsp;</div></li><li><div>          $result .= $this-&gt;headerLine('Subject', $this-&gt;encodeHeader($this-&gt;secureHeader($this-&gt;Subject)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only allow a custom message ID if it conforms to RFC 5322 section 3.6.4</span>&nbsp;</div></li><li><div>      <span class="comment">// https://tools.ietf.org/html/rfc5322#section-3.6.4</span>&nbsp;</div></li><li><div>      if ('' != $this-&gt;MessageID and preg_match('/^&lt;.*@.*&gt;$/', $this-&gt;MessageID)) {&nbsp;</div></li><li><div>          $this-&gt;lastMessageID = $this-&gt;MessageID;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;lastMessageID = sprintf('&lt;%s@%s&gt;', $this-&gt;uniqueid, $this-&gt;serverHostname());&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $result .= $this-&gt;headerLine('Message-ID', $this-&gt;lastMessageID);&nbsp;</div></li><li><div>      if (!is_null($this-&gt;Priority)) {&nbsp;</div></li><li><div>          $result .= $this-&gt;headerLine('X-Priority', $this-&gt;Priority);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;XMailer == '') {&nbsp;</div></li><li><div>          $result .= $this-&gt;headerLine(&nbsp;</div></li><li><div>              'X-Mailer', &nbsp;</div></li><li><div>              'PHPMailer ' . $this-&gt;Version . ' (https:<span class="comment">//github.com/PHPMailer/PHPMailer)'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $myXmailer = trim($this-&gt;XMailer);&nbsp;</div></li><li><div>          if ($myXmailer) {&nbsp;</div></li><li><div>              $result .= $this-&gt;headerLine('X-Mailer', $myXmailer);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;ConfirmReadingTo != '') {&nbsp;</div></li><li><div>          $result .= $this-&gt;headerLine('Disposition-Notification-To', '&lt;' . $this-&gt;ConfirmReadingTo . '&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add custom headers</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;CustomHeader as $header) {&nbsp;</div></li><li><div>          $result .= $this-&gt;headerLine(&nbsp;</div></li><li><div>              trim($header[0]), &nbsp;</div></li><li><div>              $this-&gt;encodeHeader(trim($header[1]))&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;sign_key_file) {&nbsp;</div></li><li><div>          $result .= $this-&gt;headerLine('MIME-Version', '1.0');&nbsp;</div></li><li><div>          $result .= $this-&gt;getMailMIME();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the message MIME type headers.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getMailMIME()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $result = '';&nbsp;</div></li><li><div>      $ismultipart = true;&nbsp;</div></li><li><div>      switch ($this-&gt;message_type) {&nbsp;</div></li><li><div>          case 'inline':&nbsp;</div></li><li><div>              $result .= $this-&gt;headerLine('Content-Type', 'multipart/related;');&nbsp;</div></li><li><div>              $result .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'attach':&nbsp;</div></li><li><div>          case 'inline_attach':&nbsp;</div></li><li><div>          case 'alt_attach':&nbsp;</div></li><li><div>          case 'alt_inline_attach':&nbsp;</div></li><li><div>              $result .= $this-&gt;headerLine('Content-Type', 'multipart/mixed;');&nbsp;</div></li><li><div>              $result .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'alt':&nbsp;</div></li><li><div>          case 'alt_inline':&nbsp;</div></li><li><div>              $result .= $this-&gt;headerLine('Content-Type', 'multipart/alternative;');&nbsp;</div></li><li><div>              $result .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              <span class="comment">// Catches case 'plain': and case '':</span>&nbsp;</div></li><li><div>              $result .= $this-&gt;textLine('Content-Type: ' . $this-&gt;ContentType . '; charset=' . $this-&gt;CharSet);&nbsp;</div></li><li><div>              $ismultipart = false;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// RFC1341 part 5 says 7bit is assumed if not specified</span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;Encoding != '7bit') {&nbsp;</div></li><li><div>          <span class="comment">// RFC 2045 section 6.4 says multipart MIME parts may only use 7bit, 8bit or binary CTE</span>&nbsp;</div></li><li><div>          if ($ismultipart) {&nbsp;</div></li><li><div>              if ($this-&gt;Encoding == '8bit') {&nbsp;</div></li><li><div>                  $result .= $this-&gt;headerLine('Content-Transfer-Encoding', '8bit');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// The only remaining alternatives are quoted-printable and base64, which are both 7bit compatible</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $result .= $this-&gt;headerLine('Content-Transfer-Encoding', $this-&gt;Encoding);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;Mailer != 'mail') {&nbsp;</div></li><li><div>          $result .= $this-&gt;LE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns the whole MIME message.</span>&nbsp;</div></li><li><div><span class="comment">   * Includes complete headers and body.</span>&nbsp;</div></li><li><div><span class="comment">   * Only valid post preSend().</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::preSend()</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getSentMIMEMessage()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return rtrim($this-&gt;MIMEHeader . $this-&gt;mailHeader, &quot;\n\r&quot;) . self::CRLF . self::CRLF . $this-&gt;MIMEBody;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Create unique ID</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function generateId() {&nbsp;</div></li><li><div>      return md5(uniqid(time()));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Assemble the message body.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns an empty string on failure.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The assembled message body</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function createBody()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $body = '';&nbsp;</div></li><li><div>      <span class="comment">//Create unique IDs and preset boundaries</span>&nbsp;</div></li><li><div>      $this-&gt;uniqueid = $this-&gt;generateId();&nbsp;</div></li><li><div>      $this-&gt;boundary[1] = 'b1_' . $this-&gt;uniqueid;&nbsp;</div></li><li><div>      $this-&gt;boundary[2] = 'b2_' . $this-&gt;uniqueid;&nbsp;</div></li><li><div>      $this-&gt;boundary[3] = 'b3_' . $this-&gt;uniqueid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;sign_key_file) {&nbsp;</div></li><li><div>          $body .= $this-&gt;getMailMIME() . $this-&gt;LE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;setWordWrap();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bodyEncoding = $this-&gt;Encoding;&nbsp;</div></li><li><div>      $bodyCharSet = $this-&gt;CharSet;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Can we do a 7-bit downgrade?</span></span>&nbsp;</div></li><li><div>      if ($bodyEncoding == '8bit' and !$this-&gt;has8bitChars($this-&gt;Body)) {&nbsp;</div></li><li><div>          $bodyEncoding = '7bit';&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//All ISO 8859, Windows codepage and UTF-8 charsets are ascii compatible up to 7-bit</span></span>&nbsp;</div></li><li><div>          $bodyCharSet = 'us-ascii';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//If lines are too long, and we're not already using an encoding that will shorten them, </span></span>&nbsp;</div></li><li><div>      <span class="comment">//change to quoted-printable transfer encoding for the body part only</span>&nbsp;</div></li><li><div>      if ('base64' != $this-&gt;Encoding and self::hasLineLongerThanMax($this-&gt;Body)) {&nbsp;</div></li><li><div>          $bodyEncoding = 'quoted-printable';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $altBodyEncoding = $this-&gt;Encoding;&nbsp;</div></li><li><div>      $altBodyCharSet = $this-&gt;CharSet;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Can we do a 7-bit downgrade?</span></span>&nbsp;</div></li><li><div>      if ($altBodyEncoding == '8bit' and !$this-&gt;has8bitChars($this-&gt;AltBody)) {&nbsp;</div></li><li><div>          $altBodyEncoding = '7bit';&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//All ISO 8859, Windows codepage and UTF-8 charsets are ascii compatible up to 7-bit</span></span>&nbsp;</div></li><li><div>          $altBodyCharSet = 'us-ascii';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//If lines are too long, and we're not already using an encoding that will shorten them, </span></span>&nbsp;</div></li><li><div>      <span class="comment">//change to quoted-printable transfer encoding for the alt body part only</span>&nbsp;</div></li><li><div>      if ('base64' != $altBodyEncoding and self::hasLineLongerThanMax($this-&gt;AltBody)) {&nbsp;</div></li><li><div>          $altBodyEncoding = 'quoted-printable';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Use this as a preamble in all multipart message types</span>&nbsp;</div></li><li><div>      $mimepre = &quot;This is a multi-part message in MIME format.&quot; . $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>      switch ($this-&gt;message_type) {&nbsp;</div></li><li><div>          case 'inline':&nbsp;</div></li><li><div>              $body .= $mimepre;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[1], $bodyCharSet, '', $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('inline', $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'attach':&nbsp;</div></li><li><div>              $body .= $mimepre;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[1], $bodyCharSet, '', $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('attachment', $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'inline_attach':&nbsp;</div></li><li><div>              $body .= $mimepre;&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine('--' . $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              $body .= $this-&gt;headerLine('Content-Type', 'multipart/related;');&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . '&quot;');&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[2], $bodyCharSet, '', $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('inline', $this-&gt;boundary[2]);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('attachment', $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'alt':&nbsp;</div></li><li><div>              $body .= $mimepre;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[1], $altBodyCharSet, 'text/plain', $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;AltBody, $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[1], $bodyCharSet, 'text/html', $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              if (!empty($this-&gt;Ical)) {&nbsp;</div></li><li><div>                  $body .= $this-&gt;getBoundary($this-&gt;boundary[1], '', 'text/calendar; method=REQUEST', '');&nbsp;</div></li><li><div>                  $body .= $this-&gt;encodeString($this-&gt;Ical, $this-&gt;Encoding);&nbsp;</div></li><li><div>                  $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $body .= $this-&gt;endBoundary($this-&gt;boundary[1]);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'alt_inline':&nbsp;</div></li><li><div>              $body .= $mimepre;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[1], $altBodyCharSet, 'text/plain', $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;AltBody, $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine('--' . $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              $body .= $this-&gt;headerLine('Content-Type', 'multipart/related;');&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . '&quot;');&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[2], $bodyCharSet, 'text/html', $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('inline', $this-&gt;boundary[2]);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;endBoundary($this-&gt;boundary[1]);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'alt_attach':&nbsp;</div></li><li><div>              $body .= $mimepre;&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine('--' . $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              $body .= $this-&gt;headerLine('Content-Type', 'multipart/alternative;');&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . '&quot;');&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[2], $altBodyCharSet, 'text/plain', $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;AltBody, $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[2], $bodyCharSet, 'text/html', $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;endBoundary($this-&gt;boundary[2]);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('attachment', $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'alt_inline_attach':&nbsp;</div></li><li><div>              $body .= $mimepre;&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine('--' . $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              $body .= $this-&gt;headerLine('Content-Type', 'multipart/alternative;');&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . '&quot;');&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[2], $altBodyCharSet, 'text/plain', $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;AltBody, $altBodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine('--' . $this-&gt;boundary[2]);&nbsp;</div></li><li><div>              $body .= $this-&gt;headerLine('Content-Type', 'multipart/related;');&nbsp;</div></li><li><div>              $body .= $this-&gt;textLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[3] . '&quot;');&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;getBoundary($this-&gt;boundary[3], $bodyCharSet, 'text/html', $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $bodyEncoding);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('inline', $this-&gt;boundary[3]);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;endBoundary($this-&gt;boundary[2]);&nbsp;</div></li><li><div>              $body .= $this-&gt;LE;&nbsp;</div></li><li><div>              $body .= $this-&gt;attachAll('attachment', $this-&gt;boundary[1]);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              <span class="comment">// Catch case 'plain' and case '', applies to simple `text/plain` and `text/html` body content types</span>&nbsp;</div></li><li><div>              <span class="comment">//Reset the `Encoding` property in case we changed it for line length reasons</span>&nbsp;</div></li><li><div>              $this-&gt;Encoding = $bodyEncoding;&nbsp;</div></li><li><div>              $body .= $this-&gt;encodeString($this-&gt;Body, $this-&gt;Encoding);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;isError()) {&nbsp;</div></li><li><div>          $body = '';&nbsp;</div></li><li><div>      } elseif ($this-&gt;sign_key_file) {&nbsp;</div></li><li><div>          try {&nbsp;</div></li><li><div>              if (!defined('PKCS7_TEXT')) {&nbsp;</div></li><li><div>                  throw new phpmailerException($this-&gt;lang('extension_missing') . 'openssl');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// @TODO would be nice to use php://temp streams here, but need to wrap for PHP &lt; 5.1</span>&nbsp;</div></li><li><div>              $file = tempnam(sys_get_temp_dir(), 'mail');&nbsp;</div></li><li><div>              if (false === file_put_contents($file, $body)) {&nbsp;</div></li><li><div>                  throw new phpmailerException($this-&gt;lang('signing') . ' Could not write temp file');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $signed = tempnam(sys_get_temp_dir(), 'signed');&nbsp;</div></li><li><div>              <span class="comment">//Workaround for PHP bug https://bugs.php.net/bug.php?id=69197</span>&nbsp;</div></li><li><div>              if (empty($this-&gt;sign_extracerts_file)) {&nbsp;</div></li><li><div>                  $sign = @openssl_pkcs7_sign(&nbsp;</div></li><li><div>                      $file, &nbsp;</div></li><li><div>                      $signed, &nbsp;</div></li><li><div>                      'file:<span class="comment"><span class="comment">//' . realpath($this-&gt;sign_cert_file), </span></span>&nbsp;</div></li><li><div>                      array('file:<span class="comment"><span class="comment">//' . realpath($this-&gt;sign_key_file), $this-&gt;sign_key_pass), </span></span>&nbsp;</div></li><li><div>                      null&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $sign = @openssl_pkcs7_sign(&nbsp;</div></li><li><div>                      $file, &nbsp;</div></li><li><div>                      $signed, &nbsp;</div></li><li><div>                      'file:<span class="comment"><span class="comment">//' . realpath($this-&gt;sign_cert_file), </span></span>&nbsp;</div></li><li><div>                      array('file:<span class="comment"><span class="comment">//' . realpath($this-&gt;sign_key_file), $this-&gt;sign_key_pass), </span></span>&nbsp;</div></li><li><div>                      null, &nbsp;</div></li><li><div>                      PKCS7_DETACHED, &nbsp;</div></li><li><div>                      $this-&gt;sign_extracerts_file&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($sign) {&nbsp;</div></li><li><div>                  @unlink($file);&nbsp;</div></li><li><div>                  $body = file_get_contents($signed);&nbsp;</div></li><li><div>                  @unlink($signed);&nbsp;</div></li><li><div>                  <span class="comment">//The message returned by openssl contains both headers and body, so need to split them up</span>&nbsp;</div></li><li><div>                  $parts = explode(&quot;\n\n&quot;, $body, 2);&nbsp;</div></li><li><div>                  $this-&gt;MIMEHeader .= $parts[0] . $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>                  $body = $parts[1];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  @unlink($file);&nbsp;</div></li><li><div>                  @unlink($signed);&nbsp;</div></li><li><div>                  throw new phpmailerException($this-&gt;lang('signing') . openssl_error_string());&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } catch (phpmailerException $exc) {&nbsp;</div></li><li><div>              $body = '';&nbsp;</div></li><li><div>              if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>                  throw $exc;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $body;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the start of a message boundary.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $boundary</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $charSet</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $contentType</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encoding</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function getBoundary($boundary, $charSet, $contentType, $encoding)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $result = '';&nbsp;</div></li><li><div>      if ($charSet == '') {&nbsp;</div></li><li><div>          $charSet = $this-&gt;CharSet;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($contentType == '') {&nbsp;</div></li><li><div>          $contentType = $this-&gt;ContentType;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($encoding == '') {&nbsp;</div></li><li><div>          $encoding = $this-&gt;Encoding;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $result .= $this-&gt;textLine('--' . $boundary);&nbsp;</div></li><li><div>      $result .= sprintf('Content-Type: %s; charset=%s', $contentType, $charSet);&nbsp;</div></li><li><div>      $result .= $this-&gt;LE;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// RFC1341 part 5 says 7bit is assumed if not specified</span></span></span>&nbsp;</div></li><li><div>      if ($encoding != '7bit') {&nbsp;</div></li><li><div>          $result .= $this-&gt;headerLine('Content-Transfer-Encoding', $encoding);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $result .= $this-&gt;LE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the end of a message boundary.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $boundary</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function endBoundary($boundary)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;LE . '--' . $boundary . '--' . $this-&gt;LE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set the message type.</span>&nbsp;</div></li><li><div><span class="comment">   * PHPMailer only supports some preset message types, not arbitrary MIME structures.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function setMessageType()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $type = array();&nbsp;</div></li><li><div>      if ($this-&gt;alternativeExists()) {&nbsp;</div></li><li><div>          $type[] = 'alt';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;inlineImageExists()) {&nbsp;</div></li><li><div>          $type[] = 'inline';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;attachmentExists()) {&nbsp;</div></li><li><div>          $type[] = 'attach';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;message_type = implode('_', $type);&nbsp;</div></li><li><div>      if ($this-&gt;message_type == '') {&nbsp;</div></li><li><div>          <span class="comment">//The 'plain' message_type refers to the message having a single body element, not that it is plain-text</span>&nbsp;</div></li><li><div>          $this-&gt;message_type = 'plain';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Format a header line.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function headerLine($name, $value)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $name . ': ' . $value . $this-&gt;LE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return a formatted mail line.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function textLine($value)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $value . $this-&gt;LE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add an attachment from a path on the filesystem.</span>&nbsp;</div></li><li><div><span class="comment">   * Never use a user-supplied path to a file!</span>&nbsp;</div></li><li><div><span class="comment">   * Returns false if the file could not be found or read.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $path Path to the attachment.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name Overrides the attachment name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encoding File encoding (see $Encoding).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type File extension (MIME) type.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $disposition Disposition to use</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addAttachment($path, $name = '', $encoding = 'base64', $type = '', $disposition = 'attachment')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          if (!@is_file($path)) {&nbsp;</div></li><li><div>              throw new phpmailerException($this-&gt;lang('file_access') . $path, self::STOP_CONTINUE);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// If a MIME type is not specified, try to work it out from the file name</span></span></span>&nbsp;</div></li><li><div>          if ($type == '') {&nbsp;</div></li><li><div>              $type = self::filenameToType($path);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $filename = basename($path);&nbsp;</div></li><li><div>          if ($name == '') {&nbsp;</div></li><li><div>              $name = $filename;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;attachment[] = array(&nbsp;</div></li><li><div>              0 =&gt; $path, &nbsp;</div></li><li><div>              1 =&gt; $filename, &nbsp;</div></li><li><div>              2 =&gt; $name, &nbsp;</div></li><li><div>              3 =&gt; $encoding, &nbsp;</div></li><li><div>              4 =&gt; $type, &nbsp;</div></li><li><div>              5 =&gt; false, <span class="comment"><span class="comment"><span class="comment"><span class="comment">// isStringAttachment</span></span></span></span>&nbsp;</div></li><li><div>              6 =&gt; $disposition, &nbsp;</div></li><li><div>              7 =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } catch (phpmailerException $exc) {&nbsp;</div></li><li><div>          $this-&gt;setError($exc-&gt;getMessage());&nbsp;</div></li><li><div>          $this-&gt;edebug($exc-&gt;getMessage());&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw $exc;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the array of attachments.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getAttachments()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;attachment;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Attach all file, string, and binary attachments to the message.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns an empty string on failure.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $disposition_type</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $boundary</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function attachAll($disposition_type, $boundary)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Return text of body</span>&nbsp;</div></li><li><div>      $mime = array();&nbsp;</div></li><li><div>      $cidUniq = array();&nbsp;</div></li><li><div>      $incl = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add all attachments</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;attachment as $attachment) {&nbsp;</div></li><li><div>          <span class="comment">// Check if it is a valid disposition_filter</span>&nbsp;</div></li><li><div>          if ($attachment[6] == $disposition_type) {&nbsp;</div></li><li><div>              <span class="comment">// Check for string attachment</span>&nbsp;</div></li><li><div>              $string = '';&nbsp;</div></li><li><div>              $path = '';&nbsp;</div></li><li><div>              $bString = $attachment[5];&nbsp;</div></li><li><div>              if ($bString) {&nbsp;</div></li><li><div>                  $string = $attachment[0];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $path = $attachment[0];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $inclhash = md5(serialize($attachment));&nbsp;</div></li><li><div>              if (in_array($inclhash, $incl)) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $incl[] = $inclhash;&nbsp;</div></li><li><div>              $name = $attachment[2];&nbsp;</div></li><li><div>              $encoding = $attachment[3];&nbsp;</div></li><li><div>              $type = $attachment[4];&nbsp;</div></li><li><div>              $disposition = $attachment[6];&nbsp;</div></li><li><div>              $cid = $attachment[7];&nbsp;</div></li><li><div>              if ($disposition == 'inline' && array_key_exists($cid, $cidUniq)) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $cidUniq[$cid] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $mime[] = sprintf('--%s%s', $boundary, $this-&gt;LE);&nbsp;</div></li><li><div>              <span class="comment">//Only include a filename property if we have one</span>&nbsp;</div></li><li><div>              if (!empty($name)) {&nbsp;</div></li><li><div>                  $mime[] = sprintf(&nbsp;</div></li><li><div>                      'Content-Type: %s; name=&quot;%s&quot;%s', &nbsp;</div></li><li><div>                      $type, &nbsp;</div></li><li><div>                      $this-&gt;encodeHeader($this-&gt;secureHeader($name)), &nbsp;</div></li><li><div>                      $this-&gt;LE&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $mime[] = sprintf(&nbsp;</div></li><li><div>                      'Content-Type: %s%s', &nbsp;</div></li><li><div>                      $type, &nbsp;</div></li><li><div>                      $this-&gt;LE&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// RFC1341 part 5 says 7bit is assumed if not specified</span></span></span>&nbsp;</div></li><li><div>              if ($encoding != '7bit') {&nbsp;</div></li><li><div>                  $mime[] = sprintf('Content-Transfer-Encoding: %s%s', $encoding, $this-&gt;LE);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($disposition == 'inline') {&nbsp;</div></li><li><div>                  $mime[] = sprintf('Content-ID: &lt;%s&gt;%s', $cid, $this-&gt;LE);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// If a filename contains any of these chars, it should be quoted, </span>&nbsp;</div></li><li><div>              <span class="comment">// but not otherwise: RFC2183 & RFC2045 5.1</span>&nbsp;</div></li><li><div>              <span class="comment">// Fixes a warning in IETF's msglint MIME checker</span>&nbsp;</div></li><li><div>              <span class="comment">// Allow for bypassing the Content-Disposition header totally</span>&nbsp;</div></li><li><div>              if (!(empty($disposition))) {&nbsp;</div></li><li><div>                  $encoded_name = $this-&gt;encodeHeader($this-&gt;secureHeader($name));&nbsp;</div></li><li><div>                  if (preg_match('/[ \(\)&lt;&gt;@, ;:\\&quot;\/\[\]\?=]/', $encoded_name)) {&nbsp;</div></li><li><div>                      $mime[] = sprintf(&nbsp;</div></li><li><div>                          'Content-Disposition: %s; filename=&quot;%s&quot;%s', &nbsp;</div></li><li><div>                          $disposition, &nbsp;</div></li><li><div>                          $encoded_name, &nbsp;</div></li><li><div>                          $this-&gt;LE . $this-&gt;LE&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if (!empty($encoded_name)) {&nbsp;</div></li><li><div>                          $mime[] = sprintf(&nbsp;</div></li><li><div>                              'Content-Disposition: %s; filename=%s%s', &nbsp;</div></li><li><div>                              $disposition, &nbsp;</div></li><li><div>                              $encoded_name, &nbsp;</div></li><li><div>                              $this-&gt;LE . $this-&gt;LE&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $mime[] = sprintf(&nbsp;</div></li><li><div>                              'Content-Disposition: %s%s', &nbsp;</div></li><li><div>                              $disposition, &nbsp;</div></li><li><div>                              $this-&gt;LE . $this-&gt;LE&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $mime[] = $this-&gt;LE;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Encode as string attachment</span>&nbsp;</div></li><li><div>              if ($bString) {&nbsp;</div></li><li><div>                  $mime[] = $this-&gt;encodeString($string, $encoding);&nbsp;</div></li><li><div>                  if ($this-&gt;isError()) {&nbsp;</div></li><li><div>                      return '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $mime[] = $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $mime[] = $this-&gt;encodeFile($path, $encoding);&nbsp;</div></li><li><div>                  if ($this-&gt;isError()) {&nbsp;</div></li><li><div>                      return '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $mime[] = $this-&gt;LE . $this-&gt;LE;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $mime[] = sprintf('--%s--%s', $boundary, $this-&gt;LE);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return implode('', $mime);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Encode a file attachment in requested format.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns an empty string on failure.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $path The full path to the file</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encoding The encoding to use; one of 'base64', '7bit', '8bit', 'binary', 'quoted-printable'</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function encodeFile($path, $encoding = 'base64')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          if (!is_readable($path)) {&nbsp;</div></li><li><div>              throw new phpmailerException($this-&gt;lang('file_open') . $path, self::STOP_CONTINUE);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $magic_quotes = get_magic_quotes_runtime();&nbsp;</div></li><li><div>          if ($magic_quotes) {&nbsp;</div></li><li><div>              if (version_compare(PHP_VERSION, '5.3.0', '&lt;')) {&nbsp;</div></li><li><div>                  set_magic_quotes_runtime(false);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">//Doesn't exist in PHP 5.4, but we don't need to check because</span>&nbsp;</div></li><li><div>                  <span class="comment">//get_magic_quotes_runtime always returns false in 5.4+</span>&nbsp;</div></li><li><div>                  <span class="comment">//so it will never get here</span>&nbsp;</div></li><li><div>                  ini_set('magic_quotes_runtime', false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $file_buffer = file_get_contents($path);&nbsp;</div></li><li><div>          $file_buffer = $this-&gt;encodeString($file_buffer, $encoding);&nbsp;</div></li><li><div>          if ($magic_quotes) {&nbsp;</div></li><li><div>              if (version_compare(PHP_VERSION, '5.3.0', '&lt;')) {&nbsp;</div></li><li><div>                  set_magic_quotes_runtime($magic_quotes);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  ini_set('magic_quotes_runtime', $magic_quotes);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $file_buffer;&nbsp;</div></li><li><div>      } catch (Exception $exc) {&nbsp;</div></li><li><div>          $this-&gt;setError($exc-&gt;getMessage());&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Encode a string in requested format.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns an empty string on failure.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str The text to encode</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encoding The encoding to use; one of 'base64', '7bit', '8bit', 'binary', 'quoted-printable'</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function encodeString($str, $encoding = 'base64')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $encoded = '';&nbsp;</div></li><li><div>      switch (strtolower($encoding)) {&nbsp;</div></li><li><div>          case 'base64':&nbsp;</div></li><li><div>              $encoded = chunk_split(base64_encode($str), 76, $this-&gt;LE);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case '7bit':&nbsp;</div></li><li><div>          case '8bit':&nbsp;</div></li><li><div>              $encoded = $this-&gt;fixEOL($str);&nbsp;</div></li><li><div>              <span class="comment">// Make sure it ends with a line break</span>&nbsp;</div></li><li><div>              if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE) {&nbsp;</div></li><li><div>                  $encoded .= $this-&gt;LE;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'binary':&nbsp;</div></li><li><div>              $encoded = $str;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'quoted-printable':&nbsp;</div></li><li><div>              $encoded = $this-&gt;encodeQP($str);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              $this-&gt;setError($this-&gt;lang('encoding') . $encoding);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $encoded;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Encode a header string optimally.</span>&nbsp;</div></li><li><div><span class="comment">   * Picks shortest of Q, B, quoted-printable or none.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $position</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function encodeHeader($str, $position = 'text')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $matchcount = 0;&nbsp;</div></li><li><div>      switch (strtolower($position)) {&nbsp;</div></li><li><div>          case 'phrase':&nbsp;</div></li><li><div>              if (!preg_match('/[\200-\377]/', $str)) {&nbsp;</div></li><li><div>                  <span class="comment">// Can't use addslashes as we don't know the value of magic_quotes_sybase</span>&nbsp;</div></li><li><div>                  $encoded = addcslashes($str, &quot;\0..\37\177\\\&quot;&quot;);&nbsp;</div></li><li><div>                  if (($str == $encoded) && !preg_match('/[^A-Za-z0-9!#$%&\'*+\/=?^_`{|}~ -]/', $str)) {&nbsp;</div></li><li><div>                      return ($encoded);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      return (&quot;\&quot;$encoded\&quot;&quot;);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $matchcount = preg_match_all('/[^\040\041\043-\133\135-\176]/', $str, $matches);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** @noinspection PhpMissingBreakStatementInspection */</span></span>&nbsp;</div></li><li><div>          case 'comment':&nbsp;</div></li><li><div>              $matchcount = preg_match_all('/[()&quot;]/', $str, $matches);&nbsp;</div></li><li><div>              <span class="comment">// Intentional fall-through</span>&nbsp;</div></li><li><div>          case 'text':&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              $matchcount += preg_match_all('/[\000-\010\013\014\016-\037\177-\377]/', $str, $matches);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//There are no chars that need encoding</span>&nbsp;</div></li><li><div>      if ($matchcount == 0) {&nbsp;</div></li><li><div>          return ($str);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $maxlen = 75 - 7 - strlen($this-&gt;CharSet);&nbsp;</div></li><li><div>      <span class="comment">// Try to select the encoding which should produce the shortest output</span>&nbsp;</div></li><li><div>      if ($matchcount &gt; strlen($str) / 3) {&nbsp;</div></li><li><div>          <span class="comment">// More than a third of the content will need encoding, so B encoding will be most efficient</span>&nbsp;</div></li><li><div>          $encoding = 'B';&nbsp;</div></li><li><div>          if (function_exists('mb_strlen') && $this-&gt;hasMultiBytes($str)) {&nbsp;</div></li><li><div>              <span class="comment">// Use a custom function which correctly encodes and wraps long</span>&nbsp;</div></li><li><div>              <span class="comment">// multibyte strings without breaking lines within a character</span>&nbsp;</div></li><li><div>              $encoded = $this-&gt;base64EncodeWrapMB($str, &quot;\n&quot;);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $encoded = base64_encode($str);&nbsp;</div></li><li><div>              $maxlen -= $maxlen % 4;&nbsp;</div></li><li><div>              $encoded = trim(chunk_split($encoded, $maxlen, &quot;\n&quot;));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $encoding = 'Q';&nbsp;</div></li><li><div>          $encoded = $this-&gt;encodeQ($str, $position);&nbsp;</div></li><li><div>          $encoded = $this-&gt;wrapText($encoded, $maxlen, true);&nbsp;</div></li><li><div>          $encoded = str_replace('=' . self::CRLF, &quot;\n&quot;, trim($encoded));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $encoded = preg_replace('/^(.*)$/m', ' =?' . $this-&gt;CharSet . &quot;?$encoding?\\1?=&quot;, $encoded);&nbsp;</div></li><li><div>      $encoded = trim(str_replace(&quot;\n&quot;, $this-&gt;LE, $encoded));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $encoded;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if a string contains multi-byte characters.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str multi-byte text to wrap encode</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function hasMultiBytes($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (function_exists('mb_strlen')) {&nbsp;</div></li><li><div>          return (strlen($str) &gt; mb_strlen($str, $this-&gt;CharSet));&nbsp;</div></li><li><div>      } else { <span class="comment">// Assume no multibytes (we can't handle without mbstring functions anyway)</span>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Does a string contain any 8-bit chars (in any charset)?</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $text</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function has8bitChars($text)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return (boolean)preg_match('/[\x80-\xFF]/', $text);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Encode and wrap long multibyte strings for mail headers</span>&nbsp;</div></li><li><div><span class="comment">   * without breaking lines within a character.</span>&nbsp;</div></li><li><div><span class="comment">   * Adapted from a function by paravoid</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://www.php.net/manual/en/function.mb-encode-mimeheader.php#60283</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str multi-byte text to wrap encode</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $linebreak string to use as linefeed/end-of-line</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function base64EncodeWrapMB($str, $linebreak = null)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $start = '=?' . $this-&gt;CharSet . '?B?';&nbsp;</div></li><li><div>      $end = '?=';&nbsp;</div></li><li><div>      $encoded = '';&nbsp;</div></li><li><div>      if ($linebreak === null) {&nbsp;</div></li><li><div>          $linebreak = $this-&gt;LE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $mb_length = mb_strlen($str, $this-&gt;CharSet);&nbsp;</div></li><li><div>      <span class="comment">// Each line must have length &lt;= 75, including $start and $end</span>&nbsp;</div></li><li><div>      $length = 75 - strlen($start) - strlen($end);&nbsp;</div></li><li><div>      <span class="comment">// Average multi-byte ratio</span>&nbsp;</div></li><li><div>      $ratio = $mb_length / strlen($str);&nbsp;</div></li><li><div>      <span class="comment">// Base64 has a 4:3 ratio</span>&nbsp;</div></li><li><div>      $avgLength = floor($length * $ratio * .75);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $mb_length; $i += $offset) {&nbsp;</div></li><li><div>          $lookBack = 0;&nbsp;</div></li><li><div>          do {&nbsp;</div></li><li><div>              $offset = $avgLength - $lookBack;&nbsp;</div></li><li><div>              $chunk = mb_substr($str, $i, $offset, $this-&gt;CharSet);&nbsp;</div></li><li><div>              $chunk = base64_encode($chunk);&nbsp;</div></li><li><div>              $lookBack++;&nbsp;</div></li><li><div>          } while (strlen($chunk) &gt; $length);&nbsp;</div></li><li><div>          $encoded .= $chunk . $linebreak;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Chomp the last linefeed</span>&nbsp;</div></li><li><div>      $encoded = substr($encoded, 0, -strlen($linebreak));&nbsp;</div></li><li><div>      return $encoded;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Encode a string in quoted-printable format.</span>&nbsp;</div></li><li><div><span class="comment">   * According to RFC2045 section 6.7.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $string The text to encode</span>&nbsp;</div></li><li><div><span class="comment">   * @param integer $line_max Number of chars allowed on a line before wrapping</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://www.php.net/manual/en/function.quoted-printable-decode.php#89417 Adapted from this comment</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function encodeQP($string, $line_max = 76)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Use native function if it's available (&gt;= PHP5.3)</span>&nbsp;</div></li><li><div>      if (function_exists('quoted_printable_encode')) {&nbsp;</div></li><li><div>          return quoted_printable_encode($string);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Fall back to a pure PHP implementation</span>&nbsp;</div></li><li><div>      $string = str_replace(&nbsp;</div></li><li><div>          array('%20', '%0D%0A.', '%0D%0A', '%'), &nbsp;</div></li><li><div>          array(' ', &quot;\r\n=2E&quot;, &quot;\r\n&quot;, '='), &nbsp;</div></li><li><div>          rawurlencode($string)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      return preg_replace('/[^\r\n]{' . ($line_max - 3) . '}[^=\r\n]{2}/', &quot;$0=\r\n&quot;, $string);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Backward compatibility wrapper for an old QP encoding function that was removed.</span>&nbsp;</div></li><li><div><span class="comment">   * @see PHPMailer::encodeQP()</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $string</span>&nbsp;</div></li><li><div><span class="comment">   * @param integer $line_max</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $space_conv</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated Use encodeQP instead.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function encodeQPphp(&nbsp;</div></li><li><div>      $string, &nbsp;</div></li><li><div>      $line_max = 76, &nbsp;</div></li><li><div>      <span class="comment">/** @noinspection PhpUnusedParameterInspection */</span> $space_conv = false&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>      return $this-&gt;encodeQP($string, $line_max);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Encode a string using Q encoding.</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://tools.ietf.org/html/rfc2047</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str the text to encode</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $position Where the text is going to be used, see the RFC for what that means</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function encodeQ($str, $position = 'text')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// There should not be any EOL in the string</span>&nbsp;</div></li><li><div>      $pattern = '';&nbsp;</div></li><li><div>      $encoded = str_replace(array(&quot;\r&quot;, &quot;\n&quot;), '', $str);&nbsp;</div></li><li><div>      switch (strtolower($position)) {&nbsp;</div></li><li><div>          case 'phrase':&nbsp;</div></li><li><div>              <span class="comment">// RFC 2047 section 5.3</span>&nbsp;</div></li><li><div>              $pattern = '^A-Za-z0-9!*+\/ -';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** @noinspection PhpMissingBreakStatementInspection */</span></span>&nbsp;</div></li><li><div>          case 'comment':&nbsp;</div></li><li><div>              <span class="comment">// RFC 2047 section 5.2</span>&nbsp;</div></li><li><div>              $pattern = '\(\)&quot;';&nbsp;</div></li><li><div>              <span class="comment">// intentional fall-through</span>&nbsp;</div></li><li><div>              <span class="comment">// for this reason we build the $pattern without including delimiters and []</span>&nbsp;</div></li><li><div>          case 'text':&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              <span class="comment">// RFC 2047 section 5.1</span>&nbsp;</div></li><li><div>              <span class="comment">// Replace every high ascii, control, =, ? and _ characters</span>&nbsp;</div></li><li><div>              $pattern = '\000-\011\013\014\016-\037\075\077\137\177-\377' . $pattern;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $matches = array();&nbsp;</div></li><li><div>      if (preg_match_all(&quot;/[{$pattern}]/&quot;, $encoded, $matches)) {&nbsp;</div></li><li><div>          <span class="comment">// If the string contains an '=', make sure it's the first thing we replace</span>&nbsp;</div></li><li><div>          <span class="comment">// so as to avoid double-encoding</span>&nbsp;</div></li><li><div>          $eqkey = array_search('=', $matches[0]);&nbsp;</div></li><li><div>          if (false !== $eqkey) {&nbsp;</div></li><li><div>              unset($matches[0][$eqkey]);&nbsp;</div></li><li><div>              array_unshift($matches[0], '=');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach (array_unique($matches[0]) as $char) {&nbsp;</div></li><li><div>              $encoded = str_replace($char, '=' . sprintf('%02X', ord($char)), $encoded);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Replace every spaces to _ (more readable than =20)</span>&nbsp;</div></li><li><div>      return str_replace(' ', '_', $encoded);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a string or binary attachment (non-filesystem).</span>&nbsp;</div></li><li><div><span class="comment">   * This method can be used to attach ascii or binary data, </span>&nbsp;</div></li><li><div><span class="comment">   * such as a BLOB record from a database.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $string String attachment data.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $filename Name of the attachment.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encoding File encoding (see $Encoding).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type File extension (MIME) type.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $disposition Disposition to use</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addStringAttachment(&nbsp;</div></li><li><div>      $string, &nbsp;</div></li><li><div>      $filename, &nbsp;</div></li><li><div>      $encoding = 'base64', &nbsp;</div></li><li><div>      $type = '', &nbsp;</div></li><li><div>      $disposition = 'attachment'&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// If a MIME type is not specified, try to work it out from the file name</span></span></span>&nbsp;</div></li><li><div>      if ($type == '') {&nbsp;</div></li><li><div>          $type = self::filenameToType($filename);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Append to $attachment array</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;attachment[] = array(&nbsp;</div></li><li><div>          0 =&gt; $string, &nbsp;</div></li><li><div>          1 =&gt; $filename, &nbsp;</div></li><li><div>          2 =&gt; basename($filename), &nbsp;</div></li><li><div>          3 =&gt; $encoding, &nbsp;</div></li><li><div>          4 =&gt; $type, &nbsp;</div></li><li><div>          5 =&gt; true, <span class="comment"><span class="comment"><span class="comment"><span class="comment">// isStringAttachment</span></span></span></span>&nbsp;</div></li><li><div>          6 =&gt; $disposition, &nbsp;</div></li><li><div>          7 =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add an embedded (inline) attachment from a file.</span>&nbsp;</div></li><li><div><span class="comment">   * This can include images, sounds, and just about any other document type.</span>&nbsp;</div></li><li><div><span class="comment">   * These differ from 'regular' attachments in that they are intended to be</span>&nbsp;</div></li><li><div><span class="comment">   * displayed inline with the message, not just attached for download.</span>&nbsp;</div></li><li><div><span class="comment">   * This is used in HTML messages that embed the images</span>&nbsp;</div></li><li><div><span class="comment">   * the HTML refers to using the $cid value.</span>&nbsp;</div></li><li><div><span class="comment">   * Never use a user-supplied path to a file!</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $path Path to the attachment.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $cid Content ID of the attachment; Use this to reference</span>&nbsp;</div></li><li><div><span class="comment">   *        the content when using an embedded image in HTML.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name Overrides the attachment name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encoding File encoding (see $Encoding).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type File MIME type.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $disposition Disposition to use</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean True on successfully adding an attachment</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addEmbeddedImage($path, $cid, $name = '', $encoding = 'base64', $type = '', $disposition = 'inline')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!@is_file($path)) {&nbsp;</div></li><li><div>          $this-&gt;setError($this-&gt;lang('file_access') . $path);&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// If a MIME type is not specified, try to work it out from the file name</span></span></span>&nbsp;</div></li><li><div>      if ($type == '') {&nbsp;</div></li><li><div>          $type = self::filenameToType($path);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $filename = basename($path);&nbsp;</div></li><li><div>      if ($name == '') {&nbsp;</div></li><li><div>          $name = $filename;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Append to $attachment array</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;attachment[] = array(&nbsp;</div></li><li><div>          0 =&gt; $path, &nbsp;</div></li><li><div>          1 =&gt; $filename, &nbsp;</div></li><li><div>          2 =&gt; $name, &nbsp;</div></li><li><div>          3 =&gt; $encoding, &nbsp;</div></li><li><div>          4 =&gt; $type, &nbsp;</div></li><li><div>          5 =&gt; false, <span class="comment"><span class="comment"><span class="comment"><span class="comment">// isStringAttachment</span></span></span></span>&nbsp;</div></li><li><div>          6 =&gt; $disposition, &nbsp;</div></li><li><div>          7 =&gt; $cid&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add an embedded stringified attachment.</span>&nbsp;</div></li><li><div><span class="comment">   * This can include images, sounds, and just about any other document type.</span>&nbsp;</div></li><li><div><span class="comment">   * Be sure to set the $type to an image type for images:</span>&nbsp;</div></li><li><div><span class="comment">   * JPEG images use 'image/jpeg', GIF uses 'image/gif', PNG uses 'image/png'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $string The attachment binary data.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $cid Content ID of the attachment; Use this to reference</span>&nbsp;</div></li><li><div><span class="comment">   *        the content when using an embedded image in HTML.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $encoding File encoding (see $Encoding).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type MIME type.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $disposition Disposition to use</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean True on successfully adding an attachment</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addStringEmbeddedImage(&nbsp;</div></li><li><div>      $string, &nbsp;</div></li><li><div>      $cid, &nbsp;</div></li><li><div>      $name = '', &nbsp;</div></li><li><div>      $encoding = 'base64', &nbsp;</div></li><li><div>      $type = '', &nbsp;</div></li><li><div>      $disposition = 'inline'&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>      <span class="comment">// If a MIME type is not specified, try to work it out from the name</span>&nbsp;</div></li><li><div>      if ($type == '' and !empty($name)) {&nbsp;</div></li><li><div>          $type = self::filenameToType($name);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Append to $attachment array</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;attachment[] = array(&nbsp;</div></li><li><div>          0 =&gt; $string, &nbsp;</div></li><li><div>          1 =&gt; $name, &nbsp;</div></li><li><div>          2 =&gt; $name, &nbsp;</div></li><li><div>          3 =&gt; $encoding, &nbsp;</div></li><li><div>          4 =&gt; $type, &nbsp;</div></li><li><div>          5 =&gt; true, <span class="comment"><span class="comment"><span class="comment"><span class="comment">// isStringAttachment</span></span></span></span>&nbsp;</div></li><li><div>          6 =&gt; $disposition, &nbsp;</div></li><li><div>          7 =&gt; $cid&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if an inline attachment is present.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function inlineImageExists()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($this-&gt;attachment as $attachment) {&nbsp;</div></li><li><div>          if ($attachment[6] == 'inline') {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if an attachment (non-inline) is present.</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function attachmentExists()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($this-&gt;attachment as $attachment) {&nbsp;</div></li><li><div>          if ($attachment[6] == 'attachment') {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if this message has an alternative body set.</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function alternativeExists()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return !empty($this-&gt;AltBody);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear queued addresses of given kind.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $kind 'to', 'cc', or 'bcc'</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearQueuedAddresses($kind)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $RecipientsQueue = $this-&gt;RecipientsQueue;&nbsp;</div></li><li><div>      foreach ($RecipientsQueue as $address =&gt; $params) {&nbsp;</div></li><li><div>          if ($params[0] == $kind) {&nbsp;</div></li><li><div>              unset($this-&gt;RecipientsQueue[$address]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear all To recipients.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearAddresses()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($this-&gt;to as $to) {&nbsp;</div></li><li><div>          unset($this-&gt;all_recipients[strtolower($to[0])]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;to = array();&nbsp;</div></li><li><div>      $this-&gt;clearQueuedAddresses('to');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear all CC recipients.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearCCs()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($this-&gt;cc as $cc) {&nbsp;</div></li><li><div>          unset($this-&gt;all_recipients[strtolower($cc[0])]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;cc = array();&nbsp;</div></li><li><div>      $this-&gt;clearQueuedAddresses('cc');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear all BCC recipients.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearBCCs()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($this-&gt;bcc as $bcc) {&nbsp;</div></li><li><div>          unset($this-&gt;all_recipients[strtolower($bcc[0])]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;bcc = array();&nbsp;</div></li><li><div>      $this-&gt;clearQueuedAddresses('bcc');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear all ReplyTo recipients.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearReplyTos()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;ReplyTo = array();&nbsp;</div></li><li><div>      $this-&gt;ReplyToQueue = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear all recipient types.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearAllRecipients()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;to = array();&nbsp;</div></li><li><div>      $this-&gt;cc = array();&nbsp;</div></li><li><div>      $this-&gt;bcc = array();&nbsp;</div></li><li><div>      $this-&gt;all_recipients = array();&nbsp;</div></li><li><div>      $this-&gt;RecipientsQueue = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear all filesystem, string, and binary attachments.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearAttachments()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;attachment = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clear all custom headers.</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clearCustomHeaders()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;CustomHeader = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add an error message to the error container.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $msg</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function setError($msg)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;error_count++;&nbsp;</div></li><li><div>      if ($this-&gt;Mailer == 'smtp' and !is_null($this-&gt;smtp)) {&nbsp;</div></li><li><div>          $lasterror = $this-&gt;smtp-&gt;getError();&nbsp;</div></li><li><div>          if (!empty($lasterror['error'])) {&nbsp;</div></li><li><div>              $msg .= $this-&gt;lang('smtp_error') . $lasterror['error'];&nbsp;</div></li><li><div>              if (!empty($lasterror['detail'])) {&nbsp;</div></li><li><div>                  $msg .= ' Detail: '. $lasterror['detail'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!empty($lasterror['smtp_code'])) {&nbsp;</div></li><li><div>                  $msg .= ' SMTP code: ' . $lasterror['smtp_code'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!empty($lasterror['smtp_code_ex'])) {&nbsp;</div></li><li><div>                  $msg .= ' Additional SMTP info: ' . $lasterror['smtp_code_ex'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;ErrorInfo = $msg;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return an RFC 822 formatted date.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function rfcDate()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Set the time zone to whatever the default is to avoid 500 errors</span>&nbsp;</div></li><li><div>      <span class="comment">// Will default to UTC if it's not set properly in php.ini</span>&nbsp;</div></li><li><div>      date_default_timezone_set(@date_default_timezone_get());&nbsp;</div></li><li><div>      return date('D, j M Y H:i:s O');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the server hostname.</span>&nbsp;</div></li><li><div><span class="comment">   * Returns 'localhost.localdomain' if unknown.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function serverHostname()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $result = 'localhost.localdomain';&nbsp;</div></li><li><div>      if (!empty($this-&gt;Hostname)) {&nbsp;</div></li><li><div>          $result = $this-&gt;Hostname;&nbsp;</div></li><li><div>      } elseif (isset($_SERVER) and array_key_exists('SERVER_NAME', $_SERVER) and !empty($_SERVER['SERVER_NAME'])) {&nbsp;</div></li><li><div>          $result = $_SERVER['SERVER_NAME'];&nbsp;</div></li><li><div>      } elseif (function_exists('gethostname') && gethostname() !== false) {&nbsp;</div></li><li><div>          $result = gethostname();&nbsp;</div></li><li><div>      } elseif (php_uname('n') !== false) {&nbsp;</div></li><li><div>          $result = php_uname('n');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get an error message in the current language.</span>&nbsp;</div></li><li><div><span class="comment">   * @access protected</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function lang($key)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (count($this-&gt;language) &lt; 1) {&nbsp;</div></li><li><div>          $this-&gt;setLanguage('en'); <span class="comment">// set the default language</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (array_key_exists($key, $this-&gt;language)) {&nbsp;</div></li><li><div>          if ($key == 'smtp_connect_failed') {&nbsp;</div></li><li><div>              <span class="comment">//Include a link to troubleshooting docs on SMTP connection failure</span>&nbsp;</div></li><li><div>              <span class="comment">//this is by far the biggest cause of support questions</span>&nbsp;</div></li><li><div>              <span class="comment">//but it's usually not PHPMailer's fault.</span>&nbsp;</div></li><li><div>              return $this-&gt;language[$key] . ' https:<span class="comment">//github.com/PHPMailer/PHPMailer/wiki/Troubleshooting';</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $this-&gt;language[$key];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">//Return the key as a fallback</span>&nbsp;</div></li><li><div>          return $key;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if an error occurred.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean True if an error did occur.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function isError()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return ($this-&gt;error_count &gt; 0);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Ensure consistent line endings in a string.</span>&nbsp;</div></li><li><div><span class="comment">   * Changes every end of line from CRLF, CR or LF to $this-&gt;LE.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str String to fixEOL</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function fixEOL($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Normalise to \n</span>&nbsp;</div></li><li><div>      $nstr = str_replace(array(&quot;\r\n&quot;, &quot;\r&quot;), &quot;\n&quot;, $str);&nbsp;</div></li><li><div>      <span class="comment">// Now convert LE as needed</span>&nbsp;</div></li><li><div>      if ($this-&gt;LE !== &quot;\n&quot;) {&nbsp;</div></li><li><div>          $nstr = str_replace(&quot;\n&quot;, $this-&gt;LE, $nstr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $nstr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a custom header.</span>&nbsp;</div></li><li><div><span class="comment">   * $name value can be overloaded to contain</span>&nbsp;</div></li><li><div><span class="comment">   * both header name and value (name:value)</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name Custom header name</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Header value</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function addCustomHeader($name, $value = null)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($value === null) {&nbsp;</div></li><li><div>          <span class="comment">// Value passed in as name:value</span>&nbsp;</div></li><li><div>          $this-&gt;CustomHeader[] = explode(':', $name, 2);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;CustomHeader[] = array($name, $value);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns all custom headers.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getCustomHeaders()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;CustomHeader;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Create a message body from an HTML string.</span>&nbsp;</div></li><li><div><span class="comment">   * Automatically inlines images and creates a plain-text version by converting the HTML, </span>&nbsp;</div></li><li><div><span class="comment">   * overwriting any existing values in Body and AltBody.</span>&nbsp;</div></li><li><div><span class="comment">   * Do not source $message content from user input!</span>&nbsp;</div></li><li><div><span class="comment">   * $basedir is prepended when handling relative URLs, e.g. &lt;img src=&quot;/images/a.png&quot;&gt; and must not be empty</span>&nbsp;</div></li><li><div><span class="comment">   * will look for an image file in $basedir/images/a.png and convert it to inline.</span>&nbsp;</div></li><li><div><span class="comment">   * If you don't provide a $basedir, relative paths will be left untouched (and thus probably break in email)</span>&nbsp;</div></li><li><div><span class="comment">   * If you don't want to apply these transformations to your HTML, just set Body and AltBody directly.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $message HTML message string</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $basedir Absolute path to a base directory to prepend to relative paths to images</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean|callable $advanced Whether to use the internal HTML to text converter</span>&nbsp;</div></li><li><div><span class="comment">   *    or your own custom converter @see PHPMailer::html2text()</span>&nbsp;</div></li><li><div><span class="comment">   * @return string $message The transformed message Body</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function msgHTML($message, $basedir = '', $advanced = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      preg_match_all('/(src|background)=[&quot;\'](.*)[&quot;\']/Ui', $message, $images);&nbsp;</div></li><li><div>      if (array_key_exists(2, $images)) {&nbsp;</div></li><li><div>          if (strlen($basedir) &gt; 1 && substr($basedir, -1) != '/') {&nbsp;</div></li><li><div>              <span class="comment">// Ensure $basedir has a trailing /</span>&nbsp;</div></li><li><div>              $basedir .= '/';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ($images[2] as $imgindex =&gt; $url) {&nbsp;</div></li><li><div>              <span class="comment">// Convert data URIs into embedded images</span>&nbsp;</div></li><li><div>              if (preg_match('#^data:(image[^;, ]*)(;base64)?, #', $url, $match)) {&nbsp;</div></li><li><div>                  $data = substr($url, strpos($url, ', '));&nbsp;</div></li><li><div>                  if ($match[2]) {&nbsp;</div></li><li><div>                      $data = base64_decode($data);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $data = rawurldecode($data);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $cid = md5($url) . '@phpmailer.0'; <span class="comment"><span class="comment">// RFC2392 S 2</span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;addStringEmbeddedImage($data, $cid, 'embed' . $imgindex, 'base64', $match[1])) {&nbsp;</div></li><li><div>                      $message = str_replace(&nbsp;</div></li><li><div>                          $images[0][$imgindex], &nbsp;</div></li><li><div>                          $images[1][$imgindex] . '=&quot;cid:' . $cid . '&quot;', &nbsp;</div></li><li><div>                          $message&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (&nbsp;</div></li><li><div>                  <span class="comment">// Only process relative URLs if a basedir is provided (i.e. no absolute local paths)</span>&nbsp;</div></li><li><div>                  !empty($basedir)&nbsp;</div></li><li><div>                  <span class="comment">// Ignore URLs containing parent dir traversal (..)</span>&nbsp;</div></li><li><div>                  && (strpos($url, '..') === false)&nbsp;</div></li><li><div>                  <span class="comment">// Do not change urls that are already inline images</span>&nbsp;</div></li><li><div>                  && substr($url, 0, 4) !== 'cid:'&nbsp;</div></li><li><div>                  <span class="comment">// Do not change absolute URLs, including anonymous protocol</span>&nbsp;</div></li><li><div>                  && !preg_match('#^[a-z][a-z0-9+.-]*:?<span class="comment">//#i', $url)</span>&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                  $filename = basename($url);&nbsp;</div></li><li><div>                  $directory = dirname($url);&nbsp;</div></li><li><div>                  if ($directory == '.') {&nbsp;</div></li><li><div>                      $directory = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $cid = md5($url) . '@phpmailer.0'; <span class="comment"><span class="comment">// RFC2392 S 2</span></span>&nbsp;</div></li><li><div>                  if (strlen($directory) &gt; 1 && substr($directory, -1) != '/') {&nbsp;</div></li><li><div>                      $directory .= '/';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;addEmbeddedImage(&nbsp;</div></li><li><div>                      $basedir . $directory . $filename, &nbsp;</div></li><li><div>                      $cid, &nbsp;</div></li><li><div>                      $filename, &nbsp;</div></li><li><div>                      'base64', &nbsp;</div></li><li><div>                      self::_mime_types((string)self::mb_pathinfo($filename, PATHINFO_EXTENSION))&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                      $message = preg_replace(&nbsp;</div></li><li><div>                          '/' . $images[1][$imgindex] . '=[&quot;\']' . preg_quote($url, '/') . '[&quot;\']/Ui', &nbsp;</div></li><li><div>                          $images[1][$imgindex] . '=&quot;cid:' . $cid . '&quot;', &nbsp;</div></li><li><div>                          $message&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;isHTML(true);&nbsp;</div></li><li><div>      <span class="comment">// Convert all message body line breaks to CRLF, makes quoted-printable encoding work much better</span>&nbsp;</div></li><li><div>      $this-&gt;Body = $this-&gt;normalizeBreaks($message);&nbsp;</div></li><li><div>      $this-&gt;AltBody = $this-&gt;normalizeBreaks($this-&gt;html2text($message, $advanced));&nbsp;</div></li><li><div>      if (!$this-&gt;alternativeExists()) {&nbsp;</div></li><li><div>          $this-&gt;AltBody = 'To view this email message, open it in a program that understands HTML!' .&nbsp;</div></li><li><div>              self::CRLF . self::CRLF;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $this-&gt;Body;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Convert an HTML string into plain text.</span>&nbsp;</div></li><li><div><span class="comment">   * This is used by msgHTML().</span>&nbsp;</div></li><li><div><span class="comment">   * Note - older versions of this function used a bundled advanced converter</span>&nbsp;</div></li><li><div><span class="comment">   * which was been removed for license reasons in #232.</span>&nbsp;</div></li><li><div><span class="comment">   * Example usage:</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * // Use default conversion</span>&nbsp;</div></li><li><div><span class="comment">   * $plain = $mail-&gt;html2text($html);</span>&nbsp;</div></li><li><div><span class="comment">   * // Use your own custom converter</span>&nbsp;</div></li><li><div><span class="comment">   * $plain = $mail-&gt;html2text($html, function($html) {</span>&nbsp;</div></li><li><div><span class="comment">   *     $converter = new MyHtml2text($html);</span>&nbsp;</div></li><li><div><span class="comment">   *     return $converter-&gt;get_text();</span>&nbsp;</div></li><li><div><span class="comment">   * });</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $html The HTML text to convert</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean|callable $advanced Any boolean value to use the internal converter, </span>&nbsp;</div></li><li><div><span class="comment">   *   or provide your own callable for custom conversion.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function html2text($html, $advanced = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_callable($advanced)) {&nbsp;</div></li><li><div>          return call_user_func($advanced, $html);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return html_entity_decode(&nbsp;</div></li><li><div>          trim(strip_tags(preg_replace('/&lt;(head|title|style|script)[^&gt;]*&gt;.*?&lt;\/\\1&gt;/si', '', $html))), &nbsp;</div></li><li><div>          ENT_QUOTES, &nbsp;</div></li><li><div>          $this-&gt;CharSet&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the MIME type for a file extension.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $ext File extension</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return string MIME type of file.</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function _mime_types($ext = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $mimes = array(&nbsp;</div></li><li><div>          'xl' =&gt; 'application/excel', &nbsp;</div></li><li><div>          'js' =&gt; 'application/javascript', &nbsp;</div></li><li><div>          'hqx' =&gt; 'application/mac-binhex40', &nbsp;</div></li><li><div>          'cpt' =&gt; 'application/mac-compactpro', &nbsp;</div></li><li><div>          'bin' =&gt; 'application/macbinary', &nbsp;</div></li><li><div>          'doc' =&gt; 'application/msword', &nbsp;</div></li><li><div>          'word' =&gt; 'application/msword', &nbsp;</div></li><li><div>          'xlsx' =&gt; 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', &nbsp;</div></li><li><div>          'xltx' =&gt; 'application/vnd.openxmlformats-officedocument.spreadsheetml.template', &nbsp;</div></li><li><div>          'potx' =&gt; 'application/vnd.openxmlformats-officedocument.presentationml.template', &nbsp;</div></li><li><div>          'ppsx' =&gt; 'application/vnd.openxmlformats-officedocument.presentationml.slideshow', &nbsp;</div></li><li><div>          'pptx' =&gt; 'application/vnd.openxmlformats-officedocument.presentationml.presentation', &nbsp;</div></li><li><div>          'sldx' =&gt; 'application/vnd.openxmlformats-officedocument.presentationml.slide', &nbsp;</div></li><li><div>          'docx' =&gt; 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', &nbsp;</div></li><li><div>          'dotx' =&gt; 'application/vnd.openxmlformats-officedocument.wordprocessingml.template', &nbsp;</div></li><li><div>          'xlam' =&gt; 'application/vnd.ms-excel.addin.macroEnabled.12', &nbsp;</div></li><li><div>          'xlsb' =&gt; 'application/vnd.ms-excel.sheet.binary.macroEnabled.12', &nbsp;</div></li><li><div>          'class' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'dll' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'dms' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'exe' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'lha' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'lzh' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'psd' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'sea' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'so' =&gt; 'application/octet-stream', &nbsp;</div></li><li><div>          'oda' =&gt; 'application/oda', &nbsp;</div></li><li><div>          'pdf' =&gt; 'application/pdf', &nbsp;</div></li><li><div>          'ai' =&gt; 'application/postscript', &nbsp;</div></li><li><div>          'eps' =&gt; 'application/postscript', &nbsp;</div></li><li><div>          'ps' =&gt; 'application/postscript', &nbsp;</div></li><li><div>          'smi' =&gt; 'application/smil', &nbsp;</div></li><li><div>          'smil' =&gt; 'application/smil', &nbsp;</div></li><li><div>          'mif' =&gt; 'application/vnd.mif', &nbsp;</div></li><li><div>          'xls' =&gt; 'application/vnd.ms-excel', &nbsp;</div></li><li><div>          'ppt' =&gt; 'application/vnd.ms-powerpoint', &nbsp;</div></li><li><div>          'wbxml' =&gt; 'application/vnd.wap.wbxml', &nbsp;</div></li><li><div>          'wmlc' =&gt; 'application/vnd.wap.wmlc', &nbsp;</div></li><li><div>          'dcr' =&gt; 'application/x-director', &nbsp;</div></li><li><div>          'dir' =&gt; 'application/x-director', &nbsp;</div></li><li><div>          'dxr' =&gt; 'application/x-director', &nbsp;</div></li><li><div>          'dvi' =&gt; 'application/x-dvi', &nbsp;</div></li><li><div>          'gtar' =&gt; 'application/x-gtar', &nbsp;</div></li><li><div>          'php3' =&gt; 'application/x-httpd-php', &nbsp;</div></li><li><div>          'php4' =&gt; 'application/x-httpd-php', &nbsp;</div></li><li><div>          'php' =&gt; 'application/x-httpd-php', &nbsp;</div></li><li><div>          'phtml' =&gt; 'application/x-httpd-php', &nbsp;</div></li><li><div>          'phps' =&gt; 'application/x-httpd-php-source', &nbsp;</div></li><li><div>          'swf' =&gt; 'application/x-shockwave-flash', &nbsp;</div></li><li><div>          'sit' =&gt; 'application/x-stuffit', &nbsp;</div></li><li><div>          'tar' =&gt; 'application/x-tar', &nbsp;</div></li><li><div>          'tgz' =&gt; 'application/x-tar', &nbsp;</div></li><li><div>          'xht' =&gt; 'application/xhtml+xml', &nbsp;</div></li><li><div>          'xhtml' =&gt; 'application/xhtml+xml', &nbsp;</div></li><li><div>          'zip' =&gt; 'application/zip', &nbsp;</div></li><li><div>          'mid' =&gt; 'audio/midi', &nbsp;</div></li><li><div>          'midi' =&gt; 'audio/midi', &nbsp;</div></li><li><div>          'mp2' =&gt; 'audio/mpeg', &nbsp;</div></li><li><div>          'mp3' =&gt; 'audio/mpeg', &nbsp;</div></li><li><div>          'mpga' =&gt; 'audio/mpeg', &nbsp;</div></li><li><div>          'aif' =&gt; 'audio/x-aiff', &nbsp;</div></li><li><div>          'aifc' =&gt; 'audio/x-aiff', &nbsp;</div></li><li><div>          'aiff' =&gt; 'audio/x-aiff', &nbsp;</div></li><li><div>          'ram' =&gt; 'audio/x-pn-realaudio', &nbsp;</div></li><li><div>          'rm' =&gt; 'audio/x-pn-realaudio', &nbsp;</div></li><li><div>          'rpm' =&gt; 'audio/x-pn-realaudio-plugin', &nbsp;</div></li><li><div>          'ra' =&gt; 'audio/x-realaudio', &nbsp;</div></li><li><div>          'wav' =&gt; 'audio/x-wav', &nbsp;</div></li><li><div>          'bmp' =&gt; 'image/bmp', &nbsp;</div></li><li><div>          'gif' =&gt; 'image/gif', &nbsp;</div></li><li><div>          'jpeg' =&gt; 'image/jpeg', &nbsp;</div></li><li><div>          'jpe' =&gt; 'image/jpeg', &nbsp;</div></li><li><div>          'jpg' =&gt; 'image/jpeg', &nbsp;</div></li><li><div>          'png' =&gt; 'image/png', &nbsp;</div></li><li><div>          'tiff' =&gt; 'image/tiff', &nbsp;</div></li><li><div>          'tif' =&gt; 'image/tiff', &nbsp;</div></li><li><div>          'eml' =&gt; 'message/rfc822', &nbsp;</div></li><li><div>          'css' =&gt; 'text/css', &nbsp;</div></li><li><div>          'html' =&gt; 'text/html', &nbsp;</div></li><li><div>          'htm' =&gt; 'text/html', &nbsp;</div></li><li><div>          'shtml' =&gt; 'text/html', &nbsp;</div></li><li><div>          'log' =&gt; 'text/plain', &nbsp;</div></li><li><div>          'text' =&gt; 'text/plain', &nbsp;</div></li><li><div>          'txt' =&gt; 'text/plain', &nbsp;</div></li><li><div>          'rtx' =&gt; 'text/richtext', &nbsp;</div></li><li><div>          'rtf' =&gt; 'text/rtf', &nbsp;</div></li><li><div>          'vcf' =&gt; 'text/vcard', &nbsp;</div></li><li><div>          'vcard' =&gt; 'text/vcard', &nbsp;</div></li><li><div>          'xml' =&gt; 'text/xml', &nbsp;</div></li><li><div>          'xsl' =&gt; 'text/xml', &nbsp;</div></li><li><div>          'mpeg' =&gt; 'video/mpeg', &nbsp;</div></li><li><div>          'mpe' =&gt; 'video/mpeg', &nbsp;</div></li><li><div>          'mpg' =&gt; 'video/mpeg', &nbsp;</div></li><li><div>          'mov' =&gt; 'video/quicktime', &nbsp;</div></li><li><div>          'qt' =&gt; 'video/quicktime', &nbsp;</div></li><li><div>          'rv' =&gt; 'video/vnd.rn-realvideo', &nbsp;</div></li><li><div>          'avi' =&gt; 'video/x-msvideo', &nbsp;</div></li><li><div>          'movie' =&gt; 'video/x-sgi-movie'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      if (array_key_exists(strtolower($ext), $mimes)) {&nbsp;</div></li><li><div>          return $mimes[strtolower($ext)];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return 'application/octet-stream';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Map a file name to a MIME type.</span>&nbsp;</div></li><li><div><span class="comment">   * Defaults to 'application/octet-stream', i.e.. arbitrary binary data.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $filename A file name or full path, does not need to exist as a file</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function filenameToType($filename)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// In case the path is a URL, strip any query string before getting extension</span>&nbsp;</div></li><li><div>      $qpos = strpos($filename, '?');&nbsp;</div></li><li><div>      if (false !== $qpos) {&nbsp;</div></li><li><div>          $filename = substr($filename, 0, $qpos);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $pathinfo = self::mb_pathinfo($filename);&nbsp;</div></li><li><div>      return self::_mime_types($pathinfo['extension']);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Multi-byte-safe pathinfo replacement.</span>&nbsp;</div></li><li><div><span class="comment">   * Drop-in replacement for pathinfo(), but multibyte-safe, cross-platform-safe, old-version-safe.</span>&nbsp;</div></li><li><div><span class="comment">   * Works similarly to the one in PHP &gt;= 5.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://www.php.net/manual/en/function.pathinfo.php#107461</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $path A filename or path, does not need to exist as a file</span>&nbsp;</div></li><li><div><span class="comment">   * @param integer|string $options Either a PATHINFO_* constant, </span>&nbsp;</div></li><li><div><span class="comment">   *      or a string name to return only the specified piece, allows 'filename' to work on PHP &lt; 5.2</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|array</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function mb_pathinfo($path, $options = null)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $ret = array('dirname' =&gt; '', 'basename' =&gt; '', 'extension' =&gt; '', 'filename' =&gt; '');&nbsp;</div></li><li><div>      $pathinfo = array();&nbsp;</div></li><li><div>      if (preg_match('%^(.*?)[\\\\/]*(([^/\\\\]*?)(\.([^\.\\\\/]+?)|))[\\\\/\.]*$%im', $path, $pathinfo)) {&nbsp;</div></li><li><div>          if (array_key_exists(1, $pathinfo)) {&nbsp;</div></li><li><div>              $ret['dirname'] = $pathinfo[1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (array_key_exists(2, $pathinfo)) {&nbsp;</div></li><li><div>              $ret['basename'] = $pathinfo[2];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (array_key_exists(5, $pathinfo)) {&nbsp;</div></li><li><div>              $ret['extension'] = $pathinfo[5];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (array_key_exists(3, $pathinfo)) {&nbsp;</div></li><li><div>              $ret['filename'] = $pathinfo[3];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      switch ($options) {&nbsp;</div></li><li><div>          case PATHINFO_DIRNAME:&nbsp;</div></li><li><div>          case 'dirname':&nbsp;</div></li><li><div>              return $ret['dirname'];&nbsp;</div></li><li><div>          case PATHINFO_BASENAME:&nbsp;</div></li><li><div>          case 'basename':&nbsp;</div></li><li><div>              return $ret['basename'];&nbsp;</div></li><li><div>          case PATHINFO_EXTENSION:&nbsp;</div></li><li><div>          case 'extension':&nbsp;</div></li><li><div>              return $ret['extension'];&nbsp;</div></li><li><div>          case PATHINFO_FILENAME:&nbsp;</div></li><li><div>          case 'filename':&nbsp;</div></li><li><div>              return $ret['filename'];&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              return $ret;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set or reset instance properties.</span>&nbsp;</div></li><li><div><span class="comment">   * You should avoid this function - it's more verbose, less efficient, more error-prone and</span>&nbsp;</div></li><li><div><span class="comment">   * harder to debug than setting properties directly.</span>&nbsp;</div></li><li><div><span class="comment">   * Usage Example:</span>&nbsp;</div></li><li><div><span class="comment">   * `$mail-&gt;set('SMTPSecure', 'tls');`</span>&nbsp;</div></li><li><div><span class="comment">   *   is the same as:</span>&nbsp;</div></li><li><div><span class="comment">   * `$mail-&gt;SMTPSecure = 'tls';`</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name The property name to set</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $value The value to set the property to</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   * @TODO Should this not be using the __set() magic function?</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function set($name, $value = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (property_exists($this, $name)) {&nbsp;</div></li><li><div>          $this-&gt;$name = $value;&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;setError($this-&gt;lang('variable_set') . $name);&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Strip newlines to prevent header injection.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function secureHeader($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return trim(str_replace(array(&quot;\r&quot;, &quot;\n&quot;), '', $str));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Normalize line breaks in a string.</span>&nbsp;</div></li><li><div><span class="comment">   * Converts UNIX LF, Mac CR and Windows CRLF line breaks into a single line break format.</span>&nbsp;</div></li><li><div><span class="comment">   * Defaults to CRLF (for message bodies) and preserves consecutive breaks.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $text</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $breaktype What kind of line break to use, defaults to CRLF</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function normalizeBreaks($text, $breaktype = &quot;\r\n&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return preg_replace('/(\r\n|\r|\n)/ms', $breaktype, $text);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set the public and private key files and password for S/MIME signing.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $cert_filename</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key_filename</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key_pass Password for private key</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $extracerts_filename Optional path to chain certificate</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function sign($cert_filename, $key_filename, $key_pass, $extracerts_filename = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;sign_cert_file = $cert_filename;&nbsp;</div></li><li><div>      $this-&gt;sign_key_file = $key_filename;&nbsp;</div></li><li><div>      $this-&gt;sign_key_pass = $key_pass;&nbsp;</div></li><li><div>      $this-&gt;sign_extracerts_file = $extracerts_filename;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Quoted-Printable-encode a DKIM header.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $txt</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function DKIM_QP($txt)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $line = '';&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; strlen($txt); $i++) {&nbsp;</div></li><li><div>          $ord = ord($txt[$i]);&nbsp;</div></li><li><div>          if (((0x21 &lt;= $ord) && ($ord &lt;= 0x3A)) || $ord == 0x3C || ((0x3E &lt;= $ord) && ($ord &lt;= 0x7E))) {&nbsp;</div></li><li><div>              $line .= $txt[$i];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $line .= '=' . sprintf('%02X', $ord);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $line;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generate a DKIM signature.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $signHeader</span>&nbsp;</div></li><li><div><span class="comment">   * @throws phpmailerException</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The DKIM signature value</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function DKIM_Sign($signHeader)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!defined('PKCS7_TEXT')) {&nbsp;</div></li><li><div>          if ($this-&gt;exceptions) {&nbsp;</div></li><li><div>              throw new phpmailerException($this-&gt;lang('extension_missing') . 'openssl');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $privKeyStr = !empty($this-&gt;DKIM_private_string) ? $this-&gt;DKIM_private_string : file_get_contents($this-&gt;DKIM_private);&nbsp;</div></li><li><div>      if ('' != $this-&gt;DKIM_passphrase) {&nbsp;</div></li><li><div>          $privKey = openssl_pkey_get_private($privKeyStr, $this-&gt;DKIM_passphrase);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $privKey = openssl_pkey_get_private($privKeyStr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Workaround for missing digest algorithms in old PHP & OpenSSL versions</span>&nbsp;</div></li><li><div>      <span class="comment">//@link http://stackoverflow.com/a/11117338/333340</span>&nbsp;</div></li><li><div>      if (version_compare(PHP_VERSION, '5.3.0') &gt;= 0 and&nbsp;</div></li><li><div>          in_array('sha256WithRSAEncryption', openssl_get_md_methods(true))) {&nbsp;</div></li><li><div>          if (openssl_sign($signHeader, $signature, $privKey, 'sha256WithRSAEncryption')) {&nbsp;</div></li><li><div>              openssl_pkey_free($privKey);&nbsp;</div></li><li><div>              return base64_encode($signature);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $pinfo = openssl_pkey_get_details($privKey);&nbsp;</div></li><li><div>          $hash = hash('sha256', $signHeader);&nbsp;</div></li><li><div>          <span class="comment">//'Magic' constant for SHA256 from RFC3447</span>&nbsp;</div></li><li><div>          <span class="comment">//@link https://tools.ietf.org/html/rfc3447#page-43</span>&nbsp;</div></li><li><div>          $t = '3031300d060960864801650304020105000420' . $hash;&nbsp;</div></li><li><div>          $pslen = $pinfo['bits'] / 8 - (strlen($t) / 2 + 3);&nbsp;</div></li><li><div>          $eb = pack('H*', '0001' . str_repeat('FF', $pslen) . '00' . $t);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (openssl_private_encrypt($eb, $signature, $privKey, OPENSSL_NO_PADDING)) {&nbsp;</div></li><li><div>              openssl_pkey_free($privKey);&nbsp;</div></li><li><div>              return base64_encode($signature);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      openssl_pkey_free($privKey);&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generate a DKIM canonicalization header.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $signHeader Header</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function DKIM_HeaderC($signHeader)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $signHeader = preg_replace('/\r\n\s+/', ' ', $signHeader);&nbsp;</div></li><li><div>      $lines = explode(&quot;\r\n&quot;, $signHeader);&nbsp;</div></li><li><div>      foreach ($lines as $key =&gt; $line) {&nbsp;</div></li><li><div>          list($heading, $value) = explode(':', $line, 2);&nbsp;</div></li><li><div>          $heading = strtolower($heading);&nbsp;</div></li><li><div>          $value = preg_replace('/\s{2, }/', ' ', $value); <span class="comment">// Compress useless spaces</span>&nbsp;</div></li><li><div>          $lines[$key] = $heading . ':' . trim($value); <span class="comment">// Don't forget to remove WSP around the value</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $signHeader = implode(&quot;\r\n&quot;, $lines);&nbsp;</div></li><li><div>      return $signHeader;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generate a DKIM canonicalization body.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $body Message Body</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function DKIM_BodyC($body)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($body == '') {&nbsp;</div></li><li><div>          return &quot;\r\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// stabilize line endings</span>&nbsp;</div></li><li><div>      $body = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $body);&nbsp;</div></li><li><div>      $body = str_replace(&quot;\n&quot;, &quot;\r\n&quot;, $body);&nbsp;</div></li><li><div>      <span class="comment">// END stabilize line endings</span>&nbsp;</div></li><li><div>      while (substr($body, strlen($body) - 4, 4) == &quot;\r\n\r\n&quot;) {&nbsp;</div></li><li><div>          $body = substr($body, 0, strlen($body) - 2);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $body;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Create the DKIM header and body in a new message header.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $headers_line Header lines</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $subject Subject</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $body Body</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function DKIM_Add($headers_line, $subject, $body)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $DKIMsignatureType = 'rsa-sha256'; <span class="comment">// Signature & hash algorithms</span>&nbsp;</div></li><li><div>      $DKIMcanonicalization = 'relaxed/simple'; <span class="comment">// Canonicalization of header/body</span>&nbsp;</div></li><li><div>      $DKIMquery = 'dns/txt'; <span class="comment">// Query method</span>&nbsp;</div></li><li><div>      $DKIMtime = time(); <span class="comment">// Signature Timestamp = seconds since 00:00:00 - Jan 1, 1970 (UTC time zone)</span>&nbsp;</div></li><li><div>      $subject_header = &quot;Subject: $subject&quot;;&nbsp;</div></li><li><div>      $headers = explode($this-&gt;LE, $headers_line);&nbsp;</div></li><li><div>      $from_header = '';&nbsp;</div></li><li><div>      $to_header = '';&nbsp;</div></li><li><div>      $date_header = '';&nbsp;</div></li><li><div>      $current = '';&nbsp;</div></li><li><div>      foreach ($headers as $header) {&nbsp;</div></li><li><div>          if (strpos($header, 'From:') === 0) {&nbsp;</div></li><li><div>              $from_header = $header;&nbsp;</div></li><li><div>              $current = 'from_header';&nbsp;</div></li><li><div>          } elseif (strpos($header, 'To:') === 0) {&nbsp;</div></li><li><div>              $to_header = $header;&nbsp;</div></li><li><div>              $current = 'to_header';&nbsp;</div></li><li><div>          } elseif (strpos($header, 'Date:') === 0) {&nbsp;</div></li><li><div>              $date_header = $header;&nbsp;</div></li><li><div>              $current = 'date_header';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if (!empty($$current) && strpos($header, ' =?') === 0) {&nbsp;</div></li><li><div>                  $$current .= $header;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $current = '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $from = str_replace('|', '=7C', $this-&gt;DKIM_QP($from_header));&nbsp;</div></li><li><div>      $to = str_replace('|', '=7C', $this-&gt;DKIM_QP($to_header));&nbsp;</div></li><li><div>      $date = str_replace('|', '=7C', $this-&gt;DKIM_QP($date_header));&nbsp;</div></li><li><div>      $subject = str_replace(&nbsp;</div></li><li><div>          '|', &nbsp;</div></li><li><div>          '=7C', &nbsp;</div></li><li><div>          $this-&gt;DKIM_QP($subject_header)&nbsp;</div></li><li><div> ); <span class="comment">// Copied header fields (dkim-quoted-printable)</span>&nbsp;</div></li><li><div>      $body = $this-&gt;DKIM_BodyC($body);&nbsp;</div></li><li><div>      $DKIMlen = strlen($body); <span class="comment">// Length of body</span>&nbsp;</div></li><li><div>      $DKIMb64 = base64_encode(pack('H*', hash('sha256', $body))); <span class="comment">// Base64 of packed binary SHA-256 hash of body</span>&nbsp;</div></li><li><div>      if ('' == $this-&gt;DKIM_identity) {&nbsp;</div></li><li><div>          $ident = '';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $ident = ' i=' . $this-&gt;DKIM_identity . ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $dkimhdrs = 'DKIM-Signature: v=1; a=' .&nbsp;</div></li><li><div>          $DKIMsignatureType . '; q=' .&nbsp;</div></li><li><div>          $DKIMquery . '; l=' .&nbsp;</div></li><li><div>          $DKIMlen . '; s=' .&nbsp;</div></li><li><div>          $this-&gt;DKIM_selector .&nbsp;</div></li><li><div>          &quot;;\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\tt=&quot; . $DKIMtime . '; c=' . $DKIMcanonicalization . &quot;;\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\th=From:To:Date:Subject;\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\td=&quot; . $this-&gt;DKIM_domain . ';' . $ident . &quot;\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\tz=$from\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\t|$to\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\t|$date\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\t|$subject;\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\tbh=&quot; . $DKIMb64 . &quot;;\r\n&quot; .&nbsp;</div></li><li><div>          &quot;\tb=&quot;;&nbsp;</div></li><li><div>      $toSign = $this-&gt;DKIM_HeaderC(&nbsp;</div></li><li><div>          $from_header . &quot;\r\n&quot; .&nbsp;</div></li><li><div>          $to_header . &quot;\r\n&quot; .&nbsp;</div></li><li><div>          $date_header . &quot;\r\n&quot; .&nbsp;</div></li><li><div>          $subject_header . &quot;\r\n&quot; .&nbsp;</div></li><li><div>          $dkimhdrs&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $signed = $this-&gt;DKIM_Sign($toSign);&nbsp;</div></li><li><div>      return $dkimhdrs . $signed . &quot;\r\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Detect if a string contains a line longer than the maximum line length allowed.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function hasLineLongerThanMax($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//+2 to include CRLF line break for a 1000 total</span>&nbsp;</div></li><li><div>      return (boolean)preg_match('/^(.{'.(self::MAX_LINE_LENGTH + 2).', })/m', $str);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Allows for public read access to 'to' property.</span>&nbsp;</div></li><li><div><span class="comment">   * @note: Before the send() call, queued addresses (i.e. with IDN) are not yet included.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getToAddresses()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;to;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Allows for public read access to 'cc' property.</span>&nbsp;</div></li><li><div><span class="comment">   * @note: Before the send() call, queued addresses (i.e. with IDN) are not yet included.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getCcAddresses()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;cc;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Allows for public read access to 'bcc' property.</span>&nbsp;</div></li><li><div><span class="comment">   * @note: Before the send() call, queued addresses (i.e. with IDN) are not yet included.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getBccAddresses()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;bcc;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Allows for public read access to 'ReplyTo' property.</span>&nbsp;</div></li><li><div><span class="comment">   * @note: Before the send() call, queued addresses (i.e. with IDN) are not yet included.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getReplyToAddresses()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;ReplyTo;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Allows for public read access to 'all_recipients' property.</span>&nbsp;</div></li><li><div><span class="comment">   * @note: Before the send() call, queued addresses (i.e. with IDN) are not yet included.</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function getAllRecipientAddresses()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;all_recipients;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Perform a callback.</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $isSent</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $to</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $cc</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $bcc</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $subject</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $body</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $from</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function doCallback($isSent, $to, $cc, $bcc, $subject, $body, $from)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!empty($this-&gt;action_function) && is_callable($this-&gt;action_function)) {&nbsp;</div></li><li><div>          $params = array($isSent, $to, $cc, $bcc, $subject, $body, $from);&nbsp;</div></li><li><div>          call_user_func_array($this-&gt;action_function, $params);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * PHPMailer exception handler</span>&nbsp;</div></li><li><div><span class="comment"> * @package PHPMailer</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class phpmailerException extends Exception&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Prettify error message output</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function errorMessage()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $errorMsg = '&lt;strong&gt;' . $this-&gt;getMessage() . &quot;&lt;/strong&gt;&lt;br /&gt;\n&quot;;&nbsp;</div></li><li><div>      return $errorMsg;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>