<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.4" data-type="file" data-id="5006"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-signup | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=1a7046b79180252a456205dbb7b3176b' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-signup/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-signup%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-signup%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-file-wp-signup","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-signup" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-signup</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-signup.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Sets up the WordPress Environment. */</span>&nbsp;</div></li><li><div>require( dirname(__FILE__) . '/wp-load.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_head', 'wp_no_robots' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>require( dirname( __FILE__ ) . '/wp-blog-header.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( is_array( get_site_option( 'illegal_names' )) && isset( $_GET[ 'new' ] ) && in_array( $_GET[ 'new' ], get_site_option( 'illegal_names' ) ) ) {&nbsp;</div></li><li><div>  wp_redirect( network_home_url() );&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Prints signup_header via wp_head</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function do_signup_header() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires within the head section of the site sign-up screen.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'signup_header' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'wp_head', 'do_signup_header' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !is_multisite() ) {&nbsp;</div></li><li><div>  wp_redirect( wp_registration_url() );&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !is_main_site() ) {&nbsp;</div></li><li><div>  wp_redirect( network_site_url( 'wp-signup.php' ) );&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Fix for page title</span>&nbsp;</div></li><li><div>$wp_query-&gt;is_404 = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fires before the Site Signup page is loaded.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>do_action( 'before_signup_header' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Prints styles for front-end Multisite signup pages</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wpmu_signup_stylesheet() {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;style type=&quot;text/css&quot;&gt;&nbsp;</div></li><li><div>      .mu_register { width: 90%; margin:0 auto; }&nbsp;</div></li><li><div>      .mu_register form { margin-top: 2em; }&nbsp;</div></li><li><div>      .mu_register .error { font-weight:700; padding:10px; color:#333333; background:#FFEBE8; border:1px solid #CC0000; }&nbsp;</div></li><li><div>      .mu_register input[type=&quot;submit&quot;], &nbsp;</div></li><li><div>          .mu_register #blog_title, &nbsp;</div></li><li><div>          .mu_register #user_email, &nbsp;</div></li><li><div>          .mu_register #blogname, &nbsp;</div></li><li><div>          .mu_register #user_name { width:100%; font-size: 24px; margin:5px 0; }&nbsp;</div></li><li><div>      .mu_register #site-language { display: block; }&nbsp;</div></li><li><div>      .mu_register .prefix_address, &nbsp;</div></li><li><div>          .mu_register .suffix_address {font-size: 18px;display:inline; }&nbsp;</div></li><li><div>      .mu_register label { font-weight:700; font-size:15px; display:block; margin:10px 0; }&nbsp;</div></li><li><div>      .mu_register label.checkbox { display:inline; }&nbsp;</div></li><li><div>      .mu_register .mu_alert { font-weight:700; padding:10px; color:#333333; background:#ffffe0; border:1px solid #e6db55; }&nbsp;</div></li><li><div>  &lt;/style&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_head', 'wpmu_signup_stylesheet' );&nbsp;</div></li><li><div>get_header( 'wp-signup' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fires before the site sign-up form.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>do_action( 'before_signup_form' );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;div id=&quot;signup-content&quot; class=&quot;widecolumn&quot;&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;mu_register wp-signup-container&quot;&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Generates and displays the Signup and Create Site forms</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $blogname   The new site name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $blog_title The new site title.</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Error|string $errors     A WP_Error object containing existing errors. Defaults to empty string.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function show_blog_form( $blogname = '', $blog_title = '', $errors = '' ) {&nbsp;</div></li><li><div>  if ( ! is_wp_error( $errors ) ) {&nbsp;</div></li><li><div>      $errors = new WP_Error();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_network = get_network();&nbsp;</div></li><li><div>  <span class="comment">// Blog name</span>&nbsp;</div></li><li><div>  if ( !is_subdomain_install() )&nbsp;</div></li><li><div>      echo '&lt;label for=&quot;blogname&quot;&gt;' . __('Site Name:') . '&lt;/label&gt;';&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      echo '&lt;label for=&quot;blogname&quot;&gt;' . __('Site Domain:') . '&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $errmsg = $errors-&gt;get_error_message('blogname') ) { ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;error&quot;&gt;&lt;?php echo $errmsg ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_subdomain_install() )&nbsp;</div></li><li><div>      echo '&lt;span class=&quot;prefix_address&quot;&gt;' . $current_network-&gt;domain . $current_network-&gt;path . '&lt;/span&gt;&lt;input name=&quot;blogname&quot; type=&quot;text&quot; id=&quot;blogname&quot; value=&quot;'. esc_attr($blogname) .'&quot; maxlength=&quot;60&quot; /&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      echo '&lt;input name=&quot;blogname&quot; type=&quot;text&quot; id=&quot;blogname&quot; value=&quot;'.esc_attr($blogname).'&quot; maxlength=&quot;60&quot; /&gt;&lt;span class=&quot;suffix_address&quot;&gt;.' . ( $site_domain = preg_replace( '|^www\.|', '', $current_network-&gt;domain ) ) . '&lt;/span&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_user_logged_in() ) {&nbsp;</div></li><li><div>      if ( ! is_subdomain_install() ) {&nbsp;</div></li><li><div>          $site = $current_network-&gt;domain . $current_network-&gt;path . __( 'sitename' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $site = __( 'domain' ) . '.' . $site_domain . $current_network-&gt;path;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: site address */</span></span></span></span>&nbsp;</div></li><li><div>      echo '&lt;p&gt;(&lt;strong&gt;' . sprintf( __( 'Your address will be %s.' ), $site ) . '&lt;/strong&gt;) ' . __( 'Must be at least 4 characters, letters and numbers only. It cannot be changed, so choose carefully!' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Blog Title</span>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;label for=&quot;blog_title&quot;&gt;&lt;?php _e('Site Title:') ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>  &lt;?php if ( $errmsg = $errors-&gt;get_error_message('blog_title') ) { ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;error&quot;&gt;&lt;?php echo $errmsg ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php }&nbsp;</div></li><li><div>  echo '&lt;input name=&quot;blog_title&quot; type=&quot;text&quot; id=&quot;blog_title&quot; value=&quot;'.esc_attr($blog_title).'&quot; /&gt;';&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  <span class="comment">// Site Language.</span>&nbsp;</div></li><li><div>  $languages = signup_get_available_languages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $languages ) ) :&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;site-language&quot;&gt;&lt;?php _e( 'Site Language:' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          <span class="comment">// Network default.</span>&nbsp;</div></li><li><div>          $lang = get_site_option( 'WPLANG' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['WPLANG'] ) ) {&nbsp;</div></li><li><div>              $lang = $_POST['WPLANG'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Use US English if the default isn't available.</span>&nbsp;</div></li><li><div>          if ( ! in_array( $lang, $languages ) ) {&nbsp;</div></li><li><div>              $lang = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_dropdown_languages( array(&nbsp;</div></li><li><div>              'name' =&gt; 'WPLANG', &nbsp;</div></li><li><div>              'id' =&gt; 'site-language', &nbsp;</div></li><li><div>              'selected' =&gt; $lang, &nbsp;</div></li><li><div>              'languages' =&gt; $languages, &nbsp;</div></li><li><div>              'show_available_translations' =&gt; false, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php endif; <span class="comment">// Languages. ?&gt;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div id=&quot;privacy&quot;&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;privacy-intro&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;blog_public_on&quot;&gt;&lt;?php _e('Privacy:') ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;?php _e( 'Allow search engines to index this site.' ); ?&gt;&nbsp;</div></li><li><div>          &lt;br style=&quot;clear:both&quot; /&gt;&nbsp;</div></li><li><div>          &lt;label class=&quot;checkbox&quot; for=&quot;blog_public_on&quot;&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;radio&quot; id=&quot;blog_public_on&quot; name=&quot;blog_public&quot; value=&quot;1&quot; &lt;?php if ( !isset( $_POST['blog_public'] ) || $_POST['blog_public'] == '1' ) { ?&gt;checked=&quot;checked&quot;&lt;?php } ?&gt; /&gt;&nbsp;</div></li><li><div>              &lt;strong&gt;&lt;?php _e( 'Yes' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;label class=&quot;checkbox&quot; for=&quot;blog_public_off&quot;&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;radio&quot; id=&quot;blog_public_off&quot; name=&quot;blog_public&quot; value=&quot;0&quot; &lt;?php if ( isset( $_POST['blog_public'] ) && $_POST['blog_public'] == '0' ) { ?&gt;checked=&quot;checked&quot;&lt;?php } ?&gt; /&gt;&nbsp;</div></li><li><div>              &lt;strong&gt;&lt;?php _e( 'No' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the site sign-up form.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Error $errors A WP_Error object possibly containing 'blogname' or 'blog_title' errors.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'signup_blogform', $errors );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Validate the new site signup</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Contains the new site data and error messages.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function validate_blog_form() {&nbsp;</div></li><li><div>  $user = '';&nbsp;</div></li><li><div>  if ( is_user_logged_in() )&nbsp;</div></li><li><div>      $user = wp_get_current_user();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return wpmu_validate_blog_signup($_POST['blogname'], $_POST['blog_title'], $user);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display user registration form</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $user_name  The entered username.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $user_email The entered email address.</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Error|string $errors     A WP_Error object containing existing errors. Defaults to empty string.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function show_user_form($user_name = '', $user_email = '', $errors = '') {&nbsp;</div></li><li><div>  if ( ! is_wp_error( $errors ) ) {&nbsp;</div></li><li><div>      $errors = new WP_Error();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// User name</span>&nbsp;</div></li><li><div>  echo '&lt;label for=&quot;user_name&quot;&gt;' . __('Username:') . '&lt;/label&gt;';&nbsp;</div></li><li><div>  if ( $errmsg = $errors-&gt;get_error_message('user_name') ) {&nbsp;</div></li><li><div>      echo '&lt;p class=&quot;error&quot;&gt;'.$errmsg.'&lt;/p&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo '&lt;input name=&quot;user_name&quot; type=&quot;text&quot; id=&quot;user_name&quot; value=&quot;'. esc_attr( $user_name ) .'&quot; autocapitalize=&quot;none&quot; autocorrect=&quot;off&quot; maxlength=&quot;60&quot; /&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>  _e( '(Must be at least 4 characters, letters and numbers only.)' );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;label for=&quot;user_email&quot;&gt;&lt;?php _e( 'Email&nbsp;Address:' ) ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>  &lt;?php if ( $errmsg = $errors-&gt;get_error_message('user_email') ) { ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;error&quot;&gt;&lt;?php echo $errmsg ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php } ?&gt;&nbsp;</div></li><li><div>  &lt;input name=&quot;user_email&quot; type=&quot;email&quot; id=&quot;user_email&quot; value=&quot;&lt;?php  echo esc_attr($user_email) ?&gt;&quot; maxlength=&quot;200&quot; /&gt;&lt;br /&gt;&lt;?php _e('We send your registration email to this address. (Double-check your email address before continuing.)') ?&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  if ( $errmsg = $errors-&gt;get_error_message('generic') ) {&nbsp;</div></li><li><div>      echo '&lt;p class=&quot;error&quot;&gt;' . $errmsg . '&lt;/p&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires at the end of the user registration form on the site sign-up form.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Error $errors A WP_Error object containing containing 'user_name' or 'user_email' errors.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'signup_extra_fields', $errors );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Validate user signup name and email</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Contains username, email, and error messages.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function validate_user_form() {&nbsp;</div></li><li><div>  return wpmu_validate_user_signup($_POST['user_name'], $_POST['user_email']);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Allow returning users to sign up for another site</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $blogname   The new site name</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $blog_title The new site title.</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Error|string $errors     A WP_Error object containing existing errors. Defaults to empty string.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function signup_another_blog( $blogname = '', $blog_title = '', $errors = '' ) {&nbsp;</div></li><li><div>  $current_user = wp_get_current_user();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_wp_error($errors) ) {&nbsp;</div></li><li><div>      $errors = new WP_Error();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $signup_defaults = array(&nbsp;</div></li><li><div>      'blogname' =&gt; $blogname, &nbsp;</div></li><li><div>      'blog_title' =&gt; $blog_title, &nbsp;</div></li><li><div>      'errors' =&gt; $errors&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default site sign-up variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $signup_defaults {</span>&nbsp;</div></li><li><div><span class="comment">   *     An array of default site sign-up variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $blogname   The site blogname.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $blog_title The site title.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type WP_Error $errors     A WP_Error object possibly containing 'blogname' or 'blog_title' errors.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $filtered_results = apply_filters( 'signup_another_blog_init', $signup_defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $blogname = $filtered_results['blogname'];&nbsp;</div></li><li><div>  $blog_title = $filtered_results['blog_title'];&nbsp;</div></li><li><div>  $errors = $filtered_results['errors'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;h2&gt;' . sprintf( __( 'Get &lt;em&gt;another&lt;/em&gt; %s site in seconds' ), get_network()-&gt;site_name ) . '&lt;/h2&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $errors-&gt;get_error_code() ) {&nbsp;</div></li><li><div>      echo '&lt;p&gt;' . __( 'There was a problem, please correct the form below and try again.' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php printf( __( 'Welcome back, %s. By filling out the form below, you can &lt;strong&gt;add another site to your account&lt;/strong&gt;. There is no limit to the number of sites you can have, so create to your heart&#8217;s content, but write responsibly!' ), $current_user-&gt;display_name ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  $blogs = get_blogs_of_user($current_user-&gt;ID);&nbsp;</div></li><li><div>  if ( !empty($blogs) ) { ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;p&gt;&lt;?php _e( 'Sites you are already a member of:' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>          &lt;ul&gt;&nbsp;</div></li><li><div>              &lt;?php foreach ( $blogs as $blog ) {&nbsp;</div></li><li><div>                  $home_url = get_home_url( $blog-&gt;userblog_id );&nbsp;</div></li><li><div>                  echo '&lt;li&gt;&lt;a href=&quot;' . esc_url( $home_url ) . '&quot;&gt;' . $home_url . '&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>              } ?&gt;&nbsp;</div></li><li><div>          &lt;/ul&gt;&nbsp;</div></li><li><div>  &lt;?php } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'If you&#8217;re not going to use a great site domain, leave it for a new user. Now have at it!' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;form id=&quot;setupform&quot; method=&quot;post&quot; action=&quot;wp-signup.php&quot;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;stage&quot; value=&quot;gimmeanotherblog&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Hidden sign-up form fields output when creating another site or user.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since MU</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $context A string describing the steps of the sign-up process. The value can be</span>&nbsp;</div></li><li><div><span class="comment">       *                        'create-another-site', 'validate-user', or 'validate-site'.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'signup_hidden_fields', 'create-another-site' );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;?php show_blog_form($blogname, $blog_title, $errors); ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;submit&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; class=&quot;submit&quot; value=&quot;&lt;?php esc_attr_e( 'Create Site' ) ?&gt;&quot; /&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;/form&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Validate a new site signup.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return null|bool True if site signup was validated, false if error.</span>&nbsp;</div></li><li><div><span class="comment"> *                   The function halts all execution if the user is not logged in.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function validate_another_blog_signup() {&nbsp;</div></li><li><div>  global $wpdb, $blogname, $blog_title, $errors, $domain, $path;&nbsp;</div></li><li><div>  $current_user = wp_get_current_user();&nbsp;</div></li><li><div>  if ( ! is_user_logged_in() ) {&nbsp;</div></li><li><div>      die();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = validate_blog_form();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Extracted values set/overwrite globals.</span>&nbsp;</div></li><li><div>  $domain = $result['domain'];&nbsp;</div></li><li><div>  $path = $result['path'];&nbsp;</div></li><li><div>  $blogname = $result['blogname'];&nbsp;</div></li><li><div>  $blog_title = $result['blog_title'];&nbsp;</div></li><li><div>  $errors = $result['errors'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $errors-&gt;get_error_code() ) {&nbsp;</div></li><li><div>      signup_another_blog($blogname, $blog_title, $errors);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $public = (int) $_POST['blog_public'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $blog_meta_defaults = array(&nbsp;</div></li><li><div>      'lang_id' =&gt; 1, &nbsp;</div></li><li><div>      'public' =&gt; $public&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Handle the language setting for the new site.</span></span>&nbsp;</div></li><li><div>  if ( ! empty( $_POST['WPLANG'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $languages = signup_get_available_languages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( $_POST['WPLANG'], $languages ) ) {&nbsp;</div></li><li><div>          $language = wp_unslash( sanitize_text_field( $_POST['WPLANG'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $language ) {&nbsp;</div></li><li><div>              $blog_meta_defaults['WPLANG'] = $language;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the new site meta variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Use the {@see 'add_signup_meta'} filter instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since MU</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated 3.0.0 Use the {@see 'add_signup_meta'} filter instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $blog_meta_defaults An array of default blog meta variables.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $meta_defaults = apply_filters( 'signup_create_blog_meta', $blog_meta_defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the new default site meta variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $meta {</span>&nbsp;</div></li><li><div><span class="comment">   *     An array of default site meta variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int $lang_id     The language ID.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int $blog_public Whether search engines should be discouraged from indexing the site. 1 for true, 0 for false.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $meta = apply_filters( 'add_signup_meta', $meta_defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $blog_id = wpmu_create_blog( $domain, $path, $blog_title, $current_user-&gt;ID, $meta, $wpdb-&gt;siteid );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_wp_error( $blog_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  confirm_another_blog_signup( $domain, $path, $blog_title, $current_user-&gt;user_login, $current_user-&gt;user_email, $meta, $blog_id );&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Confirm a new site signup.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0 Added the `$blog_id` parameter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $domain     The domain URL.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $path       The site root path.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $blog_title The site title.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $user_name  The username.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $user_email The user's email address.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $meta       Any additional meta from the {@see 'add_signup_meta'} filter in validate_blog_signup().</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $blog_id    The site ID.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function confirm_another_blog_signup( $domain, $path, $blog_title, $user_name, $user_email = '', $meta = array(), $blog_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $blog_id ) {&nbsp;</div></li><li><div>      switch_to_blog( $blog_id );&nbsp;</div></li><li><div>      $home_url = home_url( '/' );&nbsp;</div></li><li><div>      $login_url = wp_login_url();&nbsp;</div></li><li><div>      restore_current_blog();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $home_url = 'http:<span class="comment">//' . $domain . $path;</span>&nbsp;</div></li><li><div>      $login_url = 'http:<span class="comment">//' . $domain . $path . 'wp-login.php';</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $site = sprintf( '&lt;a href=&quot;%1$s&quot;&gt;%2$s&lt;/a&gt;', &nbsp;</div></li><li><div>      esc_url( $home_url ), &nbsp;</div></li><li><div>      $blog_title&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;h2&gt;&lt;?php&nbsp;</div></li><li><div>      <span class="comment">/** translators: %s: site name */</span>&nbsp;</div></li><li><div>      printf( __( 'The site %s is yours.' ), $site );&nbsp;</div></li><li><div>  ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;?php printf(&nbsp;</div></li><li><div>          <span class="comment">/** translators: 1: home URL, 2: site address, 3: login URL, 4: username */</span>&nbsp;</div></li><li><div>          __( '&lt;a href=&quot;%1$s&quot;&gt;%2$s&lt;/a&gt; is your new site. &lt;a href=&quot;%3$s&quot;&gt;Log in&lt;/a&gt; as &#8220;%4$s&#8221; using your existing password.' ), &nbsp;</div></li><li><div>          esc_url( $home_url ), &nbsp;</div></li><li><div>          untrailingslashit( $domain . $path ), &nbsp;</div></li><li><div>          esc_url( $login_url ), &nbsp;</div></li><li><div>          $user_name&nbsp;</div></li><li><div> ); ?&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires when the site or user sign-up process is complete.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'signup_finished' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Setup the new user signup process</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $user_name  The username.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $user_email The user's email.</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Error|string $errors     A WP_Error object containing existing errors. Defaults to empty string.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function signup_user( $user_name = '', $user_email = '', $errors = '' ) {&nbsp;</div></li><li><div>  global $active_signup;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_wp_error($errors) )&nbsp;</div></li><li><div>      $errors = new WP_Error();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $signup_for = isset( $_POST[ 'signup_for' ] ) ? esc_html( $_POST[ 'signup_for' ] ) : 'blog';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $signup_user_defaults = array(&nbsp;</div></li><li><div>      'user_name' =&gt; $user_name, &nbsp;</div></li><li><div>      'user_email' =&gt; $user_email, &nbsp;</div></li><li><div>      'errors' =&gt; $errors, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default user variables used on the user sign-up form.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $signup_user_defaults {</span>&nbsp;</div></li><li><div><span class="comment">   *     An array of default user variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $user_name  The user username.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $user_email The user email address.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type WP_Error $errors     A WP_Error object with possible errors relevant to the sign-up user.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $filtered_results = apply_filters( 'signup_user_init', $signup_user_defaults );&nbsp;</div></li><li><div>  $user_name = $filtered_results['user_name'];&nbsp;</div></li><li><div>  $user_email = $filtered_results['user_email'];&nbsp;</div></li><li><div>  $errors = $filtered_results['errors'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;h2&gt;&lt;?php&nbsp;</div></li><li><div>      <span class="comment">/** translators: %s: name of the network */</span>&nbsp;</div></li><li><div>      printf( __( 'Get your own %s account in seconds' ), get_network()-&gt;site_name );&nbsp;</div></li><li><div>  ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>  &lt;form id=&quot;setupform&quot; method=&quot;post&quot; action=&quot;wp-signup.php&quot; novalidate=&quot;novalidate&quot;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;stage&quot; value=&quot;validate-user-signup&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-signup.php */</span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'signup_hidden_fields', 'validate-user' );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;?php show_user_form($user_name, $user_email, $errors); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;p&gt;&nbsp;</div></li><li><div>      &lt;?php if ( $active_signup == 'blog' ) { ?&gt;&nbsp;</div></li><li><div>          &lt;input id=&quot;signupblog&quot; type=&quot;hidden&quot; name=&quot;signup_for&quot; value=&quot;blog&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php } elseif ( $active_signup == 'user' ) { ?&gt;&nbsp;</div></li><li><div>          &lt;input id=&quot;signupblog&quot; type=&quot;hidden&quot; name=&quot;signup_for&quot; value=&quot;user&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php } else { ?&gt;&nbsp;</div></li><li><div>          &lt;input id=&quot;signupblog&quot; type=&quot;radio&quot; name=&quot;signup_for&quot; value=&quot;blog&quot; &lt;?php checked( $signup_for, 'blog' ); ?&gt; /&gt;&nbsp;</div></li><li><div>          &lt;label class=&quot;checkbox&quot; for=&quot;signupblog&quot;&gt;&lt;?php _e('Gimme a site!') ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;br /&gt;&nbsp;</div></li><li><div>          &lt;input id=&quot;signupuser&quot; type=&quot;radio&quot; name=&quot;signup_for&quot; value=&quot;user&quot; &lt;?php checked( $signup_for, 'user' ); ?&gt; /&gt;&nbsp;</div></li><li><div>          &lt;label class=&quot;checkbox&quot; for=&quot;signupuser&quot;&gt;&lt;?php _e('Just a username, please.') ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;?php } ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;p class=&quot;submit&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; class=&quot;submit&quot; value=&quot;&lt;?php esc_attr_e('Next') ?&gt;&quot; /&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;/form&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Validate the new user signup</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if new user signup was validated, false if error</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function validate_user_signup() {&nbsp;</div></li><li><div>  $result = validate_user_form();&nbsp;</div></li><li><div>  $user_name = $result['user_name'];&nbsp;</div></li><li><div>  $user_email = $result['user_email'];&nbsp;</div></li><li><div>  $errors = $result['errors'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $errors-&gt;get_error_code() ) {&nbsp;</div></li><li><div>      signup_user($user_name, $user_email, $errors);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'blog' == $_POST['signup_for'] ) {&nbsp;</div></li><li><div>      signup_blog($user_name, $user_email);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">/** This filter is documented in wp-signup.php */</span></span>&nbsp;</div></li><li><div>  wpmu_signup_user( $user_name, $user_email, apply_filters( 'add_signup_meta', array() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  confirm_user_signup($user_name, $user_email);&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * New user signup confirmation</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $user_name The username</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $user_email The user's email address</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function confirm_user_signup($user_name, $user_email) {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;h2&gt;&lt;?php <span class="comment">/** translators: %s: username */</span>&nbsp;</div></li><li><div>  printf( __( '%s is your new username' ), $user_name) ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'But, before you can start using your new username, &lt;strong&gt;you must activate it&lt;/strong&gt;.' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php <span class="comment"><span class="comment"><span class="comment">/** translators: %s: email address */</span></span></span>&nbsp;</div></li><li><div>  printf( __( 'Check your inbox at %s and click the link given.' ), '&lt;strong&gt;' . $user_email . '&lt;/strong&gt;' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'If you do not activate your username within two days, you will have to sign up again.' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-signup.php */</span></span></span></span>&nbsp;</div></li><li><div>  do_action( 'signup_finished' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Setup the new site signup</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $user_name  The username.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $user_email The user's email address.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $blogname   The site name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string          $blog_title The site title.</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Error|string $errors     A WP_Error object containing existing errors. Defaults to empty string.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function signup_blog($user_name = '', $user_email = '', $blogname = '', $blog_title = '', $errors = '') {&nbsp;</div></li><li><div>  if ( !is_wp_error($errors) )&nbsp;</div></li><li><div>      $errors = new WP_Error();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $signup_blog_defaults = array(&nbsp;</div></li><li><div>      'user_name' =&gt; $user_name, &nbsp;</div></li><li><div>      'user_email' =&gt; $user_email, &nbsp;</div></li><li><div>      'blogname' =&gt; $blogname, &nbsp;</div></li><li><div>      'blog_title' =&gt; $blog_title, &nbsp;</div></li><li><div>      'errors' =&gt; $errors&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the default site creation variables for the site sign-up form.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $signup_blog_defaults {</span>&nbsp;</div></li><li><div><span class="comment">   *     An array of default site creation variables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $user_name  The user username.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $user_email The user email address.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $blogname   The blogname.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string   $blog_title The title of the site.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type WP_Error $errors     A WP_Error object with possible errors relevant to new site creation variables.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $filtered_results = apply_filters( 'signup_blog_init', $signup_blog_defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_name = $filtered_results['user_name'];&nbsp;</div></li><li><div>  $user_email = $filtered_results['user_email'];&nbsp;</div></li><li><div>  $blogname = $filtered_results['blogname'];&nbsp;</div></li><li><div>  $blog_title = $filtered_results['blog_title'];&nbsp;</div></li><li><div>  $errors = $filtered_results['errors'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty($blogname) )&nbsp;</div></li><li><div>      $blogname = $user_name;&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;form id=&quot;setupform&quot; method=&quot;post&quot; action=&quot;wp-signup.php&quot;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;stage&quot; value=&quot;validate-blog-signup&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;user_name&quot; value=&quot;&lt;?php echo esc_attr($user_name) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;user_email&quot; value=&quot;&lt;?php echo esc_attr($user_email) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-signup.php */</span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'signup_hidden_fields', 'validate-site' );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;?php show_blog_form($blogname, $blog_title, $errors); ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;submit&quot;&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; class=&quot;submit&quot; value=&quot;&lt;?php esc_attr_e('Signup') ?&gt;&quot; /&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;/form&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Validate new site signup</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the site signup was validated, false if error</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function validate_blog_signup() {&nbsp;</div></li><li><div>  <span class="comment">// Re-validate user info.</span>&nbsp;</div></li><li><div>  $user_result = wpmu_validate_user_signup( $_POST['user_name'], $_POST['user_email'] );&nbsp;</div></li><li><div>  $user_name = $user_result['user_name'];&nbsp;</div></li><li><div>  $user_email = $user_result['user_email'];&nbsp;</div></li><li><div>  $user_errors = $user_result['errors'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $user_errors-&gt;get_error_code() ) {&nbsp;</div></li><li><div>      signup_user( $user_name, $user_email, $user_errors );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = wpmu_validate_blog_signup( $_POST['blogname'], $_POST['blog_title'] );&nbsp;</div></li><li><div>  $domain = $result['domain'];&nbsp;</div></li><li><div>  $path = $result['path'];&nbsp;</div></li><li><div>  $blogname = $result['blogname'];&nbsp;</div></li><li><div>  $blog_title = $result['blog_title'];&nbsp;</div></li><li><div>  $errors = $result['errors'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $errors-&gt;get_error_code() ) {&nbsp;</div></li><li><div>      signup_blog($user_name, $user_email, $blogname, $blog_title, $errors);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $public = (int) $_POST['blog_public'];&nbsp;</div></li><li><div>  $signup_meta = array ('lang_id' =&gt; 1, 'public' =&gt; $public);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Handle the language setting for the new site.</span></span>&nbsp;</div></li><li><div>  if ( ! empty( $_POST['WPLANG'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $languages = signup_get_available_languages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( $_POST['WPLANG'], $languages ) ) {&nbsp;</div></li><li><div>          $language = wp_unslash( sanitize_text_field( $_POST['WPLANG'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $language ) {&nbsp;</div></li><li><div>              $signup_meta['WPLANG'] = $language;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">/** This filter is documented in wp-signup.php */</span></span>&nbsp;</div></li><li><div>  $meta = apply_filters( 'add_signup_meta', $signup_meta );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wpmu_signup_blog($domain, $path, $blog_title, $user_name, $user_email, $meta);&nbsp;</div></li><li><div>  confirm_blog_signup($domain, $path, $blog_title, $user_name, $user_email, $meta);&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * New site signup confirmation</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since MU</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $domain The domain URL</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $path The site root path</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $blog_title The new site title</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $user_name The user's username</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $user_email The user's email address</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $meta Any additional meta from the {@see 'add_signup_meta'} filter in validate_blog_signup()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function confirm_blog_signup( $domain, $path, $blog_title, $user_name = '', $user_email = '', $meta = array() ) {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;h2&gt;&lt;?php <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: site address */</span></span></span></span>&nbsp;</div></li><li><div>  printf( __( 'Congratulations! Your new site, %s, is almost ready.' ), &quot;&lt;a href='http:<span class="comment">//{$domain}{$path}'&gt;{$blog_title}&lt;/a&gt;&quot; ) ?&gt;&lt;/h2&gt;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'But, before you can start using your site, &lt;strong&gt;you must activate it&lt;/strong&gt;.' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php <span class="comment"><span class="comment"><span class="comment">/** translators: %s: email address */</span></span></span>&nbsp;</div></li><li><div>  printf( __( 'Check your inbox at %s and click the link given.' ), '&lt;strong&gt;' . $user_email . '&lt;/strong&gt;' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'If you do not activate your site within two days, you will have to sign up again.' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;h2&gt;&lt;?php _e( 'Still waiting for your email?' ); ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;?php _e( 'If you haven&#8217;t received your email yet, there are a number of things you can do:' ) ?&gt;&nbsp;</div></li><li><div>      &lt;ul id=&quot;noemail-tips&quot;&gt;&nbsp;</div></li><li><div>          &lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;?php _e( 'Wait a little longer. Sometimes delivery of email can be delayed by processes outside of our control.' ) ?&gt;&lt;/strong&gt;&lt;/p&gt;&lt;/li&gt;&nbsp;</div></li><li><div>          &lt;li&gt;&lt;p&gt;&lt;?php _e( 'Check the junk or spam folder of your email client. Sometime emails wind up there by mistake.' ) ?&gt;&lt;/p&gt;&lt;/li&gt;&nbsp;</div></li><li><div>          &lt;li&gt;&lt;?php&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">/** translators: %s: email address */</span></span></span>&nbsp;</div></li><li><div>              printf( __( 'Have you entered your email correctly? You have entered %s, if it&#8217;s incorrect, you will not receive your email.' ), $user_email );&nbsp;</div></li><li><div>          ?&gt;&lt;/li&gt;&nbsp;</div></li><li><div>      &lt;/ul&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-signup.php */</span></span></span></span>&nbsp;</div></li><li><div>  do_action( 'signup_finished' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves languages available during the site/user signup process.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_available_languages()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array List of available languages.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function signup_get_available_languages() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of available languages for front-end site signups.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Passing an empty array to this hook will disable output of the setting on the</span>&nbsp;</div></li><li><div><span class="comment">   * signup form, and the default language will be used when creating the site.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Languages not already installed will be stripped.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $available_languages Available languages.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $languages = (array) apply_filters( 'signup_get_available_languages', get_available_languages() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Strip any non-installed languages and return.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Re-call get_available_languages() here in case a language pack was installed</span>&nbsp;</div></li><li><div><span class="comment">   * in a callback hooked to the 'signup_get_available_languages' filter before this point.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return array_intersect_assoc( $languages, get_available_languages() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Main</span>&nbsp;</div></li><li><div>$active_signup = get_site_option( 'registration', 'none' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filters the type of site sign-up.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $active_signup String that returns registration type. The value can be</span>&nbsp;</div></li><li><div><span class="comment"> *                              'all', 'none', 'blog', or 'user'.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>$active_signup = apply_filters( 'wpmu_active_signup', $active_signup );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Make the signup type translatable.</span>&nbsp;</div></li><li><div>$i18n_signup['all'] = _x('all', 'Multisite active signup type');&nbsp;</div></li><li><div>$i18n_signup['none'] = _x('none', 'Multisite active signup type');&nbsp;</div></li><li><div>$i18n_signup['blog'] = _x('blog', 'Multisite active signup type');&nbsp;</div></li><li><div>$i18n_signup['user'] = _x('user', 'Multisite active signup type');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( is_super_admin() ) {&nbsp;</div></li><li><div>  <span class="comment">/** translators: 1: type of site sign-up; 2: network settings URL */</span>&nbsp;</div></li><li><div>  echo '&lt;div class=&quot;mu_alert&quot;&gt;' . sprintf( __( 'Greetings Site Administrator! You are currently allowing &#8220;%s&#8221; registrations. To change or disable registration go to your &lt;a href=&quot;%s&quot;&gt;Options page&lt;/a&gt;.' ), $i18n_signup[$active_signup], esc_url( network_admin_url( 'settings.php' ) ) ) . '&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$newblogname = isset($_GET['new']) ? strtolower(preg_replace('/^-|-$|[^-a-zA-Z0-9]/', '', $_GET['new'])) : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$current_user = wp_get_current_user();&nbsp;</div></li><li><div>if ( $active_signup == 'none' ) {&nbsp;</div></li><li><div>  _e( 'Registration has been disabled.' );&nbsp;</div></li><li><div>} elseif ( $active_signup == 'blog' && !is_user_logged_in() ) {&nbsp;</div></li><li><div>  $login_url = wp_login_url( network_site_url( 'wp-signup.php' ) );&nbsp;</div></li><li><div>  <span class="comment">/** translators: %s: login URL */</span>&nbsp;</div></li><li><div>  printf( __( 'You must first &lt;a href=&quot;%s&quot;&gt;log in&lt;/a&gt;, and then you can create a new site.' ), $login_url );&nbsp;</div></li><li><div>} else {&nbsp;</div></li><li><div>  $stage = isset( $_POST['stage'] ) ?  $_POST['stage'] : 'default';&nbsp;</div></li><li><div>  switch ( $stage ) {&nbsp;</div></li><li><div>      case 'validate-user-signup' :&nbsp;</div></li><li><div>          if ( $active_signup == 'all' || $_POST[ 'signup_for' ] == 'blog' && $active_signup == 'blog' || $_POST[ 'signup_for' ] == 'user' && $active_signup == 'user' )&nbsp;</div></li><li><div>              validate_user_signup();&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              _e( 'User registration has been disabled.' );&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>      case 'validate-blog-signup':&nbsp;</div></li><li><div>          if ( $active_signup == 'all' || $active_signup == 'blog' )&nbsp;</div></li><li><div>              validate_blog_signup();&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              _e( 'Site registration has been disabled.' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'gimmeanotherblog':&nbsp;</div></li><li><div>          validate_another_blog_signup();&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'default':&nbsp;</div></li><li><div>      default :&nbsp;</div></li><li><div>          $user_email = isset( $_POST[ 'user_email' ] ) ? $_POST[ 'user_email' ] : '';&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires when the site sign-up form is sent.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'preprocess_signup_form' );&nbsp;</div></li><li><div>          if ( is_user_logged_in() && ( $active_signup == 'all' || $active_signup == 'blog' ) )&nbsp;</div></li><li><div>              signup_another_blog($newblogname);&nbsp;</div></li><li><div>          elseif ( ! is_user_logged_in() && ( $active_signup == 'all' || $active_signup == 'user' ) )&nbsp;</div></li><li><div>              signup_user( $newblogname, $user_email );&nbsp;</div></li><li><div>          elseif ( ! is_user_logged_in() && ( $active_signup == 'blog' ) )&nbsp;</div></li><li><div>              _e( 'Sorry, new registrations are not allowed at this time.' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              _e( 'You are logged in already. No need to register again!' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $newblogname ) {&nbsp;</div></li><li><div>              $newblog = get_blogaddress_by_name( $newblogname );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $active_signup == 'blog' || $active_signup == 'all' )&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: site address */</span></span></span></span>&nbsp;</div></li><li><div>                  printf( '&lt;p&gt;&lt;em&gt;' . __( 'The site you were looking for, %s, does not exist, but you can create it now!' ) . '&lt;/em&gt;&lt;/p&gt;', &nbsp;</div></li><li><div>                      '&lt;strong&gt;' . $newblog . '&lt;/strong&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: %s: site address */</span></span></span></span>&nbsp;</div></li><li><div>                  printf( '&lt;p&gt;&lt;em&gt;' . __( 'The site you were looking for, %s, does not exist.' ) . '&lt;/em&gt;&lt;/p&gt;', &nbsp;</div></li><li><div>                      '&lt;strong&gt;' . $newblog . '&lt;/strong&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fires after the sign-up forms, before wp_footer.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>do_action( 'after_signup_form' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php get_footer( 'wp-signup' );&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-root</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>