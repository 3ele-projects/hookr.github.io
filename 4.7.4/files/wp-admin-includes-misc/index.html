<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.4" data-type="file" data-id="4500"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-admin-includes-misc | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=0268f2a6c680ed241bb989822ea2f7c2' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-admin-includes-misc/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-admin-includes-misc%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-admin-includes-misc%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-file-wp-admin-includes-misc","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-admin-includes-misc" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-admin-includes-misc</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-admin/includes/misc.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Misc WordPress Administration API.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Administration</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns whether the server is running Apache with the mod_rewrite module loaded.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function got_mod_rewrite() {&nbsp;</div></li><li><div>  $got_rewrite = apache_mod_loaded('mod_rewrite', true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether Apache and mod_rewrite are present.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This filter was previously used to force URL rewriting for other servers, </span>&nbsp;</div></li><li><div><span class="comment">   * like nginx. Use the {@see 'got_url_rewrite'} filter in got_url_rewrite() instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see got_url_rewrite()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $got_rewrite Whether Apache and mod_rewrite are present.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'got_rewrite', $got_rewrite );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns whether the server supports URL rewriting.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Detects Apache's mod_rewrite, IIS 7.0+ permalink support, and nginx.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global bool $is_nginx</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether the server supports URL rewriting.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function got_url_rewrite() {&nbsp;</div></li><li><div>  $got_url_rewrite = ( got_mod_rewrite() || $GLOBALS['is_nginx'] || iis7_supports_permalinks() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether URL rewriting is available.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $got_url_rewrite Whether URL rewriting is available.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'got_url_rewrite', $got_url_rewrite );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Extracts strings from between the BEGIN and END markers in the .htaccess file.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $marker</span>&nbsp;</div></li><li><div><span class="comment"> * @return array An array of strings from a file (.htaccess ) from between BEGIN and END markers.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function extract_from_markers( $filename, $marker ) {&nbsp;</div></li><li><div>  $result = array ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!file_exists( $filename ) ) {&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $markerdata = explode( &quot;\n&quot;, implode( '', file( $filename ) ) ));&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $state = false;&nbsp;</div></li><li><div>      foreach ( $markerdata as $markerline ) {&nbsp;</div></li><li><div>          if (strpos($markerline, '# END ' . $marker) !== false)&nbsp;</div></li><li><div>              $state = false;&nbsp;</div></li><li><div>          if ( $state )&nbsp;</div></li><li><div>              $result[] = $markerline;&nbsp;</div></li><li><div>          if (strpos($markerline, '# BEGIN ' . $marker) !== false)&nbsp;</div></li><li><div>              $state = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Inserts an array of strings into a file (.htaccess ), placing it between</span>&nbsp;</div></li><li><div><span class="comment"> * BEGIN and END markers.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Replaces existing marked info. Retains surrounding</span>&nbsp;</div></li><li><div><span class="comment"> * data. Creates file if none exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $filename  Filename to alter.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $marker    The marker to alter.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $insertion The new content to insert.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on write success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function insert_with_markers( $filename, $marker, $insertion ) {&nbsp;</div></li><li><div>  if ( ! file_exists( $filename ) ) {&nbsp;</div></li><li><div>      if ( ! is_writable( dirname( $filename ) ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! touch( $filename ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } elseif ( ! is_writeable( $filename ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $insertion ) ) {&nbsp;</div></li><li><div>      $insertion = explode( &quot;\n&quot;, $insertion );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $start_marker = &quot;# BEGIN {$marker}&quot;;&nbsp;</div></li><li><div>  $end_marker = &quot;# END {$marker}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fp = fopen( $filename, 'r+' );&nbsp;</div></li><li><div>  if ( ! $fp ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Attempt to get a lock. If the filesystem supports locking, this will block until the lock is acquired.</span>&nbsp;</div></li><li><div>  flock( $fp, LOCK_EX );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $lines = array();&nbsp;</div></li><li><div>  while ( ! feof( $fp ) ) {&nbsp;</div></li><li><div>      $lines[] = rtrim( fgets( $fp ), &quot;\r\n&quot; );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Split out the existing file into the preceding lines, and those that appear after the marker</span>&nbsp;</div></li><li><div>  $pre_lines = $post_lines = $existing_lines = array();&nbsp;</div></li><li><div>  $found_marker = $found_end_marker = false;&nbsp;</div></li><li><div>  foreach ( $lines as $line ) {&nbsp;</div></li><li><div>      if ( ! $found_marker && false !== strpos( $line, $start_marker ) ) {&nbsp;</div></li><li><div>          $found_marker = true;&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      } elseif ( ! $found_end_marker && false !== strpos( $line, $end_marker ) ) {&nbsp;</div></li><li><div>          $found_end_marker = true;&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! $found_marker ) {&nbsp;</div></li><li><div>          $pre_lines[] = $line;&nbsp;</div></li><li><div>      } elseif ( $found_marker && $found_end_marker ) {&nbsp;</div></li><li><div>          $post_lines[] = $line;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $existing_lines[] = $line;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check to see if there was a change</span>&nbsp;</div></li><li><div>  if ( $existing_lines === $insertion ) {&nbsp;</div></li><li><div>      flock( $fp, LOCK_UN );&nbsp;</div></li><li><div>      fclose( $fp );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Generate the new file data</span>&nbsp;</div></li><li><div>  $new_file_data = implode( &quot;\n&quot;, array_merge(&nbsp;</div></li><li><div>      $pre_lines, &nbsp;</div></li><li><div>      array( $start_marker ), &nbsp;</div></li><li><div>      $insertion, &nbsp;</div></li><li><div>      array( $end_marker ), &nbsp;</div></li><li><div>      $post_lines&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Write to the start of the file, and truncate it to that length</span>&nbsp;</div></li><li><div>  fseek( $fp, 0 );&nbsp;</div></li><li><div>  $bytes = fwrite( $fp, $new_file_data );&nbsp;</div></li><li><div>  if ( $bytes ) {&nbsp;</div></li><li><div>      ftruncate( $fp, ftell( $fp ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  fflush( $fp );&nbsp;</div></li><li><div>  flock( $fp, LOCK_UN );&nbsp;</div></li><li><div>  fclose( $fp );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (bool) $bytes;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updates the htaccess file with the current rules if it is writable.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Always writes to the file if it exists and is writable to ensure that we</span>&nbsp;</div></li><li><div><span class="comment"> * blank out old rules.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Rewrite $wp_rewrite</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function save_mod_rewrite_rules() {&nbsp;</div></li><li><div>  if ( is_multisite() )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $home_path = get_home_path();&nbsp;</div></li><li><div>  $htaccess_file = $home_path.'.htaccess';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * If the file doesn't already exist check for write access to the directory</span>&nbsp;</div></li><li><div><span class="comment">   * and whether we have some rules. Else check for write access to the file.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ((!file_exists($htaccess_file) && is_writable($home_path) && $wp_rewrite-&gt;using_mod_rewrite_permalinks()) || is_writable($htaccess_file)) {&nbsp;</div></li><li><div>      if ( got_mod_rewrite() ) {&nbsp;</div></li><li><div>          $rules = explode( &quot;\n&quot;, $wp_rewrite-&gt;mod_rewrite_rules() );&nbsp;</div></li><li><div>          return insert_with_markers( $htaccess_file, 'WordPress', $rules );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updates the IIS web.config file with the current rules if it is writable.</span>&nbsp;</div></li><li><div><span class="comment"> * If the permalinks do not require rewrite rules then the rules are deleted from the web.config file.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Rewrite $wp_rewrite</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if web.config was updated successfully</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function iis7_save_url_rewrite_rules() {&nbsp;</div></li><li><div>  if ( is_multisite() )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $home_path = get_home_path();&nbsp;</div></li><li><div>  $web_config_file = $home_path . 'web.config';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Using win_is_writable() instead of is_writable() because of a bug in Windows PHP</span>&nbsp;</div></li><li><div>  if ( iis7_supports_permalinks() && ( ( ! file_exists($web_config_file) && win_is_writable($home_path) && $wp_rewrite-&gt;using_mod_rewrite_permalinks() ) || win_is_writable($web_config_file) ) ) {&nbsp;</div></li><li><div>      $rule = $wp_rewrite-&gt;iis7_url_rewrite_rules(false, '', '');&nbsp;</div></li><li><div>      if ( ! empty($rule) ) {&nbsp;</div></li><li><div>          return iis7_add_rewrite_rule($web_config_file, $rule);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return iis7_delete_rewrite_rule($web_config_file);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update the &quot;recently-edited&quot; file for the plugin or theme editor.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $file</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_recently_edited( $file ) {&nbsp;</div></li><li><div>  $oldfiles = (array ) get_option( 'recently_edited' );&nbsp;</div></li><li><div>  if ( $oldfiles ) {&nbsp;</div></li><li><div>      $oldfiles = array_reverse( $oldfiles );&nbsp;</div></li><li><div>      $oldfiles[] = $file;&nbsp;</div></li><li><div>      $oldfiles = array_reverse( $oldfiles );&nbsp;</div></li><li><div>      $oldfiles = array_unique( $oldfiles );&nbsp;</div></li><li><div>      if ( 5 &lt; count( $oldfiles ))&nbsp;</div></li><li><div>          array_pop( $oldfiles );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $oldfiles[] = $file;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  update_option( 'recently_edited', $oldfiles );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Flushes rewrite rules if siteurl, home or page_on_front changed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $old_value</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $value</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_home_siteurl( $old_value, $value ) {&nbsp;</div></li><li><div>  if ( wp_installing() )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_multisite() && ms_is_switched() ) {&nbsp;</div></li><li><div>      delete_option( 'rewrite_rules' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      flush_rewrite_rules();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Resets global variables based on $_GET and $_POST</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function resets global variables based on the names passed</span>&nbsp;</div></li><li><div><span class="comment"> * in the $vars array to the value of $_POST[$var] or $_GET[$var] or ''</span>&nbsp;</div></li><li><div><span class="comment"> * if neither is defined.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $vars An array of globals to reset.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_reset_vars( $vars ) {&nbsp;</div></li><li><div>  foreach ( $vars as $var ) {&nbsp;</div></li><li><div>      if ( empty( $_POST[ $var ] ) ) {&nbsp;</div></li><li><div>          if ( empty( $_GET[ $var ] ) ) {&nbsp;</div></li><li><div>              $GLOBALS[ $var ] = '';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $GLOBALS[ $var ] = $_GET[ $var ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $GLOBALS[ $var ] = $_POST[ $var ];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays the given administration message.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|WP_Error $message</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function show_message($message) {&nbsp;</div></li><li><div>  if ( is_wp_error($message) ) {&nbsp;</div></li><li><div>      if ( $message-&gt;get_error_data() && is_string( $message-&gt;get_error_data() ) )&nbsp;</div></li><li><div>          $message = $message-&gt;get_error_message() . ': ' . $message-&gt;get_error_data();&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $message = $message-&gt;get_error_message();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo &quot;&lt;p&gt;$message&lt;/p&gt;\n&quot;;&nbsp;</div></li><li><div>  wp_ob_end_flush_all();&nbsp;</div></li><li><div>  flush();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_doc_link_parse( $content ) {&nbsp;</div></li><li><div>  if ( !is_string( $content ) || empty( $content ) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !function_exists('token_get_all') )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tokens = token_get_all( $content );&nbsp;</div></li><li><div>  $count = count( $tokens );&nbsp;</div></li><li><div>  $functions = array();&nbsp;</div></li><li><div>  $ignore_functions = array();&nbsp;</div></li><li><div>  for ( $t = 0; $t &lt; $count - 2; $t++ ) {&nbsp;</div></li><li><div>      if ( ! is_array( $tokens[ $t ] ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( T_STRING == $tokens[ $t ][0] && ( '(' == $tokens[ $t + 1 ] || '(' == $tokens[ $t + 2 ] ) ) {&nbsp;</div></li><li><div>          <span class="comment">// If it's a function or class defined locally, there's not going to be any docs available</span>&nbsp;</div></li><li><div>          if ( ( isset( $tokens[ $t - 2 ][1] ) && in_array( $tokens[ $t - 2 ][1], array( 'function', 'class' ) ) ) || ( isset( $tokens[ $t - 2 ][0] ) && T_OBJECT_OPERATOR == $tokens[ $t - 1 ][0] ) ) {&nbsp;</div></li><li><div>              $ignore_functions[] = $tokens[$t][1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Add this to our stack of unique references</span>&nbsp;</div></li><li><div>          $functions[] = $tokens[$t][1];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $functions = array_unique( $functions );&nbsp;</div></li><li><div>  sort( $functions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of functions and classes to be ignored from the documentation lookup.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $ignore_functions Functions and classes to be ignored.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $ignore_functions = apply_filters( 'documentation_ignore_functions', $ignore_functions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $ignore_functions = array_unique( $ignore_functions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $out = array();&nbsp;</div></li><li><div>  foreach ( $functions as $function ) {&nbsp;</div></li><li><div>      if ( in_array( $function, $ignore_functions ) )&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      $out[] = $function;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $out;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Saves option for number of rows when listing posts, pages, comments, etc.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function set_screen_options() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset($_POST['wp_screen_options']) && is_array($_POST['wp_screen_options']) ) {&nbsp;</div></li><li><div>      check_admin_referer( 'screen-options-nonce', 'screenoptionnonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !$user = wp_get_current_user() )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      $option = $_POST['wp_screen_options']['option'];&nbsp;</div></li><li><div>      $value = $_POST['wp_screen_options']['value'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $option != sanitize_key( $option ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $map_option = $option;&nbsp;</div></li><li><div>      $type = str_replace('edit_', '', $map_option);&nbsp;</div></li><li><div>      $type = str_replace('_per_page', '', $type);&nbsp;</div></li><li><div>      if ( in_array( $type, get_taxonomies() ) )&nbsp;</div></li><li><div>          $map_option = 'edit_tags_per_page';&nbsp;</div></li><li><div>      elseif ( in_array( $type, get_post_types() ) )&nbsp;</div></li><li><div>          $map_option = 'edit_per_page';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $option = str_replace('-', '_', $option);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $map_option ) {&nbsp;</div></li><li><div>          case 'edit_per_page':&nbsp;</div></li><li><div>          case 'users_per_page':&nbsp;</div></li><li><div>          case 'edit_comments_per_page':&nbsp;</div></li><li><div>          case 'upload_per_page':&nbsp;</div></li><li><div>          case 'edit_tags_per_page':&nbsp;</div></li><li><div>          case 'plugins_per_page':&nbsp;</div></li><li><div>          <span class="comment">// Network admin</span>&nbsp;</div></li><li><div>          case 'sites_network_per_page':&nbsp;</div></li><li><div>          case 'users_network_per_page':&nbsp;</div></li><li><div>          case 'site_users_network_per_page':&nbsp;</div></li><li><div>          case 'plugins_network_per_page':&nbsp;</div></li><li><div>          case 'themes_network_per_page':&nbsp;</div></li><li><div>          case 'site_themes_network_per_page':&nbsp;</div></li><li><div>              $value = (int) $value;&nbsp;</div></li><li><div>              if ( $value &lt; 1 || $value &gt; 999 )&nbsp;</div></li><li><div>                  return;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters a screen option value before it is set.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * The filter can also be used to modify non-standard [items]_per_page</span>&nbsp;</div></li><li><div><span class="comment">               * settings. See the parent function for a full list of standard options.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * Returning false to the filter will skip saving the current option.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @see set_screen_options()</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param bool|int $value  Screen option value. Default false to skip.</span>&nbsp;</div></li><li><div><span class="comment">               * @param string   $option The option name.</span>&nbsp;</div></li><li><div><span class="comment">               * @param int      $value  The number of rows to use.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $value = apply_filters( 'set-screen-option', false, $option, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( false === $value )&nbsp;</div></li><li><div>                  return;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_user_meta($user-&gt;ID, $option, $value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $url = remove_query_arg( array( 'pagenum', 'apage', 'paged' ), wp_get_referer() );&nbsp;</div></li><li><div>      if ( isset( $_POST['mode'] ) ) {&nbsp;</div></li><li><div>          $url = add_query_arg( array( 'mode' =&gt; $_POST['mode'] ), $url );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_safe_redirect( $url );&nbsp;</div></li><li><div>      exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check if rewrite rule for WordPress already exists in the IIS 7+ configuration file</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename The file path to the configuration file</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function iis7_rewrite_rule_exists($filename) {&nbsp;</div></li><li><div>  if ( ! file_exists($filename) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  if ( ! class_exists( 'DOMDocument', false ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $doc = new DOMDocument();&nbsp;</div></li><li><div>  if ( $doc-&gt;load($filename) === false )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  $xpath = new DOMXPath($doc);&nbsp;</div></li><li><div>  $rules = $xpath-&gt;query('/configuration/system.webServer/rewrite/rules/rule[starts-with(@name, \'wordpress\')] | /configuration/system.webServer/rewrite/rules/rule[starts-with(@name, \'WordPress\')]');&nbsp;</div></li><li><div>  if ( $rules-&gt;length == 0 )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete WordPress rewrite rule from web.config file if it exists there</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename Name of the configuration file</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function iis7_delete_rewrite_rule($filename) {&nbsp;</div></li><li><div>  <span class="comment">// If configuration file does not exist then rules also do not exist so there is nothing to delete</span>&nbsp;</div></li><li><div>  if ( ! file_exists($filename) )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! class_exists( 'DOMDocument', false ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $doc = new DOMDocument();&nbsp;</div></li><li><div>  $doc-&gt;preserveWhiteSpace = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $doc -&gt; load($filename) === false )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  $xpath = new DOMXPath($doc);&nbsp;</div></li><li><div>  $rules = $xpath-&gt;query('/configuration/system.webServer/rewrite/rules/rule[starts-with(@name, \'wordpress\')] | /configuration/system.webServer/rewrite/rules/rule[starts-with(@name, \'WordPress\')]');&nbsp;</div></li><li><div>  if ( $rules-&gt;length &gt; 0 ) {&nbsp;</div></li><li><div>      $child = $rules-&gt;item(0);&nbsp;</div></li><li><div>      $parent = $child-&gt;parentNode;&nbsp;</div></li><li><div>      $parent-&gt;removeChild($child);&nbsp;</div></li><li><div>      $doc-&gt;formatOutput = true;&nbsp;</div></li><li><div>      saveDomDocument($doc, $filename);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add WordPress rewrite rule to the IIS 7+ configuration file.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename The file path to the configuration file</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $rewrite_rule The XML fragment with URL Rewrite rule</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function iis7_add_rewrite_rule($filename, $rewrite_rule) {&nbsp;</div></li><li><div>  if ( ! class_exists( 'DOMDocument', false ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If configuration file does not exist then we create one.</span>&nbsp;</div></li><li><div>  if ( ! file_exists($filename) ) {&nbsp;</div></li><li><div>      $fp = fopen( $filename, 'w');&nbsp;</div></li><li><div>      fwrite($fp, '&lt;configuration/&gt;');&nbsp;</div></li><li><div>      fclose($fp);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $doc = new DOMDocument();&nbsp;</div></li><li><div>  $doc-&gt;preserveWhiteSpace = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $doc-&gt;load($filename) === false )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $xpath = new DOMXPath($doc);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// First check if the rule already exists as in that case there is no need to re-add it</span>&nbsp;</div></li><li><div>  $wordpress_rules = $xpath-&gt;query('/configuration/system.webServer/rewrite/rules/rule[starts-with(@name, \'wordpress\')] | /configuration/system.webServer/rewrite/rules/rule[starts-with(@name, \'WordPress\')]');&nbsp;</div></li><li><div>  if ( $wordpress_rules-&gt;length &gt; 0 )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check the XPath to the rewrite rule and create XML nodes if they do not exist</span>&nbsp;</div></li><li><div>  $xmlnodes = $xpath-&gt;query('/configuration/system.webServer/rewrite/rules');&nbsp;</div></li><li><div>  if ( $xmlnodes-&gt;length &gt; 0 ) {&nbsp;</div></li><li><div>      $rules_node = $xmlnodes-&gt;item(0);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $rules_node = $doc-&gt;createElement('rules');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $xmlnodes = $xpath-&gt;query('/configuration/system.webServer/rewrite');&nbsp;</div></li><li><div>      if ( $xmlnodes-&gt;length &gt; 0 ) {&nbsp;</div></li><li><div>          $rewrite_node = $xmlnodes-&gt;item(0);&nbsp;</div></li><li><div>          $rewrite_node-&gt;appendChild($rules_node);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $rewrite_node = $doc-&gt;createElement('rewrite');&nbsp;</div></li><li><div>          $rewrite_node-&gt;appendChild($rules_node);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $xmlnodes = $xpath-&gt;query('/configuration/system.webServer');&nbsp;</div></li><li><div>          if ( $xmlnodes-&gt;length &gt; 0 ) {&nbsp;</div></li><li><div>              $system_webServer_node = $xmlnodes-&gt;item(0);&nbsp;</div></li><li><div>              $system_webServer_node-&gt;appendChild($rewrite_node);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $system_webServer_node = $doc-&gt;createElement('system.webServer');&nbsp;</div></li><li><div>              $system_webServer_node-&gt;appendChild($rewrite_node);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $xmlnodes = $xpath-&gt;query('/configuration');&nbsp;</div></li><li><div>              if ( $xmlnodes-&gt;length &gt; 0 ) {&nbsp;</div></li><li><div>                  $config_node = $xmlnodes-&gt;item(0);&nbsp;</div></li><li><div>                  $config_node-&gt;appendChild($system_webServer_node);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $config_node = $doc-&gt;createElement('configuration');&nbsp;</div></li><li><div>                  $doc-&gt;appendChild($config_node);&nbsp;</div></li><li><div>                  $config_node-&gt;appendChild($system_webServer_node);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rule_fragment = $doc-&gt;createDocumentFragment();&nbsp;</div></li><li><div>  $rule_fragment-&gt;appendXML($rewrite_rule);&nbsp;</div></li><li><div>  $rules_node-&gt;appendChild($rule_fragment);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $doc-&gt;encoding = &quot;UTF-8&quot;;&nbsp;</div></li><li><div>  $doc-&gt;formatOutput = true;&nbsp;</div></li><li><div>  saveDomDocument($doc, $filename);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Saves the XML document into a file</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param DOMDocument $doc</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function saveDomDocument($doc, $filename) {&nbsp;</div></li><li><div>  $config = $doc-&gt;saveXML();&nbsp;</div></li><li><div>  $config = preg_replace(&quot;/([^\r])\n/&quot;, &quot;$1\r\n&quot;, $config);&nbsp;</div></li><li><div>  $fp = fopen($filename, 'w');&nbsp;</div></li><li><div>  fwrite($fp, $config);&nbsp;</div></li><li><div>  fclose($fp);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display the default admin color scheme picker (Used in user-edit.php)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_admin_css_colors</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id User ID.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function admin_color_scheme_picker( $user_id ) {&nbsp;</div></li><li><div>  global $_wp_admin_css_colors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ksort( $_wp_admin_css_colors );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_wp_admin_css_colors['fresh'] ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Set Default ('fresh') and Light should go first.</span>&nbsp;</div></li><li><div>      $_wp_admin_css_colors = array_filter( array_merge( array( 'fresh' =&gt; '', 'light' =&gt; '' ), $_wp_admin_css_colors ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_color = get_user_option( 'admin_color', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $current_color ) || ! isset( $_wp_admin_css_colors[ $current_color ] ) ) {&nbsp;</div></li><li><div>      $current_color = 'fresh';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;fieldset id=&quot;color-picker&quot; class=&quot;scheme-list&quot;&gt;&nbsp;</div></li><li><div>      &lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;&lt;?php _e( 'Admin Color Scheme' ); ?&gt;&lt;/span&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      wp_nonce_field( 'save-color-scheme', 'color-nonce', false );&nbsp;</div></li><li><div>      foreach ( $_wp_admin_css_colors as $color =&gt; $color_info ) :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;color-option &lt;?php echo ( $color == $current_color ) ? 'selected' : ''; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>              &lt;input name=&quot;admin_color&quot; id=&quot;admin_color_&lt;?php echo esc_attr( $color ); ?&gt;&quot; type=&quot;radio&quot; value=&quot;&lt;?php echo esc_attr( $color ); ?&gt;&quot; class=&quot;tog&quot; &lt;?php checked( $color, $current_color ); ?&gt; /&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;hidden&quot; class=&quot;css_url&quot; value=&quot;&lt;?php echo esc_url( $color_info-&gt;url ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;hidden&quot; class=&quot;icon_colors&quot; value=&quot;&lt;?php echo esc_attr( wp_json_encode( array( 'icons' =&gt; $color_info-&gt;icon_colors ) ) ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;admin_color_&lt;?php echo esc_attr( $color ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $color_info-&gt;name ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;table class=&quot;color-palette&quot;&gt;&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ( $color_info-&gt;colors as $html_color ) {&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                      &lt;td style=&quot;background-color: &lt;?php echo esc_attr( $html_color ); ?&gt;&quot;&gt;&nbsp;&lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;/table&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      endforeach;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;/fieldset&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_admin_css_colors</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_color_scheme_settings() {&nbsp;</div></li><li><div>  global $_wp_admin_css_colors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $color_scheme = get_user_option( 'admin_color' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// It's possible to have a color scheme set that is no longer registered.</span>&nbsp;</div></li><li><div>  if ( empty( $_wp_admin_css_colors[ $color_scheme ] ) ) {&nbsp;</div></li><li><div>      $color_scheme = 'fresh';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $_wp_admin_css_colors[ $color_scheme ]-&gt;icon_colors ) ) {&nbsp;</div></li><li><div>      $icon_colors = $_wp_admin_css_colors[ $color_scheme ]-&gt;icon_colors;&nbsp;</div></li><li><div>  } elseif ( ! empty( $_wp_admin_css_colors['fresh']-&gt;icon_colors ) ) {&nbsp;</div></li><li><div>      $icon_colors = $_wp_admin_css_colors['fresh']-&gt;icon_colors;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Fall back to the default set of icon colors if the default scheme is missing.</span>&nbsp;</div></li><li><div>      $icon_colors = array( 'base' =&gt; '#82878c', 'focus' =&gt; '#00a0d2', 'current' =&gt; '#fff' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;script type=&quot;text/javascript&quot;&gt;var _wpColorScheme = ' . wp_json_encode( array( 'icons' =&gt; $icon_colors ) ) . &quot;;&lt;/script&gt;\n&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.3.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _ipad_meta() {&nbsp;</div></li><li><div>  if ( wp_is_mobile() ) {&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;meta name=&quot;viewport&quot; id=&quot;viewport-meta&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check lock status for posts displayed on the Posts screen</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $response  The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $data      The $_POST data sent.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $screen_id The screen id.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_check_locked_posts( $response, $data, $screen_id ) {&nbsp;</div></li><li><div>  $checked = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( array_key_exists( 'wp-check-locked-posts', $data ) && is_array( $data['wp-check-locked-posts'] ) ) {&nbsp;</div></li><li><div>      foreach ( $data['wp-check-locked-posts'] as $key ) {&nbsp;</div></li><li><div>          if ( ! $post_id = absint( substr( $key, 5 ) ) )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ( $user_id = wp_check_post_lock( $post_id ) ) && ( $user = get_userdata( $user_id ) ) && current_user_can( 'edit_post', $post_id ) ) {&nbsp;</div></li><li><div>              $send = array( 'text' =&gt; sprintf( __( '%s is currently editing' ), $user-&gt;display_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ( $avatar = get_avatar( $user-&gt;ID, 18 ) ) && preg_match( &quot;|src='([^']+)'|&quot;, $avatar, $matches ) )&nbsp;</div></li><li><div>                  $send['avatar_src'] = $matches[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $checked[$key] = $send;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $checked ) )&nbsp;</div></li><li><div>      $response['wp-check-locked-posts'] = $checked;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $response;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check lock status on the New/Edit Post screen and refresh the lock</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $response  The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $data      The $_POST data sent.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $screen_id The screen id.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_refresh_post_lock( $response, $data, $screen_id ) {&nbsp;</div></li><li><div>  if ( array_key_exists( 'wp-refresh-post-lock', $data ) ) {&nbsp;</div></li><li><div>      $received = $data['wp-refresh-post-lock'];&nbsp;</div></li><li><div>      $send = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $post_id = absint( $received['post_id'] ) )&nbsp;</div></li><li><div>          return $response;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! current_user_can('edit_post', $post_id) )&nbsp;</div></li><li><div>          return $response;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( $user_id = wp_check_post_lock( $post_id ) ) && ( $user = get_userdata( $user_id ) ) ) {&nbsp;</div></li><li><div>          $error = array(&nbsp;</div></li><li><div>              'text' =&gt; sprintf( __( '%s has taken over and is currently editing.' ), $user-&gt;display_name )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $avatar = get_avatar( $user-&gt;ID, 64 ) ) {&nbsp;</div></li><li><div>              if ( preg_match( &quot;|src='([^']+)'|&quot;, $avatar, $matches ) )&nbsp;</div></li><li><div>                  $error['avatar_src'] = $matches[1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $send['lock_error'] = $error;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( $new_lock = wp_set_post_lock( $post_id ) )&nbsp;</div></li><li><div>              $send['new_lock'] = implode( ':', $new_lock );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $response['wp-refresh-post-lock'] = $send;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $response;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check nonce expiration on the New/Edit Post screen and refresh if needed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $response  The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $data      The $_POST data sent.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $screen_id The screen id.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_refresh_post_nonces( $response, $data, $screen_id ) {&nbsp;</div></li><li><div>  if ( array_key_exists( 'wp-refresh-post-nonces', $data ) ) {&nbsp;</div></li><li><div>      $received = $data['wp-refresh-post-nonces'];&nbsp;</div></li><li><div>      $response['wp-refresh-post-nonces'] = array( 'check' =&gt; 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $post_id = absint( $received['post_id'] ) ) {&nbsp;</div></li><li><div>          return $response;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! current_user_can( 'edit_post', $post_id ) ) {&nbsp;</div></li><li><div>          return $response;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $response['wp-refresh-post-nonces'] = array(&nbsp;</div></li><li><div>          'replace' =&gt; array(&nbsp;</div></li><li><div>              'getpermalinknonce' =&gt; wp_create_nonce('getpermalink'), &nbsp;</div></li><li><div>              'samplepermalinknonce' =&gt; wp_create_nonce('samplepermalink'), &nbsp;</div></li><li><div>              'closedpostboxesnonce' =&gt; wp_create_nonce('closedpostboxes'), &nbsp;</div></li><li><div>              '_ajax_linking_nonce' =&gt; wp_create_nonce( 'internal-linking' ), &nbsp;</div></li><li><div>              '_wpnonce' =&gt; wp_create_nonce( 'update-post_' . $post_id ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'heartbeatNonce' =&gt; wp_create_nonce( 'heartbeat-nonce' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $response;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Disable suspension of Heartbeat on the Add/Edit Post screens.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global string $pagenow</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $settings An array of Heartbeat settings.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Filtered Heartbeat settings.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_heartbeat_set_suspension( $settings ) {&nbsp;</div></li><li><div>  global $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'post.php' === $pagenow || 'post-new.php' === $pagenow ) {&nbsp;</div></li><li><div>      $settings['suspension'] = 'disable';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $settings;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Autosave with heartbeat</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $response The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $data     The $_POST data sent.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The Heartbeat response.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function heartbeat_autosave( $response, $data ) {&nbsp;</div></li><li><div>  if ( ! empty( $data['wp_autosave'] ) ) {&nbsp;</div></li><li><div>      $saved = wp_autosave( $data['wp_autosave'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_wp_error( $saved ) ) {&nbsp;</div></li><li><div>          $response['wp_autosave'] = array( 'success' =&gt; false, 'message' =&gt; $saved-&gt;get_error_message() );&nbsp;</div></li><li><div>      } elseif ( empty( $saved ) ) {&nbsp;</div></li><li><div>          $response['wp_autosave'] = array( 'success' =&gt; false, 'message' =&gt; __( 'Error while saving.' ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">/** translators: draft saved date format, see https://secure.php.net/date */</span>&nbsp;</div></li><li><div>          $draft_saved_date_format = __( 'g:i:s a' );&nbsp;</div></li><li><div>          <span class="comment">/** translators: %s: date and time */</span>&nbsp;</div></li><li><div>          $response['wp_autosave'] = array( 'success' =&gt; true, 'message' =&gt; sprintf( __( 'Draft saved at %s.' ), date_i18n( $draft_saved_date_format ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $response;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove single-use URL parameters and create canonical link based on new URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Remove specific query string parameters from a URL, create the canonical link, </span>&nbsp;</div></li><li><div><span class="comment"> * put it in the admin header, and change the current URL to match.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_admin_canonical_url() {&nbsp;</div></li><li><div>  $removable_query_args = wp_removable_query_args();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $removable_query_args ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Ensure we're using an absolute URL.</span>&nbsp;</div></li><li><div>  $current_url = set_url_scheme( 'http:<span class="comment">//' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] );</span>&nbsp;</div></li><li><div>  $filtered_url = remove_query_arg( $removable_query_args, $current_url );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;link id=&quot;wp-admin-canonical&quot; rel=&quot;canonical&quot; href=&quot;&lt;?php echo esc_url( $filtered_url ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>  &lt;script&gt;&nbsp;</div></li><li><div>      if ( window.history.replaceState ) {&nbsp;</div></li><li><div>          window.history.replaceState( null, null, document.getElementById( 'wp-admin-canonical' ).href + window.location.hash );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs JS that reloads the page if the user navigated to it with the Back or Forward button.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Used on the Edit Post and Add New Post screens. Needed to ensure the page is not loaded from browser cache, </span>&nbsp;</div></li><li><div><span class="comment"> * so the post title and editor content are the last saved versions. Ideally this script should run first in the head.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_page_reload_on_back_button_js() {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;script&gt;&nbsp;</div></li><li><div>      if ( typeof performance !== 'undefined' && performance.navigation && performance.navigation.type === 2 ) {&nbsp;</div></li><li><div>          document.location.reload( true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-admin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>