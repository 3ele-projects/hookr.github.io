<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.4" data-type="file" data-id="4475"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-admin-includes-class-wp-press-this | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ff956c9f678022abda02b249b8fd24b0' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-admin-includes-class-wp-press-this/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-admin-includes-class-wp-press-this%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-admin-includes-class-wp-press-this%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-file-wp-admin-includes-class-wp-press-this","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-admin-includes-class-wp-press-this" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-admin-includes-class-wp-pr&hellip;</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-admin/includes/class-wp-press-this.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Press This class and display functionality</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Press_This</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Press This class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class WP_Press_This {&nbsp;</div></li><li><div>  <span class="comment">// Used to trigger the bookmarklet update notice.</span>&nbsp;</div></li><li><div>  const VERSION = 8;&nbsp;</div></li><li><div>  public $version = 8;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $images = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $embeds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $domain = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct() {}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * App and site settings data, including i18n strings for the client-side.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Site settings.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function site_settings() {&nbsp;</div></li><li><div>      return array(&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters whether or not Press This should redirect the user in the parent window upon save.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param bool $redirect Whether to redirect in parent window or not. Default false.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          'redirInParent' =&gt; apply_filters( 'press_this_redirect_in_parent', false ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the source's images and save them locally, for posterity, unless we can't.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $post_id Post ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content Optional. Current expected markup for Press This. Expects slashed. Default empty.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string New markup with old image URLs replaced with the local attachment ones if swapped.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function side_load_images( $post_id, $content = '' ) {&nbsp;</div></li><li><div>      $content = wp_unslash( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match_all( '/&lt;img [^&gt;]+&gt;/', $content, $matches ) && current_user_can( 'upload_files' ) ) {&nbsp;</div></li><li><div>          foreach ( (array) $matches[0] as $image ) {&nbsp;</div></li><li><div>              <span class="comment">// This is inserted from our JS so HTML attributes should always be in double quotes.</span>&nbsp;</div></li><li><div>              if ( ! preg_match( '/src=&quot;([^&quot;]+)&quot;/', $image, $url_matches ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $image_src = $url_matches[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Don't try to sideload a file without a file extension, leads to WP upload error.</span>&nbsp;</div></li><li><div>              if ( ! preg_match( '/[^\?]+\.(?:jpe?g|jpe|gif|png)(?:\?|$)/i', $image_src ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Sideload image, which gives us a new image src.</span>&nbsp;</div></li><li><div>              $new_src = media_sideload_image( $image_src, $post_id, null, 'src' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! is_wp_error( $new_src ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// Replace the POSTED content &lt;img&gt; with correct uploaded ones.</span>&nbsp;</div></li><li><div>                  <span class="comment">// Need to do it in two steps so we don't replace links to the original image if any.</span>&nbsp;</div></li><li><div>                  $new_image = str_replace( $image_src, $new_src, $image );&nbsp;</div></li><li><div>                  $content = str_replace( $image, $new_image, $content );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Expected slashed</span>&nbsp;</div></li><li><div>      return wp_slash( $content );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Ajax handler for saving the post as draft or published.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function save_post() {&nbsp;</div></li><li><div>      if ( empty( $_POST['post_ID'] ) || ! $post_id = (int) $_POST['post_ID'] ) {&nbsp;</div></li><li><div>          wp_send_json_error( array( 'errorMessage' =&gt; __( 'Missing post ID.' ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $_POST['_wpnonce'] ) || ! wp_verify_nonce( $_POST['_wpnonce'], 'update-post_' . $post_id ) ||&nbsp;</div></li><li><div>          ! current_user_can( 'edit_post', $post_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_send_json_error( array( 'errorMessage' =&gt; __( 'Invalid post.' ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_data = array(&nbsp;</div></li><li><div>          'ID' =&gt; $post_id, &nbsp;</div></li><li><div>          'post_title' =&gt; ( ! empty( $_POST['post_title'] ) ) ? sanitize_text_field( trim( $_POST['post_title'] ) ) : '', &nbsp;</div></li><li><div>          'post_content' =&gt; ( ! empty( $_POST['post_content'] ) ) ? trim( $_POST['post_content'] ) : '', &nbsp;</div></li><li><div>          'post_type' =&gt; 'post', &nbsp;</div></li><li><div>          'post_status' =&gt; 'draft', &nbsp;</div></li><li><div>          'post_format' =&gt; ( ! empty( $_POST['post_format'] ) ) ? sanitize_text_field( $_POST['post_format'] ) : '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only accept categories if the user actually can assign</span>&nbsp;</div></li><li><div>      $category_tax = get_taxonomy( 'category' );&nbsp;</div></li><li><div>      if ( current_user_can( $category_tax-&gt;cap-&gt;assign_terms ) ) {&nbsp;</div></li><li><div>          $post_data['post_category'] = ( ! empty( $_POST['post_category'] ) ) ? $_POST['post_category'] : array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only accept taxonomies if the user can actually assign</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST['tax_input'] ) ) {&nbsp;</div></li><li><div>          $tax_input = $_POST['tax_input'];&nbsp;</div></li><li><div>          foreach ( $tax_input as $tax =&gt; $_ti ) {&nbsp;</div></li><li><div>              $tax_object = get_taxonomy( $tax );&nbsp;</div></li><li><div>              if ( ! $tax_object || ! current_user_can( $tax_object-&gt;cap-&gt;assign_terms ) ) {&nbsp;</div></li><li><div>                  unset( $tax_input[ $tax ] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $post_data['tax_input'] = $tax_input;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Toggle status to pending if user cannot actually publish</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST['post_status'] ) && 'publish' === $_POST['post_status'] ) {&nbsp;</div></li><li><div>          if ( current_user_can( 'publish_posts' ) ) {&nbsp;</div></li><li><div>              $post_data['post_status'] = 'publish';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $post_data['post_status'] = 'pending';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_data['post_content'] = $this-&gt;side_load_images( $post_id, $post_data['post_content'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the post data of a Press This post before saving/updating.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The {@see 'side_load_images'} action has already run at this point.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $post_data The post data.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $post_data = apply_filters( 'press_this_save_post', $post_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $updated = wp_update_post( $post_data, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_wp_error( $updated ) ) {&nbsp;</div></li><li><div>          wp_send_json_error( array( 'errorMessage' =&gt; $updated-&gt;get_error_message() ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( isset( $post_data['post_format'] ) ) {&nbsp;</div></li><li><div>              if ( current_theme_supports( 'post-formats', $post_data['post_format'] ) ) {&nbsp;</div></li><li><div>                  set_post_format( $post_id, $post_data['post_format'] );&nbsp;</div></li><li><div>              } elseif ( $post_data['post_format'] ) {&nbsp;</div></li><li><div>                  set_post_format( $post_id, false );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $forceRedirect = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'publish' === get_post_status( $post_id ) ) {&nbsp;</div></li><li><div>              $redirect = get_post_permalink( $post_id );&nbsp;</div></li><li><div>          } elseif ( isset( $_POST['pt-force-redirect'] ) && $_POST['pt-force-redirect'] === 'true' ) {&nbsp;</div></li><li><div>              $forceRedirect = true;&nbsp;</div></li><li><div>              $redirect = get_edit_post_link( $post_id, 'js' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $redirect = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the URL to redirect to when Press This saves.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $url     Redirect URL. If `$status` is 'publish', this will be the post permalink.</span>&nbsp;</div></li><li><div><span class="comment">           *                        Otherwise, the default is false resulting in no redirect.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int    $post_id Post ID.</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $status  Post status.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $redirect = apply_filters( 'press_this_save_redirect', $redirect, $post_id, $post_data['post_status'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $redirect ) {&nbsp;</div></li><li><div>              wp_send_json_success( array( 'redirect' =&gt; $redirect, 'force' =&gt; $forceRedirect ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              wp_send_json_success( array( 'postSaved' =&gt; true ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Ajax handler for adding a new category.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_category() {&nbsp;</div></li><li><div>      if ( false === wp_verify_nonce( $_POST['new_cat_nonce'], 'add-category' ) ) {&nbsp;</div></li><li><div>          wp_send_json_error();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $taxonomy = get_taxonomy( 'category' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! current_user_can( $taxonomy-&gt;cap-&gt;edit_terms ) || empty( $_POST['name'] ) ) {&nbsp;</div></li><li><div>          wp_send_json_error();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $parent = isset( $_POST['parent'] ) && (int) $_POST['parent'] &gt; 0 ? (int) $_POST['parent'] : 0;&nbsp;</div></li><li><div>      $names = explode( ', ', $_POST['name'] );&nbsp;</div></li><li><div>      $added = $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $names as $cat_name ) {&nbsp;</div></li><li><div>          $cat_name = trim( $cat_name );&nbsp;</div></li><li><div>          $cat_nicename = sanitize_title( $cat_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $cat_nicename ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// @todo Find a more performant way to check existence, maybe get_term() with a separate parent check.</span>&nbsp;</div></li><li><div>          if ( term_exists( $cat_name, $taxonomy-&gt;name, $parent ) ) {&nbsp;</div></li><li><div>              if ( count( $names ) === 1 ) {&nbsp;</div></li><li><div>                  wp_send_json_error( array( 'errorMessage' =&gt; __( 'This category already exists.' ) ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $cat_id = wp_insert_term( $cat_name, $taxonomy-&gt;name, array( 'parent' =&gt; $parent ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_wp_error( $cat_id ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          } elseif ( is_array( $cat_id ) ) {&nbsp;</div></li><li><div>              $cat_id = $cat_id['term_id'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $added[] = $cat_id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $added ) ) {&nbsp;</div></li><li><div>          wp_send_json_error( array( 'errorMessage' =&gt; __( 'This category cannot be added. Please change the name and try again.' ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $added as $new_cat_id ) {&nbsp;</div></li><li><div>          $new_cat = get_category( $new_cat_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_wp_error( $new_cat ) ) {&nbsp;</div></li><li><div>              wp_send_json_error( array( 'errorMessage' =&gt; __( 'Error while adding the category. Please try again later.' ) ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $data[] = array(&nbsp;</div></li><li><div>              'term_id' =&gt; $new_cat-&gt;term_id, &nbsp;</div></li><li><div>              'name' =&gt; $new_cat-&gt;name, &nbsp;</div></li><li><div>              'parent' =&gt; $new_cat-&gt;parent, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      wp_send_json_success( $data );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Downloads the source's HTML via server-side call for the given URL.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url URL to scan.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Source's HTML sanitized markup</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function fetch_source_html( $url ) {&nbsp;</div></li><li><div>      if ( empty( $url ) ) {&nbsp;</div></li><li><div>          return new WP_Error( 'invalid-url', __( 'A valid URL was not provided.' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $remote_url = wp_safe_remote_get( $url, array(&nbsp;</div></li><li><div>          'timeout' =&gt; 30, &nbsp;</div></li><li><div>          <span class="comment">// Use an explicit user-agent for Press This</span>&nbsp;</div></li><li><div>          'user-agent' =&gt; 'Press This (WordPress/' . get_bloginfo( 'version' ) . '); ' . get_bloginfo( 'url' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_wp_error( $remote_url ) ) {&nbsp;</div></li><li><div>          return $remote_url;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $allowed_elements = array(&nbsp;</div></li><li><div>          'img' =&gt; array(&nbsp;</div></li><li><div>              'src' =&gt; true, &nbsp;</div></li><li><div>              'width' =&gt; true, &nbsp;</div></li><li><div>              'height' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'iframe' =&gt; array(&nbsp;</div></li><li><div>              'src' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link' =&gt; array(&nbsp;</div></li><li><div>              'rel' =&gt; true, &nbsp;</div></li><li><div>              'itemprop' =&gt; true, &nbsp;</div></li><li><div>              'href' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'meta' =&gt; array(&nbsp;</div></li><li><div>              'property' =&gt; true, &nbsp;</div></li><li><div>              'name' =&gt; true, &nbsp;</div></li><li><div>              'content' =&gt; true, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $source_content = wp_remote_retrieve_body( $remote_url );&nbsp;</div></li><li><div>      $source_content = wp_kses( $source_content, $allowed_elements );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $source_content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Utility method to limit an array to 50 values.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @ignore</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $value Array to limit.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Original array if fewer than 50 values, limited array, empty array otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function _limit_array( $value ) {&nbsp;</div></li><li><div>      if ( is_array( $value ) ) {&nbsp;</div></li><li><div>          if ( count( $value ) &gt; 50 ) {&nbsp;</div></li><li><div>              return array_slice( $value, 0, 50 );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $value;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Utility method to limit the length of a given string to 5, 000 characters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @ignore</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value String to limit.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool|int|string If boolean or integer, that value. If a string, the original value</span>&nbsp;</div></li><li><div><span class="comment">   *                         if fewer than 5, 000 characters, a truncated version, otherwise an</span>&nbsp;</div></li><li><div><span class="comment">   *                         empty string.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function _limit_string( $value ) {&nbsp;</div></li><li><div>      $return = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_numeric( $value ) || is_bool( $value ) ) {&nbsp;</div></li><li><div>          $return = $value;&nbsp;</div></li><li><div>      } else if ( is_string( $value ) ) {&nbsp;</div></li><li><div>          if ( mb_strlen( $value ) &gt; 5000 ) {&nbsp;</div></li><li><div>              $return = mb_substr( $value, 0, 5000 );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $return = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $return = html_entity_decode( $return, ENT_QUOTES, 'UTF-8' );&nbsp;</div></li><li><div>          $return = sanitize_text_field( trim( $return ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Utility method to limit a given URL to 2, 048 characters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @ignore</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url URL to check for length and validity.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Escaped URL if of valid length (&lt; 2048) and makeup. Empty string otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function _limit_url( $url ) {&nbsp;</div></li><li><div>      if ( ! is_string( $url ) ) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// HTTP 1.1 allows 8000 chars but the &quot;de-facto&quot; standard supported in all current browsers is 2048.</span>&nbsp;</div></li><li><div>      if ( strlen( $url ) &gt; 2048 ) {&nbsp;</div></li><li><div>          return ''; <span class="comment">// Return empty rather than a truncated/invalid URL</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Does not look like a URL.</span>&nbsp;</div></li><li><div>      if ( ! preg_match( '/^([!#$&-;=?-\[\]_a-z~]|%[0-9a-fA-F]{2})+$/', $url ) ) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If the URL is root-relative, prepend the protocol and domain name</span>&nbsp;</div></li><li><div>      if ( $url && $this-&gt;domain && preg_match( '%^/[^/]+%', $url ) ) {&nbsp;</div></li><li><div>          $url = $this-&gt;domain . $url;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Not absolute or protocol-relative URL.</span>&nbsp;</div></li><li><div>      if ( ! preg_match( '%^(?:https?:)?<span class="comment">//[^/]+%', $url ) ) {</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return esc_url_raw( $url, array( 'http', 'https' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Utility method to limit image source URLs.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Excluded URLs include share-this type buttons, loaders, spinners, spacers, WordPress interface images, </span>&nbsp;</div></li><li><div><span class="comment">   * tiny buttons or thumbs, mathtag.com or quantserve.com images, or the WordPress.com stats gif.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @ignore</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $src Image source URL.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string If not matched an excluded URL type, the original URL, empty string otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function _limit_img( $src ) {&nbsp;</div></li><li><div>      $src = $this-&gt;_limit_url( $src );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match( '!/ad[sx]?/!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Ads</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( preg_match( '!(/share-?this[^.]+?\.[a-z0-9]{3, 4})(\?.*)?$!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Share-this type button</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( preg_match( '!/(spinner|loading|spacer|blank|rss)\.(gif|jpg|png)!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Loaders, spinners, spacers</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( preg_match( '!/([^./]+[-_])?(spinner|loading|spacer|blank)s?([-_][^./]+)?\.[a-z0-9]{3, 4}!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Fancy loaders, spinners, spacers</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( preg_match( '!([^./]+[-_])?thumb[^.]*\.(gif|jpg|png)$!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Thumbnails, too small, usually irrelevant to context</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( false !== stripos( $src, '/wp-includes/' ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Classic WordPress interface images</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( preg_match( '![^\d]\d{1, 2}x\d+\.(gif|jpg|png)$!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Most often tiny buttons/thumbs (&lt; 100px wide)</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( preg_match( '!/pixel\.(mathtag|quantserve)\.com!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// See mathtag.com and https://www.quantcast.com/how-we-do-it/iab-standard-measurement/how-we-collect-data/</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } else if ( preg_match( '!/[gb]\.gif(\?.+)?$!i', $src ) ) {&nbsp;</div></li><li><div>          <span class="comment">// WordPress.com stats gif</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $src;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Limit embed source URLs to specific providers.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Not all core oEmbed providers are supported. Supported providers include YouTube, Vimeo, </span>&nbsp;</div></li><li><div><span class="comment">   * Vine, Daily Motion, SoundCloud, and Twitter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @ignore</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $src Embed source URL.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string If not from a supported provider, an empty string. Otherwise, a reformatted embed URL.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function _limit_embed( $src ) {&nbsp;</div></li><li><div>      $src = $this-&gt;_limit_url( $src );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $src ) )&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match( '!<span class="comment">//(m|www)\.youtube\.com/(embed|v)/([^?]+)\?.+$!i', $src, $src_matches ) ) {</span>&nbsp;</div></li><li><div>          <span class="comment">// Embedded Youtube videos (www or mobile)</span>&nbsp;</div></li><li><div>          $src = 'https:<span class="comment">//www.youtube.com/watch?v=' . $src_matches[3];</span>&nbsp;</div></li><li><div>      } else if ( preg_match( '!<span class="comment">//player\.vimeo\.com/video/([\d]+)([?/].*)?$!i', $src, $src_matches ) ) {</span>&nbsp;</div></li><li><div>          <span class="comment">// Embedded Vimeo iframe videos</span>&nbsp;</div></li><li><div>          $src = 'https:<span class="comment"><span class="comment">//vimeo.com/' . (int) $src_matches[1];</span></span>&nbsp;</div></li><li><div>      } else if ( preg_match( '!<span class="comment">//vimeo\.com/moogaloop\.swf\?clip_id=([\d]+)$!i', $src, $src_matches ) ) {</span>&nbsp;</div></li><li><div>          <span class="comment">// Embedded Vimeo Flash videos</span>&nbsp;</div></li><li><div>          $src = 'https:<span class="comment"><span class="comment">//vimeo.com/' . (int) $src_matches[1];</span></span>&nbsp;</div></li><li><div>      } else if ( preg_match( '!<span class="comment">//vine\.co/v/([^/]+)/embed!i', $src, $src_matches ) ) {</span>&nbsp;</div></li><li><div>          <span class="comment">// Embedded Vine videos</span>&nbsp;</div></li><li><div>          $src = 'https:<span class="comment">//vine.co/v/' . $src_matches[1];</span>&nbsp;</div></li><li><div>      } else if ( preg_match( '!<span class="comment">//(www\.)?dailymotion\.com/embed/video/([^/?]+)([/?].+)?!i', $src, $src_matches ) ) {</span>&nbsp;</div></li><li><div>          <span class="comment">// Embedded Daily Motion videos</span>&nbsp;</div></li><li><div>          $src = 'https:<span class="comment">//www.dailymotion.com/video/' . $src_matches[2];</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $oembed = _wp_oembed_get_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $oembed-&gt;get_provider( $src, array( 'discover' =&gt; false ) ) ) {&nbsp;</div></li><li><div>              $src = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $src;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Process a meta data entry from the source.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @ignore</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $meta_name  Meta key name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $meta_value Meta value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $data       Associative array of source data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Processed data array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function _process_meta_entry( $meta_name, $meta_value, $data ) {&nbsp;</div></li><li><div>      if ( preg_match( '/:?(title|description|keywords|site_name)$/', $meta_name ) ) {&nbsp;</div></li><li><div>          $data['_meta'][ $meta_name ] = $meta_value;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          switch ( $meta_name ) {&nbsp;</div></li><li><div>              case 'og:url':&nbsp;</div></li><li><div>              case 'og:video':&nbsp;</div></li><li><div>              case 'og:video:secure_url':&nbsp;</div></li><li><div>                  $meta_value = $this-&gt;_limit_embed( $meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! isset( $data['_embeds'] ) ) {&nbsp;</div></li><li><div>                      $data['_embeds'] = array();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $meta_value ) && ! in_array( $meta_value, $data['_embeds'] ) ) {&nbsp;</div></li><li><div>                      $data['_embeds'][] = $meta_value;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'og:image':&nbsp;</div></li><li><div>              case 'og:image:secure_url':&nbsp;</div></li><li><div>              case 'twitter:image0:src':&nbsp;</div></li><li><div>              case 'twitter:image0':&nbsp;</div></li><li><div>              case 'twitter:image:src':&nbsp;</div></li><li><div>              case 'twitter:image':&nbsp;</div></li><li><div>                  $meta_value = $this-&gt;_limit_img( $meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! isset( $data['_images'] ) ) {&nbsp;</div></li><li><div>                      $data['_images'] = array();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $meta_value ) && ! in_array( $meta_value, $data['_images'] ) ) {&nbsp;</div></li><li><div>                      $data['_images'][] = $meta_value;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $data;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fetches and parses _meta, _images, and _links data from the source.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url  URL to scan.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $data Optional. Existing data array if you have one. Default empty array.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array New data array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function source_data_fetch_fallback( $url, $data = array() ) {&nbsp;</div></li><li><div>      if ( empty( $url ) ) {&nbsp;</div></li><li><div>          return array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Download source page to tmp file.</span>&nbsp;</div></li><li><div>      $source_content = $this-&gt;fetch_source_html( $url );&nbsp;</div></li><li><div>      if ( is_wp_error( $source_content ) ) {&nbsp;</div></li><li><div>          return array( 'errors' =&gt; $source_content-&gt;get_error_messages() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fetch and gather &lt;meta&gt; data first, so discovered media is offered 1st to user.</span>&nbsp;</div></li><li><div>      if ( empty( $data['_meta'] ) ) {&nbsp;</div></li><li><div>          $data['_meta'] = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match_all( '/&lt;meta [^&gt;]+&gt;/', $source_content, $matches ) ) {&nbsp;</div></li><li><div>          $items = $this-&gt;_limit_array( $matches[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $items as $value ) {&nbsp;</div></li><li><div>              if ( preg_match( '/(property|name)=&quot;([^&quot;]+)&quot;[^&gt;]+content=&quot;([^&quot;]+)&quot;/', $value, $new_matches ) ) {&nbsp;</div></li><li><div>                  $meta_name = $this-&gt;_limit_string( $new_matches[2] );&nbsp;</div></li><li><div>                  $meta_value = $this-&gt;_limit_string( $new_matches[3] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Sanity check. $key is usually things like 'title', 'description', 'keywords', etc.</span>&nbsp;</div></li><li><div>                  if ( strlen( $meta_name ) &gt; 100 ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $data = $this-&gt;_process_meta_entry( $meta_name, $meta_value, $data );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fetch and gather &lt;img&gt; data.</span>&nbsp;</div></li><li><div>      if ( empty( $data['_images'] ) ) {&nbsp;</div></li><li><div>          $data['_images'] = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match_all( '/&lt;img [^&gt;]+&gt;/', $source_content, $matches ) ) {&nbsp;</div></li><li><div>          $items = $this-&gt;_limit_array( $matches[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $items as $value ) {&nbsp;</div></li><li><div>              if ( ( preg_match( '/width=(\'|&quot;)(\d+)\\1/i', $value, $new_matches ) && $new_matches[2] &lt; 256 ) ||&nbsp;</div></li><li><div>                  ( preg_match( '/height=(\'|&quot;)(\d+)\\1/i', $value, $new_matches ) && $new_matches[2] &lt; 128 ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( preg_match( '/src=(\'|&quot;)([^\'&quot;]+)\\1/i', $value, $new_matches ) ) {&nbsp;</div></li><li><div>                  $src = $this-&gt;_limit_img( $new_matches[2] );&nbsp;</div></li><li><div>                  if ( ! empty( $src ) && ! in_array( $src, $data['_images'] ) ) {&nbsp;</div></li><li><div>                      $data['_images'][] = $src;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fetch and gather &lt;iframe&gt; data.</span>&nbsp;</div></li><li><div>      if ( empty( $data['_embeds'] ) ) {&nbsp;</div></li><li><div>          $data['_embeds'] = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match_all( '/&lt;iframe [^&gt;]+&gt;/', $source_content, $matches ) ) {&nbsp;</div></li><li><div>          $items = $this-&gt;_limit_array( $matches[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $items as $value ) {&nbsp;</div></li><li><div>              if ( preg_match( '/src=(\'|&quot;)([^\'&quot;]+)\\1/', $value, $new_matches ) ) {&nbsp;</div></li><li><div>                  $src = $this-&gt;_limit_embed( $new_matches[2] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $src ) && ! in_array( $src, $data['_embeds'] ) ) {&nbsp;</div></li><li><div>                      $data['_embeds'][] = $src;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fetch and gather &lt;link&gt; data.</span>&nbsp;</div></li><li><div>      if ( empty( $data['_links'] ) ) {&nbsp;</div></li><li><div>          $data['_links'] = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match_all( '/&lt;link [^&gt;]+&gt;/', $source_content, $matches ) ) {&nbsp;</div></li><li><div>          $items = $this-&gt;_limit_array( $matches[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $items as $value ) {&nbsp;</div></li><li><div>              if ( preg_match( '/rel=[&quot;\'](canonical|shortlink|icon)[&quot;\']/i', $value, $matches_rel ) && preg_match( '/href=[\'&quot;]([^\'&quot; ]+)[\'&quot;]/i', $value, $matches_url ) ) {&nbsp;</div></li><li><div>                  $rel = $matches_rel[1];&nbsp;</div></li><li><div>                  $url = $this-&gt;_limit_url( $matches_url[1] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $url ) && empty( $data['_links'][ $rel ] ) ) {&nbsp;</div></li><li><div>                      $data['_links'][ $rel ] = $url;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $data;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Handles backward-compat with the legacy version of Press This by supporting its query string params.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function merge_or_fetch_data() {&nbsp;</div></li><li><div>      <span class="comment">// Get data from $_POST and $_GET, as appropriate ($_POST &gt; $_GET), to remain backward compatible.</span>&nbsp;</div></li><li><div>      $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only instantiate the keys we want. Sanity check and sanitize each one.</span>&nbsp;</div></li><li><div>      foreach ( array( 'u', 's', 't', 'v' ) as $key ) {&nbsp;</div></li><li><div>          if ( ! empty( $_POST[ $key ] ) ) {&nbsp;</div></li><li><div>              $value = wp_unslash( $_POST[ $key ] );&nbsp;</div></li><li><div>          } else if ( ! empty( $_GET[ $key ] ) ) {&nbsp;</div></li><li><div>              $value = wp_unslash( $_GET[ $key ] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'u' === $key ) {&nbsp;</div></li><li><div>              $value = $this-&gt;_limit_url( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( preg_match( '%^(?:https?:)?<span class="comment">//[^/]+%i', $value, $domain_match ) ) {</span>&nbsp;</div></li><li><div>                  $this-&gt;domain = $domain_match[0];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $value = $this-&gt;_limit_string( $value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $value ) ) {&nbsp;</div></li><li><div>              $data[ $key ] = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters whether to enable in-source media discovery in Press This.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool $enable Whether to enable media discovery.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( apply_filters( 'enable_press_this_media_discovery', true ) ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * If no title, _images, _embed, and _meta was passed via $_POST, fetch data from source as fallback, </span>&nbsp;</div></li><li><div><span class="comment">           * making PT fully backward compatible with the older bookmarklet.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( empty( $_POST ) && ! empty( $data['u'] ) ) {&nbsp;</div></li><li><div>              if ( isset( $_GET['_wpnonce'] ) && wp_verify_nonce( $_GET['_wpnonce'], 'scan-site' ) ) {&nbsp;</div></li><li><div>                  $data = $this-&gt;source_data_fetch_fallback( $data['u'], $data );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $data['errors'] = 'missing nonce';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              foreach ( array( '_images', '_embeds' ) as $type ) {&nbsp;</div></li><li><div>                  if ( empty( $_POST[ $type ] ) ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $data[ $type ] = array();&nbsp;</div></li><li><div>                  $items = $this-&gt;_limit_array( $_POST[ $type ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ( $items as $key =&gt; $value ) {&nbsp;</div></li><li><div>                      if ( $type === '_images' ) {&nbsp;</div></li><li><div>                          $value = $this-&gt;_limit_img( wp_unslash( $value ) );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $value = $this-&gt;_limit_embed( wp_unslash( $value ) );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( ! empty( $value ) ) {&nbsp;</div></li><li><div>                          $data[ $type ][] = $value;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( array( '_meta', '_links' ) as $type ) {&nbsp;</div></li><li><div>                  if ( empty( $_POST[ $type ] ) ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $data[ $type ] = array();&nbsp;</div></li><li><div>                  $items = $this-&gt;_limit_array( $_POST[ $type ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ( $items as $key =&gt; $value ) {&nbsp;</div></li><li><div>                      <span class="comment">// Sanity check. These are associative arrays, $key is usually things like 'title', 'description', 'keywords', etc.</span>&nbsp;</div></li><li><div>                      if ( empty( $key ) || strlen( $key ) &gt; 100 ) {&nbsp;</div></li><li><div>                          continue;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( $type === '_meta' ) {&nbsp;</div></li><li><div>                          $value = $this-&gt;_limit_string( wp_unslash( $value ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( ! empty( $value ) ) {&nbsp;</div></li><li><div>                              $data = $this-&gt;_process_meta_entry( $key, $value, $data );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          if ( in_array( $key, array( 'canonical', 'shortlink', 'icon' ), true ) ) {&nbsp;</div></li><li><div>                              $data[ $type ][ $key ] = $this-&gt;_limit_url( wp_unslash( $value ) );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Support passing a single image src as `i`</span>&nbsp;</div></li><li><div>          if ( ! empty( $_REQUEST['i'] ) && ( $img_src = $this-&gt;_limit_img( wp_unslash( $_REQUEST['i'] ) ) ) ) {&nbsp;</div></li><li><div>              if ( empty( $data['_images'] ) ) {&nbsp;</div></li><li><div>                  $data['_images'] = array( $img_src );&nbsp;</div></li><li><div>              } elseif ( ! in_array( $img_src, $data['_images'], true ) ) {&nbsp;</div></li><li><div>                  array_unshift( $data['_images'], $img_src );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the Press This data array.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $data Press This Data array.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      return apply_filters( 'press_this_data', $data );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds another stylesheet inside TinyMCE.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $styles URL to editor stylesheet.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Possibly modified stylesheets list.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_editor_style( $styles ) {&nbsp;</div></li><li><div>      if ( ! empty( $styles ) ) {&nbsp;</div></li><li><div>          $styles .= ', ';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $press_this = admin_url( 'css/press-this-editor.css' );&nbsp;</div></li><li><div>      if ( is_rtl() ) {&nbsp;</div></li><li><div>          $press_this = str_replace( '.css', '-rtl.css', $press_this );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $styles . $press_this;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs the post format selection HTML.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post Post object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function post_formats_html( $post ) {&nbsp;</div></li><li><div>      if ( current_theme_supports( 'post-formats' ) && post_type_supports( $post-&gt;post_type, 'post-formats' ) ) {&nbsp;</div></li><li><div>          $post_formats = get_theme_support( 'post-formats' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_array( $post_formats[0] ) ) {&nbsp;</div></li><li><div>              $post_format = get_post_format( $post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! $post_format ) {&nbsp;</div></li><li><div>                  $post_format = '0';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Add in the current one if it isn't there yet, in case the current theme doesn't support it.</span>&nbsp;</div></li><li><div>              if ( $post_format && ! in_array( $post_format, $post_formats[0] ) ) {&nbsp;</div></li><li><div>                  $post_formats[0][] = $post_format;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;post-formats-select&quot;&gt;&nbsp;</div></li><li><div>              &lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Post Formats' ); ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;radio&quot; name=&quot;post_format&quot; class=&quot;post-format&quot; id=&quot;post-format-0&quot; value=&quot;0&quot; &lt;?php checked( $post_format, '0' ); ?&gt; /&gt;&nbsp;</div></li><li><div>                  &lt;label for=&quot;post-format-0&quot; class=&quot;post-format-icon post-format-standard&quot;&gt;&lt;?php echo get_post_format_string( 'standard' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ( $post_formats[0] as $format ) {&nbsp;</div></li><li><div>                      $attr_format = esc_attr( $format );&nbsp;</div></li><li><div>                      ?&gt;&nbsp;</div></li><li><div>                      &lt;br /&gt;&nbsp;</div></li><li><div>                      &lt;input type=&quot;radio&quot; name=&quot;post_format&quot; class=&quot;post-format&quot; id=&quot;post-format-&lt;?php echo $attr_format; ?&gt;&quot; value=&quot;&lt;?php echo $attr_format; ?&gt;&quot; &lt;?php checked( $post_format, $format ); ?&gt; /&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;post-format-&lt;?php echo $attr_format ?&gt;&quot; class=&quot;post-format-icon post-format-&lt;?php echo $attr_format; ?&gt;&quot;&gt;&lt;?php echo esc_html( get_post_format_string( $format ) ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>                   }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                   ?&gt;&nbsp;</div></li><li><div>              &lt;/fieldset&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs the categories HTML.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post Post object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function categories_html( $post ) {&nbsp;</div></li><li><div>      $taxonomy = get_taxonomy( 'category' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Bail if user cannot assign terms</span>&nbsp;</div></li><li><div>      if ( ! current_user_can( $taxonomy-&gt;cap-&gt;assign_terms ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only show &quot;add&quot; if user can edit terms</span>&nbsp;</div></li><li><div>      if ( current_user_can( $taxonomy-&gt;cap-&gt;edit_terms ) ) {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;button type=&quot;button&quot; class=&quot;add-cat-toggle button-link&quot; aria-expanded=&quot;false&quot;&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;dashicons dashicons-plus&quot;&gt;&lt;/span&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Toggle add category' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/button&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;add-category is-hidden&quot;&gt;&nbsp;</div></li><li><div>              &lt;label class=&quot;screen-reader-text&quot; for=&quot;new-category&quot;&gt;&lt;?php echo $taxonomy-&gt;labels-&gt;add_new_item; ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;text&quot; id=&quot;new-category&quot; class=&quot;add-category-name&quot; placeholder=&quot;&lt;?php echo esc_attr( $taxonomy-&gt;labels-&gt;new_item_name ); ?&gt;&quot; value=&quot;&quot; aria-required=&quot;true&quot;&gt;&nbsp;</div></li><li><div>              &lt;label class=&quot;screen-reader-text&quot; for=&quot;new-category-parent&quot;&gt;&lt;?php echo $taxonomy-&gt;labels-&gt;parent_item_colon; ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;postform-wrapper&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                  wp_dropdown_categories( array(&nbsp;</div></li><li><div>                      'taxonomy' =&gt; 'category', &nbsp;</div></li><li><div>                      'hide_empty' =&gt; 0, &nbsp;</div></li><li><div>                      'name' =&gt; 'new-category-parent', &nbsp;</div></li><li><div>                      'orderby' =&gt; 'name', &nbsp;</div></li><li><div>                      'hierarchical' =&gt; 1, &nbsp;</div></li><li><div>                      'show_option_none' =&gt; '&mdash; ' . $taxonomy-&gt;labels-&gt;parent_item . ' &mdash;'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;button type=&quot;button&quot; class=&quot;add-cat-submit&quot;&gt;&lt;?php _e( 'Add' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;categories-search-wrapper&quot;&gt;&nbsp;</div></li><li><div>          &lt;input id=&quot;categories-search&quot; type=&quot;search&quot; class=&quot;categories-search&quot; placeholder=&quot;&lt;?php esc_attr_e( 'Search categories by name' ) ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;categories-search&quot;&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;dashicons dashicons-search&quot;&gt;&lt;/span&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Search categories' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div aria-label=&quot;&lt;?php esc_attr_e( 'Categories' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;ul class=&quot;categories-select&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php wp_terms_checklist( $post-&gt;ID, array( 'taxonomy' =&gt; 'category', 'list_only' =&gt; true ) ); ?&gt;&nbsp;</div></li><li><div>          &lt;/ul&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs the tags HTML.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post Post object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function tags_html( $post ) {&nbsp;</div></li><li><div>      $taxonomy = get_taxonomy( 'post_tag' );&nbsp;</div></li><li><div>      $user_can_assign_terms = current_user_can( $taxonomy-&gt;cap-&gt;assign_terms );&nbsp;</div></li><li><div>      $esc_tags = get_terms_to_edit( $post-&gt;ID, 'post_tag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $esc_tags || is_wp_error( $esc_tags ) ) {&nbsp;</div></li><li><div>          $esc_tags = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;tagsdiv&quot; id=&quot;post_tag&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;jaxtag&quot;&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;hidden&quot; name=&quot;tax_input[post_tag]&quot; class=&quot;the-tags&quot; value=&quot;&lt;?php echo $esc_tags; <span class="comment">// escaped in get_terms_to_edit() ?&gt;&quot;&gt;</span>&nbsp;</div></li><li><div>           &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $user_can_assign_terms ) {&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;ajaxtag hide-if-no-js&quot;&gt;&nbsp;</div></li><li><div>                  &lt;label class=&quot;screen-reader-text&quot; for=&quot;new-tag-post_tag&quot;&gt;&lt;?php _e( 'Tags' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;p&gt;&nbsp;</div></li><li><div>                      &lt;input type=&quot;text&quot; id=&quot;new-tag-post_tag&quot; name=&quot;newtag[post_tag]&quot; class=&quot;newtag form-input-tip&quot; size=&quot;16&quot; autocomplete=&quot;off&quot; value=&quot;&quot; aria-describedby=&quot;new-tag-desc&quot; /&gt;&nbsp;</div></li><li><div>                      &lt;button type=&quot;button&quot; class=&quot;tagadd&quot;&gt;&lt;?php _e( 'Add' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;p class=&quot;howto&quot; id=&quot;new-tag-desc&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php echo $taxonomy-&gt;labels-&gt;separate_items_with_commas; ?&gt;&nbsp;</div></li><li><div>              &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;tagchecklist&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $user_can_assign_terms ) {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;button type=&quot;button&quot; class=&quot;button-link tagcloud-link&quot; id=&quot;link-post_tag&quot; aria-expanded=&quot;false&quot;&gt;&lt;?php echo $taxonomy-&gt;labels-&gt;choose_from_most_used; ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of embeds with no duplicates.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data The site's data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Embeds selected to be available.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_embeds( $data ) {&nbsp;</div></li><li><div>      $selected_embeds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Make sure to add the Pressed page if it's a valid oembed itself</span>&nbsp;</div></li><li><div>      if ( ! empty ( $data['u'] ) && $this-&gt;_limit_embed( $data['u'] ) ) {&nbsp;</div></li><li><div>          $data['_embeds'][] = $data['u'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $data['_embeds'] ) ) {&nbsp;</div></li><li><div>          foreach ( $data['_embeds'] as $src ) {&nbsp;</div></li><li><div>              $prot_relative_src = preg_replace( '/^https?:/', '', $src );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( in_array( $prot_relative_src, $this-&gt;embeds ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $selected_embeds[] = $src;&nbsp;</div></li><li><div>              $this-&gt;embeds[] = $prot_relative_src;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $selected_embeds;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of images with no duplicates.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data The site's data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_images( $data ) {&nbsp;</div></li><li><div>      $selected_images = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $data['_images'] ) ) {&nbsp;</div></li><li><div>          foreach ( $data['_images'] as $src ) {&nbsp;</div></li><li><div>              if ( false !== strpos( $src, 'gravatar.com' ) ) {&nbsp;</div></li><li><div>                  $src = preg_replace( '%http:<span class="comment">//[\d]+\.gravatar\.com/%', 'https://secure.gravatar.com/', $src );</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $prot_relative_src = preg_replace( '/^https?:/', '', $src );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( in_array( $prot_relative_src, $this-&gt;images ) ||&nbsp;</div></li><li><div>                  ( false !== strpos( $src, 'avatar' ) && count( $this-&gt;images ) &gt; 15 ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// Skip: already selected or some type of avatar and we've already gathered more than 15 images.</span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $selected_images[] = $src;&nbsp;</div></li><li><div>              $this-&gt;images[] = $prot_relative_src;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $selected_images;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Gets the source page's canonical link, based on passed location and meta data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">    * @param array $data The site's data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Discovered canonical URL, or empty</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_canonical_link( $data ) {&nbsp;</div></li><li><div>      $link = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $data['_links']['canonical'] ) ) {&nbsp;</div></li><li><div>          $link = $data['_links']['canonical'];&nbsp;</div></li><li><div>      } elseif ( ! empty( $data['u'] ) ) {&nbsp;</div></li><li><div>          $link = $data['u'];&nbsp;</div></li><li><div>      } elseif ( ! empty( $data['_meta'] ) ) {&nbsp;</div></li><li><div>          if ( ! empty( $data['_meta']['twitter:url'] ) ) {&nbsp;</div></li><li><div>              $link = $data['_meta']['twitter:url'];&nbsp;</div></li><li><div>          } else if ( ! empty( $data['_meta']['og:url'] ) ) {&nbsp;</div></li><li><div>              $link = $data['_meta']['og:url'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $link ) && ! empty( $data['_links']['shortlink'] ) ) {&nbsp;</div></li><li><div>          $link = $data['_links']['shortlink'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $link;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Gets the source page's site name, based on passed meta data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data The site's data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Discovered site name, or empty</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_source_site_name( $data ) {&nbsp;</div></li><li><div>      $name = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $data['_meta'] ) ) {&nbsp;</div></li><li><div>          if ( ! empty( $data['_meta']['og:site_name'] ) ) {&nbsp;</div></li><li><div>              $name = $data['_meta']['og:site_name'];&nbsp;</div></li><li><div>          } else if ( ! empty( $data['_meta']['application-name'] ) ) {&nbsp;</div></li><li><div>              $name = $data['_meta']['application-name'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $name;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Gets the source page's title, based on passed title and meta data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data The site's data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Discovered page title, or empty</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_suggested_title( $data ) {&nbsp;</div></li><li><div>      $title = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $data['t'] ) ) {&nbsp;</div></li><li><div>          $title = $data['t'];&nbsp;</div></li><li><div>      } elseif ( ! empty( $data['_meta'] ) ) {&nbsp;</div></li><li><div>          if ( ! empty( $data['_meta']['twitter:title'] ) ) {&nbsp;</div></li><li><div>              $title = $data['_meta']['twitter:title'];&nbsp;</div></li><li><div>          } else if ( ! empty( $data['_meta']['og:title'] ) ) {&nbsp;</div></li><li><div>              $title = $data['_meta']['og:title'];&nbsp;</div></li><li><div>          } else if ( ! empty( $data['_meta']['title'] ) ) {&nbsp;</div></li><li><div>              $title = $data['_meta']['title'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Gets the source page's suggested content, based on passed data (description, selection, etc).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Features a blockquoted excerpt, as well as content attribution, if any.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data The site's data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Discovered content, or empty</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_suggested_content( $data ) {&nbsp;</div></li><li><div>      $content = $text = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $data['s'] ) ) {&nbsp;</div></li><li><div>          $text = $data['s'];&nbsp;</div></li><li><div>      } else if ( ! empty( $data['_meta'] ) ) {&nbsp;</div></li><li><div>          if ( ! empty( $data['_meta']['twitter:description'] ) ) {&nbsp;</div></li><li><div>              $text = $data['_meta']['twitter:description'];&nbsp;</div></li><li><div>          } else if ( ! empty( $data['_meta']['og:description'] ) ) {&nbsp;</div></li><li><div>              $text = $data['_meta']['og:description'];&nbsp;</div></li><li><div>          } else if ( ! empty( $data['_meta']['description'] ) ) {&nbsp;</div></li><li><div>              $text = $data['_meta']['description'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If there is an ellipsis at the end, the description is very likely auto-generated. Better to ignore it.</span>&nbsp;</div></li><li><div>          if ( $text && substr( $text, -3 ) === '...' ) {&nbsp;</div></li><li><div>              $text = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $default_html = array( 'quote' =&gt; '', 'link' =&gt; '', 'embed' =&gt; '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $data['u'] ) && $this-&gt;_limit_embed( $data['u'] ) ) {&nbsp;</div></li><li><div>          $default_html['embed'] = '&lt;p&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $data['s'] ) ) {&nbsp;</div></li><li><div>              <span class="comment">// If the user has selected some text, do quote it.</span>&nbsp;</div></li><li><div>              $default_html['quote'] = '&lt;blockquote&gt;%1$s&lt;/blockquote&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $default_html['quote'] = '&lt;blockquote&gt;%1$s&lt;/blockquote&gt;';&nbsp;</div></li><li><div>          $default_html['link'] = '&lt;p&gt;' . _x( 'Source:', 'Used in Press This to indicate where the content comes from.' ) .&nbsp;</div></li><li><div>              ' &lt;em&gt;&lt;a href=&quot;%1$s&quot;&gt;%2$s&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the default HTML tags used in the suggested content for the editor.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The HTML strings use printf format. After filtering the content is added at the specified places with `sprintf()`.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $default_html Associative array with three possible keys:</span>&nbsp;</div></li><li><div><span class="comment">       *                                - 'quote' where %1$s is replaced with the site description or the selected content.</span>&nbsp;</div></li><li><div><span class="comment">       *                                - 'link' where %1$s is link href, %2$s is link text, usually the source page title.</span>&nbsp;</div></li><li><div><span class="comment">       *                                - 'embed' which contains an  shortcode when the source page offers embeddable content.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $data         Associative array containing the data from the source page.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $default_html = apply_filters( 'press_this_suggested_html', $default_html, $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $default_html['embed'] ) ) {&nbsp;</div></li><li><div>          $content .= $default_html['embed'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Wrap suggested content in the specified HTML.</span>&nbsp;</div></li><li><div>      if ( ! empty( $default_html['quote'] ) && $text ) {&nbsp;</div></li><li><div>          $content .= sprintf( $default_html['quote'], $text );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add source attribution if there is one available.</span>&nbsp;</div></li><li><div>      if ( ! empty( $default_html['link'] ) ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_suggested_title( $data );&nbsp;</div></li><li><div>          $url = $this-&gt;get_canonical_link( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $title ) {&nbsp;</div></li><li><div>              $title = $this-&gt;get_source_site_name( $data );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $url && $title ) {&nbsp;</div></li><li><div>              $content .= sprintf( $default_html['link'], $url, $title );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Serves the app's base HTML, which in turns calls the load script.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global WP_Locale $wp_locale</span>&nbsp;</div></li><li><div><span class="comment">   * @global bool      $is_IE</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function html() {&nbsp;</div></li><li><div>      global $wp_locale;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wp_version = get_bloginfo( 'version' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get data, new (POST) and old (GET).</span>&nbsp;</div></li><li><div>      $data = $this-&gt;merge_or_fetch_data();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_title = $this-&gt;get_suggested_title( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_content = $this-&gt;get_suggested_content( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get site settings array/data.</span>&nbsp;</div></li><li><div>      $site_settings = $this-&gt;site_settings();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Pass the images and embeds</span>&nbsp;</div></li><li><div>      $images = $this-&gt;get_images( $data );&nbsp;</div></li><li><div>      $embeds = $this-&gt;get_embeds( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $site_data = array(&nbsp;</div></li><li><div>          'v' =&gt; ! empty( $data['v'] ) ? $data['v'] : '', &nbsp;</div></li><li><div>          'u' =&gt; ! empty( $data['u'] ) ? $data['u'] : '', &nbsp;</div></li><li><div>          'hasData' =&gt; ! empty( $data ) && ! isset( $data['errors'] ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $images ) ) {&nbsp;</div></li><li><div>          $site_data['_images'] = $images;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $embeds ) ) {&nbsp;</div></li><li><div>          $site_data['_embeds'] = $embeds;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add press-this-editor.css and remove theme's editor-style.css, if any.</span>&nbsp;</div></li><li><div>      remove_editor_styles();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'mce_css', array( $this, 'add_editor_style' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $GLOBALS['is_IE'] ) ) {&nbsp;</div></li><li><div>          @header( 'X-UA-Compatible: IE=edge' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      @header( 'Content-Type: ' . get_option( 'html_type' ) . '; charset=' . get_option( 'blog_charset' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;!DOCTYPE html&gt;&nbsp;</div></li><li><div>&lt;!--[if IE 7]&gt;         &lt;html class=&quot;lt-ie9 lt-ie8&quot; &lt;?php language_attributes(); ?&gt;&gt; &lt;![endif]--&gt;&nbsp;</div></li><li><div>&lt;!--[if IE 8]&gt;         &lt;html class=&quot;lt-ie9&quot; &lt;?php language_attributes(); ?&gt;&gt; &lt;![endif]--&gt;&nbsp;</div></li><li><div>&lt;!--[if gt IE 8]&gt;&lt;!--&gt; &lt;html &lt;?php language_attributes(); ?&gt;&gt; &lt;!--&lt;![endif]--&gt;&nbsp;</div></li><li><div>&lt;head&gt;&nbsp;</div></li><li><div>  &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;&lt;?php echo esc_attr( get_bloginfo( 'html_type' ) ); ?&gt;; charset=&lt;?php echo esc_attr( get_option( 'blog_charset' ) ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;&nbsp;</div></li><li><div>  &lt;title&gt;&lt;?php esc_html_e( 'Press This!' ) ?&gt;&lt;/title&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;script&gt;&nbsp;</div></li><li><div>      window.wpPressThisData = &lt;?php echo wp_json_encode( $site_data ); ?&gt;;&nbsp;</div></li><li><div>      window.wpPressThisConfig = &lt;?php echo wp_json_encode( $site_settings ); ?&gt;;&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>      var ajaxurl = '&lt;?php echo esc_js( admin_url( 'admin-ajax.php', 'relative' ) ); ?&gt;', &nbsp;</div></li><li><div>          pagenow = 'press-this', &nbsp;</div></li><li><div>          typenow = 'post', &nbsp;</div></li><li><div>          adminpage = 'press-this-php', &nbsp;</div></li><li><div>          thousandsSeparator = '&lt;?php echo addslashes( $wp_locale-&gt;number_format['thousands_sep'] ); ?&gt;', &nbsp;</div></li><li><div>          decimalPoint = '&lt;?php echo addslashes( $wp_locale-&gt;number_format['decimal_point'] ); ?&gt;', &nbsp;</div></li><li><div>          isRtl = &lt;?php echo (int) is_rtl(); ?&gt;;&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * $post-&gt;ID is needed for the embed shortcode so we can show oEmbed previews in the editor.</span>&nbsp;</div></li><li><div><span class="comment">       * Maybe find a way without it.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $post = get_default_post_to_edit( 'post', true );&nbsp;</div></li><li><div>      $post_ID = (int) $post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_enqueue_media( array( 'post' =&gt; $post_ID ) );&nbsp;</div></li><li><div>      wp_enqueue_style( 'press-this' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'press-this' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'json2' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'editor' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $categories_tax = get_taxonomy( 'category' );&nbsp;</div></li><li><div>      $show_categories = current_user_can( $categories_tax-&gt;cap-&gt;assign_terms ) || current_user_can( $categories_tax-&gt;cap-&gt;edit_terms );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tag_tax = get_taxonomy( 'post_tag' );&nbsp;</div></li><li><div>      $show_tags = current_user_can( $tag_tax-&gt;cap-&gt;assign_terms );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $supports_formats = false;&nbsp;</div></li><li><div>      $post_format = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( current_theme_supports( 'post-formats' ) && post_type_supports( $post-&gt;post_type, 'post-formats' ) ) {&nbsp;</div></li><li><div>          $supports_formats = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! ( $post_format = get_post_format( $post_ID ) ) ) {&nbsp;</div></li><li><div>              $post_format = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-header.php */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'admin_enqueue_scripts', 'press-this.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-header.php */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'admin_print_styles-press-this.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-header.php */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'admin_print_styles' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-header.php */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'admin_print_scripts-press-this.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-header.php */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'admin_print_scripts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-header.php */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'admin_head-press-this.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-header.php */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      do_action( 'admin_head' );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&lt;/head&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $admin_body_class = 'press-this';&nbsp;</div></li><li><div>  $admin_body_class .= ( is_rtl() ) ? ' rtl' : '';&nbsp;</div></li><li><div>  $admin_body_class .= ' branch-' . str_replace( array( '.', ', ' ), '-', floatval( $wp_version ) );&nbsp;</div></li><li><div>  $admin_body_class .= ' version-' . str_replace( '.', '-', preg_replace( '/^([.0-9]+).*/', '$1', $wp_version ) );&nbsp;</div></li><li><div>  $admin_body_class .= ' admin-color-' . sanitize_html_class( get_user_option( 'admin_color' ), 'fresh' );&nbsp;</div></li><li><div>  $admin_body_class .= ' locale-' . sanitize_html_class( strtolower( str_replace( '_', '-', get_user_locale() ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** This filter is documented in wp-admin/admin-header.php */</span>&nbsp;</div></li><li><div>  $admin_body_classes = apply_filters( 'admin_body_class', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;body class=&quot;wp-admin wp-core-ui &lt;?php echo $admin_body_classes . ' ' . $admin_body_class; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;adminbar&quot; class=&quot;adminbar&quot;&gt;&nbsp;</div></li><li><div>      &lt;h1 id=&quot;current-site&quot; class=&quot;current-site&quot;&gt;&nbsp;</div></li><li><div>          &lt;a class=&quot;current-site-link&quot; href=&quot;&lt;?php echo esc_url( home_url( '/' ) ); ?&gt;&quot; target=&quot;_blank&quot; rel=&quot;home&quot;&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;dashicons dashicons-wordpress&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;current-site-name&quot;&gt;&lt;?php bloginfo( 'name' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/a&gt;&nbsp;</div></li><li><div>      &lt;/h1&gt;&nbsp;</div></li><li><div>      &lt;button type=&quot;button&quot; class=&quot;options button-link closed&quot;&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;dashicons dashicons-tag on-closed&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;screen-reader-text on-closed&quot;&gt;&lt;?php _e( 'Show post options' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;span aria-hidden=&quot;true&quot; class=&quot;on-open&quot;&gt;&lt;?php _e( 'Done' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;screen-reader-text on-open&quot;&gt;&lt;?php _e( 'Hide post options' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/button&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div id=&quot;scanbar&quot; class=&quot;scan&quot;&gt;&nbsp;</div></li><li><div>      &lt;form method=&quot;GET&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;url-scan&quot; class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Scan site for content' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;url&quot; name=&quot;u&quot; id=&quot;url-scan&quot; class=&quot;scan-url&quot; value=&quot;&lt;?php echo esc_attr( $site_data['u'] ) ?&gt;&quot; placeholder=&quot;&lt;?php esc_attr_e( 'Enter a URL to scan' ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;submit&quot; name=&quot;url-scan-submit&quot; id=&quot;url-scan-submit&quot; class=&quot;scan-submit&quot; value=&quot;&lt;?php esc_attr_e( 'Scan' ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>          &lt;?php wp_nonce_field( 'scan-site' ); ?&gt;&nbsp;</div></li><li><div>      &lt;/form&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;form id=&quot;pressthis-form&quot; method=&quot;post&quot; action=&quot;post.php&quot; autocomplete=&quot;off&quot;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;post_ID&quot; id=&quot;post_ID&quot; value=&quot;&lt;?php echo $post_ID; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;press-this-save-post&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;post_status&quot; id=&quot;post_status&quot; value=&quot;draft&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;wp-preview&quot; id=&quot;wp-preview&quot; value=&quot;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;post_title&quot; id=&quot;post_title&quot; value=&quot;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;pt-force-redirect&quot; id=&quot;pt-force-redirect&quot; value=&quot;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_nonce_field( 'update-post_' . $post_ID, '_wpnonce', false );&nbsp;</div></li><li><div>      wp_nonce_field( 'add-category', '_ajax_nonce-add-category', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;wrapper&quot;&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;editor-wrapper&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;alerts&quot; role=&quot;alert&quot; aria-live=&quot;assertive&quot; aria-relevant=&quot;all&quot; aria-atomic=&quot;true&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $data['v'] ) && $this-&gt;version &gt; $data['v'] ) {&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>                  &lt;p class=&quot;alert is-notice&quot;&gt;&nbsp;</div></li><li><div>                      &lt;?php printf( __( 'You should upgrade &lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;your bookmarklet&lt;/a&gt; to the latest version!' ), admin_url( 'tools.php' ) ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/p&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div id=&quot;app-container&quot; class=&quot;editor&quot;&gt;&nbsp;</div></li><li><div>              &lt;span id=&quot;title-container-label&quot; class=&quot;post-title-placeholder&quot; aria-hidden=&quot;true&quot;&gt;&lt;?php _e( 'Post title' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;h2 id=&quot;title-container&quot; class=&quot;post-title&quot; contenteditable=&quot;true&quot; spellcheck=&quot;true&quot; aria-label=&quot;&lt;?php esc_attr_e( 'Post title' ); ?&gt;&quot; tabindex=&quot;0&quot;&gt;&lt;?php echo esc_html( $post_title ); ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;media-list-container&quot;&gt;&nbsp;</div></li><li><div>                  &lt;div class=&quot;media-list-inner-container&quot;&gt;&nbsp;</div></li><li><div>                      &lt;h2 class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Suggested media' ); ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>                      &lt;ul class=&quot;media-list&quot;&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>              wp_editor( $post_content, 'pressthis', array(&nbsp;</div></li><li><div>                  'drag_drop_upload' =&gt; true, &nbsp;</div></li><li><div>                  'editor_height' =&gt; 600, &nbsp;</div></li><li><div>                  'media_buttons' =&gt; false, &nbsp;</div></li><li><div>                  'textarea_name' =&gt; 'post_content', &nbsp;</div></li><li><div>                  'teeny' =&gt; true, &nbsp;</div></li><li><div>                  'tinymce' =&gt; array(&nbsp;</div></li><li><div>                      'resize' =&gt; false, &nbsp;</div></li><li><div>                      'wordpress_adv_hidden' =&gt; false, &nbsp;</div></li><li><div>                      'add_unload_trigger' =&gt; false, &nbsp;</div></li><li><div>                      'statusbar' =&gt; false, &nbsp;</div></li><li><div>                      'autoresize_min_height' =&gt; 600, &nbsp;</div></li><li><div>                      'wp_autoresize_on' =&gt; true, &nbsp;</div></li><li><div>                      'plugins' =&gt; 'lists, media, paste, tabfocus, fullscreen, wordpress, wpautoresize, wpeditimage, wpgallery, wplink, wptextpattern, wpview', &nbsp;</div></li><li><div>                      'toolbar1' =&gt; 'bold, italic, bullist, numlist, blockquote, link, unlink', &nbsp;</div></li><li><div>                      'toolbar2' =&gt; 'undo, redo', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  'quicktags' =&gt; array(&nbsp;</div></li><li><div>                      'buttons' =&gt; 'strong, em, link, block, del, ins, img, ul, ol, li, code, more', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;div class=&quot;options-panel-back is-hidden&quot; tabindex=&quot;-1&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;options-panel is-off-screen is-hidden&quot; tabindex=&quot;-1&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;post-options&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php if ( $supports_formats ) : ?&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-link post-option&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons dashicons-admin-post&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;post-option-title&quot;&gt;&lt;?php _ex( 'Format', 'post format' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;post-option-contents&quot; id=&quot;post-option-post-format&quot;&gt;&lt;?php echo esc_html( get_post_format_string( $post_format ) ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons post-option-forward&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>              &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php if ( $show_categories ) : ?&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-link post-option&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons dashicons-category&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;post-option-title&quot;&gt;&lt;?php _e( 'Categories' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons post-option-forward&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>              &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php if ( $show_tags ) : ?&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-link post-option&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons dashicons-tag&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;post-option-title&quot;&gt;&lt;?php _e( 'Tags' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons post-option-forward&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>              &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php if ( $supports_formats ) : ?&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;setting-modal is-off-screen is-hidden&quot;&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-link modal-close&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons post-option-back&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;setting-title&quot; aria-hidden=&quot;true&quot;&gt;&lt;?php _ex( 'Format', 'post format' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Back to post options' ) ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>                  &lt;?php $this-&gt;post_formats_html( $post ); ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php if ( $show_categories ) : ?&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;setting-modal is-off-screen is-hidden&quot;&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-link modal-close&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons post-option-back&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;setting-title&quot; aria-hidden=&quot;true&quot;&gt;&lt;?php _e( 'Categories' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Back to post options' ) ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>                  &lt;?php $this-&gt;categories_html( $post ); ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php if ( $show_tags ) : ?&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;setting-modal tags is-off-screen is-hidden&quot;&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;button-link modal-close&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;dashicons post-option-back&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;setting-title&quot; aria-hidden=&quot;true&quot;&gt;&lt;?php _e( 'Tags' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Back to post options' ) ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>                  &lt;?php $this-&gt;tags_html( $post ); ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&lt;!-- .options-panel --&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&lt;!-- .wrapper --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;press-this-actions&quot;&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;pressthis-media-buttons&quot;&gt;&nbsp;</div></li><li><div>          &lt;button type=&quot;button&quot; class=&quot;insert-media button-link&quot; data-editor=&quot;pressthis&quot;&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;dashicons dashicons-admin-media&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e( 'Add Media' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/button&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;post-actions&quot;&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;spinner&quot;&gt;&nbsp;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;split-button&quot;&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;split-button-head&quot;&gt;&nbsp;</div></li><li><div>                  &lt;button type=&quot;button&quot; class=&quot;publish-button split-button-primary&quot; aria-live=&quot;polite&quot;&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;publish&quot;&gt;&lt;?php echo ( current_user_can( 'publish_posts' ) ) ? __( 'Publish' ) : __( 'Submit for Review' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;saving-draft&quot;&gt;&lt;?php _e( 'Saving&hellip;' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&lt;button type=&quot;button&quot; class=&quot;split-button-toggle&quot; aria-haspopup=&quot;true&quot; aria-expanded=&quot;false&quot;&gt;&nbsp;</div></li><li><div>                      &lt;i class=&quot;dashicons dashicons-arrow-down-alt2&quot;&gt;&lt;/i&gt;&nbsp;</div></li><li><div>                      &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php _e('More actions'); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;/button&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;ul class=&quot;split-button-body&quot;&gt;&nbsp;</div></li><li><div>                  &lt;li&gt;&lt;button type=&quot;button&quot; class=&quot;button-link draft-button split-button-option&quot;&gt;&lt;?php _e( 'Save Draft' ); ?&gt;&lt;/button&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                  &lt;li&gt;&lt;button type=&quot;button&quot; class=&quot;button-link standard-editor-button split-button-option&quot;&gt;&lt;?php _e( 'Standard Editor' ); ?&gt;&lt;/button&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                  &lt;li&gt;&lt;button type=&quot;button&quot; class=&quot;button-link preview-button split-button-option&quot;&gt;&lt;?php _e( 'Preview' ); ?&gt;&lt;/button&gt;&lt;/li&gt;&nbsp;</div></li><li><div>              &lt;/ul&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-footer.php */</span></span></span></span>&nbsp;</div></li><li><div>  do_action( 'admin_footer' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-footer.php */</span></span></span></span>&nbsp;</div></li><li><div>  do_action( 'admin_print_footer_scripts-press-this.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-footer.php */</span></span></span></span>&nbsp;</div></li><li><div>  do_action( 'admin_print_footer_scripts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-admin/admin-footer.php */</span></span></span></span>&nbsp;</div></li><li><div>  do_action( 'admin_footer-press-this.php' );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&lt;/body&gt;&nbsp;</div></li><li><div>&lt;/html&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      die();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-admin</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>