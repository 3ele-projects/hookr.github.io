<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="wordpress" data-version="4.7.4" data-type="file" data-id="4971"><head xmlns="http://www.w3.org/1999/xhtml"><title> wp-includes-theme | file | WordPress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, wordpress, 4.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=bbc80c20a212530c94cbc98eda833838' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/wp-includes-theme/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-theme%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwp-includes-theme%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"wordpress-4.7.4-file-wp-includes-theme","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wp-includes-theme" class="blog single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.4." href="http://hookr.io/4.7.4/" class="H_VERSION"><span property="name">4.7.4</span></a><meta property="position" content="2"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wp-includes-theme</span><meta property="position" content="3"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="6316"><a href="http://hookr.io/4.7.4/all/" title="All">All <span class="count badge">6316</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/4.7.4/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="2538"><a href="http://hookr.io/4.7.4/hooks/" title="Hooks">Hooks <span class="count badge">2538</span></a></li><li class="" data-id="action" data-count="864"><a href="http://hookr.io/4.7.4/actions/" title="Actions">Actions <span class="count badge">864</span></a></li><li class="" data-id="filter" data-count="1674"><a href="http://hookr.io/4.7.4/filters/" title="Filters">Filters <span class="count badge">1674</span></a></li><li class="" data-id="class" data-count="351"><a href="http://hookr.io/4.7.4/classes/" title="Classes">Classes <span class="count badge">351</span></a></li><li class="" data-id="constant" data-count="566"><a href="http://hookr.io/4.7.4/constants/" title="Constants">Constants <span class="count badge">566</span></a></li><li class="" data-id="function" data-count="2853"><a href="http://hookr.io/4.7.4/functions/" title="Functions">Functions <span class="count badge">2853</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/4.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class="active"><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/wp-includes/theme.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Theme, template, and stylesheet functions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Theme</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns an array of WP_Theme objects based on the arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Despite advances over get_themes(), this function is quite expensive, and grows</span>&nbsp;</div></li><li><div><span class="comment"> * linearly with additional themes. Stick to wp_get_theme() if possible.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar array $_themes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args The search arguments. Optional.</span>&nbsp;</div></li><li><div><span class="comment"> * - errors      mixed  True to return themes with errors, false to return themes without errors, null</span>&nbsp;</div></li><li><div><span class="comment"> *                      to return all themes. Defaults to false.</span>&nbsp;</div></li><li><div><span class="comment"> * - allowed     mixed  (Multisite) True to return only allowed themes for a site. False to return only</span>&nbsp;</div></li><li><div><span class="comment"> *                      disallowed themes for a site. 'site' to return only site-allowed themes. 'network'</span>&nbsp;</div></li><li><div><span class="comment"> *                      to return only network-allowed themes. Null to return all themes. Defaults to null.</span>&nbsp;</div></li><li><div><span class="comment"> * - blog_id     int    (Multisite) The blog ID used to calculate which themes are allowed. Defaults to 0, </span>&nbsp;</div></li><li><div><span class="comment"> *                      synonymous for the current blog.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Array of WP_Theme objects.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_themes( $args = array() ) {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array( 'errors' =&gt; false, 'allowed' =&gt; null, 'blog_id' =&gt; 0 );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $theme_directories = search_theme_directories();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $wp_theme_directories ) &gt; 1 ) {&nbsp;</div></li><li><div>      <span class="comment">// Make sure the current theme wins out, in case search_theme_directories() picks the wrong</span>&nbsp;</div></li><li><div>      <span class="comment">// one in the case of a conflict. (Normally, last registered theme root wins.)</span>&nbsp;</div></li><li><div>      $current_theme = get_stylesheet();&nbsp;</div></li><li><div>      if ( isset( $theme_directories[ $current_theme ] ) ) {&nbsp;</div></li><li><div>          $root_of_current_theme = get_raw_theme_root( $current_theme );&nbsp;</div></li><li><div>          if ( ! in_array( $root_of_current_theme, $wp_theme_directories ) )&nbsp;</div></li><li><div>              $root_of_current_theme = WP_CONTENT_DIR . $root_of_current_theme;&nbsp;</div></li><li><div>          $theme_directories[ $current_theme ]['theme_root'] = $root_of_current_theme;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $theme_directories ) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_multisite() && null !== $args['allowed'] ) {&nbsp;</div></li><li><div>      $allowed = $args['allowed'];&nbsp;</div></li><li><div>      if ( 'network' === $allowed )&nbsp;</div></li><li><div>          $theme_directories = array_intersect_key( $theme_directories, WP_Theme::get_allowed_on_network() );&nbsp;</div></li><li><div>      elseif ( 'site' === $allowed )&nbsp;</div></li><li><div>          $theme_directories = array_intersect_key( $theme_directories, WP_Theme::get_allowed_on_site( $args['blog_id'] ) );&nbsp;</div></li><li><div>      elseif ( $allowed )&nbsp;</div></li><li><div>          $theme_directories = array_intersect_key( $theme_directories, WP_Theme::get_allowed( $args['blog_id'] ) );&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $theme_directories = array_diff_key( $theme_directories, WP_Theme::get_allowed( $args['blog_id'] ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $themes = array();&nbsp;</div></li><li><div>  static $_themes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $theme_directories as $theme =&gt; $theme_root ) {&nbsp;</div></li><li><div>      if ( isset( $_themes[ $theme_root['theme_root'] . '/' . $theme ] ) )&nbsp;</div></li><li><div>          $themes[ $theme ] = $_themes[ $theme_root['theme_root'] . '/' . $theme ];&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $themes[ $theme ] = $_themes[ $theme_root['theme_root'] . '/' . $theme ] = new WP_Theme( $theme, $theme_root['theme_root'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( null !== $args['errors'] ) {&nbsp;</div></li><li><div>      foreach ( $themes as $theme =&gt; $wp_theme ) {&nbsp;</div></li><li><div>          if ( $wp_theme-&gt;errors() != $args['errors'] )&nbsp;</div></li><li><div>              unset( $themes[ $theme ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $themes;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets a WP_Theme object for a theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet Directory name for the theme. Optional. Defaults to current theme.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $theme_root Absolute path of the theme root to look in. Optional. If not specified, get_raw_theme_root()</span>&nbsp;</div></li><li><div><span class="comment"> *                              is used to calculate the theme root for the $stylesheet provided (or current theme).</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Theme Theme object. Be sure to check the object's exists() method if you need to confirm the theme's existence.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_theme( $stylesheet = null, $theme_root = null ) {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $stylesheet ) )&nbsp;</div></li><li><div>      $stylesheet = get_stylesheet();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $theme_root ) ) {&nbsp;</div></li><li><div>      $theme_root = get_raw_theme_root( $stylesheet );&nbsp;</div></li><li><div>      if ( false === $theme_root )&nbsp;</div></li><li><div>          $theme_root = WP_CONTENT_DIR . '/themes';&nbsp;</div></li><li><div>      elseif ( ! in_array( $theme_root, (array) $wp_theme_directories ) )&nbsp;</div></li><li><div>          $theme_root = WP_CONTENT_DIR . $theme_root;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return new WP_Theme( $stylesheet, $theme_root );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Clears the cache held by get_theme_roots() and WP_Theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $clear_update_cache Whether to clear the Theme updates cache</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_clean_themes_cache( $clear_update_cache = true ) {&nbsp;</div></li><li><div>  if ( $clear_update_cache )&nbsp;</div></li><li><div>      delete_site_transient( 'update_themes' );&nbsp;</div></li><li><div>  search_theme_directories( true );&nbsp;</div></li><li><div>  foreach ( wp_get_themes( array( 'errors' =&gt; null ) ) as $theme )&nbsp;</div></li><li><div>      $theme-&gt;cache_delete();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether a child theme is in use.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool true if a child theme is in use, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> **/</span>&nbsp;</div></li><li><div>function is_child_theme() {&nbsp;</div></li><li><div>  return ( TEMPLATEPATH !== STYLESHEETPATH );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve name of the current stylesheet.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The theme name that the administrator has currently set the front end theme</span>&nbsp;</div></li><li><div><span class="comment"> * as.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * For all intents and purposes, the template name and the stylesheet name are</span>&nbsp;</div></li><li><div><span class="comment"> * going to be the same for most cases.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Stylesheet name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_stylesheet() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the name of current stylesheet.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet Name of the current stylesheet.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'stylesheet', get_option( 'stylesheet' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve stylesheet directory path for current theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Path to current theme directory.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_stylesheet_directory() {&nbsp;</div></li><li><div>  $stylesheet = get_stylesheet();&nbsp;</div></li><li><div>  $theme_root = get_theme_root( $stylesheet );&nbsp;</div></li><li><div>  $stylesheet_dir = &quot;$theme_root/$stylesheet&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the stylesheet directory path for current theme.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet_dir Absolute path to the current theme.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet     Directory name of the current theme.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $theme_root     Absolute path to themes directory.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'stylesheet_directory', $stylesheet_dir, $stylesheet, $theme_root );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve stylesheet directory URI.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_stylesheet_directory_uri() {&nbsp;</div></li><li><div>  $stylesheet = str_replace( '%2F', '/', rawurlencode( get_stylesheet() ) );&nbsp;</div></li><li><div>  $theme_root_uri = get_theme_root_uri( $stylesheet );&nbsp;</div></li><li><div>  $stylesheet_dir_uri = &quot;$theme_root_uri/$stylesheet&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the stylesheet directory URI.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet_dir_uri Stylesheet directory URI.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet         Name of the activated theme's directory.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $theme_root_uri     Themes root URI.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'stylesheet_directory_uri', $stylesheet_dir_uri, $stylesheet, $theme_root_uri );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the URI of current theme stylesheet.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The stylesheet file name is 'style.css' which is appended to the stylesheet directory URI path.</span>&nbsp;</div></li><li><div><span class="comment"> * See get_stylesheet_directory_uri().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_stylesheet_uri() {&nbsp;</div></li><li><div>  $stylesheet_dir_uri = get_stylesheet_directory_uri();&nbsp;</div></li><li><div>  $stylesheet_uri = $stylesheet_dir_uri . '/style.css';&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the URI of the current theme stylesheet.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet_uri     Stylesheet URI for the current theme/child theme.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet_dir_uri Stylesheet directory URI for the current theme/child theme.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'stylesheet_uri', $stylesheet_uri, $stylesheet_dir_uri );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the localized stylesheet URI.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The stylesheet directory for the localized stylesheet files are located, by</span>&nbsp;</div></li><li><div><span class="comment"> * default, in the base theme directory. The name of the locale file will be the</span>&nbsp;</div></li><li><div><span class="comment"> * locale followed by '.css'. If that does not exist, then the text direction</span>&nbsp;</div></li><li><div><span class="comment"> * stylesheet will be checked for existence, for example 'ltr.css'.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The theme may change the location of the stylesheet directory by either using</span>&nbsp;</div></li><li><div><span class="comment"> * the {@see 'stylesheet_directory_uri'} or {@see 'locale_stylesheet_uri'} filters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If you want to change the location of the stylesheet files for the entire</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress workflow, then change the former. If you just have the locale in a</span>&nbsp;</div></li><li><div><span class="comment"> * separate folder, then change the latter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Locale $wp_locale</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_locale_stylesheet_uri() {&nbsp;</div></li><li><div>  global $wp_locale;&nbsp;</div></li><li><div>  $stylesheet_dir_uri = get_stylesheet_directory_uri();&nbsp;</div></li><li><div>  $dir = get_stylesheet_directory();&nbsp;</div></li><li><div>  $locale = get_locale();&nbsp;</div></li><li><div>  if ( file_exists(&quot;$dir/$locale.css&quot;) )&nbsp;</div></li><li><div>      $stylesheet_uri = &quot;$stylesheet_dir_uri/$locale.css&quot;;&nbsp;</div></li><li><div>  elseif ( !empty($wp_locale-&gt;text_direction) && file_exists(&quot;$dir/{$wp_locale-&gt;text_direction}.css&quot;) )&nbsp;</div></li><li><div>      $stylesheet_uri = &quot;$stylesheet_dir_uri/{$wp_locale-&gt;text_direction}.css&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $stylesheet_uri = '';&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the localized stylesheet URI.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet_uri     Localized stylesheet URI.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet_dir_uri Stylesheet directory URI.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'locale_stylesheet_uri', $stylesheet_uri, $stylesheet_dir_uri );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve name of the current theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Template name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_template() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the name of the current theme.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template Current theme's directory name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'template', get_option( 'template' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve current theme directory.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Template directory path.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_template_directory() {&nbsp;</div></li><li><div>  $template = get_template();&nbsp;</div></li><li><div>  $theme_root = get_theme_root( $template );&nbsp;</div></li><li><div>  $template_dir = &quot;$theme_root/$template&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the current theme directory path.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template_dir The URI of the current theme directory.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template     Directory name of the current theme.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $theme_root   Absolute path to the themes directory.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'template_directory', $template_dir, $template, $theme_root );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve theme directory URI.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Template directory URI.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_template_directory_uri() {&nbsp;</div></li><li><div>  $template = str_replace( '%2F', '/', rawurlencode( get_template() ) );&nbsp;</div></li><li><div>  $theme_root_uri = get_theme_root_uri( $template );&nbsp;</div></li><li><div>  $template_dir_uri = &quot;$theme_root_uri/$template&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the current theme directory URI.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template_dir_uri The URI of the current theme directory.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template         Directory name of the current theme.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $theme_root_uri   The themes root URI.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'template_directory_uri', $template_dir_uri, $template, $theme_root_uri );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve theme roots.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|string An array of theme roots keyed by template/stylesheet or a single theme root if all themes have the same root.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_theme_roots() {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count($wp_theme_directories) &lt;= 1 )&nbsp;</div></li><li><div>      return '/themes';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $theme_roots = get_site_transient( 'theme_roots' );&nbsp;</div></li><li><div>  if ( false === $theme_roots ) {&nbsp;</div></li><li><div>      search_theme_directories( true ); <span class="comment">// Regenerate the transient.</span>&nbsp;</div></li><li><div>      $theme_roots = get_site_transient( 'theme_roots' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $theme_roots;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register a directory that contains themes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $directory Either the full filesystem path to a theme folder or a folder within WP_CONTENT_DIR</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function register_theme_directory( $directory ) {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! file_exists( $directory ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Try prepending as the theme directory could be relative to the content directory</span>&nbsp;</div></li><li><div>      $directory = WP_CONTENT_DIR . '/' . $directory;&nbsp;</div></li><li><div>      <span class="comment">// If this directory does not exist, return and do not register</span>&nbsp;</div></li><li><div>      if ( ! file_exists( $directory ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $wp_theme_directories ) ) {&nbsp;</div></li><li><div>      $wp_theme_directories = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $untrailed = untrailingslashit( $directory );&nbsp;</div></li><li><div>  if ( ! empty( $untrailed ) && ! in_array( $untrailed, $wp_theme_directories ) ) {&nbsp;</div></li><li><div>      $wp_theme_directories[] = $untrailed;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Search all registered theme directories for complete and valid themes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar array $found_themes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $force Optional. Whether to force a new directory scan. Defaults to false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|false Valid themes found</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function search_theme_directories( $force = false ) {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>  static $found_themes = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $wp_theme_directories ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $force && isset( $found_themes ) )&nbsp;</div></li><li><div>      return $found_themes;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $found_themes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_theme_directories = (array) $wp_theme_directories;&nbsp;</div></li><li><div>  $relative_theme_roots = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set up maybe-relative, maybe-absolute array of theme directories.</span>&nbsp;</div></li><li><div>  <span class="comment">// We always want to return absolute, but we need to cache relative</span>&nbsp;</div></li><li><div>  <span class="comment">// to use in get_theme_root().</span>&nbsp;</div></li><li><div>  foreach ( $wp_theme_directories as $theme_root ) {&nbsp;</div></li><li><div>      if ( 0 === strpos( $theme_root, WP_CONTENT_DIR ) )&nbsp;</div></li><li><div>          $relative_theme_roots[ str_replace( WP_CONTENT_DIR, '', $theme_root ) ] = $theme_root;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $relative_theme_roots[ $theme_root ] = $theme_root;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to get the cache of the registered theme directories.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool   $cache_expiration Whether to get the cache of the theme directories. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $cache_directory  Directory to be searched for the cache.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( $cache_expiration = apply_filters( 'wp_cache_themes_persistently', false, 'search_theme_directories' ) ) {&nbsp;</div></li><li><div>      $cached_roots = get_site_transient( 'theme_roots' );&nbsp;</div></li><li><div>      if ( is_array( $cached_roots ) ) {&nbsp;</div></li><li><div>          foreach ( $cached_roots as $theme_dir =&gt; $theme_root ) {&nbsp;</div></li><li><div>              <span class="comment">// A cached theme root is no longer around, so skip it.</span>&nbsp;</div></li><li><div>              if ( ! isset( $relative_theme_roots[ $theme_root ] ) )&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              $found_themes[ $theme_dir ] = array(&nbsp;</div></li><li><div>                  'theme_file' =&gt; $theme_dir . '/style.css', &nbsp;</div></li><li><div>                  'theme_root' =&gt; $relative_theme_roots[ $theme_root ], <span class="comment">// Convert relative to absolute.</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $found_themes;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! is_int( $cache_expiration ) )&nbsp;</div></li><li><div>          $cache_expiration = 1800; <span class="comment"><span class="comment">// half hour</span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $cache_expiration = 1800; <span class="comment"><span class="comment">// half hour</span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Loop the registered theme directories and extract all themes */</span>&nbsp;</div></li><li><div>  foreach ( $wp_theme_directories as $theme_root ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Start with directories in the root of the current theme directory.</span>&nbsp;</div></li><li><div>      $dirs = @ scandir( $theme_root );&nbsp;</div></li><li><div>      if ( ! $dirs ) {&nbsp;</div></li><li><div>          trigger_error( &quot;$theme_root is not readable&quot;, E_USER_NOTICE );&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ( $dirs as $dir ) {&nbsp;</div></li><li><div>          if ( ! is_dir( $theme_root . '/' . $dir ) || $dir[0] == '.' || $dir == 'CVS' )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          if ( file_exists( $theme_root . '/' . $dir . '/style.css' ) ) {&nbsp;</div></li><li><div>              <span class="comment">// wp-content/themes/a-single-theme</span>&nbsp;</div></li><li><div>              <span class="comment">// wp-content/themes is $theme_root, a-single-theme is $dir</span>&nbsp;</div></li><li><div>              $found_themes[ $dir ] = array(&nbsp;</div></li><li><div>                  'theme_file' =&gt; $dir . '/style.css', &nbsp;</div></li><li><div>                  'theme_root' =&gt; $theme_root, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $found_theme = false;&nbsp;</div></li><li><div>              <span class="comment">// wp-content/themes/a-folder-of-themes/*</span>&nbsp;</div></li><li><div>              <span class="comment">// wp-content/themes is $theme_root, a-folder-of-themes is $dir, then themes are $sub_dirs</span>&nbsp;</div></li><li><div>              $sub_dirs = @ scandir( $theme_root . '/' . $dir );&nbsp;</div></li><li><div>              if ( ! $sub_dirs ) {&nbsp;</div></li><li><div>                  trigger_error( &quot;$theme_root/$dir is not readable&quot;, E_USER_NOTICE );&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              foreach ( $sub_dirs as $sub_dir ) {&nbsp;</div></li><li><div>                  if ( ! is_dir( $theme_root . '/' . $dir . '/' . $sub_dir ) || $dir[0] == '.' || $dir == 'CVS' )&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  if ( ! file_exists( $theme_root . '/' . $dir . '/' . $sub_dir . '/style.css' ) )&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  $found_themes[ $dir . '/' . $sub_dir ] = array(&nbsp;</div></li><li><div>                      'theme_file' =&gt; $dir . '/' . $sub_dir . '/style.css', &nbsp;</div></li><li><div>                      'theme_root' =&gt; $theme_root, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  $found_theme = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Never mind the above, it's just a theme missing a style.css.</span>&nbsp;</div></li><li><div>              <span class="comment">// Return it; WP_Theme will catch the error.</span>&nbsp;</div></li><li><div>              if ( ! $found_theme )&nbsp;</div></li><li><div>                  $found_themes[ $dir ] = array(&nbsp;</div></li><li><div>                      'theme_file' =&gt; $dir . '/style.css', &nbsp;</div></li><li><div>                      'theme_root' =&gt; $theme_root, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  asort( $found_themes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $theme_roots = array();&nbsp;</div></li><li><div>  $relative_theme_roots = array_flip( $relative_theme_roots );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $found_themes as $theme_dir =&gt; $theme_data ) {&nbsp;</div></li><li><div>      $theme_roots[ $theme_dir ] = $relative_theme_roots[ $theme_data['theme_root'] ]; <span class="comment">// Convert absolute to relative.</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $theme_roots != get_site_transient( 'theme_roots' ) )&nbsp;</div></li><li><div>      set_site_transient( 'theme_roots', $theme_roots, $cache_expiration );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $found_themes;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve path to themes directory.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Does not have trailing slash.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet_or_template The stylesheet or template name of the theme</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Theme path.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_theme_root( $stylesheet_or_template = false ) {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $stylesheet_or_template && $theme_root = get_raw_theme_root( $stylesheet_or_template ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Always prepend WP_CONTENT_DIR unless the root currently registered as a theme directory.</span>&nbsp;</div></li><li><div>      <span class="comment">// This gives relative theme roots the benefit of the doubt when things go haywire.</span>&nbsp;</div></li><li><div>      if ( ! in_array( $theme_root, (array) $wp_theme_directories ) )&nbsp;</div></li><li><div>          $theme_root = WP_CONTENT_DIR . $theme_root;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $theme_root = WP_CONTENT_DIR . '/themes';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the absolute path to the themes directory.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $theme_root Absolute path to themes directory.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'theme_root', $theme_root );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve URI for themes directory.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Does not have trailing slash.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet_or_template Optional. The stylesheet or template name of the theme.</span>&nbsp;</div></li><li><div><span class="comment"> *                                          Default is to leverage the main theme root.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $theme_root             Optional. The theme root for which calculations will be based, preventing</span>&nbsp;</div></li><li><div><span class="comment"> *                                          the need for a get_raw_theme_root() call.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Themes URI.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_theme_root_uri( $stylesheet_or_template = false, $theme_root = false ) {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $stylesheet_or_template && ! $theme_root )&nbsp;</div></li><li><div>      $theme_root = get_raw_theme_root( $stylesheet_or_template );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $stylesheet_or_template && $theme_root ) {&nbsp;</div></li><li><div>      if ( in_array( $theme_root, (array) $wp_theme_directories ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Absolute path. Make an educated guess. YMMV -- but note the filter below.</span>&nbsp;</div></li><li><div>          if ( 0 === strpos( $theme_root, WP_CONTENT_DIR ) )&nbsp;</div></li><li><div>              $theme_root_uri = content_url( str_replace( WP_CONTENT_DIR, '', $theme_root ) );&nbsp;</div></li><li><div>          elseif ( 0 === strpos( $theme_root, ABSPATH ) )&nbsp;</div></li><li><div>              $theme_root_uri = site_url( str_replace( ABSPATH, '', $theme_root ) );&nbsp;</div></li><li><div>          elseif ( 0 === strpos( $theme_root, WP_PLUGIN_DIR ) || 0 === strpos( $theme_root, WPMU_PLUGIN_DIR ) )&nbsp;</div></li><li><div>              $theme_root_uri = plugins_url( basename( $theme_root ), $theme_root );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $theme_root_uri = $theme_root;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $theme_root_uri = content_url( $theme_root );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $theme_root_uri = content_url( 'themes' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the URI for themes directory.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $theme_root_uri         The URI for themes directory.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $siteurl                WordPress web address which is set in General Options.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet_or_template Stylesheet or template name of the theme.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'theme_root_uri', $theme_root_uri, get_option( 'siteurl' ), $stylesheet_or_template );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the raw theme root relative to the content directory with no filters applied.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet_or_template The stylesheet or template name of the theme</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $skip_cache             Optional. Whether to skip the cache.</span>&nbsp;</div></li><li><div><span class="comment"> *                                       Defaults to false, meaning the cache is used.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Theme root</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_raw_theme_root( $stylesheet_or_template, $skip_cache = false ) {&nbsp;</div></li><li><div>  global $wp_theme_directories;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count($wp_theme_directories) &lt;= 1 )&nbsp;</div></li><li><div>      return '/themes';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $theme_root = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If requesting the root for the current theme, consult options to avoid calling get_theme_roots()</span>&nbsp;</div></li><li><div>  if ( ! $skip_cache ) {&nbsp;</div></li><li><div>      if ( get_option('stylesheet') == $stylesheet_or_template )&nbsp;</div></li><li><div>          $theme_root = get_option('stylesheet_root');&nbsp;</div></li><li><div>      elseif ( get_option('template') == $stylesheet_or_template )&nbsp;</div></li><li><div>          $theme_root = get_option('template_root');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty($theme_root) ) {&nbsp;</div></li><li><div>      $theme_roots = get_theme_roots();&nbsp;</div></li><li><div>      if ( !empty($theme_roots[$stylesheet_or_template]) )&nbsp;</div></li><li><div>          $theme_root = $theme_roots[$stylesheet_or_template];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $theme_root;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display localized stylesheet link element.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function locale_stylesheet() {&nbsp;</div></li><li><div>  $stylesheet = get_locale_stylesheet_uri();&nbsp;</div></li><li><div>  if ( empty($stylesheet) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  echo '&lt;link rel=&quot;stylesheet&quot; href=&quot;' . $stylesheet . '&quot; type=&quot;text/css&quot; media=&quot;screen&quot; /&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Switches the theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Accepts one argument: $stylesheet of the theme. It also accepts an additional function signature</span>&nbsp;</div></li><li><div><span class="comment"> * of two arguments: $template then $stylesheet. This is for backward compatibility.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array                $wp_theme_directories</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Customize_Manager $wp_customize</span>&nbsp;</div></li><li><div><span class="comment"> * @global array                $sidebars_widgets</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet Stylesheet name</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function switch_theme( $stylesheet ) {&nbsp;</div></li><li><div>  global $wp_theme_directories, $wp_customize, $sidebars_widgets;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_sidebars_widgets = null;&nbsp;</div></li><li><div>  if ( 'wp_ajax_customize_save' === current_action() ) {&nbsp;</div></li><li><div>      $_sidebars_widgets = $wp_customize-&gt;post_value( $wp_customize-&gt;get_setting( 'old_sidebars_widgets_data' ) );&nbsp;</div></li><li><div>  } elseif ( is_array( $sidebars_widgets ) ) {&nbsp;</div></li><li><div>      $_sidebars_widgets = $sidebars_widgets;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array( $_sidebars_widgets ) ) {&nbsp;</div></li><li><div>      set_theme_mod( 'sidebars_widgets', array( 'time' =&gt; time(), 'data' =&gt; $_sidebars_widgets ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $nav_menu_locations = get_theme_mod( 'nav_menu_locations' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( func_num_args() &gt; 1 ) {&nbsp;</div></li><li><div>      $stylesheet = func_get_arg( 1 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $old_theme = wp_get_theme();&nbsp;</div></li><li><div>  $new_theme = wp_get_theme( $stylesheet );&nbsp;</div></li><li><div>  $template = $new_theme-&gt;get_template();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  update_option( 'template', $template );&nbsp;</div></li><li><div>  update_option( 'stylesheet', $stylesheet );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $wp_theme_directories ) &gt; 1 ) {&nbsp;</div></li><li><div>      update_option( 'template_root', get_raw_theme_root( $template, true ) );&nbsp;</div></li><li><div>      update_option( 'stylesheet_root', get_raw_theme_root( $stylesheet, true ) );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      delete_option( 'template_root' );&nbsp;</div></li><li><div>      delete_option( 'stylesheet_root' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $new_name = $new_theme-&gt;get('Name');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  update_option( 'current_theme', $new_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Migrate from the old mods_{name} option to theme_mods_{slug}.</span>&nbsp;</div></li><li><div>  if ( is_admin() && false === get_option( 'theme_mods_' . $stylesheet ) ) {&nbsp;</div></li><li><div>      $default_theme_mods = (array) get_option( 'mods_' . $new_name );&nbsp;</div></li><li><div>      if ( ! empty( $nav_menu_locations ) && empty( $default_theme_mods['nav_menu_locations'] ) ) {&nbsp;</div></li><li><div>          $default_theme_mods['nav_menu_locations'] = $nav_menu_locations;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      add_option( &quot;theme_mods_$stylesheet&quot;, $default_theme_mods );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Since retrieve_widgets() is called when initializing a theme in the Customizer, </span>&nbsp;</div></li><li><div><span class="comment">       * we need to remove the theme mods to avoid overwriting changes made via</span>&nbsp;</div></li><li><div><span class="comment">       * the Customizer when accessing wp-admin/widgets.php.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( 'wp_ajax_customize_save' === current_action() ) {&nbsp;</div></li><li><div>          remove_theme_mod( 'sidebars_widgets' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $nav_menu_locations ) ) {&nbsp;</div></li><li><div>          $nav_mods = get_theme_mod( 'nav_menu_locations' );&nbsp;</div></li><li><div>          if ( empty( $nav_mods ) ) {&nbsp;</div></li><li><div>              set_theme_mod( 'nav_menu_locations', $nav_menu_locations );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  update_option( 'theme_switched', $old_theme-&gt;get_stylesheet() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the theme is switched.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.5.0 Introduced the `$old_theme` parameter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string   $new_name  Name of the new theme.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Theme $new_theme WP_Theme instance of the new theme.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Theme $old_theme WP_Theme instance of the old theme.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'switch_theme', $new_name, $new_theme, $old_theme );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks that current theme files 'index.php' and 'style.css' exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Does not initially check the default theme, which is the fallback and should always exist.</span>&nbsp;</div></li><li><div><span class="comment"> * But if it doesn't exist, it'll fall back to the latest core default theme that does exist.</span>&nbsp;</div></li><li><div><span class="comment"> * Will switch theme to the fallback theme if current theme does not validate.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You can use the {@see 'validate_current_theme'} filter to return false to</span>&nbsp;</div></li><li><div><span class="comment"> * disable this functionality.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see WP_DEFAULT_THEME</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function validate_current_theme() {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether to validate the current theme.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $validate Whether to validate the current theme. Default true.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( wp_installing() || ! apply_filters( 'validate_current_theme', true ) )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! file_exists( get_template_directory() . '/index.php' ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Invalid.</span></span></span>&nbsp;</div></li><li><div>  } elseif ( ! file_exists( get_template_directory() . '/style.css' ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Invalid.</span></span></span>&nbsp;</div></li><li><div>  } elseif ( is_child_theme() && ! file_exists( get_stylesheet_directory() . '/style.css' ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Invalid.</span></span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Valid.</span>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $default = wp_get_theme( WP_DEFAULT_THEME );&nbsp;</div></li><li><div>  if ( $default-&gt;exists() ) {&nbsp;</div></li><li><div>      switch_theme( WP_DEFAULT_THEME );&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * If we're in an invalid state but WP_DEFAULT_THEME doesn't exist, </span>&nbsp;</div></li><li><div><span class="comment">   * switch to the latest core default theme that's installed.</span>&nbsp;</div></li><li><div><span class="comment">   * If it turns out that this latest core default theme is our current</span>&nbsp;</div></li><li><div><span class="comment">   * theme, then there's nothing we can do about that, so we have to bail, </span>&nbsp;</div></li><li><div><span class="comment">   * rather than going into an infinite loop. (This is why there are</span>&nbsp;</div></li><li><div><span class="comment">   * checks against WP_DEFAULT_THEME above, also.) We also can't do anything</span>&nbsp;</div></li><li><div><span class="comment">   * if it turns out there is no default theme installed. (That's `false`.)</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $default = WP_Theme::get_core_default_theme();&nbsp;</div></li><li><div>  if ( false === $default || get_stylesheet() == $default-&gt;get_stylesheet() ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch_theme( $default-&gt;get_stylesheet() );&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve all theme modifications.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|void Theme modifications.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_theme_mods() {&nbsp;</div></li><li><div>  $theme_slug = get_option( 'stylesheet' );&nbsp;</div></li><li><div>  $mods = get_option( &quot;theme_mods_$theme_slug&quot; );&nbsp;</div></li><li><div>  if ( false === $mods ) {&nbsp;</div></li><li><div>      $theme_name = get_option( 'current_theme' );&nbsp;</div></li><li><div>      if ( false === $theme_name )&nbsp;</div></li><li><div>          $theme_name = wp_get_theme()-&gt;get('Name');&nbsp;</div></li><li><div>      $mods = get_option( &quot;mods_$theme_name&quot; ); <span class="comment">// Deprecated location.</span>&nbsp;</div></li><li><div>      if ( is_admin() && false !== $mods ) {&nbsp;</div></li><li><div>          update_option( &quot;theme_mods_$theme_slug&quot;, $mods );&nbsp;</div></li><li><div>          delete_option( &quot;mods_$theme_name&quot; );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $mods;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve theme modification value for the current theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the modification name does not exist, then the $default will be passed</span>&nbsp;</div></li><li><div><span class="comment"> * through {@link https://secure.php.net/sprintf sprintf()} PHP function with the first</span>&nbsp;</div></li><li><div><span class="comment"> * string the template directory URI and the second string the stylesheet</span>&nbsp;</div></li><li><div><span class="comment"> * directory URI.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $name    Theme modification name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool|string $default</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_theme_mod( $name, $default = false ) {&nbsp;</div></li><li><div>  $mods = get_theme_mods();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $mods[$name] ) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the theme modification, or 'theme_mod', value.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The dynamic portion of the hook name, `$name`, refers to</span>&nbsp;</div></li><li><div><span class="comment">       * the key name of the modification array. For example, </span>&nbsp;</div></li><li><div><span class="comment">       * 'header_textcolor', 'header_image', and so on depending</span>&nbsp;</div></li><li><div><span class="comment">       * on the theme options.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $current_mod The value of the current theme modification.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      return apply_filters( &quot;theme_mod_{$name}&quot;, $mods[$name] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_string( $default ) )&nbsp;</div></li><li><div>      $default = sprintf( $default, get_template_directory_uri(), get_stylesheet_directory_uri() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** This filter is documented in wp-includes/theme.php */</span>&nbsp;</div></li><li><div>  return apply_filters( &quot;theme_mod_{$name}&quot;, $default );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update theme modification value for the current theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name  Theme modification name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $value Theme modification value.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function set_theme_mod( $name, $value ) {&nbsp;</div></li><li><div>  $mods = get_theme_mods();&nbsp;</div></li><li><div>  $old_value = isset( $mods[ $name ] ) ? $mods[ $name ] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the theme mod value on save.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$name`, refers to the key name of</span>&nbsp;</div></li><li><div><span class="comment">   * the modification array. For example, 'header_textcolor', 'header_image', </span>&nbsp;</div></li><li><div><span class="comment">   * and so on depending on the theme options.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value     The new value of the theme mod.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $old_value The current value of the theme mod.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $mods[ $name ] = apply_filters( &quot;pre_set_theme_mod_{$name}&quot;, $value, $old_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $theme = get_option( 'stylesheet' );&nbsp;</div></li><li><div>  update_option( &quot;theme_mods_$theme&quot;, $mods );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove theme modification name from current theme list.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If removing the name also removes all elements, then the entire option will</span>&nbsp;</div></li><li><div><span class="comment"> * be removed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name Theme modification name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_theme_mod( $name ) {&nbsp;</div></li><li><div>  $mods = get_theme_mods();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $mods[ $name ] ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  unset( $mods[ $name ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $mods ) ) {&nbsp;</div></li><li><div>      remove_theme_mods();&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $theme = get_option( 'stylesheet' );&nbsp;</div></li><li><div>  update_option( &quot;theme_mods_$theme&quot;, $mods );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove theme modifications option for current theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_theme_mods() {&nbsp;</div></li><li><div>  delete_option( 'theme_mods_' . get_option( 'stylesheet' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Old style.</span>&nbsp;</div></li><li><div>  $theme_name = get_option( 'current_theme' );&nbsp;</div></li><li><div>  if ( false === $theme_name )&nbsp;</div></li><li><div>      $theme_name = wp_get_theme()-&gt;get('Name');&nbsp;</div></li><li><div>  delete_option( 'mods_' . $theme_name );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the custom header text color in HEX format.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Header text color in HEX format (minus the hash symbol).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_header_textcolor() {&nbsp;</div></li><li><div>  return get_theme_mod('header_textcolor', get_theme_support( 'custom-header', 'default-text-color' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays the custom header text color in HEX format (minus the hash symbol).</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function header_textcolor() {&nbsp;</div></li><li><div>  echo get_header_textcolor();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether to display the header text.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function display_header_text() {&nbsp;</div></li><li><div>  if ( ! current_theme_supports( 'custom-header', 'header-text' ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $text_color = get_theme_mod( 'header_textcolor', get_theme_support( 'custom-header', 'default-text-color' ) );&nbsp;</div></li><li><div>  return 'blank' !== $text_color;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a header image is set or not.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_header_image()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether a header image is set or not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function has_header_image() {&nbsp;</div></li><li><div>  return (bool) get_header_image();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve header image for custom header.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|false</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_header_image() {&nbsp;</div></li><li><div>  $url = get_theme_mod( 'header_image', get_theme_support( 'custom-header', 'default-image' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'remove-header' == $url )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_random_header_image() )&nbsp;</div></li><li><div>      $url = get_random_header_image();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return esc_url_raw( set_url_scheme( $url ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create image tag markup for a custom header image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr Optional. Additional attributes for the image tag. Can be used</span>&nbsp;</div></li><li><div><span class="comment"> *                              to override the default attributes. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML image element markup or empty string on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_header_image_tag( $attr = array() ) {&nbsp;</div></li><li><div>  $header = get_custom_header();&nbsp;</div></li><li><div>  $header-&gt;url = get_header_image();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $header-&gt;url ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $width = absint( $header-&gt;width );&nbsp;</div></li><li><div>  $height = absint( $header-&gt;height );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $attr = wp_parse_args(&nbsp;</div></li><li><div>      $attr, &nbsp;</div></li><li><div>      array(&nbsp;</div></li><li><div>          'src' =&gt; $header-&gt;url, &nbsp;</div></li><li><div>          'width' =&gt; $width, &nbsp;</div></li><li><div>          'height' =&gt; $height, &nbsp;</div></li><li><div>          'alt' =&gt; get_bloginfo( 'name' ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Generate 'srcset' and 'sizes' if not already present.</span>&nbsp;</div></li><li><div>  if ( empty( $attr['srcset'] ) && ! empty( $header-&gt;attachment_id ) ) {&nbsp;</div></li><li><div>      $image_meta = get_post_meta( $header-&gt;attachment_id, '_wp_attachment_metadata', true );&nbsp;</div></li><li><div>      $size_array = array( $width, $height );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $image_meta ) ) {&nbsp;</div></li><li><div>          $srcset = wp_calculate_image_srcset( $size_array, $header-&gt;url, $image_meta, $header-&gt;attachment_id );&nbsp;</div></li><li><div>          $sizes = ! empty( $attr['sizes'] ) ? $attr['sizes'] : wp_calculate_image_sizes( $size_array, $header-&gt;url, $image_meta, $header-&gt;attachment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $srcset && $sizes ) {&nbsp;</div></li><li><div>              $attr['srcset'] = $srcset;&nbsp;</div></li><li><div>              $attr['sizes'] = $sizes;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $attr = array_map( 'esc_attr', $attr );&nbsp;</div></li><li><div>  $html = '&lt;img';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $attr as $name =&gt; $value ) {&nbsp;</div></li><li><div>      $html .= ' ' . $name . '=&quot;' . $value . '&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html .= ' /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the markup of header images.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $html   The HTML image tag markup being filtered.</span>&nbsp;</div></li><li><div><span class="comment">   * @param object $header The custom header object returned by 'get_custom_header()'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $attr   Array of the attributes for the image tag.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'get_header_image_tag', $html, $header, $attr );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display the image markup for a custom header image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $attr Optional. Attributes for the image markup. Default empty.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function the_header_image_tag( $attr = array() ) {&nbsp;</div></li><li><div>  echo get_header_image_tag( $attr );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get random header image data from registered images in theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array  $_wp_default_headers</span>&nbsp;</div></li><li><div><span class="comment"> * @staticvar object $_wp_random_header</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return object</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _get_random_header_data() {&nbsp;</div></li><li><div>  static $_wp_random_header = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $_wp_random_header ) ) {&nbsp;</div></li><li><div>      global $_wp_default_headers;&nbsp;</div></li><li><div>      $header_image_mod = get_theme_mod( 'header_image', '' );&nbsp;</div></li><li><div>      $headers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'random-uploaded-image' == $header_image_mod )&nbsp;</div></li><li><div>          $headers = get_uploaded_header_images();&nbsp;</div></li><li><div>      elseif ( ! empty( $_wp_default_headers ) ) {&nbsp;</div></li><li><div>          if ( 'random-default-image' == $header_image_mod ) {&nbsp;</div></li><li><div>              $headers = $_wp_default_headers;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( current_theme_supports( 'custom-header', 'random-default' ) )&nbsp;</div></li><li><div>                  $headers = $_wp_default_headers;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $headers ) )&nbsp;</div></li><li><div>          return new stdClass;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $_wp_random_header = (object) $headers[ array_rand( $headers ) ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $_wp_random_header-&gt;url =  sprintf( $_wp_random_header-&gt;url, get_template_directory_uri(), get_stylesheet_directory_uri() );&nbsp;</div></li><li><div>      $_wp_random_header-&gt;thumbnail_url =  sprintf( $_wp_random_header-&gt;thumbnail_url, get_template_directory_uri(), get_stylesheet_directory_uri() );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $_wp_random_header;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get random header image url from registered images in theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Path to header image</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_random_header_image() {&nbsp;</div></li><li><div>  $random_image = _get_random_header_data();&nbsp;</div></li><li><div>  if ( empty( $random_image-&gt;url ) )&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  return $random_image-&gt;url;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check if random header image is in use.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Always true if user expressly chooses the option in Appearance &gt; Header.</span>&nbsp;</div></li><li><div><span class="comment"> * Also true if theme has multiple header images registered, no specific header image</span>&nbsp;</div></li><li><div><span class="comment"> * is chosen, and theme turns on random headers with add_theme_support().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type The random pool to use. any|default|uploaded</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_random_header_image( $type = 'any' ) {&nbsp;</div></li><li><div>  $header_image_mod = get_theme_mod( 'header_image', get_theme_support( 'custom-header', 'default-image' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'any' == $type ) {&nbsp;</div></li><li><div>      if ( 'random-default-image' == $header_image_mod || 'random-uploaded-image' == $header_image_mod || ( '' != get_random_header_image() && empty( $header_image_mod ) ) )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( &quot;random-$type-image&quot; == $header_image_mod )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      elseif ( 'default' == $type && empty( $header_image_mod ) && '' != get_random_header_image() )&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display header image URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function header_image() {&nbsp;</div></li><li><div>  $image = get_header_image();&nbsp;</div></li><li><div>  if ( $image ) {&nbsp;</div></li><li><div>      echo esc_url( $image );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the header images uploaded for the current theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_uploaded_header_images() {&nbsp;</div></li><li><div>  $header_images = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// @todo caching</span>&nbsp;</div></li><li><div>  $headers = get_posts( array( 'post_type' =&gt; 'attachment', 'meta_key' =&gt; '_wp_attachment_is_custom_header', 'meta_value' =&gt; get_option('stylesheet'), 'orderby' =&gt; 'none', 'nopaging' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $headers ) )&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( (array) $headers as $header ) {&nbsp;</div></li><li><div>      $url = esc_url_raw( wp_get_attachment_url( $header-&gt;ID ) );&nbsp;</div></li><li><div>      $header_data = wp_get_attachment_metadata( $header-&gt;ID );&nbsp;</div></li><li><div>      $header_index = $header-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $header_images[$header_index] = array();&nbsp;</div></li><li><div>      $header_images[$header_index]['attachment_id'] = $header-&gt;ID;&nbsp;</div></li><li><div>      $header_images[$header_index]['url'] =  $url;&nbsp;</div></li><li><div>      $header_images[$header_index]['thumbnail_url'] = $url;&nbsp;</div></li><li><div>      $header_images[$header_index]['alt_text'] = get_post_meta( $header-&gt;ID, '_wp_attachment_image_alt', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $header_data['width'] ) )&nbsp;</div></li><li><div>          $header_images[$header_index]['width'] = $header_data['width'];&nbsp;</div></li><li><div>      if ( isset( $header_data['height'] ) )&nbsp;</div></li><li><div>          $header_images[$header_index]['height'] = $header_data['height'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $header_images;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the header image data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_default_headers</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return object</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_custom_header() {&nbsp;</div></li><li><div>  global $_wp_default_headers;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_random_header_image() ) {&nbsp;</div></li><li><div>      $data = _get_random_header_data();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $data = get_theme_mod( 'header_image_data' );&nbsp;</div></li><li><div>      if ( ! $data && current_theme_supports( 'custom-header', 'default-image' ) ) {&nbsp;</div></li><li><div>          $directory_args = array( get_template_directory_uri(), get_stylesheet_directory_uri() );&nbsp;</div></li><li><div>          $data = array();&nbsp;</div></li><li><div>          $data['url'] = $data['thumbnail_url'] = vsprintf( get_theme_support( 'custom-header', 'default-image' ), $directory_args );&nbsp;</div></li><li><div>          if ( ! empty( $_wp_default_headers ) ) {&nbsp;</div></li><li><div>              foreach ( (array) $_wp_default_headers as $default_header ) {&nbsp;</div></li><li><div>                  $url = vsprintf( $default_header['url'], $directory_args );&nbsp;</div></li><li><div>                  if ( $data['url'] == $url ) {&nbsp;</div></li><li><div>                      $data = $default_header;&nbsp;</div></li><li><div>                      $data['url'] = $url;&nbsp;</div></li><li><div>                      $data['thumbnail_url'] = vsprintf( $data['thumbnail_url'], $directory_args );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $default = array(&nbsp;</div></li><li><div>      'url' =&gt; '', &nbsp;</div></li><li><div>      'thumbnail_url' =&gt; '', &nbsp;</div></li><li><div>      'width' =&gt; get_theme_support( 'custom-header', 'width' ), &nbsp;</div></li><li><div>      'height' =&gt; get_theme_support( 'custom-header', 'height' ), &nbsp;</div></li><li><div>      'video' =&gt; get_theme_support( 'custom-header', 'video' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  return (object) wp_parse_args( $data, $default );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register a selection of default headers to be displayed by the custom header admin UI.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_default_headers</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $headers Array of headers keyed by a string id. The ids point to arrays containing 'url', 'thumbnail_url', and 'description' keys.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function register_default_headers( $headers ) {&nbsp;</div></li><li><div>  global $_wp_default_headers;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_wp_default_headers = array_merge( (array) $_wp_default_headers, (array) $headers );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Unregister default headers.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function must be called after register_default_headers() has already added the</span>&nbsp;</div></li><li><div><span class="comment"> * header you want to remove.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see register_default_headers()</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_default_headers</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $header The header string id (key of array) to remove, or an array thereof.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|void A single header returns true on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> *                   There is currently no return value for multiple headers.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function unregister_default_headers( $header ) {&nbsp;</div></li><li><div>  global $_wp_default_headers;&nbsp;</div></li><li><div>  if ( is_array( $header ) ) {&nbsp;</div></li><li><div>      array_map( 'unregister_default_headers', $header );&nbsp;</div></li><li><div>  } elseif ( isset( $_wp_default_headers[ $header ] ) ) {&nbsp;</div></li><li><div>      unset( $_wp_default_headers[ $header ] );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a header video is set or not.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see get_header_video_url()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether a header video is set or not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function has_header_video() {&nbsp;</div></li><li><div>  return (bool) get_header_video_url();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Retrieve header video URL for custom header.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Uses a local video if present, or falls back to an external video. Returns false if there is no video.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|false</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_header_video_url() {&nbsp;</div></li><li><div>  $id = absint( get_theme_mod( 'header_video' ) );&nbsp;</div></li><li><div>  $url = esc_url( get_theme_mod( 'external_header_video' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      <span class="comment">// Get the file URL from the attachment ID.</span>&nbsp;</div></li><li><div>      $url = wp_get_attachment_url( $id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the header video URL.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.3</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url Header video URL, if available.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $url = apply_filters( 'get_header_video_url', $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $id && ! $url ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return esc_url_raw( set_url_scheme( $url ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display header video URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function the_header_video_url() {&nbsp;</div></li><li><div>  $video = get_header_video_url();&nbsp;</div></li><li><div>  if ( $video ) {&nbsp;</div></li><li><div>      echo esc_url( $video );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve header video settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_header_video_settings() {&nbsp;</div></li><li><div>  $header = get_custom_header();&nbsp;</div></li><li><div>  $video_url = get_header_video_url();&nbsp;</div></li><li><div>  $video_type = wp_check_filetype( $video_url, wp_get_mime_types() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = array(&nbsp;</div></li><li><div>      'mimeType' =&gt; '', &nbsp;</div></li><li><div>      'posterUrl' =&gt; get_header_image(), &nbsp;</div></li><li><div>      'videoUrl' =&gt; $video_url, &nbsp;</div></li><li><div>      'width' =&gt; absint( $header-&gt;width ), &nbsp;</div></li><li><div>      'height' =&gt; absint( $header-&gt;height ), &nbsp;</div></li><li><div>      'minWidth' =&gt; 900, &nbsp;</div></li><li><div>      'minHeight' =&gt; 500, &nbsp;</div></li><li><div>      'l10n' =&gt; array(&nbsp;</div></li><li><div>          'pause' =&gt; __( 'Pause' ), &nbsp;</div></li><li><div>          'play' =&gt; __( 'Play' ), &nbsp;</div></li><li><div>          'pauseSpeak' =&gt; __( 'Video is paused.'), &nbsp;</div></li><li><div>          'playSpeak' =&gt; __( 'Video is playing.'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( preg_match( '#^https?:<span class="comment">//(?:www\.)?(?:youtube\.com/watch|youtu\.be/)#', $video_url ) ) {</span>&nbsp;</div></li><li><div>      $settings['mimeType'] = 'video/x-youtube';&nbsp;</div></li><li><div>  } elseif ( ! empty( $video_type['type'] ) ) {&nbsp;</div></li><li><div>      $settings['mimeType'] = $video_type['type'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'header_video_settings', $settings );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a custom header is set or not.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if a custom header is set. False if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function has_custom_header() {&nbsp;</div></li><li><div>  if ( has_header_image() || ( has_header_video() && is_header_video_active() ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks whether the custom header video is eligible to show on the current page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the custom header video should be shown. False if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_header_video_active() {&nbsp;</div></li><li><div>  if ( ! get_theme_support( 'custom-header', 'video' ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $video_active_cb = get_theme_support( 'custom-header', 'video-active-callback' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $video_active_cb ) || ! is_callable( $video_active_cb ) ) {&nbsp;</div></li><li><div>      $show_video = true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $show_video = call_user_func( $video_active_cb );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Modify whether the custom header video is eligible to show on the current page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $show_video Whether the custom header video should be shown. Returns the value</span>&nbsp;</div></li><li><div><span class="comment">   *                         of the theme setting for the `custom-header`'s `video-active-callback`.</span>&nbsp;</div></li><li><div><span class="comment">   *                         If no callback is set, the default value is that of `is_front_page()`.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'is_header_video_active', $show_video );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the markup for a custom header.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The container div will always be returned in the Customizer preview.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The markup for a custom header on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_custom_header_markup() {&nbsp;</div></li><li><div>  if ( ! has_custom_header() && ! is_customize_preview() ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return sprintf(&nbsp;</div></li><li><div>      '&lt;div id=&quot;wp-custom-header&quot; class=&quot;wp-custom-header&quot;&gt;%s&lt;/div&gt;', &nbsp;</div></li><li><div>      get_header_image_tag()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Print the markup for a custom header.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A container div will always be printed in the Customizer preview.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function the_custom_header_markup() {&nbsp;</div></li><li><div>  $custom_header = get_custom_header_markup();&nbsp;</div></li><li><div>  if ( empty( $custom_header ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $custom_header;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_header_video_active() && ( has_header_video() || is_customize_preview() ) ) {&nbsp;</div></li><li><div>      wp_enqueue_script( 'wp-custom-header' );&nbsp;</div></li><li><div>      wp_localize_script( 'wp-custom-header', '_wpCustomHeaderSettings', get_header_video_settings() );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve background image for custom background.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_background_image() {&nbsp;</div></li><li><div>  return get_theme_mod('background_image', get_theme_support( 'custom-background', 'default-image' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display background image path.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function background_image() {&nbsp;</div></li><li><div>  echo get_background_image();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve value for custom background color.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_background_color() {&nbsp;</div></li><li><div>  return get_theme_mod('background_color', get_theme_support( 'custom-background', 'default-color' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display background color value.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function background_color() {&nbsp;</div></li><li><div>  echo get_background_color();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Default custom background callback.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access protected</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _custom_background_cb() {&nbsp;</div></li><li><div>  <span class="comment">// $background is the saved custom image, or the default image.</span>&nbsp;</div></li><li><div>  $background = set_url_scheme( get_background_image() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// $color is the saved custom color.</span>&nbsp;</div></li><li><div>  <span class="comment">// A default has to be specified in style.css. It will not be printed here.</span>&nbsp;</div></li><li><div>  $color = get_background_color();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $color === get_theme_support( 'custom-background', 'default-color' ) ) {&nbsp;</div></li><li><div>      $color = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $background && ! $color ) {&nbsp;</div></li><li><div>      if ( is_customize_preview() ) {&nbsp;</div></li><li><div>          echo '&lt;style type=&quot;text/css&quot; id=&quot;custom-background-css&quot;&gt;&lt;/style&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $style = $color ? &quot;background-color: #$color;&quot; : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $background ) {&nbsp;</div></li><li><div>      $image = ' background-image: url(&quot;' . esc_url_raw( $background ) . '&quot;);';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Background Position.</span>&nbsp;</div></li><li><div>      $position_x = get_theme_mod( 'background_position_x', get_theme_support( 'custom-background', 'default-position-x' ) );&nbsp;</div></li><li><div>      $position_y = get_theme_mod( 'background_position_y', get_theme_support( 'custom-background', 'default-position-y' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! in_array( $position_x, array( 'left', 'center', 'right' ), true ) ) {&nbsp;</div></li><li><div>          $position_x = 'left';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! in_array( $position_y, array( 'top', 'center', 'bottom' ), true ) ) {&nbsp;</div></li><li><div>          $position_y = 'top';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $position = &quot; background-position: $position_x $position_y;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Background Size.</span>&nbsp;</div></li><li><div>      $size = get_theme_mod( 'background_size', get_theme_support( 'custom-background', 'default-size' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! in_array( $size, array( 'auto', 'contain', 'cover' ), true ) ) {&nbsp;</div></li><li><div>          $size = 'auto';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $size = &quot; background-size: $size;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Background Repeat.</span>&nbsp;</div></li><li><div>      $repeat = get_theme_mod( 'background_repeat', get_theme_support( 'custom-background', 'default-repeat' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! in_array( $repeat, array( 'repeat-x', 'repeat-y', 'repeat', 'no-repeat' ), true ) ) {&nbsp;</div></li><li><div>          $repeat = 'repeat';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $repeat = &quot; background-repeat: $repeat;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Background Scroll.</span>&nbsp;</div></li><li><div>      $attachment = get_theme_mod( 'background_attachment', get_theme_support( 'custom-background', 'default-attachment' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'fixed' !== $attachment ) {&nbsp;</div></li><li><div>          $attachment = 'scroll';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $attachment = &quot; background-attachment: $attachment;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $style .= $image . $position . $size . $repeat . $attachment;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;style type=&quot;text/css&quot; id=&quot;custom-background-css&quot;&gt;&nbsp;</div></li><li><div>body.custom-background { &lt;?php echo trim( $style ); ?&gt; }&nbsp;</div></li><li><div>&lt;/style&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render the Custom CSS style element.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_custom_css_cb() {&nbsp;</div></li><li><div>  $styles = wp_get_custom_css();&nbsp;</div></li><li><div>  if ( $styles || is_customize_preview() ) : ?&gt;&nbsp;</div></li><li><div>      &lt;style type=&quot;text/css&quot; id=&quot;wp-custom-css&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php echo strip_tags( $styles ); <span class="comment">// Note that esc_html() cannot be used because `div &gt; span` is not interpreted properly. ?&gt;</span>&nbsp;</div></li><li><div>      &lt;/style&gt;&nbsp;</div></li><li><div>  &lt;?php endif;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetch the `custom_css` post for a given theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet Optional. A theme object stylesheet name. Defaults to the current theme.</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Post|null The custom_css post or null if none exists.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_custom_css_post( $stylesheet = '' ) {&nbsp;</div></li><li><div>  if ( empty( $stylesheet ) ) {&nbsp;</div></li><li><div>      $stylesheet = get_stylesheet();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $custom_css_query_vars = array(&nbsp;</div></li><li><div>      'post_type' =&gt; 'custom_css', &nbsp;</div></li><li><div>      'post_status' =&gt; get_post_stati(), &nbsp;</div></li><li><div>      'name' =&gt; sanitize_title( $stylesheet ), &nbsp;</div></li><li><div>      'posts_per_page' =&gt; 1, &nbsp;</div></li><li><div>      'no_found_rows' =&gt; true, &nbsp;</div></li><li><div>      'cache_results' =&gt; true, &nbsp;</div></li><li><div>      'update_post_meta_cache' =&gt; false, &nbsp;</div></li><li><div>      'update_post_term_cache' =&gt; false, &nbsp;</div></li><li><div>      'lazy_load_term_meta' =&gt; false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post = null;&nbsp;</div></li><li><div>  if ( get_stylesheet() === $stylesheet ) {&nbsp;</div></li><li><div>      $post_id = get_theme_mod( 'custom_css_post_id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $post_id &gt; 0 && get_post( $post_id ) ) {&nbsp;</div></li><li><div>          $post = get_post( $post_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// `-1` indicates no post exists; no query necessary.</span>&nbsp;</div></li><li><div>      if ( ! $post && -1 !== $post_id ) {&nbsp;</div></li><li><div>          $query = new WP_Query( $custom_css_query_vars );&nbsp;</div></li><li><div>          $post = $query-&gt;post;&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Cache the lookup. See wp_update_custom_css_post().</span>&nbsp;</div></li><li><div><span class="comment">           * @todo This should get cleared if a custom_css post is added/removed.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          set_theme_mod( 'custom_css_post_id', $post ? $post-&gt;ID : -1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $query = new WP_Query( $custom_css_query_vars );&nbsp;</div></li><li><div>      $post = $query-&gt;post;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $post;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetch the saved Custom CSS content for rendering.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet Optional. A theme object stylesheet name. Defaults to the current theme.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The Custom CSS Post content.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_get_custom_css( $stylesheet = '' ) {&nbsp;</div></li><li><div>  $css = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $stylesheet ) ) {&nbsp;</div></li><li><div>      $stylesheet = get_stylesheet();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post = wp_get_custom_css_post( $stylesheet );&nbsp;</div></li><li><div>  if ( $post ) {&nbsp;</div></li><li><div>      $css = $post-&gt;post_content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Modify the Custom CSS Output into the &lt;head&gt;.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $css        CSS pulled in from the Custom CSS CPT.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $stylesheet The theme stylesheet name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $css = apply_filters( 'wp_get_custom_css', $css, $stylesheet );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $css;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update the `custom_css` post for a given theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Inserts a `custom_css` post when one doesn't yet exist.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access public</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $css CSS, stored in `post_content`.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Args.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $preprocessed Pre-processed CSS, stored in `post_content_filtered`. Normally empty string. Optional.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $stylesheet   Stylesheet (child theme) to update. Optional, defaults to current theme/stylesheet.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return WP_Post|WP_Error Post on success, error on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_update_custom_css_post( $css, $args = array() ) {&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, array(&nbsp;</div></li><li><div>      'preprocessed' =&gt; '', &nbsp;</div></li><li><div>      'stylesheet' =&gt; get_stylesheet(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data = array(&nbsp;</div></li><li><div>      'css' =&gt; $css, &nbsp;</div></li><li><div>      'preprocessed' =&gt; $args['preprocessed'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the `css` (`post_content`) and `preprocessed` (`post_content_filtered`) args for a `custom_css` post being updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This filter can be used by plugin that offer CSS pre-processors, to store the original</span>&nbsp;</div></li><li><div><span class="comment">   * pre-processed CSS in `post_content_filtered` and then store processed CSS in `post_content`.</span>&nbsp;</div></li><li><div><span class="comment">   * When used in this way, the `post_content_filtered` should be supplied as the setting value</span>&nbsp;</div></li><li><div><span class="comment">   * instead of `post_content` via a the `customize_value_custom_css` filter, for example:</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * add_filter( 'customize_value_custom_css', function( $value, $setting ) {</span>&nbsp;</div></li><li><div><span class="comment">   *     $post = wp_get_custom_css_post( $setting-&gt;stylesheet );</span>&nbsp;</div></li><li><div><span class="comment">   *     if ( $post && ! empty( $post-&gt;post_content_filtered ) ) {</span>&nbsp;</div></li><li><div><span class="comment">   *         $css = $post-&gt;post_content_filtered;</span>&nbsp;</div></li><li><div><span class="comment">   *     }</span>&nbsp;</div></li><li><div><span class="comment">   *     return $css;</span>&nbsp;</div></li><li><div><span class="comment">   * }, 10, 2 );</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data {</span>&nbsp;</div></li><li><div><span class="comment">   *     Custom CSS data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $css          CSS stored in `post_content`.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $preprocessed Pre-processed CSS stored in `post_content_filtered`. Normally empty string.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args {</span>&nbsp;</div></li><li><div><span class="comment">   *     The args passed into `wp_update_custom_css_post()` merged with defaults.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $css          The original CSS passed in to be updated.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $preprocessed The original preprocessed CSS passed in to be updated.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $stylesheet   The stylesheet (theme) being updated.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $data = apply_filters( 'update_custom_css_data', $data, array_merge( $args, compact( 'css' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post_data = array(&nbsp;</div></li><li><div>      'post_title' =&gt; $args['stylesheet'], &nbsp;</div></li><li><div>      'post_name' =&gt; sanitize_title( $args['stylesheet'] ), &nbsp;</div></li><li><div>      'post_type' =&gt; 'custom_css', &nbsp;</div></li><li><div>      'post_status' =&gt; 'publish', &nbsp;</div></li><li><div>      'post_content' =&gt; $data['css'], &nbsp;</div></li><li><div>      'post_content_filtered' =&gt; $data['preprocessed'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Update post if it already exists, otherwise create a new one.</span>&nbsp;</div></li><li><div>  $post = wp_get_custom_css_post( $args['stylesheet'] );&nbsp;</div></li><li><div>  if ( $post ) {&nbsp;</div></li><li><div>      $post_data['ID'] = $post-&gt;ID;&nbsp;</div></li><li><div>      $r = wp_update_post( wp_slash( $post_data ), true );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $r = wp_insert_post( wp_slash( $post_data ), true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_wp_error( $r ) ) {&nbsp;</div></li><li><div>          if ( get_stylesheet() === $args['stylesheet'] ) {&nbsp;</div></li><li><div>              set_theme_mod( 'custom_css_post_id', $r );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Trigger creation of a revision. This should be removed once #30854 is resolved.</span>&nbsp;</div></li><li><div>          if ( 0 === count( wp_get_post_revisions( $r ) ) ) {&nbsp;</div></li><li><div>              wp_save_post_revision( $r );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_wp_error( $r ) ) {&nbsp;</div></li><li><div>      return $r;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return get_post( $r );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add callback for custom TinyMCE editor stylesheets.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The parameter $stylesheet is the name of the stylesheet, relative to</span>&nbsp;</div></li><li><div><span class="comment"> * the theme root. It also accepts an array of stylesheets.</span>&nbsp;</div></li><li><div><span class="comment"> * It is optional and defaults to 'editor-style.css'.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function automatically adds another stylesheet with -rtl prefix, e.g. editor-style-rtl.css.</span>&nbsp;</div></li><li><div><span class="comment"> * If that file doesn't exist, it is removed before adding the stylesheet(s) to TinyMCE.</span>&nbsp;</div></li><li><div><span class="comment"> * If an array of stylesheets is passed to add_editor_style(), </span>&nbsp;</div></li><li><div><span class="comment"> * RTL is only added for the first stylesheet.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Since version 3.4 the TinyMCE body has .rtl CSS class.</span>&nbsp;</div></li><li><div><span class="comment"> * It is a better option to use that class and add any RTL styles to the main stylesheet.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $editor_styles</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $stylesheet Optional. Stylesheet name or array thereof, relative to theme root.</span>&nbsp;</div></li><li><div><span class="comment"> *                                    Defaults to 'editor-style.css'</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_editor_style( $stylesheet = 'editor-style.css' ) {&nbsp;</div></li><li><div>  add_theme_support( 'editor-style' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_admin() )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $editor_styles;&nbsp;</div></li><li><div>  $editor_styles = (array) $editor_styles;&nbsp;</div></li><li><div>  $stylesheet = (array) $stylesheet;&nbsp;</div></li><li><div>  if ( is_rtl() ) {&nbsp;</div></li><li><div>      $rtl_stylesheet = str_replace('.css', '-rtl.css', $stylesheet[0]);&nbsp;</div></li><li><div>      $stylesheet[] = $rtl_stylesheet;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $editor_styles = array_merge( $editor_styles, $stylesheet );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes all visual editor stylesheets.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $editor_styles</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false if there were no stylesheets to remove.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_editor_styles() {&nbsp;</div></li><li><div>  if ( ! current_theme_supports( 'editor-style' ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  _remove_theme_support( 'editor-style' );&nbsp;</div></li><li><div>  if ( is_admin() )&nbsp;</div></li><li><div>      $GLOBALS['editor_styles'] = array();&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve any registered editor stylesheets</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $editor_styles Registered editor stylesheets</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array If registered, a list of editor stylesheet URLs.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_editor_stylesheets() {&nbsp;</div></li><li><div>  $stylesheets = array();&nbsp;</div></li><li><div>  <span class="comment">// load editor_style.css if the current theme supports it</span>&nbsp;</div></li><li><div>  if ( ! empty( $GLOBALS['editor_styles'] ) && is_array( $GLOBALS['editor_styles'] ) ) {&nbsp;</div></li><li><div>      $editor_styles = $GLOBALS['editor_styles'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $editor_styles = array_unique( array_filter( $editor_styles ) );&nbsp;</div></li><li><div>      $style_uri = get_stylesheet_directory_uri();&nbsp;</div></li><li><div>      $style_dir = get_stylesheet_directory();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Support externally referenced styles (like, say, fonts).</span>&nbsp;</div></li><li><div>      foreach ( $editor_styles as $key =&gt; $file ) {&nbsp;</div></li><li><div>          if ( preg_match( '~^(https?:)?<span class="comment">//~', $file ) ) {</span>&nbsp;</div></li><li><div>              $stylesheets[] = esc_url_raw( $file );&nbsp;</div></li><li><div>              unset( $editor_styles[ $key ] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Look in a parent theme first, that way child theme CSS overrides.</span>&nbsp;</div></li><li><div>      if ( is_child_theme() ) {&nbsp;</div></li><li><div>          $template_uri = get_template_directory_uri();&nbsp;</div></li><li><div>          $template_dir = get_template_directory();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $editor_styles as $key =&gt; $file ) {&nbsp;</div></li><li><div>              if ( $file && file_exists( &quot;$template_dir/$file&quot; ) ) {&nbsp;</div></li><li><div>                  $stylesheets[] = &quot;$template_uri/$file&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $editor_styles as $file ) {&nbsp;</div></li><li><div>          if ( $file && file_exists( &quot;$style_dir/$file&quot; ) ) {&nbsp;</div></li><li><div>              $stylesheets[] = &quot;$style_uri/$file&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the array of stylesheets applied to the editor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $stylesheets Array of stylesheets to be applied to the editor.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'editor_stylesheets', $stylesheets );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Expand a theme's starter content configuration using core-provided data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Array of starter content.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_theme_starter_content() {&nbsp;</div></li><li><div>  $theme_support = get_theme_support( 'starter-content' );&nbsp;</div></li><li><div>  if ( is_array( $theme_support ) && ! empty( $theme_support[0] ) && is_array( $theme_support[0] ) ) {&nbsp;</div></li><li><div>      $config = $theme_support[0];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $config = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $core_content = array(&nbsp;</div></li><li><div>      'widgets' =&gt; array(&nbsp;</div></li><li><div>          'text_business_info' =&gt; array( 'text', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Find Us', 'Theme starter content' ), &nbsp;</div></li><li><div>              'text' =&gt; join( '', array(&nbsp;</div></li><li><div>                  '&lt;p&gt;&lt;strong&gt;' . _x( 'Address', 'Theme starter content' ) . '&lt;/strong&gt;&lt;br /&gt;', &nbsp;</div></li><li><div>                  _x( '123 Main Street', 'Theme starter content' ) . '&lt;br /&gt;' . _x( 'New York, NY 10001', 'Theme starter content' ) . '&lt;/p&gt;', &nbsp;</div></li><li><div>                  '&lt;p&gt;&lt;strong&gt;' . _x( 'Hours', 'Theme starter content' ) . '&lt;/strong&gt;&lt;br /&gt;', &nbsp;</div></li><li><div>                  _x( 'Monday&mdash;Friday: 9:00AM&ndash;5:00PM', 'Theme starter content' ) . '&lt;br /&gt;' . _x( 'Saturday &amp; Sunday: 11:00AM&ndash;3:00PM', 'Theme starter content' ) . '&lt;/p&gt;'&nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'text_about' =&gt; array( 'text', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'About This Site', 'Theme starter content' ), &nbsp;</div></li><li><div>              'text' =&gt; _x( 'This may be a good place to introduce yourself and your site or include some credits.', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'archives' =&gt; array( 'archives', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Archives', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'calendar' =&gt; array( 'calendar', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Calendar', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'categories' =&gt; array( 'categories', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Categories', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'meta' =&gt; array( 'meta', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Meta', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'recent-comments' =&gt; array( 'recent-comments', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Recent Comments', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'recent-posts' =&gt; array( 'recent-posts', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Recent Posts', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'search' =&gt; array( 'search', array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Search', 'Theme starter content' ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'nav_menus' =&gt; array(&nbsp;</div></li><li><div>          'link_home' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'custom', &nbsp;</div></li><li><div>              'title' =&gt; _x( 'Home', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; home_url( '/' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'page_home' =&gt; array( <span class="comment">// Deprecated in favor of home_link.</span>&nbsp;</div></li><li><div>              'type' =&gt; 'post_type', &nbsp;</div></li><li><div>              'object' =&gt; 'page', &nbsp;</div></li><li><div>              'object_id' =&gt; '{{home}}', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'page_about' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'post_type', &nbsp;</div></li><li><div>              'object' =&gt; 'page', &nbsp;</div></li><li><div>              'object_id' =&gt; '{{about}}', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'page_blog' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'post_type', &nbsp;</div></li><li><div>              'object' =&gt; 'page', &nbsp;</div></li><li><div>              'object_id' =&gt; '{{blog}}', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'page_news' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'post_type', &nbsp;</div></li><li><div>              'object' =&gt; 'page', &nbsp;</div></li><li><div>              'object_id' =&gt; '{{news}}', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'page_contact' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'post_type', &nbsp;</div></li><li><div>              'object' =&gt; 'page', &nbsp;</div></li><li><div>              'object_id' =&gt; '{{contact}}', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          'link_email' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Email', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'mailto:wordpress@example.com', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_facebook' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Facebook', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//www.facebook.com/wordpress', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_foursquare' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Foursquare', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//foursquare.com/', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_github' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'GitHub', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//github.com/wordpress/', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_instagram' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Instagram', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//www.instagram.com/explore/tags/wordcamp/', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_linkedin' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'LinkedIn', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//www.linkedin.com/company/1089783', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_pinterest' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Pinterest', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//www.pinterest.com/', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_twitter' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Twitter', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//twitter.com/wordpress', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_yelp' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'Yelp', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//www.yelp.com', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'link_youtube' =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; _x( 'YouTube', 'Theme starter content' ), &nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment">//www.youtube.com/channel/UCdof4Ju7amm1chz1gi1T2ZA', </span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'posts' =&gt; array(&nbsp;</div></li><li><div>          'home' =&gt; array(&nbsp;</div></li><li><div>              'post_type' =&gt; 'page', &nbsp;</div></li><li><div>              'post_title' =&gt; _x( 'Home', 'Theme starter content' ), &nbsp;</div></li><li><div>              'post_content' =&gt; _x( 'Welcome to your site! This is your homepage, which is what most visitors will see when they come to your site for the first time.', 'Theme starter content' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'about' =&gt; array(&nbsp;</div></li><li><div>              'post_type' =&gt; 'page', &nbsp;</div></li><li><div>              'post_title' =&gt; _x( 'About', 'Theme starter content' ), &nbsp;</div></li><li><div>              'post_content' =&gt; _x( 'You might be an artist who would like to introduce yourself and your work here or maybe you&rsquo;re a business with a mission to describe.', 'Theme starter content' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'contact' =&gt; array(&nbsp;</div></li><li><div>              'post_type' =&gt; 'page', &nbsp;</div></li><li><div>              'post_title' =&gt; _x( 'Contact', 'Theme starter content' ), &nbsp;</div></li><li><div>              'post_content' =&gt; _x( 'This is a page with some basic contact information, such as an address and phone number. You might also try a plugin to add a contact form.', 'Theme starter content' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'blog' =&gt; array(&nbsp;</div></li><li><div>              'post_type' =&gt; 'page', &nbsp;</div></li><li><div>              'post_title' =&gt; _x( 'Blog', 'Theme starter content' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'news' =&gt; array(&nbsp;</div></li><li><div>              'post_type' =&gt; 'page', &nbsp;</div></li><li><div>              'post_title' =&gt; _x( 'News', 'Theme starter content' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          'homepage-section' =&gt; array(&nbsp;</div></li><li><div>              'post_type' =&gt; 'page', &nbsp;</div></li><li><div>              'post_title' =&gt; _x( 'A homepage section', 'Theme starter content' ), &nbsp;</div></li><li><div>              'post_content' =&gt; _x( 'This is an example of a homepage section. Homepage sections can be any page other than the homepage itself, including the page that shows your latest blog posts.', 'Theme starter content' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $config as $type =&gt; $args ) {&nbsp;</div></li><li><div>      switch( $type ) {&nbsp;</div></li><li><div>          <span class="comment">// Use options and theme_mods as-is.</span>&nbsp;</div></li><li><div>          case 'options' :&nbsp;</div></li><li><div>          case 'theme_mods' :&nbsp;</div></li><li><div>              $content[ $type ] = $config[ $type ];&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Widgets are grouped into sidebars.</span>&nbsp;</div></li><li><div>          case 'widgets' :&nbsp;</div></li><li><div>              foreach ( $config[ $type ] as $sidebar_id =&gt; $widgets ) {&nbsp;</div></li><li><div>                  foreach ( $widgets as $id =&gt; $widget ) {&nbsp;</div></li><li><div>                      if ( is_array( $widget ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">// Item extends core content.</span></span></span>&nbsp;</div></li><li><div>                          if ( ! empty( $core_content[ $type ][ $id ] ) ) {&nbsp;</div></li><li><div>                              $widget = array(&nbsp;</div></li><li><div>                                  $core_content[ $type ][ $id ][0], &nbsp;</div></li><li><div>                                  array_merge( $core_content[ $type ][ $id ][1], $widget ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $content[ $type ][ $sidebar_id ][] = $widget;&nbsp;</div></li><li><div>                      } elseif ( is_string( $widget ) && ! empty( $core_content[ $type ] ) && ! empty( $core_content[ $type ][ $widget ] ) ) {&nbsp;</div></li><li><div>                          $content[ $type ][ $sidebar_id ][] = $core_content[ $type ][ $widget ];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// And nav menu items are grouped into nav menus.</span>&nbsp;</div></li><li><div>          case 'nav_menus' :&nbsp;</div></li><li><div>              foreach ( $config[ $type ] as $nav_menu_location =&gt; $nav_menu ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Ensure nav menus get a name.</span>&nbsp;</div></li><li><div>                  if ( empty( $nav_menu['name'] ) ) {&nbsp;</div></li><li><div>                      $nav_menu['name'] = $nav_menu_location;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $content[ $type ][ $nav_menu_location ]['name'] = $nav_menu['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ( $nav_menu['items'] as $id =&gt; $nav_menu_item ) {&nbsp;</div></li><li><div>                      if ( is_array( $nav_menu_item ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">// Item extends core content.</span></span></span>&nbsp;</div></li><li><div>                          if ( ! empty( $core_content[ $type ][ $id ] ) ) {&nbsp;</div></li><li><div>                              $nav_menu_item = array_merge( $core_content[ $type ][ $id ], $nav_menu_item );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $content[ $type ][ $nav_menu_location ]['items'][] = $nav_menu_item;&nbsp;</div></li><li><div>                      } elseif ( is_string( $nav_menu_item ) && ! empty( $core_content[ $type ] ) && ! empty( $core_content[ $type ][ $nav_menu_item ] ) ) {&nbsp;</div></li><li><div>                          $content[ $type ][ $nav_menu_location ]['items'][] = $core_content[ $type ][ $nav_menu_item ];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Attachments are posts but have special treatment.</span>&nbsp;</div></li><li><div>          case 'attachments' :&nbsp;</div></li><li><div>              foreach ( $config[ $type ] as $id =&gt; $item ) {&nbsp;</div></li><li><div>                  if ( ! empty( $item['file'] ) ) {&nbsp;</div></li><li><div>                      $content[ $type ][ $id ] = $item;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// All that's left now are posts (besides attachments). Not a default case for the sake of clarity and future work.</span>&nbsp;</div></li><li><div>          case 'posts' :&nbsp;</div></li><li><div>              foreach ( $config[ $type ] as $id =&gt; $item ) {&nbsp;</div></li><li><div>                  if ( is_array( $item ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// Item extends core content.</span></span></span>&nbsp;</div></li><li><div>                      if ( ! empty( $core_content[ $type ][ $id ] ) ) {&nbsp;</div></li><li><div>                          $item = array_merge( $core_content[ $type ][ $id ], $item );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Enforce a subset of fields.</span>&nbsp;</div></li><li><div>                      $content[ $type ][ $id ] = wp_array_slice_assoc(&nbsp;</div></li><li><div>                          $item, &nbsp;</div></li><li><div>                          array(&nbsp;</div></li><li><div>                              'post_type', &nbsp;</div></li><li><div>                              'post_title', &nbsp;</div></li><li><div>                              'post_excerpt', &nbsp;</div></li><li><div>                              'post_name', &nbsp;</div></li><li><div>                              'post_content', &nbsp;</div></li><li><div>                              'menu_order', &nbsp;</div></li><li><div>                              'comment_status', &nbsp;</div></li><li><div>                              'thumbnail', &nbsp;</div></li><li><div>                              'template', &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  } elseif ( is_string( $item ) && ! empty( $core_content[ $type ][ $item ] ) ) {&nbsp;</div></li><li><div>                      $content[ $type ][ $item ] = $core_content[ $type ][ $item ];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the expanded array of starter content.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $content Array of starter content.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $config  Array of theme-specific starter content configuration.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'get_theme_starter_content', $content, $config );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Registers theme support for a given feature.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Must be called in the theme's functions.php file to work.</span>&nbsp;</div></li><li><div><span class="comment"> * If attached to a hook, it must be {@see 'after_setup_theme'}.</span>&nbsp;</div></li><li><div><span class="comment"> * The {@see 'init'} hook may be too late for some features.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.6.0 The `html5` feature was added</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.9.0 The `html5` feature now also accepts 'gallery' and 'caption'</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.1.0 The `title-tag` feature was added</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.5.0 The `customize-selective-refresh-widgets` feature was added</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0 The `starter-content` feature was added</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_theme_features</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $feature  The feature being added. Likely core values include 'post-formats', </span>&nbsp;</div></li><li><div><span class="comment"> *                         'post-thumbnails', 'html5', 'custom-logo', 'custom-header-uploads', </span>&nbsp;</div></li><li><div><span class="comment"> *                         'custom-header', 'custom-background', 'title-tag', 'starter-content', etc.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $args, ... Optional extra arguments to pass along with certain features.</span>&nbsp;</div></li><li><div><span class="comment"> * @return void|bool False on failure, void otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_theme_support( $feature ) {&nbsp;</div></li><li><div>  global $_wp_theme_features;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( func_num_args() == 1 )&nbsp;</div></li><li><div>      $args = true;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $args = array_slice( func_get_args(), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $feature ) {&nbsp;</div></li><li><div>      case 'post-thumbnails':&nbsp;</div></li><li><div>          <span class="comment">// All post types are already supported.</span>&nbsp;</div></li><li><div>          if ( true === get_theme_support( 'post-thumbnails' ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Merge post types with any that already declared their support</span>&nbsp;</div></li><li><div><span class="comment">           * for post thumbnails.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( is_array( $args[0] ) && isset( $_wp_theme_features['post-thumbnails'] ) ) {&nbsp;</div></li><li><div>              $args[0] = array_unique( array_merge( $_wp_theme_features['post-thumbnails'][0], $args[0] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'post-formats' :&nbsp;</div></li><li><div>          if ( is_array( $args[0] ) ) {&nbsp;</div></li><li><div>              $post_formats = get_post_format_slugs();&nbsp;</div></li><li><div>              unset( $post_formats['standard'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $args[0] = array_intersect( $args[0], array_keys( $post_formats ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'html5' :&nbsp;</div></li><li><div>          <span class="comment">// You can't just pass 'html5', you need to pass an array of types.</span>&nbsp;</div></li><li><div>          if ( empty( $args[0] ) ) {&nbsp;</div></li><li><div>              <span class="comment">// Build an array of types for back-compat.</span>&nbsp;</div></li><li><div>              $args = array( 0 =&gt; array( 'comment-list', 'comment-form', 'search-form' ) );&nbsp;</div></li><li><div>          } elseif ( ! is_array( $args[0] ) ) {&nbsp;</div></li><li><div>              _doing_it_wrong( &quot;add_theme_support( 'html5' )&quot;, __( 'You need to pass an array of types.' ), '3.6.1' );&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Calling 'html5' again merges, rather than overwrites.</span>&nbsp;</div></li><li><div>          if ( isset( $_wp_theme_features['html5'] ) )&nbsp;</div></li><li><div>              $args[0] = array_merge( $_wp_theme_features['html5'][0], $args[0] );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'custom-logo':&nbsp;</div></li><li><div>          if ( ! is_array( $args ) ) {&nbsp;</div></li><li><div>              $args = array( 0 =&gt; array() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'width' =&gt; null, &nbsp;</div></li><li><div>              'height' =&gt; null, &nbsp;</div></li><li><div>              'flex-width' =&gt; false, &nbsp;</div></li><li><div>              'flex-height' =&gt; false, &nbsp;</div></li><li><div>              'header-text' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $args[0] = wp_parse_args( array_intersect_key( $args[0], $defaults ), $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Allow full flexibility if no size is specified.</span>&nbsp;</div></li><li><div>          if ( is_null( $args[0]['width'] ) && is_null( $args[0]['height'] ) ) {&nbsp;</div></li><li><div>              $args[0]['flex-width'] = true;&nbsp;</div></li><li><div>              $args[0]['flex-height'] = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'custom-header-uploads' :&nbsp;</div></li><li><div>          return add_theme_support( 'custom-header', array( 'uploads' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'custom-header' :&nbsp;</div></li><li><div>          if ( ! is_array( $args ) )&nbsp;</div></li><li><div>              $args = array( 0 =&gt; array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'default-image' =&gt; '', &nbsp;</div></li><li><div>              'random-default' =&gt; false, &nbsp;</div></li><li><div>              'width' =&gt; 0, &nbsp;</div></li><li><div>              'height' =&gt; 0, &nbsp;</div></li><li><div>              'flex-height' =&gt; false, &nbsp;</div></li><li><div>              'flex-width' =&gt; false, &nbsp;</div></li><li><div>              'default-text-color' =&gt; '', &nbsp;</div></li><li><div>              'header-text' =&gt; true, &nbsp;</div></li><li><div>              'uploads' =&gt; true, &nbsp;</div></li><li><div>              'wp-head-callback' =&gt; '', &nbsp;</div></li><li><div>              'admin-head-callback' =&gt; '', &nbsp;</div></li><li><div>              'admin-preview-callback' =&gt; '', &nbsp;</div></li><li><div>              'video' =&gt; false, &nbsp;</div></li><li><div>              'video-active-callback' =&gt; 'is_front_page', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $jit = isset( $args[0]['__jit'] );&nbsp;</div></li><li><div>          unset( $args[0]['__jit'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Merge in data from previous add_theme_support() calls.</span>&nbsp;</div></li><li><div>          <span class="comment">// The first value registered wins. (A child theme is set up first.)</span>&nbsp;</div></li><li><div>          if ( isset( $_wp_theme_features['custom-header'] ) )&nbsp;</div></li><li><div>              $args[0] = wp_parse_args( $_wp_theme_features['custom-header'][0], $args[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Load in the defaults at the end, as we need to insure first one wins.</span>&nbsp;</div></li><li><div>          <span class="comment">// This will cause all constants to be defined, as each arg will then be set to the default.</span>&nbsp;</div></li><li><div>          if ( $jit )&nbsp;</div></li><li><div>              $args[0] = wp_parse_args( $args[0], $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If a constant was defined, use that value. Otherwise, define the constant to ensure</span>&nbsp;</div></li><li><div>          <span class="comment">// the constant is always accurate (and is not defined later, overriding our value).</span>&nbsp;</div></li><li><div>          <span class="comment">// As stated above, the first value wins.</span>&nbsp;</div></li><li><div>          <span class="comment">// Once we get to wp_loaded (just-in-time), define any constants we haven't already.</span>&nbsp;</div></li><li><div>          <span class="comment">// Constants are lame. Don't reference them. This is just for backward compatibility.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined( 'NO_HEADER_TEXT' ) )&nbsp;</div></li><li><div>              $args[0]['header-text'] = ! NO_HEADER_TEXT;&nbsp;</div></li><li><div>          elseif ( isset( $args[0]['header-text'] ) )&nbsp;</div></li><li><div>              define( 'NO_HEADER_TEXT', empty( $args[0]['header-text'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined( 'HEADER_IMAGE_WIDTH' ) )&nbsp;</div></li><li><div>              $args[0]['width'] = (int) HEADER_IMAGE_WIDTH;&nbsp;</div></li><li><div>          elseif ( isset( $args[0]['width'] ) )&nbsp;</div></li><li><div>              define( 'HEADER_IMAGE_WIDTH', (int) $args[0]['width'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined( 'HEADER_IMAGE_HEIGHT' ) )&nbsp;</div></li><li><div>              $args[0]['height'] = (int) HEADER_IMAGE_HEIGHT;&nbsp;</div></li><li><div>          elseif ( isset( $args[0]['height'] ) )&nbsp;</div></li><li><div>              define( 'HEADER_IMAGE_HEIGHT', (int) $args[0]['height'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined( 'HEADER_TEXTCOLOR' ) )&nbsp;</div></li><li><div>              $args[0]['default-text-color'] = HEADER_TEXTCOLOR;&nbsp;</div></li><li><div>          elseif ( isset( $args[0]['default-text-color'] ) )&nbsp;</div></li><li><div>              define( 'HEADER_TEXTCOLOR', $args[0]['default-text-color'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined( 'HEADER_IMAGE' ) )&nbsp;</div></li><li><div>              $args[0]['default-image'] = HEADER_IMAGE;&nbsp;</div></li><li><div>          elseif ( isset( $args[0]['default-image'] ) )&nbsp;</div></li><li><div>              define( 'HEADER_IMAGE', $args[0]['default-image'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $jit && ! empty( $args[0]['default-image'] ) )&nbsp;</div></li><li><div>              $args[0]['random-default'] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If headers are supported, and we still don't have a defined width or height, </span>&nbsp;</div></li><li><div>          <span class="comment">// we have implicit flex sizes.</span>&nbsp;</div></li><li><div>          if ( $jit ) {&nbsp;</div></li><li><div>              if ( empty( $args[0]['width'] ) && empty( $args[0]['flex-width'] ) )&nbsp;</div></li><li><div>                  $args[0]['flex-width'] = true;&nbsp;</div></li><li><div>              if ( empty( $args[0]['height'] ) && empty( $args[0]['flex-height'] ) )&nbsp;</div></li><li><div>                  $args[0]['flex-height'] = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'custom-background' :&nbsp;</div></li><li><div>          if ( ! is_array( $args ) )&nbsp;</div></li><li><div>              $args = array( 0 =&gt; array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'default-image' =&gt; '', &nbsp;</div></li><li><div>              'default-preset' =&gt; 'default', &nbsp;</div></li><li><div>              'default-position-x' =&gt; 'left', &nbsp;</div></li><li><div>              'default-position-y' =&gt; 'top', &nbsp;</div></li><li><div>              'default-size' =&gt; 'auto', &nbsp;</div></li><li><div>              'default-repeat' =&gt; 'repeat', &nbsp;</div></li><li><div>              'default-attachment' =&gt; 'scroll', &nbsp;</div></li><li><div>              'default-color' =&gt; '', &nbsp;</div></li><li><div>              'wp-head-callback' =&gt; '_custom_background_cb', &nbsp;</div></li><li><div>              'admin-head-callback' =&gt; '', &nbsp;</div></li><li><div>              'admin-preview-callback' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $jit = isset( $args[0]['__jit'] );&nbsp;</div></li><li><div>          unset( $args[0]['__jit'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Merge in data from previous add_theme_support() calls.</span> The first value registered wins.&nbsp;</div></li><li><div>          if ( isset( $_wp_theme_features['custom-background'] ) )&nbsp;</div></li><li><div>              $args[0] = wp_parse_args( $_wp_theme_features['custom-background'][0], $args[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $jit )&nbsp;</div></li><li><div>              $args[0] = wp_parse_args( $args[0], $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined( 'BACKGROUND_COLOR' ) )&nbsp;</div></li><li><div>              $args[0]['default-color'] = BACKGROUND_COLOR;&nbsp;</div></li><li><div>          elseif ( isset( $args[0]['default-color'] ) || $jit )&nbsp;</div></li><li><div>              define( 'BACKGROUND_COLOR', $args[0]['default-color'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined( 'BACKGROUND_IMAGE' ) )&nbsp;</div></li><li><div>              $args[0]['default-image'] = BACKGROUND_IMAGE;&nbsp;</div></li><li><div>          elseif ( isset( $args[0]['default-image'] ) || $jit )&nbsp;</div></li><li><div>              define( 'BACKGROUND_IMAGE', $args[0]['default-image'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Ensure that 'title-tag' is accessible in the admin.</span>&nbsp;</div></li><li><div>      case 'title-tag' :&nbsp;</div></li><li><div>          <span class="comment">// Can be called in functions.php but must happen before wp_loaded, i.e. not in header.php.</span>&nbsp;</div></li><li><div>          if ( did_action( 'wp_loaded' ) ) {&nbsp;</div></li><li><div>              <span class="comment">/** translators: 1: Theme support 2: hook name */</span>&nbsp;</div></li><li><div>              _doing_it_wrong( &quot;add_theme_support( 'title-tag' )&quot;, sprintf( __( 'Theme support for %1$s should be registered before the %2$s hook.' ), &nbsp;</div></li><li><div>                  '&lt;code&gt;title-tag&lt;/code&gt;', '&lt;code&gt;wp_loaded&lt;/code&gt;' ), '4.1.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_wp_theme_features[ $feature ] = $args;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Registers the internal custom header and background routines.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global Custom_Image_Header $custom_image_header</span>&nbsp;</div></li><li><div><span class="comment"> * @global Custom_Background   $custom_background</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _custom_header_background_just_in_time() {&nbsp;</div></li><li><div>  global $custom_image_header, $custom_background;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( current_theme_supports( 'custom-header' ) ) {&nbsp;</div></li><li><div>      <span class="comment">// In case any constants were defined after an add_custom_image_header() call, re-run.</span>&nbsp;</div></li><li><div>      add_theme_support( 'custom-header', array( '__jit' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = get_theme_support( 'custom-header' );&nbsp;</div></li><li><div>      if ( $args[0]['wp-head-callback'] )&nbsp;</div></li><li><div>          add_action( 'wp_head', $args[0]['wp-head-callback'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_admin() ) {&nbsp;</div></li><li><div>          require_once( ABSPATH . 'wp-admin/custom-header.php' );&nbsp;</div></li><li><div>          $custom_image_header = new Custom_Image_Header( $args[0]['admin-head-callback'], $args[0]['admin-preview-callback'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( current_theme_supports( 'custom-background' ) ) {&nbsp;</div></li><li><div>      <span class="comment">// In case any constants were defined after an add_custom_background() call, re-run.</span>&nbsp;</div></li><li><div>      add_theme_support( 'custom-background', array( '__jit' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = get_theme_support( 'custom-background' );&nbsp;</div></li><li><div>      add_action( 'wp_head', $args[0]['wp-head-callback'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_admin() ) {&nbsp;</div></li><li><div>          require_once( ABSPATH . 'wp-admin/custom-background.php' );&nbsp;</div></li><li><div>          $custom_background = new Custom_Background( $args[0]['admin-head-callback'], $args[0]['admin-preview-callback'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds CSS to hide header text for custom logo, based on Customizer setting.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.5.0</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _custom_logo_header_styles() {&nbsp;</div></li><li><div>  if ( ! current_theme_supports( 'custom-header', 'header-text' ) && get_theme_support( 'custom-logo', 'header-text' ) && ! get_theme_mod( 'header_text', true ) ) {&nbsp;</div></li><li><div>      $classes = (array) get_theme_support( 'custom-logo', 'header-text' );&nbsp;</div></li><li><div>      $classes = array_map( 'sanitize_html_class', $classes );&nbsp;</div></li><li><div>      $classes = '.' . implode( ', .', $classes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;!-- Custom Logo: hide header text --&gt;&nbsp;</div></li><li><div>      &lt;style id=&quot;custom-logo-css&quot; type=&quot;text/css&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php echo $classes; ?&gt; {&nbsp;</div></li><li><div>              position: absolute;&nbsp;</div></li><li><div>              clip: rect(1px, 1px, 1px, 1px);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      &lt;/style&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets the theme support arguments passed when registering that support</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_theme_features</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $feature the feature to check</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed The array of extra arguments or the value for the registered feature.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_theme_support( $feature ) {&nbsp;</div></li><li><div>  global $_wp_theme_features;&nbsp;</div></li><li><div>  if ( ! isset( $_wp_theme_features[ $feature ] ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( func_num_args() &lt;= 1 )&nbsp;</div></li><li><div>      return $_wp_theme_features[ $feature ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array_slice( func_get_args(), 1 );&nbsp;</div></li><li><div>  switch ( $feature ) {&nbsp;</div></li><li><div>      case 'custom-logo' :&nbsp;</div></li><li><div>      case 'custom-header' :&nbsp;</div></li><li><div>      case 'custom-background' :&nbsp;</div></li><li><div>          if ( isset( $_wp_theme_features[ $feature ][0][ $args[0] ] ) )&nbsp;</div></li><li><div>              return $_wp_theme_features[ $feature ][0][ $args[0] ];&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      default :&nbsp;</div></li><li><div>          return $_wp_theme_features[ $feature ];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Allows a theme to de-register its support of a certain feature</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Should be called in the theme's functions.php file. Generally would</span>&nbsp;</div></li><li><div><span class="comment"> * be used for child themes to override support from the parent theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see add_theme_support()</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $feature the feature being added</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|void Whether feature was removed.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_theme_support( $feature ) {&nbsp;</div></li><li><div>  <span class="comment">// Blacklist: for internal registrations not used directly by themes.</span>&nbsp;</div></li><li><div>  if ( in_array( $feature, array( 'editor-style', 'widgets', 'menus' ) ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return _remove_theme_support( $feature );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Do not use. Removes theme support internally, ignorant of the blacklist.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array               $_wp_theme_features</span>&nbsp;</div></li><li><div><span class="comment"> * @global Custom_Image_Header $custom_image_header</span>&nbsp;</div></li><li><div><span class="comment"> * @global Custom_Background   $custom_background</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $feature</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _remove_theme_support( $feature ) {&nbsp;</div></li><li><div>  global $_wp_theme_features;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $feature ) {&nbsp;</div></li><li><div>      case 'custom-header-uploads' :&nbsp;</div></li><li><div>          if ( ! isset( $_wp_theme_features['custom-header'] ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          add_theme_support( 'custom-header', array( 'uploads' =&gt; false ) );&nbsp;</div></li><li><div>          return; <span class="comment">// Do not continue - custom-header-uploads no longer exists.</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $_wp_theme_features[ $feature ] ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $feature ) {&nbsp;</div></li><li><div>      case 'custom-header' :&nbsp;</div></li><li><div>          if ( ! did_action( 'wp_loaded' ) )&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          $support = get_theme_support( 'custom-header' );&nbsp;</div></li><li><div>          if ( isset( $support[0]['wp-head-callback'] ) ) {&nbsp;</div></li><li><div>              remove_action( 'wp_head', $support[0]['wp-head-callback'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( isset( $GLOBALS['custom_image_header'] ) ) {&nbsp;</div></li><li><div>              remove_action( 'admin_menu', array( $GLOBALS['custom_image_header'], 'init' ) );&nbsp;</div></li><li><div>              unset( $GLOBALS['custom_image_header'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'custom-background' :&nbsp;</div></li><li><div>          if ( ! did_action( 'wp_loaded' ) )&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          $support = get_theme_support( 'custom-background' );&nbsp;</div></li><li><div>          remove_action( 'wp_head', $support[0]['wp-head-callback'] );&nbsp;</div></li><li><div>          remove_action( 'admin_menu', array( $GLOBALS['custom_background'], 'init' ) );&nbsp;</div></li><li><div>          unset( $GLOBALS['custom_background'] );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  unset( $_wp_theme_features[ $feature ] );&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks a theme's support for a given feature</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_wp_theme_features</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $feature the feature being checked</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function current_theme_supports( $feature ) {&nbsp;</div></li><li><div>  global $_wp_theme_features;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'custom-header-uploads' == $feature )&nbsp;</div></li><li><div>      return current_theme_supports( 'custom-header', 'uploads' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !isset( $_wp_theme_features[$feature] ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If no args passed then no extra checks need be performed</span>&nbsp;</div></li><li><div>  if ( func_num_args() &lt;= 1 )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array_slice( func_get_args(), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $feature ) {&nbsp;</div></li><li><div>      case 'post-thumbnails':&nbsp;</div></li><li><div>          <span class="comment">// post-thumbnails can be registered for only certain content/post types by passing</span>&nbsp;</div></li><li><div>          <span class="comment">// an array of types to add_theme_support(). If no array was passed, then</span>&nbsp;</div></li><li><div>          <span class="comment">// any type is accepted</span>&nbsp;</div></li><li><div>          if ( true === $_wp_theme_features[$feature] )  <span class="comment">// Registered for all types</span>&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          $content_type = $args[0];&nbsp;</div></li><li><div>          return in_array( $content_type, $_wp_theme_features[$feature][0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'html5':&nbsp;</div></li><li><div>      case 'post-formats':&nbsp;</div></li><li><div>          <span class="comment">// specific post formats can be registered by passing an array of types to</span>&nbsp;</div></li><li><div>          <span class="comment">// add_theme_support()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Specific areas of HTML5 support *must* be passed via an array to add_theme_support()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $type = $args[0];&nbsp;</div></li><li><div>          return in_array( $type, $_wp_theme_features[$feature][0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'custom-logo':&nbsp;</div></li><li><div>      case 'custom-header':&nbsp;</div></li><li><div>      case 'custom-background':&nbsp;</div></li><li><div>          <span class="comment">// Specific capabilities can be registered by passing an array to add_theme_support().</span>&nbsp;</div></li><li><div>          return ( isset( $_wp_theme_features[ $feature ][0][ $args[0] ] ) && $_wp_theme_features[ $feature ][0][ $args[0] ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether the current theme supports a specific feature.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The dynamic portion of the hook name, `$feature`, refers to the specific theme</span>&nbsp;</div></li><li><div><span class="comment">   * feature. Possible values include 'post-formats', 'post-thumbnails', 'custom-background', </span>&nbsp;</div></li><li><div><span class="comment">   * 'custom-header', 'menus', 'automatic-feed-links', 'html5', </span>&nbsp;</div></li><li><div><span class="comment">   * 'starter-content', and 'customize-selective-refresh-widgets'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool   true     Whether the current theme supports the given feature. Default true.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args    Array of arguments for the feature.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $feature The theme feature.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( &quot;current_theme_supports-{$feature}&quot;, true, $args, $_wp_theme_features[$feature] );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks a theme's support for a given feature before loading the functions which implement it.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $feature The feature being checked.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $include Path to the file.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the current theme supports the supplied feature, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function require_if_theme_supports( $feature, $include ) {&nbsp;</div></li><li><div>  if ( current_theme_supports( $feature ) ) {&nbsp;</div></li><li><div>      require ( $include );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks an attachment being deleted to see if it's a header or background image.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If true it removes the theme modification which would be pointing at the deleted</span>&nbsp;</div></li><li><div><span class="comment"> * attachment.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0 Also removes `header_image_data`.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.5.0 Also removes custom logo theme mods.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $id The attachment id.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _delete_attachment_theme_mod( $id ) {&nbsp;</div></li><li><div>  $attachment_image = wp_get_attachment_url( $id );&nbsp;</div></li><li><div>  $header_image = get_header_image();&nbsp;</div></li><li><div>  $background_image = get_background_image();&nbsp;</div></li><li><div>  $custom_logo_id = get_theme_mod( 'custom_logo' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $custom_logo_id && $custom_logo_id == $id ) {&nbsp;</div></li><li><div>      remove_theme_mod( 'custom_logo' );&nbsp;</div></li><li><div>      remove_theme_mod( 'header_text' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $header_image && $header_image == $attachment_image ) {&nbsp;</div></li><li><div>      remove_theme_mod( 'header_image' );&nbsp;</div></li><li><div>      remove_theme_mod( 'header_image_data' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $background_image && $background_image == $attachment_image ) {&nbsp;</div></li><li><div>      remove_theme_mod( 'background_image' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if a theme has been changed and runs 'after_switch_theme' hook on the next WP load.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * See {@see 'after_switch_theme'}.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.3.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function check_theme_switched() {&nbsp;</div></li><li><div>  if ( $stylesheet = get_option( 'theme_switched' ) ) {&nbsp;</div></li><li><div>      $old_theme = wp_get_theme( $stylesheet );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Prevent retrieve_widgets() from running since Customizer already called it up front</span>&nbsp;</div></li><li><div>      if ( get_option( 'theme_switched_via_customizer' ) ) {&nbsp;</div></li><li><div>          remove_action( 'after_switch_theme', '_wp_sidebars_changed' );&nbsp;</div></li><li><div>          update_option( 'theme_switched_via_customizer', false );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $old_theme-&gt;exists() ) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires on the first WP load after a theme switch if the old theme still exists.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * This action fires multiple times and the parameters differs</span>&nbsp;</div></li><li><div><span class="comment">           * according to the context, if the old theme exists or not.</span>&nbsp;</div></li><li><div><span class="comment">           * If the old theme is missing, the parameter will be the slug</span>&nbsp;</div></li><li><div><span class="comment">           * of the old theme.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.3.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string   $old_name  Old theme name.</span>&nbsp;</div></li><li><div><span class="comment">           * @param WP_Theme $old_theme WP_Theme instance of the old theme.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'after_switch_theme', $old_theme-&gt;get( 'Name' ), $old_theme );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">/** This action is documented in wp-includes/theme.php */</span>&nbsp;</div></li><li><div>          do_action( 'after_switch_theme', $stylesheet );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      flush_rewrite_rules();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_option( 'theme_switched', false );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Includes and instantiates the WP_Customize_Manager class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Loads the Customizer at plugins_loaded when accessing the customize.php admin</span>&nbsp;</div></li><li><div><span class="comment"> * page or when any request includes a wp_customize=on param or a customize_changeset</span>&nbsp;</div></li><li><div><span class="comment"> * param (a UUID). This param is a signal for whether to bootstrap the Customizer when</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress is loading, especially in the Customizer preview</span>&nbsp;</div></li><li><div><span class="comment"> * or when making Customizer Ajax requests for widgets or menus.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Customize_Manager $wp_customize</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_customize_include() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $is_customize_admin_page = ( is_admin() && 'customize.php' == basename( $_SERVER['PHP_SELF'] ) );&nbsp;</div></li><li><div>  $should_include = (&nbsp;</div></li><li><div>      $is_customize_admin_page&nbsp;</div></li><li><div>      ||&nbsp;</div></li><li><div>      ( isset( $_REQUEST['wp_customize'] ) && 'on' == $_REQUEST['wp_customize'] )&nbsp;</div></li><li><div>      ||&nbsp;</div></li><li><div>      ( ! empty( $_GET['customize_changeset_uuid'] ) || ! empty( $_POST['customize_changeset_uuid'] ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $should_include ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Note that wp_unslash() is not being used on the input vars because it is</span>&nbsp;</div></li><li><div><span class="comment">   * called before wp_magic_quotes() gets called. Besides this fact, none of</span>&nbsp;</div></li><li><div><span class="comment">   * the values should contain any characters needing slashes anyway.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $keys = array( 'changeset_uuid', 'customize_changeset_uuid', 'customize_theme', 'theme', 'customize_messenger_channel' );&nbsp;</div></li><li><div>  $input_vars = array_merge(&nbsp;</div></li><li><div>      wp_array_slice_assoc( $_GET, $keys ), &nbsp;</div></li><li><div>      wp_array_slice_assoc( $_POST, $keys )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $theme = null;&nbsp;</div></li><li><div>  $changeset_uuid = null;&nbsp;</div></li><li><div>  $messenger_channel = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $is_customize_admin_page && isset( $input_vars['changeset_uuid'] ) ) {&nbsp;</div></li><li><div>      $changeset_uuid = sanitize_key( $input_vars['changeset_uuid'] );&nbsp;</div></li><li><div>  } elseif ( ! empty( $input_vars['customize_changeset_uuid'] ) ) {&nbsp;</div></li><li><div>      $changeset_uuid = sanitize_key( $input_vars['customize_changeset_uuid'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Note that theme will be sanitized via WP_Theme.</span>&nbsp;</div></li><li><div>  if ( $is_customize_admin_page && isset( $input_vars['theme'] ) ) {&nbsp;</div></li><li><div>      $theme = $input_vars['theme'];&nbsp;</div></li><li><div>  } elseif ( isset( $input_vars['customize_theme'] ) ) {&nbsp;</div></li><li><div>      $theme = $input_vars['customize_theme'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( isset( $input_vars['customize_messenger_channel'] ) ) {&nbsp;</div></li><li><div>      $messenger_channel = sanitize_key( $input_vars['customize_messenger_channel'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';&nbsp;</div></li><li><div>  $GLOBALS['wp_customize'] = new WP_Customize_Manager( compact( 'changeset_uuid', 'theme', 'messenger_channel' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Publish a snapshot's changes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string  $new_status     New post status.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string  $old_status     Old post status.</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Post $changeset_post Changeset post object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_customize_publish_changeset( $new_status, $old_status, $changeset_post ) {&nbsp;</div></li><li><div>  global $wp_customize, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $is_publishing_changeset = (&nbsp;</div></li><li><div>      'customize_changeset' === $changeset_post-&gt;post_type&nbsp;</div></li><li><div>      &&&nbsp;</div></li><li><div>      'publish' === $new_status&nbsp;</div></li><li><div>      &&&nbsp;</div></li><li><div>      'publish' !== $old_status&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( ! $is_publishing_changeset ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $wp_customize ) ) {&nbsp;</div></li><li><div>      require_once ABSPATH . WPINC . '/class-wp-customize-manager.php';&nbsp;</div></li><li><div>      $wp_customize = new WP_Customize_Manager( array( 'changeset_uuid' =&gt; $changeset_post-&gt;post_name ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! did_action( 'customize_register' ) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * When running from CLI or Cron, the customize_register action will need</span>&nbsp;</div></li><li><div><span class="comment">       * to be triggered in order for core, themes, and plugins to register their</span>&nbsp;</div></li><li><div><span class="comment">       * settings. Normally core will add_action( 'customize_register' ) at</span>&nbsp;</div></li><li><div><span class="comment">       * priority 10 to register the core settings, and if any themes/plugins</span>&nbsp;</div></li><li><div><span class="comment">       * also add_action( 'customize_register' ) at the same priority, they</span>&nbsp;</div></li><li><div><span class="comment">       * will have a $wp_customize with those settings registered since they</span>&nbsp;</div></li><li><div><span class="comment">       * call add_action() afterward, normally. However, when manually doing</span>&nbsp;</div></li><li><div><span class="comment">       * the customize_register action after the setup_theme, then the order</span>&nbsp;</div></li><li><div><span class="comment">       * will be reversed for two actions added at priority 10, resulting in</span>&nbsp;</div></li><li><div><span class="comment">       * the core settings no longer being available as expected to themes/plugins.</span>&nbsp;</div></li><li><div><span class="comment">       * So the following manually calls the method that registers the core</span>&nbsp;</div></li><li><div><span class="comment">       * settings up front before doing the action.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      remove_action( 'customize_register', array( $wp_customize, 'register_controls' ) );&nbsp;</div></li><li><div>      $wp_customize-&gt;register_controls();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** This filter is documented in /wp-includes/class-wp-customize-manager.php */</span>&nbsp;</div></li><li><div>      do_action( 'customize_register', $wp_customize );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $wp_customize-&gt;_publish_changeset_values( $changeset_post-&gt;ID ) ;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Trash the changeset post if revisions are not enabled. Unpublished</span>&nbsp;</div></li><li><div><span class="comment">   * changesets by default get garbage collected due to the auto-draft status.</span>&nbsp;</div></li><li><div><span class="comment">   * When a changeset post is published, however, it would no longer get cleaned</span>&nbsp;</div></li><li><div><span class="comment">   * out. Ths is a problem when the changeset posts are never displayed anywhere, </span>&nbsp;</div></li><li><div><span class="comment">   * since they would just be endlessly piling up. So here we use the revisions</span>&nbsp;</div></li><li><div><span class="comment">   * feature to indicate whether or not a published changeset should get trashed</span>&nbsp;</div></li><li><div><span class="comment">   * and thus garbage collected.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( ! wp_revisions_enabled( $changeset_post ) ) {&nbsp;</div></li><li><div>      $post = $changeset_post;&nbsp;</div></li><li><div>      $post_id = $changeset_post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * The following re-formulates the logic from wp_trash_post() as done in</span>&nbsp;</div></li><li><div><span class="comment">       * wp_publish_post(). The reason for bypassing wp_trash_post() is that it</span>&nbsp;</div></li><li><div><span class="comment">       * will mutate the the post_content and the post_name when they should be</span>&nbsp;</div></li><li><div><span class="comment">       * untouched.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( ! EMPTY_TRASH_DAYS ) {&nbsp;</div></li><li><div>          wp_delete_post( $post_id, true );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-includes/post.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          do_action( 'wp_trash_post', $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          add_post_meta( $post_id, '_wp_trash_meta_status', $post-&gt;post_status );&nbsp;</div></li><li><div>          add_post_meta( $post_id, '_wp_trash_meta_time', time() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $old_status = $post-&gt;post_status;&nbsp;</div></li><li><div>          $new_status = 'trash';&nbsp;</div></li><li><div>          $wpdb-&gt;update( $wpdb-&gt;posts, array( 'post_status' =&gt; $new_status ), array( 'ID' =&gt; $post-&gt;ID ) );&nbsp;</div></li><li><div>          clean_post_cache( $post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $post-&gt;post_status = $new_status;&nbsp;</div></li><li><div>          wp_transition_post_status( $new_status, $old_status, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-includes/post.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          do_action( 'edit_post', $post-&gt;ID, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-includes/post.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          do_action( &quot;save_post_{$post-&gt;post_type}&quot;, $post-&gt;ID, $post, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-includes/post.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          do_action( 'save_post', $post-&gt;ID, $post, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-includes/post.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          do_action( 'wp_insert_post', $post-&gt;ID, $post, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** This action is documented in wp-includes/post.php */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          do_action( 'trashed_post', $post_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filters changeset post data upon insert to ensure post_name is intact.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This is needed to prevent the post_name from being dropped when the post is</span>&nbsp;</div></li><li><div><span class="comment"> * transitioned into pending status by a contributor.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see wp_insert_post()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $post_data          An array of slashed post data.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $supplied_post_data An array of sanitized, but otherwise unmodified post data.</span>&nbsp;</div></li><li><div><span class="comment"> * @returns array Filtered data.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_customize_changeset_filter_insert_post_data( $post_data, $supplied_post_data ) {&nbsp;</div></li><li><div>  if ( isset( $post_data['post_type'] ) && 'customize_changeset' === $post_data['post_type'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Prevent post_name from being dropped, such as when contributor saves a changeset post as pending.</span>&nbsp;</div></li><li><div>      if ( empty( $post_data['post_name'] ) && ! empty( $supplied_post_data['post_name'] ) ) {&nbsp;</div></li><li><div>          $post_data['post_name'] = $supplied_post_data['post_name'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $post_data;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds settings for the customize-loader script.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_customize_loader_settings() {&nbsp;</div></li><li><div>  $admin_origin = parse_url( admin_url() );&nbsp;</div></li><li><div>  $home_origin = parse_url( home_url() );&nbsp;</div></li><li><div>  $cross_domain = ( strtolower( $admin_origin[ 'host' ] ) != strtolower( $home_origin[ 'host' ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $browser = array(&nbsp;</div></li><li><div>      'mobile' =&gt; wp_is_mobile(), &nbsp;</div></li><li><div>      'ios' =&gt; wp_is_mobile() && preg_match( '/iPad|iPod|iPhone/', $_SERVER['HTTP_USER_AGENT'] ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = array(&nbsp;</div></li><li><div>      'url' =&gt; esc_url( admin_url( 'customize.php' ) ), &nbsp;</div></li><li><div>      'isCrossDomain' =&gt; $cross_domain, &nbsp;</div></li><li><div>      'browser' =&gt; $browser, &nbsp;</div></li><li><div>      'l10n' =&gt; array(&nbsp;</div></li><li><div>          'saveAlert' =&gt; __( 'The changes you made will be lost if you navigate away from this page.' ), &nbsp;</div></li><li><div>          'mainIframeTitle' =&gt; __( 'Customizer' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $script = 'var _wpCustomizeLoaderSettings = ' . wp_json_encode( $settings ) . ';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_scripts = wp_scripts();&nbsp;</div></li><li><div>  $data = $wp_scripts-&gt;get_data( 'customize-loader', 'data' );&nbsp;</div></li><li><div>  if ( $data )&nbsp;</div></li><li><div>      $script = &quot;$data\n$script&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $wp_scripts-&gt;add_data( 'customize-loader', 'data', $script );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns a URL to load the Customizer.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $stylesheet Optional. Theme to customize. Defaults to current theme.</span>&nbsp;</div></li><li><div><span class="comment"> *                              The theme's stylesheet will be urlencoded if necessary.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_customize_url( $stylesheet = null ) {&nbsp;</div></li><li><div>  $url = admin_url( 'customize.php' );&nbsp;</div></li><li><div>  if ( $stylesheet )&nbsp;</div></li><li><div>      $url .= '?theme=' . urlencode( $stylesheet );&nbsp;</div></li><li><div>  return esc_url( $url );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Prints a script to check whether or not the Customizer is supported, </span>&nbsp;</div></li><li><div><span class="comment"> * and apply either the no-customize-support or customize-support class</span>&nbsp;</div></li><li><div><span class="comment"> * to the body.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function MUST be called inside the body tag.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Ideally, call this function immediately after the body tag is opened.</span>&nbsp;</div></li><li><div><span class="comment"> * This prevents a flash of unstyled content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * It is also recommended that you add the &quot;no-customize-support&quot; class</span>&nbsp;</div></li><li><div><span class="comment"> * to the body tag by default.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.7.0 Support for IE8 and below is explicitly removed via conditional comments.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_customize_support_script() {&nbsp;</div></li><li><div>  $admin_origin = parse_url( admin_url() );&nbsp;</div></li><li><div>  $home_origin = parse_url( home_url() );&nbsp;</div></li><li><div>  $cross_domain = ( strtolower( $admin_origin[ 'host' ] ) != strtolower( $home_origin[ 'host' ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;!--[if lte IE 8]&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>          document.body.className = document.body.className.replace( /(^|\s)(no-)?customize-support(?=\s|$)/, '' ) + ' no-customize-support';&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;![endif]--&gt;&nbsp;</div></li><li><div>  &lt;!--[if gte IE 9]&gt;&lt;!--&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>          (function() {&nbsp;</div></li><li><div>              var request, b = document.body, c = 'className', cs = 'customize-support', rcs = new RegExp('(^|\\s+)(no-)?'+cs+'(\\s+|$)');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php    if ( $cross_domain ) : ?&gt;&nbsp;</div></li><li><div>              request = (function() { var xhr = new XMLHttpRequest(); return ('withCredentials' in xhr); })();&nbsp;</div></li><li><div>      &lt;?php    else : ?&gt;&nbsp;</div></li><li><div>              request = true;&nbsp;</div></li><li><div>      &lt;?php    endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              b[c] = b[c].replace( rcs, ' ' );&nbsp;</div></li><li><div>              <span class="comment">// The customizer requires postMessage and CORS (if the site is cross domain)</span>&nbsp;</div></li><li><div>              b[c] += ( window.postMessage && request ? ' ' : ' no-' ) + cs;&nbsp;</div></li><li><div>          }());&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;!--&lt;![endif]--&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether the site is being previewed in the Customizer.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Customize_Manager $wp_customize Customizer instance.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the site is being previewed in the Customizer, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_customize_preview() {&nbsp;</div></li><li><div>  global $wp_customize;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return ( $wp_customize instanceof WP_Customize_Manager ) && $wp_customize-&gt;is_preview();&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>wordpress</li><li><span></span>file</li><li><span></span></li><li><span></span>wp-include</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>