<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="theme" data-version="0.1" data-slug="evolved" data-type="file" data-id="102233"><head xmlns="http://www.w3.org/1999/xhtml"><title> meta-box-meta-box-3-2-2-class | file | Evolved | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, theme, evolved, 0.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ea88c24234927c4a56764b7492ed868b' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/meta-box-meta-box-3-2-2-class/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fmeta-box-meta-box-3-2-2-class%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fmeta-box-meta-box-3-2-2-class%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"theme-evolved-0.1-file-meta-box-meta-box-3-2-2-class","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="meta-box-meta-box-3-2-2-class" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to themes." href="http://hookr.io/themes/" class=""><span property="name">themes</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to evolved." href="http://hookr.io/themes/evolved/" class="plugin"><span property="name">evolved</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><span property="name">0.1</span><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/themes/evolved/0.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">meta-box-meta-box-3-2-2-class</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="190"><a href="http://hookr.io/themes/evolved/0.1/all/" title="All">All <span class="count badge">190</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/themes/evolved/0.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="54"><a href="http://hookr.io/themes/evolved/0.1/hooks/" title="Hooks">Hooks <span class="count badge">54</span></a></li><li class="" data-id="action" data-count="6"><a href="http://hookr.io/themes/evolved/0.1/actions/" title="Actions">Actions <span class="count badge">6</span></a></li><li class="" data-id="filter" data-count="48"><a href="http://hookr.io/themes/evolved/0.1/filters/" title="Filters">Filters <span class="count badge">48</span></a></li><li class="" data-id="class" data-count="25"><a href="http://hookr.io/themes/evolved/0.1/classes/" title="Classes">Classes <span class="count badge">25</span></a></li><li class="" data-id="constant" data-count="11"><a href="http://hookr.io/themes/evolved/0.1/constants/" title="Constants">Constants <span class="count badge">11</span></a></li><li class="" data-id="function" data-count="91"><a href="http://hookr.io/themes/evolved/0.1/functions/" title="Functions">Functions <span class="count badge">91</span></a></li><li class="" data-id="shortcode" data-count="9"><a href="http://hookr.io/themes/evolved/0.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">9</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class=""><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class="active"><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/meta-box/meta-box-3.2.2.class.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create meta box for editing pages in WordPress</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Compatible with custom post types since WordPress 3.0</span>&nbsp;</div></li><li><div><span class="comment"> * Support input types: text, textarea, checkbox, checkbox list, radio box, select, wysiwyg, file, image, date, time, color</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @author Rilwis &lt;rilwis@gmail.com&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @link http://www.deluxeblogtips.com/p/meta-box-script-for-wordpress.html</span>&nbsp;</div></li><li><div><span class="comment"> * @example meta-box-usage.php Sample declaration and usage of meta boxes</span>&nbsp;</div></li><li><div><span class="comment"> * @version: 3.2.2</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @license GNU General Public License v3.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Meta Box class</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class RW_Meta_Box {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  protected $_meta_box;&nbsp;</div></li><li><div>  protected $_fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Create meta box based on given data</span>&nbsp;</div></li><li><div>  function __construct($meta_box) {&nbsp;</div></li><li><div>      <span class="comment">// run script only in admin area</span>&nbsp;</div></li><li><div>      if (!is_admin()) return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// assign meta box values to local variables and add it's missed values</span>&nbsp;</div></li><li><div>      $this-&gt;_meta_box = $meta_box;&nbsp;</div></li><li><div>      $this-&gt;_fields = &$this-&gt;_meta_box['fields'];&nbsp;</div></li><li><div>      $this-&gt;add_missed_values();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action('add_meta_boxes', array(&$this, 'add'));    <span class="comment">// add meta box, using 'add_meta_boxes' for WP 3.0+</span>&nbsp;</div></li><li><div>      add_action('save_post', array(&$this, 'save'));        <span class="comment">// save meta box's data</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// check for some special fields and add needed actions for them</span>&nbsp;</div></li><li><div>      $this-&gt;check_field_upload();&nbsp;</div></li><li><div>      $this-&gt;check_field_color();&nbsp;</div></li><li><div>      $this-&gt;check_field_date();&nbsp;</div></li><li><div>      $this-&gt;check_field_time();&nbsp;</div></li><li><div>      $this-&gt;check_field_wysiwyg();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// load common js, css files</span>&nbsp;</div></li><li><div>      <span class="comment">// must enqueue for all pages as we need js for the media upload, too</span>&nbsp;</div></li><li><div>      add_action('admin_print_styles', array(__CLASS__, 'js_css'));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Load common js, css files for the script</span>&nbsp;</div></li><li><div>  static function js_css() {&nbsp;</div></li><li><div>      <span class="comment">// change '\' to '/' in case using Windows</span>&nbsp;</div></li><li><div>      $content_dir = str_replace('\\', '/', WP_CONTENT_DIR);&nbsp;</div></li><li><div>      $script_dir = str_replace('\\', '/', dirname(__FILE__));&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// get URL of the directory of current file, this works in both theme or plugin</span>&nbsp;</div></li><li><div>      $base_url = str_replace($content_dir, WP_CONTENT_URL, $script_dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_enqueue_style('rw-meta-box', $base_url . '/meta-box.css');&nbsp;</div></li><li><div>      wp_enqueue_script('rw-meta-box', $base_url . '/meta-box.js', array('jquery'), null, true);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** BEGIN UPLOAD **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check field upload and add needed actions</span>&nbsp;</div></li><li><div>  function check_field_upload() {&nbsp;</div></li><li><div>      if (!$this-&gt;has_field('image') && !$this-&gt;has_field('file')) return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action('post_edit_form_tag', array(&$this, 'add_enctype'));                <span class="comment">// add data encoding type for file uploading</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// make upload feature works even when custom post type doesn't support 'editor'</span>&nbsp;</div></li><li><div>      wp_enqueue_script('media-upload');&nbsp;</div></li><li><div>      add_thickbox();&nbsp;</div></li><li><div>      wp_enqueue_script('jquery-ui-core');&nbsp;</div></li><li><div>      wp_enqueue_script('jquery-ui-sortable');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter('media_upload_gallery', array(&$this, 'insert_images'));            <span class="comment">// process adding multiple images to image meta field</span>&nbsp;</div></li><li><div>      add_filter('media_upload_library', array(&$this, 'insert_images'));&nbsp;</div></li><li><div>      add_filter('media_upload_image', array(&$this, 'insert_images'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add_action('delete_post', array(&$this, 'delete_attachments'));            // delete all attachments when delete post</span>&nbsp;</div></li><li><div>      add_action('wp_ajax_rw_delete_file', array(&$this, 'delete_file'));            <span class="comment">// ajax delete files</span>&nbsp;</div></li><li><div>      add_action('wp_ajax_rw_reorder_images', array(&$this, 'reorder_images'));    <span class="comment">// ajax reorder images</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add data encoding type for file uploading</span>&nbsp;</div></li><li><div>  function add_enctype() {&nbsp;</div></li><li><div>      echo ' enctype=&quot;multipart/form-data&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Process adding images to image meta field, modifiy from 'Faster image insert' plugin</span>&nbsp;</div></li><li><div>  function insert_images() {&nbsp;</div></li><li><div>      if (!isset($_POST['rw-insert']) || empty($_POST['attachments'])) return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      check_admin_referer('media-form');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $nonce = wp_create_nonce('rw_ajax_delete');&nbsp;</div></li><li><div>      $post_id = $_POST['post_id'];&nbsp;</div></li><li><div>      $id = $_POST['field_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// modify the insertion string</span>&nbsp;</div></li><li><div>      $html = '';&nbsp;</div></li><li><div>      foreach ($_POST['attachments'] as $attachment_id =&gt; $attachment) {&nbsp;</div></li><li><div>          $attachment = stripslashes_deep($attachment);&nbsp;</div></li><li><div>          if (empty($attachment['selected']) || empty($attachment['url'])) continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $li = &quot;&lt;li id='item_$attachment_id'&gt;&quot;;&nbsp;</div></li><li><div>          $li .= &quot;&lt;img src='{$attachment['url']}' /&gt;&quot;;&nbsp;</div></li><li><div>          $li .= &quot;&lt;a title='&quot; . __('Delete this image', 'delicacy') . &quot;' class='rw-delete-file' href='#' rel='$nonce|$post_id|$id|$attachment_id'&gt;&quot; . __('Delete', 'delicacy') . &quot;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>          $li .= &quot;&lt;input type='hidden' name='{$id}[]' value='$attachment_id' /&gt;&quot;;&nbsp;</div></li><li><div>          $li .= &quot;&lt;/li&gt;&quot;;&nbsp;</div></li><li><div>          $html .= $li;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      media_send_to_editor($html);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Delete all attachments when delete post</span>&nbsp;</div></li><li><div>  function delete_attachments($post_id) {&nbsp;</div></li><li><div>      $attachments = get_posts(array(&nbsp;</div></li><li><div>          'numberposts' =&gt; -1, &nbsp;</div></li><li><div>          'post_type' =&gt; 'attachment', &nbsp;</div></li><li><div>          'post_parent' =&gt; $post_id&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>      if (!empty($attachments)) {&nbsp;</div></li><li><div>          foreach ($attachments as $att) {&nbsp;</div></li><li><div>              wp_delete_attachment($att-&gt;ID);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Ajax callback for deleting files. Modified from a function used by &quot;Verve Meta Boxes&quot; plugin (http://goo.gl/LzYSq)</span>&nbsp;</div></li><li><div>  function delete_file() {&nbsp;</div></li><li><div>      if (!isset($_POST['data'])) die();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      list($nonce, $post_id, $key, $attach_id) = explode('|', $_POST['data']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!wp_verify_nonce($nonce, 'rw_ajax_delete')) die('1');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// wp_delete_attachment($attach_id);</span>&nbsp;</div></li><li><div>      delete_post_meta($post_id, $key, $attach_id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      die('0');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Ajax callback for reordering images</span>&nbsp;</div></li><li><div>  function reorder_images() {&nbsp;</div></li><li><div>      if (!isset($_POST['data'])) die();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      list($order, $post_id, $key, $nonce) = explode('|', $_POST['data']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!wp_verify_nonce($nonce, 'rw_ajax_reorder')) die('1');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      parse_str($order, $items);&nbsp;</div></li><li><div>      $items = $items['item'];&nbsp;</div></li><li><div>      $order = 1;&nbsp;</div></li><li><div>      foreach ($items as $item) {&nbsp;</div></li><li><div>          wp_update_post(array(&nbsp;</div></li><li><div>              'ID' =&gt; $item, &nbsp;</div></li><li><div>              'post_parent' =&gt; $post_id, &nbsp;</div></li><li><div>              'menu_order' =&gt; $order&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>          $order++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      die('0');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** END UPLOAD **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** BEGIN OTHER FIELDS **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check field color</span>&nbsp;</div></li><li><div>  function check_field_color() {&nbsp;</div></li><li><div>      if ($this-&gt;has_field('color') && self::is_edit_page()) {&nbsp;</div></li><li><div>          wp_enqueue_style('farbtastic');        <span class="comment">// enqueue built-in script and style for color picker</span>&nbsp;</div></li><li><div>          wp_enqueue_script('farbtastic');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check field date</span>&nbsp;</div></li><li><div>  function check_field_date() {&nbsp;</div></li><li><div>      if ($this-&gt;has_field('date') && self::is_edit_page()) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// add style and script, use proper jQuery UI version</span></span>&nbsp;</div></li><li><div>          wp_enqueue_style('rw-jquery-ui-css', 'http:<span class="comment"><span class="comment">//ajax.googleapis.com/ajax/libs/jqueryui/' . self::get_jqueryui_ver() . '/themes/base/jquery-ui.css');</span></span>&nbsp;</div></li><li><div>          wp_enqueue_script('rw-jquery-ui', 'https:<span class="comment"><span class="comment">//ajax.googleapis.com/ajax/libs/jqueryui/' . self::get_jqueryui_ver() . '/jquery-ui.min.js', array('jquery'));</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check field time</span>&nbsp;</div></li><li><div>  function check_field_time() {&nbsp;</div></li><li><div>      if ($this-&gt;has_field('time') && self::is_edit_page()) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// add style and script, use proper jQuery UI version</span></span>&nbsp;</div></li><li><div>          wp_enqueue_style('rw-jquery-ui-css', 'http:<span class="comment"><span class="comment">//ajax.googleapis.com/ajax/libs/jqueryui/' . self::get_jqueryui_ver() . '/themes/base/jquery-ui.css');</span></span>&nbsp;</div></li><li><div>          wp_enqueue_script('rw-jquery-ui', 'https:<span class="comment"><span class="comment">//ajax.googleapis.com/ajax/libs/jqueryui/' . self::get_jqueryui_ver() . '/jquery-ui.min.js', array('jquery'));</span></span>&nbsp;</div></li><li><div>          wp_enqueue_script('rw-timepicker', 'https:<span class="comment">//github.com/trentrichardson/jQuery-Timepicker-Addon/raw/master/jquery-ui-timepicker-addon.js', array('rw-jquery-ui'));</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check field WYSIWYG</span>&nbsp;</div></li><li><div>  function check_field_wysiwyg() {&nbsp;</div></li><li><div>      if ($this-&gt;has_field('wysiwyg') && self::is_edit_page()) {&nbsp;</div></li><li><div>          add_action('admin_print_footer_scripts', 'wp_tiny_mce', 25);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">/******************** END OTHER FIELDS **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** BEGIN META BOX PAGE **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add meta box for multiple post types</span>&nbsp;</div></li><li><div>  function add() {&nbsp;</div></li><li><div>      foreach ($this-&gt;_meta_box['pages'] as $page) {&nbsp;</div></li><li><div>          add_meta_box($this-&gt;_meta_box['id'], $this-&gt;_meta_box['title'], array(&$this, 'show'), $page, $this-&gt;_meta_box['context'], $this-&gt;_meta_box['priority']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Callback function to show fields in meta box</span>&nbsp;</div></li><li><div>  function show() {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_nonce_field(basename(__FILE__), 'rw_meta_box_nonce');&nbsp;</div></li><li><div>      echo '&lt;table class=&quot;form-table&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($this-&gt;_fields as $field) {&nbsp;</div></li><li><div>          $meta = get_post_meta($post-&gt;ID, $field['id'], !$field['multiple']);&nbsp;</div></li><li><div>          $meta = ($meta !== '') ? $meta : $field['std'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $meta = is_array($meta) ? array_map('esc_attr', $meta) : esc_attr($meta);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;tr&gt;';&nbsp;</div></li><li><div>          <span class="comment">// call separated methods for displaying each type of field</span>&nbsp;</div></li><li><div>          call_user_func(array(&$this, 'show_field_' . $field['type']), $field, $meta);&nbsp;</div></li><li><div>          echo '&lt;/tr&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      echo '&lt;/table&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** END META BOX PAGE **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** BEGIN META BOX FIELDS **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_begin($field, $meta) {&nbsp;</div></li><li><div>      echo &quot;&lt;th class='rw-label'&gt;&lt;label for='{$field['id']}'&gt;{$field['name']}&lt;/label&gt;&lt;/th&gt;&lt;td class='rw-field'&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_end($field, $meta) {&nbsp;</div></li><li><div>      echo &quot;&lt;br /&gt;{$field['desc']}&lt;/td&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_text($field, $meta) {&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;input type='text' class='rw-text' name='{$field['id']}' id='{$field['id']}' value='$meta' size='30' /&gt;&quot;;&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_textarea($field, $meta) {&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;textarea class='rw-textarea large-text' name='{$field['id']}' id='{$field['id']}' cols='60' rows='10'&gt;$meta&lt;/textarea&gt;&quot;;&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_select($field, $meta) {&nbsp;</div></li><li><div>      if (!is_array($meta)) $meta = (array) $meta;&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;select class='rw-select' name='{$field['id']}&quot; . ($field['multiple'] ? &quot;[]' id='{$field['id']}' multiple='multiple'&quot; : &quot;'&quot;) . &quot;&gt;&quot;;&nbsp;</div></li><li><div>      foreach ($field['options'] as $key =&gt; $value) {&nbsp;</div></li><li><div>          echo &quot;&lt;option value='$key'&quot; . selected(in_array($key, $meta), true, false) . &quot;&gt;$value&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      echo &quot;&lt;/select&gt;&quot;;&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_radio($field, $meta) {&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      foreach ($field['options'] as $key =&gt; $value) {&nbsp;</div></li><li><div>          echo &quot;&lt;input type='radio' class='rw-radio' name='{$field['id']}' value='$key'&quot; . checked($meta, $key, false) . &quot; /&gt; $value &quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_checkbox($field, $meta) {&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;input type='checkbox' class='rw-checkbox' name='{$field['id']}' id='{$field['id']}'&quot; . checked(!empty($meta), true, false) . &quot; /&gt; {$field['desc']}&lt;/td&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_wysiwyg($field, $meta) {&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;textarea class='rw-wysiwyg theEditor large-text' name='{$field['id']}' id='{$field['id']}' cols='60' rows='10'&gt;$meta&lt;/textarea&gt;&quot;;&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_file($field, $meta) {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!is_array($meta)) $meta = (array) $meta;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;{$field['desc']}&lt;br /&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!empty($meta)) {&nbsp;</div></li><li><div>          $nonce = wp_create_nonce('rw_ajax_delete');&nbsp;</div></li><li><div>          echo '&lt;div style=&quot;margin-bottom: 10px&quot;&gt;&lt;strong&gt;' . __('Uploaded files', 'delicacy') . '&lt;/strong&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>          echo '&lt;ol class=&quot;rw-upload&quot;&gt;';&nbsp;</div></li><li><div>          foreach ($meta as $att) {&nbsp;</div></li><li><div>              <span class="comment">// if (wp_attachment_is_image($att)) continue; // what's image uploader for?</span>&nbsp;</div></li><li><div>              echo &quot;&lt;li&gt;&quot; . wp_get_attachment_link($att, '' , false, false, ' ') . &quot; (&lt;a class='rw-delete-file' href='#' rel='$nonce|{$post-&gt;ID}|{$field['id']}|$att'&gt;&quot; . __('Delete', 'delicacy') . &quot;&lt;/a&gt;)&lt;/li&gt;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/ol&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// show form upload</span>&nbsp;</div></li><li><div>      echo &quot;&lt;div style='clear: both'&gt;&lt;strong&gt;&quot; . __('Upload new files', 'delicacy') . &quot;&lt;/strong&gt;&lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div class='new-files'&gt;&nbsp;</div></li><li><div>              &lt;div class='file-input'&gt;&lt;input type='file' name='{$field['id']}[]' /&gt;&lt;/div&gt;&nbsp;</div></li><li><div>              &lt;a class='rw-add-file' href='#'&gt;&quot; . __('Add more file', 'Delicacy') . &quot;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/td&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_image($field, $meta) {&nbsp;</div></li><li><div>      global $wpdb, $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!is_array($meta)) $meta = (array) $meta;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;{$field['desc']}&lt;br /&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $nonce_delete = wp_create_nonce('rw_ajax_delete');&nbsp;</div></li><li><div>      $nonce_sort = wp_create_nonce('rw_ajax_reorder');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo &quot;&lt;input type='hidden' class='rw-images-data' value='{$post-&gt;ID}|{$field['id']}|$nonce_sort' /&gt;&nbsp;</div></li><li><div>            &lt;ul class='rw-images rw-upload' id='rw-images-{$field['id']}'&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// re-arrange images with 'menu_order', thanks Onur</span>&nbsp;</div></li><li><div>      if (!empty($meta)) {&nbsp;</div></li><li><div>          $meta = implode(', ', $meta);&nbsp;</div></li><li><div>          $images = $wpdb-&gt;get_col(&quot;&nbsp;</div></li><li><div>              SELECT ID FROM $wpdb-&gt;posts&nbsp;</div></li><li><div>              WHERE post_type = 'attachment'&nbsp;</div></li><li><div>              AND ID in ($meta)&nbsp;</div></li><li><div>              ORDER BY menu_order ASC&nbsp;</div></li><li><div>          &quot;);&nbsp;</div></li><li><div>          foreach ($images as $image) {&nbsp;</div></li><li><div>              $src = wp_get_attachment_image_src($image);&nbsp;</div></li><li><div>              $src = $src[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo &quot;&lt;li id='item_$image'&gt;&nbsp;</div></li><li><div>                      &lt;img src='$src' /&gt;&nbsp;</div></li><li><div>                      &lt;a title='&quot; . __('Delete this image', 'delicacy') . &quot;' class='rw-delete-file' href='#' rel='$nonce_delete|{$post-&gt;ID}|{$field['id']}|$image'&gt;&quot; . __('Delete', 'delicacy') . &quot;&lt;/a&gt;&nbsp;</div></li><li><div>                      &lt;input type='hidden' name='{$field['id']}[]' value='$image' /&gt;&nbsp;</div></li><li><div>                  &lt;/li&gt;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      echo '&lt;/ul&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo &quot;&lt;a href='#' class='rw-upload-button button' rel='{$post-&gt;ID}|{$field['id']}'&gt;&quot; . __('Add more images', 'delicacy') . &quot;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_color($field, $meta) {&nbsp;</div></li><li><div>      if (empty($meta)) $meta = '#';&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;input class='rw-color' type='text' name='{$field['id']}' id='{$field['id']}' value='$meta' size='8' /&gt;&nbsp;</div></li><li><div>            &lt;a href='#' class='rw-color-select' rel='{$field['id']}'&gt;&quot; . __('Select a color', 'delicacy') . &quot;&lt;/a&gt;&nbsp;</div></li><li><div>            &lt;div style='display:none' class='rw-color-picker' rel='{$field['id']}'&gt;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_checkbox_list($field, $meta) {&nbsp;</div></li><li><div>      if (!is_array($meta)) $meta = (array) $meta;&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      $html = array();&nbsp;</div></li><li><div>      foreach ($field['options'] as $key =&gt; $value) {&nbsp;</div></li><li><div>          $html[] = &quot;&lt;input type='checkbox' class='rw-checkbox_list' name='{$field['id']}[]' value='$key'&quot; . checked(in_array($key, $meta), true, false) . &quot; /&gt; $value&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      echo implode('&lt;br /&gt;', $html);&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_date($field, $meta) {&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;input type='text' class='rw-date' name='{$field['id']}' id='{$field['id']}' rel='{$field['format']}' value='$meta' size='30' /&gt;&quot;;&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function show_field_time($field, $meta) {&nbsp;</div></li><li><div>      $this-&gt;show_field_begin($field, $meta);&nbsp;</div></li><li><div>      echo &quot;&lt;input type='text' class='rw-time' name='{$field['id']}' id='{$field['id']}' rel='{$field['format']}' value='$meta' size='30' /&gt;&quot;;&nbsp;</div></li><li><div>      $this-&gt;show_field_end($field, $meta);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** END META BOX FIELDS **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** BEGIN META BOX SAVE **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Save data from meta box</span>&nbsp;</div></li><li><div>  function save($post_id) {&nbsp;</div></li><li><div>      global $post_type;&nbsp;</div></li><li><div>      $post_type_object = get_post_type_object($post_type);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ((defined('DOING_AUTOSAVE') && DOING_AUTOSAVE)                        <span class="comment">// check autosave</span>&nbsp;</div></li><li><div>      || (!isset($_POST['post_ID']) || $post_id != $_POST['post_ID'])            <span class="comment">// check revision</span>&nbsp;</div></li><li><div>      || (!in_array($post_type, $this-&gt;_meta_box['pages']))                    <span class="comment">// check if current post type is supported</span>&nbsp;</div></li><li><div>      || (!check_admin_referer(basename(__FILE__), 'rw_meta_box_nonce'))        <span class="comment">// verify nonce</span>&nbsp;</div></li><li><div>      || (!current_user_can($post_type_object-&gt;cap-&gt;edit_post, $post_id))) {    <span class="comment">// check permission</span>&nbsp;</div></li><li><div>          return $post_id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      foreach ($this-&gt;_fields as $field) {&nbsp;</div></li><li><div>          $name = $field['id'];&nbsp;</div></li><li><div>          $type = $field['type'];&nbsp;</div></li><li><div>          $old = get_post_meta($post_id, $name, !$field['multiple']);&nbsp;</div></li><li><div>          $new = isset($_POST[$name]) ? $_POST[$name] : ($field['multiple'] ? array() : '');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// validate meta value</span>&nbsp;</div></li><li><div>          if (class_exists('RW_Meta_Box_Validate') && method_exists('RW_Meta_Box_Validate', $field['validate_func'])) {&nbsp;</div></li><li><div>              $new = call_user_func(array('RW_Meta_Box_Validate', $field['validate_func']), $new);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// call defined method to save meta value, if there's no methods, call common one</span>&nbsp;</div></li><li><div>          $save_func = 'save_field_' . $type;&nbsp;</div></li><li><div>          if (method_exists($this, $save_func)) {&nbsp;</div></li><li><div>              call_user_func(array(&$this, 'save_field_' . $type), $post_id, $field, $old, $new);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;save_field($post_id, $field, $old, $new);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Common functions for saving field</span>&nbsp;</div></li><li><div>  function save_field($post_id, $field, $old, $new) {&nbsp;</div></li><li><div>      $name = $field['id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      delete_post_meta($post_id, $name);&nbsp;</div></li><li><div>      if ($new === '' || $new === array()) return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($field['multiple']) {&nbsp;</div></li><li><div>          foreach ($new as $add_new) {&nbsp;</div></li><li><div>              add_post_meta($post_id, $name, $add_new, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          update_post_meta($post_id, $name, $new);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function save_field_wysiwyg($post_id, $field, $old, $new) {&nbsp;</div></li><li><div>      $new = wpautop($new);&nbsp;</div></li><li><div>      $this-&gt;save_field($post_id, $field, $old, $new);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function save_field_file($post_id, $field, $old, $new) {&nbsp;</div></li><li><div>      $name = $field['id'];&nbsp;</div></li><li><div>      if (empty($_FILES[$name])) return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      self::fix_file_array($_FILES[$name]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($_FILES[$name] as $position =&gt; $fileitem) {&nbsp;</div></li><li><div>          $file = wp_handle_upload($fileitem, array('test_form' =&gt; false));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (empty($file['file'])) continue;&nbsp;</div></li><li><div>          $filename = $file['file'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $attachment = array(&nbsp;</div></li><li><div>              'post_mime_type' =&gt; $file['type'], &nbsp;</div></li><li><div>              'guid' =&gt; $file['url'], &nbsp;</div></li><li><div>              'post_parent' =&gt; $post_id, &nbsp;</div></li><li><div>              'post_title' =&gt; preg_replace('/\.[^.]+$/', '', basename($filename)), &nbsp;</div></li><li><div>              'post_content' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $id = wp_insert_attachment($attachment, $filename, $post_id);&nbsp;</div></li><li><div>          if (!is_wp_error($id)) {&nbsp;</div></li><li><div>              wp_update_attachment_metadata($id, wp_generate_attachment_metadata($id, $filename));&nbsp;</div></li><li><div>              add_post_meta($post_id, $name, $id, false);    <span class="comment">// save file's url in meta fields</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** END META BOX SAVE **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** BEGIN HELPER FUNCTIONS **********************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add missed values for meta box</span>&nbsp;</div></li><li><div>  function add_missed_values() {&nbsp;</div></li><li><div>      <span class="comment">// default values for meta box</span>&nbsp;</div></li><li><div>      $this-&gt;_meta_box = array_merge(array(&nbsp;</div></li><li><div>          'context' =&gt; 'normal', &nbsp;</div></li><li><div>          'priority' =&gt; 'high', &nbsp;</div></li><li><div>          'pages' =&gt; array('post')&nbsp;</div></li><li><div> ), $this-&gt;_meta_box);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// default values for fields</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;_fields as &$field) {&nbsp;</div></li><li><div>          $multiple = in_array($field['type'], array('checkbox_list', 'file', 'image'));&nbsp;</div></li><li><div>          $std = $multiple ? array() : '';&nbsp;</div></li><li><div>          $format = 'date' == $field['type'] ? 'yy-mm-dd' : ('time' == $field['type'] ? 'hh:mm' : '');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $field = array_merge(array(&nbsp;</div></li><li><div>              'multiple' =&gt; $multiple, &nbsp;</div></li><li><div>              'std' =&gt; $std, &nbsp;</div></li><li><div>              'desc' =&gt; '', &nbsp;</div></li><li><div>              'format' =&gt; $format, &nbsp;</div></li><li><div>              'validate_func' =&gt; ''&nbsp;</div></li><li><div> ), $field);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check if field with $type exists</span>&nbsp;</div></li><li><div>  function has_field($type) {&nbsp;</div></li><li><div>      foreach ($this-&gt;_fields as $field) {&nbsp;</div></li><li><div>          if ($type == $field['type']) return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check if current page is edit page</span>&nbsp;</div></li><li><div>  static function is_edit_page() {&nbsp;</div></li><li><div>      global $pagenow;&nbsp;</div></li><li><div>      return in_array($pagenow, array('post.php', 'post-new.php'));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fixes the odd indexing of multiple file uploads from the format:</span>&nbsp;</div></li><li><div><span class="comment">   *     $_FILES['field']['key']['index']</span>&nbsp;</div></li><li><div><span class="comment">   * To the more standard and appropriate:</span>&nbsp;</div></li><li><div><span class="comment">   *     $_FILES['field']['index']['key']</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  static function fix_file_array(&$files) {&nbsp;</div></li><li><div>      $output = array();&nbsp;</div></li><li><div>      foreach ($files as $key =&gt; $list) {&nbsp;</div></li><li><div>          foreach ($list as $index =&gt; $value) {&nbsp;</div></li><li><div>              $output[$index][$key] = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $files = $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get proper jQuery UI version to not conflict with WP admin scripts</span>&nbsp;</div></li><li><div>  static function get_jqueryui_ver() {&nbsp;</div></li><li><div>      global $wp_version;&nbsp;</div></li><li><div>      if (version_compare($wp_version, '3.1', '&gt;=')) {&nbsp;</div></li><li><div>          return '1.8.10';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return '1.7.3';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/******************** END HELPER FUNCTIONS **********************/</span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>theme</li><li><span></span>file</li><li><span></span></li><li><span></span>Evolved</li><li><span></span>0.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>