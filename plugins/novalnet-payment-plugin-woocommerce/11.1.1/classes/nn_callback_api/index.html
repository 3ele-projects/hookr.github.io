<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="11.1.1" data-slug="novalnet-payment-plugin-woocommerce" data-type="class" data-id="70263"><head xmlns="http://www.w3.org/1999/xhtml"><title> nn_callback_api | class | Novalnet Payment Plugin Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="NN_Callback_Api, class, plugin, novalnet-payment-plugin-woocommerce, 11.1.1" /><meta name="description" content="Novalnet Callback Api Class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=2cf3db8b8e86bf5b7a0bf8d58c8bda3e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/nn_callback_api/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fnn_callback_api%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fnn_callback_api%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-novalnet-payment-plugin-woocommerce-11.1.1-class-nn_callback_api","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="nn_callback_api" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to novalnet-payment-plugin-wooco&hellip;." href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/" class="plugin"><span property="name">novalnet-payment-plugin-wooco&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 11.1.1." href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/" class="H_VERSION"><span property="name">11.1.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">nn_callback_api</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="142"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/all/" title="All">All <span class="count badge">142</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="40"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/hooks/" title="Hooks">Hooks <span class="count badge">40</span></a></li><li class="" data-id="action" data-count="7"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/actions/" title="Actions">Actions <span class="count badge">7</span></a></li><li class="" data-id="filter" data-count="33"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/filters/" title="Filters">Filters <span class="count badge">33</span></a></li><li class="active" data-id="class" data-count="23"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/classes/" title="Classes">Classes <span class="count badge">23</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="79"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/functions/" title="Functions">Functions <span class="count badge">79</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>NN_Callback_Api</strong></h1><p>Novalnet Callback Api Class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/files/includes-api-class-wc-novalnet-api-callback/" class="file">/includes/api/class-wc-novalnet-api-callback.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="22" class="block" start="22"><li><div>class NN_Callback_Api extends NN_Payment_Gateways {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Level - 0 Payment types.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $payments = array(&nbsp;</div></li><li><div>        'CREDITCARD', &nbsp;</div></li><li><div>        'INVOICE_START', &nbsp;</div></li><li><div>        'DIRECT_DEBIT_SEPA', &nbsp;</div></li><li><div>        'GUARANTEED_INVOICE_START', &nbsp;</div></li><li><div>        'GUARANTEED_DIRECT_DEBIT_SEPA', &nbsp;</div></li><li><div>        'PAYPAL', &nbsp;</div></li><li><div>        'PRZELEWY24', &nbsp;</div></li><li><div>        'ONLINE_TRANSFER', &nbsp;</div></li><li><div>        'IDEAL', &nbsp;</div></li><li><div>        'GIROPAY', &nbsp;</div></li><li><div>        'EPS', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Level - 1 Payment types.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $chargebacks = array(&nbsp;</div></li><li><div>        'RETURN_DEBIT_SEPA', &nbsp;</div></li><li><div>        'REVERSAL', &nbsp;</div></li><li><div>        'CREDITCARD_BOOKBACK', &nbsp;</div></li><li><div>        'CREDITCARD_CHARGEBACK', &nbsp;</div></li><li><div>        'PAYPAL_BOOKBACK', &nbsp;</div></li><li><div>        'REFUND_BY_BANK_TRANSFER_EU', &nbsp;</div></li><li><div>        'PRZELEWY24_REFUND', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Level - 2 Payment types.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $collections = array(&nbsp;</div></li><li><div>        'INVOICE_CREDIT', &nbsp;</div></li><li><div>        'GUARANTEED_INVOICE_CREDIT', &nbsp;</div></li><li><div>        'CREDIT_ENTRY_CREDITCARD', &nbsp;</div></li><li><div>        'CREDIT_ENTRY_SEPA', &nbsp;</div></li><li><div>        'DEBT_COLLECTION_SEPA', &nbsp;</div></li><li><div>        'DEBT_COLLECTION_CREDITCARD', &nbsp;</div></li><li><div>        'ONLINE_TRANSFER_CREDIT', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Novalnet subscriptions catagory.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $subscriptions = array(&nbsp;</div></li><li><div>        'SUBSCRIPTION_STOP', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Novalnet payments catagory.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $payment_groups = array(&nbsp;</div></li><li><div>        'novalnet_cc' =&gt; array(&nbsp;</div></li><li><div>            'CREDITCARD', &nbsp;</div></li><li><div>            'CREDITCARD_BOOKBACK', &nbsp;</div></li><li><div>            'CREDITCARD_CHARGEBACK', &nbsp;</div></li><li><div>            'CREDIT_ENTRY_CREDITCARD', &nbsp;</div></li><li><div>            'DEBT_COLLECTION_CREDITCARD', &nbsp;</div></li><li><div>            'SUBSCRIPTION_STOP', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_sepa' =&gt; array(&nbsp;</div></li><li><div>            'DIRECT_DEBIT_SEPA', &nbsp;</div></li><li><div>            'RETURN_DEBIT_SEPA', &nbsp;</div></li><li><div>            'CREDIT_ENTRY_SEPA', &nbsp;</div></li><li><div>            'DEBT_COLLECTION_SEPA', &nbsp;</div></li><li><div>            'GUARANTEED_DIRECT_DEBIT_SEPA', &nbsp;</div></li><li><div>            'REFUND_BY_BANK_TRANSFER_EU', &nbsp;</div></li><li><div>            'SUBSCRIPTION_STOP', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_ideal' =&gt; array(&nbsp;</div></li><li><div>            'IDEAL', &nbsp;</div></li><li><div>            'REFUND_BY_BANK_TRANSFER_EU', &nbsp;</div></li><li><div>            'ONLINE_TRANSFER_CREDIT', &nbsp;</div></li><li><div>            'REVERSAL', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_eps' =&gt; array(&nbsp;</div></li><li><div>            'EPS', &nbsp;</div></li><li><div>            'REFUND_BY_BANK_TRANSFER_EU', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_giropay' =&gt; array(&nbsp;</div></li><li><div>            'GIROPAY', &nbsp;</div></li><li><div>            'REFUND_BY_BANK_TRANSFER_EU', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_instantbank' =&gt; array(&nbsp;</div></li><li><div>            'ONLINE_TRANSFER', &nbsp;</div></li><li><div>            'REFUND_BY_BANK_TRANSFER_EU', &nbsp;</div></li><li><div>            'ONLINE_TRANSFER_CREDIT', &nbsp;</div></li><li><div>            'REVERSAL', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_paypal' =&gt; array(&nbsp;</div></li><li><div>            'PAYPAL', &nbsp;</div></li><li><div>            'PAYPAL_BOOKBACK', &nbsp;</div></li><li><div>            'SUBSCRIPTION_STOP', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_prepayment' =&gt; array(&nbsp;</div></li><li><div>            'INVOICE_START', &nbsp;</div></li><li><div>            'INVOICE_CREDIT', &nbsp;</div></li><li><div>            'SUBSCRIPTION_STOP', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_invoice' =&gt; array(&nbsp;</div></li><li><div>            'INVOICE_START', &nbsp;</div></li><li><div>            'GUARANTEED_INVOICE_START', &nbsp;</div></li><li><div>            'INVOICE_CREDIT', &nbsp;</div></li><li><div>            'GUARANTEED_INVOICE_CREDIT', &nbsp;</div></li><li><div>            'SUBSCRIPTION_STOP', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'novalnet_przelewy24' =&gt; array(&nbsp;</div></li><li><div>            'PRZELEWY24', &nbsp;</div></li><li><div>            'PRZELEWY24_REFUND', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Mandatory Parameters.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $required_params = array(&nbsp;</div></li><li><div>        'vendor_id', &nbsp;</div></li><li><div>        'status', &nbsp;</div></li><li><div>        'payment_type', &nbsp;</div></li><li><div>        'tid_status', &nbsp;</div></li><li><div>        'tid', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Affiliate Parameters.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $affiliate_params = array(&nbsp;</div></li><li><div>        'vendor_id', &nbsp;</div></li><li><div>        'vendor_authcode', &nbsp;</div></li><li><div>        'product_id', &nbsp;</div></li><li><div>        'aff_id', &nbsp;</div></li><li><div>        'aff_authcode', &nbsp;</div></li><li><div>        'aff_accesskey', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Novalnet success codes.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $success_code = array(&nbsp;</div></li><li><div>        'PAYPAL' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div>            '90', &nbsp;</div></li><li><div>            '85', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'INVOICE_START' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div>            '91', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'GUARANTEED_INVOICE_START' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div>            '91', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'CREDITCARD' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div>            '98', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'DIRECT_DEBIT_SEPA' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div>            '99', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'GUARANTEED_DIRECT_DEBIT_SEPA' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div>            '99', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'ONLINE_TRANSFER' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'ONLINE_TRANSFER_CREDIT' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'GIROPAY' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'IDEAL' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'EPS' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>        'PRZELEWY24' =&gt; array(&nbsp;</div></li><li><div>            '100', &nbsp;</div></li><li><div>            '86', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Allowed IP's.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $ip_allowed = array(&nbsp;</div></li><li><div>        '195.143.189.210', &nbsp;</div></li><li><div>        '195.143.189.214', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback test mode.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $test_mode;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback debug mode.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $debug_mode;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Request parameters.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $server_request = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Order reference values.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $order_reference = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Success status values.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var boolean&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $success_status;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * NN_Callback_Api The single instance of the class.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var null/object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected static $_instance = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Main NN_Callback_Api Instance.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Ensures only one instance of NN_Functions is loaded or can be loaded.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  11.0.0&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @return NN_Callback_Api Main instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static function instance() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_null( self::$_instance ) ) {&nbsp;</div></li><li><div>            self::$_instance = new self();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return self::$_instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback api process.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param array $request Get the server request.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function callback_api_process( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $request = array_map( 'trim', $request );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Hook to align email order comments.&nbsp;</div></li><li><div>        add_action( 'woocommerce_email_after_order_table', 'wc_novalnet_novalnet_align_email', 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Initialize Log & vendor details.&nbsp;</div></li><li><div>        $this-&gt;initialize_basic_details();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Backend callback option.&nbsp;</div></li><li><div>        $this-&gt;debug_mode = get_option( 'novalnet_callback_debug_mode' );&nbsp;</div></li><li><div>        $this-&gt;test_mode = get_option( 'novalnet_callback_test_mode' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Authenticating the server request based on IP.&nbsp;</div></li><li><div>        $client_ip_addr = wc_novalnet_get_ip_address();&nbsp;</div></li><li><div>        if ( ! in_array( $client_ip_addr, $this-&gt;ip_allowed, true ) && ! $this-&gt;test_mode ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet callback received. Unauthorised access from the IP ' . $client_ip_addr, true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Affiliate activation process.&nbsp;</div></li><li><div>        if ( ! empty( $request ['vendor_activation'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Validate the callback mandatory affiliate parameters.&nbsp;</div></li><li><div>             $this-&gt;validate_required_fields( $this-&gt;affiliate_params, $request );&nbsp;</div></li><li><div>            $this-&gt;server_request = $request;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wc_novalnet_db_insert_query(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                'vendor_id' =&gt; $this-&gt;server_request ['vendor_id'], &nbsp;</div></li><li><div>                'vendor_authcode' =&gt; $this-&gt;server_request ['vendor_authcode'], &nbsp;</div></li><li><div>                'product_id' =&gt; $this-&gt;server_request ['product_id'], &nbsp;</div></li><li><div>                'product_url' =&gt; $this-&gt;server_request ['product_url'], &nbsp;</div></li><li><div>                'activation_date' =&gt; date( 'Y-m-d H:i:s', strtotime( $this-&gt;server_request ['activation_date'] ) ), &nbsp;</div></li><li><div>                'aff_id' =&gt; $this-&gt;server_request ['aff_id'], &nbsp;</div></li><li><div>                'aff_authcode' =&gt; $this-&gt;server_request ['aff_authcode'], &nbsp;</div></li><li><div>                'aff_accesskey' =&gt; $this-&gt;server_request ['aff_accesskey'], &nbsp;</div></li><li><div> ), 'novalnet_aff_account_detail'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>            $this-&gt;send_notification_mail( 'Novalnet callback script executed successfully with Novalnet account activation information.' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get request parameters.&nbsp;</div></li><li><div>        $this-&gt;server_request = $this-&gt;validate_server_request( $request );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for success status.&nbsp;</div></li><li><div>        $this-&gt;success_status = ( wc_novalnet_status_check( $this-&gt;server_request ) && wc_novalnet_status_check( $this-&gt;server_request, 'tid_status' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get order reference.&nbsp;</div></li><li><div>        $this-&gt;order_reference = $this-&gt;get_order_reference();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create order object.&nbsp;</div></li><li><div>        $this-&gt;wc_order = new WC_Order( $this-&gt;order_reference ['order_no'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Order number check.&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;server_request ['order_no'] ) &&  ltrim( $this-&gt;wc_order-&gt;get_order_number(), _x( '#', 'hash before order number', 'woocommerce' ) ) !== $this-&gt;server_request ['order_no'] ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet callback script order number not valid' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // level 0 payments - Initial payments.&nbsp;</div></li><li><div>        $this-&gt;zero_level_process();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // level 1 payments - Type of charge backs.&nbsp;</div></li><li><div>        $this-&gt;first_level_process();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // level 2 payments - Type of credit entry.&nbsp;</div></li><li><div>        $this-&gt;second_level_process();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Subscription stop process.&nbsp;</div></li><li><div>        $this-&gt;subscription_stop_process();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $this-&gt;success_status ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet callback received. Status is not valid: Only 100 is allowed' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;display_message( 'Novalnet callback script executed already' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate required fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param array $required_params Required params.&nbsp;</div></li><li><div>     * @param array $request         Get the server request.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function validate_required_fields( $required_params, $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $required_params as $params ) {&nbsp;</div></li><li><div>            if ( empty( $request [ $params ] ) ) {&nbsp;</div></li><li><div>                $this-&gt;display_message( &quot;Required param ( $params ) missing!&quot; );&nbsp;</div></li><li><div>            } elseif ( in_array( $params, array( 'tid', 'tid_payment', 'signup_tid' ), true ) && ! preg_match( '/^\d{17}$/', $request [ $params ] ) ) {&nbsp;</div></li><li><div>                $this-&gt;display_message( 'Novalnet callback received. Invalid TID [ ' . $request [ $params ] . ' ] for Order.' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the required TID parameter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param array $request Get the server request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_required_tid( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $shop_tid = 'tid';&nbsp;</div></li><li><div>        if ( ! empty( $request ['payment_type'] ) && in_array( $request ['payment_type'], array_merge( $this-&gt;chargebacks, $this-&gt;collections ), true ) ) {&nbsp;</div></li><li><div>            $shop_tid = 'tid_payment';&nbsp;</div></li><li><div>        } elseif ( isset( $request ['subs_billing'] ) && '1' === $request ['subs_billing'] ) {&nbsp;</div></li><li><div>            $shop_tid = 'signup_tid';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $shop_tid;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate and return the server request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param array $request Get the server request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function validate_server_request( $request ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;required_params [] = $shop_tid_key = $this-&gt;get_required_tid( $request );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Validate the callback mandatory request parameters.&nbsp;</div></li><li><div>        $this-&gt;validate_required_fields( $this-&gt;required_params, $request );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $request ['payment_type'] ) && ! in_array( $request ['payment_type'], array_merge( $this-&gt;payments, $this-&gt;chargebacks, $this-&gt;collections, $this-&gt;subscriptions ), true ) ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet callback received. Payment type ( ' . $request ['payment_type'] . ' ) is mismatched!' );&nbsp;</div></li><li><div>        } elseif ( 'SUBSCRIPTION_STOP' !== $request ['payment_type'] && ( ! is_numeric( $request ['amount'] ) || $request ['amount'] &lt; 0 ) ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet callback received. The requested amount ( ' . $request ['amount'] . ' ) is not valid' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $request ['shop_tid'] = $request [ $shop_tid_key ];&nbsp;</div></li><li><div>        return $request;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get post id.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param int $wc_order_id The order id of the order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_post_id( $wc_order_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_id = '';&nbsp;</div></li><li><div>        if ( ! empty( $wc_order_id ) ) {&nbsp;</div></li><li><div>            $post_id = wc_novalnet_order_post_id( $wc_order_id );&nbsp;</div></li><li><div>            if ( empty( $post_id ) ) {&nbsp;</div></li><li><div>                $post_id = $wc_order_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $post_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get order reference.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since  10.0.0&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_order_reference() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wc_order_id = '';&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;server_request ['order_no'] ) ) {&nbsp;</div></li><li><div>            $wc_order_id = $this-&gt;server_request ['order_no'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $transaction_details = array();&nbsp;</div></li><li><div>        $post_id = $this-&gt;get_post_id( $wc_order_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get recurring details.&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;server_request ['subs_billing'] ) && '1' === $this-&gt;server_request ['subs_billing'] || 'SUBSCRIPTION_STOP' === $this-&gt;server_request ['payment_type'] ) {&nbsp;</div></li><li><div>            $recurring_details = wc_novalnet_get_subs_details( $this-&gt;server_request ['shop_tid'] );&nbsp;</div></li><li><div>            $post_id = $recurring_details ['order_no'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction_details = wc_novalnet_get_callback_details( $this-&gt;server_request ['shop_tid'], $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $transaction_details ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $original_post_id = wc_novalnet_original_post_id( $this-&gt;server_request ['shop_tid'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $original_post_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'ONLINE_TRANSFER_CREDIT' === $this-&gt;server_request ['payment_type'] ) {&nbsp;</div></li><li><div>                    $transaction_details ['order_no'] = $post_id;&nbsp;</div></li><li><div>                    $this-&gt;update_initial_payment( $wc_order_id, $transaction_details, false );&nbsp;</div></li><li><div>                    $transaction_details = wc_novalnet_get_callback_details( $this-&gt;server_request ['shop_tid'], $post_id );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Get Global configuration.&nbsp;</div></li><li><div>                    $transaction_details = $this-&gt;global_settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Fetch transaction tariff id.&nbsp;</div></li><li><div>                    if ( apply_filters( 'novalnet_check_subscription', $original_post_id ) ) {&nbsp;</div></li><li><div>                        $transaction_details ['tariff_id'] = $transaction_details ['subs_tariff_id'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $transaction_details ['order_no'] = $original_post_id;&nbsp;</div></li><li><div>                    $recurring_payment = get_post_meta( $original_post_id, '_recurring_payment_method', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Get payment type.&nbsp;</div></li><li><div>                    $transaction_details ['payment_type'] = ( ! empty( $recurring_payment ) ) ? $recurring_payment : get_post_meta( $original_post_id, '_payment_method', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $transaction_details ['amount'] = wc_novalnet_formatted_amount( get_post_meta( $post_id, '_order_total', true ) );&nbsp;</div></li><li><div>                    $transaction_details ['callback_amount'] = get_post_meta( $original_post_id, '_nn_callback_amount', true );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $transaction_details ['order_no'] = $post_id;&nbsp;</div></li><li><div>                $this-&gt;update_initial_payment( $wc_order_id, $transaction_details, true );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Assign payment type based on the order for subscription.&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;server_request ['subs_billing'] ) ) {&nbsp;</div></li><li><div>            $subscription_details = apply_filters( 'novalnet_get_subscription_details', $transaction_details ['order_no'] );&nbsp;</div></li><li><div>            if ( ! empty( $subscription_details ['0'] ) ) {&nbsp;</div></li><li><div>                $subscription_order_id = $subscription_details ['0'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $subscription_order_id = $transaction_details ['order_no'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get subscription payment type.&nbsp;</div></li><li><div>            $transaction_details ['payment_type'] = get_post_meta( $subscription_order_id, '_payment_method', true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Check for payment_type.&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;server_request ['payment_type'] ) && ! in_array( $this-&gt;server_request ['payment_type'], $this-&gt;payment_groups [ $transaction_details ['payment_type'] ], true ) ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet callback received. Payment type [ ' . $this-&gt;server_request ['payment_type'] . '] is not valid.' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $transaction_details;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback API Level zero process.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function zero_level_process() {&nbsp;</div></li><li><div>        if ( in_array( $this-&gt;server_request ['payment_type'], $this-&gt;payments, true ) && wc_novalnet_status_check( $this-&gt;server_request ) && in_array( $this-&gt;server_request ['tid_status'], $this-&gt;success_code [ $this-&gt;server_request ['payment_type'] ], true ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Subscription process.&nbsp;</div></li><li><div>            if ( '1' === $this-&gt;server_request ['subs_billing'] ) {&nbsp;</div></li><li><div>                $subscription_details = apply_filters( 'novalnet_get_subscription_details', $this-&gt;order_reference ['order_no'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! empty( $subscription_details ['0'] ) ) {&nbsp;</div></li><li><div>                    $subscription_order = new WC_Order( $subscription_details ['0'] );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $subscription_order = new WC_Order( $this-&gt;order_reference ['order_no'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Intialize recurring order.&nbsp;</div></li><li><div>                $callback_comments = $this-&gt;recurring_order_creation( $subscription_order, $subscription_details );&nbsp;</div></li><li><div>                $total_length = apply_filters( 'novalnet_get_order_subscription_length', $subscription_order );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Check subscription length.&nbsp;</div></li><li><div>                if ( $total_length &gt; 0 && apply_filters( 'novalnet_get_renewal_order_count', $subscription_order ) &gt;= $total_length ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Log for subscription cancellation request.&nbsp;</div></li><li><div>                    $this-&gt;maintain_debug_log( 'Subscription cancelled in Novalnet server due to subscription total length reached for the TID: ' . $this-&gt;server_request ['shop_tid'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Cancel subscription in Novalnet server.&nbsp;</div></li><li><div>                    novalnet_instance()-&gt;novalnet_functions()-&gt;submit_request(&nbsp;</div></li><li><div>                        array(&nbsp;</div></li><li><div>                        'vendor' =&gt; $this-&gt;order_reference ['vendor_id'], &nbsp;</div></li><li><div>                        'auth_code' =&gt; $this-&gt;order_reference ['auth_code'], &nbsp;</div></li><li><div>                        'product' =&gt; $this-&gt;order_reference ['product_id'], &nbsp;</div></li><li><div>                        'tariff' =&gt; $this-&gt;order_reference ['tariff_id'], &nbsp;</div></li><li><div>                        'key' =&gt; $this-&gt;order_reference ['payment_id'], &nbsp;</div></li><li><div>                        'tid' =&gt; $this-&gt;server_request ['shop_tid'], &nbsp;</div></li><li><div>                        'cancel_sub' =&gt; 1, &nbsp;</div></li><li><div>                        'cancel_reason' =&gt; __( 'Other', 'wc-novalnet' ), &nbsp;</div></li><li><div>                        'lang' =&gt; $this-&gt;language, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>                $this-&gt;send_notification_mail( $callback_comments );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $this-&gt;server_request ['payment_type'], array( 'PAYPAL', 'PRZELEWY24' ), true ) && $this-&gt;success_status && ( (int) $this-&gt;order_reference ['callback_amount'] &lt; (int) $this-&gt;order_reference ['amount'] ) ) {&nbsp;</div></li><li><div>                $callback_comments = wc_novalnet_format_text( sprintf( __( 'Novalnet Callback Script executed successfully for the TID: %1$s with amount %2$s on %3$s.', 'wc-novalnet' ), $this-&gt;server_request ['tid'], wc_novalnet_shop_amount_format( $this-&gt;server_request ['amount'] / 100 ), wc_novalnet_formatted_date() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Update transaction details.&nbsp;</div></li><li><div>                wc_novalnet_db_update_query(&nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                    'gateway_status' =&gt; $this-&gt;server_request ['tid_status'], &nbsp;</div></li><li><div>                    'callback_amount' =&gt; $this-&gt;order_reference ['callback_amount'] + $this-&gt;server_request ['amount'], &nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>                    'order_no' =&gt; $this-&gt;wc_order-&gt;id, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                update_post_meta( $this-&gt;wc_order-&gt;id, '_novalnet_gateway_status', $this-&gt;server_request ['tid_status'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Update order comments.&nbsp;</div></li><li><div>                novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $this-&gt;wc_order, $callback_comments, true, 'note', false );&nbsp;</div></li><li><div>                $payment_settings = wc_novalnet_payment_config( $this-&gt;wc_order-&gt;payment_method );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Update order status.&nbsp;</div></li><li><div>                $this-&gt;wc_order-&gt;update_status( $payment_settings ['order_success_status'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Log callback process.&nbsp;</div></li><li><div>                $this-&gt;log_callback_details( $this-&gt;wc_order-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>                $this-&gt;send_notification_mail( $callback_comments );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // After execution.&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet Callbackscript received. Payment type ( ' . $this-&gt;server_request ['payment_type'] . ' ) is not applicable for this process!' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle Przelewy failure.&nbsp;</div></li><li><div>        if ( 'PRZELEWY24' === $this-&gt;server_request ['payment_type'] && ! $this-&gt;success_status && '86' !== $this-&gt;server_request ['tid_status'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Forming comments.&nbsp;</div></li><li><div>            $novalnet_comments = novalnet_instance()-&gt;novalnet_functions()-&gt;form_comments(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                'test_mode' =&gt; $this-&gt;server_request ['test_mode'], &nbsp;</div></li><li><div>                'tid' =&gt; $this-&gt;server_request ['shop_tid'], &nbsp;</div></li><li><div>                'title' =&gt; $this-&gt;wc_order-&gt;payment_method_title, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $novalnet_comments .= PHP_EOL . sprintf( __( 'The transaction has been canceled due to: %s', 'wc-novalnet' ), wc_novalnet_response_text( $this-&gt;server_request ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Update order comments.&nbsp;</div></li><li><div>            novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $this-&gt;wc_order, $novalnet_comments );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Cancel order.&nbsp;</div></li><li><div>            $this-&gt;wc_order-&gt;cancel_order();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>            $this-&gt;send_notification_mail( $novalnet_comments );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback API Level 1 process.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function first_level_process() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $this-&gt;server_request ['payment_type'], $this-&gt;chargebacks, true ) && $this-&gt;success_status ) {&nbsp;</div></li><li><div>            // Prepare callback comments.&nbsp;</div></li><li><div>            $comments = __( 'Novalnet callback received. Chargeback executed successfully for the TID: %1$s amount: %2$s on %3$s. The subsequent TID: %4$s.', 'wc-novalnet' );&nbsp;</div></li><li><div>            if ( in_array( $this-&gt;server_request ['payment_type'], array( 'PAYPAL_BOOKBACK', 'CREDITCARD_BOOKBACK', 'REFUND_BY_BANK_TRANSFER_EU', 'PRZELEWY24_REFUND' ), true ) ) {&nbsp;</div></li><li><div>                $comments = __( 'Novalnet callback received. Refund/Bookback executed successfully for the TID: %1$s amount: %2$s on %3$s. The subsequent TID: %4$s.', 'wc-novalnet' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $callback_comments = wc_novalnet_format_text( sprintf( $comments, $this-&gt;server_request ['shop_tid'], wc_novalnet_shop_amount_format( $this-&gt;server_request ['amount'] / 100 ), date_i18n( get_option( 'date_format' ), strtotime( date( 'Y-m-d' ) ) ), $this-&gt;server_request ['tid'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Update order comments.&nbsp;</div></li><li><div>            novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $this-&gt;wc_order, $callback_comments, true, 'note', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Log callback process.&nbsp;</div></li><li><div>            $this-&gt;log_callback_details( $this-&gt;wc_order-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>            $this-&gt;send_notification_mail( $callback_comments );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Callback API Level 2 process.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function second_level_process() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $this-&gt;server_request ['payment_type'], $this-&gt;collections, true ) && $this-&gt;success_status ) {&nbsp;</div></li><li><div>            if ( in_array( $this-&gt;server_request ['payment_type'], array( 'INVOICE_CREDIT', 'GUARANTEED_INVOICE_CREDIT', 'ONLINE_TRANSFER_CREDIT' ), true ) ) {&nbsp;</div></li><li><div>                if ( (int) $this-&gt;order_reference ['callback_amount'] &lt; (int) $this-&gt;order_reference ['amount'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Prepare callback comments.&nbsp;</div></li><li><div>                    $callback_comments = wc_novalnet_format_text( sprintf( __( 'Novalnet Callback Script executed successfully for the TID: %1$s with amount %2$s on %3$s. Please refer PAID transaction in our Novalnet Merchant Administration with the TID: %4$s', 'wc-novalnet' ), $this-&gt;server_request ['shop_tid'], wc_novalnet_shop_amount_format( $this-&gt;server_request ['amount'] / 100 ), wc_novalnet_formatted_date(), $this-&gt;server_request ['tid'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Calculate total amount.&nbsp;</div></li><li><div>                    $paid_amount = $this-&gt;order_reference ['callback_amount'] + $this-&gt;server_request ['amount'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $additional_note = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Check for full payment.&nbsp;</div></li><li><div>                    if ( (int) $paid_amount &gt;= $this-&gt;order_reference ['amount'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( 'ONLINE_TRANSFER_CREDIT' === $this-&gt;server_request ['payment_type'] ) {&nbsp;</div></li><li><div>                            $formatted_order_no = ltrim( $this-&gt;wc_order-&gt;get_order_number(), _x( '#', 'hash before order number', 'woocommerce' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $additional_note = wc_novalnet_format_text( sprintf( __( 'The amount of %1$s for the order %2$s has been paid. Please verify received amount and TID details, and update the order status accordingly.', 'wc-novalnet' ), wc_novalnet_shop_amount_format( $this-&gt;server_request ['amount'] / 100 ), $formatted_order_no ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Update order comments.&nbsp;</div></li><li><div>                            novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $this-&gt;wc_order, $callback_comments, true, 'note', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Update callback comments.&nbsp;</div></li><li><div>                            $this-&gt;wc_order-&gt;add_order_note( $additional_note );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Update Callback amount.&nbsp;</div></li><li><div>                            wc_novalnet_db_update_query(&nbsp;</div></li><li><div>                                array(&nbsp;</div></li><li><div>                                    'callback_amount' =&gt; $paid_amount, &nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>                                    'order_no' =&gt; $this-&gt;wc_order-&gt;id, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Log callback process.&nbsp;</div></li><li><div>                            $this-&gt;log_callback_details( $this-&gt;wc_order-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>                            $this-&gt;send_notification_mail( $callback_comments . PHP_EOL . $additional_note );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Get payment title.&nbsp;</div></li><li><div>                            $payment_title = get_post_meta( $this-&gt;wc_order-&gt;id, '_recurring_payment_method_title', true );&nbsp;</div></li><li><div>                            if ( empty( $payment_title ) ) {&nbsp;</div></li><li><div>                                $payment_title = $this-&gt;wc_order-&gt;payment_method_title;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Form transaction comments.&nbsp;</div></li><li><div>                            $transaction_comments = novalnet_instance()-&gt;novalnet_functions()-&gt;form_comments(&nbsp;</div></li><li><div>                                array(&nbsp;</div></li><li><div>                                'title' =&gt; $payment_title, &nbsp;</div></li><li><div>                                'tid' =&gt; $this-&gt;server_request ['shop_tid'], &nbsp;</div></li><li><div>                                'test_mode' =&gt; $this-&gt;server_request ['test_mode'], &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Update callback comments.&nbsp;</div></li><li><div>                            novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $this-&gt;wc_order, $transaction_comments, false, 'transaction_info' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Update callback comments.&nbsp;</div></li><li><div>                            $payment_settings = wc_novalnet_payment_config( $this-&gt;wc_order-&gt;payment_method );&nbsp;</div></li><li><div>                            $this-&gt;wc_order-&gt;update_status( $payment_settings ['callback_status'] );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( (int) $paid_amount &gt; $this-&gt;order_reference ['amount'] ) {&nbsp;</div></li><li><div>                            $additional_note .= 'Customer paid amount is greater than order amount.';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Update order comments.&nbsp;</div></li><li><div>                    novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $this-&gt;wc_order, $callback_comments, true, 'note', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Update Callback amount.&nbsp;</div></li><li><div>                    wc_novalnet_db_update_query(&nbsp;</div></li><li><div>                        array(&nbsp;</div></li><li><div>                            'callback_amount' =&gt; $paid_amount, &nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>                            'order_no' =&gt; $this-&gt;wc_order-&gt;id, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Log callback process.&nbsp;</div></li><li><div>                    $this-&gt;log_callback_details( $this-&gt;wc_order-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>                    $this-&gt;send_notification_mail( $callback_comments, $additional_note );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // After execution.&nbsp;</div></li><li><div>                $this-&gt;display_message( 'Novalnet callback script executed already' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // After execution.&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet Callbackscript received. Payment type ( ' . $this-&gt;server_request ['payment_type'] . ' ) is not applicable for this process!' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Subscription stop process.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function subscription_stop_process() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( $this-&gt;success_status && 'SUBSCRIPTION_STOP' === $this-&gt;server_request ['payment_type'] ) || ( ! empty( $this-&gt;server_request ['subs_billing'] ) && ! wc_novalnet_status_check( $this-&gt;server_request ) && 'SUBSCRIPTION_STOP' !== $this-&gt;server_request ['payment_type'] ) ) {&nbsp;</div></li><li><div>            // Prepare callback comments.&nbsp;</div></li><li><div>            if ( empty( $this-&gt;server_request ['termination_reason'] ) ) {&nbsp;</div></li><li><div>                $this-&gt;server_request ['termination_reason'] = $this-&gt;server_request ['status_message'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $callback_comments = wc_novalnet_format_text( sprintf( __( 'Novalnet callback script received. Subscription has been stopped for the TID: %1$s on %2$s. Subscription has been canceled due to: %3$s', 'wc-novalnet' ), $this-&gt;server_request ['shop_tid'], wc_novalnet_formatted_date(), $this-&gt;server_request ['termination_reason'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Cancel the subscription.&nbsp;</div></li><li><div>            do_action( 'novalnet_cancel_subscription', $this-&gt;wc_order );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Update order comments without bank details.&nbsp;</div></li><li><div>            $order_details = apply_filters( 'novalnet_get_subscription_details', $this-&gt;wc_order-&gt;id );&nbsp;</div></li><li><div>            $wc_order = new WC_Order( $order_details ['0'] );&nbsp;</div></li><li><div>            novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $wc_order, $callback_comments, true, 'note', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // log for subscription process.&nbsp;</div></li><li><div>            $this-&gt;maintain_debug_log( &quot;$callback_comments&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Send notification mail to the configured E-mail.&nbsp;</div></li><li><div>            $this-&gt;send_notification_mail( $callback_comments );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update / initialize the payment.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param int   $wc_order_id           The order id of the processing order.&nbsp;</div></li><li><div>     * @param array $transaction_details   Stored Novalnet transaction details.&nbsp;</div></li><li><div>     * @param array $communication_failure Check for communication failure payment.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function update_initial_payment( $wc_order_id, $transaction_details, $communication_failure ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wc_order = new WC_Order( $transaction_details ['order_no'] );&nbsp;</div></li><li><div>        $post_id = $transaction_details ['order_no'];&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;server_request ['payment_type'] ) && ! in_array( $this-&gt;server_request ['payment_type'], $this-&gt;payment_groups [ $wc_order-&gt;payment_method ], true ) ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( 'Novalnet callback received. Payment type [ ' . $this-&gt;server_request ['payment_type'] . '] is not valid.' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;server_request ['payment_method'] = $wc_order-&gt;payment_method;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get payment settings.&nbsp;</div></li><li><div>        $payment_settings = wc_novalnet_payment_config( $this-&gt;server_request ['payment_method'] );&nbsp;</div></li><li><div>        $is_subscription = apply_filters( 'novalnet_check_subscription', $post_id );&nbsp;</div></li><li><div>        update_post_meta( $post_id, '_novalnet_gateway_status', $this-&gt;server_request ['tid_status'] );&nbsp;</div></li><li><div>        $bank_details = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Forming comments.&nbsp;</div></li><li><div>        $novalnet_comments = novalnet_instance()-&gt;novalnet_functions()-&gt;form_comments(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>            'test_mode' =&gt; $this-&gt;server_request ['test_mode'], &nbsp;</div></li><li><div>            'tid' =&gt; $this-&gt;server_request ['shop_tid'], &nbsp;</div></li><li><div>            'title' =&gt; $wc_order-&gt;payment_method_title, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $message = wc_novalnet_response_text( $this-&gt;server_request );&nbsp;</div></li><li><div>        if ( in_array( $this-&gt;server_request ['tid_status'], $this-&gt;success_code [ $this-&gt;server_request ['payment_type'] ], true ) ) {&nbsp;</div></li><li><div>            $transaction_details = $this-&gt;global_settings;&nbsp;</div></li><li><div>            if ( 'INVOICE_START' === $this-&gt;server_request ['payment_type'] ) {&nbsp;</div></li><li><div>                $invoice_details = $this-&gt;server_request;&nbsp;</div></li><li><div>                $invoice_details ['payment_reference_1'] = $payment_settings ['payment_reference_1'];&nbsp;</div></li><li><div>                $invoice_details ['payment_reference_2'] = $payment_settings ['payment_reference_2'];&nbsp;</div></li><li><div>                $invoice_details ['payment_reference_3'] = $payment_settings ['payment_reference_3'];&nbsp;</div></li><li><div>                $invoice_details ['response_order_no'] = $wc_order_id;&nbsp;</div></li><li><div>                $invoice_details ['invoice_ref'] = 'BNR-' . $invoice_details ['product_id'] . '-' . $wc_order_id;&nbsp;</div></li><li><div>                $invoice_details ['invoice_bankname'] = $invoice_details ['invoice_bankname'] . ' ' . $invoice_details ['invoice_bankplace'];&nbsp;</div></li><li><div>                $invoice_details ['tid'] = $this-&gt;server_request ['shop_tid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Comments with bank details.&nbsp;</div></li><li><div>                $novalnet_comments .= novalnet_instance()-&gt;novalnet_functions()-&gt;form_bank_comments( $invoice_details );&nbsp;</div></li><li><div>                $bank_details = wc_novalnet_serialize_data(&nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                    'test_mode' =&gt; $this-&gt;server_request ['test_mode'], &nbsp;</div></li><li><div>                    'invoice_bankname' =&gt; $this-&gt;server_request ['invoice_bankname'], &nbsp;</div></li><li><div>                    'invoice_bankplace' =&gt; $this-&gt;server_request ['invoice_bankplace'], &nbsp;</div></li><li><div>                    'invoice_iban' =&gt; $this-&gt;server_request ['invoice_iban'], &nbsp;</div></li><li><div>                    'invoice_bic' =&gt; $this-&gt;server_request ['invoice_bic'], &nbsp;</div></li><li><div>                    'response_order_no' =&gt; $this-&gt;server_request ['order_no'], &nbsp;</div></li><li><div>                    'invoice_ref' =&gt; $this-&gt;server_request ['invoice_ref'], &nbsp;</div></li><li><div>                    'due_date' =&gt; $this-&gt;server_request ['due_date'], &nbsp;</div></li><li><div>                    'payment_reference_1' =&gt; $payment_settings ['payment_reference_1'], &nbsp;</div></li><li><div>                    'payment_reference_2' =&gt; $payment_settings ['payment_reference_2'], &nbsp;</div></li><li><div>                    'payment_reference_3' =&gt; $payment_settings ['payment_reference_3'], &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;insert_transaction_details( $post_id, $wc_order, $transaction_details, $bank_details );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Insert the subscription details.&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;server_request ['subs_id'] ) && $is_subscription ) {&nbsp;</div></li><li><div>                wc_novalnet_db_insert_query(&nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                    'order_no' =&gt; $post_id, &nbsp;</div></li><li><div>                    'recurring_payment_type' =&gt; $wc_order-&gt;payment_method, &nbsp;</div></li><li><div>                    'payment_type' =&gt; $wc_order-&gt;payment_method, &nbsp;</div></li><li><div>                    'tid' =&gt; $this-&gt;server_request ['tid'], &nbsp;</div></li><li><div>                    'recurring_amount' =&gt; novalnet_instance()-&gt;novalnet_functions()-&gt;get_recurring_amount_cart( $wc_order ), &nbsp;</div></li><li><div>                    'recurring_tid' =&gt; $this-&gt;server_request ['tid'], &nbsp;</div></li><li><div>                    'signup_date' =&gt; date( 'Y-m-d H:i:s' ), &nbsp;</div></li><li><div>                    'subs_id' =&gt; $this-&gt;server_request ['subs_id'], &nbsp;</div></li><li><div>                    'next_payment_date' =&gt; wc_novalnet_next_subscription_date( $this-&gt;server_request ), &nbsp;</div></li><li><div>                    'subscription_length' =&gt; apply_filters( 'novalnet_get_order_subscription_length', $wc_order ), &nbsp;</div></li><li><div> ), 'novalnet_subscription_details'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Activate the subscription for the order.&nbsp;</div></li><li><div>                do_action( 'novalnet_activate_subscription', $wc_order, $novalnet_comments, $this-&gt;server_request ['tid'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Update order comments.&nbsp;</div></li><li><div>            if ( $communication_failure ) {&nbsp;</div></li><li><div>                novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $wc_order, $novalnet_comments, true, 'transaction_info' );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $wc_order, $novalnet_comments, false, 'transaction_info' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'ONLINE_TRANSFER_CREDIT' !== $this-&gt;server_request ['payment_type'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Set order status.&nbsp;</div></li><li><div>                add_filter( 'woocommerce_valid_order_statuses_for_payment_complete', 'wc_novalnet_append_shop_order_status', 10, 2 );&nbsp;</div></li><li><div>                add_filter( 'woocommerce_payment_complete_order_status', array( $this, 'callback_order_status' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Complete the payment.&nbsp;</div></li><li><div>                $wc_order-&gt;payment_complete( $this-&gt;server_request ['shop_tid'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $novalnet_comments .= PHP_EOL . $message;&nbsp;</div></li><li><div>            // Update order comments.&nbsp;</div></li><li><div>            novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $wc_order, $novalnet_comments, true, 'transaction_info' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Cancel order.&nbsp;</div></li><li><div>            $wc_order-&gt;cancel_order();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Log callback process.&nbsp;</div></li><li><div>        $this-&gt;log_callback_details( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update order Novalnet version.&nbsp;</div></li><li><div>        update_post_meta( $wc_order-&gt;id, '_nn_version', NN_VERSION );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $communication_failure ) {&nbsp;</div></li><li><div>            $this-&gt;display_message( $novalnet_comments );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Log callback process.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $post_id The post id of the processing order.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function log_callback_details( $post_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wc_novalnet_db_insert_query(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>            'payment_type' =&gt; $this-&gt;server_request ['payment_type'], &nbsp;</div></li><li><div>            'status' =&gt; $this-&gt;server_request ['status'], &nbsp;</div></li><li><div>            'callback_tid' =&gt; $this-&gt;server_request ['tid'], &nbsp;</div></li><li><div>            'org_tid' =&gt; $this-&gt;server_request ['shop_tid'], &nbsp;</div></li><li><div>            'amount' =&gt; $this-&gt;server_request ['amount'], &nbsp;</div></li><li><div>            'order_no' =&gt; $post_id, &nbsp;</div></li><li><div>            'date' =&gt; date( 'Y-m-d H:i:s' ), &nbsp;</div></li><li><div> ), 'novalnet_callback_history'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Creation of order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 10.0.0&nbsp;</div></li><li><div>     * @param array $subscription_order   Array contains subsription order.&nbsp;</div></li><li><div>     * @param array $subscription_details Array contains subsription order details.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function recurring_order_creation( $subscription_order, $subscription_details ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $order_comments = $subscription_order-&gt;customer_note;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Forming comments.&nbsp;</div></li><li><div>        $novalnet_comments = $novalnet_comments = novalnet_instance()-&gt;novalnet_functions()-&gt;form_comments(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>            'title' =&gt; get_post_meta( $subscription_order-&gt;id, '_payment_method_title', true ), &nbsp;</div></li><li><div>            'tid' =&gt; $this-&gt;server_request ['tid'], &nbsp;</div></li><li><div>            'test_mode' =&gt; $this-&gt;server_request ['test_mode'], &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $bank_details = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Forming comments with bank details.&nbsp;</div></li><li><div>        if ( 'INVOICE_START' === $this-&gt;server_request ['payment_type'] ) {&nbsp;</div></li><li><div>            $this-&gt;server_request ['invoice_bankname'] = $this-&gt;server_request ['invoice_bankname'] . ' ' . $this-&gt;server_request ['invoice_bankname'];&nbsp;</div></li><li><div>            $novalnet_comments .= novalnet_instance()-&gt;novalnet_functions()-&gt;form_bank_comments( $this-&gt;server_request, false );&nbsp;</div></li><li><div>            $bank_details = wc_novalnet_serialize_data(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                'test_mode' =&gt; $this-&gt;server_request ['test_mode'], &nbsp;</div></li><li><div>                'invoice_bankname' =&gt; $this-&gt;server_request ['invoice_bankname'], &nbsp;</div></li><li><div>                'invoice_iban' =&gt; $this-&gt;server_request ['invoice_iban'], &nbsp;</div></li><li><div>                'invoice_bic' =&gt; $this-&gt;server_request ['invoice_bic'], &nbsp;</div></li><li><div>                'response_order_no' =&gt; $this-&gt;server_request ['order_no'], &nbsp;</div></li><li><div>                'invoice_ref' =&gt; $this-&gt;server_request ['invoice_ref'], &nbsp;</div></li><li><div>                'due_date' =&gt; $this-&gt;server_request ['due_date'], &nbsp;</div></li><li><div>                'payment_reference_1' =&gt; 'no', &nbsp;</div></li><li><div>                'payment_reference_2' =&gt; 'no', &nbsp;</div></li><li><div>                'payment_reference_3' =&gt; 'no', &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction_details = $this-&gt;order_reference;&nbsp;</div></li><li><div>        $next_payment_date = wc_novalnet_next_subscription_date( $this-&gt;server_request );&nbsp;</div></li><li><div>        $next_payment_text = '';&nbsp;</div></li><li><div>        if ( '' !== $next_payment_date ) {&nbsp;</div></li><li><div>            $next_payment_text = PHP_EOL . __( ' Next charging date: ', 'wc-novalnet' ) . wc_novalnet_formatted_date( $next_payment_date );&nbsp;</div></li><li><div>            $novalnet_comments  .= $next_payment_text;&nbsp;</div></li><li><div>            do_action( 'novalnet_update_next_payment_date', $next_payment_date, $subscription_order, $subscription_details );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update the new comments with parent subscription order to send the comments in mail.&nbsp;</div></li><li><div>        wp_update_post(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>            'ID' =&gt; $subscription_order-&gt;id, &nbsp;</div></li><li><div>            'post_excerpt' =&gt; $novalnet_comments, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;server_request ['payment_method'] = get_post_meta( $subscription_order-&gt;id, '_payment_method', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'woocommerce_valid_order_statuses_for_payment_complete', 'wc_novalnet_append_shop_order_status', 10, 2 );&nbsp;</div></li><li><div>        add_filter( 'woocommerce_payment_complete_order_status', array( $this, 'callback_order_status' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Creating recurring order.&nbsp;</div></li><li><div>        $recurring_order = apply_filters( 'novalnet_create_renewal_order', $subscription_order, $subscription_details );&nbsp;</div></li><li><div>        $recurring_order = apply_filters( 'novalnet_get_renewal_order_details', $recurring_order );&nbsp;</div></li><li><div>        update_post_meta( $recurring_order-&gt;id, '_payment_method', $this-&gt;server_request ['payment_method'] );&nbsp;</div></li><li><div>        update_post_meta( $recurring_order-&gt;id, '_payment_method_title', get_post_meta( $subscription_order-&gt;id, '_payment_method_title', true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Reverting the updated comments & replace with parent subscription comments.&nbsp;</div></li><li><div>        wp_update_post(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>            'ID' =&gt; $subscription_order-&gt;id, &nbsp;</div></li><li><div>            'post_excerpt' =&gt; $order_comments, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inserting transaction details.&nbsp;</div></li><li><div>        $this-&gt;insert_transaction_details( $recurring_order-&gt;id, $recurring_order, $transaction_details, $bank_details, $subscription_order-&gt;payment_method );&nbsp;</div></li><li><div>        update_post_meta( $recurring_order-&gt;id, '_nn_version', NN_VERSION );&nbsp;</div></li><li><div>        update_post_meta( $recurring_order-&gt;id, '_paid_date', current_time( 'mysql' ) );&nbsp;</div></li><li><div>        update_post_meta( $recurring_order-&gt;id, '_novalnet_gateway_status', $this-&gt;server_request ['tid_status'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update order comments.&nbsp;</div></li><li><div>        novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $recurring_order, $novalnet_comments, false , 'transaction_info' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Prepare callback comments.&nbsp;</div></li><li><div>        $callback_comments = wc_novalnet_format_text( sprintf( __( 'Novalnet Callback Script executed successfully for the subscription TID: %1$s with amount %2$s on %3$s. Please refer PAID transaction in our Novalnet Merchant Administration with the TID: %4$s', 'wc-novalnet' ), $this-&gt;server_request ['shop_tid'], wc_novalnet_shop_amount_format( $this-&gt;server_request ['amount'] / 100 ), wc_novalnet_formatted_date(), $this-&gt;server_request ['tid'] ) );&nbsp;</div></li><li><div>        $callback_comments .= $next_payment_text;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update order comments.&nbsp;</div></li><li><div>        novalnet_instance()-&gt;novalnet_functions()-&gt;update_comments( $subscription_order, $callback_comments, true, 'note', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Log callback process.&nbsp;</div></li><li><div>        $this-&gt;log_callback_details( $recurring_order-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Log payment details.&nbsp;</div></li><li><div>        $this-&gt;maintain_debug_log( 'Recurring order created order number ' . $recurring_order-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Complete the payment.&nbsp;</div></li><li><div>        $recurring_order-&gt;payment_complete( $this-&gt;server_request ['tid'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the comments.&nbsp;</div></li><li><div>        return $callback_comments;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Inserting transaction details.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param int      $post_id        The post ID of the processing order.&nbsp;</div></li><li><div>     * @param WC_Order $wc_order       The order object.&nbsp;</div></li><li><div>     * @param array    $vendor_details Novalnet vendor details.&nbsp;</div></li><li><div>     * @param string   $bank_details   Payment bank details.&nbsp;</div></li><li><div>     * @param string   $payment_type   Type of the processing payment.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function insert_transaction_details( $post_id, $wc_order, $vendor_details, $bank_details, $payment_type = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $subs_id = '';&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;server_request ['subs_id'] ) ) {&nbsp;</div></li><li><div>            $subs_id = $this-&gt;server_request ['subs_id'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get Tariff id.&nbsp;</div></li><li><div>        $tariff_id = $vendor_details ['tariff_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get payment type.&nbsp;</div></li><li><div>        if ( '' === $payment_type ) {&nbsp;</div></li><li><div>            $payment_type = $wc_order-&gt;payment_method;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $order_amount = $this-&gt;server_request ['amount'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tid = $this-&gt;server_request ['tid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get customer paid amount.&nbsp;</div></li><li><div>        $paid_amount = $this-&gt;server_request ['amount'];&nbsp;</div></li><li><div>        if ( 'INVOICE_START' === $this-&gt;server_request ['payment_type'] || ( 'PAYPAL' === $this-&gt;server_request ['payment_type'] && '90' === $this-&gt;server_request ['tid_status'] ) ) {&nbsp;</div></li><li><div>            $paid_amount = '0';&nbsp;</div></li><li><div>        } elseif ( 'ONLINE_TRANSFER_CREDIT' === $this-&gt;server_request ['payment_type'] ) {&nbsp;</div></li><li><div>            $order_amount = wc_novalnet_formatted_amount( $wc_order-&gt;order_total );&nbsp;</div></li><li><div>            $paid_amount = '0';&nbsp;</div></li><li><div>            $tid = $this-&gt;server_request ['tid_payment'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get formated order number.&nbsp;</div></li><li><div>        $formatted_order_no = ltrim( $wc_order-&gt;get_order_number(), _x( '#', 'hash before order number', 'woocommerce' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wc_novalnet_db_insert_query(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>            'order_no' =&gt; $post_id, &nbsp;</div></li><li><div>            'order_number_formatted' =&gt; $formatted_order_no, &nbsp;</div></li><li><div>            'vendor_id' =&gt; $vendor_details ['vendor_id'], &nbsp;</div></li><li><div>            'auth_code' =&gt; $vendor_details ['auth_code'], &nbsp;</div></li><li><div>            'product_id' =&gt; $vendor_details ['product_id'], &nbsp;</div></li><li><div>            'tariff_id' =&gt; $tariff_id, &nbsp;</div></li><li><div>            'subs_id' =&gt; $subs_id, &nbsp;</div></li><li><div>            'payment_id' =&gt; wc_novalnet_get_payment_type( $payment_type, 'key' ), &nbsp;</div></li><li><div>            'payment_type' =&gt; $payment_type, &nbsp;</div></li><li><div>            'tid' =&gt; $tid, &nbsp;</div></li><li><div>            'gateway_status' =&gt; $this-&gt;server_request ['tid_status'], &nbsp;</div></li><li><div>            'amount' =&gt; $order_amount, &nbsp;</div></li><li><div>            'callback_amount' =&gt; $paid_amount, &nbsp;</div></li><li><div>            'currency' =&gt; $this-&gt;server_request ['currency'], &nbsp;</div></li><li><div>            'test_mode' =&gt; $this-&gt;server_request ['test_mode'], &nbsp;</div></li><li><div>            'customer_id' =&gt; $wc_order-&gt;user_id, &nbsp;</div></li><li><div>            'customer_email' =&gt; $wc_order-&gt;billing_email, &nbsp;</div></li><li><div>            'date' =&gt; date( 'Y-m-d H:i:s' ), &nbsp;</div></li><li><div>            'booked' =&gt; 1, &nbsp;</div></li><li><div>            'payment_ref' =&gt; 0, &nbsp;</div></li><li><div>            'bank_details' =&gt; $bank_details, &nbsp;</div></li><li><div>            'payment_params' =&gt; '', &nbsp;</div></li><li><div> ), 'novalnet_transaction_detail'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display the callback messages.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param string  $message Message for the executed process.&nbsp;</div></li><li><div>     * @param boolean $force_display Display the message if debug mode is off.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function display_message( $message, $force_display = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Log callback details.&nbsp;</div></li><li><div>        $this-&gt;maintain_debug_log( &quot;Novalnet callback message : $message &quot; . http_build_query( $this-&gt;server_request ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Display message based on backend debug / test mode option.&nbsp;</div></li><li><div>        if ( $this-&gt;debug_mode || $force_display ) {&nbsp;</div></li><li><div>            wp_die( wp_kses( $message, array() ) , 'Novalnet Callback', array(&nbsp;</div></li><li><div>                'response' =&gt; '200', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_die( '' , 'Novalnet Callback', array(&nbsp;</div></li><li><div>            'response' =&gt; '200', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Send notification mail.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param string $comments        Formed comments.&nbsp;</div></li><li><div>     * @param string $additional_note Additional note.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function send_notification_mail( $comments, $additional_note = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wc_novalnet_send_mail( get_option( 'novalnet_enable_callback' ), get_option( 'novalnet_callback_emailtoaddr' ), 'Novalnet Callback Script Access Report - WooCommerce', $comments, get_option( 'novalnet_callback_emailbccaddr' ) );&nbsp;</div></li><li><div>        $this-&gt;display_message( $comments . $additional_note );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the success status.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 11.0.0&nbsp;</div></li><li><div>     * @param string $order_status Default order status value.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function callback_order_status( $order_status ) {&nbsp;</div></li><li><div>        $payment_settings = wc_novalnet_payment_config( $this-&gt;server_request ['payment_method'] );&nbsp;</div></li><li><div>        if ( ! empty( $payment_settings ['pending_status'] ) && ( ( 'PAYPAL' === $this-&gt;server_request ['payment_type'] && in_array( $this-&gt;server_request ['tid_status'], array( '90', '85' ), true ) ) || ( 'PRZELEWY24' === $this-&gt;server_request ['payment_type'] && '86' === $this-&gt;server_request ['tid_status'] ) ) ) {&nbsp;</div></li><li><div>            $order_status = $payment_settings ['pending_status'];&nbsp;</div></li><li><div>        } elseif ( ! empty( $payment_settings ['order_success_status'] ) ) {&nbsp;</div></li><li><div>            $order_status = $payment_settings ['order_success_status'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $order_status;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 11.1.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.1/classes/nn_callback_api/" class="active">11.1.1</a></li><li><a href="http://hookr.io/plugins/novalnet-payment-plugin-woocommerce/11.1.0/classes/nn_callback_api/" class="">11.1.0</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>NN_Callback_Api</li><li><span></span>Novalnet Payment Plugin - WooCommerce</li><li><span></span>11.1.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>