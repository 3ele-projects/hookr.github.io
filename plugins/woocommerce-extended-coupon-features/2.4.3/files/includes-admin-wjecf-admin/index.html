<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.4.3" data-slug="woocommerce-extended-coupon-features" data-type="file" data-id="63195"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-admin-wjecf-admin | file | Woocommerce Extended Coupon Features | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, woocommerce-extended-coupon-features, 2.4.3" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=b500634a684a1c3f811117d184f7bb9e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-admin-wjecf-admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-wjecf-admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-wjecf-admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-extended-coupon-features-2.4.3-file-includes-admin-wjecf-admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-admin-wjecf-admin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce-extended-coupon-f&hellip;." href="http://hookr.io/plugins/woocommerce-extended-coupon-features/" class="plugin"><span property="name">woocommerce-extended-coupon-f&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.4.3." href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/" class="H_VERSION"><span property="name">2.4.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-admin-wjecf-admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="29"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/all/" title="All">All <span class="count badge">29</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="16"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/hooks/" title="Hooks">Hooks <span class="count badge">16</span></a></li><li class="" data-id="action" data-count="7"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/actions/" title="Actions">Actions <span class="count badge">7</span></a></li><li class="" data-id="filter" data-count="9"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/filters/" title="Filters">Filters <span class="count badge">9</span></a></li><li class="" data-id="class" data-count="11"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/classes/" title="Classes">Classes <span class="count badge">11</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="2"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/functions/" title="Functions">Functions <span class="count badge">2</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/woocommerce-extended-coupon-features/2.4.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/admin/wjecf-admin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>defined('ABSPATH') or die();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( class_exists('WJECF_Admin') ) {&nbsp;</div></li><li><div>  return;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class WJECF_Admin extends Abstract_WJECF_Plugin {&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  public function __construct() {    &nbsp;</div></li><li><div>      $this-&gt;set_plugin_data( array(&nbsp;</div></li><li><div>          'description' =&gt; __( 'Admin interface of WooCommerce Extended Coupon Features.', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'dependencies' =&gt; array(), &nbsp;</div></li><li><div>          'can_be_disabled' =&gt; false&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function init_admin_hook() {&nbsp;</div></li><li><div>      add_action( 'admin_notices', array( $this, 'admin_notices'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! WJECF_WC()-&gt;check_woocommerce_version('2.3.0') ) {&nbsp;</div></li><li><div>          $this-&gt;enqueue_notice( '&lt;p&gt;' . &nbsp;</div></li><li><div>              __( '&lt;strong&gt;WooCommerce Extended Coupon Features:&lt;/strong&gt; You are using an old version of WooCommerce. Updating of WooCommerce is recommended as using an outdated version might cause unexpected behaviour in combination with modern plugins.' ) &nbsp;</div></li><li><div>              . '&lt;/p&gt;', 'notice-warning' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Admin hooks</span>&nbsp;</div></li><li><div>      add_filter( 'plugin_row_meta', array( $this, 'wjecf_plugin_meta' ), 10, 2 );&nbsp;</div></li><li><div>      add_action( 'admin_head', array( $this, 'on_admin_head'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'woocommerce_coupon_data_tabs', array( $this, 'admin_coupon_options_tabs' ), 10, 1);&nbsp;</div></li><li><div>      add_action( 'woocommerce_coupon_data_panels', array( $this, 'admin_coupon_options_panels' ), 10, 0 );&nbsp;</div></li><li><div>      add_action( 'woocommerce_process_shop_coupon_meta', array( $this, 'process_shop_coupon_meta' ), 10, 2 );        &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      add_action( 'wjecf_coupon_metabox_products', array( $this, 'admin_coupon_metabox_products' ), 10, 2 );&nbsp;</div></li><li><div>      add_action( 'wjecf_coupon_metabox_checkout', array( $this, 'admin_coupon_metabox_checkout' ), 10, 2 );&nbsp;</div></li><li><div>      add_action( 'wjecf_coupon_metabox_customer', array( $this, 'admin_coupon_metabox_customer' ), 10, 2 );&nbsp;</div></li><li><div>      add_action( 'wjecf_coupon_metabox_misc', array( $this, 'admin_coupon_metabox_misc' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      WJECF_ADMIN()-&gt;add_inline_style( '&nbsp;</div></li><li><div>          #woocommerce-coupon-data .wjecf-not-wide { width:50% }&nbsp;</div></li><li><div>      ');        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//WORK IN PROGRESS: add_action( 'admin_menu', array( $this, 'action_admin_menu' ) );</span>&nbsp;</div></li><li><div>  }    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ===========================================================================</span></span></span></span>&nbsp;</div></li><li><div><span class="comment">// START - ADMIN NOTICES</span>&nbsp;</div></li><li><div><span class="comment">// Allows notices to be displayed on the admin pages</span>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ===========================================================================</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $notices = array();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue a notice to display on the admin page</span>&nbsp;</div></li><li><div><span class="comment">   * @param stirng $html Please embed in &lt;p&gt; tags</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $class </span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function enqueue_notice( $html, $class = 'notice-info' ) {&nbsp;</div></li><li><div>      $this-&gt;notices[] = array( 'class' =&gt; $class, 'html' =&gt; $html );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function admin_notices() {&nbsp;</div></li><li><div>      foreach( $this-&gt;notices as $notice ) {&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;notice ' . $notice['class'] . '&quot;&gt;';&nbsp;</div></li><li><div>          echo $notice['html'];&nbsp;</div></li><li><div>          echo '&lt;/div&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ===========================================================================</span></span></span></span>&nbsp;</div></li><li><div><span class="comment">// END - ADMIN NOTICES</span>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ===========================================================================</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function action_admin_menu() {&nbsp;</div></li><li><div>      add_options_page( __( 'WooCommerce Extended Coupon Features', 'soft79-wc-pricing-rules' ), __( 'WooCommerce Extended Coupon Features', 'soft79-wc-pricing-rules' ), 'manage_options', 'wjecf_settings', array( &$this, 'action_admin_config_page' ) ); &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function action_admin_config_page() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;h2&gt;&lt;?php _e( 'WooCommerce Extended Coupon Features', 'soft79-wc-pricing-rules' ); ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>      &lt;form method=&quot;post&quot; action=&quot;options.php&quot;&gt; &nbsp;</div></li><li><div>      &lt;?php &nbsp;</div></li><li><div>      settings_fields( 'wjecf_settings' );&nbsp;</div></li><li><div>      do_settings_sections( 'wjecf_settings' );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;?php submit_button(); ?&gt;&nbsp;</div></li><li><div>      &lt;/form&gt;&nbsp;</div></li><li><div>      &lt;h3&gt;&lt;?php _e( 'Plugins', 'soft79-wc-pricing-rules' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>      &lt;ul&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      foreach ( WJECF()-&gt;get_plugins() as $name =&gt; $plugin ) {&nbsp;</div></li><li><div>          echo &quot;&lt;li&gt;&lt;h3&gt;&quot; . $plugin-&gt;get_plugin_class_name() . &quot;&lt;/h3&gt;\n&quot;;&nbsp;</div></li><li><div>          echo &quot;&lt;p&gt;&quot; . $plugin-&gt;get_plugin_description() . &quot;&lt;/p&gt;\n&quot;;&nbsp;</div></li><li><div>          echo &quot;&lt;/li&gt;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;/ul&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  }   &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//2.3.6 Inline css</span>&nbsp;</div></li><li><div>  private $admin_css = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * 2.3.6</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function on_admin_head() {&nbsp;</div></li><li><div>       <span class="comment">//Output inline style for the admin pages</span>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;admin_css ) ) {&nbsp;</div></li><li><div>          echo '&lt;style type=&quot;text/css&quot;&gt;' . $this-&gt;admin_css . '&lt;/style&gt;';&nbsp;</div></li><li><div>          $this-&gt;admin_css = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Enqueue scripts</span>&nbsp;</div></li><li><div>      wp_enqueue_script( &quot;wjecf-admin&quot;, WJECF()-&gt;plugin_url . &quot;assets/js/wjecf-admin.js&quot;, array( 'jquery' ), WJECF()-&gt;version );&nbsp;</div></li><li><div>      wp_localize_script( 'wjecf-admin', 'wjecf_admin_i18n', array(&nbsp;</div></li><li><div>          'label_and' =&gt; __( '(AND)', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'label_or' =&gt; __( '(OR)', 'woocommerce-jos-autocoupon' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Add tabs to the coupon option page</span>&nbsp;</div></li><li><div>  public function admin_coupon_options_tabs( $tabs ) {&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $tabs['extended_features_products'] = array(&nbsp;</div></li><li><div>          'label' =&gt; __( 'Products', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'target' =&gt; 'wjecf_coupondata_products', &nbsp;</div></li><li><div>          'class' =&gt; 'wjecf_coupondata_products', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tabs['extended_features_checkout'] = array(&nbsp;</div></li><li><div>          'label' =&gt; __( 'Checkout', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'target' =&gt; 'wjecf_coupondata_checkout', &nbsp;</div></li><li><div>          'class' =&gt; 'wjecf_coupondata_checkout', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tabs['extended_features_misc'] = array(&nbsp;</div></li><li><div>          'label' =&gt; __( 'Miscellaneous', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'target' =&gt; 'wjecf_coupondata_misc', &nbsp;</div></li><li><div>          'class' =&gt; 'wjecf_coupondata_misc', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $tabs;&nbsp;</div></li><li><div>  }    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Add panels to the coupon option page</span>&nbsp;</div></li><li><div>  public function admin_coupon_options_panels() {&nbsp;</div></li><li><div>      global $thepostid, $post;&nbsp;</div></li><li><div>      $thepostid = empty( $thepostid ) ? $post-&gt;ID : $thepostid;&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;wjecf_coupondata_products&quot; class=&quot;panel woocommerce_options_panel&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                  <span class="comment">//Feed the panel with options</span>&nbsp;</div></li><li><div>                  do_action( 'wjecf_coupon_metabox_products', $thepostid, $post );&nbsp;</div></li><li><div>                  $this-&gt;admin_coupon_data_footer();&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;wjecf_coupondata_checkout&quot; class=&quot;panel woocommerce_options_panel&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                  do_action( 'wjecf_coupon_metabox_checkout', $thepostid, $post );&nbsp;</div></li><li><div>                  do_action( 'wjecf_coupon_metabox_customer', $thepostid, $post );&nbsp;</div></li><li><div>                  $this-&gt;admin_coupon_data_footer();&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;wjecf_coupondata_misc&quot; class=&quot;panel woocommerce_options_panel&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                  <span class="comment">//Allow other classes to inject options</span>&nbsp;</div></li><li><div>                  do_action( 'wjecf_woocommerce_coupon_options_extended_features', $thepostid, $post );&nbsp;</div></li><li><div>                  do_action( 'wjecf_coupon_metabox_misc', $thepostid, $post );&nbsp;</div></li><li><div>                  $this-&gt;admin_coupon_data_footer();&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php        &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function admin_coupon_data_footer() {&nbsp;</div></li><li><div>      $documentation_url = plugins_url( 'docs/index.html', dirname( __FILE__ ) );&nbsp;</div></li><li><div>      if ( ! WJECF()-&gt;is_pro() ) {&nbsp;</div></li><li><div>          $documentation_url = 'http:<span class="comment">//www.soft79.nl/documentation/wjecf';</span>&nbsp;</div></li><li><div>          ?&gt;            &nbsp;</div></li><li><div>          &lt;h3&gt;&lt;?php _e( 'Do you find WooCommerce Extended Coupon Features useful?', 'woocommerce-jos-autocoupon'); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>          &lt;p class=&quot;form-field&quot;&gt;&lt;label for=&quot;wjecf_donate_button&quot;&gt;&lt;?php&nbsp;</div></li><li><div>              echo esc_html( __('Express your gratitude', 'woocommerce-jos-autocoupon' ) );    &nbsp;</div></li><li><div>          ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;a id=&quot;wjecf_donate_button&quot; href=&quot;&lt;?php echo $this-&gt;get_donate_url(); ?&gt;&quot; target=&quot;_blank&quot; class=&quot;button button-primary&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>              echo esc_html( __('Donate to the developer', 'woocommerce-jos-autocoupon' ) );    &nbsp;</div></li><li><div>          ?&gt;&lt;/a&gt;&lt;br&gt;&nbsp;</div></li><li><div>          Or get the PRO version at &lt;a href=&quot;http:<span class="comment">//www.soft79.nl&quot; target=&quot;_blank&quot;&gt;www.soft79.nl&lt;/a&gt;.</span>&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Documentation link</span>&nbsp;</div></li><li><div>      echo '&lt;h3&gt;' . __( 'Documentation', 'woocommerce-jos-autocoupon' ) . '&lt;/h3&gt;';&nbsp;</div></li><li><div>      echo '&lt;p&gt;&lt;a href=&quot;' . $documentation_url . '&quot; target=&quot;_blank&quot;&gt;' . &nbsp;</div></li><li><div>           __( 'WooCommerce Extended Coupon Features Documentation', 'woocommerce-jos-autocoupon' ) . '&lt;/a&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Tab 'extended features'</span>&nbsp;</div></li><li><div>  public function admin_coupon_metabox_products( $thepostid, $post ) {&nbsp;</div></li><li><div>      <span class="comment">//See WooCommerce class-wc-meta-box-coupon-data.php function ouput</span>&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      echo &quot;&lt;h3&gt;&quot; . esc_html( __( 'Matching products', 'woocommerce-jos-autocoupon' ) ). &quot;&lt;/h3&gt;\n&quot;;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// AND instead of OR the products</span>&nbsp;</div></li><li><div>      $this-&gt;render_select_with_default( array(&nbsp;</div></li><li><div>          'id' =&gt; '_wjecf_products_and', &nbsp;</div></li><li><div>          'label' =&gt; __( 'Products Operator', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'options' =&gt; array( 'no' =&gt; __( 'OR', 'woocommerce-jos-autocoupon' ), 'yes' =&gt; __( 'AND', 'woocommerce-jos-autocoupon' ) ), &nbsp;</div></li><li><div>          'default_value' =&gt; 'no', &nbsp;</div></li><li><div>          'class' =&gt; 'wjecf-not-wide', &nbsp;</div></li><li><div>          <span class="comment">/** translators: OLD TEXT:  'Check this box if ALL of the products (see tab \'usage restriction\') must be in the cart to use this coupon (instead of only one of the products).' */</span>&nbsp;</div></li><li><div>          'description' =&gt; __( 'Use AND if ALL of the products must be in the cart to use this coupon (instead of only one of the products).', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'desc_tip' =&gt; true&nbsp;</div></li><li><div> ) );        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// 2.2.3.1 AND instead of OR the categories</span>&nbsp;</div></li><li><div>      $this-&gt;render_select_with_default( array(&nbsp;</div></li><li><div>          'id' =&gt; '_wjecf_categories_and', &nbsp;</div></li><li><div>          'label' =&gt; __( 'Categories Operator', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'options' =&gt; array( 'no' =&gt; __( 'OR', 'woocommerce-jos-autocoupon' ), 'yes' =&gt; __( 'AND', 'woocommerce-jos-autocoupon' ) ), &nbsp;</div></li><li><div>          'default_value' =&gt; 'no', &nbsp;</div></li><li><div>          'class' =&gt; 'wjecf-not-wide', &nbsp;</div></li><li><div>          <span class="comment">/** translators: OLD TEXT:  'Check this box if products from ALL of the categories (see tab \'usage restriction\') must be in the cart to use this coupon (instead of only one from one of the categories).' */</span>&nbsp;</div></li><li><div>          'description' =&gt; __( 'Use AND if products from ALL of the categories must be in the cart to use this coupon (instead of only one from one of the categories).', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'desc_tip' =&gt; true&nbsp;</div></li><li><div> ) );        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Minimum quantity of matching products (product/category)</span>&nbsp;</div></li><li><div>      woocommerce_wp_text_input( array( &nbsp;</div></li><li><div>          'id' =&gt; '_wjecf_min_matching_product_qty', &nbsp;</div></li><li><div>          'label' =&gt; __( 'Minimum quantity of matching products', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'placeholder' =&gt; __( 'No minimum', 'woocommerce' ), &nbsp;</div></li><li><div>          'description' =&gt; __( 'Minimum quantity of the products that match the given product or category restrictions (see tab \'usage restriction\'). If no product or category restrictions are specified, the total number of products is used.', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'data_type' =&gt; 'decimal', &nbsp;</div></li><li><div>          'desc_tip' =&gt; true&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">// Maximum quantity of matching products (product/category)</span>&nbsp;</div></li><li><div>      woocommerce_wp_text_input( array( &nbsp;</div></li><li><div>          'id' =&gt; '_wjecf_max_matching_product_qty', &nbsp;</div></li><li><div>          'label' =&gt; __( 'Maximum quantity of matching products', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'placeholder' =&gt; __( 'No maximum', 'woocommerce' ), &nbsp;</div></li><li><div>          'description' =&gt; __( 'Maximum quantity of the products that match the given product or category restrictions (see tab \'usage restriction\'). If no product or category restrictions are specified, the total number of products is used.', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'data_type' =&gt; 'decimal', &nbsp;</div></li><li><div>          'desc_tip' =&gt; true&nbsp;</div></li><li><div> ) );        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Minimum subtotal of matching products (product/category)</span>&nbsp;</div></li><li><div>      woocommerce_wp_text_input( array( &nbsp;</div></li><li><div>          'id' =&gt; '_wjecf_min_matching_product_subtotal', &nbsp;</div></li><li><div>          'label' =&gt; __( 'Minimum subtotal of matching products', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'placeholder' =&gt; __( 'No minimum', 'woocommerce' ), &nbsp;</div></li><li><div>          'description' =&gt; __( 'Minimum price subtotal of the products that match the given product or category restrictions (see tab \'usage restriction\').', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'data_type' =&gt; 'price', &nbsp;</div></li><li><div>          'desc_tip' =&gt; true&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Maximum subtotal of matching products (product/category)</span>&nbsp;</div></li><li><div>      woocommerce_wp_text_input( array( &nbsp;</div></li><li><div>          'id' =&gt; '_wjecf_max_matching_product_subtotal', &nbsp;</div></li><li><div>          'label' =&gt; __( 'Maximum subtotal of matching products', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'placeholder' =&gt; __( 'No maximum', 'woocommerce' ), &nbsp;</div></li><li><div>          'description' =&gt; __( 'Maximum price subtotal of the products that match the given product or category restrictions (see tab \'usage restriction\').', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'data_type' =&gt; 'price', &nbsp;</div></li><li><div>          'desc_tip' =&gt; true&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function admin_coupon_metabox_checkout( $thepostid, $post ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo &quot;&lt;h3&gt;&quot; . esc_html( __( 'Checkout', 'woocommerce-jos-autocoupon' ) ). &quot;&lt;/h3&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Shipping methods</span>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;form-field&quot;&gt;&lt;label for=&quot;wjecf_shipping_methods&quot;&gt;&lt;?php _e( 'Shipping methods', 'woocommerce-jos-autocoupon' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;select id=&quot;wjecf_shipping_methods&quot; name=&quot;wjecf_shipping_methods[]&quot; style=&quot;width: 50%;&quot;  class=&quot;wc-enhanced-select&quot; multiple=&quot;multiple&quot; data-placeholder=&quot;&lt;?php _e( 'Any shipping method', 'woocommerce-jos-autocoupon' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>              $coupon_shipping_method_ids = WJECF()-&gt;get_coupon_shipping_method_ids( $thepostid );&nbsp;</div></li><li><div>              $shipping_methods = WC()-&gt;shipping-&gt;load_shipping_methods();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $shipping_methods ) foreach ( $shipping_methods as $shipping_method ) {&nbsp;</div></li><li><div>                  echo '&lt;option value=&quot;' . esc_attr( $shipping_method-&gt;id ) . '&quot;' . selected( in_array( $shipping_method-&gt;id, $coupon_shipping_method_ids ), true, false ) . '&gt;' . esc_html( $shipping_method-&gt;method_title ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;/select&gt;&lt;?php echo WJECF_WC()-&gt;wc_help_tip( __( 'One of these shipping methods must be selected in order for this coupon to be valid.', 'woocommerce-jos-autocoupon' ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php        &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Payment methods</span>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;form-field&quot;&gt;&lt;label for=&quot;wjecf_payment_methods&quot;&gt;&lt;?php _e( 'Payment methods', 'woocommerce-jos-autocoupon' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;select id=&quot;wjecf_payment_methods&quot; name=&quot;wjecf_payment_methods[]&quot; style=&quot;width: 50%;&quot;  class=&quot;wc-enhanced-select&quot; multiple=&quot;multiple&quot; data-placeholder=&quot;&lt;?php _e( 'Any payment method', 'woocommerce-jos-autocoupon' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>              $coupon_payment_method_ids = WJECF()-&gt;get_coupon_payment_method_ids( $thepostid );&nbsp;</div></li><li><div>              <span class="comment">//DONT USE WC()-&gt;payment_gateways-&gt;available_payment_gateways() AS IT CAN CRASH IN UNKNOWN OCCASIONS</span>&nbsp;</div></li><li><div>              $payment_methods = WC()-&gt;payment_gateways-&gt;payment_gateways();&nbsp;</div></li><li><div>              if ( $payment_methods ) foreach ( $payment_methods as $payment_method ) {&nbsp;</div></li><li><div>                  if ('yes' === $payment_method-&gt;enabled) {&nbsp;</div></li><li><div>                      echo '&lt;option value=&quot;' . esc_attr( $payment_method-&gt;id ) . '&quot;' . selected( in_array( $payment_method-&gt;id, $coupon_payment_method_ids ), true, false ) . '&gt;' . esc_html( $payment_method-&gt;title ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;/select&gt;&lt;?php echo WJECF_WC()-&gt;wc_help_tip( __( 'One of these payment methods must be selected in order for this coupon to be valid.', 'woocommerce-jos-autocoupon' ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php        &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function admin_coupon_metabox_customer( $thepostid, $post ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">//Title: &quot;CUSTOMER RESTRICTIONS&quot;</span>&nbsp;</div></li><li><div>      echo &quot;&lt;h3&gt;&quot; . esc_html( __( 'Customer restrictions', 'woocommerce-jos-autocoupon' ) ). &quot;&lt;/h3&gt;\n&quot;;&nbsp;</div></li><li><div>      echo &quot;&lt;p&gt;&lt;span class='description'&gt;&quot; . __( 'If both a customer and a role restriction are supplied, matching either one of them will suffice.' , 'woocommerce-jos-autocoupon' ) . &quot;&lt;/span&gt;&lt;/p&gt;\n&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// User ids</span>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;form-field&quot;&gt;&lt;label&gt;&lt;?php _e( 'Allowed Customers', 'woocommerce-jos-autocoupon' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>          $coupon_customer_ids = WJECF()-&gt;get_coupon_customer_ids( $thepostid );&nbsp;</div></li><li><div>          WJECF_WC()-&gt;render_admin_customer_selector( 'wjecf_customer_ids', 'wjecf_customer_ids', $coupon_customer_ids );&nbsp;</div></li><li><div>          echo WJECF_WC()-&gt;wc_help_tip( __( 'Only these customers may use this coupon.', 'woocommerce-jos-autocoupon' ) );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// User roles</span>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;form-field&quot;&gt;&lt;label for=&quot;wjecf_customer_roles&quot;&gt;&lt;?php _e( 'Allowed User Roles', 'woocommerce-jos-autocoupon' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;select id=&quot;wjecf_customer_roles&quot; name=&quot;wjecf_customer_roles[]&quot; style=&quot;width: 50%;&quot;  class=&quot;wc-enhanced-select&quot; multiple=&quot;multiple&quot; data-placeholder=&quot;&lt;?php _e( 'Any role', 'woocommerce-jos-autocoupon' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php            &nbsp;</div></li><li><div>              $coupon_customer_roles = WJECF()-&gt;get_coupon_customer_roles( $thepostid );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $available_customer_roles = array_reverse( get_editable_roles() );&nbsp;</div></li><li><div>              foreach ( $available_customer_roles as $role_id =&gt; $role ) {&nbsp;</div></li><li><div>                  $role_name = translate_user_role($role['name'] );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>                  echo '&lt;option value=&quot;' . esc_attr( $role_id ) . '&quot;'&nbsp;</div></li><li><div>                  . selected( in_array( $role_id, $coupon_customer_roles ), true, false ) . '&gt;'&nbsp;</div></li><li><div>                  . esc_html( $role_name ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;/select&gt;&nbsp;</div></li><li><div>       &lt;?php echo WJECF_WC()-&gt;wc_help_tip( __( 'Only these User Roles may use this coupon.', 'woocommerce-jos-autocoupon' ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Excluded user roles</span>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;form-field&quot;&gt;&lt;label for=&quot;wjecf_excluded_customer_roles&quot;&gt;&lt;?php _e( 'Disallowed User Roles', 'woocommerce-jos-autocoupon' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;select id=&quot;wjecf_customer_roles&quot; name=&quot;wjecf_excluded_customer_roles[]&quot; style=&quot;width: 50%;&quot;  class=&quot;wc-enhanced-select&quot; multiple=&quot;multiple&quot; data-placeholder=&quot;&lt;?php _e( 'Any role', 'woocommerce-jos-autocoupon' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php            &nbsp;</div></li><li><div>              $coupon_excluded_customer_roles = WJECF()-&gt;get_coupon_excluded_customer_roles( $thepostid );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $available_customer_roles as $role_id =&gt; $role ) {&nbsp;</div></li><li><div>                  $role_name = translate_user_role($role['name'] );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>                  echo '&lt;option value=&quot;' . esc_attr( $role_id ) . '&quot;'&nbsp;</div></li><li><div>                  . selected( in_array( $role_id, $coupon_excluded_customer_roles ), true, false ) . '&gt;'&nbsp;</div></li><li><div>                  . esc_html( $role_name ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;/select&gt;&nbsp;</div></li><li><div>       &lt;?php echo WJECF_WC()-&gt;wc_help_tip( __( 'These User Roles will be specifically excluded from using this coupon.', 'woocommerce-jos-autocoupon' ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php    &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function admin_coupon_metabox_misc( $thepostid, $post ) {&nbsp;</div></li><li><div>      echo &quot;&lt;h3&gt;&quot; . esc_html( __( 'Miscellaneous', 'woocommerce-jos-autocoupon' ) ). &quot;&lt;/h3&gt;\n&quot;;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//=============================</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//2.2.2</span></span> Allow if minimum spend not met</span>&nbsp;</div></li><li><div>      woocommerce_wp_checkbox( array(&nbsp;</div></li><li><div>          'id' =&gt; '_wjecf_allow_below_minimum_spend', &nbsp;</div></li><li><div>          'label' =&gt; __( 'Allow when minimum spend not reached', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div>          'description' =&gt; '&lt;b&gt;' . __( 'EXPERIMENTAL: ', 'woocommerce-jos-autocoupon' ) . '&lt;/b&gt;' . __( 'Check this box to allow the coupon to be in the cart even when minimum spend (see tab \'usage restriction\') is not reached. Value of the discount will be 0 until minimum spend is reached.', 'woocommerce-jos-autocoupon' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function process_shop_coupon_meta( $post_id, $post ) {&nbsp;</div></li><li><div>      $wrap_coupon = WJECF_Wrap( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wjecf_min_matching_product_qty = isset( $_POST['_wjecf_min_matching_product_qty'] ) ? $_POST['_wjecf_min_matching_product_qty'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_min_matching_product_qty', $wjecf_min_matching_product_qty );&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>      $wjecf_max_matching_product_qty = isset( $_POST['_wjecf_max_matching_product_qty'] ) ? $_POST['_wjecf_max_matching_product_qty'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_max_matching_product_qty', $wjecf_max_matching_product_qty );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//2.2.2</span></span>&nbsp;</div></li><li><div>      $wjecf_min_matching_product_subtotal = isset( $_POST['_wjecf_min_matching_product_subtotal'] ) ? $_POST['_wjecf_min_matching_product_subtotal'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_min_matching_product_subtotal', $wjecf_min_matching_product_subtotal );&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>      $wjecf_max_matching_product_subtotal = isset( $_POST['_wjecf_max_matching_product_subtotal'] ) ? $_POST['_wjecf_max_matching_product_subtotal'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_max_matching_product_subtotal', $wjecf_max_matching_product_subtotal );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wjecf_products_and = $_POST['_wjecf_products_and'] == 'yes' ? 'yes' : 'no';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_products_and', $wjecf_products_and );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//2.2.3.1</span>&nbsp;</div></li><li><div>      $wjecf_categories_and = $_POST['_wjecf_categories_and'] == 'yes' ? 'yes' : 'no';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_categories_and', $wjecf_categories_and );&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//2.2.2</span></span>&nbsp;</div></li><li><div>      $wjecf_allow_below_minimum_spend = isset( $_POST['_wjecf_allow_below_minimum_spend'] ) ? 'yes' : 'no';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_allow_below_minimum_spend', $wjecf_allow_below_minimum_spend );&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $wjecf_shipping_methods = isset( $_POST['wjecf_shipping_methods'] ) ? $_POST['wjecf_shipping_methods'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_shipping_methods', $wjecf_shipping_methods );        &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $wjecf_payment_methods = isset( $_POST['wjecf_payment_methods'] ) ? $_POST['wjecf_payment_methods'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_payment_methods', $wjecf_payment_methods );    &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $wjecf_customer_ids = $this-&gt;comma_separated_int_array( $_POST['wjecf_customer_ids'] );&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_customer_ids', $wjecf_customer_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wjecf_customer_roles = isset( $_POST['wjecf_customer_roles'] ) ? $_POST['wjecf_customer_roles'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_customer_roles', $wjecf_customer_roles );    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wjecf_excluded_customer_roles = isset( $_POST['wjecf_excluded_customer_roles'] ) ? $_POST['wjecf_excluded_customer_roles'] : '';&nbsp;</div></li><li><div>      $wrap_coupon-&gt;set_meta( '_wjecf_excluded_customer_roles', $wjecf_excluded_customer_roles );    &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $wrap_coupon-&gt;save();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * 2.3.6</span>&nbsp;</div></li><li><div><span class="comment">   * Add inline style (css) to the admin page. Must be called BEFORE admin_head !</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $css </span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_inline_style( $css ) {&nbsp;</div></li><li><div>      $this-&gt;admin_css .= $css;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * 2.3.4</span>&nbsp;</div></li><li><div><span class="comment">   * Parse an array or comma separated string; make sure they are valid ints and return as comma separated string</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|string $int_array </span>&nbsp;</div></li><li><div><span class="comment">   * @return string comma separated int array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function comma_separated_int_array( $int_array ) {&nbsp;</div></li><li><div>      <span class="comment">//Source can be a comma separated string (select2) , or an int array (chosen)</span>&nbsp;</div></li><li><div>      if ( ! is_array( $int_array) ) {&nbsp;</div></li><li><div>          $int_array = explode( ', ', $int_array );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return implode( ', ', array_filter( array_map( 'intval', $int_array ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * 2.3.6</span>&nbsp;</div></li><li><div><span class="comment">   * Renders a &lt;SELECT&gt; that has a default value. Relies on woocommerce_wp_select</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * field['default_value']:  The default value (if omitted the first option will be default)</span>&nbsp;</div></li><li><div><span class="comment">   * field['append_default_label']: If true or omitted the text '(DEFAULT)' will be appended to the default option caption</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param array $field see wc-meta-box-functions.php:woocommerce_wp_select</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function render_select_with_default( $field ) {&nbsp;</div></li><li><div>      global $thepostid, $post;&nbsp;</div></li><li><div>      $thepostid = empty( $thepostid ) ? $post-&gt;ID : $thepostid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      reset( $field['options'] ); <span class="comment">//move to first for key()</span>&nbsp;</div></li><li><div>      $default_value = isset( $field['default_value'] ) ? $field['default_value'] : key( $field['options'] );&nbsp;</div></li><li><div>      $append_default_label = isset( $field['append_default_label'] ) ? $field['append_default_label'] : true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $append_default_label ) {&nbsp;</div></li><li><div>          $field['options'][$default_value] = sprintf( __( '%s (Default)', 'woocommerce-jos-autocoupon' ), $field['options'][$default_value] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $field['value'] ) ) {&nbsp;</div></li><li><div>          $field['value'] = get_post_meta( $thepostid, $field['id'], true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( empty( $field['value'] ) ) {&nbsp;</div></li><li><div>          $field['value'] = $default_value;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      woocommerce_wp_select( $field );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function render_admin_cat_selector( $dom_id, $field_name, $selected_ids, $placeholder = null ) {&nbsp;</div></li><li><div>      if ( $placeholder === null ) $placeholder = __( 'Search for a product*', 'woocommerce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Categories</span>&nbsp;</div></li><li><div>      ?&gt;                &nbsp;</div></li><li><div>      &lt;select id=&quot;&lt;?php esc_attr_e( $dom_id ) ?&gt;&quot; name=&quot;&lt;?php esc_attr_e( $field_name ) ?&gt;[]&quot; style=&quot;width: 50%;&quot;  class=&quot;wc-enhanced-select&quot; multiple=&quot;multiple&quot; data-placeholder=&quot;&lt;?php esc_attr_e( $placeholder ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>              $categories = get_terms( 'product_cat', 'orderby=name&hide_empty=0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $categories ) foreach ( $categories as $cat ) {&nbsp;</div></li><li><div>                  echo '&lt;option value=&quot;' . esc_attr( $cat-&gt;term_id ) . '&quot;' . selected( in_array( $cat-&gt;term_id, $selected_ids ), true, false ) . '&gt;' . esc_html( $cat-&gt;name ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;/select&gt;&nbsp;</div></li><li><div>      &lt;?php    &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add donate-link to plugin page</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function wjecf_plugin_meta( $links, $file ) {&nbsp;</div></li><li><div>      if ( strpos( $file, 'woocommerce-jos-autocoupon.php' ) !== false ) {&nbsp;</div></li><li><div>          $links = array_merge( $links, array( '&lt;a href=&quot;' . WJECF_Admin::get_donate_url() . '&quot; title=&quot;Support the development&quot; target=&quot;_blank&quot;&gt;Donate&lt;/a&gt;' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $links;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public static function get_donate_url() {&nbsp;</div></li><li><div>      return &quot;https:<span class="comment">//www.paypal.com/cgi-bin/webscr?cmd=_donations&business=5T9XQBCS2QHRY&lc=NL&item_name=Jos%20Koenis&item_number=wordpress%2dplugin&currency_code=EUR&bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted&quot;;</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>WooCommerce Extended Coupon Features</li><li><span></span>2.4.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>