<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="3.2.3" data-slug="gravity-forms-data-persistence-add-on-reloaded" data-type="file" data-id="32472"><head xmlns="http://www.w3.org/1999/xhtml"><title> persistent-multipage-forms-reloaded | file | Gravity Forms Data Persistence Add On Reloaded | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, gravity-forms-data-persistence-add-on-reloaded, 3.2.3" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=746c91236f6d402355b55a6a6d59a6af' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/persistent-multipage-forms-reloaded/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fpersistent-multipage-forms-reloaded%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fpersistent-multipage-forms-reloaded%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-gravity-forms-data-persistence-add-on-reloaded-3.2.3-file-persistent-multipage-forms-reloaded","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="persistent-multipage-forms-reloaded" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to gravity-forms-data-persistenc&hellip;." href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/" class="plugin"><span property="name">gravity-forms-data-persistenc&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.2.3." href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/" class="H_VERSION"><span property="name">3.2.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">persistent-multipage-forms-re&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="20"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/all/" title="All">All <span class="count badge">20</span></a></li><li class="" data-id="new" data-count="1"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/new/" title="New">New <span class="count badge">1</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="" data-id="class" data-count="0"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="1"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/constants/" title="Constants">Constants <span class="count badge">1</span></a></li><li class="" data-id="function" data-count="19"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/functions/" title="Functions">Functions <span class="count badge">19</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/gravity-forms-data-persistence-add-on-reloaded/3.2.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/persistent_multipage_forms-reloaded.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">Plugin Name: Gravity Forms Data Persistence Add-On Reloaded</span>&nbsp;</div></li><li><div><span class="comment">Plugin URI: http://asthait.com</span>&nbsp;</div></li><li><div><span class="comment">Description: This is a &lt;a href=&quot;http://www.gravityforms.com/&quot; target=&quot;_blank&quot;&gt;Gravity Form&lt;/a&gt; plugin. A big limitation with Gravity Form is, in case of big multipage forms, if you close or refresh the page during somewhere midle of some step. all the steps data will loose. this plugin solves that problem. This is an updated version of asthait's plugin.</span>&nbsp;</div></li><li><div><span class="comment">Author: Robert Iseley</span>&nbsp;</div></li><li><div><span class="comment">Version: 3.2.3</span>&nbsp;</div></li><li><div><span class="comment">Author URI: http://www.robertiseley.com</span>&nbsp;</div></li><li><div><span class="comment">Orginal Plugin by: asthait</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>define('GFDPVERSION', '3.2.3');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action('wp_head', 'ri_gfdp_version_head');&nbsp;</div></li><li><div>function ri_gfdp_version_head() {&nbsp;</div></li><li><div>  echo '&lt;!-- Gravity Forms Data Persistence Add-On Reloaded Version '.GFDPVERSION.' --&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Register garlic script for local persistence</span>&nbsp;</div></li><li><div>add_action('wp_enqueue_scripts', 'ri_gfdp_script_register');&nbsp;</div></li><li><div>function ri_gfdp_script_register() {&nbsp;</div></li><li><div>  wp_enqueue_script('jquery');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Render persistence data before form output</span>&nbsp;</div></li><li><div>add_filter(&quot;gform_pre_render&quot;, &quot;ri_pre_populate_the_form&quot;);&nbsp;</div></li><li><div>function ri_pre_populate_the_form($form) {&nbsp;</div></li><li><div>  if (gfdp_is_persistent($form)) {&nbsp;</div></li><li><div>      $current_page = GFFormDisplay::get_current_page($form[&quot;id&quot;]);&nbsp;</div></li><li><div>      if ($current_page == 1) {&nbsp;</div></li><li><div>          $option_key = ri_getFormOptionKeyForGF($form);&nbsp;</div></li><li><div>          if (get_option($option_key)) {&nbsp;</div></li><li><div>              $_POST = json_decode(get_option($option_key), true);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }    &nbsp;</div></li><li><div>  return $form;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Updating data via ajax auto save</span>&nbsp;</div></li><li><div>add_action( 'wp_ajax_gfdp_save', 'ri_gfdp_ajax' );&nbsp;</div></li><li><div>function ri_gfdp_ajax() {&nbsp;</div></li><li><div>  global $wpdb; <span class="comment">// this is how you get access to the database</span>&nbsp;</div></li><li><div>  parse_str($_POST['form'], $data);&nbsp;</div></li><li><div>  $form_id = isset($data['gform_submit']) ? $data[&quot;gform_submit&quot;] : 0;&nbsp;</div></li><li><div>      if($form_id) {&nbsp;</div></li><li><div>          $form_info = RGFormsModel::get_form($form_id);&nbsp;</div></li><li><div>          $is_valid_form = $form_info && $form_info-&gt;is_active;&nbsp;</div></li><li><div>          if($is_valid_form) {&nbsp;</div></li><li><div>              $form = RGFormsModel::get_form_meta($form_id);&nbsp;</div></li><li><div>              $form = RGFormsModel::add_default_properties($form);&nbsp;</div></li><li><div>              ri_gfdp_ajax_save($form);&nbsp;</div></li><li><div>              echo &quot;Saved&quot;;    &nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              echo &quot;Invalid Form&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          echo &quot;Invalid Form&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  die(); <span class="comment">// this is required to terminate immediately and return a proper response</span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//The js for ajax call</span>&nbsp;</div></li><li><div>add_action('gform_enqueue_scripts', 'ri_gfdp_js_enqueue', 90, 2);&nbsp;</div></li><li><div>function ri_gfdp_js_enqueue($form, $is_ajax) {&nbsp;</div></li><li><div>  if($form['ri_gfdp_persist'] == 'ajax' && is_user_logged_in()) {&nbsp;</div></li><li><div>      add_action('wp_footer', 'ri_gfdp_js');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>function ri_gfdp_js() { &nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/javascript&quot; &gt;&nbsp;</div></li><li><div>      var changed = false;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      function gfdp_events() {&nbsp;</div></li><li><div>          jQuery('form').on('change keyup', function() {&nbsp;</div></li><li><div>                  changed = true;&nbsp;</div></li><li><div>              })&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      jQuery(document).ready(gfdp_events);&nbsp;</div></li><li><div>      jQuery(document).ajaxComplete(gfdp_events);&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      function gfdp_ajax($) {&nbsp;</div></li><li><div>          if(changed == true) {&nbsp;</div></li><li><div>              var data = {&nbsp;</div></li><li><div>                  'action': 'gfdp_save', &nbsp;</div></li><li><div>                  'form': jQuery('form').serialize()&nbsp;</div></li><li><div>              };&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>              jQuery.ajax({&nbsp;</div></li><li><div>                  url: '&lt;?php echo admin_url('admin-ajax.php'); ?&gt;', &nbsp;</div></li><li><div>                  type: 'POST', &nbsp;</div></li><li><div>                  data: data, &nbsp;</div></li><li><div>                  success: function(response) {&nbsp;</div></li><li><div>                      changed = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              })&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      };&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      jQuery(document).ready( setInterval(gfdp_ajax, 10000));&nbsp;</div></li><li><div>      &lt;/script&gt; &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Saving data from ajax call</span>&nbsp;</div></li><li><div>function ri_gfdp_ajax_save($form, $coming_from_page, $current_page) {&nbsp;</div></li><li><div>  if ($form['ri_gfdp_persist'] == 'ajax') {&nbsp;</div></li><li><div>      if (is_user_logged_in()) {&nbsp;</div></li><li><div>          $option_key = ri_getFormOptionKeyForGF($form);&nbsp;</div></li><li><div>          parse_str($_POST['form'], $data);&nbsp;</div></li><li><div>          $data = ri_gfdp_sanitize_data($data, $form);&nbsp;</div></li><li><div>          update_option($option_key, json_encode($data));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function ri_gfdp_sanitize_data($data, $form) {&nbsp;</div></li><li><div>  foreach    ($form['fields'] as $field) {&nbsp;</div></li><li><div>      if($field['ri_gfdp_no_persist']) {&nbsp;</div></li><li><div>          if(is_array($field['inputs'])) {&nbsp;</div></li><li><div>              foreach($field['inputs'] as $input) {&nbsp;</div></li><li><div>                  $data['input_'.str_replace('.', '_', $input['id'])] = '';    &nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else &nbsp;</div></li><li><div>          $data['input_'.$field['id']] = '';    &nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $data;    &nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Updating persistence data on page change</span>&nbsp;</div></li><li><div>add_action(&quot;gform_post_paging&quot;, &quot;ri_page_changed&quot;, 10, 3);&nbsp;</div></li><li><div>function ri_page_changed($form, $coming_from_page, $current_page) {&nbsp;</div></li><li><div>  if (gfdp_is_persistent($form)) {&nbsp;</div></li><li><div>      if (is_user_logged_in()) {&nbsp;</div></li><li><div>          $option_key = ri_getFormOptionKeyForGF($form);&nbsp;</div></li><li><div>          $data = ri_gfdp_sanitize_data($_POST, $form);&nbsp;</div></li><li><div>          update_option($option_key, json_encode($data));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Updating or clearning persistence data on form submission</span>&nbsp;</div></li><li><div>add_action(&quot;gform_post_submission&quot;, &quot;ri_set_post_content&quot;, 10, 2);&nbsp;</div></li><li><div>function ri_set_post_content($entry, $form) {&nbsp;</div></li><li><div>  if (gfdp_is_persistent($form)) {&nbsp;</div></li><li><div>      <span class="comment">//Update form data in wp_options table</span>&nbsp;</div></li><li><div>      if (is_user_logged_in()) {&nbsp;</div></li><li><div>          $option_key = ri_getFormOptionKeyForGF($form);&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          if($form['isEnablePersistentClear'] || $form['ri_gfdp_persist_clear']) &nbsp;</div></li><li><div>              delete_option($option_key);&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $data = ri_gfdp_sanitize_data($_POST, $form);&nbsp;</div></li><li><div>              update_option($option_key, json_encode($data));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $entry_option_key = ri_getEntryOptionKeyForGF($form);&nbsp;</div></li><li><div>          if (get_option($entry_option_key)) {&nbsp;</div></li><li><div>              <span class="comment">//Delete old entry from GF tables</span>&nbsp;</div></li><li><div>              if(isset($form['ri_gfdp_persist'])) {&nbsp;</div></li><li><div>                  &nbsp;</div></li><li><div>                  if (!$form['ri_gfdp_multiple_entries']) {&nbsp;</div></li><li><div>                     RGFormsModel::delete_lead(get_option($entry_option_key));&nbsp;</div></li><li><div>                  }  &nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if(!$form['isEnableMulipleEntry']) {&nbsp;</div></li><li><div>                     RGFormsModel::delete_lead(get_option($entry_option_key));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Update entry in wp_options table</span>&nbsp;</div></li><li><div>      update_option($entry_option_key, $entry['id']);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Create and return option table key for a form and user</span>&nbsp;</div></li><li><div>function ri_getFormOptionKeyForGF($form) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $current_user;&nbsp;</div></li><li><div>  get_currentuserinfo();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option_key = $current_user-&gt;user_login . '_GF_' . $form['id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $option_key;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Create and return option table key for user form entry</span>&nbsp;</div></li><li><div>function ri_getEntryOptionKeyForGF($form) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $current_user;&nbsp;</div></li><li><div>  get_currentuserinfo();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option_key = $current_user-&gt;user_login . '_GF_' . $form['id'] . '_entry';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $option_key;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//Add persistent settings to the form settings</span>&nbsp;</div></li><li><div>add_filter(&quot;gform_form_settings&quot;, &quot;ri_persistency_settings&quot;, 50, 2);&nbsp;</div></li><li><div>function ri_persistency_settings($form_settings, $form) {&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// create settings on position 50 (right after Admin Label)</span>&nbsp;</div></li><li><div>  $tr_persistent = '&nbsp;</div></li><li><div>      &lt;tr&gt;&nbsp;</div></li><li><div>          &lt;td colspan=&quot;2&quot;&gt;&lt;h4 class=&quot;gf_settings_subgroup_title&quot;&gt;Persistence&lt;/h4&gt;&lt;/td&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;tr&gt;&nbsp;</div></li><li><div>          &lt;th&gt;Persistence '. gform_tooltip('ri_gfdp_persist', '', true) .' &lt;/th&gt;&nbsp;</div></li><li><div>          &lt;td&gt;&nbsp;</div></li><li><div>              &lt;select name=&quot;ri_gfdp_persist&quot; id=&quot;ri_gfdp_persist&quot;&gt;&nbsp;</div></li><li><div>                  &lt;option value=&quot;off&quot; '.selected(rgar($form, &quot;ri_gfdp_persist&quot;), 'off', false).'&gt;Off&lt;/option&gt;&nbsp;</div></li><li><div>                  &lt;option value=&quot;submit_only&quot; '.selected(rgar($form, &quot;ri_gfdp_persist&quot;), 'submit_only', false).'&gt;Save data on page change/submit only&lt;/option&gt;&nbsp;</div></li><li><div>                  &lt;option value=&quot;ajax&quot; '.selected(rgar($form, &quot;ri_gfdp_persist&quot;), 'ajax', false).'&gt;Save data with ajax&lt;/option&gt;&nbsp;</div></li><li><div>              &lt;/select&gt;&nbsp;</div></li><li><div>          &lt;/td&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;';&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  $tr_persistent .= '&nbsp;</div></li><li><div>      &lt;tr&gt;&nbsp;</div></li><li><div>          &lt;th&gt;Multiple Entries '. gform_tooltip(&quot;ri_gfdp_multiple_entries&quot;, '', true) .' &lt;/th&gt;&nbsp;</div></li><li><div>          &lt;td&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;checkbox&quot; name=&quot;ri_gfdp_multiple_entries&quot; id=&quot;ri_gfdp_multiple_entries&quot; '.checked(rgar($form, &quot;ri_gfdp_multiple_entries&quot;), '1', false).'&quot; value=&quot;1&quot; /&gt; &nbsp;</div></li><li><div>          &lt;label for=&quot;ri_gfdp_multiple_entries&quot;&gt;Allow multiple entries&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/td&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;';&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  $tr_persistent .= '&nbsp;</div></li><li><div>      &lt;tr&gt;&nbsp;</div></li><li><div>          &lt;th&gt;Clear Persistence '. gform_tooltip(&quot;ri_gfdp_clear_persist&quot;, '', true) .' &lt;/th&gt;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          &lt;td&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;checkbox&quot; name=&quot;ri_gfdp_persist_clear&quot; id=&quot;ri_gfdp_persist_clear&quot; '.checked(rgar($form, &quot;ri_gfdp_persist_clear&quot;), '1', false).'&quot; value=&quot;1&quot; /&gt; &nbsp;</div></li><li><div>          &lt;label for=&quot;ri_gfdp_persist_clear&quot;&gt; Clear persistence on submit&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/td&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;';&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $form_settings[&quot;Form Options&quot;]['persistent'] = $tr_persistent;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      return $form_settings;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_filter('gform_pre_form_settings_save', 'ri_gfdp_save_form_settings');&nbsp;</div></li><li><div>function ri_gfdp_save_form_settings($form) {&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">//Remove old setting names</span>&nbsp;</div></li><li><div>  unset($form['isPersistent']);&nbsp;</div></li><li><div>  unset($form['isEnableMulipleEntry']);&nbsp;</div></li><li><div>  unset($form['isEnablePersistentClear']);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">//update settings</span>&nbsp;</div></li><li><div>  $form['ri_gfdp_persist'] = rgpost('ri_gfdp_persist');&nbsp;</div></li><li><div>  $form['ri_gfdp_multiple_entries'] = rgpost('ri_gfdp_multiple_entries');&nbsp;</div></li><li><div>  $form['ri_gfdp_persist_clear'] = rgpost('ri_gfdp_persist_clear');&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $form;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>};&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Action to inject supporting script to the form editor page</span>&nbsp;</div></li><li><div>add_action(&quot;gform_advanced_settings&quot;, &quot;ri_editor_script_persistency&quot;);&nbsp;</div></li><li><div>function ri_editor_script_persistency() {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;script type='text/javascript'&gt;&nbsp;</div></li><li><div>      if(typeof form != 'undefined') {&nbsp;</div></li><li><div>          if(typeof form.isPersistent != 'undefined') {&nbsp;</div></li><li><div>              jQuery(&quot;#ri_gfdp_persist&quot;).val('submit_only'); &nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if(typeof form.isEnableMulipleEntry != 'undefined') {&nbsp;</div></li><li><div>              jQuery(&quot;#ri_gfdp_multiple_entries&quot;).attr(&quot;checked&quot;, form.isEnableMulipleEntry); &nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if(typeof form.isEnablePersistentClear != 'undefined') {&nbsp;</div></li><li><div>              jQuery(&quot;#ri_gfdp_persist_clear&quot;).attr(&quot;checked&quot;, form.isEnablePersistentClear);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php &nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action('gform_field_advanced_settings', 'ri_gfdp_advanced_settings', 10, 2);&nbsp;</div></li><li><div>function ri_gfdp_advanced_settings($position, $form_id) {&nbsp;</div></li><li><div>  if($position == 550) {&nbsp;</div></li><li><div>  ?&gt;    &nbsp;</div></li><li><div>      &lt;li class=&quot;field_ri_gfdp_no_persist_setting&quot;&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;checkbox&quot; id=&quot;ri_gfdp_no_persist&quot; name=&quot;ri_gfdp_no_persist&quot; onclick=&quot;SetFieldProperty('ri_gfdp_no_persist', this.checked);&quot; /&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;ri_gfdp_no_persist&quot; class=&quot;inline&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e('Do not allow persistence', 'ri_gfdp'); ?&gt;&nbsp;</div></li><li><div>              &lt;?php gform_tooltip('ri_gfdp_no_persist'); ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;  &nbsp;</div></li><li><div>      &lt;/li&gt;&nbsp;</div></li><li><div>  &lt;?php    &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//Action to inject supporting script to the form editor page</span>&nbsp;</div></li><li><div>add_action(&quot;gform_editor_js&quot;, &quot;ri_gfdp_editor_script&quot;, 11);&nbsp;</div></li><li><div>function ri_gfdp_editor_script() {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;script type='text/javascript'&gt;&nbsp;</div></li><li><div>      <span class="comment">//adding setting to fields of type &quot;text&quot;</span>&nbsp;</div></li><li><div>      <span class="comment">//fieldSettings[&quot;text&quot;] += &quot;, .field_ri_gfdp_no_persist_setting&quot;;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//binding to the load field settings event to initialize the checkbox</span>&nbsp;</div></li><li><div>      jQuery(document).bind(&quot;gform_load_field_settings&quot;, function(event, field, form) {&nbsp;</div></li><li><div>          jQuery(&quot;#ri_gfdp_no_persist&quot;).attr(&quot;checked&quot;, field[&quot;ri_gfdp_no_persist&quot;] == true);&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Filter to add a new tooltip</span>&nbsp;</div></li><li><div>add_filter('gform_tooltips', 'ri_add_persistency_tooltips');&nbsp;</div></li><li><div>function ri_add_persistency_tooltips($tooltips) {&nbsp;</div></li><li><div>  $tooltips[&quot;ri_gfdp_persist&quot;] = &quot;&lt;h6&gt;Persistency&lt;/h6&gt;Select to save users progress with form so they may continue at another time. Must be a logged in user.&quot;;&nbsp;</div></li><li><div>  $tooltips[&quot;ri_gfdp_multiple_entries&quot;] = &quot;&lt;h6&gt;Multiple Entries Allowed&lt;/h6&gt;This will allow multiple entry from same user. User can not edit their last and the previous entry not removed from the entry list&quot;;&nbsp;</div></li><li><div>  $tooltips['ri_gfdp_no_persist'] = '&lt;h6&gt;No Persist&lt;/h6&gt;Checking this will removed this field(s) from the persistence data. User will have to re-enter information upon returning to the form. This does not affect the submission of an entry. Useful for sensitive information.';&nbsp;</div></li><li><div>  $tooltips['ri_gfdp_clear_persist'] = '&lt;h6&gt;Clear Persist&lt;/h6&gt;This option will delete the persistence data when a form is submitted. Allow the user to return to a fresh blank form.';&nbsp;</div></li><li><div>  return $tooltips;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function gfdp_is_persistent($form) {&nbsp;</div></li><li><div>  if(isset($form['ri_gfdp_persist'])) {&nbsp;</div></li><li><div>      if($form['ri_gfdp_persist'] == 'off' || empty($form['ri_gfdp_persist'])) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if(isset($form['isPersistent']) && !empty($form['isPersistent'])) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Gravity Forms Data Persistence Add-On Reloaded</li><li><span></span>3.3.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>