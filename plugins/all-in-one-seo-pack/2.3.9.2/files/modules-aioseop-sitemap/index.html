<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.3.9.2" data-slug="all-in-one-seo-pack" data-type="file" data-id="63521"><head xmlns="http://www.w3.org/1999/xhtml"><title> modules-aioseop-sitemap | file | All In One Seo Pack | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, all-in-one-seo-pack, 2.3.9.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=90b3a5a6248108b778d8fd8a059f287f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/modules-aioseop-sitemap/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fmodules-aioseop-sitemap%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fmodules-aioseop-sitemap%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-all-in-one-seo-pack-2.3.9.2-file-modules-aioseop-sitemap","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="modules-aioseop-sitemap" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to all-in-one-seo-pack." href="http://hookr.io/plugins/all-in-one-seo-pack/" class="plugin"><span property="name">all-in-one-seo-pack</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.3.9.2." href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/" class="H_VERSION"><span property="name">2.3.9.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">modules-aioseop-sitemap</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="218"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/all/" title="All">All <span class="count badge">218</span></a></li><li class="" data-id="new" data-count="6"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/new/" title="New">New <span class="count badge">6</span></a></li><li class="" data-id="hooks" data-count="108"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/hooks/" title="Hooks">Hooks <span class="count badge">108</span></a></li><li class="" data-id="action" data-count="19"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/actions/" title="Actions">Actions <span class="count badge">19</span></a></li><li class="" data-id="filter" data-count="89"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/filters/" title="Filters">Filters <span class="count badge">89</span></a></li><li class="" data-id="class" data-count="33"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/classes/" title="Classes">Classes <span class="count badge">33</span></a></li><li class="" data-id="constant" data-count="15"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/constants/" title="Constants">Constants <span class="count badge">15</span></a></li><li class="" data-id="function" data-count="62"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/functions/" title="Functions">Functions <span class="count badge">62</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/modules/aioseop_sitemap.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sitemap class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package All-in-One-SEO-Pack</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'All_in_One_SEO_Pack_Sitemap' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Class All_in_One_SEO_Pack_Sitemap</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  class All_in_One_SEO_Pack_Sitemap extends All_in_One_SEO_Pack_Module {&nbsp;</div></li><li><div>      var $cache_struct = null;&nbsp;</div></li><li><div>      var $cache_home = null;&nbsp;</div></li><li><div>      var $comment_string;&nbsp;</div></li><li><div>      var $start_memory_usage = 0;&nbsp;</div></li><li><div>      var $max_posts = 50000;&nbsp;</div></li><li><div>      var $paginate = false;&nbsp;</div></li><li><div>      var $prio;&nbsp;</div></li><li><div>      var $prio_sel;&nbsp;</div></li><li><div>      var $freq;&nbsp;</div></li><li><div>      var $freq_sel;&nbsp;</div></li><li><div>      var $extra_sitemaps;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * All_in_One_SEO_Pack_Sitemap constructor.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function __construct() {&nbsp;</div></li><li><div>          if ( get_class( $this ) === 'All_in_One_SEO_Pack_Sitemap' ) { <span class="comment">// Set this up only when instantiated as this class.</span>&nbsp;</div></li><li><div>              $this-&gt;name = __( 'XML Sitemap', 'all-in-one-seo-pack' ); <span class="comment">// Human-readable name of the plugin.</span>&nbsp;</div></li><li><div>              $this-&gt;prefix = 'aiosp_sitemap_';                          <span class="comment">// Option prefix.</span>&nbsp;</div></li><li><div>              $this-&gt;file = __FILE__;                                      <span class="comment">// The current file.</span>&nbsp;</div></li><li><div>              $this-&gt;extra_sitemaps = array();&nbsp;</div></li><li><div>              $this-&gt;extra_sitemaps = apply_filters( $this-&gt;prefix . 'extra', $this-&gt;extra_sitemaps );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          parent::__construct();&nbsp;</div></li><li><div>          $this-&gt;comment_string = 'Sitemap %s generated by All in One SEO Pack %s by Michael Torbert of Semper Fi Web Design on %s';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;help_text = array(&nbsp;</div></li><li><div>              'filename' =&gt; __( &quot;Specifies the name of your sitemap file. This will default to 'sitemap'.&quot;, 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'google' =&gt; __( 'Notify Google when you update your sitemap settings.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'bing' =&gt; __( 'Notify Bing when you update your sitemap settings.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'daily_cron' =&gt; __( 'Notify search engines based on the selected schedule, and also update static sitemap daily if in use. (this uses WP-Cron, so make sure this is working properly on your server as well)', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'indexes' =&gt; __( 'Organize sitemap entries into distinct files in your sitemap. Enable this only if your sitemap contains over 50, 000 URLs or the file is over 5MB in size.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'paginate' =&gt; __( 'Split long sitemaps into separate files.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'max_posts' =&gt; __( 'Allows you to specify the maximum number of posts in a sitemap (up to 50, 000).', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'posttypes' =&gt; __( 'Select which Post Types appear in your sitemap.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'taxonomies' =&gt; __( 'Select which taxonomy archives appear in your sitemap', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'archive' =&gt; __( 'Include Date Archives in your sitemap.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'author' =&gt; __( 'Include Author Archives in your sitemap.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'gzipped' =&gt; __( 'Create a compressed sitemap file in .xml.gz format.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'robots' =&gt; __( 'Places a link to your Sitemap.xml into your virtual Robots.txt file.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'rewrite' =&gt; __( 'Dynamically creates the XML sitemap instead of using a static file.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'debug' =&gt; __( 'Use rewrites to generate your sitemap on the fly. NOTE: This is required for WordPress Multisite.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'addl_url' =&gt; __( 'URL to the page.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'addl_prio' =&gt; __( 'The priority of the page.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'addl_freq' =&gt; __( 'The frequency of the page.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'addl_mod' =&gt; __( 'Last modified date of the page.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'excl_categories' =&gt; __( 'Entries from these categories will be excluded from the sitemap.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'excl_pages' =&gt; __( 'Use page slugs or page IDs, seperated by commas, to exclude pages from the sitemap.', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;help_anchors = array(&nbsp;</div></li><li><div>              'filename' =&gt; '#filename-prefix', &nbsp;</div></li><li><div>              'google' =&gt; '#notify-google-bing', &nbsp;</div></li><li><div>              'bing' =&gt; '#notify-google-bing', &nbsp;</div></li><li><div>              'daily_cron' =&gt; '#schedule-updates', &nbsp;</div></li><li><div>              'indexes' =&gt; '#enable-sitemap-indexes', &nbsp;</div></li><li><div>              'paginate' =&gt; '#enable-sitemap-indexes', &nbsp;</div></li><li><div>              'max_posts' =&gt; '#enable-sitemap-indexes', &nbsp;</div></li><li><div>              'posttypes' =&gt; '#post-types-and-taxonomies', &nbsp;</div></li><li><div>              'taxonomies' =&gt; '#post-types-and-taxonomies', &nbsp;</div></li><li><div>              'archive' =&gt; '#include-archive-pages', &nbsp;</div></li><li><div>              'author' =&gt; '#include-archive-pages', &nbsp;</div></li><li><div>              'gzipped' =&gt; '#create-compressed-sitemap', &nbsp;</div></li><li><div>              'robots' =&gt; '#link-from-virtual-robots', &nbsp;</div></li><li><div>              'rewrite' =&gt; '#dynamically-generate-sitemap', &nbsp;</div></li><li><div>              'addl_url' =&gt; '#additional-pages', &nbsp;</div></li><li><div>              'addl_prio' =&gt; '#additional-pages', &nbsp;</div></li><li><div>              'addl_freq' =&gt; '#additional-pages', &nbsp;</div></li><li><div>              'addl_mod' =&gt; '#additional-pages', &nbsp;</div></li><li><div>              'excl_categories' =&gt; '#excluded-items', &nbsp;</div></li><li><div>              'excl_pages' =&gt; '#excluded-items', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;default_options = array(&nbsp;</div></li><li><div>              'filename' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Filename Prefix', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'default' =&gt; 'sitemap', &nbsp;</div></li><li><div>                  'type' =&gt; 'text', &nbsp;</div></li><li><div>                  'sanitize' =&gt; 'filename', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'google' =&gt; array( 'name' =&gt; __( 'Notify Google', 'all-in-one-seo-pack' ) ), &nbsp;</div></li><li><div>              'bing' =&gt; array( 'name' =&gt; __( 'Notify Bing', 'all-in-one-seo-pack' ) ), &nbsp;</div></li><li><div>              'daily_cron' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Schedule Updates', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'select', &nbsp;</div></li><li><div>                  'initial_options' =&gt; array(&nbsp;</div></li><li><div>                      0 =&gt; __( 'No Schedule', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                      'daily' =&gt; __( 'Daily', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                      'weekly' =&gt; __( 'Weekly', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                      'monthly' =&gt; __( 'Monthly', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  'default' =&gt; 0, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'indexes' =&gt; array( 'name' =&gt; __( 'Enable Sitemap Indexes', 'all-in-one-seo-pack' ) ), &nbsp;</div></li><li><div>              'paginate' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Paginate Sitemap Indexes', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'condshow' =&gt; array( &quot;{$this-&gt;prefix}indexes&quot; =&gt; 'on' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'max_posts' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Maximum Posts Per Sitemap', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'text', &nbsp;</div></li><li><div>                  'default' =&gt; 50000, &nbsp;</div></li><li><div>                  'condshow' =&gt; array( &quot;{$this-&gt;prefix}indexes&quot; =&gt; 'on', &quot;{$this-&gt;prefix}paginate&quot; =&gt; 'on' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'posttypes' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Post Types', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'multicheckbox', &nbsp;</div></li><li><div>                  'default' =&gt; 'all', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'taxonomies' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Taxonomies', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'multicheckbox', &nbsp;</div></li><li><div>                  'default' =&gt; 'all', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'archive' =&gt; array( 'name' =&gt; __( 'Include Date Archive Pages', 'all-in-one-seo-pack' ) ), &nbsp;</div></li><li><div>              'author' =&gt; array( 'name' =&gt; __( 'Include Author Pages', 'all-in-one-seo-pack' ) ), &nbsp;</div></li><li><div>              'gzipped' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Create Compressed Sitemap', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'default' =&gt; 'On', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'robots' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Link From Virtual Robots.txt', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'default' =&gt; 'On', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'rewrite' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Dynamically Generate Sitemap', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'default' =&gt; 'On', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $status_options = array(&nbsp;</div></li><li><div>              'link' =&gt; array( 'default' =&gt; '', 'type' =&gt; 'html', 'label' =&gt; 'none', 'save' =&gt; false ), &nbsp;</div></li><li><div>              'debug' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Debug Log', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'default' =&gt; '', &nbsp;</div></li><li><div>                  'type' =&gt; 'html', &nbsp;</div></li><li><div>                  'disabled' =&gt; 'disabled', &nbsp;</div></li><li><div>                  'save' =&gt; false, &nbsp;</div></li><li><div>                  'label' =&gt; 'none', &nbsp;</div></li><li><div>                  'rows' =&gt; 5, &nbsp;</div></li><li><div>                  'cols' =&gt; 120, &nbsp;</div></li><li><div>                  'style' =&gt; 'min-width:950px', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;layout = array(&nbsp;</div></li><li><div>              'status' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Sitemap Status', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'help_link' =&gt; 'http:<span class="comment"><span class="comment">//semperplugins.com/documentation/xml-sitemaps-module/', </span></span>&nbsp;</div></li><li><div>                  'options' =&gt; array_keys( $status_options ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'default' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; $this-&gt;name, &nbsp;</div></li><li><div>                  'help_link' =&gt; 'http:<span class="comment"><span class="comment">//semperplugins.com/documentation/xml-sitemaps-module/', </span></span>&nbsp;</div></li><li><div>                  'options' =&gt; array_keys( $this-&gt;default_options ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $prio = array();&nbsp;</div></li><li><div>          for ( $i = 0; $i &lt;= 10; $i ++ ) {&nbsp;</div></li><li><div>              $str = sprintf( '%0.1f', $i / 10.0 );&nbsp;</div></li><li><div>              $prio[ $str ] = $str;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $arr_no = array( 'no' =&gt; __( 'Do Not Override', 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>          $arr_sel = array( 'sel' =&gt; __( 'Select Individual', 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>          $this-&gt;prio_sel = array_merge( $arr_no, $arr_sel, $prio );&nbsp;</div></li><li><div>          $this-&gt;prio = array_merge( $arr_no, $prio );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $freq = array();&nbsp;</div></li><li><div>          foreach ( array( 'always', 'hourly', 'daily', 'weekly', 'monthly', 'yearly', 'never' ) as $f ) {&nbsp;</div></li><li><div>              $freq[ $f ] = $f;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;freq_sel = array_merge( $arr_no, $arr_sel, $freq );&nbsp;</div></li><li><div>          $this-&gt;freq = array_merge( $arr_no, $freq );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach (&nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'prio' =&gt; __( 'priority', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'freq' =&gt; __( 'frequency', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div> ) as $k =&gt; $v&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>              $s = &quot;{$k}_options&quot;;&nbsp;</div></li><li><div>              $$s = array();&nbsp;</div></li><li><div>              foreach (&nbsp;</div></li><li><div>                  array(&nbsp;</div></li><li><div>                      'homepage' =&gt; __( 'homepage', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                      'post' =&gt; __( 'posts', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                      'taxonomies' =&gt; __( 'taxonomies', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                      'archive' =&gt; __( 'archive pages', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                      'author' =&gt; __( 'author pages', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div> ) as $opt =&gt; $val&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                  $arr = $$s;&nbsp;</div></li><li><div>                  if ( ( 'post' === $opt ) || ( 'taxonomies' === $opt ) ) {&nbsp;</div></li><li><div>                      $iopts = $this-&gt;{&quot;{$k}_sel&quot;};&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $iopts = $this-&gt;$k;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $arr[ $k . '_' . $opt ] = array(&nbsp;</div></li><li><div>                      'name' =&gt; $this-&gt;ucwords( $val ), &nbsp;</div></li><li><div>                      'help_text' =&gt; sprintf( __( 'Manually set the %s of your %s.', 'all-in-one-seo-pack' ), $v, $val ), &nbsp;</div></li><li><div>                      'type' =&gt; 'select', &nbsp;</div></li><li><div>                      'initial_options' =&gt; $iopts, &nbsp;</div></li><li><div>                      'default' =&gt; 'no', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  if ( ( 'archive' === $opt ) || ( 'author' === $opt ) ) {&nbsp;</div></li><li><div>                      $arr[ $k . '_' . $opt ]['condshow'] = array( $this-&gt;prefix . $opt =&gt; 'on' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $$s = $arr;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $addl_options = array(&nbsp;</div></li><li><div>              'addl_instructions' =&gt; array(&nbsp;</div></li><li><div>                  'default' =&gt; '&lt;div&gt;' . __( 'Enter information below for any additional links for your sitemap not already managed through WordPress.', 'all-in-one-seo-pack' ) . '&lt;/div&gt;&lt;br /&gt;', &nbsp;</div></li><li><div>                  'type' =&gt; 'html', &nbsp;</div></li><li><div>                  'label' =&gt; 'none', &nbsp;</div></li><li><div>                  'save' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'addl_url' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Page URL', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'text', &nbsp;</div></li><li><div>                  'label' =&gt; 'top', &nbsp;</div></li><li><div>                  'save' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'addl_prio' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Page Priority', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'select', &nbsp;</div></li><li><div>                  'initial_options' =&gt; $prio, &nbsp;</div></li><li><div>                  'label' =&gt; 'top', &nbsp;</div></li><li><div>                  'save' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'addl_freq' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Page Frequency', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'select', &nbsp;</div></li><li><div>                  'initial_options' =&gt; $freq, &nbsp;</div></li><li><div>                  'label' =&gt; 'top', &nbsp;</div></li><li><div>                  'save' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'addl_mod' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Last Modified', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'text', &nbsp;</div></li><li><div>                  'label' =&gt; 'top', &nbsp;</div></li><li><div>                  'save' =&gt; false, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'addl_pages' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Additional Pages', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'custom', &nbsp;</div></li><li><div>                  'save' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'Submit' =&gt; array(&nbsp;</div></li><li><div>                  'type' =&gt; 'submit', &nbsp;</div></li><li><div>                  'class' =&gt; 'button-primary', &nbsp;</div></li><li><div>                  'name' =&gt; __( 'Add URL', 'all-in-one-seo-pack' ) . ' &raquo;', &nbsp;</div></li><li><div>                  'style' =&gt; 'margin-left: 20px;', &nbsp;</div></li><li><div>                  'label' =&gt; 'none', &nbsp;</div></li><li><div>                  'save' =&gt; false, &nbsp;</div></li><li><div>                  'value' =&gt; 1, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $excl_options = array(&nbsp;</div></li><li><div>              'excl_categories' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; __( 'Excluded Categories', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'multicheckbox', &nbsp;</div></li><li><div>                  'initial_options' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'excl_pages' =&gt; array( 'name' =&gt; __( 'Excluded Pages', 'all-in-one-seo-pack' ), 'type' =&gt; 'text' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;layout['addl_pages'] = array(&nbsp;</div></li><li><div>              'name' =&gt; __( 'Additional Pages', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'help_link' =&gt; 'http:<span class="comment">//semperplugins.com/documentation/xml-sitemaps-module/#additional-pages', </span>&nbsp;</div></li><li><div>              'options' =&gt; array_keys( $addl_options ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;layout['excl_pages'] = array(&nbsp;</div></li><li><div>              'name' =&gt; __( 'Excluded Items', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'help_link' =&gt; 'http:<span class="comment">//semperplugins.com/documentation/xml-sitemaps-module/#excluded-items', </span>&nbsp;</div></li><li><div>              'options' =&gt; array_keys( $excl_options ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;layout['priorities'] = array(&nbsp;</div></li><li><div>              'name' =&gt; __( 'Priorities', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'help_link' =&gt; 'http:<span class="comment"><span class="comment">//semperplugins.com/documentation/xml-sitemaps-module/#priorities-and-frequencies', </span></span>&nbsp;</div></li><li><div>              'options' =&gt; array_keys( $prio_options ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;layout['frequencies'] = array(&nbsp;</div></li><li><div>              'name' =&gt; __( 'Frequencies', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>              'help_link' =&gt; 'http:<span class="comment"><span class="comment">//semperplugins.com/documentation/xml-sitemaps-module/#priorities-and-frequencies', </span></span>&nbsp;</div></li><li><div>              'options' =&gt; array_keys( $freq_options ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;default_options = array_merge( $status_options, $this-&gt;default_options, $addl_options, $excl_options, $prio_options, $freq_options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;add_help_text_links();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          add_action( 'after_doing_aioseop_updates', array(&nbsp;</div></li><li><div>              $this, &nbsp;</div></li><li><div>              'do_sitemaps', &nbsp;</div></li><li><div> ) ); <span class="comment">// Update static sitemap when AIOSEOP is upgrade to new version.</span>&nbsp;</div></li><li><div>          add_action( 'init', array( $this, 'load_sitemap_options' ) );&nbsp;</div></li><li><div>          add_action( $this-&gt;prefix . 'settings_update', array( $this, 'do_sitemaps' ) );&nbsp;</div></li><li><div>          add_filter( $this-&gt;prefix . 'display_settings', array( $this, 'update_post_data' ) );&nbsp;</div></li><li><div>          add_filter( $this-&gt;prefix . 'display_options', array( $this, 'filter_display_options' ) );&nbsp;</div></li><li><div>          add_filter( $this-&gt;prefix . 'update_options', array( $this, 'filter_options' ) );&nbsp;</div></li><li><div>          add_filter( $this-&gt;prefix . 'output_option', array( $this, 'display_custom_options' ), 10, 2 );&nbsp;</div></li><li><div>          add_action( $this-&gt;prefix . 'daily_update_cron', array( $this, 'daily_update' ) );&nbsp;</div></li><li><div>          add_action( 'init', array( $this, 'make_dynamic_xsl' ) );&nbsp;</div></li><li><div>          add_action( 'transition_post_status', array( $this, 'update_sitemap_from_posts' ), 10, 3 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Update sitemap from posts.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $new_status</span>&nbsp;</div></li><li><div><span class="comment">       * @param $old_status</span>&nbsp;</div></li><li><div><span class="comment">       * @param $post</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function update_sitemap_from_posts( $new_status, $old_status, $post ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'rewrite' ) ) {&nbsp;</div></li><li><div>              <span class="comment">// TODO if dynamic, delete transient (we currently don't do transients).</span>&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $posttypes = array();&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}posttypes&quot;] ) ) {&nbsp;</div></li><li><div>              $posttypes = $this-&gt;options[&quot;{$this-&gt;prefix}posttypes&quot;];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! in_array( $post-&gt;post_type, $posttypes, true ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $statuses_for_updating = array( 'new', 'publish', 'trash' );&nbsp;</div></li><li><div>          if ( ! in_array( $new_status, $statuses_for_updating, true ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;do_sitemaps();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add cron schedules.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Add new intervals of a week and a month.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @link http://codex.wordpress.org/Plugin_API/Filter_Reference/cron_schedules</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $schedules</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function add_cron_schedules( $schedules ) {&nbsp;</div></li><li><div>          $schedules['weekly'] = array(&nbsp;</div></li><li><div>              'interval' =&gt; 604800, <span class="comment">// 1 week in seconds.</span>&nbsp;</div></li><li><div>              'display' =&gt; __( 'Once Weekly', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $schedules['monthly'] = array(&nbsp;</div></li><li><div>              'interval' =&gt; 2629740, <span class="comment">// 1 month in seconds.</span>&nbsp;</div></li><li><div>              'display' =&gt; __( 'Once Monthly', 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $schedules;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Cron update.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function cron_update() {&nbsp;</div></li><li><div>          add_filter( 'cron_schedules', array( $this, 'add_cron_schedules' ) );&nbsp;</div></li><li><div>          if ( ! wp_next_scheduled( $this-&gt;prefix . 'daily_update_cron' ) ) {&nbsp;</div></li><li><div>              wp_schedule_event( time(), $this-&gt;options[ $this-&gt;prefix . 'daily_cron' ], $this-&gt;prefix . 'daily_update_cron' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Daily update.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function daily_update() {&nbsp;</div></li><li><div>          $last_run = get_option( $this-&gt;prefix . 'cron_last_run' );&nbsp;</div></li><li><div>          if ( empty( $last_run ) || ( time() - $last_run &gt; 23.5 * 60 * 60 ) ) {&nbsp;</div></li><li><div>              <span class="comment">// Sanity check.</span>&nbsp;</div></li><li><div>              $this-&gt;do_sitemaps( __( 'Daily scheduled sitemap check has finished.', 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $last_run = time();&nbsp;</div></li><li><div>          update_option( $this-&gt;prefix . 'cron_last_run', $last_run );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Initialize options, after constructor.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function load_sitemap_options() {&nbsp;</div></li><li><div>          <span class="comment">// Load initial options / set defaults.</span>&nbsp;</div></li><li><div>          $this-&gt;update_options();&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}indexes&quot;] ) && ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}paginate&quot;] ) ) {&nbsp;</div></li><li><div>              $this-&gt;paginate = true;&nbsp;</div></li><li><div>              if ( $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;] && ( $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;] &gt; 0 ) && ( $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;] &lt; 50000 ) ) {&nbsp;</div></li><li><div>                  $this-&gt;max_posts = $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_multisite() ) {&nbsp;</div></li><li><div>              $this-&gt;options[&quot;{$this-&gt;prefix}rewrite&quot;] = 'On';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;options[&quot;{$this-&gt;prefix}rewrite&quot;] ) {&nbsp;</div></li><li><div>              $this-&gt;setup_rewrites();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'robots' ) ) {&nbsp;</div></li><li><div>              add_action( 'do_robots', array( $this, 'do_robots' ), 100 );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $this-&gt;options[ $this-&gt;prefix . 'daily_cron' ] ) && $this-&gt;options[ $this-&gt;prefix . 'daily_cron' ] ) {&nbsp;</div></li><li><div>              add_action( 'wp', array( $this, 'cron_update' ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( $time = wp_next_scheduled( $this-&gt;prefix . 'daily_update_cron' ) ) {&nbsp;</div></li><li><div>                  wp_unschedule_event( $time, $this-&gt;prefix . 'daily_update_cron' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Custom settings.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Displays boxes for add pages to sitemap option. Requires WordPress 4.1.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $buf</span>&nbsp;</div></li><li><div><span class="comment">       * @param $args</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function display_custom_options( $buf, $args ) {&nbsp;</div></li><li><div>          if ( &quot;{$this-&gt;prefix}addl_pages&quot; === $args['name'] ) {&nbsp;</div></li><li><div>              $buf .= &quot;&lt;div id='{$this-&gt;prefix}addl_pages'&gt;&quot;;&nbsp;</div></li><li><div>              if ( ! empty( $args['value'] ) ) {&nbsp;</div></li><li><div>                  $buf .= &quot;&lt;table class='aioseop_table' cellpadding=0 cellspacing=0&gt;\n&quot;;&nbsp;</div></li><li><div>                  foreach ( $args['value'] as $k =&gt; $v ) {&nbsp;</div></li><li><div>                      if ( is_object( $v ) ) {&nbsp;</div></li><li><div>                          $v = (Array) $v;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $buf .= &quot;\t&lt;tr&gt;&lt;td&gt;&lt;a href='#' title='$k' class='aiosp_delete_url'&gt;&lt;/a&gt; {$k}&lt;/td&gt;&lt;td&gt;{$v['prio']}&lt;/td&gt;&lt;td&gt;{$v['freq']}&lt;/td&gt;&lt;td&gt;{$v['mod']}&lt;/td&gt;&lt;/tr&gt;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $buf .= &quot;&lt;/table&gt;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $args['options']['type'] = 'hidden';&nbsp;</div></li><li><div>          if ( ! empty( $args['value'] ) ) {&nbsp;</div></li><li><div>              $args['value'] = wp_json_encode( $args['value'] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $args['options']['type'] = 'html';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $args['value'] ) ) {&nbsp;</div></li><li><div>              $args['value'] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $buf .= $this-&gt;get_option_html( $args );&nbsp;</div></li><li><div>          $buf .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $buf;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add post type details for settings once post types have been registered.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function add_post_types() {&nbsp;</div></li><li><div>          $post_type_titles = $this-&gt;get_post_type_titles( array( 'public' =&gt; true ) );&nbsp;</div></li><li><div>          $taxonomy_titles = $this-&gt;get_taxonomy_titles( array( 'public' =&gt; true ) );&nbsp;</div></li><li><div>          if ( isset( $post_type_titles['attachment'] ) ) {&nbsp;</div></li><li><div>              $post_type_titles['attachment'] = __( 'Media / Attachments', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;default_options['posttypes']['initial_options'] = array_merge( array( 'all' =&gt; __( 'All Post Types', 'all-in-one-seo-pack' ) ), $post_type_titles );&nbsp;</div></li><li><div>          $this-&gt;default_options['taxonomies']['initial_options'] = array_merge( array( 'all' =&gt; __( 'All Taxonomies', 'all-in-one-seo-pack' ) ), $taxonomy_titles );&nbsp;</div></li><li><div>          $this-&gt;default_options['posttypes']['default'] = array_keys( $this-&gt;default_options['posttypes']['initial_options'] );&nbsp;</div></li><li><div>          $this-&gt;default_options['taxonomies']['default'] = array_keys( $this-&gt;default_options['taxonomies']['initial_options'] );&nbsp;</div></li><li><div>          $this-&gt;default_options['excl_categories']['initial_options'] = $this-&gt;get_category_titles();&nbsp;</div></li><li><div>          $prio_help = __( 'Manually set the priority for the ', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>          $freq_help = __( 'Manually set the frequency for the ', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>          $post_name = __( ' Post Type', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>          $tax_name = __( ' Taxonomy', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>          foreach ( $post_type_titles as $k =&gt; $v ) {&nbsp;</div></li><li><div>              $key = 'prio_post_' . $k;&nbsp;</div></li><li><div>              $this-&gt;default_options = aioseop_array_insert_after( $this-&gt;default_options, 'prio_post', array(&nbsp;</div></li><li><div>                  $key =&gt; array(&nbsp;</div></li><li><div>                      'name' =&gt; $v . $post_name, &nbsp;</div></li><li><div>                      'help_text' =&gt; $prio_help . $v . $post_name, &nbsp;</div></li><li><div>                      'type' =&gt; 'select', &nbsp;</div></li><li><div>                      'initial_options' =&gt; $this-&gt;prio, &nbsp;</div></li><li><div>                      'default' =&gt; 'no', &nbsp;</div></li><li><div>                      'condshow' =&gt; array( &quot;{$this-&gt;prefix}prio_post&quot; =&gt; 'sel' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              $this-&gt;layout['priorities']['options'][] = $key;&nbsp;</div></li><li><div>              $key = 'freq_post_' . $k;&nbsp;</div></li><li><div>              $this-&gt;default_options = aioseop_array_insert_after( $this-&gt;default_options, 'freq_post', array(&nbsp;</div></li><li><div>                  $key =&gt; array(&nbsp;</div></li><li><div>                      'name' =&gt; $v . $post_name, &nbsp;</div></li><li><div>                      'help_text' =&gt; $freq_help . $v . $post_name, &nbsp;</div></li><li><div>                      'type' =&gt; 'select', &nbsp;</div></li><li><div>                      'initial_options' =&gt; $this-&gt;freq, &nbsp;</div></li><li><div>                      'default' =&gt; 'no', &nbsp;</div></li><li><div>                      'condshow' =&gt; array( &quot;{$this-&gt;prefix}freq_post&quot; =&gt; 'sel' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              $this-&gt;layout['frequencies']['options'][] = $key;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ( $taxonomy_titles as $k =&gt; $v ) {&nbsp;</div></li><li><div>              $key = 'prio_taxonomies_' . $k;&nbsp;</div></li><li><div>              $this-&gt;default_options = aioseop_array_insert_after( $this-&gt;default_options, 'prio_taxonomies', array(&nbsp;</div></li><li><div>                  $key =&gt; array(&nbsp;</div></li><li><div>                      'name' =&gt; $v . $tax_name, &nbsp;</div></li><li><div>                      'help_text' =&gt; $prio_help . $v . $tax_name, &nbsp;</div></li><li><div>                      'type' =&gt; 'select', &nbsp;</div></li><li><div>                      'initial_options' =&gt; $this-&gt;prio, &nbsp;</div></li><li><div>                      'default' =&gt; 'no', &nbsp;</div></li><li><div>                      'condshow' =&gt; array( &quot;{$this-&gt;prefix}prio_taxonomies&quot; =&gt; 'sel' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              $this-&gt;layout['priorities']['options'][] = $key;&nbsp;</div></li><li><div>              $key = 'freq_taxonomies_' . $k;&nbsp;</div></li><li><div>              $this-&gt;default_options = aioseop_array_insert_after( $this-&gt;default_options, 'freq_taxonomies', array(&nbsp;</div></li><li><div>                  $key =&gt; array(&nbsp;</div></li><li><div>                      'name' =&gt; $v . $tax_name, &nbsp;</div></li><li><div>                      'help_text' =&gt; $freq_help . $v . $tax_name, &nbsp;</div></li><li><div>                      'type' =&gt; 'select', &nbsp;</div></li><li><div>                      'initial_options' =&gt; $this-&gt;freq, &nbsp;</div></li><li><div>                      'default' =&gt; 'no', &nbsp;</div></li><li><div>                      'condshow' =&gt; array( &quot;{$this-&gt;prefix}freq_taxonomies&quot; =&gt; 'sel' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              $this-&gt;layout['frequencies']['options'][] = $key;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;update_options();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Set up settings, checking for sitemap conflicts, on settings page.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function add_page_hooks() {&nbsp;</div></li><li><div>          $this-&gt;flush_rules_hook();&nbsp;</div></li><li><div>          $this-&gt;add_post_types();&nbsp;</div></li><li><div>          parent::add_page_hooks();&nbsp;</div></li><li><div>          add_action( $this-&gt;prefix . 'settings_header', array( $this, 'do_sitemap_scan' ), 5 );&nbsp;</div></li><li><div>          add_filter( &quot;{$this-&gt;prefix}submit_options&quot;, array( $this, 'filter_submit' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter submit button.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Change settings page submit button to read &quot;Update Sitemap&quot;.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $submit</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function filter_submit( $submit ) {&nbsp;</div></li><li><div>          $submit['Submit']['value'] = __( 'Update Sitemap', 'all-in-one-seo-pack' ) . ' &raquo;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $submit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Updates post data.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Disable writing sitemaps to the filesystem for multisite.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $options</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function update_post_data( $options ) {&nbsp;</div></li><li><div>          if ( is_multisite() ) {&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'rewrite' ]['disabled'] = 'disabled';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $options;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * @param $url</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_rewrite_url( $url ) {&nbsp;</div></li><li><div>          global $wp_rewrite;&nbsp;</div></li><li><div>          $url = parse_url( esc_url( $url ), PHP_URL_PATH );&nbsp;</div></li><li><div>          $url = ltrim( $url, '/' );&nbsp;</div></li><li><div>          if ( ! empty( $wp_rewrite ) ) {&nbsp;</div></li><li><div>              $rewrite_rules = $wp_rewrite-&gt;rewrite_rules();&nbsp;</div></li><li><div>              foreach ( $rewrite_rules as $k =&gt; $v ) {&nbsp;</div></li><li><div>                  if ( preg_match( &quot;@^$k@&quot;, $url ) ) {&nbsp;</div></li><li><div>                      return $v;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter display options.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Add in options for status display on settings page, sitemap rewriting on multisite.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $options</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function filter_display_options( $options ) {&nbsp;</div></li><li><div>          if ( is_multisite() ) {&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'rewrite' ] = 'On';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( isset( $options[ $this-&gt;prefix . 'max_posts' ] ) && ( ( $options[ $this-&gt;prefix . 'max_posts' ] &lt;= 0 ) || ( $options[ $this-&gt;prefix . 'max_posts' ] &gt;= 50000 ) ) ) {&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'max_posts' ] = 50000;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $url = trailingslashit( get_home_url() ) . $options[ $this-&gt;prefix . 'filename' ] . '.xml';&nbsp;</div></li><li><div>          $options[ $this-&gt;prefix . 'link' ] = sprintf( __( 'Please review your settings below and click %s to build your sitemap; then, %s.', &nbsp;</div></li><li><div>              'all-in-one-seo-pack' ), sprintf( '&lt;a href=&quot;#&quot; onclick=&quot;document.dofollow.elements[\'Submit\'][0].click();&quot;&gt;%s&lt;/a&gt;', &nbsp;</div></li><li><div>              __( 'Update Sitemap', 'all-in-one-seo-pack' ) ), '&lt;a href=&quot;' . esc_url( $url ) . '&quot; target=&quot;_blank&quot;&gt;' .&nbsp;</div></li><li><div>                                                               __( 'view your sitemap', 'all-in-one-seo-pack' ) . '&lt;/a&gt;' );&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'rewrite' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'link' ] .= '&lt;p&gt;' . __( 'Note: you are using dynamic sitemap generation to keep your sitemap current; this will not generate a static sitemap file.', 'all-in-one-seo-pack' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>              $rule = $this-&gt;get_rewrite_url( $url );&nbsp;</div></li><li><div>              $rules = $this-&gt;get_rewrite_rules();&nbsp;</div></li><li><div>              if ( in_array( $rule, $rules ) ) {&nbsp;</div></li><li><div>                  $options[ $this-&gt;prefix . 'link' ] .= '&lt;p&gt;' . __( 'Dynamic sitemap generation appears to be using the correct rewrite rules.', 'all-in-one-seo-pack' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $options[ $this-&gt;prefix . 'link' ] .= '&lt;p&gt;' . __( 'Dynamic sitemap generation does not appear to be using the correct rewrite rules; please disable any other sitemap plugins or functionality on your site and reset your permalinks.', 'all-in-one-seo-pack' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! get_option( 'blog_public' ) ) {&nbsp;</div></li><li><div>              global $wp_version;&nbsp;</div></li><li><div>              if ( version_compare( $wp_version, '3.5.0', '&gt;=' ) || function_exists( 'set_url_scheme' ) ) {&nbsp;</div></li><li><div>                  $privacy_link = '&lt;a href=&quot;options-reading.php&quot;&gt;' . __( 'Reading Settings', 'all-in-one-seo-pack' ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $privacy_link = '&lt;a href=&quot;options-privacy.php&quot;&gt;' . __( 'Privacy Settings', 'all-in-one-seo-pack' ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'link' ] .= '&lt;p class=&quot;aioseop_error_notice&quot;&gt;' . sprintf( __( 'Warning: your privacy settings are configured to ask search engines to not index your site; you can change this under %s for your blog.', 'all-in-one-seo-pack' ), $privacy_link );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'debug' ) ) {&nbsp;</div></li><li><div>              $debug_msg = esc_html( $options[&quot;{$this-&gt;prefix}debug&quot;] );&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}debug&quot;] = '&lt;pre&gt;' . $debug_msg . '&lt;/pre&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $options;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter options.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Handle 'all' option for post types / taxonomies, further sanitization of filename, rewrites on for multisite, setting up addl pages option.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $options</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function filter_options( $options ) {&nbsp;</div></li><li><div>          if ( ! isset( $this-&gt;default_options['posttypes']['initial_options'] ) ) {&nbsp;</div></li><li><div>              $this-&gt;add_post_types();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) && in_array( 'all', $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) && is_array( $this-&gt;default_options['posttypes']['initial_options'] ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}posttypes&quot;] = array_keys( $this-&gt;default_options['posttypes']['initial_options'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) && in_array( 'all', $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) && is_array( $this-&gt;default_options['taxonomies']['initial_options'] ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}taxonomies&quot;] = array_keys( $this-&gt;default_options['taxonomies']['initial_options'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $opt = $this-&gt;prefix . 'filename';&nbsp;</div></li><li><div>          if ( isset( $options[ $opt ] ) && ! empty( $options[ $opt ] ) ) {&nbsp;</div></li><li><div>              $options[ $opt ] = str_replace( '/', '', $options[ $opt ] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $options[ $opt ] = 'sitemap';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_multisite() ) {&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'rewrite' ] = 'On';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! is_array( $options[ $this-&gt;prefix . 'addl_pages' ] ) ) {&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'addl_pages' ] = wp_specialchars_decode( stripslashes_deep( $options[ $this-&gt;prefix . 'addl_pages' ] ), ENT_QUOTES );&nbsp;</div></li><li><div>              $decoded = json_decode( $options[ $this-&gt;prefix . 'addl_pages' ] );&nbsp;</div></li><li><div>              if ( null === $decoded ) {&nbsp;</div></li><li><div>                  $decoded = maybe_unserialize( $options[ $this-&gt;prefix . 'addl_pages' ] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! is_array( $decoded ) ) {&nbsp;</div></li><li><div>                  $decoded = (Array) $decoded;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( null === $decoded ) {&nbsp;</div></li><li><div>                  $decoded = $options[ $this-&gt;prefix . 'addl_pages' ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'addl_pages' ] = $decoded;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $options[ $this-&gt;prefix . 'addl_pages' ] ) ) {&nbsp;</div></li><li><div>              foreach ( $options[ $this-&gt;prefix . 'addl_pages' ] as $k =&gt; $v ) {&nbsp;</div></li><li><div>                  if ( is_object( $v ) ) {&nbsp;</div></li><li><div>                      $options[ $this-&gt;prefix . 'addl_pages' ][ $k ] = (Array) $v;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( isset( $options[ $this-&gt;prefix . 'addl_pages' ][0] ) ) {&nbsp;</div></li><li><div>              unset( $options[ $this-&gt;prefix . 'addl_pages' ][0] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// TODO Refactor all these... use a nonce, dump the incoming _Post into an array and use that.</span>&nbsp;</div></li><li><div>          if ( ! empty( $_POST[ $this-&gt;prefix . 'addl_url' ] ) ) {&nbsp;</div></li><li><div>              foreach ( array( 'addl_url', 'addl_prio', 'addl_freq', 'addl_mod' ) as $field ) {&nbsp;</div></li><li><div>                  if ( ! empty( $_POST[ $this-&gt;prefix . $field ] ) ) {&nbsp;</div></li><li><div>                      $_POST[ $this-&gt;prefix . $field ] = esc_attr( wp_kses_post( $_POST[ $this-&gt;prefix . $field ] ) );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $_POST[ $this-&gt;prefix . $field ] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! is_array( $options[ $this-&gt;prefix . 'addl_pages' ] ) ) {&nbsp;</div></li><li><div>                  $options[ $this-&gt;prefix . 'addl_pages' ] = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $options[ $this-&gt;prefix . 'addl_pages' ][ $_POST[ $this-&gt;prefix . 'addl_url' ] ] = array(&nbsp;</div></li><li><div>                  'prio' =&gt; $_POST[ $this-&gt;prefix . 'addl_prio' ], &nbsp;</div></li><li><div>                  'freq' =&gt; $_POST[ $this-&gt;prefix . 'addl_freq' ], &nbsp;</div></li><li><div>                  'mod' =&gt; $_POST[ $this-&gt;prefix . 'addl_mod' ], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $options;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get sitemap urls of child blogs, if any.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed|void</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_child_sitemap_urls() {&nbsp;</div></li><li><div>          $siteurls = array();&nbsp;</div></li><li><div>          $blogs = $this-&gt;get_child_blogs();&nbsp;</div></li><li><div>          if ( ! empty( $blogs ) ) {&nbsp;</div></li><li><div>              $option_name = $this-&gt;get_option_name();&nbsp;</div></li><li><div>              foreach ( $blogs as $blog_id ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;is_aioseop_active_on_blog( $blog_id ) ) {&nbsp;</div></li><li><div>                      $options = get_blog_option( $blog_id, $this-&gt;parent_option );&nbsp;</div></li><li><div>                      if ( ! empty( $options ) && ! empty( $options['modules'] ) && ! empty( $options['modules']['aiosp_feature_manager_options'] )&nbsp;</div></li><li><div>                           && ! empty( $options['modules']['aiosp_feature_manager_options']['aiosp_feature_manager_enable_sitemap'] )&nbsp;</div></li><li><div>                           && ! empty( $options['modules'][ $option_name ] )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                          global $wpdb;&nbsp;</div></li><li><div>                          $sitemap_options = $options['modules'][ $option_name ];&nbsp;</div></li><li><div>                          $siteurl = '';&nbsp;</div></li><li><div>                          if ( defined( 'SUNRISE' ) && SUNRISE && is_object( $wpdb ) && isset( $wpdb-&gt;dmtable ) && ! empty( $wpdb-&gt;dmtable ) ) {&nbsp;</div></li><li><div>                              $domain = $wpdb-&gt;get_var( &quot;SELECT domain FROM {$wpdb-&gt;dmtable} WHERE blog_id = '$blog_id' AND active = 1 LIMIT 1&quot; );&nbsp;</div></li><li><div>                              if ( $domain ) {&nbsp;</div></li><li><div>                                  if ( false == isset( $_SERVER['HTTPS'] ) ) {&nbsp;</div></li><li><div>                                      $_SERVER['HTTPS'] = 'Off';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $protocol = ( 'on' == strtolower( $_SERVER['HTTPS'] ) ) ? 'https:<span class="comment">//' : 'http:<span class="comment">//';</span></span>&nbsp;</div></li><li><div>                                  $siteurl = untrailingslashit( $protocol . $domain );&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ( ! $siteurl ) {&nbsp;</div></li><li><div>                              $siteurl = get_home_url( $blog_id );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $url = $siteurl . '/' . $sitemap_options[&quot;{$this-&gt;prefix}filename&quot;] . '.xml';&nbsp;</div></li><li><div>                          if ( $sitemap_options[&quot;{$this-&gt;prefix}gzipped&quot;] ) {&nbsp;</div></li><li><div>                              $url .= '.gz';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $siteurls[] = $url;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $siteurls = apply_filters( $this-&gt;prefix . 'sitemap_urls', $siteurls ); <span class="comment">// Legacy.</span>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;prefix . 'child_urls', $siteurls );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Gets the home path.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * If we're in wp-admin, use the WordPress function, otherwise we user our own version here.</span>&nbsp;</div></li><li><div><span class="comment">       * This only applies to static sitemaps.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.3.6.1</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed|string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_home_path() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( function_exists( 'get_home_path' ) ) {&nbsp;</div></li><li><div>              return get_home_path();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $home = set_url_scheme( get_option( 'home' ), 'http' );&nbsp;</div></li><li><div>          $siteurl = set_url_scheme( get_option( 'siteurl' ), 'http' );&nbsp;</div></li><li><div>          if ( ! empty( $home ) && 0 !== strcasecmp( $home, $siteurl ) ) {&nbsp;</div></li><li><div>              $wp_path_rel_to_home = str_ireplace( $home, '', $siteurl ); <span class="comment">/** $siteurl - $home */</span>&nbsp;</div></li><li><div>              $pos = strripos( str_replace( '\\', '/', $_SERVER['SCRIPT_FILENAME'] ), trailingslashit( $wp_path_rel_to_home ) );&nbsp;</div></li><li><div>              $home_path = substr( $_SERVER['SCRIPT_FILENAME'], 0, $pos );&nbsp;</div></li><li><div>              $home_path = trailingslashit( $home_path );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $home_path = ABSPATH;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return str_replace( '\\', '/', $home_path );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Scan for sitemaps on filesystem.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function scan_match_files() {&nbsp;</div></li><li><div>          $scan1 = $scan2 = '';&nbsp;</div></li><li><div>          $files = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] ) ) {&nbsp;</div></li><li><div>              $scan1 = get_home_path() . $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '*.xml';&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}gzipped&quot;] ) ) {&nbsp;</div></li><li><div>                  $scan2 .= get_home_path() . $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '*.xml.gz';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $scan1 ) && empty( $scan2 ) ) {&nbsp;</div></li><li><div>                  return $files;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $home_path = get_home_path();&nbsp;</div></li><li><div>              $filescan = $this-&gt;scandir( $home_path );&nbsp;</div></li><li><div>              if ( ! empty( $filescan ) ) {&nbsp;</div></li><li><div>                  foreach ( $filescan as $f ) {&nbsp;</div></li><li><div>                      if ( ! empty( $scan1 ) && fnmatch( $scan1, $home_path . $f ) ) {&nbsp;</div></li><li><div>                          $files[] = $home_path . $f;&nbsp;</div></li><li><div>                          continue;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( ! empty( $scan2 ) && fnmatch( $scan2, $home_path . $f ) ) {&nbsp;</div></li><li><div>                          $files[] = $home_path . $f;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return $files;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Scan for sitemaps.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Handle deleting / renaming of conflicting sitemap files.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_sitemap_scan() {&nbsp;</div></li><li><div>          $msg = '';&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}rewrite&quot;] ) && ( get_option( 'permalink_structure' ) === '' ) ) {&nbsp;</div></li><li><div>              $msg = '&lt;p&gt;' . __( 'Warning: dynamic sitemap generation must have permalinks enabled.', 'all-in-one-seo-pack' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! empty( $_POST['aioseop_sitemap_rename_files'] ) || ! empty( $_POST['aioseop_sitemap_delete_files'] ) ) {&nbsp;</div></li><li><div>              $nonce = $_POST['nonce-aioseop'];&nbsp;</div></li><li><div>              if ( ! wp_verify_nonce( $nonce, 'aioseop-nonce' ) ) {&nbsp;</div></li><li><div>                  die ( __( 'Security Check - If you receive this in error, log out and back in to WordPress', 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $_POST['aioseop_sitemap_conflict'] ) ) {&nbsp;</div></li><li><div>                  $files = $this-&gt;scan_match_files();&nbsp;</div></li><li><div>                  foreach ( $files as $f =&gt; $file ) {&nbsp;</div></li><li><div>                      $files[ $f ] = realpath( $file );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  foreach ( $_POST['aioseop_sitemap_conflict'] as $ren_file ) {&nbsp;</div></li><li><div>                      $ren_file = realpath( get_home_path() . $ren_file );&nbsp;</div></li><li><div>                      if ( in_array( $ren_file, $files ) ) {&nbsp;</div></li><li><div>                          if ( ! empty( $_POST['aioseop_sitemap_delete_files'] ) ) {&nbsp;</div></li><li><div>                              if ( $this-&gt;delete_file( $ren_file ) ) {&nbsp;</div></li><li><div>                                  $msg .= '&lt;p&gt;' . sprintf( __( 'Deleted %s.', 'all-in-one-seo-pack' ), $ren_file ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              continue;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $count = 0;&nbsp;</div></li><li><div>                          do {&nbsp;</div></li><li><div>                              $ren_to = $ren_file . '._' . sprintf( '%03d', $count ) . '.old';&nbsp;</div></li><li><div>                              $count ++;&nbsp;</div></li><li><div>                          } while ( $this-&gt;file_exists( $ren_to ) && ( $count &lt; 1000 ) );&nbsp;</div></li><li><div>                          if ( $count &gt;= 1000 ) {&nbsp;</div></li><li><div>                              $msg .= '&lt;p&gt;' . sprintf( __( &quot;Couldn't rename file %s!&quot;, 'all-in-one-seo-pack' ), $ren_file ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $ren = $this-&gt;rename_file( $ren_file, $ren_to );&nbsp;</div></li><li><div>                              if ( $ren ) {&nbsp;</div></li><li><div>                                  $msg .= '&lt;p&gt;' . sprintf( __( 'Renamed %s to %s.', 'all-in-one-seo-pack' ), $ren_file, $ren_to ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $msg .= '&lt;p&gt;' . sprintf( __( &quot;Couldn't find file %s!&quot;, 'all-in-one-seo-pack' ), $ren_file ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $msg .= $this-&gt;scan_sitemaps();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $msg ) ) {&nbsp;</div></li><li><div>              $this-&gt;output_error( $msg );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Do the scan, return the results.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function scan_sitemaps() {&nbsp;</div></li><li><div>          $msg = '';&nbsp;</div></li><li><div>          $files = $this-&gt;scan_match_files();&nbsp;</div></li><li><div>          if ( ! empty( $files ) ) {&nbsp;</div></li><li><div>              $msg = $this-&gt;sitemap_warning( $files );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $msg;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get problem files.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Get the list of potentially conflicting sitemap files.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $files</span>&nbsp;</div></li><li><div><span class="comment">       * @param $msg</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_problem_files( $files, &$msg ) {&nbsp;</div></li><li><div>          $problem_files = array();&nbsp;</div></li><li><div>          $use_wpfs = true;&nbsp;</div></li><li><div>          $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>          if ( ! is_object( $wpfs ) ) {&nbsp;</div></li><li><div>              $use_wpfs = false;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( 'direct' === $wpfs-&gt;method ) {&nbsp;</div></li><li><div>                  $use_wpfs = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $files as $f ) {&nbsp;</div></li><li><div>              if ( $this-&gt;is_file( $f ) ) {&nbsp;</div></li><li><div>                  $fn = $f;&nbsp;</div></li><li><div>                  $compressed = false;&nbsp;</div></li><li><div>                  if ( $this-&gt;substr( $f, - 3 ) === '.gz' ) {&nbsp;</div></li><li><div>                      $compressed = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( $use_wpfs ) {&nbsp;</div></li><li><div>                      if ( $compressed ) {  <span class="comment">// Inefficient but necessary.</span>&nbsp;</div></li><li><div>                          $file = $this-&gt;load_file( $fn );&nbsp;</div></li><li><div>                          if ( ! empty( $file ) ) {&nbsp;</div></li><li><div>                              $file = gzuncompress( $file, 4096 );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $file = $this-&gt;load_file( $fn, false, null, - 1, 4096 );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ( $compressed ) {&nbsp;</div></li><li><div>                          $fn = 'compress.zlib:<span class="comment">//' . $fn;</span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $file = file_get_contents( $fn, false, null, - 1, 4096 );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ! empty( $file ) ) {&nbsp;</div></li><li><div>                      $matches = array();&nbsp;</div></li><li><div>                      if ( preg_match( '/&lt;!-- ' . sprintf( $this-&gt;comment_string, '(.*)', '(.*)', '(.*)' ) . ' --&gt;/', &nbsp;</div></li><li><div>                          $file, $matches ) ) {&nbsp;</div></li><li><div>                          if ( ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}rewrite&quot;] ) ) {&nbsp;</div></li><li><div>                              $msg .= '&lt;p&gt;' . sprintf( __( &quot;Warning: a static sitemap '%s' generated by All in One SEO Pack %s on %s already exists that may conflict with dynamic sitemap generation.&quot;, 'all-in-one-seo-pack' ), &nbsp;</div></li><li><div>                                      $f, $matches[2], $matches[3] ) . &quot;&lt;/p&gt;\n&quot;;&nbsp;</div></li><li><div>                              $problem_files[] = $f;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $msg .= '&lt;p&gt;' . sprintf( __( 'Potential conflict with unknown file %s.', 'all-in-one-seo-pack' ), $f ) . &quot;&lt;/p&gt;\n&quot;;&nbsp;</div></li><li><div>                          $problem_files[] = $f;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $problem_files;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Display sitemap warning.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Display the warning and the form for conflicting sitemap files.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $files</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function sitemap_warning( $files ) {&nbsp;</div></li><li><div>          $msg = '';&nbsp;</div></li><li><div>          $conflict = false;&nbsp;</div></li><li><div>          $problem_files = $this-&gt;get_problem_files( $files, $msg );&nbsp;</div></li><li><div>          if ( ! empty( $problem_files ) ) {&nbsp;</div></li><li><div>              $conflict = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $conflict ) {&nbsp;</div></li><li><div>              foreach ( $problem_files as $p ) {&nbsp;</div></li><li><div>                  $msg .= &quot;&lt;input type='hidden' name='aioseop_sitemap_conflict[]' value='&quot; . esc_attr( basename( realpath( $p ) ) ) . &quot;'&gt;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $msg .= &quot;&lt;input type='hidden' name='nonce-aioseop' value='&quot; . wp_create_nonce( 'aioseop-nonce' ) . &quot;'&gt;\n&quot;;&nbsp;</div></li><li><div>              $msg .= &quot;&lt;input type='submit' name='aioseop_sitemap_rename_files' value='&quot; . __( 'Rename Conflicting Files', 'all-in-one-seo-pack' ) . &quot;'&gt; &quot;;&nbsp;</div></li><li><div>              $msg .= &quot;&lt;input type='submit' name='aioseop_sitemap_delete_files' value='&quot; . __( 'Delete Conflicting Files', 'all-in-one-seo-pack' ) . &quot;'&gt;&quot;;&nbsp;</div></li><li><div>              $msg = '&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;' . $msg . '&lt;/form&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $msg;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Updates debug log messages.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $msg</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function debug_message( $msg ) {&nbsp;</div></li><li><div>          if ( empty( $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;] ) ) {&nbsp;</div></li><li><div>              $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;] = date( 'Y-m-d H:i:s' ) . &quot; {$msg}\n&quot; . $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;];&nbsp;</div></li><li><div>          if ( $this-&gt;strlen( $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;] ) &gt; 2048 ) {&nbsp;</div></li><li><div>              $end = $this-&gt;strrpos( $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;], &quot;\n&quot; );&nbsp;</div></li><li><div>              if ( false === $end ) {&nbsp;</div></li><li><div>                  $end = 2048;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;] = $this-&gt;substr( $this-&gt;options[&quot;{$this-&gt;prefix}debug&quot;], 0, $end );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;update_class_option( $this-&gt;options );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Set up hooks for rewrite rules for dynamic sitemap generation.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function setup_rewrites() {&nbsp;</div></li><li><div>          add_action( 'rewrite_rules_array', array( $this, 'rewrite_hook' ) );&nbsp;</div></li><li><div>          add_filter( 'query_vars', array( $this, 'query_var_hook' ) );&nbsp;</div></li><li><div>          add_action( 'parse_query', array( $this, 'sitemap_output_hook' ) );&nbsp;</div></li><li><div>          if ( ! get_transient( &quot;{$this-&gt;prefix}rules_flushed&quot; ) ) {&nbsp;</div></li><li><div>              add_action( 'wp_loaded', array( $this, 'flush_rules_hook' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Build and return our rewrite rules.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_rewrite_rules() {&nbsp;</div></li><li><div>          $sitemap_rules_normal = $sitemap_rules_gzipped = array();&nbsp;</div></li><li><div>          $sitemap_rules_normal = array(&nbsp;</div></li><li><div>              $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '.xml' =&gt; &quot;index.php?{$this-&gt;prefix}path=root&quot;, &nbsp;</div></li><li><div>              $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '_(.+)_(\d+).xml' =&gt; 'index.php?' . $this-&gt;prefix . 'path=$matches[1]&' . $this-&gt;prefix . 'page=$matches[2]', &nbsp;</div></li><li><div>              $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '_(.+).xml' =&gt; 'index.php?' . $this-&gt;prefix . 'path=$matches[1]', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          if ( $this-&gt;options[&quot;{$this-&gt;prefix}gzipped&quot;] ) {&nbsp;</div></li><li><div>              $sitemap_rules_gzipped = array(&nbsp;</div></li><li><div>                  $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '.xml.gz' =&gt; &quot;index.php?{$this-&gt;prefix}gzipped=1&{$this-&gt;prefix}path=root.gz&quot;, &nbsp;</div></li><li><div>                  $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '_(.+)_(\d+).xml.gz' =&gt; 'index.php?' . $this-&gt;prefix . 'path=$matches[1].gz&' . $this-&gt;prefix . 'page=$matches[2]', &nbsp;</div></li><li><div>                  $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '_(.+).xml.gz' =&gt; 'index.php?' . $this-&gt;prefix . 'path=$matches[1].gz', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $sitemap_rules = $sitemap_rules_gzipped + $sitemap_rules_normal;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $sitemap_rules;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add in our rewrite rules.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $rules</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function rewrite_hook( $rules ) {&nbsp;</div></li><li><div>          $sitemap_rules = $this-&gt;get_rewrite_rules();&nbsp;</div></li><li><div>          if ( ! empty( $sitemap_rules ) ) {&nbsp;</div></li><li><div>              $rules = $sitemap_rules + $rules;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $rules;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Flush rewrite rules when necessary.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function flush_rules_hook() {&nbsp;</div></li><li><div>          global $wp_rewrite;&nbsp;</div></li><li><div>          $sitemap_rules = $this-&gt;get_rewrite_rules( $wp_rewrite );&nbsp;</div></li><li><div>          if ( ! empty( $sitemap_rules ) ) {&nbsp;</div></li><li><div>              $rules = get_option( 'rewrite_rules' );&nbsp;</div></li><li><div>              $rule = key( $sitemap_rules );&nbsp;</div></li><li><div>              if ( ! isset( $rules[ $rule ] ) || ( $rules[ $rule ] !== $sitemap_rules[ $rule ] ) ) {&nbsp;</div></li><li><div>                  $wp_rewrite-&gt;flush_rules();&nbsp;</div></li><li><div>                  set_transient( &quot;{$this-&gt;prefix}rules_flushed&quot;, true, 43200 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add our query variable for sitemap generation.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $vars</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function query_var_hook( $vars ) {&nbsp;</div></li><li><div>          $vars[] = &quot;{$this-&gt;prefix}path&quot;;&nbsp;</div></li><li><div>          if ( $this-&gt;paginate ) {&nbsp;</div></li><li><div>              $vars[] = &quot;{$this-&gt;prefix}page&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $vars;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Start timing and get initial memory usage for debug info.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function log_start() {&nbsp;</div></li><li><div>          $this-&gt;start_memory_usage = memory_get_peak_usage();&nbsp;</div></li><li><div>          timer_start();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Stop timing and log memory usage for debug info.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $sitemap_type</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $compressed</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $dynamic</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function log_stats( $sitemap_type = 'static', $compressed = false, $dynamic = true ) {&nbsp;</div></li><li><div>          $time = timer_stop();&nbsp;</div></li><li><div>          $end_memory_usage = memory_get_peak_usage();&nbsp;</div></li><li><div>          $sitemap_memory_usage = $end_memory_usage - $this-&gt;start_memory_usage;&nbsp;</div></li><li><div>          $end_memory_usage = $end_memory_usage / 1024.0 / 1024.0;&nbsp;</div></li><li><div>          $sitemap_memory_usage = $sitemap_memory_usage / 1024.0 / 1024.0;&nbsp;</div></li><li><div>          $sitemap_type = __( 'static', 'all-in-one-seo-pack ' );&nbsp;</div></li><li><div>          if ( $compressed ) {&nbsp;</div></li><li><div>              $sitemap_type = __( 'compressed', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $dynamic ) {&nbsp;</div></li><li><div>              $sitemap_type = __( 'dynamic', 'all-in-one-seo-pack ' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;debug_message( sprintf( ' %01.2f MB memory used generating the %s sitemap in %01.3f seconds, %01.2f MB total memory used.', $sitemap_memory_usage, $sitemap_type, $time, $end_memory_usage ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Handle outputting of dynamic sitemaps, logging.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $query</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function sitemap_output_hook( $query ) {&nbsp;</div></li><li><div>          $page = 0;&nbsp;</div></li><li><div>          if ( $this-&gt;options[&quot;{$this-&gt;prefix}rewrite&quot;] && ! empty( $query-&gt;query_vars[&quot;{$this-&gt;prefix}path&quot;] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Make dynamic sitemap.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $query-&gt;query_vars[&quot;{$this-&gt;prefix}page&quot;] ) ) {&nbsp;</div></li><li><div>                  $page = $query-&gt;query_vars[&quot;{$this-&gt;prefix}page&quot;] - 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;start_memory_usage = memory_get_peak_usage();&nbsp;</div></li><li><div>              $sitemap_type = $query-&gt;query_vars[&quot;{$this-&gt;prefix}path&quot;];&nbsp;</div></li><li><div>              $gzipped = false;&nbsp;</div></li><li><div>              if ( $this-&gt;substr( $sitemap_type, - 3 ) === '.gz' ) {&nbsp;</div></li><li><div>                  $gzipped = true;&nbsp;</div></li><li><div>                  $sitemap_type = $this-&gt;substr( $sitemap_type, 0, - 3 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $blog_charset = get_option( 'blog_charset' );&nbsp;</div></li><li><div>              if ( $this-&gt;options[&quot;{$this-&gt;prefix}gzipped&quot;] && $gzipped ) {&nbsp;</div></li><li><div>                  header( &quot;Content-Type: application/x-gzip; charset=$blog_charset&quot;, true );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $gzipped = false;&nbsp;</div></li><li><div>                  header( &quot;Content-Type: text/xml; charset=$blog_charset&quot;, true );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Always follow and noindex the sitemap.</span>&nbsp;</div></li><li><div>              header( 'X-Robots-Tag: noindex, follow', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $gzipped ) {&nbsp;</div></li><li><div>                  ob_start();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;do_rewrite_sitemap( $sitemap_type, $page );&nbsp;</div></li><li><div>              if ( $gzipped ) {&nbsp;</div></li><li><div>                  echo gzencode( ob_get_clean() );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;log_stats( $sitemap_type, $gzipped );&nbsp;</div></li><li><div>              exit();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Make dynamic xsl.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function make_dynamic_xsl() {&nbsp;</div></li><li><div>          <span class="comment">// Make dynamic xsl file.</span>&nbsp;</div></li><li><div>          if ( preg_match( '#(/sitemap\.xsl)$#i', $_SERVER['REQUEST_URI'] ) ) {&nbsp;</div></li><li><div>              $blog_charset = get_option( 'blog_charset' );&nbsp;</div></li><li><div>              header( &quot;Content-Type: text/xml; charset=$blog_charset&quot;, true );&nbsp;</div></li><li><div>              include_once( AIOSEOP_PLUGIN_DIR . '/inc/sitemap-xsl.php' );&nbsp;</div></li><li><div>              exit();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get sitemap data.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param     $sitemap_type</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $page</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed|void</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_sitemap_data( $sitemap_type, $page = 0 ) {&nbsp;</div></li><li><div>          $sitemap_data = array();&nbsp;</div></li><li><div>          if ( $this-&gt;options[&quot;{$this-&gt;prefix}indexes&quot;] ) {&nbsp;</div></li><li><div>              $posttypes = $this-&gt;options[&quot;{$this-&gt;prefix}posttypes&quot;];&nbsp;</div></li><li><div>              if ( empty( $posttypes ) ) {&nbsp;</div></li><li><div>                  $posttypes = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $taxonomies = $this-&gt;options[&quot;{$this-&gt;prefix}taxonomies&quot;];&nbsp;</div></li><li><div>              if ( empty( $taxonomies ) ) {&nbsp;</div></li><li><div>                  $taxonomies = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( 'root' === $sitemap_type ) {&nbsp;</div></li><li><div>                  $sitemap_data = array_merge( $this-&gt;get_sitemap_index_filenames() );&nbsp;</div></li><li><div>              } elseif ( 'addl' === $sitemap_type ) {&nbsp;</div></li><li><div>                  $sitemap_data = $this-&gt;get_addl_pages();&nbsp;</div></li><li><div>              } elseif ( 'archive' === $sitemap_type && $this-&gt;option_isset( 'archive' ) ) {&nbsp;</div></li><li><div>                  $sitemap_data = $this-&gt;get_archive_prio_data();&nbsp;</div></li><li><div>              } elseif ( 'author' === $sitemap_type && $this-&gt;option_isset( 'author' ) ) {&nbsp;</div></li><li><div>                  $sitemap_data = $this-&gt;get_author_prio_data();&nbsp;</div></li><li><div>              } elseif ( in_array( $sitemap_type, $posttypes ) ) {&nbsp;</div></li><li><div>                  $sitemap_data = $this-&gt;get_all_post_priority_data( $sitemap_type, 'publish', $page );&nbsp;</div></li><li><div>              } elseif ( in_array( $sitemap_type, $taxonomies ) ) {&nbsp;</div></li><li><div>                  $sitemap_data = $this-&gt;get_term_priority_data( get_terms( $sitemap_type, $this-&gt;get_tax_args( $page ) ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( is_array( $this-&gt;extra_sitemaps ) && in_array( $sitemap_type, $this-&gt;extra_sitemaps ) ) {&nbsp;</div></li><li><div>                      $sitemap_data = apply_filters( $this-&gt;prefix . 'custom_' . $sitemap_type, $sitemap_data, $page, $this_options );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( 'root' === $sitemap_type ) {&nbsp;</div></li><li><div>              $sitemap_data = $this-&gt;get_simple_sitemap();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;prefix . 'data', $sitemap_data, $sitemap_type, $page, $this-&gt;options );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Rewrite sitemap.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Output sitemaps dynamically based on rewrite rules.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param     $sitemap_type</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $page</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_rewrite_sitemap( $sitemap_type, $page = 0 ) {&nbsp;</div></li><li><div>          $this-&gt;add_post_types();&nbsp;</div></li><li><div>          $comment = 'dynamically';&nbsp;</div></li><li><div>          echo $this-&gt;do_build_sitemap( $sitemap_type, $page, '', $comment );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Build a url to the sitemap.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_sitemap_url() {&nbsp;</div></li><li><div>          $url = get_home_url() . '/' . $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '.xml';&nbsp;</div></li><li><div>          if ( $this-&gt;options[&quot;{$this-&gt;prefix}gzipped&quot;] ) {&nbsp;</div></li><li><div>              $url .= '.gz';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $url;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Notify search engines, do logging.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_notify() {&nbsp;</div></li><li><div>          $notify_url = array(&nbsp;</div></li><li><div>              'google' =&gt; 'http:<span class="comment">//www.google.com/webmasters/sitemaps/ping?sitemap=', </span>&nbsp;</div></li><li><div>              'bing' =&gt; 'http:<span class="comment">//www.bing.com/webmaster/ping.aspx?siteMap=', </span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $url = $this-&gt;get_sitemap_url();&nbsp;</div></li><li><div>          if ( ! empty( $url ) ) {&nbsp;</div></li><li><div>              foreach ( $notify_url as $k =&gt; $v ) {&nbsp;</div></li><li><div>                  if ( isset( $this-&gt;options[ $this-&gt;prefix . $k ] ) && $this-&gt;options[ $this-&gt;prefix . $k ] ) {&nbsp;</div></li><li><div>                      $response = wp_remote_get( $notify_url[ $k ] . urlencode( $url ) );&nbsp;</div></li><li><div>                      if ( is_array( $response ) && ! empty( $response['response'] ) && ! empty( $response['response']['code'] ) ) {&nbsp;</div></li><li><div>                          if ( 200 == $response['response']['code'] ) {&nbsp;</div></li><li><div>                              $this-&gt;debug_message( sprintf( __( 'Successfully notified %s about changes to your sitemap at %s.', 'all-in-one-seo-pack' ), $k, $url ) );&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;debug_message( sprintf( __( 'Failed to notify %s about changes to your sitemap at %s, error code %s.', 'all-in-one-seo-pack' ), $k, $url, $response['response']['code'] ) );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;debug_message( sprintf( __( 'Failed to notify %s about changes to your sitemap at %s, unable to access via wp_remote_get().', 'all-in-one-seo-pack' ), $k, $url ) );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;debug_message( sprintf( __( 'Did not notify %s about changes to your sitemap.', 'all-in-one-seo-pack' ), $k, $url ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add Sitemap parameter to virtual robots.txt file.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_robots() {&nbsp;</div></li><li><div>          $url = $this-&gt;get_sitemap_url();&nbsp;</div></li><li><div>          echo &quot;\nSitemap: $url\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Build static sitemaps.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Build static sitemaps on submit if rewrite rules are not in use, do logging.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $message</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_sitemaps( $message = '' ) {&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}indexes&quot;] ) && ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}paginate&quot;] ) ) {&nbsp;</div></li><li><div>              $this-&gt;paginate = true;&nbsp;</div></li><li><div>              if ( $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;] && ( $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;] &gt; 0 ) && ( $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;] &lt; 50000 ) ) {&nbsp;</div></li><li><div>                  $this-&gt;max_posts = $this-&gt;options[&quot;{$this-&gt;prefix}max_posts&quot;];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;max_posts = 50000;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;paginate = false;&nbsp;</div></li><li><div>              $this-&gt;max_posts = 50000;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! $this-&gt;options[&quot;{$this-&gt;prefix}rewrite&quot;] ) {&nbsp;</div></li><li><div>              if ( $this-&gt;options[&quot;{$this-&gt;prefix}indexes&quot;] ) {&nbsp;</div></li><li><div>                  $this-&gt;do_indexed_sitemaps();&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;log_start();&nbsp;</div></li><li><div>                  $comment = sprintf( &quot;file '%s' statically&quot;, $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] );&nbsp;</div></li><li><div>                  $sitemap = $this-&gt;do_simple_sitemap( $comment );&nbsp;</div></li><li><div>                  $this-&gt;write_sitemaps( $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;], $sitemap );&nbsp;</div></li><li><div>                  $this-&gt;log_stats( 'root', $this-&gt;options[&quot;{$this-&gt;prefix}gzipped&quot;], false );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              delete_transient( &quot;{$this-&gt;prefix}rules_flushed&quot; );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;do_notify();&nbsp;</div></li><li><div>          if ( ! empty( $message ) && is_string( $message ) ) {&nbsp;</div></li><li><div>              $this-&gt;debug_message( $message );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;debug_message( __( 'Updated sitemap settings.', 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add mime type.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $mime</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function add_xml_mime_type( $mime ) {&nbsp;</div></li><li><div>          if ( ! empty( $mime ) ) {&nbsp;</div></li><li><div>              $mime['xml'] = 'text/xml';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $mime;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Write multiple sitemaps.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Write sitemaps (compressed or otherwise) to the filesystem.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $filename</span>&nbsp;</div></li><li><div><span class="comment">       * @param $contents</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function write_sitemaps( $filename, $contents ) {&nbsp;</div></li><li><div>          $this-&gt;write_sitemap( $filename . '.xml', $contents );&nbsp;</div></li><li><div>          if ( $this-&gt;options[&quot;{$this-&gt;prefix}gzipped&quot;] ) {&nbsp;</div></li><li><div>              $this-&gt;write_sitemap( $filename . '.xml.gz', $contents, true );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Write single sitemap.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Write a single sitemap to the filesystem, handle compression.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param      $filename</span>&nbsp;</div></li><li><div><span class="comment">       * @param      $contents</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool $gzip</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function write_sitemap( $filename, $contents, $gzip = false ) {&nbsp;</div></li><li><div>          if ( $gzip ) {&nbsp;</div></li><li><div>              $contents = gzencode( $contents );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          add_filter( 'upload_mimes', array( $this, 'add_xml_mime_type' ) );&nbsp;</div></li><li><div>          $filename = $this-&gt;get_home_path() . sanitize_file_name( $filename );&nbsp;</div></li><li><div>          remove_filter( 'upload_mimes', array( $this, 'add_xml_mime_type' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;save_file( $filename, $contents );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Gets the default values.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Helper function for handling default values.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $defaults</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $prefix</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $cache</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $item</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $nodefaults</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $type</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_default_values( $defaults, $prefix, &$cache, $item, $nodefaults = false, $type = '' ) {&nbsp;</div></li><li><div>          if ( ! empty( $cache[ $item . $type ] ) ) {&nbsp;</div></li><li><div>              return $cache[ $item . $type ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! empty( $defaults[ $item ] ) ) {&nbsp;</div></li><li><div>              $field = $this-&gt;prefix . $prefix . $item;&nbsp;</div></li><li><div>              if ( $this-&gt;option_isset( $prefix . $item ) && 'no' != $this-&gt;options[ $field ] ) {&nbsp;</div></li><li><div>                  if ( ( 'sel' === $this-&gt;options[ $field ] ) && ! empty( $type ) && isset( $this-&gt;options[ $this-&gt;prefix . $prefix . $item . '_' . $type ] ) ) {&nbsp;</div></li><li><div>                      if ( 'no' == $this-&gt;options[ $this-&gt;prefix . $prefix . $item . '_' . $type ] ) {&nbsp;</div></li><li><div>                          return false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( 'sel' === $this-&gt;options[ $this-&gt;prefix . $prefix . $item . '_' . $type ] ) {&nbsp;</div></li><li><div>                          return false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $cache[ $item . $type ] = $this-&gt;options[ $this-&gt;prefix . $prefix . $item . '_' . $type ];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ( 'no' == $this-&gt;options[ $field ] ) {&nbsp;</div></li><li><div>                          return false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( 'sel' === $this-&gt;options[ $field ] ) {&nbsp;</div></li><li><div>                          return false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $cache[ $item . $type ] = $this-&gt;options[ $field ];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return $cache[ $item . $type ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $nodefaults ) {&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return $defaults[ $item ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get priority settings for sitemap entries.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $item</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $nodefaults</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $type</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_default_priority( $item, $nodefaults = false, $type = '' ) {&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'homepage' =&gt; '1.0', &nbsp;</div></li><li><div>              'blog' =&gt; '0.9', &nbsp;</div></li><li><div>              'sitemap' =&gt; '0.8', &nbsp;</div></li><li><div>              'post' =&gt; '0.7', &nbsp;</div></li><li><div>              'archive' =&gt; '0.5', &nbsp;</div></li><li><div>              'author' =&gt; '0.3', &nbsp;</div></li><li><div>              'taxonomies' =&gt; '0.3', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          static $cache = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;get_default_values( $defaults, 'prio_', $cache, $item, $nodefaults, $type );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get frequency settings for sitemap entries.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $item</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $nodefaults</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $type</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_default_frequency( $item, $nodefaults = false, $type = '' ) {&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'homepage' =&gt; 'always', &nbsp;</div></li><li><div>              'blog' =&gt; 'daily', &nbsp;</div></li><li><div>              'sitemap' =&gt; 'hourly', &nbsp;</div></li><li><div>              'post' =&gt; 'weekly', &nbsp;</div></li><li><div>              'archive' =&gt; 'monthly', &nbsp;</div></li><li><div>              'author' =&gt; 'weekly', &nbsp;</div></li><li><div>              'taxonomies' =&gt; 'monthly', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          static $cache = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;get_default_values( $defaults, 'freq_', $cache, $item, $nodefaults, $type );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Build an index of sitemaps used.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_sitemap_index_filenames() {&nbsp;</div></li><li><div>          $files = array();&nbsp;</div></li><li><div>          $options = $this-&gt;options;&nbsp;</div></li><li><div>          $prefix = $options[&quot;{$this-&gt;prefix}filename&quot;];&nbsp;</div></li><li><div>          $suffix = '.xml';&nbsp;</div></li><li><div>          if ( $options[&quot;{$this-&gt;prefix}gzipped&quot;] ) {&nbsp;</div></li><li><div>              $suffix .= '.gz';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}posttypes&quot;] = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}taxonomies&quot;] = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $options[&quot;{$this-&gt;prefix}posttypes&quot;] = array_diff( $options[&quot;{$this-&gt;prefix}posttypes&quot;], array( 'all' ) );&nbsp;</div></li><li><div>          $options[&quot;{$this-&gt;prefix}taxonomies&quot;] = array_diff( $options[&quot;{$this-&gt;prefix}taxonomies&quot;], array( 'all' ) );&nbsp;</div></li><li><div>          $url_base = trailingslashit( get_home_url() );&nbsp;</div></li><li><div>          $files[] = array( 'loc' =&gt; $url_base . $prefix . '_addl' . $suffix );&nbsp;</div></li><li><div>          if ( ! empty( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) ) {&nbsp;</div></li><li><div>              $prio = $this-&gt;get_default_priority( 'post' );&nbsp;</div></li><li><div>              $freq = $this-&gt;get_default_frequency( 'post' );&nbsp;</div></li><li><div>              $post_counts = $this-&gt;get_all_post_counts( array(&nbsp;</div></li><li><div>                  'post_type' =&gt; $options[&quot;{$this-&gt;prefix}posttypes&quot;], &nbsp;</div></li><li><div>                  'post_status' =&gt; 'publish', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              if ( ! is_array( $post_counts ) && is_array( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) && count( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) == 1 ) {&nbsp;</div></li><li><div>                  $post_counts = array( $options[&quot;{$this-&gt;prefix}posttypes&quot;][0] =&gt; $post_counts );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              foreach ( $options[&quot;{$this-&gt;prefix}posttypes&quot;] as $sm ) {&nbsp;</div></li><li><div>                  if ( 0 == $post_counts[ $sm ] ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( $this-&gt;paginate ) {&nbsp;</div></li><li><div>                      if ( $post_counts[ $sm ] &gt; $this-&gt;max_posts ) {&nbsp;</div></li><li><div>                          $count = 1;&nbsp;</div></li><li><div>                          for ( $post_count = 0; $post_count &lt; $post_counts[ $sm ]; $post_count += $this-&gt;max_posts ) {&nbsp;</div></li><li><div>                              $files[] = array(&nbsp;</div></li><li><div>                                  'loc' =&gt; $url_base . $prefix . '_' . $sm . '_' . ( $count ++ ) . $suffix, &nbsp;</div></li><li><div>                                  'priority' =&gt; $prio, &nbsp;</div></li><li><div>                                  'changefreq' =&gt; $freq, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $files[] = array(&nbsp;</div></li><li><div>                              'loc' =&gt; $url_base . $prefix . '_' . $sm . $suffix, &nbsp;</div></li><li><div>                              'priority' =&gt; $prio, &nbsp;</div></li><li><div>                              'changefreq' =&gt; $freq, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $files[] = array(&nbsp;</div></li><li><div>                          'loc' =&gt; $url_base . $prefix . '_' . $sm . $suffix, &nbsp;</div></li><li><div>                          'priority' =&gt; $prio, &nbsp;</div></li><li><div>                          'changefreq' =&gt; $freq, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'archive' ) ) {&nbsp;</div></li><li><div>              $files[] = array(&nbsp;</div></li><li><div>                  'loc' =&gt; $url_base . $prefix . '_archive' . $suffix, &nbsp;</div></li><li><div>                  'priority' =&gt; $this-&gt;get_default_priority( 'archive' ), &nbsp;</div></li><li><div>                  'changefreq' =&gt; $this-&gt;get_default_frequency( 'archive' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'author' ) ) {&nbsp;</div></li><li><div>              $files[] = array(&nbsp;</div></li><li><div>                  'loc' =&gt; $url_base . $prefix . '_author' . $suffix, &nbsp;</div></li><li><div>                  'priority' =&gt; $this-&gt;get_default_priority( 'author' ), &nbsp;</div></li><li><div>                  'changefreq' =&gt; $this-&gt;get_default_frequency( 'author' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) ) {&nbsp;</div></li><li><div>              foreach ( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] as $sm ) {&nbsp;</div></li><li><div>                  $term_count = wp_count_terms( $sm, array( 'hide_empty' =&gt; true ) );&nbsp;</div></li><li><div>                  if ( ! is_wp_error( $term_count ) && ( $term_count &gt; 0 ) ) {&nbsp;</div></li><li><div>                      if ( $this-&gt;paginate ) {&nbsp;</div></li><li><div>                          if ( $term_count &gt; $this-&gt;max_posts ) {&nbsp;</div></li><li><div>                              $count = 1;&nbsp;</div></li><li><div>                              for ( $tc = 0; $tc &lt; $term_count; $tc += $this-&gt;max_posts ) {&nbsp;</div></li><li><div>                                  $files[] = array(&nbsp;</div></li><li><div>                                      'loc' =&gt; $url_base . $prefix . '_' . $sm . '_' . ( $count ++ ) . $suffix, &nbsp;</div></li><li><div>                                      'priority' =&gt; $this-&gt;get_default_priority( 'taxonomies' ), &nbsp;</div></li><li><div>                                      'changefreq' =&gt; $this-&gt;get_default_frequency( 'taxonomies' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $files[] = array(&nbsp;</div></li><li><div>                                  'loc' =&gt; $url_base . $prefix . '_' . $sm . $suffix, &nbsp;</div></li><li><div>                                  'priority' =&gt; $this-&gt;get_default_priority( 'taxonomies' ), &nbsp;</div></li><li><div>                                  'changefreq' =&gt; $this-&gt;get_default_frequency( 'taxonomies' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $files[] = array(&nbsp;</div></li><li><div>                              'loc' =&gt; $url_base . $prefix . '_' . $sm . $suffix, &nbsp;</div></li><li><div>                              'priority' =&gt; $this-&gt;get_default_priority( 'taxonomies' ), &nbsp;</div></li><li><div>                              'changefreq' =&gt; $this-&gt;get_default_frequency( 'taxonomies' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ( $this-&gt;get_child_sitemap_urls() as $csm ) {&nbsp;</div></li><li><div>              $files[] = array(&nbsp;</div></li><li><div>                  'loc' =&gt; $csm, &nbsp;</div></li><li><div>                  'priority' =&gt; $this-&gt;get_default_priority( 'sitemap' ), &nbsp;</div></li><li><div>                  'changefreq' =&gt; $this-&gt;get_default_frequency( 'sitemap' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $files;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Build the sitemap.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $sitemap_type</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $page</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $filename</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_build_sitemap( $sitemap_type, $page = 0, $filename = '', $comment = '' ) {&nbsp;</div></li><li><div>          if ( empty( $filename ) ) {&nbsp;</div></li><li><div>              if ( 'root' === $sitemap_type ) {&nbsp;</div></li><li><div>                  $filename = $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $filename = $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '_' . $sitemap_type;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $comment ) ) {&nbsp;</div></li><li><div>              $comment = &quot;file '%s' statically&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $sitemap_data = $this-&gt;get_sitemap_data( $sitemap_type, $page );&nbsp;</div></li><li><div>          if ( ( 'root' === $sitemap_type ) && ! empty( $this-&gt;options[&quot;{$this-&gt;prefix}indexes&quot;] ) ) {&nbsp;</div></li><li><div>              return $this-&gt;build_sitemap_index( $sitemap_data, sprintf( $comment, $filename ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return $this-&gt;build_sitemap( $sitemap_data, sprintf( $comment, $filename ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Write the sitemap.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $sitemap_type</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $page</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $filename</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_write_sitemap( $sitemap_type, $page = 0, $filename = '', $comment = '' ) {&nbsp;</div></li><li><div>          if ( empty( $filename ) ) {&nbsp;</div></li><li><div>              if ( 'root' === $sitemap_type ) {&nbsp;</div></li><li><div>                  $filename = $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $filename = $this-&gt;options[&quot;{$this-&gt;prefix}filename&quot;] . '_' . $sitemap_type;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $comment ) ) {&nbsp;</div></li><li><div>              $comment = &quot;file '%s' statically&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;write_sitemaps( $filename, $this-&gt;do_build_sitemap( $sitemap_type, $page, $filename, $comment ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Build all the indexes.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_indexed_sitemaps() {&nbsp;</div></li><li><div>          $this-&gt;start_memory_usage = memory_get_peak_usage();&nbsp;</div></li><li><div>          $options = $this-&gt;options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;do_write_sitemap( 'root' );&nbsp;</div></li><li><div>          $this-&gt;do_write_sitemap( 'addl' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'archive' ) ) {&nbsp;</div></li><li><div>              $this-&gt;do_write_sitemap( 'archive' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'author' ) ) {&nbsp;</div></li><li><div>              $this-&gt;do_write_sitemap( 'author' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ( ! isset( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) ) || ( ! is_array( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}posttypes&quot;] = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ( ! isset( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) ) || ( ! is_array( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}taxonomies&quot;] = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $options[&quot;{$this-&gt;prefix}posttypes&quot;] = array_diff( $options[&quot;{$this-&gt;prefix}posttypes&quot;], array( 'all' ) );&nbsp;</div></li><li><div>          $options[&quot;{$this-&gt;prefix}taxonomies&quot;] = array_diff( $options[&quot;{$this-&gt;prefix}taxonomies&quot;], array( 'all' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) ) {&nbsp;</div></li><li><div>              $post_counts = $this-&gt;get_all_post_counts( array(&nbsp;</div></li><li><div>                  'post_type' =&gt; $options[&quot;{$this-&gt;prefix}posttypes&quot;], &nbsp;</div></li><li><div>                  'post_status' =&gt; 'publish', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              foreach ( $options[&quot;{$this-&gt;prefix}posttypes&quot;] as $posttype ) {&nbsp;</div></li><li><div>                  if ( 0 === $post_counts[ $posttype ] ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( $this-&gt;paginate && ( $post_counts[ $posttype ] &gt; $this-&gt;max_posts ) ) {&nbsp;</div></li><li><div>                      $count = 1;&nbsp;</div></li><li><div>                      for ( $post_count = 0; $post_count &lt; $post_counts[ $posttype ]; $post_count += $this-&gt;max_posts ) {&nbsp;</div></li><li><div>                          $this-&gt;do_write_sitemap( $posttype, $count - 1, $options[&quot;{$this-&gt;prefix}filename&quot;] . &quot;_{$posttype}_{$count}&quot; );&nbsp;</div></li><li><div>                          $count ++;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;do_write_sitemap( $posttype );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) ) {&nbsp;</div></li><li><div>              foreach ( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] as $taxonomy ) {&nbsp;</div></li><li><div>                  $term_count = wp_count_terms( $taxonomy, array( 'hide_empty' =&gt; true ) );&nbsp;</div></li><li><div>                  if ( ! is_wp_error( $term_count ) && ( $term_count &gt; 0 ) ) {&nbsp;</div></li><li><div>                      if ( $this-&gt;paginate ) {&nbsp;</div></li><li><div>                          if ( $term_count &gt; $this-&gt;max_posts ) {&nbsp;</div></li><li><div>                              $count = 1;&nbsp;</div></li><li><div>                              for ( $tc = 0; $tc &lt; $term_count; $tc += $this-&gt;max_posts ) {&nbsp;</div></li><li><div>                                  $this-&gt;do_write_sitemap( $taxonomy, $tc, $options[&quot;{$this-&gt;prefix}filename&quot;] . &quot;_{$taxonomy}_{$count}&quot; );&nbsp;</div></li><li><div>                                  $count ++;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;do_write_sitemap( $taxonomy );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;do_write_sitemap( $taxonomy );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;log_stats( 'indexed', $options[&quot;{$this-&gt;prefix}gzipped&quot;], false );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get simple sitemap.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_simple_sitemap() {&nbsp;</div></li><li><div>          $home = array(&nbsp;</div></li><li><div>              'loc' =&gt; get_home_url(), &nbsp;</div></li><li><div>              'priority' =&gt; $this-&gt;get_default_priority( 'homepage' ), &nbsp;</div></li><li><div>              'changefreq' =&gt; $this-&gt;get_default_frequency( 'homepage' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $posts = get_option( 'page_for_posts' );&nbsp;</div></li><li><div>          $this-&gt;paginate = false;&nbsp;</div></li><li><div>          if ( $posts ) {&nbsp;</div></li><li><div>              $posts = $this-&gt;get_permalink( $posts );&nbsp;</div></li><li><div>              if ( $posts == $home['loc'] ) {&nbsp;</div></li><li><div>                  $posts = null;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $posts = array(&nbsp;</div></li><li><div>                      'loc' =&gt; $posts, &nbsp;</div></li><li><div>                      'priority' =&gt; $this-&gt;get_default_priority( 'blog' ), &nbsp;</div></li><li><div>                      'changefreq' =&gt; $this-&gt;get_default_frequency( 'blog' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $child = $this-&gt;get_child_sitemap_urls();&nbsp;</div></li><li><div>          $options = $this-&gt;options;&nbsp;</div></li><li><div>          if ( is_array( $options[&quot;{$this-&gt;prefix}posttypes&quot;] ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}posttypes&quot;] = array_diff( $options[&quot;{$this-&gt;prefix}posttypes&quot;], array( 'all' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $options[&quot;{$this-&gt;prefix}taxonomies&quot;] ) ) {&nbsp;</div></li><li><div>              $options[&quot;{$this-&gt;prefix}taxonomies&quot;] = array_diff( $options[&quot;{$this-&gt;prefix}taxonomies&quot;], array( 'all' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $prio = $this-&gt;get_all_post_priority_data( $options[&quot;{$this-&gt;prefix}posttypes&quot;] );&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'archive' ) ) {&nbsp;</div></li><li><div>              $prio = array_merge( $prio, $this-&gt;get_archive_prio_data() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'author' ) ) {&nbsp;</div></li><li><div>              $prio = array_merge( $prio, $this-&gt;get_author_prio_data() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ( $prio as $k =&gt; $p ) {&nbsp;</div></li><li><div>              if ( untrailingslashit( $p['loc'] ) === untrailingslashit( $home['loc'] ) ) {&nbsp;</div></li><li><div>                  $prio[ $k ]['priority'] = '1.0';&nbsp;</div></li><li><div>                  $home = null;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ( null != $posts ) && isset( $posts['loc'] ) ) {&nbsp;</div></li><li><div>              foreach ( $prio as $k =&gt; $p ) {&nbsp;</div></li><li><div>                  if ( $p['loc'] === $posts['loc'] ) {&nbsp;</div></li><li><div>                      $prio[ $k ]['priority'] = $this-&gt;get_default_priority( 'blog' );&nbsp;</div></li><li><div>                      $prio[ $k ]['changefreq'] = $this-&gt;get_default_frequency( 'blog' );&nbsp;</div></li><li><div>                      $posts = null;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              array_unshift( $prio, $posts );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $home ) ) {&nbsp;</div></li><li><div>              array_unshift( $prio, $home );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $terms = get_terms( $options[&quot;{$this-&gt;prefix}taxonomies&quot;], $this-&gt;get_tax_args() );&nbsp;</div></li><li><div>          $prio2 = $this-&gt;get_term_priority_data( $terms );&nbsp;</div></li><li><div>          $prio3 = $this-&gt;get_addl_pages_only();&nbsp;</div></li><li><div>          $prio = array_merge( $child, $prio, $prio2, $prio3 );&nbsp;</div></li><li><div>          if ( is_array( $this-&gt;extra_sitemaps ) ) {&nbsp;</div></li><li><div>              foreach ( $this-&gt;extra_sitemaps as $sitemap_type ) {&nbsp;</div></li><li><div>                  $sitemap_data = array();&nbsp;</div></li><li><div>                  $sitemap_data = apply_filters( $this-&gt;prefix . 'custom_' . $sitemap_type, $sitemap_data, $page, $this_options );&nbsp;</div></li><li><div>                  $prio = array_merge( $prio, $sitemap_data );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $prio;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Build a single, stand-alone sitemap without indexes.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function do_simple_sitemap( $comment = '' ) {&nbsp;</div></li><li><div>          $sitemap_data = $this-&gt;get_simple_sitemap();&nbsp;</div></li><li><div>          $sitemap_data = apply_filters( $this-&gt;prefix . 'data', $sitemap_data, 'root', 0, $this-&gt;options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;build_sitemap( $sitemap_data, $comment );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Gets the sitemap URL.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Has a filter for using something other than the dynamically generated one.</span>&nbsp;</div></li><li><div><span class="comment">       * Using the filter you need the full path to the custom xsl file.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see   https://semperplugins.com/documentation/aioseop_sitemap_xsl_url/</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.3.6</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_sitemap_xsl() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return esc_url( apply_filters( 'aioseop_sitemap_xsl_url', home_url( '/sitemap.xsl' ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Output the XML for a sitemap.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $urls</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function output_sitemap( $urls, $comment = '' ) {&nbsp;</div></li><li><div>          $max_items = 50000;&nbsp;</div></li><li><div>          if ( ! is_array( $urls ) ) {&nbsp;</div></li><li><div>              return null;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;' . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          echo '&lt;!-- ' . sprintf( $this-&gt;comment_string, $comment, AIOSEOP_VERSION, date( 'D, d M Y H:i:s e' ) ) . &quot; --&gt;\r\n&quot;;&nbsp;</div></li><li><div>          $plugin_path = $this-&gt;plugin_path['url'];&nbsp;</div></li><li><div>          $plugin_url = parse_url( $plugin_path );&nbsp;</div></li><li><div>          $current_host = $_SERVER['HTTP_HOST'];&nbsp;</div></li><li><div>          if ( empty( $current_host ) ) {&nbsp;</div></li><li><div>              $current_host = $_SERVER['SERVER_NAME'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $current_host ) && ( $current_host !== $plugin_url['host'] ) ) {&nbsp;</div></li><li><div>              $plugin_url['host'] = $current_host;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Code unset( $plugin_url['scheme'] );.</span>&nbsp;</div></li><li><div>          $plugin_path = $this-&gt;unparse_url( $plugin_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Using the filter you need the full path to the custom xsl file.</span>&nbsp;</div></li><li><div>          $xsl_url = $this-&gt;get_sitemap_xsl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $xml_header = '&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;' . $xsl_url . '&quot;?&gt;' . &quot;\r\n&quot;&nbsp;</div></li><li><div>                        . '&lt;urlset ';&nbsp;</div></li><li><div>          $namespaces = apply_filters( $this-&gt;prefix . 'xml_namespace', array( 'xmlns' =&gt; 'http:<span class="comment">//www.sitemaps.org/schemas/sitemap/0.9' ) );</span>&nbsp;</div></li><li><div>          if ( ! empty( $namespaces ) ) {&nbsp;</div></li><li><div>              $ns = array();&nbsp;</div></li><li><div>              foreach ( $namespaces as $k =&gt; $v ) {&nbsp;</div></li><li><div>                  $ns[] = esc_attr( $k ) . '=' . '&quot;' . esc_url( $v, array( 'http', 'https' ) ) . '&quot;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $xml_header .= join( &quot;\r\n\t&quot;, $ns );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $xml_header .= '&gt;' . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          echo $xml_header;&nbsp;</div></li><li><div>          $count = 0;&nbsp;</div></li><li><div>          foreach ( $urls as $url ) {&nbsp;</div></li><li><div>              echo &quot;\t&lt;url&gt;\r\n&quot;;&nbsp;</div></li><li><div>              if ( is_array( $url ) ) {&nbsp;</div></li><li><div>                  foreach ( $url as $k =&gt; $v ) {&nbsp;</div></li><li><div>                      if ( ! empty( $v ) ) {&nbsp;</div></li><li><div>                          if ( 'loc' === $k ) {&nbsp;</div></li><li><div>                              $v = esc_url( $v );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ( is_array( $v ) ) {&nbsp;</div></li><li><div>                              $buf = &quot;\t\t\t&lt;$k&gt;\r\n&quot;;&nbsp;</div></li><li><div>                              foreach ( $v as $ext =&gt; $attr ) {&nbsp;</div></li><li><div>                                  if ( is_array( $attr ) ) {&nbsp;</div></li><li><div>                                      $buf = '';&nbsp;</div></li><li><div>                                      echo &quot;\t\t&lt;$k&gt;\r\n&quot;;&nbsp;</div></li><li><div>                                      foreach ( $attr as $a =&gt; $nested ) {&nbsp;</div></li><li><div>                                          if ( is_array( $nested ) ) {&nbsp;</div></li><li><div>                                              echo &quot;\t\t\t&lt;$a&gt;\r\n&quot;;&nbsp;</div></li><li><div>                                              foreach ( $nested as $next =&gt; $nattr ) {&nbsp;</div></li><li><div>                                                  echo &quot;\t\t\t\t&lt;$next&gt;$nattr&lt;/$next&gt;\r\n&quot;;&nbsp;</div></li><li><div>                                              }&nbsp;</div></li><li><div>                                              echo &quot;\t\t\t&lt;/$a&gt;\r\n&quot;;&nbsp;</div></li><li><div>                                          } else {&nbsp;</div></li><li><div>                                              echo &quot;\t\t\t&lt;$a&gt;$nested&lt;/$a&gt;\r\n&quot;;&nbsp;</div></li><li><div>                                          }&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      echo &quot;\t\t&lt;/$k&gt;\r\n&quot;;&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $buf .= &quot;\t\t\t&lt;$ext&gt;$attr&lt;/$ext&gt;\r\n&quot;;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ( ! empty( $buf ) ) {&nbsp;</div></li><li><div>                                  echo $buf . &quot;\t\t&lt;/$k&gt;\r\n&quot;;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              echo &quot;\t\t&lt;$k&gt;$v&lt;/$k&gt;\r\n&quot;;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  echo &quot;\t\t&lt;loc&gt;&quot; . esc_url( $url ) . &quot;&lt;/loc&gt;\r\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo &quot;\t&lt;/url&gt;\r\n&quot;;&nbsp;</div></li><li><div>              if ( $count &gt;= $max_items ) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/urlset&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Output the XML for a sitemap index.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $urls</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function output_sitemap_index( $urls, $comment = '' ) {&nbsp;</div></li><li><div>          $max_items = 50000;&nbsp;</div></li><li><div>          if ( ! is_array( $urls ) ) {&nbsp;</div></li><li><div>              return null;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;' . &quot;\r\n\r\n&quot;;&nbsp;</div></li><li><div>          echo '&lt;!-- ' . sprintf( $this-&gt;comment_string, $comment, AIOSEOP_VERSION, date( 'D, d M Y H:i:s e' ) ) . &quot; --&gt;\r\n&quot;;&nbsp;</div></li><li><div>          $xsl_url = $this-&gt;get_sitemap_xsl();&nbsp;</div></li><li><div>          echo '&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;' . $xsl_url . '&quot;?&gt;' . &quot;\r\n&quot;;&nbsp;</div></li><li><div>          echo '&lt;sitemapindex xmlns=&quot;http:<span class="comment">//www.sitemaps.org/schemas/sitemap/0.9&quot;&gt;' . &quot;\r\n&quot;;</span>&nbsp;</div></li><li><div>          $count = 0;&nbsp;</div></li><li><div>          foreach ( $urls as $url ) {&nbsp;</div></li><li><div>              echo &quot;\t&lt;sitemap&gt;\r\n&quot;;&nbsp;</div></li><li><div>              if ( is_array( $url ) ) {&nbsp;</div></li><li><div>                  foreach ( $url as $k =&gt; $v ) {&nbsp;</div></li><li><div>                      if ( 'loc' === $k ) {&nbsp;</div></li><li><div>                          echo &quot;\t\t&lt;$k&gt;&quot; . esc_url( $v ) . &quot;&lt;/$k&gt;\r\n&quot;;&nbsp;</div></li><li><div>                      } elseif ( 'lastmod' === $k ) {&nbsp;</div></li><li><div>                          echo &quot;\t\t&lt;$k&gt;$v&lt;/$k&gt;\r\n&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  echo &quot;\t\t&lt;loc&gt;&quot; . esc_url( $url ) . &quot;&lt;/loc&gt;\r\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo &quot;\t&lt;/sitemap&gt;\r\n&quot;;&nbsp;</div></li><li><div>              $count ++;&nbsp;</div></li><li><div>              if ( $count &gt;= $max_items ) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/sitemapindex&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return an XML sitemap index as a string.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $urls</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function build_sitemap_index( $urls, $comment = '' ) {&nbsp;</div></li><li><div>          ob_start();&nbsp;</div></li><li><div>          $this-&gt;output_sitemap_index( $urls, $comment );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return ob_get_clean();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return an XML sitemap as a string.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $urls</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function build_sitemap( $urls, $comment = '' ) {&nbsp;</div></li><li><div>          ob_start();&nbsp;</div></li><li><div>          $this-&gt;output_sitemap( $urls, $comment );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return ob_get_clean();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return sitemap data for an array of terms.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $terms</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_term_priority_data( $terms ) {&nbsp;</div></li><li><div>          $prio = array();&nbsp;</div></li><li><div>          if ( is_array( $terms ) ) {&nbsp;</div></li><li><div>              $def_prio = $this-&gt;get_default_priority( 'taxonomies' );&nbsp;</div></li><li><div>              $def_freq = $this-&gt;get_default_frequency( 'taxonomies' );&nbsp;</div></li><li><div>              foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                  $pr_info = array();&nbsp;</div></li><li><div>                  $pr_info['loc'] = $this-&gt;get_term_link( $term, $term-&gt;taxonomy );&nbsp;</div></li><li><div>                  if ( ( 'sel' === $this-&gt;options[ $this-&gt;prefix . 'prio_taxonomies' ] ) && isset( $this-&gt;options[ $this-&gt;prefix . 'prio_taxonomies_' . $term-&gt;taxonomy ] ) && ( 'no' != $this-&gt;options[ $this-&gt;prefix . 'prio_taxonomies_' . $term-&gt;taxonomy ] ) ) {&nbsp;</div></li><li><div>                      $pr_info['priority'] = $this-&gt;options[ $this-&gt;prefix . 'prio_taxonomies_' . $term-&gt;taxonomy ];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $pr_info['priority'] = $def_prio;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ( 'sel' === $this-&gt;options[ $this-&gt;prefix . 'freq_taxonomies' ] ) && isset( $this-&gt;options[ $this-&gt;prefix . 'freq_taxonomies_' . $term-&gt;taxonomy ] ) && ( 'no' != $this-&gt;options[ $this-&gt;prefix . 'freq_taxonomies_' . $term-&gt;taxonomy ] ) ) {&nbsp;</div></li><li><div>                      $pr_info['changefreq'] = $this-&gt;options[ $this-&gt;prefix . 'freq_taxonomies_' . $term-&gt;taxonomy ];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $pr_info['changefreq'] = $def_freq;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $prio[] = $pr_info;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $prio;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return a list of permalinks for an array of terms.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $terms</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_term_permalinks( $terms ) {&nbsp;</div></li><li><div>          $links = array();&nbsp;</div></li><li><div>          if ( is_array( $terms ) ) {&nbsp;</div></li><li><div>              foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                  $url = $this-&gt;get_term_link( $term );&nbsp;</div></li><li><div>                  $links[] = $url;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $links;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return permalinks for archives.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $posts</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_archive_permalinks( $posts ) {&nbsp;</div></li><li><div>          $links = array();&nbsp;</div></li><li><div>          $archives = array();&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $post ) {&nbsp;</div></li><li><div>                  $date = mysql2date( 'U', $post-&gt;post_date );&nbsp;</div></li><li><div>                  $year = date( 'Y', $date );&nbsp;</div></li><li><div>                  $month = date( 'm', $date );&nbsp;</div></li><li><div>                  $archives[ $year . '-' . $month ] = array( $year, $month );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $archives = array_keys( $archives );&nbsp;</div></li><li><div>          foreach ( $archives as $d ) {&nbsp;</div></li><li><div>              $links[] = get_month_link( $d[0], $d[1] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $links;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return permalinks for authors.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $posts</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_author_permalinks( $posts ) {&nbsp;</div></li><li><div>          $links = array();&nbsp;</div></li><li><div>          $authors = array();&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $post ) {&nbsp;</div></li><li><div>                  $authors[ $post-&gt;author_id ] = 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $authors = array_keys( $authors );&nbsp;</div></li><li><div>          foreach ( $authors as $auth_id ) {&nbsp;</div></li><li><div>              $links[] = get_author_posts_url( $auth_id );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $links;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return permalinks for posts.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $posts</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_post_permalinks( $posts ) {&nbsp;</div></li><li><div>          $links = array();&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $post ) {&nbsp;</div></li><li><div>                  $post-&gt;filter = 'sample';&nbsp;</div></li><li><div>                  $url = $this-&gt;get_permalink( $post );&nbsp;</div></li><li><div>                  $links[] = $url;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $links;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Convert back from parse_url.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Props to thomas at gielfeldt dot com.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @link http://www.php.net/manual/en/function.parse-url.php#106731</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $parsed_url</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function unparse_url( $parsed_url ) {&nbsp;</div></li><li><div>          $scheme = isset( $parsed_url['scheme'] ) ? $parsed_url['scheme'] . ':<span class="comment">//' : '';</span>&nbsp;</div></li><li><div>          $host = isset( $parsed_url['host'] ) ? $parsed_url['host'] : '';&nbsp;</div></li><li><div>          if ( ! empty( $host ) && empty( $scheme ) ) {&nbsp;</div></li><li><div>              $scheme = '<span class="comment">//';</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $port = isset( $parsed_url['port'] ) ? ':' . $parsed_url['port'] : '';&nbsp;</div></li><li><div>          $user = isset( $parsed_url['user'] ) ? $parsed_url['user'] : '';&nbsp;</div></li><li><div>          $pass = isset( $parsed_url['pass'] ) ? ':' . $parsed_url['pass'] : '';&nbsp;</div></li><li><div>          $pass = ( $user || $pass ) ? &quot;$pass@&quot; : '';&nbsp;</div></li><li><div>          $path = isset( $parsed_url['path'] ) ? $parsed_url['path'] : '';&nbsp;</div></li><li><div>          $query = isset( $parsed_url['query'] ) ? '?' . $parsed_url['query'] : '';&nbsp;</div></li><li><div>          $fragment = isset( $parsed_url['fragment'] ) ? '#' . $parsed_url['fragment'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return &quot;$scheme$user$pass$host$port$path$query$fragment&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Gets additional pages.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Return data for user entered additional pages.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array|mixed|void</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_addl_pages_only() {&nbsp;</div></li><li><div>          $pages = array();&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;options[ $this-&gt;prefix . 'addl_pages' ] ) ) {&nbsp;</div></li><li><div>              $siteurl = parse_url( get_home_url() );&nbsp;</div></li><li><div>              foreach ( $this-&gt;options[ $this-&gt;prefix . 'addl_pages' ] as $k =&gt; $v ) {&nbsp;</div></li><li><div>                  $url = parse_url( $k );&nbsp;</div></li><li><div>                  if ( empty( $url['scheme'] ) ) {&nbsp;</div></li><li><div>                      $url['scheme'] = $siteurl['scheme'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( empty( $url['host'] ) ) {&nbsp;</div></li><li><div>                      $url['host'] = $siteurl['host'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ! empty( $url['path'] ) && substr( $url['path'], 0, 1 ) !== '/' ) {&nbsp;</div></li><li><div>                      $url['path'] = '/' . $url['path'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $freq = $prio = $mod = '';&nbsp;</div></li><li><div>                  if ( ! empty( $v['mod'] ) ) {&nbsp;</div></li><li><div>                      $mod = $v['mod'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ! empty( $v['freq'] ) ) {&nbsp;</div></li><li><div>                      $freq = $v['freq'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ! empty( $v['prio'] ) ) {&nbsp;</div></li><li><div>                      $prio = $v['prio'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( 'no' == $freq ) {&nbsp;</div></li><li><div>                      $freq = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( 'no' == $prio ) {&nbsp;</div></li><li><div>                      $prio = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $mod = date( 'Y-m-d\TH:i:s\Z', mysql2date( 'U', $mod ) );&nbsp;</div></li><li><div>                  $pages[] = array(&nbsp;</div></li><li><div>                      'loc' =&gt; $this-&gt;unparse_url( $url ), &nbsp;</div></li><li><div>                      'lastmod' =&gt; $mod, &nbsp;</div></li><li><div>                      'changefreq' =&gt; $freq, &nbsp;</div></li><li><div>                      'priority' =&gt; $prio, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pages = apply_filters( $this-&gt;prefix . 'addl_pages_only', $pages );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $pages;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return data for user entered additional pages and extra pages.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array|mixed|void</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_addl_pages() {&nbsp;</div></li><li><div>          $home = array();&nbsp;</div></li><li><div>          $home = array(&nbsp;</div></li><li><div>              'loc' =&gt; get_home_url(), &nbsp;</div></li><li><div>              'priority' =&gt; $this-&gt;get_default_priority( 'homepage' ), &nbsp;</div></li><li><div>              'changefreq' =&gt; $this-&gt;get_default_frequency( 'homepage' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $posts = get_option( 'page_for_posts' );&nbsp;</div></li><li><div>          if ( $posts ) {&nbsp;</div></li><li><div>              $posts = $this-&gt;get_permalink( $posts );&nbsp;</div></li><li><div>              if ( $posts == $home['loc'] ) {&nbsp;</div></li><li><div>                  $posts = array();&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $posts = array(&nbsp;</div></li><li><div>                      'loc' =&gt; $posts, &nbsp;</div></li><li><div>                      'priority' =&gt; $this-&gt;get_default_priority( 'blog' ), &nbsp;</div></li><li><div>                      'changefreq' =&gt; $this-&gt;get_default_frequency( 'blog' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $posts = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pages = $this-&gt;get_addl_pages_only();&nbsp;</div></li><li><div>          if ( ! empty( $home ) ) {&nbsp;</div></li><li><div>              $pages[] = $home;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! empty( $posts ) ) {&nbsp;</div></li><li><div>              $pages[] = $posts;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pages = apply_filters( $this-&gt;prefix . 'addl_pages', $pages );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $pages;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return links for user entered additional pages.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_addl_page_links() {&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;options[ $this-&gt;prefix . 'addl_pages' ] ) ) {&nbsp;</div></li><li><div>              return array_keys( $this-&gt;options[ $this-&gt;prefix . 'addl_pages' ] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Scores posts based on date and relative comment count, if any.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param     $date</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $stats</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_prio_calc( $date, $stats = 0 ) {&nbsp;</div></li><li><div>          static $cur_time = null;&nbsp;</div></li><li><div>          if ( null === $cur_time ) {&nbsp;</div></li><li><div>              $cur_time = time();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $time = $cur_time - mysql2date( 'U', $date );&nbsp;</div></li><li><div>          if ( ! empty( $stats ) && isset( $stats['max'] ) && $stats['max'] ) {&nbsp;</div></li><li><div>              $minadj = $time &gt;&gt; 3;&nbsp;</div></li><li><div>              $maxadj = $time &gt;&gt; 1;&nbsp;</div></li><li><div>              $avg = $stats['count'] / $stats['total'];&nbsp;</div></li><li><div>              $calc = ( $stats['comment_count'] - $stats['min'] ) / $stats['max'];&nbsp;</div></li><li><div>              $calc = $maxadj * $calc;&nbsp;</div></li><li><div>              if ( $avg &lt; $stats['comment_count'] ) {&nbsp;</div></li><li><div>                  $minadj = $time &gt;&gt; 2;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $maxadj = $time &gt;&gt; 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $calc &gt; $maxadj ) {&nbsp;</div></li><li><div>                  $calc = $maxadj;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $calc &lt; $minadj ) {&nbsp;</div></li><li><div>                  $calc = $minadj;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $time -= $calc;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $days = $time / ( 60 * 60 * 24 );&nbsp;</div></li><li><div>          $prio_table = array(&nbsp;</div></li><li><div>              'daily' =&gt; 7, &nbsp;</div></li><li><div>              'weekly' =&gt; 30, &nbsp;</div></li><li><div>              'monthly' =&gt; 210, &nbsp;</div></li><li><div>              'yearly' =&gt; null, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $interval = 1.0;&nbsp;</div></li><li><div>          $prev_days = 0;&nbsp;</div></li><li><div>          foreach ( $prio_table as $change =&gt; $max_days ) {&nbsp;</div></li><li><div>              $interval -= 0.3;&nbsp;</div></li><li><div>              if ( null === $max_days ) {&nbsp;</div></li><li><div>                  $changefreq = $change;&nbsp;</div></li><li><div>                  $prio = 0.1;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $days &lt; $max_days ) {&nbsp;</div></li><li><div>                  $int_days_max = $max_days - $prev_days;&nbsp;</div></li><li><div>                  $int_days = $days - $prev_days;&nbsp;</div></li><li><div>                  $prio = $interval + ( (int) ( 3 * ( ( $max_days - $int_days ) / $int_days_max ) ) / 10.0 );&nbsp;</div></li><li><div>                  $changefreq = $change;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $prev_days = $max_days;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return array( 'lastmod' =&gt; $date, 'changefreq' =&gt; $changefreq, 'priority' =&gt; $prio );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Generate sitemap priority data for archives from an array of posts.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $posts</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_archive_prio_from_posts( $posts ) {&nbsp;</div></li><li><div>          $archives = array();&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $p ) {&nbsp;</div></li><li><div>                  if ( 'post' !== $p-&gt;post_type ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $date = date( 'Y-m', mysql2date( 'U', $p-&gt;post_date ) );&nbsp;</div></li><li><div>                  if ( empty( $archives[ $date ] ) ) {&nbsp;</div></li><li><div>                      $archives[ $date ] = $p;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ( $p-&gt;post_modified &gt; $archives[ $date ]-&gt;post_modified ) {&nbsp;</div></li><li><div>                          $archives[ $date ] = $p;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! empty( $archives ) ) {&nbsp;</div></li><li><div>              return $this-&gt;get_prio_from_posts( $archives, $this-&gt;get_default_priority( 'archive', true ), $this-&gt;get_default_frequency( 'archive', true ), array(&nbsp;</div></li><li><div>                  $this, &nbsp;</div></li><li><div>                  'get_archive_link_from_post', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $archives;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return an archive link from a post.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $post</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool|string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_archive_link_from_post( $post ) {&nbsp;</div></li><li><div>          if ( 'post' !== $post-&gt;post_type ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $date = mysql2date( 'U', $post-&gt;post_date );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return get_month_link( date( 'Y', $date ), date( 'm', $date ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Generate sitemap priority data for authors from an array of posts.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $posts</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_author_prio_from_posts( $posts ) {&nbsp;</div></li><li><div>          $authors = array();&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $p ) {&nbsp;</div></li><li><div>                  if ( 'post' !== $p-&gt;post_type ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( empty( $authors[ $p-&gt;post_author ] ) ) {&nbsp;</div></li><li><div>                      $authors[ $p-&gt;post_author ] = $p;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ( $p-&gt;post_modified &gt; $authors[ $p-&gt;post_author ]-&gt;post_modified ) {&nbsp;</div></li><li><div>                          $authors[ $p-&gt;post_author ] = $p;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;get_prio_from_posts( $authors, $this-&gt;get_default_priority( 'author', true ), $this-&gt;get_default_frequency( 'author', true ), array(&nbsp;</div></li><li><div>              $this, &nbsp;</div></li><li><div>              'get_author_link_from_post', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return an author link from a post.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $post</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_author_link_from_post( $post ) {&nbsp;</div></li><li><div>          return get_author_posts_url( $post-&gt;post_author );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return comment statistics on an array of posts.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $posts</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array|int</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_comment_count_stats( $posts ) {&nbsp;</div></li><li><div>          $count = 0;&nbsp;</div></li><li><div>          $total = 0.0;&nbsp;</div></li><li><div>          $min = null;&nbsp;</div></li><li><div>          $max = 0;&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $post ) {&nbsp;</div></li><li><div>                  if ( ! empty( $post-&gt;comment_count ) ) {&nbsp;</div></li><li><div>                      $cnt = $post-&gt;comment_count;&nbsp;</div></li><li><div>                      $count ++;&nbsp;</div></li><li><div>                      $total += $cnt;&nbsp;</div></li><li><div>                      if ( null === $min ) {&nbsp;</div></li><li><div>                          $min = $cnt;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( $max &lt; $cnt ) {&nbsp;</div></li><li><div>                          $max = $cnt;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( $min &gt; $cnt ) {&nbsp;</div></li><li><div>                          $min = $cnt;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $count ) {&nbsp;</div></li><li><div>              return array( 'max' =&gt; $max, 'min' =&gt; $min, 'total' =&gt; $total, 'count' =&gt; $cnt );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Generate sitemap priority data from an array of posts.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $posts</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $prio_override</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $freq_override</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $linkfunc</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_prio_from_posts( $posts, $prio_override = false, $freq_override = false, $linkfunc = 'get_permalink' ) {&nbsp;</div></li><li><div>          $prio = array();&nbsp;</div></li><li><div>          $args = array(&nbsp;</div></li><li><div>              'prio_override' =&gt; $prio_override, &nbsp;</div></li><li><div>              'freq_override' =&gt; $freq_override, &nbsp;</div></li><li><div>              'linkfunc' =&gt; $linkfunc, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          if ( $prio_override && $freq_override ) {&nbsp;</div></li><li><div>              $stats = 0;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $stats = $this-&gt;get_comment_count_stats( $posts );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $posts ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $post ) {&nbsp;</div></li><li><div>                  $url = '';&nbsp;</div></li><li><div>                  $post-&gt;filter = 'sample';&nbsp;</div></li><li><div>                  if ( 'get_permalink' === $linkfunc ) {&nbsp;</div></li><li><div>                      $url = $this-&gt;get_permalink( $post );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $url = call_user_func( $linkfunc, $post );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $date = $post-&gt;post_modified;&nbsp;</div></li><li><div>                  if ( '0000-00-00 00:00:00' === $date ) {&nbsp;</div></li><li><div>                      $date = $post-&gt;post_date;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( '0000-00-00 00:00:00' !== $date ) {&nbsp;</div></li><li><div>                      $date = date( 'Y-m-d\TH:i:s\Z', mysql2date( 'U', $date ) );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $date = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( $prio_override && $freq_override ) {&nbsp;</div></li><li><div>                      $pr_info = array( 'lastmod' =&gt; $date, 'changefreq' =&gt; null, 'priority' =&gt; null );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ( empty( $post-&gt;comment_count ) ) {&nbsp;</div></li><li><div>                          $stat = 0;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $stat = $stats;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( ! empty( $stat ) ) {&nbsp;</div></li><li><div>                          $stat['comment_count'] = $post-&gt;comment_count;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $pr_info = $this-&gt;get_prio_calc( $date, $stat );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( $prio_override ) {&nbsp;</div></li><li><div>                      $pr_info['priority'] = $prio_override;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( $freq_override ) {&nbsp;</div></li><li><div>                      $pr_info['changefreq'] = $freq_override;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ( 'sel' === $this-&gt;options[ $this-&gt;prefix . 'prio_post' ] ) && isset( $this-&gt;options[ $this-&gt;prefix . 'prio_post_' . $post-&gt;post_type ] ) ) {&nbsp;</div></li><li><div>                      if ( ( 'no' != $this-&gt;options[ $this-&gt;prefix . 'prio_post_' . $post-&gt;post_type ] ) && ( 'sel' !== $this-&gt;options[ $this-&gt;prefix . 'prio_post_' . $post-&gt;post_type ] ) ) {&nbsp;</div></li><li><div>                          $pr_info['priority'] = $this-&gt;options[ $this-&gt;prefix . 'prio_post_' . $post-&gt;post_type ];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ( 'sel' === $this-&gt;options[ $this-&gt;prefix . 'freq_post' ] ) && isset( $this-&gt;options[ $this-&gt;prefix . 'freq_post_' . $post-&gt;post_type ] ) ) {&nbsp;</div></li><li><div>                      if ( ( 'no' != $this-&gt;options[ $this-&gt;prefix . 'freq_post_' . $post-&gt;post_type ] ) && ( 'sel' !== $this-&gt;options[ $this-&gt;prefix . 'freq_post_' . $post-&gt;post_type ] ) ) {&nbsp;</div></li><li><div>                          $pr_info['changefreq'] = $this-&gt;options[ $this-&gt;prefix . 'freq_post_' . $post-&gt;post_type ];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $pr_info = array( 'loc' =&gt; $url ) + $pr_info; <span class="comment">// Prepend loc to the array.</span>&nbsp;</div></li><li><div>                  if ( is_float( $pr_info['priority'] ) ) {&nbsp;</div></li><li><div>                      $pr_info['priority'] = sprintf( '%0.1F', $pr_info['priority'] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $pr_info = apply_filters( $this-&gt;prefix . 'prio_item_filter', $pr_info, $post, $args );&nbsp;</div></li><li><div>                  if ( ! empty( $pr_info ) ) {&nbsp;</div></li><li><div>                      $prio[] = $pr_info;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $prio;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return excluded categories for taxonomy queries.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $page</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_tax_args( $page = 0 ) {&nbsp;</div></li><li><div>          $args = array();&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'excl_categories' ) ) {&nbsp;</div></li><li><div>              $args['exclude'] = $this-&gt;options[ $this-&gt;prefix . 'excl_categories' ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;paginate ) {&nbsp;</div></li><li><div>              $args['number'] = $this-&gt;max_posts;&nbsp;</div></li><li><div>              $args['offset'] = $page * $this-&gt;max_posts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $args;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return excluded categories and pages for post queries.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $args</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function set_post_args( $args ) {&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'excl_categories' ) ) {&nbsp;</div></li><li><div>              $cats = array();&nbsp;</div></li><li><div>              foreach ( $this-&gt;options[ $this-&gt;prefix . 'excl_categories' ] as $c ) {&nbsp;</div></li><li><div>                  $cats[] = - $c;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $args['category'] = implode( ', ', $cats );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'excl_pages' ) ) {&nbsp;</div></li><li><div>              $args['exclude'] = $this-&gt;options[ $this-&gt;prefix . 'excl_pages' ];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $args;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return sitemap data for archives.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_archive_prio_data() {&nbsp;</div></li><li><div>          $args = array( 'numberposts' =&gt; 50000, 'post_type' =&gt; 'post' );&nbsp;</div></li><li><div>          $args = $this-&gt;set_post_args( $args );&nbsp;</div></li><li><div>          $posts = $this-&gt;get_all_post_type_data( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;get_archive_prio_from_posts( $posts );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return sitemap data for authors.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_author_prio_data() {&nbsp;</div></li><li><div>          $args = array( 'numberposts' =&gt; 50000, 'post_type' =&gt; 'post' );&nbsp;</div></li><li><div>          $args = $this-&gt;set_post_args( $args );&nbsp;</div></li><li><div>          $posts = $this-&gt;get_all_post_type_data( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;get_author_prio_from_posts( $posts );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return sitemap data for posts.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $include</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $status</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $page</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_all_post_priority_data( $include = 'any', $status = 'publish', $page = 0 ) {&nbsp;</div></li><li><div>          $posts = $page_query = array();&nbsp;</div></li><li><div>          if ( $this-&gt;paginate ) {&nbsp;</div></li><li><div>              $page_query = array( 'offset' =&gt; $page * $this-&gt;max_posts );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ( 'publish' === $status ) && ( 'attachment' === $include ) ) {&nbsp;</div></li><li><div>              $status = 'inherit';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( is_array( $include ) && ( ( $pos = array_search( 'attachment', $include ) ) !== false ) ) {&nbsp;</div></li><li><div>              unset( $include[ $pos ] );&nbsp;</div></li><li><div>              $att_args = array( 'post_type' =&gt; 'attachment', 'post_status' =&gt; 'inherit' );&nbsp;</div></li><li><div>              $att_args = array_merge( $att_args, $page_query );&nbsp;</div></li><li><div>              $posts = $this-&gt;get_all_post_type_data( $att_args );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $args = array( 'post_type' =&gt; $include, 'post_status' =&gt; $status );&nbsp;</div></li><li><div>          $args = array_merge( $args, $page_query );&nbsp;</div></li><li><div>          $args = $this-&gt;set_post_args( $args );&nbsp;</div></li><li><div>          $posts = array_merge( $this-&gt;get_all_post_type_data( $args ), $posts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;get_prio_from_posts( $posts, $this-&gt;get_default_priority( 'post', true ), $this-&gt;get_default_frequency( 'post', true ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return a list of all permalinks.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $include</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $status</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_all_permalinks( $include = 'any', $status = 'publish' ) {&nbsp;</div></li><li><div>          $args = array( 'post_type' =&gt; $include, 'post_status' =&gt; $status );&nbsp;</div></li><li><div>          $args = $this-&gt;set_post_args( $args );&nbsp;</div></li><li><div>          $posts = $this-&gt;get_all_post_type_data( $args );&nbsp;</div></li><li><div>          $links = $this-&gt;get_post_permalinks( $posts );&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'archive' ) ) {&nbsp;</div></li><li><div>              $links = array_merge( $links, $this-&gt;get_archive_permalinks( $posts ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;option_isset( 'author' ) ) {&nbsp;</div></li><li><div>              $links = array_merge( $links, $this-&gt;get_author_permalinks( $posts ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $links;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Static memory cache for permalink_structure option.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $pre</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function cache_structure( $pre ) {&nbsp;</div></li><li><div>          return $this-&gt;cache_struct;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Static memory cache for home option.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $pre</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function cache_home( $pre ) {&nbsp;</div></li><li><div>          return $this-&gt;cache_home;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Cache permalink_structure and home for repeated sitemap queries.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function cache_options() {&nbsp;</div></li><li><div>          static $start = true;&nbsp;</div></li><li><div>          if ( $start ) {&nbsp;</div></li><li><div>              $this-&gt;cache_struct = get_option( 'permalink_structure' );&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;cache_struct ) ) {&nbsp;</div></li><li><div>                  add_filter( 'pre_option_permalink_structure', array( $this, 'cache_structure' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;cache_home = get_option( 'home' );&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;cache_home ) ) {&nbsp;</div></li><li><div>                  add_filter( 'pre_option_home', array( $this, 'cache_home' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $start = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Call get_term_link with caching in place.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param        $term</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $taxonomy</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string|WP_Error</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_term_link( $term, $taxonomy = '' ) {&nbsp;</div></li><li><div>          static $start = true;&nbsp;</div></li><li><div>          if ( $start ) {&nbsp;</div></li><li><div>              $this-&gt;cache_options();&nbsp;</div></li><li><div>              $start = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return get_term_link( $term, $taxonomy );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Call get_permalink with caching in place.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $post</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return false|string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_permalink( $post ) {&nbsp;</div></li><li><div>          static $start = true;&nbsp;</div></li><li><div>          if ( $start ) {&nbsp;</div></li><li><div>              $this-&gt;cache_options();&nbsp;</div></li><li><div>              $start = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return get_permalink( $post );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return term counts using wp_count_terms().</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $args</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array|int|mixed|null|void|WP_Error</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_all_term_counts( $args ) {&nbsp;</div></li><li><div>          $term_counts = null;&nbsp;</div></li><li><div>          if ( ! empty( $args ) && ! empty( $args['taxonomy'] ) ) {&nbsp;</div></li><li><div>              if ( ! is_array( $args['taxonomy'] ) || ( count( $args['taxonomy'] ) == 1 ) ) {&nbsp;</div></li><li><div>                  if ( is_array( $args['taxonomy'] ) ) {&nbsp;</div></li><li><div>                      $args['taxonomy'] = array_shift( $args['taxonomy'] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $term_counts = wp_count_terms( $args['taxonomy'], array( 'hide_empty' =&gt; true ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  foreach ( $args['taxonomy'] as $taxonomy ) {&nbsp;</div></li><li><div>                      if ( 'all' === $taxonomy ) {&nbsp;</div></li><li><div>                          continue;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $term_counts[ $taxonomy ] = wp_count_terms( $taxonomy, array( 'hide_empty' =&gt; true ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $term_counts = apply_filters( $this-&gt;prefix . 'term_counts', $term_counts, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $term_counts;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return post counts using wp_count_posts().</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $args</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed|null|void</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_all_post_counts( $args ) {&nbsp;</div></li><li><div>          $post_counts = null;&nbsp;</div></li><li><div>          $status = 'inherit';&nbsp;</div></li><li><div>          if ( ! empty( $args['post_status'] ) ) {&nbsp;</div></li><li><div>              $status = $args['post_status'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! empty( $args ) && ! empty( $args['post_type'] ) ) {&nbsp;</div></li><li><div>              if ( ! is_array( $args['post_type'] ) || ( count( $args['post_type'] ) == 1 ) ) {&nbsp;</div></li><li><div>                  if ( is_array( $args['post_type'] ) ) {&nbsp;</div></li><li><div>                      $args['post_type'] = array_shift( $args['post_type'] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $count = (Array) wp_count_posts( $args['post_type'] );&nbsp;</div></li><li><div>                  $post_counts = $count[ $status ];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  foreach ( $args['post_type'] as $post_type ) {&nbsp;</div></li><li><div>                      if ( 'all' === $post_type ) {&nbsp;</div></li><li><div>                          continue;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $count = (Array) wp_count_posts( $post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( empty( $count ) ) {&nbsp;</div></li><li><div>                          $post_counts[ $post_type ] = 0;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          if ( 'attachment' === $post_type ) {&nbsp;</div></li><li><div>                              $post_counts[ $post_type ] = $count['inherit'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $post_counts[ $post_type ] = $count[ $status ];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $post_counts = apply_filters( $this-&gt;prefix . 'post_counts', $post_counts, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $post_counts;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get total post count.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $args</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return int|mixed|null|void</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_total_post_count( $args ) {&nbsp;</div></li><li><div>          $total = 0;&nbsp;</div></li><li><div>          $counts = $this-&gt;get_all_post_counts( $args );&nbsp;</div></li><li><div>          if ( ! empty( $counts ) ) {&nbsp;</div></li><li><div>              if ( is_array( $counts ) ) {&nbsp;</div></li><li><div>                  foreach ( $counts as $count ) {&nbsp;</div></li><li><div>                      $total += $count;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $total = $counts;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $total;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return post data using get_posts().</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param $args</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array|mixed|void</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function get_all_post_type_data( $args ) {&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'numberposts' =&gt; $this-&gt;max_posts, &nbsp;</div></li><li><div>              'offset' =&gt; 0, &nbsp;</div></li><li><div>              'category' =&gt; 0, &nbsp;</div></li><li><div>              'orderby' =&gt; 'post_date', &nbsp;</div></li><li><div>              'order' =&gt; 'DESC', &nbsp;</div></li><li><div>              'include' =&gt; array(), &nbsp;</div></li><li><div>              'exclude' =&gt; array(), &nbsp;</div></li><li><div>              'post_type' =&gt; 'any', &nbsp;</div></li><li><div>              'meta_key' =&gt; '', &nbsp;</div></li><li><div>              'meta_value' =&gt; '', &nbsp;</div></li><li><div>              'meta_compare' =&gt; '', &nbsp;</div></li><li><div>              'meta_query' =&gt; '', &nbsp;</div></li><li><div>              'cache_results' =&gt; false, &nbsp;</div></li><li><div>              'no_found_rows' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          if ( defined( 'ICL_SITEPRESS_VERSION' ) ) {&nbsp;</div></li><li><div>              $defaults['suppress_filters'] = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>          if ( empty( $args['post_type'] ) ) {&nbsp;</div></li><li><div>              return apply_filters( $this-&gt;prefix . 'post_filter', array(), $args );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $exclude_slugs = array();&nbsp;</div></li><li><div>          if ( ! empty( $args['exclude'] ) ) {&nbsp;</div></li><li><div>              $exclude = preg_split( '/[\s, ]+/', trim( $args['exclude'] ) );&nbsp;</div></li><li><div>              if ( ! empty( $exclude ) ) {&nbsp;</div></li><li><div>                  foreach ( $exclude as $k =&gt; $v ) {&nbsp;</div></li><li><div>                      if ( ! is_numeric( $v ) || ( $v != (int) $v ) ) {&nbsp;</div></li><li><div>                          $exclude_slugs[] = $v;&nbsp;</div></li><li><div>                          unset( $exclude[ $k ] );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( ! empty( $exclude_slugs ) ) {&nbsp;</div></li><li><div>                      $args['exclude'] = implode( ', ', $exclude );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $ex_args = $args;&nbsp;</div></li><li><div>          $ex_args['meta_key'] = '_aioseop_sitemap_exclude';&nbsp;</div></li><li><div>          $ex_args['meta_value'] = 'on';&nbsp;</div></li><li><div>          $ex_args['meta_compare'] = '=';&nbsp;</div></li><li><div>          $ex_args['fields'] = 'ids';&nbsp;</div></li><li><div>          $ex_args['posts_per_page'] = - 1;&nbsp;</div></li><li><div>          $q = new WP_Query( $ex_args );&nbsp;</div></li><li><div>          if ( ! is_array( $args['exclude'] ) ) {&nbsp;</div></li><li><div>              $args['exclude'] = explode( ', ', $args['exclude'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! empty( $q-&gt;posts ) ) {&nbsp;</div></li><li><div>              $args['exclude'] = array_merge( $args['exclude'], $q-&gt;posts );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $posts = get_posts( apply_filters( $this-&gt;prefix . 'post_query', $args ) );&nbsp;</div></li><li><div>          if ( ! empty( $exclude_slugs ) ) {&nbsp;</div></li><li><div>              foreach ( $posts as $k =&gt; $v ) {&nbsp;</div></li><li><div>                  if ( in_array( $v-&gt;post_name, $exclude_slugs ) ) {&nbsp;</div></li><li><div>                      unset( $posts[ $k ] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $posts = apply_filters( $this-&gt;prefix . 'post_filter', $posts, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $posts;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>All In One SEO Pack</li><li><span></span>2.3.9.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>