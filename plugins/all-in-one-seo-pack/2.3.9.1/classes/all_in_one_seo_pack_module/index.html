<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.3.9.1" data-slug="all-in-one-seo-pack" data-type="class" data-id="63488"><head xmlns="http://www.w3.org/1999/xhtml"><title> all_in_one_seo_pack_module | class | All In One Seo Pack | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="All_in_One_SEO_Pack_Module, class, plugin, all-in-one-seo-pack, 2.3.9.1" /><meta name="description" content="The All In One SEO Pack All in One SEO Pack Module class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.11"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=5e07006a73db81ec62206924f7d5b7db' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.11' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/all_in_one_seo_pack_module/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fall_in_one_seo_pack_module%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fall_in_one_seo_pack_module%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-all-in-one-seo-pack-2.3.9.1-class-all_in_one_seo_pack_module","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="all_in_one_seo_pack_module" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to all-in-one-seo-pack." href="http://hookr.io/plugins/all-in-one-seo-pack/" class="plugin"><span property="name">all-in-one-seo-pack</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.3.9.1." href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/" class="H_VERSION"><span property="name">2.3.9.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">all_in_one_seo_pack_module</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="221"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/all/" title="All">All <span class="count badge">221</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="104"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/hooks/" title="Hooks">Hooks <span class="count badge">104</span></a></li><li class="" data-id="action" data-count="19"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/actions/" title="Actions">Actions <span class="count badge">19</span></a></li><li class="" data-id="filter" data-count="85"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/filters/" title="Filters">Filters <span class="count badge">85</span></a></li><li class="active" data-id="class" data-count="31"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/classes/" title="Classes">Classes <span class="count badge">31</span></a></li><li class="" data-id="constant" data-count="22"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/constants/" title="Constants">Constants <span class="count badge">22</span></a></li><li class="" data-id="function" data-count="64"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/functions/" title="Functions">Functions <span class="count badge">64</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>All_in_One_SEO_Pack_Module</strong></h1><p>The All In One SEO Pack <strong>All in One SEO Pack Module</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/files/admin-aioseop-module-class/" class="file">/admin/aioseop_module_class.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="9" class="block" start="9"><li><div>abstract class All_in_One_SEO_Pack_Module {&nbsp;</div></li><li><div>    public static $instance = null;&nbsp;</div></li><li><div>    protected $plugin_name;&nbsp;</div></li><li><div>    protected $name;&nbsp;</div></li><li><div>    protected $menu_name;&nbsp;</div></li><li><div>    protected $prefix;&nbsp;</div></li><li><div>    protected $file;&nbsp;</div></li><li><div>    protected $options;&nbsp;</div></li><li><div>    protected $option_name;&nbsp;</div></li><li><div>    protected $default_options;&nbsp;</div></li><li><div>    protected $help_text = array();&nbsp;</div></li><li><div>    protected $help_anchors = array();&nbsp;</div></li><li><div>    protected $locations = null;    // organize settings into settings pages with a menu items and/or metaboxes on post types edit screen; optional&nbsp;</div></li><li><div>    protected $layout = null;        // organize settings on a settings page into multiple, separate metaboxes; optional&nbsp;</div></li><li><div>    protected $tabs = null;            // organize layouts on a settings page into multiple, separate tabs; optional&nbsp;</div></li><li><div>    protected $current_tab = null;    // the current tab&nbsp;</div></li><li><div>    protected $pagehook = null;        // the current page hook&nbsp;</div></li><li><div>    protected $store_option = false;&nbsp;</div></li><li><div>    protected $parent_option = 'aioseop_options';&nbsp;</div></li><li><div>    protected $post_metaboxes = array();&nbsp;</div></li><li><div>    protected $tabbed_metaboxes = true;&nbsp;</div></li><li><div>    protected $credentials = false; // used for WP Filesystem&nbsp;</div></li><li><div>    protected $script_data = null;    // used for passing data to JavaScript&nbsp;</div></li><li><div>    protected $plugin_path = null;&nbsp;</div></li><li><div>    protected $pointers = array();&nbsp;</div></li><li><div>    protected $form = 'dofollow';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handles calls to display_settings_page_{$location}, does error checking.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __call( $name, $arguments ) {&nbsp;</div></li><li><div>        if ( $this-&gt;strpos( $name, 'display_settings_page_' ) === 0 ) {&nbsp;</div></li><li><div>            return $this-&gt;display_settings_page( $this-&gt;substr( $name, 22 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $error = __( sprintf( &quot;Method %s doesn't exist&quot;, $name ), 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>        if ( class_exists( 'BadMethodCallException' ) ) {&nbsp;</div></li><li><div>            throw new BadMethodCallException( $error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        throw new Exception( $error );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function __construct() {&nbsp;</div></li><li><div>        if ( empty( $this-&gt;file ) ) {&nbsp;</div></li><li><div>            $this-&gt;file = __FILE__;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;plugin_name = AIOSEOP_PLUGIN_NAME;&nbsp;</div></li><li><div>        $this-&gt;plugin_path = array();&nbsp;</div></li><li><div>//            $this-&gt;plugin_path['dir'] = plugin_dir_path( $this-&gt;file );&nbsp;</div></li><li><div>        $this-&gt;plugin_path['basename'] = plugin_basename( $this-&gt;file );&nbsp;</div></li><li><div>        $this-&gt;plugin_path['dirname'] = dirname( $this-&gt;plugin_path['basename'] );&nbsp;</div></li><li><div>        $this-&gt;plugin_path['url'] = plugin_dir_url( $this-&gt;file );&nbsp;</div></li><li><div>        $this-&gt;plugin_path['images_url'] = $this-&gt;plugin_path['url'] . 'images';&nbsp;</div></li><li><div>        $this-&gt;script_data['plugin_path'] = $this-&gt;plugin_path;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get options for module, stored individually or together.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_class_option() {&nbsp;</div></li><li><div>        $option_name = $this-&gt;get_option_name();&nbsp;</div></li><li><div>        if ( $this-&gt;store_option || $option_name == $this-&gt;parent_option ) {&nbsp;</div></li><li><div>            return get_option( $option_name );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $option = get_option( $this-&gt;parent_option );&nbsp;</div></li><li><div>            if ( isset( $option['modules'] ) && isset( $option['modules'][ $option_name ] ) ) {&nbsp;</div></li><li><div>                return $option['modules'][ $option_name ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update options for module, stored individually or together.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function update_class_option( $option_data, $option_name = false ) {&nbsp;</div></li><li><div>        if ( $option_name == false ) {&nbsp;</div></li><li><div>            $option_name = $this-&gt;get_option_name();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $this-&gt;store_option || $option_name == $this-&gt;parent_option ) {&nbsp;</div></li><li><div>            return update_option( $option_name, $option_data );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $option = get_option( $this-&gt;parent_option );&nbsp;</div></li><li><div>            if ( ! isset( $option['modules'] ) ) {&nbsp;</div></li><li><div>                $option['modules'] = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $option['modules'][ $option_name ] = $option_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return update_option( $this-&gt;parent_option, $option );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete options for module, stored individually or together.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function delete_class_option( $delete = false ) {&nbsp;</div></li><li><div>        $option_name = $this-&gt;get_option_name();&nbsp;</div></li><li><div>        if ( $this-&gt;store_option || $delete ) {&nbsp;</div></li><li><div>            delete_option( $option_name );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $option = get_option( $this-&gt;parent_option );&nbsp;</div></li><li><div>            if ( isset( $option['modules'] ) && isset( $option['modules'][ $option_name ] ) ) {&nbsp;</div></li><li><div>                unset( $option['modules'][ $option_name ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return update_option( $this-&gt;parent_option, $option );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the option name with prefix.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_option_name() {&nbsp;</div></li><li><div>        if ( ! isset( $this-&gt;option_name ) || empty( $this-&gt;option_name ) ) {&nbsp;</div></li><li><div>            $this-&gt;option_name = $this-&gt;prefix . 'options';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;option_name;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convenience function to see if an option is set.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function option_isset( $option, $location = null ) {&nbsp;</div></li><li><div>        $prefix = $this-&gt;get_prefix( $location );&nbsp;</div></li><li><div>        $opt = $prefix . $option;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ( isset( $this-&gt;options[ $opt ] ) && $this-&gt;options[ $opt ] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /*** Case conversion; handle non UTF-8 encodings and fallback ***/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function convert_case( $str, $mode = 'upper' ) {&nbsp;</div></li><li><div>        static $charset = null;&nbsp;</div></li><li><div>        if ( $charset == null ) {&nbsp;</div></li><li><div>            $charset = get_bloginfo( 'charset' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $str = (string) $str;&nbsp;</div></li><li><div>        if ( $mode == 'title' ) {&nbsp;</div></li><li><div>            if ( function_exists( 'mb_convert_case' ) ) {&nbsp;</div></li><li><div>                return mb_convert_case( $str, MB_CASE_TITLE, $charset );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return ucwords( $str );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $charset == 'UTF-8' ) {&nbsp;</div></li><li><div>            global $UTF8_TABLES;&nbsp;</div></li><li><div>            include_once( AIOSEOP_PLUGIN_DIR . 'inc/aioseop_UTF8.php' );&nbsp;</div></li><li><div>            if ( is_array( $UTF8_TABLES ) ) {&nbsp;</div></li><li><div>                if ( $mode == 'upper' ) {&nbsp;</div></li><li><div>                    return strtr( $str, $UTF8_TABLES['strtoupper'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $mode == 'lower' ) {&nbsp;</div></li><li><div>                    return strtr( $str, $UTF8_TABLES['strtolower'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $mode == 'upper' ) {&nbsp;</div></li><li><div>            if ( function_exists( 'mb_strtoupper' ) ) {&nbsp;</div></li><li><div>                return mb_strtoupper( $str, $charset );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return strtoupper( $str );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $mode == 'lower' ) {&nbsp;</div></li><li><div>            if ( function_exists( 'mb_strtolower' ) ) {&nbsp;</div></li><li><div>                return mb_strtolower( $str, $charset );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return strtolower( $str );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $str;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert a string to lower case&nbsp;</div></li><li><div>     * Compatible with mb_strtolower(), an UTF-8 friendly replacement for strtolower()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function strtolower( $str ) {&nbsp;</div></li><li><div>        return $this-&gt;convert_case( $str, 'lower' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert a string to upper case&nbsp;</div></li><li><div>     * Compatible with mb_strtoupper(), an UTF-8 friendly replacement for strtoupper()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function strtoupper( $str ) {&nbsp;</div></li><li><div>        return $this-&gt;convert_case( $str, 'upper' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert a string to title case&nbsp;</div></li><li><div>     * Compatible with mb_convert_case(), an UTF-8 friendly replacement for ucwords()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function ucwords( $str ) {&nbsp;</div></li><li><div>        return $this-&gt;convert_case( $str, 'title' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Wrapper for strlen() - uses mb_strlen() if possible.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function strlen( $string ) {&nbsp;</div></li><li><div>        if ( function_exists( 'mb_strlen' ) ) {&nbsp;</div></li><li><div>            return mb_strlen( $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return strlen( $string );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Wrapper for substr() - uses mb_substr() if possible.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function substr( $string, $start = 0, $length = 2147483647 ) {&nbsp;</div></li><li><div>        $args = func_get_args();&nbsp;</div></li><li><div>        if ( function_exists( 'mb_substr' ) ) {&nbsp;</div></li><li><div>            return call_user_func_array( 'mb_substr', $args );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return call_user_func_array( 'substr', $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Wrapper for strpos() - uses mb_strpos() if possible.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function strpos( $haystack, $needle, $offset = 0 ) {&nbsp;</div></li><li><div>        if ( function_exists( 'mb_strpos' ) ) {&nbsp;</div></li><li><div>            return mb_strpos( $haystack, $needle, $offset );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return strpos( $haystack, $needle, $offset );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Wrapper for strrpos() - uses mb_strrpos() if possible.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function strrpos( $haystack, $needle, $offset = 0 ) {&nbsp;</div></li><li><div>        if ( function_exists( 'mb_strrpos' ) ) {&nbsp;</div></li><li><div>            return mb_strrpos( $haystack, $needle, $offset );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return strrpos( $haystack, $needle, $offset );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * convert xml string to php array - useful to get a serializable value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $xmlstr&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @author Adrien aka Gaarf & contributors&nbsp;</div></li><li><div>     * @see    http://gaarf.info/2009/08/13/xml-string-to-php-array/&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function html_string_to_array( $xmlstr ) {&nbsp;</div></li><li><div>        if ( ! class_exists( 'DOMDocument' ) ) {&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $doc = new DOMDocument();&nbsp;</div></li><li><div>            $doc-&gt;loadHTML( $xmlstr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $this-&gt;domnode_to_array( $doc-&gt;documentElement );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function xml_string_to_array( $xmlstr ) {&nbsp;</div></li><li><div>        if ( ! class_exists( 'DOMDocument' ) ) {&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $doc = new DOMDocument();&nbsp;</div></li><li><div>            $doc-&gt;loadXML( $xmlstr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $this-&gt;domnode_to_array( $doc-&gt;documentElement );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function domnode_to_array( $node ) {&nbsp;</div></li><li><div>        switch ( $node-&gt;nodeType ) {&nbsp;</div></li><li><div>            case XML_CDATA_SECTION_NODE:&nbsp;</div></li><li><div>            case XML_TEXT_NODE:&nbsp;</div></li><li><div>                return trim( $node-&gt;textContent );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case XML_ELEMENT_NODE:&nbsp;</div></li><li><div>                $output = array();&nbsp;</div></li><li><div>                for ( $i = 0, $m = $node-&gt;childNodes-&gt;length; $i &lt; $m; $i ++ ) {&nbsp;</div></li><li><div>                    $child = $node-&gt;childNodes-&gt;item( $i );&nbsp;</div></li><li><div>                    $v = $this-&gt;domnode_to_array( $child );&nbsp;</div></li><li><div>                    if ( isset( $child-&gt;tagName ) ) {&nbsp;</div></li><li><div>                        $t = $child-&gt;tagName;&nbsp;</div></li><li><div>                        if ( ! isset( $output[ $t ] ) ) {&nbsp;</div></li><li><div>                            $output[ $t ] = array();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ( is_array( $output ) ) {&nbsp;</div></li><li><div>                            $output[ $t ][] = $v;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } elseif ( $v || $v === '0' ) {&nbsp;</div></li><li><div>                        $output = (string) $v;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $node-&gt;attributes-&gt;length && ! is_array( $output ) ) //Has attributes but isn't an array&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $output = array( '@content' =&gt; $output );&nbsp;</div></li><li><div>                } //Change output into an array.&nbsp;</div></li><li><div>                if ( is_array( $output ) ) {&nbsp;</div></li><li><div>                    if ( $node-&gt;attributes-&gt;length ) {&nbsp;</div></li><li><div>                        $a = array();&nbsp;</div></li><li><div>                        foreach ( $node-&gt;attributes as $attrName =&gt; $attrNode ) {&nbsp;</div></li><li><div>                            $a[ $attrName ] = (string) $attrNode-&gt;value;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $output['@attributes'] = $a;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    foreach ( $output as $t =&gt; $v ) {&nbsp;</div></li><li><div>                        if ( is_array( $v ) && count( $v ) == 1 && $t != '@attributes' ) {&nbsp;</div></li><li><div>                            $output[ $t ] = $v[0];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $output ) ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /*** adds support for using %cf_(name of field)% for using custom fields / Advanced Custom Fields in titles / descriptions etc. ***/&nbsp;</div></li><li><div>    function apply_cf_fields( $format ) {&nbsp;</div></li><li><div>        return preg_replace_callback( '/%cf_([^%]*?)%/', array( $this, 'cf_field_replace' ), $format );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function cf_field_replace( $matches ) {&nbsp;</div></li><li><div>        $result = '';&nbsp;</div></li><li><div>        if ( ! empty( $matches ) ) {&nbsp;</div></li><li><div>            if ( ! empty( $matches[1] ) ) {&nbsp;</div></li><li><div>                if ( function_exists( 'get_field' ) ) {&nbsp;</div></li><li><div>                    $result = get_field( $matches[1] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( empty( $result ) ) {&nbsp;</div></li><li><div>                    global $post;&nbsp;</div></li><li><div>                    if ( ! empty( $post ) ) {&nbsp;</div></li><li><div>                        $result = get_post_meta( $post-&gt;ID, $matches[1], true );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( empty( $result ) ) {&nbsp;</div></li><li><div>                    $result = $matches[0];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $result = $matches[0];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $result = strip_tags( $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns child blogs of parent in a multisite.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_child_blogs() {&nbsp;</div></li><li><div>        global $wpdb, $blog_id;&nbsp;</div></li><li><div>        $site_id = $wpdb-&gt;siteid;&nbsp;</div></li><li><div>        if ( is_multisite() ) {&nbsp;</div></li><li><div>            if ( $site_id != $blog_id ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $wpdb-&gt;get_col( &quot;SELECT blog_id FROM {$wpdb-&gt;blogs} WHERE site_id = {$blog_id} AND site_id != blog_id&quot; );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if the plugin is active on a given blog by blogid on a multisite.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function is_aioseop_active_on_blog( $bid = false ) {&nbsp;</div></li><li><div>        global $blog_id;&nbsp;</div></li><li><div>        if ( empty( $bid ) || ( $bid == $blog_id ) || ! is_multisite() ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! function_exists( 'is_plugin_active_for_network' ) ) {&nbsp;</div></li><li><div>            require_once( ABSPATH . '/wp-admin/includes/plugin.php' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( is_plugin_active_for_network( AIOSEOP_PLUGIN_BASENAME ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return in_array( AIOSEOP_PLUGIN_BASENAME, (array) get_blog_option( $bid, 'active_plugins', array() ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function quote_list_for_regex( $list, $quote = '/' ) {&nbsp;</div></li><li><div>        $regex = '';&nbsp;</div></li><li><div>        $cont = 0;&nbsp;</div></li><li><div>        foreach ( $list as $l ) {&nbsp;</div></li><li><div>            if ( $cont ) {&nbsp;</div></li><li><div>                $regex .= '|';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $cont = 1;&nbsp;</div></li><li><div>            $regex .= preg_quote( trim( $l ), $quote );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $regex;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // original code thanks to Sean M. Brown -- http://smbrown.wordpress.com/2009/04/29/verify-googlebot-forward-reverse-dns/&nbsp;</div></li><li><div>    function is_good_bot() {&nbsp;</div></li><li><div>        $botlist = array(&nbsp;</div></li><li><div>            'Yahoo! Slurp' =&gt; 'crawl.yahoo.net', &nbsp;</div></li><li><div>            'googlebot' =&gt; '.googlebot.com', &nbsp;</div></li><li><div>            'msnbot' =&gt; 'search.msn.com', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $botlist = apply_filters( $this-&gt;prefix . 'botlist', $botlist );&nbsp;</div></li><li><div>        if ( ! empty( $botlist ) ) {&nbsp;</div></li><li><div>            if ( ! isset( $_SERVER['HTTP_USER_AGENT'] ) ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $ua = $_SERVER['HTTP_USER_AGENT'];&nbsp;</div></li><li><div>            $uas = $this-&gt;quote_list_for_regex( $botlist );&nbsp;</div></li><li><div>            if ( preg_match( '/' . $uas . '/i', $ua ) ) {&nbsp;</div></li><li><div>                $ip = $_SERVER['REMOTE_ADDR'];&nbsp;</div></li><li><div>                $hostname = gethostbyaddr( $ip );&nbsp;</div></li><li><div>                $ip_by_hostname = gethostbyname( $hostname );&nbsp;</div></li><li><div>                if ( $ip_by_hostname == $ip ) {&nbsp;</div></li><li><div>                    $hosts = array_values( $botlist );&nbsp;</div></li><li><div>                    foreach ( $hosts as $k =&gt; $h ) {&nbsp;</div></li><li><div>                        $hosts[ $k ] = preg_quote( $h ) . '$';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $hosts = join( '|', $hosts );&nbsp;</div></li><li><div>                    if ( preg_match( '/' . $hosts . '/i', $hostname ) ) {&nbsp;</div></li><li><div>                        return true;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function default_bad_bots() {&nbsp;</div></li><li><div>        $botlist = array(&nbsp;</div></li><li><div>            'Abonti', &nbsp;</div></li><li><div>            'aggregator', &nbsp;</div></li><li><div>            'AhrefsBot', &nbsp;</div></li><li><div>            'asterias', &nbsp;</div></li><li><div>            'BDCbot', &nbsp;</div></li><li><div>            'BLEXBot', &nbsp;</div></li><li><div>            'BuiltBotTough', &nbsp;</div></li><li><div>            'Bullseye', &nbsp;</div></li><li><div>            'BunnySlippers', &nbsp;</div></li><li><div>            'ca-crawler', &nbsp;</div></li><li><div>            'CCBot', &nbsp;</div></li><li><div>            'Cegbfeieh', &nbsp;</div></li><li><div>            'CheeseBot', &nbsp;</div></li><li><div>            'CherryPicker', &nbsp;</div></li><li><div>            'CopyRightCheck', &nbsp;</div></li><li><div>            'cosmos', &nbsp;</div></li><li><div>            'Crescent', &nbsp;</div></li><li><div>            'discobot', &nbsp;</div></li><li><div>            'DittoSpyder', &nbsp;</div></li><li><div>            'DotBot', &nbsp;</div></li><li><div>            'Download Ninja', &nbsp;</div></li><li><div>            'EasouSpider', &nbsp;</div></li><li><div>            'EmailCollector', &nbsp;</div></li><li><div>            'EmailSiphon', &nbsp;</div></li><li><div>            'EmailWolf', &nbsp;</div></li><li><div>            'EroCrawler', &nbsp;</div></li><li><div>            'Exabot', &nbsp;</div></li><li><div>            'ExtractorPro', &nbsp;</div></li><li><div>            'Fasterfox', &nbsp;</div></li><li><div>            'FeedBooster', &nbsp;</div></li><li><div>            'Foobot', &nbsp;</div></li><li><div>            'Genieo', &nbsp;</div></li><li><div>            'grub-client', &nbsp;</div></li><li><div>            'Harvest', &nbsp;</div></li><li><div>            'hloader', &nbsp;</div></li><li><div>            'httplib', &nbsp;</div></li><li><div>            'HTTrack', &nbsp;</div></li><li><div>            'humanlinks', &nbsp;</div></li><li><div>            'ieautodiscovery', &nbsp;</div></li><li><div>            'InfoNaviRobot', &nbsp;</div></li><li><div>            'IstellaBot', &nbsp;</div></li><li><div>            'Java/1.', &nbsp;</div></li><li><div>            'JennyBot', &nbsp;</div></li><li><div>            'k2spider', &nbsp;</div></li><li><div>            'Kenjin Spider', &nbsp;</div></li><li><div>            'Keyword Density/0.9', &nbsp;</div></li><li><div>            'larbin', &nbsp;</div></li><li><div>            'LexiBot', &nbsp;</div></li><li><div>            'libWeb', &nbsp;</div></li><li><div>            'libwww', &nbsp;</div></li><li><div>            'LinkextractorPro', &nbsp;</div></li><li><div>            'linko', &nbsp;</div></li><li><div>            'LinkScan/8.1a Unix', &nbsp;</div></li><li><div>            'LinkWalker', &nbsp;</div></li><li><div>            'LNSpiderguy', &nbsp;</div></li><li><div>            'lwp-trivial', &nbsp;</div></li><li><div>            'magpie', &nbsp;</div></li><li><div>            'Mata Hari', &nbsp;</div></li><li><div>            'MaxPointCrawler', &nbsp;</div></li><li><div>            'MegaIndex', &nbsp;</div></li><li><div>            'Microsoft URL Control', &nbsp;</div></li><li><div>            'MIIxpc', &nbsp;</div></li><li><div>            'Mippin', &nbsp;</div></li><li><div>            'Missigua Locator', &nbsp;</div></li><li><div>            'Mister PiX', &nbsp;</div></li><li><div>            'MJ12bot', &nbsp;</div></li><li><div>            'moget', &nbsp;</div></li><li><div>            'MSIECrawler', &nbsp;</div></li><li><div>            'NetAnts', &nbsp;</div></li><li><div>            'NICErsPRO', &nbsp;</div></li><li><div>            'Niki-Bot', &nbsp;</div></li><li><div>            'NPBot', &nbsp;</div></li><li><div>            'Nutch', &nbsp;</div></li><li><div>            'Offline Explorer', &nbsp;</div></li><li><div>            'Openfind', &nbsp;</div></li><li><div>            'panscient.com', &nbsp;</div></li><li><div>            'PHP/5.{', &nbsp;</div></li><li><div>            'ProPowerBot/2.14', &nbsp;</div></li><li><div>            'ProWebWalker', &nbsp;</div></li><li><div>            'Python-urllib', &nbsp;</div></li><li><div>            'QueryN Metasearch', &nbsp;</div></li><li><div>            'RepoMonkey', &nbsp;</div></li><li><div>            'RMA', &nbsp;</div></li><li><div>            'SemrushBot', &nbsp;</div></li><li><div>            'SISTRIX', &nbsp;</div></li><li><div>            'sitecheck.Internetseer.com', &nbsp;</div></li><li><div>            'SiteSnagger', &nbsp;</div></li><li><div>            'SnapPreviewBot', &nbsp;</div></li><li><div>            'Sogou', &nbsp;</div></li><li><div>            'SpankBot', &nbsp;</div></li><li><div>            'spanner', &nbsp;</div></li><li><div>            'spbot', &nbsp;</div></li><li><div>            'Spinn3r', &nbsp;</div></li><li><div>            'suzuran', &nbsp;</div></li><li><div>            'Szukacz/1.4', &nbsp;</div></li><li><div>            'Teleport', &nbsp;</div></li><li><div>            'Telesoft', &nbsp;</div></li><li><div>            'The Intraformant', &nbsp;</div></li><li><div>            'TheNomad', &nbsp;</div></li><li><div>            'TightTwatBot', &nbsp;</div></li><li><div>            'Titan', &nbsp;</div></li><li><div>            'toCrawl/UrlDispatcher', &nbsp;</div></li><li><div>            'True_Robot', &nbsp;</div></li><li><div>            'turingos', &nbsp;</div></li><li><div>            'TurnitinBot', &nbsp;</div></li><li><div>            'UbiCrawler', &nbsp;</div></li><li><div>            'UnisterBot', &nbsp;</div></li><li><div>            'URLy Warning', &nbsp;</div></li><li><div>            'VCI', &nbsp;</div></li><li><div>            'WBSearchBot', &nbsp;</div></li><li><div>            'Web Downloader/6.9', &nbsp;</div></li><li><div>            'Web Image Collector', &nbsp;</div></li><li><div>            'WebAuto', &nbsp;</div></li><li><div>            'WebBandit', &nbsp;</div></li><li><div>            'WebCopier', &nbsp;</div></li><li><div>            'WebEnhancer', &nbsp;</div></li><li><div>            'WebmasterWorldForumBot', &nbsp;</div></li><li><div>            'WebReaper', &nbsp;</div></li><li><div>            'WebSauger', &nbsp;</div></li><li><div>            'Website Quester', &nbsp;</div></li><li><div>            'Webster Pro', &nbsp;</div></li><li><div>            'WebStripper', &nbsp;</div></li><li><div>            'WebZip', &nbsp;</div></li><li><div>            'Wotbox', &nbsp;</div></li><li><div>            'wsr-agent', &nbsp;</div></li><li><div>            'WWW-Collector-E', &nbsp;</div></li><li><div>            'Xenu', &nbsp;</div></li><li><div>            'Zao', &nbsp;</div></li><li><div>            'Zeus', &nbsp;</div></li><li><div>            'ZyBORG', &nbsp;</div></li><li><div>            'coccoc', &nbsp;</div></li><li><div>            'Incutio', &nbsp;</div></li><li><div>            'lmspider', &nbsp;</div></li><li><div>            'memoryBot', &nbsp;</div></li><li><div>            'SemrushBot', &nbsp;</div></li><li><div>            'serf', &nbsp;</div></li><li><div>            'Unknown', &nbsp;</div></li><li><div>            'uptime files', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $botlist;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function is_bad_bot() {&nbsp;</div></li><li><div>        $botlist = $this-&gt;default_bad_bots();&nbsp;</div></li><li><div>        $botlist = apply_filters( $this-&gt;prefix . 'badbotlist', $botlist );&nbsp;</div></li><li><div>        if ( ! empty( $botlist ) ) {&nbsp;</div></li><li><div>            if ( ! isset( $_SERVER['HTTP_USER_AGENT'] ) ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $ua = $_SERVER['HTTP_USER_AGENT'];&nbsp;</div></li><li><div>            $uas = $this-&gt;quote_list_for_regex( $botlist );&nbsp;</div></li><li><div>            if ( preg_match( '/' . $uas . '/i', $ua ) ) {&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function default_bad_referers() {&nbsp;</div></li><li><div>        $referlist = array(&nbsp;</div></li><li><div>            'semalt.com', &nbsp;</div></li><li><div>            'kambasoft.com', &nbsp;</div></li><li><div>            'savetubevideo.com', &nbsp;</div></li><li><div>            'buttons-for-website.com', &nbsp;</div></li><li><div>            'sharebutton.net', &nbsp;</div></li><li><div>            'soundfrost.org', &nbsp;</div></li><li><div>            'srecorder.com', &nbsp;</div></li><li><div>            'softomix.com', &nbsp;</div></li><li><div>            'softomix.net', &nbsp;</div></li><li><div>            'myprintscreen.com', &nbsp;</div></li><li><div>            'joinandplay.me', &nbsp;</div></li><li><div>            'fbfreegifts.com', &nbsp;</div></li><li><div>            'openmediasoft.com', &nbsp;</div></li><li><div>            'zazagames.org', &nbsp;</div></li><li><div>            'extener.org', &nbsp;</div></li><li><div>            'openfrost.com', &nbsp;</div></li><li><div>            'openfrost.net', &nbsp;</div></li><li><div>            'googlsucks.com', &nbsp;</div></li><li><div>            'best-seo-offer.com', &nbsp;</div></li><li><div>            'buttons-for-your-website.com', &nbsp;</div></li><li><div>            'www.Get-Free-Traffic-Now.com', &nbsp;</div></li><li><div>            'best-seo-solution.com', &nbsp;</div></li><li><div>            'buy-cheap-online.info', &nbsp;</div></li><li><div>            'site3.free-share-buttons.com', &nbsp;</div></li><li><div>            'webmaster-traffic.com', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $referlist;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function is_bad_referer() {&nbsp;</div></li><li><div>        $referlist = $this-&gt;default_bad_referers();&nbsp;</div></li><li><div>        $referlist = apply_filters( $this-&gt;prefix . 'badreferlist', $referlist );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $referlist ) && ! empty( $_SERVER ) && ! empty( $_SERVER['HTTP_REFERER'] ) ) {&nbsp;</div></li><li><div>            $ref = $_SERVER['HTTP_REFERER'];&nbsp;</div></li><li><div>            $regex = $this-&gt;quote_list_for_regex( $referlist );&nbsp;</div></li><li><div>            if ( preg_match( '/' . $regex . '/i', $ref ) ) {&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function allow_bot() {&nbsp;</div></li><li><div>        $allow_bot = true;&nbsp;</div></li><li><div>        if ( ( ! $this-&gt;is_good_bot() ) && $this-&gt;is_bad_bot() && ! is_user_logged_in() ) {&nbsp;</div></li><li><div>            $allow_bot = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( $this-&gt;prefix . 'allow_bot', $allow_bot );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Displays tabs for tabbed locations on a settings page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function display_tabs( $location ) {&nbsp;</div></li><li><div>        if ( ( $location != null ) && isset( $locations[ $location ]['tabs'] ) ) {&nbsp;</div></li><li><div>            $tabs = $locations['location']['tabs'];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $tabs = $this-&gt;tabs;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $tabs ) ) {&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;aioseop_tabs_div&quot;&gt;&lt;label class=&quot;aioseop_head_nav&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    foreach ( $tabs as $k =&gt; $v ) {&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;a class=&quot;aioseop_head_nav_tab aioseop_head_nav_&lt;?php if ( $this-&gt;current_tab != $k ) {&nbsp;</div></li><li><div>                            echo 'in';&nbsp;</div></li><li><div>                        } ?&gt;active&quot;&nbsp;</div></li><li><div>                           href=&quot;&lt;?php echo esc_url( add_query_arg( 'tab', $k ) ); ?&gt;&quot;&gt;&lt;?php echo $v['name']; ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                &lt;/label&gt;&lt;/div&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_object_labels( $post_objs ) {&nbsp;</div></li><li><div>        $pt = array_keys( $post_objs );&nbsp;</div></li><li><div>        $post_types = array();&nbsp;</div></li><li><div>        foreach ( $pt as $p ) {&nbsp;</div></li><li><div>            if ( ! empty( $post_objs[ $p ]-&gt;label ) ) {&nbsp;</div></li><li><div>                $post_types[ $p ] = $post_objs[ $p ]-&gt;label;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $post_types[ $p ] = $p;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $post_types;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_term_labels( $post_objs ) {&nbsp;</div></li><li><div>        $post_types = array();&nbsp;</div></li><li><div>        foreach ( $post_objs as $p ) {&nbsp;</div></li><li><div>            if ( ! empty( $p-&gt;name ) ) {&nbsp;</div></li><li><div>                $post_types[ $p-&gt;term_id ] = $p-&gt;name;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $post_types;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_post_type_titles( $args = array() ) {&nbsp;</div></li><li><div>        return $this-&gt;get_object_labels( get_post_types( $args, 'objects' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_taxonomy_titles( $args = array() ) {&nbsp;</div></li><li><div>        return $this-&gt;get_object_labels( get_taxonomies( $args, 'objects' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_category_titles( $args = array() ) {&nbsp;</div></li><li><div>        return $this-&gt;get_term_labels( get_categories( $args ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Helper function for exporting settings on post data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function post_data_export( $prefix = '_aioseop', $query = array( 'posts_per_page' =&gt; - 1 ) ) {&nbsp;</div></li><li><div>        $buf = '';&nbsp;</div></li><li><div>        $posts_query = new WP_Query( $query );&nbsp;</div></li><li><div>        while ( $posts_query-&gt;have_posts() ) {&nbsp;</div></li><li><div>            $posts_query-&gt;the_post();&nbsp;</div></li><li><div>            global $post;&nbsp;</div></li><li><div>            $guid = $post-&gt;guid;&nbsp;</div></li><li><div>            $type = $post-&gt;post_type;&nbsp;</div></li><li><div>            $title = $post-&gt;post_title;&nbsp;</div></li><li><div>            $date = $post-&gt;post_date;&nbsp;</div></li><li><div>            $data = '';&nbsp;</div></li><li><div>            $post_custom_fields = get_post_custom( $post-&gt;ID );&nbsp;</div></li><li><div>            $has_data = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $post_custom_fields ) ) {&nbsp;</div></li><li><div>                foreach ( $post_custom_fields as $field_name =&gt; $field ) {&nbsp;</div></li><li><div>                    if ( ( $this-&gt;strpos( $field_name, $prefix ) === 0 ) && $field[0] ) {&nbsp;</div></li><li><div>                        $has_data = true;&nbsp;</div></li><li><div>                        $data .= $field_name . &quot; = '&quot; . $field[0] . &quot;'\n&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( ! empty( $data ) ) {&nbsp;</div></li><li><div>                $has_data = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $has_data != null ) {&nbsp;</div></li><li><div>                $post_info = &quot;\n[post_data]\n\n&quot;;&nbsp;</div></li><li><div>                $post_info .= &quot;post_title = '&quot; . $title . &quot;'\n&quot;;&nbsp;</div></li><li><div>                $post_info .= &quot;post_guid = '&quot; . $guid . &quot;'\n&quot;;&nbsp;</div></li><li><div>                $post_info .= &quot;post_date = '&quot; . $date . &quot;'\n&quot;;&nbsp;</div></li><li><div>                $post_info .= &quot;post_type = '&quot; . $type . &quot;'\n&quot;;&nbsp;</div></li><li><div>                if ( $data ) {&nbsp;</div></li><li><div>                    $buf .= $post_info . $data . &quot;\n&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_reset_postdata();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $buf;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handles exporting settings data for a module.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function settings_export( $buf ) {&nbsp;</div></li><li><div>        global $aiosp;&nbsp;</div></li><li><div>        $post_types = null;&nbsp;</div></li><li><div>        $has_data = null;&nbsp;</div></li><li><div>        $general_settings = null;&nbsp;</div></li><li><div>        $exporter_choices = '';&nbsp;</div></li><li><div>        if ( ! empty( $_REQUEST['aiosp_importer_exporter_export_choices'] ) ) {&nbsp;</div></li><li><div>            $exporter_choices = $_REQUEST['aiosp_importer_exporter_export_choices'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $exporter_choices ) && is_array( $exporter_choices ) ) {&nbsp;</div></li><li><div>            foreach ( $exporter_choices as $ex ) {&nbsp;</div></li><li><div>                if ( $ex == 1 ) {&nbsp;</div></li><li><div>                    $general_settings = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $ex == 2 && isset( $_REQUEST['aiosp_importer_exporter_export_post_types'] ) ) {&nbsp;</div></li><li><div>                    $post_types = $_REQUEST['aiosp_importer_exporter_export_post_types'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( $post_types != null ) && ( $this === $aiosp ) ) {&nbsp;</div></li><li><div>            $buf .= $this-&gt;post_data_export( '_aioseop', array(&nbsp;</div></li><li><div>                'posts_per_page' =&gt; - 1, &nbsp;</div></li><li><div>                'post_type' =&gt; $post_types, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Add all active settings to settings file */&nbsp;</div></li><li><div>        $name = $this-&gt;get_option_name();&nbsp;</div></li><li><div>        $options = $this-&gt;get_class_option();&nbsp;</div></li><li><div>        if ( ! empty( $options ) && $general_settings != null ) {&nbsp;</div></li><li><div>            $buf .= &quot;\n[$name]\n\n&quot;;&nbsp;</div></li><li><div>            foreach ( $options as $key =&gt; $value ) {&nbsp;</div></li><li><div>                if ( ( $name == $this-&gt;parent_option ) && ( $key == 'modules' ) ) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                } // don't re-export all module settings -- pdb&nbsp;</div></li><li><div>                if ( is_array( $value ) ) {&nbsp;</div></li><li><div>                    $value = &quot;'&quot; . str_replace( array( &quot;'&quot;, &quot;\n&quot;, &quot;\r&quot; ), array(&nbsp;</div></li><li><div>                            &quot;\'&quot;, &nbsp;</div></li><li><div>                            '\n', &nbsp;</div></li><li><div>                            '\r', &nbsp;</div></li><li><div> ), trim( serialize( $value ) ) ) . &quot;'&quot;;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $value = str_replace( array( &quot;\n&quot;, &quot;\r&quot; ), array(&nbsp;</div></li><li><div>                        '\n', &nbsp;</div></li><li><div>                        '\r', &nbsp;</div></li><li><div> ), trim( var_export( $value, true ) ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $buf .= &quot;$key = $value\n&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $buf;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Order for adding the menus for the aioseop_modules_add_menus hook.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function menu_order() {&nbsp;</div></li><li><div>        return 10;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Print a basic error message.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function output_error( $error ) {&nbsp;</div></li><li><div>        echo &quot;&lt;div class='aioseop_module error'&gt;$error&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /***&nbsp;</div></li><li><div>     * Backwards compatibility - see http://php.net/manual/en/function.str-getcsv.php&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function str_getcsv( $input, $delimiter = ', ', $enclosure = '&quot;', $escape = &quot;\\&quot; ) {&nbsp;</div></li><li><div>        $fp = fopen( 'php://memory', 'r+' );&nbsp;</div></li><li><div>        fputs( $fp, $input );&nbsp;</div></li><li><div>        rewind( $fp );&nbsp;</div></li><li><div>        $data = fgetcsv( $fp, null, $delimiter, $enclosure ); // $escape only got added in 5.3.0&nbsp;</div></li><li><div>        fclose( $fp );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /***&nbsp;</div></li><li><div>     * Helper function to convert csv in key/value pair format to an associative array.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function csv_to_array( $csv ) {&nbsp;</div></li><li><div>        $args = array();&nbsp;</div></li><li><div>        if ( ! function_exists( 'str_getcsv' ) ) {&nbsp;</div></li><li><div>            $v = $this-&gt;str_getcsv( $csv );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $v = str_getcsv( $csv );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $size = count( $v );&nbsp;</div></li><li><div>        if ( is_array( $v ) && isset( $v[0] ) && $size &gt;= 2 ) {&nbsp;</div></li><li><div>            for ( $i = 0; $i &lt; $size; $i += 2 ) {&nbsp;</div></li><li><div>                $args[ $v[ $i ] ] = $v[ $i + 1 ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $args;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Allow modules to use WP Filesystem if available and desired, fall back to PHP filesystem access otherwise. */&nbsp;</div></li><li><div>    function use_wp_filesystem( $method = '', $form_fields = false, $url = '', $error = false ) {&nbsp;</div></li><li><div>        if ( empty( $method ) ) {&nbsp;</div></li><li><div>            $this-&gt;credentials = request_filesystem_credentials( $url );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;credentials = request_filesystem_credentials( $url, $method, $error, false, $form_fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;credentials;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Wrapper function to get filesystem object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_filesystem_object() {&nbsp;</div></li><li><div>        $cred = get_transient( 'aioseop_fs_credentials' );&nbsp;</div></li><li><div>        if ( ! empty( $cred ) ) {&nbsp;</div></li><li><div>            $this-&gt;credentials = $cred;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( function_exists( 'WP_Filesystem' ) && WP_Filesystem( $this-&gt;credentials ) ) {&nbsp;</div></li><li><div>            global $wp_filesystem;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $wp_filesystem;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/template.php' );&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/screen.php' );&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/file.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! WP_Filesystem( $this-&gt;credentials ) ) {&nbsp;</div></li><li><div>                $this-&gt;use_wp_filesystem();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;credentials ) ) {&nbsp;</div></li><li><div>                set_transient( 'aioseop_fs_credentials', $this-&gt;credentials, 10800 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            global $wp_filesystem;&nbsp;</div></li><li><div>            if ( is_object( $wp_filesystem ) ) {&nbsp;</div></li><li><div>                return $wp_filesystem;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * See if a file exists using WP Filesystem.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function file_exists( $filename ) {&nbsp;</div></li><li><div>        $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>        if ( is_object( $wpfs ) ) {&nbsp;</div></li><li><div>            return $wpfs-&gt;exists( $filename );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $wpfs;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * See if the directory entry is a file using WP Filesystem.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function is_file( $filename ) {&nbsp;</div></li><li><div>        $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>        if ( is_object( $wpfs ) ) {&nbsp;</div></li><li><div>            return $wpfs-&gt;is_file( $filename );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $wpfs;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * List files in a directory using WP Filesystem.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function scandir( $path ) {&nbsp;</div></li><li><div>        $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>        if ( is_object( $wpfs ) ) {&nbsp;</div></li><li><div>            $dirlist = $wpfs-&gt;dirlist( $path );&nbsp;</div></li><li><div>            if ( empty( $dirlist ) ) {&nbsp;</div></li><li><div>                return $dirlist;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return array_keys( $dirlist );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $wpfs;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a file through WP Filesystem; implement basic support for offset and maxlen.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_file( $filename, $use_include_path = false, $context = null, $offset = - 1, $maxlen = - 1 ) {&nbsp;</div></li><li><div>        $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>        if ( is_object( $wpfs ) ) {&nbsp;</div></li><li><div>            if ( ! $wpfs-&gt;exists( $filename ) ) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( ( $offset &gt; 0 ) || ( $maxlen &gt;= 0 ) ) {&nbsp;</div></li><li><div>                if ( $maxlen === 0 ) {&nbsp;</div></li><li><div>                    return '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $offset &lt; 0 ) {&nbsp;</div></li><li><div>                    $offset = 0;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $file = $wpfs-&gt;get_contents( $filename );&nbsp;</div></li><li><div>                if ( ! is_string( $file ) || empty( $file ) ) {&nbsp;</div></li><li><div>                    return $file;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $maxlen &lt; 0 ) {&nbsp;</div></li><li><div>                    return $this-&gt;substr( $file, $offset );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return $this-&gt;substr( $file, $offset, $maxlen );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return $wpfs-&gt;get_contents( $filename );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a file through WP Filesystem.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_file( $filename, $contents ) {&nbsp;</div></li><li><div>        $failed_str = __( sprintf( &quot;Failed to write file %s!\n&quot;, $filename ), 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>        $readonly_str = __( sprintf( &quot;File %s isn't writable!\n&quot;, $filename ), 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>        $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>        if ( is_object( $wpfs ) ) {&nbsp;</div></li><li><div>            $file_exists = $wpfs-&gt;exists( $filename );&nbsp;</div></li><li><div>            if ( ! $file_exists || $wpfs-&gt;is_writable( $filename ) ) {&nbsp;</div></li><li><div>                if ( $wpfs-&gt;put_contents( $filename, $contents ) === false ) {&nbsp;</div></li><li><div>                    return $this-&gt;output_error( $failed_str );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return $this-&gt;output_error( $readonly_str );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete a file through WP Filesystem.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function delete_file( $filename ) {&nbsp;</div></li><li><div>        $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>        if ( is_object( $wpfs ) ) {&nbsp;</div></li><li><div>            if ( $wpfs-&gt;exists( $filename ) ) {&nbsp;</div></li><li><div>                if ( $wpfs-&gt;delete( $filename ) === false ) {&nbsp;</div></li><li><div>                    $this-&gt;output_error( __( sprintf( &quot;Failed to delete file %s!\n&quot;, $filename ), 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;output_error( __( sprintf( &quot;File %s doesn't exist!\n&quot;, $filename ), 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Rename a file through WP Filesystem.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function rename_file( $filename, $newname ) {&nbsp;</div></li><li><div>        $wpfs = $this-&gt;get_filesystem_object();&nbsp;</div></li><li><div>        if ( is_object( $wpfs ) ) {&nbsp;</div></li><li><div>            $file_exists = $wpfs-&gt;exists( $filename );&nbsp;</div></li><li><div>            $newfile_exists = $wpfs-&gt;exists( $newname );&nbsp;</div></li><li><div>            if ( $file_exists && ! $newfile_exists ) {&nbsp;</div></li><li><div>                if ( $wpfs-&gt;move( $filename, $newname ) === false ) {&nbsp;</div></li><li><div>                    $this-&gt;output_error( __( sprintf( &quot;Failed to rename file %s!\n&quot;, $filename ), 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( ! $file_exists ) {&nbsp;</div></li><li><div>                    $this-&gt;output_error( __( sprintf( &quot;File %s doesn't exist!\n&quot;, $filename ), 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>                } elseif ( $newfile_exists ) {&nbsp;</div></li><li><div>                    $this-&gt;output_error( __( sprintf( &quot;File %s already exists!\n&quot;, $newname ), 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load multiple files.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_files( $options, $opts, $prefix ) {&nbsp;</div></li><li><div>        foreach ( $opts as $opt =&gt; $file ) {&nbsp;</div></li><li><div>            $opt = $prefix . $opt;&nbsp;</div></li><li><div>            $file = ABSPATH . $file;&nbsp;</div></li><li><div>            $contents = $this-&gt;load_file( $file );&nbsp;</div></li><li><div>            if ( $contents !== false ) {&nbsp;</div></li><li><div>                $options[ $opt ] = $contents;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $options;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save multiple files.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_files( $opts, $prefix ) {&nbsp;</div></li><li><div>        foreach ( $opts as $opt =&gt; $file ) {&nbsp;</div></li><li><div>            $opt = $prefix . $opt;&nbsp;</div></li><li><div>            if ( isset( $_POST[ $opt ] ) ) {&nbsp;</div></li><li><div>                $output = stripslashes_deep( $_POST[ $opt ] );&nbsp;</div></li><li><div>                $file = ABSPATH . $file;&nbsp;</div></li><li><div>                $this-&gt;save_file( $file, $output );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete multiple files.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function delete_files( $opts ) {&nbsp;</div></li><li><div>        foreach ( $opts as $opt =&gt; $file ) {&nbsp;</div></li><li><div>            $file = ABSPATH . $file;&nbsp;</div></li><li><div>            $this-&gt;delete_file( $file );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_all_images_by_type( $options = null, $p = null ) {&nbsp;</div></li><li><div>        $img = array();&nbsp;</div></li><li><div>        if ( empty( $img ) ) {&nbsp;</div></li><li><div>            $size = apply_filters( 'post_thumbnail_size', 'large' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            global $aioseop_options, $wp_query, $aioseop_opengraph;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $p === null ) {&nbsp;</div></li><li><div>                global $post;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $post = $p;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $count = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $post ) ) {&nbsp;</div></li><li><div>                if ( ! is_object( $post ) ) {&nbsp;</div></li><li><div>                    $post = get_post( $post );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( is_object( $post ) && function_exists( 'get_post_thumbnail_id' ) ) {&nbsp;</div></li><li><div>                    if ( $post-&gt;post_type == 'attachment' ) {&nbsp;</div></li><li><div>                        $post_thumbnail_id = $post-&gt;ID;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $post_thumbnail_id = get_post_thumbnail_id( $post-&gt;ID );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ! empty( $post_thumbnail_id ) ) {&nbsp;</div></li><li><div>                        $image = wp_get_attachment_image_src( $post_thumbnail_id, $size );&nbsp;</div></li><li><div>                        if ( is_array( $image ) ) {&nbsp;</div></li><li><div>                            $img[] = array( 'type' =&gt; 'featured', 'id' =&gt; $post_thumbnail_id, 'link' =&gt; $image[0] );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $post_id = $post-&gt;ID;&nbsp;</div></li><li><div>                $p = $post;&nbsp;</div></li><li><div>                $w = $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $meta_key = '';&nbsp;</div></li><li><div>                if ( is_array( $options ) && isset( $options['meta_key'] ) ) {&nbsp;</div></li><li><div>                    $meta_key = $options['meta_key'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! empty( $meta_key ) && ! empty( $post ) ) {&nbsp;</div></li><li><div>                    $meta_key = explode( ', ', $meta_key );&nbsp;</div></li><li><div>                    $image = $this-&gt;get_the_image_by_meta_key( array(&nbsp;</div></li><li><div>                        'post_id' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>                        'meta_key' =&gt; $meta_key, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                    if ( ! empty( $image ) ) {&nbsp;</div></li><li><div>                        $img[] = array( 'type' =&gt; 'meta_key', 'id' =&gt; $meta_key, 'link' =&gt; $image );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! $post-&gt;post_modified_gmt != '' ) {&nbsp;</div></li><li><div>                    $wp_query = new WP_Query( array( 'p' =&gt; $post_id, 'post_type' =&gt; $post-&gt;post_type ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $post-&gt;post_type == 'page' ) {&nbsp;</div></li><li><div>                    $wp_query-&gt;is_page = true;&nbsp;</div></li><li><div>                } elseif ( $post-&gt;post_type == 'attachment' ) {&nbsp;</div></li><li><div>                    $wp_query-&gt;is_attachment = true;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $wp_query-&gt;is_single = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( get_option( 'show_on_front' ) == 'page' && $post-&gt;ID == get_option( 'page_for_posts' ) ) {&nbsp;</div></li><li><div>                    $wp_query-&gt;is_home = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $args['options']['type'] = 'html';&nbsp;</div></li><li><div>                $args['options']['nowrap'] = false;&nbsp;</div></li><li><div>                $args['options']['save'] = false;&nbsp;</div></li><li><div>                $wp_query-&gt;queried_object = $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $attachments = get_children( array(&nbsp;</div></li><li><div>                    'post_parent' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>                    'post_status' =&gt; 'inherit', &nbsp;</div></li><li><div>                    'post_type' =&gt; 'attachment', &nbsp;</div></li><li><div>                    'post_mime_type' =&gt; 'image', &nbsp;</div></li><li><div>                    'order' =&gt; 'ASC', &nbsp;</div></li><li><div>                    'orderby' =&gt; 'menu_order ID', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                if ( ! empty( $attachments ) ) {&nbsp;</div></li><li><div>                    foreach ( $attachments as $id =&gt; $attachment ) {&nbsp;</div></li><li><div>                        $image = wp_get_attachment_image_src( $id, $size );&nbsp;</div></li><li><div>                        if ( is_array( $image ) ) {&nbsp;</div></li><li><div>                            $img[] = array( 'type' =&gt; 'attachment', 'id' =&gt; $id, 'link' =&gt; $image[0] );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $matches = array();&nbsp;</div></li><li><div>                preg_match_all( '|&lt;img.*?src=[\'&quot;](.*?)[\'&quot;].*?&gt;|i', get_post_field( 'post_content', $post-&gt;ID ), $matches );&nbsp;</div></li><li><div>                if ( isset( $matches ) && ! empty( $matches[1] ) && ! empty( $matches[1][0] ) ) {&nbsp;</div></li><li><div>                    foreach ( $matches[1] as $i =&gt; $m ) {&nbsp;</div></li><li><div>                        $img[] = array( 'type' =&gt; 'post_content', 'id' =&gt; 'post' . $count ++, 'link' =&gt; $m );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                wp_reset_postdata();&nbsp;</div></li><li><div>                $wp_query = $w;&nbsp;</div></li><li><div>                $post = $p;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $img;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_all_images( $options = null, $p = null ) {&nbsp;</div></li><li><div>        $img = $this-&gt;get_all_images_by_type( $options, $p );&nbsp;</div></li><li><div>        $legacy = array();&nbsp;</div></li><li><div>        foreach ( $img as $k =&gt; $v ) {&nbsp;</div></li><li><div>            if ( $v['type'] == 'featured' ) {&nbsp;</div></li><li><div>                $legacy[ $v['link'] ] = 1;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $legacy[ $v['link'] ] = $v['id'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $legacy;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /*** Thanks to Justin Tadlock for the original get-the-image code - http://themehybrid.com/plugins/get-the-image ***/&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_the_image( $options = null, $p = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $p === null ) {&nbsp;</div></li><li><div>            global $post;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post = $p;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta_key = '';&nbsp;</div></li><li><div>        if ( is_array( $options ) && isset( $options['meta_key'] ) ) {&nbsp;</div></li><li><div>            $meta_key = $options['meta_key'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $meta_key ) && ! empty( $post ) ) {&nbsp;</div></li><li><div>            $meta_key = explode( ', ', $meta_key );&nbsp;</div></li><li><div>            $image = $this-&gt;get_the_image_by_meta_key( array(&nbsp;</div></li><li><div>                'post_id' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>                'meta_key' =&gt; $meta_key, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $image ) ) {&nbsp;</div></li><li><div>            $image = $this-&gt;get_the_image_by_post_thumbnail( $post );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $image ) ) {&nbsp;</div></li><li><div>            $image = $this-&gt;get_the_image_by_attachment( $post );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $image ) ) {&nbsp;</div></li><li><div>            $image = $this-&gt;get_the_image_by_scan( $post );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $image ) ) {&nbsp;</div></li><li><div>            $image = $this-&gt;get_the_image_by_default( $post );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $image;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_the_image_by_default( $p = null ) {&nbsp;</div></li><li><div>        return '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_the_image_by_meta_key( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** If $meta_key is not an array. */&nbsp;</div></li><li><div>        if ( ! is_array( $args['meta_key'] ) ) {&nbsp;</div></li><li><div>            $args['meta_key'] = array( $args['meta_key'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Loop through each of the given meta keys. */&nbsp;</div></li><li><div>        foreach ( $args['meta_key'] as $meta_key ) {&nbsp;</div></li><li><div>            /** Get the image URL by the current meta key in the loop. */&nbsp;</div></li><li><div>            $image = get_post_meta( $args['post_id'], $meta_key, true );&nbsp;</div></li><li><div>            /** If a custom key value has been given for one of the keys, return the image URL. */&nbsp;</div></li><li><div>            if ( ! empty( $image ) ) {&nbsp;</div></li><li><div>                return $image;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_the_image_by_post_thumbnail( $p = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $p === null ) {&nbsp;</div></li><li><div>            global $post;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post = $p;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_thumbnail_id = null;&nbsp;</div></li><li><div>        if ( function_exists( 'get_post_thumbnail_id' ) ) {&nbsp;</div></li><li><div>            $post_thumbnail_id = get_post_thumbnail_id( $post-&gt;ID );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $post_thumbnail_id ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $size = apply_filters( 'post_thumbnail_size', 'large' );&nbsp;</div></li><li><div>        $image = wp_get_attachment_image_src( $post_thumbnail_id, $size );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $image[0];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_the_image_by_attachment( $p = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $p === null ) {&nbsp;</div></li><li><div>            global $post;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post = $p;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $attachments = get_children( array(&nbsp;</div></li><li><div>            'post_parent' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>            'post_status' =&gt; 'inherit', &nbsp;</div></li><li><div>            'post_type' =&gt; 'attachment', &nbsp;</div></li><li><div>            'post_mime_type' =&gt; 'image', &nbsp;</div></li><li><div>            'order' =&gt; 'ASC', &nbsp;</div></li><li><div>            'orderby' =&gt; 'menu_order ID', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $attachments ) && 'attachment' == get_post_type( $post-&gt;ID ) ) {&nbsp;</div></li><li><div>            $image = wp_get_attachment_image_src( $post-&gt;ID, 'large' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** If no attachments or image is found, return false. */&nbsp;</div></li><li><div>        if ( empty( $attachments ) && empty( $image ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Set the default iterator to 0. */&nbsp;</div></li><li><div>        $i = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Loop through each attachment. Once the $order_of_image (default is '1') is reached, break the loop. */&nbsp;</div></li><li><div>        foreach ( $attachments as $id =&gt; $attachment ) {&nbsp;</div></li><li><div>            if ( ++ $i == 1 ) {&nbsp;</div></li><li><div>                $image = wp_get_attachment_image_src( $id, 'large' );&nbsp;</div></li><li><div>                $alt = trim( strip_tags( get_post_field( 'post_excerpt', $id ) ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Return the image URL. */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $image[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_the_image_by_scan( $p = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $p === null ) {&nbsp;</div></li><li><div>            global $post;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $post = $p;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Search the post's content for the &lt;img /&gt; tag and get its URL. */&nbsp;</div></li><li><div>        preg_match_all( '|&lt;img.*?src=[\'&quot;](.*?)[\'&quot;].*?&gt;|i', get_post_field( 'post_content', $post-&gt;ID ), $matches );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** If there is a match for the image, return its URL. */&nbsp;</div></li><li><div>        if ( isset( $matches ) && ! empty( $matches[1][0] ) ) {&nbsp;</div></li><li><div>            return $matches[1][0];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** crude approximization of whether current user is an admin */&nbsp;</div></li><li><div>    function is_admin() {&nbsp;</div></li><li><div>        return current_user_can( 'level_8' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function help_text_helper( &$default_options, $options, $help_link = '' ) {&nbsp;</div></li><li><div>        foreach ( $options as $o ) {&nbsp;</div></li><li><div>            $ht = '';&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;help_text[ $o ] ) ) {&nbsp;</div></li><li><div>                $ht = $this-&gt;help_text[ $o ];&nbsp;</div></li><li><div>            } elseif ( ! empty( $default_options[ $o ]['help_text'] ) ) {&nbsp;</div></li><li><div>                $ht = $default_options[ $o ]['help_text'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $ht && ! is_array( $ht ) ) {&nbsp;</div></li><li><div>                $ha = '';&nbsp;</div></li><li><div>                $hl = $help_link;&nbsp;</div></li><li><div>                if ( strpos( $o, 'ga_' ) === 0 ) { // special case -- pdb&nbsp;</div></li><li><div>                    $hl = 'http://semperplugins.com/documentation/advanced-google-analytics-settings/';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! empty( $this-&gt;help_anchors[ $o ] ) ) {&nbsp;</div></li><li><div>                    $ha = $this-&gt;help_anchors[ $o ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! empty( $ha ) && ( $pos = strrpos( $hl, '#' ) ) ) {&nbsp;</div></li><li><div>                    $hl = substr( $hl, 0, $pos );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! empty( $ha ) && ( $ha[0] == 'h' ) ) {&nbsp;</div></li><li><div>                    $hl = '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! empty( $ha ) || ! isset( $this-&gt;help_anchors[ $o ] ) ) {&nbsp;</div></li><li><div>                    $ht .= &quot;&lt;br /&gt;&lt;a href='&quot; . $hl . $ha . &quot;' target='_blank'&gt;&quot; . __( 'Click here for documentation on this setting', 'all-in-one-seo-pack' ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $default_options[ $o ]['help_text'] = $ht;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function add_help_text_links() {&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;help_text ) ) {&nbsp;</div></li><li><div>            foreach ( $this-&gt;layout as $k =&gt; $v ) {&nbsp;</div></li><li><div>                $this-&gt;help_text_helper( $this-&gt;default_options, $v['options'], $v['help_link'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;locations ) ) {&nbsp;</div></li><li><div>                foreach ( $this-&gt;locations as $k =&gt; $v ) {&nbsp;</div></li><li><div>                    if ( ! empty( $v['default_options'] ) && ! empty( $v['options'] ) ) {&nbsp;</div></li><li><div>                        $this-&gt;help_text_helper( $this-&gt;locations[ $k ]['default_options'], $v['options'], $v['help_link'] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load scripts and styles for metaboxes.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * edit-tags exists only for pre 4.5 support... remove when we drop 4.5 support.&nbsp;</div></li><li><div>     * Also, that check and others should be pulled out into their own functions&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function enqueue_metabox_scripts() {&nbsp;</div></li><li><div>        $screen = '';&nbsp;</div></li><li><div>        if ( function_exists( 'get_current_screen' ) ) {&nbsp;</div></li><li><div>            $screen = get_current_screen();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $bail = false;&nbsp;</div></li><li><div>        if ( empty( $screen ) ) {&nbsp;</div></li><li><div>            $bail = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ( $screen-&gt;base != 'post' ) && ( $screen-&gt;base != 'term' ) && ( $screen-&gt;base != 'edit-tags' ) && ( $screen-&gt;base != 'toplevel_page_shopp-products' ) ) {&nbsp;</div></li><li><div>            $bail = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $prefix = $this-&gt;get_prefix();&nbsp;</div></li><li><div>        $bail = apply_filters( $prefix . 'bail_on_enqueue', $bail, $screen );&nbsp;</div></li><li><div>        if ( $bail ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;form = 'post';&nbsp;</div></li><li><div>        if ( $screen-&gt;base == 'term' || $screen-&gt;base == 'edit-tags' ) {&nbsp;</div></li><li><div>            $this-&gt;form = 'edittag';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $screen-&gt;base == 'toplevel_page_shopp-products' ) {&nbsp;</div></li><li><div>            $this-&gt;form = 'product';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;form = apply_filters( $prefix . 'set_form_on_enqueue', $this-&gt;form, $screen );&nbsp;</div></li><li><div>        foreach ( $this-&gt;locations as $k =&gt; $v ) {&nbsp;</div></li><li><div>            if ( $v['type'] === 'metabox' && isset( $v['display'] ) && ! empty( $v['display'] ) ) {&nbsp;</div></li><li><div>                $enqueue_scripts = false;&nbsp;</div></li><li><div>                $enqueue_scripts = ( ( ( $screen-&gt;base == 'toplevel_page_shopp-products' ) && in_array( 'shopp_product', $v['display'] ) ) ) || in_array( $screen-&gt;post_type, $v['display'] );&nbsp;</div></li><li><div>                $enqueue_scripts = apply_filters( $prefix . 'enqueue_metabox_scripts', $enqueue_scripts, $screen, $v );&nbsp;</div></li><li><div>                if ( $enqueue_scripts ) {&nbsp;</div></li><li><div>                    add_filter( 'aioseop_localize_script_data', array( $this, 'localize_script_data' ) );&nbsp;</div></li><li><div>                    add_action( 'admin_print_scripts', array( $this, 'enqueue_scripts' ), 20 );&nbsp;</div></li><li><div>                    add_action( 'admin_print_scripts', array( $this, 'enqueue_styles' ), 20 );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load styles for module.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function enqueue_styles() {&nbsp;</div></li><li><div>        wp_enqueue_style( 'thickbox' );&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;pointers ) ) {&nbsp;</div></li><li><div>            wp_enqueue_style( 'wp-pointer' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_enqueue_style( 'aioseop-module-style', AIOSEOP_PLUGIN_URL . 'css/modules/aioseop_module.css' );&nbsp;</div></li><li><div>        if ( function_exists( 'is_rtl' ) && is_rtl() ) {&nbsp;</div></li><li><div>            wp_enqueue_style( 'aioseop-module-style-rtl', AIOSEOP_PLUGIN_URL . 'css/modules/aioseop_module-rtl.css', array( 'aioseop-module-style' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load scripts for module, can pass data to module script.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function enqueue_scripts() {&nbsp;</div></li><li><div>        wp_enqueue_script( 'sack' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'jquery' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'media-upload' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'thickbox' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'common' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'wp-lists' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'postbox' );&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;pointers ) ) {&nbsp;</div></li><li><div>            wp_enqueue_script( 'wp-pointer', false, array( 'jquery' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_enqueue_script( 'aioseop-module-script', AIOSEOP_PLUGIN_URL . 'js/modules/aioseop_module.js', array(), AIOSEOP_VERSION );&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;script_data ) ) {&nbsp;</div></li><li><div>            aioseop_localize_script_data();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function localize_script_data( $data ) {&nbsp;</div></li><li><div>        if ( ! is_array( $data ) ) {&nbsp;</div></li><li><div>            $data = array( 0 =&gt; $data );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $this-&gt;script_data ) ) {&nbsp;</div></li><li><div>            $this-&gt;script_data = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;pointers ) ) {&nbsp;</div></li><li><div>            $this-&gt;script_data['pointers'] = $this-&gt;pointers;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $data[0]['condshow'] ) ) {&nbsp;</div></li><li><div>            $data[0]['condshow'] = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $this-&gt;script_data['condshow'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;script_data['condshow'] = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $condshow = $this-&gt;script_data['condshow'];&nbsp;</div></li><li><div>        $data[0]['condshow'] = array_merge( $data[0]['condshow'], $condshow );&nbsp;</div></li><li><div>        unset( $this-&gt;script_data['condshow'] );&nbsp;</div></li><li><div>        $data[0] = array_merge( $this-&gt;script_data, $data[0] );&nbsp;</div></li><li><div>        $this-&gt;script_data['condshow'] = $condshow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Override this to run code at the beginning of the settings page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function settings_page_init() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter out admin pointers that have already been clicked.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function filter_pointers() {&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;pointers ) ) {&nbsp;</div></li><li><div>            $dismissed = explode( ', ', (string) get_user_meta( get_current_user_id(), 'dismissed_wp_pointers', true ) );&nbsp;</div></li><li><div>            foreach ( $dismissed as $d ) {&nbsp;</div></li><li><div>                if ( isset( $this-&gt;pointers[ $d ] ) ) {&nbsp;</div></li><li><div>                    unset( $this-&gt;pointers[ $d ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add basic hooks when on the module's page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_page_hooks() {&nbsp;</div></li><li><div>        $hookname = current_filter();&nbsp;</div></li><li><div>        if ( $this-&gt;strpos( $hookname, 'load-' ) === 0 ) {&nbsp;</div></li><li><div>            $this-&gt;pagehook = $this-&gt;substr( $hookname, 5 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        add_action( 'admin_print_scripts', array( $this, 'enqueue_scripts' ) );&nbsp;</div></li><li><div>        add_action( 'admin_print_styles', array( $this, 'enqueue_styles' ) );&nbsp;</div></li><li><div>        add_filter( 'aioseop_localize_script_data', array( $this, 'localize_script_data' ) );&nbsp;</div></li><li><div>        add_action( $this-&gt;prefix . 'settings_header', array( $this, 'display_tabs' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_admin_links() {&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;menu_name ) ) {&nbsp;</div></li><li><div>            $name = $this-&gt;menu_name;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $name = $this-&gt;name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $hookname = plugin_basename( $this-&gt;file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $links = array();&nbsp;</div></li><li><div>        $url = '';&nbsp;</div></li><li><div>        if ( function_exists( 'menu_page_url' ) ) {&nbsp;</div></li><li><div>            $url = menu_page_url( $hookname, 0 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( empty( $url ) ) {&nbsp;</div></li><li><div>            $url = esc_url( admin_url( 'admin.php?page=' . $hookname ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;locations === null ) {&nbsp;</div></li><li><div>            array_unshift( $links, array(&nbsp;</div></li><li><div>                'parent' =&gt; AIOSEOP_PLUGIN_DIRNAME, &nbsp;</div></li><li><div>                'title' =&gt; $name, &nbsp;</div></li><li><div>                'id' =&gt; $hookname, &nbsp;</div></li><li><div>                'href' =&gt; $url, &nbsp;</div></li><li><div>                'order' =&gt; $this-&gt;menu_order(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            foreach ( $this-&gt;locations as $k =&gt; $v ) {&nbsp;</div></li><li><div>                if ( $v['type'] === 'settings' ) {&nbsp;</div></li><li><div>                    if ( $k === 'default' ) {&nbsp;</div></li><li><div>                        array_unshift( $links, array(&nbsp;</div></li><li><div>                            'parent' =&gt; AIOSEOP_PLUGIN_DIRNAME, &nbsp;</div></li><li><div>                            'title' =&gt; $name, &nbsp;</div></li><li><div>                            'id' =&gt; $hookname, &nbsp;</div></li><li><div>                            'href' =&gt; $url, &nbsp;</div></li><li><div>                            'order' =&gt; $this-&gt;menu_order(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        if ( ! empty( $v['menu_name'] ) ) {&nbsp;</div></li><li><div>                            $name = $v['menu_name'];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $name = $v['name'];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        array_unshift( $links, array(&nbsp;</div></li><li><div>                            'parent' =&gt; AIOSEOP_PLUGIN_DIRNAME, &nbsp;</div></li><li><div>                            'title' =&gt; $name, &nbsp;</div></li><li><div>                            'id' =&gt; $this-&gt;get_prefix( $k ) . $k, &nbsp;</div></li><li><div>                            'href' =&gt; esc_url( admin_url( 'admin.php?page=' . $this-&gt;get_prefix( $k ) . $k ) ), &nbsp;</div></li><li><div>                            'order' =&gt; $this-&gt;menu_order(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $links;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function add_admin_bar_submenu() {&nbsp;</div></li><li><div>        global $aioseop_admin_menu, $wp_admin_bar;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $aioseop_admin_menu ) {&nbsp;</div></li><li><div>            $links = $this-&gt;get_admin_links();&nbsp;</div></li><li><div>            if ( ! empty( $links ) ) {&nbsp;</div></li><li><div>                foreach ( $links as $l ) {&nbsp;</div></li><li><div>                    $wp_admin_bar-&gt;add_menu( $l );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Collect metabox data together for tabbed metaboxes.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function filter_return_metaboxes( $args ) {&nbsp;</div></li><li><div>        return array_merge( $args, $this-&gt;post_metaboxes );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Add submenu for module, call page hooks, set up metaboxes. */&nbsp;</div></li><li><div>    function add_menu( $parent_slug ) {&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;menu_name ) ) {&nbsp;</div></li><li><div>            $name = $this-&gt;menu_name;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $name = $this-&gt;name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $this-&gt;locations === null ) {&nbsp;</div></li><li><div>            $hookname = add_submenu_page( $parent_slug, $name, $name, apply_filters( 'manage_aiosp', 'aiosp_manage_seo' ), plugin_basename( $this-&gt;file ), array(&nbsp;</div></li><li><div>                $this, &nbsp;</div></li><li><div>                'display_settings_page', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>            add_action( &quot;load-{$hookname}&quot;, array( $this, 'add_page_hooks' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ( $this-&gt;locations as $k =&gt; $v ) {&nbsp;</div></li><li><div>            if ( $v['type'] === 'settings' ) {&nbsp;</div></li><li><div>                if ( $k === 'default' ) {&nbsp;</div></li><li><div>                    if ( ! empty( $this-&gt;menu_name ) ) {&nbsp;</div></li><li><div>                        $name = $this-&gt;menu_name;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $name = $this-&gt;name;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $hookname = add_submenu_page( $parent_slug, $name, $name, apply_filters( 'manage_aiosp', 'aiosp_manage_seo' ), plugin_basename( $this-&gt;file ), array(&nbsp;</div></li><li><div>                        $this, &nbsp;</div></li><li><div>                        'display_settings_page', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    if ( ! empty( $v['menu_name'] ) ) {&nbsp;</div></li><li><div>                        $name = $v['menu_name'];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $name = $v['name'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $hookname = add_submenu_page( $parent_slug, $name, $name, apply_filters( 'manage_aiosp', 'aiosp_manage_seo' ), $this-&gt;get_prefix( $k ) . $k, array(&nbsp;</div></li><li><div>                        $this, &nbsp;</div></li><li><div>                        &quot;display_settings_page_$k&quot;, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                add_action( &quot;load-{$hookname}&quot;, array( $this, 'add_page_hooks' ) );&nbsp;</div></li><li><div>            } elseif ( $v['type'] === 'metabox' ) {&nbsp;</div></li><li><div>                $this-&gt;setting_options( $k ); // hack -- make sure this runs anyhow, for now -- pdb&nbsp;</div></li><li><div>                add_action( 'edit_post', array( $this, 'save_post_data' ) );&nbsp;</div></li><li><div>                add_action( 'publish_post', array( $this, 'save_post_data' ) );&nbsp;</div></li><li><div>                add_action( 'add_attachment', array( $this, 'save_post_data' ) );&nbsp;</div></li><li><div>                add_action( 'edit_attachment', array( $this, 'save_post_data' ) );&nbsp;</div></li><li><div>                add_action( 'save_post', array( $this, 'save_post_data' ) );&nbsp;</div></li><li><div>                add_action( 'edit_page_form', array( $this, 'save_post_data' ) );&nbsp;</div></li><li><div>                if ( isset( $v['display'] ) && ! empty( $v['display'] ) ) {&nbsp;</div></li><li><div>                    add_action( 'admin_print_scripts', array( $this, 'enqueue_metabox_scripts' ), 5 );&nbsp;</div></li><li><div>                    if ( $this-&gt;tabbed_metaboxes ) {&nbsp;</div></li><li><div>                        add_filter( 'aioseop_add_post_metabox', array( $this, 'filter_return_metaboxes' ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    foreach ( $v['display'] as $posttype ) {&nbsp;</div></li><li><div>                        $v['location'] = $k;&nbsp;</div></li><li><div>                        $v['posttype'] = $posttype;&nbsp;</div></li><li><div>                        if ( ! isset( $v['context'] ) ) {&nbsp;</div></li><li><div>                            $v['context'] = 'advanced';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ( ! isset( $v['priority'] ) ) {&nbsp;</div></li><li><div>                            $v['priority'] = 'default';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ( $this-&gt;tabbed_metaboxes ) {&nbsp;</div></li><li><div>                            $this-&gt;post_metaboxes[] = array(&nbsp;</div></li><li><div>                                'id' =&gt; $v['prefix'] . $k, &nbsp;</div></li><li><div>                                'title' =&gt; $v['name'], &nbsp;</div></li><li><div>                                'callback' =&gt; array( $this, 'display_metabox' ), &nbsp;</div></li><li><div>                                'post_type' =&gt; $posttype, &nbsp;</div></li><li><div>                                'context' =&gt; $v['context'], &nbsp;</div></li><li><div>                                'priority' =&gt; $v['priority'], &nbsp;</div></li><li><div>                                'callback_args' =&gt; $v, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $title = $v['name'];&nbsp;</div></li><li><div>                            if ( $title != $this-&gt;plugin_name ) {&nbsp;</div></li><li><div>                                $title = $this-&gt;plugin_name . ' - ' . $title;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if ( ! empty( $v['help_link'] ) ) {&nbsp;</div></li><li><div>                                $title .= &quot;&lt;a class='aioseop_help_text_link aioseop_meta_box_help' target='_blank' href='&quot; . $lopts['help_link'] . &quot;'&gt;&lt;span&gt;&quot; . __( 'Help', 'all-in-one-seo-pack' ) . '&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            add_meta_box( $v['prefix'] . $k, $title, array(&nbsp;</div></li><li><div>                                $this, &nbsp;</div></li><li><div>                                'display_metabox', &nbsp;</div></li><li><div> ), $posttype, $v['context'], $v['priority'], $v );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update postmeta for metabox.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_post_data( $post_id ) {&nbsp;</div></li><li><div>        static $update = false;&nbsp;</div></li><li><div>        if ( $update ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $this-&gt;locations !== null ) {&nbsp;</div></li><li><div>            foreach ( $this-&gt;locations as $k =&gt; $v ) {&nbsp;</div></li><li><div>                if ( isset( $v['type'] ) && ( $v['type'] === 'metabox' ) ) {&nbsp;</div></li><li><div>                    $opts = $this-&gt;default_options( $k );&nbsp;</div></li><li><div>                    $options = array();&nbsp;</div></li><li><div>                    $update = false;&nbsp;</div></li><li><div>                    foreach ( $opts as $l =&gt; $o ) {&nbsp;</div></li><li><div>                        if ( isset( $_POST[ $l ] ) ) {&nbsp;</div></li><li><div>                            $options[ $l ] = stripslashes_deep( $_POST[ $l ] );&nbsp;</div></li><li><div>                            $options[ $l ] = esc_attr( $options[ $l ] );&nbsp;</div></li><li><div>                            $update = true;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( $update ) {&nbsp;</div></li><li><div>                        $prefix = $this-&gt;get_prefix( $k );&nbsp;</div></li><li><div>                        $options = apply_filters( $prefix . 'filter_metabox_options', $options, $k, $post_id );&nbsp;</div></li><li><div>                        update_post_meta( $post_id, '_' . $prefix . $k, $options );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Outputs radio buttons, checkboxes, selects, multiselects, handles groups.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function do_multi_input( $args ) {&nbsp;</div></li><li><div>        extract( $args );&nbsp;</div></li><li><div>        $buf1 = '';&nbsp;</div></li><li><div>        $type = $options['type'];&nbsp;</div></li><li><div>        if ( ( $type == 'radio' ) || ( $type == 'checkbox' ) ) {&nbsp;</div></li><li><div>            $strings = array(&nbsp;</div></li><li><div>                'block' =&gt; &quot;%s\n&quot;, &nbsp;</div></li><li><div>                'group' =&gt; &quot;\t&lt;b&gt;%s&lt;/b&gt;&lt;br&gt;\n%s\n&quot;, &nbsp;</div></li><li><div>                'item' =&gt; &quot;\t&lt;label class='aioseop_option_setting_label'&gt;&lt;input type='$type' %s name='%s' value='%s' %s&gt; %s&lt;/label&gt;\n&quot;, &nbsp;</div></li><li><div>                'item_args' =&gt; array( 'sel', 'name', 'v', 'attr', 'subopt' ), &nbsp;</div></li><li><div>                'selected' =&gt; 'checked ', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $strings = array(&nbsp;</div></li><li><div>                'block' =&gt; &quot;&lt;select name='$name' $attr&gt;%s\n&lt;/select&gt;\n&quot;, &nbsp;</div></li><li><div>                'group' =&gt; &quot;\t&lt;optgroup label='%s'&gt;\n%s\t&lt;/optgroup&gt;\n&quot;, &nbsp;</div></li><li><div>                'item' =&gt; &quot;\t&lt;option %s value='%s'&gt;%s&lt;/option&gt;\n&quot;, &nbsp;</div></li><li><div>                'item_args' =&gt; array( 'sel', 'v', 'subopt' ), &nbsp;</div></li><li><div>                'selected' =&gt; 'selected ', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $setsel = $strings['selected'];&nbsp;</div></li><li><div>        if ( isset( $options['initial_options'] ) && is_array( $options['initial_options'] ) ) {&nbsp;</div></li><li><div>            foreach ( $options['initial_options'] as $l =&gt; $option ) {&nbsp;</div></li><li><div>                $is_group = is_array( $option );&nbsp;</div></li><li><div>                if ( ! $is_group ) {&nbsp;</div></li><li><div>                    $option = array( $l =&gt; $option );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $buf2 = '';&nbsp;</div></li><li><div>                foreach ( $option as $v =&gt; $subopt ) {&nbsp;</div></li><li><div>                    $sel = '';&nbsp;</div></li><li><div>                    $is_arr = is_array( $value );&nbsp;</div></li><li><div>                    if ( is_string( $v ) || is_string( $value ) ) {&nbsp;</div></li><li><div>                        if ( is_string( $value ) ) {&nbsp;</div></li><li><div>                            $cmp = ! strcmp( $v, $value );&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $cmp = ! strcmp( $v, '' );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        //    $cmp = !strcmp( (string)$v, (string)$value );&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $cmp = ( $value == $v );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ( ! $is_arr && $cmp ) || ( $is_arr && in_array( $v, $value ) ) ) {&nbsp;</div></li><li><div>                        $sel = $setsel;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $item_arr = array();&nbsp;</div></li><li><div>                    foreach ( $strings['item_args'] as $arg ) {&nbsp;</div></li><li><div>                        $item_arr[] = $$arg;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $buf2 .= vsprintf( $strings['item'], $item_arr );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $is_group ) {&nbsp;</div></li><li><div>                    $buf1 .= sprintf( $strings['group'], $l, $buf2 );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $buf1 .= $buf2;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $buf1 = sprintf( $strings['block'], $buf1 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $buf1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Outputs a setting item for settings pages and metaboxes.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_option_html( $args ) {&nbsp;</div></li><li><div>        static $n = 0;&nbsp;</div></li><li><div>        extract( $args );&nbsp;</div></li><li><div>        if ( $options['type'] == 'custom' ) {&nbsp;</div></li><li><div>            return apply_filters( &quot;{$prefix}output_option&quot;, '', $args );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( in_array( $options['type'], array(&nbsp;</div></li><li><div>                'multiselect', &nbsp;</div></li><li><div>                'select', &nbsp;</div></li><li><div>                'multicheckbox', &nbsp;</div></li><li><div>                'radio', &nbsp;</div></li><li><div>                'checkbox', &nbsp;</div></li><li><div>                'textarea', &nbsp;</div></li><li><div>                'text', &nbsp;</div></li><li><div>                'submit', &nbsp;</div></li><li><div>                'hidden', &nbsp;</div></li><li><div> ) ) && is_string( $value )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>            $value = esc_attr( $value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $buf = '';&nbsp;</div></li><li><div>        $onload = '';&nbsp;</div></li><li><div>        if ( ! empty( $options['count'] ) ) {&nbsp;</div></li><li><div>            $n ++;&nbsp;</div></li><li><div>            $attr .= &quot; onKeyDown='if (typeof countChars == \&quot;function\&quot;) countChars(document.{$this-&gt;form}.$name, document.{$this-&gt;form}.{$prefix}length$n)' onKeyUp='if (typeof countChars == \&quot;function\&quot;) countChars(document.{$this-&gt;form}.$name, document.{$this-&gt;form}.{$prefix}length$n)'&quot;;&nbsp;</div></li><li><div>            $onload = &quot;if (typeof countChars == \&quot;function\&quot;) countChars(document.{$this-&gt;form}.$name, document.{$this-&gt;form}.{$prefix}length$n);&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( isset( $opts['id'] ) ) {&nbsp;</div></li><li><div>            $attr .= &quot; id=\&quot;{$opts['id']}\&quot; &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        switch ( $options['type'] ) {&nbsp;</div></li><li><div>            case 'multiselect':&nbsp;</div></li><li><div>                $attr .= ' MULTIPLE';&nbsp;</div></li><li><div>                $args['attr'] = $attr;&nbsp;</div></li><li><div>                $args['name'] = $name = &quot;{$name}[]&quot;;&nbsp;</div></li><li><div>            case 'select':&nbsp;</div></li><li><div>                $buf .= $this-&gt;do_multi_input( $args );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'multicheckbox':&nbsp;</div></li><li><div>                $args['name'] = $name = &quot;{$name}[]&quot;;&nbsp;</div></li><li><div>                $args['options']['type'] = $options['type'] = 'checkbox';&nbsp;</div></li><li><div>            case 'radio':&nbsp;</div></li><li><div>                $buf .= $this-&gt;do_multi_input( $args );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'checkbox':&nbsp;</div></li><li><div>                if ( $value ) {&nbsp;</div></li><li><div>                    $attr .= ' CHECKED';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $buf .= &quot;&lt;input name='$name' type='{$options['type']}' $attr&gt;\n&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'textarea':&nbsp;</div></li><li><div>                $buf .= &quot;&lt;textarea name='$name' $attr&gt;$value&lt;/textarea&gt;&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'image':&nbsp;</div></li><li><div>                $buf .= &quot;&lt;input class='aioseop_upload_image_button button-primary' type='button' value='Upload Image' style='float:left;' /&gt;&quot; .&nbsp;</div></li><li><div>                        &quot;&lt;input class='aioseop_upload_image_label' name='$name' type='text' $attr value='$value' size=57 style='float:left;clear:left;'&gt;\n&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'html':&nbsp;</div></li><li><div>                $buf .= $value;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'esc_html':&nbsp;</div></li><li><div>                $buf .= &quot;&lt;pre&gt;&quot; . esc_html( $value ) . &quot;&lt;/pre&gt;\n&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                $buf .= &quot;&lt;input name='$name' type='{$options['type']}' $attr value='$value'&gt;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $options['count'] ) ) {&nbsp;</div></li><li><div>            $size = 60;&nbsp;</div></li><li><div>            if ( isset( $options['size'] ) ) {&nbsp;</div></li><li><div>                $size = $options['size'];&nbsp;</div></li><li><div>            } elseif ( isset( $options['rows'] ) && isset( $options['cols'] ) ) {&nbsp;</div></li><li><div>                $size = $options['rows'] * $options['cols'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( isset( $options['count_desc'] ) ) {&nbsp;</div></li><li><div>                $count_desc = $options['count_desc'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $count_desc = __( ' characters. Most search engines use a maximum of %s chars for the %s.', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $buf .= &quot;&lt;br /&gt;&lt;input readonly type='text' name='{$prefix}length$n' size='3' maxlength='3' style='width:53px;height:23px;margin:0px;padding:0px 0px 0px 10px;' value='&quot; . $this-&gt;strlen( $value ) . &quot;' /&gt;&quot;&nbsp;</div></li><li><div>                    . sprintf( $count_desc, $size, trim( $this-&gt;strtolower( $options['name'] ), ':' ) );&nbsp;</div></li><li><div>            if ( ! empty( $onload ) ) {&nbsp;</div></li><li><div>                $buf .= &quot;&lt;script&gt;jQuery( document ).ready(function() { {$onload} });&lt;/script&gt;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $buf;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    const DISPLAY_HELP_START = '&lt;a class=&quot;aioseop_help_text_link&quot; style=&quot;cursor:pointer;&quot; title=&quot;%s&quot; onclick=&quot;toggleVisibility(\'%s_tip\');&quot;&gt;&lt;label class=&quot;aioseop_label textinput&quot;&gt;%s&lt;/label&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>    const DISPLAY_HELP_END = '&lt;div class=&quot;aioseop_help_text_div&quot; style=&quot;display:none&quot; id=&quot;%s_tip&quot;&gt;&lt;label class=&quot;aioseop_help_text&quot;&gt;%s&lt;/label&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>    const DISPLAY_LABEL_FORMAT = '&lt;span class=&quot;aioseop_option_label&quot; style=&quot;text-align:%s;vertical-align:top;&quot;&gt;%s&lt;/span&gt;';&nbsp;</div></li><li><div>    const DISPLAY_TOP_LABEL = &quot;&lt;/div&gt;\n&lt;div class='aioseop_input aioseop_top_label'&gt;\n&quot;;&nbsp;</div></li><li><div>    const DISPLAY_ROW_TEMPLATE = '&lt;div class=&quot;aioseop_wrapper%s&quot; id=&quot;%s_wrapper&quot;&gt;&lt;div class=&quot;aioseop_input&quot;&gt;%s&lt;span class=&quot;aioseop_option_input&quot;&gt;&lt;div class=&quot;aioseop_option_div&quot; %s&gt;%s&lt;/div&gt;%s&lt;/span&gt;&lt;p style=&quot;clear:left&quot;&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Format a row for an option on a settings page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_option_row( $name, $opts, $args ) {&nbsp;</div></li><li><div>        $label_text = $input_attr = $help_text_2 = $id_attr = '';&nbsp;</div></li><li><div>        if ( $opts['label'] == 'top' ) {&nbsp;</div></li><li><div>            $align = 'left';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $align = 'right';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( isset( $opts['id'] ) ) {&nbsp;</div></li><li><div>            $id_attr .= &quot; id=\&quot;{$opts['id']}_div\&quot; &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $opts['label'] != 'none' ) {&nbsp;</div></li><li><div>            if ( isset( $opts['help_text'] ) ) {&nbsp;</div></li><li><div>                $help_text = sprintf( All_in_One_SEO_Pack_Module::DISPLAY_HELP_START, __( 'Click for Help!', 'all-in-one-seo-pack' ), $name, $opts['name'] );&nbsp;</div></li><li><div>                $help_text_2 = sprintf( All_in_One_SEO_Pack_Module::DISPLAY_HELP_END, $name, $opts['help_text'] );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $help_text = $opts['name'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $label_text = sprintf( All_in_One_SEO_Pack_Module::DISPLAY_LABEL_FORMAT, $align, $help_text );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $input_attr .= ' aioseop_no_label ';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $opts['label'] == 'top' ) {&nbsp;</div></li><li><div>            $label_text .= All_in_One_SEO_Pack_Module::DISPLAY_TOP_LABEL;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $input_attr .= &quot; aioseop_{$opts['type']}_type&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return sprintf( All_in_One_SEO_Pack_Module::DISPLAY_ROW_TEMPLATE, $input_attr, $name, $label_text, $id_attr, $this-&gt;get_option_html( $args ), $help_text_2 );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display options for settings pages and metaboxes, allows for filtering settings, custom display options.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function display_options( $location = null, $meta_args = null ) {&nbsp;</div></li><li><div>        static $location_settings = array();&nbsp;</div></li><li><div>        $defaults = null;&nbsp;</div></li><li><div>        $prefix = $this-&gt;get_prefix( $location );&nbsp;</div></li><li><div>        $help_link = '';&nbsp;</div></li><li><div>        if ( is_array( $meta_args['args'] ) && ! empty( $meta_args['args']['default_options'] ) ) {&nbsp;</div></li><li><div>            $defaults = $meta_args['args']['default_options'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $meta_args['callback_args'] ) && ! empty( $meta_args['callback_args']['help_link'] ) ) {&nbsp;</div></li><li><div>            $help_link = $meta_args['callback_args']['help_link'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $help_link ) ) {&nbsp;</div></li><li><div>            echo &quot;&lt;a class='aioseop_help_text_link aioseop_meta_box_help' target='_blank' href='&quot; . $help_link . &quot;'&gt;&lt;span&gt;&quot; . __( 'Help', 'all-in-one-seo-pack' ) . '&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $location_settings[ $prefix ] ) ) {&nbsp;</div></li><li><div>            $current_options = apply_filters( &quot;{$this-&gt;prefix}display_options&quot;, $this-&gt;get_current_options( array(), $location, $defaults ), $location );&nbsp;</div></li><li><div>            $settings = apply_filters( &quot;{$this-&gt;prefix}display_settings&quot;, $this-&gt;setting_options( $location, $defaults ), $location, $current_options );&nbsp;</div></li><li><div>            $current_options = apply_filters( &quot;{$this-&gt;prefix}override_options&quot;, $current_options, $location, $settings );&nbsp;</div></li><li><div>            $location_settings[ $prefix ]['current_options'] = $current_options;&nbsp;</div></li><li><div>            $location_settings[ $prefix ]['settings'] = $settings;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $current_options = $location_settings[ $prefix ]['current_options'];&nbsp;</div></li><li><div>            $settings = $location_settings[ $prefix ]['settings'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // $opts[&quot;snippet&quot;][&quot;default&quot;] = sprintf( $opts[&quot;snippet&quot;][&quot;default&quot;], &quot;foo&quot;, &quot;bar&quot;, &quot;moby&quot; );&nbsp;</div></li><li><div>        $container = &quot;&lt;div class='aioseop aioseop_options {$this-&gt;prefix}settings'&gt;&quot;;&nbsp;</div></li><li><div>        if ( is_array( $meta_args['args'] ) && ! empty( $meta_args['args']['options'] ) ) {&nbsp;</div></li><li><div>            $args = array();&nbsp;</div></li><li><div>            $arg_keys = array();&nbsp;</div></li><li><div>            foreach ( $meta_args['args']['options'] as $a ) {&nbsp;</div></li><li><div>                if ( ! empty( $location ) ) {&nbsp;</div></li><li><div>                    $key = $prefix . $location . '_' . $a;&nbsp;</div></li><li><div>                    if ( ! isset( $settings[ $key ] ) ) {&nbsp;</div></li><li><div>                        $key = $a;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $key = $prefix . $a;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( isset( $settings[ $key ] ) ) {&nbsp;</div></li><li><div>                    $arg_keys[ $key ] = 1;&nbsp;</div></li><li><div>                } elseif ( isset( $settings[ $a ] ) ) {&nbsp;</div></li><li><div>                    $arg_keys[ $a ] = 1;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $setting_keys = array_keys( $settings );&nbsp;</div></li><li><div>            foreach ( $setting_keys as $s ) {&nbsp;</div></li><li><div>                if ( ! empty( $arg_keys[ $s ] ) ) {&nbsp;</div></li><li><div>                    $args[ $s ] = $settings[ $s ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $args = $settings;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ( $args as $name =&gt; $opts ) {&nbsp;</div></li><li><div>            $attr_list = array( 'class', 'style', 'readonly', 'disabled', 'size', 'placeholder' );&nbsp;</div></li><li><div>            if ( $opts['type'] == 'textarea' ) {&nbsp;</div></li><li><div>                $attr_list = array_merge( $attr_list, array( 'rows', 'cols' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $attr = '';&nbsp;</div></li><li><div>            foreach ( $attr_list as $a ) {&nbsp;</div></li><li><div>                if ( isset( $opts[ $a ] ) ) {&nbsp;</div></li><li><div>                    $attr .= ' ' . $a . '=&quot;' . esc_attr( $opts[ $a ] ) . '&quot; ';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $opt = '';&nbsp;</div></li><li><div>            if ( isset( $current_options[ $name ] ) ) {&nbsp;</div></li><li><div>                $opt = $current_options[ $name ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $opts['label'] == 'none' && $opts['type'] == 'submit' && $opts['save'] == false ) {&nbsp;</div></li><li><div>                $opt = $opts['name'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $opts['type'] == 'html' && empty( $opt ) && $opts['save'] == false ) {&nbsp;</div></li><li><div>                $opt = $opts['default'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $args = array(&nbsp;</div></li><li><div>                'name' =&gt; $name, &nbsp;</div></li><li><div>                'options' =&gt; $opts, &nbsp;</div></li><li><div>                'attr' =&gt; $attr, &nbsp;</div></li><li><div>                'value' =&gt; $opt, &nbsp;</div></li><li><div>                'prefix' =&gt; $prefix, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            if ( ! empty( $opts['nowrap'] ) ) {&nbsp;</div></li><li><div>                echo $this-&gt;get_option_html( $args );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( $container ) {&nbsp;</div></li><li><div>                    echo $container;&nbsp;</div></li><li><div>                    $container = '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                echo $this-&gt;get_option_row( $name, $opts, $args );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! $container ) {&nbsp;</div></li><li><div>            echo '&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function sanitize_domain( $domain ) {&nbsp;</div></li><li><div>        $domain = trim( $domain );&nbsp;</div></li><li><div>        $domain = $this-&gt;strtolower( $domain );&nbsp;</div></li><li><div>        if ( $this-&gt;strpos( $domain, 'http://' ) === 0 ) {&nbsp;</div></li><li><div>            $domain = $this-&gt;substr( $domain, 7 );&nbsp;</div></li><li><div>        } elseif ( $this-&gt;strpos( $domain, 'https://' ) === 0 ) {&nbsp;</div></li><li><div>            $domain = $this-&gt;substr( $domain, 8 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $domain = untrailingslashit( $domain );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $domain;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Sanitize options */&nbsp;</div></li><li><div>    function sanitize_options( $location = null ) {&nbsp;</div></li><li><div>        foreach ( $this-&gt;setting_options( $location ) as $k =&gt; $v ) {&nbsp;</div></li><li><div>            if ( isset( $this-&gt;options[ $k ] ) ) {&nbsp;</div></li><li><div>                if ( ! empty( $v['sanitize'] ) ) {&nbsp;</div></li><li><div>                    $type = $v['sanitize'];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $type = $v['type'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                switch ( $type ) {&nbsp;</div></li><li><div>                    case 'multiselect':&nbsp;</div></li><li><div>                    case 'multicheckbox':&nbsp;</div></li><li><div>                        $this-&gt;options[ $k ] = urlencode_deep( $this-&gt;options[ $k ] );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'textarea':&nbsp;</div></li><li><div>                        $this-&gt;options[ $k ] = wp_kses_post( $this-&gt;options[ $k ] );&nbsp;</div></li><li><div>                        $this-&gt;options[ $k ] = htmlspecialchars( $this-&gt;options[ $k ], ENT_QUOTES );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'filename':&nbsp;</div></li><li><div>                        $this-&gt;options[ $k ] = sanitize_file_name( $this-&gt;options[ $k ] );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'text':&nbsp;</div></li><li><div>                        $this-&gt;options[ $k ] = wp_kses_post( $this-&gt;options[ $k ] );&nbsp;</div></li><li><div>                    case 'checkbox':&nbsp;</div></li><li><div>                    case 'radio':&nbsp;</div></li><li><div>                    case 'select':&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        if ( ! is_array( $this-&gt;options[ $k ] ) ) {&nbsp;</div></li><li><div>                            $this-&gt;options[ $k ] = esc_attr( $this-&gt;options[ $k ] );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display metaboxes with display_options()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function display_metabox( $post, $metabox ) {&nbsp;</div></li><li><div>        $this-&gt;display_options( $metabox['args']['location'], $metabox );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle resetting options to defaults.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function reset_options( $location = null, $delete = false ) {&nbsp;</div></li><li><div>        if ( $delete === true ) {&nbsp;</div></li><li><div>            $this-&gt;delete_class_option( $delete );&nbsp;</div></li><li><div>            $this-&gt;options = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $default_options = $this-&gt;default_options( $location );&nbsp;</div></li><li><div>        foreach ( $default_options as $k =&gt; $v ) {&nbsp;</div></li><li><div>            $this-&gt;options[ $k ] = $v;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;update_class_option( $this-&gt;options );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** handle option resetting and updating */&nbsp;</div></li><li><div>    function handle_settings_updates( $location = null ) {&nbsp;</div></li><li><div>        $message = '';&nbsp;</div></li><li><div>        if ( ( isset( $_POST['action'] ) && $_POST['action'] == 'aiosp_update_module' &&&nbsp;</div></li><li><div>               ( isset( $_POST['Submit_Default'] ) || isset( $_POST['Submit_All_Default'] ) || ! empty( $_POST['Submit'] ) ) )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>            $nonce = $_POST['nonce-aioseop'];&nbsp;</div></li><li><div>            if ( ! wp_verify_nonce( $nonce, 'aioseop-nonce' ) ) {&nbsp;</div></li><li><div>                die ( __( 'Security Check - If you receive this in error, log out and back in to WordPress', 'all-in-one-seo-pack' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( isset( $_POST['Submit_Default'] ) || isset( $_POST['Submit_All_Default'] ) ) {&nbsp;</div></li><li><div>                $message = __( 'Options Reset.', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>                if ( isset( $_POST['Submit_All_Default'] ) ) {&nbsp;</div></li><li><div>                    $this-&gt;reset_options( $location, true );&nbsp;</div></li><li><div>                    do_action( 'aioseop_options_reset' );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $this-&gt;reset_options( $location );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( ! empty( $_POST['Submit'] ) ) {&nbsp;</div></li><li><div>                $message = __( 'All in One SEO Options Updated.', 'all-in-one-seo-pack' );&nbsp;</div></li><li><div>                $default_options = $this-&gt;default_options( $location );&nbsp;</div></li><li><div>                foreach ( $default_options as $k =&gt; $v ) {&nbsp;</div></li><li><div>                    if ( isset( $_POST[ $k ] ) ) {&nbsp;</div></li><li><div>                        $this-&gt;options[ $k ] = stripslashes_deep( $_POST[ $k ] );&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $this-&gt;options[ $k ] = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;sanitize_options( $location );&nbsp;</div></li><li><div>                $this-&gt;options = apply_filters( $this-&gt;prefix . 'update_options', $this-&gt;options, $location );&nbsp;</div></li><li><div>                $this-&gt;update_class_option( $this-&gt;options );&nbsp;</div></li><li><div>                wp_cache_flush();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            do_action( $this-&gt;prefix . 'settings_update', $this-&gt;options, $location );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $message;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Update / reset settings, printing options, sanitizing, posting back */&nbsp;</div></li><li><div>    function display_settings_page( $location = null ) {&nbsp;</div></li><li><div>        if ( $location != null ) {&nbsp;</div></li><li><div>            $location_info = $this-&gt;locations[ $location ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $name = null;&nbsp;</div></li><li><div>        if ( $location && isset( $location_info['name'] ) ) {&nbsp;</div></li><li><div>            $name = $location_info['name'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! $name ) {&nbsp;</div></li><li><div>            $name = $this-&gt;name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $message = $this-&gt;handle_settings_updates( $location );&nbsp;</div></li><li><div>        $this-&gt;settings_page_init();&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;wrap &lt;?php echo get_class( $this ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;aioseop_settings_header&quot;&gt;&nbsp;</div></li><li><div>                &lt;?php if ( ! empty( $message ) ) {&nbsp;</div></li><li><div>                    echo &quot;&lt;div id=\&quot;message\&quot; class=\&quot;updated fade\&quot;&gt;&lt;p&gt;$message&lt;/p&gt;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>                } ?&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;icon-aioseop&quot; class=&quot;icon32&quot;&gt;&lt;br&gt;&lt;/div&gt;&nbsp;</div></li><li><div>                &lt;h2&gt;&lt;?php echo $name; ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;dropmessage&quot; class=&quot;updated&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            do_action( 'aioseop_global_settings_header', $location );&nbsp;</div></li><li><div>            do_action( $this-&gt;prefix . 'settings_header', $location );&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;form id=&quot;aiosp_settings_form&quot; name=&quot;dofollow&quot; enctype=&quot;multipart/form-data&quot; action=&quot;&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;aioseop_top_button&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;aiosp_ajax_settings_message&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $submit_options = array(&nbsp;</div></li><li><div>                        'action' =&gt; array( 'type' =&gt; 'hidden', 'value' =&gt; 'aiosp_update_module' ), &nbsp;</div></li><li><div>                        'module' =&gt; array( 'type' =&gt; 'hidden', 'value' =&gt; get_class( $this ) ), &nbsp;</div></li><li><div>                        'location' =&gt; array( 'type' =&gt; 'hidden', 'value' =&gt; $location ), &nbsp;</div></li><li><div>                        'nonce-aioseop' =&gt; array(&nbsp;</div></li><li><div>                            'type' =&gt; 'hidden', &nbsp;</div></li><li><div>                            'value' =&gt; wp_create_nonce( 'aioseop-nonce' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        'page_options' =&gt; array( 'type' =&gt; 'hidden', 'value' =&gt; 'aiosp_home_description' ), &nbsp;</div></li><li><div>                        'Submit' =&gt; array(&nbsp;</div></li><li><div>                            'type' =&gt; 'submit', &nbsp;</div></li><li><div>                            'class' =&gt; 'button-primary', &nbsp;</div></li><li><div>                            'value' =&gt; __( 'Update Options', 'all-in-one-seo-pack' ) . ' &raquo;', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        'Submit_Default' =&gt; array(&nbsp;</div></li><li><div>                            'type' =&gt; 'submit', &nbsp;</div></li><li><div>                            'class' =&gt; 'button-secondary', &nbsp;</div></li><li><div>                            'value' =&gt; __( sprintf( 'Reset %s Settings to Defaults', $name ), 'all-in-one-seo-pack' ) . ' &raquo;', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $submit_options = apply_filters( &quot;{$this-&gt;prefix}submit_options&quot;, $submit_options, $location );&nbsp;</div></li><li><div>                    foreach ( $submit_options as $k =&gt; $s ) {&nbsp;</div></li><li><div>                        if ( $s['type'] == 'submit' && $k != 'Submit' ) {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $class = '';&nbsp;</div></li><li><div>                        if ( isset( $s['class'] ) ) {&nbsp;</div></li><li><div>                            $class = &quot; class='{$s['class']}' &quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        echo $this-&gt;get_option_html( array(&nbsp;</div></li><li><div>                            'name' =&gt; $k, &nbsp;</div></li><li><div>                            'options' =&gt; $s, &nbsp;</div></li><li><div>                            'attr' =&gt; $class, &nbsp;</div></li><li><div>                            'value' =&gt; $s['value'], &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;aioseop_options_wrapper aioseop_settings_left&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php $opts = $this-&gt;get_class_option();&nbsp;</div></li><li><div>                    if ( $opts !== false ) {&nbsp;</div></li><li><div>                        $this-&gt;options = $opts;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( is_array( $this-&gt;layout ) ) {&nbsp;</div></li><li><div>                        foreach ( $this-&gt;layout as $l =&gt; $lopts ) {&nbsp;</div></li><li><div>                            if ( ! isset( $lopts['tab'] ) || ( $this-&gt;current_tab == $lopts['tab'] ) ) {&nbsp;</div></li><li><div>                                $title = $lopts['name'];&nbsp;</div></li><li><div>                                if ( ! empty( $lopts['help_link'] ) ) {&nbsp;</div></li><li><div>                                    $title .= &quot;&lt;a class='aioseop_help_text_link aioseop_meta_box_help' target='_blank' href='&quot; . $lopts['help_link'] . &quot;'&gt;&lt;span&gt;&quot; . __( 'Help', 'all-in-one-seo-pack' ) . '&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                add_meta_box( $this-&gt;get_prefix( $location ) . $l . '_metabox', $title, array(&nbsp;</div></li><li><div>                                    $this, &nbsp;</div></li><li><div>                                    'display_options', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                                    &quot;{$this-&gt;prefix}settings&quot;, 'advanced', 'default', $lopts );&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        add_meta_box( $this-&gt;get_prefix( $location ) . 'metabox', $name, array(&nbsp;</div></li><li><div>                            $this, &nbsp;</div></li><li><div>                            'display_options', &nbsp;</div></li><li><div> ), &quot;{$this-&gt;prefix}settings&quot;, 'advanced' );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    do_meta_boxes( &quot;{$this-&gt;prefix}settings&quot;, 'advanced', $location );&nbsp;</div></li><li><div>                    ?&gt; &lt;p class=&quot;submit&quot; style=&quot;clear:both;&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                        foreach ( array( 'action', 'nonce-aioseop', 'page_options' ) as $submit_field ) {&nbsp;</div></li><li><div>                            if ( isset( $submit_field ) ) {&nbsp;</div></li><li><div>                                unset( $submit_field );&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        foreach ( $submit_options as $k =&gt; $s ) {&nbsp;</div></li><li><div>                            $class = '';&nbsp;</div></li><li><div>                            if ( isset( $s['class'] ) ) {&nbsp;</div></li><li><div>                                $class = &quot; class='{$s['class']}' &quot;;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            echo $this-&gt;get_option_html( array(&nbsp;</div></li><li><div>                                'name' =&gt; $k, &nbsp;</div></li><li><div>                                'options' =&gt; $s, &nbsp;</div></li><li><div>                                'attr' =&gt; $class, &nbsp;</div></li><li><div>                                'value' =&gt; $s['value'], &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        ?&gt;    &lt;/p&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/form&gt;&nbsp;</div></li><li><div>            &lt;?php do_action( $this-&gt;prefix . 'settings_footer', $location );&nbsp;</div></li><li><div>            do_action( 'aioseop_global_settings_footer', $location ); ?&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;    &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the prefix used for a given location.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_prefix( $location = null ) {&nbsp;</div></li><li><div>        if ( ( $location != null ) && isset( $this-&gt;locations[ $location ]['prefix'] ) ) {&nbsp;</div></li><li><div>            return $this-&gt;locations[ $location ]['prefix'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;prefix;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Sets up initial settings */&nbsp;</div></li><li><div>    function setting_options( $location = null, $defaults = null ) {&nbsp;</div></li><li><div>        if ( $defaults === null ) {&nbsp;</div></li><li><div>            $defaults = $this-&gt;default_options;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $prefix = $this-&gt;get_prefix( $location );&nbsp;</div></li><li><div>        $opts = array();&nbsp;</div></li><li><div>        if ( $location == null || $this-&gt;locations[ $location ]['options'] === null ) {&nbsp;</div></li><li><div>            $options = $defaults;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $options = array();&nbsp;</div></li><li><div>            $prefix = &quot;{$prefix}{$location}_&quot;;&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;locations[ $location ]['default_options'] ) ) {&nbsp;</div></li><li><div>                $options = $this-&gt;locations[ $location ]['default_options'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            foreach ( $this-&gt;locations[ $location ]['options'] as $opt ) {&nbsp;</div></li><li><div>                if ( isset( $defaults[ $opt ] ) ) {&nbsp;</div></li><li><div>                    $options[ $opt ] = $defaults[ $opt ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! $prefix ) {&nbsp;</div></li><li><div>            $prefix = $this-&gt;prefix;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! empty( $options ) ) {&nbsp;</div></li><li><div>            foreach ( $options as $k =&gt; $v ) {&nbsp;</div></li><li><div>                if ( ! isset( $v['name'] ) ) {&nbsp;</div></li><li><div>                    $v['name'] = $this-&gt;ucwords( strtr( $k, '_', ' ' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! isset( $v['type'] ) ) {&nbsp;</div></li><li><div>                    $v['type'] = 'checkbox';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! isset( $v['default'] ) ) {&nbsp;</div></li><li><div>                    $v['default'] = null;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! isset( $v['initial_options'] ) ) {&nbsp;</div></li><li><div>                    $v['initial_options'] = $v['default'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $v['type'] == 'custom' && ( ! isset( $v['nowrap'] ) ) ) {&nbsp;</div></li><li><div>                    $v['nowrap'] = true;&nbsp;</div></li><li><div>                } elseif ( ! isset( $v['nowrap'] ) ) {&nbsp;</div></li><li><div>                    $v['nowrap'] = null;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( isset( $v['condshow'] ) ) {&nbsp;</div></li><li><div>                    if ( ! is_array( $this-&gt;script_data ) ) {&nbsp;</div></li><li><div>                        $this-&gt;script_data = array();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ! isset( $this-&gt;script_data['condshow'] ) ) {&nbsp;</div></li><li><div>                        $this-&gt;script_data['condshow'] = array();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $this-&gt;script_data['condshow'][ $prefix . $k ] = $v['condshow'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $v['type'] == 'submit' ) {&nbsp;</div></li><li><div>                    if ( ! isset( $v['save'] ) ) {&nbsp;</div></li><li><div>                        $v['save'] = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ! isset( $v['label'] ) ) {&nbsp;</div></li><li><div>                        $v['label'] = 'none';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ! isset( $v['prefix'] ) ) {&nbsp;</div></li><li><div>                        $v['prefix'] = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    if ( ! isset( $v['label'] ) ) {&nbsp;</div></li><li><div>                        $v['label'] = null;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $v['type'] == 'hidden' ) {&nbsp;</div></li><li><div>                    if ( ! isset( $v['label'] ) ) {&nbsp;</div></li><li><div>                        $v['label'] = 'none';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ! isset( $v['prefix'] ) ) {&nbsp;</div></li><li><div>                        $v['prefix'] = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ( $v['type'] == 'text' ) && ( ! isset( $v['size'] ) ) ) {&nbsp;</div></li><li><div>                    $v['size'] = 57;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $v['type'] == 'textarea' ) {&nbsp;</div></li><li><div>                    if ( ! isset( $v['cols'] ) ) {&nbsp;</div></li><li><div>                        $v['cols'] = 57;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( ! isset( $v['rows'] ) ) {&nbsp;</div></li><li><div>                        $v['rows'] = 2;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! isset( $v['save'] ) ) {&nbsp;</div></li><li><div>                    $v['save'] = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( ! isset( $v['prefix'] ) ) {&nbsp;</div></li><li><div>                    $v['prefix'] = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( $v['prefix'] ) {&nbsp;</div></li><li><div>                    $opts[ $prefix . $k ] = $v;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $opts[ $k ] = $v;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $opts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Generates just the default option names and values */&nbsp;</div></li><li><div>    function default_options( $location = null, $defaults = null ) {&nbsp;</div></li><li><div>        $options = $this-&gt;setting_options( $location, $defaults );&nbsp;</div></li><li><div>        $opts = array();&nbsp;</div></li><li><div>        foreach ( $options as $k =&gt; $v ) {&nbsp;</div></li><li><div>            if ( $v['save'] ) {&nbsp;</div></li><li><div>                $opts[ $k ] = $v['default'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $opts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Gets the current options stored for a given location. */&nbsp;</div></li><li><div>    function get_current_options( $opts = array(), $location = null, $defaults = null, $post = null ) {&nbsp;</div></li><li><div>        $prefix = $this-&gt;get_prefix( $location );&nbsp;</div></li><li><div>        $get_opts = '';&nbsp;</div></li><li><div>        if ( empty( $location ) ) {&nbsp;</div></li><li><div>            $type = 'settings';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $type = $this-&gt;locations[ $location ]['type'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $type === 'settings' ) {&nbsp;</div></li><li><div>            $get_opts = $this-&gt;get_class_option();&nbsp;</div></li><li><div>        } elseif ( $type == 'metabox' ) {&nbsp;</div></li><li><div>            if ( $post == null ) {&nbsp;</div></li><li><div>                global $post;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ( isset( $_GET['taxonomy'] ) && isset( $_GET['tag_ID'] ) ) || is_category() || is_tag() || is_tax() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( AIOSEOPPRO ) {&nbsp;</div></li><li><div>                    $get_opts = AIO_ProGeneral::getprotax( $get_opts );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } elseif ( isset( $post ) ) {&nbsp;</div></li><li><div>                $get_opts = get_post_meta( $post-&gt;ID, '_' . $prefix . $location, true );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $defs = $this-&gt;default_options( $location, $defaults );&nbsp;</div></li><li><div>        if ( $get_opts == '' ) {&nbsp;</div></li><li><div>            $get_opts = $defs;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $get_opts = wp_parse_args( $get_opts, $defs );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $opts = wp_parse_args( $opts, $get_opts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $opts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Updates the options array in the module; loads saved settings with get_option() or uses defaults */&nbsp;</div></li><li><div>    function update_options( $opts = array(), $location = null, $defaults = null ) {&nbsp;</div></li><li><div>        if ( $location === null ) {&nbsp;</div></li><li><div>            $type = 'settings';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $type = $this-&gt;locations[ $location ][ $type ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $type === 'settings' ) {&nbsp;</div></li><li><div>            $get_opts = $this-&gt;get_class_option();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $get_opts === false ) {&nbsp;</div></li><li><div>            $get_opts = $this-&gt;default_options( $location, $defaults );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;setting_options( $location, $defaults );&nbsp;</div></li><li><div>        } // hack -- make sure this runs anyhow, for now -- pdb&nbsp;</div></li><li><div>        $this-&gt;options = wp_parse_args( $opts, $get_opts );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.3.7</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.2/classes/all_in_one_seo_pack_module/" class="">2.3.9.2</a></li><li><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9.1/classes/all_in_one_seo_pack_module/" class="active">2.3.9.1</a></li><li><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.9/classes/all_in_one_seo_pack_module/" class="">2.3.9</a></li><li><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.8/classes/all_in_one_seo_pack_module/" class="">2.3.8</a></li><li><a href="http://hookr.io/plugins/all-in-one-seo-pack/2.3.7/classes/all_in_one_seo_pack_module/" class="">2.3.7</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>All_in_One_SEO_Pack_Module</li><li><span></span>All In One SEO Pack</li><li><span></span>2.3.9.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>