<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="0.9.9.2" data-slug="inline-google-spreadsheet-viewer" data-type="file" data-id="93858"><head xmlns="http://www.w3.org/1999/xhtml"><title> inline-gdocs-viewer | file | Inline Google Spreadsheet Viewer | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, inline-google-spreadsheet-viewer, 0.9.9.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=e3e4bfa8551aec93167e692782e7b3dc' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/inline-gdocs-viewer/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Finline-gdocs-viewer%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Finline-gdocs-viewer%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-inline-google-spreadsheet-viewer-0.9.9.2-file-inline-gdocs-viewer","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="inline-gdocs-viewer" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to inline-google-spreadsheet-vie&hellip;." href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/" class="plugin"><span property="name">inline-google-spreadsheet-vie&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 0.9.9.2." href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/" class="H_VERSION"><span property="name">0.9.9.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">inline-gdocs-viewer</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="25"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/all/" title="All">All <span class="count badge">25</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="4"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/hooks/" title="Hooks">Hooks <span class="count badge">4</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="4"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/filters/" title="Filters">Filters <span class="count badge">4</span></a></li><li class="" data-id="class" data-count="8"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/classes/" title="Classes">Classes <span class="count badge">8</span></a></li><li class="" data-id="constant" data-count="11"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/constants/" title="Constants">Constants <span class="count badge">11</span></a></li><li class="" data-id="function" data-count="1"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/functions/" title="Functions">Functions <span class="count badge">1</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/inline-google-spreadsheet-viewer/0.9.9.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/inline-gdocs-viewer.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Plugin Name: Inline Google Spreadsheet Viewer</span>&nbsp;</div></li><li><div><span class="comment"> * Plugin URI: http://maymay.net/blog/projects/inline-google-spreadsheet-viewer/</span>&nbsp;</div></li><li><div><span class="comment"> * Description: Retrieves data from a public Google Spreadsheet or CSV file and displays it as an HTML table or interactive chart. &lt;strong&gt;Like this plugin? Please &lt;a href=&quot;https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=TJLPJYXHSRBEE&amp;lc=US&amp;item_name=Inline%20Google%20Spreadsheet%20Viewer&amp;item_number=Inline%20Google%20Spreadsheet%20Viewer&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donate_SM%2egif%3aNonHosted&quot; title=&quot;Send a donation to the developer of Inline Google Spreadsheet Viewer&quot;&gt;donate&lt;/a&gt;. &hearts; Thank you!&lt;/strong&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * Version: 0.9.9.2</span>&nbsp;</div></li><li><div><span class="comment"> * Author: Meitar Moscovitz &lt;meitar@maymay.net&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * Author URI: http://maymay.net/</span>&nbsp;</div></li><li><div><span class="comment"> * Text Domain: inline-gdocs-viewer</span>&nbsp;</div></li><li><div><span class="comment"> * Domain Path: /languages</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('ABSPATH')) { exit; } <span class="comment">// Disallow direct HTTP access.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class InlineGoogleSpreadsheetViewerPlugin {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $shortcode = 'gdoc';&nbsp;</div></li><li><div>  private $dt_class = 'igsv-table'; <span class="comment">//&lt; Default table class.</span>&nbsp;</div></li><li><div>  private $dt_defaults; <span class="comment">//&lt; Defaults for DataTables defaults object.</span>&nbsp;</div></li><li><div>  private $invocations = 0;&nbsp;</div></li><li><div>  private $prefix; <span class="comment">//&lt; Internal prefix for settings, etc., derived from shortcode.</span>&nbsp;</div></li><li><div>  private $capabilities; <span class="comment">//&lt; List of custom capabilities.</span>&nbsp;</div></li><li><div>  private $gdoc_url_regex =&nbsp;</div></li><li><div>      '!https:<span class="comment">//(?:docs\.google\.com/spreadsheets/d/|script\.google\.com/macros/s/)([^/]+)!';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function __construct () {&nbsp;</div></li><li><div>      <span class="comment">// Initialize private defaults.</span>&nbsp;</div></li><li><div>      $this-&gt;prefix = $this-&gt;shortcode . '_';&nbsp;</div></li><li><div>      $this-&gt;dt_defaults = json_encode(array(&nbsp;</div></li><li><div>          'dom' =&gt; &quot;TC&lt;'clear'&gt;lfrtip&quot;&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>      $this-&gt;capabilities = array(&nbsp;</div></li><li><div>          $this-&gt;prefix . 'query_sql_databases'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action('plugins_loaded', array($this, 'registerL10n'));&nbsp;</div></li><li><div>      add_action('init', array($this, 'maybeFetchGvizDataSource'));&nbsp;</div></li><li><div>      add_action('admin_init', array($this, 'registerSettings'));&nbsp;</div></li><li><div>      add_action('admin_menu', array($this, 'registerAdminMenu'));&nbsp;</div></li><li><div>      add_action('admin_head', array($this, 'doAdminHeadActions'));&nbsp;</div></li><li><div>      add_action('admin_enqueue_scripts', array($this, 'addAdminScripts'));&nbsp;</div></li><li><div>      add_action('admin_print_footer_scripts', array($this, 'addQuickTagButton'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action('wp_enqueue_scripts', array($this, 'addFrontEndScripts'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_shortcode($this-&gt;shortcode, array($this, 'displayShortcode'));&nbsp;</div></li><li><div>      wp_embed_register_handler(&nbsp;</div></li><li><div>          $this-&gt;shortcode . 'spreadsheet', &nbsp;</div></li><li><div>          $this-&gt;gdoc_url_regex, &nbsp;</div></li><li><div>          array($this, 'oEmbedHandler')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      register_activation_hook(__FILE__, array($this, 'activate'));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function activate () {&nbsp;</div></li><li><div>      $options = get_option($this-&gt;prefix . 'settings');&nbsp;</div></li><li><div>      if (!isset($options['datatables_classes'])) { $options['datatables_classes'] = $this-&gt;dt_class; }&nbsp;</div></li><li><div>      if (empty($options['datatables_defaults_object'])) {&nbsp;</div></li><li><div>          $options['datatables_defaults_object'] = json_decode($this-&gt;dt_defaults);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      update_option($this-&gt;prefix . 'settings', $options);&nbsp;</div></li><li><div>      $admin_role = get_role('administrator');&nbsp;</div></li><li><div>      $admin_role-&gt;add_cap($this-&gt;prefix . 'query_sql_databases', true);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function registerL10n () {&nbsp;</div></li><li><div>      load_plugin_textdomain('inline-gdocs-viewer', false, dirname(plugin_basename(__FILE__)) . '/languages/');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function registerSettings () {&nbsp;</div></li><li><div>      register_setting(&nbsp;</div></li><li><div>          $this-&gt;prefix . 'settings', &nbsp;</div></li><li><div>          $this-&gt;prefix . 'settings', &nbsp;</div></li><li><div>          array($this, 'validateSettings')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function registerAdminMenu () {&nbsp;</div></li><li><div>      add_options_page(&nbsp;</div></li><li><div>          __('Inline Google Spreadsheet Viewer Settings', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          __('Inline Google Spreadsheet Viewer', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          'manage_options', &nbsp;</div></li><li><div>          $this-&gt;prefix . 'settings', &nbsp;</div></li><li><div>          array($this, 'renderOptionsPage')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function doAdminHeadActions () {&nbsp;</div></li><li><div>      $this-&gt;registerContextualHelp();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function addAdminScripts () {&nbsp;</div></li><li><div>      wp_enqueue_style('wp-jquery-ui-dialog');&nbsp;</div></li><li><div>      wp_enqueue_script('jquery-ui-dialog');&nbsp;</div></li><li><div>      wp_enqueue_script('jquery-ui-tabs');&nbsp;</div></li><li><div>      <span class="comment">//wp_enqueue_script('jquery-ui-tooltip');</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_enqueue_style(&nbsp;</div></li><li><div>          'inline-gdocs-viewer', &nbsp;</div></li><li><div>          plugins_url('inline-gdocs-viewer.css', __FILE__)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function addFrontEndScripts () {&nbsp;</div></li><li><div>      <span class="comment">// Core DataTables.</span>&nbsp;</div></li><li><div>      wp_enqueue_style(&nbsp;</div></li><li><div>          'jquery-datatables', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/1.10.6/css/jquery.dataTables.min.css'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'jquery-datatables', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/1.10.6/js/jquery.dataTables.min.js', </span>&nbsp;</div></li><li><div>          array('jquery')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// DataTables extensions</span>.</span>&nbsp;</div></li><li><div>      wp_enqueue_style(&nbsp;</div></li><li><div>          'datatables-colvis', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/colvis/1.1.0/css/dataTables.colVis.css'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'datatables-colvis', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/colvis/1.1.0/js/dataTables.colVis.min.js', </span>&nbsp;</div></li><li><div>          array('jquery-datatables')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_style(&nbsp;</div></li><li><div>          'datatables-tabletools', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/tabletools/2.2.1/css/dataTables.tableTools.css'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'datatables-tabletools', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/tabletools/2.2.1/js/dataTables.tableTools.min.js', </span>&nbsp;</div></li><li><div>          array('jquery-datatables')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_style(&nbsp;</div></li><li><div>          'datatables-fixedheader', &nbsp;</div></li><li><div>          '<span class="comment">//datatables.net/release-datatables/extensions/FixedHeader/css/dataTables.fixedHeader.css'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'datatables-fixedheader', &nbsp;</div></li><li><div>          '<span class="comment">//datatables.net/release-datatables/extensions/FixedHeader/js/dataTables.fixedHeader.js', </span>&nbsp;</div></li><li><div>          array('jquery-datatables')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_style(&nbsp;</div></li><li><div>          'datatables-fixedcolumns', &nbsp;</div></li><li><div>          '<span class="comment">//datatables.net/release-datatables/extensions/FixedColumns/css/dataTables.fixedColumns.css'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'datatables-fixedcolumns', &nbsp;</div></li><li><div>          '<span class="comment">//datatables.net/release-datatables/extensions/FixedColumns/js/dataTables.fixedColumns.js', </span>&nbsp;</div></li><li><div>          array('jquery-datatables')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_style(&nbsp;</div></li><li><div>          'datatables-responsive', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/responsive/1.0.4/css/dataTables.responsive.css'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'datatables-responsive', &nbsp;</div></li><li><div>          '<span class="comment">//cdn.datatables.net/responsive/1.0.4/js/dataTables.responsive.js', </span>&nbsp;</div></li><li><div>          array('jquery-datatables')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'igsv-datatables', &nbsp;</div></li><li><div>          plugins_url('igsv-datatables.js', __FILE__), &nbsp;</div></li><li><div>          array('jquery-datatables')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_localize_script('igsv-datatables', 'igsv_plugin_vars', $this-&gt;getLocalizedPluginVars());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Google Charts and Visualization libraries</span>&nbsp;</div></li><li><div>      wp_enqueue_script('google-ajax-api', '<span class="comment">//www.google.com/jsapi');</span>&nbsp;</div></li><li><div>      wp_enqueue_script(&nbsp;</div></li><li><div>          'igsv-gvizcharts', &nbsp;</div></li><li><div>          plugins_url('igsv-gvizcharts.js', __FILE__), &nbsp;</div></li><li><div>          array('google-ajax-api')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Deterministically makes a unique transient name.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key The ID of the document, extracted from the key attribute of the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $q The query, if one exists, from the query attribute of the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string A 40 character unique string representing the name of the transient for this key and query.</span>&nbsp;</div></li><li><div><span class="comment">   * @see https://codex.wordpress.org/Transients_API</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function getTransientName ($key, $q, $gid) {&nbsp;</div></li><li><div>      return substr($this-&gt;shortcode . hash('sha1', $this-&gt;shortcode . $key . $q . $gid), 0, 40);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This simple getter/setter pair works around a bug in WP's own</span>&nbsp;</div></li><li><div><span class="comment">   * serialization, apparently, by serializing the data ourselves</span>&nbsp;</div></li><li><div><span class="comment">   * and then base64 encoding it.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function getTransient ($transient) {&nbsp;</div></li><li><div>      return unserialize(base64_decode(get_transient($transient)));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  private function setTransient ($transient, $data, $expiry) {&nbsp;</div></li><li><div>      return set_transient($transient, base64_encode(serialize($data)), $expiry);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Lazily tests the provided Google Doc &quot;key&quot; (URL or document ID)</span>&nbsp;</div></li><li><div><span class="comment">   * to determine what type of document it really is. Valid doc</span>&nbsp;</div></li><li><div><span class="comment">   * types are one of: `spreadsheet`, `gasapp`, `docsviewer`, or `csv`.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key The key passed from the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string A keyword referring to the type of document the key refers to.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function getDocTypeByKey ($key) {&nbsp;</div></li><li><div>      $type = '';&nbsp;</div></li><li><div>      $p = parse_url($key);&nbsp;</div></li><li><div>      if ('csv' === strtolower(pathinfo($p['path'], PATHINFO_EXTENSION))) {&nbsp;</div></li><li><div>          $type = 'csv';&nbsp;</div></li><li><div>      } else if (!isset($p['scheme']) && 'wordpress' === $p['path']) {&nbsp;</div></li><li><div>          $type = 'wpdb';&nbsp;</div></li><li><div>      } else if ('mysql' === $p['scheme']) {&nbsp;</div></li><li><div>          $type = 'mysql';&nbsp;</div></li><li><div>      } else if (isset($p['host'])) {&nbsp;</div></li><li><div>          switch ($p['host']) {&nbsp;</div></li><li><div>              case 'docs.google.com':&nbsp;</div></li><li><div>                  $type = 'spreadsheet';&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'script.google.com':&nbsp;</div></li><li><div>                  $type = 'gasapp';&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              default:&nbsp;</div></li><li><div>                  $type = 'docsviewer';&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// without a host part, assume an old-style Spreadsheet</span>&nbsp;</div></li><li><div>          $type = 'spreadsheet';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $type;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function getSpreadsheetUrl ($atts) {&nbsp;</div></li><li><div>      $url = '';&nbsp;</div></li><li><div>      <span class="comment">// Assume a full link.</span>&nbsp;</div></li><li><div>      $m = array();&nbsp;</div></li><li><div>      if (preg_match('/\/(edit|view|pubhtml|htmlview).*$/', $atts['key'], $m) && 'http' === substr($atts['key'], 0, 4)) {&nbsp;</div></li><li><div>          $parts = parse_url($atts['key']);&nbsp;</div></li><li><div>          if (!empty($parts['fragment'])) {&nbsp;</div></li><li><div>              $frag = array();&nbsp;</div></li><li><div>              parse_str($parts['fragment'], $frag);&nbsp;</div></li><li><div>              if ($frag['gid']) { $atts['gid'] = $frag['gid']; }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $atts['key'] = $parts['scheme'] . ':<span class="comment">//' . $parts['host'] . $parts['path'];</span>&nbsp;</div></li><li><div>          $action = ($atts['query'] || $atts['chart'])&nbsp;</div></li><li><div>              ? 'gviz/tq?tqx=out:csv&tq=' . rawurlencode($atts['query'])&nbsp;</div></li><li><div>              : 'export?format=csv';&nbsp;</div></li><li><div>          $url = str_replace($m[1], $action, $atts['key']);&nbsp;</div></li><li><div>          if ($atts['gid']) {&nbsp;</div></li><li><div>              $url .= '&gid=' . $atts['gid'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $url .= &quot;https:<span class="comment">//spreadsheets.google.com/pub?key={$atts['key']}&output=csv&quot;;</span>&nbsp;</div></li><li><div>          if ($gid) {&nbsp;</div></li><li><div>              $url .= &quot;&single=true&gid={$atts['gid']}&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $url;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function getGVizDataSourceUrl ($key, $query, $format) {&nbsp;</div></li><li><div>      $format = ($format) ? $format : 'json';&nbsp;</div></li><li><div>      $base = trailingslashit(get_site_url()) . '?';&nbsp;</div></li><li><div>      $qs = 'url=';&nbsp;</div></li><li><div>      $qs .= rawurlencode($key) . '&tq=' . rawurlencode($query) . &quot;&tqx=out:$format&quot;;&nbsp;</div></li><li><div>      return $base . $qs;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function sanitizeQuery ($query) {&nbsp;</div></li><li><div>      <span class="comment">// Due to shortcode parsing limitations of angle brackets (&lt; and &gt; characters), </span>&nbsp;</div></li><li><div>      <span class="comment">// manually decode only the URL encoded values for those values, which are</span>&nbsp;</div></li><li><div>      <span class="comment">// themselves expected to be entered manually by the user. That is, to supply</span>&nbsp;</div></li><li><div>      <span class="comment">// the shortcode with a less than sign, the user ought enter %3C, but after</span>&nbsp;</div></li><li><div>      <span class="comment">// the initial urlencode($query), this will encode the percent sign, returning</span>&nbsp;</div></li><li><div>      <span class="comment">// instead the value %253C, so we manually replace this in the query ourselves.</span>&nbsp;</div></li><li><div>      return rawurldecode(str_replace('%253E', '%3E', str_replace('%253C', '%3C', rawurlencode($query))));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function getDocId ($key) {&nbsp;</div></li><li><div>      $m = array();&nbsp;</div></li><li><div>      preg_match($this-&gt;gdoc_url_regex, $key, $m);&nbsp;</div></li><li><div>      if (!empty($m[1])) {&nbsp;</div></li><li><div>          $id = $m[1];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $id = sanitize_title_with_dashes($key);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ('mysql' === $this-&gt;getDocTypeByKey($key)) {&nbsp;</div></li><li><div>          $id = hash('md5', $key);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieves data from the transient cache if available, or via HTTP if not.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url The URL to fetch, if not in cache.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $x Values from the shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function fetchData ($url, $x) {&nbsp;</div></li><li><div>      $transient = $this-&gt;getTransientName($x['key'], $x['query'], $x['gid']);&nbsp;</div></li><li><div>      if (false === $x['use_cache'] || 'no' === strtolower($x['use_cache'])) {&nbsp;</div></li><li><div>          delete_transient($transient);&nbsp;</div></li><li><div>          $http_response = $this-&gt;doHttpRequest($url, $x['http_opts']);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (false === ($http_response = $this-&gt;getTransient($transient))) {&nbsp;</div></li><li><div>              $http_response = $this-&gt;doHttpRequest($url, $x['http_opts']);&nbsp;</div></li><li><div>              $this-&gt;setTransient($transient, $http_response, (int) $x['expire_in']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $http_response;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Performs an HTTP request as instructed by the shortcode's parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url The URL to request.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $http_opts A JSON string representing options to pass to the WordPress HTTP API.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array $resp The HTTP response from the WordPress HTTP API.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function doHttpRequest ($url, $opts) {&nbsp;</div></li><li><div>      $http_args = array();&nbsp;</div></li><li><div>      if ($opts) {&nbsp;</div></li><li><div>          try {&nbsp;</div></li><li><div>              foreach (json_decode($opts) as $k =&gt; $v) {&nbsp;</div></li><li><div>                  $http_args[$k] = $v;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } catch (Exception $e) {&nbsp;</div></li><li><div>              $this-&gt;runtimeError(__('Error parsing HTTP options attribute:', 'inline-gdocs-viewer') . $e-&gt;getMessage());&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $resp = (empty($http_args)) ? wp_remote_get($url) : wp_remote_request($url, $http_args);&nbsp;</div></li><li><div>      if (is_wp_error($resp)) { <span class="comment">// bail on error</span>&nbsp;</div></li><li><div>          $this-&gt;runtimeError(__('Error requesting data:', 'inline-gdocs-viewer') . ' ' . $resp-&gt;get_error_message());&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $resp;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function runtimeError ($msg) {&nbsp;</div></li><li><div>      throw new Exception(esc_html(&quot;[{$this-&gt;shortcode} $msg]&quot;));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function parseCsv ($csv_str) {&nbsp;</div></li><li><div>      return $this-&gt;str_getcsv($csv_str); <span class="comment">// Yo, why is PHP's built-in str_getcsv() frakking things up?</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Prints an appropriate HTML attribute string for any HTML5 Data</span>&nbsp;</div></li><li><div><span class="comment">   * attributes that DataTables can use.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $atts Values passed from the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @return A string representing attribute-value pairs in HTML.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function dataTablesAttributes ($atts) {&nbsp;</div></li><li><div>      $str = '';&nbsp;</div></li><li><div>      foreach ($atts as $k =&gt; $v) {&nbsp;</div></li><li><div>          if (0 === strpos($k, 'datatables_') && false !== $v) {&nbsp;</div></li><li><div>              $k = str_replace('datatables', 'data', str_replace('_', '-', $k));&nbsp;</div></li><li><div>              <span class="comment">// We urldecode() the value here because WordPress shortcodes</span>&nbsp;</div></li><li><div>              <span class="comment">// use square brackets, but so do JavaScript arrays so users</span>&nbsp;</div></li><li><div>              <span class="comment">// are advised to sometimes enter URL-encoded equivalents.</span>&nbsp;</div></li><li><div>              $str .= esc_attr($k) . '=\'' . esc_attr(urldecode($v)) . '\' ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $str;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Converts a two-dimensional array representing rows and cells of data</span>&nbsp;</div></li><li><div><span class="comment">   * into an HTML representation of that data, according to any additional</span>&nbsp;</div></li><li><div><span class="comment">   * options passed to it.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $r Multidimensional array representing table data.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $options Values passed from the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $caption Passed via shortcode, should be the table caption.</span>&nbsp;</div></li><li><div><span class="comment">   * @return An HTML string of the complete &lt;table&gt; element.</span>&nbsp;</div></li><li><div><span class="comment">   * @see displayShortcode</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function dataToHtml ($r, $options, $caption = '') {&nbsp;</div></li><li><div>      if ($options['strip'] &gt; 0) { $r = array_slice($r, $options['strip']); } <span class="comment">// discard</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Split into table headers and body.</span>&nbsp;</div></li><li><div>      $thead = ((int) $options['header_rows']) ? array_splice($r, 0, $options['header_rows']) : array_splice($r, 0, 1);&nbsp;</div></li><li><div>      $tbody = $r;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ir = 1; <span class="comment">// row number counter</span>&nbsp;</div></li><li><div>      $ic = 1; <span class="comment">// column number counter</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $id = (0 === $this-&gt;invocations)&nbsp;</div></li><li><div>          ? 'igsv-' . $this-&gt;getDocId($options['key'])&nbsp;</div></li><li><div>          : &quot;igsv-{$this-&gt;invocations}-&quot; . $this-&gt;getDocId($options['key']);&nbsp;</div></li><li><div>      $html = '&lt;table id=&quot;' . esc_attr($id) . '&quot;';&nbsp;</div></li><li><div>      <span class="comment">// Prepend a space character onto the 'class' value, if one exists.</span>&nbsp;</div></li><li><div>      if (!empty($options['class'])) { $options['class'] = &quot; {$options['class']}&quot;; }&nbsp;</div></li><li><div>      $html .= ' class=&quot;' . $this-&gt;dt_class . esc_attr($options['class']) . '&quot;';&nbsp;</div></li><li><div>      $html .= ' lang=&quot;' . esc_attr($options['lang']) . '&quot;';&nbsp;</div></li><li><div>      $html .= ' summary=&quot;' . esc_attr($options['summary']) . '&quot;';&nbsp;</div></li><li><div>      $html .= ' title=&quot;' . esc_attr($options['title']) . '&quot;';&nbsp;</div></li><li><div>      $html .= ' style=&quot;' . esc_attr($options['style']) . '&quot;';&nbsp;</div></li><li><div>      $html .= (array_search('no-datatables', explode(' ', $options['class'])))&nbsp;</div></li><li><div>          ? ''&nbsp;</div></li><li><div>          : ' ' . $this-&gt;dataTablesAttributes($options);&nbsp;</div></li><li><div>      $html .= '&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!empty($caption)) {&nbsp;</div></li><li><div>          $html .= '&lt;caption&gt;' . esc_html($caption) . '&lt;/caption&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html .= &quot;&lt;thead&gt;\n&quot;;&nbsp;</div></li><li><div>      foreach ($thead as $v) {&nbsp;</div></li><li><div>          $html .= &quot;&lt;tr class=\&quot;row-$ir &quot; . $this-&gt;evenOrOdd($ir) . &quot;\&quot;&gt;&quot;;&nbsp;</div></li><li><div>          $ir++;&nbsp;</div></li><li><div>          $ic = 1; <span class="comment"><span class="comment">// reset column counting</span></span>&nbsp;</div></li><li><div>          foreach ($v as $th) {&nbsp;</div></li><li><div>              $th = nl2br(esc_html($th));&nbsp;</div></li><li><div>              $html .= &quot;&lt;th class=\&quot;col-$ic &quot; . $this-&gt;evenOrOdd($ic) . &quot;\&quot;&gt;&lt;div&gt;$th&lt;/div&gt;&lt;/th&gt;&quot;;&nbsp;</div></li><li><div>              $ic++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $html .= &quot;&lt;/tr&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= &quot;&lt;/thead&gt;&lt;tbody&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($tbody as $v) {&nbsp;</div></li><li><div>          $html .= &quot;&lt;tr class=\&quot;row-$ir &quot; . $this-&gt;evenOrOdd($ir) . &quot;\&quot;&gt;&quot;;&nbsp;</div></li><li><div>          $ir++;&nbsp;</div></li><li><div>          $ic = 1; <span class="comment"><span class="comment">// reset column counting</span></span>&nbsp;</div></li><li><div>          foreach ($v as $td) {&nbsp;</div></li><li><div>              $td = nl2br(esc_html($td));&nbsp;</div></li><li><div>              $html .= &quot;&lt;td class=\&quot;col-$ic &quot; . $this-&gt;evenOrOdd($ic) . &quot;\&quot;&gt;$td&lt;/td&gt;&quot;;&nbsp;</div></li><li><div>              $ic++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $html .= &quot;&lt;/tr&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '&lt;/tbody&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = apply_filters($this-&gt;shortcode . '_table_html', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (false === $options['linkify'] || 'no' === strtolower($options['linkify'])) {&nbsp;</div></li><li><div>          return $html;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return make_clickable($html);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function evenOrOdd ($x) {&nbsp;</div></li><li><div>      return ((int) $x % 2) ? 'odd' : 'even'; <span class="comment">// cast to integer just in case</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Simple CSV parsing, taken directly from PHP manual.</span>&nbsp;</div></li><li><div><span class="comment">   * @see http://www.php.net/manual/en/function.str-getcsv.php#100579</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function str_getcsv ($input, $delimiter=', ', $enclosure='&quot;', $escape=null, $eol=null) {&nbsp;</div></li><li><div>      $temp=fopen(&quot;php:<span class="comment">//memory&quot;, &quot;rw&quot;);</span>&nbsp;</div></li><li><div>      fwrite($temp, $input);&nbsp;</div></li><li><div>      fseek($temp, 0);&nbsp;</div></li><li><div>      $r = array();&nbsp;</div></li><li><div>      while (($data = fgetcsv($temp, 4096, $delimiter, $enclosure)) !== false) {&nbsp;</div></li><li><div>          $r[] = $data;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      fclose($temp);&nbsp;</div></li><li><div>      return $r;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function oEmbedHandler ($matches, $attr, $url, $rawattr) {&nbsp;</div></li><li><div>      return $this-&gt;displayShortcode(array('key' =&gt; $url));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function maybeFetchGvizDataSource () {&nbsp;</div></li><li><div>      if (&nbsp;</div></li><li><div>          !isset($_GET[$this-&gt;prefix . 'get_datasource_nonce'])&nbsp;</div></li><li><div>          ||&nbsp;</div></li><li><div>          !$this-&gt;isValidNonce($_GET[$this-&gt;prefix . 'get_datasource_nonce'], $this-&gt;prefix . 'get_datasource_nonce')&nbsp;</div></li><li><div> ) { return; }&nbsp;</div></li><li><div>      $url = rawurldecode($_GET['url']);&nbsp;</div></li><li><div>      $http_response = $this-&gt;doHttpRequest($url, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($_GET['chart'])) {&nbsp;</div></li><li><div>          $http_response['body'] = $this-&gt;setGVizCsvDataTypes($http_response['body']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      require_once dirname(__FILE__) . '/lib/vistable.php';&nbsp;</div></li><li><div>      $vt = new csv_vistable(&nbsp;</div></li><li><div>          (isset($_GET['tqx']))  ? $_GET['tqx'] : '', &nbsp;</div></li><li><div>          (isset($_GET['tq']))   ? $_GET['tq']  : '', &nbsp;</div></li><li><div>          (isset($_GET['tqrt'])) ? $_GET['tqrt']: '', &nbsp;</div></li><li><div>          (isset($_GET['tz']))   ? $_GET['tz']  : 'PDT', <span class="comment">// TODO: will get_option('timezone_string') work?</span>&nbsp;</div></li><li><div>          get_locale(), &nbsp;</div></li><li><div>          array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $vt-&gt;setup_table($http_response['body']);&nbsp;</div></li><li><div>      print @$vt-&gt;execute();&nbsp;</div></li><li><div>      exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * When trying to do a chart on standard CSV data, </span>&nbsp;</div></li><li><div><span class="comment">   * the vistable library needs help to hint at the</span>&nbsp;</div></li><li><div><span class="comment">   * data types of columns, or else it'll always treat</span>&nbsp;</div></li><li><div><span class="comment">   * the data as a string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $csv_str The raw CSV data.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The same CSV data with a type-hinted header row.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function setGVizCsvDataTypes ($csv_str) {&nbsp;</div></li><li><div>      $data = $this-&gt;parseCsv($csv_str);&nbsp;</div></li><li><div>      $head = array_shift($data);&nbsp;</div></li><li><div>      $cols = array();&nbsp;</div></li><li><div>      <span class="comment">// peek at lines 2 through 20 (not the header)</span>&nbsp;</div></li><li><div>      $peek = (count($data) &gt; 20) ? 20 : count($data);&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $peek; $i++) {&nbsp;</div></li><li><div>          foreach ($data[$i] as $k =&gt; $v) {&nbsp;</div></li><li><div>              if (ctype_digit($v) || preg_match('/^[0-9]+(?:\.[0-9]*)?$/', $v)) {&nbsp;</div></li><li><div>                  $cols[$k] = 'number';&nbsp;</div></li><li><div>              } else if (strtotime($v)) {&nbsp;</div></li><li><div>                  $cols[$k] = 'datetime';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $cols[$k] = 'string';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $head_typed = array();&nbsp;</div></li><li><div>      foreach ($head as $k =&gt; $v) {&nbsp;</div></li><li><div>          if ('string' === $cols[$k]) {&nbsp;</div></li><li><div>              $head_typed[] = $v;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $head_typed[] = $v . ' as ' . $cols[$k];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      array_unshift($data, $head_typed);&nbsp;</div></li><li><div>      $lines = array();&nbsp;</div></li><li><div>      foreach ($data as $row) {&nbsp;</div></li><li><div>          $lines[] = implode(', ', $row);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return implode(&quot;\n&quot;, $lines);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function makeNonceUrl ($url) {&nbsp;</div></li><li><div>      $options = get_option($this-&gt;prefix . 'settings');&nbsp;</div></li><li><div>      $options[$this-&gt;prefix . 'get_datasource_nonce'] = wp_create_nonce($this-&gt;prefix . 'get_datasource_nonce');&nbsp;</div></li><li><div>      update_option($this-&gt;prefix . 'settings', $options);&nbsp;</div></li><li><div>      $p = parse_url($url);&nbsp;</div></li><li><div>      return $p['scheme']&nbsp;</div></li><li><div>          . ':<span class="comment">//' . $p['host'] . $p['path']</span>&nbsp;</div></li><li><div>          . '?' . $p['query'] . '&'&nbsp;</div></li><li><div>          . $this-&gt;prefix . 'get_datasource_nonce=' . $options[$this-&gt;prefix . 'get_datasource_nonce'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function isValidNonce ($nonce, $nonce_name) {&nbsp;</div></li><li><div>      $options = get_option($this-&gt;prefix . 'settings');&nbsp;</div></li><li><div>      $is_valid = ($nonce === $options[$nonce_name]) ? true : false;&nbsp;</div></li><li><div>      unset($options[$this-&gt;prefix . 'get_datasource_nonce']);&nbsp;</div></li><li><div>      update_option($this-&gt;prefix . 'settings', $options);&nbsp;</div></li><li><div>      return $is_valid;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * WordPress Shortcode handler.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function displayShortcode ($atts, $content = null) {&nbsp;</div></li><li><div>      $atts = shortcode_atts(array(&nbsp;</div></li><li><div>          'key' =&gt; false, <span class="comment">// Google Doc URL or ID</span>&nbsp;</div></li><li><div>          'title' =&gt; '', <span class="comment">// Title (attribute) text or visible chart title</span>&nbsp;</div></li><li><div>          'class' =&gt; '', <span class="comment">// Container element's custom class value</span>&nbsp;</div></li><li><div>          'gid' =&gt; false, <span class="comment">// Sheet ID for a Google Spreadsheet, if only one</span>&nbsp;</div></li><li><div>          'summary' =&gt; 'Google Spreadsheet', <span class="comment">// If spreadsheet, value for summary attribute</span>&nbsp;</div></li><li><div>          'width' =&gt; '100%', &nbsp;</div></li><li><div>          'height' =&gt; false, &nbsp;</div></li><li><div>          'style' =&gt; false, &nbsp;</div></li><li><div>          'strip' =&gt; 0, <span class="comment">// If spreadsheet, how many rows to omit from top</span>&nbsp;</div></li><li><div>          'header_rows' =&gt; 1, <span class="comment">// Number of rows in &lt;thead&gt;</span>&nbsp;</div></li><li><div>          'use_cache' =&gt; true, <span class="comment">// Whether to use Transients API for fetched data.</span>&nbsp;</div></li><li><div>          'http_opts' =&gt; false, <span class="comment">// Arguments to pass to the WordPress HTTP API.</span>&nbsp;</div></li><li><div>          <span class="comment">// TODO: Make a plugin option setting for default transient expiry time.</span>&nbsp;</div></li><li><div>          'expire_in' =&gt; 10*MINUTE_IN_SECONDS, <span class="comment">// Custom time-to-live of cached transient data.</span>&nbsp;</div></li><li><div>          'lang' =&gt; get_bloginfo('language'), &nbsp;</div></li><li><div>          'linkify' =&gt; true, <span class="comment">// Whether to run make_clickable() on parsed data.</span>&nbsp;</div></li><li><div>          'query' =&gt; false, <span class="comment">// Google Visualization Query Language querystring</span>&nbsp;</div></li><li><div>          'chart' =&gt; false, <span class="comment">// Type of Chart (for an interactive chart)</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Depending on the type of chart, the following options may be available.</span>&nbsp;</div></li><li><div>          'chart_aggregation_target' =&gt; false, &nbsp;</div></li><li><div>          'chart_annotations' =&gt; false, &nbsp;</div></li><li><div>          'chart_area_opacity' =&gt; false, &nbsp;</div></li><li><div>          'chart_axis_titles_position' =&gt; false, &nbsp;</div></li><li><div>          'chart_background_color' =&gt; false, &nbsp;</div></li><li><div>          'chart_bars' =&gt; false, &nbsp;</div></li><li><div>          'chart_bubble' =&gt; false, &nbsp;</div></li><li><div>          'chart_candlestick' =&gt; false, &nbsp;</div></li><li><div>          'chart_chart_area' =&gt; false, &nbsp;</div></li><li><div>          'chart_color_axis' =&gt; false, &nbsp;</div></li><li><div>          'chart_colors' =&gt; false, &nbsp;</div></li><li><div>          'chart_crosshair' =&gt; false, &nbsp;</div></li><li><div>          'chart_curve_type' =&gt; false, &nbsp;</div></li><li><div>          'chart_data_opacity' =&gt; false, &nbsp;</div></li><li><div>          'chart_dimensions' =&gt; false, &nbsp;</div></li><li><div>          'chart_enable_interactivity' =&gt; false, &nbsp;</div></li><li><div>          'chart_explorer' =&gt; false, &nbsp;</div></li><li><div>          'chart_focus_target' =&gt; false, &nbsp;</div></li><li><div>          'chart_font_name' =&gt; false, &nbsp;</div></li><li><div>          'chart_font_size' =&gt; false, &nbsp;</div></li><li><div>          'chart_force_i_frame' =&gt; false, &nbsp;</div></li><li><div>          'chart_h_axes' =&gt; false, &nbsp;</div></li><li><div>          'chart_h_axis' =&gt; false, &nbsp;</div></li><li><div>          'chart_height' =&gt; false, &nbsp;</div></li><li><div>          'chart_interpolate_nulls' =&gt; false, &nbsp;</div></li><li><div>          'chart_is_stacked' =&gt; false, &nbsp;</div></li><li><div>          'chart_legend' =&gt; false, &nbsp;</div></li><li><div>          'chart_line_width' =&gt; false, &nbsp;</div></li><li><div>          'chart_orientation' =&gt; false, &nbsp;</div></li><li><div>          'chart_pie_hole' =&gt; false, &nbsp;</div></li><li><div>          'chart_pie_residue_slice_color' =&gt; false, &nbsp;</div></li><li><div>          'chart_pie_residue_slice_label' =&gt; false, &nbsp;</div></li><li><div>          'chart_pie_slice_border_color' =&gt; false, &nbsp;</div></li><li><div>          'chart_pie_slice_text' =&gt; false, &nbsp;</div></li><li><div>          'chart_pie_slice_text_style' =&gt; false, &nbsp;</div></li><li><div>          'chart_pie_start_angle' =&gt; false, &nbsp;</div></li><li><div>          'chart_point_shape' =&gt; false, &nbsp;</div></li><li><div>          'chart_point_size' =&gt; false, &nbsp;</div></li><li><div>          'chart_reverse_categories' =&gt; false, &nbsp;</div></li><li><div>          'chart_selection_mode' =&gt; false, &nbsp;</div></li><li><div>          'chart_series' =&gt; false, &nbsp;</div></li><li><div>          'chart_size_axis' =&gt; false, &nbsp;</div></li><li><div>          'chart_slice_visibility_threshold' =&gt; false, &nbsp;</div></li><li><div>          'chart_slices' =&gt; false, &nbsp;</div></li><li><div>          'chart_theme' =&gt; false, &nbsp;</div></li><li><div>          'chart_title_position' =&gt; false, &nbsp;</div></li><li><div>          'chart_title_text_style' =&gt; false, &nbsp;</div></li><li><div>          'chart_tooltip' =&gt; false, &nbsp;</div></li><li><div>          'chart_trendlines' =&gt; false, &nbsp;</div></li><li><div>          'chart_v_axis' =&gt; false, &nbsp;</div></li><li><div>          'chart_width' =&gt; false, &nbsp;</div></li><li><div>          <span class="comment">// For some reason this isn't parsing?</span>&nbsp;</div></li><li><div>          <span class="comment">//'chart_is3D' =&gt; false, </span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// DataTables's HTML5 data- attributes.</span>&nbsp;</div></li><li><div>          <span class="comment">// DataTables Features</span>&nbsp;</div></li><li><div>          <span class="comment">// @see https://www.datatables.net/reference/option/#Features</span>&nbsp;</div></li><li><div>          'datatables_auto_width' =&gt; false, &nbsp;</div></li><li><div>          'datatables_defer_render' =&gt; false, &nbsp;</div></li><li><div>          'datatables_info' =&gt; false, &nbsp;</div></li><li><div>          'datatables_j_query_UI' =&gt; false, &nbsp;</div></li><li><div>          'datatables_length_change' =&gt; false, &nbsp;</div></li><li><div>          'datatables_ordering' =&gt; false, &nbsp;</div></li><li><div>          'datatables_paging' =&gt; false, &nbsp;</div></li><li><div>          'datatables_processing' =&gt; false, &nbsp;</div></li><li><div>          'datatables_scroll_x' =&gt; false, &nbsp;</div></li><li><div>          'datatables_scroll_y' =&gt; false, &nbsp;</div></li><li><div>          'datatables_searching' =&gt; false, &nbsp;</div></li><li><div>          'datatables_server_side' =&gt; false, &nbsp;</div></li><li><div>          'datatables_state_save' =&gt; false, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// DataTables Data</span>&nbsp;</div></li><li><div>          <span class="comment">// @see https://www.datatables.net/reference/option/#Data</span>&nbsp;</div></li><li><div>          'datatables_ajax' =&gt; false, &nbsp;</div></li><li><div>          'datatables_data' =&gt; false, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// DataTables Options</span>&nbsp;</div></li><li><div>          <span class="comment">// @see https://www.datatables.net/reference/option/#Options</span>&nbsp;</div></li><li><div>          'datatables_defer_loading' =&gt; false, &nbsp;</div></li><li><div>          'datatables_destroy' =&gt; false, &nbsp;</div></li><li><div>          'datatables_display_start' =&gt; false, &nbsp;</div></li><li><div>          'datatables_dom' =&gt; false, &nbsp;</div></li><li><div>          'datatables_length_menu' =&gt; false, &nbsp;</div></li><li><div>          'datatables_order_cells_top' =&gt; false, &nbsp;</div></li><li><div>          'datatables_order_classes' =&gt; false, &nbsp;</div></li><li><div>          'datatables_order' =&gt; false, &nbsp;</div></li><li><div>          'datatables_order_fixed' =&gt; false, &nbsp;</div></li><li><div>          'datatables_order_multi' =&gt; false, &nbsp;</div></li><li><div>          'datatables_page_length' =&gt; false, &nbsp;</div></li><li><div>          'datatables_paging_type' =&gt; false, &nbsp;</div></li><li><div>          'datatables_renderer' =&gt; false, &nbsp;</div></li><li><div>          'datatables_retrieve' =&gt; false, &nbsp;</div></li><li><div>          'datatables_scroll_collapse' =&gt; false, &nbsp;</div></li><li><div>          'datatables_search_cols' =&gt; false, &nbsp;</div></li><li><div>          'datatables_search_delay' =&gt; false, &nbsp;</div></li><li><div>          'datatables_search' =&gt; false, &nbsp;</div></li><li><div>          'datatables_state_duration' =&gt; false, &nbsp;</div></li><li><div>          'datatables_stripe_classes' =&gt; false, &nbsp;</div></li><li><div>          'datatables_tab_index' =&gt; false, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// DataTables Columns</span>&nbsp;</div></li><li><div>          <span class="comment">// @see https://www.datatables.net/reference/option/#Columnes</span>&nbsp;</div></li><li><div>          'datatables_column_defs' =&gt; false, &nbsp;</div></li><li><div>          'datatables_columns' =&gt; false, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// DataTables extensions</span>&nbsp;</div></li><li><div>          <span class="comment">// TableTools</span>&nbsp;</div></li><li><div>          <span class="comment">// @see https://www.datatables.net/extensions/tabletools/initialisation</span>&nbsp;</div></li><li><div>          'datatables_table_tools' =&gt; false&nbsp;</div></li><li><div> ), $atts, $this-&gt;shortcode);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $atts['key'] = $this-&gt;sanitizeKey($atts['key']);&nbsp;</div></li><li><div>      $atts['query'] = apply_filters($this-&gt;shortcode . '_query', $this-&gt;sanitizeQuery($atts['query']), $atts);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          switch ($this-&gt;getDocTypeByKey($atts['key'])) {&nbsp;</div></li><li><div>              case 'wpdb':&nbsp;</div></li><li><div>              case 'mysql':&nbsp;</div></li><li><div>                  $output = $this-&gt;getSqlOutput($atts, $content);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              default:&nbsp;</div></li><li><div>                  $output = $this-&gt;getHttpOutput($atts, $content);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } catch (Exception $e) {&nbsp;</div></li><li><div>          $output = $e-&gt;getMessage();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;invocations++;&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns the output of an HTTP datasource.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $x The shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content The content of the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The HTML output as requested by the shortcode or an error message.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function getHttpOutput ($x, $content) {&nbsp;</div></li><li><div>      <span class="comment">// Set up datasource URL.</span>&nbsp;</div></li><li><div>      $url = $x['key']; <span class="comment">// in the default case, the URL is the shortcode's key</span>&nbsp;</div></li><li><div>      $key_type = $this-&gt;getDocTypeByKey($x['key']);&nbsp;</div></li><li><div>      if ('spreadsheet' === $key_type) {&nbsp;</div></li><li><div>          <span class="comment">// if a Google Spreadsheet, the URL to fetch needs to be modified.</span>&nbsp;</div></li><li><div>          $url = $this-&gt;getSpreadsheetUrl($x);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (!empty($x['chart'])) { $fmt = 'json'; }&nbsp;</div></li><li><div>          else { $fmt = 'csv'; }&nbsp;</div></li><li><div>          <span class="comment">// the url should be proxied through this plugin</span>&nbsp;</div></li><li><div>          $url = $this-&gt;makeNonceUrl($this-&gt;getGVizDataSourceUrl($x['key'], $x['query'], $fmt));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Retrieve and set HTML output.</span>&nbsp;</div></li><li><div>      if ('docsviewer' === $key_type) {&nbsp;</div></li><li><div>          $output = $this-&gt;getGDocsViewerOutput($x);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (false === $x['chart']) {&nbsp;</div></li><li><div>              $http_response = $this-&gt;fetchData($url, $x);&nbsp;</div></li><li><div>              $http_content_type = explode(';', $http_response['headers']['content-type']);&nbsp;</div></li><li><div>              switch ($http_content_type[0]) {&nbsp;</div></li><li><div>                  case 'text/csv':&nbsp;</div></li><li><div>                      <span class="comment">// This catches any HTTP response served as text/csv</span>&nbsp;</div></li><li><div>                      $output = $this-&gt;csvToDataTable($http_response['body'], $x, $content);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  default:&nbsp;</div></li><li><div>                      $output = apply_filters($this-&gt;shortcode . '_webapp_html', $http_response['body'], $x);&nbsp;</div></li><li><div>                      if ('csv' === $key_type) {&nbsp;</div></li><li><div>                          <span class="comment">// even if the response is text/plain, parse as CSV if the filename</span>&nbsp;</div></li><li><div>                          <span class="comment">// we detected earlier (by using the key attribute) suggests it is.</span>&nbsp;</div></li><li><div>                          $output = $this-&gt;csvToDataTable($output, $x, $content);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $output = $this-&gt;getGVizChartOutput($url, $x);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns the output of a SQL datasource.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $atts The shortcode attributes.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content The content of the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The HTML output as requested by the shortcode or an error message.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function getSqlOutput ($atts, $content) {&nbsp;</div></li><li><div>      if (!$this-&gt;isSqlDbEnabled()) {&nbsp;</div></li><li><div>          $this-&gt;runtimeError(&nbsp;</div></li><li><div>              esc_html__('Error:', 'inline-gdocs-viewer') . ' '&nbsp;</div></li><li><div>              . esc_html__('SQL datasources are disabled.', 'inline-gdocs-viewer')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;canQuerySqlDatabases()) {&nbsp;</div></li><li><div>          $this-&gt;runtimeError(&nbsp;</div></li><li><div>              esc_html__('Error:', 'inline-gdocs-viewer') . ' '&nbsp;</div></li><li><div>              . esc_html__('The author does not have permission to perform a SQL query.', 'inline-gdocs-viewer')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $query = trim($atts['query']);&nbsp;</div></li><li><div>      if (empty($query)) {&nbsp;</div></li><li><div>          $this-&gt;runtimeError(&nbsp;</div></li><li><div>              esc_html__('Error:', 'inline-gdocs-viewer') . ' '&nbsp;</div></li><li><div>              . esc_html__('Missing query.', 'inline-gdocs-viewer')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (0 !== strpos(strtoupper($query), 'SELECT')) {&nbsp;</div></li><li><div>          $this-&gt;runtimeError(&nbsp;</div></li><li><div>              esc_html__('Error:', 'inline-gdocs-viewer') . ' '&nbsp;</div></li><li><div>              . esc_html__('Unsupported query:', 'inline-gdocs-viewer')&nbsp;</div></li><li><div>              . ' ' . esc_html($query)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ('wpdb' === $this-&gt;getDocTypeByKey($atts['key'])) {&nbsp;</div></li><li><div>          global $wpdb;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $p = parse_url($atts['key']);&nbsp;</div></li><li><div>          $wpdb = new wpdb(&nbsp;</div></li><li><div>              isset($p['user']) ? $p['user'] : '', &nbsp;</div></li><li><div>              isset($p['pass']) ? $p['pass'] : '', &nbsp;</div></li><li><div>              isset($p['path']) ? basename($p['path']) : '', &nbsp;</div></li><li><div>              isset($p['port']) ? &quot;{$p['host']}:{$p['port']}&quot; : $p['host']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $data = $wpdb-&gt;get_results($query, ARRAY_A);&nbsp;</div></li><li><div>      if (empty($data)) {&nbsp;</div></li><li><div>          $this-&gt;runtimeError(&nbsp;</div></li><li><div>              esc_html__('Error:', 'inline-gdocs-viewer') . ' '&nbsp;</div></li><li><div>              . esc_html__('Query produced zero results:', 'inline-gdocs-viewer')&nbsp;</div></li><li><div>              . ' ' . esc_html($query)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $header = array(array()); <span class="comment">// 2D</span>&nbsp;</div></li><li><div>      foreach ($data[0] as $k =&gt; $v) {&nbsp;</div></li><li><div>          $header[0][] = $k;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $output = $this-&gt;dataToHtml(array_merge($header, $data), $atts, $content);&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether or not the &quot;Allow SQL queries in shortcodes&quot; option is enabled.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function isSqlDbEnabled () {&nbsp;</div></li><li><div>      $options = get_option($this-&gt;prefix . 'settings');&nbsp;</div></li><li><div>      return isset($options['allow_sql_db_queries']);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determines if a user has the required capability to run a SQL query from the shortcode.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether or not the author of the current post can do SQL queries.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function canQuerySqlDatabases () {&nbsp;</div></li><li><div>      $author = get_userdata(get_the_author_meta('ID'));&nbsp;</div></li><li><div>      return $author-&gt;has_cap($this-&gt;prefix . 'query_sql_databases');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * WordPress mangles some HTML in subtle ways. Clean that up.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key The value passed to the shortcode's `key` attribute.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The &quot;sanitized&quot; key value.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function sanitizeKey ($key) {&nbsp;</div></li><li><div>      return str_replace('&#038;', '&', $key);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function csvToDataTable ($csv, $x, $content) {&nbsp;</div></li><li><div>      $data = $this-&gt;parseCsv($csv);&nbsp;</div></li><li><div>      return $this-&gt;dataToHtml($data, $x, $content);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function getGDocsViewerOutput ($x) {&nbsp;</div></li><li><div>      $output = '&lt;iframe src=&quot;';&nbsp;</div></li><li><div>      $output .= esc_attr('https:<span class="comment">//docs.google.com/viewer?url=' . esc_url($x['key']) . '&embedded=true');</span>&nbsp;</div></li><li><div>      $output .= '&quot; width=&quot;' . esc_attr($x['width']) . '&quot; height=&quot;' . esc_attr($x['height']) . '&quot; style=&quot;' . esc_attr($x['style']) . '&quot;&gt;';&nbsp;</div></li><li><div>      $output .= esc_html__('Your Web browser must support inline frames to display this content:', 'inline-gdocs-viewer');&nbsp;</div></li><li><div>      $output .= ' &lt;a href=&quot;' . esc_attr($x['key']) . '&quot;&gt;' . esc_html($x['title']) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      $output .= '&lt;/iframe&gt;';&nbsp;</div></li><li><div>      return apply_filters($this-&gt;shortcode . '_viewer_html', $output);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function getGVizChartOutput ($url, $x) {&nbsp;</div></li><li><div>      $chart_id = 'igsv-' . $this-&gt;invocations . '-' . $x['chart'] . 'chart-'  . $this-&gt;getDocId($x['key']);&nbsp;</div></li><li><div>      $output = '&lt;div id=&quot;' . esc_attr($chart_id) . '&quot; class=&quot;igsv-chart&quot; title=&quot;' . esc_attr($x['title']) . '&quot;';&nbsp;</div></li><li><div>      $output .= ' data-chart-type=&quot;' . esc_attr(ucfirst($x['chart'])) . '&quot;';&nbsp;</div></li><li><div>      $output .= ' data-datasource-href=&quot;' . esc_attr($url) . '&chart=true&quot;';&nbsp;</div></li><li><div>      if ($chart_opts = $this-&gt;getChartOptions($x)) {&nbsp;</div></li><li><div>          foreach ($chart_opts as $k =&gt; $v) {&nbsp;</div></li><li><div>              if (!empty($v)) {&nbsp;</div></li><li><div>                  <span class="comment">// use single-quoted attribute-value syntax for later JSON parsing in JavaScript</span>&nbsp;</div></li><li><div>                  $output .= ' data-' . str_replace('_', '-', $k) . &quot;='&quot; . $v . &quot;'&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $output .= '&gt;&lt;/div&gt;'; <span class="comment">// .igsv-chart</span>&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieves the global plugin options.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array An array of data suitable for passing to wp_localize_script().</span>&nbsp;</div></li><li><div><span class="comment">   * @see https://codex.wordpress.org/Function_Reference/wp_localize_script</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function getLocalizedPluginVars () {&nbsp;</div></li><li><div>      $options = get_option($this-&gt;prefix . 'settings');&nbsp;</div></li><li><div>      $tmp = array();&nbsp;</div></li><li><div>      foreach (explode(' ', $options['datatables_classes']) as $cls) {&nbsp;</div></li><li><div>          $cls = (empty($cls)) ? $this-&gt;dt_class : $cls;&nbsp;</div></li><li><div>          $tmp[] = &quot;.$cls:not(.no-datatables)&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $dt_classes = implode(', ', $tmp);&nbsp;</div></li><li><div>      $data = array(&nbsp;</div></li><li><div>          'lang_dir' =&gt; plugins_url('languages', __FILE__), &nbsp;</div></li><li><div>          'datatables_classes' =&gt; $dt_classes, &nbsp;</div></li><li><div>          'datatables_defaults_object' =&gt; $options['datatables_defaults_object']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      return $data;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function getChartOptions($atts) {&nbsp;</div></li><li><div>      $opts = array();&nbsp;</div></li><li><div>      foreach ($atts as $k =&gt; $v) {&nbsp;</div></li><li><div>          if (0 === strpos($k, 'chart_')) {&nbsp;</div></li><li><div>              $opts[$k] = $v;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $opts;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function addQuickTagButton () {&nbsp;</div></li><li><div>      $screen = get_current_screen();&nbsp;</div></li><li><div>      if (wp_script_is('quicktags') && 'post' === $screen-&gt;base) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>jQuery(function () {&nbsp;</div></li><li><div>  var IGSV_QT = {};&nbsp;</div></li><li><div>  IGSV_QT.d = jQuery('#qt_content_igsv_dialog');&nbsp;</div></li><li><div>  IGSV_QT.d.find('#qt_content_igsv_dialog_tabs_container').tabs({&nbsp;</div></li><li><div><span class="comment">//        'beforeActivate': function (e, ui) {</span>&nbsp;</div></li><li><div><span class="comment">//            if ('igsv-datasource-tab' === ui.newTab.context.getAttribute('id')) { return; }</span>&nbsp;</div></li><li><div><span class="comment">//            var is_valid = IGSV_QT.d.find('form').get(0).checkValidity();</span>&nbsp;</div></li><li><div><span class="comment">//            if (!is_valid) {</span>&nbsp;</div></li><li><div><span class="comment">//                IGSV_QT.d.find('[name]:invalid').each(function () {</span>&nbsp;</div></li><li><div><span class="comment">//                    jQuery(this).tooltip();</span>&nbsp;</div></li><li><div><span class="comment"><span class="comment">//                })</span>;</span>&nbsp;</div></li><li><div><span class="comment">//                IGSV_QT.d.find('form :invalid:first-of-type').focus();</span>&nbsp;</div></li><li><div><span class="comment">//            } else {</span>&nbsp;</div></li><li><div><span class="comment">//                IGSV_QT.d.find('[name]').each(function () {</span>&nbsp;</div></li><li><div><span class="comment">//                    var x = jQuery(this).tooltip('instance');</span>&nbsp;</div></li><li><div><span class="comment">//                    if (x) { x.destroy(); }</span>&nbsp;</div></li><li><div><span class="comment">//                })</span>&nbsp;</div></li><li><div><span class="comment">//</span>&nbsp;</div></li><li><div><span class="comment">//            }</span>&nbsp;</div></li><li><div><span class="comment">//            return is_valid;</span>&nbsp;</div></li><li><div><span class="comment">//        }</span>&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>  IGSV_QT.d.dialog({&nbsp;</div></li><li><div>      'dialogClass'  : 'wp-dialog', &nbsp;</div></li><li><div>      'modal'        : true, &nbsp;</div></li><li><div>      'autoOpen'     : false, &nbsp;</div></li><li><div>      'closeOnEscape': true, &nbsp;</div></li><li><div>      'minWidth'     : 700, &nbsp;</div></li><li><div>      'buttons'      : {&nbsp;</div></li><li><div>          'add' : {&nbsp;</div></li><li><div>              'text'  : '&lt;?php print esc_js(__('Add Spreadsheet', 'inline-gdocs-viewer'));?&gt;', &nbsp;</div></li><li><div>              'class' : 'button-primary', &nbsp;</div></li><li><div>              'click' : function () {&nbsp;</div></li><li><div>                  var x = jQuery('#content').prop('selectionStart');&nbsp;</div></li><li><div>                  var cur_txt = jQuery('#content').val();&nbsp;</div></li><li><div>                  var new_txt = '[gdoc ' + shortcodeAttributes(getValues()) + ']';&nbsp;</div></li><li><div>                  jQuery('#content').val([cur_txt.slice(0, x), new_txt, cur_txt.slice(x)].join(''));&nbsp;</div></li><li><div>                  resetDialogUi();&nbsp;</div></li><li><div>                  jQuery(this).dialog('close');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  function getValues () {&nbsp;</div></li><li><div>                      var atts = {};&nbsp;</div></li><li><div>                      jQuery('#qt_content_igsv_dialog input[type=&quot;text&quot;]').each(function () {&nbsp;</div></li><li><div>                          if (jQuery(this).val().length) {&nbsp;</div></li><li><div>                              atts[jQuery(this).attr('name')] = jQuery(this).val();&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      });&nbsp;</div></li><li><div>                      jQuery('#qt_content_igsv_dialog input[type=&quot;checkbox&quot;]').each(function () {&nbsp;</div></li><li><div>                          if (false === jQuery(this).prop('checked')) {&nbsp;</div></li><li><div>                              atts[jQuery(this).attr('name')] = 'no';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      });&nbsp;</div></li><li><div>                      return atts;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  function shortcodeAttributes (atts) {&nbsp;</div></li><li><div>                      var str = '';&nbsp;</div></li><li><div>                      for (k in atts) {&nbsp;</div></li><li><div>                          var v;&nbsp;</div></li><li><div>                          switch (k) {&nbsp;</div></li><li><div>                              case 'query':&nbsp;</div></li><li><div>                                  v = atts[k]&nbsp;</div></li><li><div>                                      .replace('&lt;', encodeURIComponent('&lt;'))&nbsp;</div></li><li><div>                                      .replace('&gt;', encodeURIComponent('&gt;'));&nbsp;</div></li><li><div>                                  break;&nbsp;</div></li><li><div>                              default:&nbsp;</div></li><li><div>                                  atts[k] = v;&nbsp;</div></li><li><div>                                  break;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          str += ' ' + k + '=&quot;' + v + '&quot;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      return str;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  function resetDialogUi () {&nbsp;</div></li><li><div>                      jQuery('#qt_content_igsv_dialog input').each(function () {&nbsp;</div></li><li><div>                          jQuery(this).val('');&nbsp;</div></li><li><div>                      });&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>  QTags.addButton(&nbsp;</div></li><li><div>      'igsv_sheet', &nbsp;</div></li><li><div>      'gdoc', &nbsp;</div></li><li><div>      function () {&nbsp;</div></li><li><div>          jQuery('#qt_content_igsv_sheet').on('click', function (e) {&nbsp;</div></li><li><div>              e.preventDefault();&nbsp;</div></li><li><div>              IGSV_QT.d.dialog('open');&nbsp;</div></li><li><div>              IGSV_QT.d.find('input').get(0).focus();&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>          jQuery('#qt_content_igsv_sheet').click();&nbsp;</div></li><li><div>      }, &nbsp;</div></li><li><div>      '[/gdoc]', &nbsp;</div></li><li><div>      '', &nbsp;</div></li><li><div>      '&lt;?php print esc_js(__('Inline Google Spreadsheet shortcode', 'inline-gdocs-viewer'));?&gt;', &nbsp;</div></li><li><div>      130&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>});&nbsp;</div></li><li><div>&lt;/script&gt;&nbsp;</div></li><li><div>&lt;div id=&quot;qt_content_igsv_dialog&quot; title=&quot;&lt;?php esc_attr_e('Insert Spreadsheet Data as a Table or Chart', 'inline-gdocs-viewer');?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;qt_content_igsv_dialog_tabs_container&quot;&gt;&nbsp;</div></li><li><div>      &lt;ul&gt;&nbsp;</div></li><li><div>          &lt;li&gt;&lt;a href=&quot;#igsv-datasource-tab&quot;&gt;&lt;?php esc_html_e('Datasource', 'inline-gdocs-viewer');?&gt;&lt;/a&gt;&lt;/li&gt;&nbsp;</div></li><li><div>          &lt;li&gt;&lt;a href=&quot;#igsv-integrations-tab&quot;&gt;&lt;?php esc_html_e('Integrations', 'inline-gdocs-viewer');?&gt;&lt;/a&gt;&lt;/li&gt;&nbsp;</div></li><li><div>          &lt;li&gt;&lt;a href=&quot;#igsv-extras-tab&quot;&gt;&lt;?php esc_html_e('Extras', 'inline-gdocs-viewer');?&gt;&lt;/a&gt;&lt;/li&gt;&nbsp;</div></li><li><div>      &lt;/ul&gt;&nbsp;</div></li><li><div>      &lt;form&gt;&nbsp;</div></li><li><div>          &lt;fieldset id=&quot;igsv-datasource-tab&quot;&gt;&nbsp;</div></li><li><div>              &lt;legend&gt;&lt;?php esc_html_e('Datasource options', 'inline-gdocs-viewer');?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>              &lt;p&gt;&lt;?php esc_html_e('Provide a datasource. A datasource is usually a URL. If your data is in a Google Spreadsheet, paste the Web address of the spreadsheet. The only required attribute is the datasource &quot;key.&quot; All other attributes are optional.', 'inline-gdocs-viewer');?&gt; &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;table class=&quot;form-table&quot; summary=&quot;&quot;&gt;&nbsp;</div></li><li><div>                  &lt;tbody&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-key&quot;&gt;&lt;?php esc_html_e('Key', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-key&quot; name=&quot;key&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('paste your Google Spreadsheet or datasource URL here', 'inline-gdocs-viewer');?&gt;&quot; required=&quot;required&quot; title=&quot;&lt;?php esc_html_e('This attribute is required.', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php esc_html_e('Paste the web address of your Google Spreadsheet or CSV-formatted data file.', 'inline-gdocs-viewer');?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-query&quot;&gt;&lt;?php esc_html_e('Query', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-query&quot; name=&quot;query&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('type a query', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php esc_html_e('Enter a query to pre-process your data or to select only the parts of the data you want to use in your post.', 'inline-gdocs-viewer');?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-title&quot;&gt;&lt;?php esc_html_e('Title', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-title&quot; name=&quot;title&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('my data', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php esc_html_e('A title usually appears as a tooltip when a user hovers their cursor over a table or is shown as the headline of a chart.', 'inline-gdocs-viewer');?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                  &lt;/tbody&gt;&nbsp;</div></li><li><div>              &lt;/table&gt;&nbsp;</div></li><li><div>          &lt;/fieldset&gt;&nbsp;</div></li><li><div>          &lt;fieldset id=&quot;igsv-integrations-tab&quot;&gt;&nbsp;</div></li><li><div>              &lt;legend&gt;&lt;?php esc_html_e('Integrations', 'inline-gdocs-viewer');?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>              &lt;p&gt;&lt;?php esc_html_e('If you use a custom theme or write custom functions, you can integrate your spreadsheet table or chart by specifying your integration values here. You can safely ignore these options if you do not have other code or are not using another plugin that needs them.', 'inline-gdocs-viewer');?&gt; &lt;/p&gt;&nbsp;</div></li><li><div>              &lt;table class=&quot;form-table&quot; summary=&quot;&quot;&gt;&nbsp;</div></li><li><div>                  &lt;tbody&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-class&quot;&gt;&lt;?php esc_html_e('Class', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-class&quot; name=&quot;class&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('custom-class other-custom-class', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php esc_html_e('Add a custom HTML class value to the containing element.', 'inline-gdocs-viewer');?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-style&quot;&gt;&lt;?php esc_html_e('Style', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-style&quot; name=&quot;style&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('style', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php esc_html_e('Add inline CSS rules to your table or chart if you need to tweak its appearance.', 'inline-gdocs-viewer');?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-width&quot;&gt;&lt;?php esc_html_e('Width', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-width&quot; name=&quot;width&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('width', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php esc_html_e('Add an explicit width to your chart if you need to tweak its appearance. (Tables ignore this. Use the &quot;style&quot; option instead.)', 'inline-gdocs-viewer');?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-height&quot;&gt;&lt;?php esc_html_e('Height', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-height&quot; name=&quot;height&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('height', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php esc_html_e('Add an explicit height to your chart if you need to tweak its appearance. (Tables ignore this. Use the &quot;style&quot; option instead.)', 'inline-gdocs-viewer');?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-lang&quot;&gt;&lt;?php esc_html_e('Language', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-lang&quot; name=&quot;lang&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php esc_attr_e('lang', 'inline-gdocs-viewer');?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;p class=&quot;description&quot;&gt;&lt;?php print sprintf(&nbsp;</div></li><li><div>                                  esc_html__('If your datasource content is in a language other than %1$s, enter the %2$sISO-639%3$s language code for that language here.', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>                                  '&lt;code&gt;' . get_locale() . '&lt;/code&gt;', &nbsp;</div></li><li><div>                                  '&lt;a href=&quot;http:<span class="comment">//www.iso.org/iso/home/standards/language_codes.htm&quot;&gt;', '&lt;/a&gt;'</span>&nbsp;</div></li><li><div> );?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                  &lt;/tbody&gt;&nbsp;</div></li><li><div>              &lt;/table&gt;&nbsp;</div></li><li><div>          &lt;/fieldset&gt;&nbsp;</div></li><li><div>          &lt;fieldset id=&quot;igsv-extras-tab&quot;&gt;&nbsp;</div></li><li><div>              &lt;legend&gt;&lt;?php esc_html_e('Extras', 'inline-gdocs-viewer');?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>              &lt;table class=&quot;form-table&quot; summary=&quot;&quot;&gt;&nbsp;</div></li><li><div>                  &lt;tbody&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-use-cache&quot;&gt;&lt;?php esc_html_e('Cache', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-use-cache&quot; name=&quot;use_cache&quot; type=&quot;checkbox&quot; checked=&quot;checked&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;span class=&quot;description&quot;&gt;&lt;?php esc_html_e('To improve performance, your datasource is cached for ten minutes. If you are making many changes quickly, or if your spreadsheet data is small but frequently updated, you may want to disable caching. Disabling the cache is not recommended for medium or large datasets.', 'inline-gdocs-viewer');?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;tr&gt;&nbsp;</div></li><li><div>                          &lt;th&gt;&nbsp;</div></li><li><div>                              &lt;label for=&quot;js-qt-igsv-linkify&quot;&gt;&lt;?php esc_html_e('Linkify', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                          &lt;/th&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;input id=&quot;js-qt-igsv-linkify&quot; name=&quot;linkify&quot; type=&quot;checkbox&quot; checked=&quot;checked&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;span class=&quot;description&quot;&gt;&lt;?php esc_html_e('Email addresses and URLs in your data are automatically turned into clickable links. If this causes problems, you can disable the automatic linking feature by unchecking this box.', 'inline-gdocs-viewer');?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                  &lt;/tbody&gt;&nbsp;</div></li><li><div>              &lt;/table&gt;&nbsp;</div></li><li><div>          &lt;/fieldset&gt;&nbsp;</div></li><li><div>      &lt;/form&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&lt;!-- #qt_content_igsv_dialog_tabs_container --&gt;&nbsp;</div></li><li><div>  &lt;?php print $this-&gt;showDonationAppeal();?&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&lt;!-- #qt_content_igsv_dialog --&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function registerContextualHelp () {&nbsp;</div></li><li><div>      $screen = get_current_screen();&nbsp;</div></li><li><div>      if ($screen-&gt;id !== 'post' ) { return; }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = '&lt;p&gt;';&nbsp;</div></li><li><div>      $html .= sprintf(&nbsp;</div></li><li><div>          esc_html__('You can insert a Google Spreadsheet in this post. To do so, type %s[gdoc key=&quot;YOUR_SPREADSHEET_URL&quot;]%s wherever you would like the spreadsheet to appear. Remember to replace YOUR_SPREADSHEET_URL with the web address of your Google Spreadsheet.', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          '&lt;kbd&gt;', '&lt;/kbd&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $html .= '&lt;/p&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;p&gt;';&nbsp;</div></li><li><div>      $html .= esc_html__('Only Google Spreadsheets that have been shared using either the &quot;Public on the web&quot; or &quot;anyone with the link&quot; options will be visible on this page.', 'inline-gdocs-viewer');&nbsp;</div></li><li><div>      $html .= '&lt;/p&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;p&gt;' . sprintf(&nbsp;</div></li><li><div>          esc_html__('You can also transform your data into an interactive chart by using the %1$schart%2$s attribute. Supported chart types are Area, Bar, Bubble, Candlestick, Column, Combo, Histogram, Line, Pie, Scatter, and Stepped. For instance, to make a Pie chart, type %1$s[gdoc key=&quot;YOUR_SPREADSHEET_URL&quot; chart=&quot;Pie&quot;]%2$s. Customize your chart with your own choice of colors by supplying a space-separated list of color values with the %1$schart_colors%2$s attribute, like %1$schart_colors=&quot;red green&quot;%2$s. Additional options depend on the chart you use.' , 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          '&lt;kbd&gt;', '&lt;/kbd&gt;'&nbsp;</div></li><li><div> ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;p&gt;' . sprintf(&nbsp;</div></li><li><div>          esc_html__('Refer to the %1$sshortcode attribute documentation%3$s for a complete list of shortcode attributes, and the %2$sGoogle Chart API documentation%3$s for more information about each option.' , 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          '&lt;a href=&quot;https:<span class="comment">//wordpress.org/plugins/inline-google-spreadsheet-viewer/other_notes/&quot; target=&quot;_blank&quot;&gt;', </span>&nbsp;</div></li><li><div>          '&lt;a href=&quot;https:<span class="comment">//developers.google.com/chart/interactive/docs/gallery&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;'</span>&nbsp;</div></li><li><div> ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;p&gt;';&nbsp;</div></li><li><div>      $html .= sprintf(&nbsp;</div></li><li><div>          esc_html__('If you are having trouble getting your Spreadsheet to show up on your website, you can %sget help from the plugin support forum%s. Consider searching the support forum to see if your question has already been answered before posting a new thread.', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          '&lt;a href=&quot;https:<span class="comment">//wordpress.org/support/plugin/inline-google-spreadsheet-viewer/&quot;&gt;', '&lt;/a&gt;'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $html .= '&lt;/p&gt;';&nbsp;</div></li><li><div>      ob_start();&nbsp;</div></li><li><div>      $this-&gt;showDonationAppeal();&nbsp;</div></li><li><div>      $x = ob_get_contents();&nbsp;</div></li><li><div>      ob_end_clean();&nbsp;</div></li><li><div>      $html .= $x;&nbsp;</div></li><li><div>      $screen-&gt;add_help_tab(array(&nbsp;</div></li><li><div>          'id' =&gt; $this-&gt;shortcode . '-' . $screen-&gt;base . '-help', &nbsp;</div></li><li><div>          'title' =&gt; __('Inserting a Google Spreadsheet', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          'content' =&gt; $html&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private function showDonationAppeal () {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;div class=&quot;donation-appeal&quot;&gt;&nbsp;</div></li><li><div>  &lt;p style=&quot;text-align: center; font-style: italic; margin: 1em 3em;&quot;&gt;&lt;?php print sprintf(&nbsp;</div></li><li><div>esc_html__('Inline Google Spreadsheet Viewer is provided as free software, but sadly grocery stores do not offer free food. If you like this plugin, please consider %1$s to its %2$s. &hearts; Thank you!', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>'&lt;a href=&quot;https:<span class="comment">//www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=meitarm%40gmail%2ecom&lc=US&amp;item_name=Inline%20Google%20Spreadsheet%20Viewer%20WordPress%20Plugin&amp;item_number=inline%2dgdocs%2dviewer&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted&quot;&gt;' . esc_html__('making a donation', 'inline-gdocs-viewer') . '&lt;/a&gt;', </span>&nbsp;</div></li><li><div>'&lt;a href=&quot;http:<span class="comment">//Cyberbusking.org/&quot;&gt;' . esc_html__('houseless, jobless, nomadic developer', 'inline-gdocs-viewer') . '&lt;/a&gt;'</span>&nbsp;</div></li><li><div>);?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function validateSettings ($input) {&nbsp;</div></li><li><div>      $safe_input = array();&nbsp;</div></li><li><div>      foreach ($input as $k =&gt; $v) {&nbsp;</div></li><li><div>          switch ($k) {&nbsp;</div></li><li><div>              case 'allow_sql_db_queries':&nbsp;</div></li><li><div>                  $safe_input[$k] = intval($v);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'datatables_classes':&nbsp;</div></li><li><div>                  if (empty($v)) { $v = $this-&gt;dt_class; }&nbsp;</div></li><li><div>                  $safe_input[$k] = sanitize_text_field($v);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'datatables_defaults_object':&nbsp;</div></li><li><div>                  if (empty($v)) { $v = $this-&gt;dt_defaults; }&nbsp;</div></li><li><div>                  $safe_input[$k] = json_decode($v);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $safe_input;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function renderOptionsPage () {&nbsp;</div></li><li><div>      if (!current_user_can('manage_options')) {&nbsp;</div></li><li><div>          wp_die(__('You do not have sufficient permissions to access this page.', 'inline-gdocs-viewer'));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $options = get_option($this-&gt;prefix . 'settings');&nbsp;</div></li><li><div>      $datatables_defaults_json = (defined('JSON_PRETTY_PRINT'))&nbsp;</div></li><li><div>          ? json_encode($options['datatables_defaults_object'], JSON_PRETTY_PRINT)&nbsp;</div></li><li><div>          : json_encode($options['datatables_defaults_object']);&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;h2&gt;&lt;?php esc_html_e('Inline Google Spreadsheet Viewer Settings', 'inline-gdocs-viewer');?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>&lt;form method=&quot;post&quot; action=&quot;options.php&quot;&gt;&nbsp;</div></li><li><div>&lt;?php settings_fields($this-&gt;prefix . 'settings');?&gt;&nbsp;</div></li><li><div>&lt;fieldset&gt;&lt;legend&gt;&lt;?php esc_html_e('DataTables defaults', 'inline-gdocs-viewer');?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;table class=&quot;form-table&quot; summary=&quot;&lt;?php esc_attr_e('Site-wide defaults for DataTables-enhanced tables.', 'inline-gdocs-viewer');?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;tbody&gt;&nbsp;</div></li><li><div>      &lt;tr&gt;&nbsp;</div></li><li><div>          &lt;th&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;datatables_classes&quot;&gt;&lt;?php esc_html_e('DataTables classes', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/th&gt;&nbsp;</div></li><li><div>          &lt;td&gt;&nbsp;</div></li><li><div>              &lt;input id=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;datatables_classes&quot; name=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;settings[datatables_classes]&quot; value=&quot;&lt;?php esc_attr_e($options['datatables_classes'])?&gt;&quot; placeholder=&quot;&lt;?php esc_attr_e('class-1 class-2', 'inline-gdocs-viewer')?&gt;&quot; /&gt;&nbsp;</div></li><li><div>              &lt;p class=&quot;description&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php print sprintf(&nbsp;</div></li><li><div>                      esc_html__('A space-separated list of HTML %1$sclass%2$s values. %1$s&lt;table&gt;%2$s elements with these classes will automatically be enhanced with %3$sjQuery DataTables%4$s, unless the given table also has the special %1$sno-datatables%2$s class. Leave blank to use the plugin default.', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>                      '&lt;code&gt;', '&lt;/code&gt;', &nbsp;</div></li><li><div>                      '&lt;a href=&quot;https:<span class="comment">//datatables.net/&quot;&gt;', '&lt;/a&gt;'</span>&nbsp;</div></li><li><div> );?&gt;&nbsp;</div></li><li><div>              &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;/td&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;tr&gt;&nbsp;</div></li><li><div>          &lt;th&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;datatables_defaults_object&quot;&gt;&lt;?php esc_html_e('DataTables defaults object', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/th&gt;&nbsp;</div></li><li><div>          &lt;td&gt;&nbsp;</div></li><li><div>              &lt;textarea&nbsp;</div></li><li><div>                  id=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;datatables_defaults_object&quot;&nbsp;</div></li><li><div>                  name=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;settings[datatables_defaults_object]&quot;&nbsp;</div></li><li><div>                  placeholder='{ &quot;searching&quot;: false, &quot;ordering&quot;: false }'&nbsp;</div></li><li><div>                  style=&quot;width: 50%; min-height: 200px;&quot;&nbsp;</div></li><li><div>              &gt;&lt;?php if (!empty($options['datatables_defaults_object'])) { print stripslashes($datatables_defaults_json); }?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>              &lt;p class=&quot;description&quot;&gt;&lt;?php print sprintf(&nbsp;</div></li><li><div>                  esc_html__('Define a DataTables defaults initialization object. This is useful if you wish to change the default DataTables enhancements for all affected tables on your site at once. All DataTables-enhanced tables will use the DataTables options configured here unless explicitly overriden in the shortcode, HTML, or JavaScript initialization for the given table, itself. To learn more, read the %1$sDataTables manual section on Setting defaults%2$s and refer to the %3$sdocumentation for shortcode attributes available via this plugin%2$s. Leave blank to use the plugin default.'), &nbsp;</div></li><li><div>                  '&lt;a href=&quot;https:<span class="comment">//datatables.net/manual/options#Setting-defaults&quot;&gt;', '&lt;/a&gt;', </span>&nbsp;</div></li><li><div>                  '&lt;a href=&quot;https:<span class="comment">//wordpress.org/plugins/inline-google-spreadsheet-viewer/other_notes/&quot;&gt;'</span>&nbsp;</div></li><li><div> );?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>          &lt;/td&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;&nbsp;</div></li><li><div>  &lt;/tbody&gt;&nbsp;</div></li><li><div>&lt;/table&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&nbsp;</div></li><li><div>&lt;fieldset&gt;&lt;legend&gt;&lt;?php esc_html_e('Advanced options', 'inline-gdocs-viewer');?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>&lt;table class=&quot;form-table&quot; summary=&quot;&lt;?php esc_attr_e('Advanced Options', 'inline-gdocs-viewer');?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;tbody&gt;&nbsp;</div></li><li><div>      &lt;tr&gt;&nbsp;</div></li><li><div>          &lt;th&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;allow_sql_db_queries&quot;&gt;&lt;?php esc_html_e('Allow SQL queries in shortcodes?', 'inline-gdocs-viewer');?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/th&gt;&nbsp;</div></li><li><div>          &lt;td&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;checkbox&quot; &lt;?php if (isset($options['allow_sql_db_queries'])) : print 'checked=&quot;checked&quot;'; endif; ?&gt; value=&quot;1&quot; id=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;allow_sql_db_queries&quot; name=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;settings[allow_sql_db_queries]&quot; /&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;&lt;?php esc_attr_e($this-&gt;prefix);?&gt;allow_sql_db_queries&quot;&gt;&lt;span class=&quot;description&quot;&gt;&lt;?php&nbsp;</div></li><li><div>      print sprintf(&nbsp;</div></li><li><div>          esc_html__('Enabling this option permits SQL queries against arbitrary MySQL databases to be inserted as part of a %1$s shortcode. This is useful but can also be easily abused, so it is disabled by default. Even once enabled, such queries will only work in posts whose author has been granted the %2$s capability. (Only Administrators have this capability by default.)', 'inline-gdocs-viewer'), &nbsp;</div></li><li><div>          $this-&gt;shortcode, &nbsp;</div></li><li><div>          &quot;&lt;code&gt;{$this-&gt;prefix}query_sql_databases&lt;/code&gt;&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              ?&gt;&lt;/span&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/td&gt;&nbsp;</div></li><li><div>      &lt;/tr&gt;&nbsp;</div></li><li><div>  &lt;/tbody&gt;&nbsp;</div></li><li><div>&lt;/table&gt;&nbsp;</div></li><li><div>&lt;/fieldset&gt;&nbsp;</div></li><li><div>&lt;?php submit_button();?&gt;&nbsp;</div></li><li><div>&lt;/form&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>      $this-&gt;showDonationAppeal();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$inline_gdoc_viewer = new InlineGoogleSpreadsheetViewerPlugin();&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Inline Google Spreadsheet Viewer</li><li><span></span>0.9.9.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>