<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.6.1" data-slug="woocommerce-products-quick-view" data-type="class" data-id="21909"><head xmlns="http://www.w3.org/1999/xhtml"><title> a3_cssmin | class | Woocommerce Products Quick View | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="a3_CSSmin, class, plugin, woocommerce-products-quick-view, 1.6.1" /><meta name="description" content="The WooCommerce Products Quick View a3 CSSmin class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=05bcf834530832c795b3a35e1661f6f7' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/a3_cssmin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fa3_cssmin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fa3_cssmin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-products-quick-view-1.6.1-class-a3_cssmin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="a3_cssmin" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce-products-quick-vi&hellip;." href="http://hookr.io/plugins/woocommerce-products-quick-view/" class="plugin"><span property="name">woocommerce-products-quick-vi&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.6.1." href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/" class="H_VERSION"><span property="name">1.6.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">a3_cssmin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="184"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/all/" title="All">All <span class="count badge">184</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="100"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/hooks/" title="Hooks">Hooks <span class="count badge">100</span></a></li><li class="" data-id="action" data-count="34"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/actions/" title="Actions">Actions <span class="count badge">34</span></a></li><li class="" data-id="filter" data-count="66"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/filters/" title="Filters">Filters <span class="count badge">66</span></a></li><li class="active" data-id="class" data-count="49"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/classes/" title="Classes">Classes <span class="count badge">49</span></a></li><li class="" data-id="constant" data-count="13"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/constants/" title="Constants">Constants <span class="count badge">13</span></a></li><li class="" data-id="function" data-count="22"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/functions/" title="Functions">Functions <span class="count badge">22</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>a3_CSSmin</strong></h1><p>The WooCommerce Products Quick View <strong>a3 CSSmin</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/files/admin-less-lib-cssmin-inc/" class="file">/admin/less/lib/cssmin.inc.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="23" class="block" start="23"><li><div>class a3_CSSmin&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    const NL = '___YUICSSMIN_PRESERVED_NL___';&nbsp;</div></li><li><div>    const TOKEN = '___YUICSSMIN_PRESERVED_TOKEN_';&nbsp;</div></li><li><div>    const COMMENT = '___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_';&nbsp;</div></li><li><div>    const CLASSCOLON = '___YUICSSMIN_PSEUDOCLASSCOLON___';&nbsp;</div></li><li><div>    const QUERY_FRACTION = '___YUICSSMIN_QUERY_FRACTION___';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private $comments;&nbsp;</div></li><li><div>    private $preserved_tokens;&nbsp;</div></li><li><div>    private $memory_limit;&nbsp;</div></li><li><div>    private $max_execution_time;&nbsp;</div></li><li><div>    private $pcre_backtrack_limit;&nbsp;</div></li><li><div>    private $pcre_recursion_limit;&nbsp;</div></li><li><div>    private $raise_php_limits;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param bool|int $raise_php_limits&nbsp;</div></li><li><div>     * If true, PHP settings will be raised if needed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct($raise_php_limits = TRUE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Set suggested PHP limits&nbsp;</div></li><li><div>        $this-&gt;memory_limit = 128 * 1048576; // 128MB in bytes&nbsp;</div></li><li><div>        $this-&gt;max_execution_time = 60; // 1 min&nbsp;</div></li><li><div>        $this-&gt;pcre_backtrack_limit = 1000 * 1000;&nbsp;</div></li><li><div>        $this-&gt;pcre_recursion_limit =  500 * 1000;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;raise_php_limits = (bool) $raise_php_limits;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Minify a string of CSS&nbsp;</div></li><li><div>     * @param string $css&nbsp;</div></li><li><div>     * @param int|bool $linebreak_pos&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function run($css = '', $linebreak_pos = FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (empty($css)) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;raise_php_limits) {&nbsp;</div></li><li><div>            $this-&gt;do_raise_php_limits();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;comments = array();&nbsp;</div></li><li><div>        $this-&gt;preserved_tokens = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $start_index = 0;&nbsp;</div></li><li><div>        $length = strlen($css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $css = $this-&gt;extract_data_urls($css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // collect all comment blocks...&nbsp;</div></li><li><div>        while (($start_index = $this-&gt;index_of($css, '/*', $start_index)) &gt;= 0) {&nbsp;</div></li><li><div>            $end_index = $this-&gt;index_of($css, '*/', $start_index + 2);&nbsp;</div></li><li><div>            if ($end_index &lt; 0) {&nbsp;</div></li><li><div>                $end_index = $length;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $comment_found = $this-&gt;str_slice($css, $start_index + 2, $end_index);&nbsp;</div></li><li><div>            $this-&gt;comments[] = $comment_found;&nbsp;</div></li><li><div>            $comment_preserve_string = self::COMMENT . (count($this-&gt;comments) - 1) . '___';&nbsp;</div></li><li><div>            $css = $this-&gt;str_slice($css, 0, $start_index + 2) . $comment_preserve_string . $this-&gt;str_slice($css, $end_index);&nbsp;</div></li><li><div>            // Set correct start_index: Fixes issue #2528130&nbsp;</div></li><li><div>            $start_index = $end_index + 2 + strlen($comment_preserve_string) - strlen($comment_found);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // preserve strings so their content doesn't get accidentally minified&nbsp;</div></li><li><div>        $css = preg_replace_callback('/(?:&quot;(?:[^\\\\&quot;]|\\\\.|\\\\)*&quot;)|'.&quot;(?:'(?:[^\\\\']|\\\\.|\\\\)*')/S&quot;, array($this, 'replace_string'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let's divide css code in chunks of 5.000 chars aprox.&nbsp;</div></li><li><div>        // Reason: PHP's PCRE functions like preg_replace have a &quot;backtrack limit&quot;&nbsp;</div></li><li><div>        // of 100.000 chars by default (php &lt; 5.3.7) so if we're dealing with really&nbsp;</div></li><li><div>        // long strings and a (sub)pattern matches a number of chars greater than&nbsp;</div></li><li><div>        // the backtrack limit number (i.e. /(.*)/s) PCRE functions may fail silently&nbsp;</div></li><li><div>        // returning NULL and $css would be empty.&nbsp;</div></li><li><div>        $charset = '';&nbsp;</div></li><li><div>        $charset_regexp = '/(@charset)( [^;]+;)/i';&nbsp;</div></li><li><div>        $css_chunks = array();&nbsp;</div></li><li><div>        $css_chunk_length = 5000; // aprox size, not exact&nbsp;</div></li><li><div>        $start_index = 0;&nbsp;</div></li><li><div>        $i = $css_chunk_length; // save initial iterations&nbsp;</div></li><li><div>        $l = strlen($css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if the number of characters is 5000 or less, do not chunk&nbsp;</div></li><li><div>        if ($l &lt;= $css_chunk_length) {&nbsp;</div></li><li><div>            $css_chunks[] = $css;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // chunk css code securely&nbsp;</div></li><li><div>            while ($i &lt; $l) {&nbsp;</div></li><li><div>                $i += 50; // save iterations&nbsp;</div></li><li><div>                if ($l - $start_index &lt;= $css_chunk_length || $i &gt;= $l) {&nbsp;</div></li><li><div>                    $css_chunks[] = $this-&gt;str_slice($css, $start_index);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($css[$i - 1] === '}' && $i - $start_index &gt; $css_chunk_length) {&nbsp;</div></li><li><div>                    // If there are two ending curly braces }} separated or not by spaces, &nbsp;</div></li><li><div>                    // join them in the same chunk (i.e. @media blocks)&nbsp;</div></li><li><div>                    $next_chunk = substr($css, $i);&nbsp;</div></li><li><div>                    if (preg_match('/^\s*\}/', $next_chunk)) {&nbsp;</div></li><li><div>                        $i = $i + $this-&gt;index_of($next_chunk, '}') + 1;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $css_chunks[] = $this-&gt;str_slice($css, $start_index, $i);&nbsp;</div></li><li><div>                    $start_index = $i;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Minify each chunk&nbsp;</div></li><li><div>        for ($i = 0, $n = count($css_chunks); $i &lt; $n; $i++) {&nbsp;</div></li><li><div>            $css_chunks[$i] = $this-&gt;minify($css_chunks[$i], $linebreak_pos);&nbsp;</div></li><li><div>            // Keep the first @charset at-rule found&nbsp;</div></li><li><div>            if (empty($charset) && preg_match($charset_regexp, $css_chunks[$i], $matches)) {&nbsp;</div></li><li><div>                $charset = strtolower($matches[1]) . $matches[2];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Delete all @charset at-rules&nbsp;</div></li><li><div>            $css_chunks[$i] = preg_replace($charset_regexp, '', $css_chunks[$i]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update the first chunk and push the charset to the top of the file.&nbsp;</div></li><li><div>        $css_chunks[0] = $charset . $css_chunks[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return implode('', $css_chunks);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the memory limit for this script&nbsp;</div></li><li><div>     * @param int|string $limit&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_memory_limit($limit)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;memory_limit = $this-&gt;normalize_int($limit);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the maximum execution time for this script&nbsp;</div></li><li><div>     * @param int|string $seconds&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_max_execution_time($seconds)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;max_execution_time = (int) $seconds;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the PCRE backtrack limit for this script&nbsp;</div></li><li><div>     * @param int $limit&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_pcre_backtrack_limit($limit)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;pcre_backtrack_limit = (int) $limit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the PCRE recursion limit for this script&nbsp;</div></li><li><div>     * @param int $limit&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_pcre_recursion_limit($limit)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;pcre_recursion_limit = (int) $limit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Try to configure PHP to use at least the suggested minimum settings&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function do_raise_php_limits()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $php_limits = array(&nbsp;</div></li><li><div>            'memory_limit' =&gt; $this-&gt;memory_limit, &nbsp;</div></li><li><div>            'max_execution_time' =&gt; $this-&gt;max_execution_time, &nbsp;</div></li><li><div>            'pcre.backtrack_limit' =&gt; $this-&gt;pcre_backtrack_limit, &nbsp;</div></li><li><div>            'pcre.recursion_limit' =&gt;  $this-&gt;pcre_recursion_limit&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If current settings are higher respect them.&nbsp;</div></li><li><div>        foreach ($php_limits as $name =&gt; $suggested) {&nbsp;</div></li><li><div>            $current = $this-&gt;normalize_int(ini_get($name));&nbsp;</div></li><li><div>            // memory_limit exception: allow -1 for &quot;no memory limit&quot;.&nbsp;</div></li><li><div>            if ($current &gt; -1 && ($suggested == -1 || $current &lt; $suggested)) {&nbsp;</div></li><li><div>                ini_set($name, $suggested);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Does bulk of the minification&nbsp;</div></li><li><div>     * @param string $css&nbsp;</div></li><li><div>     * @param int|bool $linebreak_pos&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function minify($css, $linebreak_pos)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // strings are safe, now wrestle the comments&nbsp;</div></li><li><div>        for ($i = 0, $max = count($this-&gt;comments); $i &lt; $max; $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $token = $this-&gt;comments[$i];&nbsp;</div></li><li><div>            $placeholder = '/' . self::COMMENT . $i . '___/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // ! in the first position of the comment means preserve&nbsp;</div></li><li><div>            // so push to the preserved tokens keeping the !&nbsp;</div></li><li><div>            if (substr($token, 0, 1) === '!') {&nbsp;</div></li><li><div>                $this-&gt;preserved_tokens[] = $token;&nbsp;</div></li><li><div>                $token_tring = self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___';&nbsp;</div></li><li><div>                $css = preg_replace($placeholder, $token_tring, $css, 1);&nbsp;</div></li><li><div>                // Preserve new lines for /*! important comments&nbsp;</div></li><li><div>                $css = preg_replace('/\s*[\n\r\f]+\s*(\/\*'. $token_tring .')/S', self::NL.'$1', $css);&nbsp;</div></li><li><div>                $css = preg_replace('/('. $token_tring .'\*\/)\s*[\n\r\f]+\s*/', '$1'.self::NL, $css);&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // \ in the last position looks like hack for Mac/IE5&nbsp;</div></li><li><div>            // shorten that to /*\*/ and the next one to /**/&nbsp;</div></li><li><div>            if (substr($token, (strlen($token) - 1), 1) === '\\') {&nbsp;</div></li><li><div>                $this-&gt;preserved_tokens[] = '\\';&nbsp;</div></li><li><div>                $css = preg_replace($placeholder, self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___', $css, 1);&nbsp;</div></li><li><div>                $i = $i + 1; // attn: advancing the loop&nbsp;</div></li><li><div>                $this-&gt;preserved_tokens[] = '';&nbsp;</div></li><li><div>                $css = preg_replace('/' . self::COMMENT . $i . '___/', self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___', $css, 1);&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // keep empty comments after child selectors (IE7 hack)&nbsp;</div></li><li><div>            // e.g. html &gt;/**/ body&nbsp;</div></li><li><div>            if (strlen($token) === 0) {&nbsp;</div></li><li><div>                $start_index = $this-&gt;index_of($css, $this-&gt;str_slice($placeholder, 1, -1));&nbsp;</div></li><li><div>                if ($start_index &gt; 2) {&nbsp;</div></li><li><div>                    if (substr($css, $start_index - 3, 1) === '&gt;') {&nbsp;</div></li><li><div>                        $this-&gt;preserved_tokens[] = '';&nbsp;</div></li><li><div>                        $css = preg_replace($placeholder, self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___', $css, 1);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // in all other cases kill the comment&nbsp;</div></li><li><div>            $css = preg_replace('/\/\*' . $this-&gt;str_slice($placeholder, 1, -1) . '\*\//', '', $css, 1);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Normalize all whitespace strings to single spaces. Easier to work with that way.&nbsp;</div></li><li><div>        $css = preg_replace('/\s+/', ' ', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fix IE7 issue on matrix filters which browser accept whitespaces between Matrix parameters&nbsp;</div></li><li><div>        $css = preg_replace_callback('/\s*filter\:\s*progid:DXImageTransform\.Microsoft\.Matrix\(([^\)]+)\)/', array($this, 'preserve_old_IE_specific_matrix_definition'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Shorten & preserve calculations calc(...) since spaces are important&nbsp;</div></li><li><div>        $css = preg_replace_callback('/calc(\(((?:[^\(\)]+|(?1))*)\))/i', array($this, 'replace_calc'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Replace positive sign from numbers preceded by : or a white-space before the leading space is removed&nbsp;</div></li><li><div>        // +1.2em to 1.2em, +.8px to .8px, +2% to 2%&nbsp;</div></li><li><div>        $css = preg_replace('/((?&lt;!\\\\)\:|\s)\+(\.?\d+)/S', '$1$2', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove leading zeros from integer and float numbers preceded by : or a white-space&nbsp;</div></li><li><div>        // 000.6 to .6, -0.8 to -.8, 0050 to 50, -01.05 to -1.05&nbsp;</div></li><li><div>        $css = preg_replace('/((?&lt;!\\\\)\:|\s)(\-?)0+(\.?\d+)/S', '$1$2$3', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove trailing zeros from float numbers preceded by : or a white-space&nbsp;</div></li><li><div>        // -6.0100em to -6.01em, .0100 to .01, 1.200px to 1.2px&nbsp;</div></li><li><div>        $css = preg_replace('/((?&lt;!\\\\)\:|\s)(\-?)(\d?\.\d+?)0+([^\d])/S', '$1$2$3$4', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove trailing .0 -&gt; -9.0 to -9&nbsp;</div></li><li><div>        $css = preg_replace('/((?&lt;!\\\\)\:|\s)(\-?\d+)\.0([^\d])/S', '$1$2$3', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Replace 0 length numbers with 0&nbsp;</div></li><li><div>        $css = preg_replace('/((?&lt;!\\\\)\:|\s)\-?\.?0+([^\d])/S', '${1}0$2', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove the spaces before the things that should not have spaces before them.&nbsp;</div></li><li><div>        // But, be careful not to turn &quot;p :link {...}&quot; into &quot;p:link{...}&quot;&nbsp;</div></li><li><div>        // Swap out any pseudo-class colons with the token, and then swap back.&nbsp;</div></li><li><div>        $css = preg_replace_callback('/(?:^|\})[^\{]*\s+\:/', array($this, 'replace_colon'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove spaces before the things that should not have spaces before them.&nbsp;</div></li><li><div>        $css = preg_replace('/\s+([\!\{\}\;\:\&gt;\+\(\)\]\~\=, ])/', '$1', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Restore spaces for !important&nbsp;</div></li><li><div>        $css = preg_replace('/\!important/i', ' !important', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // bring back the colon&nbsp;</div></li><li><div>        $css = preg_replace('/' . self::CLASSCOLON . '/', ':', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // retain space for special IE6 cases&nbsp;</div></li><li><div>        $css = preg_replace_callback('/\:first\-(line|letter)(\{|, )/i', array($this, 'lowercase_pseudo_first'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // no space after the end of a preserved comment&nbsp;</div></li><li><div>        $css = preg_replace('/\*\/ /', '*/', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // lowercase some popular @directives&nbsp;</div></li><li><div>        $css = preg_replace_callback('/@(font-face|import|(?:-(?:atsc|khtml|moz|ms|o|wap|webkit)-)?keyframe|media|page|namespace)/i', array($this, 'lowercase_directives'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // lowercase some more common pseudo-elements&nbsp;</div></li><li><div>        $css = preg_replace_callback('/:(active|after|before|checked|disabled|empty|enabled|first-(?:child|of-type)|focus|hover|last-(?:child|of-type)|link|only-(?:child|of-type)|root|:selection|target|visited)/i', array($this, 'lowercase_pseudo_elements'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // lowercase some more common functions&nbsp;</div></li><li><div>        $css = preg_replace_callback('/:(lang|not|nth-child|nth-last-child|nth-last-of-type|nth-of-type|(?:-(?:moz|webkit)-)?any)\(/i', array($this, 'lowercase_common_functions'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // lower case some common function that can be values&nbsp;</div></li><li><div>        // NOTE: rgb() isn't useful as we replace with #hex later, as well as and() is already done for us&nbsp;</div></li><li><div>        $css = preg_replace_callback('/([:, \( ]\s*)(attr|color-stop|from|rgba|to|url|(?:-(?:atsc|khtml|moz|ms|o|wap|webkit)-)?(?:calc|max|min|(?:repeating-)?(?:linear|radial)-gradient)|-webkit-gradient)/iS', array($this, 'lowercase_common_functions_values'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Put the space back in some cases, to support stuff like&nbsp;</div></li><li><div>        // @media screen and (-webkit-min-device-pixel-ratio:0) {&nbsp;</div></li><li><div>        $css = preg_replace('/\band\(/i', 'and (', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove the spaces after the things that should not have spaces after them.&nbsp;</div></li><li><div>        $css = preg_replace('/([\!\{\}\:;\&gt;\+\(\[\~\=, ])\s+/S', '$1', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove unnecessary semicolons&nbsp;</div></li><li><div>        $css = preg_replace('/;+\}/', '}', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fix for issue: #2528146&nbsp;</div></li><li><div>        // Restore semicolon if the last property is prefixed with a `*` (lte IE7 hack)&nbsp;</div></li><li><div>        // to avoid issues on Symbian S60 3.x browsers.&nbsp;</div></li><li><div>        $css = preg_replace('/(\*[a-z0-9\-]+\s*\:[^;\}]+)(\})/', '$1;$2', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Replace 0 &lt;length&gt; and 0 &lt;percentage&gt; values with 0.&nbsp;</div></li><li><div>        // &lt;length&gt; data type: https://developer.mozilla.org/en-US/docs/Web/CSS/length&nbsp;</div></li><li><div>        // &lt;percentage&gt; data type: https://developer.mozilla.org/en-US/docs/Web/CSS/percentage&nbsp;</div></li><li><div>        $css = preg_replace('/([^\\\\]\:|\s)0(?:em|ex|ch|rem|vw|vh|vm|vmin|cm|mm|in|px|pt|pc|%)/iS', '${1}0', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // 0% step in a keyframe? restore the % unit&nbsp;</div></li><li><div>        $css = preg_replace_callback('/(@[a-z\-]*?keyframes[^\{]+\{)(.*?)(\}\})/iS', array($this, 'replace_keyframe_zero'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Replace 0 0; or 0 0 0; or 0 0 0 0; with 0.&nbsp;</div></li><li><div>        $css = preg_replace('/\:0(?: 0) {1, 3}(;|\}| \!)/', ':0$1', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fix for issue: #2528142&nbsp;</div></li><li><div>        // Replace text-shadow:0; with text-shadow:0 0 0;&nbsp;</div></li><li><div>        $css = preg_replace('/(text-shadow\:0)(;|\}| \!)/i', '$1 0 0$2', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Replace background-position:0; with background-position:0 0;&nbsp;</div></li><li><div>        // same for transform-origin&nbsp;</div></li><li><div>        // Changing -webkit-mask-position: 0 0 to just a single 0 will result in the second parameter defaulting to 50% (center)&nbsp;</div></li><li><div>        $css = preg_replace('/(background\-position|webkit-mask-position|(?:webkit|moz|o|ms|)\-?transform\-origin)\:0(;|\}| \!)/iS', '$1:0 0$2', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Shorten colors from rgb(51, 102, 153) to #336699, rgb(100%, 0%, 0%) to #ff0000 (sRGB color space)&nbsp;</div></li><li><div>        // Shorten colors from hsl(0, 100%, 50%) to #ff0000 (sRGB color space)&nbsp;</div></li><li><div>        // This makes it more likely that it'll get further compressed in the next step.&nbsp;</div></li><li><div>        $css = preg_replace_callback('/rgb\s*\(\s*([0-9, \s\-\.\%]+)\s*\)(.{1})/i', array($this, 'rgb_to_hex'), $css);&nbsp;</div></li><li><div>        $css = preg_replace_callback('/hsl\s*\(\s*([0-9, \s\-\.\%]+)\s*\)(.{1})/i', array($this, 'hsl_to_hex'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Shorten colors from #AABBCC to #ABC or short color name.&nbsp;</div></li><li><div>        $css = $this-&gt;compress_hex_colors($css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // border: none to border:0, outline: none to outline:0&nbsp;</div></li><li><div>        $css = preg_replace('/(border\-?(?:top|right|bottom|left|)|outline)\:none(;|\}| \!)/iS', '$1:0$2', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // shorter opacity IE filter&nbsp;</div></li><li><div>        $css = preg_replace('/progid\:DXImageTransform\.Microsoft\.Alpha\(Opacity\=/i', 'alpha(opacity=', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Find a fraction that is used for Opera's -o-device-pixel-ratio query&nbsp;</div></li><li><div>        // Add token to add the &quot;\&quot; back in later&nbsp;</div></li><li><div>        $css = preg_replace('/\(([a-z\-]+):([0-9]+)\/([0-9]+)\)/i', '($1:$2'. self::QUERY_FRACTION .'$3)', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove empty rules.&nbsp;</div></li><li><div>        $css = preg_replace('/[^\};\{\/]+\{\}/S', '', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add &quot;/&quot; back to fix Opera -o-device-pixel-ratio query&nbsp;</div></li><li><div>        $css = preg_replace('/'. self::QUERY_FRACTION .'/', '/', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Replace multiple semi-colons in a row by a single one&nbsp;</div></li><li><div>        // See SF bug #1980989&nbsp;</div></li><li><div>        $css = preg_replace('/;;+/', ';', $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Restore new lines for /*! important comments&nbsp;</div></li><li><div>        $css = preg_replace('/'. self::NL .'/', &quot;\n&quot;, $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Lowercase all uppercase properties&nbsp;</div></li><li><div>        $css = preg_replace_callback('/(\{|\;)([A-Z\-]+)(\:)/', array($this, 'lowercase_properties'), $css);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Some source control tools don't like it when files containing lines longer&nbsp;</div></li><li><div>        // than, say 8000 characters, are checked in. The linebreak option is used in&nbsp;</div></li><li><div>        // that case to split long lines after a specific column.&nbsp;</div></li><li><div>        if ($linebreak_pos !== FALSE && (int) $linebreak_pos &gt;= 0) {&nbsp;</div></li><li><div>            $linebreak_pos = (int) $linebreak_pos;&nbsp;</div></li><li><div>            $start_index = $i = 0;&nbsp;</div></li><li><div>            while ($i &lt; strlen($css)) {&nbsp;</div></li><li><div>                $i++;&nbsp;</div></li><li><div>                if ($css[$i - 1] === '}' && $i - $start_index &gt; $linebreak_pos) {&nbsp;</div></li><li><div>                    $css = $this-&gt;str_slice($css, 0, $i) . &quot;\n&quot; . $this-&gt;str_slice($css, $i);&nbsp;</div></li><li><div>                    $start_index = $i;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // restore preserved comments and strings in reverse order&nbsp;</div></li><li><div>        for ($i = count($this-&gt;preserved_tokens) - 1; $i &gt;= 0; $i--) {&nbsp;</div></li><li><div>            $css = preg_replace('/' . self::TOKEN . $i . '___/', $this-&gt;preserved_tokens[$i], $css, 1);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Trim the final string (for any leading or trailing white spaces)&nbsp;</div></li><li><div>        return trim($css);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Utility method to replace all data urls with tokens before we start&nbsp;</div></li><li><div>     * compressing, to avoid performance issues running some of the subsequent&nbsp;</div></li><li><div>     * regexes against large strings chunks.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $css&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function extract_data_urls($css)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Leave data urls alone to increase parse performance.&nbsp;</div></li><li><div>        $max_index = strlen($css) - 1;&nbsp;</div></li><li><div>        $append_index = $index = $last_index = $offset = 0;&nbsp;</div></li><li><div>        $sb = array();&nbsp;</div></li><li><div>        $pattern = '/url\(\s*([&quot;\']?)data\:/i';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Since we need to account for non-base64 data urls, we need to handle&nbsp;</div></li><li><div>        // ' and ) being part of the data string. Hence switching to indexOf, &nbsp;</div></li><li><div>        // to determine whether or not we have matching string terminators and&nbsp;</div></li><li><div>        // handling sb appends directly, instead of using matcher.append* methods.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (preg_match($pattern, $css, $m, 0, $offset)) {&nbsp;</div></li><li><div>            $index = $this-&gt;index_of($css, $m[0], $offset);&nbsp;</div></li><li><div>            $last_index = $index + strlen($m[0]);&nbsp;</div></li><li><div>            $start_index = $index + 4; // &quot;url(&quot;.length()&nbsp;</div></li><li><div>            $end_index = $last_index - 1;&nbsp;</div></li><li><div>            $terminator = $m[1]; // ', &quot; or empty (not quoted)&nbsp;</div></li><li><div>            $found_terminator = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (strlen($terminator) === 0) {&nbsp;</div></li><li><div>                $terminator = ')';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            while ($found_terminator === FALSE && $end_index+1 &lt;= $max_index) {&nbsp;</div></li><li><div>                $end_index = $this-&gt;index_of($css, $terminator, $end_index + 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // endIndex == 0 doesn't really apply here&nbsp;</div></li><li><div>                if ($end_index &gt; 0 && substr($css, $end_index - 1, 1) !== '\\') {&nbsp;</div></li><li><div>                    $found_terminator = TRUE;&nbsp;</div></li><li><div>                    if (')' != $terminator) {&nbsp;</div></li><li><div>                        $end_index = $this-&gt;index_of($css, ')', $end_index);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Enough searching, start moving stuff over to the buffer&nbsp;</div></li><li><div>            $sb[] = $this-&gt;str_slice($css, $append_index, $index);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($found_terminator) {&nbsp;</div></li><li><div>                $token = $this-&gt;str_slice($css, $start_index, $end_index);&nbsp;</div></li><li><div>                $token = preg_replace('/\s+/', '', $token);&nbsp;</div></li><li><div>                $this-&gt;preserved_tokens[] = $token;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $preserver = 'url(' . self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___)';&nbsp;</div></li><li><div>                $sb[] = $preserver;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $append_index = $end_index + 1;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // No end terminator found, re-add the whole match. Should we throw/warn here?&nbsp;</div></li><li><div>                $sb[] = $this-&gt;str_slice($css, $index, $last_index);&nbsp;</div></li><li><div>                $append_index = $last_index;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $offset = $last_index;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sb[] = $this-&gt;str_slice($css, $append_index);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return implode('', $sb);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Utility method to compress hex color values of the form #AABBCC to #ABC or short color name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * DOES NOT compress CSS ID selectors which match the above pattern (which would break things).&nbsp;</div></li><li><div>     * e.g. #AddressForm { ... }&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * DOES NOT compress IE filters, which have hex color values (which would break things).&nbsp;</div></li><li><div>     * e.g. filter: chroma(color=&quot;#FFFFFF&quot;);&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * DOES NOT compress invalid hex values.&nbsp;</div></li><li><div>     * e.g. background-color: #aabbccdd&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $css&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function compress_hex_colors($css)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Look for hex colors inside { ... } (to avoid IDs) and which don't have a =, or a &quot; in front of them (to avoid filters)&nbsp;</div></li><li><div>        $pattern = '/(\=\s*?[&quot;\']?)?#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])(\}|[^0-9a-f{][^{]*?\})/iS';&nbsp;</div></li><li><div>        $_index = $index = $last_index = $offset = 0;&nbsp;</div></li><li><div>        $sb = array();&nbsp;</div></li><li><div>        // See: http://ajaxmin.codeplex.com/wikipage?title=CSS%20Colors&nbsp;</div></li><li><div>        $short_safe = array(&nbsp;</div></li><li><div>            '#808080' =&gt; 'gray', &nbsp;</div></li><li><div>            '#008000' =&gt; 'green', &nbsp;</div></li><li><div>            '#800000' =&gt; 'maroon', &nbsp;</div></li><li><div>            '#000080' =&gt; 'navy', &nbsp;</div></li><li><div>            '#808000' =&gt; 'olive', &nbsp;</div></li><li><div>            '#ffa500' =&gt; 'orange', &nbsp;</div></li><li><div>            '#800080' =&gt; 'purple', &nbsp;</div></li><li><div>            '#c0c0c0' =&gt; 'silver', &nbsp;</div></li><li><div>            '#008080' =&gt; 'teal', &nbsp;</div></li><li><div>            '#f00' =&gt; 'red'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (preg_match($pattern, $css, $m, 0, $offset)) {&nbsp;</div></li><li><div>            $index = $this-&gt;index_of($css, $m[0], $offset);&nbsp;</div></li><li><div>            $last_index = $index + strlen($m[0]);&nbsp;</div></li><li><div>            $is_filter = $m[1] !== null && $m[1] !== '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sb[] = $this-&gt;str_slice($css, $_index, $index);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($is_filter) {&nbsp;</div></li><li><div>                // Restore, maintain case, otherwise filter will break&nbsp;</div></li><li><div>                $sb[] = $m[1] . '#' . $m[2] . $m[3] . $m[4] . $m[5] . $m[6] . $m[7];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if (strtolower($m[2]) == strtolower($m[3]) &&&nbsp;</div></li><li><div>                    strtolower($m[4]) == strtolower($m[5]) &&&nbsp;</div></li><li><div>                    strtolower($m[6]) == strtolower($m[7])) {&nbsp;</div></li><li><div>                    // Compress.&nbsp;</div></li><li><div>                    $hex = '#' . strtolower($m[3] . $m[5] . $m[7]);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // Non compressible color, restore but lower case.&nbsp;</div></li><li><div>                    $hex = '#' . strtolower($m[2] . $m[3] . $m[4] . $m[5] . $m[6] . $m[7]);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // replace Hex colors to short safe color names&nbsp;</div></li><li><div>                $sb[] = array_key_exists($hex, $short_safe) ? $short_safe[$hex] : $hex;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $_index = $offset = $last_index - strlen($m[8]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sb[] = $this-&gt;str_slice($css, $_index);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return implode('', $sb);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** CALLBACKS&nbsp;</div></li><li><div>     * ---------------------------------------------------------------------------------------------&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function replace_string($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $match = $matches[0];&nbsp;</div></li><li><div>        $quote = substr($match, 0, 1);&nbsp;</div></li><li><div>        // Must use addcslashes in PHP to avoid parsing of backslashes&nbsp;</div></li><li><div>        $match = addcslashes($this-&gt;str_slice($match, 1, -1), '\\');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // maybe the string contains a comment-like substring?&nbsp;</div></li><li><div>        // one, maybe more? put'em back then&nbsp;</div></li><li><div>        if (($pos = $this-&gt;index_of($match, self::COMMENT)) &gt;= 0) {&nbsp;</div></li><li><div>            for ($i = 0, $max = count($this-&gt;comments); $i &lt; $max; $i++) {&nbsp;</div></li><li><div>                $match = preg_replace('/' . self::COMMENT . $i . '___/', $this-&gt;comments[$i], $match, 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // minify alpha opacity in filter strings&nbsp;</div></li><li><div>        $match = preg_replace('/progid\:DXImageTransform\.Microsoft\.Alpha\(Opacity\=/i', 'alpha(opacity=', $match);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;preserved_tokens[] = $match;&nbsp;</div></li><li><div>        return $quote . self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___' . $quote;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function replace_colon($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return preg_replace('/\:/', self::CLASSCOLON, $matches[0]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function replace_calc($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;preserved_tokens[] = trim(preg_replace('/\s*([\*\/\(\), ])\s*/', '$1', $matches[2]));&nbsp;</div></li><li><div>        return 'calc('. self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___' . ')';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function preserve_old_IE_specific_matrix_definition($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;preserved_tokens[] = $matches[1];&nbsp;</div></li><li><div>        return 'filter:progid:DXImageTransform.Microsoft.Matrix(' . self::TOKEN . (count($this-&gt;preserved_tokens) - 1) . '___' . ')';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function replace_keyframe_zero($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $matches[1] . preg_replace('/0(\{|, [^\)\{]+\{)/', '0%$1', $matches[2]) . $matches[3];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function rgb_to_hex($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Support for percentage values rgb(100%, 0%, 45%);&nbsp;</div></li><li><div>        if ($this-&gt;index_of($matches[1], '%') &gt;= 0) {&nbsp;</div></li><li><div>            $rgbcolors = explode(', ', str_replace('%', '', $matches[1]));&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; count($rgbcolors); $i++) {&nbsp;</div></li><li><div>                $rgbcolors[$i] = $this-&gt;round_number(floatval($rgbcolors[$i]) * 2.55);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $rgbcolors = explode(', ', $matches[1]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Values outside the sRGB color space should be clipped (0-255)&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; count($rgbcolors); $i++) {&nbsp;</div></li><li><div>            $rgbcolors[$i] = $this-&gt;clamp_number(intval($rgbcolors[$i], 10), 0, 255);&nbsp;</div></li><li><div>            $rgbcolors[$i] = sprintf(&quot;%02x&quot;, $rgbcolors[$i]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fix for issue #2528093&nbsp;</div></li><li><div>        if (!preg_match('/[\s\, \);\}]/', $matches[2])) {&nbsp;</div></li><li><div>            $matches[2] = ' ' . $matches[2];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return '#' . implode('', $rgbcolors) . $matches[2];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function hsl_to_hex($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $values = explode(', ', str_replace('%', '', $matches[1]));&nbsp;</div></li><li><div>        $h = floatval($values[0]);&nbsp;</div></li><li><div>        $s = floatval($values[1]);&nbsp;</div></li><li><div>        $l = floatval($values[2]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Wrap and clamp, then fraction!&nbsp;</div></li><li><div>        $h = ((($h % 360) + 360) % 360) / 360;&nbsp;</div></li><li><div>        $s = $this-&gt;clamp_number($s, 0, 100) / 100;&nbsp;</div></li><li><div>        $l = $this-&gt;clamp_number($l, 0, 100) / 100;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($s == 0) {&nbsp;</div></li><li><div>            $r = $g = $b = $this-&gt;round_number(255 * $l);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $v2 = $l &lt; 0.5 ? $l * (1 + $s) : ($l + $s) - ($s * $l);&nbsp;</div></li><li><div>            $v1 = (2 * $l) - $v2;&nbsp;</div></li><li><div>            $r = $this-&gt;round_number(255 * $this-&gt;hue_to_rgb($v1, $v2, $h + (1/3)));&nbsp;</div></li><li><div>            $g = $this-&gt;round_number(255 * $this-&gt;hue_to_rgb($v1, $v2, $h));&nbsp;</div></li><li><div>            $b = $this-&gt;round_number(255 * $this-&gt;hue_to_rgb($v1, $v2, $h - (1/3)));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;rgb_to_hex(array('', $r.', '.$g.', '.$b, $matches[2]));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function lowercase_pseudo_first($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return ':first-'. strtolower($matches[1]) .' '. $matches[2];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function lowercase_directives($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return '@'. strtolower($matches[1]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function lowercase_pseudo_elements($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return ':'. strtolower($matches[1]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function lowercase_common_functions($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return ':'. strtolower($matches[1]) .'(';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function lowercase_common_functions_values($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $matches[1] . strtolower($matches[2]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function lowercase_properties($matches)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $matches[1].strtolower($matches[2]).$matches[3];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** HELPERS&nbsp;</div></li><li><div>     * ---------------------------------------------------------------------------------------------&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function hue_to_rgb($v1, $v2, $vh)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $vh = $vh &lt; 0 ? $vh + 1 : ($vh &gt; 1 ? $vh - 1 : $vh);&nbsp;</div></li><li><div>        if ($vh * 6 &lt; 1) return $v1 + ($v2 - $v1) * 6 * $vh;&nbsp;</div></li><li><div>        if ($vh * 2 &lt; 1) return $v2;&nbsp;</div></li><li><div>        if ($vh * 3 &lt; 2) return $v1 + ($v2 - $v1) * ((2/3) - $vh) * 6;&nbsp;</div></li><li><div>        return $v1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function round_number($n)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return intval(floor(floatval($n) + 0.5), 10);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function clamp_number($n, $min, $max)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return min(max($n, $min), $max);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * PHP port of Javascript's &quot;indexOf&quot; function for strings only&nbsp;</div></li><li><div>     * Author: Tubal Martin http://blog.margenn.com&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $haystack&nbsp;</div></li><li><div>     * @param string $needle&nbsp;</div></li><li><div>     * @param int    $offset index (optional)&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function index_of($haystack, $needle, $offset = 0)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $index = strpos($haystack, $needle, $offset);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($index !== FALSE) ? $index : -1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * PHP port of Javascript's &quot;slice&quot; function for strings only&nbsp;</div></li><li><div>     * Author: Tubal Martin http://blog.margenn.com&nbsp;</div></li><li><div>     * Tests: http://margenn.com/tubal/str_slice/&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string   $str&nbsp;</div></li><li><div>     * @param int      $start index&nbsp;</div></li><li><div>     * @param int|bool $end index (optional)&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function str_slice($str, $start = 0, $end = FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($end !== FALSE && ($start &lt; 0 || $end &lt;= 0)) {&nbsp;</div></li><li><div>            $max = strlen($str);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($start &lt; 0) {&nbsp;</div></li><li><div>                if (($start = $max + $start) &lt; 0) {&nbsp;</div></li><li><div>                    return '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($end &lt; 0) {&nbsp;</div></li><li><div>                if (($end = $max + $end) &lt; 0) {&nbsp;</div></li><li><div>                    return '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($end &lt;= $start) {&nbsp;</div></li><li><div>                return '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $slice = ($end === FALSE) ? substr($str, $start) : substr($str, $start, $end - $start);&nbsp;</div></li><li><div>        return ($slice === FALSE) ? '' : $slice;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert strings like &quot;64M&quot; or &quot;30&quot; to int values&nbsp;</div></li><li><div>     * @param mixed $size&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function normalize_int($size)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (is_string($size)) {&nbsp;</div></li><li><div>            switch (substr($size, -1)) {&nbsp;</div></li><li><div>                case 'M': case 'm': return $size * 1048576;&nbsp;</div></li><li><div>                case 'K': case 'k': return $size * 1024;&nbsp;</div></li><li><div>                case 'G': case 'g': return $size * 1073741824;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return (int) $size;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.4.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.1/classes/a3_cssmin/" class="active">1.6.1</a></li><li><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.6.0/classes/a3_cssmin/" class="">1.6.0</a></li><li><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.5.1/classes/a3_cssmin/" class="">1.5.1</a></li><li><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.5.0/classes/a3_cssmin/" class="">1.5.0</a></li><li><a href="http://hookr.io/plugins/woocommerce-products-quick-view/1.4.1/classes/a3_cssmin/" class="">1.4.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>a3_CSSmin</li><li><span></span>WooCommerce Products Quick View</li><li><span></span>1.6.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>