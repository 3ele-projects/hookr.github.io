<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.6" data-slug="pods-custom-content-types-and-fields" data-type="class" data-id="59387"><head xmlns="http://www.w3.org/1999/xhtml"><title> podsdata | class | Pods Custom Content Types And Fields | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PodsData, class, plugin, pods-custom-content-types-and-fields, 2.6" /><meta name="description" content="The Pods - Custom Content Types and Fields PodsData class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=4d21dc5b3212307689c0f52bf215b3f7' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pods_data/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpods_data%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpods_data%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-pods-custom-content-types-and-fields-2.6-class-pods_data","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pods_data" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to pods-custom-content-types-and&hellip;." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/" class="plugin"><span property="name">pods-custom-content-types-and&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.6." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/" class="H_VERSION"><span property="name">2.6</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pods_data</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="726"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/all/" title="All">All <span class="count badge">726</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="474"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/hooks/" title="Hooks">Hooks <span class="count badge">474</span></a></li><li class="" data-id="action" data-count="109"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/actions/" title="Actions">Actions <span class="count badge">109</span></a></li><li class="" data-id="filter" data-count="365"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/filters/" title="Filters">Filters <span class="count badge">365</span></a></li><li class="active" data-id="class" data-count="70"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/classes/" title="Classes">Classes <span class="count badge">70</span></a></li><li class="" data-id="constant" data-count="18"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/constants/" title="Constants">Constants <span class="count badge">18</span></a></li><li class="" data-id="function" data-count="156"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/functions/" title="Functions">Functions <span class="count badge">156</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PodsData</strong></h1><p>The Pods - Custom Content Types and Fields <strong>PodsData</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/files/classes-podsdata/" class="file">/classes/PodsData.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="5" class="block" start="5"><li><div>class PodsData {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var PodsData&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static $instance = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static protected $prefix = 'pods_';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static protected $field_types = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static $display_errors = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var PodsAPI&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $api = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $select = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $table = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $pod = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array|bool|mixed|null|void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $pod_data = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $field_id = 'id';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $field_index = 'name';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $field_slug = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $join = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $where = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $where_default = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $orderby = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $aliases = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $detail_page;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // data&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $row_number = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $row;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $insert_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $total;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $total_found;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $total_found_calculated;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // pagination&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $page_var = 'pg';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $page = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $limit = 15;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $pagination = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // search&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $search = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $search_var = 'search';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $search_mode = 'int'; // int | text | text_like&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $search_query = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $search_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $search_where = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $filters = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds Traversal information about Pods&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $traversal = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds custom Traversals to be included&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $traverse = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Last select() query SQL&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $sql = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Last total sql&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $total_sql = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Singleton handling for a basic pods_data() request&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $pod Pod name&nbsp;</div></li><li><div>     * @param integer $id Pod Item ID&nbsp;</div></li><li><div>     * @param bool $strict If true throws an error if a pod is not found.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return \PodsData&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function init ( $pod = null, $id = 0, $strict = true ) {&nbsp;</div></li><li><div>        if ( ( true !== $pod && null !== $pod ) || 0 != $id )&nbsp;</div></li><li><div>            return new PodsData( $pod, $id, $strict );&nbsp;</div></li><li><div>        elseif ( !is_object( self::$instance ) )&nbsp;</div></li><li><div>            self::$instance = new PodsData();&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $vars = get_class_vars( __CLASS__ );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $vars as $var =&gt; $default ) {&nbsp;</div></li><li><div>                if ( 'api' == $var )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                self::$instance-&gt;{$var} = $default;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::$instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Data Abstraction Class for Pods&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $pod Pod name&nbsp;</div></li><li><div>     * @param integer $id Pod Item ID&nbsp;</div></li><li><div>     * @param bool $strict If true throws an error if a pod is not found.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return \PodsData&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @license http://www.gnu.org/licenses/gpl-2.0.html&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct ( $pod = null, $id = 0, $strict = true ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $pod ) && 'PodsAPI' == get_class( $pod ) ) {&nbsp;</div></li><li><div>            $this-&gt;api = $pod;&nbsp;</div></li><li><div>            $pod = $this-&gt;api-&gt;pod;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $this-&gt;api = pods_api( $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;api-&gt;display_errors =& self::$display_errors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod ) ) {&nbsp;</div></li><li><div>            $this-&gt;pod_data =& $this-&gt;api-&gt;pod_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === $this-&gt;pod_data ) {&nbsp;</div></li><li><div>                if ( true === $strict )&nbsp;</div></li><li><div>                    return pods_error( 'Pod not found', $this );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    return $this;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;pod_id = $this-&gt;pod_data[ 'id' ];&nbsp;</div></li><li><div>            $this-&gt;pod = $this-&gt;pod_data[ 'name' ];&nbsp;</div></li><li><div>            $this-&gt;fields = $this-&gt;pod_data[ 'fields' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'options' ][ 'detail_url' ] ) )&nbsp;</div></li><li><div>                $this-&gt;detail_page = $this-&gt;pod_data[ 'options' ][ 'detail_url' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'select' ] ) )&nbsp;</div></li><li><div>                $this-&gt;select = $this-&gt;pod_data[ 'select' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'table' ] ) )&nbsp;</div></li><li><div>                $this-&gt;table = $this-&gt;pod_data[ 'table' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'join' ] ) )&nbsp;</div></li><li><div>                $this-&gt;join = $this-&gt;pod_data[ 'join' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'field_id' ] ) )&nbsp;</div></li><li><div>                $this-&gt;field_id = $this-&gt;pod_data[ 'field_id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'field_index' ] ) )&nbsp;</div></li><li><div>                $this-&gt;field_index = $this-&gt;pod_data[ 'field_index' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'field_slug' ] ) )&nbsp;</div></li><li><div>                $this-&gt;field_slug = $this-&gt;pod_data[ 'field_slug' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'where' ] ) )&nbsp;</div></li><li><div>                $this-&gt;where = $this-&gt;pod_data[ 'where' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'where_default' ] ) )&nbsp;</div></li><li><div>                $this-&gt;where_default = $this-&gt;pod_data[ 'where_default' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'orderby' ] ) )&nbsp;</div></li><li><div>                $this-&gt;orderby = $this-&gt;pod_data[ 'orderby' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'settings' == $this-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                $this-&gt;id = $this-&gt;pod_data[ 'id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;fetch( $this-&gt;id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( null !== $id && !is_array( $id ) && !is_object( $id ) ) {&nbsp;</div></li><li><div>                $this-&gt;id = $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;fetch( $this-&gt;id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle tables like they are Pods (for traversal in select/build)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|string $table&nbsp;</div></li><li><div>     * @param string $object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function table ( $table, $object = '' ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $table ) ) {&nbsp;</div></li><li><div>            $object_type = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $wpdb-&gt;users == $table )&nbsp;</div></li><li><div>                $object_type = 'user';&nbsp;</div></li><li><div>            elseif ( $wpdb-&gt;posts == $table )&nbsp;</div></li><li><div>                $object_type = 'post_type';&nbsp;</div></li><li><div>            elseif ( $wpdb-&gt;terms == $table )&nbsp;</div></li><li><div>                $object_type = 'taxonomy';&nbsp;</div></li><li><div>            elseif ( $wpdb-&gt;options == $table )&nbsp;</div></li><li><div>                $object_type = 'settings';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $object_type ) )&nbsp;</div></li><li><div>            $table = $this-&gt;api-&gt;get_table_info( $object_type, $object );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $table ) && is_array( $table ) ) {&nbsp;</div></li><li><div>            $table[ 'id' ] = pods_var( 'id', $table[ 'pod' ], 0, null, true );&nbsp;</div></li><li><div>            $table[ 'name' ] = pods_var( 'name', $table[ 'pod' ], $table[ 'object_type' ], null, true );&nbsp;</div></li><li><div>            $table[ 'type' ] = pods_var_raw( 'type', $table[ 'pod' ], $table[ 'object_type' ], null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $default_storage = 'meta';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'taxonomy' == $table[ 'type' ] && ! function_exists( 'get_term_meta' ) ) {&nbsp;</div></li><li><div>                $default_storage = 'none';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $table[ 'storage' ] = pods_var_raw( 'storage', $table[ 'pod' ], $default_storage, null, true );&nbsp;</div></li><li><div>            $table[ 'fields' ] = pods_var_raw( 'fields', $table[ 'pod' ], array() );&nbsp;</div></li><li><div>            $table[ 'object_fields' ] = pods_var_raw( 'object_fields', $table[ 'pod' ], $this-&gt;api-&gt;get_wp_object_fields( $table[ 'object_type' ] ), null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;pod_data = $table;&nbsp;</div></li><li><div>            $this-&gt;pod_id = $this-&gt;pod_data[ 'id' ];&nbsp;</div></li><li><div>            $this-&gt;pod = $this-&gt;pod_data[ 'name' ];&nbsp;</div></li><li><div>            $this-&gt;fields = $this-&gt;pod_data[ 'fields' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'select' ] ) )&nbsp;</div></li><li><div>                $this-&gt;select = $this-&gt;pod_data[ 'select' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'table' ] ) )&nbsp;</div></li><li><div>                $this-&gt;table = $this-&gt;pod_data[ 'table' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'join' ] ) )&nbsp;</div></li><li><div>                $this-&gt;join = $this-&gt;pod_data[ 'join' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'field_id' ] ) )&nbsp;</div></li><li><div>                $this-&gt;field_id = $this-&gt;pod_data[ 'field_id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'field_index' ] ) )&nbsp;</div></li><li><div>                $this-&gt;field_index = $this-&gt;pod_data[ 'field_index' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'field_slug' ] ) )&nbsp;</div></li><li><div>                $this-&gt;field_slug = $this-&gt;pod_data[ 'field_slug' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'where' ] ) )&nbsp;</div></li><li><div>                $this-&gt;where = $this-&gt;pod_data[ 'where' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'where_default' ] ) )&nbsp;</div></li><li><div>                $this-&gt;where_default = $this-&gt;pod_data[ 'where_default' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;pod_data[ 'orderby' ] ) )&nbsp;</div></li><li><div>                $this-&gt;orderby = $this-&gt;pod_data[ 'orderby' ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Insert an item, eventually mapping to WPDB::insert&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     * @param array $data Data to insert (in column =&gt; value pairs). Both $data columns and $data values should be &quot;raw&quot; (neither should be SQL escaped).&nbsp;</div></li><li><div>     * @param array $format (optional) An array of formats to be mapped to each of the value in $data.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int|bool The ID of the item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses wpdb::insert&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function insert ( $table, $data, $format = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( strlen( $table ) &lt; 1 || empty( $data ) || !is_array( $data ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $format ) ) {&nbsp;</div></li><li><div>            $format = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $data as $field ) {&nbsp;</div></li><li><div>                if ( isset( self::$field_types[ $field ] ) )&nbsp;</div></li><li><div>                    $format[] = self::$field_types[ $field ];&nbsp;</div></li><li><div>                elseif ( isset( $wpdb-&gt;field_types[ $field ] ) )&nbsp;</div></li><li><div>                    $format[] = $wpdb-&gt;field_types[ $field ];&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        list( $table, $data, $format ) = $this-&gt;do_hook( 'insert', array( $table, $data, $format ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $wpdb-&gt;insert( $table, $data, $format );&nbsp;</div></li><li><div>        $this-&gt;insert_id = $wpdb-&gt;insert_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $result )&nbsp;</div></li><li><div>            return $this-&gt;insert_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Insert into a table, if unique key exists just update values.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Data must be a key value pair array, keys act as table rows.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Returns the prepared query from wpdb or false for errors&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Name of the table to update&nbsp;</div></li><li><div>     * @param array $data column =&gt; value pairs&nbsp;</div></li><li><div>     * @param array $formats For $wpdb-&gt;prepare, uses sprintf formatting&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed Sanitized query string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses wpdb::prepare&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function insert_on_duplicate ( $table, $data, $formats = array() ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $columns = array_keys( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $update = array();&nbsp;</div></li><li><div>        $values = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $columns as $column ) {&nbsp;</div></li><li><div>            $update[] = &quot;`{$column}` = VALUES( `{$column}` )&quot;;&nbsp;</div></li><li><div>            $values[] = &quot;%s&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $formats ) )&nbsp;</div></li><li><div>            $formats = $values;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $columns_data = implode( '`, `', $columns );&nbsp;</div></li><li><div>        $formats = implode( &quot;, &quot;, $formats );&nbsp;</div></li><li><div>        $update = implode( ', ', $update );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;INSERT INTO `{$table}` ( `{$columns_data}` ) VALUES ( {$formats} ) ON DUPLICATE KEY UPDATE {$update}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $wpdb-&gt;prepare( $sql, $data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update an item, eventually mapping to WPDB::update&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     * @param array $data Data to update (in column =&gt; value pairs). Both $data columns and $data values should be &quot;raw&quot; (neither should be SQL escaped).&nbsp;</div></li><li><div>     * @param array $where A named array of WHERE clauses (in column =&gt; value pairs). Multiple clauses will be joined with ANDs. Both $where columns and $where values should be &quot;raw&quot;.&nbsp;</div></li><li><div>     * @param array $format (optional) An array of formats to be mapped to each of the values in $data.&nbsp;</div></li><li><div>     * @param array $where_format (optional) An array of formats to be mapped to each of the values in $where.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function update ( $table, $data, $where, $format = null, $where_format = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( strlen( $table ) &lt; 1 || empty( $data ) || !is_array( $data ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $format ) ) {&nbsp;</div></li><li><div>            $format = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $data as $field ) {&nbsp;</div></li><li><div>                if ( isset( self::$field_types[ $field ] ) )&nbsp;</div></li><li><div>                    $form = self::$field_types[ $field ];&nbsp;</div></li><li><div>                elseif ( isset( $wpdb-&gt;field_types[ $field ] ) )&nbsp;</div></li><li><div>                    $form = $wpdb-&gt;field_types[ $field ];&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $form = '%s';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $format[] = $form;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $where_format ) ) {&nbsp;</div></li><li><div>            $where_format = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( (array) array_keys( $where ) as $field ) {&nbsp;</div></li><li><div>                if ( isset( self::$field_types[ $field ] ) )&nbsp;</div></li><li><div>                    $form = self::$field_types[ $field ];&nbsp;</div></li><li><div>                elseif ( isset( $wpdb-&gt;field_types[ $field ] ) )&nbsp;</div></li><li><div>                    $form = $wpdb-&gt;field_types[ $field ];&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $form = '%s';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $where_format[] = $form;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        list( $table, $data, $where, $format, $where_format ) = $this-&gt;do_hook( 'update', array(&nbsp;</div></li><li><div>            $table, &nbsp;</div></li><li><div>            $data, &nbsp;</div></li><li><div>            $where, &nbsp;</div></li><li><div>            $format, &nbsp;</div></li><li><div>            $where_format&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $wpdb-&gt;update( $table, $data, $where, $format, $where_format );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $result )&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete an item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     * @param array $where A named array of WHERE clauses (in column =&gt; value pairs). Multiple clauses will be joined with ANDs. Both $where columns and $where values should be &quot;raw&quot;.&nbsp;</div></li><li><div>     * @param array $where_format (optional) An array of formats to be mapped to each of the values in $where.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|null|void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsData::query&nbsp;</div></li><li><div>     * @uses PodsData::prepare&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete ( $table, $where, $where_format = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( strlen( $table ) &lt; 1 || empty( $where ) || !is_array( $where ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wheres = array();&nbsp;</div></li><li><div>        $where_formats = $where_format = (array) $where_format;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( (array) array_keys( $where ) as $field ) {&nbsp;</div></li><li><div>            if ( !empty( $where_format ) )&nbsp;</div></li><li><div>                $form = ( $form = array_shift( $where_formats ) ) ? $form : $where_format[ 0 ];&nbsp;</div></li><li><div>            elseif ( isset( self::$field_types[ $field ] ) )&nbsp;</div></li><li><div>                $form = self::$field_types[ $field ];&nbsp;</div></li><li><div>            elseif ( isset( $wpdb-&gt;field_types[ $field ] ) )&nbsp;</div></li><li><div>                $form = $wpdb-&gt;field_types[ $field ];&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $form = '%s';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $wheres[] = &quot;`{$field}` = {$form}&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;DELETE FROM `$table` WHERE &quot; . implode( ' AND ', $wheres );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        list( $sql, $where ) = $this-&gt;do_hook( 'delete', array(&nbsp;</div></li><li><div>            $sql, &nbsp;</div></li><li><div>            array_values( $where )&nbsp;</div></li><li><div> ), $table, $where, $where_format, $wheres );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;query( self::prepare( $sql, $where ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Select items, eventually building dynamic query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function select ( $params ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cache_key = $results = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = apply_filters( 'pods_data_pre_select_params', $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Debug purposes&nbsp;</div></li><li><div>        if ( 1 == pods_v( 'pods_debug_params', 'get', 0 ) && pods_is_admin( array( 'pods' ) ) )&nbsp;</div></li><li><div>            pods_debug( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get from cache if enabled&nbsp;</div></li><li><div>        if ( null !== pods_v( 'expires', $params, null, false ) ) {&nbsp;</div></li><li><div>            $cache_key = md5( (string) $this-&gt;pod . serialize( $params ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $results = pods_view_get( $cache_key, pods_v( 'cache_mode', $params, 'cache', true ), 'pods_data_select' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $results ) )&nbsp;</div></li><li><div>                $results = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $results ) ) {&nbsp;</div></li><li><div>            // Build&nbsp;</div></li><li><div>            $this-&gt;sql = $this-&gt;build( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Debug purposes&nbsp;</div></li><li><div>            if ( ( 1 == pods_v( 'pods_debug_sql', 'get', 0 ) || 1 == pods_v( 'pods_debug_sql_all', 'get', 0 ) ) && pods_is_admin( array( 'pods' ) ) )&nbsp;</div></li><li><div>                echo '&lt;textarea cols=&quot;100&quot; rows=&quot;24&quot;&gt;' . esc_textarea( str_replace( array( '@wp_users', '@wp_' ), array( $wpdb-&gt;users, $wpdb-&gt;prefix ), $this-&gt;sql ) ) . '&lt;/textarea&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $this-&gt;sql ) )&nbsp;</div></li><li><div>                return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get Data&nbsp;</div></li><li><div>            $results = pods_query( $this-&gt;sql, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Cache if enabled&nbsp;</div></li><li><div>            if ( false !== $cache_key )&nbsp;</div></li><li><div>                pods_view_set( $cache_key, $results, pods_v( 'expires', $params, 0, false ), pods_v( 'cache_mode', $params, 'cache', true ), 'pods_data_select' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $results = apply_filters( 'pods_data_select', $results, $params, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;data = $results;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;row_number = -1;&nbsp;</div></li><li><div>        $this-&gt;row = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fill in empty field data (if none provided)&nbsp;</div></li><li><div>        if ( ( !isset( $this-&gt;fields ) || empty( $this-&gt;fields ) ) && !empty( $this-&gt;data ) ) {&nbsp;</div></li><li><div>            $this-&gt;fields = array();&nbsp;</div></li><li><div>            $data = (array) @current( $this-&gt;data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $data as $data_key =&gt; $data_value ) {&nbsp;</div></li><li><div>                $this-&gt;fields[ $data_key ] = array( 'label' =&gt; ucwords( str_replace( '-', ' ', str_replace( '_', ' ', $data_key ) ) ) );&nbsp;</div></li><li><div>                if ( isset( $this-&gt;pod_data[ 'object_fields' ][ $data_key ] ) ) {&nbsp;</div></li><li><div>                    $this-&gt;fields[ $data_key ] = $this-&gt;pod_data[ 'object_fields' ][ $data_key ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;fields = PodsForm::fields_setup( $this-&gt;fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;total_found_calculated = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;total = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;data ) ) {&nbsp;</div></li><li><div>            $this-&gt;total = count( (array) $this-&gt;data );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function calculate_totals () {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set totals&nbsp;</div></li><li><div>        if ( false !== $this-&gt;total_sql )&nbsp;</div></li><li><div>            $total = @current( $wpdb-&gt;get_col( $this-&gt;get_sql( $this-&gt;total_sql ) ) );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $total = @current( $wpdb-&gt;get_col( &quot;SELECT FOUND_ROWS()&quot; ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $total = $this-&gt;do_hook( 'select_total', $total );&nbsp;</div></li><li><div>        $this-&gt;total_found = 0;&nbsp;</div></li><li><div>        $this-&gt;total_found_calculated = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_numeric( $total ) )&nbsp;</div></li><li><div>            $this-&gt;total_found = $total;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Build/Rewrite dynamic SQL and handle search/filter/sort&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|mixed|string&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function build ( $params ) {&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>        $file_field_types = PodsForm::file_field_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'select' =&gt; '*', &nbsp;</div></li><li><div>            'calc_rows' =&gt; false, &nbsp;</div></li><li><div>            'distinct' =&gt; true, &nbsp;</div></li><li><div>            'table' =&gt; null, &nbsp;</div></li><li><div>            'join' =&gt; null, &nbsp;</div></li><li><div>            'where' =&gt; null, &nbsp;</div></li><li><div>            'groupby' =&gt; null, &nbsp;</div></li><li><div>            'having' =&gt; null, &nbsp;</div></li><li><div>            'orderby' =&gt; null, &nbsp;</div></li><li><div>            'limit' =&gt; -1, &nbsp;</div></li><li><div>            'offset' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'id' =&gt; null, &nbsp;</div></li><li><div>            'index' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'page' =&gt; 1, &nbsp;</div></li><li><div>            'pagination' =&gt; $this-&gt;pagination, &nbsp;</div></li><li><div>            'search' =&gt; $this-&gt;search, &nbsp;</div></li><li><div>            'search_query' =&gt; null, &nbsp;</div></li><li><div>            'search_mode' =&gt; null, &nbsp;</div></li><li><div>            'search_across' =&gt; false, &nbsp;</div></li><li><div>            'search_across_picks' =&gt; false, &nbsp;</div></li><li><div>            'search_across_files' =&gt; false, &nbsp;</div></li><li><div>            'filters' =&gt; array(), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'fields' =&gt; array(), &nbsp;</div></li><li><div>            'object_fields' =&gt; array(), &nbsp;</div></li><li><div>            'pod_table_prefix' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'traverse' =&gt; array(), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'sql' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'strict' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) array_merge( $defaults, (array) $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 &lt; strlen( $params-&gt;sql ) )&nbsp;</div></li><li><div>            return $params-&gt;sql;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $this-&gt;pod_data ) ) {&nbsp;</div></li><li><div>            $pod = $this-&gt;pod_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Validate&nbsp;</div></li><li><div>        $params-&gt;page = pods_absint( $params-&gt;page );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;pagination = (boolean) $params-&gt;pagination;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 == $params-&gt;page || !$params-&gt;pagination )&nbsp;</div></li><li><div>            $params-&gt;page = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;limit = (int) $params-&gt;limit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 == $params-&gt;limit )&nbsp;</div></li><li><div>            $params-&gt;limit = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;limit = $params-&gt;limit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $offset = ( $params-&gt;limit * ( $params-&gt;page - 1 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 &lt; (int) $params-&gt;offset )&nbsp;</div></li><li><div>            $params-&gt;offset += $offset;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params-&gt;offset = $offset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$params-&gt;pagination || -1 == $params-&gt;limit ) {&nbsp;</div></li><li><div>            $params-&gt;page = 1;&nbsp;</div></li><li><div>            $params-&gt;offset = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( empty( $params-&gt;fields ) || !is_array( $params-&gt;fields ) ) && !empty( $pod ) && isset( $this-&gt;fields ) && !empty( $this-&gt;fields ) )&nbsp;</div></li><li><div>            $params-&gt;fields = $this-&gt;fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( empty( $params-&gt;object_fields ) || !is_array( $params-&gt;object_fields ) ) && !empty( $pod ) && isset( $pod[ 'object_fields' ] ) && !empty( $pod[ 'object_fields' ] ) )&nbsp;</div></li><li><div>            $params-&gt;object_fields = $pod[ 'object_fields' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;filters ) && $params-&gt;search )&nbsp;</div></li><li><div>            $params-&gt;filters = array_keys( $params-&gt;fields );&nbsp;</div></li><li><div>        elseif ( empty( $params-&gt;filters ) )&nbsp;</div></li><li><div>            $params-&gt;filters = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;index ) )&nbsp;</div></li><li><div>            $params-&gt;index = $this-&gt;field_index;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;id ) )&nbsp;</div></li><li><div>            $params-&gt;id = $this-&gt;field_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;table ) && !empty( $pod ) && isset( $this-&gt;table ) && !empty( $this-&gt;table ) )&nbsp;</div></li><li><div>            $params-&gt;table = $this-&gt;table;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;pod_table_prefix ) )&nbsp;</div></li><li><div>            $params-&gt;pod_table_prefix = 't';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod ) && !in_array( $pod[ 'type' ], array( 'pod', 'table' ) ) && 'table' == $pod[ 'storage' ] )&nbsp;</div></li><li><div>            $params-&gt;pod_table_prefix = 'd';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;meta_fields = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod ) && !in_array( $pod[ 'type' ], array( 'pod', 'table' ) ) && ( 'meta' == $pod[ 'storage' ] || ( 'none' == $pod[ 'storage' ] && function_exists( 'get_term_meta' ) ) ) )&nbsp;</div></li><li><div>            $params-&gt;meta_fields = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;table ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === strpos( $params-&gt;table, '(' ) && false === strpos( $params-&gt;table, '`' ) )&nbsp;</div></li><li><div>            $params-&gt;table = '`' . $params-&gt;table . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;join ) )&nbsp;</div></li><li><div>            $params-&gt;join = array_merge( (array) $this-&gt;join, (array) $params-&gt;join );&nbsp;</div></li><li><div>        elseif ( false === $params-&gt;strict )&nbsp;</div></li><li><div>            $params-&gt;join = $this-&gt;join;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;where_defaulted = false;&nbsp;</div></li><li><div>        $params-&gt;where_default = $this-&gt;where_default;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $params-&gt;strict ) {&nbsp;</div></li><li><div>            // Set default where&nbsp;</div></li><li><div>            if ( !empty( $this-&gt;where_default ) && empty( $params-&gt;where ) ) {&nbsp;</div></li><li><div>                $params-&gt;where = array_values( (array) $this-&gt;where_default );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $params-&gt;where_defaulted = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $this-&gt;where ) ) {&nbsp;</div></li><li><div>                if ( is_array( $params-&gt;where ) && isset( $params-&gt;where[ 'relation' ] ) && 'OR' == strtoupper( $params-&gt;where[ 'relation' ] ) ) {&nbsp;</div></li><li><div>                    $params-&gt;where = array_merge( array( $params-&gt;where ), array_values( (array) $this-&gt;where ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $params-&gt;where = array_merge( (array) $params-&gt;where, array_values( (array) $this-&gt;where ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow where array ( 'field' =&gt; 'value' ) and WP_Query meta_query syntax&nbsp;</div></li><li><div>        if ( ! empty( $params-&gt;where ) ) {&nbsp;</div></li><li><div>            $params-&gt;where = $this-&gt;query_fields( (array) $params-&gt;where, $pod, $params );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;where ) ) {&nbsp;</div></li><li><div>            $params-&gt;where = array();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $params-&gt;where = (array) $params-&gt;where;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow having array ( 'field' =&gt; 'value' ) and WP_Query meta_query syntax&nbsp;</div></li><li><div>        if ( ! empty( $params-&gt;having ) ) {&nbsp;</div></li><li><div>            $params-&gt;having = $this-&gt;query_fields( (array) $params-&gt;having, $pod, $params );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;having ) ) {&nbsp;</div></li><li><div>            $params-&gt;having = array();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $params-&gt;having = (array) $params-&gt;having;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;orderby ) ) {&nbsp;</div></li><li><div>            if ( 'post_type' == $pod[ 'type' ] && 'meta' == $pod[ 'storage' ] && is_array( $params-&gt;orderby ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $params-&gt;orderby as $i =&gt; $orderby ) {&nbsp;</div></li><li><div>                    if ( strpos( $orderby, '.meta_value_num' ) ) {&nbsp;</div></li><li><div>                        $params-&gt;orderby[ $i ] = 'CAST(' . str_replace( '.meta_value_num', '.meta_value', $orderby ) . ' AS DECIMAL)';&nbsp;</div></li><li><div>                    } elseif ( strpos( $orderby, '.meta_value_date' ) ) {&nbsp;</div></li><li><div>                        $params-&gt;orderby[ $i ] = 'CAST(' . str_replace( '.meta_value_date', '.meta_value', $orderby ) . ' AS DATE)';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;orderby = (array) $params-&gt;orderby;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $params-&gt;orderby = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $params-&gt;strict && !empty( $this-&gt;orderby ) )&nbsp;</div></li><li><div>            $params-&gt;orderby = array_merge( $params-&gt;orderby, (array) $this-&gt;orderby );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;traverse ) )&nbsp;</div></li><li><div>            $this-&gt;traverse = $params-&gt;traverse;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $allowed_search_modes = array( 'int', 'text', 'text_like' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;search_mode ) && in_array( $params-&gt;search_mode, $allowed_search_modes ) )&nbsp;</div></li><li><div>            $this-&gt;search_mode = $params-&gt;search_mode;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;search = (boolean) $params-&gt;search;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 1 == pods_v( 'pods_debug_params_all', 'get', 0 ) && pods_is_admin( array( 'pods' ) ) )&nbsp;</div></li><li><div>            pods_debug( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;field_table_alias = 't';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get Aliases for future reference&nbsp;</div></li><li><div>        $selectsfound = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;select ) ) {&nbsp;</div></li><li><div>            if ( is_array( $params-&gt;select ) )&nbsp;</div></li><li><div>                $selectsfound = implode( ', ', $params-&gt;select );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $selectsfound = $params-&gt;select;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Pull Aliases from SQL query too&nbsp;</div></li><li><div>        if ( null !== $params-&gt;sql ) {&nbsp;</div></li><li><div>            $temp_sql = ' ' . trim( str_replace( array( &quot;\n&quot;, &quot;\r&quot; ), ' ', $params-&gt;sql ) );&nbsp;</div></li><li><div>            $temp_sql = preg_replace( array(&nbsp;</div></li><li><div>                    '/\sSELECT\sSQL_CALC_FOUND_ROWS\s/i', &nbsp;</div></li><li><div>                    '/\sSELECT\s/i'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    ' SELECT ', &nbsp;</div></li><li><div>                    ' SELECT SQL_CALC_FOUND_ROWS '&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                $temp_sql );&nbsp;</div></li><li><div>            preg_match( '/\sSELECT SQL_CALC_FOUND_ROWS\s(.*)\sFROM/i', $temp_sql, $selectmatches );&nbsp;</div></li><li><div>            if ( isset( $selectmatches[ 1 ] ) && !empty( $selectmatches[ 1 ] ) && false !== stripos( $selectmatches[ 1 ], ' AS ' ) )&nbsp;</div></li><li><div>                $selectsfound .= ( !empty( $selectsfound ) ? ', ' : '' ) . $selectmatches[ 1 ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Build Alias list&nbsp;</div></li><li><div>        $this-&gt;aliases = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $selectsfound ) && false !== stripos( $selectsfound, ' AS ' ) ) {&nbsp;</div></li><li><div>            $theselects = array_filter( explode( ', ', $selectsfound ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $theselects ) )&nbsp;</div></li><li><div>                $theselects = array_filter( explode( ', ', $selectsfound ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $theselects as $selected ) {&nbsp;</div></li><li><div>                $selected = trim( $selected );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( strlen( $selected ) &lt; 1 )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $selectfield = explode( ' AS ', str_replace( ' as ', ' AS ', $selected ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 2 == count( $selectfield ) ) {&nbsp;</div></li><li><div>                    $field = trim( trim( $selectfield[ 1 ] ), '`' );&nbsp;</div></li><li><div>                    $real_field = trim( trim( $selectfield[ 0 ] ), '`' );&nbsp;</div></li><li><div>                    $this-&gt;aliases[ $field ] = $real_field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Search&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;search ) && !empty( $params-&gt;fields ) ) {&nbsp;</div></li><li><div>            if ( false !== $params-&gt;search_query && 0 &lt; strlen( $params-&gt;search_query ) ) {&nbsp;</div></li><li><div>                $where = $having = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false !== $params-&gt;search_across ) {&nbsp;</div></li><li><div>                    foreach ( $params-&gt;fields as $key =&gt; $field ) {&nbsp;</div></li><li><div>                        if ( is_array( $field ) ) {&nbsp;</div></li><li><div>                            $attributes = $field;&nbsp;</div></li><li><div>                            $field = pods_v( 'name', $field, $key, true );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else {&nbsp;</div></li><li><div>                            $attributes = array(&nbsp;</div></li><li><div>                                'type' =&gt; '', &nbsp;</div></li><li><div>                                'options' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( isset( $attributes[ 'options' ][ 'search' ] ) && !$attributes[ 'options' ][ 'search' ] )&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( in_array( $attributes[ 'type' ], array( 'date', 'time', 'datetime', 'number', 'decimal', 'currency', 'phone', 'password', 'boolean' ) ) )&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $fieldfield = '`' . $field . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( 'pick' == $attributes[ 'type' ] && !in_array( pods_v( 'pick_object', $attributes ), $simple_tableless_objects ) ) {&nbsp;</div></li><li><div>                            if ( false === $params-&gt;search_across_picks )&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            else {&nbsp;</div></li><li><div>                                if ( empty( $attributes[ 'table_info' ] ) )&nbsp;</div></li><li><div>                                    $attributes[ 'table_info' ] = $this-&gt;api-&gt;get_table_info( pods_v( 'pick_object', $attributes ), pods_v( 'pick_val', $attributes ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ( empty( $attributes[ 'table_info' ][ 'field_index' ] ) )&nbsp;</div></li><li><div>                                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $fieldfield = $fieldfield . '.`' . $attributes[ 'table_info' ][ 'field_index' ] . '`';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif ( in_array( $attributes[ 'type' ], $file_field_types ) ) {&nbsp;</div></li><li><div>                            if ( false === $params-&gt;search_across_files )&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $fieldfield = $fieldfield . '.`post_title`';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif ( isset( $params-&gt;fields[ $field ] ) ) {&nbsp;</div></li><li><div>                            if ( $params-&gt;meta_fields )&nbsp;</div></li><li><div>                                $fieldfield = $fieldfield . '.`' . $params-&gt;pod_table_prefix . '`';&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $fieldfield = '`' . $params-&gt;pod_table_prefix . '`.' . $fieldfield;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif ( !empty( $params-&gt;object_fields ) && !isset( $params-&gt;object_fields[ $field ] ) && 'meta' == $pod['storage'] )&nbsp;</div></li><li><div>                            $fieldfield = $fieldfield . '.`meta_value`';&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $fieldfield = '`t`.' . $fieldfield;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( isset( $this-&gt;aliases[ $field ] ) )&nbsp;</div></li><li><div>                            $fieldfield = '`' . $this-&gt;aliases[ $field ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( !empty( $attributes[ 'real_name' ] ) )&nbsp;</div></li><li><div>                            $fieldfield = $attributes[ 'real_name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( isset( $attributes[ 'group_related' ] ) && false !== $attributes[ 'group_related' ] )&nbsp;</div></li><li><div>                            $having[] = &quot;{$fieldfield} LIKE '%&quot; . pods_sanitize_like( $params-&gt;search_query ) . &quot;%'&quot;;&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $where[] = &quot;{$fieldfield} LIKE '%&quot; . pods_sanitize_like( $params-&gt;search_query ) . &quot;%'&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( !empty( $params-&gt;index ) ) {&nbsp;</div></li><li><div>                    $attributes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $fieldfield = '`t`.`' . $params-&gt;index . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $params-&gt;fields[ $params-&gt;index ] ) ) {&nbsp;</div></li><li><div>                        if ( $params-&gt;meta_fields )&nbsp;</div></li><li><div>                            $fieldfield = '`' . $params-&gt;index . '`.`' . $params-&gt;pod_table_prefix . '`';&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $fieldfield = '`' . $params-&gt;pod_table_prefix . '`.`' . $params-&gt;index . '`';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif ( !empty( $params-&gt;object_fields ) && !isset( $params-&gt;object_fields[ $params-&gt;index ] ) && 'meta' == $pod['storage'] )&nbsp;</div></li><li><div>                        $fieldfield = '`' . $params-&gt;index . '`.`meta_value`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $attributes[ 'real_name' ] ) && false !== $attributes[ 'real_name' ] && !empty( $attributes[ 'real_name' ] ) )&nbsp;</div></li><li><div>                        $fieldfield = $attributes[ 'real_name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $attributes[ 'group_related' ] ) && false !== $attributes[ 'group_related' ] )&nbsp;</div></li><li><div>                        $having[] = &quot;{$fieldfield} LIKE '%&quot; . pods_sanitize_like( $params-&gt;search_query ) . &quot;%'&quot;;&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $where[] = &quot;{$fieldfield} LIKE '%&quot; . pods_sanitize_like( $params-&gt;search_query ) . &quot;%'&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $where ) )&nbsp;</div></li><li><div>                    $params-&gt;where[] = '( ' . implode( ' OR ', $where ) . ' )';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $having ) )&nbsp;</div></li><li><div>                    $params-&gt;having[] = '( ' . implode( ' OR ', $having ) . ' )';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Filter&nbsp;</div></li><li><div>            foreach ( $params-&gt;filters as $filter ) {&nbsp;</div></li><li><div>                $where = $having = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !isset( $params-&gt;fields[ $filter ] ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $attributes = $params-&gt;fields[ $filter ];&nbsp;</div></li><li><div>                $field = pods_v( 'name', $attributes, $filter, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $filterfield = '`' . $field . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'pick' == $attributes[ 'type' ] && !in_array( pods_v( 'pick_object', $attributes ), $simple_tableless_objects ) ) {&nbsp;</div></li><li><div>                    if ( empty( $attributes[ 'table_info' ] ) )&nbsp;</div></li><li><div>                        $attributes[ 'table_info' ] = $this-&gt;api-&gt;get_table_info( pods_v( 'pick_object', $attributes ), pods_v( 'pick_val', $attributes ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $attributes[ 'table_info' ][ 'field_index' ] ) )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $filterfield = $filterfield . '.`' . $attributes[ 'table_info' ][ 'field_index' ] . '`';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( in_array( $attributes[ 'type' ], $file_field_types ) )&nbsp;</div></li><li><div>                    $filterfield = $filterfield . '.`post_title`';&nbsp;</div></li><li><div>                elseif ( isset( $params-&gt;fields[ $field ] ) ) {&nbsp;</div></li><li><div>                    if ( $params-&gt;meta_fields && 'meta' == $pod['storage'] )&nbsp;</div></li><li><div>                        $filterfield = $filterfield . '.`meta_value`';&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $filterfield = '`' . $params-&gt;pod_table_prefix . '`.' . $filterfield;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( !empty( $params-&gt;object_fields ) && !isset( $params-&gt;object_fields[ $field ] ) && 'meta' == $pod['storage'] )&nbsp;</div></li><li><div>                    $filterfield = $filterfield . '.`meta_value`';&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $filterfield = '`t`.' . $filterfield;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $this-&gt;aliases[ $field ] ) )&nbsp;</div></li><li><div>                    $filterfield = '`' . $this-&gt;aliases[ $field ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $attributes[ 'real_name' ] ) )&nbsp;</div></li><li><div>                    $filterfield = $attributes[ 'real_name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'pick' == $attributes[ 'type' ] ) {&nbsp;</div></li><li><div>                    $filter_value = pods_v( 'filter_' . $field, 'get' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !is_array( $filter_value ) )&nbsp;</div></li><li><div>                        $filter_value = (array) $filter_value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $filter_value as $filter_v ) {&nbsp;</div></li><li><div>                        if ( in_array( pods_v( 'pick_object', $attributes ), $simple_tableless_objects ) ) {&nbsp;</div></li><li><div>                            if ( strlen( $filter_v ) &lt; 1 )&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( isset( $attributes[ 'group_related' ] ) && false !== $attributes[ 'group_related' ] ) {&nbsp;</div></li><li><div>                                $having[] = &quot;( {$filterfield} = '&quot; . pods_sanitize( $filter_v ) . &quot;'&quot;&nbsp;</div></li><li><div>                                             . &quot; OR {$filterfield} LIKE '%\&quot;&quot; . pods_sanitize_like( $filter_v ) . &quot;\&quot;%' )&quot;;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else {&nbsp;</div></li><li><div>                                $where[] = &quot;( {$filterfield} = '&quot; . pods_sanitize( $filter_v ) . &quot;'&quot;&nbsp;</div></li><li><div>                                            . &quot; OR {$filterfield} LIKE '%\&quot;&quot; . pods_sanitize_like( $filter_v ) . &quot;\&quot;%' )&quot;;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else {&nbsp;</div></li><li><div>                            $filter_v = (int) $filter_v;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( empty( $filter_v ) || empty( $attributes[ 'table_info' ] ) || empty( $attributes[ 'table_info' ][ 'field_id' ] ) )&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $filterfield = '`' . $field . '`.`' . $attributes[ 'table_info' ][ 'field_id' ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( isset( $attributes[ 'group_related' ] ) && false !== $attributes[ 'group_related' ] )&nbsp;</div></li><li><div>                                $having[] = &quot;{$filterfield} = &quot; . $filter_v;&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $where[] = &quot;{$filterfield} = &quot; . $filter_v;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( in_array( $attributes[ 'type' ], array( 'date', 'datetime' ) ) ) {&nbsp;</div></li><li><div>                    $start_value = pods_v( 'filter_' . $field . '_start', 'get', false );&nbsp;</div></li><li><div>                    $end_value = pods_v( 'filter_' . $field . '_end', 'get', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $start_value ) && empty( $end_value ) )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $start_value ) )&nbsp;</div></li><li><div>                        $start = date_i18n( 'Y-m-d', strtotime( $start_value ) ) . ( 'datetime' == $attributes[ 'type' ] ? ' 00:00:00' : '' );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $start = date_i18n( 'Y-m-d' ) . ( 'datetime' == $attributes[ 'type' ] ) ? ' 00:00:00' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $end_value ) )&nbsp;</div></li><li><div>                        $end = date_i18n( 'Y-m-d', strtotime( $end_value ) ) . ( 'datetime' == $attributes[ 'type' ] ? ' 23:59:59' : '' );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $end = date_i18n( 'Y-m-d' ) . ( 'datetime' == $attributes[ 'type' ] ) ? ' 23:59:59' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $attributes[ 'date_ongoing' ] ) && true === $attributes[ 'date_ongoing' ] ) {&nbsp;</div></li><li><div>                        $date_ongoing = '`' . $attributes[ 'date_ongoing' ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( isset( $this-&gt;aliases[ $date_ongoing ] ) )&nbsp;</div></li><li><div>                            $date_ongoing = '`' . $this-&gt;aliases[ $date_ongoing ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( isset( $attributes[ 'group_related' ] ) && false !== $attributes[ 'group_related' ] )&nbsp;</div></li><li><div>                            $having[] = &quot;(({$filterfield} &lt;= '$start' OR ({$filterfield} &gt;= '$start' AND {$filterfield} &lt;= '$end')) AND ({$date_ongoing} &gt;= '$start' OR ({$date_ongoing} &gt;= '$start' AND {$date_ongoing} &lt;= '$end')))&quot;;&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $where[] = &quot;(({$filterfield} &lt;= '$start' OR ({$filterfield} &gt;= '$start' AND {$filterfield} &lt;= '$end')) AND ({$date_ongoing} &gt;= '$start' OR ({$date_ongoing} &gt;= '$start' AND {$date_ongoing} &lt;= '$end')))&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        if ( isset( $attributes[ 'group_related' ] ) && false !== $attributes[ 'group_related' ] )&nbsp;</div></li><li><div>                            $having[] = &quot;({$filterfield} BETWEEN '$start' AND '$end')&quot;;&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $where[] = &quot;({$filterfield} BETWEEN '$start' AND '$end')&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $filter_value = pods_v( 'filter_' . $field, 'get', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( strlen( $filter_value ) &lt; 1 )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $attributes[ 'group_related' ] ) && false !== $attributes[ 'group_related' ] )&nbsp;</div></li><li><div>                        $having[] = &quot;{$filterfield} LIKE '%&quot; . pods_sanitize_like( $filter_value ) . &quot;%'&quot;;&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $where[] = &quot;{$filterfield} LIKE '%&quot; . pods_sanitize_like( $filter_value ) . &quot;%'&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $where ) )&nbsp;</div></li><li><div>                    $params-&gt;where[] = implode( ' AND ', $where );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $having ) )&nbsp;</div></li><li><div>                    $params-&gt;having[] = implode( ' AND ', $having );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Traverse the Rabbit Hole&nbsp;</div></li><li><div>        if ( !empty( $this-&gt;pod ) ) {&nbsp;</div></li><li><div>            $haystack = implode( ' ', (array) $params-&gt;select )&nbsp;</div></li><li><div>                        . ' ' . implode( ' ', (array) $params-&gt;where )&nbsp;</div></li><li><div>                        . ' ' . implode( ' ', (array) $params-&gt;groupby )&nbsp;</div></li><li><div>                        . ' ' . implode( ' ', (array) $params-&gt;having )&nbsp;</div></li><li><div>                        . ' ' . implode( ' ', (array) $params-&gt;orderby );&nbsp;</div></li><li><div>            $haystack = preg_replace( '/\s/', ' ', $haystack );&nbsp;</div></li><li><div>            $haystack = preg_replace( '/\w\(/', ' ', $haystack );&nbsp;</div></li><li><div>            $haystack = str_replace( array( '(', ')', '  ', '\\\'', &quot;\\\&quot;&quot; ), ' ', $haystack );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            preg_match_all( '/`?[\w\-]+`?(?:\\.`?[\w\-]+`?)+(?=[^&quot;\']*(?:&quot;[^&quot;]*&quot;[^&quot;]*|\'[^\']*\'[^\']*)*$)/', $haystack, $found, PREG_PATTERN_ORDER );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $found = (array) @current( $found );&nbsp;</div></li><li><div>            $find = $replace = $traverse = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $found as $key =&gt; $value ) {&nbsp;</div></li><li><div>                $value = str_replace( '`', '', $value );&nbsp;</div></li><li><div>                $value = explode( '.', $value );&nbsp;</div></li><li><div>                $dot = $last_value = array_pop( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 't' == $value[ 0 ] )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                elseif ( array_key_exists( $value[ 0 ], $params-&gt;join ) )&nbsp;</div></li><li><div>                    // Don't traverse for tables we are already going to join&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                elseif ( 1 == count( $value ) && '' == preg_replace( '/[0-9]*/', '', $value[ 0 ] ) && '' == preg_replace( '/[0-9]*/', '', $last_value ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $found_value = str_replace( '`', '', $found[ $key ] );&nbsp;</div></li><li><div>                $found_value = '([`]{1}|\b)' . str_replace( '.', '[`]*\.[`]*', $found_value ) . '([`]{1}|\b)';&nbsp;</div></li><li><div>                $found_value = '/' . $found_value . '(?=[^&quot;\']*(?:&quot;[^&quot;]*&quot;[^&quot;]*|\'[^\']*\'[^\']*)*$)/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( in_array( $found_value, $find ) ) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $find[ $key ] = $found_value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( '*' != $dot )&nbsp;</div></li><li><div>                    $dot = '`' . $dot . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $replace[ $key ] = '`' . implode( '_', $value ) . '`.' . $dot;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $value[] = $last_value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !in_array( $value, $traverse ) )&nbsp;</div></li><li><div>                    $traverse[ $key ] = $value;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $this-&gt;traverse ) ) {&nbsp;</div></li><li><div>                foreach ( (array) $this-&gt;traverse as $key =&gt; $traverse ) {&nbsp;</div></li><li><div>                    $traverse = str_replace( '`', '', $traverse );&nbsp;</div></li><li><div>                    $already_found = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $traverse as $traversal ) {&nbsp;</div></li><li><div>                        if ( is_array( $traversal ) )&nbsp;</div></li><li><div>                            $traversal = implode( '.', $traversal );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( $traversal == $traverse ) {&nbsp;</div></li><li><div>                            $already_found = true;&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !$already_found )&nbsp;</div></li><li><div>                        $traverse[ 'traverse_' . $key ] = explode( '.', $traverse );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $joins = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $find ) ) {&nbsp;</div></li><li><div>                $params-&gt;select = preg_replace( $find, $replace, $params-&gt;select );&nbsp;</div></li><li><div>                $params-&gt;where = preg_replace( $find, $replace, $params-&gt;where );&nbsp;</div></li><li><div>                $params-&gt;groupby = preg_replace( $find, $replace, $params-&gt;groupby );&nbsp;</div></li><li><div>                $params-&gt;having = preg_replace( $find, $replace, $params-&gt;having );&nbsp;</div></li><li><div>                $params-&gt;orderby = preg_replace( $find, $replace, $params-&gt;orderby );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $traverse ) )&nbsp;</div></li><li><div>                    $joins = $this-&gt;traverse( $traverse, $params-&gt;fields, $params );&nbsp;</div></li><li><div>                elseif ( false !== $params-&gt;search )&nbsp;</div></li><li><div>                    $joins = $this-&gt;traverse( null, $params-&gt;fields, $params );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Traversal Search&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;search ) && !empty( $this-&gt;search_where ) )&nbsp;</div></li><li><div>            $params-&gt;where = array_merge( (array) $this-&gt;search_where, $params-&gt;where );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;join ) && !empty( $joins ) )&nbsp;</div></li><li><div>            $params-&gt;join = array_merge( $joins, (array) $params-&gt;join );&nbsp;</div></li><li><div>        elseif ( !empty( $joins ) )&nbsp;</div></li><li><div>            $params-&gt;join = $joins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Build&nbsp;</div></li><li><div>        if ( null === $params-&gt;sql ) {&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>                SELECT&nbsp;</div></li><li><div>                &quot; . ( $params-&gt;calc_rows ? 'SQL_CALC_FOUND_ROWS' : '' ) . &quot;&nbsp;</div></li><li><div>                &quot; . ( $params-&gt;distinct ? 'DISTINCT' : '' ) . &quot;&nbsp;</div></li><li><div>                &quot; . ( !empty( $params-&gt;select ) ? ( is_array( $params-&gt;select ) ? implode( ', ', $params-&gt;select ) : $params-&gt;select ) : '*' ) . &quot;&nbsp;</div></li><li><div>                FROM {$params-&gt;table} AS `t`&nbsp;</div></li><li><div>                &quot; . ( !empty( $params-&gt;join ) ? ( is_array( $params-&gt;join ) ? implode( &quot;\n                &quot;, $params-&gt;join ) : $params-&gt;join ) : '' ) . &quot;&nbsp;</div></li><li><div>                &quot; . ( !empty( $params-&gt;where ) ? 'WHERE ' . ( is_array( $params-&gt;where ) ? implode( ' AND ', $params-&gt;where ) : $params-&gt;where ) : '' ) . &quot;&nbsp;</div></li><li><div>                &quot; . ( !empty( $params-&gt;groupby ) ? 'GROUP BY ' . ( is_array( $params-&gt;groupby ) ? implode( ', ', $params-&gt;groupby ) : $params-&gt;groupby ) : '' ) . &quot;&nbsp;</div></li><li><div>                &quot; . ( !empty( $params-&gt;having ) ? 'HAVING ' . ( is_array( $params-&gt;having ) ? implode( ' AND  ', $params-&gt;having ) : $params-&gt;having ) : '' ) . &quot;&nbsp;</div></li><li><div>                &quot; . ( !empty( $params-&gt;orderby ) ? 'ORDER BY ' . ( is_array( $params-&gt;orderby ) ? implode( ', ', $params-&gt;orderby ) : $params-&gt;orderby ) : '' ) . &quot;&nbsp;</div></li><li><div>                &quot; . ( ( 0 &lt; $params-&gt;page && 0 &lt; $params-&gt;limit ) ? 'LIMIT ' . $params-&gt;offset . ', ' . ( $params-&gt;limit ) : '' ) . &quot;&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !$params-&gt;calc_rows ) {&nbsp;</div></li><li><div>                // Handle COUNT() SELECT&nbsp;</div></li><li><div>                $total_sql_select = &quot;COUNT( &quot; . ( $params-&gt;distinct ? 'DISTINCT `t`.`' . $params-&gt;id . '`' : '*' ) . &quot; )&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // If 'having' is set, we have to select all so it has access to anything it needs&nbsp;</div></li><li><div>                if ( ! empty( $params-&gt;having ) ) {&nbsp;</div></li><li><div>                    $total_sql_select .= ', ' . ( !empty( $params-&gt;select ) ? ( is_array( $params-&gt;select ) ? implode( ', ', $params-&gt;select ) : $params-&gt;select ) : '*' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;total_sql = &quot;&nbsp;</div></li><li><div>                    SELECT {$total_sql_select}&nbsp;</div></li><li><div>                    FROM {$params-&gt;table} AS `t`&nbsp;</div></li><li><div>                    &quot; . ( !empty( $params-&gt;join ) ? ( is_array( $params-&gt;join ) ? implode( &quot;\n                &quot;, $params-&gt;join ) : $params-&gt;join ) : '' ) . &quot;&nbsp;</div></li><li><div>                    &quot; . ( !empty( $params-&gt;where ) ? 'WHERE ' . ( is_array( $params-&gt;where ) ? implode( ' AND  ', $params-&gt;where ) : $params-&gt;where ) : '' ) . &quot;&nbsp;</div></li><li><div>                    &quot; . ( !empty( $params-&gt;groupby ) ? 'GROUP BY ' . ( is_array( $params-&gt;groupby ) ? implode( ', ', $params-&gt;groupby ) : $params-&gt;groupby ) : '' ) . &quot;&nbsp;</div></li><li><div>                    &quot; . ( !empty( $params-&gt;having ) ? 'HAVING ' . ( is_array( $params-&gt;having ) ? implode( ' AND  ', $params-&gt;having ) : $params-&gt;having ) : '' ) . &quot;&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Rewrite&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $sql = ' ' . trim( str_replace( array( &quot;\n&quot;, &quot;\r&quot; ), ' ', $params-&gt;sql ) );&nbsp;</div></li><li><div>            $sql = preg_replace( array(&nbsp;</div></li><li><div>                    '/\sSELECT\sSQL_CALC_FOUND_ROWS\s/i', &nbsp;</div></li><li><div>                    '/\sSELECT\s/i'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    ' SELECT ', &nbsp;</div></li><li><div>                    ' SELECT SQL_CALC_FOUND_ROWS '&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Insert variables based on existing statements&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%SELECT%%' ) )&nbsp;</div></li><li><div>                $sql = preg_replace( '/\sSELECT\sSQL_CALC_FOUND_ROWS\s/i', ' SELECT SQL_CALC_FOUND_ROWS %%SELECT%% ', $sql );&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%WHERE%%' ) )&nbsp;</div></li><li><div>                $sql = preg_replace( '/\sWHERE\s(?!.*\sWHERE\s)/i', ' WHERE %%WHERE%% ', $sql );&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%GROUPBY%%' ) )&nbsp;</div></li><li><div>                $sql = preg_replace( '/\sGROUP BY\s(?!.*\sGROUP BY\s)/i', ' GROUP BY %%GROUPBY%% ', $sql );&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%HAVING%%' ) )&nbsp;</div></li><li><div>                $sql = preg_replace( '/\sHAVING\s(?!.*\sHAVING\s)/i', ' HAVING %%HAVING%% ', $sql );&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%ORDERBY%%' ) )&nbsp;</div></li><li><div>                $sql = preg_replace( '/\sORDER BY\s(?!.*\sORDER BY\s)/i', ' ORDER BY %%ORDERBY%% ', $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Insert variables based on other existing statements&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%JOIN%%' ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' WHERE ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\sWHERE\s(?!.*\sWHERE\s)/i', ' %%JOIN%% WHERE ', $sql );&nbsp;</div></li><li><div>                elseif ( false !== stripos( $sql, ' GROUP BY ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\sGROUP BY\s(?!.*\sGROUP BY\s)/i', ' %%WHERE%% GROUP BY ', $sql );&nbsp;</div></li><li><div>                elseif ( false !== stripos( $sql, ' ORDER BY ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\ORDER BY\s(?!.*\ORDER BY\s)/i', ' %%WHERE%% ORDER BY ', $sql );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql .= ' %%JOIN%% ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%WHERE%%' ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' GROUP BY ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\sGROUP BY\s(?!.*\sGROUP BY\s)/i', ' %%WHERE%% GROUP BY ', $sql );&nbsp;</div></li><li><div>                elseif ( false !== stripos( $sql, ' ORDER BY ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\ORDER BY\s(?!.*\ORDER BY\s)/i', ' %%WHERE%% ORDER BY ', $sql );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql .= ' %%WHERE%% ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%GROUPBY%%' ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' HAVING ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\sHAVING\s(?!.*\sHAVING\s)/i', ' %%GROUPBY%% HAVING ', $sql );&nbsp;</div></li><li><div>                elseif ( false !== stripos( $sql, ' ORDER BY ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\ORDER BY\s(?!.*\ORDER BY\s)/i', ' %%GROUPBY%% ORDER BY ', $sql );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql .= ' %%GROUPBY%% ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%HAVING%%' ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' ORDER BY ' ) )&nbsp;</div></li><li><div>                    $sql = preg_replace( '/\ORDER BY\s(?!.*\ORDER BY\s)/i', ' %%HAVING%% ORDER BY ', $sql );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql .= ' %%HAVING%% ';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%ORDERBY%%' ) )&nbsp;</div></li><li><div>                $sql .= ' %%ORDERBY%% ';&nbsp;</div></li><li><div>            if ( false === stripos( $sql, '%%LIMIT%%' ) )&nbsp;</div></li><li><div>                $sql .= ' %%LIMIT%% ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Replace variables&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $params-&gt;select ) ) {&nbsp;</div></li><li><div>                if ( false === stripos( $sql, '%%SELECT%% FROM ' ) )&nbsp;</div></li><li><div>                    $sql = str_ireplace( '%%SELECT%%', $params-&gt;select . ', ', $sql );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql = str_ireplace( '%%SELECT%%', $params-&gt;select, $sql );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $params-&gt;join ) )&nbsp;</div></li><li><div>                $sql = str_ireplace( '%%JOIN%%', $params-&gt;join, $sql );&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $params-&gt;where ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' WHERE ' ) ) {&nbsp;</div></li><li><div>                    if ( false !== stripos( $sql, ' WHERE %%WHERE%% ' ) )&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%WHERE%%', $params-&gt;where . ' AND ', $sql );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%WHERE%%', ' AND ' . $params-&gt;where, $sql );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql = str_ireplace( '%%WHERE%%', ' WHERE ' . $params-&gt;where, $sql );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $params-&gt;groupby ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' GROUP BY ' ) ) {&nbsp;</div></li><li><div>                    if ( false !== stripos( $sql, ' GROUP BY %%GROUPBY%% ' ) )&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%GROUPBY%%', $params-&gt;groupby . ', ', $sql );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%GROUPBY%%', ', ' . $params-&gt;groupby, $sql );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql = str_ireplace( '%%GROUPBY%%', ' GROUP BY ' . $params-&gt;groupby, $sql );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $params-&gt;having ) && false !== stripos( $sql, ' GROUP BY ' ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' HAVING ' ) ) {&nbsp;</div></li><li><div>                    if ( false !== stripos( $sql, ' HAVING %%HAVING%% ' ) )&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%HAVING%%', $params-&gt;having . ' AND ', $sql );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%HAVING%%', ' AND ' . $params-&gt;having, $sql );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql = str_ireplace( '%%HAVING%%', ' HAVING ' . $params-&gt;having, $sql );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $params-&gt;orderby ) ) {&nbsp;</div></li><li><div>                if ( false !== stripos( $sql, ' ORDER BY ' ) ) {&nbsp;</div></li><li><div>                    if ( false !== stripos( $sql, ' ORDER BY %%ORDERBY%% ' ) )&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%ORDERBY%%', $params-&gt;groupby . ', ', $sql );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $sql = str_ireplace( '%%ORDERBY%%', ', ' . $params-&gt;groupby, $sql );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $sql = str_ireplace( '%%ORDERBY%%', ' ORDER BY ' . $params-&gt;groupby, $sql );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( 0 &lt; $params-&gt;page && 0 &lt; $params-&gt;limit ) {&nbsp;</div></li><li><div>                $start = ( $params-&gt;page - 1 ) * $params-&gt;limit;&nbsp;</div></li><li><div>                $end = $start + $params-&gt;limit;&nbsp;</div></li><li><div>                $sql .= 'LIMIT ' . (int) $start . ', ' . (int) $end;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Clear any unused variables&nbsp;</div></li><li><div>            $sql = str_ireplace( array(&nbsp;</div></li><li><div>                '%%SELECT%%', &nbsp;</div></li><li><div>                '%%JOIN%%', &nbsp;</div></li><li><div>                '%%WHERE%%', &nbsp;</div></li><li><div>                '%%GROUPBY%%', &nbsp;</div></li><li><div>                '%%HAVING%%', &nbsp;</div></li><li><div>                '%%ORDERBY%%', &nbsp;</div></li><li><div>                '%%LIMIT%%'&nbsp;</div></li><li><div> ), '', $sql );&nbsp;</div></li><li><div>            $sql = str_replace( array( '``', '`' ), array( '  ', ' ' ), $sql );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $sql;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fetch the total row count returned&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Number of rows returned by select()&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function total () {&nbsp;</div></li><li><div>        return (int) $this-&gt;total;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fetch the total row count total&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Number of rows found by select()&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function total_found () {&nbsp;</div></li><li><div>        if(false === $this-&gt;total_found_calculated)&nbsp;</div></li><li><div>            $this-&gt;calculate_totals();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return (int) $this-&gt;total_found;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fetch the zebra state&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Zebra state&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     * @see PodsData::nth&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function zebra () {&nbsp;</div></li><li><div>        return $this-&gt;nth( 'odd' ); // Odd numbers&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fetch the nth state&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int|string $nth The $nth to match on the PodsData::row_number&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether $nth matches&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function nth ( $nth ) {&nbsp;</div></li><li><div>        if ( empty( $nth ) )&nbsp;</div></li><li><div>            $nth = 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $offset = 0;&nbsp;</div></li><li><div>        $negative = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'even' == $nth )&nbsp;</div></li><li><div>            $nth = 2;&nbsp;</div></li><li><div>        elseif ( 'odd' == $nth ) {&nbsp;</div></li><li><div>            $negative = true;&nbsp;</div></li><li><div>            $nth = 2;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( false !== strpos( $nth, '+' ) ) {&nbsp;</div></li><li><div>            $nth = explode( '+', $nth );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $nth[ 1 ] ) )&nbsp;</div></li><li><div>                $offset += (int) trim( $nth[ 1 ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $nth = (int) trim( $nth[ 0 ], ' n' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( false !== strpos( $nth, '-' ) ) {&nbsp;</div></li><li><div>            $nth = explode( '-', $nth );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $nth[ 1 ] ) )&nbsp;</div></li><li><div>                $offset -= (int) trim( $nth[ 1 ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $nth = (int) trim( $nth[ 0 ], ' n' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $nth = (int) $nth;&nbsp;</div></li><li><div>        $offset = (int) $offset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 == ( ( $this-&gt;row_number % $nth ) + $offset ) )&nbsp;</div></li><li><div>            return ( $negative ? false: true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ( $negative ? true : false );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fetch the current position in the loop (starting at 1)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Current row number (+1)&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function position () {&nbsp;</div></li><li><div>        return $this-&gt;row_number + 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create a Table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     * @param string $fields&nbsp;</div></li><li><div>     * @param boolean $if_not_exists Check if the table exists.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|null|void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsData::query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function table_create ( $table, $fields, $if_not_exists = false ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;CREATE TABLE&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true === $if_not_exists )&nbsp;</div></li><li><div>            $sql .= &quot; IF NOT EXISTS&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql .= &quot; `{$wpdb-&gt;prefix}&quot; . self::$prefix . &quot;{$table}` ({$fields})&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $wpdb-&gt;charset ) )&nbsp;</div></li><li><div>            $sql .= &quot; DEFAULT CHARACTER SET {$wpdb-&gt;charset}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $wpdb-&gt;collate ) )&nbsp;</div></li><li><div>            $sql .= &quot; COLLATE {$wpdb-&gt;collate}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::query( $sql );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Alter a Table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     * @param string $changes&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|null|void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsData::query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function table_alter ( $table, $changes ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;ALTER TABLE `{$wpdb-&gt;prefix}&quot; . self::$prefix . &quot;{$table}` {$changes}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::query( $sql );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Truncate a Table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|null|void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsData::query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function table_truncate ( $table ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;TRUNCATE TABLE `{$wpdb-&gt;prefix}&quot; . self::$prefix . &quot;{$table}`&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::query( $sql );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a Table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsData::query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|null|void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsData::query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function table_drop ( $table ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;DROP TABLE `{$wpdb-&gt;prefix}&quot; . self::$prefix . &quot;{$table}`&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::query( $sql );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reorder Items&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     * @param string $weight_field&nbsp;</div></li><li><div>     * @param string $id_field&nbsp;</div></li><li><div>     * @param array $ids&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsData::update&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function reorder ( $table, $weight_field, $id_field, $ids ) {&nbsp;</div></li><li><div>        $success = false;&nbsp;</div></li><li><div>        $ids = (array) $ids;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        list( $table, $weight_field, $id_field, $ids ) = $this-&gt;do_hook( 'reorder', array(&nbsp;</div></li><li><div>            $table, &nbsp;</div></li><li><div>            $weight_field, &nbsp;</div></li><li><div>            $id_field, &nbsp;</div></li><li><div>            $ids&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $ids ) ) {&nbsp;</div></li><li><div>            $success = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $ids as $weight =&gt; $id ) {&nbsp;</div></li><li><div>                $updated = $this-&gt;update( $table, array( $weight_field =&gt; $weight ), array( $id_field =&gt; $id ), array( '%d' ), array( '%d' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false === $updated )&nbsp;</div></li><li><div>                    $success = false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $success;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fetch a new row for the current pod_data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $row Row number to fetch&nbsp;</div></li><li><div>     * @param bool $explicit_set Whether to set explicitly (use false when in loop)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function fetch ( $row = null, $explicit_set = true ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null === $row )&nbsp;</div></li><li><div>            $explicit_set = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $already_cached = false;&nbsp;</div></li><li><div>        $id = $row;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null === $row ) {&nbsp;</div></li><li><div>            $this-&gt;row_number++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;row = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $this-&gt;data[ $this-&gt;row_number ] ) ) {&nbsp;</div></li><li><div>                $this-&gt;row = get_object_vars( $this-&gt;data[ $this-&gt;row_number ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $current_row_id = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( in_array( $this-&gt;pod_data[ 'type' ], array( 'post_type', 'media' ) ) )&nbsp;</div></li><li><div>                    $current_row_id = pods_var_raw( 'ID', $this-&gt;row );&nbsp;</div></li><li><div>                elseif ( 'taxonomy' == $this-&gt;pod_data[ 'type' ] )&nbsp;</div></li><li><div>                    $current_row_id = pods_var_raw( 'term_id', $this-&gt;row );&nbsp;</div></li><li><div>                elseif ( 'user' == $this-&gt;pod_data[ 'type' ] )&nbsp;</div></li><li><div>                    $current_row_id = pods_var_raw( 'ID', $this-&gt;row );&nbsp;</div></li><li><div>                elseif ( 'comment' == $this-&gt;pod_data[ 'type' ] )&nbsp;</div></li><li><div>                    $current_row_id = pods_var_raw( 'comment_ID', $this-&gt;row );&nbsp;</div></li><li><div>                elseif ( 'settings' == $this-&gt;pod_data[ 'type' ] )&nbsp;</div></li><li><div>                    $current_row_id = $this-&gt;pod_data[ 'id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 0 &lt; $current_row_id )&nbsp;</div></li><li><div>                    $row = $current_row_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null !== $row || 'settings' == $this-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>            if ( $explicit_set )&nbsp;</div></li><li><div>                $this-&gt;row_number = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $mode = 'id';&nbsp;</div></li><li><div>            $id = pods_absint( $row );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !is_numeric( $row ) || 0 === strpos( $row, '0' ) || $row != preg_replace( '/[^0-9]/', '', $row ) ) {&nbsp;</div></li><li><div>                $mode = 'slug';&nbsp;</div></li><li><div>                $id = $row;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $row = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $this-&gt;pod ) ) {&nbsp;</div></li><li><div>                $row = pods_cache_get( $id, 'pods_items_' . $this-&gt;pod );&nbsp;</div></li><li><div>                if ( false !== $row ) {&nbsp;</div></li><li><div>                    $already_cached = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $current_row_id = false;&nbsp;</div></li><li><div>            $get_table_data = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $old_row = $this-&gt;row;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $row && is_array( $row ) )&nbsp;</div></li><li><div>                $this-&gt;row = $row;&nbsp;</div></li><li><div>            elseif ( in_array( $this-&gt;pod_data[ 'type' ], array( 'post_type', 'media' ) ) ) {&nbsp;</div></li><li><div>                if ( 'post_type' == $this-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                    if ( empty( $this-&gt;pod_data[ 'object' ] ) ) {&nbsp;</div></li><li><div>                        $post_type = $this-&gt;pod_data[ 'name' ];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $post_type = $this-&gt;pod_data[ 'object' ];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $post_type = 'attachment';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'id' == $mode ) {&nbsp;</div></li><li><div>                    $this-&gt;row = get_post( $id, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_array( $this-&gt;row ) && $this-&gt;row[ 'post_type' ] != $post_type )&nbsp;</div></li><li><div>                        $this-&gt;row = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $args = array(&nbsp;</div></li><li><div>                        'post_type' =&gt; $post_type, &nbsp;</div></li><li><div>                        'name' =&gt; $id, &nbsp;</div></li><li><div>                        'numberposts' =&gt; 5&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $find = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $find ) )&nbsp;</div></li><li><div>                        $this-&gt;row = get_object_vars( $find[ 0 ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_wp_error( $this-&gt;row ) || empty( $this-&gt;row ) )&nbsp;</div></li><li><div>                    $this-&gt;row = false;&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $current_row_id = $this-&gt;row[ 'ID' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $get_table_data = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $this-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                $taxonomy = $this-&gt;pod_data[ 'object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $taxonomy ) )&nbsp;</div></li><li><div>                    $taxonomy = $this-&gt;pod_data[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Taxonomies are registered during init, so they aren't available before then&nbsp;</div></li><li><div>                if ( !did_action( 'init' ) ) {&nbsp;</div></li><li><div>                    // hackaround :(&nbsp;</div></li><li><div>                    if ( 'id' == $mode )&nbsp;</div></li><li><div>                        $term_where = 't.term_id = %d';&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $term_where = 't.slug = %s';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $filter = 'raw';&nbsp;</div></li><li><div>                    $term = $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'id' != $mode || !$_term = wp_cache_get( $term, $taxonomy ) ) {&nbsp;</div></li><li><div>                        $_term = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT t.*, tt.* FROM $wpdb-&gt;terms AS t INNER JOIN $wpdb-&gt;term_taxonomy AS tt ON t.term_id = tt.term_id WHERE tt.taxonomy = %s AND {$term_where} LIMIT 1&quot;, $taxonomy, $term ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( $_term )&nbsp;</div></li><li><div>                            wp_cache_add( $term, $_term, $taxonomy );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $_term = apply_filters( 'get_term', $_term, $taxonomy );&nbsp;</div></li><li><div>                    $_term = apply_filters( &quot;get_$taxonomy&quot;, $_term, $taxonomy );&nbsp;</div></li><li><div>                    $_term = sanitize_term( $_term, $taxonomy, $filter );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_object( $_term ) )&nbsp;</div></li><li><div>                        $this-&gt;row = get_object_vars( $_term );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( 'id' == $mode )&nbsp;</div></li><li><div>                    $this-&gt;row = get_term( $id, $taxonomy, ARRAY_A );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;row = get_term_by( 'slug', $id, $taxonomy, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_wp_error( $this-&gt;row ) || empty( $this-&gt;row ) )&nbsp;</div></li><li><div>                    $this-&gt;row = false;&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $current_row_id = $this-&gt;row[ 'term_id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $get_table_data = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'user' == $this-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                if ( 'id' == $mode )&nbsp;</div></li><li><div>                    $this-&gt;row = get_userdata( $id );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;row = get_user_by( 'slug', $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_wp_error( $this-&gt;row ) || empty( $this-&gt;row ) )&nbsp;</div></li><li><div>                    $this-&gt;row = false;&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    // Get other vars&nbsp;</div></li><li><div>                    $roles = $this-&gt;row-&gt;roles;&nbsp;</div></li><li><div>                    $caps = $this-&gt;row-&gt;caps;&nbsp;</div></li><li><div>                    $allcaps = $this-&gt;row-&gt;allcaps;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;row = get_object_vars( $this-&gt;row-&gt;data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Set other vars&nbsp;</div></li><li><div>                    $this-&gt;row[ 'roles' ] = $roles;&nbsp;</div></li><li><div>                    $this-&gt;row[ 'caps' ] = $caps;&nbsp;</div></li><li><div>                    $this-&gt;row[ 'allcaps' ] = $allcaps;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $this-&gt;row[ 'user_pass' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $current_row_id = $this-&gt;row[ 'ID' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $get_table_data = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'comment' == $this-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                $this-&gt;row = get_comment( $id, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // No slug handling here&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_wp_error( $this-&gt;row ) || empty( $this-&gt;row ) )&nbsp;</div></li><li><div>                    $this-&gt;row = false;&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $current_row_id = $this-&gt;row[ 'comment_ID' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $get_table_data = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'settings' == $this-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                $this-&gt;row = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $this-&gt;fields ) )&nbsp;</div></li><li><div>                    $this-&gt;row = false;&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    foreach ( $this-&gt;fields as $field ) {&nbsp;</div></li><li><div>                        if ( !in_array( $field[ 'type' ], $tableless_field_types ) )&nbsp;</div></li><li><div>                            $this-&gt;row[ $field[ 'name' ] ] = get_option( $this-&gt;pod_data[ 'name' ] . '_' . $field[ 'name' ], null );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Force ID&nbsp;</div></li><li><div>                    $this-&gt;id = $this-&gt;pod_data[ 'id' ];&nbsp;</div></li><li><div>                    $this-&gt;row[ 'option_id' ] = $this-&gt;id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $params = array(&nbsp;</div></li><li><div>                    'table' =&gt; $this-&gt;table, &nbsp;</div></li><li><div>                    'where' =&gt; &quot;`t`.`{$this-&gt;field_id}` = &quot; . (int) $id, &nbsp;</div></li><li><div>                    'orderby' =&gt; &quot;`t`.`{$this-&gt;field_id}` DESC&quot;, &nbsp;</div></li><li><div>                    'page' =&gt; 1, &nbsp;</div></li><li><div>                    'limit' =&gt; 1, &nbsp;</div></li><li><div>                    'search' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'slug' == $mode && !empty( $this-&gt;field_slug ) ) {&nbsp;</div></li><li><div>                    $id = pods_sanitize( $id );&nbsp;</div></li><li><div>                    $params[ 'where' ] = &quot;`t`.`{$this-&gt;field_slug}` = '{$id}'&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;row = pods_data()-&gt;select( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $this-&gt;row ) )&nbsp;</div></li><li><div>                    $this-&gt;row = false;&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $current_row = (array) $this-&gt;row;&nbsp;</div></li><li><div>                    $this-&gt;row = get_object_vars( (object) @current( $current_row ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !$explicit_set && !empty( $this-&gt;row ) && is_array( $this-&gt;row ) && !empty( $old_row ) ) {&nbsp;</div></li><li><div>                $this-&gt;row = array_merge( $old_row, $this-&gt;row );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'table' == $this-&gt;pod_data[ 'storage' ] && false !== $get_table_data && is_numeric( $current_row_id ) ) {&nbsp;</div></li><li><div>                $params = array(&nbsp;</div></li><li><div>                    'table' =&gt; $wpdb-&gt;prefix . &quot;pods_&quot;, &nbsp;</div></li><li><div>                    'where' =&gt; &quot;`t`.`id` = {$current_row_id}&quot;, &nbsp;</div></li><li><div>                    'orderby' =&gt; &quot;`t`.`id` DESC&quot;, &nbsp;</div></li><li><div>                    'page' =&gt; 1, &nbsp;</div></li><li><div>                    'limit' =&gt; 1, &nbsp;</div></li><li><div>                    'search' =&gt; false, &nbsp;</div></li><li><div>                    'strict' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $this-&gt;pod_data[ 'object' ] ) )&nbsp;</div></li><li><div>                    $params[ 'table' ] .= $this-&gt;pod_data[ 'name' ];&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $params[ 'table' ] .= $this-&gt;pod_data[ 'object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $row = pods_data()-&gt;select( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $row ) ) {&nbsp;</div></li><li><div>                    $current_row = (array) $row;&nbsp;</div></li><li><div>                    $row = get_object_vars( (object) @current( $current_row ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_array( $this-&gt;row ) && !empty( $this-&gt;row ) )&nbsp;</div></li><li><div>                        $this-&gt;row = array_merge( $this-&gt;row, $row );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $this-&gt;row = $row;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $this-&gt;pod ) && ! $already_cached ) {&nbsp;</div></li><li><div>                pods_cache_set( $id, $this-&gt;row, 'pods_items_' . $this-&gt;pod, 0 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;row = apply_filters( 'pods_data_fetch', $this-&gt;row, $id, $this-&gt;row_number, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;row;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reset the current data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $row Row number to reset to&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function reset ( $row = null ) {&nbsp;</div></li><li><div>        $row = pods_absint( $row );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;row = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $this-&gt;data[ $row ] ) )&nbsp;</div></li><li><div>            $this-&gt;row = get_object_vars( $this-&gt;data[ $row ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $row ) )&nbsp;</div></li><li><div>            $this-&gt;row_number = -1;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $this-&gt;row_number = $row - 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;row;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Do a query on the database&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $sql The SQL to execute&nbsp;</div></li><li><div>     * @param string $error Error to throw on problems&nbsp;</div></li><li><div>     * @param null $results_error (optional)&nbsp;</div></li><li><div>     * @param null $no_results_error (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|null|void Result of the query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function query ( $sql, $error = 'Database Error', $results_error = null, $no_results_error = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $wpdb-&gt;show_errors )&nbsp;</div></li><li><div>            self::$display_errors = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $display_errors = self::$display_errors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $error ) ) {&nbsp;</div></li><li><div>            if ( isset( $error-&gt;display_errors ) && false === $error-&gt;display_errors )&nbsp;</div></li><li><div>                $display_errors = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $error = 'Database Error';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( is_bool( $error ) ) {&nbsp;</div></li><li><div>            $display_errors = $error;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $error )&nbsp;</div></li><li><div>                $error = 'Database Error';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) array(&nbsp;</div></li><li><div>            'sql' =&gt; $sql, &nbsp;</div></li><li><div>            'error' =&gt; $error, &nbsp;</div></li><li><div>            'results_error' =&gt; $results_error, &nbsp;</div></li><li><div>            'no_results_error' =&gt; $no_results_error, &nbsp;</div></li><li><div>            'display_errors' =&gt; $display_errors&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle Preparations of Values (sprintf format)&nbsp;</div></li><li><div>        if ( is_array( $sql ) ) {&nbsp;</div></li><li><div>            if ( isset( $sql[ 0 ] ) && 1 &lt; count( $sql ) ) {&nbsp;</div></li><li><div>                if ( 2 == count( $sql ) ) {&nbsp;</div></li><li><div>                    if ( !is_array( $sql[ 1 ] ) )&nbsp;</div></li><li><div>                        $sql[ 1 ] = array( $sql[ 1 ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $params-&gt;sql = self::prepare( $sql[ 0 ], $sql[ 1 ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( 3 == count( $sql ) )&nbsp;</div></li><li><div>                    $params-&gt;sql = self::prepare( $sql[ 0 ], array( $sql[ 1 ], $sql[ 2 ] ) );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $params-&gt;sql = self::prepare( $sql[ 0 ], array( $sql[ 1 ], $sql[ 2 ], $sql[ 3 ] ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $params = array_merge( $params, $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 1 == pods_var( 'pods_debug_sql_all', 'get', 0 ) && pods_is_admin( array( 'pods' ) ) )&nbsp;</div></li><li><div>                echo '&lt;textarea cols=&quot;100&quot; rows=&quot;24&quot;&gt;' . esc_textarea( str_replace( array( '@wp_users', '@wp_' ), array( $wpdb-&gt;users, $wpdb-&gt;prefix ), $params-&gt;sql ) ) . '&lt;/textarea&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;sql = trim( $params-&gt;sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Run Query&nbsp;</div></li><li><div>        $params-&gt;sql = apply_filters( 'pods_data_query', $params-&gt;sql, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $wpdb-&gt;query( $params-&gt;sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = apply_filters( 'pods_data_query_result', $result, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $result && !empty( $params-&gt;error ) && !empty( $wpdb-&gt;last_error ) )&nbsp;</div></li><li><div>            return pods_error( &quot;{$params-&gt;error}; SQL: {$params-&gt;sql}; Response: {$wpdb-&gt;last_error}&quot;, $params-&gt;display_errors );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'INSERT' == strtoupper( substr( $params-&gt;sql, 0, 6 ) ) || 'REPLACE' == strtoupper( substr( $params-&gt;sql, 0, 7 ) ) )&nbsp;</div></li><li><div>            $result = $wpdb-&gt;insert_id;&nbsp;</div></li><li><div>        elseif ( preg_match( '/^[\s\r\n\(]*SELECT/', strtoupper( $params-&gt;sql ) ) ) {&nbsp;</div></li><li><div>            $result = (array) $wpdb-&gt;last_result;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $result ) && !empty( $params-&gt;results_error ) )&nbsp;</div></li><li><div>                return pods_error( $params-&gt;results_error, $params-&gt;display_errors );&nbsp;</div></li><li><div>            elseif ( empty( $result ) && !empty( $params-&gt;no_results_error ) )&nbsp;</div></li><li><div>                return pods_error( $params-&gt;no_results_error, $params-&gt;display_errors );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets all tables in the WP database, optionally exclude WP core&nbsp;</div></li><li><div>     * tables, and/or Pods table by settings the parameters to false.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param boolean $wp_core&nbsp;</div></li><li><div>     * @param boolean $pods_tables restrict Pods 2.x tables&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_tables ( $wp_core = true, $pods_tables = true ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $core_wp_tables = array(&nbsp;</div></li><li><div>            $wpdb-&gt;options, &nbsp;</div></li><li><div>            $wpdb-&gt;comments, &nbsp;</div></li><li><div>            $wpdb-&gt;commentmeta, &nbsp;</div></li><li><div>            $wpdb-&gt;posts, &nbsp;</div></li><li><div>            $wpdb-&gt;postmeta, &nbsp;</div></li><li><div>            $wpdb-&gt;users, &nbsp;</div></li><li><div>            $wpdb-&gt;usermeta, &nbsp;</div></li><li><div>            $wpdb-&gt;links, &nbsp;</div></li><li><div>            $wpdb-&gt;terms, &nbsp;</div></li><li><div>            $wpdb-&gt;term_taxonomy, &nbsp;</div></li><li><div>            $wpdb-&gt;term_relationships&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $showTables = mysql_list_tables( DB_NAME );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $finalTables = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while ( $table = mysql_fetch_row( $showTables ) ) {&nbsp;</div></li><li><div>            if ( !$pods_tables && 0 === ( strpos( $table[ 0 ], $wpdb-&gt;prefix . rtrim( self::$prefix, '_' ) ) ) ) // don't include pods tables&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            elseif ( !$wp_core && in_array( $table[ 0 ], $core_wp_tables ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $finalTables[] = $table[ 0 ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $finalTables;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets column information from a table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table Table Name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_table_columns ( $table ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        self::query( &quot;SHOW COLUMNS FROM `{$table}` &quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_columns = $wpdb-&gt;last_result;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_cols_and_types = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $table_columns as $table_col ) {&nbsp;</div></li><li><div>            // Get only the type, not the attributes&nbsp;</div></li><li><div>            if ( false === strpos( $table_col-&gt;Type, '(' ) )&nbsp;</div></li><li><div>                $modified_type = $table_col-&gt;Type;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $modified_type = substr( $table_col-&gt;Type, 0, ( strpos( $table_col-&gt;Type, '(' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $table_cols_and_types[ $table_col-&gt;Field ] = $modified_type;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $table_cols_and_types;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets column data information from a table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $column_name Column name&nbsp;</div></li><li><div>     * @param string $table Table name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_column_data ( $column_name, $table ) {&nbsp;</div></li><li><div>        $describe_data = mysql_query( 'DESCRIBE ' . $table );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $column_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while ( $column_row = mysql_fetch_assoc( $describe_data ) ) {&nbsp;</div></li><li><div>            $column_data[] = $column_row;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $column_data as $single_column ) {&nbsp;</div></li><li><div>            if ( $column_name == $single_column[ 'Field' ] )&nbsp;</div></li><li><div>                return $single_column;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $column_data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepare values for the DB&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $sql SQL to prepare&nbsp;</div></li><li><div>     * @param array $data Data to add to the sql prepare statement&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|null|string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function prepare ( $sql, $data ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        list( $sql, $data ) = apply_filters( 'pods_data_prepare', array( $sql, $data ) );&nbsp;</div></li><li><div>        return $wpdb-&gt;prepare( $sql, $data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the string to use in a query for WHERE/HAVING, uses WP_Query meta_query arguments&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $fields Array of field matches for querying&nbsp;</div></li><li><div>     * @param array $pod Related Pod&nbsp;</div></li><li><div>     * @param object $params Parameters passed from select()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null Query string for WHERE/HAVING&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function query_fields ( $fields, $pod = null, &$params = null ) {&nbsp;</div></li><li><div>        $query_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_object( $params ) ) {&nbsp;</div></li><li><div>            $params = new stdClass();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;query_field_level ) || 0 == $params-&gt;query_field_level ) {&nbsp;</div></li><li><div>            $params-&gt;query_fields = array();&nbsp;</div></li><li><div>            $params-&gt;query_field_syntax = false;&nbsp;</div></li><li><div>            $params-&gt;query_field_level = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;where_default ) ) {&nbsp;</div></li><li><div>                $params-&gt;where_default = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;where_defaulted ) ) {&nbsp;</div></li><li><div>                $params-&gt;where_defaulted = false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current_level = $params-&gt;query_field_level;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $relation = 'AND';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $fields[ 'relation' ] ) ) {&nbsp;</div></li><li><div>            $relation = strtoupper( trim( pods_var( 'relation', $fields, 'AND', null, true ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'AND' != $relation )&nbsp;</div></li><li><div>                $relation = 'OR';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $fields[ 'relation' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $fields as $field =&gt; $match ) {&nbsp;</div></li><li><div>            if ( is_array( $match ) && isset( $match[ 'relation' ] ) ) {&nbsp;</div></li><li><div>                $params-&gt;query_field_level = $current_level + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $query_field = self::query_fields( $match, $pod, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $params-&gt;query_field_level = $current_level;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $query_field ) ) {&nbsp;</div></li><li><div>                    $query_fields[] = $query_field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $query_field = self::query_field( $field, $match, $pod, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $query_field ) ) {&nbsp;</div></li><li><div>                    $query_fields[] = $query_field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $query_fields ) ) {&nbsp;</div></li><li><div>            // If post_status not sent, detect it&nbsp;</div></li><li><div>            if ( !empty( $pod ) && 'post_type' == $pod[ 'type' ] && 1 == $current_level && !$params-&gt;where_defaulted && !empty( $params-&gt;where_default ) ) {&nbsp;</div></li><li><div>                $post_status_found = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !$params-&gt;query_field_syntax ) {&nbsp;</div></li><li><div>                    $haystack = implode( ' ', (array) $query_fields );&nbsp;</div></li><li><div>                    $haystack = preg_replace( '/\s/', ' ', $haystack );&nbsp;</div></li><li><div>                    $haystack = preg_replace( '/\w\(/', ' ', $haystack );&nbsp;</div></li><li><div>                    $haystack = str_replace( array( '(', ')', '  ', '\\\'', &quot;\\\&quot;&quot; ), ' ', $haystack );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    preg_match_all( '/`?[\w\-]+`?(?:\\.`?[\w\-]+`?)+(?=[^&quot;\']*(?:&quot;[^&quot;]*&quot;[^&quot;]*|\'[^\']*\'[^\']*)*$)/', $haystack, $found, PREG_PATTERN_ORDER );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $found = (array) @current( $found );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $found as $value ) {&nbsp;</div></li><li><div>                        $value = str_replace( '`', '', $value );&nbsp;</div></li><li><div>                        $value = explode( '.', $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( ( 'post_status' == $value[ 0 ] && 1 == count( $value ) ) || ( 2 == count( $value ) && 't' == $value[ 0 ] && 'post_status' == $value[ 1 ] ) ) {&nbsp;</div></li><li><div>                            $post_status_found = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( !empty( $params-&gt;query_fields ) && in_array( 'post_status', $params-&gt;query_fields ) ) {&nbsp;</div></li><li><div>                    $post_status_found = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !$post_status_found ) {&nbsp;</div></li><li><div>                    $query_fields[] = $params-&gt;where_default;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 1 &lt; count( $query_fields ) )&nbsp;</div></li><li><div>                $query_fields = '( ( ' . implode( ' ) ' . $relation . ' ( ', $query_fields ) . ' ) )';&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $query_fields = '( ' . implode( ' ' . $relation . ' ', $query_fields ) . ' )';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $query_fields = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // query_fields level complete&nbsp;</div></li><li><div>        if ( 1 == $params-&gt;query_field_level ) {&nbsp;</div></li><li><div>            $params-&gt;query_field_level = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $query_fields;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the string to use in a query for matching, uses WP_Query meta_query arguments&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|int $field Field name or array index&nbsp;</div></li><li><div>     * @param array|string $q Query array (meta_query) or string for matching&nbsp;</div></li><li><div>     * @param array $pod Related Pod&nbsp;</div></li><li><div>     * @param object $params Parameters passed from select()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null Query field string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see PodsData::query_fields&nbsp;</div></li><li><div>     * @static&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function query_field ( $field, $q, $pod = null, &$params = null ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_query = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plain queries&nbsp;</div></li><li><div>        if ( is_numeric( $field ) && !is_array( $q ) ) {&nbsp;</div></li><li><div>            return $q;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // key =&gt; value queries (backwards compatibility)&nbsp;</div></li><li><div>        elseif ( !is_numeric( $field ) && ( !is_array( $q ) || ( !isset( $q[ 'key' ] ) && !isset( $q[ 'field' ] ) ) ) ) {&nbsp;</div></li><li><div>            $new_q = array(&nbsp;</div></li><li><div>                'field' =&gt; $field, &nbsp;</div></li><li><div>                'compare' =&gt; pods_var_raw( 'compare', $q, '=', null, true ), &nbsp;</div></li><li><div>                'value' =&gt; pods_var_raw( 'value', $q, $q, null, true ), &nbsp;</div></li><li><div>                'sanitize' =&gt; pods_var_raw( 'sanitize', $q, true ), &nbsp;</div></li><li><div>                'sanitize_format' =&gt; pods_var_raw( 'sanitize_format', $q ), &nbsp;</div></li><li><div>                'cast' =&gt; pods_var_raw( 'cast', $q )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $new_q[ 'value' ] ) ) {&nbsp;</div></li><li><div>                if ( '=' == $new_q[ 'compare' ] )&nbsp;</div></li><li><div>                    $new_q[ 'compare' ] = 'IN';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $new_q[ 'value' ][ 'compare' ] ) )&nbsp;</div></li><li><div>                    unset( $new_q[ 'value' ][ 'compare' ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $q = $new_q;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_name = trim( pods_var_raw( 'field', $q, pods_var_raw( 'key', $q, $field, null, true ), null, true ) );&nbsp;</div></li><li><div>        $field_type = strtoupper( trim( pods_var_raw( 'type', $q, 'CHAR', null, true ) ) );&nbsp;</div></li><li><div>        $field_value = pods_var_raw( 'value', $q );&nbsp;</div></li><li><div>        $field_compare = strtoupper( trim( pods_var_raw( 'compare', $q, ( is_array( $field_value ? 'IN' : '=' ) ), null, true ) ) );&nbsp;</div></li><li><div>        $field_sanitize = (boolean) pods_var( 'sanitize', $q, true );&nbsp;</div></li><li><div>        $field_sanitize_format = pods_var_raw( 'sanitize_format', $q, null, null, true );&nbsp;</div></li><li><div>        $field_cast = pods_var_raw( 'cast', $q, null, null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $params ) ) {&nbsp;</div></li><li><div>            $params-&gt;meta_query_syntax = true;&nbsp;</div></li><li><div>            $params-&gt;query_fields[] = $field_name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Deprecated WP type&nbsp;</div></li><li><div>        if ( 'NUMERIC' == $field_type )&nbsp;</div></li><li><div>            $field_type = 'SIGNED';&nbsp;</div></li><li><div>        // Restrict to supported types&nbsp;</div></li><li><div>        elseif ( !in_array( $field_type, array( 'BINARY', 'CHAR', 'DATE', 'DATETIME', 'DECIMAL', 'SIGNED', 'TIME', 'UNSIGNED' ) ) )&nbsp;</div></li><li><div>            $field_type = 'CHAR';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Alias / Casting&nbsp;</div></li><li><div>        if ( empty( $field_cast ) ) {&nbsp;</div></li><li><div>            // Setup field casting from field name&nbsp;</div></li><li><div>            if ( false === strpos( $field_name, '`' ) && false === strpos( $field_name, '(' ) && false === strpos( $field_name, ' ' ) ) {&nbsp;</div></li><li><div>                // Handle field naming if Pod-based&nbsp;</div></li><li><div>                if ( !empty( $pod ) && false === strpos( $field_name, '.' ) ) {&nbsp;</div></li><li><div>                    $field_cast = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $pod[ 'fields' ][ $field_name ] ) && in_array( $pod[ 'fields' ][ $field_name ][ 'type' ], $tableless_field_types ) ) {&nbsp;</div></li><li><div>                        if ( in_array( $pod[ 'fields' ][ $field_name ][ 'pick_object' ], $simple_tableless_objects ) ) {&nbsp;</div></li><li><div>                            if ( 'meta' == $pod[ 'storage' ] )&nbsp;</div></li><li><div>                                $field_cast = &quot;`{$field_name}`.`meta_value`&quot;;&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $field_cast = &quot;`t`.`{$field_name}`&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else {&nbsp;</div></li><li><div>                            $table = pods_api()-&gt;get_table_info( $pod[ 'fields' ][ $field_name ][ 'pick_object' ], $pod[ 'fields' ][ $field_name ][ 'pick_val' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( !empty( $table ) )&nbsp;</div></li><li><div>                                $field_cast = &quot;`{$field_name}`.`&quot; . $table[ 'field_index' ] . '`';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $field_cast ) ) {&nbsp;</div></li><li><div>                        if ( !in_array( $pod[ 'type' ], array( 'pod', 'table' ) ) ) {&nbsp;</div></li><li><div>                            if ( isset( $pod[ 'object_fields' ][ $field_name ] ) )&nbsp;</div></li><li><div>                                $field_cast = &quot;`t`.`{$field_name}`&quot;;&nbsp;</div></li><li><div>                            elseif ( isset( $pod[ 'fields' ][ $field_name ] ) ) {&nbsp;</div></li><li><div>                                if ( 'meta' == $pod['storage'] )&nbsp;</div></li><li><div>                                    $field_cast = &quot;`{$field_name}`.`meta_value`&quot;;&nbsp;</div></li><li><div>                                else&nbsp;</div></li><li><div>                                    $field_cast = &quot;`d`.`{$field_name}`&quot;;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else {&nbsp;</div></li><li><div>                                foreach ( $pod[ 'object_fields' ] as $object_field =&gt; $object_field_opt ) {&nbsp;</div></li><li><div>                                    if ( $object_field == $field_name || in_array( $field_name, $object_field_opt[ 'alias' ] ) ) {&nbsp;</div></li><li><div>                                        $field_cast = &quot;`t`.`{$object_field}`&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif ( isset( $pod[ 'fields' ][ $field_name ] ) ) {&nbsp;</div></li><li><div>                            if ( 'meta' == $pod['storage'] )&nbsp;</div></li><li><div>                                $field_cast = &quot;`{$field_name}`.`meta_value`&quot;;&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $field_cast = &quot;`t`.`{$field_name}`&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( empty( $field_cast ) ) {&nbsp;</div></li><li><div>                            if ( 'meta' == $pod['storage'] ) {&nbsp;</div></li><li><div>                                $field_cast = &quot;`{$field_name}`.`meta_value`&quot;;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $field_cast = &quot;`t`.`{$field_name}`&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $field_cast = '`' . str_replace( '.', '`.`', $field_name ) . '`';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $field_cast = $field_name;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Cast field if needed&nbsp;</div></li><li><div>            if ( 'CHAR' != $field_type ) {&nbsp;</div></li><li><div>                $field_cast = 'CAST( ' . $field_cast . ' AS ' . $field_type .' )';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup string sanitizing for $wpdb-&gt;prepare()&nbsp;</div></li><li><div>        if ( empty( $field_sanitize_format ) ) {&nbsp;</div></li><li><div>            // Sanitize as string&nbsp;</div></li><li><div>            $field_sanitize_format = '%s';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Sanitize as integer if needed&nbsp;</div></li><li><div>            if ( in_array( $field_type, array( 'UNSIGNED', 'SIGNED' ) ) )&nbsp;</div></li><li><div>                $field_sanitize_format = '%d';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Restrict to supported comparisons&nbsp;</div></li><li><div>        if ( !in_array( $field_compare, array( '=', '!=', '&gt;', '&gt;=', '&lt;', '&lt;=', 'LIKE', 'NOT LIKE', 'IN', 'NOT IN', 'ALL', 'BETWEEN', 'NOT BETWEEN', 'EXISTS', 'NOT EXISTS', 'REGEXP', 'NOT REGEXP', 'RLIKE' ) ) )&nbsp;</div></li><li><div>            $field_compare = '=';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Restrict to supported array comparisons&nbsp;</div></li><li><div>        if ( is_array( $field_value ) && !in_array( $field_compare, array( 'IN', 'NOT IN', 'ALL', 'BETWEEN', 'NOT BETWEEN' ) ) ) {&nbsp;</div></li><li><div>            if ( in_array( $field_compare, array( '!=', 'NOT LIKE' ) ) )&nbsp;</div></li><li><div>                $field_compare = 'NOT IN';&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $field_compare = 'IN';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Restrict to supported string comparisons&nbsp;</div></li><li><div>        elseif ( !is_array( $field_value ) && in_array( $field_compare, array( 'IN', 'NOT IN', 'ALL', 'BETWEEN', 'NOT BETWEEN' ) ) ) {&nbsp;</div></li><li><div>            $check_value = preg_split( '/[, \s]+/', $field_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 1 &lt; count( $check_value ) )&nbsp;</div></li><li><div>                $field_value = $check_value;&nbsp;</div></li><li><div>            elseif ( in_array( $field_compare, array( 'NOT IN', 'NOT BETWEEN' ) ) )&nbsp;</div></li><li><div>                $field_compare = '!=';&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $field_compare = '=';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Restrict to two values, force = and != if only one value provided&nbsp;</div></li><li><div>        if ( in_array( $field_compare, array( 'BETWEEN', 'NOT BETWEEN' ) ) ) {&nbsp;</div></li><li><div>            $field_value = array_values( array_slice( $field_value, 0, 2 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 1 == count( $field_value ) ) {&nbsp;</div></li><li><div>                if ( 'NOT IN' == $field_compare )&nbsp;</div></li><li><div>                    $field_compare = '!=';&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $field_compare = '=';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Single array handling&nbsp;</div></li><li><div>        if ( 1 == count( $field_value ) && $field_compare == 'ALL' ) {&nbsp;</div></li><li><div>            $field_compare = '=';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Empty array handling&nbsp;</div></li><li><div>        elseif ( empty( $field_value ) && in_array( $field_compare, array( 'IN', 'NOT IN', 'BETWEEN', 'NOT BETWEEN' ) ) ) {&nbsp;</div></li><li><div>            $field_compare = 'EXISTS';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Rebuild $q&nbsp;</div></li><li><div>        $q = array(&nbsp;</div></li><li><div>            'field' =&gt; $field_name, &nbsp;</div></li><li><div>            'type' =&gt; $field_type, &nbsp;</div></li><li><div>            'value' =&gt; $field_value, &nbsp;</div></li><li><div>            'compare' =&gt; $field_compare, &nbsp;</div></li><li><div>            'sanitize' =&gt; $field_sanitize, &nbsp;</div></li><li><div>            'sanitize_format' =&gt; $field_sanitize_format, &nbsp;</div></li><li><div>            'cast' =&gt; $field_cast&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make the query&nbsp;</div></li><li><div>        if ( in_array( $field_compare, array( '=', '!=', '&gt;', '&gt;=', '&lt;', '&lt;=', 'REGEXP', 'NOT REGEXP', 'RLIKE' ) ) ) {&nbsp;</div></li><li><div>            if ( $field_sanitize ) {&nbsp;</div></li><li><div>                $field_query = $wpdb-&gt;prepare( $field_cast . ' ' . $field_compare . ' ' . $field_sanitize_format, $field_value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $field_query = $field_cast . ' ' . $field_compare . ' &quot;' . $field_value . '&quot;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $field_compare, array( 'LIKE', 'NOT LIKE' ) ) ) {&nbsp;</div></li><li><div>            if ( $field_sanitize ) {&nbsp;</div></li><li><div>                $field_query = $field_cast . ' ' . $field_compare . ' &quot;%' . pods_sanitize_like( $field_value ) . '%&quot;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $field_query = $field_cast . ' ' . $field_compare . ' &quot;' . $field_value . '&quot;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $field_compare, array( 'IN', 'NOT IN', 'ALL' ) ) ) {&nbsp;</div></li><li><div>            if ( $field_compare == 'ALL' ) {&nbsp;</div></li><li><div>                $field_compare = 'IN';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! empty( $pod ) ) {&nbsp;</div></li><li><div>                    $params-&gt;having[] = 'COUNT( DISTINCT ' . $field_cast . ' ) = ' . count( $field_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $params-&gt;groupby ) || ( ! in_array( '`t`.`' . $pod['field_id'] . '`', $params-&gt;groupby ) && ! in_array( 't.' . $pod['field_id'] . '', $params-&gt;groupby ) ) ) {&nbsp;</div></li><li><div>                        $params-&gt;groupby[] = '`t`.`' . $pod['field_id'] . '`';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $field_sanitize ) {&nbsp;</div></li><li><div>                $field_query = $wpdb-&gt;prepare( $field_cast . ' ' . $field_compare . ' ( ' . substr( str_repeat( ', ' . $field_sanitize_format, count( $field_value ) ), 1 ) . ' )', $field_value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $field_query = $field_cast . ' ' . $field_compare . ' ( &quot;' . implode( '&quot;, &quot;', $field_value ) . '&quot; )';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $field_compare, array( 'BETWEEN', 'NOT BETWEEN' ) ) ) {&nbsp;</div></li><li><div>            if ( $field_sanitize ) {&nbsp;</div></li><li><div>                $field_query = $wpdb-&gt;prepare( $field_cast . ' ' . $field_compare . ' ' . $field_sanitize_format . ' AND ' . $field_sanitize_format, $field_value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $field_query = $field_cast . ' ' . $field_compare . ' &quot;' . $field_value[ 0 ] . '&quot; AND &quot;' . $field_value[ 1 ] . '&quot;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'EXISTS' == $field_compare )&nbsp;</div></li><li><div>            $field_query = $field_cast . ' IS NOT NULL';&nbsp;</div></li><li><div>        elseif ( 'NOT EXISTS' == $field_compare )&nbsp;</div></li><li><div>            $field_query = $field_cast . ' IS NULL';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_query = apply_filters( 'pods_data_field_query', $field_query, $q );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field_query;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Setup fields for traversal&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $fields Associative array of fields data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Traverse feed&nbsp;</div></li><li><div>     * @param object $params (optional) Parameters from build()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function traverse_build ( $fields = null, $params = null ) {&nbsp;</div></li><li><div>        if ( null === $fields )&nbsp;</div></li><li><div>            $fields = $this-&gt;fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $feed = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $fields as $field =&gt; $data ) {&nbsp;</div></li><li><div>            if ( !is_array( $data ) )&nbsp;</div></li><li><div>                $field = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $_GET[ 'filter_' . $field ] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field_value = pods_var( 'filter_' . $field, 'get', false, null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $field_value ) || 0 &lt; strlen( $field_value ) )&nbsp;</div></li><li><div>                $feed[ 'traverse_' . $field ] = array( $field );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $feed;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Recursively join tables based on fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $traverse_recurse Array of traversal options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of table joins&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function traverse_recurse ( $traverse_recurse ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'pod' =&gt; null, &nbsp;</div></li><li><div>            'fields' =&gt; array(), &nbsp;</div></li><li><div>            'joined' =&gt; 't', &nbsp;</div></li><li><div>            'depth' =&gt; 0, &nbsp;</div></li><li><div>            'joined_id' =&gt; 'id', &nbsp;</div></li><li><div>            'joined_index' =&gt; 'id', &nbsp;</div></li><li><div>            'params' =&gt; new stdClass(), &nbsp;</div></li><li><div>            'last_table_info' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $traverse_recurse = array_merge( $defaults, $traverse_recurse );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $joins = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 == $traverse_recurse[ 'depth' ] && !empty( $traverse_recurse[ 'pod' ] ) && !empty( $traverse_recurse [ 'last_table_info' ] ) && isset( $traverse_recurse [ 'last_table_info' ][ 'id' ] ) )&nbsp;</div></li><li><div>            $pod_data = $traverse_recurse [ 'last_table_info' ];&nbsp;</div></li><li><div>        elseif ( empty( $traverse_recurse[ 'pod' ] ) ) {&nbsp;</div></li><li><div>            if ( !empty( $traverse_recurse[ 'params' ] ) && !empty( $traverse_recurse[ 'params' ]-&gt;table ) && 0 === strpos( $traverse_recurse[ 'params' ]-&gt;table, $wpdb-&gt;prefix ) ) {&nbsp;</div></li><li><div>                if ( $wpdb-&gt;posts == $traverse_recurse[ 'params' ]-&gt;table )&nbsp;</div></li><li><div>                    $traverse_recurse[ 'pod' ] = 'post_type';&nbsp;</div></li><li><div>                elseif ( $wpdb-&gt;terms == $traverse_recurse[ 'params' ]-&gt;table )&nbsp;</div></li><li><div>                    $traverse_recurse[ 'pod' ] = 'taxonomy';&nbsp;</div></li><li><div>                elseif ( $wpdb-&gt;users == $traverse_recurse[ 'params' ]-&gt;table )&nbsp;</div></li><li><div>                    $traverse_recurse[ 'pod' ] = 'user';&nbsp;</div></li><li><div>                elseif ( $wpdb-&gt;comments == $traverse_recurse[ 'params' ]-&gt;table )&nbsp;</div></li><li><div>                    $traverse_recurse[ 'pod' ] = 'comment';&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    return $joins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( in_array( $traverse_recurse[ 'pod' ], array( 'user', 'comment' ) ) ) {&nbsp;</div></li><li><div>                    $pod = $this-&gt;api-&gt;load_pod( array( 'name' =&gt; $traverse_recurse[ 'pod' ], 'table_info' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $pod ) && $pod[ 'type' ] == $pod )&nbsp;</div></li><li><div>                        $pod_data = $pod;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $pod_data ) ) {&nbsp;</div></li><li><div>                    $default_storage = 'meta';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'taxonomy' == $traverse_recurse['pod'] && ! function_exists( 'get_term_meta' ) ) {&nbsp;</div></li><li><div>                        $default_storage = 'none';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pod_data = array(&nbsp;</div></li><li><div>                        'id' =&gt; 0, &nbsp;</div></li><li><div>                        'name' =&gt; '_table_' . $traverse_recurse[ 'pod' ], &nbsp;</div></li><li><div>                        'type' =&gt; $traverse_recurse[ 'pod' ], &nbsp;</div></li><li><div>                        'storage' =&gt; $default_storage, &nbsp;</div></li><li><div>                        'fields' =&gt; array(), &nbsp;</div></li><li><div>                        'object_fields' =&gt; $this-&gt;api-&gt;get_wp_object_fields( $traverse_recurse[ 'pod' ] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pod_data = array_merge( $this-&gt;api-&gt;get_table_info( $traverse_recurse[ 'pod' ], '' ), $pod_data );&nbsp;</div></li><li><div>                } elseif ( 'taxonomy' == $pod_data['type'] && 'none' == $pod_data['storage'] && function_exists( 'get_term_meta' ) ) {&nbsp;</div></li><li><div>                    $pod_data['storage'] = 'meta';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $traverse_recurse[ 'pod' ] = $pod_data[ 'name' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                return $joins;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $pod_data = $this-&gt;api-&gt;load_pod( array( 'name' =&gt; $traverse_recurse[ 'pod' ], 'table_info' =&gt; true ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $pod_data ) )&nbsp;</div></li><li><div>                return $joins;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $pod_data[ 'object_fields' ] ) ) {&nbsp;</div></li><li><div>            $pod_data[ 'fields' ] = array_merge( $pod_data[ 'fields' ], $pod_data[ 'object_fields' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>        $file_field_types = PodsForm::file_field_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $this-&gt;traversal[ $traverse_recurse[ 'pod' ] ] ) )&nbsp;</div></li><li><div>            $this-&gt;traversal[ $traverse_recurse[ 'pod' ] ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( empty( $pod_data[ 'meta_table' ] ) || $pod_data[ 'meta_table' ] == $pod_data[ 'table' ] ) && ( empty( $traverse_recurse[ 'fields' ] ) || empty( $traverse_recurse[ 'fields' ][ $traverse_recurse[ 'depth' ] ] ) ) )&nbsp;</div></li><li><div>            return $joins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = $traverse_recurse[ 'fields' ][ $traverse_recurse[ 'depth' ] ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ignore_aliases = array(&nbsp;</div></li><li><div>            'wpml_languages', &nbsp;</div></li><li><div>            'polylang_languages'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ignore_aliases = apply_filters( 'pods_data_traverse_recurse_ignore_aliases', $ignore_aliases, $field, $traverse_recurse, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $field, $ignore_aliases ) )&nbsp;</div></li><li><div>            return $joins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta_data_table = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $pod_data[ 'fields' ][ $field ] ) && 'd' == $field && isset( $traverse_recurse[ 'fields' ][ $traverse_recurse[ 'depth' ] - 1 ] ) ) {&nbsp;</div></li><li><div>            $field = $traverse_recurse[ 'fields' ][ $traverse_recurse[ 'depth' ] - 1 ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field_type = 'pick';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $traverse_recurse[ 'last_table_info' ][ 'pod' ][ 'fields' ][ $field ] ) ) {&nbsp;</div></li><li><div>                $field_type = $traverse_recurse[ 'last_table_info' ][ 'pod' ][ 'fields' ][ $field ][ 'type' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( isset( $traverse_recurse[ 'last_table_info' ][ 'pod' ][ 'object_fields' ][ $field ] ) ) {&nbsp;</div></li><li><div>                $field_type = $traverse_recurse[ 'last_table_info' ][ 'pod' ][ 'object_fields' ][ $field ][ 'type' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod_data[ 'fields' ][ $field ] = array(&nbsp;</div></li><li><div>                'id' =&gt; 0, &nbsp;</div></li><li><div>                'name' =&gt; $field, &nbsp;</div></li><li><div>                'type' =&gt; $field_type, &nbsp;</div></li><li><div>                'pick_object' =&gt; $traverse_recurse[ 'last_table_info' ][ 'pod' ][ 'type' ], &nbsp;</div></li><li><div>                'pick_val' =&gt; $traverse_recurse[ 'last_table_info' ][ 'pod' ][ 'name' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $meta_data_table = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Fallback to meta table if the pod type supports it&nbsp;</div></li><li><div>        if ( !isset( $pod_data[ 'fields' ][ $field ] ) ) {&nbsp;</div></li><li><div>            $last = end( $traverse_recurse[ 'fields' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $pod_data[ 'type' ] && !isset( $pod_data[ 'object_fields' ] ) )&nbsp;</div></li><li><div>                $pod_data[ 'object_fields' ] = $this-&gt;api-&gt;get_wp_object_fields( 'post_type', $pod_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $pod_data[ 'type' ] && isset( $pod_data[ 'object_fields'][ $field ] ) && in_array( $pod_data[ 'object_fields' ][ $field ][ 'type' ], $tableless_field_types ) )&nbsp;</div></li><li><div>                $pod_data[ 'fields' ][ $field ] = $pod_data[ 'object_fields' ][ $field ];&nbsp;</div></li><li><div>            elseif ( 'meta_value' === $last && in_array( $pod_data[ 'type' ], array( 'post_type', 'media', 'taxonomy', 'user', 'comment' ) ) )&nbsp;</div></li><li><div>                $pod_data[ 'fields' ][ $field ] = PodsForm::field_setup( array( 'name' =&gt; $field ) );&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                if ( 'post_type' == $pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                    $pod_data[ 'object_fields' ] = $this-&gt;api-&gt;get_wp_object_fields( 'post_type', $pod_data, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'post_type' == $pod_data[ 'type' ] && isset( $pod_data[ 'object_fields' ][ $field ] ) && in_array( $pod_data[ 'object_fields' ][ $field ][ 'type' ], $tableless_field_types ) )&nbsp;</div></li><li><div>                        $pod_data[ 'fields' ][ $field ] = $pod_data[ 'object_fields' ][ $field ];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        return $joins;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    return $joins;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( isset( $pod_data[ 'object_fields' ] ) && isset( $pod_data[ 'object_fields' ][ $field ] ) && ! in_array( $pod_data[ 'object_fields' ][ $field ][ 'type' ], $tableless_field_types ) ) {&nbsp;</div></li><li><div>            return $joins;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $traverse = $pod_data[ 'fields' ][ $field ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'taxonomy' == $traverse[ 'type' ] )&nbsp;</div></li><li><div>            $traverse[ 'table_info' ] = $this-&gt;api-&gt;get_table_info( $traverse[ 'type' ], $traverse[ 'name' ] );&nbsp;</div></li><li><div>        elseif ( in_array( $traverse[ 'type' ], $file_field_types ) )&nbsp;</div></li><li><div>            $traverse[ 'table_info' ] = $this-&gt;api-&gt;get_table_info( 'post_type', 'attachment' );&nbsp;</div></li><li><div>        elseif ( !in_array( $traverse[ 'type' ], $tableless_field_types ) )&nbsp;</div></li><li><div>            $traverse[ 'table_info' ] = $this-&gt;api-&gt;get_table_info( $pod_data[ 'type' ], $pod_data[ 'name' ], $pod_data[ 'name' ], $pod_data );&nbsp;</div></li><li><div>        elseif ( empty( $traverse[ 'table_info' ] ) || ( in_array( $traverse[ 'pick_object' ], $simple_tableless_objects ) && !empty( $traverse_recurse[ 'last_table_info' ] ) ) ) {&nbsp;</div></li><li><div>            if ( in_array( $traverse[ 'pick_object' ], $simple_tableless_objects ) && !empty( $traverse_recurse[ 'last_table_info' ] ) ) {&nbsp;</div></li><li><div>                $traverse[ 'table_info' ] = $traverse_recurse[ 'last_table_info' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $traverse[ 'table_info' ][ 'meta_table' ] ) )&nbsp;</div></li><li><div>                    $meta_data_table = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( !in_array( $traverse[ 'type' ], $tableless_field_types ) && !empty( $traverse_recurse[ 'last_table_info' ] )  && 0 == $traverse_recurse[ 'depth' ] )&nbsp;</div></li><li><div>                $traverse[ 'table_info' ] = $traverse_recurse[ 'last_table_info' ];&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                if ( ! isset( $traverse[ 'pod' ] ) ) {&nbsp;</div></li><li><div>                    $traverse[ 'pod' ] = null;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $traverse[ 'table_info' ] = $this-&gt;api-&gt;get_table_info( $traverse[ 'pick_object' ], $traverse[ 'pick_val' ], null, $traverse[ 'pod' ], $traverse );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $this-&gt;traversal[ $traverse_recurse[ 'pod' ] ][ $traverse[ 'name' ] ] ) )&nbsp;</div></li><li><div>            $traverse = array_merge( $traverse, (array) $this-&gt;traversal[ $traverse_recurse[ 'pod' ] ][ $traverse[ 'name' ] ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $traverse = apply_filters( 'pods_data_traverse', $traverse, compact( 'pod', 'fields', 'joined', 'depth', 'joined_id', 'params' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $traverse ) )&nbsp;</div></li><li><div>            return $joins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $traverse[ 'id' ] = (int) $traverse[ 'id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $traverse[ 'id' ] ) )&nbsp;</div></li><li><div>            $traverse[ 'id' ] = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_info = $traverse[ 'table_info' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;traversal[ $traverse_recurse[ 'pod' ] ][ $field ] = $traverse;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_joined = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 &lt; $traverse_recurse[ 'depth' ] && 't' != $traverse_recurse[ 'joined' ] ) {&nbsp;</div></li><li><div>            if ( $meta_data_table && ( 'pick' != $traverse[ 'type' ] || !in_array( pods_var( 'pick_object', $traverse ), $simple_tableless_objects ) ) )&nbsp;</div></li><li><div>                $field_joined = $traverse_recurse[ 'joined' ] . '_d';&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $field_joined = $traverse_recurse[ 'joined' ] . '_' . $field;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $rel_alias = 'rel_' . $field_joined;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_v( 'search', $traverse_recurse[ 'params' ], false ) && empty( $traverse_recurse[ 'params' ]-&gt;filters ) ) {&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( pods_var( 'filter_' . $field_joined, 'get' ) ) ) {&nbsp;</div></li><li><div>                $val = absint( pods_var( 'filter_' . $field_joined, 'get' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $search = &quot;`{$field_joined}`.`{$table_info[ 'field_id' ]}` = {$val}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'text' == $this-&gt;search_mode ) {&nbsp;</div></li><li><div>                    $val = pods_var( 'filter_' . $field_joined, 'get' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $search = &quot;`{$field_joined}`.`{$traverse[ 'name' ]}` = '{$val}'&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( 'text_like' == $this-&gt;search_mode ) {&nbsp;</div></li><li><div>                    $val = pods_sanitize( pods_sanitize_like( pods_var_raw( 'filter_' . $field_joined ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $search = &quot;`{$field_joined}`.`{$traverse[ 'name' ]}` LIKE '%{$val}%'&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;search_where[] = &quot; {$search} &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $the_join = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $joined_id = $table_info[ 'field_id' ];&nbsp;</div></li><li><div>        $joined_index = $table_info[ 'field_index' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'taxonomy' == $traverse[ 'type' ] ) {&nbsp;</div></li><li><div>            $rel_tt_alias = 'rel_tt_' . $field_joined;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( pods_tableless() && function_exists( 'get_term_meta' ) ) {&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'meta_table' ]}` AS `{$rel_alias}` ON&nbsp;</div></li><li><div>                        `{$rel_alias}`.`{$table_info[ 'meta_field_index' ]}` = '{$traverse[ 'name' ]}'&nbsp;</div></li><li><div>                        AND `{$rel_alias}`.`{$table_info[ 'meta_field_id' ]}` = `{$traverse_recurse[ 'joined' ]}`.`{$traverse_recurse[ 'joined_id' ]}`&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'meta_table' ]}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info[ 'meta_field_index' ]}` = '{$traverse[ 'name' ]}'&nbsp;</div></li><li><div>                        AND `{$field_joined}`.`{$table_info[ 'meta_field_id' ]}` = CONVERT( `{$rel_alias}`.`{$table_info[ 'meta_field_value' ]}`, SIGNED )&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $joined_id = $table_info[ 'meta_field_id' ];&nbsp;</div></li><li><div>                $joined_index = $table_info[ 'meta_field_index' ];&nbsp;</div></li><li><div>            } elseif ( $meta_data_table ) {&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'pod_table' ]}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info[ 'pod_field_id' ]}` = `{$traverse_recurse[ 'rel_alias' ]}`.`{$traverse_recurse[ 'joined_id' ]}`&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                    LEFT JOIN `{$wpdb-&gt;term_relationships}` AS `{$rel_alias}` ON&nbsp;</div></li><li><div>                        `{$rel_alias}`.`object_id` = `{$traverse_recurse[ 'joined' ]}`.`ID`&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    LEFT JOIN `{$wpdb-&gt;term_taxonomy}` AS `{$rel_tt_alias}` ON&nbsp;</div></li><li><div>                        `{$rel_tt_alias}`.`taxonomy` = '{$traverse[ 'name' ]}'&nbsp;</div></li><li><div>                        AND `{$rel_tt_alias}`.`term_taxonomy_id` = `{$rel_alias}`.`term_taxonomy_id`&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'table' ]}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info[ 'field_id' ]}` = `{$rel_tt_alias}`.`{$table_info[ 'field_id' ]}`&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Override $rel_alias&nbsp;</div></li><li><div>                $rel_alias = $field_joined;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $joined_id = $table_info[ 'field_id' ];&nbsp;</div></li><li><div>                $joined_index = $table_info[ 'field_index' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $traverse[ 'type' ], $tableless_field_types ) && ( 'pick' != $traverse[ 'type' ] || !in_array( pods_v( 'pick_object', $traverse ), $simple_tableless_objects ) ) ) {&nbsp;</div></li><li><div>            if ( pods_tableless() ) {&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'meta_table' ]}` AS `{$rel_alias}` ON&nbsp;</div></li><li><div>                        `{$rel_alias}`.`{$table_info[ 'meta_field_index' ]}` = '{$traverse[ 'name' ]}'&nbsp;</div></li><li><div>                        AND `{$rel_alias}`.`{$table_info[ 'meta_field_id' ]}` = `{$traverse_recurse[ 'joined' ]}`.`{$traverse_recurse[ 'joined_id' ]}`&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'meta_table' ]}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info[ 'meta_field_index' ]}` = '{$traverse[ 'name' ]}'&nbsp;</div></li><li><div>                        AND `{$field_joined}`.`{$table_info[ 'meta_field_id' ]}` = CONVERT( `{$rel_alias}`.`{$table_info[ 'meta_field_value' ]}`, SIGNED )&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $joined_id = $table_info[ 'meta_field_id' ];&nbsp;</div></li><li><div>                $joined_index = $table_info[ 'meta_field_index' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( $meta_data_table ) {&nbsp;</div></li><li><div>                if ( $traverse[ 'id' ] !== $traverse[ 'pick_val' ] ) {&nbsp;</div></li><li><div>                    // This must be a relationship&nbsp;</div></li><li><div>                    $joined_id = 'related_item_id';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $joined_id = $traverse_recurse[ 'joined_id' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                     LEFT JOIN `{$table_info['pod_table']}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info['pod_field_id']}` = `{$traverse_recurse['rel_alias']}`.`{$joined_id}`&nbsp;</div></li><li><div>                 &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                    LEFT JOIN `@wp_podsrel` AS `{$rel_alias}` ON&nbsp;</div></li><li><div>                        `{$rel_alias}`.`field_id` = {$traverse[ 'id' ]}&nbsp;</div></li><li><div>                        AND `{$rel_alias}`.`item_id` = `{$traverse_recurse[ 'joined' ]}`.`{$traverse_recurse[ 'joined_id' ]}`&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'table' ]}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info[ 'field_id' ]}` = `{$rel_alias}`.`related_item_id`&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'meta' == $pod_data[ 'storage' ] ) {&nbsp;</div></li><li><div>            if (&nbsp;</div></li><li><div>                ( $traverse_recurse[ 'depth' ] + 2 ) == count( $traverse_recurse[ 'fields' ] )&nbsp;</div></li><li><div>                && ( 'pick' != $traverse[ 'type' ] || !in_array( pods_var( 'pick_object', $traverse ), $simple_tableless_objects ) )&nbsp;</div></li><li><div>                && $table_info[ 'meta_field_value' ] == $traverse_recurse[ 'fields' ][ $traverse_recurse[ 'depth' ] + 1 ] ) {&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'meta_table' ]}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info[ 'meta_field_index' ]}` = '{$traverse[ 'name' ]}'&nbsp;</div></li><li><div>                        AND `{$field_joined}`.`{$table_info[ 'meta_field_id' ]}` = `{$traverse_recurse[ 'joined' ]}`.`{$traverse_recurse[ 'joined_id' ]}`&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $table_info[ 'recurse' ] = false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $the_join = &quot;&nbsp;</div></li><li><div>                    LEFT JOIN `{$table_info[ 'meta_table' ]}` AS `{$field_joined}` ON&nbsp;</div></li><li><div>                        `{$field_joined}`.`{$table_info[ 'meta_field_index' ]}` = '{$traverse[ 'name' ]}'&nbsp;</div></li><li><div>                        AND `{$field_joined}`.`{$table_info[ 'meta_field_id' ]}` = `{$traverse_recurse[ 'joined' ]}`.`{$traverse_recurse[ 'joined_id' ]}`&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $joined_id = $table_info[ 'meta_field_id' ];&nbsp;</div></li><li><div>                $joined_index = $table_info[ 'meta_field_index' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $traverse_recursive = array(&nbsp;</div></li><li><div>            'pod' =&gt; pods_var_raw( 'name', pods_var_raw( 'pod', $table_info ) ), &nbsp;</div></li><li><div>            'fields' =&gt; $traverse_recurse[ 'fields' ], &nbsp;</div></li><li><div>            'joined' =&gt; $field_joined, &nbsp;</div></li><li><div>            'depth' =&gt; ( $traverse_recurse[ 'depth' ] + 1 ), &nbsp;</div></li><li><div>            'joined_id' =&gt; $joined_id, &nbsp;</div></li><li><div>            'joined_index' =&gt; $joined_index, &nbsp;</div></li><li><div>            'params' =&gt; $traverse_recurse[ 'params' ], &nbsp;</div></li><li><div>            'rel_alias' =&gt; $rel_alias, &nbsp;</div></li><li><div>            'last_table_info' =&gt; $table_info&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $the_join = apply_filters( 'pods_data_traverse_the_join', $the_join, $traverse_recurse, $traverse_recursive, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $the_join ) )&nbsp;</div></li><li><div>            return $joins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $joins[ $traverse_recurse[ 'pod' ] . '_' . $traverse_recurse[ 'depth' ] . '_' . $traverse[ 'id' ] ] = $the_join;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( $traverse_recurse[ 'depth' ] + 1 ) &lt; count( $traverse_recurse[ 'fields' ] ) && !empty( $traverse_recurse[ 'pod' ] ) && false !== $table_info[ 'recurse' ] )&nbsp;</div></li><li><div>            $joins = array_merge( $joins, $this-&gt;traverse_recurse( $traverse_recursive ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $joins;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Recursively join tables based on fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $fields Fields to recurse&nbsp;</div></li><li><div>     * @param null $all_fields (optional) If $fields is empty then traverse all fields, argument does not need to be passed&nbsp;</div></li><li><div>     * @param object $params (optional) Parameters from build()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of joins&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function traverse ( $fields = null, $all_fields = null, $params = null ) {&nbsp;</div></li><li><div>        $joins = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null === $fields )&nbsp;</div></li><li><div>            $fields = $this-&gt;traverse_build( $all_fields, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( (array) $fields as $field_group ) {&nbsp;</div></li><li><div>            $traverse_recurse = array(&nbsp;</div></li><li><div>                'pod' =&gt; $this-&gt;pod, &nbsp;</div></li><li><div>                'fields' =&gt; $fields, &nbsp;</div></li><li><div>                'params' =&gt; $params, &nbsp;</div></li><li><div>                'last_table_info' =&gt; $this-&gt;pod_data, &nbsp;</div></li><li><div>                'joined_id' =&gt; $this-&gt;pod_data[ 'field_id' ], &nbsp;</div></li><li><div>                'joined_index' =&gt; $this-&gt;pod_data[ 'field_index' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $field_group ) ) {&nbsp;</div></li><li><div>                $traverse_recurse[ 'fields' ] = $field_group;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $joins = array_merge( $joins, $this-&gt;traverse_recurse( $traverse_recurse ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $joins = array_merge( $joins, $this-&gt;traverse_recurse( $traverse_recurse ) );&nbsp;</div></li><li><div>                $joins = array_filter( $joins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $joins;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $joins = array_filter( $joins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $joins;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle filters / actions for the class&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function do_hook () {&nbsp;</div></li><li><div>        $args = func_get_args();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $args ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = array_shift( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return pods_do_hook( 'data', $name, $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the complete sql&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_sql ( $sql ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $sql ) )&nbsp;</div></li><li><div>            $sql = $this-&gt;sql;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = str_replace( array( '@wp_users', '@wp_' ), array( $wpdb-&gt;users, $wpdb-&gt;prefix ), $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = str_replace( '{prefix}', '@wp_', $sql );&nbsp;</div></li><li><div>        $sql = str_replace( '{/prefix/}', '{prefix}', $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $sql;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.5.2</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/classes/pods_data/" class="active">2.6</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/classes/pods_data/" class="">2.5.5</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.4/classes/pods_data/" class="">2.5.4</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.3/classes/pods_data/" class="">2.5.3</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.2/classes/pods_data/" class="">2.5.2</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PodsData</li><li><span></span>Pods - Custom Content Types and Fields</li><li><span></span>2.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>