<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.6" data-slug="pods-custom-content-types-and-fields" data-type="class" data-id="59665"><head xmlns="http://www.w3.org/1999/xhtml"><title> podsmigrate | class | Pods Custom Content Types And Fields | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PodsMigrate, class, plugin, pods-custom-content-types-and-fields, 2.6" /><meta name="description" content="The Pods - Custom Content Types and Fields PodsMigrate class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=43adbbd8b8eb049611be3f1b7c5f6a79' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pods_migrate/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpods_migrate%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpods_migrate%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-pods-custom-content-types-and-fields-2.6-class-pods_migrate","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pods_migrate" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to pods-custom-content-types-and&hellip;." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/" class="plugin"><span property="name">pods-custom-content-types-and&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.6." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/" class="H_VERSION"><span property="name">2.6</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pods_migrate</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="726"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/all/" title="All">All <span class="count badge">726</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="474"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/hooks/" title="Hooks">Hooks <span class="count badge">474</span></a></li><li class="" data-id="action" data-count="109"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/actions/" title="Actions">Actions <span class="count badge">109</span></a></li><li class="" data-id="filter" data-count="365"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/filters/" title="Filters">Filters <span class="count badge">365</span></a></li><li class="active" data-id="class" data-count="70"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/classes/" title="Classes">Classes <span class="count badge">70</span></a></li><li class="" data-id="constant" data-count="18"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/constants/" title="Constants">Constants <span class="count badge">18</span></a></li><li class="" data-id="function" data-count="156"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/functions/" title="Functions">Functions <span class="count badge">156</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PodsMigrate</strong></h1><p>The Pods - Custom Content Types and Fields <strong>PodsMigrate</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/files/classes-podsmigrate/" class="file">/classes/PodsMigrate.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="5" class="block" start="5"><li><div>class PodsMigrate {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var null|string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $type = 'php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $types = array( 'php', 'json', 'sv', 'xml' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $mimes = array(&nbsp;</div></li><li><div>        'json' =&gt; 'application/json', &nbsp;</div></li><li><div>        'csv' =&gt; 'text/csv', &nbsp;</div></li><li><div>        'tsv' =&gt; 'text/tsv', &nbsp;</div></li><li><div>        'xml' =&gt; 'text/xml', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var null|string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $delimiter = ', ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $data = array(&nbsp;</div></li><li><div>        'items' =&gt; array(), &nbsp;</div></li><li><div>        'columns' =&gt; array(), &nbsp;</div></li><li><div>        'fields' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $input;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $parsed;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $built;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Migrate Data to and from Pods&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $type Export Type (php, json, sv, xml)&nbsp;</div></li><li><div>     * @param string $delimiter Delimiter for export type 'sv'&nbsp;</div></li><li><div>     * @param array $data Array of data settings&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return \PodsMigrate&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @license http://www.gnu.org/licenses/gpl-2.0.html&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct ( $type = null, $delimiter = null, $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $type ) && in_array( $type, $this-&gt;types ) )&nbsp;</div></li><li><div>            $this-&gt;type = $type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $delimiter ) )&nbsp;</div></li><li><div>            $this-&gt;delimiter = $delimiter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function set_data ( $data ) {&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'items' =&gt; array(), &nbsp;</div></li><li><div>            'columns' =&gt; array(), &nbsp;</div></li><li><div>            'fields' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;data = array_merge( $defaults, (array) $data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Importing / Parsing / Validating Code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     * @param string $type Export Type (php, json, sv, xml)&nbsp;</div></li><li><div>     * @param string $delimiter Delimiter for export type 'sv'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function import ( $data = null, $type = null, $delimiter = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;input = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $type ) && in_array( $type, $this-&gt;types ) )&nbsp;</div></li><li><div>            $this-&gt;type = $type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $delimiter ) )&nbsp;</div></li><li><div>            $this-&gt;delimiter = $delimiter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( method_exists( $this, &quot;parse_{$this-&gt;type}&quot; ) )&nbsp;</div></li><li><div>            call_user_func( array( $this, 'parse_' . $this-&gt;type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;import_pod_items();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     * @param string $type Export Type (php, json, sv, xml)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function import_pod_items ( $data = null, $type = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;input = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $type ) && in_array( $type, $this-&gt;types ) )&nbsp;</div></li><li><div>            $this-&gt;type = $type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     * @param string $type Export Type (php, json, sv, xml)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse ( $data = null, $type = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;input = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $type ) && in_array( $type, $this-&gt;types ) )&nbsp;</div></li><li><div>            $this-&gt;type = $type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( method_exists( $this, &quot;parse_{$this-&gt;type}&quot; ) )&nbsp;</div></li><li><div>            return call_user_func( array( $this, 'parse_' . $this-&gt;type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;parsed;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_json ( $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;input = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $items = @json_decode( $this-&gt;input, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $items ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array(&nbsp;</div></li><li><div>            'columns' =&gt; array(), &nbsp;</div></li><li><div>            'items' =&gt; array(), &nbsp;</div></li><li><div>            'fields' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $items as $key =&gt; $item ) {&nbsp;</div></li><li><div>            if ( !is_array( $item ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $item as $column =&gt; $value ) {&nbsp;</div></li><li><div>                if ( !in_array( $column, $data[ 'columns' ] ) )&nbsp;</div></li><li><div>                    $data[ 'columns' ][] = $column;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data[ 'items' ][ $key ] = $item;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;parsed = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;parsed;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     * @param string $delimiter Delimiter for export type 'sv'&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_sv ( $data = null, $delimiter = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;input = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $delimiter ) )&nbsp;</div></li><li><div>            $this-&gt;delimiter = $delimiter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $rows = $this-&gt;str_getcsv( $this-&gt;input, '\n' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $rows ) || 2 &gt; count( $rows ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array(&nbsp;</div></li><li><div>            'columns' =&gt; array(), &nbsp;</div></li><li><div>            'items' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $rows as $key =&gt; $row ) {&nbsp;</div></li><li><div>            if ( 0 == $key )&nbsp;</div></li><li><div>                $data[ 'columns' ] = $this-&gt;str_getcsv( $row, $this-&gt;delimiter );&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $row = $this-&gt;str_getcsv( $row, $this-&gt;delimiter );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $data[ 'items' ][ $key ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $data[ 'columns' ] as $ckey =&gt; $column ) {&nbsp;</div></li><li><div>                    $data[ 'items' ][ $key ][ $column ] = ( isset( $row[ $ckey ] ) ? $row[ $ckey ] : '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'NULL' === $data[ 'items' ][ $key ][ $column ] )&nbsp;</div></li><li><div>                        $data[ 'items' ][ $key ][ $column ] = null;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;parsed = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;parsed;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle str_getcsv for cases where it's not set&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $line&nbsp;</div></li><li><div>     * @param string $delimiter&nbsp;</div></li><li><div>     * @param string $enclosure&nbsp;</div></li><li><div>     * @param string $escape&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function str_getcsv ( $line, $delimiter = ', ', $enclosure = '&quot;', $escape = '\\' ) {&nbsp;</div></li><li><div>        $line = str_replace( &quot;\r\n&quot;, &quot;\n&quot;, $line );&nbsp;</div></li><li><div>        $line = str_replace( &quot;\r&quot;, &quot;\n&quot;, $line );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( '\n' != $delimiter && function_exists( 'str_getcsv' ) )&nbsp;</div></li><li><div>            return str_getcsv( $line, $delimiter, $enclosure, $escape );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $delimiter = str_replace( '/', '\/', $delimiter );&nbsp;</div></li><li><div>        $enclosure = preg_quote( $enclosure, '/' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $split = &quot;/{$delimiter}(?=(?:[^{$enclosure}]*{$enclosure}[^{$enclosure}]*{$enclosure})*(?![^{$enclosure}]*{$enclosure}))/&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = preg_split( $split, trim( $line ), -1, PREG_SPLIT_NO_EMPTY );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( '\n' != $delimiter )&nbsp;</div></li><li><div>            $data = preg_replace( &quot;/^{$enclosure}(.*) {$enclosure}$/s&quot;, &quot;$1&quot;, $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_xml ( $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;input = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $xml = new SimpleXMLElement( $this-&gt;input );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $xml-&gt;items ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array( 'columns' =&gt; array(), 'items' =&gt; array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $child SimpleXMLElement&nbsp;</div></li><li><div>         * @var $item_child SimpleXMLElement&nbsp;</div></li><li><div>         * @var $data_child SimpleXMLElement&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $xml-&gt;columns ) ) {&nbsp;</div></li><li><div>            foreach ( $xml-&gt;columns-&gt;children() as $child ) {&nbsp;</div></li><li><div>                $sub = $child-&gt;getName();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $sub ) || 'column' != $sub )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $child-&gt;name ) ) {&nbsp;</div></li><li><div>                    if ( is_array( $child-&gt;name ) )&nbsp;</div></li><li><div>                        $column = $child-&gt;name[ 0 ];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $column = $child-&gt;name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $data[ 'columns' ][] = $column;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $xml-&gt;items-&gt;children() as $child ) {&nbsp;</div></li><li><div>            $sub = $child-&gt;getName();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $sub ) || 'item' != $sub )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $item = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $attributes = $child-&gt;attributes();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $attributes ) ) {&nbsp;</div></li><li><div>                foreach ( $attributes as $column =&gt; $value ) {&nbsp;</div></li><li><div>                    if ( !in_array( $column, $data[ 'columns' ] ) )&nbsp;</div></li><li><div>                        $data[ 'columns' ][] = $column;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $item[ $column ] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $item_child = $child-&gt;children();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $item_child ) ) {&nbsp;</div></li><li><div>                foreach ( $item_child-&gt;children() as $data_child ) {&nbsp;</div></li><li><div>                    $column = $data_child-&gt;getName();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !in_array( $column, $data[ 'columns' ] ) )&nbsp;</div></li><li><div>                        $data[ 'columns' ][] = $column;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $item[ $column ] = $item_child-&gt;$column;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $item ) )&nbsp;</div></li><li><div>                $data[ 'items' ][] = $item;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;parsed = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;parsed;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @todo For much much later&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_sql ( $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;input = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;parsed = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;parsed;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Exporting / Building Code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     * @param string $type Export Type (php, json, sv, xml)&nbsp;</div></li><li><div>     * @param string $delimiter Delimiter for export type 'sv'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function export ( $data = null, $type = null, $delimiter = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $type ) && in_array( $type, $this-&gt;types ) )&nbsp;</div></li><li><div>            $this-&gt;type = $type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $delimiter ) )&nbsp;</div></li><li><div>            $this-&gt;delimiter = $delimiter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( method_exists( $this, &quot;build_{$this-&gt;type}&quot; ) )&nbsp;</div></li><li><div>            call_user_func( array( $this, 'build_' . $this-&gt;type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;built;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function export_pod_items ( $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     * @param string $type Export Type (php, json, sv, xml)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function build ( $data = null, $type = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $type ) && in_array( $type, $this-&gt;types ) )&nbsp;</div></li><li><div>            $this-&gt;type = $type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( method_exists( $this, &quot;build_{$this-&gt;type}&quot; ) )&nbsp;</div></li><li><div>            call_user_func( array( $this, 'build_' . $this-&gt;type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function build_json ( $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $this-&gt;data ) || !is_array( $this-&gt;data ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array(&nbsp;</div></li><li><div>            'items' =&gt; array(&nbsp;</div></li><li><div>                'count' =&gt; count( $this-&gt;data[ 'items' ] ), &nbsp;</div></li><li><div>                'item' =&gt; array()&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;data[ 'items' ] as $item ) {&nbsp;</div></li><li><div>            $row = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $this-&gt;data[ 'columns' ] as $column =&gt; $label ) {&nbsp;</div></li><li><div>                if ( is_numeric( $column ) && ( ( is_object( $item ) && !isset( $item-&gt;$column ) ) || ( is_array( $item ) && !isset( $item[ $column ] ) ) ) )&nbsp;</div></li><li><div>                    $column = $label;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_object( $item ) ) {&nbsp;</div></li><li><div>                    if ( !isset( $item-&gt;$column ) )&nbsp;</div></li><li><div>                        $item-&gt;$column = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = $item-&gt;$column;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( is_array( $item ) ) {&nbsp;</div></li><li><div>                    if ( !isset( $item[ $column ] ) )&nbsp;</div></li><li><div>                        $item[ $column ] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = $item[ $column ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $row[ $column ] = $value;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data[ 'items' ][ 'item' ][] = $row;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;built = @json_encode( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;built;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     * @param string $delimiter Delimiter for export type 'sv'&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function build_sv ( $data = null, $delimiter = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $delimiter ) )&nbsp;</div></li><li><div>            $this-&gt;delimiter = $delimiter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $this-&gt;data ) || !is_array( $this-&gt;data ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $head = $lines = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;data[ 'columns' ] as $column =&gt; $label ) {&nbsp;</div></li><li><div>            $head .= '&quot;' . $label . '&quot;' . $this-&gt;delimiter;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $head = substr( $head, 0, -1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;data[ 'items' ] as $item ) {&nbsp;</div></li><li><div>            $line = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $this-&gt;data[ 'columns' ] as $column =&gt; $label ) {&nbsp;</div></li><li><div>                if ( is_numeric( $column ) && ( ( is_object( $item ) && !isset( $item-&gt;$column ) ) || ( is_array( $item ) && !isset( $item[ $column ] ) ) ) )&nbsp;</div></li><li><div>                    $column = $label;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_object( $item ) ) {&nbsp;</div></li><li><div>                    if ( !isset( $item-&gt;$column ) )&nbsp;</div></li><li><div>                        $item-&gt;$column = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = $item-&gt;$column;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( is_array( $item ) ) {&nbsp;</div></li><li><div>                    if ( !isset( $item[ $column ] ) )&nbsp;</div></li><li><div>                        $item[ $column ] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = $item[ $column ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $value ) || is_object( $value ) )&nbsp;</div></li><li><div>                    $value = pods_serial_comma( $value, array( 'field' =&gt; $column, 'fields' =&gt; pods_var_raw( $column, $this-&gt;data[ 'fields' ] ), 'and' =&gt; '' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $value = str_replace( array( '&quot;', &quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot; ), array( '\\&quot;', &quot;\n&quot;, &quot;\n&quot;, '\n' ), $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $line .= '&quot;' . $value . '&quot;' . $this-&gt;delimiter;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $lines .= substr( $line, 0, -1 ) . &quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $lines ) )&nbsp;</div></li><li><div>            $lines = &quot;\n&quot; . substr( $lines, 0, -1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;built = $head . $lines;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;built;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function build_xml ( $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $this-&gt;data ) || !is_array( $this-&gt;data ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $head = '&lt;' . '?' . 'xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ' . '?' . '&gt;' . &quot;\r\n&lt;items count=\&quot;&quot; . count( $this-&gt;data[ 'items' ] ) . &quot;\&quot;&gt;\r\n&quot;;&nbsp;</div></li><li><div>        $lines = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;data[ 'items' ] as $item ) {&nbsp;</div></li><li><div>            $line = &quot;\t&lt;item&gt;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $this-&gt;data[ 'columns' ] as $column =&gt; $label ) {&nbsp;</div></li><li><div>                if ( is_numeric( $column ) && ( ( is_object( $item ) && !isset( $item-&gt;$column ) ) || ( is_array( $item ) && !isset( $item[ $column ] ) ) ) )&nbsp;</div></li><li><div>                    $column = $label;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $line .= $this-&gt;build_xml_level( $item, $column );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $line .= &quot;\t&lt;/item&gt;\r\n&quot;;&nbsp;</div></li><li><div>            $lines .= $line;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $foot = '&lt;/items&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;built = $head . $lines . $foot;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;built;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function build_xml_level ( $item, $column, $level = 2, $column_name = '' ) {&nbsp;</div></li><li><div>        $column = pods_clean_name( $column, false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $line = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $item ) ) {&nbsp;</div></li><li><div>            if ( !isset( $item-&gt;$column ) )&nbsp;</div></li><li><div>                $item-&gt;$column = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $value = $item-&gt;$column;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( is_array( $item ) ) {&nbsp;</div></li><li><div>            if ( !isset( $item[ $column ] ) )&nbsp;</div></li><li><div>                $item[ $column ] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $value = $item[ $column ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $column_name ) )&nbsp;</div></li><li><div>            $column = $column_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tabs = str_repeat( &quot;\t&quot;, $level );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $line .= $tabs . &quot;&lt;{$column}&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $value ) || is_object( $value ) ) {&nbsp;</div></li><li><div>            if ( is_object( $value ) )&nbsp;</div></li><li><div>                $value = get_object_vars( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $value as $k =&gt; $v ) {&nbsp;</div></li><li><div>                if ( is_int( $k ) )&nbsp;</div></li><li><div>                    $line .= $this-&gt;build_xml_level( $value, $k, $level + 1, 'value' );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $line .= $this-&gt;build_xml_level( $value, $k, $level + 1 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( false !== strpos( $value, '&lt;' ) ) {&nbsp;</div></li><li><div>            $value = str_replace( array( '&lt;![CDATA[', ']]&gt;' ), array( '&lt;![CDATA[', ']]&gt;' ), $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $line .= &quot;&lt;![CDATA[&quot; . $value . &quot;]]&gt;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $line .= str_replace( '&', '&amp;', $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $line .= &quot;&lt;/{$column}&gt;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $line;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param array $data Array of data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function build_sql ( $data = null ) {&nbsp;</div></li><li><div>        if ( !empty( $data ) )&nbsp;</div></li><li><div>            $this-&gt;set_data( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;built = $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;built;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save export to a file&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save() {&nbsp;</div></li><li><div>        $extension = 'txt';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'sv' == $this-&gt;type ) {&nbsp;</div></li><li><div>            if ( ', ' == $this-&gt;delimiter )&nbsp;</div></li><li><div>                $extension = 'csv';&nbsp;</div></li><li><div>            elseif ( &quot;\t&quot; == $this-&gt;delimiter )&nbsp;</div></li><li><div>                $extension = 'tsv';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $extension = $this-&gt;type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $export_file = 'pods_export_' . wp_create_nonce( date_i18n( 'm-d-Y_h-i-sa' ) ) . '.' . $extension;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !( ( $uploads = wp_upload_dir( current_time( 'mysql' ) ) ) && false === $uploads[ 'error' ] ) )&nbsp;</div></li><li><div>            return pods_error( __( 'There was an issue saving the export file in your uploads folder.', 'pods' ), true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Generate unique file name&nbsp;</div></li><li><div>        $filename = wp_unique_filename( $uploads[ 'path' ], $export_file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // move the file to the uploads dir&nbsp;</div></li><li><div>        $new_file = $uploads[ 'path' ] . '/' . $filename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        file_put_contents( $new_file, $this-&gt;built );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set correct file permissions&nbsp;</div></li><li><div>        $stat = stat( dirname( $new_file ) );&nbsp;</div></li><li><div>        $perms = $stat[ 'mode' ] & 0000666;&nbsp;</div></li><li><div>        @chmod( $new_file, $perms );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the file type&nbsp;</div></li><li><div>        $wp_filetype = wp_check_filetype( $filename, $this-&gt;mimes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // construct the attachment array&nbsp;</div></li><li><div>        $attachment = array(&nbsp;</div></li><li><div>            'post_mime_type' =&gt; ( !$wp_filetype[ 'type' ] ? 'text/' . $extension : $wp_filetype[ 'type' ] ), &nbsp;</div></li><li><div>            'guid' =&gt; $uploads[ 'url' ] . '/' . $filename, &nbsp;</div></li><li><div>            'post_parent' =&gt; null, &nbsp;</div></li><li><div>            'post_title' =&gt; 'Pods Export (' . $export_file . ')', &nbsp;</div></li><li><div>            'post_content' =&gt; '', &nbsp;</div></li><li><div>            'post_status' =&gt; 'private'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // insert attachment&nbsp;</div></li><li><div>        $attachment_id = wp_insert_attachment( $attachment, $new_file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // error!&nbsp;</div></li><li><div>        if ( is_wp_error( $attachment_id ) )&nbsp;</div></li><li><div>            return pods_error( __( 'There was an issue saving the export file in your uploads folder.', 'pods' ), true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $attachment[ 'guid' ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    * The real enchilada!&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    /** EXAMPLES&nbsp;</div></li><li><div>    //// minimal import (if your fields match on both your pods and tables)&nbsp;</div></li><li><div>    $import = array('my_pod' =&gt; array('table' =&gt; 'my_table')); // if your table name doesn't match the pod name&nbsp;</div></li><li><div>    $import = array('my_pod'); // if your table name matches your pod name&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    //// advanced import&nbsp;</div></li><li><div>    $import = array();&nbsp;</div></li><li><div>    $import['my_pod'] = array();&nbsp;</div></li><li><div>    $import['my_pod']['fields']['this_field'] = 'field_name_in_table'; // if the field name doesn't match on table and pod&nbsp;</div></li><li><div>    $import['my_pod']['fields'][] = 'that_field'; // if the field name matches on table and pod&nbsp;</div></li><li><div>    $import['my_pod']['fields']['this_other_field'] = array('filter' =&gt; 'wpautop'); // if you want the value to be different than is provided, set a filter function to use [filter uses = filter_name($value, $rowdata)]&nbsp;</div></li><li><div>    $import['my_pod']['fields']['another_field'] = array('field' =&gt; 'the_real_field_in_table', 'filter' =&gt; 'my_custom_function'); // if you want the value to be filtered, and the field name doesn't match on the table and pod&nbsp;</div></li><li><div>    $import[] = 'my_other_pod'; // if your table name matches your pod name&nbsp;</div></li><li><div>    $import['another_pod'] = array('update_on' =&gt; 'main_field'); // you can update a pod item if the value of this field is the same on both tables&nbsp;</div></li><li><div>    $import['another_pod'] = array('reset' =&gt; true); // you can choose to reset all data in a pod before importing&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    //// run import&nbsp;</div></li><li><div>    pods_import_it($import);&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param $import&nbsp;</div></li><li><div>     * @param bool $output&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function heres_the_beef ( $import, $output = true ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $api = pods_api();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ( $i = 0; $i &lt; 40000; $i++ ) {&nbsp;</div></li><li><div>            echo &quot;  \t&quot;; // extra spaces&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $default_data = array(&nbsp;</div></li><li><div>            'pod' =&gt; null, &nbsp;</div></li><li><div>            'table' =&gt; null, &nbsp;</div></li><li><div>            'reset' =&gt; null, &nbsp;</div></li><li><div>            'update_on' =&gt; null, &nbsp;</div></li><li><div>            'where' =&gt; null, &nbsp;</div></li><li><div>            'fields' =&gt; array(), &nbsp;</div></li><li><div>            'row_filter' =&gt; null, &nbsp;</div></li><li><div>            'pre_save' =&gt; null, &nbsp;</div></li><li><div>            'post_save' =&gt; null, &nbsp;</div></li><li><div>            'sql' =&gt; null, &nbsp;</div></li><li><div>            'sort' =&gt; null, &nbsp;</div></li><li><div>            'limit' =&gt; null, &nbsp;</div></li><li><div>            'page' =&gt; null, &nbsp;</div></li><li><div>            'output' =&gt; null, &nbsp;</div></li><li><div>            'page_var' =&gt; 'ipg', &nbsp;</div></li><li><div>            'bypass_helpers' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $default_field_data = array( 'field' =&gt; null, 'filter' =&gt; null );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $import ) )&nbsp;</div></li><li><div>            $import = array( $import );&nbsp;</div></li><li><div>        elseif ( empty( $import ) )&nbsp;</div></li><li><div>            die( '&lt;h1 style=&quot;color:red;font-weight:bold;&quot;&gt;ERROR: No imports configured&lt;/h1&gt;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $import_counter = 0;&nbsp;</div></li><li><div>        $total_imports = count( $import );&nbsp;</div></li><li><div>        $paginated = false;&nbsp;</div></li><li><div>        $avg_time = -1;&nbsp;</div></li><li><div>        $total_time = 0;&nbsp;</div></li><li><div>        $counter = 0;&nbsp;</div></li><li><div>        $avg_unit = 100;&nbsp;</div></li><li><div>        $avg_counter = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $import as $datatype =&gt; $data ) {&nbsp;</div></li><li><div>            $import_counter++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            flush();&nbsp;</div></li><li><div>            @ob_end_flush();&nbsp;</div></li><li><div>            usleep( 50000 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !is_array( $data ) ) {&nbsp;</div></li><li><div>                $datatype = $data;&nbsp;</div></li><li><div>                $data = array( 'table' =&gt; $data );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $data[ 0 ] ) )&nbsp;</div></li><li><div>                $data = array( 'table' =&gt; $data[ 0 ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data = array_merge( $default_data, $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( null === $data[ 'pod' ] )&nbsp;</div></li><li><div>                $data[ 'pod' ] = array( 'name' =&gt; $datatype );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $output )&nbsp;</div></li><li><div>                echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - &lt;strong&gt;Loading Pod: &quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/strong&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 2 &gt; count( $data[ 'pod' ] ) )&nbsp;</div></li><li><div>                $data[ 'pod' ] = $api-&gt;load_pod( array( 'name' =&gt; $data[ 'pod' ][ 'name' ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $data[ 'pod' ][ 'fields' ] ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( null === $data[ 'table' ] )&nbsp;</div></li><li><div>                $data[ 'table' ] = $data[ 'pod' ][ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $data[ 'reset' ] === true ) {&nbsp;</div></li><li><div>                if ( false !== $output )&nbsp;</div></li><li><div>                    echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - &lt;strong style='color:blue;'&gt;Resetting Pod: &quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/strong&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $api-&gt;reset_pod( array( 'id' =&gt; $data[ 'pod' ][ 'id' ], 'name' =&gt; $data[ 'pod' ][ 'name' ] ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( null === $data[ 'sort' ] && null !== $data[ 'update_on' ] && isset( $data[ 'fields' ][ $data[ 'update_on' ] ] ) ) {&nbsp;</div></li><li><div>                if ( isset( $data[ 'fields' ][ $data[ 'update_on' ] ][ 'field' ] ) )&nbsp;</div></li><li><div>                    $data[ 'sort' ] = $data[ 'fields' ][ $data[ 'update_on' ] ][ 'field' ];&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $data[ 'sort' ] = $data[ 'update_on' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $page = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $data[ 'page_var' ] && isset( $_GET[ $data[ 'page_var' ] ] ) )&nbsp;</div></li><li><div>                $page = absval( $_GET[ $data[ 'page_var' ] ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( null === $data[ 'sql' ] )&nbsp;</div></li><li><div>                $data[ 'sql' ] = &quot;SELECT * FROM {$data['table']}&quot; . ( null !== $data[ 'where' ] ? &quot; WHERE {$data['where']}&quot; : '' ) . ( null !== $data[ 'sort' ] ? &quot; ORDER BY {$data['sort']}&quot; : '' ) . ( null !== $data[ 'limit' ] ? &quot; LIMIT &quot; . ( 1 &lt; $page ? ( ( $page - 1 ) * $data[ 'limit' ] ) . ', ' : '' ) . &quot;{$data['limit']}&quot; : '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $output )&nbsp;</div></li><li><div>                echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Getting Results: &quot; . $data[ 'pod' ][ 'name' ] . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $output )&nbsp;</div></li><li><div>                echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Using Query: &lt;small&gt;&lt;code&gt;&quot; . $data[ 'sql' ] . &quot;&lt;/code&gt;&lt;/small&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $result = $wpdb-&gt;get_results( $data[ 'sql' ], ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $output )&nbsp;</div></li><li><div>                echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Results Found: &quot; . count( $result ) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $avg_time = -1;&nbsp;</div></li><li><div>            $total_time = 0;&nbsp;</div></li><li><div>            $counter = 0;&nbsp;</div></li><li><div>            $avg_unit = 100;&nbsp;</div></li><li><div>            $avg_counter = 0;&nbsp;</div></li><li><div>            $result_count = count( $result );&nbsp;</div></li><li><div>            $paginated = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $data[ 'page_var' ] && $result_count == $data[ 'limit' ] )&nbsp;</div></li><li><div>                $paginated = &quot;&lt;input type=\&quot;button\&quot; onclick=\&quot;document.location=\'&quot; . pods_ui_var_update( array( $data[ 'page_var' ] =&gt; $page + 1 ), false, false ) . &quot;\';\&quot; value=\&quot;  Continue Import &raquo;  \&quot; /&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $result_count &lt; $avg_unit && 5 &lt; $result_count )&nbsp;</div></li><li><div>                $avg_unit = number_format( $result_count / 5, 0, '', '' );&nbsp;</div></li><li><div>            elseif ( 2000 &lt; $result_count && 10 &lt; count( $data[ 'pod' ][ 'fields' ] ) )&nbsp;</div></li><li><div>                $avg_unit = 40;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data[ 'count' ] = $result_count;&nbsp;</div></li><li><div>            timer_start();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $output && 1 == $import_counter )&nbsp;</div></li><li><div>                echo &quot;&lt;div style='width:50%;background-color:navy;padding:10px 10px 30px 10px;color:#FFF;position:absolute;top:10px;left:25%;text-align:center;'&gt;&lt;p id='progress_status' align='center'&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Running Importer..&lt;/p&gt;&lt;br /&gt;&lt;small&gt;This will automatically update every &quot; . $avg_unit . &quot; rows&lt;/small&gt;&lt;/div&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $result as $k =&gt; $row ) {&nbsp;</div></li><li><div>                flush();&nbsp;</div></li><li><div>                @ob_end_flush();&nbsp;</div></li><li><div>                usleep( 50000 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false !== $output )&nbsp;</div></li><li><div>                    echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Processing Row #&quot; . ( $k + 1 ) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( null !== $data[ 'row_filter' ] && function_exists( $data[ 'row_filter' ] ) ) {&nbsp;</div></li><li><div>                    if ( false !== $output )&nbsp;</div></li><li><div>                        echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Filtering &lt;strong&gt;&quot; . $data[ 'row_filter' ] . &quot;&lt;/strong&gt; on Row #&quot; . ( $k + 1 ) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $row = $data[ 'row_filter' ]( $row, $data );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !is_array( $row ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $params = array(&nbsp;</div></li><li><div>                    'datatype' =&gt; $data[ 'pod' ][ 'name' ], &nbsp;</div></li><li><div>                    'columns' =&gt; array(), &nbsp;</div></li><li><div>                    'bypass_helpers' =&gt; $data[ 'bypass_helpers' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $data[ 'pod' ][ 'fields' ] as $fk =&gt; $field_info ) {&nbsp;</div></li><li><div>                    $field = $field_info[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $data[ 'fields' ] ) && !isset( $data[ 'fields' ][ $field ] ) && !in_array( $field, $data[ 'fields' ] ) )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $data[ 'fields' ][ $field ] ) ) {&nbsp;</div></li><li><div>                        if ( is_array( $data[ 'fields' ][ $field ] ) )&nbsp;</div></li><li><div>                            $field_data = $data[ 'fields' ][ $field ];&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $field_data = array( 'field' =&gt; $data[ 'fields' ][ $field ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $field_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !is_array( $field_data ) ) {&nbsp;</div></li><li><div>                        $field = $field_data;&nbsp;</div></li><li><div>                        $field_data = array();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $field_data = array_merge( $default_field_data, $field_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( null === $field_data[ 'field' ] )&nbsp;</div></li><li><div>                        $field_data[ 'field' ] = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $data[ 'fields' ][ $field ] = $field_data;&nbsp;</div></li><li><div>                    $value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $row[ $field_data[ 'field' ] ] ) )&nbsp;</div></li><li><div>                        $value = $row[ $field_data[ 'field' ] ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( null !== $field_data[ 'filter' ] ) {&nbsp;</div></li><li><div>                        if ( function_exists( $field_data[ 'filter' ] ) ) {&nbsp;</div></li><li><div>                            if ( false !== $output )&nbsp;</div></li><li><div>                                echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Filtering &lt;strong&gt;&quot; . $field_data[ 'filter' ] . &quot;&lt;/strong&gt; on Field: &quot; . $field . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $value = $field_data[ 'filter' ]( $value, $row, $data );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 1 &gt; strlen( $value ) && 1 == $field_info[ 'required' ] )&nbsp;</div></li><li><div>                        die( '&lt;h1 style=&quot;color:red;font-weight:bold;&quot;&gt;ERROR: Field Required for &lt;strong&gt;' . $field . '&lt;/strong&gt;&lt;/h1&gt;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $params[ 'columns' ][ $field ] = $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $value );&nbsp;</div></li><li><div>                    unset( $field_data );&nbsp;</div></li><li><div>                    unset( $field_info );&nbsp;</div></li><li><div>                    unset( $fk );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $params[ 'columns' ] ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $params[ 'columns' ] = pods_sanitize( $params[ 'columns' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( null !== $data[ 'update_on' ] && isset( $params[ 'columns' ][ $data[ 'update_on' ] ] ) ) {&nbsp;</div></li><li><div>                    if ( false !== $output )&nbsp;</div></li><li><div>                        echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Checking for Existing Item\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $check = new Pod( $data[ 'pod' ][ 'name' ] );&nbsp;</div></li><li><div>                    $check-&gt;findRecords( array(&nbsp;</div></li><li><div>                                             'orderby' =&gt; 't.id', &nbsp;</div></li><li><div>                                             'limit' =&gt; 1, &nbsp;</div></li><li><div>                                             'where' =&gt; &quot;t.{$data['update_on']} = '{$params['columns'][$data['update_on']]}'&quot;, &nbsp;</div></li><li><div>                                             'search' =&gt; false, &nbsp;</div></li><li><div>                                             'page' =&gt; 1&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 0 &lt; $check-&gt;getTotalRows() ) {&nbsp;</div></li><li><div>                        $check-&gt;fetchRecord();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $params[ 'tbl_row_id' ] = $check-&gt;get_field( 'id' );&nbsp;</div></li><li><div>                        $params[ 'pod_id' ] = $check-&gt;get_pod_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( false !== $output )&nbsp;</div></li><li><div>                            echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Found Existing Item w/ ID: &quot; . $params[ 'tbl_row_id' ] . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        unset( $check );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !isset( $params[ 'tbl_row_id' ] ) && false !== $output )&nbsp;</div></li><li><div>                        echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Existing item not found - Creating New\n&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( null !== $data[ 'pre_save' ] && function_exists( $data[ 'pre_save' ] ) ) {&nbsp;</div></li><li><div>                    if ( false !== $output )&nbsp;</div></li><li><div>                        echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Running Pre Save &lt;strong&gt;&quot; . $data[ 'pre_save' ] . &quot;&lt;/strong&gt; on &quot; . $data[ 'pod' ][ 'name' ] . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $params = $data[ 'pre_save' ]( $params, $row, $data );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $id = $api-&gt;save_pod_item( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false !== $output )&nbsp;</div></li><li><div>                    echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - &lt;strong&gt;Saved Row #&quot; . ( $k + 1 ) . &quot; w/ ID: &quot; . $id . &quot;&lt;/strong&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $params[ 'tbl_row_id' ] = $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( null !== $data[ 'post_save' ] && function_exists( $data[ 'post_save' ] ) ) {&nbsp;</div></li><li><div>                    if ( false !== $output )&nbsp;</div></li><li><div>                        echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - Running Post Save &lt;strong&gt;&quot; . $data[ 'post_save' ] . &quot;&lt;/strong&gt; on &quot; . $data[ 'pod' ][ 'name' ] . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $data[ 'post_save' ]( $params, $row, $data );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                unset( $params );&nbsp;</div></li><li><div>                unset( $result[ $k ] );&nbsp;</div></li><li><div>                unset( $row );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                wp_cache_flush();&nbsp;</div></li><li><div>                $wpdb-&gt;queries = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $avg_counter++;&nbsp;</div></li><li><div>                $counter++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $avg_counter == $avg_unit && false !== $output ) {&nbsp;</div></li><li><div>                    $avg_counter = 0;&nbsp;</div></li><li><div>                    $avg_time = timer_stop( 0, 10 );&nbsp;</div></li><li><div>                    $total_time += $avg_time;&nbsp;</div></li><li><div>                    $rows_left = $result_count - $counter;&nbsp;</div></li><li><div>                    $estimated_time_left = ( ( $total_time / $counter ) * $rows_left ) / 60;&nbsp;</div></li><li><div>                    $percent_complete = 100 - ( ( $rows_left * 100 ) / $result_count );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    echo &quot;&lt;script type='text/javascript'&gt;document.getElementById('progress_status').innerHTML = '&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt;&lt;br /&gt;&lt;strong&gt;&quot; . $percent_complete . &quot;% Complete&lt;/strong&gt;&lt;br /&gt;&lt;strong&gt;Estimated Time Left:&lt;/strong&gt; &quot; . $estimated_time_left . &quot; minute(s) or &quot; . ( $estimated_time_left / 60 ) . &quot; hours(s)&lt;br /&gt;&lt;strong&gt;Time Spent:&lt;/strong&gt; &quot; . ( $total_time / 60 ) . &quot; minute(s)&lt;br /&gt;&lt;strong&gt;Rows Done:&lt;/strong&gt; &quot; . ( $result_count - $rows_left ) . &quot;/&quot; . $result_count . &quot;&lt;br /&gt;&lt;strong&gt;Rows Left:&lt;/strong&gt; &quot; . $rows_left . &quot;';&lt;/script&gt;\n&quot;;&nbsp;</div></li><li><div>                    echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - &lt;strong&gt;Updated Status:&lt;/strong&gt; &quot; . $percent_complete . &quot;% Complete&lt;/strong&gt;\n&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $output ) {&nbsp;</div></li><li><div>                $avg_counter = 0;&nbsp;</div></li><li><div>                $avg_time = timer_stop( 0, 10 );&nbsp;</div></li><li><div>                $total_time += $avg_time;&nbsp;</div></li><li><div>                $rows_left = $result_count - $counter;&nbsp;</div></li><li><div>                $estimated_time_left = ( ( $total_time / $counter ) * $rows_left ) / 60;&nbsp;</div></li><li><div>                $percent_complete = 100 - ( ( $rows_left * 100 ) / $result_count );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                echo &quot;&lt;script type='text/javascript'&gt;document.getElementById('progress_status').innerHTML = '&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt;&lt;br /&gt;&lt;strong style=\'color:green;\'&gt;100% Complete&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;&lt;strong&gt;Time Spent:&lt;/strong&gt; &quot; . ( $total_time / 60 ) . &quot; minute(s)&lt;br /&gt;&lt;strong&gt;Rows Imported:&lt;/strong&gt; &quot; . $result_count . ( false !== $paginated ? &quot;&lt;br /&gt;&lt;br /&gt;&quot; . $paginated : '' ) . &quot;';&lt;/script&gt;\n&quot;;&nbsp;</div></li><li><div>                echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;em&gt;&quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/em&gt; - &lt;strong style='color:green;'&gt;Done Importing: &quot; . $data[ 'pod' ][ 'name' ] . &quot;&lt;/strong&gt;\n&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $result );&nbsp;</div></li><li><div>            unset( $import[ $datatype ] );&nbsp;</div></li><li><div>            unset( $datatype );&nbsp;</div></li><li><div>            unset( $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_cache_flush();&nbsp;</div></li><li><div>            $wpdb-&gt;queries = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $output ) {&nbsp;</div></li><li><div>            $avg_counter = 0;&nbsp;</div></li><li><div>            $avg_time = timer_stop( 0, 10 );&nbsp;</div></li><li><div>            $total_time += $avg_time;&nbsp;</div></li><li><div>            $rows_left = $result_count - $counter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            echo &quot;&lt;script type='text/javascript'&gt;document.getElementById('progress_status').innerHTML = '&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;strong style=\'color:green;\'&gt;Import Complete&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;&lt;strong&gt;Time Spent:&lt;/strong&gt; &quot; . ( $total_time / 60 ) . &quot; minute(s)&lt;br /&gt;&lt;strong&gt;Rows Imported:&lt;/strong&gt; &quot; . $result_count . ( false !== $paginated ? &quot;&lt;br /&gt;&lt;br /&gt;&quot; . $paginated : '' ) . &quot;';&lt;/script&gt;\n&quot;;&nbsp;</div></li><li><div>            echo &quot;&lt;br /&gt;&quot; . date( 'Y-m-d h:i:sa' ) . &quot; - &lt;strong style='color:green;'&gt;Import Complete&lt;/strong&gt;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.5.2</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/classes/pods_migrate/" class="active">2.6</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/classes/pods_migrate/" class="">2.5.5</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.4/classes/pods_migrate/" class="">2.5.4</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.3/classes/pods_migrate/" class="">2.5.3</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.2/classes/pods_migrate/" class="">2.5.2</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PodsMigrate</li><li><span></span>Pods - Custom Content Types and Fields</li><li><span></span>2.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>