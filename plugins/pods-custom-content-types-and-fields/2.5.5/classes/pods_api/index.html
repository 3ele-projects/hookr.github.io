<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.5.5" data-slug="pods-custom-content-types-and-fields" data-type="class" data-id="59334"><head xmlns="http://www.w3.org/1999/xhtml"><title> podsapi | class | Pods Custom Content Types And Fields | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PodsAPI, class, plugin, pods-custom-content-types-and-fields, 2.5.5" /><meta name="description" content="The Pods - Custom Content Types and Fields PodsAPI class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=7eba2261b18a908fd71e26be68cf1890' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pods_api/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpods_api%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpods_api%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-pods-custom-content-types-and-fields-2.5.5-class-pods_api","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pods_api" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to pods-custom-content-types-and&hellip;." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/" class="plugin"><span property="name">pods-custom-content-types-and&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.5.5." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/" class="H_VERSION"><span property="name">2.5.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pods_api</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="721"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/all/" title="All">All <span class="count badge">721</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="471"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/hooks/" title="Hooks">Hooks <span class="count badge">471</span></a></li><li class="" data-id="action" data-count="109"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/actions/" title="Actions">Actions <span class="count badge">109</span></a></li><li class="" data-id="filter" data-count="362"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/filters/" title="Filters">Filters <span class="count badge">362</span></a></li><li class="active" data-id="class" data-count="68"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/classes/" title="Classes">Classes <span class="count badge">68</span></a></li><li class="" data-id="constant" data-count="18"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/constants/" title="Constants">Constants <span class="count badge">18</span></a></li><li class="" data-id="function" data-count="156"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/functions/" title="Functions">Functions <span class="count badge">156</span></a></li><li class="" data-id="shortcode" data-count="8"><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">8</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PodsAPI</strong></h1><p>The Pods - Custom Content Types and Fields <strong>PodsAPI</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/files/classes-podsapi/" class="file">/classes/PodsAPI.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="5" class="block" start="5"><li><div>class PodsAPI {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var PodsAPI&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static $instance = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array PodsAPI&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static $instances = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $display_errors = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array|bool|mixed|null|void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $pod_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $pod_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     * @deprecated 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $format = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $deprecated;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @since 2.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $fields_cache = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @since 2.5&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $table_info_cache = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @since 2.5&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static $related_item_cache = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Singleton-ish handling for a basic pods_api() request&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $pod (optional) The pod name&nbsp;</div></li><li><div>     * @param string $format (deprecated) Format for import/export, &quot;php&quot; or &quot;csv&quot;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return \PodsAPI&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function init ( $pod = null, $format = null ) {&nbsp;</div></li><li><div>        if ( null !== $pod || null !== $format ) {&nbsp;</div></li><li><div>            if ( ! isset( self::$instances[ $pod ] ) ) {&nbsp;</div></li><li><div>                // Cache API singleton per Pod&nbsp;</div></li><li><div>                self::$instances[ $pod ] = new PodsAPI( $pod, $format );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return self::$instances[ $pod ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( !is_object( self::$instance ) ) {&nbsp;</div></li><li><div>            self::$instance = new PodsAPI();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::$instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Store and retrieve data programatically&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $pod (optional) The pod name&nbsp;</div></li><li><div>     * @param string $format (deprecated) Format for import/export, &quot;php&quot; or &quot;csv&quot;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return \PodsAPI&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @license http://www.gnu.org/licenses/gpl-2.0.html&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct ( $pod = null, $format = null ) {&nbsp;</div></li><li><div>        if ( null !== $pod && 0 &lt; strlen( (string) $pod ) ) {&nbsp;</div></li><li><div>            if ( null !== $format ) {&nbsp;</div></li><li><div>                $this-&gt;format = $format;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                pods_deprecated( 'pods_api( $pod, $format )', '2.0', 'pods_api( $pod )' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod = pods_clean_name( $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'name' =&gt; $pod, 'table_info' =&gt; true ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod ) ) {&nbsp;</div></li><li><div>                $this-&gt;pod_data = $pod;&nbsp;</div></li><li><div>                $this-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>                $this-&gt;pod_id = $pod[ 'id' ];&nbsp;</div></li><li><div>                $this-&gt;fields = $pod[ 'fields' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a WP object and its meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $object_type Object type: post|user|comment|setting&nbsp;</div></li><li><div>     * @param array $data All post data to be saved&nbsp;</div></li><li><div>     * @param array $meta (optional) Associative array of meta keys and values&nbsp;</div></li><li><div>     * @param bool $strict (optional) Decides whether the previous saved meta should be deleted or not&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Will unsanitize the data, should be passed if the data is sanitized before sending.&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|mixed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_wp_object ( $object_type, $data, $meta = array(), $strict = false, $sanitized = false, $fields = array() ) {&nbsp;</div></li><li><div>        if ( in_array( $object_type, array( 'post_type', 'media' ) ) )&nbsp;</div></li><li><div>            $object_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $sanitized ) {&nbsp;</div></li><li><div>            $data = pods_unsanitize( $data );&nbsp;</div></li><li><div>            $meta = pods_unsanitize( $meta );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $object_type, array( 'post', 'user', 'comment' ) ) )&nbsp;</div></li><li><div>            return call_user_func( array( $this, 'save_' . $object_type ), $data, $meta, $strict, false, $fields );&nbsp;</div></li><li><div>        elseif ( 'settings' == $object_type ) {&nbsp;</div></li><li><div>            // Nothing to save&nbsp;</div></li><li><div>            if ( empty( $meta ) )&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $this-&gt;save_setting( pods_var( 'option_id', $data ), $meta, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete a WP object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $object_type Object type: post|user|comment&nbsp;</div></li><li><div>     * @param int $id Object ID&nbsp;</div></li><li><div>     * @param bool $force_delete (optional) Force deletion instead of trashing (post types only)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|mixed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_wp_object ( $object_type, $id, $force_delete = true ) {&nbsp;</div></li><li><div>        if ( in_array( $object_type, array( 'post_type', 'media' ) ) )&nbsp;</div></li><li><div>            $object_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $id ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $object_type, array( 'post' ) ) )&nbsp;</div></li><li><div>            return wp_delete_post( $id, $force_delete );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( function_exists( 'wp_delete_' . $object_type ) )&nbsp;</div></li><li><div>            return call_user_func( 'wp_delete_' . $object_type, $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a post and it's meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $post_data All post data to be saved (using wp_insert_post / wp_update_post)&nbsp;</div></li><li><div>     * @param array $post_meta (optional) All meta to be saved (set value to null to delete)&nbsp;</div></li><li><div>     * @param bool $strict (optional) Whether to delete previously saved meta not in $post_meta&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Will unsanitize the data, should be passed if the data is sanitized before sending.&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed|void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_post ( $post_data, $post_meta = null, $strict = false, $sanitized = false, $fields = array() ) {&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $post_data ) || empty( $post_data ) )&nbsp;</div></li><li><div>            $post_data = array( 'post_title' =&gt; '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $post_meta ) )&nbsp;</div></li><li><div>            $post_meta = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $sanitized ) {&nbsp;</div></li><li><div>            $post_data = pods_unsanitize( $post_data );&nbsp;</div></li><li><div>            $post_meta = pods_unsanitize( $post_meta );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $post_data[ 'ID' ] ) || empty( $post_data[ 'ID' ] ) )&nbsp;</div></li><li><div>            $post_data[ 'ID' ] = wp_insert_post( $post_data, true );&nbsp;</div></li><li><div>        elseif ( 2 &lt; count( $post_data ) || !isset( $post_data[ 'post_type' ] ) )&nbsp;</div></li><li><div>            wp_update_post( $post_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $post_data[ 'ID' ] ) ) {&nbsp;</div></li><li><div>            if ( !$conflicted )&nbsp;</div></li><li><div>                pods_no_conflict_off( 'post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * @var $post_error WP_Error&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $post_error = $post_data[ 'ID' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return pods_error( $post_error-&gt;get_error_message(), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;save_post_meta( $post_data[ 'ID' ], $post_meta, $strict, $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $post_data[ 'ID' ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a post's meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $id Post ID&nbsp;</div></li><li><div>     * @param array $post_meta All meta to be saved (set value to null to delete)&nbsp;</div></li><li><div>     * @param bool $strict Whether to delete previously saved meta not in $post_meta&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Id of the post with the meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_post_meta ( $id, $post_meta = null, $strict = false, $fields = array() ) {&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $post_meta ) )&nbsp;</div></li><li><div>            $post_meta = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta = get_post_meta( $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $meta as $k =&gt; $value ) {&nbsp;</div></li><li><div>            if ( is_array( $value ) && 1 == count( $value ) )&nbsp;</div></li><li><div>                $meta[ $k ] = current( $value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $post_meta as $meta_key =&gt; $meta_value ) {&nbsp;</div></li><li><div>            if ( null === $meta_value || ( $strict && '' === $post_meta[ $meta_key ] ) ) {&nbsp;</div></li><li><div>                $old_meta_value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $meta[ $meta_key ] ) )&nbsp;</div></li><li><div>                    $old_meta_value = $meta[ $meta_key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                delete_post_meta( $id, $meta_key, $old_meta_value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $simple = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $fields[ $meta_key ] ) ) {&nbsp;</div></li><li><div>                    $field_data = $fields[ $meta_key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $simple = ( 'pick' == $field_data[ 'type' ] && in_array( pods_var( 'pick_object', $field_data ), $simple_tableless_objects ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $simple ) {&nbsp;</div></li><li><div>                    delete_post_meta( $id, $meta_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    update_post_meta( $id, '_pods_' . $meta_key, $meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( ! is_array( $meta_value ) ) {&nbsp;</div></li><li><div>                        $meta_value = array( $meta_value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $meta_value as $value ) {&nbsp;</div></li><li><div>                        add_post_meta( $id, $meta_key, $value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    update_post_meta( $id, $meta_key, $meta_value );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $strict ) {&nbsp;</div></li><li><div>            foreach ( $meta as $meta_key =&gt; $meta_value ) {&nbsp;</div></li><li><div>                if ( !isset( $post_meta[ $meta_key ] ) )&nbsp;</div></li><li><div>                    delete_post_meta( $id, $meta_key, $meta_value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a user and it's meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $user_data All user data to be saved (using wp_insert_user / wp_update_user)&nbsp;</div></li><li><div>     * @param array $user_meta (optional) All meta to be saved (set value to null to delete)&nbsp;</div></li><li><div>     * @param bool $strict (optional) Whether to delete previously saved meta not in $user_meta&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Will unsanitize the data, should be passed if the data is sanitized before sending.&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Returns user id on success&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_user ( $user_data, $user_meta = null, $strict = false, $sanitized = false, $fields = array() ) {&nbsp;</div></li><li><div>        if ( !is_array( $user_data ) || empty( $user_data ) )&nbsp;</div></li><li><div>            return pods_error( __( 'User data is required but is either invalid or empty', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $user_meta ) )&nbsp;</div></li><li><div>            $user_meta = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $sanitized ) {&nbsp;</div></li><li><div>            $user_data = pods_unsanitize( $user_data );&nbsp;</div></li><li><div>            $user_meta = pods_unsanitize( $user_meta );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set role&nbsp;</div></li><li><div>        if ( isset( $user_meta[ 'role' ] ) ) {&nbsp;</div></li><li><div>            $user_data[ 'role' ] = $user_meta[ 'role' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $user_meta[ 'role' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $user_data[ 'ID' ] ) || empty( $user_data[ 'ID' ] ) )&nbsp;</div></li><li><div>            $user_data[ 'ID' ] = wp_insert_user( $user_data );&nbsp;</div></li><li><div>        elseif ( 1 &lt; count( $user_data ) )&nbsp;</div></li><li><div>            wp_update_user( $user_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $user_data[ 'ID' ] ) ) {&nbsp;</div></li><li><div>            if ( !$conflicted )&nbsp;</div></li><li><div>                pods_no_conflict_off( 'user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * @var $user_error WP_Error&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $user_error = $user_data[ 'ID' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return pods_error( $user_error-&gt;get_error_message(), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;save_user_meta( $user_data[ 'ID' ], $user_meta, $strict, $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $user_data[ 'ID' ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a user meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $id User ID&nbsp;</div></li><li><div>     * @param array $user_meta (optional) All meta to be saved (set value to null to delete)&nbsp;</div></li><li><div>     * @param bool $strict (optional) Whether to delete previously saved meta not in $user_meta&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int User ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_user_meta ( $id, $user_meta = null, $strict = false, $fields = array() ) {&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $user_meta ) )&nbsp;</div></li><li><div>            $user_meta = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta = get_user_meta( $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $user_meta as $meta_key =&gt; $meta_value ) {&nbsp;</div></li><li><div>            if ( null === $meta_value ) {&nbsp;</div></li><li><div>                $old_meta_value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $meta[ $meta_key ] ) )&nbsp;</div></li><li><div>                    $old_meta_value = $meta[ $meta_key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                delete_user_meta( $id, $meta_key, $old_meta_value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $simple = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $fields[ $meta_key ] ) ) {&nbsp;</div></li><li><div>                    $field_data = $fields[ $meta_key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $simple = ( 'pick' == $field_data[ 'type' ] && in_array( pods_var( 'pick_object', $field_data ), $simple_tableless_objects ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $simple ) {&nbsp;</div></li><li><div>                    delete_user_meta( $id, $meta_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( ! is_array( $meta_value ) ) {&nbsp;</div></li><li><div>                        $meta_value = array( $meta_value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $meta_value as $value ) {&nbsp;</div></li><li><div>                        add_user_meta( $id, $meta_key, $value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    update_user_meta( $id, $meta_key, $meta_value );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $strict ) {&nbsp;</div></li><li><div>            foreach ( $meta as $meta_key =&gt; $meta_value ) {&nbsp;</div></li><li><div>                if ( !isset( $user_meta[ $meta_key ] ) )&nbsp;</div></li><li><div>                    delete_user_meta( $id, $meta_key, $user_meta[ $meta_key ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a comment and it's meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $comment_data All comment data to be saved (using wp_insert_comment / wp_update_comment)&nbsp;</div></li><li><div>     * @param array $comment_meta (optional) All meta to be saved (set value to null to delete)&nbsp;</div></li><li><div>     * @param bool $strict (optional) Whether to delete previously saved meta not in $comment_meta&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Will unsanitize the data, should be passed if the data is sanitized before sending.&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Comment ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_comment ( $comment_data, $comment_meta = null, $strict = false, $sanitized = false, $fields = array() ) {&nbsp;</div></li><li><div>        if ( !is_array( $comment_data ) || empty( $comment_data ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Comment data is required but is either invalid or empty', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $comment_meta ) )&nbsp;</div></li><li><div>            $comment_meta = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $sanitized ) {&nbsp;</div></li><li><div>            $comment_data = pods_unsanitize( $comment_data );&nbsp;</div></li><li><div>            $comment_meta = pods_unsanitize( $comment_meta );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $comment_data[ 'comment_ID' ] ) || empty( $comment_data[ 'comment_ID' ] ) )&nbsp;</div></li><li><div>            $comment_data[ 'comment_ID' ] = wp_insert_comment( pods_slash( $comment_data ) ); // Expects slashed&nbsp;</div></li><li><div>        elseif ( 1 &lt; count( $comment_data ) )&nbsp;</div></li><li><div>            wp_update_comment( $comment_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $comment_data[ 'comment_ID' ] ) ) {&nbsp;</div></li><li><div>            if ( !$conflicted )&nbsp;</div></li><li><div>                pods_no_conflict_off( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * @var $comment_error WP_Error&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $comment_error = $comment_data[ 'comment_ID' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return pods_error( $comment_error-&gt;get_error_message(), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;save_comment_meta( $comment_data[ 'comment_ID' ], $comment_meta, $strict, $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $comment_data[ 'comment_ID' ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a comment meta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $id Comment ID&nbsp;</div></li><li><div>     * @param array $comment_meta (optional) All meta to be saved (set value to null to delete)&nbsp;</div></li><li><div>     * @param bool $strict (optional) Whether to delete previously saved meta not in $comment_meta&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Comment ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_comment_meta ( $id, $comment_meta = null, $strict = false, $fields = array() ) {&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $comment_meta ) )&nbsp;</div></li><li><div>            $comment_meta = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta = get_comment_meta( $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $comment_meta as $meta_key =&gt; $meta_value ) {&nbsp;</div></li><li><div>            if ( null === $meta_value ) {&nbsp;</div></li><li><div>                $old_meta_value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $meta[ $meta_key ] ) )&nbsp;</div></li><li><div>                    $old_meta_value = $meta[ $meta_key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                delete_comment_meta( $id, $meta_key, $old_meta_value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $simple = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $fields[ $meta_key ] ) ) {&nbsp;</div></li><li><div>                    $field_data = $fields[ $meta_key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $simple = ( 'pick' == $field_data[ 'type' ] && in_array( pods_var( 'pick_object', $field_data ), $simple_tableless_objects ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $simple ) {&nbsp;</div></li><li><div>                    delete_comment_meta( $id, $meta_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( ! is_array( $meta_value ) ) {&nbsp;</div></li><li><div>                        $meta_value = array( $meta_value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $meta_value as $value ) {&nbsp;</div></li><li><div>                        add_comment_meta( $id, $meta_key, $value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    update_comment_meta( $id, $meta_key, $meta_value );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $strict ) {&nbsp;</div></li><li><div>            foreach ( $meta as $meta_key =&gt; $meta_value ) {&nbsp;</div></li><li><div>                if ( !isset( $comment_meta[ $meta_key ] ) )&nbsp;</div></li><li><div>                    delete_comment_meta( (int) $id, $meta_key, $comment_meta[ $meta_key ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a taxonomy's term&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $term_ID Term ID, leave empty to add&nbsp;</div></li><li><div>     * @param string $term Term name&nbsp;</div></li><li><div>     * @param string $taxonomy Taxonomy name&nbsp;</div></li><li><div>     * @param array $term_data All term data to be saved (using wp_insert_term / wp_update_term)&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Will unsanitize the data, should be passed if the data is sanitized before sending.&nbsp;</div></li><li><div>     * @param array $fields (optional) The array of fields and their options, for further processing with&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Term ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_term ( $term_ID, $term, $taxonomy, $term_data, $sanitized = false, $fields = array() ) {&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'taxonomy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'taxonomy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $term_data ) )&nbsp;</div></li><li><div>            $term_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $term_ID = (int) $term_ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $sanitized ) {&nbsp;</div></li><li><div>            $term = pods_unsanitize( $term );&nbsp;</div></li><li><div>            $taxonomy = pods_unsanitize( $taxonomy );&nbsp;</div></li><li><div>            $term_data = pods_unsanitize( $term_data );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $term_ID ) )&nbsp;</div></li><li><div>            $term_ID = wp_insert_term( $term, $taxonomy, $term_data );&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $term ) )&nbsp;</div></li><li><div>                $term_data[ 'term' ] = $term;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $term_data ) ) {&nbsp;</div></li><li><div>                if ( !$conflicted )&nbsp;</div></li><li><div>                    pods_no_conflict_off( 'taxonomy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return pods_error( __( 'Taxonomy term data is required but is either invalid or empty', 'pods' ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_update_term( $term_ID, $taxonomy, $term_data );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $term_ID ) ) {&nbsp;</div></li><li><div>            if ( !$conflicted )&nbsp;</div></li><li><div>                pods_no_conflict_off( 'taxonomy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return pods_error( $term_ID-&gt;get_error_message(), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( is_array( $term_ID ) )&nbsp;</div></li><li><div>            $term_ID = $term_ID[ 'term_id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'taxonomy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $term_ID;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a set of options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $setting Setting group name&nbsp;</div></li><li><div>     * @param array $option_data All option data to be saved&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Will unsanitize the data, should be passed if the data is sanitized before sending.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_setting ( $setting, $option_data, $sanitized = false ) {&nbsp;</div></li><li><div>        if ( !is_array( $option_data ) || empty( $option_data ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Setting data is required but is either invalid or empty', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $conflicted = pods_no_conflict_check( 'settings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_on( 'settings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $sanitized )&nbsp;</div></li><li><div>            $option_data = pods_unsanitize( $option_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $option_data as $option =&gt; $value ) {&nbsp;</div></li><li><div>            if ( !empty( $setting ) )&nbsp;</div></li><li><div>                $option = $setting . '_' . $option;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            update_option( $option, $value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$conflicted )&nbsp;</div></li><li><div>            pods_no_conflict_off( 'settings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Rename a WP object's type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $object_type Object type: post|taxonomy|comment|setting&nbsp;</div></li><li><div>     * @param string $old_name The old name&nbsp;</div></li><li><div>     * @param string $new_name The new name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function rename_wp_object_type ( $object_type, $old_name, $new_name ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'post_type' == $object_type )&nbsp;</div></li><li><div>            $object_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'post' == $object_type ) {&nbsp;</div></li><li><div>            pods_query( &quot;UPDATE `{$wpdb-&gt;posts}` SET `post_type` = %s WHERE `post_type` = %s&quot;, array(&nbsp;</div></li><li><div>                $new_name, &nbsp;</div></li><li><div>                $old_name&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'taxonomy' == $object_type ) {&nbsp;</div></li><li><div>            pods_query( &quot;UPDATE `{$wpdb-&gt;term_taxonomy}` SET `taxonomy` = %s WHERE `taxonomy` = %s&quot;, array(&nbsp;</div></li><li><div>                $new_name, &nbsp;</div></li><li><div>                $old_name&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'comment' == $object_type ) {&nbsp;</div></li><li><div>            pods_query( &quot;UPDATE `{$wpdb-&gt;comments}` SET `comment_type` = %s WHERE `comment_type` = %s&quot;, array(&nbsp;</div></li><li><div>                $new_name, &nbsp;</div></li><li><div>                $old_name&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'settings' == $object_type ) {&nbsp;</div></li><li><div>            pods_query( &quot;UPDATE `{$wpdb-&gt;options}` SET `option_name` = REPLACE( `option_name`, %s, %s ) WHERE `option_name` LIKE '&quot; . pods_sanitize_like( $old_name ) . &quot;_%'&quot;, array(&nbsp;</div></li><li><div>                $new_name . '_', &nbsp;</div></li><li><div>                $old_name . '_'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a list of core WP object fields for a specific object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $object The pod type to look for, possible values: post_type, user, comment, taxonomy&nbsp;</div></li><li><div>     * @param array $pod Array of Pod data&nbsp;</div></li><li><div>     * @param boolean $refresh Whether to force refresh the information&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_wp_object_fields ( $object = 'post_type', $pod = null, $refresh = false ) {&nbsp;</div></li><li><div>        $pod_name = pods_var_raw( 'name', $pod, $object, null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'media' == $pod_name ) {&nbsp;</div></li><li><div>            $object = 'post_type';&nbsp;</div></li><li><div>            $pod_name = 'attachment';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() )&nbsp;</div></li><li><div>            $fields = pods_transient_get( trim( 'pods_api_object_fields_' . $object . $pod_name . '_', '_' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $fields && !$refresh )&nbsp;</div></li><li><div>            return $this-&gt;do_hook( 'get_wp_object_fields', $fields, $object, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'post_type' == $object ) {&nbsp;</div></li><li><div>            $fields = array(&nbsp;</div></li><li><div>                'ID' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'ID', &nbsp;</div></li><li><div>                    'label' =&gt; 'ID', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'id' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_title' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_title', &nbsp;</div></li><li><div>                    'label' =&gt; 'Title', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'title', 'name' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'display_filter' =&gt; 'the_title', &nbsp;</div></li><li><div>                        'display_filter_args' =&gt; array( 'post_ID' )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_content' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_content', &nbsp;</div></li><li><div>                    'label' =&gt; 'Content', &nbsp;</div></li><li><div>                    'type' =&gt; 'wysiwyg', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'content' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'wysiwyg_allowed_html_tags' =&gt; '', &nbsp;</div></li><li><div>                        'display_filter' =&gt; 'the_content', &nbsp;</div></li><li><div>                        'pre_save' =&gt; 0&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_excerpt' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_excerpt', &nbsp;</div></li><li><div>                    'label' =&gt; 'Excerpt', &nbsp;</div></li><li><div>                    'type' =&gt; 'paragraph', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'excerpt' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'paragraph_allow_html' =&gt; 1, &nbsp;</div></li><li><div>                        'paragraph_allowed_html_tags' =&gt; '', &nbsp;</div></li><li><div>                        'display_filter' =&gt; 'the_excerpt', &nbsp;</div></li><li><div>                        'pre_save' =&gt; 0&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_author' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_author', &nbsp;</div></li><li><div>                    'label' =&gt; 'Author', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'author' ), &nbsp;</div></li><li><div>                    'pick_object' =&gt; 'user', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'pick_format_type' =&gt; 'single', &nbsp;</div></li><li><div>                        'pick_format_single' =&gt; 'autocomplete', &nbsp;</div></li><li><div>                        'default_value' =&gt; '{@user.ID}'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_date' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_date', &nbsp;</div></li><li><div>                    'label' =&gt; 'Publish Date', &nbsp;</div></li><li><div>                    'type' =&gt; 'datetime', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'created', 'date' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_date_gmt' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_date_gmt', &nbsp;</div></li><li><div>                    'label' =&gt; 'Publish Date (GMT)', &nbsp;</div></li><li><div>                    'type' =&gt; 'datetime', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_status' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_status', &nbsp;</div></li><li><div>                    'label' =&gt; 'Status', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'pick_object' =&gt; 'post-status', &nbsp;</div></li><li><div>                    'default' =&gt; $this-&gt;do_hook( 'default_status_' . $pod_name, pods_var( 'default_status', pods_var_raw( 'options', $pod ), 'draft', null, true ), $pod ), &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'status' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_status' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_status', &nbsp;</div></li><li><div>                    'label' =&gt; 'Comment Status', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'default' =&gt; get_option( 'default_comment_status', 'open' ), &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'data' =&gt; array(&nbsp;</div></li><li><div>                        'open' =&gt; __( 'Open', 'pods' ), &nbsp;</div></li><li><div>                        'closed' =&gt; __( 'Closed', 'pods' )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'ping_status' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'ping_status', &nbsp;</div></li><li><div>                    'label' =&gt; 'Ping Status', &nbsp;</div></li><li><div>                    'default' =&gt; get_option( 'default_ping_status', 'open' ), &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'data' =&gt; array(&nbsp;</div></li><li><div>                        'open' =&gt; __( 'Open', 'pods' ), &nbsp;</div></li><li><div>                        'closed' =&gt; __( 'Closed', 'pods' )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_password' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_password', &nbsp;</div></li><li><div>                    'label' =&gt; 'Password', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_name' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_name', &nbsp;</div></li><li><div>                    'label' =&gt; 'Permalink', &nbsp;</div></li><li><div>                    'type' =&gt; 'slug', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'slug', 'permalink' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'to_ping' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'to_ping', &nbsp;</div></li><li><div>                    'label' =&gt; 'To Ping', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'pinged' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'pinged', &nbsp;</div></li><li><div>                    'label' =&gt; 'Pinged', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_modified' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_modified', &nbsp;</div></li><li><div>                    'label' =&gt; 'Last Modified Date', &nbsp;</div></li><li><div>                    'type' =&gt; 'datetime', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'modified' ), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_modified_gmt' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_modified_gmt', &nbsp;</div></li><li><div>                    'label' =&gt; 'Last Modified Date (GMT)', &nbsp;</div></li><li><div>                    'type' =&gt; 'datetime', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_content_filtered' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_content_filtered', &nbsp;</div></li><li><div>                    'label' =&gt; 'Content (filtered)', &nbsp;</div></li><li><div>                    'type' =&gt; 'paragraph', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true, &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'paragraph_allow_html' =&gt; 1, &nbsp;</div></li><li><div>                        'paragraph_oembed' =&gt; 1, &nbsp;</div></li><li><div>                        'paragraph_wptexturize' =&gt; 1, &nbsp;</div></li><li><div>                        'paragraph_convert_chars' =&gt; 1, &nbsp;</div></li><li><div>                        'paragraph_wpautop' =&gt; 1, &nbsp;</div></li><li><div>                        'paragraph_allow_shortcode' =&gt; 1, &nbsp;</div></li><li><div>                        'paragraph_allowed_html_tags' =&gt; ''&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_parent' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_parent', &nbsp;</div></li><li><div>                    'label' =&gt; 'Parent', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'pick_object' =&gt; 'post_type', &nbsp;</div></li><li><div>                    'pick_val' =&gt; '__current__', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'parent' ), &nbsp;</div></li><li><div>                    'data' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'guid' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'guid', &nbsp;</div></li><li><div>                    'label' =&gt; 'GUID', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'menu_order' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'menu_order', &nbsp;</div></li><li><div>                    'label' =&gt; 'Menu Order', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_type' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_type', &nbsp;</div></li><li><div>                    'label' =&gt; 'Type', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'type' ), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'post_mime_type' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'post_mime_type', &nbsp;</div></li><li><div>                    'label' =&gt; 'Mime Type', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_count' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_count', &nbsp;</div></li><li><div>                    'label' =&gt; 'Comment Count', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod ) ) {&nbsp;</div></li><li><div>                $taxonomies = get_object_taxonomies( $pod_name, 'objects' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $taxonomies as $taxonomy ) {&nbsp;</div></li><li><div>                    $fields[ $taxonomy-&gt;name ] = array(&nbsp;</div></li><li><div>                        'name' =&gt; $taxonomy-&gt;name, &nbsp;</div></li><li><div>                        'label' =&gt; $taxonomy-&gt;labels-&gt;name, &nbsp;</div></li><li><div>                        'type' =&gt; 'taxonomy', &nbsp;</div></li><li><div>                        'pick_object' =&gt; 'taxonomy', &nbsp;</div></li><li><div>                        'pick_val' =&gt; $taxonomy-&gt;name, &nbsp;</div></li><li><div>                        'alias' =&gt; array(), &nbsp;</div></li><li><div>                        'hidden' =&gt; true, &nbsp;</div></li><li><div>                        'options' =&gt; array(&nbsp;</div></li><li><div>                            'taxonomy_format_type' =&gt; 'multi'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'user' == $object ) {&nbsp;</div></li><li><div>            $fields = array(&nbsp;</div></li><li><div>                'ID' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'ID', &nbsp;</div></li><li><div>                    'label' =&gt; 'ID', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'id' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'user_login' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'user_login', &nbsp;</div></li><li><div>                    'label' =&gt; 'Title', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'login' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'required' =&gt; 1&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'user_nicename' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'user_nicename', &nbsp;</div></li><li><div>                    'label' =&gt; 'Permalink', &nbsp;</div></li><li><div>                    'type' =&gt; 'slug', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'nicename', 'slug', 'permalink' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'display_name' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'display_name', &nbsp;</div></li><li><div>                    'label' =&gt; 'Display Name', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'title', 'name' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'user_pass' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'user_pass', &nbsp;</div></li><li><div>                    'label' =&gt; 'Password', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'password', 'pass' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'required' =&gt; 1, &nbsp;</div></li><li><div>                        'text_format_type' =&gt; 'password'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'user_email' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'user_email', &nbsp;</div></li><li><div>                    'label' =&gt; 'E-mail', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'email' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'required' =&gt; 1, &nbsp;</div></li><li><div>                        'text_format_type' =&gt; 'email'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'user_url' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'user_url', &nbsp;</div></li><li><div>                    'label' =&gt; 'URL', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'url', 'website' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'required' =&gt; 0, &nbsp;</div></li><li><div>                        'text_format_type' =&gt; 'website', &nbsp;</div></li><li><div>                        'text_format_website' =&gt; 'normal'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'user_registered' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'user_registered', &nbsp;</div></li><li><div>                    'label' =&gt; 'Registration Date', &nbsp;</div></li><li><div>                    'type' =&gt; 'date', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'created', 'date', 'registered' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'date_format_type' =&gt; 'datetime'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'comment' == $object ) {&nbsp;</div></li><li><div>            $fields = array(&nbsp;</div></li><li><div>                'comment_ID' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_ID', &nbsp;</div></li><li><div>                    'label' =&gt; 'ID', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'id', 'ID', 'comment_id' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_content' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_content', &nbsp;</div></li><li><div>                    'label' =&gt; 'Content', &nbsp;</div></li><li><div>                    'type' =&gt; 'wysiwyg', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'content' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_approved' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_approved', &nbsp;</div></li><li><div>                    'label' =&gt; 'Approved', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'approved' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_post_ID' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_post_ID', &nbsp;</div></li><li><div>                    'label' =&gt; 'Post', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'post', 'post_id' ), &nbsp;</div></li><li><div>                    'data' =&gt; array()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'user_id' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'user_id', &nbsp;</div></li><li><div>                    'label' =&gt; 'Author', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'author' ), &nbsp;</div></li><li><div>                    'pick_object' =&gt; 'user', &nbsp;</div></li><li><div>                    'data' =&gt; array()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_date' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_date', &nbsp;</div></li><li><div>                    'label' =&gt; 'Date', &nbsp;</div></li><li><div>                    'type' =&gt; 'date', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'created', 'date' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'date_format_type' =&gt; 'datetime'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_author' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_author', &nbsp;</div></li><li><div>                    'label' =&gt; 'Author', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'author' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_author_email' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_author_email', &nbsp;</div></li><li><div>                    'label' =&gt; 'Author E-mail', &nbsp;</div></li><li><div>                    'type' =&gt; 'email', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'author_email' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_author_url' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_author_url', &nbsp;</div></li><li><div>                    'label' =&gt; 'Author URL', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'author_url' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_author_IP' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_author_IP', &nbsp;</div></li><li><div>                    'label' =&gt; 'Author IP', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'author_IP' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_type' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_type', &nbsp;</div></li><li><div>                    'label' =&gt; 'Type', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'type' ), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'comment_parent' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'comment_parent', &nbsp;</div></li><li><div>                    'label' =&gt; 'Parent', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'pick_object' =&gt; 'comment', &nbsp;</div></li><li><div>                    'pick_val' =&gt; '__current__', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'parent' ), &nbsp;</div></li><li><div>                    'data' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'taxonomy' == $object ) {&nbsp;</div></li><li><div>            $fields = array(&nbsp;</div></li><li><div>                'term_id' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'term_id', &nbsp;</div></li><li><div>                    'label' =&gt; 'ID', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'id', 'ID' ), &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'name' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'name', &nbsp;</div></li><li><div>                    'label' =&gt; 'Title', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'title' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'slug' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'slug', &nbsp;</div></li><li><div>                    'label' =&gt; 'Permalink', &nbsp;</div></li><li><div>                    'type' =&gt; 'slug', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'permalink' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'description' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'description', &nbsp;</div></li><li><div>                    'label' =&gt; 'Description', &nbsp;</div></li><li><div>                    'type' =&gt; 'wysiwyg', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'content' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'taxonomy' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'taxonomy', &nbsp;</div></li><li><div>                    'label' =&gt; 'Taxonomy', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'alias' =&gt; array()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'parent' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'parent', &nbsp;</div></li><li><div>                    'label' =&gt; 'Parent', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'pick_object' =&gt; 'taxonomy', &nbsp;</div></li><li><div>                    'pick_val' =&gt; '__current__', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'parent' ), &nbsp;</div></li><li><div>                    'data' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'term_taxonomy_id' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'term_taxonomy_id', &nbsp;</div></li><li><div>                    'label' =&gt; 'Term Taxonomy ID', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true, &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'term_group' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'term_group', &nbsp;</div></li><li><div>                    'label' =&gt; 'Term Group', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array( 'group' ), &nbsp;</div></li><li><div>                    'hidden' =&gt; true, &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'count' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; 'count', &nbsp;</div></li><li><div>                    'label' =&gt; 'Count', &nbsp;</div></li><li><div>                    'type' =&gt; 'number', &nbsp;</div></li><li><div>                    'alias' =&gt; array(), &nbsp;</div></li><li><div>                    'hidden' =&gt; true, &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'number_format' =&gt; '9999.99'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = $this-&gt;do_hook( 'get_wp_object_fields', $fields, $object, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $fields as $field =&gt; $options ) {&nbsp;</div></li><li><div>            if ( !isset( $options[ 'alias' ] ) )&nbsp;</div></li><li><div>                $options[ 'alias' ] = array();&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $options[ 'alias' ] = (array) $options[ 'alias' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $options[ 'name' ] ) )&nbsp;</div></li><li><div>                $options[ 'name' ] = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fields[ $field ] = $options;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = PodsForm::fields_setup( $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( did_action( 'init' ) && pods_api_cache() )&nbsp;</div></li><li><div>            pods_transient_set( trim( 'pods_api_object_fields_' . $object . $pod_name . '_', '_' ), $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $fields;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see PodsAPI::save_pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Add a Pod via the Wizard&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['create_extend'] string Create or Extend a Content Type&nbsp;</div></li><li><div>     * $params['create_pod_type'] string Pod Type (for Creating)&nbsp;</div></li><li><div>     * $params['create_name'] string Pod Name (for Creating)&nbsp;</div></li><li><div>     * $params['create_label_plural'] string Plural Label (for Creating)&nbsp;</div></li><li><div>     * $params['create_label_singular'] string Singular Label (for Creating)&nbsp;</div></li><li><div>     * $params['create_storage'] string Storage Type (for Creating Post Types)&nbsp;</div></li><li><div>     * $params['create_storage_taxonomy'] string Storage Type (for Creating Taxonomies)&nbsp;</div></li><li><div>     * $params['extend_pod_type'] string Pod Type (for Extending)&nbsp;</div></li><li><div>     * $params['extend_post_type'] string Post Type (for Extending Post Types)&nbsp;</div></li><li><div>     * $params['extend_taxonomy'] string Taxonomy (for Extending Taxonomies)&nbsp;</div></li><li><div>     * $params['extend_storage'] string Storage Type (for Extending Post Types / Users / Comments)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|int Pod ID&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_pod ( $params ) {&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'create_extend' =&gt; 'create', &nbsp;</div></li><li><div>            'create_pod_type' =&gt; 'post_type', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'create_name' =&gt; '', &nbsp;</div></li><li><div>            'create_label_singular' =&gt; '', &nbsp;</div></li><li><div>            'create_label_plural' =&gt; '', &nbsp;</div></li><li><div>            'create_storage' =&gt; 'meta', &nbsp;</div></li><li><div>            'create_storage_taxonomy' =&gt; 'none', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'create_setting_name' =&gt; '', &nbsp;</div></li><li><div>            'create_label_title' =&gt; '', &nbsp;</div></li><li><div>            'create_label_menu' =&gt; '', &nbsp;</div></li><li><div>            'create_menu_location' =&gt; 'settings', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'extend_pod_type' =&gt; 'post_type', &nbsp;</div></li><li><div>            'extend_post_type' =&gt; 'post', &nbsp;</div></li><li><div>            'extend_taxonomy' =&gt; 'category', &nbsp;</div></li><li><div>            'extend_table' =&gt; '', &nbsp;</div></li><li><div>            'extend_storage_taxonomy' =&gt; 'table', &nbsp;</div></li><li><div>            'extend_storage' =&gt; 'meta'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) array_merge( $defaults, (array) $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;create_extend ) || !in_array( $params-&gt;create_extend, array( 'create', 'extend' ) ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Please choose whether to Create or Extend a Content Type', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod_params = array(&nbsp;</div></li><li><div>            'name' =&gt; '', &nbsp;</div></li><li><div>            'label' =&gt; '', &nbsp;</div></li><li><div>            'type' =&gt; '', &nbsp;</div></li><li><div>            'storage' =&gt; 'table', &nbsp;</div></li><li><div>            'object' =&gt; '', &nbsp;</div></li><li><div>            'options' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'create' == $params-&gt;create_extend ) {&nbsp;</div></li><li><div>            $label = ucwords( str_replace( '_', ' ', $params-&gt;create_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $params-&gt;create_label_singular ) )&nbsp;</div></li><li><div>                $label = $params-&gt;create_label_singular;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod_params[ 'name' ] = $params-&gt;create_name;&nbsp;</div></li><li><div>            $pod_params[ 'label' ] = ( !empty( $params-&gt;create_label_plural ) ? $params-&gt;create_label_plural : $label );&nbsp;</div></li><li><div>            $pod_params[ 'type' ] = $params-&gt;create_pod_type;&nbsp;</div></li><li><div>            $pod_params[ 'options' ] = array(&nbsp;</div></li><li><div>                'label_singular' =&gt; ( !empty( $params-&gt;create_label_singular ) ? $params-&gt;create_label_singular : $pod_params[ 'label' ] ), &nbsp;</div></li><li><div>                'public' =&gt; 1, &nbsp;</div></li><li><div>                'show_ui' =&gt; 1&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Auto-generate name if not provided&nbsp;</div></li><li><div>            if ( empty( $pod_params[ 'name' ] ) && !empty( $pod_params[ 'options' ][ 'label_singular' ] ) )&nbsp;</div></li><li><div>                $pod_params[ 'name' ] = pods_clean_name( $pod_params[ 'options' ][ 'label_singular' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                if ( empty(  $pod_params[ 'name' ] ) )&nbsp;</div></li><li><div>                    return pods_error( 'Please enter a Name for this Pod', $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod_params[ 'storage' ] = $params-&gt;create_storage;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_tableless() )&nbsp;</div></li><li><div>                    $pod_params[ 'storage' ] = 'meta';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                if ( empty(  $pod_params[ 'name' ] ) )&nbsp;</div></li><li><div>                    return pods_error( 'Please enter a Name for this Pod', $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod_params[ 'storage' ] = $params-&gt;create_storage_taxonomy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_tableless() )&nbsp;</div></li><li><div>                    $pod_params[ 'storage' ] = 'none';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'pod' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                if ( empty(  $pod_params[ 'name' ] ) )&nbsp;</div></li><li><div>                    return pods_error( 'Please enter a Name for this Pod', $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_tableless() ) {&nbsp;</div></li><li><div>                    $pod_params[ 'type' ] = 'post_type';&nbsp;</div></li><li><div>                    $pod_params[ 'storage' ] = 'meta';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'settings' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                $pod_params[ 'name' ] = $params-&gt;create_setting_name;&nbsp;</div></li><li><div>                $pod_params[ 'label' ] = ( !empty( $params-&gt;create_label_title ) ? $params-&gt;create_label_title : ucwords( str_replace( '_', ' ', $params-&gt;create_setting_name ) ) );&nbsp;</div></li><li><div>                $pod_params[ 'options' ] = array(&nbsp;</div></li><li><div>                    'menu_name' =&gt; ( !empty( $params-&gt;create_label_menu ) ? $params-&gt;create_label_menu : $pod_params[ 'label' ] ), &nbsp;</div></li><li><div>                    'menu_location' =&gt; $params-&gt;create_menu_location&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $pod_params[ 'storage' ] = 'none';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Auto-generate name if not provided&nbsp;</div></li><li><div>                if ( empty( $pod_params[ 'name' ] ) && !empty( $pod_params[ 'label' ] ) )&nbsp;</div></li><li><div>                    $pod_params[ 'name' ] = pods_clean_name( $pod_params[ 'label' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $pod_params[ 'name' ] ) )&nbsp;</div></li><li><div>                    return pods_error( 'Please enter a Name for this Pod', $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'extend' == $params-&gt;create_extend ) {&nbsp;</div></li><li><div>            $pod_params[ 'type' ] = $params-&gt;extend_pod_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                $pod_params[ 'storage' ] = $params-&gt;extend_storage;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_tableless() )&nbsp;</div></li><li><div>                    $pod_params[ 'storage' ] = 'meta';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod_params[ 'name' ] = $params-&gt;extend_post_type;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                $pod_params[ 'storage' ] = $params-&gt;extend_storage_taxonomy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_tableless() )&nbsp;</div></li><li><div>                    $pod_params[ 'storage' ] = 'none';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod_params[ 'name' ] = $params-&gt;extend_taxonomy;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'table' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                $pod_params[ 'storage' ] = 'table';&nbsp;</div></li><li><div>                $pod_params[ 'name' ] = $params-&gt;extend_table;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $pod_params[ 'storage' ] = $params-&gt;extend_storage;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_tableless() )&nbsp;</div></li><li><div>                    $pod_params[ 'storage' ] = 'meta';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod_params[ 'name' ] = $params-&gt;extend_pod_type;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod_params[ 'label' ] = ucwords( str_replace( '_', ' ', $pod_params[ 'name' ] ) );&nbsp;</div></li><li><div>            $pod_params[ 'object' ] = $pod_params[ 'name' ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod_params[ 'object' ] ) ) {&nbsp;</div></li><li><div>            if ( 'post_type' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                $check = get_post_type_object( $pod_params[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $check ) )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( 'Post Type %s already exists, try extending it instead', 'pods' ), $pod_params[ 'name' ] ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod_params[ 'options' ][ 'supports_title' ] = 1;&nbsp;</div></li><li><div>                $pod_params[ 'options' ][ 'supports_editor' ] = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $pod_params[ 'type' ] ) {&nbsp;</div></li><li><div>                $check = get_taxonomy( $pod_params[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $check ) )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( 'Taxonomy %s already exists, try extending it instead', 'pods' ), $pod_params[ 'name' ] ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod_params ) )&nbsp;</div></li><li><div>            return $this-&gt;save_pod( $pod_params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['name'] string The Pod name&nbsp;</div></li><li><div>     * $params['label'] string The Pod label&nbsp;</div></li><li><div>     * $params['type'] string The Pod type&nbsp;</div></li><li><div>     * $params['object'] string The object being extended (if any)&nbsp;</div></li><li><div>     * $params['storage'] string The Pod storage&nbsp;</div></li><li><div>     * $params['options'] array Options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Decides whether the params have been sanitized before being passed, will sanitize them if false.&nbsp;</div></li><li><div>     * @param bool|int $db (optional) Whether to save into the DB or just return Pod array.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Pod ID&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_pod ( $params, $sanitized = false, $db = true ) {&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $load_params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $load_params-&gt;id ) && isset( $load_params-&gt;name ) )&nbsp;</div></li><li><div>            unset( $load_params-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $load_params-&gt;old_name ) )&nbsp;</div></li><li><div>            $load_params-&gt;name = $load_params-&gt;old_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $load_params-&gt;table_info = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( $load_params, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $sanitized )&nbsp;</div></li><li><div>            $params = pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $old_id = $old_name = $old_storage = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $old_fields = $old_options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;name ) && ! isset( $params-&gt;object ) ) {&nbsp;</div></li><li><div>            $params-&gt;name = pods_clean_name( $params-&gt;name );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod ) ) {&nbsp;</div></li><li><div>            if ( isset( $params-&gt;id ) && 0 &lt; $params-&gt;id )&nbsp;</div></li><li><div>                $old_id = $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;id = $pod[ 'id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $old_name = $pod[ 'name' ];&nbsp;</div></li><li><div>            $old_storage = $pod[ 'storage' ];&nbsp;</div></li><li><div>            $old_fields = $pod[ 'fields' ];&nbsp;</div></li><li><div>            $old_options = $pod[ 'options' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;name ) && empty( $params-&gt;name ) )&nbsp;</div></li><li><div>                $params-&gt;name = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $old_name != $params-&gt;name && false !== $this-&gt;pod_exists( array( 'name' =&gt; $params-&gt;name ) ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( 'Pod %s already exists, you cannot rename %s to that', 'pods' ), $params-&gt;name, $old_name ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $old_name != $params-&gt;name && in_array( $pod[ 'type' ], array( 'user', 'comment', 'media' ) ) && in_array( $pod[ 'object' ], array( 'user', 'comment', 'media' ) ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( 'Pod %s cannot be renamed, it extends an existing WP Object', 'pods' ), $old_name ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $old_name != $params-&gt;name && in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) && !empty( $pod[ 'object' ] ) && $pod[ 'object' ] == $old_name )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( 'Pod %s cannot be renamed, it extends an existing WP Object', 'pods' ), $old_name ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $old_id != $params-&gt;id ) {&nbsp;</div></li><li><div>                if ( $params-&gt;type == $pod[ 'type' ] && isset( $params-&gt;object ) && $params-&gt;object == $pod[ 'object' ] )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( 'Pod using %s already exists, you can not reuse an object across multiple pods', 'pods' ), $params-&gt;object ), $this );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( 'Pod %s already exists', 'pods' ), $params-&gt;name ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $params-&gt;name, array( 'order', 'orderby', 'post_type' ) ) && 'post_type' == pods_var( 'type', $params ) ) {&nbsp;</div></li><li><div>            return pods_error( sprintf( 'There are certain names that a Custom Post Types cannot be named and unfortunately, %s is one of them.', $params-&gt;name ), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $pod = array(&nbsp;</div></li><li><div>                'id' =&gt; 0, &nbsp;</div></li><li><div>                'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                'label' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'type' =&gt; 'pod', &nbsp;</div></li><li><div>                'storage' =&gt; 'table', &nbsp;</div></li><li><div>                'object' =&gt; '', &nbsp;</div></li><li><div>                'alias' =&gt; '', &nbsp;</div></li><li><div>                'options' =&gt; array(), &nbsp;</div></li><li><div>                'fields' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Blank out fields and options for AJAX calls (everything should be sent to it for a full overwrite)&nbsp;</div></li><li><div>        if ( defined( 'DOING_AJAX' ) && DOING_AJAX ) {&nbsp;</div></li><li><div>            $pod[ 'fields' ] = array();&nbsp;</div></li><li><div>            $pod[ 'options' ] = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup options&nbsp;</div></li><li><div>        $options = get_object_vars( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $options[ 'method' ] ) )&nbsp;</div></li><li><div>            unset( $options[ 'method' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $options_ignore = array(&nbsp;</div></li><li><div>            'object_type', &nbsp;</div></li><li><div>            'object_name', &nbsp;</div></li><li><div>            'table', &nbsp;</div></li><li><div>            'meta_table', &nbsp;</div></li><li><div>            'pod_table', &nbsp;</div></li><li><div>            'field_id', &nbsp;</div></li><li><div>            'field_index', &nbsp;</div></li><li><div>            'field_slug', &nbsp;</div></li><li><div>            'field_type', &nbsp;</div></li><li><div>            'field_parent', &nbsp;</div></li><li><div>            'field_parent_select', &nbsp;</div></li><li><div>            'meta_field_id', &nbsp;</div></li><li><div>            'meta_field_index', &nbsp;</div></li><li><div>            'meta_field_value', &nbsp;</div></li><li><div>            'pod_field_id', &nbsp;</div></li><li><div>            'pod_field_index', &nbsp;</div></li><li><div>            'object_fields', &nbsp;</div></li><li><div>            'join', &nbsp;</div></li><li><div>            'where', &nbsp;</div></li><li><div>            'where_default', &nbsp;</div></li><li><div>            'orderby', &nbsp;</div></li><li><div>            'pod', &nbsp;</div></li><li><div>            'recurse', &nbsp;</div></li><li><div>            'table_info', &nbsp;</div></li><li><div>            'attributes', &nbsp;</div></li><li><div>            'group', &nbsp;</div></li><li><div>            'grouped', &nbsp;</div></li><li><div>            'developer_mode', &nbsp;</div></li><li><div>            'dependency', &nbsp;</div></li><li><div>            'depends-on', &nbsp;</div></li><li><div>            'excludes-on'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $options_ignore as $ignore ) {&nbsp;</div></li><li><div>            if ( isset( $options[ $ignore ] ) )&nbsp;</div></li><li><div>                unset( $options[ $ignore ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $exclude = array(&nbsp;</div></li><li><div>            'id', &nbsp;</div></li><li><div>            'name', &nbsp;</div></li><li><div>            'label', &nbsp;</div></li><li><div>            'description', &nbsp;</div></li><li><div>            'type', &nbsp;</div></li><li><div>            'storage', &nbsp;</div></li><li><div>            'object', &nbsp;</div></li><li><div>            'alias', &nbsp;</div></li><li><div>            'options', &nbsp;</div></li><li><div>            'fields'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $exclude as $k =&gt; $exclude_field ) {&nbsp;</div></li><li><div>            $aliases = array( $exclude_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $exclude_field ) ) {&nbsp;</div></li><li><div>                $aliases = array_merge( array( $k ), $exclude_field );&nbsp;</div></li><li><div>                $exclude_field = $k;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $aliases as $alias ) {&nbsp;</div></li><li><div>                if ( isset( $options[ $alias ] ) ) {&nbsp;</div></li><li><div>                    $pod[ $exclude_field ] = pods_trim( $options[ $alias ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $options[ $alias ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_tableless() && !in_array( $pod[ 'type' ], array( 'settings', 'table' ) ) ) {&nbsp;</div></li><li><div>            if ( 'pod' == $pod[ 'type' ] )&nbsp;</div></li><li><div>                $pod[ 'type' ] = 'post_type';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'table' == $pod[ 'storage' ] ) {&nbsp;</div></li><li><div>                if ( 'taxonomy' == $pod[ 'type' ] )&nbsp;</div></li><li><div>                    $pod[ 'storage' ] = 'none';&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $pod[ 'storage' ] = 'meta';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'options' ][ 'type' ] = $pod[ 'type' ];&nbsp;</div></li><li><div>        $pod[ 'options' ][ 'storage' ] = $pod[ 'storage' ];&nbsp;</div></li><li><div>        $pod[ 'options' ][ 'object' ] = $pod[ 'object' ];&nbsp;</div></li><li><div>        $pod[ 'options' ][ 'alias' ] = $pod[ 'alias' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'options' ] = array_merge( $pod[ 'options' ], $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var WP_Query&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $reserved_query_vars = array(&nbsp;</div></li><li><div>            'post_type', &nbsp;</div></li><li><div>            'taxonomy', &nbsp;</div></li><li><div>            'output'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $wp_query ) ) {&nbsp;</div></li><li><div>            $reserved_query_vars = array_merge( $reserved_query_vars, array_keys( $wp_query-&gt;fill_query_vars( array() ) ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $pod[ 'options' ][ 'query_var_string' ] ) ) {&nbsp;</div></li><li><div>            if ( in_array( $pod[ 'options' ][ 'query_var_string' ], $reserved_query_vars ) ) {&nbsp;</div></li><li><div>                $pod[ 'options' ][ 'query_var_string' ] = $pod[ 'options' ][ 'type' ] . '_' . $pod[ 'options' ][ 'query_var_string' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $pod[ 'options' ][ 'query_var' ] ) ) {&nbsp;</div></li><li><div>            if ( in_array( $pod[ 'options' ][ 'query_var' ], $reserved_query_vars ) ) {&nbsp;</div></li><li><div>                $pod[ 'options' ][ 'query_var' ] = $pod[ 'options' ][ 'type' ] . '_' . $pod[ 'options' ][ 'query_var' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( strlen( $pod[ 'label' ] ) &lt; 1 )&nbsp;</div></li><li><div>            $pod[ 'label' ] = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'post_type' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            // Max length for post types are 20 characters&nbsp;</div></li><li><div>            $pod[ 'name' ] = substr( $pod[ 'name' ], 0, 20 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'taxonomy' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            // Max length for taxonomies are 32 characters&nbsp;</div></li><li><div>            $pod[ 'name' ] = substr( $pod[ 'name' ], 0, 32 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = $pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;name = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null !== $old_name && $old_name != $params-&gt;name && empty( $pod[ 'object' ] ) ) {&nbsp;</div></li><li><div>            if ( 'post_type' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>                $check = get_post_type_object( $params-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $check ) )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( 'Post Type %s already exists, you cannot rename %s to that', 'pods' ), $params-&gt;name, $old_name ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>                $check = get_taxonomy( $params-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $check ) )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( 'Taxonomy %s already exists, you cannot rename %s to that', 'pods' ), $params-&gt;name, $old_name ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_table_operation = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add new pod&nbsp;</div></li><li><div>        if ( empty( $params-&gt;id ) ) {&nbsp;</div></li><li><div>            if ( strlen( $params-&gt;name ) &lt; 1 )&nbsp;</div></li><li><div>                return pods_error( __( 'Pod name cannot be empty', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_data = array(&nbsp;</div></li><li><div>                'post_name' =&gt; $pod[ 'name' ], &nbsp;</div></li><li><div>                'post_title' =&gt; $pod[ 'label' ], &nbsp;</div></li><li><div>                'post_content' =&gt; $pod[ 'description' ], &nbsp;</div></li><li><div>                'post_type' =&gt; '_pods_pod', &nbsp;</div></li><li><div>                'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'pod' == $pod[ 'type' ] && ( !is_array( $pod[ 'fields' ] ) || empty( $pod[ 'fields' ] ) ) ) {&nbsp;</div></li><li><div>                $pod[ 'fields' ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod[ 'fields' ][ 'name' ] = array(&nbsp;</div></li><li><div>                    'name' =&gt; 'name', &nbsp;</div></li><li><div>                    'label' =&gt; 'Name', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'required' =&gt; '1'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod[ 'fields' ][ 'created' ] = array(&nbsp;</div></li><li><div>                    'name' =&gt; 'created', &nbsp;</div></li><li><div>                    'label' =&gt; 'Date Created', &nbsp;</div></li><li><div>                    'type' =&gt; 'datetime', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'datetime_format' =&gt; 'ymd_slash', &nbsp;</div></li><li><div>                        'datetime_time_type' =&gt; '12', &nbsp;</div></li><li><div>                        'datetime_time_format' =&gt; 'h_mm_ss_A'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod[ 'fields' ][ 'modified' ] = array(&nbsp;</div></li><li><div>                    'name' =&gt; 'modified', &nbsp;</div></li><li><div>                    'label' =&gt; 'Date Modified', &nbsp;</div></li><li><div>                    'type' =&gt; 'datetime', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'datetime_format' =&gt; 'ymd_slash', &nbsp;</div></li><li><div>                        'datetime_time_type' =&gt; '12', &nbsp;</div></li><li><div>                        'datetime_time_format' =&gt; 'h_mm_ss_A'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod[ 'fields' ][ 'author' ] = array(&nbsp;</div></li><li><div>                    'name' =&gt; 'author', &nbsp;</div></li><li><div>                    'label' =&gt; 'Author', &nbsp;</div></li><li><div>                    'type' =&gt; 'pick', &nbsp;</div></li><li><div>                    'pick_object' =&gt; 'user', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'pick_format_type' =&gt; 'single', &nbsp;</div></li><li><div>                        'pick_format_single' =&gt; 'autocomplete', &nbsp;</div></li><li><div>                        'default_value' =&gt; '{@user.ID}'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod[ 'fields' ][ 'permalink' ] = array(&nbsp;</div></li><li><div>                    'name' =&gt; 'permalink', &nbsp;</div></li><li><div>                    'label' =&gt; 'Permalink', &nbsp;</div></li><li><div>                    'type' =&gt; 'slug', &nbsp;</div></li><li><div>                    'description' =&gt; 'Leave blank to auto-generate from Name'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !isset( $pod[ 'options' ][ 'pod_index' ] ) )&nbsp;</div></li><li><div>                    $pod[ 'options' ][ 'pod_index' ] = 'name';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod = $this-&gt;do_hook( 'save_pod_default_pod', $pod, $params, $sanitized, $db );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field_table_operation = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $post_data = array(&nbsp;</div></li><li><div>                'ID' =&gt; $pod[ 'id' ], &nbsp;</div></li><li><div>                'post_name' =&gt; $pod[ 'name' ], &nbsp;</div></li><li><div>                'post_title' =&gt; $pod[ 'label' ], &nbsp;</div></li><li><div>                'post_content' =&gt; $pod[ 'description' ], &nbsp;</div></li><li><div>                'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true === $db ) {&nbsp;</div></li><li><div>            if ( !has_filter( 'wp_unique_post_slug', array( $this, 'save_slug_fix' ) ) )&nbsp;</div></li><li><div>                add_filter( 'wp_unique_post_slug', array( $this, 'save_slug_fix' ), 100, 6 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $conflicted = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Headway compatibility fix&nbsp;</div></li><li><div>            if ( has_filter( 'wp_insert_post_data', 'headway_clean_slug', 0 ) ) {&nbsp;</div></li><li><div>                remove_filter( 'wp_insert_post_data', 'headway_clean_slug', 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $conflicted = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;id = $this-&gt;save_wp_object( 'post', $post_data, $pod[ 'options' ], true, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $conflicted )&nbsp;</div></li><li><div>                add_filter( 'wp_insert_post_data', 'headway_clean_slug', 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === $params-&gt;id )&nbsp;</div></li><li><div>                return pods_error( __( 'Cannot save Pod', 'pods' ), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( empty( $params-&gt;id ) )&nbsp;</div></li><li><div>            $params-&gt;id = (int) $db;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'id' ] = $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup / update tables&nbsp;</div></li><li><div>        if ( 'table' != $pod[ 'type' ] && 'table' == $pod[ 'storage' ] && $old_storage != $pod[ 'storage' ] && $db ) {&nbsp;</div></li><li><div>            $definitions = array( &quot;`id` BIGINT(20) UNSIGNED AUTO_INCREMENT PRIMARY KEY&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $defined_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $pod[ 'fields' ] as $field ) {&nbsp;</div></li><li><div>                if ( !is_array( $field ) || !isset( $field[ 'name' ] ) || in_array( $field[ 'name' ], $defined_fields ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $defined_fields[] = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !in_array( $field[ 'type' ], $tableless_field_types ) || ( 'pick' == $field[ 'type' ] && in_array( pods_var( 'pick_object', $field ), $simple_tableless_objects ) ) ) {&nbsp;</div></li><li><div>                    $definition = $this-&gt;get_field_definition( $field[ 'type' ], array_merge( $field, pods_var_raw( 'options', $field, array() ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 0 &lt; strlen( $definition ) )&nbsp;</div></li><li><div>                        $definitions[] = &quot;`{$field['name']}` &quot; . $definition;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( &quot;DROP TABLE IF EXISTS `@wp_pods_{$params-&gt;name}`&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $result = pods_query( &quot;CREATE TABLE `@wp_pods_{$params-&gt;name}` (&quot; . implode( ', ', $definitions ) . &quot;) DEFAULT CHARSET utf8&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $result ) )&nbsp;</div></li><li><div>                return pods_error( __( 'Cannot add Database Table for Pod', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'table' != $pod[ 'type' ] && 'table' == $pod[ 'storage' ] && $pod[ 'storage' ] == $old_storage && null !== $old_name && $old_name != $params-&gt;name && $db ) {&nbsp;</div></li><li><div>            $result = pods_query( &quot;ALTER TABLE `@wp_pods_{$old_name}` RENAME `@wp_pods_{$params-&gt;name}`&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $result ) )&nbsp;</div></li><li><div>                return pods_error( __( 'Cannot update Database Table for Pod', 'pods' ), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null !== $old_name && $old_name != $params-&gt;name && $db ) {&nbsp;</div></li><li><div>            // Rename items in the DB pointed at the old WP Object names&nbsp;</div></li><li><div>            if ( 'post_type' == $pod[ 'type' ] && empty( $pod[ 'object' ] ) ) {&nbsp;</div></li><li><div>                $this-&gt;rename_wp_object_type( 'post', $old_name, $params-&gt;name );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $pod[ 'type' ] && empty( $pod[ 'object' ] ) ) {&nbsp;</div></li><li><div>                $this-&gt;rename_wp_object_type( 'taxonomy', $old_name, $params-&gt;name );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'comment' == $pod[ 'type' ] && empty( $pod[ 'object' ] ) ) {&nbsp;</div></li><li><div>                $this-&gt;rename_wp_object_type( 'comment', $old_name, $params-&gt;name );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'settings' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>                $this-&gt;rename_wp_object_type( 'settings', $old_name, $params-&gt;name );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Sync any related fields if the name has changed&nbsp;</div></li><li><div>            $fields = pods_query( &quot;&nbsp;</div></li><li><div>                SELECT `p`.`ID`&nbsp;</div></li><li><div>                FROM `{$wpdb-&gt;posts}` AS `p`&nbsp;</div></li><li><div>                LEFT JOIN `{$wpdb-&gt;postmeta}` AS `pm` ON `pm`.`post_id` = `p`.`ID`&nbsp;</div></li><li><div>                LEFT JOIN `{$wpdb-&gt;postmeta}` AS `pm2` ON `pm2`.`post_id` = `p`.`ID`&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                    `p`.`post_type` = '_pods_field'&nbsp;</div></li><li><div>                    AND `pm`.`meta_key` = 'pick_object'&nbsp;</div></li><li><div>                    AND (&nbsp;</div></li><li><div>                        `pm`.`meta_value` = 'pod'&nbsp;</div></li><li><div>                        OR `pm`.`meta_value` = '&quot; . $pod[ 'type' ] . &quot;'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                    AND `pm2`.`meta_key` = 'pick_val'&nbsp;</div></li><li><div>                    AND `pm2`.`meta_value` = '{$old_name}'&nbsp;</div></li><li><div>            &quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $fields ) ) {&nbsp;</div></li><li><div>                foreach ( $fields as $field ) {&nbsp;</div></li><li><div>                    update_post_meta( $field-&gt;ID, 'pick_object', $pod[ 'type' ] );&nbsp;</div></li><li><div>                    update_post_meta( $field-&gt;ID, 'pick_val', $params-&gt;name );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fields = pods_query( &quot;&nbsp;</div></li><li><div>                SELECT `p`.`ID`&nbsp;</div></li><li><div>                FROM `{$wpdb-&gt;posts}` AS `p`&nbsp;</div></li><li><div>                LEFT JOIN `{$wpdb-&gt;postmeta}` AS `pm` ON `pm`.`post_id` = `p`.`ID`&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                    `p`.`post_type` = '_pods_field'&nbsp;</div></li><li><div>                    AND `pm`.`meta_key` = 'pick_object'&nbsp;</div></li><li><div>                    AND (&nbsp;</div></li><li><div>                        `pm`.`meta_value` = 'pod-{$old_name}'&nbsp;</div></li><li><div>                        OR `pm`.`meta_value` = '&quot; . $pod[ 'type' ] . &quot;-{$old_name}'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>            &quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $fields ) ) {&nbsp;</div></li><li><div>                foreach ( $fields as $field ) {&nbsp;</div></li><li><div>                    update_post_meta( $field-&gt;ID, 'pick_object', $pod[ 'type' ] );&nbsp;</div></li><li><div>                    update_post_meta( $field-&gt;ID, 'pick_val', $params-&gt;name );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Sync built-in options for post types and taxonomies&nbsp;</div></li><li><div>        if ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) && empty( $pod[ 'object' ] ) && $db ) {&nbsp;</div></li><li><div>            // Build list of 'built_in' for later&nbsp;</div></li><li><div>            $built_in = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $pod[ 'options' ] as $key =&gt; $val ) {&nbsp;</div></li><li><div>                if ( false === strpos( $key, 'built_in_' ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                elseif ( false !== strpos( $key, 'built_in_post_types_' ) )&nbsp;</div></li><li><div>                    $built_in_type = 'post_type';&nbsp;</div></li><li><div>                elseif ( false !== strpos( $key, 'built_in_taxonomies_' ) )&nbsp;</div></li><li><div>                    $built_in_type = 'taxonomy';&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $built_in_type == $pod[ 'type' ] )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !isset( $built_in[ $built_in_type ] ) )&nbsp;</div></li><li><div>                    $built_in[ $built_in_type ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $built_in_object = str_replace( array( 'built_in_post_types_', 'built_in_taxonomies_' ), '', $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $built_in[ $built_in_type ][ $built_in_object ] = (int) $val;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $lookup_option = $lookup_built_in = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $lookup_name = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>                $lookup_option = 'built_in_post_types_' . $lookup_name;&nbsp;</div></li><li><div>                $lookup_built_in = 'taxonomy';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>                $lookup_option = 'built_in_taxonomies_' . $lookup_name;&nbsp;</div></li><li><div>                $lookup_built_in = 'post_type';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $lookup_option ) && !empty( $lookup_built_in ) && isset( $built_in[ $lookup_built_in ] ) ) {&nbsp;</div></li><li><div>                foreach ( $built_in[ $lookup_built_in ] as $built_in_object =&gt; $val ) {&nbsp;</div></li><li><div>                    $search_val = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 1 == $val )&nbsp;</div></li><li><div>                        $search_val = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $query = &quot;SELECT p.ID FROM {$wpdb-&gt;posts} AS p&nbsp;</div></li><li><div>                                LEFT JOIN {$wpdb-&gt;postmeta} AS pm ON pm.post_id = p.ID AND pm.meta_key = '{$lookup_option}'&nbsp;</div></li><li><div>                                LEFT JOIN {$wpdb-&gt;postmeta} AS pm2 ON pm2.post_id = p.ID AND pm2.meta_key = 'type' AND pm2.meta_value = '{$lookup_built_in}'&nbsp;</div></li><li><div>                                LEFT JOIN {$wpdb-&gt;postmeta} AS pm3 ON pm3.post_id = p.ID AND pm3.meta_key = 'object' AND pm3.meta_value = ''&nbsp;</div></li><li><div>                                WHERE p.post_type = '_pods_pod' AND p.post_name = '{$built_in_object}'&nbsp;</div></li><li><div>                                    AND pm2.meta_id IS NOT NULL&nbsp;</div></li><li><div>                                    AND ( pm.meta_id IS NULL OR pm.meta_value = {$search_val} )&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $results = pods_query( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $results ) ) {&nbsp;</div></li><li><div>                        foreach ( $results as $the_pod ) {&nbsp;</div></li><li><div>                            delete_post_meta( $the_pod-&gt;ID, $lookup_option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            add_post_meta( $the_pod-&gt;ID, $lookup_option, $val );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $saved = array();&nbsp;</div></li><li><div>        $errors = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_index_change = false;&nbsp;</div></li><li><div>        $field_index_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id_required = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_index = pods_var( 'pod_index', $pod[ 'options' ], 'id', null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'pod' == $pod[ 'type' ] && !empty( $pod[ 'fields' ] ) && isset( $pod[ 'fields' ][ $field_index ] ) )&nbsp;</div></li><li><div>            $field_index_id = $pod[ 'fields' ][ $field_index ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;fields ) || ( defined( 'DOING_AJAX' ) && DOING_AJAX ) ) {&nbsp;</div></li><li><div>            $fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;fields ) ) {&nbsp;</div></li><li><div>                $params-&gt;fields = (array) $params-&gt;fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $weight = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $params-&gt;fields as $field ) {&nbsp;</div></li><li><div>                    if ( !is_array( $field ) || !isset( $field[ 'name' ] ) )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !isset( $field[ 'weight' ] ) ) {&nbsp;</div></li><li><div>                        $field[ 'weight' ] = $weight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $weight++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $fields[ $field[ 'name' ] ] = $field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $weight = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $saved_field_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $pod[ 'fields' ] as $k =&gt; $field ) {&nbsp;</div></li><li><div>                if ( !empty( $old_id ) && ( !is_array( $field ) || !isset( $field[ 'name' ] ) || !isset( $fields[ $field[ 'name' ] ] ) ) ) {&nbsp;</div></li><li><div>                    // Iterative change handling for setup-edit.php&nbsp;</div></li><li><div>                    if ( !is_array( $field ) && isset( $old_fields[ $k ] ) )&nbsp;</div></li><li><div>                        $saved[ $old_fields[ $k ][ 'name' ] ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $old_id ) )&nbsp;</div></li><li><div>                    $field = array_merge( $field, $fields[ $field[ 'name' ] ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field[ 'pod' ] = $pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !isset( $field[ 'weight' ] ) ) {&nbsp;</div></li><li><div>                    $field[ 'weight' ] = $weight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $weight++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 0 &lt; $field_index_id && pods_var( 'id', $field ) == $field_index_id )&nbsp;</div></li><li><div>                    $field_index_change = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 0 &lt; pods_var( 'id', $field ) )&nbsp;</div></li><li><div>                    $id_required = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $id_required )&nbsp;</div></li><li><div>                    $field[ 'id_required' ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field_data = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field = $this-&gt;save_field( $field_data, $field_table_operation, true, $db );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( true !== $db ) {&nbsp;</div></li><li><div>                    $pod[ 'fields' ][ $k ] = $field;&nbsp;</div></li><li><div>                    $saved_field_ids[] = $field[ 'id' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    if ( !empty( $field ) && 0 &lt; $field ) {&nbsp;</div></li><li><div>                        $saved[ $field_data[ 'name' ] ] = true;&nbsp;</div></li><li><div>                        $saved_field_ids[] = $field;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $errors[] = sprintf( __( 'Cannot save the %s field', 'pods' ), $field_data[ 'name' ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $db ) {&nbsp;</div></li><li><div>                foreach ( $old_fields as $field ) {&nbsp;</div></li><li><div>                    if ( isset( $pod[ 'fields' ][ $field[ 'name' ] ] ) || isset( $saved[ $field[ 'name' ] ] ) || in_array( $field[ 'id' ], $saved_field_ids ) )&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( $field[ 'id' ] == $field_index_id )&nbsp;</div></li><li><div>                        $field_index_change = 'id';&nbsp;</div></li><li><div>                    elseif ( $field[ 'name' ] == $field_index )&nbsp;</div></li><li><div>                        $field_index_change = 'id';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;delete_field( array(&nbsp;</div></li><li><div>                        'id' =&gt; (int) $field[ 'id' ], &nbsp;</div></li><li><div>                        'name' =&gt; $field[ 'name' ], &nbsp;</div></li><li><div>                        'pod' =&gt; $pod&nbsp;</div></li><li><div> ), $field_table_operation );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Update field index if the name has changed or the field has been removed&nbsp;</div></li><li><div>            if ( false !== $field_index_change && true === $db )&nbsp;</div></li><li><div>                update_post_meta( $pod[ 'id' ], 'pod_index', $field_index_change );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $errors ) )&nbsp;</div></li><li><div>            return pods_error( $errors, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;cache_flush_pods( $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'post_type' == $pod[ 'type' ] )&nbsp;</div></li><li><div>            PodsMeta::$post_types[ $pod[ 'id' ] ] = $this-&gt;load_pod( array( 'name' =&gt; $pod[ 'name' ] ) );&nbsp;</div></li><li><div>        elseif ( 'taxonomy' == $pod[ 'type' ] )&nbsp;</div></li><li><div>            PodsMeta::$taxonomies[ $pod[ 'id' ] ] = $this-&gt;load_pod( array( 'name' =&gt; $pod[ 'name' ] ) );&nbsp;</div></li><li><div>        elseif ( 'media' == $pod[ 'type' ] )&nbsp;</div></li><li><div>            PodsMeta::$media[ $pod[ 'id' ] ] = $this-&gt;load_pod( array( 'name' =&gt; $pod[ 'name' ] ) );&nbsp;</div></li><li><div>        elseif ( 'user' == $pod[ 'type' ] )&nbsp;</div></li><li><div>            PodsMeta::$user[ $pod[ 'id' ] ] = $this-&gt;load_pod( array( 'name' =&gt; $pod[ 'name' ] ) );&nbsp;</div></li><li><div>        elseif ( 'comment' == $pod[ 'type' ] )&nbsp;</div></li><li><div>            PodsMeta::$comment[ $pod[ 'id' ] ] = $this-&gt;load_pod( array( 'name' =&gt; $pod[ 'name' ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Register Post Types / Taxonomies post-registration from PodsInit&nbsp;</div></li><li><div>        if ( !empty( PodsInit::$content_types_registered ) && in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) && empty( $pod[ 'object' ] ) ) {&nbsp;</div></li><li><div>            global $pods_init;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pods_init-&gt;setup_content_types( true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true === $db )&nbsp;</div></li><li><div>            return $pod[ 'id' ];&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return $pod;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a field within a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int Field ID (id OR pod_id+pod+name required)&nbsp;</div></li><li><div>     * $params['pod_id'] int Pod ID (id OR pod_id+pod+name required)&nbsp;</div></li><li><div>     * $params['pod'] string Pod name (id OR pod_id+pod+name required)&nbsp;</div></li><li><div>     * $params['name'] string Field name (id OR pod_id+pod+name required)&nbsp;</div></li><li><div>     * $params['label'] string (optional) Field label&nbsp;</div></li><li><div>     * $params['type'] string (optional) Field type (avatar, boolean, code, color, currency, date, datetime, email, file, number, paragraph, password, phone, pick, slug, text, time, website, wysiwyg)&nbsp;</div></li><li><div>     * $params['pick_object'] string (optional) Related Object (for relationships)&nbsp;</div></li><li><div>     * $params['pick_val'] string (optional) Related Object name (for relationships)&nbsp;</div></li><li><div>     * $params['sister_id'] int (optional) Related Field ID (for bidirectional relationships)&nbsp;</div></li><li><div>     * $params['weight'] int (optional) Order in which the field appears&nbsp;</div></li><li><div>     * $params['options'] array (optional) Options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $table_operation (optional) Whether or not to handle table operations&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Decides wether the params have been sanitized before being passed, will sanitize them if false.&nbsp;</div></li><li><div>     * @param bool|int $db (optional) Whether to save into the DB or just return field array.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int|array The field ID or field array (if !$db)&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_field ( $params, $table_operation = true, $sanitized = false, $db = true ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true !== $db )&nbsp;</div></li><li><div>            $table_operation = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $sanitized )&nbsp;</div></li><li><div>            $params = pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;pod_id ) )&nbsp;</div></li><li><div>            $params-&gt;pod_id = pods_absint( $params-&gt;pod_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true !== $db )&nbsp;</div></li><li><div>            $params-&gt;pod_id = (int) $db;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = null;&nbsp;</div></li><li><div>        $save_pod = false;&nbsp;</div></li><li><div>        $id_required = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;id_required ) ) {&nbsp;</div></li><li><div>            unset( $params-&gt;id_required );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $id_required = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( !isset( $params-&gt;pod ) || empty( $params-&gt;pod ) ) && ( !isset( $params-&gt;pod_id ) || empty( $params-&gt;pod_id ) ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod ID or name is required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;pod ) && is_array( $params-&gt;pod ) ) {&nbsp;</div></li><li><div>            $pod = $params-&gt;pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $save_pod = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( ( !isset( $params-&gt;pod_id ) || empty( $params-&gt;pod_id ) ) && ( true === $db || 0 &lt; $db ) )&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;pod, 'table_info' =&gt; true ) );&nbsp;</div></li><li><div>        elseif ( !isset( $params-&gt;pod ) && ( true === $db || 0 &lt; $db ) )&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'id' =&gt; $params-&gt;pod_id, 'table_info' =&gt; true ) );&nbsp;</div></li><li><div>        elseif ( true === $db || 0 &lt; $db )&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'id' =&gt; $params-&gt;pod_id, 'name' =&gt; $params-&gt;pod, 'table_info' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod ) && true === $db )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;pod_id = $pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>        $params-&gt;pod_data = $pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;name = pods_clean_name( $params-&gt;name, true, ( 'meta' == $pod[ 'storage' ] ? false : true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;id ) )&nbsp;</div></li><li><div>            $params-&gt;id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;name ) )&nbsp;</div></li><li><div>            return pods_error( 'Pod field name is required', $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = $this-&gt;load_field( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $params-&gt;pod_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $old_id = $old_name = $old_type = $old_definition = $old_simple = $old_options = $old_sister_id = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $field ) ) {&nbsp;</div></li><li><div>            $old_id = pods_var( 'id', $field );&nbsp;</div></li><li><div>            $old_name = pods_clean_name( $field[ 'name' ], true, ( 'meta' == $pod[ 'storage' ] ? false : true ) );&nbsp;</div></li><li><div>            $old_type = $field[ 'type' ];&nbsp;</div></li><li><div>            $old_options = $field[ 'options' ];&nbsp;</div></li><li><div>            $old_sister_id = (int) pods_var( 'sister_id', $old_options, 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $old_simple = ( 'pick' == $old_type && in_array( pods_var( 'pick_object', $field ), $simple_tableless_objects ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;name ) && !empty( $params-&gt;name ) )&nbsp;</div></li><li><div>                $field[ 'name' ] = $params-&gt;name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $old_name != $field[ 'name' ] && false !== $this-&gt;field_exists( $params ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( 'Field %s already exists, you cannot rename %s to that', 'pods' ), $field[ 'name' ], $old_name ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ( $id_required || !empty( $params-&gt;id ) ) && ( empty( $old_id ) || $old_id != $params-&gt;id ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( 'Field %s already exists', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $params-&gt;id ) )&nbsp;</div></li><li><div>                $params-&gt;id = $old_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !in_array( $old_type, $tableless_field_types ) || $old_simple ) {&nbsp;</div></li><li><div>                $definition = $this-&gt;get_field_definition( $old_type, array_merge( $field, $old_options ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 0 &lt; strlen( $definition ) )&nbsp;</div></li><li><div>                    $old_definition = &quot;`{$old_name}` &quot; . $definition;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $field = array(&nbsp;</div></li><li><div>                'id' =&gt; 0, &nbsp;</div></li><li><div>                'pod_id' =&gt; $params-&gt;pod_id, &nbsp;</div></li><li><div>                'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                'label' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                'description' =&gt; '', &nbsp;</div></li><li><div>                'type' =&gt; 'text', &nbsp;</div></li><li><div>                'pick_object' =&gt; '', &nbsp;</div></li><li><div>                'pick_val' =&gt; '', &nbsp;</div></li><li><div>                'sister_id' =&gt; '', &nbsp;</div></li><li><div>                'weight' =&gt; null, &nbsp;</div></li><li><div>                'options' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup options&nbsp;</div></li><li><div>        $options = get_object_vars( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $options_ignore = array(&nbsp;</div></li><li><div>            'method', &nbsp;</div></li><li><div>            'table_info', &nbsp;</div></li><li><div>            'attributes', &nbsp;</div></li><li><div>            'group', &nbsp;</div></li><li><div>            'grouped', &nbsp;</div></li><li><div>            'developer_mode', &nbsp;</div></li><li><div>            'dependency', &nbsp;</div></li><li><div>            'depends-on', &nbsp;</div></li><li><div>            'excludes-on'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $options_ignore as $ignore ) {&nbsp;</div></li><li><div>            if ( isset( $options[ $ignore ] ) )&nbsp;</div></li><li><div>                unset( $options[ $ignore ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $options[ 'method' ] ) )&nbsp;</div></li><li><div>            unset( $options[ 'method' ] );&nbsp;</div></li><li><div>        elseif ( isset( $options[ 'table_info' ] ) )&nbsp;</div></li><li><div>            unset( $options[ 'table_info' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $exclude = array(&nbsp;</div></li><li><div>            'id', &nbsp;</div></li><li><div>            'pod_id', &nbsp;</div></li><li><div>            'pod', &nbsp;</div></li><li><div>            'name', &nbsp;</div></li><li><div>            'label', &nbsp;</div></li><li><div>            'description', &nbsp;</div></li><li><div>            'type', &nbsp;</div></li><li><div>            'pick_object', &nbsp;</div></li><li><div>            'pick_val', &nbsp;</div></li><li><div>            'sister_id', &nbsp;</div></li><li><div>            'weight', &nbsp;</div></li><li><div>            'options'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $exclude as $k =&gt; $exclude_field ) {&nbsp;</div></li><li><div>            $aliases = array( $exclude_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $exclude_field ) ) {&nbsp;</div></li><li><div>                $aliases = array_merge( array( $k ), $exclude_field );&nbsp;</div></li><li><div>                $exclude_field = $k;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $aliases as $alias ) {&nbsp;</div></li><li><div>                if ( isset( $options[ $alias ] ) ) {&nbsp;</div></li><li><div>                    $field[ $exclude_field ] = pods_trim( $options[ $alias ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $options[ $alias ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( strlen( $field[ 'label' ] ) &lt; 1 )&nbsp;</div></li><li><div>            $field[ 'label' ] = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field[ 'options' ][ 'type' ] = $field[ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $field[ 'options' ][ 'type' ], $tableless_field_types ) ) {&nbsp;</div></li><li><div>            // Clean up special drop-down in field editor and save out pick_val&nbsp;</div></li><li><div>            $field[ 'pick_object' ] = pods_var( 'pick_object', $field, '', null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 0 === strpos( $field[ 'pick_object' ], 'pod-' ) ) {&nbsp;</div></li><li><div>                $field[ 'pick_val' ] = pods_str_replace( 'pod-', '', $field[ 'pick_object' ], 1 );&nbsp;</div></li><li><div>                $field[ 'pick_object' ] = 'pod';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 0 === strpos( $field[ 'pick_object' ], 'post_type-' ) ) {&nbsp;</div></li><li><div>                $field[ 'pick_val' ] = pods_str_replace( 'post_type-', '', $field[ 'pick_object' ], 1 );&nbsp;</div></li><li><div>                $field[ 'pick_object' ] = 'post_type';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 0 === strpos( $field[ 'pick_object' ], 'taxonomy-' ) ) {&nbsp;</div></li><li><div>                $field[ 'pick_val' ] = pods_str_replace( 'taxonomy-', '', $field[ 'pick_object' ], 1 );&nbsp;</div></li><li><div>                $field[ 'pick_object' ] = 'taxonomy';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'table' == $field[ 'pick_object' ] && 0 &lt; strlen( pods_var_raw( 'pick_table', $field[ 'options' ] ) ) ) {&nbsp;</div></li><li><div>                $field[ 'pick_val' ] = $field[ 'options' ][ 'pick_table' ];&nbsp;</div></li><li><div>                $field[ 'pick_object' ] = 'table';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( false === strpos( $field[ 'pick_object' ], '-' ) && !in_array( $field[ 'pick_object' ], array( 'pod', 'post_type', 'taxonomy' ) ) ) {&nbsp;</div></li><li><div>                $field[ 'pick_val' ] = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 'custom-simple' == $field[ 'pick_object' ] ) {&nbsp;</div></li><li><div>                $field[ 'pick_val' ] = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field[ 'options' ][ 'pick_object' ] = $field[ 'pick_object' ];&nbsp;</div></li><li><div>            $field[ 'options' ][ 'pick_val' ] = $field[ 'pick_val' ];&nbsp;</div></li><li><div>            $field[ 'options' ][ 'sister_id' ] = pods_var( 'sister_id', $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $field[ 'pick_object' ] );&nbsp;</div></li><li><div>            unset( $field[ 'pick_val' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $field[ 'sister_id' ] ) )&nbsp;</div></li><li><div>                unset( $field[ 'sister_id' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field[ 'options' ] = array_merge( $field[ 'options' ], $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object_fields = (array) pods_var_raw( 'object_fields', $pod, array(), null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 &lt; $old_id && defined( 'PODS_FIELD_STRICT' ) && !PODS_FIELD_STRICT )&nbsp;</div></li><li><div>            $params-&gt;id = $field[ 'id' ] = $old_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add new field&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;id ) || empty( $params-&gt;id ) || empty( $field ) ) {&nbsp;</div></li><li><div>            if ( $table_operation && in_array( $field[ 'name' ], array( 'created', 'modified' ) ) && !in_array( $field[ 'type' ], array( 'date', 'datetime' ) ) && ( !defined( 'PODS_FIELD_STRICT' ) || PODS_FIELD_STRICT ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( '%s is reserved for internal Pods usage, please try a different name', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $table_operation && 'author' == $field[ 'name' ] && 'pick' != $field[ 'type' ] && ( !defined( 'PODS_FIELD_STRICT' ) || PODS_FIELD_STRICT ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( '%s is reserved for internal Pods usage, please try a different name', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $field[ 'name' ], array( 'id', 'ID' ) ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( '%s is reserved for internal Pods usage, please try a different name', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $object_fields as $object_field =&gt; $object_field_opt ) {&nbsp;</div></li><li><div>                if ( $object_field == $field[ 'name' ] || in_array( $field[ 'name' ], $object_field_opt[ 'alias' ] ) )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( '%s is reserved for internal WordPress or Pods usage, please try a different name. Also consider what WordPress and Pods provide you built-in.', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $field[ 'name' ], array( 'rss' ) ) ) // Reserved post_name values that can't be used as field names&nbsp;</div></li><li><div>                $field[ 'name' ] .= '2';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'slug' == $field[ 'type' ] && true === $db ) {&nbsp;</div></li><li><div>                if ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy', 'user' ) ) )&nbsp;</div></li><li><div>                    return pods_error( __( 'This pod already has an internal WordPress permalink field', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $slug_field = get_posts( array(&nbsp;</div></li><li><div>                    'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>                    'orderby' =&gt; 'menu_order', &nbsp;</div></li><li><div>                    'order' =&gt; 'ASC', &nbsp;</div></li><li><div>                    'posts_per_page' =&gt; 1, &nbsp;</div></li><li><div>                    'post_parent' =&gt; $field[ 'pod_id' ], &nbsp;</div></li><li><div>                    'meta_query' =&gt; array(&nbsp;</div></li><li><div>                        array(&nbsp;</div></li><li><div>                            'key' =&gt; 'type', &nbsp;</div></li><li><div>                            'value' =&gt; 'slug'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $slug_field ) )&nbsp;</div></li><li><div>                    return pods_error( __( 'This pod already has a permalink field', 'pods' ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Sink the new field to the bottom of the list&nbsp;</div></li><li><div>            if ( null === $field[ 'weight' ] ) {&nbsp;</div></li><li><div>                $field[ 'weight' ] = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $bottom_most_field = get_posts( array(&nbsp;</div></li><li><div>                    'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>                    'orderby' =&gt; 'menu_order', &nbsp;</div></li><li><div>                    'order' =&gt; 'DESC', &nbsp;</div></li><li><div>                    'posts_per_page' =&gt; 1, &nbsp;</div></li><li><div>                    'post_parent' =&gt; $field[ 'pod_id' ]&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $bottom_most_field ) )&nbsp;</div></li><li><div>                    $field[ 'weight' ] = pods_absint( $bottom_most_field[ 0 ]-&gt;menu_order ) + 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field[ 'weight' ] = pods_absint( $field[ 'weight' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_data = array(&nbsp;</div></li><li><div>                'post_name' =&gt; $field[ 'name' ], &nbsp;</div></li><li><div>                'post_title' =&gt; $field[ 'label' ], &nbsp;</div></li><li><div>                'post_content' =&gt; $field[ 'description' ], &nbsp;</div></li><li><div>                'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>                'post_parent' =&gt; $field[ 'pod_id' ], &nbsp;</div></li><li><div>                'post_status' =&gt; 'publish', &nbsp;</div></li><li><div>                'menu_order' =&gt; $field[ 'weight' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ( in_array( $field[ 'name' ], array( 'id', 'ID' ) ) ) {&nbsp;</div></li><li><div>                if ( null !== $old_name )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( '%s is reserved for internal Pods usage, please try a different name', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( '%s is not editable', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( null !== $old_name && $field[ 'name' ] != $old_name && in_array( $field[ 'name' ], array( 'created', 'modified' ) ) && !in_array( $field[ 'type' ], array( 'date', 'datetime' ) ) && ( !defined( 'PODS_FIELD_STRICT' ) || PODS_FIELD_STRICT ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( '%s is reserved for internal Pods usage, please try a different name', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( null !== $old_name && $field[ 'name' ] != $old_name && 'author' == $field[ 'name' ] && 'pick' != $field[ 'type' ] && ( !defined( 'PODS_FIELD_STRICT' ) || PODS_FIELD_STRICT ) )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( '%s is reserved for internal Pods usage, please try a different name', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $object_fields as $object_field =&gt; $object_field_opt ) {&nbsp;</div></li><li><div>                if ( $object_field != $field[ 'name' ] && !in_array( $field[ 'name' ], $object_field_opt[ 'alias' ] ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( null !== $old_name )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( '%s is reserved for internal WordPress or Pods usage, please try a different name', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( '%s is not editable', 'pods' ), $field[ 'name' ] ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_data = array(&nbsp;</div></li><li><div>                'ID' =&gt; $field[ 'id' ], &nbsp;</div></li><li><div>                'post_name' =&gt; $field[ 'name' ], &nbsp;</div></li><li><div>                'post_title' =&gt; $field[ 'label' ], &nbsp;</div></li><li><div>                'post_content' =&gt; $field[ 'description' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( null !== $field[ 'weight' ] ) {&nbsp;</div></li><li><div>                $field[ 'weight' ] = pods_absint( $field[ 'weight' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $post_data[ 'menu_order' ] = $field[ 'weight' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true === $db ) {&nbsp;</div></li><li><div>            if ( !has_filter( 'wp_unique_post_slug', array( $this, 'save_slug_fix' ) ) )&nbsp;</div></li><li><div>                add_filter( 'wp_unique_post_slug', array( $this, 'save_slug_fix' ), 100, 6 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $conflicted = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Headway compatibility fix&nbsp;</div></li><li><div>            if ( has_filter( 'wp_insert_post_data', 'headway_clean_slug', 0 ) ) {&nbsp;</div></li><li><div>                remove_filter( 'wp_insert_post_data', 'headway_clean_slug', 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $conflicted = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;id = $this-&gt;save_wp_object( 'post', $post_data, $field[ 'options' ], true, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $conflicted )&nbsp;</div></li><li><div>                add_filter( 'wp_insert_post_data', 'headway_clean_slug', 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === $params-&gt;id )&nbsp;</div></li><li><div>                return pods_error( __( 'Cannot save Field', 'pods' ), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params-&gt;id = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field[ 'id' ] = $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $simple = ( 'pick' == $field[ 'type' ] && in_array( pods_var( 'pick_object', $field[ 'options' ] ), $simple_tableless_objects ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $definition = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !in_array( $field[ 'type' ], $tableless_field_types ) || $simple ) {&nbsp;</div></li><li><div>            $field_definition = $this-&gt;get_field_definition( $field[ 'type' ], array_merge( $field, $field[ 'options' ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $field_definition ) )&nbsp;</div></li><li><div>                $definition = '`' . $field[ 'name' ] . '` ' . $field_definition;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sister_id = (int) pods_var( 'sister_id', $field[ 'options' ], 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $table_operation && 'table' == $pod[ 'storage' ] && !pods_tableless() ) {&nbsp;</div></li><li><div>            if ( !empty( $old_id ) ) {&nbsp;</div></li><li><div>                if ( ( $field[ 'type' ] != $old_type || $old_simple != $simple ) && empty( $definition ) )&nbsp;</div></li><li><div>                    pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` DROP COLUMN `{$old_name}`&quot;, false );&nbsp;</div></li><li><div>                elseif ( 0 &lt; strlen( $definition ) ) {&nbsp;</div></li><li><div>                    if ( $old_name != $field[ 'name' ] || $old_simple != $simple ) {&nbsp;</div></li><li><div>                        $test = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( 0 &lt; strlen( $old_definition ) )&nbsp;</div></li><li><div>                            $test = pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` CHANGE `{$old_name}` {$definition}&quot;, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // If the old field doesn't exist, continue to add a new field&nbsp;</div></li><li><div>                        if ( false === $test )&nbsp;</div></li><li><div>                            pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` ADD COLUMN {$definition}&quot;, __( 'Cannot create new field', 'pods' ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif ( null !== $old_definition && $definition != $old_definition ) {&nbsp;</div></li><li><div>                        $test = pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` CHANGE `{$old_name}` {$definition}&quot;, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // If the old field doesn't exist, continue to add a new field&nbsp;</div></li><li><div>                        if ( false === $test )&nbsp;</div></li><li><div>                            pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` ADD COLUMN {$definition}&quot;, __( 'Cannot create new field', 'pods' ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( 0 &lt; strlen( $definition ) ) {&nbsp;</div></li><li><div>                $test = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 0 &lt; strlen( $old_definition ) )&nbsp;</div></li><li><div>                    $test = pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` CHANGE `&quot; . $field[ 'name' ] . &quot;` {$definition}&quot;, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // If the old field doesn't exist, continue to add a new field&nbsp;</div></li><li><div>                if ( false === $test )&nbsp;</div></li><li><div>                    pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` ADD COLUMN {$definition}&quot;, __( 'Cannot create new field', 'pods' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $old_id ) && 'meta' == $pod[ 'storage' ] && $old_name != $field[ 'name' ] && $pod[ 'meta_table' ] != $pod[ 'table' ] ) {&nbsp;</div></li><li><div>            $prepare = array(&nbsp;</div></li><li><div>                $field[ 'name' ], &nbsp;</div></li><li><div>                $old_name&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Users don't have a type&nbsp;</div></li><li><div>            if ( !empty( $pod[ 'field_type' ] ) )&nbsp;</div></li><li><div>                $prepare[] = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( &quot;&nbsp;</div></li><li><div>                UPDATE `{$pod[ 'meta_table' ]}` AS `m`&nbsp;</div></li><li><div>                LEFT JOIN `{$pod[ 'table' ]}` AS `t`&nbsp;</div></li><li><div>                    ON `t`.`{$pod[ 'field_id' ]}` = `m`.`{$pod[ 'meta_field_id' ]}`&nbsp;</div></li><li><div>                SET&nbsp;</div></li><li><div>                    `m`.`{$pod[ 'meta_field_index' ]}` = %s&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                    `m`.`{$pod[ 'meta_field_index' ]}` = %s&nbsp;</div></li><li><div>            &quot; . ( !empty( $pod[ 'field_type' ] ) ? &quot; AND `t`.`{$pod[ 'field_type' ]}` = %s&quot; : &quot;&quot; ), &nbsp;</div></li><li><div>                $prepare&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $field[ 'type' ] != $old_type && in_array( $old_type, $tableless_field_types ) ) {&nbsp;</div></li><li><div>            delete_post_meta( $old_sister_id, 'sister_id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $db ) {&nbsp;</div></li><li><div>                pods_query( &quot;&nbsp;</div></li><li><div>                        DELETE pm&nbsp;</div></li><li><div>                        FROM {$wpdb-&gt;postmeta} AS pm&nbsp;</div></li><li><div>                        LEFT JOIN {$wpdb-&gt;posts} AS p&nbsp;</div></li><li><div>                            ON p.post_type = '_pods_field'&nbsp;</div></li><li><div>                            AND p.ID = pm.post_id&nbsp;</div></li><li><div>                        WHERE&nbsp;</div></li><li><div>                            p.ID IS NOT NULL&nbsp;</div></li><li><div>                            AND pm.meta_key = 'sister_id'&nbsp;</div></li><li><div>                            AND pm.meta_value = %d&nbsp;</div></li><li><div>                    &quot;, array(&nbsp;</div></li><li><div>                        $params-&gt;id&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !pods_tableless() ) {&nbsp;</div></li><li><div>                    pods_query( &quot;DELETE FROM @wp_podsrel WHERE `field_id` = {$params-&gt;id}&quot;, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    pods_query( &quot;&nbsp;</div></li><li><div>                            UPDATE `@wp_podsrel`&nbsp;</div></li><li><div>                            SET `related_field_id` = 0&nbsp;</div></li><li><div>                            WHERE `field_id` = %d&nbsp;</div></li><li><div>                        &quot;, array(&nbsp;</div></li><li><div>                            $old_sister_id&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 0 &lt; $sister_id ) {&nbsp;</div></li><li><div>            update_post_meta( $sister_id, 'sister_id', $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $db && ( !pods_tableless() ) ) {&nbsp;</div></li><li><div>                pods_query( &quot;&nbsp;</div></li><li><div>                        UPDATE `@wp_podsrel`&nbsp;</div></li><li><div>                        SET `related_field_id` = %d&nbsp;</div></li><li><div>                        WHERE `field_id` = %d&nbsp;</div></li><li><div>                    &quot;, &nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                        $params-&gt;id, &nbsp;</div></li><li><div>                        $sister_id&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 0 &lt; $old_sister_id ) {&nbsp;</div></li><li><div>            delete_post_meta( $old_sister_id, 'sister_id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $db && ( !pods_tableless() ) ) {&nbsp;</div></li><li><div>                pods_query( &quot;&nbsp;</div></li><li><div>                        UPDATE `@wp_podsrel`&nbsp;</div></li><li><div>                        SET `related_field_id` = 0&nbsp;</div></li><li><div>                        WHERE `field_id` = %d&nbsp;</div></li><li><div>                    &quot;, array(&nbsp;</div></li><li><div>                        $old_sister_id&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $old_id ) && $old_name != $field[ 'name' ] && true === $db ) {&nbsp;</div></li><li><div>            pods_query( &quot;&nbsp;</div></li><li><div>                    UPDATE `@wp_postmeta`&nbsp;</div></li><li><div>                    SET `meta_value` = %s&nbsp;</div></li><li><div>                    WHERE&nbsp;</div></li><li><div>                        `post_id` = %d&nbsp;</div></li><li><div>                        AND `meta_key` = 'pod_index'&nbsp;</div></li><li><div>                        AND `meta_value` = %s&nbsp;</div></li><li><div>                &quot;, array(&nbsp;</div></li><li><div>                    $field[ 'name' ], &nbsp;</div></li><li><div>                    $pod[ 'id' ], &nbsp;</div></li><li><div>                    $old_name&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$save_pod )&nbsp;</div></li><li><div>            $this-&gt;cache_flush_pods( $pod );&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            pods_transient_clear( 'pods_field_' . $pod[ 'name' ] . '_' . $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $old_id ) && $old_name != $field[ 'name' ] )&nbsp;</div></li><li><div>                pods_transient_clear( 'pods_field_' . $pod[ 'name' ] . '_' . $old_name );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true === $db )&nbsp;</div></li><li><div>            return $params-&gt;id;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fix Pod / Field post_name to ensure they are exactly as saved (allow multiple posts w/ same post_name)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Unique slug value&nbsp;</div></li><li><div>     * @param int $post_ID Post ID&nbsp;</div></li><li><div>     * @param string $post_status Post Status&nbsp;</div></li><li><div>     * @param string $post_type Post Type&nbsp;</div></li><li><div>     * @param int $post_parent Post Parent ID&nbsp;</div></li><li><div>     * @param string $original_slug Original slug value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Final slug value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_slug_fix ( $slug, $post_ID, $post_status, $post_type, $post_parent = 0, $original_slug = null ) {&nbsp;</div></li><li><div>        if ( in_array( $post_type, array( '_pods_field', '_pods_pod' ) ) && false !== strpos( $slug, '-' ) )&nbsp;</div></li><li><div>            $slug = $original_slug;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $slug;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or Edit a Pods Object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The Object ID&nbsp;</div></li><li><div>     * $params['name'] string The Object name&nbsp;</div></li><li><div>     * $params['type'] string The Object type&nbsp;</div></li><li><div>     * $params['options'] Associative array of Object options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $sanitized (optional) Decides whether the params have been sanitized before being passed, will sanitize them if false.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The Object ID&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_object ( $params, $sanitized = false ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $sanitized )&nbsp;</div></li><li><div>            $params = pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;name ) || empty( $params-&gt;name ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Name must be given to save an Object', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;type ) || empty( $params-&gt;type ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Type must be given to save an Object', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object = array(&nbsp;</div></li><li><div>            'id' =&gt; 0, &nbsp;</div></li><li><div>            'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>            'type' =&gt; $params-&gt;type, &nbsp;</div></li><li><div>            'code' =&gt; '', &nbsp;</div></li><li><div>            'options' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup options&nbsp;</div></li><li><div>        $options = get_object_vars( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $options[ 'method' ] ) )&nbsp;</div></li><li><div>            unset( $options[ 'method' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $exclude = array(&nbsp;</div></li><li><div>            'id', &nbsp;</div></li><li><div>            'name', &nbsp;</div></li><li><div>            'helper_type', &nbsp;</div></li><li><div>            'code', &nbsp;</div></li><li><div>            'options', &nbsp;</div></li><li><div>            'status'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $exclude as $k =&gt; $exclude_field ) {&nbsp;</div></li><li><div>            $aliases = array( $exclude_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $exclude_field ) ) {&nbsp;</div></li><li><div>                $aliases = array_merge( array( $k ), $exclude_field );&nbsp;</div></li><li><div>                $exclude_field = $k;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $aliases as $alias ) {&nbsp;</div></li><li><div>                if ( isset( $options[ $alias ] ) ) {&nbsp;</div></li><li><div>                    $object[ $exclude_field ] = pods_trim( $options[ $alias ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $options[ $alias ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'helper' == $object[ 'type' ] )&nbsp;</div></li><li><div>            $object[ 'options' ][ 'helper_type' ] = $object[ 'helper_type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $object[ 'options' ][ 'code' ] ) )&nbsp;</div></li><li><div>            unset( $object[ 'options' ][ 'code' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object[ 'options' ] = array_merge( $object[ 'options' ], $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_data = array(&nbsp;</div></li><li><div>            'post_name' =&gt; pods_clean_name( $object[ 'name' ], true), &nbsp;</div></li><li><div>            'post_title' =&gt; $object[ 'name' ], &nbsp;</div></li><li><div>            'post_content' =&gt; $object[ 'code' ], &nbsp;</div></li><li><div>            'post_type' =&gt; '_pods_' . $object[ 'type' ], &nbsp;</div></li><li><div>            'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $object[ 'id' ] ) )&nbsp;</div></li><li><div>            $post_data[ 'ID' ] = $object[ 'id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null !== pods_var( 'status', $object, null, null, true ) )&nbsp;</div></li><li><div>            $post_data[ 'post_status' ] = pods_var( 'status', $object, null, null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        remove_filter( 'content_save_pre', 'balanceTags', 50 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_data = pods_sanitize( $post_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = $this-&gt;save_post( $post_data, $object[ 'options' ], true, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_transient_clear( 'pods_objects_' . $params-&gt;type );&nbsp;</div></li><li><div>        pods_transient_clear( 'pods_objects_' . $params-&gt;type . '_get' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $params-&gt;id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::save_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Add or edit a Pod Template&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The template ID&nbsp;</div></li><li><div>     * $params['name'] string The template name&nbsp;</div></li><li><div>     * $params['code'] string The template code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $sanitized  (optional) Decides wether the params have been sanitized before being passed, will sanitize them if false.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The Template ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_template ( $params, $sanitized = false ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;type = 'template';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;save_object( $params, $sanitized );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::save_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Add or edit a Pod Page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The page ID&nbsp;</div></li><li><div>     * $params['name'] string The page URI&nbsp;</div></li><li><div>     * $params['code'] string The page code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $sanitized  (optional) Decides wether the params have been sanitized before being passed, will sanitize them if false.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The page ID&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_page ( $params, $sanitized = false ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;name ) ) {&nbsp;</div></li><li><div>            $params-&gt;name = $params-&gt;uri;&nbsp;</div></li><li><div>            unset( $params-&gt;uri );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;phpcode ) ) {&nbsp;</div></li><li><div>            $params-&gt;code = $params-&gt;phpcode;&nbsp;</div></li><li><div>            unset( $params-&gt;phpcode );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;name = trim( $params-&gt;name, '/' );&nbsp;</div></li><li><div>        $params-&gt;type = 'page';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;save_object( $params, $sanitized );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::save_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Add or edit a Pod Helper&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The helper ID&nbsp;</div></li><li><div>     * $params['name'] string The helper name&nbsp;</div></li><li><div>     * $params['helper_type'] string The helper type (&quot;pre_save&quot;, &quot;display&quot;, etc)&nbsp;</div></li><li><div>     * $params['code'] string The helper code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $sanitized  (optional) Decides wether the params have been sanitized before being passed, will sanitize them if false.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The helper ID&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_helper ( $params, $sanitized = false ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;phpcode ) ) {&nbsp;</div></li><li><div>            $params-&gt;code = $params-&gt;phpcode;&nbsp;</div></li><li><div>            unset( $params-&gt;phpcode );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;type ) ) {&nbsp;</div></li><li><div>            $params-&gt;helper_type = $params-&gt;type;&nbsp;</div></li><li><div>            unset( $params-&gt;type );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;type = 'helper';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;save_object( $params, $sanitized );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a single pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name (pod or pod_id is required)&nbsp;</div></li><li><div>     * $params['pod_id'] string The Pod ID (pod or pod_id is required)&nbsp;</div></li><li><div>     * $params['id'] int The item ID&nbsp;</div></li><li><div>     * $params['data'] array (optional) Associative array of field names + values&nbsp;</div></li><li><div>     * $params['bypass_helpers'] bool Set to true to bypass running pre-save and post-save helpers&nbsp;</div></li><li><div>     * $params['track_changed_fields'] bool Set to true to enable tracking of saved fields via PodsAPI::get_changed_fields()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The item ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_pod_item ( $params ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) pods_str_replace( '@wp_', '{prefix}', $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>        $repeatable_field_types = PodsForm::repeatable_field_types();&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @deprecated 2.0&nbsp;</div></li><li><div>        if ( isset( $params-&gt;datatype ) ) {&nbsp;</div></li><li><div>            pods_deprecated( '$params-&gt;pod instead of $params-&gt;datatype', '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;pod = $params-&gt;datatype;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $params-&gt;datatype );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;pod_id ) ) {&nbsp;</div></li><li><div>                pods_deprecated( '$params-&gt;id instead of $params-&gt;pod_id', '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $params-&gt;id = $params-&gt;pod_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                unset( $params-&gt;pod_id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;data ) && !empty( $params-&gt;data ) && is_array( $params-&gt;data ) ) {&nbsp;</div></li><li><div>                $check = current( $params-&gt;data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $check ) ) {&nbsp;</div></li><li><div>                    pods_deprecated( 'PodsAPI::save_pod_items', '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    return $this-&gt;save_pod_items( $params, $params-&gt;data );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @deprecated 2.0&nbsp;</div></li><li><div>        if ( isset( $params-&gt;tbl_row_id ) ) {&nbsp;</div></li><li><div>            pods_deprecated( '$params-&gt;id instead of $params-&gt;tbl_row_id', '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;id = $params-&gt;tbl_row_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $params-&gt;tbl_row_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @deprecated 2.0&nbsp;</div></li><li><div>        if ( isset( $params-&gt;columns ) ) {&nbsp;</div></li><li><div>            pods_deprecated( '$params-&gt;data instead of $params-&gt;columns', '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;data = $params-&gt;columns;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $params-&gt;columns );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod ) )&nbsp;</div></li><li><div>            $params-&gt;pod = false;&nbsp;</div></li><li><div>        if ( isset( $params-&gt;pod_id ) )&nbsp;</div></li><li><div>            $params-&gt;pod_id = pods_absint( $params-&gt;pod_id );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params-&gt;pod_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;id ) )&nbsp;</div></li><li><div>            $params-&gt;id = pods_absint( $params-&gt;id );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params-&gt;id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;from ) )&nbsp;</div></li><li><div>            $params-&gt;from = 'save';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;location ) )&nbsp;</div></li><li><div>            $params-&gt;location = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;track_changed_fields ) )&nbsp;</div></li><li><div>            $params-&gt;track_changed_fields = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Override $params['track_changed_fields']&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * Use for globally setting field change tracking.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.3.19&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $track_changed_fields = apply_filters( 'pods_api_save_pod_item_track_changed_fields_' . $params-&gt;pod, (boolean) $params-&gt;track_changed_fields, $params );&nbsp;</div></li><li><div>        $changed_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;clear_slug_cache ) ) {&nbsp;</div></li><li><div>            $params-&gt;clear_slug_cache = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Support for bulk edit&nbsp;</div></li><li><div>        if ( isset( $params-&gt;id ) && !empty( $params-&gt;id ) && is_array( $params-&gt;id ) ) {&nbsp;</div></li><li><div>            $ids = array();&nbsp;</div></li><li><div>            $new_params = $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $params-&gt;id as $id ) {&nbsp;</div></li><li><div>                $new_params-&gt;id = $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $ids[] = $this-&gt;save_pod_item( $new_params );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $ids;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow Helpers to know what's going on, are we adding or saving?&nbsp;</div></li><li><div>        $is_new_item = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;id ) )&nbsp;</div></li><li><div>            $is_new_item = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;is_new_item ) )&nbsp;</div></li><li><div>            $is_new_item = (boolean) $params-&gt;is_new_item;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow Helpers to bypass subsequent helpers in recursive save_pod_item calls&nbsp;</div></li><li><div>        $bypass_helpers = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;bypass_helpers ) && false !== $params-&gt;bypass_helpers )&nbsp;</div></li><li><div>            $bypass_helpers = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow Custom Fields not defined by Pods to be saved&nbsp;</div></li><li><div>        $allow_custom_fields = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;allow_custom_fields ) && false !== $params-&gt;allow_custom_fields )&nbsp;</div></li><li><div>            $allow_custom_fields = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get array of Pods&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( array( 'id' =&gt; $params-&gt;pod_id, 'name' =&gt; $params-&gt;pod, 'table_info' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $pod )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>        $params-&gt;pod_id = $pod[ 'id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'settings' == $pod[ 'type' ] )&nbsp;</div></li><li><div>            $params-&gt;id = $pod[ 'id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = $pod[ 'fields' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object_fields = (array) pods_var_raw( 'object_fields', $pod, array(), null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields_active = array();&nbsp;</div></li><li><div>        $custom_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Find the active fields (loop through $params-&gt;data to retain order)&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;data ) && is_array( $params-&gt;data ) ) {&nbsp;</div></li><li><div>            $custom_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $params-&gt;data as $field =&gt; $value ) {&nbsp;</div></li><li><div>                if ( isset( $object_fields[ $field ] ) ) {&nbsp;</div></li><li><div>                    $object_fields[ $field ][ 'value' ] = $value;&nbsp;</div></li><li><div>                    $fields_active[] = $field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( isset( $fields[ $field ] ) ) {&nbsp;</div></li><li><div>                    if ( 'save' == $params-&gt;from || true === PodsForm::permission( $fields[ $field ][ 'type' ], $field, $fields[ $field ], $fields, $pod, $params-&gt;id, $params ) ) {&nbsp;</div></li><li><div>                        $fields[ $field ][ 'value' ] = $value;&nbsp;</div></li><li><div>                        $fields_active[] = $field;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif ( !pods_has_permissions( $fields[ $field ][ 'options' ] ) && pods_var( 'hidden', $fields[ $field ][ 'options' ], false ) ) {&nbsp;</div></li><li><div>                        $fields[ $field ][ 'value' ] = $value;&nbsp;</div></li><li><div>                        $fields_active[] = $field;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $found = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $object_fields as $object_field =&gt; $object_field_opt ) {&nbsp;</div></li><li><div>                        if ( in_array( $field, $object_field_opt[ 'alias' ] ) ) {&nbsp;</div></li><li><div>                            $object_fields[ $object_field ][ 'value' ] = $value;&nbsp;</div></li><li><div>                            $fields_active[] = $object_field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $found = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( $allow_custom_fields && !$found )&nbsp;</div></li><li><div>                        $custom_fields[] = $field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $allow_custom_fields && !empty( $custom_fields ) ) {&nbsp;</div></li><li><div>                foreach ( $custom_fields as $field ) {&nbsp;</div></li><li><div>                    $custom_data[ $field ] = $params-&gt;data[ $field ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $pod[ 'type' ] === 'taxonomy' && isset( $params-&gt;data )  && !empty( $params-&gt;data ) ) {&nbsp;</div></li><li><div>                $term_data = $params-&gt;data;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>           unset( $params-&gt;data );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $params-&gt;id ) && !in_array( 'created', $fields_active ) && isset( $fields[ 'created' ] ) && in_array( $fields[ 'created' ][ 'type' ], array( 'date', 'datetime' ) ) ) {&nbsp;</div></li><li><div>            $fields[ 'created' ][ 'value' ] = current_time( 'mysql' );&nbsp;</div></li><li><div>            $fields_active[] = 'created';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !in_array( 'modified', $fields_active ) && isset( $fields[ 'modified' ] ) && in_array( $fields[ 'modified' ][ 'type' ], array( 'date', 'datetime' ) ) ) {&nbsp;</div></li><li><div>            $fields[ 'modified' ][ 'value' ] = current_time( 'mysql' );&nbsp;</div></li><li><div>            $fields_active[] = 'modified';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( in_array( $pod[ 'type' ], array( 'pod', 'table' ) ) && empty( $params-&gt;id ) && !empty( $pod[ 'pod_field_index' ] ) && in_array( $pod[ 'pod_field_index' ], $fields_active ) && !in_array( $pod[ 'pod_field_slug' ], $fields_active ) && isset( $fields[ $pod[ 'pod_field_slug' ] ] ) ) {&nbsp;</div></li><li><div>            $fields[ $pod[ 'pod_field_slug' ] ][ 'value' ] = ''; // this will get picked up by slug pre_save method&nbsp;</div></li><li><div>            $fields_active[] = $pod[ 'pod_field_slug' ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Handle hidden fields&nbsp;</div></li><li><div>        if ( empty( $params-&gt;id ) ) {&nbsp;</div></li><li><div>            foreach ( $fields as $field =&gt; $field_data ) {&nbsp;</div></li><li><div>                if ( in_array( $field, $fields_active ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( in_array( $params-&gt;from, array( 'save', 'process_form' ) ) || true === PodsForm::permission( $fields[ $field ][ 'type' ], $field, $fields[ $field ], $fields, $pod, $params-&gt;id, $params ) ) {&nbsp;</div></li><li><div>                    $value = PodsForm::default_value( pods_var_raw( $field, 'post' ), $field_data[ 'type' ], $field, pods_var_raw( 'options', $field_data, $field_data, null, true ), $pod, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( null !== $value && '' !== $value && false !== $value ) {&nbsp;</div></li><li><div>                        $fields[ $field ][ 'value' ] = $value;&nbsp;</div></li><li><div>                        $fields_active[] = $field;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Set default field values for object fields&nbsp;</div></li><li><div>            if ( !empty( $object_fields ) ) {&nbsp;</div></li><li><div>                foreach ( $object_fields as $field =&gt; $field_data ) {&nbsp;</div></li><li><div>                    if ( in_array( $field, $fields_active ) ) {&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif ( !isset( $field_data[ 'default' ] ) || strlen( $field_data[ 'default' ] ) &lt; 1 ) {&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = PodsForm::default_value( pods_var_raw( $field, 'post' ), $field_data[ 'type' ], $field, pods_var_raw( 'options', $field_data, $field_data, null, true ), $pod, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( null !== $value && '' !== $value && false !== $value ) {&nbsp;</div></li><li><div>                        $object_fields[ $field ][ 'value' ] = $value;&nbsp;</div></li><li><div>                        $fields_active[] = $field;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Set default field values for Pod fields&nbsp;</div></li><li><div>            foreach ( $fields as $field =&gt; $field_data ) {&nbsp;</div></li><li><div>                if ( in_array( $field, $fields_active ) ) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( !isset( $field_data[ 'default' ] ) || strlen( $field_data[ 'default' ] ) &lt; 1 ) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $value = PodsForm::default_value( pods_var_raw( $field, 'post' ), $field_data[ 'type' ], $field, pods_var_raw( 'options', $field_data, $field_data, null, true ), $pod, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( null !== $value && '' !== $value && false !== $value ) {&nbsp;</div></li><li><div>                    $fields[ $field ][ 'value' ] = $value;&nbsp;</div></li><li><div>                    $fields_active[] = $field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $columns =& $fields; // @deprecated 2.0&nbsp;</div></li><li><div>        $active_columns =& $fields_active; // @deprecated 2.0&nbsp;</div></li><li><div>        $params-&gt;tbl_row_id =& $params-&gt;id; // @deprecated 2.0&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pre_save_helpers = $post_save_helpers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pieces = array(&nbsp;</div></li><li><div>            'fields', &nbsp;</div></li><li><div>            'params', &nbsp;</div></li><li><div>            'pod', &nbsp;</div></li><li><div>            'fields_active', &nbsp;</div></li><li><div>            'object_fields', &nbsp;</div></li><li><div>            'custom_fields', &nbsp;</div></li><li><div>            'custom_data', &nbsp;</div></li><li><div>            'track_changed_fields', &nbsp;</div></li><li><div>            'changed_fields'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $bypass_helpers ) {&nbsp;</div></li><li><div>            // Plugin hooks&nbsp;</div></li><li><div>            $hooked = $this-&gt;do_hook( 'pre_save_pod_item', compact( $pieces ), $is_new_item, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $hooked ) && !empty( $hooked ) )&nbsp;</div></li><li><div>                extract( $hooked );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $hooked = $this-&gt;do_hook( &quot;pre_save_pod_item_{$params-&gt;pod}&quot;, compact( $pieces ), $is_new_item, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $hooked ) && !empty( $hooked ) )&nbsp;</div></li><li><div>                extract( $hooked );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $is_new_item ) {&nbsp;</div></li><li><div>                $hooked = $this-&gt;do_hook( 'pre_create_pod_item', compact( $pieces ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $hooked ) && !empty( $hooked ) )&nbsp;</div></li><li><div>                    extract( $hooked );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $hooked = $this-&gt;do_hook( &quot;pre_create_pod_item_{$params-&gt;pod}&quot;, compact( $pieces ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $hooked ) && !empty( $hooked ) )&nbsp;</div></li><li><div>                    extract( $hooked );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $hooked = $this-&gt;do_hook( 'pre_edit_pod_item', compact( $pieces ), $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $hooked ) && !empty( $hooked ) )&nbsp;</div></li><li><div>                    extract( $hooked );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $hooked = $this-&gt;do_hook( &quot;pre_edit_pod_item_{$params-&gt;pod}&quot;, compact( $pieces ), $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $hooked ) && !empty( $hooked ) )&nbsp;</div></li><li><div>                    extract( $hooked );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Call any pre-save helpers (if not bypassed)&nbsp;</div></li><li><div>            if ( !defined( 'PODS_DISABLE_EVAL' ) || !PODS_DISABLE_EVAL ) {&nbsp;</div></li><li><div>                if ( !empty( $pod[ 'options' ] ) && is_array( $pod[ 'options' ] ) ) {&nbsp;</div></li><li><div>                    $helpers = array( 'pre_save_helpers', 'post_save_helpers' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $helpers as $helper ) {&nbsp;</div></li><li><div>                        if ( isset( $pod[ 'options' ][ $helper ] ) && !empty( $pod[ 'options' ][ $helper ] ) )&nbsp;</div></li><li><div>                            ${$helper} = explode( ', ', $pod[ 'options' ][ $helper ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $pre_save_helpers ) ) {&nbsp;</div></li><li><div>                    pods_deprecated( sprintf( __( 'Pre-save helpers are deprecated, use the action pods_pre_save_pod_item_%s instead', 'pods' ), $params-&gt;pod ), '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $pre_save_helpers as $helper ) {&nbsp;</div></li><li><div>                        $helper = $this-&gt;load_helper( array( 'name' =&gt; $helper ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( false !== $helper )&nbsp;</div></li><li><div>                            eval( '?&gt;' . $helper[ 'code' ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $track_changed_fields ) {&nbsp;</div></li><li><div>            $changed_fields = $this-&gt;get_changed_fields( compact( $pieces ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_data = $table_formats = $update_values = $rel_fields = $rel_field_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object_type = $pod[ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object_ID = 'ID';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'comment' == $object_type )&nbsp;</div></li><li><div>            $object_ID = 'comment_ID';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object_data = $object_meta = $post_term_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'settings' == $object_type )&nbsp;</div></li><li><div>            $object_data[ 'option_id' ] = $pod[ 'name' ];&nbsp;</div></li><li><div>        elseif ( !empty( $params-&gt;id ) )&nbsp;</div></li><li><div>            $object_data[ $object_ID ] = $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields_active = array_unique( $fields_active );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Loop through each active field, validating and preparing the table data&nbsp;</div></li><li><div>        foreach ( $fields_active as $field ) {&nbsp;</div></li><li><div>            if ( isset( $object_fields[ $field ] ) )&nbsp;</div></li><li><div>                $field_data = $object_fields[ $field ];&nbsp;</div></li><li><div>            elseif ( isset( $fields[ $field ] ) )&nbsp;</div></li><li><div>                $field_data = $fields[ $field ];&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $value = $field_data[ 'value' ];&nbsp;</div></li><li><div>            $type = $field_data[ 'type' ];&nbsp;</div></li><li><div>            $options = pods_var( 'options', $field_data, array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // WPML AJAX compatibility&nbsp;</div></li><li><div>            if ( is_admin() && isset( $_GET[ 'page' ] ) && false !== strpos( $_GET[ 'page' ], '/menu/languages.php' ) && isset( $_POST[ 'icl_ajx_action' ] ) && isset( $_POST[ '_icl_nonce' ] ) && wp_verify_nonce( $_POST[ '_icl_nonce' ], $_POST[ 'icl_ajx_action' ] . '_nonce' ) )&nbsp;</div></li><li><div>                $options[ 'unique' ] = $fields[ $field ][ 'options' ][ 'unique' ] = $options[ 'required' ] = $fields[ $field ][ 'options' ][ 'required' ] = 0;&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                // Validate value&nbsp;</div></li><li><div>                $validate = $this-&gt;handle_field_validation( $value, $field, $object_fields, $fields, $pod, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false === $validate )&nbsp;</div></li><li><div>                    $validate = sprintf( __( 'There was an issue validating the field %s', 'pods' ), $field_data[ 'label' ] );&nbsp;</div></li><li><div>                elseif ( true !== $validate )&nbsp;</div></li><li><div>                    $validate = (array) $validate;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !is_bool( $validate ) && !empty( $validate ) )&nbsp;</div></li><li><div>                    return pods_error( $validate, $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $value = PodsForm::pre_save( $field_data[ 'type' ], $value, $params-&gt;id, $field, array_merge( $field_data, $options ), array_merge( $fields, $object_fields ), $pod, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field_data[ 'value' ] = $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $object_fields[ $field ] ) ) {&nbsp;</div></li><li><div>                if ( 'taxonomy' == $object_fields[ $field ][ 'type' ] ) {&nbsp;</div></li><li><div>                    $post_term_data[ $field ] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $object_data[ $field ] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $simple = ( 'pick' == $type && in_array( pods_var( 'pick_object', $field_data ), $simple_tableless_objects ) );&nbsp;</div></li><li><div>                $simple = (boolean) $this-&gt;do_hook( 'tableless_custom', $simple, $field_data, $field, $fields, $pod, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Handle Simple Relationships&nbsp;</div></li><li><div>                if ( $simple ) {&nbsp;</div></li><li><div>                    if ( !is_array( $value ) )&nbsp;</div></li><li><div>                        $value = explode( ', ', $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pick_limit = (int) pods_var_raw( 'pick_limit', $options, 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'single' == pods_var_raw( 'pick_format_type', $options ) )&nbsp;</div></li><li><div>                        $pick_limit = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'custom-simple' == pods_var( 'pick_object', $field_data ) ) {&nbsp;</div></li><li><div>                        $custom = pods_var_raw( 'pick_custom', $options, '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $custom = apply_filters( 'pods_form_ui_field_pick_custom_values', $custom, $field_data[ 'name' ], $value, array_merge( $field_data, $options ), $pod, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( empty( $value ) || empty( $custom ) )&nbsp;</div></li><li><div>                            $value = '';&nbsp;</div></li><li><div>                        elseif ( !empty( $custom ) ) {&nbsp;</div></li><li><div>                            if ( !is_array( $custom ) ) {&nbsp;</div></li><li><div>                                $custom = explode( &quot;\n&quot;, $custom );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $custom_values = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                foreach ( $custom as $c =&gt; $cv ) {&nbsp;</div></li><li><div>                                    if ( 0 &lt; strlen( $cv ) ) {&nbsp;</div></li><li><div>                                        $custom_label = explode( '|', $cv );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        if ( !isset( $custom_label[ 1 ] ) )&nbsp;</div></li><li><div>                                            $custom_label[ 1 ] = $custom_label[ 0 ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $custom_label[ 0 ] = trim( (string) $custom_label[ 0 ] );&nbsp;</div></li><li><div>                                        $custom_label[ 1 ] = trim( (string) $custom_label[ 1 ] );&nbsp;</div></li><li><div>                                        $custom_values[ $custom_label[ 0 ] ] = $custom_label[ 1 ];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $custom_values = $custom;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $values = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            foreach ( $value as $k =&gt; $v ) {&nbsp;</div></li><li><div>                                $v = pods_unsanitize( $v );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ( isset( $custom_values[ $v ] ) )&nbsp;</div></li><li><div>                                    $values[ $k ] = $v;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $value = $values;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 0 &lt; $pick_limit && !empty( $value ) )&nbsp;</div></li><li><div>                        $value = array_slice( $value, 0, $pick_limit );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Don't save an empty array, just make it an empty string&nbsp;</div></li><li><div>                    if ( empty( $value ) )&nbsp;</div></li><li><div>                        $value = '';&nbsp;</div></li><li><div>                    elseif ( is_array( $value ) ) {&nbsp;</div></li><li><div>                        // If there's just one item, don't save as an array, save the string&nbsp;</div></li><li><div>                        if ( 1 == $pick_limit || 1 == count( $value ) )&nbsp;</div></li><li><div>                            $value = implode( '', $value );&nbsp;</div></li><li><div>                        // If storage is set to table, json encode, otherwise WP will serialize automatically&nbsp;</div></li><li><div>                        elseif ( 'table' == pods_var( 'storage', $pod ) )&nbsp;</div></li><li><div>                            $value = version_compare( PHP_VERSION, '5.4.0', '&gt;=' ) ? json_encode( $value, JSON_UNESCAPED_UNICODE ) : json_encode( $value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Prepare all table / meta data&nbsp;</div></li><li><div>                if ( !in_array( $type, $tableless_field_types ) || $simple ) {&nbsp;</div></li><li><div>                    if ( in_array( $type, $repeatable_field_types ) && 1 == pods_var( $type . '_repeatable', $field_data, 0 ) ) {&nbsp;</div></li><li><div>                        // Don't save an empty array, just make it an empty string&nbsp;</div></li><li><div>                        if ( empty( $value ) )&nbsp;</div></li><li><div>                            $value = '';&nbsp;</div></li><li><div>                        elseif ( is_array( $value ) ) {&nbsp;</div></li><li><div>                            // If there's just one item, don't save as an array, save the string&nbsp;</div></li><li><div>                            if ( 1 == count( $value ) )&nbsp;</div></li><li><div>                                $value = implode( '', $value );&nbsp;</div></li><li><div>                            // If storage is set to table, json encode, otherwise WP will serialize automatically&nbsp;</div></li><li><div>                            elseif ( 'table' == pods_var( 'storage', $pod ) )&nbsp;</div></li><li><div>                                $value = version_compare( PHP_VERSION, '5.4.0', '&gt;=' ) ? json_encode( $value, JSON_UNESCAPED_UNICODE ) : json_encode( $value );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $table_data[ $field ] = str_replace( array( '{prefix}', '@wp_' ), array( '{/prefix/}', '{prefix}' ), $value ); // Fix for pods_query&nbsp;</div></li><li><div>                    $table_formats[] = PodsForm::prepare( $type, $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $object_meta[ $field ] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // Store relational field data to be looped through later&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    // Convert values from a comma-separated string into an array&nbsp;</div></li><li><div>                    if ( !is_array( $value ) )&nbsp;</div></li><li><div>                        $value = explode( ', ', $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $rel_fields[ $type ][ $field ] = $value;&nbsp;</div></li><li><div>                    $rel_field_ids[] = $field_data[ 'id' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'post_type' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            $post_type = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod[ 'object' ] ) )&nbsp;</div></li><li><div>                $post_type = $pod[ 'object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $object_data[ 'post_type' ] = $post_type;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( 'meta' == $pod[ 'storage' ] || 'settings' == $pod[ 'type' ] ) && !in_array( $pod[ 'type' ], array( 'taxonomy', 'pod', 'table', '' ) ) ) {&nbsp;</div></li><li><div>            if ( $allow_custom_fields && !empty( $custom_data ) )&nbsp;</div></li><li><div>                $object_meta = array_merge( $custom_data, $object_meta );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fields_to_send = array_flip( array_keys( $object_meta ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $fields_to_send as $field =&gt; $field_data ) {&nbsp;</div></li><li><div>                if ( isset( $object_fields[ $field ] ) ) {&nbsp;</div></li><li><div>                    $field_data = $object_fields[ $field ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( isset( $fields[ $field ] ) ) {&nbsp;</div></li><li><div>                    $field_data = $fields[ $field ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    unset( $fields_to_send[ $field ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $fields_to_send[ $field ] = $field_data;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;id = $this-&gt;save_wp_object( $object_type, $object_data, $object_meta, false, true, $fields_to_send );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $params-&gt;id ) && 'settings' == $object_type )&nbsp;</div></li><li><div>                $params-&gt;id = $pod[ 'id' ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ( !in_array( $pod[ 'type' ], array( 'taxonomy', 'pod', 'table', '' ) ) )&nbsp;</div></li><li><div>                $params-&gt;id = $this-&gt;save_wp_object( $object_type, $object_data, array(), false, true );&nbsp;</div></li><li><div>            elseif ( 'taxonomy' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>                $term = pods_v( $object_fields[ 'name' ][ 'name' ], $object_data, '', null, true );&nbsp;</div></li><li><div>                if ( !isset( $term_data ) ) {&nbsp;</div></li><li><div>                    $term_data = array ();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $params-&gt;id ) || !empty( $term_data ) ) {&nbsp;</div></li><li><div>                    $taxonomy = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $pod[ 'object' ] ) )&nbsp;</div></li><li><div>                        $taxonomy = $pod[ 'object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $params-&gt;id = $this-&gt;save_term( $params-&gt;id, $term, $taxonomy, $term_data, true );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'table' == $pod[ 'storage' ] ) {&nbsp;</div></li><li><div>                // Every row should have an id set here, otherwise Pods with nothing&nbsp;</div></li><li><div>                // but relationship fields won't get properly ID'd&nbsp;</div></li><li><div>                if ( empty( $params-&gt;id ) )&nbsp;</div></li><li><div>                    $params-&gt;id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $table_data = array( 'id' =&gt; $params-&gt;id ) + $table_data;&nbsp;</div></li><li><div>                array_unshift( $table_formats, '%d' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $table_data ) ) {&nbsp;</div></li><li><div>                    $sql = pods_data()-&gt;insert_on_duplicate( &quot;@wp_pods_{$params-&gt;pod}&quot;, $table_data, $table_formats );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $id = pods_query( $sql, 'Cannot add/save table row' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $params-&gt;id ) )&nbsp;</div></li><li><div>                        $params-&gt;id = $id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = (int) $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save terms for taxonomies associated to a post type&nbsp;</div></li><li><div>        if ( 0 &lt; $params-&gt;id && 'post_type' == $pod[ 'type' ] && !empty( $post_term_data ) ) {&nbsp;</div></li><li><div>            foreach ( $post_term_data as $post_taxonomy =&gt; $post_terms ) {&nbsp;</div></li><li><div>                $post_terms = (array) $post_terms;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $post_terms as $k =&gt; $v ) {&nbsp;</div></li><li><div>                    if ( ! preg_match( '/[^0-9]/', $v ) ) {&nbsp;</div></li><li><div>                        $v = (int) $v;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $post_terms[ $k ] = $v;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                wp_set_object_terms( $params-&gt;id, $post_terms, $post_taxonomy );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $no_conflict = pods_no_conflict_check( $pod[ 'type' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$no_conflict )&nbsp;</div></li><li><div>            pods_no_conflict_on( $pod[ 'type' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save relationship / file data&nbsp;</div></li><li><div>        if ( !empty( $rel_fields ) ) {&nbsp;</div></li><li><div>            foreach ( $rel_fields as $type =&gt; $data ) {&nbsp;</div></li><li><div>                // Only handle tableless fields&nbsp;</div></li><li><div>                if ( !in_array( $type, $tableless_field_types ) ) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $data as $field =&gt; $values ) {&nbsp;</div></li><li><div>                    $pick_val = pods_var( 'pick_val', $fields[ $field ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'table' == pods_var( 'pick_object', $fields[ $field ] ) ) {&nbsp;</div></li><li><div>                        $pick_val = pods_var( 'pick_table', $fields[ $field ][ 'options' ], $pick_val, null, true );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( '__current__' == $pick_val ) {&nbsp;</div></li><li><div>                        if ( is_object( $pod ) ) {&nbsp;</div></li><li><div>                            $pick_val = $pod-&gt;pod;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif ( is_array( $pod ) ) {&nbsp;</div></li><li><div>                            $pick_val = $pod[ 'name' ];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif ( 0 &lt; strlen( $pod ) ) {&nbsp;</div></li><li><div>                            $pick_val = $pod;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $fields[ $field ][ 'options' ][ 'table_info' ] = pods_api()-&gt;get_table_info( pods_var( 'pick_object', $fields[ $field ] ), $pick_val, null, null, $fields[ $field ][ 'options' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $fields[ $field ][ 'options' ][ 'table_info' ][ 'pod' ] ) && !empty( $fields[ $field ][ 'options' ][ 'table_info' ][ 'pod' ] ) && isset( $fields[ $field ][ 'options' ][ 'table_info' ][ 'pod' ][ 'name' ] ) ) {&nbsp;</div></li><li><div>                        $search_data = pods( $fields[ $field ][ 'options' ][ 'table_info' ][ 'pod' ][ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $data_mode = 'pods';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $search_data = pods_data();&nbsp;</div></li><li><div>                        $search_data-&gt;table( $fields[ $field ][ 'options' ][ 'table_info' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $data_mode = 'data';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $find_rel_params = array(&nbsp;</div></li><li><div>                        'select' =&gt; &quot;`t`.`{$search_data-&gt;field_id}`&quot;, &nbsp;</div></li><li><div>                        'where' =&gt; &quot;`t`.`{$search_data-&gt;field_slug}` = %s OR `t`.`{$search_data-&gt;field_index}` = %s&quot;, &nbsp;</div></li><li><div>                        'limit' =&gt; 1, &nbsp;</div></li><li><div>                        'pagination' =&gt; false, &nbsp;</div></li><li><div>                        'search' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $search_data-&gt;field_slug ) && !empty( $search_data-&gt;field_index ) ) {&nbsp;</div></li><li><div>                        $find_rel_params[ 'where' ] = &quot;`t`.`{$search_data-&gt;field_index}` = %s&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif ( empty( $search_data-&gt;field_slug ) && empty( $search_data-&gt;field_index ) ) {&nbsp;</div></li><li><div>                        $find_rel_params = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $related_limit = (int) pods_var_raw( $type . '_limit', $fields[ $field ][ 'options' ], 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( 'single' == pods_var_raw( $type . '_format_type', $fields[ $field ][ 'options' ] ) ) {&nbsp;</div></li><li><div>                        $related_limit = 1;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Enforce integers / unique values for IDs&nbsp;</div></li><li><div>                    $value_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $is_file_field = in_array( $type, PodsForm::file_field_types() );&nbsp;</div></li><li><div>                    $is_taggable = ( in_array( $type, PodsForm::tableless_field_types() ) && 1 == pods_v( $type . '_taggable', $fields[ $field ][ 'options' ] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // @todo Handle simple relationships eventually&nbsp;</div></li><li><div>                    foreach ( $values as $v ) {&nbsp;</div></li><li><div>                        if ( !empty( $v ) ) {&nbsp;</div></li><li><div>                            if ( !is_array( $v ) ) {&nbsp;</div></li><li><div>                                if ( !preg_match( '/[^0-9]/', $v ) ) {&nbsp;</div></li><li><div>                                    $v = (int) $v;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                // File handling&nbsp;</div></li><li><div>                                elseif ( $is_file_field ) {&nbsp;</div></li><li><div>                                    // Get ID from GUID&nbsp;</div></li><li><div>                                    $v = pods_image_id_from_field( $v );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // If file not found, add it&nbsp;</div></li><li><div>                                    if ( empty( $v ) ) {&nbsp;</div></li><li><div>                                        $v = pods_attachment_import( $v );&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                // Reference by slug&nbsp;</div></li><li><div>                                else {&nbsp;</div></li><li><div>                                    $v_data = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( false !== $find_rel_params ) {&nbsp;</div></li><li><div>                                        $rel_params = $find_rel_params;&nbsp;</div></li><li><div>                                        $rel_params[ 'where' ] = $wpdb-&gt;prepare( $rel_params[ 'where' ], array( $v, $v ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $search_data-&gt;select( $rel_params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $v_data = $search_data-&gt;fetch( $v );&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( !empty( $v_data ) && isset( $v_data[ $search_data-&gt;field_id ] ) ) {&nbsp;</div></li><li><div>                                        $v = (int) $v_data[ $search_data-&gt;field_id ];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    // Allow tagging for Pods objects&nbsp;</div></li><li><div>                                    elseif ( $is_taggable && 'pods' == $data_mode ) {&nbsp;</div></li><li><div>                                        $tag_data = array(&nbsp;</div></li><li><div>                                            $search_data-&gt;field_index =&gt; $v&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        if ( 'post_type' == $search_data-&gt;pod_data[ 'type' ] ) {&nbsp;</div></li><li><div>                                            $tag_data[ 'post_status' ] = 'publish';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        /**&nbsp;</div></li><li><div>                                         * Filter for changing tag before adding new item.&nbsp;</div></li><li><div>                                         *&nbsp;</div></li><li><div>                                         * @param array $tag_data Fields for creating new item.&nbsp;</div></li><li><div>                                         * @param int $v Field ID of tag.&nbsp;</div></li><li><div>                                         * @param obj $search_data Search object for tag.&nbsp;</div></li><li><div>                                         * @param string $field Table info for field.&nbsp;</div></li><li><div>                                         * @param array    $pieces Field array.&nbsp;</div></li><li><div>                                         *&nbsp;</div></li><li><div>                                         * @since 2.3.19&nbsp;</div></li><li><div>                                         */&nbsp;</div></li><li><div>                                        $tag_data = apply_filters( 'pods_api_save_pod_item_taggable_data', $tag_data, $v, $search_data, $field, compact( $pieces ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        // Save $v to a new item on related object&nbsp;</div></li><li><div>                                        $v = $search_data-&gt;add( $tag_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        // @todo Support non-Pods for tagging&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            elseif ( $is_file_field && isset( $v[ 'id' ] ) ) {&nbsp;</div></li><li><div>                                $v = (int) $v[ 'id' ];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else {&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( !empty( $v ) && !in_array( $v, $value_ids ) ) {&nbsp;</div></li><li><div>                                $value_ids[] = $v;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value_ids = array_unique( array_filter( $value_ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Limit values&nbsp;</div></li><li><div>                    if ( 0 &lt; $related_limit && !empty( $value_ids ) )&nbsp;</div></li><li><div>                        $value_ids = array_slice( $value_ids, 0, $related_limit );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Get current values&nbsp;</div></li><li><div>                    if ( 'pick' == $type && isset( PodsField_Pick::$related_data[ $fields[ $field ][ 'id' ] ] ) && isset( PodsField_Pick::$related_data[ $fields[ $field ][ 'id' ] ][ 'current_ids' ] ) )&nbsp;</div></li><li><div>                        $related_ids = PodsField_Pick::$related_data[ $fields[ $field ][ 'id' ] ][ 'current_ids' ];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $related_ids = $this-&gt;lookup_related_items( $fields[ $field ][ 'id' ], $pod[ 'id' ], $params-&gt;id, $fields[ $field ], $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Get ids to remove&nbsp;</div></li><li><div>                    $remove_ids = array_diff( $related_ids, $value_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Delete relationships&nbsp;</div></li><li><div>                    if ( !empty( $remove_ids ) )&nbsp;</div></li><li><div>                        $this-&gt;delete_relationships( $params-&gt;id, $remove_ids, $pod, $fields[ $field ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Save relationships&nbsp;</div></li><li><div>                    if ( !empty( $value_ids ) )&nbsp;</div></li><li><div>                        $this-&gt;save_relationships( $params-&gt;id, $value_ids, $pod, $fields[ $field ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Run save function for field type (where needed)&nbsp;</div></li><li><div>                    PodsForm::save( $type, $values, $params-&gt;id, $field, array_merge( $fields[ $field ], $fields[ $field ][ 'options' ] ), array_merge( $fields, $object_fields ), $pod, $params );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Unset data no longer needed&nbsp;</div></li><li><div>                if ( 'pick' == $type ) {&nbsp;</div></li><li><div>                    foreach ( $data as $field =&gt; $values ) {&nbsp;</div></li><li><div>                        if ( isset( PodsField_Pick::$related_data[ $fields[ $field ][ 'id' ] ] ) ) {&nbsp;</div></li><li><div>                            unset( PodsField_Pick::$related_data[ PodsField_Pick::$related_data[ $fields[ $field ][ 'id' ] ][ 'related_field' ][ 'id' ] ] );&nbsp;</div></li><li><div>                            unset( PodsField_Pick::$related_data[ $fields[ $field ][ 'id' ] ] );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$no_conflict )&nbsp;</div></li><li><div>            pods_no_conflict_off( $pod[ 'type' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $bypass_helpers ) {&nbsp;</div></li><li><div>            $pieces = compact( $pieces );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Plugin hooks&nbsp;</div></li><li><div>            $this-&gt;do_hook( 'post_save_pod_item', $pieces, $is_new_item, $params-&gt;id );&nbsp;</div></li><li><div>            $this-&gt;do_hook( &quot;post_save_pod_item_{$params-&gt;pod}&quot;, $pieces, $is_new_item, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $is_new_item ) {&nbsp;</div></li><li><div>                $this-&gt;do_hook( 'post_create_pod_item', $pieces, $params-&gt;id );&nbsp;</div></li><li><div>                $this-&gt;do_hook( &quot;post_create_pod_item_{$params-&gt;pod}&quot;, $pieces, $params-&gt;id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $this-&gt;do_hook( 'post_edit_pod_item', $pieces, $params-&gt;id );&nbsp;</div></li><li><div>                $this-&gt;do_hook( &quot;post_edit_pod_item_{$params-&gt;pod}&quot;, $pieces, $params-&gt;id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Call any post-save helpers (if not bypassed)&nbsp;</div></li><li><div>            if ( !defined( 'PODS_DISABLE_EVAL' ) || !PODS_DISABLE_EVAL ) {&nbsp;</div></li><li><div>                if ( !empty( $post_save_helpers ) ) {&nbsp;</div></li><li><div>                    pods_deprecated( sprintf( __( 'Post-save helpers are deprecated, use the action pods_post_save_pod_item_%s instead', 'pods' ), $params-&gt;pod ), '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $post_save_helpers as $helper ) {&nbsp;</div></li><li><div>                        $helper = $this-&gt;load_helper( array( 'name' =&gt; $helper ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( false !== $helper && ( !defined( 'PODS_DISABLE_EVAL' ) || !PODS_DISABLE_EVAL ) )&nbsp;</div></li><li><div>                            eval( '?&gt;' . $helper[ 'code' ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Clear cache&nbsp;</div></li><li><div>        pods_cache_clear( $params-&gt;id, 'pods_items_' . $pod[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $params-&gt;clear_slug_cache && !empty( $pod[ 'field_slug' ] ) ) {&nbsp;</div></li><li><div>            $slug = pods( $pod[ 'name' ], $params-&gt;id )-&gt;field( $pod[ 'field_slug' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 0 &lt; strlen( $slug ) ) {&nbsp;</div></li><li><div>                pods_cache_clear( $slug, 'pods_items_' . $pod[ 'name' ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Clear WP meta cache&nbsp;</div></li><li><div>        if ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy', 'user', 'comment' ) ) ) {&nbsp;</div></li><li><div>            $meta_type = $pod[ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $meta_type )&nbsp;</div></li><li><div>                $meta_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_cache_delete( $params-&gt;id, $meta_type . '_meta' );&nbsp;</div></li><li><div>            wp_cache_delete( $params-&gt;id, 'pods_' . $meta_type . '_meta' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Success! Return the id&nbsp;</div></li><li><div>        return $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::save_pod_item&nbsp;</div></li><li><div>     * Add multiple pod items&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name (pod or pod_id is required)&nbsp;</div></li><li><div>     * $params['pod_id'] string The Pod ID (pod or pod_id is required)&nbsp;</div></li><li><div>     * $params['bypass_helpers'] bool Set to true to bypass running pre-save and post-save helpers&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $data['id'] int The item ID (optional)&nbsp;</div></li><li><div>     * $data['data'] array An associative array of field names + values&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters, data excluded&nbsp;</div></li><li><div>     * @param array $data An associative array of pod ids and field names + values (arrays of field data)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The item ID&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_pod_items ( $params, $data ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $data as $fields ) {&nbsp;</div></li><li><div>            $params-&gt;data = $fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $fields[ 'id' ] ) && isset( $fields[ 'data' ] ) ) {&nbsp;</div></li><li><div>                $params-&gt;id = $fields[ 'id' ];&nbsp;</div></li><li><div>                $params-&gt;data = $fields[ 'data' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $ids[] = $this-&gt;save_pod_item( $params );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $ids;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the fields that have changed during a save&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $pieces Pieces array from save_pod_item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of fields and values that have changed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_changed_fields( $pieces ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = $pieces[ 'fields' ];&nbsp;</div></li><li><div>        $fields_active = $pieces[ 'fields_active' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields_changed = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 &lt; $pieces[ 'params' ]-&gt;id ) {&nbsp;</div></li><li><div>            $pod = pods( $pieces[ 'params' ]-&gt;pod, $pieces[ 'params' ]-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $fields_active as $field ) {&nbsp;</div></li><li><div>                if ( isset( $fields[ $field ] ) && $pod-&gt;raw( $field ) != $fields[ $field ][ 'value' ] ) {&nbsp;</div></li><li><div>                    $fields_changed[ $field ] = $fields[ $field ][ 'value' ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $fields_changed;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save relationships&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $id ID of item&nbsp;</div></li><li><div>     * @param int|array $related_id ID or IDs to save&nbsp;</div></li><li><div>     * @param array $pod Pod data&nbsp;</div></li><li><div>     * @param array $field Field data&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_relationships ( $id, $related_ids, $pod, $field ) {&nbsp;</div></li><li><div>        // Get current values&nbsp;</div></li><li><div>        if ( 'pick' == $field[ 'type' ] && isset( PodsField_Pick::$related_data[ $field[ 'id' ] ] ) && isset( PodsField_Pick::$related_data[ $field[ 'id' ] ][ 'current_ids' ] ) )&nbsp;</div></li><li><div>            $current_ids = PodsField_Pick::$related_data[ $field[ 'id' ] ][ 'current_ids' ];&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $current_ids = $this-&gt;lookup_related_items( $field[ 'id' ], $pod[ 'id' ], $id, $field, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $related_ids ) )&nbsp;</div></li><li><div>            $related_ids = implode( ', ', $related_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $related_ids as $k =&gt; $related_id ) {&nbsp;</div></li><li><div>            $related_ids[ $k ] = (int) $related_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $related_ids = array_unique( array_filter( $related_ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $related_limit = (int) pods_var_raw( $field[ 'type' ] . '_limit', $field[ 'options' ], 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'single' == pods_var_raw( $field[ 'type' ] . '_format_type', $field[ 'options' ] ) )&nbsp;</div></li><li><div>            $related_limit = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Limit values&nbsp;</div></li><li><div>        if ( 0 &lt; $related_limit && !empty( $related_ids ) )&nbsp;</div></li><li><div>            $related_ids = array_slice( $related_ids, 0, $related_limit );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Post Types, Media, Users, and Comments (meta-based)&nbsp;</div></li><li><div>        if ( in_array( $pod[ 'type' ], array( 'post_type', 'media', 'user', 'comment' ) ) ) {&nbsp;</div></li><li><div>            $object_type = $pod[ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $object_type || 'media' == $object_type )&nbsp;</div></li><li><div>                $object_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            delete_metadata( $object_type, $id, $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $related_ids ) ) {&nbsp;</div></li><li><div>                update_metadata( $object_type, $id, '_pods_' . $field[ 'name' ], $related_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $related_ids as $related_id ) {&nbsp;</div></li><li><div>                    add_metadata( $object_type, $id, $field[ 'name' ], $related_id );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                delete_metadata( $object_type, $id, '_pods_' . $field[ 'name' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Custom Settings Pages (options-based)&nbsp;</div></li><li><div>        elseif ( 'settings' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            if ( !empty( $related_ids ) )&nbsp;</div></li><li><div>                update_option( $pod[ 'name' ] . '_' . $field[ 'name' ], $related_ids );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                delete_option( $pod[ 'name' ] . '_' . $field[ 'name' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $related_pod_id = $related_field_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'pick' == $field[ 'type' ] && isset( PodsField_Pick::$related_data[ $field[ 'id' ] ] ) && !empty( PodsField_Pick::$related_data[ $field[ 'id' ] ][ 'related_field' ] ) ) {&nbsp;</div></li><li><div>            $related_pod_id = PodsField_Pick::$related_data[ $field[ 'id' ] ][ 'related_pod' ][ 'id' ];&nbsp;</div></li><li><div>            $related_field_id = PodsField_Pick::$related_data[ $field[ 'id' ] ][ 'related_field' ][ 'id' ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Relationships table&nbsp;</div></li><li><div>        if ( !pods_tableless() ) {&nbsp;</div></li><li><div>            $related_weight = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $related_ids as $related_id ) {&nbsp;</div></li><li><div>                if ( in_array( $related_id, $current_ids ) ) {&nbsp;</div></li><li><div>                    pods_query( &quot;&nbsp;</div></li><li><div>                        UPDATE `@wp_podsrel`&nbsp;</div></li><li><div>                        SET&nbsp;</div></li><li><div>                            `pod_id` = %d, &nbsp;</div></li><li><div>                            `field_id` = %d, &nbsp;</div></li><li><div>                            `item_id` = %d, &nbsp;</div></li><li><div>                            `related_pod_id` = %d, &nbsp;</div></li><li><div>                            `related_field_id` = %d, &nbsp;</div></li><li><div>                            `related_item_id` = %d, &nbsp;</div></li><li><div>                            `weight` = %d&nbsp;</div></li><li><div>                        WHERE&nbsp;</div></li><li><div>                            `pod_id` = %d&nbsp;</div></li><li><div>                            AND `field_id` = %d&nbsp;</div></li><li><div>                            AND `item_id` = %d&nbsp;</div></li><li><div>                            AND `related_item_id` = %d&nbsp;</div></li><li><div>                    &quot;, array(&nbsp;</div></li><li><div>                        $pod[ 'id' ], &nbsp;</div></li><li><div>                        $field[ 'id' ], &nbsp;</div></li><li><div>                        $id, &nbsp;</div></li><li><div>                        $related_pod_id, &nbsp;</div></li><li><div>                        $related_field_id, &nbsp;</div></li><li><div>                        $related_id, &nbsp;</div></li><li><div>                        $related_weight, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $pod[ 'id' ], &nbsp;</div></li><li><div>                        $field[ 'id' ], &nbsp;</div></li><li><div>                        $id, &nbsp;</div></li><li><div>                        $related_id, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    pods_query( &quot;&nbsp;</div></li><li><div>                        INSERT INTO `@wp_podsrel`&nbsp;</div></li><li><div>                            (&nbsp;</div></li><li><div>                                `pod_id`, &nbsp;</div></li><li><div>                                `field_id`, &nbsp;</div></li><li><div>                                `item_id`, &nbsp;</div></li><li><div>                                `related_pod_id`, &nbsp;</div></li><li><div>                                `related_field_id`, &nbsp;</div></li><li><div>                                `related_item_id`, &nbsp;</div></li><li><div>                                `weight`&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                        VALUES ( %d, %d, %d, %d, %d, %d, %d )&nbsp;</div></li><li><div>                    &quot;, array(&nbsp;</div></li><li><div>                        $pod[ 'id' ], &nbsp;</div></li><li><div>                        $field[ 'id' ], &nbsp;</div></li><li><div>                        $id, &nbsp;</div></li><li><div>                        $related_pod_id, &nbsp;</div></li><li><div>                        $related_field_id, &nbsp;</div></li><li><div>                        $related_id, &nbsp;</div></li><li><div>                        $related_weight&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $related_weight++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Duplicate a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['name'] string The Pod name&nbsp;</div></li><li><div>     * $params['new_name'] string The new Pod name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $strict (optional) Makes sure a pod exists, if it doesn't throws an error&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int New Pod ID&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function duplicate_pod ( $params, $strict = false ) {&nbsp;</div></li><li><div>        if ( !is_object( $params ) && !is_array( $params ) ) {&nbsp;</div></li><li><div>            if ( is_numeric( $params ) )&nbsp;</div></li><li><div>                $params = array( 'id' =&gt; $params );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $params = array( 'name' =&gt; $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;table_info = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( $params, $strict );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod ) ) {&nbsp;</div></li><li><div>            if ( false !== $strict )&nbsp;</div></li><li><div>                return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $pod[ 'type' ], array( 'media', 'user', 'comment' ) ) ) {&nbsp;</div></li><li><div>            if ( false !== $strict )&nbsp;</div></li><li><div>                return pods_error( __( 'Pod not allowed to be duplicated', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) && 0 &lt; strlen( $pod[ 'object' ] ) ) {&nbsp;</div></li><li><div>            $pod[ 'object' ] = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $pod[ 'id' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;new_name ) )&nbsp;</div></li><li><div>            $pod[ 'name' ] = $params-&gt;new_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $try = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $check_name = $pod[ 'name' ];&nbsp;</div></li><li><div>        $new_label = $pod[ 'label' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while ( $this-&gt;load_pod( array( 'name' =&gt; $check_name, 'table_info' =&gt; false ), false ) ) {&nbsp;</div></li><li><div>            $try++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $check_name = $pod[ 'name' ] . $try;&nbsp;</div></li><li><div>            $new_label = $pod[ 'label' ] . $try;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'name' ] = $check_name;&nbsp;</div></li><li><div>        $pod[ 'label' ] = $new_label;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $pod[ 'fields' ] as $field =&gt; $field_data ) {&nbsp;</div></li><li><div>            unset( $pod[ 'fields' ][ $field ][ 'id' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;save_pod( $pod );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Duplicate a Field&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod_id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name&nbsp;</div></li><li><div>     * $params['id'] int The Field ID&nbsp;</div></li><li><div>     * $params['name'] string The Field name&nbsp;</div></li><li><div>     * $params['new_name'] string The new Field name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $strict (optional) Makes sure a field exists, if it doesn't throws an error&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int New Field ID&nbsp;</div></li><li><div>     * @since 2.3.10&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function duplicate_field( $params, $strict = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_object( $params ) && !is_array( $params ) ) {&nbsp;</div></li><li><div>            if ( is_numeric( $params ) ) {&nbsp;</div></li><li><div>                $params = array( 'id' =&gt; $params );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $params = array( 'name' =&gt; $params );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;table_info = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = $this-&gt;load_field( $params, $strict );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $field ) ) {&nbsp;</div></li><li><div>            if ( false !== $strict ) {&nbsp;</div></li><li><div>                return pods_error( __( 'Field not found', 'pods' ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $field[ 'id' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;new_name ) ) {&nbsp;</div></li><li><div>            $field[ 'name' ] = $params-&gt;new_name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $try = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $check_name = $field[ 'name' ];&nbsp;</div></li><li><div>        $new_label = $field[ 'label' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while ( $this-&gt;load_field( array( 'pod_id' =&gt; $field[ 'pod_id' ], 'name' =&gt; $check_name, 'table_info' =&gt; false ), false ) ) {&nbsp;</div></li><li><div>            $try++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $check_name = $field[ 'name' ] . $try;&nbsp;</div></li><li><div>            $new_label = $field[ 'label' ] . $try;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field[ 'name' ] = $check_name;&nbsp;</div></li><li><div>        $field[ 'label' ] = $new_label;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;save_field( $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::save_pod_item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Duplicate a pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name&nbsp;</div></li><li><div>     * $params['id'] int The item's ID from the wp_pods_* table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The table row ID&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function duplicate_pod_item ( $params ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;pod, 'table_info' =&gt; false ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $pod )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = pods( $params-&gt;pod, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;pod = $pod-&gt;pod;&nbsp;</div></li><li><div>        $params-&gt;pod_id = $pod-&gt;pod_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = (array) pods_var_raw( 'fields', $pod-&gt;pod_data, array(), null, true );&nbsp;</div></li><li><div>        $object_fields = (array) pods_var_raw( 'object_fields', $pod-&gt;pod_data, array(), null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $object_fields ) )&nbsp;</div></li><li><div>            $fields = array_merge( $object_fields, $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $save_params = array(&nbsp;</div></li><li><div>            'pod' =&gt; $params-&gt;pod, &nbsp;</div></li><li><div>            'data' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $fields as $field ) {&nbsp;</div></li><li><div>            $value = $pod-&gt;field( array( 'name' =&gt; $field[ 'name' ], 'output' =&gt; 'ids' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $value ) || ( !is_array( $value ) && 0 &lt; strlen( $value ) ) )&nbsp;</div></li><li><div>                $save_params[ 'data' ][ $field[ 'name' ] ] = $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $save_params = $this-&gt;do_hook( 'duplicate_pod_item', $save_params, $pod-&gt;pod, $pod-&gt;id(), $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = $this-&gt;save_pod_item( $save_params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see pods()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Export a pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name&nbsp;</div></li><li><div>     * $params['id'] int The item's ID from the wp_pods_* table&nbsp;</div></li><li><div>     * $params['fields'] array The fields to export&nbsp;</div></li><li><div>     * $params['depth'] int How many levels deep to export data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param object $pod (optional) Pods object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int The table row ID&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function export_pod_item ( $params, $pod = null ) {&nbsp;</div></li><li><div>        if ( !is_object( $pod ) || 'Pods' != get_class( $pod ) ) {&nbsp;</div></li><li><div>            if ( empty( $params ) )&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod = pods( $params-&gt;pod, $params-&gt;id, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $pod ) )&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = (array) pods_var_raw( 'fields', $params, array(), null, true );&nbsp;</div></li><li><div>        $depth = (int) pods_var_raw( 'depth', $params, 2, null, true );&nbsp;</div></li><li><div>        $object_fields = (array) pods_var_raw( 'object_fields', $pod-&gt;pod_data, array(), null, true );&nbsp;</div></li><li><div>        $flatten = (boolean) pods_var( 'flatten', $params, false, null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $fields ) ) {&nbsp;</div></li><li><div>            $fields = $pod-&gt;fields;&nbsp;</div></li><li><div>            $fields = array_merge( $fields, $object_fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;export_pod_item_level( $pod, $fields, $depth, $flatten );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;do_hook( 'export_pod_item', $data, $pod-&gt;pod, $pod-&gt;id(), $pod, $fields, $depth, $flatten );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Export a pod item by depth level&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param Pods $pod Pods object&nbsp;</div></li><li><div>     * @param array $fields Fields to export&nbsp;</div></li><li><div>     * @param int $depth Depth limit&nbsp;</div></li><li><div>     * @param boolean $flatten Whether to flatten arrays for display&nbsp;</div></li><li><div>     * @param int $current_depth Current depth level&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Data array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function export_pod_item_level ( $pod, $fields, $depth, $flatten = false, $current_depth = 1 ) {&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object_fields = (array) pods_var_raw( 'object_fields', $pod-&gt;pod_data, array(), null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $export_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $fields as $k =&gt; $field ) {&nbsp;</div></li><li><div>            if ( !is_array( $field ) ) {&nbsp;</div></li><li><div>                $field = array(&nbsp;</div></li><li><div>                    'id' =&gt; 0, &nbsp;</div></li><li><div>                    'name' =&gt; $field&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $pod-&gt;fields[ $field[ 'name' ] ] ) ) {&nbsp;</div></li><li><div>                $field = $pod-&gt;fields[ $field[ 'name' ] ];&nbsp;</div></li><li><div>                $field[ 'lookup_name' ] = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( in_array( $field[ 'type' ], $tableless_field_types ) && !in_array( pods_var( 'pick_object', $field ), $simple_tableless_objects ) ) {&nbsp;</div></li><li><div>                    if ( 'pick' == $field[ 'type' ] ) {&nbsp;</div></li><li><div>                        if ( empty( $field[ 'table_info' ] ) )&nbsp;</div></li><li><div>                            $field[ 'table_info' ] = $this-&gt;get_table_info( pods_var_raw( 'pick_object', $field ), pods_var_raw( 'pick_val', $field ), null, null, $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( !empty( $field[ 'table_info' ] ) )&nbsp;</div></li><li><div>                            $field[ 'lookup_name' ] .= '.' . $field[ 'table_info' ][ 'field_id' ];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif ( in_array( $field[ 'type' ], PodsForm::file_field_types() ) )&nbsp;</div></li><li><div>                        $field[ 'lookup_name' ] .= '.guid';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $export_fields[ $field[ 'name' ] ] = $field;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( isset( $object_fields[ $field[ 'name' ] ] ) ) {&nbsp;</div></li><li><div>                $field = $object_fields[ $field[ 'name' ] ];&nbsp;</div></li><li><div>                $field[ 'lookup_name' ] = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $export_fields[ $field[ 'name' ] ] = $field;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( $field[ 'name' ] == $pod-&gt;pod_data[ 'field_id' ] ) {&nbsp;</div></li><li><div>                $field[ 'type' ] = 'number';&nbsp;</div></li><li><div>                $field[ 'lookup_name' ] = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $export_fields[ $field[ 'name' ] ] = $field;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $export_fields as $field ) {&nbsp;</div></li><li><div>            // Return IDs (or guid for files) if only one level deep&nbsp;</div></li><li><div>            if ( 1 == $depth )&nbsp;</div></li><li><div>                $data[ $field[ 'name' ] ] = $pod-&gt;field( array( 'name' =&gt; $field[ 'lookup_name' ], 'output' =&gt; 'arrays' ) );&nbsp;</div></li><li><div>            // Recurse depth levels for pick fields if $depth allows&nbsp;</div></li><li><div>            elseif ( ( -1 == $depth || $current_depth &lt; $depth ) && 'pick' == $field[ 'type' ] && !in_array( pods_var( 'pick_object', $field ), $simple_tableless_objects ) ) {&nbsp;</div></li><li><div>                $related_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $related_ids = $pod-&gt;field( array( 'name' =&gt; $field[ 'name' ], 'output' =&gt; 'ids' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $related_ids ) ) {&nbsp;</div></li><li><div>                    $related_ids = (array) $related_ids;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pick_object = pods_var_raw( 'pick_object', $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $related_pod = pods( pods_var_raw( 'pick_val', $field ), null, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // If this isn't a Pod, return data exactly as Pods does normally&nbsp;</div></li><li><div>                    if ( empty( $related_pod ) || ( 'pod' != $pick_object && $pick_object != $related_pod-&gt;pod_data[ 'type' ] ) || $related_pod-&gt;pod == $pod-&gt;pod )&nbsp;</div></li><li><div>                        $related_data = $pod-&gt;field( array( 'name' =&gt; $field[ 'name' ], 'output' =&gt; 'arrays' ) );&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $related_object_fields = (array) pods_var_raw( 'object_fields', $related_pod-&gt;pod_data, array(), null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $related_fields = array_merge( $related_pod-&gt;fields, $related_object_fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        foreach ( $related_ids as $related_id ) {&nbsp;</div></li><li><div>                            if ( $related_pod-&gt;fetch( $related_id ) ) {&nbsp;</div></li><li><div>                                $related_item = $this-&gt;export_pod_item_level( $related_pod, $related_fields, $depth, $flatten, ( $current_depth + 1 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $related_data[ $related_id ] = $this-&gt;do_hook( 'export_pod_item_level', $related_item, $related_pod-&gt;pod, $related_pod-&gt;id(), $related_pod, $related_fields, $depth, $flatten, ( $current_depth + 1 ) );&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( $flatten && !empty( $related_data ) )&nbsp;</div></li><li><div>                            $related_data = pods_serial_comma( array_values( $related_data ), array( 'and' =&gt; '', 'field_index' =&gt; $related_pod-&gt;pod_data[ 'field_index' ] ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $data[ $field[ 'name' ] ] = $related_data;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Return data exactly as Pods does normally&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $data[ $field[ 'name' ] ] = $pod-&gt;field( array( 'name' =&gt; $field[ 'name' ], 'output' =&gt; 'arrays' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $flatten && is_array( $data[ $field[ 'name' ] ] ) )&nbsp;</div></li><li><div>                $data[ $field[ 'name' ] ] = pods_serial_comma( $data[ $field[ 'name' ] ], array( 'field' =&gt; $field[ 'name' ], 'fields' =&gt; $export_fields, 'and' =&gt; '' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $data[ 'id' ] = (int) $pod-&gt;id();&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reorder a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name&nbsp;</div></li><li><div>     * $params['field'] string The field name of the field to reorder&nbsp;</div></li><li><div>     * $params['order'] array The key =&gt; value array of items to reorder (key should be an integer)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function reorder_pod_item ( $params ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @deprecated 2.0&nbsp;</div></li><li><div>        if ( isset( $params-&gt;datatype ) ) {&nbsp;</div></li><li><div>            pods_deprecated( __( '$params-&gt;pod instead of $params-&gt;datatype', 'pods' ), '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;pod = $params-&gt;datatype;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $params-&gt;datatype );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null === pods_var_raw( 'pod', $params, null, null, true ) )&nbsp;</div></li><li><div>            return pods_error( __( '$params-&gt;pod is required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $params-&gt;order ) )&nbsp;</div></li><li><div>            $params-&gt;order = explode( ', ', $params-&gt;order );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;pod, 'table_info' =&gt; true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;name = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $pod )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod is required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $params-&gt;order as $order =&gt; $id ) {&nbsp;</div></li><li><div>            if ( isset( $pod[ 'fields' ][ $params-&gt;field ] ) || isset( $pod[ 'object_fields' ][ $params-&gt;field ] ) ) {&nbsp;</div></li><li><div>                if ( 'table' == $pod[ 'storage' ] && ( !pods_tableless() ) ) {&nbsp;</div></li><li><div>                    if ( isset( $pod[ 'fields' ][ $params-&gt;field ] ) )&nbsp;</div></li><li><div>                        pods_query( &quot;UPDATE `@wp_pods_{$params-&gt;name}` SET `{$params-&gt;field}` = &quot; . pods_absint( $order ) . &quot; WHERE `id` = &quot; . pods_absint( $id ) . &quot; LIMIT 1&quot; );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        pods_query( &quot;UPDATE `{$pod['table']}` SET `{$params-&gt;field}` = &quot; . pods_absint( $order ) . &quot; WHERE `{$pod['field_id']}` = &quot; . pods_absint( $id ) . &quot; LIMIT 1&quot; );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;save_pod_item( array( 'pod' =&gt; $params-&gt;pod, 'pod_id' =&gt; $params-&gt;pod_id, 'id' =&gt; $id, 'data' =&gt; array( $params-&gt;field =&gt; pods_absint( $order ) ) ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Delete all content for a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['name'] string The Pod name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param array $pod Pod data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses pods_query&nbsp;</div></li><li><div>     * @uses pods_cache_clear&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function reset_pod ( $params, $pod = false ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;table_info = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod ) )&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $pod )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = $pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;name = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !pods_tableless() ) {&nbsp;</div></li><li><div>            if ( 'table' == $pod[ 'storage' ] ) {&nbsp;</div></li><li><div>                try {&nbsp;</div></li><li><div>                    pods_query( &quot;TRUNCATE `@wp_pods_{$params-&gt;name}`&quot;, false );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                catch ( Exception $e ) {&nbsp;</div></li><li><div>                    // Allow pod to be reset if the table doesn't exist&nbsp;</div></li><li><div>                    if ( false === strpos( $e-&gt;getMessage(), 'Unknown table' ) )&nbsp;</div></li><li><div>                        return pods_error( $e-&gt;getMessage(), $this );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( &quot;DELETE FROM `@wp_podsrel` WHERE `pod_id` = {$params-&gt;id} OR `related_pod_id` = {$params-&gt;id}&quot;, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @todo Delete relationships from tableless relationships&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete all posts/revisions from this post type&nbsp;</div></li><li><div>        if ( in_array( $pod[ 'type' ], array( 'post_type', 'media' ) ) ) {&nbsp;</div></li><li><div>            $type = pods_var( 'object', $pod, $pod[ 'name' ], null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>                DELETE `t`, `r`, `m`&nbsp;</div></li><li><div>                FROM `{$pod['table']}` AS `t`&nbsp;</div></li><li><div>                LEFT JOIN `{$pod['meta_table']}` AS `m`&nbsp;</div></li><li><div>                    ON `m`.`{$pod['meta_field_id']}` = `t`.`{$pod['field_id']}`&nbsp;</div></li><li><div>                LEFT JOIN `{$pod['table']}` AS `r`&nbsp;</div></li><li><div>                    ON `r`.`post_parent` = `t`.`{$pod['field_id']}` AND `r`.`post_status` = 'inherit'&nbsp;</div></li><li><div>                WHERE `t`.`{$pod['field_type']}` = '{$type}'&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( $sql, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Delete all terms from this taxonomy&nbsp;</div></li><li><div>        elseif ( 'taxonomy' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            $type = pods_var( 'object', $pod, $pod[ 'name' ], null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>                DELETE FROM `{$pod['table']}` AS `t`&nbsp;</div></li><li><div>                &quot; . $pod['join']['tt'] . &quot;&nbsp;</div></li><li><div>                WHERE &quot; . implode( ' AND ', $pod['where'] ) . &quot;&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( $sql, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Delete all users except the current one&nbsp;</div></li><li><div>        elseif ( 'user' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>                DELETE `t`, `m`&nbsp;</div></li><li><div>                FROM `{$pod['table']}` AS `t`&nbsp;</div></li><li><div>                LEFT JOIN `{$pod['meta_table']}` AS `m`&nbsp;</div></li><li><div>                    ON `m`.`{$pod['meta_field_id']}` = `t`.`{$pod['field_id']}`&nbsp;</div></li><li><div>                WHERE `t`.`{$pod['field_id']}` != &quot; . (int) get_current_user_id() . &quot;&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( $sql, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Delete all comments&nbsp;</div></li><li><div>        elseif ( 'comment' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            $type = pods_var( 'object', $pod, $pod[ 'name' ], null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>                DELETE `t`, `m`&nbsp;</div></li><li><div>                FROM `{$pod['table']}` AS `t`&nbsp;</div></li><li><div>                LEFT JOIN `{$pod['meta_table']}` AS `m`&nbsp;</div></li><li><div>                    ON `m`.`{$pod['meta_field_id']}` = `t`.`{$pod['field_id']}`&nbsp;</div></li><li><div>                WHERE `t`.`{$pod['field_type']}` = '{$type}'&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( $sql, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_cache_clear( true ); // only way to reliably clear out cached data across an entire group&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete a Pod and all its content&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['name'] string The Pod name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $strict (optional) Makes sure a pod exists, if it doesn't throws an error&nbsp;</div></li><li><div>     * @param bool $delete_all (optional) Whether to delete all content from a WP object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsAPI::load_pod&nbsp;</div></li><li><div>     * @uses wp_delete_post&nbsp;</div></li><li><div>     * @uses pods_query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_pod ( $params, $strict = false, $delete_all = false ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_object( $params ) && !is_array( $params ) ) {&nbsp;</div></li><li><div>            if ( is_numeric( $params ) )&nbsp;</div></li><li><div>                $params = array( 'id' =&gt; $params );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $params = array( 'name' =&gt; $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;table_info = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( $params, $strict );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod ) ) {&nbsp;</div></li><li><div>            if ( false !== $strict )&nbsp;</div></li><li><div>                return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = (int) $pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;name = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $pod[ 'fields' ] as $field ) {&nbsp;</div></li><li><div>            $field[ 'pod' ] = $pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;delete_field( $field, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only delete the post once the fields are taken care of, it's not required anymore&nbsp;</div></li><li><div>        $success = wp_delete_post( $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$success )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod unable to be deleted', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Reset content&nbsp;</div></li><li><div>        if ( $delete_all )&nbsp;</div></li><li><div>            $this-&gt;reset_pod( $params, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !pods_tableless() ) {&nbsp;</div></li><li><div>            if ( 'table' == $pod[ 'storage' ] ) {&nbsp;</div></li><li><div>                try {&nbsp;</div></li><li><div>                    pods_query( &quot;DROP TABLE IF EXISTS `@wp_pods_{$params-&gt;name}`&quot;, false );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                catch ( Exception $e ) {&nbsp;</div></li><li><div>                    // Allow pod to be deleted if the table doesn't exist&nbsp;</div></li><li><div>                    if ( false === strpos( $e-&gt;getMessage(), 'Unknown table' ) )&nbsp;</div></li><li><div>                        return pods_error( $e-&gt;getMessage(), $this );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_query( &quot;DELETE FROM `@wp_podsrel` WHERE `pod_id` = {$params-&gt;id} OR `related_pod_id` = {$params-&gt;id}&quot;, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @todo Delete relationships from tableless relationships&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete any relationship references&nbsp;</div></li><li><div>        $sql = &quot;&nbsp;</div></li><li><div>            DELETE `pm`&nbsp;</div></li><li><div>            FROM `{$wpdb-&gt;postmeta}` AS `pm`&nbsp;</div></li><li><div>            LEFT JOIN `{$wpdb-&gt;posts}` AS `p`&nbsp;</div></li><li><div>                ON `p`.`post_type` = '_pods_field'&nbsp;</div></li><li><div>                    AND `p`.`ID` = `pm`.`post_id`&nbsp;</div></li><li><div>            LEFT JOIN `{$wpdb-&gt;postmeta}` AS `pm2`&nbsp;</div></li><li><div>                ON `pm2`.`meta_key` = 'pick_object'&nbsp;</div></li><li><div>                    AND `pm2`.`meta_value` = 'pod'&nbsp;</div></li><li><div>                    AND `pm2`.`post_id` = `pm`.`post_id`&nbsp;</div></li><li><div>            WHERE&nbsp;</div></li><li><div>                `p`.`ID` IS NOT NULL&nbsp;</div></li><li><div>                AND `pm2`.`meta_id` IS NOT NULL&nbsp;</div></li><li><div>                AND `pm`.`meta_key` = 'pick_val'&nbsp;</div></li><li><div>                AND `pm`.`meta_value` = '{$params-&gt;name}'&nbsp;</div></li><li><div>        &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_query( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;cache_flush_pods( $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a field within a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The field ID&nbsp;</div></li><li><div>     * $params['name'] int The field name&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name&nbsp;</div></li><li><div>     * $params['pod_id'] string The Pod name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $table_operation Whether or not to handle table operations&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsAPI::load_field&nbsp;</div></li><li><div>     * @uses wp_delete_post&nbsp;</div></li><li><div>     * @uses pods_query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_field ( $params, $table_operation = true ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod ) )&nbsp;</div></li><li><div>            $params-&gt;pod = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod_id ) )&nbsp;</div></li><li><div>            $params-&gt;pod_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $params-&gt;pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $save_pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $pod ) )&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'name' =&gt; $pod, 'id' =&gt; $params-&gt;pod_id, 'table_info' =&gt; false ) );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $save_pod = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;pod_id = $pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;name ) )&nbsp;</div></li><li><div>            $params-&gt;name = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;id ) )&nbsp;</div></li><li><div>            $params-&gt;id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = $this-&gt;load_field( array( 'name' =&gt; $params-&gt;name, 'id' =&gt; $params-&gt;id, 'pod' =&gt; $params-&gt;pod, 'pod_id' =&gt; $params-&gt;pod_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $field )&nbsp;</div></li><li><div>            return pods_error( __( 'Field not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = $field[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;name = $field[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $simple = ( 'pick' == $field[ 'type' ] && in_array( pods_var( 'pick_object', $field ), $simple_tableless_objects ) );&nbsp;</div></li><li><div>        $simple = (boolean) $this-&gt;do_hook( 'tableless_custom', $simple, $field, $pod, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $table_operation && 'table' == $pod[ 'storage' ] && ( !in_array( $field[ 'type' ], $tableless_field_types ) || $simple ) )&nbsp;</div></li><li><div>            pods_query( &quot;ALTER TABLE `@wp_pods_{$params-&gt;pod}` DROP COLUMN `{$params-&gt;name}`&quot;, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $success = wp_delete_post( $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$success )&nbsp;</div></li><li><div>            return pods_error( __( 'Field unable to be deleted', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wpdb-&gt;query( $wpdb-&gt;prepare( &quot;DELETE pm FROM {$wpdb-&gt;postmeta} AS pm&nbsp;</div></li><li><div>            LEFT JOIN {$wpdb-&gt;posts} AS p&nbsp;</div></li><li><div>                ON p.post_type = '_pods_field' AND p.ID = pm.post_id&nbsp;</div></li><li><div>            WHERE p.ID IS NOT NULL AND pm.meta_key = 'sister_id' AND pm.meta_value = %d&quot;, $params-&gt;id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( !pods_tableless() ) && $table_operation ) {&nbsp;</div></li><li><div>            pods_query( &quot;DELETE FROM `@wp_podsrel` WHERE (`pod_id` = {$params-&gt;pod_id} AND `field_id` = {$params-&gt;id}) OR (`related_pod_id` = {$params-&gt;pod_id} AND `related_field_id` = {$params-&gt;id})&quot;, false );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @todo Delete tableless relationship meta&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( true === $save_pod )&nbsp;</div></li><li><div>            $this-&gt;cache_flush_pods( $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a Pod Object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The object ID&nbsp;</div></li><li><div>     * $params['name'] string The object name&nbsp;</div></li><li><div>     * $params['type'] string The object type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses wp_delete_post&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_object ( $params ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $object = $this-&gt;load_object( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $object ) )&nbsp;</div></li><li><div>            return pods_error( sprintf( __( &quot;%s Object not found&quot;, 'pods' ), ucwords( $params-&gt;type ) ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $success = wp_delete_post( $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$success )&nbsp;</div></li><li><div>            return pods_error( sprintf( __( &quot;%s Object not deleted&quot;, 'pods' ), ucwords( $params-&gt;type ) ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_transient_clear( 'pods_objects_' . $params-&gt;type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::delete_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Drop a Pod Template&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The template ID&nbsp;</div></li><li><div>     * $params['name'] string The template name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_template ( $params ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $params-&gt;type = 'template';&nbsp;</div></li><li><div>        return $this-&gt;delete_object( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::delete_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Drop a Pod Page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The page ID&nbsp;</div></li><li><div>     * $params['uri'] string The page URI&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_page ( $params ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if ( isset( $params-&gt;uri ) ) {&nbsp;</div></li><li><div>            $params-&gt;name = $params-&gt;uri;&nbsp;</div></li><li><div>            unset( $params-&gt;uri );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( isset( $params-&gt;name ) )&nbsp;</div></li><li><div>            $params-&gt;name = trim( $params-&gt;name, '/' );&nbsp;</div></li><li><div>        $params-&gt;type = 'page';&nbsp;</div></li><li><div>        return $this-&gt;delete_object( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::delete_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Drop a Pod Helper&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The helper ID&nbsp;</div></li><li><div>     * $params['name'] string The helper name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_helper ( $params ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $params-&gt;type = 'helper';&nbsp;</div></li><li><div>        return $this-&gt;delete_object( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a single pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int (optional) The item's ID from the wp_pod_* table (used with datatype parameter)&nbsp;</div></li><li><div>     * $params['pod'] string (optional) The Pod name (used with id parameter)&nbsp;</div></li><li><div>     * $params['pod_id'] int (optional) The Pod ID (used with id parameter)&nbsp;</div></li><li><div>     * $params['bypass_helpers'] bool Set to true to bypass running pre-save and post-save helpers&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $wp Whether to run WP object delete action&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_pod_item ( $params, $wp = true ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @deprecated 2.0&nbsp;</div></li><li><div>        if ( isset( $params-&gt;datatype_id ) || isset( $params-&gt;datatype ) || isset( $params-&gt;tbl_row_id ) ) {&nbsp;</div></li><li><div>            if ( isset( $params-&gt;tbl_row_id ) ) {&nbsp;</div></li><li><div>                pods_deprecated( __( '$params-&gt;id instead of $params-&gt;tbl_row_id', 'pods' ), '2.0' );&nbsp;</div></li><li><div>                $params-&gt;id = $params-&gt;tbl_row_id;&nbsp;</div></li><li><div>                unset( $params-&gt;tbl_row_id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;pod_id ) ) {&nbsp;</div></li><li><div>                pods_deprecated( __( '$params-&gt;id instead of $params-&gt;pod_id', 'pods' ), '2.0' );&nbsp;</div></li><li><div>                $params-&gt;id = $params-&gt;pod_id;&nbsp;</div></li><li><div>                unset( $params-&gt;pod_id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;dataype_id ) ) {&nbsp;</div></li><li><div>                pods_deprecated( __( '$params-&gt;pod_id instead of $params-&gt;datatype_id', 'pods' ), '2.0' );&nbsp;</div></li><li><div>                $params-&gt;pod_id = $params-&gt;dataype_id;&nbsp;</div></li><li><div>                unset( $params-&gt;dataype_id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;datatype ) ) {&nbsp;</div></li><li><div>                pods_deprecated( __( '$params-&gt;pod instead of $params-&gt;datatype', 'pods' ), '2.0' );&nbsp;</div></li><li><div>                $params-&gt;pod = $params-&gt;datatype;&nbsp;</div></li><li><div>                unset( $params-&gt;datatype );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;id ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod Item not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = pods_absint( $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod ) )&nbsp;</div></li><li><div>            $params-&gt;pod = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod_id ) )&nbsp;</div></li><li><div>            $params-&gt;pod_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;pod, 'id' =&gt; $params-&gt;pod_id, 'table_info' =&gt; false ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $pod )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;pod_id = $pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow Helpers to bypass subsequent helpers in recursive delete_pod_item calls&nbsp;</div></li><li><div>        $bypass_helpers = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;bypass_helpers ) && false !== $params-&gt;bypass_helpers )&nbsp;</div></li><li><div>            $bypass_helpers = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pre_delete_helpers = $post_delete_helpers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $bypass_helpers ) {&nbsp;</div></li><li><div>            // Plugin hook&nbsp;</div></li><li><div>            $this-&gt;do_hook( 'pre_delete_pod_item', $params, $pod );&nbsp;</div></li><li><div>            $this-&gt;do_hook( &quot;pre_delete_pod_item_{$params-&gt;pod}&quot;, $params, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Call any pre-save helpers (if not bypassed)&nbsp;</div></li><li><div>            if ( !defined( 'PODS_DISABLE_EVAL' ) || !PODS_DISABLE_EVAL ) {&nbsp;</div></li><li><div>                if ( !empty( $pod[ 'options' ] ) && is_array( $pod[ 'options' ] ) ) {&nbsp;</div></li><li><div>                    $helpers = array( 'pre_delete_helpers', 'post_delete_helpers' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $helpers as $helper ) {&nbsp;</div></li><li><div>                        if ( isset( $pod[ 'options' ][ $helper ] ) && !empty( $pod[ 'options' ][ $helper ] ) )&nbsp;</div></li><li><div>                            ${$helper} = explode( ', ', $pod[ 'options' ][ $helper ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $pre_delete_helpers ) ) {&nbsp;</div></li><li><div>                    pods_deprecated( sprintf( __( 'Pre-delete helpers are deprecated, use the action pods_pre_delete_pod_item_%s instead', 'pods' ), $params-&gt;pod ), '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $pre_delete_helpers as $helper ) {&nbsp;</div></li><li><div>                        $helper = $this-&gt;load_helper( array( 'name' =&gt; $helper ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( false !== $helper )&nbsp;</div></li><li><div>                            eval( '?&gt;' . $helper[ 'code' ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete object from relationship fields&nbsp;</div></li><li><div>        $this-&gt;delete_object_from_relationships( $params-&gt;id, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'table' == $pod[ 'storage' ] )&nbsp;</div></li><li><div>            pods_query( &quot;DELETE FROM `@wp_pods_{$params-&gt;pod}` WHERE `id` = {$params-&gt;id} LIMIT 1&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $wp && 'taxonomy' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            $taxonomy = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod[ 'object' ] ) )&nbsp;</div></li><li><div>                $taxonomy = $pod[ 'object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_delete_term( $params-&gt;id, $taxonomy );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( $wp && !in_array( $pod[ 'type' ], array( 'pod', 'table', '', 'taxonomy' ) ) )&nbsp;</div></li><li><div>            $this-&gt;delete_wp_object( $pod[ 'type' ], $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $bypass_helpers ) {&nbsp;</div></li><li><div>            // Plugin hook&nbsp;</div></li><li><div>            $this-&gt;do_hook( 'post_delete_pod_item', $params, $pod );&nbsp;</div></li><li><div>            $this-&gt;do_hook( &quot;post_delete_pod_item_{$params-&gt;pod}&quot;, $params, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Call any post-save helpers (if not bypassed)&nbsp;</div></li><li><div>            if ( !defined( 'PODS_DISABLE_EVAL' ) || !PODS_DISABLE_EVAL ) {&nbsp;</div></li><li><div>                if ( !empty( $post_delete_helpers ) ) {&nbsp;</div></li><li><div>                    pods_deprecated( sprintf( __( 'Post-delete helpers are deprecated, use the action pods_post_delete_pod_item_%s instead', 'pods' ), $params-&gt;pod ), '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ( $post_delete_helpers as $helper ) {&nbsp;</div></li><li><div>                        $helper = $this-&gt;load_helper( array( 'name' =&gt; $helper ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( false !== $helper )&nbsp;</div></li><li><div>                            eval( '?&gt;' . $helper[ 'code' ] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_cache_clear( $params-&gt;id, 'pods_items_' . $params-&gt;pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete an object from tableless fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $id&nbsp;</div></li><li><div>     * @param string $type&nbsp;</div></li><li><div>     * @param string $name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_object_from_relationships ( $id, $object, $name = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $pods_init \PodsInit&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $pods_init;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Run any bidirectional delete operations&nbsp;</div></li><li><div>        if ( is_array( $object ) )&nbsp;</div></li><li><div>            $pod = $object;&nbsp;</div></li><li><div>        elseif ( is_object( $pods_init ) )&nbsp;</div></li><li><div>            $pod = PodsInit::$meta-&gt;get_object( $object, $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod ) ) {&nbsp;</div></li><li><div>            $object = $pod[ 'type' ];&nbsp;</div></li><li><div>            $name = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $pod[ 'fields' ] as $field ) {&nbsp;</div></li><li><div>                PodsForm::delete( $field[ 'type' ], $id, $field[ 'name' ], array_merge( $field, $field[ 'options' ] ), $pod );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Lookup related fields (non-bidirectional)&nbsp;</div></li><li><div>        $params = array(&nbsp;</div></li><li><div>            'where' =&gt; array(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'key' =&gt; 'type', &nbsp;</div></li><li><div>                    'value' =&gt; 'pick'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'key' =&gt; 'pick_object', &nbsp;</div></li><li><div>                    'value' =&gt; $object&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $name ) && $name != $object ) {&nbsp;</div></li><li><div>            $params[ 'where' ][] = array(&nbsp;</div></li><li><div>                'key' =&gt; 'pick_val', &nbsp;</div></li><li><div>                'value' =&gt; $name&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = $this-&gt;load_fields( $params, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod ) && 'media' == $pod[ 'type' ] ) {&nbsp;</div></li><li><div>            $params[ 'where' ] = array(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'key' =&gt; 'type', &nbsp;</div></li><li><div>                    'value' =&gt; 'file'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fields = array_merge( $fields, $this-&gt;load_fields( $params, false ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $fields ) && !empty( $fields ) ) {&nbsp;</div></li><li><div>            foreach ( $fields as $related_field ) {&nbsp;</div></li><li><div>                $related_pod = $this-&gt;load_pod( array( 'id' =&gt; $related_field[ 'pod_id' ], 'fields' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $related_pod ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $related_from = $this-&gt;lookup_related_items_from( $related_field[ 'id' ], $related_pod[ 'id' ], $id, $related_field, $related_pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;delete_relationships( $related_from, $id, $related_pod, $related_field );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $pod ) && !pods_tableless() ) {&nbsp;</div></li><li><div>            pods_query( &quot;&nbsp;</div></li><li><div>                DELETE FROM `@wp_podsrel`&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                (&nbsp;</div></li><li><div>                    `pod_id` = %d&nbsp;</div></li><li><div>                    AND `item_id` = %d&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                OR (&nbsp;</div></li><li><div>                    `related_pod_id` = %d&nbsp;</div></li><li><div>                    AND `related_item_id` = %d&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>            &quot;, array(&nbsp;</div></li><li><div>                $pod[ 'id' ], &nbsp;</div></li><li><div>                $id, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod[ 'id' ], &nbsp;</div></li><li><div>                $id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete relationships&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int|array $related_id IDs for items to save&nbsp;</div></li><li><div>     * @param int|array $id ID or IDs to remove&nbsp;</div></li><li><div>     * @param array $related_pod Pod data&nbsp;</div></li><li><div>     * @param array $related_field Field data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_relationships ( $related_id, $id, $related_pod, $related_field ) {&nbsp;</div></li><li><div>        if ( is_array( $related_id ) ) {&nbsp;</div></li><li><div>            foreach ( $related_id as $rid ) {&nbsp;</div></li><li><div>                $this-&gt;delete_relationships( $rid, $id, $related_pod, $related_field );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $id ) ) {&nbsp;</div></li><li><div>            foreach ( $id as $rid ) {&nbsp;</div></li><li><div>                $this-&gt;delete_relationships( $related_id, $rid, $related_pod, $related_field );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $id ) )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $related_ids = $this-&gt;lookup_related_items( $related_field[ 'id' ], $related_pod[ 'id' ], $related_id, $related_field, $related_pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $related_ids ) )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        elseif ( !in_array( $id, $related_ids ) )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( self::$related_item_cache[ $related_pod[ 'id' ] ][ $related_field[ 'id' ] ] ) ) {&nbsp;</div></li><li><div>            // Delete relationship from cache&nbsp;</div></li><li><div>            unset( self::$related_item_cache[ $related_pod[ 'id' ] ][ $related_field[ 'id' ] ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        unset( $related_ids[ array_search( $id, $related_ids ) ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $no_conflict = pods_no_conflict_check( $related_pod[ 'type' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$no_conflict )&nbsp;</div></li><li><div>            pods_no_conflict_on( $related_pod[ 'type' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Post Types, Media, Users, and Comments (meta-based)&nbsp;</div></li><li><div>        if ( in_array( $related_pod[ 'type' ], array( 'post_type', 'media', 'user', 'comment' ) ) ) {&nbsp;</div></li><li><div>            $object_type = $related_pod[ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $object_type || 'media' == $object_type )&nbsp;</div></li><li><div>                $object_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            delete_metadata( $object_type, $related_id, $related_field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $related_ids ) ) {&nbsp;</div></li><li><div>                update_metadata( $object_type, $related_id, '_pods_' . $related_field[ 'name' ], $related_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $related_ids as $rel_id ) {&nbsp;</div></li><li><div>                    add_metadata( $object_type, $related_id, $related_field[ 'name' ], $rel_id );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                delete_metadata( $object_type, $related_id, '_pods_' . $related_field[ 'name' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Custom Settings Pages (options-based)&nbsp;</div></li><li><div>        elseif ( 'settings' == $related_pod[ 'type' ] ) {&nbsp;</div></li><li><div>            if ( !empty( $related_ids ) )&nbsp;</div></li><li><div>                update_option( $related_pod[ 'name' ] . '_' . $related_field[ 'name' ], $related_ids );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                delete_option( $related_pod[ 'name' ] . '_' . $related_field[ 'name' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Relationships table&nbsp;</div></li><li><div>        if ( !pods_tableless() ) {&nbsp;</div></li><li><div>            pods_query( &quot;&nbsp;</div></li><li><div>                DELETE FROM `@wp_podsrel`&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                (&nbsp;</div></li><li><div>                    `pod_id` = %d&nbsp;</div></li><li><div>                    AND `field_id` = %d&nbsp;</div></li><li><div>                    AND `item_id` = %d&nbsp;</div></li><li><div>                    AND `related_item_id` = %d&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                OR (&nbsp;</div></li><li><div>                    `related_pod_id` = %d&nbsp;</div></li><li><div>                    AND `related_field_id` = %d&nbsp;</div></li><li><div>                    AND `related_item_id` = %d&nbsp;</div></li><li><div>                    AND `item_id` = %d&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>            &quot;, array(&nbsp;</div></li><li><div>                $related_pod[ 'id' ], &nbsp;</div></li><li><div>                $related_field[ 'id' ], &nbsp;</div></li><li><div>                $related_id, &nbsp;</div></li><li><div>                $id, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $related_pod[ 'id' ], &nbsp;</div></li><li><div>                $related_field[ 'id' ], &nbsp;</div></li><li><div>                $related_id, &nbsp;</div></li><li><div>                $id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$no_conflict )&nbsp;</div></li><li><div>            pods_no_conflict_off( $related_pod[ 'type' ] );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if a Pod exists&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int Pod ID&nbsp;</div></li><li><div>     * $params['name'] string Pod name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool True if exists&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function pod_exists ( $params, $type = null ) {&nbsp;</div></li><li><div>        if ( is_string( $params ) )&nbsp;</div></li><li><div>            $params = array( 'name' =&gt; $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;id ) || !empty( $params-&gt;name ) ) {&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;name ) )&nbsp;</div></li><li><div>                $pod = get_post( $dummy = (int) $params-&gt;id );&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $pod = get_posts( array(&nbsp;</div></li><li><div>                    'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                    'post_type' =&gt; '_pods_pod', &nbsp;</div></li><li><div>                    'posts_per_page' =&gt; 1&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod ) && ( empty( $type ) || $type == get_post_meta( $pod-&gt;ID, 'type', true ) ) )&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a Pod and all of its fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['name'] string The Pod name&nbsp;</div></li><li><div>     * $params['fields'] bool Whether to load fields (default is true)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters or pod name as a string&nbsp;</div></li><li><div>     * @param bool $strict Makes sure the pod exists, throws an error if it doesn't work&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|void&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_pod ( $params, $strict = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $sitepress SitePress&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $sitepress, $icl_adjust_id_url_filter_off, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current_language = false;&nbsp;</div></li><li><div>        $load_fields = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // WPML support&nbsp;</div></li><li><div>        if ( is_object( $sitepress ) && !$icl_adjust_id_url_filter_off )&nbsp;</div></li><li><div>            $current_language = pods_sanitize( ICL_LANGUAGE_CODE );&nbsp;</div></li><li><div>        // Polylang support&nbsp;</div></li><li><div>        elseif ( function_exists( 'pll_current_language' ) )&nbsp;</div></li><li><div>            $current_language = pll_current_language( 'slug' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $params ) && !is_object( $params ) )&nbsp;</div></li><li><div>            $params = array( 'name' =&gt; $params, 'table_info' =&gt; false, 'fields' =&gt; true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $params ) && isset( $params-&gt;fields ) && !$params-&gt;fields )&nbsp;</div></li><li><div>            $load_fields = false;&nbsp;</div></li><li><div>        elseif ( is_array( $params ) && isset( $params[ 'fields' ] ) && !$params[ 'fields' ] )&nbsp;</div></li><li><div>            $load_fields = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table_info = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $params ) && ! empty( $params-&gt;table_info ) )&nbsp;</div></li><li><div>            $table_info = true;&nbsp;</div></li><li><div>        elseif ( is_array( $params ) && ! empty( $params[ 'table_info' ] ) )&nbsp;</div></li><li><div>            $table_info = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transient = 'pods_' . $wpdb-&gt;prefix . '_pod';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $current_language ) )&nbsp;</div></li><li><div>            $transient .= '_' . $current_language;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$load_fields )&nbsp;</div></li><li><div>            $transient .= '_nofields';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $table_info )&nbsp;</div></li><li><div>            $transient .= '_tableinfo';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $params ) && isset( $params-&gt;post_name ) ) {&nbsp;</div></li><li><div>            $pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( pods_api_cache() )&nbsp;</div></li><li><div>                $pod = pods_transient_get( $transient . '_' . $params-&gt;post_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $pod && ( ! $table_info || isset( $pod[ 'table' ] ) ) ) {&nbsp;</div></li><li><div>                if ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) && is_object( $sitepress ) && !$icl_adjust_id_url_filter_off )&nbsp;</div></li><li><div>                    $pod = array_merge( $pod, $this-&gt;get_table_info( $pod[ 'type' ], $pod[ 'object' ], $pod[ 'name' ], $pod ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $pod;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $_pod = get_object_vars( $params );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ( !isset( $params-&gt;id ) || empty( $params-&gt;id ) ) && ( !isset( $params-&gt;name ) || empty( $params-&gt;name ) ) ) {&nbsp;</div></li><li><div>                if ( $strict )&nbsp;</div></li><li><div>                    return pods_error( 'Either Pod ID or Name are required', $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;name ) ) {&nbsp;</div></li><li><div>                $pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( '_pods_pod' == $params-&gt;name ) {&nbsp;</div></li><li><div>                    $pod = array(&nbsp;</div></li><li><div>                        'id' =&gt; 0, &nbsp;</div></li><li><div>                        'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                        'label' =&gt; __( 'Pods', 'pods' ), &nbsp;</div></li><li><div>                        'type' =&gt; 'post_type', &nbsp;</div></li><li><div>                        'storage' =&gt; 'meta', &nbsp;</div></li><li><div>                        'options' =&gt; array(&nbsp;</div></li><li><div>                            'label_singular' =&gt; __( 'Pod', 'pods' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        'fields' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( '_pods_field' == $params-&gt;name ) {&nbsp;</div></li><li><div>                    $pod = array(&nbsp;</div></li><li><div>                        'id' =&gt; 0, &nbsp;</div></li><li><div>                        'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                        'label' =&gt; __( 'Pod Fields', 'pods' ), &nbsp;</div></li><li><div>                        'type' =&gt; 'post_type', &nbsp;</div></li><li><div>                        'storage' =&gt; 'meta', &nbsp;</div></li><li><div>                        'options' =&gt; array(&nbsp;</div></li><li><div>                            'label_singular' =&gt; __( 'Pod Field', 'pods' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        'fields' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( pods_api_cache() )&nbsp;</div></li><li><div>                    $pod = pods_transient_get( $transient . '_' . $params-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false !== $pod && ( ! $table_info || isset( $pod[ 'table' ] ) ) ) {&nbsp;</div></li><li><div>                    if ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) && is_object( $sitepress ) && !$icl_adjust_id_url_filter_off )&nbsp;</div></li><li><div>                        $pod = array_merge( $pod, $this-&gt;get_table_info( $pod[ 'type' ], $pod[ 'object' ], $pod[ 'name' ], $pod ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    return $pod;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;name ) )&nbsp;</div></li><li><div>                $pod = get_post( $dummy = (int) $params-&gt;id );&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $pod = get_posts( array(&nbsp;</div></li><li><div>                    'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                    'post_type' =&gt; '_pods_pod', &nbsp;</div></li><li><div>                    'posts_per_page' =&gt; 1&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $pod ) ) {&nbsp;</div></li><li><div>                if ( $strict )&nbsp;</div></li><li><div>                    return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $pod ) )&nbsp;</div></li><li><div>                $pod = $pod[ 0 ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $_pod = get_object_vars( $pod );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() )&nbsp;</div></li><li><div>            $pod = pods_transient_get( $transient . '_' . $_pod[ 'post_name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $pod && ( ! $table_info || isset( $pod[ 'table' ] ) ) ) {&nbsp;</div></li><li><div>            if ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) && is_object( $sitepress ) && !$icl_adjust_id_url_filter_off )&nbsp;</div></li><li><div>                $pod = array_merge( $pod, $this-&gt;get_table_info( $pod[ 'type' ], $pod[ 'object' ], $pod[ 'name' ], $pod ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $pod;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = array(&nbsp;</div></li><li><div>            'id' =&gt; $_pod[ 'ID' ], &nbsp;</div></li><li><div>            'name' =&gt; $_pod[ 'post_name' ], &nbsp;</div></li><li><div>            'label' =&gt; $_pod[ 'post_title' ], &nbsp;</div></li><li><div>            'description' =&gt; $_pod[ 'post_content' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( strlen( $pod[ 'label' ] ) &lt; 1 )&nbsp;</div></li><li><div>            $pod[ 'label' ] = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @todo update with a method to put all options in&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'show_in_menu' =&gt; 1, &nbsp;</div></li><li><div>            'type' =&gt; 'post_type', &nbsp;</div></li><li><div>            'storage' =&gt; 'meta', &nbsp;</div></li><li><div>            'object' =&gt; '', &nbsp;</div></li><li><div>            'alias' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'options' ] = get_post_meta( $pod[ 'id' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $pod[ 'options' ] as $option =&gt; $value ) {&nbsp;</div></li><li><div>            if ( is_array( $value ) ) {&nbsp;</div></li><li><div>                foreach ( $value as $k =&gt; $v ) {&nbsp;</div></li><li><div>                    if ( !is_array( $v ) )&nbsp;</div></li><li><div>                        $value[ $k ] = maybe_unserialize( $v );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 1 == count( $value ) )&nbsp;</div></li><li><div>                    $value = current( $value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $value = maybe_unserialize( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod[ 'options' ][ $option ] = $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'options' ] = array_merge( $defaults, $pod[ 'options' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'type' ] = $pod[ 'options' ][ 'type' ];&nbsp;</div></li><li><div>        $pod[ 'storage' ] = $pod[ 'options' ][ 'storage' ];&nbsp;</div></li><li><div>        $pod[ 'object' ] = $pod[ 'options' ][ 'object' ];&nbsp;</div></li><li><div>        $pod[ 'alias' ] = $pod[ 'options' ][ 'alias' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $pod[ 'options' ][ 'type' ] );&nbsp;</div></li><li><div>        unset( $pod[ 'options' ][ 'storage' ] );&nbsp;</div></li><li><div>        unset( $pod[ 'options' ][ 'object' ] );&nbsp;</div></li><li><div>        unset( $pod[ 'options' ][ 'alias' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $table_info )&nbsp;</div></li><li><div>            $pod = array_merge( $this-&gt;get_table_info( $pod[ 'type' ], $pod[ 'object' ], $pod[ 'name' ], $pod ), $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $pod[ 'pod' ] ) )&nbsp;</div></li><li><div>            unset( $pod[ 'pod' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'fields' ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod[ 'object_fields' ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'pod' != $pod[ 'type' ] )&nbsp;</div></li><li><div>            $pod[ 'object_fields' ] = $this-&gt;get_wp_object_fields( $pod[ 'type' ], $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = get_posts( array(&nbsp;</div></li><li><div>            'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>            'posts_per_page' =&gt; -1, &nbsp;</div></li><li><div>            'nopaging' =&gt; true, &nbsp;</div></li><li><div>            'post_parent' =&gt; $pod[ 'id' ], &nbsp;</div></li><li><div>            'orderby' =&gt; 'menu_order', &nbsp;</div></li><li><div>            'order' =&gt; 'ASC'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $fields ) ) {&nbsp;</div></li><li><div>            foreach ( $fields as $field ) {&nbsp;</div></li><li><div>                $field-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>                $field-&gt;table_info = $table_info;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $load_fields ) {&nbsp;</div></li><li><div>                    $field = $this-&gt;load_field( $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $field = PodsForm::field_setup( $field, null, $field[ 'type' ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $field = array(&nbsp;</div></li><li><div>                        'id' =&gt; $field-&gt;ID, &nbsp;</div></li><li><div>                        'name' =&gt; $field-&gt;post_name, &nbsp;</div></li><li><div>                        'label' =&gt; $field-&gt;post_title, &nbsp;</div></li><li><div>                        'type' =&gt; get_post_meta( $field-&gt;ID, 'type', true )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pod[ 'fields' ][ $field[ 'name' ] ] = $field;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( did_action( 'init' ) && pods_api_cache() )&nbsp;</div></li><li><div>            pods_transient_set( $transient . '_' . $pod[ 'name' ], $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $pod;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a list of Pods based on filters specified.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['type'] string/array Pod Type(s) to filter by&nbsp;</div></li><li><div>     * $params['object'] string/array Pod Object(s) to filter by&nbsp;</div></li><li><div>     * $params['options'] array Pod Option(s) key=&gt;value array to filter by&nbsp;</div></li><li><div>     * $params['orderby'] string ORDER BY clause of query&nbsp;</div></li><li><div>     * $params['limit'] string Number of Pods to return&nbsp;</div></li><li><div>     * $params['where'] string WHERE clause of query&nbsp;</div></li><li><div>     * $params['ids'] string|array IDs of Objects&nbsp;</div></li><li><div>     * $params['count'] boolean Return only a count of Pods&nbsp;</div></li><li><div>     * $params['names'] boolean Return only an array of name =&gt; label&nbsp;</div></li><li><div>     * $params['ids'] boolean Return only an array of ID =&gt; label&nbsp;</div></li><li><div>     * $params['fields'] boolean Return pod fields with Pods (default is true)&nbsp;</div></li><li><div>     * $params['key_names'] boolean Return pods keyed by name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|mixed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsAPI::load_pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_pods ( $params = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $sitepress SitePress&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $sitepress, $icl_adjust_id_url_filter_off;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current_language = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // WPML support&nbsp;</div></li><li><div>        if ( is_object( $sitepress ) && !$icl_adjust_id_url_filter_off )&nbsp;</div></li><li><div>            $current_language = pods_sanitize( ICL_LANGUAGE_CODE );&nbsp;</div></li><li><div>        // Polylang support&nbsp;</div></li><li><div>        elseif ( function_exists( 'pll_current_language' ) )&nbsp;</div></li><li><div>            $current_language = pll_current_language( 'slug' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $order = 'ASC';&nbsp;</div></li><li><div>        $orderby = 'menu_order title';&nbsp;</div></li><li><div>        $limit = -1;&nbsp;</div></li><li><div>        $ids = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta_query = array();&nbsp;</div></li><li><div>        $cache_key = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;type ) && !empty( $params-&gt;type ) ) {&nbsp;</div></li><li><div>            if ( !is_array( $params-&gt;type ) )&nbsp;</div></li><li><div>                $params-&gt;type = array( trim( $params-&gt;type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            sort( $params-&gt;type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $meta_query[] = array(&nbsp;</div></li><li><div>                'key' =&gt; 'type', &nbsp;</div></li><li><div>                'value' =&gt; $params-&gt;type, &nbsp;</div></li><li><div>                'compare' =&gt; 'IN'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 0 &lt; count( $params-&gt;type ) )&nbsp;</div></li><li><div>                $cache_key .= '_type_' . trim( implode( '_', $params-&gt;type ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;object ) && !empty( $params-&gt;object ) ) {&nbsp;</div></li><li><div>            if ( !is_array( $params-&gt;object ) )&nbsp;</div></li><li><div>                $params-&gt;object = array( $params-&gt;object );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;object = pods_trim( $params-&gt;object );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            sort( $params-&gt;object );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $meta_query[] = array(&nbsp;</div></li><li><div>                'key' =&gt; 'object', &nbsp;</div></li><li><div>                'value' =&gt; $params-&gt;object, &nbsp;</div></li><li><div>                'compare' =&gt; 'IN'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 1 == count( $params-&gt;object ) )&nbsp;</div></li><li><div>                $cache_key .= '_object_' . trim( implode( '', $params-&gt;object ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;options ) && !empty( $params-&gt;options ) && is_array( $params-&gt;options ) ) {&nbsp;</div></li><li><div>            foreach ( $params-&gt;options as $option =&gt; $value ) {&nbsp;</div></li><li><div>                if ( !is_array( $value ) )&nbsp;</div></li><li><div>                    $value = array( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $value = pods_trim( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                sort( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $meta_query[] = array(&nbsp;</div></li><li><div>                    'key' =&gt; $option, &nbsp;</div></li><li><div>                    'value' =&gt; pods_sanitize( $value ), &nbsp;</div></li><li><div>                    'compare' =&gt; 'IN'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $cache_key = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;where ) && is_array( $params-&gt;where ) )&nbsp;</div></li><li><div>            $meta_query = array_merge( $meta_query, (array) $params-&gt;where );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;order ) && !empty( $params-&gt;order ) && in_array( strtoupper( $params-&gt;order ), array( 'ASC', 'DESC' ) ) )&nbsp;</div></li><li><div>            $order = strtoupper( $params-&gt;order );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;orderby ) && !empty( $params-&gt;orderby ) )&nbsp;</div></li><li><div>            $orderby = strtoupper( $params-&gt;orderby );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;limit ) && !empty( $params-&gt;limit ) )&nbsp;</div></li><li><div>            $limit = pods_absint( $params-&gt;limit );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;ids ) && !empty( $params-&gt;ids ) ) {&nbsp;</div></li><li><div>            $ids = $params-&gt;ids;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !is_array( $ids ) )&nbsp;</div></li><li><div>                $ids = explode( ', ', $ids );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $ids ) )&nbsp;</div></li><li><div>            $ids = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pre_key = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $current_language ) )&nbsp;</div></li><li><div>            $pre_key .= '_' . $current_language;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;count ) && $params-&gt;count )&nbsp;</div></li><li><div>            $pre_key .= '_count';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;ids ) && $params-&gt;ids && !empty( $ids ) )&nbsp;</div></li><li><div>            $pre_key .= '_ids_' . implode( '_', $ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;names ) && $params-&gt;names )&nbsp;</div></li><li><div>            $pre_key .= '_names';&nbsp;</div></li><li><div>        elseif ( isset( $params-&gt;names_ids ) && $params-&gt;names_ids )&nbsp;</div></li><li><div>            $pre_key .= '_names_ids';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;key_names ) && $params-&gt;key_names )&nbsp;</div></li><li><div>            $pre_key .= '_namekeys';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;fields ) && !$params-&gt;fields )&nbsp;</div></li><li><div>            $pre_key .= '_nofields';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;table_info ) && $params-&gt;table_info )&nbsp;</div></li><li><div>            $pre_key .= '_tableinfo';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pre_key .= '_get';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $cache_key ) )&nbsp;</div></li><li><div>            $cache_key = 'pods' . $pre_key . '_all';&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $cache_key = 'pods' . $pre_key . $cache_key;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() && !empty( $cache_key ) && ( 'pods' . ( !empty( $current_language ) ? '_' . $current_language : '' ) . '_get_all' != $cache_key || empty( $meta_query ) ) && $limit &lt; 1 && ( empty( $orderby ) || 'menu_order title' == $orderby ) && empty( $ids ) ) {&nbsp;</div></li><li><div>            $the_pods = pods_transient_get( $cache_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === $the_pods )&nbsp;</div></li><li><div>                $the_pods = pods_cache_get( $cache_key, 'pods' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !is_array( $the_pods ) && 'none' == $the_pods )&nbsp;</div></li><li><div>                return array();&nbsp;</div></li><li><div>            elseif ( false !== $the_pods )&nbsp;</div></li><li><div>                return $the_pods;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $the_pods = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>            'post_type' =&gt; '_pods_pod', &nbsp;</div></li><li><div>            'nopaging' =&gt; true, &nbsp;</div></li><li><div>            'posts_per_page' =&gt; $limit, &nbsp;</div></li><li><div>            'order' =&gt; $order, &nbsp;</div></li><li><div>            'orderby' =&gt; $orderby, &nbsp;</div></li><li><div>            'meta_query' =&gt; $meta_query, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only set post__in if there are ids to filter (see https://core.trac.wordpress.org/ticket/28099)&nbsp;</div></li><li><div>        if ( false != $ids ) {&nbsp;</div></li><li><div>            $args[ 'post__in' ] = $ids;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_pods = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $export_ignore = array(&nbsp;</div></li><li><div>            'object_type', &nbsp;</div></li><li><div>            'object_name', &nbsp;</div></li><li><div>            'table', &nbsp;</div></li><li><div>            'meta_table', &nbsp;</div></li><li><div>            'pod_table', &nbsp;</div></li><li><div>            'field_id', &nbsp;</div></li><li><div>            'field_index', &nbsp;</div></li><li><div>            'field_slug', &nbsp;</div></li><li><div>            'field_type', &nbsp;</div></li><li><div>            'field_parent', &nbsp;</div></li><li><div>            'field_parent_select', &nbsp;</div></li><li><div>            'meta_field_id', &nbsp;</div></li><li><div>            'meta_field_index', &nbsp;</div></li><li><div>            'meta_field_value', &nbsp;</div></li><li><div>            'pod_field_id', &nbsp;</div></li><li><div>            'pod_field_index', &nbsp;</div></li><li><div>            'object_fields', &nbsp;</div></li><li><div>            'join', &nbsp;</div></li><li><div>            'where', &nbsp;</div></li><li><div>            'where_default', &nbsp;</div></li><li><div>            'orderby', &nbsp;</div></li><li><div>            'pod', &nbsp;</div></li><li><div>            'recurse', &nbsp;</div></li><li><div>            'table_info', &nbsp;</div></li><li><div>            'attributes', &nbsp;</div></li><li><div>            'group', &nbsp;</div></li><li><div>            'grouped', &nbsp;</div></li><li><div>            'developer_mode', &nbsp;</div></li><li><div>            'dependency', &nbsp;</div></li><li><div>            'depends-on', &nbsp;</div></li><li><div>            'excludes-on'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $total_fields = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;count ) && $params-&gt;count )&nbsp;</div></li><li><div>            $the_pods = count( $_pods );&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            foreach ( $_pods as $pod ) {&nbsp;</div></li><li><div>                if ( isset( $params-&gt;names ) && $params-&gt;names )&nbsp;</div></li><li><div>                    $the_pods[ $pod-&gt;post_name ] = $pod-&gt;post_title;&nbsp;</div></li><li><div>                elseif ( isset( $params-&gt;names_ids ) && $params-&gt;names_ids )&nbsp;</div></li><li><div>                    $the_pods[ $pod-&gt;ID ] = $pod-&gt;post_name;&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    if ( isset( $params-&gt;fields ) && !$params-&gt;fields )&nbsp;</div></li><li><div>                        $pod-&gt;fields = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pod = $this-&gt;load_pod( $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Remove extra data not needed&nbsp;</div></li><li><div>                    if ( pods_var( 'export', $params, false ) && ( !isset( $params-&gt;fields ) || $params-&gt;fields ) ) {&nbsp;</div></li><li><div>                        foreach ( $export_ignore as $ignore ) {&nbsp;</div></li><li><div>                            if ( isset( $pod[ $ignore ] ) )&nbsp;</div></li><li><div>                                unset( $pod[ $ignore ] );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        foreach ( $pod[ 'fields' ] as $field =&gt; $field_data ) {&nbsp;</div></li><li><div>                            if ( isset( $pod[ 'fields' ][ $field ][ 'table_info' ] ) )&nbsp;</div></li><li><div>                                unset( $pod[ 'fields' ][ $field ][ 'table_info' ] );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $total_fields += count( $pod[ 'fields' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset( $params-&gt;key_names ) && $params-&gt;key_names )&nbsp;</div></li><li><div>                        $the_pods[ $pod[ 'name' ] ] = $pod;&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $the_pods[ $pod[ 'id' ] ] = $pod;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( !function_exists( 'pll_current_language' ) || ( isset( $params-&gt;refresh ) && $params-&gt;refresh ) ) && !empty( $cache_key ) && ( 'pods' != $cache_key || empty( $meta_query ) ) && $limit &lt; 1 && ( empty( $orderby ) || 'menu_order title' == $orderby ) && empty( $ids ) ) {&nbsp;</div></li><li><div>            // Too many Pods can cause issues with the DB when caching is not enabled&nbsp;</div></li><li><div>            if ( 15 &lt; count( $the_pods ) || 75 &lt; count( $total_fields ) ) {&nbsp;</div></li><li><div>                pods_transient_clear( $cache_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_api_cache() ) {&nbsp;</div></li><li><div>                    if ( empty( $the_pods ) && ( !isset( $params-&gt;count ) || !$params-&gt;count ) )&nbsp;</div></li><li><div>                        pods_cache_set( $cache_key, 'none', 'pods' );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        pods_cache_set( $cache_key, $the_pods, 'pods' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                pods_cache_clear( $cache_key, 'pods' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_api_cache() ) {&nbsp;</div></li><li><div>                    if ( empty( $the_pods ) && ( !isset( $params-&gt;count ) || !$params-&gt;count ) )&nbsp;</div></li><li><div>                        pods_transient_set( $cache_key, 'none' );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        pods_transient_set( $cache_key, $the_pods );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $the_pods;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if a Pod's field exists&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod_id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['id'] int The field ID&nbsp;</div></li><li><div>     * $params['name'] string The field name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function field_exists ( $params ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( !empty( $params-&gt;id ) || !empty( $params-&gt;name ) ) && isset( $params-&gt;pod_id ) && !empty( $params-&gt;pod_id ) ) {&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;name ) )&nbsp;</div></li><li><div>                $field = get_post( $dummy = (int) $params-&gt;id );&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $field = get_posts( array(&nbsp;</div></li><li><div>                    'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                    'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>                    'posts_per_page' =&gt; 1, &nbsp;</div></li><li><div>                    'post_parent' =&gt; $params-&gt;pod_id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $field ) )&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a field&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod_id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name&nbsp;</div></li><li><div>     * $params['id'] int The field ID&nbsp;</div></li><li><div>     * $params['name'] string The field name&nbsp;</div></li><li><div>     * $params['table_info'] boolean Whether to lookup a pick field's table info&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param boolean $strict Whether to require a field exist or not when loading the info&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool Array with field data, false if field not found&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_field ( $params, $strict = false ) {&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;table_info ) )&nbsp;</div></li><li><div>            $params-&gt;table_info = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = array();&nbsp;</div></li><li><div>        $field = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;post_title ) )&nbsp;</div></li><li><div>            $_field = $params;&nbsp;</div></li><li><div>        elseif ( isset( $params-&gt;id ) && !empty( $params-&gt;id ) )&nbsp;</div></li><li><div>            $_field = get_post( $dumb = (int) $params-&gt;id );&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;pod ) )&nbsp;</div></li><li><div>                $params-&gt;pod = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;pod_id ) )&nbsp;</div></li><li><div>                $params-&gt;pod_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;pod_data ) )&nbsp;</div></li><li><div>                $pod = $params-&gt;pod_data;&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;pod, 'id' =&gt; $params-&gt;pod_id, 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false === $pod ) {&nbsp;</div></li><li><div>                    if ( $strict )&nbsp;</div></li><li><div>                        return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;pod_id = $pod[ 'id' ];&nbsp;</div></li><li><div>            $params-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $params-&gt;name ) && empty( $params-&gt;pod ) && empty( $params-&gt;pod_id ) )&nbsp;</div></li><li><div>                return pods_error( __( 'Either Field Name or Field ID / Pod ID are required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $params-&gt;name = pods_clean_name( $params-&gt;name, true, ( 'meta' == $pod[ 'storage' ] ? false : true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $pod[ 'fields' ][ $params-&gt;name ] ) && isset( $pod[ 'fields' ][ $params-&gt;name ][ 'id' ] ) )&nbsp;</div></li><li><div>                return $pod[ 'fields' ][ $params-&gt;name ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( pods_api_cache() )&nbsp;</div></li><li><div>                $field = pods_transient_get( 'pods_field_' . $params-&gt;pod . '_' . $params-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $field ) ) {&nbsp;</div></li><li><div>                $field = get_posts( array(&nbsp;</div></li><li><div>                    'name' =&gt; $params-&gt;name, &nbsp;</div></li><li><div>                    'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>                    'posts_per_page' =&gt; 1, &nbsp;</div></li><li><div>                    'post_parent' =&gt; $params-&gt;pod_id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( empty( $field ) ) {&nbsp;</div></li><li><div>                    if ( $strict )&nbsp;</div></li><li><div>                        return pods_error( __( 'Field not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $_field = $field[ 0 ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $_field ) ) {&nbsp;</div></li><li><div>            if ( $strict )&nbsp;</div></li><li><div>                return pods_error( __( 'Field not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_field = get_object_vars( $_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $pod[ 'name' ] ) && !isset( $_field[ 'pod' ] ) ) {&nbsp;</div></li><li><div>            if ( 0 &lt; $_field[ 'post_parent' ] )&nbsp;</div></li><li><div>                $pod = $this-&gt;load_pod( array( 'id' =&gt; $_field[ 'post_parent' ], 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $pod ) ) {&nbsp;</div></li><li><div>                if ( $strict )&nbsp;</div></li><li><div>                    return pods_error( __( 'Pod for field not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $field ) ) {&nbsp;</div></li><li><div>            if ( pods_api_cache() && ( isset( $pod[ 'name' ] ) || isset( $_field[ 'pod' ] ) ) )&nbsp;</div></li><li><div>                $field = pods_transient_get( 'pods_field_' . pods_var( 'name', $pod, pods_var( 'pod', $_field ), null, true ) . '_' . $_field[ 'post_name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $field ) ) {&nbsp;</div></li><li><div>                $defaults = array(&nbsp;</div></li><li><div>                    'type' =&gt; 'text'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field = array(&nbsp;</div></li><li><div>                    'id' =&gt; $_field[ 'ID' ], &nbsp;</div></li><li><div>                    'name' =&gt; $_field[ 'post_name' ], &nbsp;</div></li><li><div>                    'label' =&gt; $_field[ 'post_title' ], &nbsp;</div></li><li><div>                    'description' =&gt; $_field[ 'post_content' ], &nbsp;</div></li><li><div>                    'weight' =&gt; $_field[ 'menu_order' ], &nbsp;</div></li><li><div>                    'pod_id' =&gt; $_field[ 'post_parent' ], &nbsp;</div></li><li><div>                    'pick_object' =&gt; '', &nbsp;</div></li><li><div>                    'pick_val' =&gt; '', &nbsp;</div></li><li><div>                    'sister_id' =&gt; '', &nbsp;</div></li><li><div>                    'table_info' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $pod[ 'name' ] ) )&nbsp;</div></li><li><div>                    $field[ 'pod' ] = $pod[ 'name' ];&nbsp;</div></li><li><div>                elseif ( isset( $_field[ 'pod' ] ) )&nbsp;</div></li><li><div>                    $field[ 'pod' ] = $_field[ 'pod' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field[ 'options' ] = get_post_meta( $field[ 'id' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $options_ignore = array(&nbsp;</div></li><li><div>                    'method', &nbsp;</div></li><li><div>                    'table_info', &nbsp;</div></li><li><div>                    'attributes', &nbsp;</div></li><li><div>                    'group', &nbsp;</div></li><li><div>                    'grouped', &nbsp;</div></li><li><div>                    'developer_mode', &nbsp;</div></li><li><div>                    'dependency', &nbsp;</div></li><li><div>                    'depends-on', &nbsp;</div></li><li><div>                    'excludes-on'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $options_ignore as $ignore ) {&nbsp;</div></li><li><div>                    if ( isset( $field[ 'options' ][ $ignore ] ) )&nbsp;</div></li><li><div>                        unset( $field[ 'options' ][ $ignore ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $field[ 'options' ] as $option =&gt; $value ) {&nbsp;</div></li><li><div>                    if ( is_array( $value ) ) {&nbsp;</div></li><li><div>                        foreach ( $value as $k =&gt; $v ) {&nbsp;</div></li><li><div>                            if ( !is_array( $v ) )&nbsp;</div></li><li><div>                                $value[ $k ] = maybe_unserialize( $v );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( 1 == count( $value ) )&nbsp;</div></li><li><div>                            $value = current( $value );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $value = maybe_unserialize( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $field[ 'options' ][ $option ] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field[ 'options' ] = array_merge( $defaults, $field[ 'options' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field[ 'type' ] = $field[ 'options' ][ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                unset( $field[ 'options' ][ 'type' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $field[ 'options' ][ 'pick_object' ] ) ) {&nbsp;</div></li><li><div>                    $field[ 'pick_object' ] = $field[ 'options' ][ 'pick_object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $field[ 'options' ][ 'pick_object' ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $field[ 'options' ][ 'pick_val' ] ) ) {&nbsp;</div></li><li><div>                    $field[ 'pick_val' ] = $field[ 'options' ][ 'pick_val' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $field[ 'options' ][ 'pick_val' ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $field[ 'options' ][ 'sister_id' ] ) ) {&nbsp;</div></li><li><div>                    $field[ 'sister_id' ] = $field[ 'options' ][ 'sister_id' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    unset( $field[ 'options' ][ 'sister_id' ] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $field[ 'options' ][ 'sister_field_id' ] ) )&nbsp;</div></li><li><div>                    unset( $field[ 'options' ][ 'sister_field_id' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( pods_api_cache() && ( isset( $pod[ 'name' ] ) || isset( $_field[ 'pod' ] ) ) )&nbsp;</div></li><li><div>                    pods_transient_set( 'pods_field_' . pods_var( 'name', $pod, pods_var( 'pod', $_field ), null, true ) . '_' . $field[ 'name' ], $field );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field[ 'table_info' ] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'pick' == $field[ 'type' ] && $params-&gt;table_info )&nbsp;</div></li><li><div>            $field[ 'table_info' ] = $this-&gt;get_table_info( $field[ 'pick_object' ], $field[ 'pick_val' ], null, null, $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load fields by Pod, ID, Name, and/or Type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod_id'] int The Pod ID&nbsp;</div></li><li><div>     * $params['pod'] string The Pod name&nbsp;</div></li><li><div>     * $params['id'] array The field IDs&nbsp;</div></li><li><div>     * $params['name'] array The field names&nbsp;</div></li><li><div>     * $params['type'] array The field types&nbsp;</div></li><li><div>     * $params['options'] array Field Option(s) key=&gt;value array to filter by&nbsp;</div></li><li><div>     * $params['where'] string WHERE clause of query&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $strict  Whether to require a field exist or not when loading the info&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of field data.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_fields ( $params, $strict = false ) {&nbsp;</div></li><li><div>        // @todo Get away from using md5/serialize, I'm sure we can cache specific parts&nbsp;</div></li><li><div>        $cache_key = md5( serialize( $params ) );&nbsp;</div></li><li><div>        if ( isset( $this-&gt;fields_cache[ $cache_key ] ) ) {&nbsp;</div></li><li><div>            return $this-&gt;fields_cache[ $cache_key ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod ) || empty( $params-&gt;pod ) )&nbsp;</div></li><li><div>            $params-&gt;pod = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod_id ) || empty( $params-&gt;pod_id ) )&nbsp;</div></li><li><div>            $params-&gt;pod_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;name ) || empty( $params-&gt;name ) )&nbsp;</div></li><li><div>            $params-&gt;name = array();&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params-&gt;name = (array) $params-&gt;name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;id ) || empty( $params-&gt;id ) )&nbsp;</div></li><li><div>            $params-&gt;id = array();&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $params-&gt;id = (array) $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $params-&gt;id as &$id ) {&nbsp;</div></li><li><div>                $id = pods_absint( $id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;type ) || empty( $params-&gt;type ) )&nbsp;</div></li><li><div>            $params-&gt;type = array();&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $params-&gt;type = (array) $params-&gt;type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params-&gt;pod ) || !empty( $params-&gt;pod_id ) ) {&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;pod, 'id' =&gt; $params-&gt;pod_id, 'table_info' =&gt; true ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === $pod ) {&nbsp;</div></li><li><div>                if ( $strict )&nbsp;</div></li><li><div>                    return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $fields;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod[ 'fields' ] = array_merge( pods_var_raw( 'object_fields', $pod, array() ), $pod[ 'fields' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $pod[ 'fields' ] as $field ) {&nbsp;</div></li><li><div>                if ( empty( $params-&gt;name ) && empty( $params-&gt;id ) && empty( $params-&gt;type ) )&nbsp;</div></li><li><div>                    $fields[ $field[ 'name' ] ] = $field;&nbsp;</div></li><li><div>                elseif ( in_array( $fields[ 'name' ], $params-&gt;name ) || in_array( $fields[ 'id' ], $params-&gt;id ) || in_array( $fields[ 'type' ], $params-&gt;type ) )&nbsp;</div></li><li><div>                    $fields[ $field[ 'name' ] ] = $field;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( ( isset( $params-&gt;options ) && !empty( $params-&gt;options ) && is_array( $params-&gt;options ) ) || ( isset( $params-&gt;where ) && !empty( $params-&gt;where ) && is_array( $params-&gt;where ) ) ) {&nbsp;</div></li><li><div>            $order = 'ASC';&nbsp;</div></li><li><div>            $orderby = 'menu_order title';&nbsp;</div></li><li><div>            $limit = -1;&nbsp;</div></li><li><div>            $ids = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $meta_query = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;options ) && !empty( $params-&gt;options ) && is_array( $params-&gt;options ) ) {&nbsp;</div></li><li><div>                foreach ( $params-&gt;options as $option =&gt; $value ) {&nbsp;</div></li><li><div>                    if ( !is_array( $value ) )&nbsp;</div></li><li><div>                        $value = array( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = pods_trim( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    sort( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $meta_query[] = array(&nbsp;</div></li><li><div>                        'key' =&gt; $option, &nbsp;</div></li><li><div>                        'value' =&gt; pods_sanitize( $value ), &nbsp;</div></li><li><div>                        'compare' =&gt; 'IN'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;where ) && !empty( $params-&gt;where ) && is_array( $params-&gt;where ) )&nbsp;</div></li><li><div>                $meta_query = array_merge( $meta_query, (array) $params-&gt;where );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $args = array(&nbsp;</div></li><li><div>                'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>                'nopaging' =&gt; true, &nbsp;</div></li><li><div>                'posts_per_page' =&gt; $limit, &nbsp;</div></li><li><div>                'order' =&gt; $order, &nbsp;</div></li><li><div>                'orderby' =&gt; $orderby, &nbsp;</div></li><li><div>                'meta_query' =&gt; $meta_query, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Only set post__in if there are ids to filter (see https://core.trac.wordpress.org/ticket/28099)&nbsp;</div></li><li><div>            if ( false != $ids ) {&nbsp;</div></li><li><div>                $args[ 'post__in' ] = $ids;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $_fields = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $_fields as $field ) {&nbsp;</div></li><li><div>                $field = $this-&gt;load_field( $field, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $field ) )&nbsp;</div></li><li><div>                    $fields[ $field[ 'id' ] ] = $field;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ( empty( $params-&gt;name ) && empty( $params-&gt;id ) && empty( $params-&gt;type ) )&nbsp;</div></li><li><div>                return pods_error( __( 'Either Field Name / Field ID / Field Type, or Pod Name / Pod ID are required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $lookup = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $params-&gt;name ) ) {&nbsp;</div></li><li><div>                $fields = implode( &quot;', '&quot;, $params-&gt;name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $lookup[] = &quot;`post_name` IN ( '{$fields}' )&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $params-&gt;id ) ) {&nbsp;</div></li><li><div>                $fields = implode( &quot;, &quot;, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $lookup[] = &quot;`ID` IN ( {$fields} )&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $lookup = implode( ' AND ', $lookup );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $result = pods_query( &quot;SELECT `ID`, `post_name`, `post_parent` FROM `@wp_posts` WHERE `post_type` = '_pods_field' AND ( {$lookup} )&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $result ) ) {&nbsp;</div></li><li><div>                foreach ( $result as $field ) {&nbsp;</div></li><li><div>                    $field = $this-&gt;load_field( array(&nbsp;</div></li><li><div>                        'id' =&gt; $field-&gt;ID, &nbsp;</div></li><li><div>                        'name' =&gt; $field-&gt;post_name, &nbsp;</div></li><li><div>                        'pod_id' =&gt; $field-&gt;post_parent&nbsp;</div></li><li><div> ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $field ) && ( empty( $params-&gt;type ) || in_array( $field[ 'type' ], $params-&gt;type ) ) )&nbsp;</div></li><li><div>                        $fields[ $field[ 'id' ] ] = $field;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( isset( $cache_key ) ) {&nbsp;</div></li><li><div>            $this-&gt;fields_cache[ $cache_key ] = $fields;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $fields;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a Pods Object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The Object ID&nbsp;</div></li><li><div>     * $params['name'] string The Object name&nbsp;</div></li><li><div>     * $params['type'] string The Object type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters&nbsp;</div></li><li><div>     * @param bool $strict&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_object ( $params, $strict = false ) {&nbsp;</div></li><li><div>        if ( is_object( $params ) && isset( $params-&gt;post_title ) )&nbsp;</div></li><li><div>            $_object = get_object_vars( $params );&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !isset( $params-&gt;type ) || empty( $params-&gt;type ) )&nbsp;</div></li><li><div>                return pods_error( __( 'Object type is required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ( !isset( $params-&gt;id ) || empty( $params-&gt;id ) ) && ( !isset( $params-&gt;name ) || empty( $params-&gt;name ) ) )&nbsp;</div></li><li><div>                return pods_error( __( 'Either Object ID or Name are required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * @var $wpdb wpdb&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $params-&gt;name ) )&nbsp;</div></li><li><div>                $_object = pods_by_title( $params-&gt;name, ARRAY_A, '_pods_' . $params-&gt;type, 'publish' );&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $object = $params-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $_object = get_post( $object, ARRAY_A );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $_object ) ) {&nbsp;</div></li><li><div>                if ( $strict )&nbsp;</div></li><li><div>                    return pods_error( __( 'Object not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object = array(&nbsp;</div></li><li><div>            'id' =&gt; $_object[ 'ID' ], &nbsp;</div></li><li><div>            'name' =&gt; $_object[ 'post_title' ], &nbsp;</div></li><li><div>            'code' =&gt; $_object[ 'post_content' ], &nbsp;</div></li><li><div>            'type' =&gt; str_replace( '_pods_', '', $_object[ 'post_type' ] ), &nbsp;</div></li><li><div>            'slug' =&gt; $_object[ 'post_name' ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $object[ 'options' ] = get_post_meta( $object[ 'id' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $object[ 'options' ] as $option =&gt; &$value ) {&nbsp;</div></li><li><div>            if ( is_array( $value ) && 1 == count( $value ) )&nbsp;</div></li><li><div>                $value = current( $value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $object;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load Multiple Pods Objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['type'] string The Object type&nbsp;</div></li><li><div>     * $params['options'] array Pod Option(s) key=&gt;value array to filter by&nbsp;</div></li><li><div>     * $params['orderby'] string ORDER BY clause of query&nbsp;</div></li><li><div>     * $params['limit'] string Number of objects to return&nbsp;</div></li><li><div>     * $params['where'] string WHERE clause of query&nbsp;</div></li><li><div>     * $params['ids'] string|array IDs of Objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|object $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_objects ( $params ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;type ) || empty( $params-&gt;type ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Pods Object type is required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $order = 'ASC';&nbsp;</div></li><li><div>        $orderby = 'menu_order';&nbsp;</div></li><li><div>        $limit = -1;&nbsp;</div></li><li><div>        $ids = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $meta_query = array();&nbsp;</div></li><li><div>        $cache_key = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;options ) && !empty( $params-&gt;options ) && is_array( $params-&gt;options ) ) {&nbsp;</div></li><li><div>            foreach ( $params-&gt;options as $option =&gt; $value ) {&nbsp;</div></li><li><div>                if ( !is_array( $value ) )&nbsp;</div></li><li><div>                    $value = array( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $value = pods_trim( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                sort( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $meta_query[] = array(&nbsp;</div></li><li><div>                    'key' =&gt; $option, &nbsp;</div></li><li><div>                    'value' =&gt; pods_sanitize( $value ), &nbsp;</div></li><li><div>                    'compare' =&gt; 'IN'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;where ) && is_array( $params-&gt;where ) )&nbsp;</div></li><li><div>            $meta_query = array_merge( $meta_query, (array) $params-&gt;where );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;order ) && !empty( $params-&gt;order ) && in_array( strtoupper( $params-&gt;order ), array( 'ASC', 'DESC' ) ) )&nbsp;</div></li><li><div>            $order = strtoupper( $params-&gt;order );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;orderby ) && !empty( $params-&gt;orderby ) )&nbsp;</div></li><li><div>            $orderby = strtoupper( $params-&gt;orderby );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;limit ) && !empty( $params-&gt;limit ) )&nbsp;</div></li><li><div>            $limit = pods_absint( $params-&gt;limit );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $params-&gt;ids ) && !empty( $params-&gt;ids ) ) {&nbsp;</div></li><li><div>            $ids = $params-&gt;ids;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !is_array( $ids ) )&nbsp;</div></li><li><div>                $ids = explode( ', ', $ids );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $ids ) )&nbsp;</div></li><li><div>            $ids = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() && empty( $meta_query ) && empty( $limit ) && ( empty( $orderby ) || 'menu_order' == $orderby ) && empty( $ids ) ) {&nbsp;</div></li><li><div>            $cache_key = 'pods_objects_' . $params-&gt;type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $the_objects = pods_transient_get( $cache_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $the_objects )&nbsp;</div></li><li><div>                return $the_objects;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $the_objects = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>            'post_type' =&gt; '_pods_' . $params-&gt;type, &nbsp;</div></li><li><div>            'nopaging' =&gt; true, &nbsp;</div></li><li><div>            'posts_per_page' =&gt; $limit, &nbsp;</div></li><li><div>            'order' =&gt; $order, &nbsp;</div></li><li><div>            'orderby' =&gt; $orderby, &nbsp;</div></li><li><div>            'meta_query' =&gt; $meta_query, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only set post__in if there are ids to filter (see https://core.trac.wordpress.org/ticket/28099)&nbsp;</div></li><li><div>        if ( false != $ids ) {&nbsp;</div></li><li><div>            $args[ 'post__in' ] = $ids;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $objects = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $objects as $object ) {&nbsp;</div></li><li><div>            $object = $this-&gt;load_object( $object );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $the_objects[ $object[ 'name' ] ] = $object;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() && !empty( $cache_key ) )&nbsp;</div></li><li><div>            pods_transient_set( $cache_key, $the_objects );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $the_objects;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::load_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Load a Pod Template&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The template ID&nbsp;</div></li><li><div>     * $params['name'] string The template name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_template ( $params ) {&nbsp;</div></li><li><div>        if ( !class_exists( 'Pods_Templates' ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $params-&gt;type = 'template';&nbsp;</div></li><li><div>        return $this-&gt;load_object( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::load_objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Load Multiple Pod Templates&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['where'] string The WHERE clause of query&nbsp;</div></li><li><div>     * $params['options'] array Pod Option(s) key=&gt;value array to filter by&nbsp;</div></li><li><div>     * $params['orderby'] string ORDER BY clause of query&nbsp;</div></li><li><div>     * $params['limit'] string Number of templates to return&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params (optional) An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_templates ( $params = null ) {&nbsp;</div></li><li><div>        if ( !class_exists( 'Pods_Templates' ) )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $params-&gt;type = 'template';&nbsp;</div></li><li><div>        return $this-&gt;load_objects( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::load_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Load a Pod Page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The page ID&nbsp;</div></li><li><div>     * $params['name'] string The page URI&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_page ( $params ) {&nbsp;</div></li><li><div>        if ( !class_exists( 'Pods_Pages' ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;name ) && isset( $params-&gt;uri ) ) {&nbsp;</div></li><li><div>            $params-&gt;name = $params-&gt;uri;&nbsp;</div></li><li><div>            unset( $params-&gt;uri );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $params-&gt;type = 'page';&nbsp;</div></li><li><div>        return $this-&gt;load_object( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::load_objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Load Multiple Pod Pages&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['where'] string The WHERE clause of query&nbsp;</div></li><li><div>     * $params['options'] array Pod Option(s) key=&gt;value array to filter by&nbsp;</div></li><li><div>     * $params['orderby'] string ORDER BY clause of query&nbsp;</div></li><li><div>     * $params['limit'] string Number of pages to return&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params (optional) An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_pages ( $params = null ) {&nbsp;</div></li><li><div>        if ( !class_exists( 'Pods_Pages' ) )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $params-&gt;type = 'page';&nbsp;</div></li><li><div>        return $this-&gt;load_objects( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::load_object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Load a Pod Helper&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The helper ID&nbsp;</div></li><li><div>     * $params['name'] string The helper name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_helper ( $params ) {&nbsp;</div></li><li><div>        if ( !class_exists( 'Pods_Helpers' ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $params-&gt;type = 'helper';&nbsp;</div></li><li><div>        return $this-&gt;load_object( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsAPI::load_objects&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Load Multiple Pod Helpers&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['where'] string The WHERE clause of query&nbsp;</div></li><li><div>     * $params['options'] array Pod Option(s) key=&gt;value array to filter by&nbsp;</div></li><li><div>     * $params['orderby'] string ORDER BY clause of query&nbsp;</div></li><li><div>     * $params['limit'] string Number of pages to return&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params (optional) An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_helpers ( $params = null ) {&nbsp;</div></li><li><div>        if ( !class_exists( 'Pods_Helpers' ) )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $params-&gt;type = 'helper';&nbsp;</div></li><li><div>        return $this-&gt;load_objects( $params );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load the pod item object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string The datatype name&nbsp;</div></li><li><div>     * $params['id'] int (optional) The item's ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|\Pods&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses pods()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_pod_item ( $params ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;pod ) || empty( $params-&gt;pod ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod name required', 'pods' ), $this );&nbsp;</div></li><li><div>        if ( !isset( $params-&gt;id ) || empty( $params-&gt;id ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Item ID required', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() )&nbsp;</div></li><li><div>            $pod = pods_cache_get( $params-&gt;id, 'pods_item_object_' . $params-&gt;pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $pod )&nbsp;</div></li><li><div>            return $pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = pods( $params-&gt;pod, $params-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() )&nbsp;</div></li><li><div>            pods_cache_set( $params-&gt;id, $pod, 'pods_item_object_' . $params-&gt;pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $pod;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load potential sister fields for a specific field&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] int The Pod name&nbsp;</div></li><li><div>     * $params['related_pod'] string The related Pod name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @param array $pod (optional) Array of Pod data to use (to avoid lookup)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsAPI::load_pod&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_sister_fields ( $params, $pod = null ) {&nbsp;</div></li><li><div>        $params = (object) pods_sanitize( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod ) ) {&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;pod, 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === $pod )&nbsp;</div></li><li><div>                return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;pod_id = $pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;pod = $pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $type = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 === strpos( $params-&gt;related_pod, 'pod-' ) ) {&nbsp;</div></li><li><div>            $params-&gt;related_pod = pods_str_replace( 'pod-', '', $params-&gt;related_pod, 1 );&nbsp;</div></li><li><div>            $type = 'pod';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 0 === strpos( $params-&gt;related_pod, 'post_type-' ) ) {&nbsp;</div></li><li><div>            $params-&gt;related_pod = pods_str_replace( 'post_type-', '', $params-&gt;related_pod, 1 );&nbsp;</div></li><li><div>            $type = 'post_type';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 0 === strpos( $params-&gt;related_pod, 'taxonomy-' ) ) {&nbsp;</div></li><li><div>            $params-&gt;related_pod = pods_str_replace( 'taxonomy-', '', $params-&gt;related_pod, 1 );&nbsp;</div></li><li><div>            $type = 'taxonomy';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $related_pod = $this-&gt;load_pod( array( 'name' =&gt; $params-&gt;related_pod, 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $related_pod || ( false !== $type && 'pod' != $type && $type != $related_pod[ 'type' ] ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Related Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;related_pod_id = $related_pod[ 'id' ];&nbsp;</div></li><li><div>        $params-&gt;related_pod = $related_pod[ 'name' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sister_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $related_pod[ 'fields' ] as $field ) {&nbsp;</div></li><li><div>            if ( 'pick' == $field[ 'type' ] && in_array( $field[ 'pick_object' ], array( $pod[ 'type' ], 'pod' ) ) && ( $params-&gt;pod == $field[ 'pick_object' ] || $params-&gt;pod == $field[ 'pick_val' ] ) )&nbsp;</div></li><li><div>                $sister_fields[ $field[ 'id' ] ] = esc_html( $field[ 'label' ] . ' (' . $field[ 'name' ] . ')' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $sister_fields;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Takes a sql field such as tinyint and returns the pods field type, such as num.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $sql_field The SQL field to look for&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string The field type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function detect_pod_field_from_sql_data_type ( $sql_field ) {&nbsp;</div></li><li><div>        $sql_field = strtolower( $sql_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_to_field_map = array(&nbsp;</div></li><li><div>            'tinyint' =&gt; 'number', &nbsp;</div></li><li><div>            'smallint' =&gt; 'number', &nbsp;</div></li><li><div>            'mediumint' =&gt; 'number', &nbsp;</div></li><li><div>            'int' =&gt; 'number', &nbsp;</div></li><li><div>            'bigint' =&gt; 'number', &nbsp;</div></li><li><div>            'float' =&gt; 'number', &nbsp;</div></li><li><div>            'double' =&gt; 'number', &nbsp;</div></li><li><div>            'decimal' =&gt; 'number', &nbsp;</div></li><li><div>            'date' =&gt; 'date', &nbsp;</div></li><li><div>            'datetime' =&gt; 'datetime', &nbsp;</div></li><li><div>            'timestamp' =&gt; 'datetime', &nbsp;</div></li><li><div>            'time' =&gt; 'time', &nbsp;</div></li><li><div>            'year' =&gt; 'date', &nbsp;</div></li><li><div>            'varchar' =&gt; 'text', &nbsp;</div></li><li><div>            'text' =&gt; 'paragraph', &nbsp;</div></li><li><div>            'mediumtext' =&gt; 'paragraph', &nbsp;</div></li><li><div>            'longtext' =&gt; 'paragraph'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ( array_key_exists( $sql_field, $field_to_field_map ) ) ? $field_to_field_map[ $sql_field ] : 'paragraph';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets all field types&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Array of field types&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsForm::field_loader&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     * @deprecated&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_field_types () {&nbsp;</div></li><li><div>        return PodsForm::field_types();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the schema definition of a field.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $type Field type to look for&nbsp;</div></li><li><div>     * @param array $options (optional) Options of the field to pass to the schema function.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool|mixed|null&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function get_field_definition ( $type, $options = null ) {&nbsp;</div></li><li><div>        $definition = PodsForm::field_method( $type, 'schema', $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;do_hook( 'field_definition', $definition, $type, $options );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @see PodsForm:validate&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Validates the value of a field.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $value The value to validate&nbsp;</div></li><li><div>     * @param string $field Field to use for validation&nbsp;</div></li><li><div>     * @param array $object_fields Fields of the object we're validating&nbsp;</div></li><li><div>     * @param array $fields Array of all fields data&nbsp;</div></li><li><div>     * @param array|Pods $pod Array of pod data (or Pods object)&nbsp;</div></li><li><div>     * @param array|object $params Extra parameters to pass to the validation function of the field.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses PodsForm::validate&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function handle_field_validation ( &$value, $field, $object_fields, $fields, $pod, $params ) {&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array_merge( $fields, $object_fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $options = $fields[ $field ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = ( is_object( $params ) ? $params-&gt;id : ( is_object( $pod ) ? $pod-&gt;id() : 0 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $pod ) )&nbsp;</div></li><li><div>            $pod = $pod-&gt;pod_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $type = $options[ 'type' ];&nbsp;</div></li><li><div>        $label = $options[ 'label' ];&nbsp;</div></li><li><div>        $label = empty( $label ) ? $field : $label;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Verify required fields&nbsp;</div></li><li><div>        if ( 1 == pods_var( 'required', $options[ 'options' ], 0 ) && 'slug' != $type ) {&nbsp;</div></li><li><div>            if ( '' == $value || null === $value || array() === $value )&nbsp;</div></li><li><div>                return pods_error( sprintf( __( '%s is empty', 'pods' ), $label ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'multi' == pods_var( 'pick_format_type', $options[ 'options' ] ) && 'autocomplete' != pods_var( 'pick_format_multi', $options[ 'options' ] ) ) {&nbsp;</div></li><li><div>                $has_value = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $check_value = (array) $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $check_value as $val ) {&nbsp;</div></li><li><div>                    if ( '' != $val && null !== $val && 0 !== $val && '0' !== $val ) {&nbsp;</div></li><li><div>                        $has_value = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !$has_value )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( '%s is required', 'pods' ), $label ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @todo move this to after pre-save preparations&nbsp;</div></li><li><div>        // Verify unique fields&nbsp;</div></li><li><div>        if ( 1 == pods_var( 'unique', $options[ 'options' ], 0 ) && '' !== $value && null !== $value && array() !== $value ) {&nbsp;</div></li><li><div>            if ( empty( $pod ) )&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !in_array( $type, $tableless_field_types ) ) {&nbsp;</div></li><li><div>                $exclude = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $id ) )&nbsp;</div></li><li><div>                    $exclude = &quot;AND `id` != {$id}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $check = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $check_value = pods_sanitize( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // @todo handle meta-based fields&nbsp;</div></li><li><div>                // Trigger an error if not unique&nbsp;</div></li><li><div>                if ( 'table' == $pod[ 'storage' ] )&nbsp;</div></li><li><div>                    $check = pods_query( &quot;SELECT `id` FROM `@wp_pods_&quot; . $pod[ 'name' ] . &quot;` WHERE `{$field}` = '{$check_value}' {$exclude} LIMIT 1&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $check ) )&nbsp;</div></li><li><div>                    return pods_error( sprintf( __( '%s needs to be unique', 'pods' ), $label ), $this );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                // @todo handle tableless check&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $validate = PodsForm::validate( $options[ 'type' ], $value, $field, array_merge( $options, pods_var( 'options', $options, array() ) ), $fields, $pod, $id, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $validate = $this-&gt;do_hook( 'field_validation', $validate, $value, $field, $object_fields, $fields, $pod, $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $validate;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Find items related to a parent field&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $field_id The Field ID&nbsp;</div></li><li><div>     * @param int $pod_id The Pod ID&nbsp;</div></li><li><div>     * @param mixed $ids A comma-separated string (or array) of item IDs&nbsp;</div></li><li><div>     * @param array $field Field data array&nbsp;</div></li><li><div>     * @param array $pod Pod data array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses pods_query()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function lookup_related_items ( $field_id, $pod_id, $ids, $field = null, $pod = null ) {&nbsp;</div></li><li><div>        $related_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $ids ) )&nbsp;</div></li><li><div>            $ids = explode( ', ', $ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $ids as $k =&gt; $id ) {&nbsp;</div></li><li><div>            $ids[ $k ] = (int) $id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ids = array_unique( array_filter( $ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $idstring = implode( ', ', $ids );&nbsp;</div></li><li><div>        if ( 0 != $pod_id && 0 != $field_id && isset( self::$related_item_cache[ $pod_id ][ $field_id ][ $idstring ] ) ) {&nbsp;</div></li><li><div>            // Check cache first, no point in running the same query multiple times&nbsp;</div></li><li><div>            return self::$related_item_cache[ $pod_id ][ $field_id ][ $idstring ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_type = pods_v( 'type', $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $ids ) || !in_array( $field_type, $tableless_field_types ) )&nbsp;</div></li><li><div>            return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $related_pick_limit = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $field ) ) {&nbsp;</div></li><li><div>            $field = $this-&gt;load_field( array( 'id' =&gt; $field_id ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $field ) ) {&nbsp;</div></li><li><div>            $options = (array) pods_var_raw( 'options', $field, $field, null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $related_pick_limit = (int) pods_v( $field_type . '_limit', $options, 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'single' == pods_var_raw( $field_type . '_format_type', $options ) )&nbsp;</div></li><li><div>                $related_pick_limit = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Temporary hack until there's some better handling here&nbsp;</div></li><li><div>            $related_pick_limit = $related_pick_limit * count( $ids );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'taxonomy' == $field_type ) {&nbsp;</div></li><li><div>            $related = wp_get_object_terms( $ids, pods_v( 'name', $field ), array( 'fields' =&gt; 'ids' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !is_wp_error( $related ) ) {&nbsp;</div></li><li><div>                $related_ids = $related;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( !pods_tableless() ) {&nbsp;</div></li><li><div>            $ids = implode( ', ', $ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field_id = (int) $field_id;&nbsp;</div></li><li><div>            $sister_id = (int) pods_var_raw( 'sister_id', $field, 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $related_where = &quot;&nbsp;</div></li><li><div>                `field_id` = {$field_id}&nbsp;</div></li><li><div>                AND `item_id` IN ( {$ids} )&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>                SELECT item_id, related_item_id, related_field_id&nbsp;</div></li><li><div>                FROM `@wp_podsrel`&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                    {$related_where}&nbsp;</div></li><li><div>                ORDER BY `weight`&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $relationships = pods_query( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $relationships ) ) {&nbsp;</div></li><li><div>                foreach ( $relationships as $relation ) {&nbsp;</div></li><li><div>                    if ( !in_array( $relation-&gt;related_item_id, $related_ids ) )&nbsp;</div></li><li><div>                        $related_ids[] = (int) $relation-&gt;related_item_id;&nbsp;</div></li><li><div>                    elseif ( 0 &lt; $sister_id && $field_id == $relation-&gt;related_field_id && !in_array( $relation-&gt;item_id, $related_ids ) )&nbsp;</div></li><li><div>                        $related_ids[] = (int) $relation-&gt;item_id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ( !is_array( $pod ) )&nbsp;</div></li><li><div>                $pod = $this-&gt;load_pod( array( 'id' =&gt; $pod_id, 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod ) && in_array( $pod[ 'type' ], array( 'post_type', 'media', 'user', 'comment', 'settings' ) ) ) {&nbsp;</div></li><li><div>                $meta_type = $pod[ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( in_array( $pod[ 'type' ], array( 'post_type', 'media' ) ) )&nbsp;</div></li><li><div>                    $meta_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $no_conflict = pods_no_conflict_check( $meta_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !$no_conflict )&nbsp;</div></li><li><div>                    pods_no_conflict_on( $meta_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $ids as $id ) {&nbsp;</div></li><li><div>                    if ( 'settings' == $meta_type ) {&nbsp;</div></li><li><div>                        $related_id = get_option( '_pods_' . $pod[ 'name' ] . '_' . $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( empty( $related_id ) )&nbsp;</div></li><li><div>                            $related_id = get_option( $pod[ 'name' ] . '_' . $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( is_array( $related_id ) && !empty( $related_id ) ) {&nbsp;</div></li><li><div>                            foreach ( $related_id as $related ) {&nbsp;</div></li><li><div>                                if ( is_array( $related ) && !empty( $related ) ) {&nbsp;</div></li><li><div>                                    if ( isset( $related[ 'id' ] ) )&nbsp;</div></li><li><div>                                        $related_ids[] = (int) $related[ 'id' ];&nbsp;</div></li><li><div>                                    else {&nbsp;</div></li><li><div>                                        foreach ( $related as $r ) {&nbsp;</div></li><li><div>                                            $related_ids[] = (int) $r;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                else&nbsp;</div></li><li><div>                                    $related_ids[] = (int) $related;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $related_id = get_metadata( $meta_type, $id, '_pods_' . $field[ 'name' ], true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( empty( $related_id ) )&nbsp;</div></li><li><div>                            $related_id = get_metadata( $meta_type, $id, $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( is_array( $related_id ) && !empty( $related_id ) ) {&nbsp;</div></li><li><div>                            foreach ( $related_id as $related ) {&nbsp;</div></li><li><div>                                if ( is_array( $related ) && !empty( $related ) ) {&nbsp;</div></li><li><div>                                    if ( isset( $related[ 'id' ] ) )&nbsp;</div></li><li><div>                                        $related_ids[] = (int) $related[ 'id' ];&nbsp;</div></li><li><div>                                    else {&nbsp;</div></li><li><div>                                        foreach ( $related as $r ) {&nbsp;</div></li><li><div>                                            if ( isset( $related[ 'id' ] ) )&nbsp;</div></li><li><div>                                                $related_ids[] = (int) $r[ 'id' ];&nbsp;</div></li><li><div>                                            else&nbsp;</div></li><li><div>                                                $related_ids[] = (int) $r;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                else&nbsp;</div></li><li><div>                                    $related_ids[] = (int) $related;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !$no_conflict )&nbsp;</div></li><li><div>                    pods_no_conflict_off( $meta_type );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $related_ids ) ) {&nbsp;</div></li><li><div>            $related_ids = array_unique( array_filter( $related_ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 0 &lt; $related_pick_limit && !empty( $related_ids ) )&nbsp;</div></li><li><div>                $related_ids = array_slice( $related_ids, 0, $related_pick_limit );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( 0 != $pod_id && 0 != $field_id && ! empty( $related_ids ) ) {&nbsp;</div></li><li><div>                    // Only cache if $pod_id and $field_id were passed&nbsp;</div></li><li><div>            self::$related_item_cache[ $pod_id ][ $field_id ][ $idstring ] = $related_ids;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $related_ids;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Find related items related to an item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $field_id The Field ID&nbsp;</div></li><li><div>     * @param int $pod_id The Pod ID&nbsp;</div></li><li><div>     * @param int $id Item ID to get related IDs from&nbsp;</div></li><li><div>     * @param array $field Field data array&nbsp;</div></li><li><div>     * @param array $pod Pod data array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.3&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses pods_query()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function lookup_related_items_from ( $field_id, $pod_id, $id, $field = null, $pod = null ) {&nbsp;</div></li><li><div>        $related_ids = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tableless_field_types = PodsForm::tableless_field_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $id ) || !in_array( pods_v( 'type', $field ), $tableless_field_types ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $related_pick_limit = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $field ) ) {&nbsp;</div></li><li><div>            $options = (array) pods_var_raw( 'options', $field, $field, null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $related_pick_limit = (int) pods_v( 'pick_limit', $options, 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'single' == pods_var_raw( 'pick_format_type', $options ) )&nbsp;</div></li><li><div>                $related_pick_limit = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !pods_tableless() ) {&nbsp;</div></li><li><div>            $field_id = (int) $field_id;&nbsp;</div></li><li><div>            $sister_id = (int) pods_var_raw( 'sister_id', $field, 0 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $related_where = &quot;&nbsp;</div></li><li><div>                `field_id` = {$field_id}&nbsp;</div></li><li><div>                AND `related_item_id` = {$id}&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>                SELECT *&nbsp;</div></li><li><div>                FROM `@wp_podsrel`&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                    {$related_where}&nbsp;</div></li><li><div>                ORDER BY `weight`&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $relationships = pods_query( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $relationships ) ) {&nbsp;</div></li><li><div>                $related_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $relationships as $relation ) {&nbsp;</div></li><li><div>                    if ( $field_id == $relation-&gt;field_id && !in_array( $relation-&gt;item_id, $related_ids ) )&nbsp;</div></li><li><div>                        $related_ids[] = (int) $relation-&gt;item_id;&nbsp;</div></li><li><div>                    elseif ( 0 &lt; $sister_id && $field_id == $relation-&gt;related_field_id && !in_array( $relation-&gt;related_item_id, $related_ids ) )&nbsp;</div></li><li><div>                        $related_ids[] = (int) $relation-&gt;related_item_id;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            // @todo handle meta-based lookups&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !is_array( $pod ) )&nbsp;</div></li><li><div>                $pod = $this-&gt;load_pod( array( 'id' =&gt; $pod_id, 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod ) && in_array( $pod[ 'type' ], array( 'post_type', 'media', 'user', 'comment', 'settings' ) ) ) {&nbsp;</div></li><li><div>                $related_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $meta_type = $pod[ 'type' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( in_array( $pod[ 'type' ], array( 'post_type', 'media' ) ) )&nbsp;</div></li><li><div>                    $meta_type = 'post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $no_conflict = pods_no_conflict_check( $meta_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !$no_conflict )&nbsp;</div></li><li><div>                    pods_no_conflict_on( $meta_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 'settings' == $meta_type ) {&nbsp;</div></li><li><div>                    $related_id = get_option( '_pods_' . $pod[ 'name' ] . '_' . $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $related_id ) )&nbsp;</div></li><li><div>                        $related_id = get_option( $pod[ 'name' ] . '_' . $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_array( $related_id ) && !empty( $related_id ) ) {&nbsp;</div></li><li><div>                        foreach ( $related_id as $related ) {&nbsp;</div></li><li><div>                            if ( is_array( $related ) && !empty( $related ) ) {&nbsp;</div></li><li><div>                                if ( isset( $related[ 'id' ] ) )&nbsp;</div></li><li><div>                                    $related_ids[] = (int) $related[ 'id' ];&nbsp;</div></li><li><div>                                else {&nbsp;</div></li><li><div>                                    foreach ( $related as $r ) {&nbsp;</div></li><li><div>                                        $related_ids[] = (int) $r;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $related_ids[] = (int) $related;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $related_id = get_metadata( $meta_type, $id, '_pods_' . $field[ 'name' ], true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( empty( $related_id ) )&nbsp;</div></li><li><div>                        $related_id = get_metadata( $meta_type, $id, $field[ 'name' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( is_array( $related_id ) && !empty( $related_id ) ) {&nbsp;</div></li><li><div>                        foreach ( $related_id as $related ) {&nbsp;</div></li><li><div>                            if ( is_array( $related ) && !empty( $related ) ) {&nbsp;</div></li><li><div>                                if ( isset( $related[ 'id' ] ) )&nbsp;</div></li><li><div>                                    $related_ids[] = (int) $related[ 'id' ];&nbsp;</div></li><li><div>                                else {&nbsp;</div></li><li><div>                                    foreach ( $related as $r ) {&nbsp;</div></li><li><div>                                        if ( isset( $related[ 'id' ] ) )&nbsp;</div></li><li><div>                                            $related_ids[] = (int) $r[ 'id' ];&nbsp;</div></li><li><div>                                        else&nbsp;</div></li><li><div>                                            $related_ids[] = (int) $r;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $related_ids[] = (int) $related;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !$no_conflict )&nbsp;</div></li><li><div>                    pods_no_conflict_off( $meta_type );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $related_ids ) )&nbsp;</div></li><li><div>            $related_ids = array_unique( array_filter( $related_ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $related_ids;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Load the information about an objects MySQL table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $object_type&nbsp;</div></li><li><div>     * @param string $object The object to look for&nbsp;</div></li><li><div>     * @param null $name (optional) Name of the pod to load&nbsp;</div></li><li><div>     * @param array $pod (optional) Array with pod information&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_table_info_load ( $object_type, $object, $name = null, $pod = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'pod' == $object_type && null === $pod ) {&nbsp;</div></li><li><div>            if ( empty( $name ) ) {&nbsp;</div></li><li><div>                $prefix = 'pod-';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Make sure we actually have the prefix before trying anything with the name&nbsp;</div></li><li><div>                if ( 0 === strpos( $object_type, $prefix ) )&nbsp;</div></li><li><div>                    $name = substr( $object_type, strlen( $prefix ), strlen( $object_type ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $name ) && !empty( $object ) )&nbsp;</div></li><li><div>                $name = $object;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod( array( 'name' =&gt; $name, 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $pod ) ) {&nbsp;</div></li><li><div>                $object_type = $pod[ 'type' ];&nbsp;</div></li><li><div>                $name = $pod[ 'name' ];&nbsp;</div></li><li><div>                $object = $pod[ 'object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info[ 'pod' ] = $pod;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( null === $pod ) {&nbsp;</div></li><li><div>            if ( empty( $name ) ) {&nbsp;</div></li><li><div>                $prefix = $object_type . '-';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Make sure we actually have the prefix before trying anything with the name&nbsp;</div></li><li><div>                if ( 0 === strpos( $object_type, $prefix ) )&nbsp;</div></li><li><div>                    $name = substr( $object_type, strlen( $prefix ), strlen( $object_type ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $name ) && !empty( $object ) )&nbsp;</div></li><li><div>                $name = $object;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $name ) ) {&nbsp;</div></li><li><div>                $pod = $this-&gt;load_pod( array( 'name' =&gt; $name, 'table_info' =&gt; false ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $pod ) && ( null === $object_type || $object_type == $pod[ 'type' ] ) ) {&nbsp;</div></li><li><div>                    $object_type = $pod[ 'type' ];&nbsp;</div></li><li><div>                    $name = $pod[ 'name' ];&nbsp;</div></li><li><div>                    $object = $pod[ 'object' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $info[ 'pod' ] = $pod;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( !empty( $pod ) )&nbsp;</div></li><li><div>            $info[ 'pod' ] = $pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 === strpos( $object_type, 'pod' ) ) {&nbsp;</div></li><li><div>            if ( empty( $name ) ) {&nbsp;</div></li><li><div>                $prefix = 'pod-';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Make sure we actually have the prefix before trying anything with the name&nbsp;</div></li><li><div>                if ( 0 === strpos( $object_type, $prefix ) )&nbsp;</div></li><li><div>                    $name = substr( $object_type, strlen( $prefix ), strlen( $object_type ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'type' ] = 'pod';&nbsp;</div></li><li><div>            global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'table' ] = $info[ 'meta_table' ] = $wpdb-&gt;prefix . 'pods_' . ( empty( $object ) ? $name : $object );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_array( $info[ 'pod' ] ) && 'pod' == pods_v( 'type', $info[ 'pod' ] ) ) {&nbsp;</div></li><li><div>                $info[ 'pod_field_index' ] = $info[ 'field_index' ] = $info[ 'meta_field_index' ] = $info[ 'meta_field_value' ] = pods_v( 'pod_index', $info[ 'pod' ][ 'options' ], 'id', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $slug_field = get_posts( array(&nbsp;</div></li><li><div>                    'post_type' =&gt; '_pods_field', &nbsp;</div></li><li><div>                    'posts_per_page' =&gt; 1, &nbsp;</div></li><li><div>                    'nopaging' =&gt; true, &nbsp;</div></li><li><div>                    'post_parent' =&gt; $info[ 'pod' ][ 'id' ], &nbsp;</div></li><li><div>                    'orderby' =&gt; 'menu_order', &nbsp;</div></li><li><div>                    'order' =&gt; 'ASC', &nbsp;</div></li><li><div>                    'meta_query' =&gt; array(&nbsp;</div></li><li><div>                        array(&nbsp;</div></li><li><div>                            'key' =&gt; 'type', &nbsp;</div></li><li><div>                            'value' =&gt; 'slug', &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( !empty( $slug_field ) ) {&nbsp;</div></li><li><div>                    $slug_field = $slug_field[ 0 ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $info[ 'field_slug' ] = $info[ 'pod_field_slug' ] = $slug_field-&gt;post_name;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( 1 == pods_v( 'hierarchical', $info[ 'pod' ][ 'options' ], 0 ) ) {&nbsp;</div></li><li><div>                    $parent_field = pods_v( 'pod_parent', $info[ 'pod' ][ 'options' ], 'id', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( !empty( $parent_field ) && isset( $info[ 'pod' ][ 'fields' ][ $parent_field ] ) ) {&nbsp;</div></li><li><div>                        $info[ 'object_hierarchical' ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $info[ 'pod_field_parent' ] = $info[ 'field_parent' ] = $parent_field . '_select';&nbsp;</div></li><li><div>                        $info[ 'field_parent_select' ] = '`' . $parent_field . '`.`id` AS `' . $info[ 'field_parent' ] . '`';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $info;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get information about an objects MySQL table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $object_type&nbsp;</div></li><li><div>     * @param string $object The object to look for&nbsp;</div></li><li><div>     * @param null $name (optional) Name of the pod to load&nbsp;</div></li><li><div>     * @param array $pod (optional) Array with pod information&nbsp;</div></li><li><div>     * @param array $field (optional) Array with field information&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_table_info ( $object_type, $object, $name = null, $pod = null, $field = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         * @var $sitepress SitePress&nbsp;</div></li><li><div>         * @var $icl_adjust_id_url_filter_off boolean&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb, $sitepress, $icl_adjust_id_url_filter_off, $polylang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @todo Handle $object arrays for Post Types, Taxonomies, Comments (table pulled from first object in array)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info = array(&nbsp;</div></li><li><div>            //'select' =&gt; '`t`.*', &nbsp;</div></li><li><div>            'object_type' =&gt; $object_type, &nbsp;</div></li><li><div>            'type' =&gt; null, &nbsp;</div></li><li><div>            'object_name' =&gt; $object, &nbsp;</div></li><li><div>            'object_hierarchical' =&gt; false, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'table' =&gt; $object, &nbsp;</div></li><li><div>            'meta_table' =&gt; $object, &nbsp;</div></li><li><div>            'pod_table' =&gt; $wpdb-&gt;prefix . 'pods_' . ( empty( $object ) ? $name : $object ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'field_id' =&gt; 'id', &nbsp;</div></li><li><div>            'field_index' =&gt; 'name', &nbsp;</div></li><li><div>            'field_slug' =&gt; null, &nbsp;</div></li><li><div>            'field_type' =&gt; null, &nbsp;</div></li><li><div>            'field_parent' =&gt; null, &nbsp;</div></li><li><div>            'field_parent_select' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'meta_field_id' =&gt; 'id', &nbsp;</div></li><li><div>            'meta_field_index' =&gt; 'name', &nbsp;</div></li><li><div>            'meta_field_value' =&gt; 'name', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'pod_field_id' =&gt; 'id', &nbsp;</div></li><li><div>            'pod_field_index' =&gt; 'name', &nbsp;</div></li><li><div>            'pod_field_slug' =&gt; null, &nbsp;</div></li><li><div>            'pod_field_parent' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'join' =&gt; array(), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'where' =&gt; null, &nbsp;</div></li><li><div>            'where_default' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'orderby' =&gt; null, &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'pod' =&gt; null, &nbsp;</div></li><li><div>            'recurse' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $object_type ) ) {&nbsp;</div></li><li><div>            $object_type = 'post_type';&nbsp;</div></li><li><div>            $object = 'post';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( empty( $object ) && in_array( $object_type, array( 'user', 'media', 'comment' ) ) ) {&nbsp;</div></li><li><div>            $object = $object_type;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod_name = $pod;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $pod_name ) )&nbsp;</div></li><li><div>            $pod_name = pods_var_raw( 'name', $pod_name, ( version_compare( PHP_VERSION, '5.4.0', '&gt;=' ) ? json_encode( $pod_name, JSON_UNESCAPED_UNICODE ) : json_encode( $pod_name ) ), null, true );&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $pod_name = $object;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_name = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $field_name ) )&nbsp;</div></li><li><div>            $field_name = pods_var_raw( 'name', $field_name, ( version_compare( PHP_VERSION, '5.4.0', '&gt;=' ) ? json_encode( $pod_name, JSON_UNESCAPED_UNICODE ) : json_encode( $field_name ) ), null, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transient = 'pods_' . $wpdb-&gt;prefix . '_get_table_info_' . md5( $object_type . '_object_' . $object . '_name_' . $name . '_pod_' . $pod_name . '_field_' . $field_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current_language = false;&nbsp;</div></li><li><div>        $current_language_t_id = $current_language_tt_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // WPML support&nbsp;</div></li><li><div>        if ( is_object( $sitepress ) && !$icl_adjust_id_url_filter_off )&nbsp;</div></li><li><div>            $current_language = pods_sanitize( ICL_LANGUAGE_CODE );&nbsp;</div></li><li><div>        // Polylang support&nbsp;</div></li><li><div>        elseif ( is_object( $polylang ) && function_exists( 'pll_current_language' ) ) {&nbsp;</div></li><li><div>            $current_language = pods_sanitize( pll_current_language( 'slug' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $current_language ) ) {&nbsp;</div></li><li><div>                $current_language_t_id = (int) $polylang-&gt;get_language( $current_language )-&gt;term_id;&nbsp;</div></li><li><div>                $current_language_tt_id = (int) $polylang-&gt;get_language( $current_language )-&gt;term_taxonomy_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $current_language ) )&nbsp;</div></li><li><div>            $transient = 'pods_' . $wpdb-&gt;prefix . '_get_table_info_' . $current_language . '_' . md5( $object_type . '_object_' . $object . '_name_' . $name . '_pod_' . $pod_name . '_field_' . $field_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_info = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( self::$table_info_cache[ $transient ] ) ) {&nbsp;</div></li><li><div>            // Prefer info from the object internal cache&nbsp;</div></li><li><div>            $_info = self::$table_info_cache[ $transient ];&nbsp;</div></li><li><div>        } elseif ( pods_api_cache() ) {&nbsp;</div></li><li><div>            $_info = pods_transient_get( $transient );&nbsp;</div></li><li><div>            if ( false === $_info && ! did_action( 'init' ) ) {&nbsp;</div></li><li><div>                $_info = pods_transient_get( $transient . '_pre_init' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $_info ) {&nbsp;</div></li><li><div>            // Data was cached, use that&nbsp;</div></li><li><div>            $info = $_info;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // Data not cached, load it up&nbsp;</div></li><li><div>            $_info = $this-&gt;get_table_info_load( $object_type, $object, $name, $pod );&nbsp;</div></li><li><div>            if ( isset( $_info[ 'type' ] ) ) {&nbsp;</div></li><li><div>                // Allow function to override $object_type&nbsp;</div></li><li><div>                $object_type = $_info[ 'type' ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $info = array_merge( $info, $_info );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 === strpos( $object_type, 'post_type' ) || 'media' == $object_type || in_array( pods_var_raw( 'type', $info[ 'pod' ] ), array( 'post_type', 'media' ) ) ) {&nbsp;</div></li><li><div>            $info[ 'table' ] = $wpdb-&gt;posts;&nbsp;</div></li><li><div>            $info[ 'meta_table' ] = $wpdb-&gt;postmeta;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'field_id' ] = 'ID';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = 'post_title';&nbsp;</div></li><li><div>            $info[ 'field_slug' ] = 'post_name';&nbsp;</div></li><li><div>            $info[ 'field_type' ] = 'post_type';&nbsp;</div></li><li><div>            $info[ 'field_parent' ] = 'post_parent';&nbsp;</div></li><li><div>            $info[ 'field_parent_select' ] = '`t`.`' . $info[ 'field_parent' ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'meta_field_id' ] = 'post_id';&nbsp;</div></li><li><div>            $info[ 'meta_field_index' ] = 'meta_key';&nbsp;</div></li><li><div>            $info[ 'meta_field_value' ] = 'meta_value';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'media' == $object_type )&nbsp;</div></li><li><div>                $object = 'attachment';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $name ) ) {&nbsp;</div></li><li><div>                $prefix = 'post_type-';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Make sure we actually have the prefix before trying anything with the name&nbsp;</div></li><li><div>                if ( 0 === strpos( $object_type, $prefix ) )&nbsp;</div></li><li><div>                    $name = substr( $object_type, strlen( $prefix ), strlen( $object_type ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'media' != $object_type )&nbsp;</div></li><li><div>                $object_type = 'post_type';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_type = pods_sanitize( ( empty( $object ) ? $name : $object ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'attachment' == $post_type || 'media' == $object_type )&nbsp;</div></li><li><div>                $info[ 'pod_table' ] = $wpdb-&gt;prefix . 'pods_media';&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $info[ 'pod_table' ] = $wpdb-&gt;prefix . 'pods_' . pods_clean_name( $post_type, true, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $post_type_object = get_post_type_object( $post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_object( $post_type_object ) && $post_type_object-&gt;hierarchical )&nbsp;</div></li><li><div>                $info[ 'object_hierarchical' ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Default Post Status to query for.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * Use to change &quot;default&quot; post status from publish to any other status or statuses.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param  array $post_status List of post statuses. Default is 'publish'&nbsp;</div></li><li><div>             * @param  string $post_type Post type of current object&nbsp;</div></li><li><div>             * @param  array $info Array of information about the object.&nbsp;</div></li><li><div>             * @param  string $object    Type of object&nbsp;</div></li><li><div>             * @param  string $name Name of pod to load&nbsp;</div></li><li><div>             * @param  array $pod Array with Pod information. Result of PodsAPI::load_pod()&nbsp;</div></li><li><div>             * @param  array $field        Array with field information&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since unknown&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            $post_status = apply_filters( 'pods_api_get_table_info_default_post_status', array( 'publish' ), $post_type, $info, $object_type, $object, $name, $pod, $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'where' ] = array(&nbsp;</div></li><li><div>                //'post_status' =&gt; '`t`.`post_status` IN ( &quot;inherit&quot;, &quot;publish&quot; )', // @todo Figure out what statuses Attachments can be&nbsp;</div></li><li><div>                'post_type' =&gt; '`t`.`' . $info[ 'field_type' ] . '` = &quot;' . $post_type . '&quot;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'post_type' == $object_type )&nbsp;</div></li><li><div>                $info[ 'where_default' ] = '`t`.`post_status` IN ( &quot;' . implode( '&quot;, &quot;', $post_status ) . '&quot; )';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'orderby' ] = '`t`.`menu_order`, `t`.`' . $info[ 'field_index' ] . '`, `t`.`post_date`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // WPML support&nbsp;</div></li><li><div>            if ( is_object( $sitepress ) && $sitepress-&gt;is_translated_post_type( $post_type ) && !$icl_adjust_id_url_filter_off ) {&nbsp;</div></li><li><div>                $info[ 'join' ][ 'wpml_translations' ] = &quot;&nbsp;</div></li><li><div>                        LEFT JOIN `{$wpdb-&gt;prefix}icl_translations` AS `wpml_translations`&nbsp;</div></li><li><div>                            ON `wpml_translations`.`element_id` = `t`.`ID`&nbsp;</div></li><li><div>                                AND `wpml_translations`.`element_type` = 'post_{$post_type}'&nbsp;</div></li><li><div>                                AND `wpml_translations`.`language_code` = '{$current_language}'&nbsp;</div></li><li><div>                    &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info[ 'join' ][ 'wpml_languages' ] = &quot;&nbsp;</div></li><li><div>                        LEFT JOIN `{$wpdb-&gt;prefix}icl_languages` AS `wpml_languages`&nbsp;</div></li><li><div>                            ON `wpml_languages`.`code` = `wpml_translations`.`language_code` AND `wpml_languages`.`active` = 1&nbsp;</div></li><li><div>                    &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info[ 'where' ][ 'wpml_languages' ] = &quot;`wpml_languages`.`code` IS NOT NULL&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Polylang support&nbsp;</div></li><li><div>            elseif( is_object( $polylang ) && !empty( $current_language ) && function_exists( 'pll_is_translated_post_type' ) && pll_is_translated_post_type( $post_type ) ) {&nbsp;</div></li><li><div>                $info[ 'join' ][ 'polylang_languages' ] = &quot;&nbsp;</div></li><li><div>                        LEFT JOIN `{$wpdb-&gt;term_relationships}` AS `polylang_languages`&nbsp;</div></li><li><div>                            ON `polylang_languages`.`object_id` = `t`.`ID`&nbsp;</div></li><li><div>                                AND `polylang_languages`.`term_taxonomy_id` = {$current_language_tt_id}&nbsp;</div></li><li><div>                    &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info[ 'where' ][ 'polylang_languages' ] = &quot;`polylang_languages`.`object_id` IS NOT NULL&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'object_fields' ] = $this-&gt;get_wp_object_fields( $object_type, $info[ 'pod' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 0 === strpos( $object_type, 'taxonomy' ) || in_array( $object_type, array( 'nav_menu', 'post_format' ) ) || 'taxonomy' == pods_var_raw( 'type', $info[ 'pod' ] ) ) {&nbsp;</div></li><li><div>            $info[ 'table' ] = $info[ 'meta_table' ] = $wpdb-&gt;terms;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'join' ][ 'tt' ] = &quot;LEFT JOIN `{$wpdb-&gt;term_taxonomy}` AS `tt` ON `tt`.`term_id` = `t`.`term_id`&quot;;&nbsp;</div></li><li><div>            $info[ 'field_id' ] = $info[ 'meta_field_id' ] = 'term_id';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = $info[ 'meta_field_index' ] = $info[ 'meta_field_value' ] = 'name';&nbsp;</div></li><li><div>            $info[ 'field_slug' ] = 'slug';&nbsp;</div></li><li><div>            $info[ 'field_type' ] = 'taxonomy';&nbsp;</div></li><li><div>            $info[ 'field_parent' ] = 'parent';&nbsp;</div></li><li><div>            $info[ 'field_parent_select' ] = '`tt`.`' . $info[ 'field_parent' ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'nav_menu' == $object_type )&nbsp;</div></li><li><div>                $object = 'nav_menu';&nbsp;</div></li><li><div>            elseif ( 'post_format' == $object_type )&nbsp;</div></li><li><div>                $object = 'post_format';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $name ) ) {&nbsp;</div></li><li><div>                $prefix = 'taxonomy-';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Make sure we actually have the prefix before trying anything with the name&nbsp;</div></li><li><div>                if ( 0 === strpos( $object_type, $prefix ) )&nbsp;</div></li><li><div>                    $name = substr( $object_type, strlen( $prefix ), strlen( $object_type ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !in_array( $object_type, array( 'nav_menu', 'post_format' ) ) )&nbsp;</div></li><li><div>                $object_type = 'taxonomy';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $taxonomy = pods_sanitize( ( empty( $object ) ? $name : $object ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'pod_table' ] = $wpdb-&gt;prefix . 'pods_' . pods_clean_name( $taxonomy, true, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $taxonomy_object = get_taxonomy( $taxonomy );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_object( $taxonomy_object ) && $taxonomy_object-&gt;hierarchical )&nbsp;</div></li><li><div>                $info[ 'object_hierarchical' ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'where' ] = array(&nbsp;</div></li><li><div>                'tt.taxonomy' =&gt; '`tt`.`' . $info[ 'field_type' ] . '` = &quot;' . $taxonomy . '&quot;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // WPML Support&nbsp;</div></li><li><div>            if ( is_object( $sitepress ) && $sitepress-&gt;is_translated_taxonomy( $taxonomy ) && !$icl_adjust_id_url_filter_off ) {&nbsp;</div></li><li><div>                $info[ 'join' ][ 'wpml_translations' ] = &quot;&nbsp;</div></li><li><div>                        LEFT JOIN `{$wpdb-&gt;prefix}icl_translations` AS `wpml_translations`&nbsp;</div></li><li><div>                            ON `wpml_translations`.`element_id` = `tt`.`term_taxonomy_id`&nbsp;</div></li><li><div>                                AND `wpml_translations`.`element_type` = 'tax_{$taxonomy}'&nbsp;</div></li><li><div>                                AND `wpml_translations`.`language_code` = '{$current_language}'&nbsp;</div></li><li><div>                    &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info[ 'join' ][ 'wpml_languages' ] = &quot;&nbsp;</div></li><li><div>                        LEFT JOIN `{$wpdb-&gt;prefix}icl_languages` AS `wpml_languages`&nbsp;</div></li><li><div>                            ON `wpml_languages`.`code` = `wpml_translations`.`language_code` AND `wpml_languages`.`active` = 1&nbsp;</div></li><li><div>                    &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info[ 'where' ][ 'wpml_languages' ] = &quot;`wpml_languages`.`code` IS NOT NULL&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Polylang support&nbsp;</div></li><li><div>            elseif ( is_object( $polylang ) && !empty( $current_language ) && function_exists( 'pll_is_translated_taxonomy' ) && pll_is_translated_taxonomy( $taxonomy ) ) {&nbsp;</div></li><li><div>                $info[ 'join' ][ 'polylang_languages' ] = &quot;&nbsp;</div></li><li><div>                        LEFT JOIN `{$wpdb-&gt;termmeta}` AS `polylang_languages`&nbsp;</div></li><li><div>                            ON `polylang_languages`.`term_id` = `t`.`term_id`&nbsp;</div></li><li><div>                                AND `polylang_languages`.`meta_value` = {$current_language_t_id}&nbsp;</div></li><li><div>                    &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $info[ 'where' ][ 'polylang_languages' ] = &quot;`polylang_languages`.`term_id` IS NOT NULL&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'object_fields' ] = $this-&gt;get_wp_object_fields( $object_type, $info[ 'pod' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'user' == $object_type || 'user' == pods_var_raw( 'type', $info[ 'pod' ] ) ) {&nbsp;</div></li><li><div>            $info[ 'table' ] = $wpdb-&gt;users;&nbsp;</div></li><li><div>            $info[ 'meta_table' ] = $wpdb-&gt;usermeta;&nbsp;</div></li><li><div>            $info[ 'pod_table' ] = $wpdb-&gt;prefix . 'pods_user';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'field_id' ] = 'ID';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = 'display_name';&nbsp;</div></li><li><div>            $info[ 'field_slug' ] = 'user_nicename';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'meta_field_id' ] = 'user_id';&nbsp;</div></li><li><div>            $info[ 'meta_field_index' ] = 'meta_key';&nbsp;</div></li><li><div>            $info[ 'meta_field_value' ] = 'meta_value';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'where' ] = array(&nbsp;</div></li><li><div>                'user_status' =&gt; '`t`.`user_status` = 0'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'object_fields' ] = $this-&gt;get_wp_object_fields( $object_type, $info[ 'pod' ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'comment' == $object_type || 'comment' == pods_var_raw( 'type', $info[ 'pod' ] ) ) {&nbsp;</div></li><li><div>            //$info[ 'object_hierarchical' ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'table' ] = $wpdb-&gt;comments;&nbsp;</div></li><li><div>            $info[ 'meta_table' ] = $wpdb-&gt;commentmeta;&nbsp;</div></li><li><div>            $info[ 'pod_table' ] = $wpdb-&gt;prefix . 'pods_comment';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'field_id' ] = 'comment_ID';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = 'comment_date';&nbsp;</div></li><li><div>            $info[ 'field_type' ] = 'comment_type';&nbsp;</div></li><li><div>            $info[ 'field_parent' ] = 'comment_parent';&nbsp;</div></li><li><div>            $info[ 'field_parent_select' ] = '`t`.`' . $info[ 'field_parent' ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'meta_field_id' ] = 'comment_id';&nbsp;</div></li><li><div>            $info[ 'meta_field_index' ] = 'meta_key';&nbsp;</div></li><li><div>            $info[ 'meta_field_value' ] = 'meta_value';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $object = 'comment';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $comment_type = ( empty( $object ) ? $name : $object );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $comment_type_clause = '`t`.`' . $info[ 'field_type' ] . '` = &quot;' . $comment_type . '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'comment' == $comment_type ) {&nbsp;</div></li><li><div>                $comment_type_clause = '( ' . $comment_type_clause . ' OR `t`.`' . $info[ 'field_type' ] . '` = &quot;&quot; )';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'where' ] = array(&nbsp;</div></li><li><div>                'comment_approved' =&gt; '`t`.`comment_approved` = 1', &nbsp;</div></li><li><div>                'comment_type' =&gt; $comment_type_clause&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'orderby' ] = '`t`.`' . $info[ 'field_index' ] . '` DESC, `t`.`' . $info[ 'field_id' ] . '`';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( in_array( $object_type, array( 'option', 'settings' ) ) || 'settings' == pods_var_raw( 'type', $info[ 'pod' ] ) ) {&nbsp;</div></li><li><div>            $info[ 'table' ] = $wpdb-&gt;options;&nbsp;</div></li><li><div>            $info[ 'meta_table' ] = $wpdb-&gt;options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'field_id' ] = 'option_id';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = 'option_name';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'meta_field_id' ] = 'option_id';&nbsp;</div></li><li><div>            $info[ 'meta_field_index' ] = 'option_name';&nbsp;</div></li><li><div>            $info[ 'meta_field_value' ] = 'option_value';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'orderby' ] = '`t`.`' . $info[ 'field_index' ] . '` ASC';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( is_multisite() && ( in_array( $object_type, array( 'site_option', 'site_settings' ) ) || 'site_settings' == pods_var_raw( 'type', $info[ 'pod' ] ) ) ) {&nbsp;</div></li><li><div>            $info[ 'table' ] = $wpdb-&gt;sitemeta;&nbsp;</div></li><li><div>            $info[ 'meta_table' ] = $wpdb-&gt;sitemeta;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'field_id' ] = 'site_id';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = 'meta_key';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'meta_field_id' ] = 'site_id';&nbsp;</div></li><li><div>            $info[ 'meta_field_index' ] = 'meta_key';&nbsp;</div></li><li><div>            $info[ 'meta_field_value' ] = 'meta_value';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'orderby' ] = '`t`.`' . $info[ 'field_index' ] . '` ASC';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( is_multisite() && 'network' == $object_type ) { // Network = Site&nbsp;</div></li><li><div>            $info[ 'table' ] = $wpdb-&gt;site;&nbsp;</div></li><li><div>            $info[ 'meta_table' ] = $wpdb-&gt;sitemeta;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'field_id' ] = 'id';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = 'domain';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'meta_field_id' ] = 'site_id';&nbsp;</div></li><li><div>            $info[ 'meta_field_index' ] = 'meta_key';&nbsp;</div></li><li><div>            $info[ 'meta_field_value' ] = 'meta_value';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'orderby' ] = '`t`.`' . $info[ 'field_index' ] . '` ASC, `t`.`path` ASC, `t`.`' . $info[ 'field_id' ] . '`';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( is_multisite() && 'site' == $object_type ) { // Site = Blog&nbsp;</div></li><li><div>            $info[ 'table' ] = $wpdb-&gt;blogs;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'field_id' ] = 'blog_id';&nbsp;</div></li><li><div>            $info[ 'field_index' ] = 'domain';&nbsp;</div></li><li><div>            $info[ 'field_type' ] = 'site_id';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'where' ] = array(&nbsp;</div></li><li><div>                'archived' =&gt; '`t`.`archived` = 0', &nbsp;</div></li><li><div>                'spam' =&gt; '`t`.`spam` = 0', &nbsp;</div></li><li><div>                'deleted' =&gt; '`t`.`deleted` = 0', &nbsp;</div></li><li><div>                'site_id' =&gt; '`t`.`' . $info[ 'field_type' ] . '` = ' . (int) get_current_site()-&gt;id&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $info[ 'orderby' ] = '`t`.`' . $info[ 'field_index' ] . '` ASC, `t`.`path` ASC, `t`.`' . $info[ 'field_id' ] . '`';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( 'table' == $object_type || 'table' == pods_var_raw( 'type', $info[ 'pod' ] ) ) {&nbsp;</div></li><li><div>            $info[ 'table' ] = ( empty( $object ) ? $name : $object );&nbsp;</div></li><li><div>            $info[ 'pod_table' ] = $wpdb-&gt;prefix . 'pods_' . $info[ 'table' ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $field ) && is_array( $field ) ) {&nbsp;</div></li><li><div>                $info[ 'table' ] = pods_var_raw( 'pick_table', pods_var_raw( 'options', $field, $field ) );&nbsp;</div></li><li><div>                $info[ 'field_id' ] = pods_var_raw( 'pick_table_id', pods_var_raw( 'options', $field, $field ) );&nbsp;</div></li><li><div>                $info[ 'field_index' ] = $info[ 'meta_field_index' ] = $info[ 'meta_field_value' ] = pods_var_raw( 'pick_table_index', pods_var_raw( 'options', $field, $field ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info[ 'table' ] = pods_clean_name( $info[ 'table' ], false, false );&nbsp;</div></li><li><div>        $info[ 'meta_table' ] = pods_clean_name( $info[ 'meta_table' ], false, false );&nbsp;</div></li><li><div>        $info[ 'pod_table' ] = pods_clean_name( $info[ 'pod_table' ], false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info[ 'field_id' ] = pods_clean_name( $info[ 'field_id' ], false, false );&nbsp;</div></li><li><div>        $info[ 'field_index' ] = pods_clean_name( $info[ 'field_index' ], false, false );&nbsp;</div></li><li><div>        $info[ 'field_slug' ] = pods_clean_name( $info[ 'field_slug' ], false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info[ 'meta_field_id' ] = pods_clean_name( $info[ 'meta_field_id' ], false, false );&nbsp;</div></li><li><div>        $info[ 'meta_field_index' ] = pods_clean_name( $info[ 'meta_field_index' ], false, false );&nbsp;</div></li><li><div>        $info[ 'meta_field_value' ] = pods_clean_name( $info[ 'meta_field_value' ], false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $info[ 'orderby' ] ) )&nbsp;</div></li><li><div>            $info[ 'orderby' ] = '`t`.`' . $info[ 'field_index' ] . '`, `t`.`' . $info[ 'field_id' ] . '`';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'table' == pods_var_raw( 'storage', $info[ 'pod' ] ) && !in_array( $object_type, array( 'pod', 'table' ) ) ) {&nbsp;</div></li><li><div>            $info[ 'join' ][ 'd' ] = 'LEFT JOIN `' . $info[ 'pod_table' ] . '` AS `d` ON `d`.`id` = `t`.`' . $info[ 'field_id' ] . '`';&nbsp;</div></li><li><div>            //$info[ 'select' ] .= ', `d`.*';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $info[ 'pod' ] ) && is_array( $info[ 'pod' ] ) )&nbsp;</div></li><li><div>            $info[ 'recurse' ] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info[ 'type' ] = $object_type;&nbsp;</div></li><li><div>        $info[ 'object_name' ] = $object;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( pods_api_cache() ) {&nbsp;</div></li><li><div>            if ( ! did_action( 'init' ) ) {&nbsp;</div></li><li><div>                $transient .= '_pre_init';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            pods_transient_set( $transient, $info );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        self::$table_info_cache[ $transient ] = apply_filters( 'pods_api_get_table_info', $info, $object_type, $object, $name, $pod, $field, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::$table_info_cache[ $transient ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Export a package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string Pod Type IDs to export&nbsp;</div></li><li><div>     * $params['template'] string Template IDs to export&nbsp;</div></li><li><div>     * $params['podpage'] string Pod Page IDs to export&nbsp;</div></li><li><div>     * $params['helper'] string Helper IDs to export&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     * @deprecated 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function export_package ( $params ) {&nbsp;</div></li><li><div>        if ( class_exists( 'Pods_Migrate_Packages' ) )&nbsp;</div></li><li><div>            return Pods_Migrate_Packages::export( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Replace an existing package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $data (optional) An associative array containing a package, or the json encoded package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.8&nbsp;</div></li><li><div>     * @deprecated 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function replace_package ( $data = false ) {&nbsp;</div></li><li><div>        return $this-&gt;import_package( $data, true );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Import a package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $data (optional) An associative array containing a package, or the json encoded package&nbsp;</div></li><li><div>     * @param bool $replace (optional) Replace existing items when found&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     * @deprecated 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function import_package ( $data = false, $replace = false ) {&nbsp;</div></li><li><div>        if ( class_exists( 'Pods_Migrate_Packages' ) )&nbsp;</div></li><li><div>            return Pods_Migrate_Packages::import( $data, $replace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate a package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|string $data (optional) An associative array containing a package, or the json encoded package&nbsp;</div></li><li><div>     * @param bool $output (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|bool&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     * @deprecated 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function validate_package ( $data = false, $output = false ) {&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Import data from an array or a CSV file.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $import_data PHP associative array or CSV input&nbsp;</div></li><li><div>     * @param bool $numeric_mode Use IDs instead of the name field when matching&nbsp;</div></li><li><div>     * @param string $format Format of import data, options are php or csv&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array IDs of imported items&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     * @todo This needs some love and use of table_info etc for relationships&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function import ( $import_data, $numeric_mode = false, $format = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null === $format && null !== $this-&gt;format )&nbsp;</div></li><li><div>            $format = $this-&gt;format;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'csv' == $format && !is_array( $import_data ) ) {&nbsp;</div></li><li><div>            $data = pods_migrate( 'sv', ', ' )-&gt;parse( $import_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $import_data = $data[ 'items' ];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_query( &quot;SET NAMES utf8&quot; );&nbsp;</div></li><li><div>        pods_query( &quot;SET CHARACTER SET utf8&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Loop through the array of items&nbsp;</div></li><li><div>        $ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Test to see if it's an array of arrays&nbsp;</div></li><li><div>        if ( !is_array( @current( $import_data ) ) )&nbsp;</div></li><li><div>            $import_data = array( $import_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod( array( 'name' =&gt; $this-&gt;pod ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === $pod )&nbsp;</div></li><li><div>            return pods_error( __( 'Pod not found', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array_merge( $pod[ 'fields' ], $pod[ 'object_fields' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $simple_tableless_objects = PodsForm::simple_tableless_objects();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $import_data as $key =&gt; $data_row ) {&nbsp;</div></li><li><div>            $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Loop through each field (use $fields so only valid fields get parsed)&nbsp;</div></li><li><div>            foreach ( $fields as $field_name =&gt; $field_data ) {&nbsp;</div></li><li><div>                if ( !isset( $data_row[ $field_name ] ) && !isset( $data_row[ $field_data[ 'label' ] ] ) )&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field_id = $field_data[ 'id' ];&nbsp;</div></li><li><div>                $type = $field_data[ 'type' ];&nbsp;</div></li><li><div>                $pick_object = isset( $field_data[ 'pick_object' ] ) ? $field_data[ 'pick_object' ] : '';&nbsp;</div></li><li><div>                $pick_val = isset( $field_data[ 'pick_val' ] ) ?  $field_data[ 'pick_val' ] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset( $data_row[ $field_name] ) )&nbsp;</div></li><li><div>                    $field_value = $data_row[ $field_name ];&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $field_value = $data_row[ $field_data[ 'label' ] ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( null !== $field_value && false !== $field_value && '' !== $field_value ) {&nbsp;</div></li><li><div>                    if ( 'pick' == $type || in_array( $type, PodsForm::file_field_types() ) ) {&nbsp;</div></li><li><div>                        $field_values = is_array( $field_value ) ? $field_value : array( $field_value );&nbsp;</div></li><li><div>                        $pick_values = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        foreach ( $field_values as $pick_value ) {&nbsp;</div></li><li><div>                            if ( in_array( $type, PodsForm::file_field_types() ) || 'media' == $pick_object ) {&nbsp;</div></li><li><div>                                $where = &quot;`guid` = '&quot; . pods_sanitize( $pick_value ) . &quot;'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ( 0 &lt; pods_absint( $pick_value ) && false !== $numeric_mode )&nbsp;</div></li><li><div>                                    $where = &quot;`ID` = &quot; . pods_absint( $pick_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $result = pods_query( &quot;SELECT `ID` AS `id` FROM `{$wpdb-&gt;posts}` WHERE `post_type` = 'attachment' AND {$where} ORDER BY `ID`&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ( !empty( $result ) )&nbsp;</div></li><li><div>                                    $pick_values[] = $result[ 0 ]-&gt;id;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            // @todo This could and should be abstracted better and simplified&nbsp;</div></li><li><div>                            elseif ( 'pick' == $type ) {&nbsp;</div></li><li><div>                                $related_pod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ( 'pod' == $pick_object )&nbsp;</div></li><li><div>                                    $related_pod = $this-&gt;load_pod( array( 'name' =&gt; $pick_val, 'table_info' =&gt; true ), false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ( empty( $related_pod ) ) {&nbsp;</div></li><li><div>                                    $related_pod = array(&nbsp;</div></li><li><div>                                        'id' =&gt; 0, &nbsp;</div></li><li><div>                                        'type' =&gt; $pick_object&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                if ( in_array( 'taxonomy', array( $pick_object, $related_pod[ 'type' ] ) ) ) {&nbsp;</div></li><li><div>                                    $where = &quot;`t`.`name` = '&quot; . pods_sanitize( $pick_value ) . &quot;'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( 0 &lt; pods_absint( $pick_value ) && false !== $numeric_mode )&nbsp;</div></li><li><div>                                        $where = &quot;`tt`.`term_id` = &quot; . pods_absint( $pick_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $result = pods_query( &quot;SELECT `t`.`term_id` AS `id` FROM `{$wpdb-&gt;term_taxonomy}` AS `tt` LEFT JOIN `{$wpdb-&gt;terms}` AS `t` ON `t`.`term_id` = `tt`.`term_id` WHERE `taxonomy` = '{$pick_val}' AND {$where} ORDER BY `t`.`term_id`&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( !empty( $result ) )&nbsp;</div></li><li><div>                                        $pick_values[] = $result[ 0 ]-&gt;id;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                elseif ( in_array( 'post_type', array( $pick_object, $related_pod[ 'type' ] ) ) || in_array( 'media', array( $pick_object, $related_pod[ 'type' ] ) ) ) {&nbsp;</div></li><li><div>                                    $where = &quot;`post_title` = '&quot; . pods_sanitize( $pick_value ) . &quot;'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( 0 &lt; pods_absint( $pick_value ) && false !== $numeric_mode )&nbsp;</div></li><li><div>                                        $where = &quot;`ID` = &quot; . pods_absint( $pick_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $result = pods_query( &quot;SELECT `ID` AS `id` FROM `{$wpdb-&gt;posts}` WHERE `post_type` = '{$pick_val}' AND {$where} ORDER BY `ID`&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( !empty( $result ) )&nbsp;</div></li><li><div>                                        $pick_values[] = $result[ 0 ]-&gt;id;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                elseif ( in_array( 'user', array( $pick_object, $related_pod[ 'type' ] ) ) ) {&nbsp;</div></li><li><div>                                    $where = &quot;`user_login` = '&quot; . pods_sanitize( $pick_value ) . &quot;'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( 0 &lt; pods_absint( $pick_value ) && false !== $numeric_mode )&nbsp;</div></li><li><div>                                        $where = &quot;`ID` = &quot; . pods_absint( $pick_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $result = pods_query( &quot;SELECT `ID` AS `id` FROM `{$wpdb-&gt;users}` WHERE {$where} ORDER BY `ID`&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( !empty( $result ) )&nbsp;</div></li><li><div>                                        $pick_values[] = $result[ 0 ]-&gt;id;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                elseif ( in_array( 'comment', array( $pick_object, $related_pod[ 'type' ] ) ) ) {&nbsp;</div></li><li><div>                                    $where = &quot;`comment_ID` = &quot; . pods_absint( $pick_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $result = pods_query( &quot;SELECT `comment_ID` AS `id` FROM `{$wpdb-&gt;comments}` WHERE {$where} ORDER BY `ID`&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( !empty( $result ) )&nbsp;</div></li><li><div>                                        $pick_values[] = $result[ 0 ]-&gt;id;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                elseif ( in_array( $pick_object, $simple_tableless_objects ) )&nbsp;</div></li><li><div>                                    $pick_values[] = $pick_value;&nbsp;</div></li><li><div>                                elseif ( !empty( $related_pod[ 'id' ] ) ) {&nbsp;</div></li><li><div>                                    $where = &quot;`&quot; . $related_pod[ 'field_index' ] . &quot;` = '&quot; . pods_sanitize( $pick_value ) . &quot;'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( 0 &lt; pods_absint( $pick_value ) && false !== $numeric_mode )&nbsp;</div></li><li><div>                                        $where = &quot;`&quot; . $related_pod[ 'field_id' ] . &quot;` = &quot; . pods_absint( $pick_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    $result = pods_query( &quot;SELECT `&quot; . $related_pod[ 'field_id' ] . &quot;` AS `id` FROM `&quot; . $related_pod[ 'table' ] . &quot;` WHERE {$where} ORDER BY `&quot; . $related_pod[ 'field_id' ] . &quot;`&quot;, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( !empty( $result ) )&nbsp;</div></li><li><div>                                        $pick_values[] = $result[ 0 ]-&gt;id;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $field_value = implode( ', ', $pick_values );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $data[ $field_name ] = $field_value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty( $data ) ) {&nbsp;</div></li><li><div>                $params = array(&nbsp;</div></li><li><div>                    'pod' =&gt; $this-&gt;pod, &nbsp;</div></li><li><div>                    'data' =&gt; $data&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $ids[] = $this-&gt;save_pod_item( $params );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $ids;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Export data from a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|object $pod The pod name or Pods object&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Data arrays of all exported pod items&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function export ( $pod = null, $params = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $pod ) ) {&nbsp;</div></li><li><div>            $pod = $this-&gt;pod;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $find = array(&nbsp;</div></li><li><div>            'limit' =&gt; -1, &nbsp;</div></li><li><div>            'search' =&gt; false, &nbsp;</div></li><li><div>            'pagination' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $params ) && isset( $params[ 'params' ] ) ) {&nbsp;</div></li><li><div>            $find = array_merge( $find, (array) $params[ 'params' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unset( $params[ 'params' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $pod = pods( $pod, $find );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( !is_object( $pod ) ) {&nbsp;</div></li><li><div>            $pod = pods( $pod, $find );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while ( $pod-&gt;fetch() ) {&nbsp;</div></li><li><div>            $data[ $pod-&gt;id() ] = $this-&gt;export_pod_item( $params, $pod );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;do_hook( 'export', $data, $pod-&gt;pod, $pod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert CSV to a PHP array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $data The CSV input&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @deprecated 2.3.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function csv_to_php ( $data, $delimiter = ', ' ) {&nbsp;</div></li><li><div>        pods_deprecated( &quot;PodsAPI-&gt;csv_to_php&quot;, '2.3.5' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = pods_migrate( 'sv', $delimiter, $data )-&gt;parse();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data[ 'items' ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Clear Pod-related cache&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function cache_flush_pods ( $pod = null ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * @var $wpdb wpdb&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_transient_clear( 'pods' );&nbsp;</div></li><li><div>        pods_transient_clear( 'pods_components' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( null !== $pod && is_array( $pod ) ) {&nbsp;</div></li><li><div>            pods_transient_clear( 'pods_pod_' . $pod[ 'name' ] );&nbsp;</div></li><li><div>            pods_cache_clear( $pod[ 'name' ], 'pods-class' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $pod[ 'fields' ] as $field ) {&nbsp;</div></li><li><div>                pods_transient_clear( 'pods_field_' . $pod[ 'name' ] . '_' . $field[ 'name' ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( in_array( $pod[ 'type' ], array( 'post_type', 'taxonomy' ) ) )&nbsp;</div></li><li><div>                pods_transient_clear( 'pods_wp_cpt_ct' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            pods_transient_clear( 'pods_wp_cpt_ct' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wpdb-&gt;query( &quot;DELETE FROM `{$wpdb-&gt;options}` WHERE `option_name` LIKE '_transient_pods%'&quot; );&nbsp;</div></li><li><div>        $wpdb-&gt;query( &quot;DELETE FROM `{$wpdb-&gt;options}` WHERE `option_name` LIKE '_transient_timeout_pods%'&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_cache_clear( true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pods_transient_set( 'pods_flush_rewrites', 1 );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Process a Pod-based form&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $params&nbsp;</div></li><li><div>     * @param object $obj Pod object&nbsp;</div></li><li><div>     * @param array $fields Fields being submitted in form ( key =&gt; settings )&nbsp;</div></li><li><div>     * @param string $thank_you URL to send to upon success&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function process_form ( $params, $obj = null, $fields = null, $thank_you = null ) {&nbsp;</div></li><li><div>        $this-&gt;display_errors = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $nonce = pods_var( '_pods_nonce', $params );&nbsp;</div></li><li><div>        $pod = pods_var( '_pods_pod', $params );&nbsp;</div></li><li><div>        $id = pods_var( '_pods_id', $params );&nbsp;</div></li><li><div>        $uri = pods_var( '_pods_uri', $params );&nbsp;</div></li><li><div>        $form = pods_var( '_pods_form', $params );&nbsp;</div></li><li><div>        $location = pods_var( '_pods_location', $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_object( $obj ) ) {&nbsp;</div></li><li><div>            $pod = $obj-&gt;pod;&nbsp;</div></li><li><div>            $id = $obj-&gt;id();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $fields ) ) {&nbsp;</div></li><li><div>            $fields = array_keys( $fields );&nbsp;</div></li><li><div>            $form = implode( ', ', $fields );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $fields = explode( ', ', $form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $nonce ) || empty( $pod ) || empty( $uri ) || empty( $fields ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Invalid submission', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $uid = @session_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_user_logged_in() )&nbsp;</div></li><li><div>            $uid = 'user_' . get_current_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_hash = wp_create_nonce( 'pods_fields_' . $form );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $action = 'pods_form_' . $pod . '_' . $uid . '_' . $id . '_' . $uri . '_' . $field_hash;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $uid ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Access denied for your session, please refresh and try again.', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false === wp_verify_nonce( $nonce, $action ) )&nbsp;</div></li><li><div>            return pods_error( __( 'Access denied, please refresh and try again.', 'pods' ), $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $fields as $field ) {&nbsp;</div></li><li><div>            $data[ $field ] = pods_var_raw( 'pods_field_' . $field, $params, '' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = array(&nbsp;</div></li><li><div>            'pod' =&gt; $pod, &nbsp;</div></li><li><div>            'id' =&gt; $id, &nbsp;</div></li><li><div>            'data' =&gt; $data, &nbsp;</div></li><li><div>            'from' =&gt; 'process_form', &nbsp;</div></li><li><div>            'location' =&gt; $location&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = $this-&gt;save_pod_item( $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 0 &lt; $id && !empty( $thank_you ) ) {&nbsp;</div></li><li><div>            $thank_you = str_replace( 'X_ID_X', $id, $thank_you );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            pods_redirect( $thank_you );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle filters / actions for the class&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function do_hook () {&nbsp;</div></li><li><div>        $args = func_get_args();&nbsp;</div></li><li><div>        if ( empty( $args ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        $name = array_shift( $args );&nbsp;</div></li><li><div>        return pods_do_hook( &quot;api&quot;, $name, $args, $this );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle variables that have been deprecated&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __get ( $name ) {&nbsp;</div></li><li><div>        $name = (string) $name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $this-&gt;deprecated ) ) {&nbsp;</div></li><li><div>            require_once( PODS_DIR . 'deprecated/classes/PodsAPI.php' );&nbsp;</div></li><li><div>            $this-&gt;deprecated = new PodsAPI_Deprecated( $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $var = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $this-&gt;deprecated-&gt;{$name} ) ) {&nbsp;</div></li><li><div>            pods_deprecated( &quot;PodsAPI-&gt;{$name}&quot;, '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $var = $this-&gt;deprecated-&gt;{$name};&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            pods_deprecated( &quot;PodsAPI-&gt;{$name}&quot;, '2.0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $var;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle methods that have been deprecated&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __call ( $name, $args ) {&nbsp;</div></li><li><div>        $name = (string) $name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $this-&gt;deprecated ) ) {&nbsp;</div></li><li><div>            require_once( PODS_DIR . 'deprecated/classes/PodsAPI.php' );&nbsp;</div></li><li><div>            $this-&gt;deprecated = new PodsAPI_Deprecated( $this );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( method_exists( $this-&gt;deprecated, $name ) )&nbsp;</div></li><li><div>            return call_user_func_array( array( $this-&gt;deprecated, $name ), $args );&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            pods_deprecated( &quot;PodsAPI::{$name}&quot;, '2.0' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.5.2</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.6/classes/pods_api/" class="">2.6</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.5/classes/pods_api/" class="active">2.5.5</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.4/classes/pods_api/" class="">2.5.4</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.3/classes/pods_api/" class="">2.5.3</a></li><li><a href="http://hookr.io/plugins/pods-custom-content-types-and-fields/2.5.2/classes/pods_api/" class="">2.5.2</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PodsAPI</li><li><span></span>Pods - Custom Content Types and Fields</li><li><span></span>2.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>