<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.5.6" data-slug="bbpress" data-type="file" data-id="62478"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-topics-template | file | Bbpress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, bbpress, 2.5.6" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=6e80e6e4f7f78c1852871890cebdac55' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-topics-template/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-topics-template%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-topics-template%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-bbpress-2.5.6-file-includes-topics-template","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-topics-template" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to bbpress." href="http://hookr.io/plugins/bbpress/" class="plugin"><span property="name">bbpress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.5.6." href="http://hookr.io/plugins/bbpress/2.5.6/" class="H_VERSION"><span property="name">2.5.6</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/bbpress/2.5.6/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-topics-template</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="2366"><a href="http://hookr.io/plugins/bbpress/2.5.6/all/" title="All">All <span class="count badge">2366</span></a></li><li class="" data-id="new" data-count="7"><a href="http://hookr.io/plugins/bbpress/2.5.6/new/" title="New">New <span class="count badge">7</span></a></li><li class="" data-id="hooks" data-count="1131"><a href="http://hookr.io/plugins/bbpress/2.5.6/hooks/" title="Hooks">Hooks <span class="count badge">1131</span></a></li><li class="" data-id="action" data-count="471"><a href="http://hookr.io/plugins/bbpress/2.5.6/actions/" title="Actions">Actions <span class="count badge">471</span></a></li><li class="" data-id="filter" data-count="660"><a href="http://hookr.io/plugins/bbpress/2.5.6/filters/" title="Filters">Filters <span class="count badge">660</span></a></li><li class="" data-id="class" data-count="54"><a href="http://hookr.io/plugins/bbpress/2.5.6/classes/" title="Classes">Classes <span class="count badge">54</span></a></li><li class="" data-id="constant" data-count="28"><a href="http://hookr.io/plugins/bbpress/2.5.6/constants/" title="Constants">Constants <span class="count badge">28</span></a></li><li class="" data-id="function" data-count="1152"><a href="http://hookr.io/plugins/bbpress/2.5.6/functions/" title="Functions">Functions <span class="count badge">1152</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/bbpress/2.5.6/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/topics/template.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * bbPress Topic Template Tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage TemplateTags</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly</span>&nbsp;</div></li><li><div>if ( !defined( 'ABSPATH' ) ) exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Post Type *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the unique id of the custom post type for topics</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2857)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_post_type() To get the topic post type</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_post_type() {&nbsp;</div></li><li><div>  echo bbp_get_topic_post_type();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the unique id of the custom post type for topics</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2857)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_post_type' with the topic</span>&nbsp;</div></li><li><div><span class="comment">   *                        post type id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The unique topic post type id</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_post_type() {&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_post_type', bbpress()-&gt;topic_post_type );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return array of labels used by the topic post type</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5129)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic_post_type_labels() {&nbsp;</div></li><li><div>  return apply_filters( 'bbp_get_topic_post_type_labels', array(&nbsp;</div></li><li><div>      'name' =&gt; __( 'Topics', 'bbpress' ), &nbsp;</div></li><li><div>      'menu_name' =&gt; __( 'Topics', 'bbpress' ), &nbsp;</div></li><li><div>      'singular_name' =&gt; __( 'Topic', 'bbpress' ), &nbsp;</div></li><li><div>      'all_items' =&gt; __( 'All Topics', 'bbpress' ), &nbsp;</div></li><li><div>      'add_new' =&gt; __( 'New Topic', 'bbpress' ), &nbsp;</div></li><li><div>      'add_new_item' =&gt; __( 'Create New Topic', 'bbpress' ), &nbsp;</div></li><li><div>      'edit' =&gt; __( 'Edit', 'bbpress' ), &nbsp;</div></li><li><div>      'edit_item' =&gt; __( 'Edit Topic', 'bbpress' ), &nbsp;</div></li><li><div>      'new_item' =&gt; __( 'New Topic', 'bbpress' ), &nbsp;</div></li><li><div>      'view' =&gt; __( 'View Topic', 'bbpress' ), &nbsp;</div></li><li><div>      'view_item' =&gt; __( 'View Topic', 'bbpress' ), &nbsp;</div></li><li><div>      'search_items' =&gt; __( 'Search Topics', 'bbpress' ), &nbsp;</div></li><li><div>      'not_found' =&gt; __( 'No topics found', 'bbpress' ), &nbsp;</div></li><li><div>      'not_found_in_trash' =&gt; __( 'No topics found in Trash', 'bbpress' ), &nbsp;</div></li><li><div>      'parent_item_colon' =&gt; __( 'Forum:', 'bbpress' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return array of topic post type rewrite settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5129)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic_post_type_rewrite() {&nbsp;</div></li><li><div>  return apply_filters( 'bbp_get_topic_post_type_rewrite', array(&nbsp;</div></li><li><div>      'slug' =&gt; bbp_get_topic_slug(), &nbsp;</div></li><li><div>      'with_front' =&gt; false&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return array of features the topic post type supports</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5129)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic_post_type_supports() {&nbsp;</div></li><li><div>  return apply_filters( 'bbp_get_topic_post_type_supports', array(&nbsp;</div></li><li><div>      'title', &nbsp;</div></li><li><div>      'editor', &nbsp;</div></li><li><div>      'revisions'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * The plugin version of bbPress comes with two topic display options:</span>&nbsp;</div></li><li><div><span class="comment"> * - Traditional: Topics are included in the reply loop (default)</span>&nbsp;</div></li><li><div><span class="comment"> * - New Style: Topics appear as &quot;lead&quot; posts, ahead of replies</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2954)</span>&nbsp;</div></li><li><div><span class="comment"> * @param $show_lead Optional. Default false</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Yes if the topic appears as a lead, otherwise false</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_show_lead_topic( $show_lead = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Never separate the lead topic in feeds</span>&nbsp;</div></li><li><div>  if ( is_feed() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (bool) apply_filters( 'bbp_show_lead_topic', (bool) $show_lead );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic Loop ****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * The main topic loop. WordPress makes this easy for us</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args All the arguments supported by {@link WP_Query}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses current_user_can() To check if the current user can edit other's topics</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_post_type() To get the topic post type</span>&nbsp;</div></li><li><div><span class="comment"> * @uses WP_Query To make query and get the topics</span>&nbsp;</div></li><li><div><span class="comment"> * @uses is_page() To check if it's a page</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_is_single_forum() To check if it's a forum</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_forum_id() To get the forum id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_paged() To get the current page value</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_super_stickies() To get the super stickies</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_stickies() To get the forum stickies</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wpdb::get_results() To execute our query and get the results</span>&nbsp;</div></li><li><div><span class="comment"> * @uses WP_Rewrite::using_permalinks() To check if the blog is using permalinks</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_permalink() To get the permalink</span>&nbsp;</div></li><li><div><span class="comment"> * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_topics_pagination' with the pagination args</span>&nbsp;</div></li><li><div><span class="comment"> * @uses paginate_links() To paginate the links</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_has_topics' with</span>&nbsp;</div></li><li><div><span class="comment"> *                        bbPres::topic_query::have_posts()</span>&nbsp;</div></li><li><div><span class="comment"> *                        and bbPres::topic_query</span>&nbsp;</div></li><li><div><span class="comment"> * @return object Multidimensional array of topic information</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_has_topics( $args = '' ) {&nbsp;</div></li><li><div>  global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Defaults **************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Other defaults</span>&nbsp;</div></li><li><div>  $default_topic_search = !empty( $_REQUEST['ts'] ) ? $_REQUEST['ts'] : false;&nbsp;</div></li><li><div>  $default_show_stickies = (bool) ( bbp_is_single_forum() || bbp_is_topic_archive() ) && ( false === $default_topic_search );&nbsp;</div></li><li><div>  $default_post_parent = bbp_is_single_forum() ? bbp_get_forum_id() : 'any';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Default</span> argument array</span>&nbsp;</div></li><li><div>  $default = array(&nbsp;</div></li><li><div>      'post_type' =&gt; bbp_get_topic_post_type(), <span class="comment">// Narrow query down to bbPress topics</span>&nbsp;</div></li><li><div>      'post_parent' =&gt; $default_post_parent, <span class="comment">// Forum ID</span>&nbsp;</div></li><li><div>      'meta_key' =&gt; '_bbp_last_active_time', <span class="comment">// Make sure topic has some last activity time</span>&nbsp;</div></li><li><div>      'orderby' =&gt; 'meta_value', <span class="comment">// 'meta_value', 'author', 'date', 'title', 'modified', 'parent', rand', </span>&nbsp;</div></li><li><div>      'order' =&gt; 'DESC', <span class="comment">// 'ASC', 'DESC'</span>&nbsp;</div></li><li><div>      'posts_per_page' =&gt; bbp_get_topics_per_page(), <span class="comment">// Topics per page</span>&nbsp;</div></li><li><div>      'paged' =&gt; bbp_get_paged(), <span class="comment">// Page Number</span>&nbsp;</div></li><li><div>      's' =&gt; $default_topic_search, <span class="comment">// Topic Search</span>&nbsp;</div></li><li><div>      'show_stickies' =&gt; $default_show_stickies, <span class="comment">// Ignore sticky topics?</span>&nbsp;</div></li><li><div>      'max_num_pages' =&gt; false, <span class="comment">// Maximum number of pages to show</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// What are the default allowed statuses (based on user caps)</span></span>&nbsp;</div></li><li><div>  if ( bbp_get_view_all() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Default</span> view=all statuses</span>&nbsp;</div></li><li><div>      $post_statuses = array(&nbsp;</div></li><li><div>          bbp_get_public_status_id(), &nbsp;</div></li><li><div>          bbp_get_closed_status_id(), &nbsp;</div></li><li><div>          bbp_get_spam_status_id(), &nbsp;</div></li><li><div>          bbp_get_trash_status_id()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add support for private status</span>&nbsp;</div></li><li><div>      if ( current_user_can( 'read_private_topics' ) ) {&nbsp;</div></li><li><div>          $post_statuses[] = bbp_get_private_status_id();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Join post statuses together</span>&nbsp;</div></li><li><div>      $default['post_status'] = implode( ', ', $post_statuses );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Lean on the 'perm' query var value of 'readable' to provide statuses</span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $default['perm'] = 'readable';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Maybe query for topic tags</span>&nbsp;</div></li><li><div>  if ( bbp_is_topic_tag() ) {&nbsp;</div></li><li><div>      $default['term'] = bbp_get_topic_tag_slug();&nbsp;</div></li><li><div>      $default['taxonomy'] = bbp_get_topic_tag_tax_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Setup *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  $r = bbp_parse_args( $args, $default, 'has_topics' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get bbPress</span>&nbsp;</div></li><li><div>  $bbp = bbpress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Call the query</span>&nbsp;</div></li><li><div>  $bbp-&gt;topic_query = new WP_Query( $r );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set post_parent back to 0 if originally set to 'any'</span>&nbsp;</div></li><li><div>  if ( 'any' === $r['post_parent'] )&nbsp;</div></li><li><div>      $r['post_parent'] = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Limited the number of pages shown</span>&nbsp;</div></li><li><div>  if ( !empty( $r['max_num_pages'] ) )&nbsp;</div></li><li><div>      $bbp-&gt;topic_query-&gt;max_num_pages = $r['max_num_pages'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Stickies **************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Put sticky posts at the top of the posts array</span>&nbsp;</div></li><li><div>  if ( !empty( $r['show_stickies'] ) && $r['paged'] &lt;= 1 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get super stickies and stickies in this forum</span>&nbsp;</div></li><li><div>      $stickies = bbp_get_super_stickies();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get stickies for current forum</span>&nbsp;</div></li><li><div>      if ( !empty( $r['post_parent'] ) ) {&nbsp;</div></li><li><div>          $stickies = array_merge( $stickies, bbp_get_stickies( $r['post_parent'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Remove any duplicate stickies</span>&nbsp;</div></li><li><div>      $stickies = array_unique( $stickies );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// We have stickies</span>&nbsp;</div></li><li><div>      if ( is_array( $stickies ) && !empty( $stickies ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Start the offset at -1 so first sticky is at correct 0 offset</span>&nbsp;</div></li><li><div>          $sticky_offset = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Loop over topics and relocate stickies to the front.</span>&nbsp;</div></li><li><div>          foreach ( $stickies as $sticky_index =&gt; $sticky_ID ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Get the post offset from the posts array</span>&nbsp;</div></li><li><div>              $post_offsets = wp_filter_object_list( $bbp-&gt;topic_query-&gt;posts, array( 'ID' =&gt; $sticky_ID ), 'OR', 'ID' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Continue if no post offsets</span>&nbsp;</div></li><li><div>              if ( empty( $post_offsets ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Loop over posts in current query and splice them into position</span>&nbsp;</div></li><li><div>              foreach ( array_keys( $post_offsets ) as $post_offset ) {&nbsp;</div></li><li><div>                  $sticky_offset++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $sticky = $bbp-&gt;topic_query-&gt;posts[$post_offset];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Remove sticky from current position</span>&nbsp;</div></li><li><div>                  array_splice( $bbp-&gt;topic_query-&gt;posts, $post_offset, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Move to front, after other stickies</span>&nbsp;</div></li><li><div>                  array_splice( $bbp-&gt;topic_query-&gt;posts, $sticky_offset, 0, array( $sticky ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Cleanup</span></span></span></span></span>&nbsp;</div></li><li><div>                  unset( $stickies[$sticky_index] );&nbsp;</div></li><li><div>                  unset( $sticky );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Cleanup</span></span></span></span></span>&nbsp;</div></li><li><div>              unset( $post_offsets );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Cleanup</span></span></span></span></span>&nbsp;</div></li><li><div>          unset( $sticky_offset );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If any posts have been excluded specifically, Ignore those that are sticky.</span>&nbsp;</div></li><li><div>          if ( !empty( $stickies ) && !empty( $r['post__not_in'] ) ) {&nbsp;</div></li><li><div>              $stickies = array_diff( $stickies, $r['post__not_in'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Fetch sticky posts that weren't in the query results</span>&nbsp;</div></li><li><div>          if ( !empty( $stickies ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Query to use in get_posts to get sticky posts</span>&nbsp;</div></li><li><div>              $sticky_query = array(&nbsp;</div></li><li><div>                  'post_type' =&gt; bbp_get_topic_post_type(), &nbsp;</div></li><li><div>                  'post_parent' =&gt; 'any', &nbsp;</div></li><li><div>                  'meta_key' =&gt; '_bbp_last_active_time', &nbsp;</div></li><li><div>                  'orderby' =&gt; 'meta_value', &nbsp;</div></li><li><div>                  'order' =&gt; 'DESC', &nbsp;</div></li><li><div>                  'include' =&gt; $stickies&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Cleanup</span></span></span></span></span>&nbsp;</div></li><li><div>              unset( $stickies );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Conditionally exclude private/hidden forum ID's</span>&nbsp;</div></li><li><div>              $exclude_forum_ids = bbp_exclude_forum_ids( 'array' );&nbsp;</div></li><li><div>              if ( ! empty( $exclude_forum_ids ) ) {&nbsp;</div></li><li><div>                  $sticky_query['post_parent__not_in'] = $exclude_forum_ids;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// What are the default allowed statuses (based on user caps)</span></span>&nbsp;</div></li><li><div>              if ( bbp_get_view_all() ) {&nbsp;</div></li><li><div>                  $sticky_query['post_status'] = $r['post_status'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Lean on the 'perm' query var value of 'readable' to provide statuses</span></span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $sticky_query['post_status'] = $r['perm'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Get all stickies</span>&nbsp;</div></li><li><div>              $sticky_posts = get_posts( $sticky_query );&nbsp;</div></li><li><div>              if ( !empty( $sticky_posts ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Get a count of the visible stickies</span>&nbsp;</div></li><li><div>                  $sticky_count = count( $sticky_posts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Merge the stickies topics with the query topics .</span>&nbsp;</div></li><li><div>                  $bbp-&gt;topic_query-&gt;posts = array_merge( $sticky_posts, $bbp-&gt;topic_query-&gt;posts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Adjust loop and counts for new sticky positions</span>&nbsp;</div></li><li><div>                  $bbp-&gt;topic_query-&gt;found_posts = (int) $bbp-&gt;topic_query-&gt;found_posts + (int) $sticky_count;&nbsp;</div></li><li><div>                  $bbp-&gt;topic_query-&gt;post_count = (int) $bbp-&gt;topic_query-&gt;post_count  + (int) $sticky_count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Cleanup</span></span></span></span></span>&nbsp;</div></li><li><div>                  unset( $sticky_posts );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If no limit to posts per page, set it to the current post_count</span>&nbsp;</div></li><li><div>  if ( -1 === $r['posts_per_page'] )&nbsp;</div></li><li><div>      $r['posts_per_page'] = $bbp-&gt;topic_query-&gt;post_count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add pagination values to query object</span>&nbsp;</div></li><li><div>  $bbp-&gt;topic_query-&gt;posts_per_page = $r['posts_per_page'];&nbsp;</div></li><li><div>  $bbp-&gt;topic_query-&gt;paged = $r['paged'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only add pagination if query returned results</span>&nbsp;</div></li><li><div>  if ( ( (int) $bbp-&gt;topic_query-&gt;post_count || (int) $bbp-&gt;topic_query-&gt;found_posts ) && (int) $bbp-&gt;topic_query-&gt;posts_per_page ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Limit the number of topics shown based on maximum allowed pages</span>&nbsp;</div></li><li><div>      if ( ( !empty( $r['max_num_pages'] ) ) && $bbp-&gt;topic_query-&gt;found_posts &gt; $bbp-&gt;topic_query-&gt;max_num_pages * $bbp-&gt;topic_query-&gt;post_count )&nbsp;</div></li><li><div>          $bbp-&gt;topic_query-&gt;found_posts = $bbp-&gt;topic_query-&gt;max_num_pages * $bbp-&gt;topic_query-&gt;post_count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If pretty permalinks are enabled, make our pagination pretty</span></span>&nbsp;</div></li><li><div>      if ( $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// User's topics</span>&nbsp;</div></li><li><div>          if ( bbp_is_single_user_topics() ) {&nbsp;</div></li><li><div>              $base = bbp_get_user_topics_created_url( bbp_get_displayed_user_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// User's favorites</span>&nbsp;</div></li><li><div>          } elseif ( bbp_is_favorites() ) {&nbsp;</div></li><li><div>              $base = bbp_get_favorites_permalink( bbp_get_displayed_user_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// User's subscriptions</span>&nbsp;</div></li><li><div>          } elseif ( bbp_is_subscriptions() ) {&nbsp;</div></li><li><div>              $base = bbp_get_subscriptions_permalink( bbp_get_displayed_user_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Root profile page</span>&nbsp;</div></li><li><div>          } elseif ( bbp_is_single_user() ) {&nbsp;</div></li><li><div>              $base = bbp_get_user_profile_url( bbp_get_displayed_user_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// View</span>&nbsp;</div></li><li><div>          } elseif ( bbp_is_single_view() ) {&nbsp;</div></li><li><div>              $base = bbp_get_view_url();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Topic tag</span>&nbsp;</div></li><li><div>          } elseif ( bbp_is_topic_tag() ) {&nbsp;</div></li><li><div>              $base = bbp_get_topic_tag_link();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Page or single post</span>&nbsp;</div></li><li><div>          } elseif ( is_page() || is_single() ) {&nbsp;</div></li><li><div>              $base = get_permalink();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Forum archive</span>&nbsp;</div></li><li><div>          } elseif ( bbp_is_forum_archive() ) {&nbsp;</div></li><li><div>              $base = bbp_get_forums_url();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Topic archive</span>&nbsp;</div></li><li><div>          } elseif ( bbp_is_topic_archive() ) {&nbsp;</div></li><li><div>              $base = bbp_get_topics_url();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Default</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $base = get_permalink( (int) $r['post_parent'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Use pagination base</span>&nbsp;</div></li><li><div>          $base = trailingslashit( $base ) . user_trailingslashit( $wp_rewrite-&gt;pagination_base . '/%#%/' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Unpretty pagination</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $base = add_query_arg( 'paged', '%#%' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Pagination settings</span> with filter</span>&nbsp;</div></li><li><div>      $bbp_topic_pagination = apply_filters( 'bbp_topic_pagination', array (&nbsp;</div></li><li><div>          'base' =&gt; $base, &nbsp;</div></li><li><div>          'format' =&gt; '', &nbsp;</div></li><li><div>          'total' =&gt; $r['posts_per_page'] === $bbp-&gt;topic_query-&gt;found_posts ? 1 : ceil( (int) $bbp-&gt;topic_query-&gt;found_posts / (int) $r['posts_per_page'] ), &nbsp;</div></li><li><div>          'current' =&gt; (int) $bbp-&gt;topic_query-&gt;paged, &nbsp;</div></li><li><div>          'prev_text' =&gt; is_rtl() ? '&rarr;' : '&larr;', &nbsp;</div></li><li><div>          'next_text' =&gt; is_rtl() ? '&larr;' : '&rarr;', &nbsp;</div></li><li><div>          'mid_size' =&gt; 1&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Add pagination to query object</span></span>&nbsp;</div></li><li><div>      $bbp-&gt;topic_query-&gt;pagination_links = paginate_links( $bbp_topic_pagination );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Remove first page from pagination</span></span>&nbsp;</div></li><li><div>      $bbp-&gt;topic_query-&gt;pagination_links = str_replace( $wp_rewrite-&gt;pagination_base . &quot;/1/'&quot;, &quot;'&quot;, $bbp-&gt;topic_query-&gt;pagination_links );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return object</span>&nbsp;</div></li><li><div>  return apply_filters( 'bbp_has_topics', $bbp-&gt;topic_query-&gt;have_posts(), $bbp-&gt;topic_query );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether there are more topics available in the loop</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses WP_Query bbPress::topic_query::have_posts()</span>&nbsp;</div></li><li><div><span class="comment"> * @return object Topic information</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topics() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Put into variable to check against next</span>&nbsp;</div></li><li><div>  $have_posts = bbpress()-&gt;topic_query-&gt;have_posts();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Reset the post data when finished</span>&nbsp;</div></li><li><div>  if ( empty( $have_posts ) )&nbsp;</div></li><li><div>      wp_reset_postdata();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $have_posts;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Loads up the current topic in the loop</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses WP_Query bbPress::topic_query::the_post()</span>&nbsp;</div></li><li><div><span class="comment"> * @return object Topic information</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_the_topic() {&nbsp;</div></li><li><div>  return bbpress()-&gt;topic_query-&gt;the_post();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topic id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_id( $topic_id = 0) {&nbsp;</div></li><li><div>  echo bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the topic id</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $topic_id Optional. Used to check emptiness</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbPress::topic_query::post::ID To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic() To check if the search result is a topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_single_topic() To check if it's a topic page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_edit() To check if it's a topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_single_reply() To check if it it's a reply page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_reply_edit() To check if it's a reply edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_reply_topic_edit() To get the reply topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_field() To get the post's post type</span>&nbsp;</div></li><li><div><span class="comment">   * @uses WP_Query::post::ID To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_post_type() To get the topic post type</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_id' with the topic id and</span>&nbsp;</div></li><li><div><span class="comment">   *                        supplied topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int The topic id</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bbp = bbpress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Easy empty checking</span>&nbsp;</div></li><li><div>      if ( !empty( $topic_id ) && is_numeric( $topic_id ) ) {&nbsp;</div></li><li><div>          $bbp_topic_id = $topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Currently inside a topic loop</span>&nbsp;</div></li><li><div>      } elseif ( !empty( $bbp-&gt;topic_query-&gt;in_the_loop ) && isset( $bbp-&gt;topic_query-&gt;post-&gt;ID ) ) {&nbsp;</div></li><li><div>          $bbp_topic_id = $bbp-&gt;topic_query-&gt;post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Currently inside a search loop</span>&nbsp;</div></li><li><div>      } elseif ( !empty( $bbp-&gt;search_query-&gt;in_the_loop ) && isset( $bbp-&gt;search_query-&gt;post-&gt;ID ) && bbp_is_topic( $bbp-&gt;search_query-&gt;post-&gt;ID ) ) {&nbsp;</div></li><li><div>          $bbp_topic_id = $bbp-&gt;search_query-&gt;post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Currently viewing/editing a topic, likely alone</span>&nbsp;</div></li><li><div>      } elseif ( ( bbp_is_single_topic() || bbp_is_topic_edit() ) && !empty( $bbp-&gt;current_topic_id ) ) {&nbsp;</div></li><li><div>          $bbp_topic_id = $bbp-&gt;current_topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Currently viewing/editing a topic, likely in a loop</span>&nbsp;</div></li><li><div>      } elseif ( ( bbp_is_single_topic() || bbp_is_topic_edit() ) && isset( $wp_query-&gt;post-&gt;ID ) ) {&nbsp;</div></li><li><div>          $bbp_topic_id = $wp_query-&gt;post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Currently viewing/editing a reply</span>&nbsp;</div></li><li><div>      } elseif ( bbp_is_single_reply() || bbp_is_reply_edit() ) {&nbsp;</div></li><li><div>          $bbp_topic_id = bbp_get_reply_topic_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fallback</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $bbp_topic_id = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return (int) apply_filters( 'bbp_get_topic_id', (int) $bbp_topic_id, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2787)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|object $topic Topic id or topic object</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $output Optional. OBJECT, ARRAY_A, or ARRAY_N. Default = OBJECT</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filter Optional Sanitation filter. See {@link sanitize_post()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_post() To get the topic</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_get_topic' with the topic, output type and</span>&nbsp;</div></li><li><div><span class="comment"> *                        sanitation filter</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Null if error or topic (in specified form) if success</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic( $topic, $output = OBJECT, $filter = 'raw' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Use topic ID</span>&nbsp;</div></li><li><div>  if ( empty( $topic ) || is_numeric( $topic ) )&nbsp;</div></li><li><div>      $topic = bbp_get_topic_id( $topic );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Attempt to load the topic</span>&nbsp;</div></li><li><div>  $topic = get_post( $topic, OBJECT, $filter );&nbsp;</div></li><li><div>  if ( empty( $topic ) )&nbsp;</div></li><li><div>      return $topic;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if post_type is not a topic</span>&nbsp;</div></li><li><div>  if ( $topic-&gt;post_type !== bbp_get_topic_post_type() )&nbsp;</div></li><li><div>      return null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Tweak the data type to return</span>&nbsp;</div></li><li><div>  if ( $output === OBJECT ) {&nbsp;</div></li><li><div>      return $topic;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } elseif ( $output === ARRAY_A ) {&nbsp;</div></li><li><div>      $_topic = get_object_vars( $topic );&nbsp;</div></li><li><div>      return $_topic;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } elseif ( $output === ARRAY_N ) {&nbsp;</div></li><li><div>      $_topic = array_values( get_object_vars( $topic ) );&nbsp;</div></li><li><div>      return $_topic;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bbp_get_topic', $topic, $output, $filter );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the link to the topic in the topic loop</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param $string $redirect_to Optional. Pass a redirect value for use with</span>&nbsp;</div></li><li><div><span class="comment"> *                              shortcodes and other fun things.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_permalink() To get the topic permalink</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_permalink( $topic_id = 0, $redirect_to = '' ) {&nbsp;</div></li><li><div>  echo esc_url( bbp_get_topic_permalink( $topic_id, $redirect_to ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the link to the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param $string $redirect_to Optional. Pass a redirect value for use with</span>&nbsp;</div></li><li><div><span class="comment">   *                              shortcodes and other fun things.</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_permalink() To get the topic permalink</span>&nbsp;</div></li><li><div><span class="comment">   * @uses esc_url_raw() To clean the redirect_to url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_permalink' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Permanent link to topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_permalink( $topic_id = 0, $redirect_to = '' ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Use the redirect address</span>&nbsp;</div></li><li><div>      if ( !empty( $redirect_to ) ) {&nbsp;</div></li><li><div>          $topic_permalink = esc_url_raw( $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Use the topic permalink</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_permalink = get_permalink( $topic_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_permalink', $topic_permalink, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the title of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_title() To get the topic title</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_title( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_title( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the title of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_the_title() To get the title</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_title' with the title and</span>&nbsp;</div></li><li><div><span class="comment">   *                        topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Title of topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_title( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $title = get_the_title( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_title', $title, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topic archive title</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3249)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $title Default text to use as title</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_archive_title( $title = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_archive_title( $title );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the topic archive title</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3249)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title Default text to use as title</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_page_by_path() Check if page exists at root path</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_the_title() Use the page title at the root path</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_type_object() Load the post type object</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_post_type() Get the topic post type ID</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_type_labels() Get labels for topic post type</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Allow output to be manipulated</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The topic archive title</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_archive_title( $title = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If no title was passed</span>&nbsp;</div></li><li><div>      if ( empty( $title ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set root text to page title</span>&nbsp;</div></li><li><div>          $page = bbp_get_page_by_path( bbp_get_topic_archive_slug() );&nbsp;</div></li><li><div>          if ( !empty( $page ) ) {&nbsp;</div></li><li><div>              $title = get_the_title( $page-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Default</span> to topic post type name label&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $tto = get_post_type_object( bbp_get_topic_post_type() );&nbsp;</div></li><li><div>              $title = $tto-&gt;labels-&gt;name;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_archive_title', $title );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the content of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2780)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_content() To get the topic content</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_content( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_content( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the content of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2780)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses post_password_required() To check if the topic requires pass</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_the_password_form() To get the password form</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_field() To get the content post field</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_content' with the content</span>&nbsp;</div></li><li><div><span class="comment">   *                        and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Content of the topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_content( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check if password is required</span>&nbsp;</div></li><li><div>      if ( post_password_required( $topic_id ) )&nbsp;</div></li><li><div>          return get_the_password_form();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $content = get_post_field( 'post_content', $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_content', $content, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the excerpt of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2780)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $length Optional. Length of the excerpt. Defaults to 100 letters</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_excerpt() To get the topic excerpt</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_excerpt( $topic_id = 0, $length = 100 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_excerpt( $topic_id, $length );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the excerpt of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2780)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $length Optional. Length of the excerpt. Defaults to 100</span>&nbsp;</div></li><li><div><span class="comment">   *                     letters</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_field() To get the excerpt</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_content() To get the topic content</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_excerpt' with the excerpt, </span>&nbsp;</div></li><li><div><span class="comment">   *                        topic id and length</span>&nbsp;</div></li><li><div><span class="comment">   * @return string topic Excerpt</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_excerpt( $topic_id = 0, $length = 100 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $length = (int) $length;&nbsp;</div></li><li><div>      $excerpt = get_post_field( 'post_excerpt', $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $excerpt ) ) {&nbsp;</div></li><li><div>          $excerpt = bbp_get_topic_content( $topic_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $excerpt = trim( strip_tags( $excerpt ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Multibyte support</span>&nbsp;</div></li><li><div>      if ( function_exists( 'mb_strlen' ) ) {&nbsp;</div></li><li><div>          $excerpt_length = mb_strlen( $excerpt );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $excerpt_length = strlen( $excerpt );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $length ) && ( $excerpt_length &gt; $length ) ) {&nbsp;</div></li><li><div>          $excerpt = substr( $excerpt, 0, $length - 1 );&nbsp;</div></li><li><div>          $excerpt .= '&hellip;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_excerpt', $excerpt, $topic_id, $length );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the post date and time of a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r4155)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $humanize Optional. Humanize output using time_since</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $gmt Optional. Use GMT</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_post_date() to get the output</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_post_date( $topic_id = 0, $humanize = false, $gmt = false ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_post_date( $topic_id, $humanize, $gmt );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the post date and time of a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r4155)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $humanize Optional. Humanize output using time_since</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $gmt Optional. Use GMT</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_time() to get the topic post time</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_time_since() to maybe humanize the topic post time</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_post_date( $topic_id = 0, $humanize = false, $gmt = false ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// 4 days, 4 hours ago</span>&nbsp;</div></li><li><div>      if ( !empty( $humanize ) ) {&nbsp;</div></li><li><div>          $gmt_s = !empty( $gmt ) ? 'U' : 'G';&nbsp;</div></li><li><div>          $date = get_post_time( $gmt_s, $gmt, $topic_id );&nbsp;</div></li><li><div>          $time = false; <span class="comment">// For filter below</span>&nbsp;</div></li><li><div>          $result = bbp_get_time_since( $date );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// August 4, 2012 at 2:37 pm</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $date = get_post_time( get_option( 'date_format' ), $gmt, $topic_id, true );&nbsp;</div></li><li><div>          $time = get_post_time( get_option( 'time_format' ), $gmt, $topic_id, true );&nbsp;</div></li><li><div>          $result = sprintf( _x( '%1$s at %2$s', 'date at time', 'bbpress' ), $date, $time );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_post_date', $result, $topic_id, $humanize, $gmt, $date, $time );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output pagination links of a topic within the topic loop</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2966)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args See {@link bbp_get_topic_pagination()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_pagination() To get the topic pagination links</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_pagination( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_pagination( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns pagination links of a topic within the topic loop</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2966)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment">   *  - topic_id: Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - before: Before the links</span>&nbsp;</div></li><li><div><span class="comment">   *  - after: After the links</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses WP_Rewrite::using_permalinks() To check if the blog is using</span>&nbsp;</div></li><li><div><span class="comment">   *                                       permalinks</span>&nbsp;</div></li><li><div><span class="comment">   * @uses user_trailingslashit() To add a trailing slash</span>&nbsp;</div></li><li><div><span class="comment">   * @uses trailingslashit() To add a trailing slash</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_permalink() To get the permalink of the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add query args</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_reply_count() To get topic reply count</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_show_topic_lead() Are we showing the topic as a lead?</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_option() To get replies per page option</span>&nbsp;</div></li><li><div><span class="comment">   * @uses paginate_links() To paginate the links</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_pagination' with the links</span>&nbsp;</div></li><li><div><span class="comment">   *                        and arguments</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Pagination links</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_pagination( $args = '' ) {&nbsp;</div></li><li><div>      global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Bail if threading replies</span>&nbsp;</div></li><li><div>      if ( bbp_thread_replies() ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'topic_id' =&gt; bbp_get_topic_id(), &nbsp;</div></li><li><div>          'before' =&gt; '&lt;span class=&quot;bbp-topic-pagination&quot;&gt;', &nbsp;</div></li><li><div>          'after' =&gt; '&lt;/span&gt;', &nbsp;</div></li><li><div> ), 'get_topic_pagination' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If pretty permalinks are enabled, make our pagination pretty</span></span>&nbsp;</div></li><li><div>      if ( $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>          $base = trailingslashit( get_permalink( $r['topic_id'] ) ) . user_trailingslashit( $wp_rewrite-&gt;pagination_base . '/%#%/' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $base = add_query_arg( 'paged', '%#%', get_permalink( $r['topic_id'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get total and add 1 if topic is included in the reply loop</span>&nbsp;</div></li><li><div>      $total = bbp_get_topic_reply_count( $r['topic_id'], true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Bump if topic is in loop</span>&nbsp;</div></li><li><div>      if ( !bbp_show_lead_topic() )&nbsp;</div></li><li><div>          $total++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Pagination settings</span>&nbsp;</div></li><li><div>      $pagination = array(&nbsp;</div></li><li><div>          'base' =&gt; $base, &nbsp;</div></li><li><div>          'format' =&gt; '', &nbsp;</div></li><li><div>          'total' =&gt; ceil( (int) $total / (int) bbp_get_replies_per_page() ), &nbsp;</div></li><li><div>          'current' =&gt; 0, &nbsp;</div></li><li><div>          'prev_next' =&gt; false, &nbsp;</div></li><li><div>          'mid_size' =&gt; 2, &nbsp;</div></li><li><div>          'end_size' =&gt; 3, &nbsp;</div></li><li><div>          'add_args' =&gt; ( bbp_get_view_all() ) ? array( 'view' =&gt; 'all' ) : false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Add pagination to query object</span></span>&nbsp;</div></li><li><div>      $pagination_links = paginate_links( $pagination );&nbsp;</div></li><li><div>      if ( !empty( $pagination_links ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Remove first page from pagination</span></span>&nbsp;</div></li><li><div>          if ( $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>              $pagination_links = str_replace( $wp_rewrite-&gt;pagination_base . '/1/', '', $pagination_links );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $pagination_links = str_replace( '&#038;paged=1', '', $pagination_links );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Add before and after to pagination links</span>&nbsp;</div></li><li><div>          $pagination_links = $r['before'] . $pagination_links . $r['after'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_pagination', $pagination_links, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Append revisions to the topic content</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2782)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Optional. Content to which we need to append the revisions to</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_revision_log() To get the topic revision log</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_topic_append_revisions' with the processed</span>&nbsp;</div></li><li><div><span class="comment"> *                        content, original content and topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Content with the revisions appended</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_content_append_revisions( $content = '', $topic_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if in admin or feed</span>&nbsp;</div></li><li><div>  if ( is_admin() || is_feed() )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Validate the ID</span>&nbsp;</div></li><li><div>  $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bbp_topic_append_revisions', $content . bbp_get_topic_revision_log( $topic_id ), $content, $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the revision log of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2782)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_revision_log() To get the topic revision log</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_revision_log( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_revision_log( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the formatted revision log of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2782)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_revisions() To get the topic revisions</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_raw_revision_log() To get the raw revision log</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_display_name() To get the topic author</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_author_link() To get the topic author link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_convert_date() To convert the date</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_time_since() To get the time in since format</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_revision_log' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        log and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Revision log of the topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_revision_log( $topic_id = 0 ) {&nbsp;</div></li><li><div>      <span class="comment">// Create necessary variables</span>&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $revision_log = bbp_get_topic_raw_revision_log( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $topic_id ) || empty( $revision_log ) || !is_array( $revision_log ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $revisions = bbp_get_topic_revisions( $topic_id );&nbsp;</div></li><li><div>      if ( empty( $revisions ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $r = &quot;\n\n&quot; . '&lt;ul id=&quot;bbp-topic-revision-log-' . esc_attr( $topic_id ) . '&quot; class=&quot;bbp-topic-revision-log&quot;&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Loop through revisions</span>&nbsp;</div></li><li><div>      foreach ( (array) $revisions as $revision ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $revision_log[$revision-&gt;ID] ) ) {&nbsp;</div></li><li><div>              $author_id = $revision-&gt;post_author;&nbsp;</div></li><li><div>              $reason = '';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $author_id = $revision_log[$revision-&gt;ID]['author'];&nbsp;</div></li><li><div>              $reason = $revision_log[$revision-&gt;ID]['reason'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $author = bbp_get_author_link( array( 'size' =&gt; 14, 'link_text' =&gt; bbp_get_topic_author_display_name( $revision-&gt;ID ), 'post_id' =&gt; $revision-&gt;ID ) );&nbsp;</div></li><li><div>          $since = bbp_get_time_since( bbp_convert_date( $revision-&gt;post_modified ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $r .= &quot;\t&quot; . '&lt;li id=&quot;bbp-topic-revision-log-' . esc_attr( $topic_id ) . '-item-' . esc_attr( $revision-&gt;ID ) . '&quot; class=&quot;bbp-topic-revision-log-item&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          if ( !empty( $reason ) ) {&nbsp;</div></li><li><div>              $r .= &quot;\t\t&quot; . sprintf( __( 'This topic was modified %1$s by %2$s. Reason: %3$s', 'bbpress' ), esc_html( $since ), $author, esc_html( $reason ) ) . &quot;\n&quot;;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $r .= &quot;\t\t&quot; . sprintf( __( 'This topic was modified %1$s by %2$s.', 'bbpress' ), esc_html( $since ), $author ) . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $r .= &quot;\t&quot; . '&lt;/li&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $r .= &quot;\n&quot; . '&lt;/ul&gt;' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_revision_log', $r, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Return the raw revision log of the topic</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since bbPress (r2782)</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">       * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">       * @uses get_post_meta() To get the revision log meta</span>&nbsp;</div></li><li><div><span class="comment">       * @uses apply_filters() Calls 'bbp_get_topic_raw_revision_log'</span>&nbsp;</div></li><li><div><span class="comment">       *                        with the log and topic id</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Raw revision log of the topic</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function bbp_get_topic_raw_revision_log( $topic_id = 0 ) {&nbsp;</div></li><li><div>          $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $revision_log = get_post_meta( $topic_id, '_bbp_revision_log', true );&nbsp;</div></li><li><div>          $revision_log = empty( $revision_log ) ? array() : $revision_log;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( 'bbp_get_topic_raw_revision_log', $revision_log, $topic_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return the revisions of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2782)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_get_post_revisions() To get the topic revisions</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_get_topic_revisions'</span>&nbsp;</div></li><li><div><span class="comment"> *                        with the revisions and topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Topic revisions</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic_revisions( $topic_id = 0 ) {&nbsp;</div></li><li><div>  $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>  $revisions = wp_get_post_revisions( $topic_id, array( 'order' =&gt; 'ASC' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bbp_get_topic_revisions', $revisions, $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return the revision count of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2782)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_revisions() To get the topic revisions</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_get_topic_revision_count'</span>&nbsp;</div></li><li><div><span class="comment"> *                        with the revision count and topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Topic revision count</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic_revision_count( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>  $count = (int) count( bbp_get_topic_revisions( $topic_id ) );&nbsp;</div></li><li><div>  $filter = ( true === $integer ) ? 'bbp_get_topic_revision_count_int' : 'bbp_get_topic_revision_count';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( $filter, $count, $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the status of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2667)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_status( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_status( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the status of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2667)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_status' with the status</span>&nbsp;</div></li><li><div><span class="comment">   *                        and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Status of topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_status( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_status', get_post_status( $topic_id ), $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the topic open to new replies?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_status()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_is_topic_closed() To check if the topic is closed</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if open, false if closed.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_is_topic_open( $topic_id = 0 ) {&nbsp;</div></li><li><div>  return !bbp_is_topic_closed( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the topic closed to new replies?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2746)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_is_topic_closed' with the topic id</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True if closed, false if not.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_is_topic_closed( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $closed = bbp_get_topic_status( $topic_id ) === bbp_get_closed_status_id();&nbsp;</div></li><li><div>      return (bool) apply_filters( 'bbp_is_topic_closed', (bool) $closed, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the topic a sticky or super sticky?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2754)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $check_super Optional. If set to true and if the topic is not a</span>&nbsp;</div></li><li><div><span class="comment"> *                           normal sticky, it is checked if it is a super</span>&nbsp;</div></li><li><div><span class="comment"> *                           sticky or not. Defaults to true.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_forum_id() To get the topic forum id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_stickies() To get the stickies</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_is_topic_super_sticky() To check if the topic is a super sticky</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if sticky or super sticky, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_is_topic_sticky( $topic_id = 0, $check_super = true ) {&nbsp;</div></li><li><div>  $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>  $forum_id = bbp_get_topic_forum_id( $topic_id );&nbsp;</div></li><li><div>  $stickies = bbp_get_stickies( $forum_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( in_array( $topic_id, $stickies ) || ( !empty( $check_super ) && bbp_is_topic_super_sticky( $topic_id ) ) )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the topic a super sticky?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2754)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_super_stickies() To get the super stickies</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if super sticky, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_is_topic_super_sticky( $topic_id = 0 ) {&nbsp;</div></li><li><div>  $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>  $stickies = bbp_get_super_stickies( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return in_array( $topic_id, $stickies );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the topic not spam or deleted?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3496)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_is_topic_published' with the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if published, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_is_topic_published( $topic_id = 0 ) {&nbsp;</div></li><li><div>  $topic_status = bbp_get_topic_status( bbp_get_topic_id( $topic_id ) ) === bbp_get_public_status_id();&nbsp;</div></li><li><div>  return (bool) apply_filters( 'bbp_is_topic_published', (bool) $topic_status, $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the topic marked as spam?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_is_topic_spam' with the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if spam, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_is_topic_spam( $topic_id = 0 ) {&nbsp;</div></li><li><div>  $topic_status = bbp_get_topic_status( bbp_get_topic_id( $topic_id ) ) === bbp_get_spam_status_id();&nbsp;</div></li><li><div>  return (bool) apply_filters( 'bbp_is_topic_spam', (bool) $topic_status, $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the topic trashed?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2888)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_is_topic_trash' with the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if trashed, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_is_topic_trash( $topic_id = 0 ) {&nbsp;</div></li><li><div>  $topic_status = bbp_get_topic_status( bbp_get_topic_id( $topic_id ) ) === bbp_get_trash_status_id();&nbsp;</div></li><li><div>  return (bool) apply_filters( 'bbp_is_topic_trash', (bool) $topic_status, $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the posted by an anonymous user?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2753)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses get_post_meta() To get the anonymous user name and email meta</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_is_topic_anonymous' with the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if the post is by an anonymous user, false if not.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_is_topic_anonymous( $topic_id = 0 ) {&nbsp;</div></li><li><div>  $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>  $retval = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bbp_get_topic_author_id( $topic_id ) )&nbsp;</div></li><li><div>      $retval = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  elseif ( get_post_meta( $topic_id, '_bbp_anonymous_name', true ) )&nbsp;</div></li><li><div>      $retval = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  elseif ( get_post_meta( $topic_id, '_bbp_anonymous_email', true ) )&nbsp;</div></li><li><div>      $retval = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The topic is by an anonymous user</span>&nbsp;</div></li><li><div>  return (bool) apply_filters( 'bbp_is_topic_anonymous', $retval, $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Deprecated. Use bbp_topic_author_display_name() instead.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Output the author of the topic.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated bbPress (r5119)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author() To get the topic author</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_author( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Deprecated. Use bbp_get_topic_author_display_name() instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Return the author of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated bbPress (r5119)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_anonymous() To check if the topic is by an</span>&nbsp;</div></li><li><div><span class="comment">   *                                 anonymous user</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_the_author_meta() To get the display name of the author</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the name of the anonymous poster</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_author' with the author</span>&nbsp;</div></li><li><div><span class="comment">   *                        and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Author of topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !bbp_is_topic_anonymous( $topic_id ) ) {&nbsp;</div></li><li><div>          $author = get_the_author_meta( 'display_name', bbp_get_topic_author_id( $topic_id ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $author = get_post_meta( $topic_id, '_bbp_anonymous_name', true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_author', $author, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the author ID of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_author_id( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the author ID of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_field() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_author_id' with the author</span>&nbsp;</div></li><li><div><span class="comment">   *                        id and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Author of topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $author_id = get_post_field( 'post_author', $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return (int) apply_filters( 'bbp_get_topic_author_id', (int) $author_id, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the author display_name of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_display_name() To get the topic author's display</span>&nbsp;</div></li><li><div><span class="comment"> *                                            name</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author_display_name( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_author_display_name( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the author display_name of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_anonymous() To check if the topic is by an</span>&nbsp;</div></li><li><div><span class="comment">   *                                 anonymous user</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_the_author_meta() To get the author meta</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the anonymous user name</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_author_id' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        display name and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic's author's display name</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author_display_name( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check for anonymous user</span>&nbsp;</div></li><li><div>      if ( !bbp_is_topic_anonymous( $topic_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get the author ID</span>&nbsp;</div></li><li><div>          $author_id = bbp_get_topic_author_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Try to get a display name</span>&nbsp;</div></li><li><div>          $author_name = get_the_author_meta( 'display_name', $author_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Fall back to user login</span>&nbsp;</div></li><li><div>          if ( empty( $author_name ) ) {&nbsp;</div></li><li><div>              $author_name = get_the_author_meta( 'user_login', $author_id );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// User does not have an account</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $author_name = get_post_meta( $topic_id, '_bbp_anonymous_name', true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If nothing could be found anywhere, use Anonymous</span>&nbsp;</div></li><li><div>      if ( empty( $author_name ) )&nbsp;</div></li><li><div>          $author_name = __( 'Anonymous', 'bbpress' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Encode possible UTF8 display names</span>&nbsp;</div></li><li><div>      if ( seems_utf8( $author_name ) === false )&nbsp;</div></li><li><div>          $author_name = utf8_encode( $author_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_author_display_name', $author_name, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the author avatar of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $size Optional. Avatar size. Defaults to 40</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_avatar() To get the topic author avatar</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author_avatar( $topic_id = 0, $size = 40 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_author_avatar( $topic_id, $size );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the author avatar of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $size Optional. Avatar size. Defaults to 40</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_anonymous() To check if the topic is by an</span>&nbsp;</div></li><li><div><span class="comment">   *                                 anonymous user</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the anonymous user's email</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_avatar() To get the avatar</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_author_avatar' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        avatar, topic id and size</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Avatar of the author of the topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author_avatar( $topic_id = 0, $size = 40 ) {&nbsp;</div></li><li><div>      $author_avatar = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      if ( !empty( $topic_id ) ) {&nbsp;</div></li><li><div>          if ( !bbp_is_topic_anonymous( $topic_id ) ) {&nbsp;</div></li><li><div>              $author_avatar = get_avatar( bbp_get_topic_author_id( $topic_id ), $size );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $author_avatar = get_avatar( get_post_meta( $topic_id, '_bbp_anonymous_email', true ), $size );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_author_avatar', $author_avatar, $topic_id, $size );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the author link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2717)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed|int $args If it is an integer, it is used as topic_id. Optional.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_link() To get the topic author link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_author_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the author link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2717)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed|int $args If it is an integer, it is used as topic id.</span>&nbsp;</div></li><li><div><span class="comment">   *                         Optional.</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_display_name() To get the topic author</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_anonymous() To check if the topic is by an</span>&nbsp;</div></li><li><div><span class="comment">   *                                 anonymous user</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_url() To get the topic author url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_avatar() To get the topic author avatar</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_display_name() To get the topic author display</span>&nbsp;</div></li><li><div><span class="comment">   *                                      name</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_user_display_role() To get the topic author display role</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_author_link' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Author link of topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author_link( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'post_id' =&gt; 0, &nbsp;</div></li><li><div>          'link_title' =&gt; '', &nbsp;</div></li><li><div>          'type' =&gt; 'both', &nbsp;</div></li><li><div>          'size' =&gt; 80, &nbsp;</div></li><li><div>          'sep' =&gt; '&nbsp;', &nbsp;</div></li><li><div>          'show_role' =&gt; false&nbsp;</div></li><li><div> ), 'get_topic_author_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Used as topic_id</span>&nbsp;</div></li><li><div>      if ( is_numeric( $args ) ) {&nbsp;</div></li><li><div>          $topic_id = bbp_get_topic_id( $args );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_id = bbp_get_topic_id( $r['post_id'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Topic ID is good</span>&nbsp;</div></li><li><div>      if ( !empty( $topic_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get some useful topic information</span>&nbsp;</div></li><li><div>          $author_url = bbp_get_topic_author_url( $topic_id );&nbsp;</div></li><li><div>          $anonymous = bbp_is_topic_anonymous( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Tweak link title if empty</span>&nbsp;</div></li><li><div>          if ( empty( $r['link_title'] ) ) {&nbsp;</div></li><li><div>              $link_title = sprintf( empty( $anonymous ) ? __( 'View %s\'s profile', 'bbpress' ) : __( 'Visit %s\'s website', 'bbpress' ), bbp_get_topic_author_display_name( $topic_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Use what was passed if not</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $link_title = $r['link_title'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Setup title and author_links array</span>&nbsp;</div></li><li><div>          $link_title = !empty( $link_title ) ? ' title=&quot;' . esc_attr( $link_title ) . '&quot;' : '';&nbsp;</div></li><li><div>          $author_links = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get avatar</span>&nbsp;</div></li><li><div>          if ( 'avatar' === $r['type'] || 'both' === $r['type'] ) {&nbsp;</div></li><li><div>              $author_links['avatar'] = bbp_get_topic_author_avatar( $topic_id, $r['size'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get display name</span>&nbsp;</div></li><li><div>          if ( 'name' === $r['type'] || 'both' === $r['type'] ) {&nbsp;</div></li><li><div>              $author_links['name'] = bbp_get_topic_author_display_name( $topic_id );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Link</span> class</span>&nbsp;</div></li><li><div>          $link_class = ' class=&quot;bbp-author-' . esc_attr( $r['type'] ) . '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Add links if not anonymous</span>&nbsp;</div></li><li><div>          if ( empty( $anonymous ) && bbp_user_has_profile( bbp_get_topic_author_id( $topic_id ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Assemble the links</span>&nbsp;</div></li><li><div>              foreach ( $author_links as $link =&gt; $link_text ) {&nbsp;</div></li><li><div>                  $link_class = ' class=&quot;bbp-author-' . esc_attr( $link ) . '&quot;';&nbsp;</div></li><li><div>                  $author_link[] = sprintf( '&lt;a href=&quot;%1$s&quot;%2$s%3$s&gt;%4$s&lt;/a&gt;', esc_url( $author_url ), $link_title, $link_class, $link_text );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( true === $r['show_role'] ) {&nbsp;</div></li><li><div>                  $author_link[] = bbp_get_topic_author_role( array( 'topic_id' =&gt; $topic_id ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $author_link = implode( $r['sep'], $author_link );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No link</span></span></span></span></span>s if anonymous</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $author_link = implode( $r['sep'], $author_links );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $author_link = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_author_link', $author_link, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the author url of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_url() To get the topic author url</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author_url( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo esc_url( bbp_get_topic_author_url( $topic_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the author url of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2590)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_anonymous() To check if the topic is by an anonymous</span>&nbsp;</div></li><li><div><span class="comment">   *                                 user or not</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_user_has_profile() To check if the user has a profile</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_id() To get topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_user_profile_url() To get profile url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get anonmous user's website</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_author_url' with the link &</span>&nbsp;</div></li><li><div><span class="comment">   *                        topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Author URL of topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author_url( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check for anonymous user</span> or non-existant user&nbsp;</div></li><li><div>      if ( !bbp_is_topic_anonymous( $topic_id ) && bbp_user_has_profile( bbp_get_topic_author_id( $topic_id ) ) ) {&nbsp;</div></li><li><div>          $author_url = bbp_get_user_profile_url( bbp_get_topic_author_id( $topic_id ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $author_url = get_post_meta( $topic_id, '_bbp_anonymous_website', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set empty author_url as empty string</span>&nbsp;</div></li><li><div>          if ( empty( $author_url ) ) {&nbsp;</div></li><li><div>              $author_url = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_author_url', $author_url, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topic author email address</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3445)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Reply id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_email() To get the topic author email</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author_email( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_author_email( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the topic author email address</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3445)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Reply id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_anonymous() To check if the topic is by an anonymous</span>&nbsp;</div></li><li><div><span class="comment">   *                                 user</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_userdata() To get the user data</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the anonymous poster's email</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls bbp_get_topic_author_email with the author</span>&nbsp;</div></li><li><div><span class="comment">   *                        email & topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic author email address</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author_email( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Not anonymous user</span>&nbsp;</div></li><li><div>      if ( !bbp_is_topic_anonymous( $topic_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Use topic author email address</span>&nbsp;</div></li><li><div>          $user_id = bbp_get_topic_author_id( $topic_id );&nbsp;</div></li><li><div>          $user = get_userdata( $user_id );&nbsp;</div></li><li><div>          $author_email = !empty( $user-&gt;user_email ) ? $user-&gt;user_email : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Anonymous</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get email from post meta</span>&nbsp;</div></li><li><div>          $author_email = get_post_meta( $topic_id, '_bbp_anonymous_email', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Sanity check for missing email address</span>&nbsp;</div></li><li><div>          if ( empty( $author_email ) ) {&nbsp;</div></li><li><div>              $author_email = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_author_email', $author_email, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topic author role</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3860)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args Optional.</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_author_role() To get the topic author role</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_author_role( $args = array() ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_author_role( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the topic author role</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3860)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args Optional.</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_user_display_role() To get the user display role</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_author_id() To get the topic author id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls bbp_get_topic_author_role with the author</span>&nbsp;</div></li><li><div><span class="comment">   *                        role & args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string topic author role</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_author_role( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'topic_id' =&gt; 0, &nbsp;</div></li><li><div>          'class' =&gt; 'bbp-author-role', &nbsp;</div></li><li><div>          'before' =&gt; '', &nbsp;</div></li><li><div>          'after' =&gt; ''&nbsp;</div></li><li><div> ), 'get_topic_author_role' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $r['topic_id'] );&nbsp;</div></li><li><div>      $role = bbp_get_user_display_role( bbp_get_topic_author_id( $topic_id ) );&nbsp;</div></li><li><div>      $author_role = sprintf( '%1$s&lt;div class=&quot;%2$s&quot;&gt;%3$s&lt;/div&gt;%4$s', $r['before'], $r['class'], $role, $r['after'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_author_role', $author_role, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the title of the forum a topic belongs to</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_forum_title() To get the topic's forum title</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_forum_title( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_forum_title( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the title of the forum a topic belongs to</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_forum_id() To get topic's forum id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_forum' with the forum</span>&nbsp;</div></li><li><div><span class="comment">   *                        title and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic forum title</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_forum_title( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $forum_id = bbp_get_topic_forum_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_forum', bbp_get_forum_title( $forum_id ), $topic_id, $forum_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the forum id a topic belongs to</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2491)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_forum_id()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_forum_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_forum_id( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the forum id a topic belongs to</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2491)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To retrieve get topic's forum id meta</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_forum_id' with the forum</span>&nbsp;</div></li><li><div><span class="comment">   *                        id and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Topic forum id</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_forum_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $forum_id = get_post_meta( $topic_id, '_bbp_forum_id', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return (int) apply_filters( 'bbp_get_topic_forum_id', (int) $forum_id, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topics last active ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2860)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Forum id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_last_active_id() To get the topic's last active id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_last_active_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_last_active_id( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the topics last active ID</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2860)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Forum id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the topic's last active id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_last_active_id' with</span>&nbsp;</div></li><li><div><span class="comment">   *                        the last active id and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Forum's last active id</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_last_active_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $active_id = get_post_meta( $topic_id, '_bbp_last_active_id', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return (int) apply_filters( 'bbp_get_topic_last_active_id', (int) $active_id, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topics last update date/time (aka freshness)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2625)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_last_active_time() To get topic freshness</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_last_active_time( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_last_active_time( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the topics last update date/time (aka freshness)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2625)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the topic lst active meta</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_reply_id() To get topic last reply id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_field() To get the post date of topic/reply</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_convert_date() To convert date</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_time_since() To get time in since format</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_last_active' with topic</span>&nbsp;</div></li><li><div><span class="comment">   *                        freshness and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic freshness</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_last_active_time( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Try to get the most accurate freshness time possible</span>&nbsp;</div></li><li><div>      $last_active = get_post_meta( $topic_id, '_bbp_last_active_time', true );&nbsp;</div></li><li><div>      if ( empty( $last_active ) ) {&nbsp;</div></li><li><div>          $reply_id = bbp_get_topic_last_reply_id( $topic_id );&nbsp;</div></li><li><div>          if ( !empty( $reply_id ) ) {&nbsp;</div></li><li><div>              $last_active = get_post_field( 'post_date', $reply_id );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $last_active = get_post_field( 'post_date', $topic_id );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $last_active = !empty( $last_active ) ? bbp_get_time_since( bbp_convert_date( $last_active ) ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Return the time since</span>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_last_active', $last_active, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic Subscriptions *******************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topic subscription link</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5156)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_subscription_link()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_subscription_link( $args = array() ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_subscription_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the forum subscription link</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * A custom wrapper for bbp_get_user_subscribe_link()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r5156)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_parse_args()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_user_subscribe_link()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_subscribe_link'</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_subscription_link( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No link</span></span></span></span></span>&nbsp;</div></li><li><div>      $retval = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Parse the arguments</span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'user_id' =&gt; 0, &nbsp;</div></li><li><div>          'topic_id' =&gt; 0, &nbsp;</div></li><li><div>          'before' =&gt; '&nbsp;|&nbsp;', &nbsp;</div></li><li><div>          'after' =&gt; '', &nbsp;</div></li><li><div>          'subscribe' =&gt; __( 'Subscribe', 'bbpress' ), &nbsp;</div></li><li><div>          'unsubscribe' =&gt; __( 'Unsubscribe', 'bbpress' )&nbsp;</div></li><li><div> ), 'get_forum_subscribe_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Get the link</span></span>&nbsp;</div></li><li><div>      $retval = bbp_get_user_subscribe_link( $r );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_subscribe_link', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic Favorites ***********************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the topic favorite link</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5156)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_favorite_link()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_favorite_link( $args = array() ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_favorite_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the forum favorite link</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * A custom wrapper for bbp_get_user_favorite_link()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r5156)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_parse_args()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_user_favorites_link()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_favorite_link'</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_favorite_link( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No link</span></span></span></span></span>&nbsp;</div></li><li><div>      $retval = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Parse the arguments</span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'user_id' =&gt; 0, &nbsp;</div></li><li><div>          'topic_id' =&gt; 0, &nbsp;</div></li><li><div>          'before' =&gt; '', &nbsp;</div></li><li><div>          'after' =&gt; '', &nbsp;</div></li><li><div>          'favorite' =&gt; __( 'Favorite', 'bbpress' ), &nbsp;</div></li><li><div>          'favorited' =&gt; __( 'Unfavorite', 'bbpress' )&nbsp;</div></li><li><div> ), 'get_forum_favorite_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Get the link</span></span>&nbsp;</div></li><li><div>      $retval = bbp_get_user_favorites_link( $r );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_favorite_link', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic Last Reply **********************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the id of the topics last reply</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2625)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_last_reply_id() To get the topic last reply id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_last_reply_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_last_reply_id( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the topics last update date/time (aka freshness)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2625)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the last reply id meta</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_last_reply_id' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        last reply id and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Topic last reply id</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_last_reply_id( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $reply_id = get_post_meta( $topic_id, '_bbp_last_reply_id', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $reply_id ) )&nbsp;</div></li><li><div>          $reply_id = $topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return (int) apply_filters( 'bbp_get_topic_last_reply_id', (int) $reply_id, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the title of the last reply inside a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_last_reply_title() To get the topic last reply title</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_last_reply_title( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_last_reply_title( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the title of the last reply inside a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_reply_id() To get the topic last reply id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_reply_title() To get the reply title</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_last_topic_title' with</span>&nbsp;</div></li><li><div><span class="comment">   *                        the reply title and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic last reply title</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_last_reply_title( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_last_topic_title', bbp_get_reply_title( bbp_get_topic_last_reply_id( $topic_id ) ), $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the link to the last reply in a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2464)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_last_reply_permalink() To get the topic's last reply link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_last_reply_permalink( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo esc_url( bbp_get_topic_last_reply_permalink( $topic_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the link to the last reply in a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2464)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_reply_id() To get the topic last reply id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_reply_permalink() To get the reply permalink</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_last_topic_permalink' with</span>&nbsp;</div></li><li><div><span class="comment">   *                        the reply permalink and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Permanent link to the reply</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_last_reply_permalink( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_last_reply_permalink', bbp_get_reply_permalink( bbp_get_topic_last_reply_id( $topic_id ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the link to the last reply in a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2683)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_last_reply_url() To get the topic last reply url</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_last_reply_url( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo esc_url( bbp_get_topic_last_reply_url( $topic_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the link to the last reply in a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2683)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_reply_id() To get the topic last reply id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_reply_url() To get the reply url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_reply_permalink() To get the reply permalink</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_last_topic_url' with</span>&nbsp;</div></li><li><div><span class="comment">   *                        the reply url and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic last reply url</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_last_reply_url( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $reply_id = bbp_get_topic_last_reply_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $reply_id ) && ( $reply_id !== $topic_id ) ) {&nbsp;</div></li><li><div>          $reply_url = bbp_get_reply_url( $reply_id );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $reply_url = bbp_get_topic_permalink( $topic_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_last_reply_url', $reply_url );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output link to the most recent activity inside a topic, complete with link</span>&nbsp;</div></li><li><div><span class="comment"> * attributes and content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2625)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_freshness_link() To get the topic freshness link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_freshness_link( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_freshness_link( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns link to the most recent activity inside a topic, complete</span>&nbsp;</div></li><li><div><span class="comment">   * with link attributes and content.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2625)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_reply_url() To get the topic last reply url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_reply_title() To get the reply title</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_active_time() To get the topic freshness</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_freshness_link' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        link and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic freshness link</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_freshness_link( $topic_id = 0 ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $link_url = bbp_get_topic_last_reply_url( $topic_id );&nbsp;</div></li><li><div>      $title = bbp_get_topic_last_reply_title( $topic_id );&nbsp;</div></li><li><div>      $time_since = bbp_get_topic_last_active_time( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $time_since ) )&nbsp;</div></li><li><div>          $anchor = '&lt;a href=&quot;' . esc_url( $link_url ) . '&quot; title=&quot;' . esc_attr( $title ) . '&quot;&gt;' . esc_html( $time_since ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $anchor = __( 'No Replies', 'bbpress' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_freshness_link', $anchor, $topic_id, $time_since, $link_url, $title );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the replies link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2740)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_replies_link() To get the topic replies link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_replies_link( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_replies_link( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the replies link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2740)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_reply_count() To get the topic reply count</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_permalink() To get the topic permalink</span>&nbsp;</div></li><li><div><span class="comment">   * @uses remove_query_arg() To remove args from the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_reply_count_hidden() To get the topic hidden</span>&nbsp;</div></li><li><div><span class="comment">   *                                           reply count</span>&nbsp;</div></li><li><div><span class="comment">   * @uses current_user_can() To check if the current user can edit others</span>&nbsp;</div></li><li><div><span class="comment">   *                           replies</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_replies_link' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        replies link and topic id</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_replies_link( $topic_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $topic_id ) );&nbsp;</div></li><li><div>      $topic_id = $topic-&gt;ID;&nbsp;</div></li><li><div>      $replies = sprintf( _n( '%s reply', '%s replies', bbp_get_topic_reply_count( $topic_id, true ), 'bbpress' ), bbp_get_topic_reply_count( $topic_id ) );&nbsp;</div></li><li><div>      $retval = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// First link never has view=all</span>&nbsp;</div></li><li><div>      if ( bbp_get_view_all( 'edit_others_replies' ) )&nbsp;</div></li><li><div>          $retval .= &quot;&lt;a href='&quot; . esc_url( bbp_remove_view_all( bbp_get_topic_permalink( $topic_id ) ) ) . &quot;'&gt;$replies&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $retval .= $replies;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Any deleted replies?</span>&nbsp;</div></li><li><div>      $deleted = bbp_get_topic_reply_count_hidden( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This forum has hidden topics</span>&nbsp;</div></li><li><div>      if ( !empty( $deleted ) && current_user_can( 'edit_others_replies' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Extra text</span>&nbsp;</div></li><li><div>          $extra = sprintf( __( ' (+ %d hidden)', 'bbpress' ), $deleted );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No link</span></span></span></span></span>&nbsp;</div></li><li><div>          if ( bbp_get_view_all() ) {&nbsp;</div></li><li><div>              $retval .= &quot; $extra&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Link</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $retval .= &quot; &lt;a href='&quot; . esc_url( bbp_add_view_all( bbp_get_topic_permalink( $topic_id ), true ) ) . &quot;'&gt;$extra&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_replies_link', $retval, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output total reply count of a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param boolean $integer Optional. Whether or not to format the result</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_reply_count() To get the topic reply count</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_reply_count( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_reply_count( $topic_id, $integer );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return total reply count of a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2485)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $integer Optional. Whether or not to format the result</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the topic reply count meta</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_reply_count' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        reply count and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Reply count</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_reply_count( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $replies = (int) get_post_meta( $topic_id, '_bbp_reply_count', true );&nbsp;</div></li><li><div>      $filter = ( true === $integer ) ? 'bbp_get_topic_reply_count_int' : 'bbp_get_topic_reply_count';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( $filter, $replies, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output total post count of a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2954)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param boolean $integer Optional. Whether or not to format the result</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_post_count() To get the topic post count</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_post_count( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_post_count( $topic_id, $integer );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return total post count of a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2954)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $integer Optional. Whether or not to format the result</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the topic post count meta</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_post_count' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        post count and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Post count</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_post_count( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $replies = (int) get_post_meta( $topic_id, '_bbp_reply_count', true ) + 1;&nbsp;</div></li><li><div>      $filter = ( true === $integer ) ? 'bbp_get_topic_post_count_int' : 'bbp_get_topic_post_count';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( $filter, $replies, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output total hidden reply count of a topic (hidden includes trashed and</span>&nbsp;</div></li><li><div><span class="comment"> * spammed replies)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2740)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param boolean $integer Optional. Whether or not to format the result</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_reply_count_hidden() To get the topic hidden reply count</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_reply_count_hidden( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_reply_count_hidden( $topic_id, $integer );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return total hidden reply count of a topic (hidden includes trashed</span>&nbsp;</div></li><li><div><span class="comment">   * and spammed replies)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2740)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $integer Optional. Whether or not to format the result</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the hidden reply count</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_reply_count_hidden' with</span>&nbsp;</div></li><li><div><span class="comment">   *                        the hidden reply count and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Topic hidden reply count</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_reply_count_hidden( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $replies = (int) get_post_meta( $topic_id, '_bbp_reply_count_hidden', true );&nbsp;</div></li><li><div>      $filter = ( true === $integer ) ? 'bbp_get_topic_reply_count_hidden_int' : 'bbp_get_topic_reply_count_hidden';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( $filter, $replies, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output total voice count of a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2567)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_voice_count() To get the topic voice count</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_voice_count( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_voice_count( $topic_id, $integer );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return total voice count of a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2567)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_meta() To get the voice count meta</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_voice_count' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        voice count and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Voice count of the topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_voice_count( $topic_id = 0, $integer = false ) {&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $voices = (int) get_post_meta( $topic_id, '_bbp_voice_count', true );&nbsp;</div></li><li><div>      $filter = ( true === $integer ) ? 'bbp_get_topic_voice_count_int' : 'bbp_get_topic_voice_count';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( $filter, $voices, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output a the tags of a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args See {@link bbp_get_topic_tag_list()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_tag_list() To get the topic tag list</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_list( $topic_id = 0, $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_tag_list( $topic_id, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the tags of a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment">   *  - before: Before the tag list</span>&nbsp;</div></li><li><div><span class="comment">   *  - sep: Tag separator</span>&nbsp;</div></li><li><div><span class="comment">   *  - after: After the tag list</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_the_term_list() To get the tags list</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Tag list of the topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_list( $topic_id = 0, $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Bail if topic-tags are off</span>&nbsp;</div></li><li><div>      if ( ! bbp_allow_topic_tags() )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'before' =&gt; '&lt;div class=&quot;bbp-topic-tags&quot;&gt;&lt;p&gt;' . esc_html__( 'Tagged:', 'bbpress' ) . '&nbsp;', &nbsp;</div></li><li><div>          'sep' =&gt; ', ', &nbsp;</div></li><li><div>          'after' =&gt; '&lt;/p&gt;&lt;/div&gt;'&nbsp;</div></li><li><div> ), 'get_topic_tag_list' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Topic is spammed, so display pre-spam terms</span>&nbsp;</div></li><li><div>      if ( bbp_is_topic_spam( $topic_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Get pre-spam terms</span></span>&nbsp;</div></li><li><div>          $terms = get_post_meta( $topic_id, '_bbp_spam_topic_tags', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// If terms exist, explode them and compile the return value</span></span>&nbsp;</div></li><li><div>          if ( !empty( $terms ) ) {&nbsp;</div></li><li><div>              $terms = implode( $r['sep'], $terms );&nbsp;</div></li><li><div>              $retval = $r['before'] . $terms . $r['after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// No terms so return emty string</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $retval = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Topic is not spam so display a clickable term list</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retval = get_the_term_list( $topic_id, bbp_get_topic_tag_tax_id(), $r['before'], $r['sep'], $r['after'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $retval;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the row class of a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2667)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @param array Extra classes you can pass when calling this function</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_class() To get the topic class</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_class( $topic_id = 0, $classes = array() ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_class( $topic_id, $classes );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the row class of a topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2667)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @param array Extra classes you can pass when calling this function</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_sticky() To check if the topic is a sticky</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_super_sticky() To check if the topic is a super sticky</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_forum_id() To get the topic forum id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_post_class() To get the topic classes</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_class' with the classes</span>&nbsp;</div></li><li><div><span class="comment">   *                        and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Row class of a topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_class( $topic_id = 0, $classes = array() ) {&nbsp;</div></li><li><div>      $bbp = bbpress();&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $topic_id );&nbsp;</div></li><li><div>      $count = isset( $bbp-&gt;topic_query-&gt;current_post ) ? $bbp-&gt;topic_query-&gt;current_post : 1;&nbsp;</div></li><li><div>      $classes = (array) $classes;&nbsp;</div></li><li><div>      $classes[] = ( (int) $count % 2 )                    ? 'even'         : 'odd';&nbsp;</div></li><li><div>      $classes[] = bbp_is_topic_sticky( $topic_id, false ) ? 'sticky'       : '';&nbsp;</div></li><li><div>      $classes[] = bbp_is_topic_super_sticky( $topic_id ) ? 'super-sticky' : '';&nbsp;</div></li><li><div>      $classes[] = 'bbp-parent-forum-' . bbp_get_topic_forum_id( $topic_id );&nbsp;</div></li><li><div>      $classes[] = 'user-id-' . bbp_get_topic_author_id( $topic_id );&nbsp;</div></li><li><div>      $classes = array_filter( $classes );&nbsp;</div></li><li><div>      $classes = get_post_class( $classes, $topic_id );&nbsp;</div></li><li><div>      $classes = apply_filters( 'bbp_get_topic_class', $classes, $topic_id );&nbsp;</div></li><li><div>      $retval = 'class=&quot;' . implode( ' ', $classes ) . '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $retval;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic Admin Links *********************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output admin links for topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args See {@link bbp_get_topic_admin_links()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_admin_links() To get the topic admin links</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_admin_links( $args = array() ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_admin_links( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return admin links for topic.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Move topic functionality is handled by the edit topic page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment">   *  - id: Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - before: Before the links</span>&nbsp;</div></li><li><div><span class="comment">   *  - after: After the links</span>&nbsp;</div></li><li><div><span class="comment">   *  - sep: Links separator</span>&nbsp;</div></li><li><div><span class="comment">   *  - links: Topic admin links array</span>&nbsp;</div></li><li><div><span class="comment">   * @uses current_user_can() To check if the current user can edit/delete</span>&nbsp;</div></li><li><div><span class="comment">   *                           the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_edit_link() To get the topic edit link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_trash_link() To get the topic trash link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_close_link() To get the topic close link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_spam_link() To get the topic spam link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_stick_link() To get the topic stick link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_merge_link() To get the topic merge link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_admin_links' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        topic admin links and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic admin links</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_admin_links( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array (&nbsp;</div></li><li><div>          'id' =&gt; bbp_get_topic_id(), &nbsp;</div></li><li><div>          'before' =&gt; '&lt;span class=&quot;bbp-admin-links&quot;&gt;', &nbsp;</div></li><li><div>          'after' =&gt; '&lt;/span&gt;', &nbsp;</div></li><li><div>          'sep' =&gt; ' | ', &nbsp;</div></li><li><div>          'links' =&gt; array()&nbsp;</div></li><li><div> ), 'get_topic_admin_links' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $r['links'] ) ) {&nbsp;</div></li><li><div>          $r['links'] = apply_filters( 'bbp_topic_admin_links', array(&nbsp;</div></li><li><div>              'edit' =&gt; bbp_get_topic_edit_link ( $r ), &nbsp;</div></li><li><div>              'close' =&gt; bbp_get_topic_close_link( $r ), &nbsp;</div></li><li><div>              'stick' =&gt; bbp_get_topic_stick_link( $r ), &nbsp;</div></li><li><div>              'merge' =&gt; bbp_get_topic_merge_link( $r ), &nbsp;</div></li><li><div>              'trash' =&gt; bbp_get_topic_trash_link( $r ), &nbsp;</div></li><li><div>              'spam' =&gt; bbp_get_topic_spam_link ( $r ), &nbsp;</div></li><li><div>              'reply' =&gt; bbp_get_topic_reply_link( $r )&nbsp;</div></li><li><div> ), $r['id'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// See if links need to be unset</span>&nbsp;</div></li><li><div>      $topic_status = bbp_get_topic_status( $r['id'] );&nbsp;</div></li><li><div>      if ( in_array( $topic_status, array( bbp_get_spam_status_id(), bbp_get_trash_status_id() ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Close link shouldn't be visible on trashed/spammed topics</span>&nbsp;</div></li><li><div>          unset( $r['links']['close'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Spam link shouldn't be visible on trashed topics</span>&nbsp;</div></li><li><div>          if ( bbp_get_trash_status_id() === $topic_status ) {&nbsp;</div></li><li><div>              unset( $r['links']['spam'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Trash link shouldn't be visible on spam topics</span>&nbsp;</div></li><li><div>          } elseif ( bbp_get_spam_status_id() === $topic_status ) {&nbsp;</div></li><li><div>              unset( $r['links']['trash'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Process the admin links</span></span>&nbsp;</div></li><li><div>      $links = implode( $r['sep'], array_filter( $r['links'] ) );&nbsp;</div></li><li><div>      $retval = $r['before'] . $links . $r['after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_admin_links', $retval, $r, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the edit link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args See {@link bbp_get_topic_edit_link()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_edit_link() To get the topic edit link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_edit_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_edit_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the edit link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these args:</span>&nbsp;</div></li><li><div><span class="comment">   *  - id: Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_before: Before the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_after: After the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - edit_text: Edit text</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses current_user_can() To check if the current user can edit the</span>&nbsp;</div></li><li><div><span class="comment">   *                           topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_edit_url() To get the topic edit url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_edit_link' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic edit link</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_edit_link( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div>          'link_before' =&gt; '', &nbsp;</div></li><li><div>          'link_after' =&gt; '', &nbsp;</div></li><li><div>          'edit_text' =&gt; esc_html__( 'Edit', 'bbpress' )&nbsp;</div></li><li><div> ), 'get_topic_edit_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $r['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Bypass check if user has caps</span>&nbsp;</div></li><li><div>      if ( !current_user_can( 'edit_others_topics' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// User cannot edit or it is past the lock time</span>&nbsp;</div></li><li><div>          if ( empty( $topic ) || !current_user_can( 'edit_topic', $topic-&gt;ID ) || bbp_past_edit_lock( $topic-&gt;post_date_gmt ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get uri</span>&nbsp;</div></li><li><div>      $uri = bbp_get_topic_edit_url( $r['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Bail if no uri</span>&nbsp;</div></li><li><div>      if ( empty( $uri ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $retval = $r['link_before'] . '&lt;a href=&quot;' . esc_url( $uri ) . '&quot; class=&quot;bbp-topic-edit-link&quot;&gt;' . $r['edit_text'] . '&lt;/a&gt;' . $r['link_after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_edit_link', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output URL to the topic edit page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2753)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_edit_url() To get the topic edit url</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_edit_url( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo esc_url( bbp_get_topic_edit_url( $topic_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return URL to the topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2753)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $topic_id Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_edit_url' with the edit</span>&nbsp;</div></li><li><div><span class="comment">   *                        url and topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic edit url</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_edit_url( $topic_id = 0 ) {&nbsp;</div></li><li><div>      global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bbp = bbpress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( $topic_id ) );&nbsp;</div></li><li><div>      if ( empty( $topic ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Remove view=all link from edit</span>&nbsp;</div></li><li><div>      $topic_link = bbp_remove_view_all( bbp_get_topic_permalink( $topic_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Pretty</span> permalinks</span>&nbsp;</div></li><li><div>      if ( $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>          $url = trailingslashit( $topic_link ) . $bbp-&gt;edit_id;&nbsp;</div></li><li><div>          $url = trailingslashit( $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Unpretty permalinks</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $url = add_query_arg( array( bbp_get_topic_post_type() =&gt; $topic-&gt;post_name, $bbp-&gt;edit_id =&gt; '1' ), $topic_link );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Maybe add view=all</span>&nbsp;</div></li><li><div>      $url = bbp_add_view_all( $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_edit_url', $url, $topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the trash link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args See {@link bbp_get_topic_trash_link()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_trash_link() To get the topic trash link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_trash_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_trash_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the trash link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these args:</span>&nbsp;</div></li><li><div><span class="comment">   *  - id: Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_before: Before the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_after: After the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - sep: Links separator</span>&nbsp;</div></li><li><div><span class="comment">   *  - trash_text: Trash text</span>&nbsp;</div></li><li><div><span class="comment">   *  - restore_text: Restore text</span>&nbsp;</div></li><li><div><span class="comment">   *  - delete_text: Delete text</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses current_user_can() To check if the current user can delete the</span>&nbsp;</div></li><li><div><span class="comment">   *                           topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_trash() To check if the topic is trashed</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses wp_nonce_url() To nonce the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses esc_url() To escape the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_trash_link' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic trash link</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_trash_link( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div>          'link_before' =&gt; '', &nbsp;</div></li><li><div>          'link_after' =&gt; '', &nbsp;</div></li><li><div>          'sep' =&gt; ' | ', &nbsp;</div></li><li><div>          'trash_text' =&gt; esc_html__( 'Trash', 'bbpress' ), &nbsp;</div></li><li><div>          'restore_text' =&gt; esc_html__( 'Restore', 'bbpress' ), &nbsp;</div></li><li><div>          'delete_text' =&gt; esc_html__( 'Delete', 'bbpress' )&nbsp;</div></li><li><div> ), 'get_topic_trash_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $actions = array();&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $r['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $topic ) || !current_user_can( 'delete_topic', $topic-&gt;ID ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( bbp_is_topic_trash( $topic-&gt;ID ) ) {&nbsp;</div></li><li><div>          $actions['untrash'] = '&lt;a title=&quot;' . esc_attr__( 'Restore this item from the Trash', 'bbpress' ) . '&quot; href=&quot;' . esc_url( wp_nonce_url( add_query_arg( array( 'action' =&gt; 'bbp_toggle_topic_trash', 'sub_action' =&gt; 'untrash', 'topic_id' =&gt; $topic-&gt;ID ) ), 'untrash-' . $topic-&gt;post_type . '_' . $topic-&gt;ID ) ) . '&quot; class=&quot;bbp-topic-restore-link&quot;&gt;' . $r['restore_text'] . '&lt;/a&gt;';&nbsp;</div></li><li><div>      } elseif ( EMPTY_TRASH_DAYS ) {&nbsp;</div></li><li><div>          $actions['trash'] = '&lt;a title=&quot;' . esc_attr__( 'Move this item to the Trash', 'bbpress' ) . '&quot; href=&quot;' . esc_url( wp_nonce_url( add_query_arg( array( 'action' =&gt; 'bbp_toggle_topic_trash', 'sub_action' =&gt; 'trash', 'topic_id' =&gt; $topic-&gt;ID ) ), 'trash-'   . $topic-&gt;post_type . '_' . $topic-&gt;ID ) ) . '&quot; class=&quot;bbp-topic-trash-link&quot;&gt;'   . $r['trash_text']   . '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( bbp_is_topic_trash( $topic-&gt;ID ) || !EMPTY_TRASH_DAYS ) {&nbsp;</div></li><li><div>          $actions['delete'] = '&lt;a title=&quot;' . esc_attr__( 'Delete this item permanently', 'bbpress' ) . '&quot; href=&quot;' . esc_url( wp_nonce_url( add_query_arg( array( 'action' =&gt; 'bbp_toggle_topic_trash', 'sub_action' =&gt; 'delete', 'topic_id' =&gt; $topic-&gt;ID ) ), 'delete-'  . $topic-&gt;post_type . '_' . $topic-&gt;ID ) ) . '&quot; onclick=&quot;return confirm(\'' . esc_js( __( 'Are you sure you want to delete that permanently?', 'bbpress' ) ) . '\' );&quot; class=&quot;bbp-topic-delete-link&quot;&gt;' . $r['delete_text'] . '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Process the admin links</span></span>&nbsp;</div></li><li><div>      $retval = $r['link_before'] . implode( $r['sep'], $actions ) . $r['link_after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_trash_link', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the close link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args See {@link bbp_get_topic_close_link()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_close_link() To get the topic close link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_close_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_close_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the close link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these args:</span>&nbsp;</div></li><li><div><span class="comment">   *  - id: Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_before: Before the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_after: After the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - close_text: Close text</span>&nbsp;</div></li><li><div><span class="comment">   *  - open_text: Open text</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses current_user_can() To check if the current user can edit the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_open() To check if the topic is open</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses wp_nonce_url() To nonce the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses esc_url() To escape the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_close_link' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic close link</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_close_link( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div>          'link_before' =&gt; '', &nbsp;</div></li><li><div>          'link_after' =&gt; '', &nbsp;</div></li><li><div>          'sep' =&gt; ' | ', &nbsp;</div></li><li><div>          'close_text' =&gt; _x( 'Close', 'Topic Status', 'bbpress' ), &nbsp;</div></li><li><div>          'open_text' =&gt; _x( 'Open', 'Topic Status', 'bbpress' )&nbsp;</div></li><li><div> ), 'get_topic_close_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $r['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $topic ) || !current_user_can( 'moderate', $topic-&gt;ID ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $display = bbp_is_topic_open( $topic-&gt;ID ) ? $r['close_text'] : $r['open_text'];&nbsp;</div></li><li><div>      $uri = add_query_arg( array( 'action' =&gt; 'bbp_toggle_topic_close', 'topic_id' =&gt; $topic-&gt;ID ) );&nbsp;</div></li><li><div>      $uri = wp_nonce_url( $uri, 'close-topic_' . $topic-&gt;ID );&nbsp;</div></li><li><div>      $retval = $r['link_before'] . '&lt;a href=&quot;' . esc_url( $uri ) . '&quot; class=&quot;bbp-topic-close-link&quot;&gt;' . $display . '&lt;/a&gt;' . $r['link_after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_close_link', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the stick link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2754)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args See {@link bbp_get_topic_stick_link()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_stick_link() To get the topic stick link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_stick_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_stick_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the stick link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2754)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these args:</span>&nbsp;</div></li><li><div><span class="comment">   *  - id: Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_before: Before the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_after: After the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - stick_text: Stick text</span>&nbsp;</div></li><li><div><span class="comment">   *  - unstick_text: Unstick text</span>&nbsp;</div></li><li><div><span class="comment">   *  - super_text: Stick to front text</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses current_user_can() To check if the current user can edit the</span>&nbsp;</div></li><li><div><span class="comment">   *                           topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_sticky() To check if the topic is a sticky</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses wp_nonce_url() To nonce the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses esc_url() To escape the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_stick_link' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic stick link</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_stick_link( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div>          'link_before' =&gt; '', &nbsp;</div></li><li><div>          'link_after' =&gt; '', &nbsp;</div></li><li><div>          'stick_text' =&gt; esc_html__( 'Stick', 'bbpress' ), &nbsp;</div></li><li><div>          'unstick_text' =&gt; esc_html__( 'Unstick', 'bbpress' ), &nbsp;</div></li><li><div>          'super_text' =&gt; esc_html__( '(to front)', 'bbpress' ), &nbsp;</div></li><li><div> ), 'get_topic_stick_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $r['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $topic ) || !current_user_can( 'moderate', $topic-&gt;ID ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $is_sticky = bbp_is_topic_sticky( $topic-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $stick_uri = add_query_arg( array( 'action' =&gt; 'bbp_toggle_topic_stick', 'topic_id' =&gt; $topic-&gt;ID ) );&nbsp;</div></li><li><div>      $stick_uri = wp_nonce_url( $stick_uri, 'stick-topic_' . $topic-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $stick_display = ( true === $is_sticky ) ? $r['unstick_text'] : $r['stick_text'];&nbsp;</div></li><li><div>      $stick_display = '&lt;a href=&quot;' . esc_url( $stick_uri ) . '&quot; class=&quot;bbp-topic-sticky-link&quot;&gt;' . $stick_display . '&lt;/a&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $is_sticky ) ) {&nbsp;</div></li><li><div>          $super_uri = add_query_arg( array( 'action' =&gt; 'bbp_toggle_topic_stick', 'topic_id' =&gt; $topic-&gt;ID, 'super' =&gt; 1 ) );&nbsp;</div></li><li><div>          $super_uri = wp_nonce_url( $super_uri, 'stick-topic_' . $topic-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $super_display = ' &lt;a href=&quot;' . esc_url( $super_uri ) . '&quot; class=&quot;bbp-topic-super-sticky-link&quot;&gt;' . $r['super_text'] . '&lt;/a&gt;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $super_display = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Combine the HTML into 1 string</span>&nbsp;</div></li><li><div>      $retval = $r['link_before'] . $stick_display . $super_display . $r['link_after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_stick_link', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the merge link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2756)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_merge_link() To get the topic merge link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_merge_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_merge_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the merge link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2756)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these args:</span>&nbsp;</div></li><li><div><span class="comment">   *  - id: Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_before: Before the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_after: After the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - merge_text: Merge text</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_edit_url() To get the topic edit url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses esc_url() To escape the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_merge_link' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic merge link</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_merge_link( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div>          'link_before' =&gt; '', &nbsp;</div></li><li><div>          'link_after' =&gt; '', &nbsp;</div></li><li><div>          'merge_text' =&gt; esc_html__( 'Merge', 'bbpress' ), &nbsp;</div></li><li><div> ), 'get_topic_merge_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $r['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $topic ) || !current_user_can( 'moderate', $topic-&gt;ID ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $uri = add_query_arg( array( 'action' =&gt; 'merge' ), bbp_get_topic_edit_url( $topic-&gt;ID ) );&nbsp;</div></li><li><div>      $retval = $r['link_before'] . '&lt;a href=&quot;' . esc_url( $uri ) . '&quot; class=&quot;bbp-topic-merge-link&quot;&gt;' . $r['merge_text'] . '&lt;/a&gt;' . $r['link_after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_merge_link', $retval, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the spam link of the topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $args See {@link bbp_get_topic_spam_link()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_spam_link() Topic spam link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_spam_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_spam_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the spam link of the topic</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2727)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these args:</span>&nbsp;</div></li><li><div><span class="comment">   *  - id: Optional. Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_before: Before the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - link_after: After the link</span>&nbsp;</div></li><li><div><span class="comment">   *  - spam_text: Spam text</span>&nbsp;</div></li><li><div><span class="comment">   *  - unspam_text: Unspam text</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses current_user_can() To check if the current user can edit the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_spam() To check if the topic is marked as spam</span>&nbsp;</div></li><li><div><span class="comment">   * @uses add_query_arg() To add custom args to the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses wp_nonce_url() To nonce the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses esc_url() To escape the url</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_spam_link' with the link</span>&nbsp;</div></li><li><div><span class="comment">   *                        and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic spam link</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_spam_link( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div>          'link_before' =&gt; '', &nbsp;</div></li><li><div>          'link_after' =&gt; '', &nbsp;</div></li><li><div>          'sep' =&gt; ' | ', &nbsp;</div></li><li><div>          'spam_text' =&gt; esc_html__( 'Spam', 'bbpress' ), &nbsp;</div></li><li><div>          'unspam_text' =&gt; esc_html__( 'Unspam', 'bbpress' )&nbsp;</div></li><li><div> ), 'get_topic_spam_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $r['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $topic ) || !current_user_can( 'moderate', $topic-&gt;ID ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $display = bbp_is_topic_spam( $topic-&gt;ID ) ? $r['unspam_text'] : $r['spam_text'];&nbsp;</div></li><li><div>      $uri = add_query_arg( array( 'action' =&gt; 'bbp_toggle_topic_spam', 'topic_id' =&gt; $topic-&gt;ID ) );&nbsp;</div></li><li><div>      $uri = wp_nonce_url( $uri, 'spam-topic_' . $topic-&gt;ID );&nbsp;</div></li><li><div>      $retval = $r['link_before'] . '&lt;a href=&quot;' . esc_url( $uri ) . '&quot; class=&quot;bbp-topic-spam-link&quot;&gt;' . $display . '&lt;/a&gt;' . $r['link_after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_spam_link', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the link to go directly to the reply form</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r4966)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_reply_to_link() To get the reply to link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_reply_link( $args = array() ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_reply_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the link to go directly to the reply form</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r4966)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args Arguments</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_current_user_can_access_create_reply_form() To check permissions</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To validate the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic() To get the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_reply_link' with the formatted link, </span>&nbsp;</div></li><li><div><span class="comment">   *                        the arguments array, and the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Link for a reply to a topic</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_reply_link( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'id' =&gt; 0, &nbsp;</div></li><li><div>          'link_before' =&gt; '', &nbsp;</div></li><li><div>          'link_after' =&gt; '', &nbsp;</div></li><li><div>          'reply_text' =&gt; esc_html__( 'Reply', 'bbpress' ), &nbsp;</div></li><li><div> ), 'get_topic_reply_link' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get the reply to use it's ID and post_parent</span>&nbsp;</div></li><li><div>      $topic = bbp_get_topic( bbp_get_topic_id( (int) $r['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Bail if no reply or user cannot reply</span>&nbsp;</div></li><li><div>      if ( empty( $topic ) || ! bbp_current_user_can_access_create_reply_form() )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $uri = '#new-post';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add $uri to the array, to be passed through the filter</span>&nbsp;</div></li><li><div>      $r['uri'] = $uri;&nbsp;</div></li><li><div>      $retval = $r['link_before'] . '&lt;a href=&quot;' . esc_url( $r['uri'] ) . '&quot; class=&quot;bbp-topic-reply-link&quot;&gt;' . $r['reply_text'] . '&lt;/a&gt;' . $r['link_after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_reply_link', $retval, $r, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic Pagination **********************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the pagination count</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2519)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_forum_pagination_count() To get the forum pagination count</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_forum_pagination_count() {&nbsp;</div></li><li><div>  echo bbp_get_forum_pagination_count();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the pagination count</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2519)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_number_format() To format the number value</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_forum_pagination_count' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        pagination count</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Forum Pagintion count</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_forum_pagination_count() {&nbsp;</div></li><li><div>      $bbp = bbpress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $bbp-&gt;topic_query ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set pagination values</span>&nbsp;</div></li><li><div>      $start_num = intval( ( $bbp-&gt;topic_query-&gt;paged - 1 ) * $bbp-&gt;topic_query-&gt;posts_per_page ) + 1;&nbsp;</div></li><li><div>      $from_num = bbp_number_format( $start_num );&nbsp;</div></li><li><div>      $to_num = bbp_number_format( ( $start_num + ( $bbp-&gt;topic_query-&gt;posts_per_page - 1 ) &gt; $bbp-&gt;topic_query-&gt;found_posts ) ? $bbp-&gt;topic_query-&gt;found_posts : $start_num + ( $bbp-&gt;topic_query-&gt;posts_per_page - 1 ) );&nbsp;</div></li><li><div>      $total_int = (int) !empty( $bbp-&gt;topic_query-&gt;found_posts ) ? $bbp-&gt;topic_query-&gt;found_posts : $bbp-&gt;topic_query-&gt;post_count;&nbsp;</div></li><li><div>      $total = bbp_number_format( $total_int );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Several topics in a forum with a single page</span>&nbsp;</div></li><li><div>      if ( empty( $to_num ) ) {&nbsp;</div></li><li><div>          $retstr = sprintf( _n( 'Viewing %1$s topic', 'Viewing %1$s topics', $total_int, 'bbpress' ), $total );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Several topics in a forum with several pages</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retstr = sprintf( _n( 'Viewing topic %2$s (of %4$s total)', 'Viewing %1$s topics - %2$s through %3$s (of %4$s total)', $total_int, 'bbpress' ), $bbp-&gt;topic_query-&gt;post_count, $from_num, $to_num, $total );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Filter and return</span>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_forum_pagination_count', esc_html( $retstr ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output pagination links</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2519)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_forum_pagination_links() To get the pagination links</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_forum_pagination_links() {&nbsp;</div></li><li><div>  echo bbp_get_forum_pagination_links();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return pagination links</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2519)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbPress::topic_query::pagination_links To get the links</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Pagination links</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_forum_pagination_links() {&nbsp;</div></li><li><div>      $bbp = bbpress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $bbp-&gt;topic_query ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_forum_pagination_links', $bbp-&gt;topic_query-&gt;pagination_links );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays topic notices</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2744)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_is_single_topic() To check if it's a topic page</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_status() To get the topic status</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'bbp_topic_notices' with the notice text, topic</span>&nbsp;</div></li><li><div><span class="comment"> *                        status and topic id</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_add_error() To add an error message</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_notices() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if not viewing a topic</span>&nbsp;</div></li><li><div>  if ( !bbp_is_single_topic() )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the topic_status</span>&nbsp;</div></li><li><div>  $topic_status = bbp_get_topic_status();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the topic status</span>&nbsp;</div></li><li><div>  switch ( $topic_status ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Spam notice</span>&nbsp;</div></li><li><div>      case bbp_get_spam_status_id() :&nbsp;</div></li><li><div>          $notice_text = __( 'This topic is marked as spam.', 'bbpress' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Trashed notice</span>&nbsp;</div></li><li><div>      case bbp_get_trash_status_id() :&nbsp;</div></li><li><div>          $notice_text = __( 'This topic is in the trash.', 'bbpress' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Standard status</span>&nbsp;</div></li><li><div>      default :&nbsp;</div></li><li><div>          $notice_text = '';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Filter notice text and bail if empty</span>&nbsp;</div></li><li><div>  $notice_text = apply_filters( 'bbp_topic_notices', $notice_text, $topic_status, bbp_get_topic_id() );&nbsp;</div></li><li><div>  if ( empty( $notice_text ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bbp_add_error( 'topic_notice', $notice_text, 'message' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays topic type select box (normal/sticky/super sticky)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5059)</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated since bbPress (r5059)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment"> *  - select_id: Select id. Defaults to bbp_stick_topic</span>&nbsp;</div></li><li><div><span class="comment"> *  - tab: Tabindex</span>&nbsp;</div></li><li><div><span class="comment"> *  - topic_id: Topic id</span>&nbsp;</div></li><li><div><span class="comment"> *  - selected: Override the selected option</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_type_select( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_type_dropdown( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Displays topic type select box (normal/sticky/super sticky)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5059)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment"> *  - select_id: Select id. Defaults to bbp_stick_topic</span>&nbsp;</div></li><li><div><span class="comment"> *  - tab: Tabindex</span>&nbsp;</div></li><li><div><span class="comment"> *  - topic_id: Topic id</span>&nbsp;</div></li><li><div><span class="comment"> *  - selected: Override the selected option</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_type_dropdown( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_type_dropdown( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns topic type select box (normal/sticky/super sticky)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r5059)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment">   *  - select_id: Select id. Defaults to bbp_stick_topic</span>&nbsp;</div></li><li><div><span class="comment">   *  - tab: Tabindex</span>&nbsp;</div></li><li><div><span class="comment">   *  - topic_id: Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - selected: Override the selected option</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_single_topic() To check if we're viewing a single topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_edit() To check if it is the topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_super_sticky() To check if the topic is a super sticky</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_sticky() To check if the topic is a sticky</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_type_dropdown( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'select_id' =&gt; 'bbp_stick_topic', &nbsp;</div></li><li><div>          'tab' =&gt; bbp_get_tab_index(), &nbsp;</div></li><li><div>          'topic_id' =&gt; 0, &nbsp;</div></li><li><div>          'selected' =&gt; false&nbsp;</div></li><li><div> ), 'topic_type_select' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// No specific selected value passed</span></span>&nbsp;</div></li><li><div>      if ( empty( $r['selected'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Post value is passed</span></span>&nbsp;</div></li><li><div>          if ( bbp_is_post_request() && isset( $_POST[ $r['select_id'] ] ) ) {&nbsp;</div></li><li><div>              $r['selected'] = $_POST[ $r['select_id'] ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// No Post value passed</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Edit topic</span></span>&nbsp;</div></li><li><div>              if ( bbp_is_single_topic() || bbp_is_topic_edit() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Get current topic id</span>&nbsp;</div></li><li><div>                  $topic_id = bbp_get_topic_id( $r['topic_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Topic is super sticky</span>&nbsp;</div></li><li><div>                  if ( bbp_is_topic_super_sticky( $topic_id ) ) {&nbsp;</div></li><li><div>                      $r['selected'] = 'super';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Topic is sticky or normal</span>&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $r['selected'] = bbp_is_topic_sticky( $topic_id, false ) ? 'stick' : 'unstick';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Used variables</span></span>&nbsp;</div></li><li><div>      $tab = !empty( $r['tab'] ) ? ' tabindex=&quot;' . (int) $r['tab'] . '&quot;' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Start an output buffer, we'll finish it after the select loop</span></span>&nbsp;</div></li><li><div>      ob_start(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;select name=&quot;&lt;?php echo esc_attr( $r['select_id'] ); ?&gt;&quot; id=&quot;&lt;?php echo esc_attr( $r['select_id'] ); ?&gt;_select&quot;&lt;?php echo $tab; ?&gt;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php foreach ( bbp_get_topic_types() as $key =&gt; $label ) : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;option value=&quot;&lt;?php echo esc_attr( $key ); ?&gt;&quot;&lt;?php selected( $key, $r['selected'] ); ?&gt;&gt;&lt;?php echo esc_html( $label ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;/select&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Return the results</span></span>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_type_dropdown', ob_get_clean(), $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output value topic status dropdown</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5059)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id The topic id to use</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_status_dropdown( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_status_dropdown( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns topic status downdown</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This dropdown is only intended to be seen by users with the 'moderate'</span>&nbsp;</div></li><li><div><span class="comment">   * capability. Because of this, no additional capablitiy checks are performed</span>&nbsp;</div></li><li><div><span class="comment">   * within this function to check available topic statuses.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r5059)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment">   *  - select_id: Select id. Defaults to bbp_open_close_topic</span>&nbsp;</div></li><li><div><span class="comment">   *  - tab: Tabindex</span>&nbsp;</div></li><li><div><span class="comment">   *  - topic_id: Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - selected: Override the selected option</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_status_dropdown( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'select_id' =&gt; 'bbp_topic_status', &nbsp;</div></li><li><div>          'tab' =&gt; bbp_get_tab_index(), &nbsp;</div></li><li><div>          'topic_id' =&gt; 0, &nbsp;</div></li><li><div>          'selected' =&gt; false&nbsp;</div></li><li><div> ), 'topic_open_close_select' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// No specific selected value passed</span></span>&nbsp;</div></li><li><div>      if ( empty( $r['selected'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Post value is passed</span></span>&nbsp;</div></li><li><div>          if ( bbp_is_post_request() && isset( $_POST[ $r['select_id'] ] ) ) {&nbsp;</div></li><li><div>              $r['selected'] = $_POST[ $r['select_id'] ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// No Post value was passed</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Edit topic</span></span>&nbsp;</div></li><li><div>              if ( bbp_is_topic_edit() ) {&nbsp;</div></li><li><div>                  $r['topic_id'] = bbp_get_topic_id( $r['topic_id'] );&nbsp;</div></li><li><div>                  $r['selected'] = bbp_get_topic_status( $r['topic_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// New topic</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $r['selected'] = bbp_get_public_status_id();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Used variables</span></span>&nbsp;</div></li><li><div>      $tab = ! empty( $r['tab'] ) ? ' tabindex=&quot;' . (int) $r['tab'] . '&quot;' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Start an output buffer, we'll finish it after the select loop</span></span>&nbsp;</div></li><li><div>      ob_start(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;select name=&quot;&lt;?php echo esc_attr( $r['select_id'] ) ?&gt;&quot; id=&quot;&lt;?php echo esc_attr( $r['select_id'] ); ?&gt;_select&quot;&lt;?php echo $tab; ?&gt;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php foreach ( bbp_get_topic_statuses( $r['topic_id'] ) as $key =&gt; $label ) : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;option value=&quot;&lt;?php echo esc_attr( $key ); ?&gt;&quot;&lt;?php selected( $key, $r['selected'] ); ?&gt;&gt;&lt;?php echo esc_html( $label ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;/select&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Return the results</span></span>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_status_dropdown', ob_get_clean(), $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Single Topic **************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output a fancy description of the current topic, including total topics, </span>&nbsp;</div></li><li><div><span class="comment"> * total replies, and last activity.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2860)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args See {@link bbp_get_single_topic_description()}</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_single_topic_description() Return the eventual output</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_single_topic_description( $args = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_single_topic_description( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return a fancy description of the current topic, including total topics, </span>&nbsp;</div></li><li><div><span class="comment">   * total replies, and last activity.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2860)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args This function supports these arguments:</span>&nbsp;</div></li><li><div><span class="comment">   *  - topic_id: Topic id</span>&nbsp;</div></li><li><div><span class="comment">   *  - before: Before the text</span>&nbsp;</div></li><li><div><span class="comment">   *  - after: After the text</span>&nbsp;</div></li><li><div><span class="comment">   *  - size: Size of the avatar</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_id() To get the topic id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_voice_count() To get the topic voice count</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_reply_count() To get the topic reply count</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_freshness_link() To get the topic freshness link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_last_active_id() To get the topic last active id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_reply_author_link() To get the reply author link</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_single_topic_description' with</span>&nbsp;</div></li><li><div><span class="comment">   *                        the description and args</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Filtered topic description</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_single_topic_description( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'topic_id' =&gt; 0, &nbsp;</div></li><li><div>          'before' =&gt; '&lt;div class=&quot;bbp-template-notice info&quot;&gt;&lt;p class=&quot;bbp-topic-description&quot;&gt;', &nbsp;</div></li><li><div>          'after' =&gt; '&lt;/p&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>          'size' =&gt; 14&nbsp;</div></li><li><div> ), 'get_single_topic_description' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Validate topic_id</span>&nbsp;</div></li><li><div>      $topic_id = bbp_get_topic_id( $r['topic_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Unhook the 'view all' query var adder</span>&nbsp;</div></li><li><div>      remove_filter( 'bbp_get_topic_permalink', 'bbp_add_view_all' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Build the topic description</span>&nbsp;</div></li><li><div>      $vc_int = bbp_get_topic_voice_count   ( $topic_id, true );&nbsp;</div></li><li><div>      $voice_count = bbp_get_topic_voice_count   ( $topic_id, false );&nbsp;</div></li><li><div>      $reply_count = bbp_get_topic_replies_link  ( $topic_id );&nbsp;</div></li><li><div>      $time_since = bbp_get_topic_freshness_link( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Singular/Plural</span>&nbsp;</div></li><li><div>      $voice_count = sprintf( _n( '%s voice', '%s voices', $vc_int, 'bbpress' ), $voice_count );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Topic has replies</span>&nbsp;</div></li><li><div>      $last_reply = bbp_get_topic_last_reply_id( $topic_id );&nbsp;</div></li><li><div>      if ( !empty( $last_reply ) ) {&nbsp;</div></li><li><div>          $last_updated_by = bbp_get_author_link( array( 'post_id' =&gt; $last_reply, 'size' =&gt; $r['size'] ) );&nbsp;</div></li><li><div>          $retstr = sprintf( esc_html__( 'This topic contains %1$s, has %2$s, and was last updated by %3$s %4$s.', 'bbpress' ), $reply_count, $voice_count, $last_updated_by, $time_since );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Topic has no replies</span>&nbsp;</div></li><li><div>      } elseif ( ! empty( $voice_count ) && ! empty( $reply_count ) ) {&nbsp;</div></li><li><div>          $retstr = sprintf( esc_html__( 'This topic contains %1$s and has %2$s.', 'bbpress' ), $voice_count, $reply_count );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Topic has no replies</span> and no voices&nbsp;</div></li><li><div>      } elseif ( empty( $voice_count ) && empty( $reply_count ) ) {&nbsp;</div></li><li><div>          $retstr = sprintf( esc_html__( 'This topic has no replies.', 'bbpress' ), $voice_count, $reply_count );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add the 'view all' filter back</span>&nbsp;</div></li><li><div>      add_filter( 'bbp_get_topic_permalink', 'bbp_add_view_all' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Combine the elements together</span>&nbsp;</div></li><li><div>      $retstr = $r['before'] . $retstr . $r['after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Return filtered result</span>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_single_topic_description', $retstr, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic Tags ****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the unique id of the topic tag taxonomy</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3348)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_post_type() To get the topic post type</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_tax_id() {&nbsp;</div></li><li><div>  echo bbp_get_topic_tag_tax_id();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the unique id of the topic tag taxonomy</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3348)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_topic_tag_tax_id' with the topic tax id</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The unique topic tag taxonomy</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_tax_id() {&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_tag_tax_id', bbpress()-&gt;topic_tag_tax_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return array of labels used by the topic-tag taxonomy</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5129)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic_tag_tax_labels() {&nbsp;</div></li><li><div>  return apply_filters( 'bbp_get_topic_tag_tax_labels', array(&nbsp;</div></li><li><div>      'name' =&gt; __( 'Topic Tags', 'bbpress' ), &nbsp;</div></li><li><div>      'singular_name' =&gt; __( 'Topic Tag', 'bbpress' ), &nbsp;</div></li><li><div>      'search_items' =&gt; __( 'Search Tags', 'bbpress' ), &nbsp;</div></li><li><div>      'popular_items' =&gt; __( 'Popular Tags', 'bbpress' ), &nbsp;</div></li><li><div>      'all_items' =&gt; __( 'All Tags', 'bbpress' ), &nbsp;</div></li><li><div>      'edit_item' =&gt; __( 'Edit Tag', 'bbpress' ), &nbsp;</div></li><li><div>      'update_item' =&gt; __( 'Update Tag', 'bbpress' ), &nbsp;</div></li><li><div>      'add_new_item' =&gt; __( 'Add New Tag', 'bbpress' ), &nbsp;</div></li><li><div>      'new_item_name' =&gt; __( 'New Tag Name', 'bbpress' ), &nbsp;</div></li><li><div>      'view_item' =&gt; __( 'View Topic Tag', 'bbpress' )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return an array of topic-tag taxonomy rewrite settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r5129)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_get_topic_tag_tax_rewrite() {&nbsp;</div></li><li><div>  return apply_filters( 'bbp_get_topic_tag_tax_rewrite', array(&nbsp;</div></li><li><div>      'slug' =&gt; bbp_get_topic_tag_tax_slug(), &nbsp;</div></li><li><div>      'with_front' =&gt; false&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the id of the current tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_tag_id()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_id( $tag = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_tag_id( $tag );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the id of the current tag</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_term_by()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_queried_object()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_query_var()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Term Name</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_id( $tag = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get the term</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( ! empty( $tag ) ) {&nbsp;</div></li><li><div>          $term = get_term_by( 'slug', $tag, bbp_get_topic_tag_tax_id() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tag = get_query_var( 'term' );&nbsp;</div></li><li><div>          $term = get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Add before and after if description exists</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !empty( $term-&gt;term_id ) ) {&nbsp;</div></li><li><div>          $retval = $term-&gt;term_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// No id</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retval = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return (int) apply_filters( 'bbp_get_topic_tag_id', (int) $retval, $tag );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the name of the current tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_tag_name()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_name( $tag = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_tag_name( $tag );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the name of the current tag</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_term_by()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_queried_object()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_query_var()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Term Name</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_name( $tag = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get the term</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( ! empty( $tag ) ) {&nbsp;</div></li><li><div>          $term = get_term_by( 'slug', $tag, bbp_get_topic_tag_tax_id() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tag = get_query_var( 'term' );&nbsp;</div></li><li><div>          $term = get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Add before and after if description exists</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !empty( $term-&gt;name ) ) {&nbsp;</div></li><li><div>          $retval = $term-&gt;name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// No name</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retval = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_tag_name', $retval );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the slug of the current tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_tag_slug()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_slug( $tag = '' ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_tag_slug( $tag );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the slug of the current tag</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_term_by()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_queried_object()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_query_var()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Term Name</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_slug( $tag = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get the term</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( ! empty( $tag ) ) {&nbsp;</div></li><li><div>          $term = get_term_by( 'slug', $tag, bbp_get_topic_tag_tax_id() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tag = get_query_var( 'term' );&nbsp;</div></li><li><div>          $term = get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Add before and after if description exists</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !empty( $term-&gt;slug ) ) {&nbsp;</div></li><li><div>          $retval = $term-&gt;slug;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// No slug</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retval = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_tag_slug', $retval );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the link of the current tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3348)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_tag_link()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_link( $tag = '' ) {&nbsp;</div></li><li><div>  echo esc_url( bbp_get_topic_tag_link( $tag ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the link of the current tag</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3348)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_term_by()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_queried_object()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_query_var()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Term Name</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_link( $tag = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get the term</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( ! empty( $tag ) ) {&nbsp;</div></li><li><div>          $term = get_term_by( 'slug', $tag, bbp_get_topic_tag_tax_id() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tag = get_query_var( 'term' );&nbsp;</div></li><li><div>          $term = get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Add before and after if description exists</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !empty( $term-&gt;term_id ) ) {&nbsp;</div></li><li><div>          $retval = get_term_link( $term, bbp_get_topic_tag_tax_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No link</span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retval = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_tag_link', $retval, $tag );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the link of the current tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3348)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_tag_edit_link()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_edit_link( $tag = '' ) {&nbsp;</div></li><li><div>  echo esc_url( bbp_get_topic_tag_edit_link( $tag ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the link of the current tag</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3348)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_term_by()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_queried_object()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_query_var()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Term Name</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_edit_link( $tag = '' ) {&nbsp;</div></li><li><div>      global $wp_rewrite;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get the term</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( ! empty( $tag ) ) {&nbsp;</div></li><li><div>          $term = get_term_by( 'slug', $tag, bbp_get_topic_tag_tax_id() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tag = get_query_var( 'term' );&nbsp;</div></li><li><div>          $term = get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Add before and after if description exists</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !empty( $term-&gt;term_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $bbp = bbpress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Pretty</span>&nbsp;</div></li><li><div>          if ( $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>              $retval = user_trailingslashit( trailingslashit( bbp_get_topic_tag_link() ) . $bbp-&gt;edit_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Ugly</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $retval = add_query_arg( array( $bbp-&gt;edit_id =&gt; '1' ), bbp_get_topic_tag_link() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No link</span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retval = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_tag_edit_link', $retval, $tag );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the description of the current tag</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_topic_tag_description()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_tag_description( $args = array() ) {&nbsp;</div></li><li><div>  echo bbp_get_topic_tag_description( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the description of the current tag</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r3109)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_term_by()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_queried_object()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses get_query_var()</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters()</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args before|after|tag</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Term Name</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_topic_tag_description( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Parse arguments against default values</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $r = bbp_parse_args( $args, array(&nbsp;</div></li><li><div>          'before' =&gt; '&lt;div class=&quot;bbp-topic-tag-description&quot;&gt;&lt;p&gt;', &nbsp;</div></li><li><div>          'after' =&gt; '&lt;/p&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>          'tag' =&gt; ''&nbsp;</div></li><li><div> ), 'get_topic_tag_description' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get the term</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( ! empty( $r['tag'] ) ) {&nbsp;</div></li><li><div>          $term = get_term_by( 'slug', $r['tag'], bbp_get_topic_tag_tax_id() );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tag = get_query_var( 'term' );&nbsp;</div></li><li><div>          $r['tag'] = $tag;&nbsp;</div></li><li><div>          $term = get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Add before and after if description exists</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !empty( $term-&gt;description ) ) {&nbsp;</div></li><li><div>          $retval = $r['before'] . $term-&gt;description . $r['after'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// No description, no HTML</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $retval = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_topic_tag_description', $retval, $r );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Forms *********************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the value of topic title field</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_form_topic_title() To get the value of topic title field</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_title() {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_title();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the value of topic title field</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_edit() To check if it's topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_form_topic_title' with the title</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Value of topic title field</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_title() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get _POST data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( bbp_is_post_request() && isset( $_POST['bbp_topic_title'] ) ) {&nbsp;</div></li><li><div>          $topic_title = $_POST['bbp_topic_title'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get edit data</span></span></span></span></span>&nbsp;</div></li><li><div>      } elseif ( bbp_is_topic_edit() ) {&nbsp;</div></li><li><div>          $topic_title = bbp_get_global_post_field( 'post_title', 'raw' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_title = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_title', esc_attr( $topic_title ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the value of topic content field</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_form_topic_content() To get value of topic content field</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_content() {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_content();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the value of topic content field</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_edit() To check if it's the topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_form_topic_content' with the content</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Value of topic content field</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_content() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get _POST data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( bbp_is_post_request() && isset( $_POST['bbp_topic_content'] ) ) {&nbsp;</div></li><li><div>          $topic_content = stripslashes( $_POST['bbp_topic_content'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get edit data</span></span></span></span></span>&nbsp;</div></li><li><div>      } elseif ( bbp_is_topic_edit() ) {&nbsp;</div></li><li><div>          $topic_content = bbp_get_global_post_field( 'post_content', 'raw' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_content = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_content', $topic_content );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Allow topic rows to have adminstrative actions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r3653)</span>&nbsp;</div></li><li><div><span class="comment"> * @uses do_action()</span>&nbsp;</div></li><li><div><span class="comment"> * @todo Links and filter</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_topic_row_actions() {&nbsp;</div></li><li><div>  do_action( 'bbp_topic_row_actions' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output value of topic tags field</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_form_topic_tags() To get the value of topic tags field</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_tags() {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_tags();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return value of topic tags field</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_edit() To check if it's the topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_form_topic_tags' with the tags</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Value of topic tags field</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_tags() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get _POST data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( bbp_is_post_request() && isset( $_POST['bbp_topic_tags'] ) ) {&nbsp;</div></li><li><div>          $topic_tags = $_POST['bbp_topic_tags'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get edit data</span></span></span></span></span>&nbsp;</div></li><li><div>      } elseif ( bbp_is_single_topic() || bbp_is_single_reply() || bbp_is_topic_edit() || bbp_is_reply_edit() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Determine the topic id based on the post type</span>&nbsp;</div></li><li><div>          switch ( get_post_type() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Post is a topic</span>&nbsp;</div></li><li><div>              case bbp_get_topic_post_type() :&nbsp;</div></li><li><div>                  $topic_id = get_the_ID();&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Post is a reply</span>&nbsp;</div></li><li><div>              case bbp_get_reply_post_type() :&nbsp;</div></li><li><div>                  $topic_id = bbp_get_reply_topic_id( get_the_ID() );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Topic exists</span>&nbsp;</div></li><li><div>          if ( !empty( $topic_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Topic is spammed so display pre-spam terms</span>&nbsp;</div></li><li><div>              if ( bbp_is_topic_spam( $topic_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Get pre-spam terms</span></span>&nbsp;</div></li><li><div>                  $new_terms = get_post_meta( $topic_id, '_bbp_spam_topic_tags', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// If terms exist, explode them and compile the return value</span></span>&nbsp;</div></li><li><div>                  if ( empty( $new_terms ) ) {&nbsp;</div></li><li><div>                      $new_terms = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Topic is not spam so get real terms</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $terms = array_filter( (array) get_the_terms( $topic_id, bbp_get_topic_tag_tax_id() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Loop through them</span>&nbsp;</div></li><li><div>                  foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                      $new_terms[] = $term-&gt;name;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Define local variable(s)</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $new_terms = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set the return value</span>&nbsp;</div></li><li><div>          $topic_tags = ( !empty( $new_terms ) ) ? implode( ', ', $new_terms ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_tags = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_tags', esc_attr( $topic_tags ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output value of topic forum</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_form_topic_forum() To get the topic's forum id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_forum() {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_forum();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return value of topic forum</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_edit() To check if it's the topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_get_topic_forum_id() To get the topic forum id</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_form_topic_forum' with the forum</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Value of topic content field</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_forum() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get _POST data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( bbp_is_post_request() && isset( $_POST['bbp_forum_id'] ) ) {&nbsp;</div></li><li><div>          $topic_forum = (int) $_POST['bbp_forum_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get edit data</span></span></span></span></span>&nbsp;</div></li><li><div>      } elseif ( bbp_is_topic_edit() ) {&nbsp;</div></li><li><div>          $topic_forum = bbp_get_topic_forum_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_forum = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_forum', $topic_forum );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output checked value of topic subscription</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_form_topic_subscribed() To get the subscribed checkbox value</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_subscribed() {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_subscribed();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return checked value of topic subscription</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_topic_edit() To check if it's the topic edit page</span>&nbsp;</div></li><li><div><span class="comment">   * @uses bbp_is_user_subscribed_to_topic() To check if the user is</span>&nbsp;</div></li><li><div><span class="comment">   *                                          subscribed to the topic</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_form_topic_subscribed' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        option</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Checked value of topic subscription</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_subscribed() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get _POST data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( bbp_is_post_request() && isset( $_POST['bbp_topic_subscription'] ) ) {&nbsp;</div></li><li><div>          $topic_subscribed = (bool) $_POST['bbp_topic_subscription'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get edit data</span></span></span></span></span>&nbsp;</div></li><li><div>      } elseif ( bbp_is_topic_edit() || bbp_is_reply_edit() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get current posts author</span>&nbsp;</div></li><li><div>          $post_author = bbp_get_global_post_field( 'post_author', 'raw' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Post author is not the current user</span>&nbsp;</div></li><li><div>          if ( bbp_get_current_user_id() !== $post_author ) {&nbsp;</div></li><li><div>              $topic_subscribed = bbp_is_user_subscribed_to_topic( $post_author );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Post author is the current user</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $topic_subscribed = bbp_is_user_subscribed_to_topic( bbp_get_current_user_id() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get current status</span>&nbsp;</div></li><li><div>      } elseif ( bbp_is_single_topic() ) {&nbsp;</div></li><li><div>          $topic_subscribed = bbp_is_user_subscribed_to_topic( bbp_get_current_user_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_subscribed = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Get checked output</span></span>&nbsp;</div></li><li><div>      $checked = checked( $topic_subscribed, true, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_subscribed', $checked, $topic_subscribed );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output checked value of topic log edit field</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_form_topic_log_edit() To get the topic log edit value</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_log_edit() {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_log_edit();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return checked value of topic log edit field</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_form_topic_log_edit' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        log edit value</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic log edit checked value</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_log_edit() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get _POST data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( bbp_is_post_request() && isset( $_POST['bbp_log_topic_edit'] ) ) {&nbsp;</div></li><li><div>          $topic_revision = (int) $_POST['bbp_log_topic_edit'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_revision = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Get checked output</span></span>&nbsp;</div></li><li><div>      $checked = checked( $topic_revision, true, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_log_edit', $checked, $topic_revision );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the value of the topic edit reason</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses bbp_get_form_topic_edit_reason() To get the topic edit reason value</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bbp_form_topic_edit_reason() {&nbsp;</div></li><li><div>  echo bbp_get_form_topic_edit_reason();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return the value of the topic edit reason</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since bbPress (r2976)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @uses apply_filters() Calls 'bbp_get_form_topic_edit_reason' with the</span>&nbsp;</div></li><li><div><span class="comment">   *                        topic edit reason value</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Topic edit reason value</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bbp_get_form_topic_edit_reason() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Get _POST data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( bbp_is_post_request() && isset( $_POST['bbp_topic_edit_reason'] ) ) {&nbsp;</div></li><li><div>          $topic_edit_reason = $_POST['bbp_topic_edit_reason'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// No data</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topic_edit_reason = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'bbp_get_form_topic_edit_reason', esc_attr( $topic_edit_reason ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>bbPress</li><li><span></span>2.5.9</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>