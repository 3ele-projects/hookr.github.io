<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.1.3" data-slug="polylang" data-type="class" data-id="67215"><head xmlns="http://www.w3.org/1999/xhtml"><title> pll_admin_filters_post | class | Polylang | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PLL_Admin_Filters_Post, class, plugin, polylang, 2.1.3" /><meta name="description" content="Manages filters and actions related to posts on admin side" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=8ac77a412f91763fd9fcb68545559240' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pll_admin_filters_post/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpll_admin_filters_post%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpll_admin_filters_post%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-polylang-2.1.3-class-pll_admin_filters_post","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pll_admin_filters_post" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to polylang." href="http://hookr.io/plugins/polylang/" class="plugin"><span property="name">polylang</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.1.3." href="http://hookr.io/plugins/polylang/2.1.3/" class="H_VERSION"><span property="name">2.1.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/polylang/2.1.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pll_admin_filters_post</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="232"><a href="http://hookr.io/plugins/polylang/2.1.3/all/" title="All">All <span class="count badge">232</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/polylang/2.1.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="87"><a href="http://hookr.io/plugins/polylang/2.1.3/hooks/" title="Hooks">Hooks <span class="count badge">87</span></a></li><li class="" data-id="action" data-count="22"><a href="http://hookr.io/plugins/polylang/2.1.3/actions/" title="Actions">Actions <span class="count badge">22</span></a></li><li class="" data-id="filter" data-count="65"><a href="http://hookr.io/plugins/polylang/2.1.3/filters/" title="Filters">Filters <span class="count badge">65</span></a></li><li class="active" data-id="class" data-count="81"><a href="http://hookr.io/plugins/polylang/2.1.3/classes/" title="Classes">Classes <span class="count badge">81</span></a></li><li class="" data-id="constant" data-count="21"><a href="http://hookr.io/plugins/polylang/2.1.3/constants/" title="Constants">Constants <span class="count badge">21</span></a></li><li class="" data-id="function" data-count="43"><a href="http://hookr.io/plugins/polylang/2.1.3/functions/" title="Functions">Functions <span class="count badge">43</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/polylang/2.1.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PLL_Admin_Filters_Post</strong></h1><p>Manages filters and actions related to posts on admin side.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/polylang/2.1.3/files/admin-admin-filters-post/" class="file">/admin/admin-filters-post.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="8" class="block" start="8"><li><div>class PLL_Admin_Filters_Post extends PLL_Admin_Filters_Post_Base {&nbsp;</div></li><li><div>    public $options, $curlang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor: setups filters and actions&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $polylang&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct( &$polylang ) {&nbsp;</div></li><li><div>        parent::__construct( $polylang );&nbsp;</div></li><li><div>        $this-&gt;options = &$polylang-&gt;options;&nbsp;</div></li><li><div>        $this-&gt;curlang = &$polylang-&gt;curlang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'admin_enqueue_scripts', array( $this, 'admin_enqueue_scripts' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filters posts, pages and media by language&nbsp;</div></li><li><div>        add_action( 'parse_query', array( $this, 'parse_query' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Adds the Languages box in the 'Edit Post' and 'Edit Page' panels&nbsp;</div></li><li><div>        add_action( 'add_meta_boxes', array( $this, 'add_meta_boxes' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Ajax response for changing the language in the post metabox&nbsp;</div></li><li><div>        add_action( 'wp_ajax_post_lang_choice', array( $this, 'post_lang_choice' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_pll_posts_not_translated', array( $this, 'ajax_posts_not_translated' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Adds actions and filters related to languages when creating, saving or deleting posts and pages&nbsp;</div></li><li><div>        add_action( 'save_post', array( $this, 'save_post' ), 21, 3 ); // Priority 21 to come after advanced custom fields ( 20 ) and before the event calendar which breaks everything after 25&nbsp;</div></li><li><div>        add_filter( 'wp_insert_post_parent', array( $this, 'wp_insert_post_parent' ), 10, 4 );&nbsp;</div></li><li><div>        add_action( 'before_delete_post', array( $this, 'delete_post' ) );&nbsp;</div></li><li><div>        if ( $this-&gt;options['media_support'] ) {&nbsp;</div></li><li><div>            add_action( 'delete_attachment', array( $this, 'delete_post' ) ); // Action shared with media&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filters the pages by language in the parent dropdown list in the page attributes metabox&nbsp;</div></li><li><div>        add_filter( 'page_attributes_dropdown_pages_args', array( $this, 'page_attributes_dropdown_pages_args' ), 10, 2 );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Outputs a javascript list of terms ordered by language and hierarchical taxonomies&nbsp;</div></li><li><div>     * to filter the category checklist per post language in quick edit&nbsp;</div></li><li><div>     * Outputs a javascript list of pages ordered by language&nbsp;</div></li><li><div>     * to filter the parent dropdown per post language in quick edit&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_enqueue_scripts() {&nbsp;</div></li><li><div>        $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Hierarchical taxonomies&nbsp;</div></li><li><div>        if ( 'edit' == $screen-&gt;base && $taxonomies = get_object_taxonomies( $screen-&gt;post_type, 'object' ) ) {&nbsp;</div></li><li><div>            // Get translated hierarchical taxonomies&nbsp;</div></li><li><div>            foreach ( $taxonomies as $taxonomy ) {&nbsp;</div></li><li><div>                if ( $taxonomy-&gt;hierarchical && $taxonomy-&gt;show_in_quick_edit && $this-&gt;model-&gt;is_translated_taxonomy( $taxonomy-&gt;name ) ) {&nbsp;</div></li><li><div>                    $hierarchical_taxonomies[] = $taxonomy-&gt;name;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $hierarchical_taxonomies ) ) {&nbsp;</div></li><li><div>                $terms = get_terms( $hierarchical_taxonomies, array( 'get' =&gt; 'all' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                    if ( $lang = $this-&gt;model-&gt;term-&gt;get_language( $term-&gt;term_id ) ) {&nbsp;</div></li><li><div>                        $term_languages[ $lang-&gt;slug ][ $term-&gt;taxonomy ][] = $term-&gt;term_id;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Send all these data to javascript&nbsp;</div></li><li><div>                if ( ! empty( $term_languages ) ) {&nbsp;</div></li><li><div>                    wp_localize_script( 'pll_post', 'pll_term_languages', $term_languages );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Hierarchical post types&nbsp;</div></li><li><div>        if ( 'edit' == $screen-&gt;base && is_post_type_hierarchical( $screen-&gt;post_type ) ) {&nbsp;</div></li><li><div>            $pages = get_pages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $pages as $page ) {&nbsp;</div></li><li><div>                if ( $lang = $this-&gt;model-&gt;post-&gt;get_language( $page-&gt;ID ) ) {&nbsp;</div></li><li><div>                    $page_languages[ $lang-&gt;slug ][] = $page-&gt;ID;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Send all these data to javascript&nbsp;</div></li><li><div>            if ( ! empty( $page_languages ) ) {&nbsp;</div></li><li><div>                wp_localize_script( 'pll_post', 'pll_page_languages', $page_languages );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filters posts, pages and media by language&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.1&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $query a WP_Query object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_query( $query ) {&nbsp;</div></li><li><div>        $qvars = &$query-&gt;query_vars;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do not filter post types such as nav_menu_item&nbsp;</div></li><li><div>        if ( isset( $qvars['post_type'] ) && ! $this-&gt;model-&gt;is_translated_post_type( $qvars['post_type'] ) ) {&nbsp;</div></li><li><div>            unset( $qvars['lang'] );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do not filter the query if the language is already specified in another way&nbsp;</div></li><li><div>        if ( ! isset( $qvars['lang'] ) ) {&nbsp;</div></li><li><div>            $excludes = array(&nbsp;</div></li><li><div>                'p', &nbsp;</div></li><li><div>                'post_parent', &nbsp;</div></li><li><div>                'attachment', &nbsp;</div></li><li><div>                'attachment_id', &nbsp;</div></li><li><div>                'name', &nbsp;</div></li><li><div>                'pagename', &nbsp;</div></li><li><div>                'page_id', &nbsp;</div></li><li><div>                'category_name', &nbsp;</div></li><li><div>                'tag', &nbsp;</div></li><li><div>                'cat', &nbsp;</div></li><li><div>                'tag_id', &nbsp;</div></li><li><div>                'category__in', &nbsp;</div></li><li><div>                'category__and', &nbsp;</div></li><li><div>                'post__in', &nbsp;</div></li><li><div>                'post_name__in', &nbsp;</div></li><li><div>                'tag__in', &nbsp;</div></li><li><div>                'tag__and', &nbsp;</div></li><li><div>                'tag_slug__in', &nbsp;</div></li><li><div>                'tag_slug__and', &nbsp;</div></li><li><div>                'post_parent__in', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $excludes as $k ) {&nbsp;</div></li><li><div>                if ( ! empty( $qvars[ $k ] ) ) {&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $taxonomies = array_intersect( $this-&gt;model-&gt;get_translated_taxonomies(), get_taxonomies( array( '_builtin' =&gt; false ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $taxonomies as $tax ) {&nbsp;</div></li><li><div>                $tax = get_taxonomy( $tax );&nbsp;</div></li><li><div>                if ( ! empty( $qv[ $tax-&gt;query_var ] ) ) {&nbsp;</div></li><li><div>                    return;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $qvars['tax_query'] ) && is_array( $qvars['tax_query'] ) && $this-&gt;model-&gt;have_translated_taxonomy( $qvars['tax_query'] ) ) {&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Filter queries according to the current language&nbsp;</div></li><li><div>            if ( isset( $qvars['post_type'] ) && ! empty( $this-&gt;curlang ) ) {&nbsp;</div></li><li><div>                $qvars['lang'] = $this-&gt;curlang-&gt;slug;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $qvars['lang'] ) && 'all' === $qvars['lang'] ) {&nbsp;</div></li><li><div>            unset( $qvars['lang'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds the Language box in the 'Edit Post' and 'Edit Page' panels ( as well as in custom post types panels )&nbsp;</div></li><li><div>     * Removes the editor for translations of the pages for posts&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.1&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $post_type&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_meta_boxes( $post_type, $post ) {&nbsp;</div></li><li><div>        if ( $this-&gt;model-&gt;is_translated_post_type( $post_type ) ) {&nbsp;</div></li><li><div>            add_meta_box( 'ml_box', __( 'Languages', 'polylang' ), array( $this, 'post_language' ), $post_type, 'side', 'high' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( $page_for_posts = get_option( 'page_for_posts' ) ) && ( $translations = $this-&gt;model-&gt;post-&gt;get_translations( $page_for_posts ) ) && in_array( $post-&gt;ID, $translations ) &&  empty( $post-&gt;post_content ) ) {&nbsp;</div></li><li><div>            add_action( 'edit_form_after_title', '_wp_posts_page_notice' );&nbsp;</div></li><li><div>            remove_post_type_support( $post_type, 'editor' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Displays the Languages metabox in the 'Edit Post' and 'Edit Page' panels&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function post_language() {&nbsp;</div></li><li><div>        global $post_ID;&nbsp;</div></li><li><div>        $post_id = $post_ID;&nbsp;</div></li><li><div>        $post_type = get_post_type( $post_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lang = ( $lg = $this-&gt;model-&gt;post-&gt;get_language( $post_ID ) ) ? $lg :&nbsp;</div></li><li><div>            ( isset( $_GET['new_lang'] ) ? $this-&gt;model-&gt;get_language( $_GET['new_lang'] ) :&nbsp;</div></li><li><div>            $this-&gt;pref_lang );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $dropdown = new PLL_Walker_Dropdown();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_nonce_field( 'pll_language', '_pll_nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // NOTE: the class &quot;tags-input&quot; allows to include the field in the autosave $_POST ( see autosave.js )&nbsp;</div></li><li><div>        printf( '&nbsp;</div></li><li><div>            &lt;p&gt;&lt;strong&gt;%1$s&lt;/strong&gt;&lt;/p&gt;&nbsp;</div></li><li><div>            &lt;label class=&quot;screen-reader-text&quot; for=&quot;%2$s&quot;&gt;%1$s&lt;/label&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;select-%3$s-language&quot;&gt;%4$s&lt;/div&gt;', &nbsp;</div></li><li><div>            esc_html__( 'Language', 'polylang' ), &nbsp;</div></li><li><div>            $id = ( 'attachment' === $post_type ) ? sprintf( 'attachments[%d][language]', $post_ID ) : 'post_lang_choice', &nbsp;</div></li><li><div>            'attachment' === $post_type ? 'media' : 'post', &nbsp;</div></li><li><div>            $dropdown-&gt;walk( $this-&gt;model-&gt;get_languages_list(), array(&nbsp;</div></li><li><div>                'name' =&gt; $id, &nbsp;</div></li><li><div>                'class' =&gt; 'post_lang_choice tags-input', &nbsp;</div></li><li><div>                'selected' =&gt; $lang ? $lang-&gt;slug : '', &nbsp;</div></li><li><div>                'flag' =&gt; true, &nbsp;</div></li><li><div> ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Fires before displaying the list of translations in the Languages metabox for posts&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.8&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        do_action( 'pll_before_post_translations', $post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div id=&quot;post-translations&quot; class=&quot;translations&quot;&gt;';&nbsp;</div></li><li><div>        if ( $lang ) {&nbsp;</div></li><li><div>            include PLL_ADMIN_INC . '/view-translations-' . ( 'attachment' == $post_type ? 'media' : 'post' ) . '.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        echo '&lt;/div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Ajax response for changing the language in the post metabox&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function post_lang_choice() {&nbsp;</div></li><li><div>        check_ajax_referer( 'pll_language', '_pll_nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $post_ID; // Obliged to use the global variable for wp_popular_terms_checklist&nbsp;</div></li><li><div>        $post_id = $post_ID = (int) $_POST['post_id'];&nbsp;</div></li><li><div>        $lang = $this-&gt;model-&gt;get_language( $_POST['lang'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_type = $_POST['post_type'];&nbsp;</div></li><li><div>        $post_type_object = get_post_type_object( $post_type );&nbsp;</div></li><li><div>        if ( ! current_user_can( $post_type_object-&gt;cap-&gt;edit_post, $post_ID ) ) {&nbsp;</div></li><li><div>            wp_die( -1 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;model-&gt;post-&gt;set_language( $post_ID, $lang ); // Save language, useful to set the language when uploading media from post&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ob_start();&nbsp;</div></li><li><div>        if ( $lang ) {&nbsp;</div></li><li><div>            include PLL_ADMIN_INC . '/view-translations-' . ( 'attachment' == $post_type ? 'media' : 'post' ) . '.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x = new WP_Ajax_Response( array( 'what' =&gt; 'translations', 'data' =&gt; ob_get_contents() ) );&nbsp;</div></li><li><div>        ob_end_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Categories&nbsp;</div></li><li><div>        if ( isset( $_POST['taxonomies'] ) ) {&nbsp;</div></li><li><div>            // Not set for pages&nbsp;</div></li><li><div>            foreach ( $_POST['taxonomies'] as $taxname ) {&nbsp;</div></li><li><div>                $taxonomy = get_taxonomy( $taxname );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ob_start();&nbsp;</div></li><li><div>                $popular_ids = wp_popular_terms_checklist( $taxonomy-&gt;name );&nbsp;</div></li><li><div>                $supplemental['populars'] = ob_get_contents();&nbsp;</div></li><li><div>                ob_end_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ob_start();&nbsp;</div></li><li><div>                // Use $post_ID to remember ckecked terms in case we come back to the original language&nbsp;</div></li><li><div>                wp_terms_checklist( $post_ID, array( 'taxonomy' =&gt; $taxonomy-&gt;name, 'popular_cats' =&gt; $popular_ids ) );&nbsp;</div></li><li><div>                $supplemental['all'] = ob_get_contents();&nbsp;</div></li><li><div>                ob_end_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $supplemental['dropdown'] = wp_dropdown_categories( array(&nbsp;</div></li><li><div>                    'taxonomy' =&gt; $taxonomy-&gt;name, &nbsp;</div></li><li><div>                    'hide_empty' =&gt; 0, &nbsp;</div></li><li><div>                    'name' =&gt; 'new'.$taxonomy-&gt;name.'_parent', &nbsp;</div></li><li><div>                    'orderby' =&gt; 'name', &nbsp;</div></li><li><div>                    'hierarchical' =&gt; 1, &nbsp;</div></li><li><div>                    'show_option_none' =&gt; '&mdash; '.$taxonomy-&gt;labels-&gt;parent_item.' &mdash;', &nbsp;</div></li><li><div>                    'echo' =&gt; 0, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $x-&gt;Add( array( 'what' =&gt; 'taxonomy', 'data' =&gt; $taxonomy-&gt;name, 'supplemental' =&gt; $supplemental ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Parent dropdown list ( only for hierarchical post types )&nbsp;</div></li><li><div>        if ( in_array( $post_type, get_post_types( array( 'hierarchical' =&gt; true ) ) ) ) {&nbsp;</div></li><li><div>            $post = get_post( $post_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Args and filter from 'page_attributes_meta_box' in wp-admin/includes/meta-boxes.php of WP 4.2.1&nbsp;</div></li><li><div>            $dropdown_args = array(&nbsp;</div></li><li><div>                'post_type' =&gt; $post-&gt;post_type, &nbsp;</div></li><li><div>                'exclude_tree' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>                'selected' =&gt; $post-&gt;post_parent, &nbsp;</div></li><li><div>                'name' =&gt; 'parent_id', &nbsp;</div></li><li><div>                'show_option_none' =&gt; __( '(no parent)' ), &nbsp;</div></li><li><div>                'sort_column' =&gt; 'menu_order, post_title', &nbsp;</div></li><li><div>                'echo' =&gt; 0, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /** This filter is documented in wp-admin/includes/meta-boxes.php */&nbsp;</div></li><li><div>            $dropdown_args = apply_filters( 'page_attributes_dropdown_pages_args', $dropdown_args, $post ); // Since WP 3.3&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $x-&gt;Add( array( 'what' =&gt; 'pages', 'data' =&gt; wp_dropdown_pages( $dropdown_args ) ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Flag&nbsp;</div></li><li><div>        $x-&gt;Add( array( 'what' =&gt; 'flag', 'data' =&gt; empty( $lang-&gt;flag ) ? esc_html( $lang-&gt;slug ) : $lang-&gt;flag ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Sample permalink&nbsp;</div></li><li><div>        $x-&gt;Add( array( 'what' =&gt; 'permalink', 'data' =&gt; get_sample_permalink_html( $post_ID ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x-&gt;send();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Ajax response for input in translation autocomplete input box&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function ajax_posts_not_translated() {&nbsp;</div></li><li><div>        check_ajax_referer( 'pll_language', '_pll_nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! post_type_exists( $_GET['post_type'] ) ) {&nbsp;</div></li><li><div>            die( 0 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_language = $this-&gt;model-&gt;get_language( $_GET['post_language'] );&nbsp;</div></li><li><div>        $translation_language = $this-&gt;model-&gt;get_language( $_GET['translation_language'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Don't order by title: see https://wordpress.org/support/topic/find-translated-post-when-10-is-not-enough&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>            's' =&gt; wp_unslash( $_GET['term'] ), &nbsp;</div></li><li><div>            'suppress_filters' =&gt; 0, // To make the post_fields filter work&nbsp;</div></li><li><div>            'lang' =&gt; 0, // Avoid admin language filter&nbsp;</div></li><li><div>            'numberposts' =&gt; 20, // Limit to 20 posts&nbsp;</div></li><li><div>            'post_status' =&gt; 'any', &nbsp;</div></li><li><div>            'post_type' =&gt; $_GET['post_type'], &nbsp;</div></li><li><div>            'tax_query' =&gt; array( array(&nbsp;</div></li><li><div>                'taxonomy' =&gt; 'language', &nbsp;</div></li><li><div>                'field' =&gt; 'term_taxonomy_id', // WP 3.5+&nbsp;</div></li><li><div>                'terms' =&gt; $translation_language-&gt;term_taxonomy_id, &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter the query args when auto suggesting untranslated posts in the Languages metabox&nbsp;</div></li><li><div>         * This should help plugins to fix some edge cases&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @see https://wordpress.org/support/topic/find-translated-post-when-10-is-not-enough&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.7&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $args WP_Query arguments&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $args = apply_filters( 'pll_ajax_posts_not_translated_args', $args );&nbsp;</div></li><li><div>        $posts = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $return = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $posts as $key =&gt; $post ) {&nbsp;</div></li><li><div>            if ( ! $this-&gt;model-&gt;post-&gt;get_translation( $post-&gt;ID, $post_language ) ) {&nbsp;</div></li><li><div>                $return[] = array(&nbsp;</div></li><li><div>                    'id' =&gt; $post-&gt;ID, &nbsp;</div></li><li><div>                    'value' =&gt; $post-&gt;post_title, &nbsp;</div></li><li><div>                    'link' =&gt; $this-&gt;links-&gt;edit_post_translation_link( $post-&gt;ID ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add current translation in list&nbsp;</div></li><li><div>        if ( $post_id = $this-&gt;model-&gt;post-&gt;get_translation( (int) $_GET['pll_post_id'], $translation_language ) ) {&nbsp;</div></li><li><div>            $post = get_post( $post_id );&nbsp;</div></li><li><div>            array_unshift( $return, array(&nbsp;</div></li><li><div>                'id' =&gt; $post_id, &nbsp;</div></li><li><div>                'value' =&gt; $post-&gt;post_title, &nbsp;</div></li><li><div>                'link' =&gt; $this-&gt;links-&gt;edit_post_translation_link( $post_id ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_die( json_encode( $return ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves language&nbsp;</div></li><li><div>     * Checks the terms saved are in the right language&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.5&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int   $post_id&nbsp;</div></li><li><div>     * @param array $post&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function save_language( $post_id, $post ) {&nbsp;</div></li><li><div>        // Security checks are necessary to accept language modifications as 'wp_insert_post' can be called from outside WP admin&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Edit post&nbsp;</div></li><li><div>        if ( isset( $_POST['post_lang_choice'], $_POST['post_ID'] ) && $_POST['post_ID'] == $post_id ) {&nbsp;</div></li><li><div>            check_admin_referer( 'pll_language', '_pll_nonce' );&nbsp;</div></li><li><div>            $this-&gt;model-&gt;post-&gt;set_language( $post_id, $lang = $this-&gt;model-&gt;get_language( $_POST['post_lang_choice'] ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Quick edit and bulk edit&nbsp;</div></li><li><div>        // POST for quick edit, GET for bulk edit&nbsp;</div></li><li><div>        elseif ( isset( $_REQUEST['inline_lang_choice'] ) ) {&nbsp;</div></li><li><div>            // Bulk edit does not modify the language&nbsp;</div></li><li><div>            if ( isset( $_GET['bulk_edit'] ) && -1 == $_REQUEST['inline_lang_choice'] ) {&nbsp;</div></li><li><div>                check_admin_referer( 'bulk-posts' );&nbsp;</div></li><li><div>                $lang = $this-&gt;model-&gt;post-&gt;get_language( $post_id ); // Get the post language for later use when saving terms&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // A language is set in the language dropdown&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                isset( $_GET['bulk_edit'] ) ? check_admin_referer( 'bulk-posts' ) : check_admin_referer( 'inlineeditnonce', '_inline_edit' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $old_lang = $this-&gt;model-&gt;post-&gt;get_language( $post_id ); // Stores the old  language&nbsp;</div></li><li><div>                $this-&gt;model-&gt;post-&gt;set_language( $post_id, $lang = $this-&gt;model-&gt;get_language( $_REQUEST['inline_lang_choice'] ) ); // set new language&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Checks if the new language already exists in the translation group&nbsp;</div></li><li><div>                if ( $old_lang && $old_lang-&gt;slug != $lang-&gt;slug ) {&nbsp;</div></li><li><div>                    $translations = $this-&gt;model-&gt;post-&gt;get_translations( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // If yes, separate this post from the translation group&nbsp;</div></li><li><div>                    if ( array_key_exists( $lang-&gt;slug, $translations ) ) {&nbsp;</div></li><li><div>                        $this-&gt;model-&gt;post-&gt;delete_translation( $post_id );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    elseif ( array_key_exists( $old_lang-&gt;slug, $translations ) ) {&nbsp;</div></li><li><div>                        unset( $translations[ $old_lang-&gt;slug ] );&nbsp;</div></li><li><div>                        $this-&gt;model-&gt;post-&gt;save_translations( $post_id, $translations );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Quick press&nbsp;</div></li><li><div>        // 'post-quickpress-save', 'post-quickpress-publish' = backward compatibility WP &lt; 3.8&nbsp;</div></li><li><div>        elseif ( isset( $_REQUEST['action'] ) && in_array( $_REQUEST['action'], array( 'post-quickpress-save', 'post-quickpress-publish', 'post-quickdraft-save' ) ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'add-' . $post-&gt;post_type );&nbsp;</div></li><li><div>            $this-&gt;model-&gt;post-&gt;set_language( $post_id, $lang = $this-&gt;pref_lang ); // Default language for Quick draft&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $this-&gt;set_default_language( $post_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure we get save terms in the right language (especially tags with same name in different languages)&nbsp;</div></li><li><div>        if ( ! empty( $lang ) ) {&nbsp;</div></li><li><div>            // FIXME quite a lot of queries in foreach&nbsp;</div></li><li><div>            foreach ( $this-&gt;model-&gt;get_translated_taxonomies() as $tax ) {&nbsp;</div></li><li><div>                $terms = get_the_terms( $post_id, $tax );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( is_array( $terms ) ) {&nbsp;</div></li><li><div>                    $newterms = array();&nbsp;</div></li><li><div>                    foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                        // Check if the term is in the correct language or if a translation exist ( mainly for default category )&nbsp;</div></li><li><div>                        if ( $newterm = $this-&gt;model-&gt;term-&gt;get( $term-&gt;term_id, $lang ) ) {&nbsp;</div></li><li><div>                            $newterms[] = (int) $newterm;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Or choose the correct language for tags ( initially defined by name )&nbsp;</div></li><li><div>                        elseif ( $newterm = $this-&gt;model-&gt;term_exists( $term-&gt;name, $tax, $term-&gt;parent, $lang ) ) {&nbsp;</div></li><li><div>                            $newterms[] = (int) $newterm; // Cast is important otherwise we get 'numeric' tags&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Or create the term in the correct language&nbsp;</div></li><li><div>                        elseif ( ! is_wp_error( $term_info = wp_insert_term( $term-&gt;name, $tax ) ) ) {&nbsp;</div></li><li><div>                            $newterms[] = (int) $term_info['term_id'];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    wp_set_object_terms( $post_id, $newterms, $tax );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Called when a post ( or page ) is saved, published or updated&nbsp;</div></li><li><div>     * saves languages and translations&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.1&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int    $post_id&nbsp;</div></li><li><div>     * @param object $post&nbsp;</div></li><li><div>     * @param bool   $update  Whether it is an update or not&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_post( $post_id, $post, $update ) {&nbsp;</div></li><li><div>        // Does nothing except on post types which are filterable&nbsp;</div></li><li><div>        if ( ! $this-&gt;model-&gt;is_translated_post_type( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $id = wp_is_post_revision( $post_id ) ) {&nbsp;</div></li><li><div>            $post_id = $id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Capability check&nbsp;</div></li><li><div>        // As 'wp_insert_post' can be called from outside WP admin&nbsp;</div></li><li><div>        $post_type_object = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>        if ( ( $update && current_user_can( $post_type_object-&gt;cap-&gt;edit_post, $post_id ) ) || ( ! $update && current_user_can( $post_type_object-&gt;cap-&gt;create_posts ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;save_language( $post_id, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Make sure we are saving translations only for the main post currently being edited&nbsp;</div></li><li><div>            if ( isset( $_POST['post_tr_lang'], $_POST['post_ID'] ) && $_POST['post_ID'] == $post_id ) {&nbsp;</div></li><li><div>                $translations = $this-&gt;save_translations( $post_id, $_POST['post_tr_lang'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Fires after the post language and translations are saved&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 1.2&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param int    $post_id      Post id&nbsp;</div></li><li><div>             * @param object $post         Post object&nbsp;</div></li><li><div>             * @param array  $translations The list of translations post ids&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            do_action( 'pll_save_post', $post_id, $post, empty( $translations ) ? $this-&gt;model-&gt;post-&gt;get_translations( $post_id ) : $translations );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Attempts to set a default language even if no capability&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $this-&gt;set_default_language( $post_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Make sure that the post parent is in the correct language when using bulk edit&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.8&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int   $post_parent Post parent ID.&nbsp;</div></li><li><div>     * @param int   $post_id     Post ID.&nbsp;</div></li><li><div>     * @param array $new_postarr Array of parsed post data.&nbsp;</div></li><li><div>     * @param array $postarr     Array of sanitized, but otherwise unmodified post data.&nbsp;</div></li><li><div>     * @return int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function wp_insert_post_parent( $post_parent, $post_id, $new_postarr, $postarr ) {&nbsp;</div></li><li><div>        if ( isset( $postarr['bulk_edit'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'bulk-posts' );&nbsp;</div></li><li><div>            $lang = -1 == $postarr['inline_lang_choice'] ?&nbsp;</div></li><li><div>                $this-&gt;model-&gt;post-&gt;get_language( $post_id ) :&nbsp;</div></li><li><div>                $this-&gt;model-&gt;get_language( $postarr['inline_lang_choice'] );&nbsp;</div></li><li><div>            $post_parent = $this-&gt;model-&gt;post-&gt;get_translation( $post_parent, $lang );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $post_parent;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Called when a post, page or media is deleted&nbsp;</div></li><li><div>     * Don't delete translations if this is a post revision thanks to AndyDeGroo who catched this bug&nbsp;</div></li><li><div>     * http://wordpress.org/support/topic/plugin-polylang-quick-edit-still-breaks-translation-linking-of-pages-in-072&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.1&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $post_id&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_post( $post_id ) {&nbsp;</div></li><li><div>        if ( ! wp_is_post_revision( $post_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;model-&gt;post-&gt;delete_translation( $post_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filters the pages by language in the parent dropdown list in the page attributes metabox&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.6&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array  $dropdown_args Arguments passed to wp_dropdown_pages&nbsp;</div></li><li><div>     * @param object $post&nbsp;</div></li><li><div>     * @return array Modified arguments&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function page_attributes_dropdown_pages_args( $dropdown_args, $post ) {&nbsp;</div></li><li><div>        $dropdown_args['lang'] = isset( $_POST['lang'] ) ? $this-&gt;model-&gt;get_language( $_POST['lang'] ) : $this-&gt;model-&gt;post-&gt;get_language( $post-&gt;ID ); // ajax or not ?&nbsp;</div></li><li><div>        if ( ! $dropdown_args['lang'] ) {&nbsp;</div></li><li><div>            $dropdown_args['lang'] = $this-&gt;pref_lang;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $dropdown_args;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.2</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/polylang/2.1.3/classes/pll_admin_filters_post/" class="active">2.1.3</a></li><li><a href="http://hookr.io/plugins/polylang/2.1.2/classes/pll_admin_filters_post/" class="">2.1.2</a></li><li><a href="http://hookr.io/plugins/polylang/2.1.1/classes/pll_admin_filters_post/" class="">2.1.1</a></li><li><a href="http://hookr.io/plugins/polylang/2.1/classes/pll_admin_filters_post/" class="">2.1</a></li><li><a href="http://hookr.io/plugins/polylang/2.0.9/classes/pll_admin_filters_post/" class="">2.0.9</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PLL_Admin_Filters_Post</li><li><span></span>Polylang</li><li><span></span>2.1.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>