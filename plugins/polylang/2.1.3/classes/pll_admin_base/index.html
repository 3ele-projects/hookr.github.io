<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.1.3" data-slug="polylang" data-type="class" data-id="67211"><head xmlns="http://www.w3.org/1999/xhtml"><title> pll_admin_base | class | Polylang | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PLL_Admin_Base, class, plugin, polylang, 2.1.3" /><meta name="description" content="Base class for both admin" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=a361d3bcf2bd74ba50baaaa8f61a5857' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pll_admin_base/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpll_admin_base%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpll_admin_base%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-polylang-2.1.3-class-pll_admin_base","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pll_admin_base" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to polylang." href="http://hookr.io/plugins/polylang/" class="plugin"><span property="name">polylang</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.1.3." href="http://hookr.io/plugins/polylang/2.1.3/" class="H_VERSION"><span property="name">2.1.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/polylang/2.1.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pll_admin_base</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="232"><a href="http://hookr.io/plugins/polylang/2.1.3/all/" title="All">All <span class="count badge">232</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/polylang/2.1.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="87"><a href="http://hookr.io/plugins/polylang/2.1.3/hooks/" title="Hooks">Hooks <span class="count badge">87</span></a></li><li class="" data-id="action" data-count="22"><a href="http://hookr.io/plugins/polylang/2.1.3/actions/" title="Actions">Actions <span class="count badge">22</span></a></li><li class="" data-id="filter" data-count="65"><a href="http://hookr.io/plugins/polylang/2.1.3/filters/" title="Filters">Filters <span class="count badge">65</span></a></li><li class="active" data-id="class" data-count="81"><a href="http://hookr.io/plugins/polylang/2.1.3/classes/" title="Classes">Classes <span class="count badge">81</span></a></li><li class="" data-id="constant" data-count="21"><a href="http://hookr.io/plugins/polylang/2.1.3/constants/" title="Constants">Constants <span class="count badge">21</span></a></li><li class="" data-id="function" data-count="43"><a href="http://hookr.io/plugins/polylang/2.1.3/functions/" title="Functions">Functions <span class="count badge">43</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/polylang/2.1.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PLL_Admin_Base</strong></h1><p>Base class for both admin.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/polylang/2.1.3/files/admin-admin-base/" class="file">/admin/admin-base.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="8" class="block" start="8"><li><div>class PLL_Admin_Base extends PLL_Base {&nbsp;</div></li><li><div>    public $filter_lang, $curlang, $pref_lang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads the polylang text domain&nbsp;</div></li><li><div>     * Setups actions needed on all admin pages&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.8&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $links_model&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct( &$links_model ) {&nbsp;</div></li><li><div>        parent::__construct( $links_model );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugin i18n, only needed for backend&nbsp;</div></li><li><div>        load_plugin_textdomain( 'polylang', false, basename( POLYLANG_DIR ).'/languages' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Adds the link to the languages panel in the WordPress admin menu&nbsp;</div></li><li><div>        add_action( 'admin_menu', array( $this, 'add_menus' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup js scripts and css styles&nbsp;</div></li><li><div>        add_action( 'admin_enqueue_scripts', array( $this, 'admin_enqueue_scripts' ) );&nbsp;</div></li><li><div>        add_action( 'admin_print_footer_scripts', array( $this, 'admin_print_footer_scripts' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Lingotek&nbsp;</div></li><li><div>        if ( ! defined( 'PLL_LINGOTEK_AD' ) || PLL_LINGOTEK_AD ) {&nbsp;</div></li><li><div>            require_once POLYLANG_DIR . '/lingotek/lingotek.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Setups filters and action needed on all admin pages and on plugins page&nbsp;</div></li><li><div>     * Loads the settings pages or the filters base on the request&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $links_model&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function init() {&nbsp;</div></li><li><div>        if ( ! $this-&gt;model-&gt;get_languages_list() ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;links = new PLL_Admin_Links( $this ); // FIXME needed here ?&nbsp;</div></li><li><div>        $this-&gt;static_pages = new PLL_Admin_Static_Pages( $this ); // FIXME needed here ?&nbsp;</div></li><li><div>        $this-&gt;filters_links = new PLL_Filters_Links( $this ); // FIXME needed here ?&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter admin language for users&nbsp;</div></li><li><div>        // We must not call user info before WordPress defines user roles in wp-settings.php&nbsp;</div></li><li><div>        add_filter( 'setup_theme', array( $this, 'init_user' ) );&nbsp;</div></li><li><div>        add_filter( 'request', array( $this, 'request' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Adds the languages in admin bar&nbsp;</div></li><li><div>        add_action( 'admin_bar_menu', array( $this, 'admin_bar_menu' ), 100 ); // 100 determines the position&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds the link to the languages panel in the WordPress admin menu&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_menus() {&nbsp;</div></li><li><div>        // Prepare the list of tabs&nbsp;</div></li><li><div>        $tabs = array( 'lang' =&gt; __( 'Languages', 'polylang' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only if at least one language has been created&nbsp;</div></li><li><div>        if ( $this-&gt;model-&gt;get_languages_list() ) {&nbsp;</div></li><li><div>            $tabs['strings'] = __( 'Strings translations', 'polylang' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tabs['settings'] = __( 'Settings', 'polylang' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter the list of tabs in Polylang settings&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.5.1&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $tabs list of tab names&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $tabs = apply_filters( 'pll_settings_tabs', $tabs );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $tabs as $tab =&gt; $title ) {&nbsp;</div></li><li><div>            $page = 'lang' === $tab ? 'mlang' : &quot;mlang_$tab&quot;;&nbsp;</div></li><li><div>            if ( empty( $parent ) ) {&nbsp;</div></li><li><div>                $parent = $page;&nbsp;</div></li><li><div>                add_menu_page( $title, __( 'Languages', 'polylang' ), 'manage_options', $page, null , 'dashicons-translation' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            add_submenu_page( $parent, $title, $title, 'manage_options', $page , array( $this, 'languages_page' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Setup js scripts & css styles ( only on the relevant pages )&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.6&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_enqueue_scripts() {&nbsp;</div></li><li><div>        $screen = get_current_screen();&nbsp;</div></li><li><div>        if ( empty( $screen ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $suffix = defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG ? '' : '.min';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // For each script:&nbsp;</div></li><li><div>        // 0 =&gt; the pages on which to load the script&nbsp;</div></li><li><div>        // 1 =&gt; the scripts it needs to work&nbsp;</div></li><li><div>        // 2 =&gt; 1 if loaded even if languages have not been defined yet, 0 otherwise&nbsp;</div></li><li><div>        // 3 =&gt; 1 if loaded in footer&nbsp;</div></li><li><div>        // FIXME: check if I can load more scripts in footer&nbsp;</div></li><li><div>        $scripts = array(&nbsp;</div></li><li><div>            'post' =&gt; array( array( 'post', 'media', 'async-upload', 'edit' ), array( 'jquery', 'wp-ajax-response', 'post', 'jquery-ui-autocomplete' ), 0 , 1 ), &nbsp;</div></li><li><div>            'media' =&gt; array( array( 'upload' ), array( 'jquery' ), 0 , 1 ), &nbsp;</div></li><li><div>            'term' =&gt; array( array( 'edit-tags', 'term' ), array( 'jquery', 'wp-ajax-response', 'jquery-ui-autocomplete' ), 0, 1 ), &nbsp;</div></li><li><div>            'user' =&gt; array( array( 'profile', 'user-edit' ), array( 'jquery' ), 0 , 0 ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $scripts as $script =&gt; $v ) {&nbsp;</div></li><li><div>            if ( in_array( $screen-&gt;base, $v[0] ) && ( $v[2] || $this-&gt;model-&gt;get_languages_list() ) ) {&nbsp;</div></li><li><div>                wp_enqueue_script( 'pll_' . $script, plugins_url( '/js/' . $script . $suffix . '.js', POLYLANG_FILE ), $v[1], POLYLANG_VERSION, $v[3] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_enqueue_style( 'polylang_admin', plugins_url( '/css/admin' . $suffix . '.css', POLYLANG_FILE ), array(), POLYLANG_VERSION );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets pll_ajax_backend on all backend ajax request&nbsp;</div></li><li><div>     * The final goal is to detect if an ajax request is made on admin or frontend&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Takes care to various situations:&nbsp;</div></li><li><div>     * when the ajax request has no options.data thanks to ScreenfeedFr&nbsp;</div></li><li><div>     * see: https://wordpress.org/support/topic/ajaxprefilter-may-not-work-as-expected&nbsp;</div></li><li><div>     * when options.data is a json string&nbsp;</div></li><li><div>     * see: https://wordpress.org/support/topic/polylang-breaking-third-party-ajax-requests-on-admin-panels&nbsp;</div></li><li><div>     * when options.data is an empty string (GET request with the method 'load')&nbsp;</div></li><li><div>     * see: https://wordpress.org/support/topic/invalid-url-during-wordpress-new-dashboard-widget-operation&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.4&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_print_footer_scripts() {&nbsp;</div></li><li><div>        global $post_ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = array( 'pll_ajax_backend' =&gt; 1 );&nbsp;</div></li><li><div>        if ( ! empty( $post_ID ) ) {&nbsp;</div></li><li><div>            $params = array_merge( $params, array( 'pll_post_id' =&gt; (int) $post_ID ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $str = http_build_query( $params );&nbsp;</div></li><li><div>        $arr = json_encode( $params );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>    if (typeof jQuery != 'undefined') {&nbsp;</div></li><li><div>        (function($) {&nbsp;</div></li><li><div>            $.ajaxPrefilter(function (options, originalOptions, jqXHR) {&nbsp;</div></li><li><div>                if ( -1 != options.url.indexOf( ajaxurl ) || -1 != ajaxurl.indexOf( options.url ) ) {&nbsp;</div></li><li><div>                    if ( 'undefined' === typeof options.data ) {&nbsp;</div></li><li><div>                        options.data = ( 'get' === options.type.toLowerCase() ) ? '&lt;?php echo $str;?&gt;' : &lt;?php echo $arr;?&gt;;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        if ( 'string' === typeof options.data ) {&nbsp;</div></li><li><div>                            if ( '' === options.data && 'get' === options.type.toLowerCase() ) {&nbsp;</div></li><li><div>                                options.url = options.url+'&&lt;?php echo $str;?&gt;';&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                try {&nbsp;</div></li><li><div>                                    o = $.parseJSON(options.data);&nbsp;</div></li><li><div>                                    o = $.extend(o, &lt;?php echo $arr;?&gt;);&nbsp;</div></li><li><div>                                    options.data = JSON.stringify(o);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                catch(e) {&nbsp;</div></li><li><div>                                    options.data = '&lt;?php echo $str;?&gt;&'+options.data;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            options.data = $.extend(options.data, &lt;?php echo $arr;?&gt;);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            });&nbsp;</div></li><li><div>        })(jQuery)&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&lt;/script&gt;&lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the admin current language, used to filter the content&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_current_language() {&nbsp;</div></li><li><div>        $this-&gt;curlang = $this-&gt;filter_lang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Edit Post&nbsp;</div></li><li><div>        if ( isset( $_REQUEST['pll_post_id'] ) && $lang = $this-&gt;model-&gt;post-&gt;get_language( (int) $_REQUEST['pll_post_id'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;curlang = $lang;&nbsp;</div></li><li><div>        } elseif ( 'post.php' === $GLOBALS['pagenow'] && isset( $_GET['post'] ) && is_numeric( $_GET['post'] ) && $lang = $this-&gt;model-&gt;post-&gt;get_language( (int) $_GET['post'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;curlang = $lang;&nbsp;</div></li><li><div>        } elseif ( 'post-new.php' === $GLOBALS['pagenow'] && ( empty( $_GET['post_type'] ) || $this-&gt;model-&gt;is_translated_post_type( $_GET['post_type'] ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;curlang = empty( $_GET['new_lang'] ) ? $this-&gt;pref_lang : $this-&gt;model-&gt;get_language( $_GET['new_lang'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Edit Term&nbsp;</div></li><li><div>        // FIXME 'edit-tags.php' for backward compatibility with WP &lt; 4.5&nbsp;</div></li><li><div>        elseif ( in_array( $GLOBALS['pagenow'], array( 'edit-tags.php', 'term.php' ) ) && isset( $_GET['tag_ID'] ) && $lang = $this-&gt;model-&gt;term-&gt;get_language( (int) $_GET['tag_ID'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;curlang = $lang;&nbsp;</div></li><li><div>        } elseif ( 'edit-tags.php' === $GLOBALS['pagenow'] && isset( $_GET['taxonomy'] ) && $this-&gt;model-&gt;is_translated_taxonomy( $_GET['taxonomy'] ) ) {&nbsp;</div></li><li><div>            if ( ! empty( $_GET['new_lang'] ) ) {&nbsp;</div></li><li><div>                $this-&gt;curlang = $this-&gt;model-&gt;get_language( $_GET['new_lang'] );&nbsp;</div></li><li><div>            } elseif ( empty( $this-&gt;curlang ) ) {&nbsp;</div></li><li><div>                $this-&gt;curlang = $this-&gt;pref_lang;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Ajax&nbsp;</div></li><li><div>        if ( defined( 'DOING_AJAX' ) && DOING_AJAX && ! empty( $_REQUEST['lang'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;curlang = $this-&gt;model-&gt;get_language( $_REQUEST['lang'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Defines the backend language and the admin language filter based on user preferences&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function init_user() {&nbsp;</div></li><li><div>        // Backend locale&nbsp;</div></li><li><div>        // FIXME: Backward compatibility with WP &lt; 4.7&nbsp;</div></li><li><div>        if ( version_compare( $GLOBALS['wp_version'], '4.7alpha', '&lt;' ) ) {&nbsp;</div></li><li><div>            add_filter( 'locale', array( $this, 'get_locale' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Language for admin language filter: may be empty&nbsp;</div></li><li><div>        // $_GET['lang'] is numeric when editing a language, not when selecting a new language in the filter&nbsp;</div></li><li><div>        if ( ! defined( 'DOING_AJAX' ) && ! empty( $_GET['lang'] ) && ! is_numeric( $_GET['lang'] ) && current_user_can( 'edit_user', $user_id = get_current_user_id() ) ) {&nbsp;</div></li><li><div>            update_user_meta( $user_id, 'pll_filter_content', ( $lang = $this-&gt;model-&gt;get_language( $_GET['lang'] ) ) ? $lang-&gt;slug : '' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;filter_lang = $this-&gt;model-&gt;get_language( get_user_meta( get_current_user_id(), 'pll_filter_content', true ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set preferred language for use when saving posts and terms: must not be empty&nbsp;</div></li><li><div>        $this-&gt;pref_lang = empty( $this-&gt;filter_lang ) ? $this-&gt;model-&gt;get_language( $this-&gt;options['default_lang'] ) : $this-&gt;filter_lang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter the preferred language on amin side&nbsp;</div></li><li><div>         * The preferred language is used for example to determine the language of a new post&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 1.2.3&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param object $pref_lang preferred language&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $this-&gt;pref_lang = apply_filters( 'pll_admin_preferred_language', $this-&gt;pref_lang );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;set_current_language();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inform that the admin language has been set&nbsp;</div></li><li><div>        // Only if the admin language is one of the Polylang defined language&nbsp;</div></li><li><div>        // FIXME test get_user_locale for backward compatibility with WP 4.7&nbsp;</div></li><li><div>        if ( $curlang = $this-&gt;model-&gt;get_language( function_exists( 'get_user_locale' ) ? get_user_locale() : get_locale() ) ) {&nbsp;</div></li><li><div>            // FIXME: Backward compatibility with WP &lt; 4.7&nbsp;</div></li><li><div>            if ( version_compare( $GLOBALS['wp_version'], '4.7alpha', '&lt;' ) ) {&nbsp;</div></li><li><div>                $GLOBALS['text_direction'] = $curlang-&gt;is_rtl ? 'rtl' : 'ltr'; // force text direction according to language setting&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /** This action is documented in frontend/choose-lang.php */&nbsp;</div></li><li><div>            do_action( 'pll_language_defined', $curlang-&gt;slug, $curlang );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            /** This action is documented in include/class-polylang.php */&nbsp;</div></li><li><div>            do_action( 'pll_no_language_defined' ); // to load overriden textdomains&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Avoids parsing a tax query when all languages are requested&nbsp;</div></li><li><div>     * Fixes https://wordpress.org/support/topic/notice-undefined-offset-0-in-wp-includesqueryphp-on-line-3877 introduced in WP 4.1&nbsp;</div></li><li><div>     * @see the suggestion of @boonebgorges, https://core.trac.wordpress.org/ticket/31246&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.6.5&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $qvars&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function request( $qvars ) {&nbsp;</div></li><li><div>        if ( isset( $qvars['lang'] ) && 'all' === $qvars['lang'] ) {&nbsp;</div></li><li><div>            unset( $qvars['lang'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $qvars;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the locale based on user preference&nbsp;</div></li><li><div>     * FIXME: Backward compatibility with WP &lt; 4.7&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.4&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $locale&nbsp;</div></li><li><div>     * @return string modified locale&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_locale( $locale ) {&nbsp;</div></li><li><div>        return ( $loc = get_user_meta( get_current_user_id(), 'locale', 'true' ) ) ? $loc : $locale;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds the languages list in admin bar for the admin languages filter&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 0.9&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param object $wp_admin_bar&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_bar_menu( $wp_admin_bar ) {&nbsp;</div></li><li><div>        $url = ( is_ssl() ? 'https://' : 'http://' ) . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $all_item = (object) array(&nbsp;</div></li><li><div>            'slug' =&gt; 'all', &nbsp;</div></li><li><div>            'name' =&gt; __( 'Show all languages', 'polylang' ), &nbsp;</div></li><li><div>            'flag' =&gt; '&lt;span class=&quot;ab-icon&quot;&gt;&lt;/span&gt;', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $selected = empty( $this-&gt;filter_lang ) ? $all_item : $this-&gt;filter_lang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $title = sprintf(&nbsp;</div></li><li><div>            '&lt;span class=&quot;ab-label&quot;%s&gt;%s&lt;/span&gt;', &nbsp;</div></li><li><div>            'all' === $selected-&gt;slug ? '' : sprintf( ' lang=&quot;%s&quot;', esc_attr( $selected-&gt;get_locale( 'display' ) ) ), &nbsp;</div></li><li><div>            esc_html( $selected-&gt;name )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wp_admin_bar-&gt;add_menu( array(&nbsp;</div></li><li><div>            'id' =&gt; 'languages', &nbsp;</div></li><li><div>            'title' =&gt; $selected-&gt;flag . $title, &nbsp;</div></li><li><div>            'meta' =&gt; array( 'title' =&gt; __( 'Filters content by language', 'polylang' ) ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( array_merge( array( $all_item ), $this-&gt;model-&gt;get_languages_list() ) as $lang ) {&nbsp;</div></li><li><div>            if ( $selected-&gt;slug === $lang-&gt;slug ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $wp_admin_bar-&gt;add_menu( array(&nbsp;</div></li><li><div>                'parent' =&gt; 'languages', &nbsp;</div></li><li><div>                'id' =&gt; $lang-&gt;slug, &nbsp;</div></li><li><div>                'title' =&gt; $lang-&gt;flag . esc_html( $lang-&gt;name ), &nbsp;</div></li><li><div>                'href' =&gt; esc_url( add_query_arg( 'lang', $lang-&gt;slug, remove_query_arg( 'paged', $url ) ) ), &nbsp;</div></li><li><div>                'meta' =&gt; 'all' === $lang-&gt;slug ? array() : array( 'lang' =&gt; esc_attr( $lang-&gt;get_locale( 'display' ) ) ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.8</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/polylang/2.1.3/classes/pll_admin_base/" class="active">2.1.3</a></li><li><a href="http://hookr.io/plugins/polylang/2.1.2/classes/pll_admin_base/" class="">2.1.2</a></li><li><a href="http://hookr.io/plugins/polylang/2.1.1/classes/pll_admin_base/" class="">2.1.1</a></li><li><a href="http://hookr.io/plugins/polylang/2.1/classes/pll_admin_base/" class="">2.1</a></li><li><a href="http://hookr.io/plugins/polylang/2.0.9/classes/pll_admin_base/" class="">2.0.9</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PLL_Admin_Base</li><li><span></span>Polylang</li><li><span></span>2.1.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>