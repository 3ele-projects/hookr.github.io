<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.1.50" data-slug="nextgen-gallery" data-type="class" data-id="64789"><head xmlns="http://www.w3.org/1999/xhtml"><title> c_component_registry | class | Nextgen Gallery | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="C_Component_Registry, class, plugin, nextgen-gallery, 2.1.50" /><meta name="description" content="A registry of registered products, modules, adapters, and utilities." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=362b2e8441da55d1710cfbbfd1b71a0f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/c_component_registry/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fc_component_registry%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fc_component_registry%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-nextgen-gallery-2.1.50-class-c_component_registry","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="c_component_registry" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to nextgen-gallery." href="http://hookr.io/plugins/nextgen-gallery/" class="plugin"><span property="name">nextgen-gallery</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.1.50." href="http://hookr.io/plugins/nextgen-gallery/2.1.50/" class="H_VERSION"><span property="name">2.1.50</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/nextgen-gallery/2.1.50/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">c_component_registry</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="768"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/all/" title="All">All <span class="count badge">768</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="152"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/hooks/" title="Hooks">Hooks <span class="count badge">152</span></a></li><li class="" data-id="action" data-count="46"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/actions/" title="Actions">Actions <span class="count badge">46</span></a></li><li class="" data-id="filter" data-count="106"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/filters/" title="Filters">Filters <span class="count badge">106</span></a></li><li class="active" data-id="class" data-count="368"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/classes/" title="Classes">Classes <span class="count badge">368</span></a></li><li class="" data-id="constant" data-count="170"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/constants/" title="Constants">Constants <span class="count badge">170</span></a></li><li class="" data-id="function" data-count="77"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/functions/" title="Functions">Functions <span class="count badge">77</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>C_Component_Registry</strong></h1><p>A registry of registered products, modules, adapters, and utilities.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/files/pope-lib-class-component-registry/" class="file">/pope/lib/class.component_registry.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="14" class="block" start="14"><li><div>class C_Component_Registry&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    static  $_instance = NULL;&nbsp;</div></li><li><div>    var     $_searched_paths = array();&nbsp;</div></li><li><div>    var     $_blacklist = array();&nbsp;</div></li><li><div>    var     $_meta_info = array();&nbsp;</div></li><li><div>    var     $_default_path = NULL;&nbsp;</div></li><li><div>    var     $_modules = array();&nbsp;</div></li><li><div>    var     $_products = array();&nbsp;</div></li><li><div>    var     $_adapters = array();&nbsp;</div></li><li><div>    var     $_utilities = array();&nbsp;</div></li><li><div>    var     $_module_type_cache = array();&nbsp;</div></li><li><div>    var     $_module_type_cache_count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * This is a singleton object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function __construct()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Create an autoloader&nbsp;</div></li><li><div>        spl_autoload_register(array($this, '_module_autoload'), TRUE);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a singleton&nbsp;</div></li><li><div>     * @return C_Component_Registry()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static function &get_instance()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (is_null(self::$_instance)) {&nbsp;</div></li><li><div>            $klass = get_class();&nbsp;</div></li><li><div>            self::$_instance = new $klass();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return self::$_instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function require_module_file($module_file_abspath)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // We don't include (require) module files that have the same name. This&nbsp;</div></li><li><div>        // avoids loading module.autoupdate.php from two products&nbsp;</div></li><li><div>        static $already_required = array();&nbsp;</div></li><li><div>        $relpath = basename($module_file_abspath);&nbsp;</div></li><li><div>        if (!in_array($relpath, $already_required)) {&nbsp;</div></li><li><div>            @require_once($module_file_abspath);&nbsp;</div></li><li><div>            $already_required[] = $relpath;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function has_searched_path_before($abspath)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return in_array($abspath, $this-&gt;_searched_paths);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function mark_as_searched_path($abspath)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_searched_paths[] = $abspath;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a path in the search paths for loading modules&nbsp;</div></li><li><div>     * @param string $path&nbsp;</div></li><li><div>     * @param bool $recurse - TRUE, FALSE, or the number of levels to recurse&nbsp;</div></li><li><div>     * @param bool $load_all - loads all modules found in the path&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_module_path($path, $recurse = false, $load_all = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!$recurse || (!$this-&gt;has_searched_path_before($path))) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If no default module path has been set, then set one now&nbsp;</div></li><li><div>            if ($this-&gt;get_default_module_path() == null)  {&nbsp;</div></li><li><div>                $this-&gt;set_default_module_path($path);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // We we've been passed a module file, then include it&nbsp;</div></li><li><div>            if (@file_exists($path) && is_file($path)) {&nbsp;</div></li><li><div>                $this-&gt;require_module_file($path);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Recursively find product and module files in this path&nbsp;</div></li><li><div>            else foreach ($this-&gt;find_product_and_module_files($path, $recurse) as $file_abspath) {&nbsp;</div></li><li><div>                $this-&gt;require_module_file($file_abspath);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;mark_as_searched_path($path);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($load_all) $this-&gt;load_all_modules(NULL, $path);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves the default module path (Note: this is just the generic root container path for modules)&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_default_module_path()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;_default_path;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the default module path (Note: this is just the generic root container path for modules)&nbsp;</div></li><li><div>     * @param string $path&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function set_default_module_path($path)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_default_path = $path;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves the module path&nbsp;</div></li><li><div>     * @param string $module_id&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_module_path($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_meta_info[$module_id])) {&nbsp;</div></li><li><div>            $info = $this-&gt;_meta_info[$module_id];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($info['path'])) {&nbsp;</div></li><li><div>                return $info['path'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves the module installation directory&nbsp;</div></li><li><div>     * @param string $module_id&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_module_dir($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $path = $this-&gt;get_module_path($module_id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($path != null) {&nbsp;</div></li><li><div>            return dirname($path);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function is_module_loaded($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return (isset($this-&gt;_meta_info[$module_id]) && isset($this-&gt;_meta_info[$module_id]['loaded']) && $this-&gt;_meta_info[$module_id]['loaded']);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads a module's code according to its dependency list&nbsp;</div></li><li><div>     * @param string $module_id&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_module($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $retval = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (($module = $this-&gt;get_module($module_id)) && !$this-&gt;is_module_loaded($module_id) && !$this-&gt;is_blacklisted($module_id)) {&nbsp;</div></li><li><div>            $module-&gt;load();&nbsp;</div></li><li><div>            $retval = $this-&gt;_meta_info[$module_id]['loaded'] = TRUE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $retval;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function load_all_modules($type=NULL, $dir=NULL)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $modules = $this-&gt;get_known_module_list();&nbsp;</div></li><li><div>        $ret = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($modules as $module_id)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if ($type == null || $this-&gt;get_module_meta($module_id, 'type') == $type) {&nbsp;</div></li><li><div>                if ($dir == NULL || strpos($this-&gt;get_module_dir($module_id), $dir) !== FALSE)&nbsp;</div></li><li><div>                    $ret = $this-&gt;load_module($module_id) && $ret;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $ret;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initializes a previously loaded module&nbsp;</div></li><li><div>     * @param string $module_id&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function initialize_module($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $retval = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($this-&gt;_modules[$module_id])) {&nbsp;</div></li><li><div>            $module = $this-&gt;_modules[$module_id];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;is_module_loaded($module_id) && !$module-&gt;initialized) {&nbsp;</div></li><li><div>                if (method_exists($module, 'initialize'))&nbsp;</div></li><li><div>                    $module-&gt;initialize();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $module-&gt;initialized = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $retval = TRUE;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $retval;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initializes an already loaded product&nbsp;</div></li><li><div>     * @param string $product_id&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function initialize_product($product_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;initialize_module($product_id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initializes all previously loaded modules&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function initialize_all_modules()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $module_list = $this-&gt;get_loaded_module_list();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($module_list as $module_id)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;initialize_module($module_id);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds an already loaded module to the registry&nbsp;</div></li><li><div>     * @param string $module_id&nbsp;</div></li><li><div>     * @param C_Base_Module $module_object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_module($module_id, $module_object)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!isset($this-&gt;_modules[$module_id])) {&nbsp;</div></li><li><div>            $this-&gt;_modules[$module_id] = $module_object;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!isset($this-&gt;_meta_info[$module_id])) {&nbsp;</div></li><li><div>            $klass = new ReflectionClass($module_object);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;_meta_info[$module_id] = array(&nbsp;</div></li><li><div>                'path' =&gt;  $klass-&gt;getFileName(), &nbsp;</div></li><li><div>                'type' =&gt;  $klass-&gt;isSubclassOf('C_Base_Product') ? 'product' : 'module', &nbsp;</div></li><li><div>                'loaded' =&gt;  FALSE&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes an already loaded module from the registry&nbsp;</div></li><li><div>     * @param string $module_id&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function del_module($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_modules[$module_id])) {&nbsp;</div></li><li><div>            unset($this-&gt;_modules[$module_id]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves the instance of the registered module. Note: it's the instance of the module object, so the module needs to be loaded or this function won't return anything. For module info returned by scanning (with add_module_path), look at get_module_meta&nbsp;</div></li><li><div>     * @param string $module_id&nbsp;</div></li><li><div>     * @return C_Base_Module&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_module($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_modules[$module_id])) {&nbsp;</div></li><li><div>            return $this-&gt;_modules[$module_id];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_module_meta($module_id, $meta_name)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $meta = $this-&gt;get_module_meta_list($module_id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($meta[$meta_name])) {&nbsp;</div></li><li><div>            return $meta[$meta_name];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_module_meta_list($module_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_meta_info[$module_id])) {&nbsp;</div></li><li><div>            return $this-&gt;_meta_info[$module_id];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a list of instantiated module ids, in their &quot;loaded&quot; order as defined by a product&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_module_list($for_product_id=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $retval = $module_list = array();&nbsp;</div></li><li><div>        // As of May 1, 2015, there's a new standard. A product will provide get_provided_modules() and get_modules_to_load().&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // As of Feb 10, 2015, there's no standard way across Pope products to an &quot;ordered&quot; list of modules&nbsp;</div></li><li><div>        // that the product provides.&nbsp;</div></li><li><div>        //&nbsp;</div></li><li><div>        // The &quot;standard&quot; going forward will insist that all Product classes will provide either:&nbsp;</div></li><li><div>        // A) a static property called &quot;modules&quot;&nbsp;</div></li><li><div>        // B) an instance method called &quot;define_modules&quot;, which returns a list of modules, and as well, sets&nbsp;</div></li><li><div>        //    a static property called &quot;modules'.&nbsp;</div></li><li><div>        //&nbsp;</div></li><li><div>        // IMPORTANT!&nbsp;</div></li><li><div>        // The Photocrati Theme, as of version 4.1.8, doesn't follow this standard. But both NextGEN Pro and Plus do.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Following the standard above, collect all modules provided by a product&nbsp;</div></li><li><div>        $problematic_product_id = FALSE;&nbsp;</div></li><li><div>        foreach ($this-&gt;get_product_list() as $product_id) {&nbsp;</div></li><li><div>            $modules = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Try getting the list of modules using the &quot;standard&quot; described above&nbsp;</div></li><li><div>            $obj = $this-&gt;get_product($product_id);&nbsp;</div></li><li><div>            try{&nbsp;</div></li><li><div>                $klass = new ReflectionClass($obj);&nbsp;</div></li><li><div>                if ($klass-&gt;hasMethod('get_modules_to_load')) {&nbsp;</div></li><li><div>                    $modules = $obj-&gt;get_modules_provided();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ($klass-&gt;hasProperty('modules')) {&nbsp;</div></li><li><div>                    $modules = $klass-&gt;getStaticPropertyValue('modules');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (!$modules && $klass-&gt;hasMethod('define_modules')) {&nbsp;</div></li><li><div>                    $modules = $obj-&gt;define_modules();&nbsp;</div></li><li><div>                    if ($klass-&gt;hasProperty('modules')) {&nbsp;</div></li><li><div>                        $modules = $klass-&gt;getStaticPropertyValue('modules');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // We've encountered a product that doesn't follow the standard. For these exceptions, we'll have to&nbsp;</div></li><li><div>                // make an educated guess - if the module path is in the product's default module path, we know that&nbsp;</div></li><li><div>                // it belongs to the product&nbsp;</div></li><li><div>            catch (ReflectionException $ex) {&nbsp;</div></li><li><div>                $modules = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!$modules) {&nbsp;</div></li><li><div>                $product_path = $this-&gt;get_product_module_path($product_id);&nbsp;</div></li><li><div>                foreach ($this-&gt;_modules as $module_id =&gt; $module) {&nbsp;</div></li><li><div>                    if (strpos($this-&gt;get_module_path($module_id), $product_path) !== FALSE) {&nbsp;</div></li><li><div>                        $modules[] = $module_id;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!$modules) $problematic_product_id = $product_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $module_list[$product_id] = $modules;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we have a problematic product, that is, one that we can't find it's ordered list of modules&nbsp;</div></li><li><div>        // that it provides, then we have one last fallback: get a list of modules that Pope is aware of, but hasn't&nbsp;</div></li><li><div>        // added to $module_list[$product_id] yet&nbsp;</div></li><li><div>        if ($problematic_product_id) {&nbsp;</div></li><li><div>            $modules = array();&nbsp;</div></li><li><div>            foreach (array_keys($this-&gt;_modules) as $module_id) {&nbsp;</div></li><li><div>                $assigned = FALSE;&nbsp;</div></li><li><div>                foreach (array_keys($module_list) as $product_id) {&nbsp;</div></li><li><div>                    if (in_array($module_id, $module_list[$product_id])) {&nbsp;</div></li><li><div>                        $assigned =TRUE;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!$assigned) $modules[] = $module_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $module_list[$problematic_product_id] = $modules;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Now that we know which products provide which modules, we can serve the request.&nbsp;</div></li><li><div>        if (!$for_product_id) {&nbsp;</div></li><li><div>            foreach (array_values($module_list) as $modules) {&nbsp;</div></li><li><div>                $retval = array_merge($retval, $modules);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else $retval = $module_list[$for_product_id];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Final fallback...if all else fails, just return the list of all modules&nbsp;</div></li><li><div>        // that Pope is aware of&nbsp;</div></li><li><div>        if (!$retval) $retval = array_keys($this-&gt;_modules);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $retval;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_loaded_module_list()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $retval = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($this-&gt;get_module_list() as $module_id) {&nbsp;</div></li><li><div>            if ($this-&gt;is_module_loaded($module_id)) $retval[] = $module_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $retval;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a list of registered module ids, including those that aren't loaded (i.e. get_module() call with those unloaded ids will fail)&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_known_module_list()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return array_keys($this-&gt;_meta_info);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function load_product($product_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;load_module($product_id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function load_all_products()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;load_all_modules('product');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds an already loaded product in the registry&nbsp;</div></li><li><div>     * @param string $product_id&nbsp;</div></li><li><div>     * @param C_Base_Module $product_object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_product($product_id, $product_object)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!isset($this-&gt;_products[$product_id])) {&nbsp;</div></li><li><div>            $this-&gt;_products[$product_id] = $product_object;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes an already loaded product from the registry&nbsp;</div></li><li><div>     * @param string $product_id&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function del_product($product_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_products[$product_id])) {&nbsp;</div></li><li><div>            unset($this-&gt;_products[$product_id]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves the instance of the registered product&nbsp;</div></li><li><div>     * @param string $product_id&nbsp;</div></li><li><div>     * @return C_Base_Module&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_product($product_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_products[$product_id])) {&nbsp;</div></li><li><div>            return $this-&gt;_products[$product_id];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_product_meta($product_id, $meta_name)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $meta = $this-&gt;get_product_meta_list($product_id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($meta[$meta_name])) {&nbsp;</div></li><li><div>            return $meta[$meta_name];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_product_meta_list($product_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_meta_info[$product_id]) && $this-&gt;_meta_info[$product_id]['type'] == 'product') {&nbsp;</div></li><li><div>            return $this-&gt;_meta_info[$product_id];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves the module installation path for a specific product (Note: this is just the generic root container path for modules of this product)&nbsp;</div></li><li><div>     * @param string $product_id&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_product_module_path($product_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_meta_info[$product_id])) {&nbsp;</div></li><li><div>            $info = $this-&gt;_meta_info[$product_id];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($info['product-module-path'])) {&nbsp;</div></li><li><div>                return $info['product-module-path'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function blacklist_module_file($relpath)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!in_array($relpath, $this-&gt;_blacklist)) $this-&gt;_blacklist[] = $relpath;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function is_blacklisted($filename)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return in_array($filename, $this-&gt;_blacklist);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the module installation path for a specific product (Note: this is just the generic root container path for modules of this product)&nbsp;</div></li><li><div>     * @param string $product_id&nbsp;</div></li><li><div>     * @param string $module_path&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function set_product_module_path($product_id, $module_path)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_meta_info[$product_id])) {&nbsp;</div></li><li><div>            $this-&gt;_meta_info[$product_id]['product-module-path'] = $module_path;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a list of instantiated product ids&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_product_list()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return array_keys($this-&gt;_products);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves a list of registered product ids, including those that aren't loaded (i.e. get_product() call with those unloaded ids will fail)&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_known_product_list()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $list = array_keys($this-&gt;_meta_info);&nbsp;</div></li><li><div>        $return = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($list as $module_id)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if ($this-&gt;get_product_meta_list($module_id) != null)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $return[] = $module_id;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Registers an adapter for an interface with specific contexts&nbsp;</div></li><li><div>     * @param string $interface&nbsp;</div></li><li><div>     * @param string $class&nbsp;</div></li><li><div>     * @param array $contexts&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_adapter($interface, $class, $contexts=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // If no specific contexts are given, then we assume&nbsp;</div></li><li><div>        // that the adapter is to be applied in ALL contexts&nbsp;</div></li><li><div>        if (!$contexts) $contexts = array('all');&nbsp;</div></li><li><div>        if (!is_array($contexts)) $contexts = array($contexts);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!isset($this-&gt;_adapters[$interface])) {&nbsp;</div></li><li><div>            $this-&gt;_adapters[$interface] = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Iterate through each specific context&nbsp;</div></li><li><div>        foreach ($contexts as $context) {&nbsp;</div></li><li><div>            if (!isset($this-&gt;_adapters[$interface][$context])) {&nbsp;</div></li><li><div>                $this-&gt;_adapters[$interface][$context] = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;_adapters[$interface][$context][] = $class;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Removes an adapter for an interface. May optionally specifify what&nbsp;</div></li><li><div>     * contexts to remove the adapter from, leaving the rest intact&nbsp;</div></li><li><div>     * @param string $interface&nbsp;</div></li><li><div>     * @param string $class&nbsp;</div></li><li><div>     * @param array $contexts&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function del_adapter($interface, $class, $contexts=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Ensure that contexts is an array of contexts&nbsp;</div></li><li><div>        if (!$contexts) $contexts = array('all');&nbsp;</div></li><li><div>        if (!is_array($contexts)) $contexts = array($contexts);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Iterate through each context for an adapter&nbsp;</div></li><li><div>        foreach ($this-&gt;_adapters[$interface] as $context =&gt; $classes) {&nbsp;</div></li><li><div>            if (!$context OR in_array($context, $contexts)) {&nbsp;</div></li><li><div>                $index = array_search($class, $classes);&nbsp;</div></li><li><div>                unset($this-&gt;_adapters[$interface][$context][$index]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Apply adapters registered for the component&nbsp;</div></li><li><div>     * @param C_Component $component&nbsp;</div></li><li><div>     * @return C_Component&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function &apply_adapters(C_Component &$component)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Iterate through each adapted interface. If the component implements&nbsp;</div></li><li><div>        // the interface, then apply the adapters&nbsp;</div></li><li><div>        foreach ($this-&gt;_adapters as $interface =&gt; $contexts) {&nbsp;</div></li><li><div>            if ($component-&gt;implements_interface($interface)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Determine what context apply to the current component&nbsp;</div></li><li><div>                $applied_contexts = array('all');&nbsp;</div></li><li><div>                if ($component-&gt;context) {&nbsp;</div></li><li><div>                    $applied_contexts[] = $component-&gt;context;&nbsp;</div></li><li><div>                    $applied_contexts = $this-&gt;_flatten_array($applied_contexts);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Iterate through each of the components contexts and apply the&nbsp;</div></li><li><div>                // registered adapters&nbsp;</div></li><li><div>                foreach ($applied_contexts as $context) {&nbsp;</div></li><li><div>                    if (isset($contexts[$context])) {&nbsp;</div></li><li><div>                        foreach ($contexts[$context] as $adapter) {&nbsp;</div></li><li><div>                            $component-&gt;add_mixin($adapter, FALSE);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $component;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a utility for an interface, to be used in particular contexts&nbsp;</div></li><li><div>     * @param string $interface&nbsp;</div></li><li><div>     * @param string $class&nbsp;</div></li><li><div>     * @param array $contexts&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_utility($interface, $class, $contexts=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // If no specific contexts are given, then we assume&nbsp;</div></li><li><div>        // that the utility is for ALL contexts&nbsp;</div></li><li><div>        if (!$contexts) $contexts = array('all');&nbsp;</div></li><li><div>        if (!is_array($contexts)) $contexts = array($contexts);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!isset($this-&gt;_utilities[$interface])) {&nbsp;</div></li><li><div>            $this-&gt;_utilities[$interface] = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the utility for each appropriate context&nbsp;</div></li><li><div>        foreach ($contexts as $context) {&nbsp;</div></li><li><div>            $this-&gt;_utilities[$interface][$context] = $class;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes a registered utility for a particular interface.&nbsp;</div></li><li><div>     * @param string $interface&nbsp;</div></li><li><div>     * @param array $contexts&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function del_utility($interface, $contexts=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!$contexts) $contexts = array('all');&nbsp;</div></li><li><div>        if (!is_array($contexts)) $contexts = array($contexts);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Iterate through each context for an interface&nbsp;</div></li><li><div>        foreach ($this-&gt;_utilities[$interface] as $context =&gt; $class) {&nbsp;</div></li><li><div>            if (!$context OR in_array($context, $contexts)) {&nbsp;</div></li><li><div>                unset($this-&gt;_utilities[$interface][$context]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the class name of the component providing a utility implementation&nbsp;</div></li><li><div>     * @param string $interface&nbsp;</div></li><li><div>     * @param string|array $context&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_utility_class_name($interface, $context=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;_retrieve_utility_class($interface, $context);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieves an instantiates the registered utility for the provided instance.&nbsp;</div></li><li><div>     * The instance is a singleton and must provide the get_instance() method&nbsp;</div></li><li><div>     * @param string $interface&nbsp;</div></li><li><div>     * @param string $context&nbsp;</div></li><li><div>     * @return C_Component&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_utility($interface, $context=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!$context) $context='all';&nbsp;</div></li><li><div>        $class = $this-&gt;_retrieve_utility_class($interface, $context);&nbsp;</div></li><li><div>        return call_user_func(&quot;{$class}::get_instance&quot;, $context);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flattens an array of arrays to a single array&nbsp;</div></li><li><div>     * @param array $array&nbsp;</div></li><li><div>     * @param array $parent (optional)&nbsp;</div></li><li><div>     * @param bool $exclude_duplicates (optional - defaults to TRUE)&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _flatten_array($array, $parent=NULL, $exclude_duplicates=TRUE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (is_array($array)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // We're to add each element to the parent array&nbsp;</div></li><li><div>            if ($parent) {&nbsp;</div></li><li><div>                foreach ($array as $index =&gt; $element) {&nbsp;</div></li><li><div>                    foreach ($this-&gt;_flatten_array($array) as $sub_element) {&nbsp;</div></li><li><div>                        if ($exclude_duplicates) {&nbsp;</div></li><li><div>                            if (!in_array($sub_element, $parent)) {&nbsp;</div></li><li><div>                                $parent[] = $sub_element;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else $parent[] = $sub_element;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $array = $parent;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // We're starting the process..&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $index = 0;&nbsp;</div></li><li><div>                while (isset($array[$index])) {&nbsp;</div></li><li><div>                    $element = $array[$index];&nbsp;</div></li><li><div>                    if (is_array($element)) {&nbsp;</div></li><li><div>                        $array = $this-&gt;_flatten_array($element, $array);&nbsp;</div></li><li><div>                        unset($array[$index]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $index += 1;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $array = array_values($array);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $array = array($array);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function find_product_and_module_files($abspath, $recursive=FALSE)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $retval = array();&nbsp;</div></li><li><div>        static $recursive_level = 0;&nbsp;</div></li><li><div>        $recursive_level++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $abspath = str_replace(array('\\', '/'), DIRECTORY_SEPARATOR, $abspath);&nbsp;</div></li><li><div>        $contents = @scandir($abspath);&nbsp;</div></li><li><div>        if ($contents) foreach ($contents as $filename) {&nbsp;</div></li><li><div>            if ($filename == '.' || $filename == '..' || $filename == 'error_log') continue;&nbsp;</div></li><li><div>            $filename_abspath = $abspath.DIRECTORY_SEPARATOR.$filename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Is this a subdirectory?&nbsp;</div></li><li><div>            // We don't use is_dir(), as it's less efficient than just checking for a 'dot' in the filename.&nbsp;</div></li><li><div>            // The problem is that we're assuming that our directories won't contain a 'dot'.&nbsp;</div></li><li><div>            if ($recursive && strpos($filename, '.') === FALSE) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // The recursive parameter can either be set to TRUE or the number of levels to navigate&nbsp;</div></li><li><div>                // If we reach the max number of recursive levels we're supported to navigate, then we try&nbsp;</div></li><li><div>                // to guess if there's a module or product file under the directory with the same name as&nbsp;</div></li><li><div>                // the directory&nbsp;</div></li><li><div>                if ($recursive === TRUE || (is_int($recursive) && $recursive_level &lt;= $recursive)) {&nbsp;</div></li><li><div>                    $retval = array_merge($retval, $this-&gt;find_product_and_module_files($filename_abspath, $recursive));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                elseif (@file_exists(($module_abspath = $filename_abspath.DIRECTORY_SEPARATOR.'module.'.$filename.'.php'))) {&nbsp;</div></li><li><div>                    $filename = 'module.'.$filename.'.php';&nbsp;</div></li><li><div>                    $filename_abspath = $module_abspath;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif (@file_exists(($product_abspath = $filename_abspath.DIRECTORY_SEPARATOR.'product.'.$filename.'.php'))) {&nbsp;</div></li><li><div>                    $filename = 'product.'.$filename.'.php';&nbsp;</div></li><li><div>                    $filename_abspath = $module_abspath;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>             if ((strpos($filename, 'module.') === 0 OR strpos($filename, 'product.') === 0) AND !$this-&gt;is_blacklisted($filename)) {&nbsp;</div></li><li><div>                $retval[] = $filename_abspath;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;mark_as_searched_path($abspath);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $recursive_level--;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $retval;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Private API method. Retrieves the class which currently provides the utility&nbsp;</div></li><li><div>     * @param string $interface&nbsp;</div></li><li><div>     * @param string $context&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _retrieve_utility_class($interface, $context='all')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $class = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$context) $context = 'all';&nbsp;</div></li><li><div>        if (isset($this-&gt;_utilities[$interface])) {&nbsp;</div></li><li><div>            if (isset($this-&gt;_utilities[$interface][$context])) {&nbsp;</div></li><li><div>                $class = $this-&gt;_utilities[$interface][$context];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // No utility defined for the specified interface&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                if ($context == 'all') $context = 'default';&nbsp;</div></li><li><div>                $class = $this-&gt;_retrieve_utility_class($interface, FALSE);&nbsp;</div></li><li><div>                if (!$class)&nbsp;</div></li><li><div>                    throw new Exception(&quot;No utility registered for `{$interface}` with the `{$context}` context.&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else throw new Exception(&quot;No utilities registered for `{$interface}`&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $class;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Autoloads any classes, interfaces, or adapters needed by this module&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _module_autoload($name)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Pope classes are always prefixed&nbsp;</div></li><li><div>        if (strpos($name, 'C_') !== 0 && strpos($name, 'A_') !== 0 && strpos($name, 'Mixin_') !== 0) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;_module_type_cache == null || count($this-&gt;_modules) &gt; $this-&gt;_module_type_cache_count)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;_module_type_cache_count = count($this-&gt;_modules);&nbsp;</div></li><li><div>            $modules = $this-&gt;_modules;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $keys = array();&nbsp;</div></li><li><div>            foreach ($modules as $mod =&gt; $properties) $keys[$mod] = $properties-&gt;module_version;&nbsp;</div></li><li><div>            if (!($this-&gt;_module_type_cache = C_Pope_Cache::get($keys, array()))) {&nbsp;</div></li><li><div>                foreach ($modules as $module_id =&gt; $module)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $dir = $this-&gt;get_module_dir($module_id);&nbsp;</div></li><li><div>                    $type_list = $module-&gt;get_type_list();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach ($type_list as $type =&gt; $filename)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $this-&gt;_module_type_cache[strtolower($type)] = $dir . DIRECTORY_SEPARATOR . $filename;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                C_Pope_Cache::set($keys, $this-&gt;_module_type_cache);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif (is_object($this-&gt;_module_type_cache)) $this-&gt;_module_type_cache = get_object_vars($this-&gt;_module_type_cache);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = strtolower($name);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($this-&gt;_module_type_cache[$name]))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $module_filename = $this-&gt;_module_type_cache[$name];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (file_exists($module_filename))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                require_once($module_filename);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.1.50</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/classes/c_component_registry/" class="">2.2.3</a></li><li><a href="http://hookr.io/plugins/nextgen-gallery/2.2.2/classes/c_component_registry/" class="">2.2.2</a></li><li><a href="http://hookr.io/plugins/nextgen-gallery/2.2.1/classes/c_component_registry/" class="">2.2.1</a></li><li><a href="http://hookr.io/plugins/nextgen-gallery/2.1.79/classes/c_component_registry/" class="">2.1.79</a></li><li><a href="http://hookr.io/plugins/nextgen-gallery/2.1.50/classes/c_component_registry/" class="active">2.1.50</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>C_Component_Registry</li><li><span></span>NextGEN Gallery</li><li><span></span>2.2.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>