<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.2.3" data-slug="nextgen-gallery" data-type="file" data-id="65678"><head xmlns="http://www.w3.org/1999/xhtml"><title> products-photocrati-nextgen-modules-third-party-compat-module-third-party-compat | file | Nextgen Gallery | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, nextgen-gallery, 2.2.3" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=9070c30b55bf4e0667ec7885bfe77a4b' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/products-photocrati-nextgen-modules-third-party-compat-module-third-party-compat/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fproducts-photocrati-nextgen-modules-third-party-compat-module-third-party-compat%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fproducts-photocrati-nextgen-modules-third-party-compat-module-third-party-compat%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-nextgen-gallery-2.2.3-file-products-photocrati-nextgen-modules-third-party-compat-module-third-party-compat","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="products-photocrati-nextgen-modules-third-party-compat-module-third-party-compat" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to nextgen-gallery." href="http://hookr.io/plugins/nextgen-gallery/" class="plugin"><span property="name">nextgen-gallery</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.2.3." href="http://hookr.io/plugins/nextgen-gallery/2.2.3/" class="H_VERSION"><span property="name">2.2.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/nextgen-gallery/2.2.3/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">products-photocrati-nextgen-m&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="783"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/all/" title="All">All <span class="count badge">783</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="157"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/hooks/" title="Hooks">Hooks <span class="count badge">157</span></a></li><li class="" data-id="action" data-count="48"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/actions/" title="Actions">Actions <span class="count badge">48</span></a></li><li class="" data-id="filter" data-count="109"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/filters/" title="Filters">Filters <span class="count badge">109</span></a></li><li class="" data-id="class" data-count="374"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/classes/" title="Classes">Classes <span class="count badge">374</span></a></li><li class="" data-id="constant" data-count="172"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/constants/" title="Constants">Constants <span class="count badge">172</span></a></li><li class="" data-id="function" data-count="79"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/functions/" title="Functions">Functions <span class="count badge">79</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/nextgen-gallery/2.2.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/products/photocrati_nextgen/modules/third_party_compat/module.third_party_compat.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>class M_Third_Party_Compat extends C_Base_Module&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  protected $wpseo_images = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function define($id = 'pope-module', &nbsp;</div></li><li><div>                  $name = 'Pope Module', &nbsp;</div></li><li><div>                  $description = '', &nbsp;</div></li><li><div>                  $version = '', &nbsp;</div></li><li><div>                  $uri = '', &nbsp;</div></li><li><div>                  $author = '', &nbsp;</div></li><li><div>                  $author_uri = '', &nbsp;</div></li><li><div>                  $context = FALSE)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      parent::define(&nbsp;</div></li><li><div>          'photocrati-third_party_compat', &nbsp;</div></li><li><div>          'Third Party Compatibility', &nbsp;</div></li><li><div>          &quot;Adds Third party compatibility hacks, adjustments, and modifications&quot;, &nbsp;</div></li><li><div>          '0.6', &nbsp;</div></li><li><div>          'https:<span class="comment">//www.imagely.com/wordpress-gallery-plugin/nextgen-gallery/', </span>&nbsp;</div></li><li><div>          'Imagely', &nbsp;</div></li><li><div>          'https:<span class="comment">//www.imagely.com'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// the following constants were renamed for 2.0.41; keep them declared for compatibility sake until</span>&nbsp;</div></li><li><div>      <span class="comment">// other parties can update themselves.</span>&nbsp;</div></li><li><div>      $changed_constants = array(&nbsp;</div></li><li><div>          'NEXTGEN_ADD_GALLERY_SLUG' =&gt; 'NGG_ADD_GALLERY_SLUG', &nbsp;</div></li><li><div>          'NEXTGEN_BASIC_SINGLEPIC_MODULE_NAME' =&gt; 'NGG_BASIC_SINGLEPIC', &nbsp;</div></li><li><div>          'NEXTGEN_BASIC_TAG_CLOUD_MODULE_NAME' =&gt; 'NGG_BASIC_TAGCLOUD', &nbsp;</div></li><li><div>          'NEXTGEN_DISPLAY_PRIORITY_BASE' =&gt; 'NGG_DISPLAY_PRIORITY_BASE', &nbsp;</div></li><li><div>          'NEXTGEN_DISPLAY_PRIORITY_STEP' =&gt; 'NGG_DISPLAY_PRIORITY_STEP', &nbsp;</div></li><li><div>          'NEXTGEN_DISPLAY_SETTINGS_SLUG' =&gt; 'NGG_DISPLAY_SETTINGS_SLUG', &nbsp;</div></li><li><div>          'NEXTGEN_FS_ACCESS_SLUG' =&gt; 'NGG_FS_ACCESS_SLUG', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_ATTACH_TO_POST_SLUG' =&gt; 'NGG_ATTACH_TO_POST_SLUG', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_BASIC_SLIDESHOW' =&gt; 'NGG_BASIC_SLIDESHOW', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_BASIC_THUMBNAILS' =&gt; 'NGG_BASIC_THUMBNAILS', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_CHANGE_OPTIONS_CAP' =&gt; 'NGG_CHANGE_OPTIONS_CAP', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_I18N_DOMAIN' =&gt; 'NGG_I18N_DOMAIN', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_IMPORT_ROOT' =&gt; 'NGG_IMPORT_ROOT', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_MODULE_DIR' =&gt; 'NGG_MODULE_DIR', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_MODULE_URL' =&gt; 'NGG_MODULE_URL', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_NEXTGEN_BASIC_COMPACT_ALBUM' =&gt; 'NGG_BASIC_COMPACT_ALBUM', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_NEXTGEN_BASIC_EXTENDED_ALBUM' =&gt; 'NGG_BASIC_EXTENDED_ALBUM', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_NEXTGEN_BASIC_IMAGEBROWSER' =&gt; 'NGG_BASIC_IMAGEBROWSER', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_NGGLEGACY_MOD_DIR' =&gt; 'NGG_LEGACY_MOD_DIR', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_NGGLEGACY_MOD_URL' =&gt; 'NGG_LEGACY_MOD_URL', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PLUGIN' =&gt; 'NGG_PLUGIN', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PLUGIN_BASENAME' =&gt; 'NGG_PLUGIN_BASENAME', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PLUGIN_DIR' =&gt; 'NGG_PLUGIN_DIR', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PLUGIN_STARTED_AT' =&gt; 'NGG_PLUGIN_STARTED_AT', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PLUGIN_URL' =&gt; 'NGG_PLUGIN_URL', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PLUGIN_VERSION' =&gt; 'NGG_PLUGIN_VERSION', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PRODUCT_DIR' =&gt; 'NGG_PRODUCT_DIR', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PRODUCT_URL' =&gt; 'NGG_PRODUCT_URL', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PROTECT_IMAGE_MOD_STATIC_URL' =&gt; 'NGG_PROTUCT_IMAGE_MOD_STATIC_URL', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_PROTECT_IMAGE_MOD_URL' =&gt; 'NGG_PROTECT_IMAGE_MOD_URL', &nbsp;</div></li><li><div>          'NEXTGEN_GALLERY_TESTS_DIR' =&gt; 'NGG_TESTS_DIR', &nbsp;</div></li><li><div>          'NEXTGEN_LIGHTBOX_ADVANCED_OPTIONS_SLUG' =&gt; 'NGG_LIGHTBOX_ADVANCED_OPTIONS_SLUG', &nbsp;</div></li><li><div>          'NEXTGEN_LIGHTBOX_OPTIONS_SLUG' =&gt; 'NGG_LIGHTBOX_OPTIONS_SLUG', &nbsp;</div></li><li><div>          'NEXTGEN_OTHER_OPTIONS_SLUG' =&gt; 'NGG_OTHER_OPTIONS_SLUG'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      foreach ($changed_constants as $old =&gt; $new) {&nbsp;</div></li><li><div>          if (defined($new) && !defined($old)) {&nbsp;</div></li><li><div>              define($old, constant($new));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Resolve problems with zlib compression: https://core.trac.wordpress.org/ticket/18525</span>&nbsp;</div></li><li><div>      if (PHP_MAJOR_VERSION == 5 && PHP_MINOR_VERSION == 4) {&nbsp;</div></li><li><div>          @ini_set('zlib.output_compression', 'Off');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Detect 'Adminer' and whether the user is viewing its loader.php</span>&nbsp;</div></li><li><div>      if (class_exists('AdminerForWP') && function_exists('adminer_object'))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          if (!defined('NGG_DISABLE_RESOURCE_MANAGER'))&nbsp;</div></li><li><div>              define('NGG_DISABLE_RESOURCE_MANAGER', TRUE);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Cornerstone's page builder requires a 'clean slate' of css/js that our resource manager interefers with</span>&nbsp;</div></li><li><div>      if (class_exists('Cornerstone'))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          if (!defined('NGG_DISABLE_FILTER_THE_CONTENT')) define('NGG_DISABLE_FILTER_THE_CONTENT', TRUE);&nbsp;</div></li><li><div>          if (!defined('NGG_DISABLE_RESOURCE_MANAGER'))   define('NGG_DISABLE_RESOURCE_MANAGER', TRUE);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Genesis Tabs creates a new query / do_shortcode loop which requires these be set</span>&nbsp;</div></li><li><div>      if (class_exists('Genesis_Tabs'))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          if (!defined('NGG_DISABLE_FILTER_THE_CONTENT')) define('NGG_DISABLE_FILTER_THE_CONTENT', TRUE);&nbsp;</div></li><li><div>          if (!defined('NGG_DISABLE_RESOURCE_MANAGER'))   define('NGG_DISABLE_RESOURCE_MANAGER', TRUE);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _register_adapters()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;get_registry()-&gt;add_adapter(&nbsp;</div></li><li><div>          'I_Display_Type_Controller', 'A_Non_Cachable_Pro_Film_Controller', 'photocrati-nextgen_pro_film'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _register_hooks()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      add_action('init', array(&$this, 'colorbox'), PHP_INT_MAX);&nbsp;</div></li><li><div>      add_action('init', array(&$this, 'flattr'), PHP_INT_MAX);&nbsp;</div></li><li><div>      add_action('wp', array(&$this, 'bjlazyload'), PHP_INT_MAX);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action('admin_init', array($this, 'excellent_themes_admin'), -10);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action('plugins_loaded', array(&$this, 'wpml'), PHP_INT_MAX);&nbsp;</div></li><li><div>      add_action('plugins_loaded', array(&$this, 'wpml_translation_management'), PHP_INT_MAX);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter('headway_gzip', array(&$this, 'headway_gzip'), (PHP_INT_MAX - 1));&nbsp;</div></li><li><div>      add_filter('ckeditor_external_plugins', array(&$this, 'ckeditor_plugins'), 11);&nbsp;</div></li><li><div>      add_filter('bp_do_redirect_canonical', array(&$this, 'fix_buddypress_routing'));&nbsp;</div></li><li><div>      add_filter('the_content', array($this, 'check_weaverii'), -(PHP_INT_MAX-2));&nbsp;</div></li><li><div>      add_action('wp', array($this, 'check_for_jquery_lightbox'));&nbsp;</div></li><li><div>      add_filter('get_the_excerpt', array($this, 'disable_galleries_in_excerpts'), 1);&nbsp;</div></li><li><div>      add_filter('get_the_excerpt', array($this, 'enable_galleries_in_excerpts'), PHP_INT_MAX-1);&nbsp;</div></li><li><div>      add_action('debug_bar_enqueue_scripts', array($this, 'no_debug_bar'));&nbsp;</div></li><li><div>      add_filter('ngg_non_minified_modules', array($this, 'dont_minify_nextgen_pro_cssjs'));&nbsp;</div></li><li><div>      add_filter('ngg_atp_show_display_type', array($this, 'atp_check_pro_albums'), 10, 2);&nbsp;</div></li><li><div>      add_filter('run_ngg_resource_manager', array($this, 'run_ngg_resource_manager'));&nbsp;</div></li><li><div>      add_filter('wpseo_sitemap_urlimages', array($this, 'add_wpseo_xml_sitemap_images'), 10, 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// WPML fix</span>&nbsp;</div></li><li><div>      if (class_exists('SitePress')) {&nbsp;</div></li><li><div>          M_WordPress_Routing::$_use_canonical_redirect = FALSE;&nbsp;</div></li><li><div>          M_WordPress_Routing::$_use_old_slugs = FALSE;&nbsp;</div></li><li><div>          add_action('template_redirect', array(&$this, 'fix_wpml_canonical_redirect'), 1);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// TODO: Only needed for NGG Pro 1.0.10 and lower</span>&nbsp;</div></li><li><div>      add_action('the_post', array(&$this, 'add_ngg_pro_page_parameter'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filter support for WordPress SEO</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $images Provided by WPSEO Filter</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $post ID Provided by WPSEO Filter</span>&nbsp;</div></li><li><div><span class="comment">   * @return array $image List of a displayed galleries entities</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function add_wpseo_xml_sitemap_images($images, $post_id)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;wpseo_images = $images;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post = get_post($post_id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Assign our own shortcode handler; ngglegacy and ATP do this same routine for their own</span>&nbsp;</div></li><li><div>      <span class="comment">// legacy and preview image placeholders.</span>&nbsp;</div></li><li><div>      remove_all_shortcodes();&nbsp;</div></li><li><div>      C_NextGen_Shortcode_Manager::add('ngg_images', array($this, 'wpseo_shortcode_handler'));&nbsp;</div></li><li><div>      do_shortcode($post-&gt;post_content);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;wpseo_images;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Processes ngg_images shortcode when WordPress SEO is building sitemaps. Adds images belonging to a</span>&nbsp;</div></li><li><div><span class="comment">   * displayed gallery to $this-&gt;wpseo_images for the assigned filter method to return.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $params Array of shortcode parameters</span>&nbsp;</div></li><li><div><span class="comment">   * @param null $inner_content</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function wpseo_shortcode_handler($params, $inner_content = NULL)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $renderer = C_Displayed_Gallery_Renderer::get_instance();&nbsp;</div></li><li><div>      $displayed_gallery = $renderer-&gt;params_to_displayed_gallery($params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($displayed_gallery)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $gallery_storage = C_Gallery_Storage::get_instance();&nbsp;</div></li><li><div>          $settings = C_NextGen_Settings::get_instance();&nbsp;</div></li><li><div>          $source = $displayed_gallery-&gt;get_source();&nbsp;</div></li><li><div>          if (in_array('image', $source-&gt;returns))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              foreach ($displayed_gallery-&gt;get_entities() as $image) {&nbsp;</div></li><li><div>                  $named_image_size = $settings-&gt;imgAutoResize ? 'full' : 'thumb';&nbsp;</div></li><li><div>                  $sitemap_image = array(&nbsp;</div></li><li><div>                      'src' =&gt;    $gallery_storage-&gt;get_image_url($image, $named_image_size), &nbsp;</div></li><li><div>                      'alt' =&gt;    $image-&gt;alttext, &nbsp;</div></li><li><div>                      'title' =&gt;    $image-&gt;description ? $image-&gt;description: $image-&gt;alttext&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  $this-&gt;wpseo_images[] = $sitemap_image;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Some other plugins output content and die(); this causes problems with our resource manager which uses output buffering</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $valid_request</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function run_ngg_resource_manager($valid_request = TRUE)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// WP-Post-To-PDF-Enhanced</span>&nbsp;</div></li><li><div>      if (class_exists('wpptopdfenh') && !empty($_GET['format']))&nbsp;</div></li><li><div>          $valid_request = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// WP-Photo-Seller download</span>&nbsp;</div></li><li><div>      if (class_exists('WPS') && isset($_REQUEST['wps_file_dl']) && $_REQUEST['wps_file_dl'] == '1')&nbsp;</div></li><li><div>          $valid_request = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Multiverso Advanced File Sharing download</span>&nbsp;</div></li><li><div>      if (function_exists('mv_install') && isset($_GET['upf']) && isset($_GET['id']))&nbsp;</div></li><li><div>          $valid_request = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// WooCommerce downloads</span>&nbsp;</div></li><li><div>      if (class_exists('WC_Download_Handler') && isset($_GET['download_file']) && isset($_GET['order']) && isset($_GET['email']))&nbsp;</div></li><li><div>          $valid_request = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// WP-E-Commerce</span>&nbsp;</div></li><li><div>      if (isset($_GET['wpsc_download_id']) || (function_exists('wpsc_download_file') && isset($_GET['downloadid'])))&nbsp;</div></li><li><div>          $valid_request = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Easy Digital Downloads</span>&nbsp;</div></li><li><div>      if (function_exists('edd_process_download') && (isset($_GET['download_id']) || isset($_GET['download'])))&nbsp;</div></li><li><div>          $valid_request = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $valid_request;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This style causes problems with Excellent Themes admin settings</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function excellent_themes_admin()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_admin() && (!empty($_GET['page']) && strpos($_GET['page'], 'et_') == 0))&nbsp;</div></li><li><div>          wp_deregister_style('ngg-jquery-ui');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function atp_check_pro_albums($available, $display_type)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!defined('NGG_PRO_ALBUMS'))&nbsp;</div></li><li><div>          return $available;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (in_array($display_type-&gt;name, array(NGG_PRO_LIST_ALBUM, NGG_PRO_GRID_ALBUM))&nbsp;</div></li><li><div>      &&  $this-&gt;get_registry()-&gt;is_module_loaded(NGG_PRO_ALBUMS))&nbsp;</div></li><li><div>          $available = TRUE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $available;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function no_debug_bar()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (M_Attach_To_Post::is_atp_url()) {&nbsp;</div></li><li><div>          wp_dequeue_script('debug-bar-console');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// A lot of routing issues start occuring with WordPress SEO when the routing system is</span>&nbsp;</div></li><li><div>  <span class="comment">// initialized by the excerpt, and then again from the post content.</span>&nbsp;</div></li><li><div>  function disable_galleries_in_excerpts($excerpt)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (class_exists('WPSEO_OpenGraph')) {&nbsp;</div></li><li><div>          M_Attach_To_Post::$substitute_placeholders = FALSE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $excerpt;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function enable_galleries_in_excerpts($excerpt)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (class_exists('WPSEO_OpenGraph')) {&nbsp;</div></li><li><div>          M_Attach_To_Post::$substitute_placeholders = TRUE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $excerpt;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function fix_buddypress_routing()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      M_WordPress_Routing::$_use_canonical_redirect = FALSE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return FALSE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function fix_wpml_canonical_redirect()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      M_WordPress_Routing::$_use_canonical_redirect = FALSE;&nbsp;</div></li><li><div>      M_WordPress_Routing::$_use_old_slugs = FALSE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * CKEditor features a custom NextGEN shortcode generator that unfortunately relies on parts of the NextGEN</span>&nbsp;</div></li><li><div><span class="comment">   * 1.9x API that has been deprecated in NextGEN 2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $plugins</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function ckeditor_plugins($plugins)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('add_ckeditor_button'))&nbsp;</div></li><li><div>          return $plugins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!empty($plugins['nextgen']))&nbsp;</div></li><li><div>          unset($plugins['nextgen']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $plugins;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function check_for_jquery_lightbox()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Fix for jQuery Lightbox: http://wordpress.org/plugins/wp-jquery-lightbox/</span>&nbsp;</div></li><li><div>      <span class="comment">// jQuery Lightbox tries to modify the content of a post, but it does so before we modify</span>&nbsp;</div></li><li><div>      <span class="comment">// the content, and therefore it's modifications have no effect on our galleries</span>&nbsp;</div></li><li><div>      if (function_exists('jqlb_autoexpand_rel_wlightbox')) {&nbsp;</div></li><li><div>          $settings = C_NextGen_Settings::get_instance();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// First, we make it appear that NGG has no lightbox effect enabled. That way</span>&nbsp;</div></li><li><div>          <span class="comment">// we don't any lightbox resources</span>&nbsp;</div></li><li><div>          unset($settings-&gt;thumbEffect);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// We would normally just let the third-party plugin do it's thing, but it's regex doesn't</span>&nbsp;</div></li><li><div>          <span class="comment">// seem to work on our &lt;a&gt; tags (perhaps because they span multiple of lines or have data attributes)</span>&nbsp;</div></li><li><div>          <span class="comment">// So instead, we just do what the third-party plugin wants - add the rel attribute</span>&nbsp;</div></li><li><div>          $settings-&gt;thumbCode=&quot;rel='lightbox[%POST_ID%]'&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Weaver II's 'weaver_show_posts' shortcode creates a new wp-query, causing a second round of 'the_content'</span>&nbsp;</div></li><li><div><span class="comment">   * filters to apply. This checks for WeaverII and enables all NextGEN shortcodes that would otherwise be left</span>&nbsp;</div></li><li><div><span class="comment">   * disabled by our shortcode manager. See https://core.trac.wordpress.org/ticket/17817 for more.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $content</span>&nbsp;</div></li><li><div><span class="comment">   * @return $content</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function check_weaverii($content)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (function_exists('weaverii_show_posts_shortcode'))&nbsp;</div></li><li><div>          C_NextGen_Shortcode_Manager::get_instance()-&gt;activate_all();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * WPML assigns an action to 'init' that *may* enqueue some admin-side JS. This JS relies on some inline JS</span>&nbsp;</div></li><li><div><span class="comment">   * to be injected that isn't present in ATP so for ATP requests ONLY we disable their action that enqueues</span>&nbsp;</div></li><li><div><span class="comment">   * their JS files.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function wpml()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('SitePress'))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!M_Attach_To_Post::is_atp_url())&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_filter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (empty($wp_filter['init'][2]) && empty($wp_filter['after_setup_theme'][1]))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($wp_filter['init'][2] as $id =&gt; $filter) {&nbsp;</div></li><li><div>          if (!strpos($id, 'js_load'))&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $object = $filter['function'][0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (is_object($object) && get_class($object) != 'SitePress')&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          remove_action('init', array($object, 'js_load'), 2);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($wp_filter['after_setup_theme'][1] as $id =&gt; $filter) {&nbsp;</div></li><li><div>          if ($id !== 'wpml_installer_instance_delegator')&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          remove_action('after_setup_theme', 'wpml_installer_instance_delegator', 1);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * WPML Translation Management has a similar problem to plain ol' WPML</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function wpml_translation_management()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('WPML_Translation_Management'))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!M_Attach_To_Post::is_atp_url())&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_filter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (empty($wp_filter['init'][10]))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($wp_filter['init'][10] as $id =&gt; $filter) {&nbsp;</div></li><li><div>          if (!strpos($id, 'init'))&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $object = $filter['function'][0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (is_object($object) && get_class($object) != 'WPML_Translation_Management')&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          remove_action('init', array($object, 'init'), 10);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * NGG Pro 1.0.10 relies on the 'page' parameter for pagination, but that conflicts with</span>&nbsp;</div></li><li><div><span class="comment">   * WordPress Post Pagination (&lt;!-- nextpage --&gt;). This was fixed in 1.0.11, so this code is</span>&nbsp;</div></li><li><div><span class="comment">   * for backwards compatibility</span>&nbsp;</div></li><li><div><span class="comment">   * TODO: This can be removed in a later release</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function add_ngg_pro_page_parameter()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($post AND !is_array($post-&gt;content) AND (strpos($post-&gt;content, &quot;&lt;!--nextpage--&gt;&quot;) === FALSE) AND (strpos($_SERVER['REQUEST_URI'], '/page/') !== FALSE)) {&nbsp;</div></li><li><div>          if (preg_match(&quot;#/page/(\\d+)#&quot;, $_SERVER['REQUEST_URI'], $match)) {&nbsp;</div></li><li><div>              $_REQUEST['page'] = $match[1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Headway themes offer gzip compression, but it causes problems with NextGEN output. Disable that feature while</span>&nbsp;</div></li><li><div><span class="comment">   * NextGEN is active.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $option</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function headway_gzip($option)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('HeadwayOption'))&nbsp;</div></li><li><div>          return $option;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return FALSE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Colorbox fires a filter (pri=100) to add class attributes to images via a the_content filter. We fire our</span>&nbsp;</div></li><li><div><span class="comment">   * shortcodes at PHP_INT_MAX-1 to avoid encoding issues with some themes. Here we move the Colorbox filters</span>&nbsp;</div></li><li><div><span class="comment">   * priority to PHP_INT_MAX so that they run after our shortcode text has been replaced with rendered galleries.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function colorbox()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('JQueryColorboxFrontend'))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_filter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (empty($wp_filter['the_content'][100]))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($wp_filter['the_content'][100] as $id =&gt; $filter) {&nbsp;</div></li><li><div>          if (!strpos($id, 'addColorboxGroupIdToImages'))&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $object = $filter['function'][0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (is_object($object) && get_class($object) != 'JQueryColorboxFrontend')&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          remove_filter('the_content', array($object, 'addColorboxGroupIdToImages'), 100);&nbsp;</div></li><li><div>          remove_filter('the_excerpt', array($object, 'addColorboxGroupIdToImages'), 100);&nbsp;</div></li><li><div>          add_filter('the_content', array($object, 'addColorboxGroupIdToImages'), PHP_INT_MAX);&nbsp;</div></li><li><div>          add_filter('the_excerpt', array($object, 'addColorboxGroupIdToImages'), PHP_INT_MAX);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Flattr fires a filter (pri=32767) on &quot;the_content&quot; that recurses. This causes problems, </span>&nbsp;</div></li><li><div><span class="comment">   * see https://core.trac.wordpress.org/ticket/17817 for more information. Moving their filter to PHP_INT_MAX</span>&nbsp;</div></li><li><div><span class="comment">   * is enough for us though</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function flattr()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('Flattr'))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_filter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $level = 32767;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (empty($wp_filter['the_content'][$level]))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($wp_filter['the_content'][$level] as $id =&gt; $filter) {&nbsp;</div></li><li><div>          if (!strpos($id, 'injectIntoTheContent'))&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $object = $filter['function'][0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (is_object($object) && get_class($object) != 'Flattr')&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          remove_filter('the_content', array($object, 'injectIntoTheContent'), $level);&nbsp;</div></li><li><div>          add_filter('the_content', array($object, 'injectIntoTheContent'), PHP_INT_MAX);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * For the same reasons as Colorbox we move BJ-Lazy-load's filter() method to a later priority so it can access</span>&nbsp;</div></li><li><div><span class="comment">   * our rendered galleries.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bjlazyload()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('BJLL'))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_filter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (empty($wp_filter['the_content'][200]))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($wp_filter['the_content'][200] as $id =&gt; $filter) {&nbsp;</div></li><li><div>          if (!strpos($id, 'filter'))&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $object = $filter['function'][0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (is_object($object) && get_class($object) != 'BJLL')&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          remove_filter('the_content', array($object, 'filter'), 200);&nbsp;</div></li><li><div>          add_filter('the_content', array($object, 'filter'), PHP_INT_MAX);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter('the_content', array($this, 'bjlazyload_filter'), PHP_INT_MAX-1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * BJ-Lazy-load's regex is lazy and doesn't handle multiline search or instances where &lt;img is immediately followed</span>&nbsp;</div></li><li><div><span class="comment">   * by a newline. The following regex replaces newlines and strips unnecessary space. We fire this filter</span>&nbsp;</div></li><li><div><span class="comment">   * before BJ-Lazy-Load's to make our galleries compatible with its expectations.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bjlazyload_filter($content)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return trim(preg_replace(&quot;/\\s\\s+/&quot;, &quot; &quot;, $content));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * NextGen 2.0.67.20 introduced CSS/JS minification; do not apply this to NextGen Pro yet</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $modules_to_not_minify</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function dont_minify_nextgen_pro_cssjs($modules_to_not_minify)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// TODO: once Pro 2.1.30 is widely circulated, we don't need to use</span>&nbsp;</div></li><li><div>      <span class="comment">// the installer. We can use the component registry to fetch the product</span>&nbsp;</div></li><li><div>      <span class="comment">// and call the product's get_modules_to_load() function</span>&nbsp;</div></li><li><div>      $installer = new C_NextGen_Product_Installer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (defined('NGG_PRO_PLUGIN_VERSION') && class_exists('P_Photocrati_NextGen_Pro'))&nbsp;</div></li><li><div>          $modules_to_not_minify += $installer-&gt;get_modules_to_load_for('photocrati-nextgen-pro');&nbsp;</div></li><li><div>      else if (defined('NGG_PLUS_PLUGIN_VERSION') && class_exists('P_Photocrati_NextGen_Plus'))&nbsp;</div></li><li><div>          $modules_to_not_minify += $installer-&gt;get_modules_to_load_for('photocrati-nextgen-plus');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $modules_to_not_minify;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function get_type_list()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return array(&nbsp;</div></li><li><div>          'A_Non_Cachable_Pro_Film_Controller' =&gt; 'adapter.non_cachable_pro_film_controller.php'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>new M_Third_Party_Compat();&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>NextGEN Gallery</li><li><span></span>2.2.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>