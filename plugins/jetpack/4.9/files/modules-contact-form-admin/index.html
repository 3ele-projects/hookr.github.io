<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="3.8.0" data-slug="jetpack-by-wordpress-com" data-type="file" data-id="13020"><head xmlns="http://www.w3.org/1999/xhtml"><title> modules-contact-form-admin | file | Jetpack By WordPress Com | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, jetpack-by-wordpress-com, 3.8.0" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=6d05357400fcb6613f229e53c5bcddb6' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/modules-contact-form-admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fmodules-contact-form-admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fmodules-contact-form-admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-jetpack-by-wordpress-com-3.8.0-file-modules-contact-form-admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="modules-contact-form-admin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to jetpack-by-wordpress-com." href="http://hookr.io/plugins/jetpack-by-wordpress-com/" class="plugin"><span property="name">jetpack-by-wordpress-com</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.8.0." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/" class="H_VERSION"><span property="name">3.8.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">modules-contact-form-admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="1499"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/all/" title="All">All <span class="count badge">1499</span></a></li><li class="" data-id="new" data-count="17"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/new/" title="New">New <span class="count badge">17</span></a></li><li class="" data-id="hooks" data-count="599"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/hooks/" title="Hooks">Hooks <span class="count badge">599</span></a></li><li class="" data-id="action" data-count="195"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/actions/" title="Actions">Actions <span class="count badge">195</span></a></li><li class="" data-id="filter" data-count="404"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/filters/" title="Filters">Filters <span class="count badge">404</span></a></li><li class="" data-id="class" data-count="262"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/" title="Classes">Classes <span class="count badge">262</span></a></li><li class="" data-id="constant" data-count="62"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/constants/" title="Constants">Constants <span class="count badge">62</span></a></li><li class="" data-id="function" data-count="530"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/functions/" title="Functions">Functions <span class="count badge">530</span></a></li><li class="" data-id="shortcode" data-count="46"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">46</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/modules/contact-form/admin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function grunion_menu_alter() {&nbsp;</div></li><li><div>  if( is_rtl() ) {&nbsp;</div></li><li><div>      wp_enqueue_style( 'grunion-menu-alter', plugins_url( 'css/rtl/menu-alter-rtl.css', __FILE__ ) );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      wp_enqueue_style( 'grunion-menu-alter', plugins_url( 'css/menu-alter.css', __FILE__ ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'admin_enqueue_scripts', 'grunion_menu_alter' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a contact form button to the post composition screen</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>add_action( 'media_buttons', 'grunion_media_button', 999 );&nbsp;</div></li><li><div>function grunion_media_button( ) {&nbsp;</div></li><li><div>  global $post_ID, $temp_ID, $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'press-this.php' === $pagenow ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $iframe_post_id = (int) (0 == $post_ID ? $temp_ID : $post_ID);&nbsp;</div></li><li><div>  $title = __( 'Add Contact Form', 'jetpack' );&nbsp;</div></li><li><div>  $plugin_url = esc_url( GRUNION_PLUGIN_URL );&nbsp;</div></li><li><div>  $site_url = esc_url( admin_url( &quot;/admin-ajax.php?post_id={$iframe_post_id}&action=grunion_form_builder&TB_iframe=true&width=768&quot; ) );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;a id=&quot;insert-jetpack-contact-form&quot; class=&quot;button thickbox&quot; title=&quot;&lt;?php echo esc_attr( $title ); ?&gt;&quot; data-editor=&quot;content&quot; href=&quot;&lt;?php echo $site_url ?&gt;&id=add_form&quot;&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;jetpack-contact-form-icon&quot;&gt;&lt;/span&gt; &lt;?php echo esc_html( $title ); ?&gt;&nbsp;</div></li><li><div>  &lt;/a&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_ajax_grunion_form_builder', 'grunion_display_form_view' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function grunion_display_form_view() {&nbsp;</div></li><li><div>  require_once GRUNION_PLUGIN_DIR . 'grunion-form-view.php';&nbsp;</div></li><li><div>  exit;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// feedback specific css items</span>&nbsp;</div></li><li><div>add_action( 'admin_print_styles', 'grunion_admin_css' );&nbsp;</div></li><li><div>function grunion_admin_css() {&nbsp;</div></li><li><div>  global $current_screen;&nbsp;</div></li><li><div>  if ( ! in_array( $current_screen-&gt;id, array( 'edit-feedback', 'jetpack_page_omnisearch', 'dashboard_page_omnisearch' ) ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_enqueue_script( 'wp-lists' );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;style type='text/css'&gt;&nbsp;</div></li><li><div>.add-new-h2, .view-switch, body.no-js .tablenav select[name^=action], body.no-js #doaction, body.no-js #doaction2 {&nbsp;</div></li><li><div>  display: none&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>.column-feedback_from img {&nbsp;</div></li><li><div>  float:left;&nbsp;</div></li><li><div>  margin-right:10px;&nbsp;</div></li><li><div>  margin-top:3px;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>.widefat .column-feedback_from {&nbsp;</div></li><li><div>  width: 17%;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>.widefat .column-feedback_date {&nbsp;</div></li><li><div>  width: 17%;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>.spam a {&nbsp;</div></li><li><div>  color: #BC0B0B;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>.untrash a {&nbsp;</div></li><li><div>  color: #D98500;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>.unspam a {&nbsp;</div></li><li><div>color: #D98500;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>#icon-edit.icon32-posts-feedback, #icon-post.icon32-posts-feedback { background: url(&quot;&lt;?php echo GRUNION_PLUGIN_URL; ?&gt;images/grunion-menu-big.png&quot;) no-repeat !important; }&nbsp;</div></li><li><div>@media only screen and (min--moz-device-pixel-ratio: 1.5), only screen and (-o-min-device-pixel-ratio: 3/2), only screen and (-webkit-min-device-pixel-ratio: 1.5), only screen and (min-device-pixel-ratio: 1.5) {&nbsp;</div></li><li><div>  #icon-edit.icon32-posts-feedback, #icon-post.icon32-posts-feedback { background: url(&quot;&lt;?php echo GRUNION_PLUGIN_URL; ?&gt;images/grunion-menu-big-2x.png&quot;) no-repeat !important; background-size: 30px 31px !important; }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>#icon-edit.icon32-posts-feedback { background-position: 2px 2px !important; }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;/style&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Hack a 'Bulk Spam' option for bulk edit in other than spam view</span>&nbsp;</div></li><li><div><span class="comment"> * Hack a 'Bulk Delete' option for bulk edit in spam view</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * There isn't a better way to do this until</span>&nbsp;</div></li><li><div><span class="comment"> * http://core.trac.wordpress.org/changeset/17297 is resolved</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>add_action( 'admin_head', 'grunion_add_bulk_edit_option' );&nbsp;</div></li><li><div>function grunion_add_bulk_edit_option() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'edit-feedback' != $screen-&gt;id ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// When viewing spam we want to be able to be able to bulk delete</span>&nbsp;</div></li><li><div>  <span class="comment">// When viewing anything we want to be able to bulk move to spam</span>&nbsp;</div></li><li><div>  if ( isset( $_GET['post_status'] ) && 'spam' == $_GET['post_status'] ) {&nbsp;</div></li><li><div>      <span class="comment">// Create Delete Permanently bulk item</span>&nbsp;</div></li><li><div>      $option_val = 'delete';&nbsp;</div></li><li><div>      $option_txt = __( 'Delete Permanently', 'jetpack' );&nbsp;</div></li><li><div>      $pseudo_selector = 'last-child';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Create Mark Spam bulk item</span>&nbsp;</div></li><li><div>      $option_val = 'spam';&nbsp;</div></li><li><div>      $option_txt = __( 'Mark as Spam', 'jetpack' );&nbsp;</div></li><li><div>      $pseudo_selector = 'first-child';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>          jQuery(document).ready(function($) {&nbsp;</div></li><li><div>              $('#posts-filter .actions select').filter('[name=action], [name=action2]').find('option:&lt;?php echo $pseudo_selector; ?&gt;').after('&lt;option value=&quot;&lt;?php echo $option_val; ?&gt;&quot;&gt;&lt;?php echo esc_attr( $option_txt ); ?&gt;&lt;/option&gt;' );&nbsp;</div></li><li><div>          })&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Hack an 'Empty Spam' button to spam view</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Leverages core's delete_all functionality</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>add_action( 'admin_head', 'grunion_add_empty_spam_button' );&nbsp;</div></li><li><div>function grunion_add_empty_spam_button() {&nbsp;</div></li><li><div>  $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only add to feedback, only to spam view</span>&nbsp;</div></li><li><div>  if ( 'edit-feedback' != $screen-&gt;id&nbsp;</div></li><li><div>  || empty( $_GET['post_status'] )&nbsp;</div></li><li><div>  || 'spam' !== $_GET['post_status'] ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Get HTML for the button</span></span>&nbsp;</div></li><li><div>  $button_html = wp_nonce_field( 'bulk-destroy', '_destroy_nonce', true, false );&nbsp;</div></li><li><div>  $button_html .= get_submit_button( __( 'Empty Spam', 'jetpack' ), 'apply', 'delete_all', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Add the button next to the filter button via js</span></span>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>          jQuery(document).ready(function($) {&nbsp;</div></li><li><div>              $('#posts-filter #post-query-submit').after('&lt;?php echo $button_html; ?&gt;' );&nbsp;</div></li><li><div>          })&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle a bulk spam report</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>add_action( 'admin_init', 'grunion_handle_bulk_spam' );&nbsp;</div></li><li><div>function grunion_handle_bulk_spam() {&nbsp;</div></li><li><div>  global $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'edit.php' != $pagenow&nbsp;</div></li><li><div>  || ( empty( $_REQUEST['post_type'] ) || 'feedback' != $_REQUEST['post_type'] ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Slip in a success message</span>&nbsp;</div></li><li><div>  if ( ! empty( $_REQUEST['message'] ) && 'marked-spam' == $_REQUEST['message'] )&nbsp;</div></li><li><div>      add_action( 'admin_notices', 'grunion_message_bulk_spam' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( empty( $_REQUEST['action'] ) || 'spam' != $_REQUEST['action'] ) && ( empty( $_REQUEST['action2'] ) || 'spam' != $_REQUEST['action2'] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  check_admin_referer('bulk-posts');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $_REQUEST['post'] ) ) {&nbsp;</div></li><li><div>      wp_safe_redirect( wp_get_referer() );&nbsp;</div></li><li><div>      exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post_ids = array_map( 'intval', $_REQUEST['post'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach( $post_ids as $post_id ) {&nbsp;</div></li><li><div>      if ( ! current_user_can( &quot;edit_page&quot;, $post_id ) ) {&nbsp;</div></li><li><div>          wp_die( __( 'You are not allowed to manage this item.', 'jetpack' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post = array(&nbsp;</div></li><li><div>              'ID' =&gt; $post_id, &nbsp;</div></li><li><div>              'post_status' =&gt; 'spam', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $akismet_values = get_post_meta( $post_id, '_feedback_akismet_values', true );&nbsp;</div></li><li><div>      wp_update_post( $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after a comment has been marked by Akismet.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Typically this means the comment is spam.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @module contact-form</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $comment_status Usually is 'spam', otherwise 'ham'.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $akismet_values From '_feedback_akismet_values' in comment meta</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'contact_form_akismet', 'spam', $akismet_values );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $redirect_url = add_query_arg( 'message', 'marked-spam', wp_get_referer() );&nbsp;</div></li><li><div>  wp_safe_redirect( $redirect_url );&nbsp;</div></li><li><div>  exit;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function grunion_message_bulk_spam() {&nbsp;</div></li><li><div>  echo '&lt;div class=&quot;updated&quot;&gt;&lt;p&gt;' . __( 'Feedback(s) marked as spam', 'jetpack' ) . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// remove admin UI parts that we don't support in feedback management</span>&nbsp;</div></li><li><div>add_action( 'admin_menu', 'grunion_admin_menu' );&nbsp;</div></li><li><div>function grunion_admin_menu() {&nbsp;</div></li><li><div>  global $menu, $submenu;&nbsp;</div></li><li><div>  unset( $submenu['edit.php?post_type=feedback'] );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_filter( 'bulk_actions-edit-feedback', 'grunion_admin_bulk_actions' );&nbsp;</div></li><li><div>function grunion_admin_bulk_actions( $actions ) {&nbsp;</div></li><li><div>  global $current_screen;&nbsp;</div></li><li><div>  if ( 'edit-feedback' != $current_screen-&gt;id )&nbsp;</div></li><li><div>      return $actions;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  unset( $actions['edit'] );&nbsp;</div></li><li><div>  return $actions;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_filter( 'views_edit-feedback', 'grunion_admin_view_tabs' );&nbsp;</div></li><li><div>function grunion_admin_view_tabs( $views ) {&nbsp;</div></li><li><div>  global $current_screen;&nbsp;</div></li><li><div>  if ( 'edit-feedback' != $current_screen-&gt;id )&nbsp;</div></li><li><div>      return $actions;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  unset( $views['publish'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match( '|post_type=feedback\'( class=&quot;current&quot;)?\&gt;(.*)\&lt;span class=|', $views['all'], $match );&nbsp;</div></li><li><div>  if ( !empty( $match[2] ) )&nbsp;</div></li><li><div>      $views['all'] = str_replace( $match[2], __( 'Messages', 'jetpack' ) . ' ', $views['all'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $views;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_filter( 'manage_feedback_posts_columns', 'grunion_post_type_columns_filter' );&nbsp;</div></li><li><div>function grunion_post_type_columns_filter( $cols ) {&nbsp;</div></li><li><div>  $cols = array(&nbsp;</div></li><li><div>      'cb' =&gt; '&lt;input type=&quot;checkbox&quot; /&gt;', &nbsp;</div></li><li><div>      'feedback_from' =&gt; __( 'From', 'jetpack' ), &nbsp;</div></li><li><div>      'feedback_message' =&gt; __( 'Message', 'jetpack' ), &nbsp;</div></li><li><div>      'feedback_date' =&gt; __( 'Date', 'jetpack' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $cols;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'manage_posts_custom_column', 'grunion_manage_post_columns', 10, 2 );&nbsp;</div></li><li><div>function grunion_manage_post_columns( $col, $post_id ) {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Only call parse_fields_from_content if we're dealing with a Grunion custom column.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( ! in_array( $col, array( 'feedback_date', 'feedback_from', 'feedback_message' ) ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content_fields = Grunion_Contact_Form_Plugin::parse_fields_from_content( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $col ) {&nbsp;</div></li><li><div>      case 'feedback_from':&nbsp;</div></li><li><div>          $author_name = $content_fields['_feedback_author'];&nbsp;</div></li><li><div>          $author_email = $content_fields['_feedback_author_email'];&nbsp;</div></li><li><div>          $author_url = $content_fields['_feedback_author_url'];&nbsp;</div></li><li><div>          $author_ip = $content_fields['_feedback_ip'];&nbsp;</div></li><li><div>          $form_url = isset( $post-&gt;post_parent ) ? get_permalink( $post-&gt;post_parent ) : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $author_name_line = '';&nbsp;</div></li><li><div>          if ( !empty( $author_name ) ) {&nbsp;</div></li><li><div>              if ( !empty( $author_email ) )&nbsp;</div></li><li><div>                  $author_name_line = get_avatar( $author_email, 32 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $author_name_line .= sprintf( &quot;&lt;strong&gt;%s&lt;/strong&gt;&lt;br /&gt;&quot;, esc_html( $author_name ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $author_email_line = '';&nbsp;</div></li><li><div>          if ( !empty( $author_email ) ) {&nbsp;</div></li><li><div>              $author_email_line = sprintf( &quot;&lt;a href='%1\$s'&gt;%2\$s&lt;/a&gt;&lt;br /&gt;&quot;, esc_url( &quot;mailto:&quot; . $author_email ) , esc_html( $author_email ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $author_url_line = '';&nbsp;</div></li><li><div>          if ( !empty( $author_url ) ) {&nbsp;</div></li><li><div>              $author_url_line = sprintf( &quot;&lt;a href='%1\$s'&gt;%1\$s&lt;/a&gt;&lt;br /&gt;&quot;, esc_url( $author_url ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo $author_name_line;&nbsp;</div></li><li><div>          echo $author_email_line;&nbsp;</div></li><li><div>          echo $author_url_line;&nbsp;</div></li><li><div>          echo &quot;&lt;a href='edit.php?post_type=feedback&s=&quot; . urlencode( $author_ip );&nbsp;</div></li><li><div>          echo &quot;&mode=detail'&gt;&quot; . esc_html( $author_ip ) . &quot;&lt;/a&gt;&lt;br /&gt;&quot;;&nbsp;</div></li><li><div>          if ( $form_url ) {&nbsp;</div></li><li><div>              echo '&lt;a href=&quot;' . esc_url( $form_url ) . '&quot;&gt;' . esc_html( $form_url ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'feedback_message':&nbsp;</div></li><li><div>          $post_type_object = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>          echo '&lt;strong&gt;';&nbsp;</div></li><li><div>          echo esc_html( $content_fields['_feedback_subject'] );&nbsp;</div></li><li><div>          echo '&lt;/strong&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>          echo sanitize_text_field( get_the_content( '' ) );&nbsp;</div></li><li><div>          echo '&lt;br /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $extra_fields = get_post_meta( $post_id, '_feedback_extra_fields', TRUE );&nbsp;</div></li><li><div>          if ( !empty( $extra_fields ) ) {&nbsp;</div></li><li><div>              echo '&lt;br /&gt;&lt;hr /&gt;';&nbsp;</div></li><li><div>              echo '&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>              foreach ( (array) $extra_fields as $k =&gt; $v ) {&nbsp;</div></li><li><div>                  <span class="comment">// Remove prefix from exta fields</span>&nbsp;</div></li><li><div>                  echo &quot;&lt;tr&gt;&lt;td align='right'&gt;&lt;b&gt;&quot;. esc_html( preg_replace( '#^\d+_#', '', $k ) ) .&quot;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&quot;. sanitize_text_field( $v ) .&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo '&lt;/table&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;row-actions&quot;&gt;';&nbsp;</div></li><li><div>          if ( $post-&gt;post_status == 'trash' ) {&nbsp;</div></li><li><div>              echo '&lt;span class=&quot;untrash&quot; id=&quot;feedback-restore-' . $post_id;&nbsp;</div></li><li><div>              echo '&quot;&gt;&lt;a title=&quot;';&nbsp;</div></li><li><div>              echo esc_attr__( 'Restore this item from the Trash', 'jetpack' );&nbsp;</div></li><li><div>              echo '&quot; href=&quot;' . wp_nonce_url( admin_url( sprintf( $post_type_object-&gt;_edit_link . '&amp;action=untrash', $post-&gt;ID ) ), 'untrash-' . $post-&gt;post_type . '_' . $post-&gt;ID );&nbsp;</div></li><li><div>              echo '&quot;&gt;' . __( 'Restore', 'jetpack' ) . '&lt;/a&gt;&lt;/span&gt; | ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo &quot;&lt;span class='delete'&gt; &lt;a class='submitdelete' title='&quot;;&nbsp;</div></li><li><div>              echo esc_attr( __( 'Delete this item permanently', 'jetpack' ) );&nbsp;</div></li><li><div>              echo &quot;' href='&quot; . get_delete_post_link( $post-&gt;ID, '', true );&nbsp;</div></li><li><div>              echo &quot;'&gt;&quot; . __( 'Delete Permanently', 'jetpack' ) . &quot;&lt;/a&gt;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;script&gt;&nbsp;</div></li><li><div>jQuery(document).ready(function($) {&nbsp;</div></li><li><div>$('#feedback-restore-&lt;?php echo $post_id; ?&gt;').click(function(e) {&nbsp;</div></li><li><div>  e.preventDefault();&nbsp;</div></li><li><div>  $.post(ajaxurl, {&nbsp;</div></li><li><div>          action: 'grunion_ajax_spam', &nbsp;</div></li><li><div>          post_id: '&lt;?php echo $post_id; ?&gt;', &nbsp;</div></li><li><div>          make_it: 'publish', &nbsp;</div></li><li><div>          sub_menu: jQuery('.subsubsub .current').attr('href'), &nbsp;</div></li><li><div>          _ajax_nonce: '&lt;?php echo wp_create_nonce( 'grunion-post-status-' . $post_id ); ?&gt;'&nbsp;</div></li><li><div>      }, &nbsp;</div></li><li><div>      function(r) {&nbsp;</div></li><li><div>          $('#post-&lt;?php echo $post_id; ?&gt;')&nbsp;</div></li><li><div>              .css({backgroundColor: '#59C859'})&nbsp;</div></li><li><div>              .fadeOut(350, function() {&nbsp;</div></li><li><div>                  $(this).remove();&nbsp;</div></li><li><div>                  $('.subsubsub').html(r);&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>});&nbsp;</div></li><li><div>});&nbsp;</div></li><li><div>&lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>          } elseif ( $post-&gt;post_status == 'publish' ) {&nbsp;</div></li><li><div>              echo '&lt;span class=&quot;spam&quot; id=&quot;feedback-spam-' . $post_id;&nbsp;</div></li><li><div>              echo '&quot;&gt;&lt;a title=&quot;';&nbsp;</div></li><li><div>              echo __( 'Mark this message as spam', 'jetpack' );&nbsp;</div></li><li><div>              echo '&quot; href=&quot;' . wp_nonce_url( admin_url( 'admin-ajax.php?post_id=' . $post_id . '&amp;action=spam' ), 'spam-feedback_' . $post_id );&nbsp;</div></li><li><div>              echo '&quot;&gt;Spam&lt;/a&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>              echo ' | ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;span class=&quot;delete&quot; id=&quot;feedback-trash-' . $post_id;&nbsp;</div></li><li><div>              echo '&quot;&gt;';&nbsp;</div></li><li><div>              echo '&lt;a class=&quot;submitdelete&quot; title=&quot;' . esc_attr__( 'Trash', 'jetpack' );&nbsp;</div></li><li><div>              echo '&quot; href=&quot;' . get_delete_post_link( $post_id );&nbsp;</div></li><li><div>              echo '&quot;&gt;' . __( 'Trash', 'jetpack' ) . '&lt;/a&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;script&gt;&nbsp;</div></li><li><div>jQuery(document).ready( function($) {&nbsp;</div></li><li><div>  $('#feedback-spam-&lt;?php echo $post_id; ?&gt;').click( function(e) {&nbsp;</div></li><li><div>      e.preventDefault();&nbsp;</div></li><li><div>      $.post( ajaxurl, {&nbsp;</div></li><li><div>              action: 'grunion_ajax_spam', &nbsp;</div></li><li><div>              post_id: '&lt;?php echo $post_id; ?&gt;', &nbsp;</div></li><li><div>              make_it: 'spam', &nbsp;</div></li><li><div>              sub_menu: jQuery('.subsubsub .current').attr('href'), &nbsp;</div></li><li><div>              _ajax_nonce: '&lt;?php echo wp_create_nonce( 'grunion-post-status-' . $post_id ); ?&gt;'&nbsp;</div></li><li><div>          }, &nbsp;</div></li><li><div>          function( r ) {&nbsp;</div></li><li><div>              $('#post-&lt;?php echo $post_id; ?&gt;')&nbsp;</div></li><li><div>                  .css( {backgroundColor:'#FF7979'} )&nbsp;</div></li><li><div>                  .fadeOut(350, function() {&nbsp;</div></li><li><div>                      $(this).remove();&nbsp;</div></li><li><div>                      $('.subsubsub').html(r);&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $('#feedback-trash-&lt;?php echo $post_id; ?&gt;').click(function(e) {&nbsp;</div></li><li><div>      e.preventDefault();&nbsp;</div></li><li><div>      $.post(ajaxurl, {&nbsp;</div></li><li><div>              action: 'grunion_ajax_spam', &nbsp;</div></li><li><div>              post_id: '&lt;?php echo $post_id; ?&gt;', &nbsp;</div></li><li><div>              make_it: 'trash', &nbsp;</div></li><li><div>              sub_menu: jQuery('.subsubsub .current').attr('href'), &nbsp;</div></li><li><div>              _ajax_nonce: '&lt;?php echo wp_create_nonce( 'grunion-post-status-' . $post_id ); ?&gt;'&nbsp;</div></li><li><div>          }, &nbsp;</div></li><li><div>          function(r) {&nbsp;</div></li><li><div>              $('#post-&lt;?php echo $post_id; ?&gt;')&nbsp;</div></li><li><div>                  .css({backgroundColor: '#FF7979'})&nbsp;</div></li><li><div>                  .fadeOut(350, function() {&nbsp;</div></li><li><div>                      $(this).remove();&nbsp;</div></li><li><div>                      $('.subsubsub').html(r);&nbsp;</div></li><li><div>                  });&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>});&nbsp;</div></li><li><div>&lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>          } elseif ( $post-&gt;post_status == 'spam' ) {&nbsp;</div></li><li><div>              echo '&lt;span class=&quot;unspam unapprove&quot; id=&quot;feedback-ham-' . $post_id;&nbsp;</div></li><li><div>              echo '&quot;&gt;&lt;a title=&quot;';&nbsp;</div></li><li><div>              echo __( 'Mark this message as NOT spam', 'jetpack' );&nbsp;</div></li><li><div>              echo '&quot; href=&quot;&quot;&gt;Not Spam&lt;/a&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>              echo ' | ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo &quot;&lt;span class='delete' id='feedback-trash-&quot; . $post_id;&nbsp;</div></li><li><div>              echo &quot;'&gt; &lt;a class='submitdelete' title='&quot;;&nbsp;</div></li><li><div>              echo esc_attr( __( 'Delete this item permanently', 'jetpack' ) );&nbsp;</div></li><li><div>              echo &quot;' href='&quot; . get_delete_post_link( $post-&gt;ID, '', true );&nbsp;</div></li><li><div>              echo &quot;'&gt;&quot; . __( 'Delete Permanently', 'jetpack' ) . &quot;&lt;/a&gt;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;script&gt;&nbsp;</div></li><li><div>jQuery(document).ready( function($) {&nbsp;</div></li><li><div>  $('#feedback-ham-&lt;?php echo $post_id; ?&gt;').click( function(e) {&nbsp;</div></li><li><div>      e.preventDefault();&nbsp;</div></li><li><div>      $.post( ajaxurl, {&nbsp;</div></li><li><div>              action: 'grunion_ajax_spam', &nbsp;</div></li><li><div>              post_id: '&lt;?php echo $post_id; ?&gt;', &nbsp;</div></li><li><div>              make_it: 'ham', &nbsp;</div></li><li><div>              sub_menu: jQuery('.subsubsub .current').attr('href'), &nbsp;</div></li><li><div>              _ajax_nonce: '&lt;?php echo wp_create_nonce( 'grunion-post-status-' . $post_id ); ?&gt;'&nbsp;</div></li><li><div>          }, &nbsp;</div></li><li><div>          function( r ) {&nbsp;</div></li><li><div>              $('#post-&lt;?php echo $post_id; ?&gt;')&nbsp;</div></li><li><div>                  .css( {backgroundColor:'#59C859'} )&nbsp;</div></li><li><div>                  .fadeOut(350, function() {&nbsp;</div></li><li><div>                      $(this).remove();&nbsp;</div></li><li><div>                      $('.subsubsub').html(r);&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>});&nbsp;</div></li><li><div>&lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'feedback_date':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $date_time_format = _x( '%1$s \a\t %2$s', '{$date_format} \a\t {$time_format}', 'jetpack' );&nbsp;</div></li><li><div>          $date_time_format = sprintf( $date_time_format, get_option( 'date_format' ), get_option( 'time_format' ) );&nbsp;</div></li><li><div>          $time = date_i18n( $date_time_format, get_the_time( 'U' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo $time;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function grunion_esc_attr( $attr ) {&nbsp;</div></li><li><div>  $out = esc_attr( $attr );&nbsp;</div></li><li><div>  <span class="comment">// we also have to entity-encode square brackets so they don't interfere with the shortcode parser</span>&nbsp;</div></li><li><div>  <span class="comment">// FIXME: do this better - just stripping out square brackets for now since they mysteriously keep reappearing</span>&nbsp;</div></li><li><div>  $out = str_replace( '[', '', $out );&nbsp;</div></li><li><div>  $out = str_replace( ']', '', $out );&nbsp;</div></li><li><div>  return $out;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function grunion_sort_objects( $a, $b ) {&nbsp;</div></li><li><div>  if ( isset($a['order']) && isset($b['order']) )&nbsp;</div></li><li><div>      return $a['order'] - $b['order'];&nbsp;</div></li><li><div>  return 0;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// take an array of field types from the form builder, and construct a shortcode form</span>&nbsp;</div></li><li><div><span class="comment">// returns both the shortcode form, and HTML markup representing a preview of the form</span>&nbsp;</div></li><li><div>function grunion_ajax_shortcode() {&nbsp;</div></li><li><div>  check_ajax_referer( 'grunion_shortcode' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $attributes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( array( 'subject', 'to' ) as $attribute ) {&nbsp;</div></li><li><div>      if ( isset( $_POST[$attribute] ) && strlen( $_POST[$attribute] ) ) {&nbsp;</div></li><li><div>          $attributes[$attribute] = stripslashes( $_POST[$attribute] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array( $_POST['fields'] ) ) {&nbsp;</div></li><li><div>      $fields = stripslashes_deep( $_POST['fields'] );&nbsp;</div></li><li><div>      usort( $fields, 'grunion_sort_objects' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $field_shortcodes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $fields as $field ) {&nbsp;</div></li><li><div>          $field_attributes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $field['required'] ) && 'true' === $field['required'] ) {&nbsp;</div></li><li><div>              $field_attributes['required'] = 'true';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( array( 'options', 'label', 'type' ) as $attribute ) {&nbsp;</div></li><li><div>              if ( isset( $field[$attribute] ) ) {&nbsp;</div></li><li><div>                  $field_attributes[$attribute] = $field[$attribute];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $field_shortcodes[] = new Grunion_Contact_Form_Field( $field_attributes );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $grunion = new Grunion_Contact_Form( $attributes, $field_shortcodes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  die( &quot;\n$grunion\n&quot; );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// takes a post_id, extracts the contact-form shortcode from that post (if there is one), parses it, </span>&nbsp;</div></li><li><div><span class="comment">// and constructs a json object representing its contents and attributes</span>&nbsp;</div></li><li><div>function grunion_ajax_shortcode_to_json() {&nbsp;</div></li><li><div>  global $post, $grunion_form;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  check_ajax_referer( 'grunion_shortcode_to_json' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !isset( $_POST['content'] ) || !is_numeric( $_POST['post_id'] ) ) {&nbsp;</div></li><li><div>      die( '-1' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $content = stripslashes( $_POST['content'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// doesn't look like a post with a [contact-form] already.</span>&nbsp;</div></li><li><div>  if ( false === has_shortcode( $content, 'contact-form' ) ) {&nbsp;</div></li><li><div>      die( '' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post = get_post( $_POST['post_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_shortcode( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $grunion = Grunion_Contact_Form::$last;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $out = array(&nbsp;</div></li><li><div>      'to' =&gt; '', &nbsp;</div></li><li><div>      'subject' =&gt; '', &nbsp;</div></li><li><div>      'fields' =&gt; array(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $grunion-&gt;fields as $field ) {&nbsp;</div></li><li><div>      $out['fields'][$field-&gt;get_attribute( 'id' )] = $field-&gt;attributes;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $to = $grunion-&gt;get_attribute( 'to' );&nbsp;</div></li><li><div>  $subject = $grunion-&gt;get_attribute( 'subject' );&nbsp;</div></li><li><div>  foreach ( array( 'to', 'subject' ) as $attribute ) {&nbsp;</div></li><li><div>      $value = $grunion-&gt;get_attribute( $attribute );&nbsp;</div></li><li><div>      if ( isset( $grunion-&gt;defaults[$attribute] ) && $value == $grunion-&gt;defaults[$attribute] ) {&nbsp;</div></li><li><div>          $value = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $out[$attribute] = $value;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  die( json_encode( $out ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_ajax_grunion_shortcode', 'grunion_ajax_shortcode' );&nbsp;</div></li><li><div>add_action( 'wp_ajax_grunion_shortcode_to_json', 'grunion_ajax_shortcode_to_json' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// process row-action spam/not spam clicks</span>&nbsp;</div></li><li><div>add_action( 'wp_ajax_grunion_ajax_spam', 'grunion_ajax_spam' );&nbsp;</div></li><li><div>function grunion_ajax_spam() {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $_POST['make_it'] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post_id = (int) $_POST['post_id'];&nbsp;</div></li><li><div>  check_ajax_referer( 'grunion-post-status-' . $post_id );&nbsp;</div></li><li><div>  if ( ! current_user_can( &quot;edit_page&quot;, $post_id ) ) {&nbsp;</div></li><li><div>      wp_die( __( 'You are not allowed to manage this item.', 'jetpack' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  require_once dirname( __FILE__ ) . '/grunion-contact-form.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_menu = '';&nbsp;</div></li><li><div>  if ( isset( $_POST['sub_menu'] ) && preg_match( '|post_type=feedback|', $_POST['sub_menu'] ) ) {&nbsp;</div></li><li><div>      if ( preg_match( '|post_status=spam|', $_POST['sub_menu'] ) ) {&nbsp;</div></li><li><div>          $current_menu = 'spam';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( preg_match( '|post_status=trash|', $_POST['sub_menu'] ) ) {&nbsp;</div></li><li><div>          $current_menu = 'trash';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $current_menu = 'messages';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post = get_post( $post_id );&nbsp;</div></li><li><div>  $post_type_object = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>  $akismet_values = get_post_meta( $post_id, '_feedback_akismet_values', TRUE );&nbsp;</div></li><li><div>  if ( $_POST['make_it'] == 'spam' ) {&nbsp;</div></li><li><div>      $post-&gt;post_status = 'spam';&nbsp;</div></li><li><div>      $status = wp_insert_post( $post );&nbsp;</div></li><li><div>      wp_transition_post_status( 'spam', 'publish', $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">/** This action is already documented in modules/contact-form/admin.php */</span></span></span>&nbsp;</div></li><li><div>      do_action( 'contact_form_akismet', 'spam', $akismet_values );&nbsp;</div></li><li><div>  } elseif ( $_POST['make_it'] == 'ham' ) {&nbsp;</div></li><li><div>      $post-&gt;post_status = 'publish';&nbsp;</div></li><li><div>      $status = wp_insert_post( $post );&nbsp;</div></li><li><div>      wp_transition_post_status( 'publish', 'spam', $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">/** This action is already documented in modules/contact-form/admin.php */</span></span></span>&nbsp;</div></li><li><div>      do_action( 'contact_form_akismet', 'ham', $akismet_values );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $comment_author_email = $reply_to_addr = $message = $to = $headers = false;&nbsp;</div></li><li><div>      $blog_url = parse_url( site_url() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// resend the original email</span>&nbsp;</div></li><li><div>      $email = get_post_meta( $post_id, '_feedback_email', TRUE );&nbsp;</div></li><li><div>      $content_fields = Grunion_Contact_Form_Plugin::parse_fields_from_content( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $email ) && !empty( $content_fields ) ) {&nbsp;</div></li><li><div>          if ( isset( $content_fields['_feedback_author_email'] ) ) {&nbsp;</div></li><li><div>              $comment_author_email = $content_fields['_feedback_author_email'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $email['to'] ) ) {&nbsp;</div></li><li><div>              $to = $email['to'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $email['message'] ) ) {&nbsp;</div></li><li><div>              $message = $email['message'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $email['headers'] ) ) {&nbsp;</div></li><li><div>              $headers = $email['headers'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $headers = 'From: &quot;' . $content_fields['_feedback_author'] .'&quot; &lt;wordpress@' . $blog_url['host']  . &quot;&gt;\r\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $comment_author_email ) ) {&nbsp;</div></li><li><div>                  $reply_to_addr = $comment_author_email;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( is_array( $to ) ) {&nbsp;</div></li><li><div>                  $reply_to_addr = $to[0];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $reply_to_addr ) {&nbsp;</div></li><li><div>                  $headers .= 'Reply-To: &quot;' . $content_fields['_feedback_author'] .'&quot; &lt;' . $reply_to_addr . &quot;&gt;\r\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $headers .= &quot;Content-Type: text/plain; charset=\&quot;&quot; . get_option('blog_charset') . &quot;\&quot;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the subject of the email sent after a contact form submission.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @module contact-form</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 3.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $content_fields['_feedback_subject'] Feedback's subject line.</span>&nbsp;</div></li><li><div><span class="comment">           * @param array $content_fields['_feedback_all_fields'] Feedback's data from old fields.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $subject = apply_filters( 'contact_form_subject', $content_fields['_feedback_subject'], $content_fields['_feedback_all_fields'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_mail( $to, $subject, $message, $headers );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } elseif( $_POST['make_it'] == 'publish' ) {&nbsp;</div></li><li><div>      if ( ! current_user_can($post_type_object-&gt;cap-&gt;delete_post, $post_id) ) {&nbsp;</div></li><li><div>          wp_die( __( 'You are not allowed to move this item out of the Trash.', 'jetpack' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! wp_untrash_post($post_id) ) {&nbsp;</div></li><li><div>          wp_die( __( 'Error in restoring from Trash.', 'jetpack' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } elseif( $_POST['make_it'] == 'trash' ) {&nbsp;</div></li><li><div>      if ( ! current_user_can($post_type_object-&gt;cap-&gt;delete_post, $post_id) ) {&nbsp;</div></li><li><div>          wp_die( __( 'You are not allowed to move this item to the Trash.', 'jetpack' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! wp_trash_post($post_id) ) {&nbsp;</div></li><li><div>          wp_die( __( 'Error in moving to Trash.', 'jetpack' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sql = &quot;&nbsp;</div></li><li><div>      SELECT post_status, &nbsp;</div></li><li><div>          COUNT( * ) AS post_count&nbsp;</div></li><li><div>      FROM `{$wpdb-&gt;posts}`&nbsp;</div></li><li><div>      WHERE post_type =  'feedback'&nbsp;</div></li><li><div>      GROUP BY post_status&nbsp;</div></li><li><div>  &quot;;&nbsp;</div></li><li><div>  $status_count = (array) $wpdb-&gt;get_results( $sql, ARRAY_A );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $status = array();&nbsp;</div></li><li><div>  $status_html = '';&nbsp;</div></li><li><div>  foreach ( $status_count as $i =&gt; $row ) {&nbsp;</div></li><li><div>      $status[$row['post_status']] = $row['post_count'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $status['publish'] ) ) {&nbsp;</div></li><li><div>      $status_html .= '&lt;li&gt;&lt;a href=&quot;edit.php?post_type=feedback&quot;';&nbsp;</div></li><li><div>      if ( $current_menu == 'messages' ) {&nbsp;</div></li><li><div>          $status_html .= ' class=&quot;current&quot;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $status_html .= '&gt;' . __( 'Messages', 'jetpack' ) . ' &lt;span class=&quot;count&quot;&gt;';&nbsp;</div></li><li><div>      $status_html .= '(' . number_format( $status['publish'] ) . ')';&nbsp;</div></li><li><div>      $status_html .= '&lt;/span&gt;&lt;/a&gt; |&lt;/li&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $status['trash'] ) ) {&nbsp;</div></li><li><div>      $status_html .= '&lt;li&gt;&lt;a href=&quot;edit.php?post_status=trash&amp;post_type=feedback&quot;';&nbsp;</div></li><li><div>      if ( $current_menu == 'trash' )&nbsp;</div></li><li><div>          $status_html .= ' class=&quot;current&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $status_html .= '&gt;' . __( 'Trash', 'jetpack' ) . ' &lt;span class=&quot;count&quot;&gt;';&nbsp;</div></li><li><div>      $status_html .= '(' . number_format( $status['trash'] ) . ')';&nbsp;</div></li><li><div>      $status_html .= '&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>      if ( isset( $status['spam'] ) )&nbsp;</div></li><li><div>          $status_html .= ' |';&nbsp;</div></li><li><div>      $status_html .= '&lt;/li&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $status['spam'] ) ) {&nbsp;</div></li><li><div>      $status_html .= '&lt;li&gt;&lt;a href=&quot;edit.php?post_status=spam&amp;post_type=feedback&quot;';&nbsp;</div></li><li><div>      if ( $current_menu == 'spam' )&nbsp;</div></li><li><div>          $status_html .= ' class=&quot;current&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $status_html .= '&gt;' . __( 'Spam', 'jetpack' ) . ' &lt;span class=&quot;count&quot;&gt;';&nbsp;</div></li><li><div>      $status_html .= '(' . number_format( $status['spam'] ) . ')';&nbsp;</div></li><li><div>      $status_html .= '&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $status_html;&nbsp;</div></li><li><div>  exit;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'omnisearch_add_providers', 'grunion_omnisearch_add_providers' );&nbsp;</div></li><li><div>function grunion_omnisearch_add_providers() {&nbsp;</div></li><li><div>  <span class="comment">// Feedback uses capability_type 'page'</span>&nbsp;</div></li><li><div>  if ( current_user_can( 'edit_pages' ) ) {&nbsp;</div></li><li><div>      require_once( GRUNION_PLUGIN_DIR . '/grunion-omnisearch.php' );&nbsp;</div></li><li><div>      new Jetpack_Omnisearch_Grunion;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add the scripts that will add the &quot;Check for Spam&quot; button to the Feedbacks dashboard page.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function grunion_enable_spam_recheck() {&nbsp;</div></li><li><div>  if ( ! defined( 'AKISMET_VERSION' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only add to feedback, only to non-spam view</span>&nbsp;</div></li><li><div>  if ( 'edit-feedback' != $screen-&gt;id || ( ! empty( $_GET['post_status'] ) && 'spam' == $_GET['post_status'] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add the scripts that handle the spam check event.</span>&nbsp;</div></li><li><div>  wp_register_script( 'grunion-admin', plugin_dir_url( __FILE__ ) . 'js/grunion-admin.js', array( 'jquery' ) );&nbsp;</div></li><li><div>  wp_enqueue_script( 'grunion-admin' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_enqueue_style( 'grunion.css' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add the actual &quot;Check for Spam&quot; button.</span>&nbsp;</div></li><li><div>  add_action( 'admin_head', 'grunion_check_for_spam_button' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'admin_enqueue_scripts', 'grunion_enable_spam_recheck' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add the &quot;Check for Spam&quot; button to the Feedbacks dashboard page.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function grunion_check_for_spam_button() {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Get HTML for the button</span></span>&nbsp;</div></li><li><div>  $button_html = get_submit_button(&nbsp;</div></li><li><div>      __( 'Check for Spam', 'jetpack' ), &nbsp;</div></li><li><div>      'secondary', &nbsp;</div></li><li><div>      'jetpack-check-feedback-spam', &nbsp;</div></li><li><div>      false, &nbsp;</div></li><li><div>      array( 'class' =&gt; 'jetpack-check-feedback-spam' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $button_html .= '&lt;span class=&quot;jetpack-check-feedback-spam-spinner&quot;&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Add the button next to the filter button via js</span></span>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>      jQuery( function( $ ) {&nbsp;</div></li><li><div>          $( '#posts-filter #post-query-submit' ).after( '&lt;?php echo $button_html; ?&gt;' );&nbsp;</div></li><li><div>      } );&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Recheck all approved feedbacks for spam.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function grunion_recheck_queue() {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $query = 'post_type=feedback&post_status=publish';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_POST['limit'], $_POST['offset'] ) ) {&nbsp;</div></li><li><div>      $query .= '&posts_per_page=' . intval( $_POST['limit'] ) . '&offset=' . intval( $_POST['offset'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $approved_feedbacks = get_posts( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $approved_feedbacks as $feedback ) {&nbsp;</div></li><li><div>      $meta = get_post_meta( $feedback-&gt;ID, '_feedback_akismet_values', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter whether the submitted feedback is considered as spam.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @module contact-form</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 3.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool false Is the submitted feedback spam? Default to false.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $meta Feedack values returned by the Akismet plugin.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $is_spam = apply_filters( 'jetpack_contact_form_is_spam', false, $meta );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $is_spam ) {&nbsp;</div></li><li><div>          wp_update_post( array( 'ID' =&gt; $feedback-&gt;ID, 'post_status' =&gt; 'spam' ) );&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** This action is already documented in modules/contact-form/admin.php */</span></span></span>&nbsp;</div></li><li><div>          do_action( 'contact_form_akismet', 'spam', $akismet_values );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_send_json( array(&nbsp;</div></li><li><div>      'processed' =&gt; count( $approved_feedbacks ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_ajax_grunion_recheck_queue', 'grunion_recheck_queue' );&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Jetpack by WordPress.com</li><li><span></span>3.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>