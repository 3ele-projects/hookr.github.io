<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.9.3" data-slug="buddypress-docs" data-type="class" data-id="71899"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp_docs_component | class | Buddypress Docs | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="BP_Docs_Component, class, plugin, buddypress-docs, 1.9.3" /><meta name="description" content="The BuddyPress Docs BP Docs Component class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=c97e143a64095b810827e1f7c85698f4' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/bp_docs_component/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fbp_docs_component%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fbp_docs_component%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-docs-1.9.3-class-bp_docs_component","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp_docs_component" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress-docs." href="http://hookr.io/plugins/buddypress-docs/" class="plugin"><span property="name">buddypress-docs</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.9.3." href="http://hookr.io/plugins/buddypress-docs/1.9.3/" class="H_VERSION"><span property="name">1.9.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/buddypress-docs/1.9.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp_docs_component</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="594"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/all/" title="All">All <span class="count badge">594</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="256"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/hooks/" title="Hooks">Hooks <span class="count badge">256</span></a></li><li class="" data-id="action" data-count="73"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/actions/" title="Actions">Actions <span class="count badge">73</span></a></li><li class="" data-id="filter" data-count="183"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/filters/" title="Filters">Filters <span class="count badge">183</span></a></li><li class="active" data-id="class" data-count="27"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/classes/" title="Classes">Classes <span class="count badge">27</span></a></li><li class="" data-id="constant" data-count="21"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/constants/" title="Constants">Constants <span class="count badge">21</span></a></li><li class="" data-id="function" data-count="290"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/functions/" title="Functions">Functions <span class="count badge">290</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>BP_Docs_Component</strong></h1><p>The BuddyPress Docs <strong>BP Docs Component</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/files/includes-component/" class="file">/includes/component.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="16" class="block" start="16"><li><div>class BP_Docs_Component extends BP_Component {&nbsp;</div></li><li><div>    var $groups_integration;&nbsp;</div></li><li><div>    var $submitted_data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $post_type_name;&nbsp;</div></li><li><div>    var $associated_tax_name;&nbsp;</div></li><li><div>    var $access_tax_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $slugtocheck = array();&nbsp;</div></li><li><div>    var $query;&nbsp;</div></li><li><div>    var $includes_url;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $current_view;&nbsp;</div></li><li><div>    var $slug_defined_in_wp_config = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct() {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        parent::start(&nbsp;</div></li><li><div>            'bp_docs', &nbsp;</div></li><li><div>            __( 'BuddyPress Docs', 'bp-docs' ), &nbsp;</div></li><li><div>            BP_DOCS_INSTALL_PATH&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $bp-&gt;active_components[$this-&gt;id] = '1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;setup_hooks();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets up the hooks for the Component's custom methods&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function setup_hooks() {&nbsp;</div></li><li><div>        require( BP_DOCS_INCLUDES_PATH . 'integration-users.php' );&nbsp;</div></li><li><div>        $this-&gt;users_integration = new BP_Docs_Users_Integration;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_is_active( 'groups' ) ) {&nbsp;</div></li><li><div>            require( BP_DOCS_INCLUDES_PATH . 'integration-groups.php' );&nbsp;</div></li><li><div>            $this-&gt;groups_integration = new BP_Docs_Groups_Integration;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_is_active( 'activity' ) ) {&nbsp;</div></li><li><div>            require( BP_DOCS_INCLUDES_PATH . 'activity.php' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'bp_actions', array( &$this, 'catch_page_load' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;attachments = new BP_Docs_Attachments();&nbsp;</div></li><li><div>//        add_action( 'wp', array( $this, 'setup_attachments' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get submitted form data out of the cookie&nbsp;</div></li><li><div>        add_action( 'bp_actions', array( $this, 'submitted_form_data' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Methods related to comment behavior&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Redirect to the correct place after a comment&nbsp;</div></li><li><div>        add_action( 'comment_post_redirect', array( &$this, 'comment_post_redirect' ), 99, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Doc comments are always from trusted members (for the moment), so approve them&nbsp;</div></li><li><div>        add_action( 'pre_comment_approved', array( $this, 'approve_doc_comments' ), 999, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter the location of the comments template to allow it to be included with&nbsp;</div></li><li><div>        // the plugin&nbsp;</div></li><li><div>        add_filter( 'comments_template', array( $this, 'comments_template' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'post_type_link', array( &$this, 'filter_permalinks' ), 10, 4 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Keep comment notifications from being sent&nbsp;</div></li><li><div>        add_filter( 'comment_post', array( $this, 'check_comment_type' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Force comments_open to obey Doc-specific settings.&nbsp;</div></li><li><div>        add_filter( 'comments_open', array( $this, 'comments_open' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the Search filter markup&nbsp;</div></li><li><div>        add_filter( 'bp_docs_filter_types', array( $this, 'filter_type' ) );&nbsp;</div></li><li><div>        add_filter( 'bp_docs_filter_sections', array( $this, 'filter_markup' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Determine whether the directory view is filtered by a keyword search.&nbsp;</div></li><li><div>        add_filter( 'bp_docs_is_directory_view_filtered', array( $this, 'is_directory_view_filtered' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * MISC&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'bp_core_get_directory_page_ids', array( $this, 'remove_bp_page' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Respect $activities_template-&gt;disable_blogforum_replies&nbsp;</div></li><li><div>        add_filter( 'bp_activity_can_comment', array( $this, 'activity_can_comment' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add body class&nbsp;</div></li><li><div>        add_filter( 'bp_get_the_body_class', array( $this, 'body_class' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Global directory tags&nbsp;</div></li><li><div>        add_filter( 'bp_docs_taxonomy_get_item_terms', array( $this, 'get_item_terms' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'bp_docs_init', array( $this, 'set_includes_url' ) );&nbsp;</div></li><li><div>        add_action( 'wp_enqueue_scripts', array( $this, 'enqueue_scripts' ) );&nbsp;</div></li><li><div>        add_action( 'wp_print_styles', array( $this, 'enqueue_styles' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the &quot;last directory viewed&quot; cookie when viewing the main docs directory.&nbsp;</div></li><li><div>        add_action( 'bp_actions', array( $this, 'set_directory_cookie' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the parent and child theme names to the body class when on a BP Docs page.&nbsp;</div></li><li><div>        add_filter( 'body_class', array( $this, 'filter_body_class' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Implementation of BP_Component::setup_globals()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Creates globals required by BP_Component.&nbsp;</div></li><li><div>     * Registers post_type and taxonomy names in component global.&nbsp;</div></li><li><div>     * Sets up the 'slugstocheck', which are used when enqueuing styles and scripts.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     * @see BP_Docs_Component::enqueue_scripts()&nbsp;</div></li><li><div>     * @see BP_Docs_Component::enqueue_styles()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function setup_globals( $args = array() ) {&nbsp;</div></li><li><div>        global $bp_docs;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set up the $globals array to be passed along to parent::setup_globals()&nbsp;</div></li><li><div>        $globals = array(&nbsp;</div></li><li><div>            'slug' =&gt; bp_docs_get_docs_slug(), &nbsp;</div></li><li><div>            'root_slug' =&gt; isset( $bp-&gt;pages-&gt;{$this-&gt;id}-&gt;slug ) ? $bp-&gt;pages-&gt;{$this-&gt;id}-&gt;slug : bp_docs_get_docs_slug(), &nbsp;</div></li><li><div>            'has_directory' =&gt; false, // Set to false if not required&nbsp;</div></li><li><div>            'notification_callback' =&gt; 'bp_docs_format_notifications', &nbsp;</div></li><li><div>            'search_string' =&gt; __( 'Search Docs...', 'bp-docs' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let BP_Component::setup_globals() do its work.&nbsp;</div></li><li><div>        parent::setup_globals( $globals );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Stash tax and post type names in the $bp global for use in template tags&nbsp;</div></li><li><div>        $this-&gt;post_type_name = $bp_docs-&gt;post_type_name;&nbsp;</div></li><li><div>        $this-&gt;associated_item_tax_name = $bp_docs-&gt;associated_item_tax_name;&nbsp;</div></li><li><div>        $this-&gt;access_tax_name = $bp_docs-&gt;access_tax_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // This info is loaded here because it needs to happen after BP core globals are&nbsp;</div></li><li><div>        // set up&nbsp;</div></li><li><div>        $this-&gt;slugstocheck = bp_action_variables() ? bp_action_variables() : array();&nbsp;</div></li><li><div>        $this-&gt;slugstocheck[] = bp_current_component();&nbsp;</div></li><li><div>        $this-&gt;slugstocheck[] = bp_current_action();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;set_current_item_type();&nbsp;</div></li><li><div>        $this-&gt;set_current_view();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets up Docs menu under My Account toolbar&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function setup_admin_bar( $wp_admin_nav = array() ) {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wp_admin_nav = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_user_logged_in() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $title = bp_docs_get_user_tab_name();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Add the &quot;My Account&quot; sub menus&nbsp;</div></li><li><div>            $wp_admin_nav[] = array(&nbsp;</div></li><li><div>                'parent' =&gt; $bp-&gt;my_account_menu_id, &nbsp;</div></li><li><div>                'id' =&gt; 'my-account-' . $this-&gt;id, &nbsp;</div></li><li><div>                'title' =&gt; $title, &nbsp;</div></li><li><div>                'href' =&gt; bp_docs_get_mydocs_link(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $wp_admin_nav[] = array(&nbsp;</div></li><li><div>                'parent' =&gt; 'my-account-' . $this-&gt;id, &nbsp;</div></li><li><div>                'id' =&gt; 'my-account-' . $this-&gt;id . '-started', &nbsp;</div></li><li><div>                'title' =&gt; __( 'Started By Me', 'bp-docs' ), &nbsp;</div></li><li><div>                'href' =&gt; bp_docs_get_mydocs_started_link(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $wp_admin_nav[] = array(&nbsp;</div></li><li><div>                'parent' =&gt; 'my-account-' . $this-&gt;id, &nbsp;</div></li><li><div>                'id' =&gt; 'my-account-' . $this-&gt;id . '-edited', &nbsp;</div></li><li><div>                'title' =&gt; __( 'Edited By Me', 'bp-docs' ), &nbsp;</div></li><li><div>                'href' =&gt; bp_docs_get_mydocs_edited_link(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $wp_admin_nav[] = array(&nbsp;</div></li><li><div>                'parent' =&gt; 'my-account-' . $this-&gt;id, &nbsp;</div></li><li><div>                'id' =&gt; 'my-account-' . $this-&gt;id . '-create', &nbsp;</div></li><li><div>                'title' =&gt; __( 'Create New Doc', 'bp-docs' ), &nbsp;</div></li><li><div>                'href' =&gt; bp_docs_get_create_link(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        parent::setup_admin_bar( $wp_admin_nav );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get previously submitted form data out of the cookie, and stash.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.8&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function submitted_form_data() {&nbsp;</div></li><li><div>        if ( isset( $_COOKIE['bp-docs-submit-data'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;submitted_data = json_decode( stripslashes( $_COOKIE['bp-docs-submit-data'] ) );&nbsp;</div></li><li><div>            setcookie( 'bp-docs-submit-data', '', time() - 24*60*60, '/' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * In Docs 1.2 through 1.2.2, there was an error in which Docs registered&nbsp;</div></li><li><div>     * a bp-pages entry. This fixes the error&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function remove_bp_page( $pages ) {&nbsp;</div></li><li><div>        if ( isset( $pages['bp_docs'] ) ) {&nbsp;</div></li><li><div>            unset( $pages['bp_docs']);&nbsp;</div></li><li><div>            bp_update_option( 'bp-pages', $pages );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $pages;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the item type of the item you're looking at - e.g 'group', 'user'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return str $view The current item type&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function set_current_item_type() {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $type = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_is_user() ) {&nbsp;</div></li><li><div>            $type = 'user';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $type = apply_filters( 'bp_docs_get_item_type', $type, $this );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;item_type = $type;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the current view, based on the page you're looking at.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Filter 'bp_docs_get_current_view' to extend to different components.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param str $item_type Defaults to the object's item type&nbsp;</div></li><li><div>     * @return str $view The current view. Core values: edit, single, list, category&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function set_current_view( $item_type = false ) {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $view = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$item_type )&nbsp;</div></li><li><div>            $item_type = $this-&gt;item_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $view = apply_filters( 'bp_docs_get_current_view', $view, $item_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;current_view = $view;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Creates component navigation (Member &gt; Docs)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     * @todo Make the 'Docs' label customizable by the admin&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function setup_nav( $main_nav = array(), $sub_nav = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $main_nav = array(&nbsp;</div></li><li><div>            'name' =&gt; bp_docs_get_user_tab_name(), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Disabled count for now. See https://github.com/boonebgorges/buddypress-docs/issues/261&nbsp;</div></li><li><div>            //'name' =&gt; sprintf( __( 'Docs &lt;span&gt;%d&lt;/span&gt;', 'bp-docs' ), bp_docs_get_doc_count( bp_displayed_user_id(), 'user' ) ), &nbsp;</div></li><li><div>            'slug' =&gt; bp_docs_get_docs_slug(), &nbsp;</div></li><li><div>            'position' =&gt; 80, &nbsp;</div></li><li><div>            'screen_function' =&gt; array( &$this, 'template_loader' ), &nbsp;</div></li><li><div>            'default_subnav_slug' =&gt; BP_DOCS_STARTED_SLUG&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $parent_url = trailingslashit( bp_displayed_user_domain() . bp_docs_get_docs_slug() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $mydocs_label = bp_is_my_profile() ? __( 'My Docs ', 'bp-docs' ) : sprintf( __( '%s&#8217;s Docs', 'bp-docs' ), bp_get_user_firstname( bp_get_displayed_user_fullname() ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sub_nav[] = array(&nbsp;</div></li><li><div>            'name' =&gt; bp_is_my_profile() ? __( 'Started By Me', 'bp-docs' ) : sprintf( __( 'Started By %s', 'bp-docs' ), bp_get_user_firstname() ), &nbsp;</div></li><li><div>            'slug' =&gt; BP_DOCS_STARTED_SLUG, &nbsp;</div></li><li><div>            'parent_url' =&gt; $parent_url, &nbsp;</div></li><li><div>            'parent_slug' =&gt; bp_docs_get_docs_slug(), &nbsp;</div></li><li><div>            'screen_function' =&gt; array( &$this, 'template_loader' ), &nbsp;</div></li><li><div>            'position' =&gt; 10&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sub_nav[] = array(&nbsp;</div></li><li><div>            'name' =&gt; bp_is_my_profile() ? __( 'Edited By Me', 'bp-docs' ) : sprintf( __( 'Edited By %s', 'bp-docs' ), bp_get_user_firstname() ), &nbsp;</div></li><li><div>            'slug' =&gt; BP_DOCS_EDITED_SLUG, &nbsp;</div></li><li><div>            'parent_url' =&gt; $parent_url, &nbsp;</div></li><li><div>            'parent_slug' =&gt; bp_docs_get_docs_slug(), &nbsp;</div></li><li><div>            'screen_function' =&gt; array( &$this, 'template_loader' ), &nbsp;</div></li><li><div>            'position' =&gt; 20, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        parent::setup_nav( $main_nav, $sub_nav );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Utility function for loading component template and hooking content&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     * @see self::setup_nav()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function template_loader() {&nbsp;</div></li><li><div>        add_action( 'bp_template_content', array( &$this, 'select_template' ) );&nbsp;</div></li><li><div>        bp_core_load_template( 'members/single/plugins' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Utility function for selecting the correct Docs template to be loaded in the component&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * At the moment, this only loads a single template. Logic could be&nbsp;</div></li><li><div>     * put here in the future in case more than one template needs to be&nbsp;</div></li><li><div>     * displayable on the component page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function select_template() {&nbsp;</div></li><li><div>        $template = 'docs-loop.php';&nbsp;</div></li><li><div>        include bp_docs_locate_template( apply_filters( 'bp_docs_select_template', $template ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads the Docs query.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * We do this in order to have some of the info about the current doc throughout the&nbsp;</div></li><li><div>     * loading process&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     * @deprecated No longer used since 1.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function do_query() {&nbsp;</div></li><li><div>        _deprecated_function( __METHOD__, '1.2' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Catches page loads, determines what to do, and sends users on their merry way&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     * @todo This needs a ton of cleanup&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function catch_page_load() {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $_POST['doc-edit-submit'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Existing Docs have a more specific permission check.&nbsp;</div></li><li><div>            $doc = bp_docs_get_current_doc();&nbsp;</div></li><li><div>            if ( $doc && ! current_user_can( 'bp_docs_edit', $doc-&gt;ID ) ) {&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            } elseif ( ! $doc && ! current_user_can( 'bp_docs_create' ) ) {&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            check_admin_referer( 'bp_docs_save' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this_doc = new BP_Docs_Query;&nbsp;</div></li><li><div>            $result = $this_doc-&gt;save();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            bp_core_add_message( $result['message'], $result['message_type'] );&nbsp;</div></li><li><div>            bp_core_redirect( trailingslashit( $result['redirect_url'] ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $_POST['docs-filter-submit'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;handle_filters();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If this is the edit screen, ensure that the user can edit the&nbsp;</div></li><li><div>        // doc before querying, and redirect if necessary&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_edit() ) {&nbsp;</div></li><li><div>            if ( current_user_can( 'bp_docs_edit' ) ) {&nbsp;</div></li><li><div>                $doc = bp_docs_get_current_doc();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // The user can edit, so we check for edit locks&nbsp;</div></li><li><div>                // Because we're not using WP autosave at the moment, ensure that&nbsp;</div></li><li><div>                // the lock interval always returns as in process&nbsp;</div></li><li><div>                add_filter( 'wp_check_post_lock_window', create_function( false, 'return time();' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $doc ) {&nbsp;</div></li><li><div>                    $lock = bp_docs_check_post_lock( $doc-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( $lock ) {&nbsp;</div></li><li><div>                        bp_core_add_message( sprintf( __( 'This doc is currently being edited by %s. To prevent overwrites, you cannot edit until that user has finished. Please try again in a few minutes.', 'bp-docs' ), bp_core_get_user_displayname( $lock ) ), 'error' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Redirect back to the non-edit view of this document&nbsp;</div></li><li><div>                        bp_core_redirect( bp_docs_get_doc_link( $doc-&gt;ID ) );&nbsp;</div></li><li><div>                        bp_core_redirect( $group_permalink . $bp-&gt;bp_docs-&gt;slug . '/' . $doc_slug );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( function_exists( 'bp_core_no_access' ) && !is_user_logged_in() ) {&nbsp;</div></li><li><div>                    bp_core_no_access();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // The user does not have edit permission. Redirect.&nbsp;</div></li><li><div>                bp_core_add_message( __( 'You do not have permission to edit the doc.', 'bp-docs' ), 'error' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Redirect back to the non-edit view of this document&nbsp;</div></li><li><div>                bp_core_redirect( bp_docs_get_doc_link( $doc-&gt;ID ) );&nbsp;</div></li><li><div>                die();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_create() ) {&nbsp;</div></li><li><div>            if ( ! current_user_can( 'bp_docs_create' ) ) {&nbsp;</div></li><li><div>                // The user does not have edit permission. Redirect.&nbsp;</div></li><li><div>                if ( function_exists( 'bp_core_no_access' ) && !is_user_logged_in() )&nbsp;</div></li><li><div>                    bp_core_no_access();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                bp_core_add_message( __( 'You do not have permission to create a Doc in this group.', 'bp-docs' ), 'error' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $group_permalink = bp_get_group_permalink( $bp-&gt;groups-&gt;current_group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Redirect back to the Doc list view&nbsp;</div></li><li><div>                bp_core_redirect( $group_permalink . $bp-&gt;bp_docs-&gt;slug . '/' );&nbsp;</div></li><li><div>                die();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $bp-&gt;bp_docs-&gt;current_view ) && 'history' == $bp-&gt;bp_docs-&gt;current_view ) {&nbsp;</div></li><li><div>            if ( ! current_user_can( 'bp_docs_view_history' ) ) {&nbsp;</div></li><li><div>                // The user does not have edit permission. Redirect.&nbsp;</div></li><li><div>                if ( function_exists( 'bp_core_no_access' ) && !is_user_logged_in() )&nbsp;</div></li><li><div>                    bp_core_no_access();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                bp_core_add_message( __( 'You do not have permission to view this Doc\'s history.', 'bp-docs' ), 'error' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $doc = bp_docs_get_current_doc();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $redirect = bp_docs_get_doc_link( $doc-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Redirect back to the Doc list view&nbsp;</div></li><li><div>                bp_core_redirect( $redirect );&nbsp;</div></li><li><div>                die();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Cancel edit lock&nbsp;</div></li><li><div>        if ( !empty( $_GET['bpd_action'] ) && $_GET['bpd_action'] == 'cancel_edit_lock' ) {&nbsp;</div></li><li><div>            // Check the nonce&nbsp;</div></li><li><div>            check_admin_referer( 'bp_docs_cancel_edit_lock' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Todo: make this part of the perms system&nbsp;</div></li><li><div>            if ( is_super_admin() || bp_group_is_admin() ) {&nbsp;</div></li><li><div>                $doc = bp_docs_get_current_doc();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Todo: get this into a proper method as well, blech&nbsp;</div></li><li><div>                delete_post_meta( $doc-&gt;ID, '_bp_docs_last_pinged' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                bp_core_add_message( __( 'Lock successfully removed', 'bp-docs' ) );&nbsp;</div></li><li><div>                bp_core_redirect( bp_docs_get_doc_link( $doc-&gt;ID ) );&nbsp;</div></li><li><div>                die();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Cancel edit&nbsp;</div></li><li><div>        // Have to have a catcher for this so the edit lock can be removed&nbsp;</div></li><li><div>        if ( !empty( $_GET['bpd_action'] ) && $_GET['bpd_action'] == 'cancel_edit' ) {&nbsp;</div></li><li><div>            $doc = bp_docs_get_current_doc();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Todo: get this into a proper method as well, blech&nbsp;</div></li><li><div>            delete_post_meta( $doc-&gt;ID, '_bp_docs_last_pinged' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            bp_core_redirect( bp_docs_get_doc_link( $doc-&gt;ID ) );&nbsp;</div></li><li><div>            die();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Todo: get this into a proper method&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_read() && ! empty( $_GET['delete'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            check_admin_referer( 'bp_docs_delete' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( current_user_can( 'bp_docs_manage' ) ) {&nbsp;</div></li><li><div>                $force_delete = false;&nbsp;</div></li><li><div>                if ( ! empty( $_GET['force_delete'] ) ) {&nbsp;</div></li><li><div>                    $force_delete = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $delete_doc_id = get_queried_object_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( bp_docs_trash_doc( $delete_doc_id, $force_delete ) ) {&nbsp;</div></li><li><div>                    bp_core_add_message( __( 'Doc successfully deleted!', 'bp-docs' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    bp_core_add_message( __( 'Could not delete doc.', 'bp-docs' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                bp_core_add_message( __( 'You do not have permission to delete that doc.', 'bp-docs' ), 'error' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Send the user back to the most recently viewed directory if possible.&nbsp;</div></li><li><div>            if ( isset( $_COOKIE[ 'bp-docs-last-docs-directory' ] ) && filter_var( $_COOKIE[ 'bp-docs-last-docs-directory' ], FILTER_VALIDATE_URL) ) {&nbsp;</div></li><li><div>                $delete_redirect = $_COOKIE[ 'bp-docs-last-docs-directory' ];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $delete_redirect = home_url( bp_docs_get_docs_slug() );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            bp_core_redirect( $delete_redirect );&nbsp;</div></li><li><div>            die();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_read() && ! empty( $_GET['untrash'] ) && ! empty( $_GET['doc_id'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'bp_docs_untrash' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $untrash_doc_id = absint( $_GET['doc_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( current_user_can( 'bp_docs_manage', $untrash_doc_id ) ) {&nbsp;</div></li><li><div>                if ( bp_docs_untrash_doc( $untrash_doc_id ) ) {&nbsp;</div></li><li><div>                    bp_core_add_message( __( 'Doc successfully removed from Trash!', 'bp-docs' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    bp_core_add_message( __( 'Could not remove Doc from Trash.', 'bp-docs' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                bp_core_add_message( __( 'You do not have permission to remove that Doc from the Trash.', 'bp-docs' ), 'error' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            bp_core_redirect( bp_docs_get_doc_link( $untrash_doc_id ) );&nbsp;</div></li><li><div>            die();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_read() && ! empty( $_GET[ BP_DOCS_UNLINK_FROM_GROUP_SLUG ] ) && ! empty( $_GET['doc_id'] ) && ! empty( $_GET['group_id'] ) ) {&nbsp;</div></li><li><div>            check_admin_referer( 'bp_docs_unlink_from_group' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $unlink_doc_id = absint( $_GET['doc_id'] );&nbsp;</div></li><li><div>            $unlink_group_id = absint( $_GET['group_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( current_user_can( 'bp_docs_dissociate_from_group', $unlink_group_id ) ) {&nbsp;</div></li><li><div>                if ( bp_docs_unlink_from_group( $unlink_doc_id, $unlink_group_id ) ) {&nbsp;</div></li><li><div>                    bp_core_add_message( __( 'Doc successfully removed from the group', 'bp-docs' ) );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    bp_core_add_message( __( 'Could not remove Doc from the group.', 'bp-docs' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                bp_core_add_message( __( 'You do not have permission to remove that Doc from this group.', 'bp-docs' ), 'error' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            bp_core_redirect( bp_get_group_permalink( groups_get_group( array( 'group_id' =&gt; $unlink_group_id ) ) ) . $bp-&gt;bp_docs-&gt;slug . '/' );&nbsp;</div></li><li><div>            die();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * METHODS RELATED TO DOC COMMENTS&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Approve Doc comments as necessary.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Docs handles its own comment permissions, so we override WP's value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3.3&nbsp;</div></li><li><div>     * @param string $approved&nbsp;</div></li><li><div>     * @param array $commentdata&nbsp;</div></li><li><div>     * @return string $approved&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function approve_doc_comments( $approved, $commentdata ) {&nbsp;</div></li><li><div>        $post = get_post( $commentdata['comment_post_ID'] );&nbsp;</div></li><li><div>        if ( bp_docs_get_post_type_name() === $post-&gt;post_type ) {&nbsp;</div></li><li><div>            if ( bp_docs_user_can( 'post_comments', bp_loggedin_user_id(), $post-&gt;ID ) ) {&nbsp;</div></li><li><div>                $approved = 1;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $approved = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $approved;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filters the comment_post_direct URL so that the user gets sent back to the true&nbsp;</div></li><li><div>     * comment URL after posting&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param str $location The original location, created by WP&nbsp;</div></li><li><div>     * @param obj $comment The new comment object&nbsp;</div></li><li><div>     * @return str $location The correct location&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function comment_post_redirect( $location, $comment ) {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check to see whether this is a BP Doc&nbsp;</div></li><li><div>        $post = get_post( $comment-&gt;comment_post_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $bp-&gt;bp_docs-&gt;post_type_name != $post-&gt;post_type )&nbsp;</div></li><li><div>            return $location;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $location = bp_docs_get_doc_link( $comment-&gt;comment_post_ID ) . '#comment-' . $comment-&gt;comment_ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $location;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Posts an activity item when a comment is posted to a doc&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param obj $comment_id The id of the comment that's just been saved.&nbsp;</div></li><li><div>     * @return int $activity_id The id number of the activity created&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function post_comment_activity( $comment_id ) {&nbsp;</div></li><li><div>        return bp_docs_post_comment_activity( $comment_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter the location of the comments.php template&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This function uses a little trick to make sure that the comments.php file can be&nbsp;</div></li><li><div>     * overridden by child themes, yet still has a fallback in the plugin folder.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * If you find this annoying, I have provided a filter for your convenience.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param str $path The path (STYLESHEETPATH . $file) from comments_template()&nbsp;</div></li><li><div>     * @return str The path of the preferred template&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function comments_template( $path ) {&nbsp;</div></li><li><div>        if ( ! bp_docs_is_existing_doc() )&nbsp;</div></li><li><div>            return $path;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $original_path = $path;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $path = locate_template( 'docs/single/comments.php' ) ) {&nbsp;</div></li><li><div>            $path = BP_DOCS_INSTALL_PATH . 'includes/templates/docs/single/comments.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'bp_docs_comment_template_path', $path, $original_path );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prevents comment notification emails from being sent on BP Docs comments&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * For the moment, I'm shutting off WP's native email notifications on BP Docs comments.&nbsp;</div></li><li><div>     * They are better handled as part of the BP activity stream. This maneuver requires a&nbsp;</div></li><li><div>     * trick: when a comment is posted on a BP Doc type post, I hijack the get_option() call&nbsp;</div></li><li><div>     * for comments_notify and return 0 (rather than false, which would not stop the real&nbsp;</div></li><li><div>     * get_option operation from running).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $comment_id ID number of the new comment being posted&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function check_comment_type( $comment_id ) {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $comment = get_comment( $comment_id );&nbsp;</div></li><li><div>        $post = get_post( $comment-&gt;comment_post_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $bp-&gt;bp_docs-&gt;post_type_name == $post-&gt;post_type ) {&nbsp;</div></li><li><div>            add_filter( 'pre_option_comments_notify', create_function( false, 'return 0;' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Force comments_open status to obey Doc-specific settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.8.6&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $open    Whether the current post is open for comments.&nbsp;</div></li><li><div>     * @param int  $post_id ID of the post.&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function comments_open( $open, $post_id ) {&nbsp;</div></li><li><div>        $post = get_post( $post_id );&nbsp;</div></li><li><div>        if ( ! ( $post instanceof WP_Post ) || bp_docs_get_post_type_name() !== $post-&gt;post_type ) {&nbsp;</div></li><li><div>            return $open;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return current_user_can( 'bp_docs_post_comments', $post_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds BP Docs options to activity filter dropdowns&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function activity_filter_options() {&nbsp;</div></li><li><div>        return bp_docs_activity_filter_options();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Posts an activity item on doc save&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param obj $query The query object created in BP_Docs_Query and passed to the&nbsp;</div></li><li><div>     *     bp_docs_doc_saved filter&nbsp;</div></li><li><div>     * @return int $activity_id The id number of the activity created&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function post_activity( $query ) {&nbsp;</div></li><li><div>        return bp_docs_post_activity( $query );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete activity associated with a Doc&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Run on transition_post_status, to catch deletes from all locations&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $new_status&nbsp;</div></li><li><div>     * @param string $old_status&nbsp;</div></li><li><div>     * @param obj WP_Post object&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_doc_activity( $new_status, $old_status, $post ) {&nbsp;</div></li><li><div>        return bp_docs_delete_doc_activity( $new_status, $old_status, $post );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * MISCELLANEOUS&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display the proper permalink for Docs&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This function filters 'post_type_link', which in turn powers get_permalink() and related&nbsp;</div></li><li><div>     * functions.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * BuddyPress Docs has a completely flat architecture for URLs, where&nbsp;</div></li><li><div>     * parent slugs never appear in the URL (as they do in the case of WP&nbsp;</div></li><li><div>     * pages). So we reconstruct the link completely.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.1.8&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param str $link The permalink&nbsp;</div></li><li><div>     * @param obj $post The post object&nbsp;</div></li><li><div>     * @param bool $leavename&nbsp;</div></li><li><div>     * @param bool $sample See get_post_permalink() for an explanation of these two params&nbsp;</div></li><li><div>     * @return str $link The filtered permalink&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function filter_permalinks( $link, $post, $leavename, $sample ) {&nbsp;</div></li><li><div>        if ( bp_docs_get_post_type_name() == $post-&gt;post_type ) {&nbsp;</div></li><li><div>            $link = trailingslashit( bp_docs_get_archive_link() . $post-&gt;post_name );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return html_entity_decode( $link );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Repsect disable_blogforum_replies&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * BuddyPress allows you to disable activity commenting on items related to blog posts or&nbsp;</div></li><li><div>     * to forums, content types that have their own reply/comment mechanisms. Since BuddyPress&nbsp;</div></li><li><div>     * Docs are similar in this respect, they should respect this setting as well.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * In the future, I may add a separate toggle for this. I may also build a filter that&nbsp;</div></li><li><div>     * redirects the Comment/Reply link so that it goes to the Doc's Comment section, or so that&nbsp;</div></li><li><div>     * this setting reflects the individual Doc's can_comment settings. (For now, this would&nbsp;</div></li><li><div>     * require too many additional queries.)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This function filters bp_activity_can_comment, which was introduced in BP 1.5. It is&nbsp;</div></li><li><div>     * therefore not backward compatible with BP &lt; 1.5.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.1.17&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $can_comment Whether the current user can comment. Comes from&nbsp;</div></li><li><div>     *             bp_activity_can_comment()&nbsp;</div></li><li><div>     * @return bool $can_comment&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function activity_can_comment( $can_comment ) {&nbsp;</div></li><li><div>        global $activities_template;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'bp_doc_created' == bp_get_activity_action_name() ||&nbsp;</div></li><li><div>             'bp_doc_edited' == bp_get_activity_action_name() ||&nbsp;</div></li><li><div>             'bp_doc_comment' == bp_get_activity_action_name()&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>               // Flip the 'disable'&nbsp;</div></li><li><div>            $can_comment = !(bool)$activities_template-&gt;disable_blogforum_replies;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'bp_docs_activity_can_comment', $can_comment );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handles doc filters from a form post and translates to $_GET arguments before redirect&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function handle_filters() {&nbsp;</div></li><li><div>        $redirect_url = apply_filters( 'bp_docs_handle_filters', bp_docs_get_item_docs_link() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        bp_core_redirect( $redirect_url );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the includes URL for use when loading scripts and styles&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function set_includes_url() {&nbsp;</div></li><li><div>        $this-&gt;includes_url = plugins_url() . '/' . BP_DOCS_PLUGIN_SLUG . '/includes/';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add a bp-docs class to bp-docs pages&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function body_class( $classes ) {&nbsp;</div></li><li><div>        if ( bp_docs_is_docs_component() ) {&nbsp;</div></li><li><div>            $classes[] = 'bp-docs';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_trashed() ) {&nbsp;</div></li><li><div>            $classes[] = 'trashed-doc';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( wp_is_mobile() ) {&nbsp;</div></li><li><div>            $classes[] = 'mobile';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_edit() ) {&nbsp;</div></li><li><div>            $classes[] = 'bp-docs-edit';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_create() ) {&nbsp;</div></li><li><div>            $classes[] = 'bp-docs-create';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array_unique( $classes );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * When on a global directory, get terms for the tag cloud&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.4&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_item_terms( $terms ) {&nbsp;</div></li><li><div>        global $wpdb, $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only on global directory and mygroups view&nbsp;</div></li><li><div>        if ( ! bp_docs_is_global_directory() && ! bp_docs_is_mygroups_directory() ) {&nbsp;</div></li><li><div>            return $terms;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get list of docs the user has access to&nbsp;</div></li><li><div>        $item_ids = bp_docs_get_doc_ids_accessible_to_current_user();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Pass to wp_get_object_terms()&nbsp;</div></li><li><div>        $terms = wp_get_object_terms( $item_ids, array( $bp-&gt;bp_docs-&gt;docs_tag_tax_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Reformat&nbsp;</div></li><li><div>        $terms_array = array();&nbsp;</div></li><li><div>        foreach ( $terms as $t ) {&nbsp;</div></li><li><div>            $terms_array[ $t-&gt;slug ] = array(&nbsp;</div></li><li><div>                'count' =&gt; $t-&gt;count, &nbsp;</div></li><li><div>                'name' =&gt; $t-&gt;name, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $item_ids, $terms );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $terms_array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function filter_type( $types ) {&nbsp;</div></li><li><div>        $types[] = array(&nbsp;</div></li><li><div>            'slug' =&gt; 'search', &nbsp;</div></li><li><div>            'title' =&gt; __( 'Search', 'bp-docs' ), &nbsp;</div></li><li><div>            'query_arg' =&gt; 's', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return $types;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static function filter_markup() {&nbsp;</div></li><li><div>        $has_search = ! empty( $_GET['s'] );&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;docs-filter-section-search&quot; class=&quot;docs-filter-section&lt;?php if ( $has_search ) : ?&gt; docs-filter-section-open&lt;?php endif ?&gt;&quot;&gt;&nbsp;</div></li><li><div>            &lt;form action=&quot;&quot; method=&quot;get&quot;&gt;&nbsp;</div></li><li><div>                &lt;input name=&quot;s&quot; value=&quot;&lt;?php the_search_query() ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                &lt;input name=&quot;search_submit&quot; type=&quot;submit&quot; value=&quot;&lt;?php _e( 'Search', 'bp-docs' ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                &lt;?php do_action( 'bp_docs_directory_filter_search_form' ) ?&gt;&nbsp;</div></li><li><div>            &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine whether the directory view is filtered by a keyword search.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool  $is_filtered Is the current directory view filtered?&nbsp;</div></li><li><div>      * @param array $exclude Array of filter types to ignore.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool $is_filtered&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_directory_view_filtered( $is_filtered, $exclude ) {&nbsp;</div></li><li><div>        // If this filter is excluded, stop now.&nbsp;</div></li><li><div>        if ( in_array( 's', $exclude ) ) {&nbsp;</div></li><li><div>            return $is_filtered;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $_GET['s'] ) ) {&nbsp;</div></li><li><div>            $is_filtered = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $is_filtered;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads JavaScript&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function enqueue_scripts() {&nbsp;</div></li><li><div>        wp_register_script( 'bp-docs-js', plugins_url( BP_DOCS_PLUGIN_SLUG . '/includes/js/bp-docs.js' ), array( 'jquery' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // This is for edit/create scripts&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_edit()&nbsp;</div></li><li><div>             ||&nbsp;</div></li><li><div>             bp_docs_is_doc_create()&nbsp;</div></li><li><div>             || ( !empty( $this-&gt;query-&gt;current_view )&nbsp;</div></li><li><div>                   &&&nbsp;</div></li><li><div>                   ( 'edit' == $this-&gt;query-&gt;current_view || 'create' == $this-&gt;query-&gt;current_view )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>            require_once( ABSPATH . '/wp-admin/includes/post.php' );&nbsp;</div></li><li><div>            wp_enqueue_script( 'common' );&nbsp;</div></li><li><div>            wp_enqueue_script( 'jquery-color' );&nbsp;</div></li><li><div>            wp_enqueue_script( 'editor' );&nbsp;</div></li><li><div>            wp_enqueue_script( 'utils' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_script( 'bp-docs-idle-js', plugins_url( BP_DOCS_PLUGIN_SLUG . '/includes/js/idle.js' ), array( 'jquery', 'bp-docs-js' ) );&nbsp;</div></li><li><div>            wp_enqueue_script( 'bp-docs-idle-js' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_script( 'jquery-colorbox', plugins_url( BP_DOCS_PLUGIN_SLUG . '/lib/js/colorbox/jquery.colorbox-min.js' ), array( 'jquery' ) );&nbsp;</div></li><li><div>            wp_enqueue_script( 'jquery-colorbox' );&nbsp;</div></li><li><div>            // Edit mode requires bp-docs-js to be dependent on TinyMCE, so we must&nbsp;</div></li><li><div>            // reregister bp-docs-js with the correct dependencies&nbsp;</div></li><li><div>            wp_deregister_script( 'bp-docs-js' );&nbsp;</div></li><li><div>            wp_register_script( 'bp-docs-js', plugins_url( BP_DOCS_PLUGIN_SLUG . '/includes/js/bp-docs.js' ), array( 'jquery', 'editor', 'heartbeat' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_script( 'word-counter', site_url() . '/wp-admin/js/word-count.js', array( 'jquery' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_enqueue_script( 'bp-docs-edit-validation', plugins_url( BP_DOCS_PLUGIN_SLUG . '/includes/js/edit-validation.js' ), array( 'jquery', 'bp-docs-js' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only load our JS on the right sorts of pages. Generous to account for&nbsp;</div></li><li><div>        // different item types&nbsp;</div></li><li><div>        if ( in_array( bp_docs_get_docs_slug(), $this-&gt;slugstocheck ) || bp_docs_is_single_doc() || bp_docs_is_global_directory() || bp_docs_is_mygroups_directory() || bp_docs_is_doc_create() ) {&nbsp;</div></li><li><div>            wp_enqueue_script( 'bp-docs-js' );&nbsp;</div></li><li><div>            wp_enqueue_script( 'comment-reply' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $strings = array(&nbsp;</div></li><li><div>                'upload_title' =&gt; __( 'Upload File', 'bp-docs' ), &nbsp;</div></li><li><div>                'upload_button' =&gt; __( 'OK', 'bp-docs' ), &nbsp;</div></li><li><div>                'still_working' =&gt; __( 'Still working?', 'bp-docs' ), &nbsp;</div></li><li><div>                'and_x_more' =&gt; __( 'and %d more', 'bp-docs' ), &nbsp;</div></li><li><div>                'failed_submission' =&gt; ! empty( buddypress()-&gt;bp_docs-&gt;submitted_data ) ? 1 : 0, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( bp_docs_is_doc_edit() ) {&nbsp;</div></li><li><div>                $strings['pulse'] = bp_docs_heartbeat_pulse();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            wp_localize_script( 'bp-docs-js', 'bp_docs', $strings );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            do_action( 'bp_docs_enqueue_scripts' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads styles&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0-beta&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function enqueue_styles() {&nbsp;</div></li><li><div>        global $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load the main CSS only on the proper pages&nbsp;</div></li><li><div>        if ( in_array( bp_docs_get_docs_slug(), $this-&gt;slugstocheck ) || bp_docs_is_docs_component() ) {&nbsp;</div></li><li><div>            wp_enqueue_style( 'bp-docs-css', $this-&gt;includes_url . 'css/screen.css' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( bp_docs_is_doc_edit() || bp_docs_is_doc_create() ) {&nbsp;</div></li><li><div>            wp_enqueue_style( 'bp-docs-edit-css', $this-&gt;includes_url . 'css/edit.css' );&nbsp;</div></li><li><div>            wp_enqueue_style( 'thickbox' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Renew the last directory cookie if the user is viewing the main docs library.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function    set_directory_cookie() {&nbsp;</div></li><li><div>        if ( bp_docs_is_global_directory() ) {&nbsp;</div></li><li><div>            @setcookie( 'bp-docs-last-docs-directory', home_url( $_SERVER['REQUEST_URI'] ), 0, '/' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add the parent and child theme names to the body class when on a BP Docs page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $classes An array of body classes.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function filter_body_class( $classes ) {&nbsp;</div></li><li><div>        if ( bp_docs_is_docs_component() ) {&nbsp;</div></li><li><div>            $classes[] = 'bp-docs-body-theme-' . get_stylesheet();&nbsp;</div></li><li><div>            $classes[] = 'bp-docs-body-theme-' . get_template();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $classes;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.8.8</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/buddypress-docs/1.9.3/classes/bp_docs_component/" class="active">1.9.3</a></li><li><a href="http://hookr.io/plugins/buddypress-docs/1.9.2/classes/bp_docs_component/" class="">1.9.2</a></li><li><a href="http://hookr.io/plugins/buddypress-docs/1.9.1/classes/bp_docs_component/" class="">1.9.1</a></li><li><a href="http://hookr.io/plugins/buddypress-docs/1.9.0/classes/bp_docs_component/" class="">1.9.0</a></li><li><a href="http://hookr.io/plugins/buddypress-docs/1.8.8/classes/bp_docs_component/" class="">1.8.8</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>BP_Docs_Component</li><li><span></span>BuddyPress Docs</li><li><span></span>1.9.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>