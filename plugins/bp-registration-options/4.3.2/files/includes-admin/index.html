<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="4.3.2" data-slug="bp-registration-options" data-type="file" data-id="17494"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-admin | file | Bp Registration Options | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, bp-registration-options, 4.3.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=7c7361e905f58c7a18bde88ed240f9ab' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-bp-registration-options-4.3.2-file-includes-admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-admin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to bp-registration-options." href="http://hookr.io/plugins/bp-registration-options/" class="plugin"><span property="name">bp-registration-options</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.3.2." href="http://hookr.io/plugins/bp-registration-options/4.3.2/" class="H_VERSION"><span property="name">4.3.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/bp-registration-options/4.3.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="81"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/all/" title="All">All <span class="count badge">81</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="28"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/hooks/" title="Hooks">Hooks <span class="count badge">28</span></a></li><li class="" data-id="action" data-count="12"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/actions/" title="Actions">Actions <span class="count badge">12</span></a></li><li class="" data-id="filter" data-count="16"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/filters/" title="Filters">Filters <span class="count badge">16</span></a></li><li class="" data-id="class" data-count="2"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/classes/" title="Classes">Classes <span class="count badge">2</span></a></li><li class="" data-id="constant" data-count="1"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/constants/" title="Constants">Constants <span class="count badge">1</span></a></li><li class="" data-id="function" data-count="50"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/functions/" title="Functions">Functions <span class="count badge">50</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/bp-registration-options/4.3.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/admin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Admin Settings for BP Registration Options.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BP-Registration-Options</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a count of our pending users</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return integer  count of our current pending users</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_get_pending_user_count() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === ( $rs = get_transient( 'bpro_user_count' ) ) ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sql = &quot;SELECT count( user_id ) AS count FROM &quot; . $wpdb-&gt;usermeta . &quot; WHERE meta_key = %s AND meta_value = %s&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $rs = $wpdb-&gt;get_col( $wpdb-&gt;prepare( $sql, '_bprwg_is_moderated', 'true' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $rs ) ) {&nbsp;</div></li><li><div>          set_transient( 'bpro_user_count', $rs, 60 * 5 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return ( $rs ) ? $rs[0] : '0';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get our pending users</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param integer $start_from Offset to start from with our paging of pending users.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Array of user ID objects or empty array.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_get_pending_users( $start_from = 0 ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sql = &quot;&nbsp;</div></li><li><div>      SELECT u.ID AS user_id&nbsp;</div></li><li><div>      FROM &quot; . $wpdb-&gt;users . &quot; AS u&nbsp;</div></li><li><div>      INNER JOIN &quot; . $wpdb-&gt;usermeta . &quot; AS um&nbsp;</div></li><li><div>      WHERE u.ID = um.user_id&nbsp;</div></li><li><div>      AND um.meta_key = %s&nbsp;</div></li><li><div>      AND meta_value = %s&nbsp;</div></li><li><div>      ORDER BY u.user_registered&nbsp;</div></li><li><div>      LIMIT %d, 20&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $results = $wpdb-&gt;get_results( $wpdb-&gt;prepare( $sql, '_bprwg_is_moderated', 'true', $start_from ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the results of the pending users.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $results Array of found pending users.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $results = apply_filters( 'bpro_hook_get_pending_users', $results );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return ( ! empty( $results ) ) ? $results : array();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete our stored options so that they get reset next time.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_handle_reset_messages() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  delete_option( 'bprwg_activate_message' );&nbsp;</div></li><li><div>  delete_option( 'bprwg_approved_message' );&nbsp;</div></li><li><div>  delete_option( 'bprwg_denied_message' );&nbsp;</div></li><li><div>  delete_option( 'bprwg_admin_pending_message' );&nbsp;</div></li><li><div>  delete_option( 'bprwg_user_pending_message' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after we've deleted our four message options</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bpro_hook_after_reset_messages' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle processing of new values for general options page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args Array of inputs to save.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_handle_general_settings( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before we've saved our options</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args Array of inputs to be saved.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bpro_hook_before_save_settings', $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Handle saving our moderate setting.</span>&nbsp;</div></li><li><div>  if ( ! empty( $args['set_moderate'] ) ) {&nbsp;</div></li><li><div>      $bp_moderate = sanitize_text_field( $args['set_moderate'] );&nbsp;</div></li><li><div>      update_option( 'bprwg_moderate', $bp_moderate );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      delete_option( 'bprwg_moderate' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Handle saving our private network setting.</span>&nbsp;</div></li><li><div>  if ( ! empty( $args['set_private'] ) ) {&nbsp;</div></li><li><div>      $privacy_network = sanitize_text_field( $args['set_private'] );&nbsp;</div></li><li><div>      update_option( 'bprwg_privacy_network', $privacy_network );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      delete_option( 'bprwg_privacy_network' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Handle saving our BuddyPress notifications setting.</span>&nbsp;</div></li><li><div>  if ( ! empty( $args['enable_notifications'] ) ) {&nbsp;</div></li><li><div>      $enable_notifications = sanitize_text_field( $args['enable_notifications'] );&nbsp;</div></li><li><div>      update_option( 'bprwg_enable_notifications', $enable_notifications );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      delete_option( 'bprwg_enable_notifications' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $activate_message = wp_kses( $args['activate_message'], wp_kses_allowed_html( 'post' ) );&nbsp;</div></li><li><div>  update_option( 'bprwg_activate_message', $activate_message );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $approved_message = wp_kses( $args['approved_message'], wp_kses_allowed_html( 'post' ) );&nbsp;</div></li><li><div>  update_option( 'bprwg_approved_message', $approved_message );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $denied_message = wp_kses( $args['denied_message'], wp_kses_allowed_html( 'post' ) );&nbsp;</div></li><li><div>  update_option( 'bprwg_denied_message', $denied_message );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $admin_pending_message = wp_kses( $args['admin_pending_message'], wp_kses_allowed_html( 'post' ) );&nbsp;</div></li><li><div>  update_option( 'bprwg_admin_pending_message', $admin_pending_message );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_pending_message = wp_kses( $args['user_pending_message'], wp_kses_allowed_html( 'post' ) );&nbsp;</div></li><li><div>  update_option( 'bprwg_user_pending_message', $user_pending_message );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after we've saved our options</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args Array of inputs that were saved.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bpro_hook_after_save_settings', $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Process approved or denied users. Sends out the notifications and handles user deletion when applicable</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  unknown</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_form_actions() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Settings save.</span>&nbsp;</div></li><li><div>  if ( isset( $_POST['save_general'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      check_admin_referer( 'bp_reg_options_check' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_registration_handle_general_settings(&nbsp;</div></li><li><div>          array(&nbsp;</div></li><li><div>              'set_moderate' =&gt; empty( $_POST['bp_moderate'] ) ? '' : $_POST['bp_moderate'], &nbsp;</div></li><li><div>              'set_private' =&gt; empty( $_POST['privacy_network'] ) ? '' : $_POST['privacy_network'], &nbsp;</div></li><li><div>              'enable_notifications' =&gt; empty( $_POST['enable_notifications'] ) ? '' : $_POST['enable_notifications'], &nbsp;</div></li><li><div>              'activate_message' =&gt; empty( $_POST['activate_message'] ) ? '' : $_POST['activate_message'], &nbsp;</div></li><li><div>              'approved_message' =&gt; empty( $_POST['approved_message'] ) ? '' : $_POST['approved_message'], &nbsp;</div></li><li><div>              'denied_message' =&gt; empty( $_POST['denied_message'] ) ? '' : $_POST['denied_message'], &nbsp;</div></li><li><div>              'admin_pending_message' =&gt; empty( $_POST['admin_pending_message'] ) ? '' : $_POST['admin_pending_message'], &nbsp;</div></li><li><div>              'user_pending_message' =&gt; empty( $_POST['user_pending_message'] ) ? '' : $_POST['user_pending_message'], &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_POST['reset_messages'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      check_admin_referer( 'bp_reg_options_check' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_registration_handle_reset_messages();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Request submissions.</span>&nbsp;</div></li><li><div>  if ( isset( $_POST['moderate'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      check_admin_referer( 'bp_reg_options_check' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $action = sanitize_text_field( $_POST['moderate'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $checked_members = array();&nbsp;</div></li><li><div>      $send = false;&nbsp;</div></li><li><div>      $subject = '';&nbsp;</div></li><li><div>      $message = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_POST['bp_member_check'] ) ) {&nbsp;</div></li><li><div>          $checked_members = $_POST['bp_member_check'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_array( $checked_members ) ) {&nbsp;</div></li><li><div>          $checked_members = array( $checked_members );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'deny' === $action ) {&nbsp;</div></li><li><div>          $send = true;&nbsp;</div></li><li><div>          $subject = __( 'Membership Denied', 'bp-registration-options' );&nbsp;</div></li><li><div>          $message = get_option( 'bprwg_denied_message' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( 'approve' === $action ) {&nbsp;</div></li><li><div>          $send = true;&nbsp;</div></li><li><div>          $subject = __( 'Membership Approved', 'bp-registration-options' );&nbsp;</div></li><li><div>          $message = get_option( 'bprwg_approved_message' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $checked_members as $user_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Grab our userdata object while we still have a user.</span>&nbsp;</div></li><li><div>          $user = get_userdata( $user_id );&nbsp;</div></li><li><div>          if ( 'deny' == $action || 'ban' == $action ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               // Add our user to the IP ban option.</span>&nbsp;</div></li><li><div><span class="comment">               if ( 'Ban' == $action ) {</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">                  $blockedIPs = get_option( 'bprwg_blocked_ips', array() );</span>&nbsp;</div></li><li><div><span class="comment">                  $blockedemails = get_option( 'bprwg_blocked_emails', array() );</span>&nbsp;</div></li><li><div><span class="comment">                  $blockedIPs[] = get_user_meta( $user_id, 'bprwg_ip_address', true);</span>&nbsp;</div></li><li><div><span class="comment">                  $blockedemails[] = $user-&gt;data-&gt;user_email;</span>&nbsp;</div></li><li><div><span class="comment">                  $successIP = update_option( 'bprwg_blocked_ips', $blockedIPs );</span>&nbsp;</div></li><li><div><span class="comment">                  $successEmail = update_option( 'bprwg_blocked_emails', $blockedemails );</span>&nbsp;</div></li><li><div><span class="comment">              }</span>&nbsp;</div></li><li><div><span class="comment">              */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Fires before the user deletion when user denied.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param int $user_id User ID being deleted.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              do_action( 'bpro_hook_denied_user_before_delete', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_multisite() ) {&nbsp;</div></li><li><div>                  wpmu_delete_user( $user_id );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  wp_delete_user( $user_id );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Fires after the user deletion when user denied.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param int $user_id User ID that was deleted.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              do_action( 'bpro_hook_denied_user_after_delete', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              bp_registration_options_delete_user_count_transient();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( 'approve' === $action ) {&nbsp;</div></li><li><div>              <span class="comment">// Mark as not spam for BuddyPress Registration Options.</span>&nbsp;</div></li><li><div>              bp_registration_set_moderation_status( $user_id, 'false' );&nbsp;</div></li><li><div>              <span class="comment">// Mark as not spam for BuddyPress Core.</span>&nbsp;</div></li><li><div>              bp_core_process_spammer_status( $user_id, 'ham' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Fires after a user has been marked as approved.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param int $user_id ID of the approved user.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              do_action( 'bpro_hook_approved_user', $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              bp_registration_options_delete_user_count_transient();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Only send out message if one exists.</span>&nbsp;</div></li><li><div>          if ( $send ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $mailme = array(&nbsp;</div></li><li><div>                  'user_email' =&gt; $user-&gt;data-&gt;user_email, &nbsp;</div></li><li><div>                  'user_subject' =&gt; $subject, &nbsp;</div></li><li><div>                  'user_message' =&gt; str_replace( '[username]', $user-&gt;data-&gt;user_login, $message ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filters the email arguments before mailing.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param array  $emailme Array of email arguments for wp_mail.</span>&nbsp;</div></li><li><div><span class="comment">               * @param object $user User object for user being moderated.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $mailme_filtered = apply_filters( 'bpro_hook_before_email', $mailme, $user );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'wp_mail_content_type', 'bp_registration_options_set_content_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              wp_mail( $mailme_filtered['user_email'], $mailme_filtered['user_subject'], $mailme_filtered['user_message'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              remove_filter( 'wp_mail_content_type', 'bp_registration_options_set_content_type' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_init', 'bp_registration_options_form_actions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds our admin notices with pending users info, for people who can manage users</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since unknown</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_admin_messages() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member_requests = bp_registration_get_pending_user_count();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $member_requests &gt; 0 && isset( $_GET['page'] ) != 'bp_registration_options_member_requests' && current_user_can( 'add_users' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $message = '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $message .= sprintf(&nbsp;</div></li><li><div>          _n(&nbsp;</div></li><li><div>              'You have %d new member request that needs to be approved or denied.', &nbsp;</div></li><li><div>              'You have %d new member requests that needs to be approved or denied.', &nbsp;</div></li><li><div>              $member_requests, &nbsp;</div></li><li><div>              'bp-registration-options'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          $member_requests&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $message .= ' ' . sprintf(&nbsp;</div></li><li><div>          <span class="comment">/** translators: placeholder will have linked &quot;click here&quot; that goes to requests page. */</span>&nbsp;</div></li><li><div>          __( 'Please %s to take action', 'bp-registration-options' ), &nbsp;</div></li><li><div>          sprintf(&nbsp;</div></li><li><div>              '&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;', &nbsp;</div></li><li><div>              admin_url( '/admin.php?page=bp_registration_options_member_requests' ), &nbsp;</div></li><li><div>              __( 'click here', 'bp-registration-options' )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $message .= '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo $message;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_notices', 'bp_registration_options_admin_messages' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register our plugins menus</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since unknown</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_plugin_menu() {&nbsp;</div></li><li><div>  global $blog_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member_requests = bp_registration_get_pending_user_count();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $capability = ( is_multisite() ) ? 'create_users' : 'delete_users';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the minimum capability needed to view options page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $capability Minimal capability required.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $minimum_cap = apply_filters( 'bp_registration_filter_minimum_caps', $capability );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_menu_page(&nbsp;</div></li><li><div>      __( 'BP Registration', 'bp-registration-options' ), &nbsp;</div></li><li><div>      __( 'BP Registration', 'bp-registration-options' ), &nbsp;</div></li><li><div>      $minimum_cap, &nbsp;</div></li><li><div>      'bp_registration_options', &nbsp;</div></li><li><div>      'bp_registration_options_settings', &nbsp;</div></li><li><div>      'dashicons-groups'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $count = '&lt;span class=&quot;update-plugins count-' . $member_requests . '&quot;&gt;&lt;span class=&quot;plugin-count&quot;&gt;' . $member_requests . '&lt;/span&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_submenu_page(&nbsp;</div></li><li><div>      'bp_registration_options', &nbsp;</div></li><li><div>      __( 'Member Requests ', 'bp-registration-options' ) . $member_requests, &nbsp;</div></li><li><div>      __( 'Member Requests ', 'bp-registration-options' ) . $count, &nbsp;</div></li><li><div>      $minimum_cap, &nbsp;</div></li><li><div>      'bp_registration_options_member_requests', &nbsp;</div></li><li><div>      'bp_registration_options_member_requests'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**add_submenu_page(</span>&nbsp;</div></li><li><div><span class="comment">      'bp_registration_options', </span>&nbsp;</div></li><li><div><span class="comment">      __( 'Banned Sources', 'bp-registration-options' ), </span>&nbsp;</div></li><li><div><span class="comment">      __( 'Banned Sources', 'bp-registration-options' ), </span>&nbsp;</div></li><li><div><span class="comment">      $minimum_cap, </span>&nbsp;</div></li><li><div><span class="comment">      'bp_registration_options_banned', </span>&nbsp;</div></li><li><div><span class="comment">      'bp_registration_options_banned'</span>&nbsp;</div></li><li><div><span class="comment"> );*/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**add_submenu_page(</span>&nbsp;</div></li><li><div><span class="comment">      'bp_registration_options', </span>&nbsp;</div></li><li><div><span class="comment">      __( 'Help / Support', 'bp-registration-options' ), </span>&nbsp;</div></li><li><div><span class="comment">      __( 'Help / Support', 'bp-registration-options' ), </span>&nbsp;</div></li><li><div><span class="comment">      $minimum_cap, </span>&nbsp;</div></li><li><div><span class="comment">      'bp_registration_options_help_support', </span>&nbsp;</div></li><li><div><span class="comment">      'bp_registration_options_help_support'</span>&nbsp;</div></li><li><div><span class="comment"> );*/</span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_menu', 'bp_registration_options_plugin_menu' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create our tab navigation between setting pages</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  unknown</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $page Page title to render.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_tab_menu( $page = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member_requests = bp_registration_get_pending_user_count(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;h1&gt;&lt;?php esc_html_e( 'BP Registration Options', 'bp-registration-options' ); ?&gt;&lt;/h1&gt;&nbsp;</div></li><li><div>  &lt;h2 class=&quot;nav-tab-wrapper&quot;&gt;&nbsp;</div></li><li><div>  &lt;a class=&quot;nav-tab&lt;?php if ( ! $page ) { echo ' nav-tab-active'; } ?&gt;&quot; href=&quot;&lt;?php echo esc_attr( admin_url( 'admin.php?page=bp_registration_options' ) ); ?&gt;&quot;&gt;&lt;?php esc_html_e( 'General Settings', 'bp-registration-options' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>  &lt;a class=&quot;nav-tab&lt;?php if ( 'requests' === $page ) { echo ' nav-tab-active'; } ?&gt;&quot; href=&quot;&lt;?php echo esc_attr( admin_url( 'admin.php?page=bp_registration_options_member_requests' ) ); ?&gt;&quot;&gt;&lt;?php _e( 'Member Requests', 'bp-registration-options' ); ?&gt; (&lt;?php echo $member_requests;?&gt;)&lt;/a&gt;&nbsp;</div></li><li><div>  &lt;?php <span class="comment">// &lt;a class=&quot;nav-tab&lt;?php if ( $page == 'banned' ) echo ' nav-tab-active';?&quot; &lt;?php //href=&quot;&lt;?php echo admin_url( 'admin.php?page=bp_registration_options_banned' ); ?&quot;&gt;&lt;?php //_e( 'Banned', 'bp-registration-options' ); &lt;/a&gt;?&gt;</span>&nbsp;</div></li><li><div>  &lt;?php <span class="comment">// &lt;a class=&quot;nav-tab&lt;?php if ( 'help' === $page ) { echo ' nav-tab-active'; } ?&gt;&lt;?php //&quot; href=&quot;&lt;?php echo esc_attr( admin_url( 'admin.php?page=bp_registration_options_help_support' ) ); &quot;&gt;&lt;?php esc_html_e( 'Help / Support', 'bp-registration-options' ); //&lt;/a&gt; ?&gt;</span>&nbsp;</div></li><li><div>  &lt;/h2&gt;&nbsp;</div></li><li><div>&lt;?php }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Options page for settings and messages to use</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since unknown</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_settings() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check for already saved values.</span>&nbsp;</div></li><li><div>  $bp_moderate = get_option( 'bprwg_moderate' );&nbsp;</div></li><li><div>  $privacy_network = get_option( 'bprwg_privacy_network' );&nbsp;</div></li><li><div>  $enable_notifications = get_option( 'bprwg_enable_notifications' );&nbsp;</div></li><li><div>  $activate_message = get_option( 'bprwg_activate_message' );&nbsp;</div></li><li><div>  $approved_message = get_option( 'bprwg_approved_message' );&nbsp;</div></li><li><div>  $denied_message = get_option( 'bprwg_denied_message' );&nbsp;</div></li><li><div>  $admin_pending_message = get_option( 'bprwg_admin_pending_message' );&nbsp;</div></li><li><div>  $user_pending_message = get_option( 'bprwg_user_pending_message' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $activate_message ) {&nbsp;</div></li><li><div>      $activate_message = __( 'Your membership account is awaiting approval by the site administrator. You will not be able to fully interact with the social aspects of this website until your account is approved. Once approved or denied you will receive an email notice.', 'bp-registration-options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_option( 'bprwg_activate_message', $activate_message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $approved_message ) {&nbsp;</div></li><li><div>      $approved_message = sprintf(&nbsp;</div></li><li><div>          __( 'Hi [username], your member account at %s has been approved! You can now login and start interacting with the rest of the community...', 'bp-registration-options' ), &nbsp;</div></li><li><div>          get_bloginfo( 'url' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_option( 'bprwg_approved_message', $approved_message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $denied_message ) {&nbsp;</div></li><li><div>      $denied_message = sprintf(&nbsp;</div></li><li><div>          __( 'Hi [username], we regret to inform you that your member account at %s has been denied...', 'bp-registration-options' ), &nbsp;</div></li><li><div>          get_bloginfo( 'url' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_option( 'bprwg_denied_message', $denied_message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $admin_pending_message ) {&nbsp;</div></li><li><div>      $admin_pending_message = sprintf(&nbsp;</div></li><li><div>          __( '[username] ( [user_email] ) would like to become a member of your website. To accept or reject their request, please go to %s', 'bp-registration-options' ), &nbsp;</div></li><li><div>          '&lt;a href=&quot;' . admin_url( '/admin.php?page=bp_registration_options_member_requests' ) . '&quot;&gt;' . __( 'Member Requests', 'bp-registration-options' ) . '&lt;/a&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_option( 'bprwg_admin_pending_message', $admin_pending_message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user_pending_message ) {&nbsp;</div></li><li><div>      $user_pending_message = sprintf(&nbsp;</div></li><li><div>          __( 'Hi [username], your account at %s is currently pending approval.', 'bp-registration-options' ), &nbsp;</div></li><li><div>          get_bloginfo( 'url' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      update_option( 'bprwg_denied_message', $user_pending_message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;wrap gensettings&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php bp_registration_options_tab_menu(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;form method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php wp_nonce_field( 'bp_reg_options_check' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the general settings form output, inside the form tag.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'bpro_hook_before_general_settings_form' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;p&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;checkbox&quot; id=&quot;bp_moderate&quot; name=&quot;bp_moderate&quot; value=&quot;1&quot; &lt;?php checked( $bp_moderate, '1' ); ?&gt;/&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;bp_moderate&quot;&gt;&nbsp;</div></li><li><div>                  &lt;strong&gt;&nbsp;</div></li><li><div>                      &lt;?php esc_html_e( 'Moderate New Members', 'bp-registration-options' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/strong&gt; (&lt;?php esc_html_e( 'Every new member will have to be approved by an administrator before they can interact with BuddyPress/bbPress components.', 'bp-registration-options' ); ?&gt;)&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;p&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;checkbox&quot; id=&quot;privacy_network&quot; name=&quot;privacy_network&quot; value=&quot;1&quot; &lt;?php checked( $privacy_network, '1' ); ?&gt;/&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;privacy_network&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php esc_html_e( 'Only registered or approved members can view BuddyPress/bbPress pages (Private Network).', 'bp-registration-options' ); ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;p&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;checkbox&quot; id=&quot;enable_notifications&quot; name=&quot;enable_notifications&quot; value=&quot;1&quot; &lt;?php checked( $enable_notifications, '1' ); ?&gt;/&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;enable_notifications&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php esc_html_e( 'Add new user notification to admin user account BuddyPress notification inbox.', 'bp-registration-options' ); ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;table&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;alignright&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;activate_message&quot;&gt;&lt;?php esc_html_e( 'Activate & Profile Alert Message:', 'bp-registration-options' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;textarea id=&quot;activate_message&quot; name=&quot;activate_message&quot;&gt;&lt;?php echo stripslashes( $activate_message ); ?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;alignright&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;approved_message&quot;&gt;&lt;?php esc_html_e( 'Account Approved Email:', 'bp-registration-options' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;textarea id=&quot;approved_message&quot; name=&quot;approved_message&quot;&gt;&lt;?php echo stripslashes( $approved_message );?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;alignright&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;denied_message&quot;&gt;&lt;?php esc_html_e( 'Account Denied Email:', 'bp-registration-options' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;textarea id=&quot;denied_message&quot; name=&quot;denied_message&quot;&gt;&lt;?php echo stripslashes( $denied_message );?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;alignright&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;admin_pending_message&quot;&gt;&lt;?php esc_html_e( 'Admin Pending Email Message:', 'bp-registration-options' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;textarea id=&quot;admin_pending_message&quot; name=&quot;admin_pending_message&quot;&gt;&lt;?php echo stripslashes( $admin_pending_message );?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;alignright&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;user_pending_message&quot;&gt;&lt;?php esc_html_e( 'User Pending Email Message:', 'bp-registration-options' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;textarea id=&quot;user_pending_message&quot; name=&quot;user_pending_message&quot;&gt;&lt;?php echo stripslashes( $user_pending_message );?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;alignright&quot;&gt;&nbsp;</div></li><li><div>                      &lt;table width=&quot;100%&quot;&gt;&nbsp;</div></li><li><div>                          &lt;tr&gt;&nbsp;</div></li><li><div>                              &lt;td&gt;&nbsp;</div></li><li><div>                                  &lt;?php esc_html_e( 'Short Code Key: [username], [user_email]', 'bp-registration-options' ); ?&gt;&nbsp;</div></li><li><div>                              &lt;/td&gt;&nbsp;</div></li><li><div>                              &lt;td class=&quot;alignright&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;input type=&quot;submit&quot; id=&quot;reset_messages&quot; name=&quot;reset_messages&quot; class=&quot;button button-secondary&quot; value=&quot;&lt;?php esc_attr_e( 'Reset Messages', 'bp-registration-options' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                              &lt;/td&gt;&nbsp;</div></li><li><div>                          &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;/table&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>          &lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after the general settings form output, inside the form tag.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'bpro_hook_after_general_settings_form' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;button class=&quot;button button-primary&quot; name=&quot;save_general&quot; value=&quot;save_general&quot;&gt;&lt;?php esc_attr_e( 'Save Options', 'bp-registration-options' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;/form&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php bp_registration_options_admin_footer();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Options page for managing pending members.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since unknown</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_member_requests() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      bp_registration_options_tab_menu( 'requests' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $member_requests = bp_registration_get_pending_user_count();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $member_requests &gt; 0 ) { ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;form method=&quot;POST&quot; name=&quot;bprwg&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the pending members list output, inside the form tag.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'bpro_hook_before_pending_member_list' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_nonce_field( 'bp_reg_options_check' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;p&gt;&lt;?php esc_html_e( 'Please approve or deny the following new members:', 'bp-registration-options' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;table class=&quot;widefat&quot;&gt;&nbsp;</div></li><li><div>          &lt;thead&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;th id=&quot;cb&quot; class=&quot;manage-column column-cb check-column&quot; scope=&quot;col&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;bp_checkall_top&quot; name=&quot;checkall&quot; /&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Photo', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Name', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Email', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Created', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Additional Data', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>          &lt;/thead&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $odd = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get paged value, determine total pages, and calculate start_from value for offset.</span>&nbsp;</div></li><li><div>          $page = ( isset( $_GET['p'] ) ) ? $_GET['p'] : 1;&nbsp;</div></li><li><div>          $total_pages = ceil( $member_requests / 20 ); <span class="comment">// TODO: Test pagination.</span>&nbsp;</div></li><li><div>          $start_from = ( $page - 1 ) * 20;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $pending_users = bp_registration_get_pending_users( $start_from );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $pending_users as $pending ) {&nbsp;</div></li><li><div>              if ( class_exists( 'BP_Core_User' ) ) {&nbsp;</div></li><li><div>                  $user = new BP_Core_User( $pending-&gt;user_id );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $user_data = get_userdata( $pending-&gt;user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $odd ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;tr class=&quot;alternate&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                  $odd = false;&nbsp;</div></li><li><div>              } else { ?&gt;&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                  $odd = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>                  &lt;th class=&quot;check-column&quot; scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                      &lt;label&gt;&lt;input type=&quot;checkbox&quot; class=&quot;bpro_checkbox&quot; id=&quot;bp_member_check_&lt;?php echo esc_attr( $pending-&gt;user_id ); ?&gt;&quot; name=&quot;bp_member_check[]&quot; value=&quot;&lt;?php echo esc_attr( $pending-&gt;user_id ); ?&gt;&quot;  /&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;?php if ( isset( $user ) ) { ?&gt;&nbsp;</div></li><li><div>                          &lt;a target=&quot;_blank&quot; href=&quot;&lt;?php echo esc_attr( $user-&gt;user_url ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                              &lt;?php echo $user-&gt;avatar_mini; ?&gt;&nbsp;</div></li><li><div>                          &lt;/a&gt;&nbsp;</div></li><li><div>                      &lt;?php } ?&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;?php if ( isset( $user ) ) { ?&gt;&nbsp;</div></li><li><div>                          &lt;strong&gt;&lt;a target=&quot;_blank&quot; href=&quot;&lt;?php echo esc_attr( $user-&gt;user_url ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                              if ( ! empty( $user-&gt;fullname ) ) {&nbsp;</div></li><li><div>                                  echo $user-&gt;fullname;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  echo $user-&gt;profile_data['user_login'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                          &lt;/a&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>                      &lt;?php } else {&nbsp;</div></li><li><div>                          echo $user_data-&gt;user_login;&nbsp;</div></li><li><div>                      } ?&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;a href=&quot;mailto:&lt;?php echo $user_data-&gt;data-&gt;user_email;?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php echo $user_data-&gt;data-&gt;user_email; ?&gt;&nbsp;</div></li><li><div>                      &lt;/a&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;?php echo $user_data-&gt;data-&gt;user_registered; ?&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;td&gt;&nbsp;</div></li><li><div>                      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                       * Fires in the last table cell in pending member list.</span>&nbsp;</div></li><li><div><span class="comment">                       *</span>&nbsp;</div></li><li><div><span class="comment">                       * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">                       *</span>&nbsp;</div></li><li><div><span class="comment">                       * @param int $value Pending user ID.</span>&nbsp;</div></li><li><div><span class="comment">                       */</span>&nbsp;</div></li><li><div>                      do_action( 'bpro_hook_member_item_additional_data', $pending-&gt;user_id ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Fires after an individual pending member table row item.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  do_action( 'bpro_hook_after_pending_member_list_item' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;tfoot&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>                  &lt;th class=&quot;manage-column column-cb check-column&quot; scope=&quot;col&quot;&gt;&lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;bp_checkall_bottom&quot; name=&quot;checkall&quot; /&gt;&lt;/label&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Photo', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Name', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Email', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Created', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;th&gt;&lt;?php esc_html_e( 'Additional Data', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;&nbsp;</div></li><li><div>          &lt;/tfoot&gt;&nbsp;</div></li><li><div>          &lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;p&gt;&nbsp;</div></li><li><div>          &lt;button class=&quot;button button-primary&quot; name=&quot;moderate&quot; value=&quot;approve&quot; id=&quot;bpro_approve&quot;&gt;&lt;?php esc_html_e( 'Approve', 'bp-registration-options' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>          &lt;button class=&quot;button button-secondary&quot; name=&quot;moderate&quot; value=&quot;deny&quot; id=&quot;bpro_deny&quot;&gt;&lt;?php esc_html_e( 'Deny', 'bp-registration-options' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>          &lt;?php <span class="comment">/**&lt;button class=&quot;button button-secondary&quot; name=&quot;moderate&quot; value=&quot;ban&quot; id=&quot;bpro_ban&quot; disabled&gt;&lt;?php esc_html_e( 'Ban', 'bp-registration-options' ); &lt;/button&gt; */</span> ?&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php if ( $total_pages &gt; 1 ) {&nbsp;</div></li><li><div>              $current = ( ! empty( $_GET['p'] ) ) ? $_GET['p'] : 1;&nbsp;</div></li><li><div>              echo '&lt;p&gt;' . esc_html__( 'Pagination: ', 'bp-registration-options' );&nbsp;</div></li><li><div>              for ( $i = 1; $i &lt;= $total_pages; $i++ ) {&nbsp;</div></li><li><div>                  $classes = ( $i == $current ) ? 'bpro_pagination bpro_current wp-ui-highlight' : 'bpro_pagination';&nbsp;</div></li><li><div>                  $classes = 'class=&quot;' . $classes . '&quot;';&nbsp;</div></li><li><div>                  printf(&nbsp;</div></li><li><div>                      '&lt;a href=&quot;%s&quot; %s&gt;%s&lt;/a&gt; ', &nbsp;</div></li><li><div>                      esc_url( add_query_arg( 'p', $i ) ), &nbsp;</div></li><li><div>                      $classes, &nbsp;</div></li><li><div>                      $i&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo '&lt;/p&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after the pending members list output, inside the form tag.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'bpro_hook_after_pending_member_list' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php } else {&nbsp;</div></li><li><div>          echo '&lt;p&gt;&lt;strong&gt;' . esc_html__( 'No new members to approve.', 'bp-registration-options' ) . '&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>  &lt;/div&gt; &lt;!--End Wrap--&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  bp_registration_options_admin_footer();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render our banned members management page</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_banned() {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// NEEDS DONE.</span></span>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_registration_options_tab_menu( 'banned' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $blockedIPs = get_option( 'bprwg_blocked_ips' );&nbsp;</div></li><li><div>  $blockedemails = get_option( 'bprwg_blocked_emails' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $blockedIPs ) || ! empty( $blockedemails ) ) { ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;h3&gt;&lt;?php esc_html_e( 'The following IP addresses are currently banned.', 'bp-registration-options' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>      &lt;table class=&quot;widefat&quot;&gt;&nbsp;</div></li><li><div>      &lt;thead&gt;&nbsp;</div></li><li><div>          &lt;tr&gt;&nbsp;</div></li><li><div>              &lt;th id=&quot;cb&quot; class=&quot;manage-column column-cb check-column&quot; scope=&quot;col&quot;&gt;&nbsp;</div></li><li><div>                  &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;bp_checkall_top_blocked&quot; name=&quot;checkall&quot; /&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;/th&gt;&nbsp;</div></li><li><div>              &lt;th&gt;&lt;?php esc_html_e( 'IP Address', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;/thead&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $odd = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $blockedIPs as $IP ) {&nbsp;</div></li><li><div>          if ( $odd ) {&nbsp;</div></li><li><div>              $attributes = ' class=&quot;alternate&quot;';&nbsp;</div></li><li><div>              $odd = false;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $attributes = '';&nbsp;</div></li><li><div>              $odd = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;tr&lt;?php echo $attributes; ?&gt;&gt;&nbsp;</div></li><li><div>          &lt;th class=&quot;check-column&quot; scope=&quot;row&quot;&gt;&lt;label&gt;&lt;input type=&quot;checkbox&quot; class=&quot;bpro_checkbox&quot; id=&quot;bp_blocked_check_&lt;?php echo $IP; ?&gt;&quot; name=&quot;bp_blockedip_check[]&quot; value=&quot;&lt;?php echo esc_attr( $IP ); ?&gt;&quot;  /&gt;&lt;/label&gt;&lt;/th&gt;&nbsp;</div></li><li><div>          &lt;td&gt;&lt;?php echo esc_html( $IP ); ?&gt;&lt;/a&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;?php } ?&gt;&nbsp;</div></li><li><div>      &lt;tfoot&gt;&nbsp;</div></li><li><div>          &lt;tr&gt;&nbsp;</div></li><li><div>              &lt;th id=&quot;cb&quot; class=&quot;manage-column column-cb check-column&quot; scope=&quot;col&quot;&gt;&nbsp;</div></li><li><div>                  &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;bp_checkall_top_blocked&quot; name=&quot;checkall&quot; /&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;/th&gt;&nbsp;</div></li><li><div>              &lt;th&gt;&lt;?php esc_html_e( 'IP Address', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;/tfoot&gt;&nbsp;</div></li><li><div>      &lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;h3&gt;&lt;?php esc_html_e( 'The following Email addresses are currently banned.', 'bp-registration-options' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;table class=&quot;widefat&quot;&gt;&nbsp;</div></li><li><div>      &lt;thead&gt;&nbsp;</div></li><li><div>          &lt;tr&gt;&nbsp;</div></li><li><div>              &lt;th id=&quot;cb&quot; class=&quot;manage-column column-cb check-column&quot; scope=&quot;col&quot;&gt;&nbsp;</div></li><li><div>                  &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;bp_checkall_top_blocked&quot; name=&quot;checkall&quot; /&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;/th&gt;&nbsp;</div></li><li><div>              &lt;th&gt;&lt;?php esc_html_e( 'Email Address', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;/thead&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $odd = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $blockedemails as $email ) {&nbsp;</div></li><li><div>          if ( $odd ) { ?&gt;&nbsp;</div></li><li><div>              &lt;tr class=&quot;alternate&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>              $odd = false;&nbsp;</div></li><li><div>          } else { ?&gt;&nbsp;</div></li><li><div>              &lt;tr&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>              $odd = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;th class=&quot;check-column&quot; scope=&quot;row&quot;&gt;&lt;label&gt;&lt;input type=&quot;checkbox&quot; class=&quot;bpro_checkbox&quot; id=&quot;bp_member_check_&lt;?php echo $user_id; ?&gt;&quot; name=&quot;bp_blockedemail_check[]&quot; value=&quot;&quot;  /&gt;&lt;/label&gt;&lt;/th&gt;&nbsp;</div></li><li><div>          &lt;td&gt;&lt;?php echo $email; ?&gt;&lt;/a&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;?php } ?&gt;&nbsp;</div></li><li><div>      &lt;tfoot&gt;&nbsp;</div></li><li><div>          &lt;tr&gt;&nbsp;</div></li><li><div>              &lt;th id=&quot;cb&quot; class=&quot;manage-column column-cb check-column&quot; scope=&quot;col&quot;&gt;&nbsp;</div></li><li><div>                  &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;bp_checkall_top_blocked&quot; name=&quot;checkall&quot; /&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;/th&gt;&nbsp;</div></li><li><div>              &lt;th&gt;&lt;?php esc_html_e( 'Email Address', 'bp-registration-options' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;/tfoot&gt;&nbsp;</div></li><li><div>      &lt;/table&gt;&nbsp;</div></li><li><div>      &lt;?php } else {&nbsp;</div></li><li><div>          echo '&lt;p&gt;&lt;strong&gt;' . esc_html__( 'You have no blocked IP Addresses or Email Addresses at the moment', 'bp-registration-options' ) . '&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      bp_registration_options_admin_footer();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render our help/support page</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_help_support() {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// NEEDS DONE.</span></span>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php bp_registration_options_tab_menu( 'help' );?&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php bp_registration_options_admin_footer();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render our content at the bottom of each page. Displays contact and credit information.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since unknown</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0 Revised to be a footer text filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $original Original footer text.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $value New footer text.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_admin_footer( $original = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $screen = get_current_screen();&nbsp;</div></li><li><div>  if ( ! is_object( $screen ) || 'bp_registration_options' != $screen-&gt;parent_base ) {&nbsp;</div></li><li><div>      return $original;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return sprintf(&nbsp;</div></li><li><div>      __( '%s version %s by %s', 'bp-registration-options' ), &nbsp;</div></li><li><div>      sprintf(&nbsp;</div></li><li><div>          '&lt;a target=&quot;_blank&quot; href=&quot;https:<span class="comment">//wordpress.org/support/plugin/bp-registration-options&quot;&gt;%s&lt;/a&gt;', </span>&nbsp;</div></li><li><div>          __( 'BP Registration Options', 'bp-registration-options' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      BP_REGISTRATION_OPTIONS_VERSION, &nbsp;</div></li><li><div>      '&lt;a href=&quot;http:<span class="comment">//webdevstudios.com&quot; target=&quot;_blank&quot;&gt;WebDevStudios&lt;/a&gt;'</span>&nbsp;</div></li><li><div> ).&nbsp;</div></li><li><div>  ' - '.&nbsp;</div></li><li><div>  sprintf(&nbsp;</div></li><li><div>      '&lt;a href=&quot;https:<span class="comment">//github.com/WebDevStudios/BuddyPress-Registration-Options/issues&quot; target=&quot;_blank&quot;&gt;%s&lt;/a&gt;', </span>&nbsp;</div></li><li><div>      __( 'Please Report Bugs', 'bp-registration-options' )&nbsp;</div></li><li><div> ).&nbsp;</div></li><li><div>  ' '.&nbsp;</div></li><li><div>  __( 'Follow on Twitter:', 'bp-registration-options' ).&nbsp;</div></li><li><div>  sprintf(&nbsp;</div></li><li><div>      ' %s &middot; %s &middot; %s', &nbsp;</div></li><li><div>      '&lt;a href=&quot;http:<span class="comment">//twitter.com/tw2113&quot; target=&quot;_blank&quot;&gt;Michael&lt;/a&gt;', </span>&nbsp;</div></li><li><div>      '&lt;a href=&quot;http:<span class="comment">//twitter.com/bmess&quot; target=&quot;_blank&quot;&gt;Brian&lt;/a&gt;', </span>&nbsp;</div></li><li><div>      '&lt;a href=&quot;http:<span class="comment">//twitter.com/webdevstudios&quot; target=&quot;_blank&quot;&gt;WebDevStudios&lt;/a&gt;'</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'admin_footer_text', 'bp_registration_options_admin_footer' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add User-provided CSS to our admin_head output for styling purposes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_css() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters and allows users to add their own CSS to the output of the page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $styles = apply_filters( 'bpro_hook_admin_styles', '' );&nbsp;</div></li><li><div>  if ( ! empty( $styles ) ) {&nbsp;</div></li><li><div>      echo '&lt;style&gt;' . $styles . '&lt;/style&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_head', 'bp_registration_options_css' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add our core plugin CSS</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_stylesheet() {&nbsp;</div></li><li><div>  wp_enqueue_style( 'bp-registration-options-stylesheet', plugins_url( 'assets/bp-registration-options.css', dirname( __FILE__ ) ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_enqueue_scripts', 'bp_registration_options_stylesheet' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add JS to our admin_footer output for DOM manipulation purposes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since unknown</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_js() {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;script language=&quot;javascript&quot;&gt;&nbsp;</div></li><li><div>      (function($) {&nbsp;</div></li><li><div>          <span class="comment">//Handle our checkboxes</span>&nbsp;</div></li><li><div>          var checkboxes = $('.bpro_checkbox');&nbsp;</div></li><li><div>          $('#bp_checkall_top, #bp_checkall_bottom').on('click', function() {&nbsp;</div></li><li><div>              if ( $(this).attr('checked')) {&nbsp;</div></li><li><div>                  $(checkboxes).each(function() {&nbsp;</div></li><li><div>                      if ( $(this).prop('checked', false) ) {&nbsp;</div></li><li><div>                          $(this).prop('checked', true);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  });&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $(checkboxes).each(function() {&nbsp;</div></li><li><div>                      $(this).prop('checked', false);&nbsp;</div></li><li><div>                  });&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>          <span class="comment">//Confirm/cancel on deny/ban.</span>&nbsp;</div></li><li><div>          $('#bpro_deny').on('click', function() {&nbsp;</div></li><li><div>              return confirm(&quot;&lt;?php esc_html_e( 'Are you sure you want to deny and delete the checked member(s)?', 'bp-registration-options' ); ?&gt;&quot;);&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>          $('#bpro_ban').on('click', function() {&nbsp;</div></li><li><div>              return confirm(&quot;&lt;?php esc_html_e( 'Are you sure you want to ban and delete the checked member(s)?', 'bp-registration-options' ); ?&gt;&quot;);&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>          $('#reset_messages').on('click', function() {&nbsp;</div></li><li><div>              return confirm(&quot;&lt;?php esc_html_e( 'Are you sure you want to reset to the default messages?', 'bp-registration-options' ); ?&gt;&quot;);&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      })(jQuery);&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_footer', 'bp_registration_options_js' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Callback function for HTML email purposes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content_type Content type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $value new content type to use</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_set_content_type( $content_type ) {&nbsp;</div></li><li><div>  return 'text/html';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete user count transient as needed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0 Delete bpro_total_user_count transient as well.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_delete_user_count_transient() {&nbsp;</div></li><li><div>  delete_transient( 'bpro_user_count' );&nbsp;</div></li><li><div>  delete_transient( 'bpro_total_user_count' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'deleted_user', 'bp_registration_options_delete_user_count_transient' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filters the IP data into the user list table.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 4.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user being listed.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_registration_options_ip_data( $user_id ) {&nbsp;</div></li><li><div>  $userip = trim( get_user_meta( $user_id, '_bprwg_ip_address', true ) );&nbsp;</div></li><li><div>  $response = wp_remote_get( 'https:<span class="comment">//freegeoip.net/json/' . $userip );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_wp_error( $response ) && 200 === wp_remote_retrieve_response_code( $response ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;ip_address_wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;alignleft&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>              $data = json_decode( wp_remote_retrieve_body( $response ) );&nbsp;</div></li><li><div>              printf(&nbsp;</div></li><li><div>                  esc_html__( 'City: %s', 'bp-registration-options' ), &nbsp;</div></li><li><div>                  esc_html( $data-&gt;city )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              printf(&nbsp;</div></li><li><div>                  esc_html__( 'IP: %s', 'bp-registration-options' ), &nbsp;</div></li><li><div>                  esc_html( $data-&gt;ip )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      echo wpautop( $userip );&nbsp;</div></li><li><div>  } ?&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bpro_hook_member_item_additional_data', 'bp_registration_options_ip_data', 10, 1 );&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BP Registration Options</li><li><span></span>4.3.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2019 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>