<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="3.1.1" data-slug="ninja-forms" data-type="class" data-id="38752"><head xmlns="http://www.w3.org/1999/xhtml"><title> nf_subs_cpt | class | Ninja Forms | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="NF_Subs_CPT, class, plugin, ninja-forms, 3.1.1" /><meta name="description" content="Submission CPT." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=9ee3eba6196e1e6c953b0233ed51f9bd' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/nf_subs_cpt/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fnf_subs_cpt%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fnf_subs_cpt%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-ninja-forms-3.1.1-class-nf_subs_cpt","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="nf_subs_cpt" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to ninja-forms." href="http://hookr.io/plugins/ninja-forms/" class="plugin"><span property="name">ninja-forms</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.1.1." href="http://hookr.io/plugins/ninja-forms/3.1.1/" class="H_VERSION"><span property="name">3.1.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/ninja-forms/3.1.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">nf_subs_cpt</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="1326"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/all/" title="All">All <span class="count badge">1326</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="573"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/hooks/" title="Hooks">Hooks <span class="count badge">573</span></a></li><li class="" data-id="action" data-count="122"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/actions/" title="Actions">Actions <span class="count badge">122</span></a></li><li class="" data-id="filter" data-count="451"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/filters/" title="Filters">Filters <span class="count badge">451</span></a></li><li class="active" data-id="class" data-count="193"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/classes/" title="Classes">Classes <span class="count badge">193</span></a></li><li class="" data-id="constant" data-count="31"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/constants/" title="Constants">Constants <span class="count badge">31</span></a></li><li class="" data-id="function" data-count="515"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/functions/" title="Functions">Functions <span class="count badge">515</span></a></li><li class="" data-id="shortcode" data-count="14"><a href="http://hookr.io/plugins/ninja-forms/3.1.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">14</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>NF_Subs_CPT</strong></h1><p>Submission CPT.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/ninja-forms/3.1.1/files/deprecated-classes-subs-cpt/" class="file">/deprecated/classes/subs-cpt.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="13" class="block" start="13"><li><div>class NF_Subs_CPT {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $form_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $screen_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $filename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get things started&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Register our submission custom post type.&nbsp;</div></li><li><div>        add_action( 'init', array( $this, 'register_cpt' ), 5 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Populate our field settings var&nbsp;</div></li><li><div>        add_action( 'current_screen', array( $this, 'setup_fields' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter our hidden columns by form ID.&nbsp;</div></li><li><div>        add_action( 'wp', array( $this, 'filter_hidden_columns' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add our submenu for the submissions page.&nbsp;</div></li><li><div>        add_action( 'admin_menu', array( $this, 'add_submenu' ), 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Change our submission columns.&nbsp;</div></li><li><div>        add_filter( 'manage_nf_sub_posts_columns', array( $this, 'change_columns' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make our columns sortable.&nbsp;</div></li><li><div>        add_filter( 'manage_edit-nf_sub_sortable_columns', array( $this, 'sortable_columns' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Actually do the sorting&nbsp;</div></li><li><div>        add_filter( 'request', array( $this, 'sort_columns' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the appropriate data for our custom columns.&nbsp;</div></li><li><div>        add_action( 'manage_posts_custom_column', array( $this, 'custom_columns' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add our submission filters.&nbsp;</div></li><li><div>        add_action( 'restrict_manage_posts', array( $this, 'add_filters' ) );&nbsp;</div></li><li><div>        add_filter( 'parse_query', array( $this, 'table_filter' ) );&nbsp;</div></li><li><div>        add_filter( 'posts_clauses', array( $this, 'search' ), 20 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'admin_footer', array( $this, 'jquery_remove_counts' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter our post counts&nbsp;</div></li><li><div>        add_filter( 'wp_count_posts', array( $this, 'count_posts' ), 10, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter our bulk actions&nbsp;</div></li><li><div>        add_filter( 'bulk_actions-edit-nf_sub', array( $this, 'remove_bulk_edit' ) );&nbsp;</div></li><li><div>        add_action( 'admin_footer-edit.php', array( $this, 'bulk_admin_footer' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter our bulk updated/trashed messages&nbsp;</div></li><li><div>        add_filter( 'bulk_post_updated_messages', array( $this, 'updated_messages_filter' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter singular updated/trashed messages&nbsp;</div></li><li><div>        add_filter( 'post_updated_messages', array( $this, 'post_updated_messages' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add our metabox for editing field values&nbsp;</div></li><li><div>        add_action( 'add_meta_boxes', array( $this, 'add_metaboxes' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save our metabox values&nbsp;</div></li><li><div>        add_action( 'save_post', array( $this, 'save_sub' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save our hidden columns by form id.&nbsp;</div></li><li><div>        add_action( 'wp_ajax_nf_hide_columns', array( $this, 'hide_columns' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load any custom screen options&nbsp;</div></li><li><div>        add_filter( 'screen_settings', array( $this, 'output_screen_options' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Listen for our exports button.&nbsp;</div></li><li><div>        add_action( 'load-edit.php', array( $this, 'export_listen' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Filter our submission capabilities&nbsp;</div></li><li><div>        add_filter( 'user_has_cap', array( $this, 'cap_filter' ), 10, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register our submission CPT&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function register_cpt() {&nbsp;</div></li><li><div>        if ( ! isset ( $_REQUEST['form_id'] ) || empty( $_REQUEST['form_id'] ) ) {&nbsp;</div></li><li><div>            $not_found = __( 'Please select a form to view submissions', 'ninja-forms' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $not_found = __( 'No Submissions Found', 'ninja-forms' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = _x( 'Submissions', 'post type general name', 'ninja-forms' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty ( $_REQUEST['form_id'] ) ) {&nbsp;</div></li><li><div>            $form_title = Ninja_Forms()-&gt;form( absint( $_REQUEST['form_id'] ) )-&gt;get_setting( 'form_title' );&nbsp;</div></li><li><div>            $name =$name . ' - ' . $form_title;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $labels = array(&nbsp;</div></li><li><div>            'name' =&gt; $name, &nbsp;</div></li><li><div>            'singular_name' =&gt; _x( 'Submission', 'post type singular name', 'ninja-forms' ), &nbsp;</div></li><li><div>            'add_new' =&gt; _x( 'Add New', 'nf_sub' ), &nbsp;</div></li><li><div>            'add_new_item' =&gt; __( 'Add New Submission', 'ninja-forms' ), &nbsp;</div></li><li><div>            'edit_item' =&gt; __( 'Edit Submission', 'ninja-forms' ), &nbsp;</div></li><li><div>            'new_item' =&gt; __( 'New Submission', 'ninja-forms' ), &nbsp;</div></li><li><div>            'view_item' =&gt; __( 'View Submission', 'ninja-forms' ), &nbsp;</div></li><li><div>            'search_items' =&gt; __( 'Search Submissions', 'ninja-forms' ), &nbsp;</div></li><li><div>            'not_found' =&gt;  $not_found, &nbsp;</div></li><li><div>            'not_found_in_trash' =&gt; __( 'No Submissions Found In The Trash', 'ninja-forms' ), &nbsp;</div></li><li><div>            'parent_item_colon' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = array(&nbsp;</div></li><li><div>            'labels' =&gt; $labels, &nbsp;</div></li><li><div>            'public' =&gt; false, &nbsp;</div></li><li><div>            'publicly_queryable' =&gt; false, &nbsp;</div></li><li><div>            'show_ui' =&gt; true, &nbsp;</div></li><li><div>            '_builtin' =&gt; false, // It's a custom post type, not built in!&nbsp;</div></li><li><div>            'query_var' =&gt; true, &nbsp;</div></li><li><div>            'has_archive' =&gt; false, &nbsp;</div></li><li><div>            'show_in_menu' =&gt; false, &nbsp;</div></li><li><div>            'hierarchical' =&gt; false, &nbsp;</div></li><li><div>            'menu_events' =&gt; null, &nbsp;</div></li><li><div>            'rewrite' =&gt; array( 'slug' =&gt; 'nf_sub' ), // Permalinks format&nbsp;</div></li><li><div>            'supports' =&gt; array( 'custom-fields' ), &nbsp;</div></li><li><div>            'capability_type' =&gt; 'nf_sub', &nbsp;</div></li><li><div>            'capabilities' =&gt; array(&nbsp;</div></li><li><div>                'publish_posts' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'edit_posts' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'edit_others_posts' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'delete_posts' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'delete_others_posts' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'read_private_posts' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'edit_post' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'delete_post' =&gt; 'nf_sub', &nbsp;</div></li><li><div>                'read_post' =&gt; 'nf_sub', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        register_post_type( 'nf_sub', $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Populate our fields var with all the fields. This keeps us from needing to ping the database later.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function setup_fields() {&nbsp;</div></li><li><div>        global $pagenow, $typenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Bail if we aren't on the edit.php page, we aren't editing our custom post type, or we don't have a form_id set.&nbsp;</div></li><li><div>        if ( ( $pagenow != 'edit.php' && $pagenow != 'post.php' ) || $typenow != 'nf_sub' )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset ( $_REQUEST['form_id'] ) ) {&nbsp;</div></li><li><div>            $form_id = absint( $_REQUEST['form_id'] );&nbsp;</div></li><li><div>        } else if ( isset ( $_REQUEST['post'] ) ) {&nbsp;</div></li><li><div>            $form_id = Ninja_Forms()-&gt;sub( absint( $_REQUEST['post'] ) )-&gt;form_id;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $form_id = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;form_id = $form_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Ninja_Forms()-&gt;form( $form_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add our submissions submenu&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_submenu() {&nbsp;</div></li><li><div>        // Add our submissions submenu&nbsp;</div></li><li><div>        $sub_page = add_submenu_page( 'ninja-forms', __( 'Submissions', 'ninja-forms' ), __( 'Submissions', 'ninja-forms' ), apply_filters( 'ninja_forms_admin_submissions_capabilities', 'manage_options' ), 'edit.php?post_type=nf_sub' );&nbsp;</div></li><li><div>        // Enqueue our JS on the edit page.&nbsp;</div></li><li><div>        //add_action( 'load-' . $sub_page, array( $this, 'load_js' ) );&nbsp;</div></li><li><div>        add_action( 'admin_print_styles', array( $this, 'load_js' ) );&nbsp;</div></li><li><div>        add_action( 'admin_print_styles', array( $this, 'load_css' ) );&nbsp;</div></li><li><div>        // Remove the publish box from the submission editing page.&nbsp;</div></li><li><div>        remove_meta_box( 'submitdiv', 'nf_sub', 'side' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enqueue our submissions JS file.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_js() {&nbsp;</div></li><li><div>        global $pagenow, $typenow;&nbsp;</div></li><li><div>        // Bail if we aren't on the edit.php page or we aren't editing our custom post type.&nbsp;</div></li><li><div>        if ( ( $pagenow != 'edit.php' && $pagenow != 'post.php' ) || $typenow != 'nf_sub' )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form_id = isset ( $_REQUEST['form_id'] ) ? absint( $_REQUEST['form_id'] ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( defined( 'NINJA_FORMS_JS_DEBUG' ) && NINJA_FORMS_JS_DEBUG ) {&nbsp;</div></li><li><div>            $suffix = '';&nbsp;</div></li><li><div>            $src = 'dev';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $suffix = '.min';&nbsp;</div></li><li><div>            $src = 'min';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $suffix = '';&nbsp;</div></li><li><div>        $src = 'dev';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $plugin_settings = nf_get_settings();&nbsp;</div></li><li><div>        $date_format = ninja_forms_date_to_datepicker( $plugin_settings['date_format'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $datepicker_args = array();&nbsp;</div></li><li><div>        if ( !empty( $date_format ) ) {&nbsp;</div></li><li><div>            $datepicker_args['dateFormat'] = $date_format;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_enqueue_script( 'subs-cpt', &nbsp;</div></li><li><div>            NF_PLUGIN_URL . 'assets/js/' . $src .'/subs-cpt' . $suffix . '.js', &nbsp;</div></li><li><div>            array('jquery', 'jquery-ui-datepicker') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_localize_script( 'subs-cpt', 'nf_sub', array( 'form_id' =&gt; $form_id, 'datepicker_args' =&gt; apply_filters( 'ninja_forms_admin_submissions_datepicker_args', $datepicker_args ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enqueue our submissions CSS file.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_css() {&nbsp;</div></li><li><div>        global $pagenow, $typenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Bail if we aren't on the edit.php page or the post.php page.&nbsp;</div></li><li><div>        if ( ( $pagenow != 'edit.php' && $pagenow != 'post.php' ) || $typenow != 'nf_sub' )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_enqueue_style( 'nf-sub', NF_PLUGIN_URL .'assets/css/cpt.css' );&nbsp;</div></li><li><div>        wp_enqueue_style( 'nf-jquery-ui-freshness', NF_PLUGIN_URL .'assets/css/jquery-ui-fresh.min.css' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Modify the columns of our submissions table.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return array $cols&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function change_columns( $cols ) {&nbsp;</div></li><li><div>        // Compatibility with old field registration system. Can be removed when the new one is in place.&nbsp;</div></li><li><div>        global $ninja_forms_fields;&nbsp;</div></li><li><div>        // End Compatibility&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cols = array(&nbsp;</div></li><li><div>            'cb' =&gt; '&lt;input type=&quot;checkbox&quot; /&gt;', &nbsp;</div></li><li><div>            'id' =&gt; __( '#', 'ninja-forms' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Compatibility with old field registration system. Can be removed when the new one is in place.&nbsp;</div></li><li><div>        if ( isset ( $_GET['form_id'] ) && $_GET['form_id'] != '' ) {&nbsp;</div></li><li><div>            $form_id = absint( $_GET['form_id'] );&nbsp;</div></li><li><div>            if ( is_object( Ninja_Forms()-&gt;form( $this-&gt;form_id ) ) && is_array ( Ninja_Forms()-&gt;form( $this-&gt;form_id )-&gt;fields ) ) {&nbsp;</div></li><li><div>                foreach ( Ninja_Forms()-&gt;form( $this-&gt;form_id )-&gt;fields as $field ) {&nbsp;</div></li><li><div>                    $field_id = $field['id'];&nbsp;</div></li><li><div>                    $field_type = $field['type'];&nbsp;</div></li><li><div>                    if ( isset ( $ninja_forms_fields[ $field_type ] ) ) {&nbsp;</div></li><li><div>                        $reg_field = $ninja_forms_fields[ $field_type ];&nbsp;</div></li><li><div>                        $process_field = $reg_field['process_field'];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $process_field = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( isset ( $field['data']['admin_label'] ) && ! empty ( $field['data']['admin_label'] ) ) {&nbsp;</div></li><li><div>                        $label = $field['data']['admin_label'];&nbsp;</div></li><li><div>                    } else if ( isset ( $field['data']['label'] ) ) {&nbsp;</div></li><li><div>                        $label = $field['data']['label'];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $label = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( strlen( $label ) &gt; 140 )&nbsp;</div></li><li><div>                        $label = substr( $label, 0, 140 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset ( $field['data']['label'] ) && $process_field )&nbsp;</div></li><li><div>                        $cols[ 'form_' . $form_id . '_field_' . $field_id ] = $label;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $form_id = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // End Compatibility&nbsp;</div></li><li><div>        // Add our date column&nbsp;</div></li><li><div>        $cols['sub_date'] = __( 'Date', 'ninja-forms' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return apply_filters( 'nf_sub_table_columns', $cols, $form_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Make our columns sortable&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function sortable_columns() {&nbsp;</div></li><li><div>        // Get a list of all of our fields.&nbsp;</div></li><li><div>        $columns = get_column_headers( 'edit-nf_sub' );&nbsp;</div></li><li><div>        $tmp_array = array();&nbsp;</div></li><li><div>        foreach ( $columns as $slug =&gt; $c ) {&nbsp;</div></li><li><div>            if ( $slug != 'cb' ) {&nbsp;</div></li><li><div>                $tmp_array[ $slug ] = $slug;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $tmp_array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Actually sort our columns&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return array $vars&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function sort_columns( $vars ) {&nbsp;</div></li><li><div>        global $pagenow, $typenow;&nbsp;</div></li><li><div>        if( array_key_exists( 'orderby', $vars ) ) {&nbsp;</div></li><li><div>            if( strpos( $vars['orderby'], 'form_' ) !== false ) {&nbsp;</div></li><li><div>                $args = explode( '_', $vars['orderby'] );&nbsp;</div></li><li><div>                $field_id = $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset ( Ninja_Forms()-&gt;form( $this-&gt;form_id )-&gt;fields[ $field_id ]['data']['num_sort'] ) && Ninja_Forms()-&gt;form( $this-&gt;form_id )-&gt;fields[ $field_id ]['data']['num_sort'] == 1 ) {&nbsp;</div></li><li><div>                    $orderby = 'meta_value_num';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $orderby = 'meta_value';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $vars['orderby'] = $orderby;&nbsp;</div></li><li><div>                $vars['meta_key'] = '_field_' . $field_id;&nbsp;</div></li><li><div>            } else if ( $vars['orderby'] == 'id' ) {&nbsp;</div></li><li><div>                $vars['orderby'] = 'meta_value_num';&nbsp;</div></li><li><div>                $vars['meta_key'] = '_seq_num';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else if( is_admin() && $typenow == 'nf_sub' && $pagenow == 'edit.php' ) {&nbsp;</div></li><li><div>            $vars['orderby'] = 'meta_value_num';&nbsp;</div></li><li><div>            $vars['meta_key'] = '_seq_num';&nbsp;</div></li><li><div>            $vars['order'] = 'DESC';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $vars;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add our custom column data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function custom_columns( $column, $sub_id ) {&nbsp;</div></li><li><div>        if ( isset ( $_GET['form_id'] ) ) {&nbsp;</div></li><li><div>            $form_id = $_GET['form_id'];&nbsp;</div></li><li><div>            if ( $column == 'id' ) {&nbsp;</div></li><li><div>                echo apply_filters( 'nf_sub_table_seq_num', Ninja_Forms()-&gt;sub( $sub_id )-&gt;get_seq_num(), $sub_id, $column );&nbsp;</div></li><li><div>                echo '&lt;div class=&quot;locked-info&quot;&gt;&lt;span class=&quot;locked-avatar&quot;&gt;&lt;/span&gt; &lt;span class=&quot;locked-text&quot;&gt;&lt;/span&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                if ( !isset ( $_GET['post_status'] ) || $_GET['post_status'] == 'all' ) {&nbsp;</div></li><li><div>                    echo '&lt;div class=&quot;row-actions custom-row-actions&quot;&gt;';&nbsp;</div></li><li><div>                    do_action( 'nf_sub_table_before_row_actions', $sub_id, $column );&nbsp;</div></li><li><div>                    echo '&lt;span class=&quot;edit&quot;&gt;&lt;a href=&quot;post.php?post=' . $sub_id . '&action=edit&ref=' . urlencode( esc_url(  add_query_arg( array() ) ) ) . '&quot; title=&quot;' . __( 'Edit this item', 'ninja-forms' ) . '&quot;&gt;' . __( 'Edit', 'ninja-forms' ) . '&lt;/a&gt; | &lt;/span&gt; &nbsp;</div></li><li><div>                        &lt;span class=&quot;edit&quot;&gt;&lt;a href=&quot;' . esc_url( add_query_arg( array( 'export_single' =&gt; $sub_id ) ) ) . '&quot; title=&quot;' . __( 'Export this item', 'ninja-forms' ) . '&quot;&gt;' . __( 'Export', 'ninja-forms' ) . '&lt;/a&gt; | &lt;/span&gt;';&nbsp;</div></li><li><div>                    $row_actions = apply_filters( 'nf_sub_table_row_actions', array(), $sub_id, $form_id );&nbsp;</div></li><li><div>                    if ( ! empty( $row_actions ) ) {&nbsp;</div></li><li><div>                        echo implode(&quot; | &quot;, $row_actions);&nbsp;</div></li><li><div>                        echo '| ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    echo '&lt;span class=&quot;trash&quot;&gt;&lt;a class=&quot;submitdelete&quot; title=&quot;' . __( 'Move this item to the Trash', 'ninja-forms' ) . '&quot; href=&quot;' . get_delete_post_link( $sub_id ) . '&quot;&gt;' . __( 'Trash', 'ninja-forms' ) . '&lt;/a&gt; &lt;/span&gt;';&nbsp;</div></li><li><div>                    do_action( 'nf_sub_table_after_row_actions', $sub_id, $column );&nbsp;</div></li><li><div>                    echo '&lt;/div&gt;';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    echo '&lt;div class=&quot;row-actions custom-row-actions&quot;&gt;';&nbsp;</div></li><li><div>                    do_action( 'nf_sub_table_before_row_actions_trash', $sub_id, $column );&nbsp;</div></li><li><div>                    echo '&lt;span class=&quot;untrash&quot;&gt;&lt;a title=&quot;' . esc_attr( __( 'Restore this item from the Trash' ) ) . '&quot; href=&quot;' . wp_nonce_url( sprintf( get_edit_post_link( $sub_id ) . '&amp;action=untrash', $sub_id ) , 'untrash-post_' . $sub_id ) . '&quot;&gt;' . __( 'Restore' ) . '&lt;/a&gt; | &lt;/span&gt; &nbsp;</div></li><li><div>                    &lt;span class=&quot;delete&quot;&gt;&lt;a class=&quot;submitdelete&quot; title=&quot;' . esc_attr( __( 'Delete this item permanently' ) ) . '&quot; href=&quot;' . get_delete_post_link( $sub_id, '', true ) . '&quot;&gt;' . __( 'Delete Permanently' ) . '&lt;/a&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>                    do_action( 'nf_sub_table_after_row_actions_trash', $sub_id, $column );&nbsp;</div></li><li><div>                    echo '&lt;/div&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else if ( $column == 'sub_date' ) {&nbsp;</div></li><li><div>                $post = get_post( $sub_id );&nbsp;</div></li><li><div>                if ( '0000-00-00 00:00:00' == $post-&gt;post_date ) {&nbsp;</div></li><li><div>                    $t_time = $h_time = __( 'Unpublished' );&nbsp;</div></li><li><div>                    $time_diff = 0;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $t_time = get_the_time( 'Y/m/d g:i:s A' );&nbsp;</div></li><li><div>                    $m_time = $post-&gt;post_date;&nbsp;</div></li><li><div>                    $time = get_post_time( 'G', true, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $time_diff = time() - $time;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( $time_diff &gt; 0 && $time_diff &lt; DAY_IN_SECONDS )&nbsp;</div></li><li><div>                        $h_time = sprintf( __( '%s ago' ), human_time_diff( $time ) );&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $h_time = mysql2date( 'Y/m/d', $m_time );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $t_time = apply_filters( 'nf_sub_title_time', $t_time );&nbsp;</div></li><li><div>                $h_time = apply_filters( 'nf_sub_human_time', $h_time );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** This filter is documented in wp-admin/includes/class-wp-posts-list-table.php */&nbsp;</div></li><li><div>                echo '&lt;abbr title=&quot;' . $t_time . '&quot;&gt;' . $h_time . '&lt;/abbr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                echo '&lt;br /&gt;';&nbsp;</div></li><li><div>                echo apply_filters( 'nf_sub_table_status', __( 'Submitted', 'ninja-forms' ), $sub_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else if ( strpos( $column, '_field_' ) !== false ) {&nbsp;</div></li><li><div>                global $ninja_forms_fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field_id = str_replace( 'form_' . $form_id . '_field_', '', $column );&nbsp;</div></li><li><div>                //if ( apply_filters( 'nf_add_sub_value', Ninja_Forms()-&gt;field( $field_id )-&gt;type-&gt;add_to_sub, $field_id ) ) {&nbsp;</div></li><li><div>                $field = Ninja_Forms()-&gt;form( $form_id )-&gt;fields[ $field_id ];&nbsp;</div></li><li><div>                $field_type = $field['type'];&nbsp;</div></li><li><div>                if ( isset ( $ninja_forms_fields[ $field_type ] ) ) {&nbsp;</div></li><li><div>                    $reg_field = $ninja_forms_fields[ $field_type ];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $reg_field = array();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( isset ( $reg_field['sub_table_value'] ) ) {&nbsp;</div></li><li><div>                    $edit_value_function = $reg_field['sub_table_value'];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $edit_value_function = 'nf_field_text_sub_table_value';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $user_value = Ninja_Forms()-&gt;sub( $sub_id )-&gt;get_field( $field_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $args['field_id'] = $field_id;&nbsp;</div></li><li><div>                $args['user_value'] = ninja_forms_esc_html_deep( $user_value );&nbsp;</div></li><li><div>                $args['field'] = $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                call_user_func_array( $edit_value_function, $args );&nbsp;</div></li><li><div>                //}&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add our submission filters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_filters() {&nbsp;</div></li><li><div>        global $typenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Bail if we aren't in our submission custom post type.&nbsp;</div></li><li><div>        if ( $typenow != 'nf_sub' )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add our Form selection dropdown.&nbsp;</div></li><li><div>        // Get our list of forms&nbsp;</div></li><li><div>        $forms = Ninja_Forms()-&gt;forms()-&gt;get_all();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form_id = isset( $_GET['form_id'] ) ? $_GET['form_id'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $begin_date = isset ( $_GET['begin_date'] ) ? $_GET['begin_date'] : '';&nbsp;</div></li><li><div>        $end_date = isset ( $_GET['end_date'] ) ? $_GET['end_date'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add begin date and end date filter fields.&nbsp;</div></li><li><div>        $html = '&lt;div style=&quot;float:left;&quot;&gt;';&nbsp;</div></li><li><div>        $html .= '&lt;span style=&quot;float:left;&quot; class=&quot;spinner&quot;&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>        $html .= '&lt;select name=&quot;form_id&quot; id=&quot;form_id&quot; class=&quot;nf-form-jump&quot;&gt;';&nbsp;</div></li><li><div>        $html .= '&lt;option value=&quot;&quot;&gt;- ' . __( 'Select a form', 'ninja-forms' ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>        if ( is_array( $forms ) ) {&nbsp;</div></li><li><div>            foreach ( $forms as $f_id ) {&nbsp;</div></li><li><div>                $form_title = Ninja_Forms()-&gt;form( $f_id )-&gt;get_setting( 'form_title' );&nbsp;</div></li><li><div>                $html .= '&lt;option value=&quot;' . $f_id . '&quot; ' . selected( $form_id, $f_id, false ) . '&gt;' . $form_title . '&lt;/option&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $html .= '&lt;/select&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html .= '&lt;input name=&quot;begin_date&quot; type=&quot;text&quot; class=&quot;datepicker&quot; placeholder=&quot;' . __( 'Begin Date', 'ninja-forms' ) . '&quot; value=&quot;' . $begin_date . '&quot; /&gt; ';&nbsp;</div></li><li><div>        $html .= '&lt;input name=&quot;end_date&quot; type=&quot;text&quot; class=&quot;datepicker&quot; placeholder=&quot;' . __( 'End Date', 'ninja-forms' ) . '&quot; value=&quot;' . $end_date . '&quot; /&gt;';&nbsp;</div></li><li><div>        $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo $html;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter our submission list by form_id&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function table_filter( $query ) {&nbsp;</div></li><li><div>        global $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $pagenow == 'edit.php' && is_admin() && ( isset ( $query-&gt;query['post_type'] ) && $query-&gt;query['post_type'] == 'nf_sub' ) && is_main_query() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $qv = &$query-&gt;query_vars;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( !empty( $_GET['form_id'] ) ) {&nbsp;</div></li><li><div>                $form_id = $_GET['form_id'];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $form_id = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $plugin_settings = nf_get_settings();&nbsp;</div></li><li><div>            $date_format = $plugin_settings['date_format'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty ( $_GET['begin_date'] ) ) {&nbsp;</div></li><li><div>                $begin_date = nf_get_begin_date( $_GET['begin_date'] )-&gt;format(&quot;Y-m-d G:i:s&quot;);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $begin_date = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !empty ( $_GET['end_date'] ) ) {&nbsp;</div></li><li><div>                $end_date = nf_get_end_date( $_GET['end_date'] )-&gt;format(&quot;Y-m-d G:i:s&quot;);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $end_date = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $begin_date &gt; $end_date ) {&nbsp;</div></li><li><div>                $begin_date = new DateTime( $begin_date );&nbsp;</div></li><li><div>                $end_date = new DateTime( $end_date );&nbsp;</div></li><li><div>                $end_date_temp = $begin_date;&nbsp;</div></li><li><div>                $begin_date_temp = $end_date;&nbsp;</div></li><li><div>                $begin_date = $begin_date_temp;&nbsp;</div></li><li><div>                $end_date = $end_date_temp;&nbsp;</div></li><li><div>                $_GET['begin_date'] = $begin_date-&gt;format('m/d/Y');&nbsp;</div></li><li><div>                $_GET['end_date'] = $end_date-&gt;format('m/d/Y');&nbsp;</div></li><li><div>                $begin_date = $begin_date-&gt;format(&quot;Y-m-d G:i:s&quot;);&nbsp;</div></li><li><div>                $end_date = $end_date-&gt;format(&quot;Y-m-d G:i:s&quot;);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! isset ( $qv['date_query'] ) ) {&nbsp;</div></li><li><div>                $qv['date_query'] = array(&nbsp;</div></li><li><div>                    'after' =&gt; $begin_date, &nbsp;</div></li><li><div>                    'before' =&gt; $end_date, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! isset ( $qv['meta_query'] ) ) {&nbsp;</div></li><li><div>                $qv['meta_query'] = array(&nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                        'key' =&gt; '_form_id', &nbsp;</div></li><li><div>                        'value' =&gt; $form_id, &nbsp;</div></li><li><div>                        'compare' =&gt; '=', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $qv = apply_filters( 'nf_subs_table_qv', $qv, $form_id );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter our search&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function search( $pieces ) {&nbsp;</div></li><li><div>        global $typenow;&nbsp;</div></li><li><div>        // filter to select search query&nbsp;</div></li><li><div>        if ( is_search() && is_admin() && $typenow == 'nf_sub' && isset ( $_GET['s'] ) ) {&nbsp;</div></li><li><div>            global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $keywords = explode(' ', get_query_var('s'));&nbsp;</div></li><li><div>            $query = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ($keywords as $word) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $query .= &quot; (mypm1.meta_value  LIKE '%{$word}%') OR &quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!empty($query)) {&nbsp;</div></li><li><div>                // add to where clause&nbsp;</div></li><li><div>                $pieces['where'] = str_replace(&quot;((({$wpdb-&gt;posts}.post_title LIKE '%&quot;, &quot;( {$query} (({$wpdb-&gt;posts}.post_title LIKE '%&quot;, $pieces['where']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pieces['join'] = $pieces['join'] . &quot; INNER JOIN {$wpdb-&gt;postmeta} AS mypm1 ON ({$wpdb-&gt;posts}.ID = mypm1.post_id)&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return ($pieces);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter our bulk updated/trashed messages so that it uses &quot;submission&quot; rather than &quot;post&quot;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return array $bulk_messages&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function updated_messages_filter( $bulk_messages, $bulk_counts ) {&nbsp;</div></li><li><div>        $bulk_messages['nf_sub'] = array(&nbsp;</div></li><li><div>            'updated' =&gt; _n( '%s submission updated.', '%s submissions updated.', $bulk_counts['updated'], 'ninja-forms' ), &nbsp;</div></li><li><div>            'locked' =&gt; _n( '%s submission not updated, somebody is editing it.', '%s submissions not updated, somebody is editing them.', $bulk_counts['locked'], 'ninja-forms' ), &nbsp;</div></li><li><div>            'deleted' =&gt; _n( '%s submission permanently deleted.', '%s submissions permanently deleted.', $bulk_counts['deleted'], 'ninja-forms' ), &nbsp;</div></li><li><div>            'trashed' =&gt; _n( '%s submission moved to the Trash.', '%s submissions moved to the Trash.', $bulk_counts['trashed'], 'ninja-forms' ), &nbsp;</div></li><li><div>            'untrashed' =&gt; _n( '%s submission restored from the Trash.', '%s submissions restored from the Trash.', $bulk_counts['untrashed'], 'ninja-forms' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $bulk_messages;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter our updated/trashed post messages&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return array $messages&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function post_updated_messages( $messages ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $post, $post_ID;&nbsp;</div></li><li><div>        $post_type = 'nf_sub';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $obj = get_post_type_object( $post_type );&nbsp;</div></li><li><div>        $singular = $obj-&gt;labels-&gt;singular_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $messages[$post_type] = array(&nbsp;</div></li><li><div>            0 =&gt;     '', // Unused. Messages start at index 1.&nbsp;</div></li><li><div>            1 =&gt;     sprintf( __( '%s updated.', 'ninja-forms' ), $singular ), &nbsp;</div></li><li><div>            2 =&gt;     __( 'Custom field updated.' ), &nbsp;</div></li><li><div>            3 =&gt;     __( 'Custom field deleted.' ), &nbsp;</div></li><li><div>            4 =&gt;     sprintf( __( '%s updated.', 'ninja-forms' ), $singular ), &nbsp;</div></li><li><div>            /** translators: %s: date and time of the revision */&nbsp;</div></li><li><div>            5 =&gt;     isset($_GET['revision']) ? sprintf( __( '%1$s restored to revision from %2$s.' ), $singular, wp_post_revision_title( (int) $_GET['revision'], false ) ) : false, &nbsp;</div></li><li><div>            6 =&gt;     sprintf( __( '%s published.', 'ninja-forms' ), $singular ), &nbsp;</div></li><li><div>            7 =&gt;     sprintf( __( '%s saved.', 'ninja-forms' ), $singular ), &nbsp;</div></li><li><div>            8 =&gt;     sprintf( __( '%1$s submitted. &lt;a href=&quot;%2$s&quot; target=&quot;_blank&quot;&gt;Preview %3$s&lt;/a&gt;', 'ninja-forms' ), $singular, esc_url( add_query_arg( 'preview', 'true', get_permalink($post_ID) ) ), $singular ), &nbsp;</div></li><li><div>            9 =&gt;     sprintf( __( '%1$s scheduled for: &lt;strong&gt;%2$s&lt;/strong&gt;. &lt;a href=&quot;%3$s&quot; target=&quot;_blank&quot;&gt;Preview %4$s&lt;/a&gt;', 'ninja-forms' ), $singular, date_i18n( get_option( 'data_format' ) . ' ' . get_option( 'time_format' ), strtotime( $post-&gt;post_date ) ), esc_url( get_permalink($post_ID ) ), $singular ), &nbsp;</div></li><li><div>            10 =&gt;     sprintf( __( '%1$s draft updated. &lt;a href=&quot;%2$s&quot; target=&quot;_blank&quot;&gt;Preview %3$s&lt;/a&gt;', 'ninja-forms' ), $singular, esc_url( add_query_arg( 'preview', 'true', get_permalink($post_ID) ) ), $singular ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $messages;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove the 'edit' bulk action&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return array $actions&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function remove_bulk_edit( $actions ) {&nbsp;</div></li><li><div>        unset( $actions['edit'] );&nbsp;</div></li><li><div>        return $actions;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add our &quot;export&quot; bulk action&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function bulk_admin_footer() {&nbsp;</div></li><li><div>        global $post_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_admin() )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $post_type == 'nf_sub' && isset ( $_REQUEST['post_status'] ) && $_REQUEST['post_status'] == 'all' ) {&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>                jQuery(document).ready(function() {&nbsp;</div></li><li><div>                    jQuery('&lt;option&gt;').val('export').text('&lt;?php _e('Export')?&gt;').appendTo(&quot;select[name='action']&quot;);&nbsp;</div></li><li><div>                    jQuery('&lt;option&gt;').val('export').text('&lt;?php _e('Export')?&gt;').appendTo(&quot;select[name='action2']&quot;);&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    if ( ( isset ( $_POST['action'] ) && $_POST['action'] == 'export' ) || ( isset ( $_POST['action2'] ) && $_POST['action2'] == 'export' ) ) {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    setInterval(function() {&nbsp;</div></li><li><div>                        jQuery( &quot;select[name='action'&quot; ).val( '-1' );&nbsp;</div></li><li><div>                        jQuery( &quot;select[name='action2'&quot; ).val( '-1' );&nbsp;</div></li><li><div>                        jQuery( '#posts-filter' ).submit();&nbsp;</div></li><li><div>                    }, 5000);&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset ( $_REQUEST['form_id'] ) && ! empty ( $_REQUEST['form_id'] ) ) {&nbsp;</div></li><li><div>                    $redirect = urlencode( remove_query_arg( array( 'download_all', 'download_file' ) ) );&nbsp;</div></li><li><div>                    $url = admin_url( 'admin.php?page=nf-processing&action=download_all_subs&form_id=' . absint( $_REQUEST['form_id'] ) . '&redirect=' . $redirect );&nbsp;</div></li><li><div>                    $url = esc_url( $url );&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    var button = '&lt;a href=&quot;&lt;?php echo $url; ?&gt;&quot; class=&quot;button-secondary nf-download-all&quot;&gt;&lt;?php echo __( 'Download All Submissions', 'ninja-forms' ); ?&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                    jQuery( '#doaction2' ).after( button );&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset ( $_REQUEST['download_all'] ) && $_REQUEST['download_all'] != '' ) {&nbsp;</div></li><li><div>                    $redirect = esc_url_raw( add_query_arg( array( 'download_file' =&gt; esc_html( $_REQUEST['download_all'] ) ) ) );&nbsp;</div></li><li><div>                    $redirect = remove_query_arg( array( 'download_all' ), $redirect );&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    document.location.href = &quot;&lt;?php echo $redirect; ?&gt;&quot;;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * jQuery that hides some of our post-related page items.&nbsp;</div></li><li><div>     * Also adds the active class to All and Trash links, and changes those&nbsp;</div></li><li><div>     * links to match the current filter.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function jquery_remove_counts() {&nbsp;</div></li><li><div>        global $typenow, $pagenow;&nbsp;</div></li><li><div>        if ( $typenow == 'nf_sub' && $pagenow == 'edit.php' ) {&nbsp;</div></li><li><div>            // Remove our transient&nbsp;</div></li><li><div>            delete_transient( 'nf_sub_edit_ref' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! isset ( $_GET['post_status'] ) || $_GET['post_status'] == 'all' ) {&nbsp;</div></li><li><div>                $active = 'all';&nbsp;</div></li><li><div>            } else if ( $_GET['post_status'] == 'trash' ) {&nbsp;</div></li><li><div>                $active = 'trash';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $all_url = esc_url_raw( add_query_arg( array( 'post_status' =&gt; 'all' ) ) );&nbsp;</div></li><li><div>            $all_url = remove_query_arg( 's', $all_url );&nbsp;</div></li><li><div>            $trash_url = esc_url_raw( add_query_arg( array( 'post_status' =&gt; 'trash' ) ) );&nbsp;</div></li><li><div>            $trash_url = remove_query_arg( 's', $trash_url );&nbsp;</div></li><li><div>            if ( isset ( $_GET['form_id'] ) ) {&nbsp;</div></li><li><div>                $trashed_sub_count = nf_get_sub_count( $_GET['form_id'], 'trash' );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $trashed_sub_count = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>                jQuery(function() {&nbsp;</div></li><li><div>                    jQuery( &quot;li.all&quot; ).find( &quot;a&quot; ).attr( &quot;href&quot;, &quot;&lt;?php echo $all_url; ?&gt;&quot; );&nbsp;</div></li><li><div>                    jQuery( &quot;li.&lt;?php echo $active; ?&gt;&quot; ).addClass( &quot;current&quot; );&nbsp;</div></li><li><div>                    jQuery( &quot;li.&lt;?php echo $active; ?&gt;&quot; ).find( &quot;a&quot; ).addClass( &quot;current&quot; );&nbsp;</div></li><li><div>                    jQuery( &quot;li.trash&quot; ).find( &quot;a&quot; ).attr( &quot;href&quot;, &quot;&lt;?php echo $trash_url; ?&gt;&quot; );&nbsp;</div></li><li><div>                    jQuery( &quot;.view-switch&quot; ).remove();&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    if ( $trashed_sub_count == 0 ) {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    var text = jQuery( &quot;li.all&quot; ).prop( &quot;innerHTML&quot; );&nbsp;</div></li><li><div>                    text = text.replace( &quot; |&quot;, &quot;&quot; );&nbsp;</div></li><li><div>                    jQuery( &quot;li.all&quot; ).prop( &quot;innerHTML&quot;, text );&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;style&gt;&nbsp;</div></li><li><div>                .add-new-h2 {&nbsp;</div></li><li><div>                    display:none;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                li.publish {&nbsp;</div></li><li><div>                    display:none;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                select[name=m] {&nbsp;</div></li><li><div>                    display:none;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            &lt;/style&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        } else if ( $typenow == 'nf_sub' && $pagenow == 'post.php' ) {&nbsp;</div></li><li><div>            if ( isset ( $_REQUEST['ref'] ) ) {&nbsp;</div></li><li><div>                $back_url = esc_url_raw( $_REQUEST['ref'] );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $back_url = get_transient( 'nf_sub_edit_ref' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $back_url ) {&nbsp;</div></li><li><div>                $back_url = urldecode( $back_url );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $back_url = '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>                jQuery(function() {&nbsp;</div></li><li><div>                    var html = '&lt;a href=&quot;&lt;?php echo $back_url; ?&gt;&quot; class=&quot;back button-secondary&quot;&gt;&lt;?php _e( 'Back to list', 'ninja-forms' ); ?&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                    jQuery( 'div.wrap' ).children( 'h2:first' ).append( html );&nbsp;</div></li><li><div>                    jQuery( 'li#toplevel_page_ninja-forms' ).children( 'a' ).removeClass( 'wp-not-current-submenu' );&nbsp;</div></li><li><div>                    jQuery( 'li#toplevel_page_ninja-forms' ).removeClass( 'wp-not-current-submenu' );&nbsp;</div></li><li><div>                    jQuery( 'li#toplevel_page_ninja-forms' ).addClass( 'wp-menu-open wp-has-current-submenu' );&nbsp;</div></li><li><div>                    jQuery( 'li#toplevel_page_ninja-forms' ).children( 'a' ).addClass( 'wp-menu-open wp-has-current-submenu' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>            &lt;style&gt;&nbsp;</div></li><li><div>                .add-new-h2 {&nbsp;</div></li><li><div>                    display:none;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            &lt;/style&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter our post counts for the submission listing page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return int $count&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function count_posts( $count, $post_type, $perm ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Bail if we aren't working with our custom post type.&nbsp;</div></li><li><div>        if ( $post_type != 'nf_sub' )&nbsp;</div></li><li><div>            return $count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset ( $_GET['form_id'] ) ) {&nbsp;</div></li><li><div>            $sub_count = nf_get_sub_count( $_GET['form_id'] );&nbsp;</div></li><li><div>            $trashed_sub_count = nf_get_sub_count( $_GET['form_id'], 'trash' );&nbsp;</div></li><li><div>            $count-&gt;publish = $sub_count;&nbsp;</div></li><li><div>            $count-&gt;trash = $trashed_sub_count;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $count-&gt;publish = 0;&nbsp;</div></li><li><div>            $count-&gt;trash = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $count;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add our field editing metabox to the CPT editing page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_metaboxes() {&nbsp;</div></li><li><div>        // Remove the 'custom fields' metabox from our CPT edit page&nbsp;</div></li><li><div>        remove_meta_box( 'postcustom', 'nf_sub', 'normal' );&nbsp;</div></li><li><div>        // Remove the 'slug' metabox from our CPT edit page.&nbsp;</div></li><li><div>        remove_meta_box( 'slugdiv', 'nf_sub', 'normal' );&nbsp;</div></li><li><div>        // Add our field editing metabox.&nbsp;</div></li><li><div>        add_meta_box( 'nf_fields', __( 'User Submitted Values', 'ninja-forms' ), array( $this, 'edit_sub_metabox' ), 'nf_sub', 'normal', 'default');&nbsp;</div></li><li><div>        // Add our save field values metabox&nbsp;</div></li><li><div>        add_meta_box( 'nf_fields_save', __( 'Submission Stats', 'ninja-forms' ), array( $this, 'save_sub_metabox' ), 'nf_sub', 'side', 'default');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Output our field editing metabox to the CPT editing page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function edit_sub_metabox( $post ) {&nbsp;</div></li><li><div>        global $ninja_forms_fields;&nbsp;</div></li><li><div>        // Get all the post meta&nbsp;</div></li><li><div>        $form_id = Ninja_Forms()-&gt;sub( $post-&gt;ID )-&gt;form_id;&nbsp;</div></li><li><div>        $fields = Ninja_Forms()-&gt;form( $this-&gt;form_id )-&gt;fields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset ( $_REQUEST['ref'] ) ) {&nbsp;</div></li><li><div>            $ref = esc_url_raw( $_REQUEST['ref'] );&nbsp;</div></li><li><div>        } else if ( get_transient( 'nf_sub_edit_ref' ) ) {&nbsp;</div></li><li><div>            $ref = get_transient( 'nf_sub_edit_ref' );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $ref = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;input type=&quot;hidden&quot; name=&quot;ref&quot; value=&quot;&lt;?php echo $ref; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;postcustomstuff&quot;&gt;&nbsp;</div></li><li><div>            &lt;table id=&quot;list-table&quot;&gt;&nbsp;</div></li><li><div>                &lt;thead&gt;&nbsp;</div></li><li><div>                &lt;tr&gt;&nbsp;</div></li><li><div>                    &lt;th class=&quot;left&quot;&gt;&lt;?php _e( 'Field', 'ninja-forms' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;th&gt;&lt;?php _e( 'Value', 'ninja-forms' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>                &lt;/thead&gt;&nbsp;</div></li><li><div>                &lt;tbody id=&quot;the-list&quot;&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                // Loop through our post meta and keep our field values&nbsp;</div></li><li><div>                foreach ( $fields as $field_id =&gt; $field ) {&nbsp;</div></li><li><div>                    $user_value = Ninja_Forms()-&gt;sub( $post-&gt;ID )-&gt;get_field( $field_id );&nbsp;</div></li><li><div>                    $field_type = $field['type'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset ( $field['data']['admin_label'] ) && $field['data']['admin_label'] != '' ) {&nbsp;</div></li><li><div>                        $label = $field['data']['admin_label'];&nbsp;</div></li><li><div>                    } else if ( isset ( $field['data']['label'] ) ) {&nbsp;</div></li><li><div>                        $label = $field['data']['label'];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $label = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset ( $ninja_forms_fields[ $field_type ] ) ) {&nbsp;</div></li><li><div>                        $reg_field = $ninja_forms_fields[ $field_type ];&nbsp;</div></li><li><div>                        $process_field = $reg_field['process_field'];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $process_field = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( isset ( Ninja_Forms()-&gt;form( $this-&gt;form_id )-&gt;fields[ $field_id ] ) && $process_field ) {&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;tr&gt;&nbsp;</div></li><li><div>                            &lt;td class=&quot;left&quot;&gt;&lt;?php echo $label; ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                            &lt;td&gt;&nbsp;</div></li><li><div>                                &lt;div class=&quot;nf-sub-edit-value type-&lt;?php echo $field_type; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                                    &lt;?php&nbsp;</div></li><li><div>                                    if ( isset ( $reg_field['edit_sub_value'] ) ) {&nbsp;</div></li><li><div>                                        $edit_value_function = $reg_field['edit_sub_value'];&nbsp;</div></li><li><div>                                    } else {&nbsp;</div></li><li><div>                                        $edit_value_function = 'nf_field_text_edit_sub_value';&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    $args['field_id'] = $field_id;&nbsp;</div></li><li><div>                                    $args['user_value'] = nf_wp_kses_post_deep( $user_value );&nbsp;</div></li><li><div>                                    $args['field'] = $field;&nbsp;</div></li><li><div>                                    $args['sub_id'] = $post-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    call_user_func_array( $edit_value_function, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    ?&gt;&nbsp;</div></li><li><div>                                &lt;/div&gt;&nbsp;</div></li><li><div>                            &lt;/td&gt;&nbsp;</div></li><li><div>                        &lt;/tr&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;/tbody&gt;&nbsp;</div></li><li><div>            &lt;/table&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Output our field editing metabox to the CPT editing page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_sub_metabox( $post ) {&nbsp;</div></li><li><div>        $date_submitted = apply_filters( 'nf_edit_sub_date_submitted', date( 'M j, Y @ h:i', strtotime( $post-&gt;post_date ) ), $post-&gt;ID );&nbsp;</div></li><li><div>        $date_modified = apply_filters( 'nf_edit_sub_date_modified', date( 'M j, Y @ h:i', strtotime( $post-&gt;post_modified ) ), $post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $post-&gt;post_author != 0 ) {&nbsp;</div></li><li><div>            $user_data = get_userdata( $post-&gt;post_author );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $first_name = $user_data-&gt;first_name;&nbsp;</div></li><li><div>            $last_name = $user_data-&gt;last_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $first_name != '' && $last_name != '' ) {&nbsp;</div></li><li><div>                $name = $first_name . ' ' . $last_name;&nbsp;</div></li><li><div>            } else if ( $user_data-&gt;display_name != '' ) {&nbsp;</div></li><li><div>                $name = $user_data-&gt;display_name;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $name = $user_data-&gt;user_login;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $name = apply_filters( 'nf_edit_sub_username', $name, $post-&gt;post_author );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $form_id = Ninja_Forms()-&gt;sub( $post-&gt;ID )-&gt;form_id;&nbsp;</div></li><li><div>        $form_title = Ninja_Forms()-&gt;form( $form_id )-&gt;get_setting( 'form_title' );&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;input type=&quot;hidden&quot; name=&quot;nf_edit_sub&quot; value=&quot;1&quot;&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;submitbox&quot; id=&quot;submitpost&quot;&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;minor-publishing&quot;&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;misc-publishing-actions&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;misc-pub-section misc-pub-post-status&quot;&gt;&nbsp;</div></li><li><div>                        &lt;label for=&quot;post_status&quot;&gt;&lt;?php _e( '#', 'ninja-forms' ); ?&gt;:&lt;/label&gt;&nbsp;</div></li><li><div>                        &lt;span id=&quot;sub-seq-num-display&quot;&gt;&lt;?php echo Ninja_Forms()-&gt;sub( $post-&gt;ID )-&gt;get_seq_num(); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;misc-pub-section misc-pub-post-status&quot;&gt;&nbsp;</div></li><li><div>                        &lt;label for=&quot;post_status&quot;&gt;&lt;?php _e( 'Status', 'ninja-forms' ); ?&gt;:&lt;/label&gt;&nbsp;</div></li><li><div>                        &lt;span id=&quot;sub-status-display&quot;&gt;&lt;?php echo apply_filters( 'nf_sub_edit_status', __( 'Submitted', 'ninja-forms' ), $post-&gt;ID ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                        &lt;?php do_action( 'nf_sub_edit_after_status', $post ); ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;misc-pub-section misc-pub-post-status&quot;&gt;&nbsp;</div></li><li><div>                        &lt;label for=&quot;post_status&quot;&gt;&lt;?php _e( 'Form', 'ninja-forms' ); ?&gt;:&lt;/label&gt;&nbsp;</div></li><li><div>                        &lt;span id=&quot;sub-form-title-display&quot;&gt;&lt;?php echo $form_title; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;misc-pub-section curtime misc-pub-curtime&quot;&gt;&nbsp;</div></li><li><div>                        &lt;span id=&quot;timestamp&quot;&gt;&nbsp;</div></li><li><div>                            &lt;?php _e( 'Submitted on', 'ninja-forms' ); ?&gt;: &lt;b&gt;&lt;?php echo $date_submitted; ?&gt;&lt;/b&gt;&nbsp;</div></li><li><div>                        &lt;/span&gt;&nbsp;</div></li><li><div>                        &lt;?php do_action( 'nf_sub_edit_date_submitted', $post ); ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;misc-pub-section curtime misc-pub-curtime&quot;&gt;&nbsp;</div></li><li><div>                        &lt;span id=&quot;timestamp&quot;&gt;&nbsp;</div></li><li><div>                            &lt;?php _e( 'Modified on', 'ninja-forms', $post ); ?&gt;: &lt;b&gt;&lt;?php echo $date_modified; ?&gt;&lt;/b&gt;&nbsp;</div></li><li><div>                        &lt;/span&gt;&nbsp;</div></li><li><div>                        &lt;?php do_action( 'nf_sub_edit_date_modified', $post ); ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    if ( $post-&gt;post_author != 0 ) {&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;misc-pub-section misc-pub-visibility&quot; id=&quot;visibility&quot;&gt;&nbsp;</div></li><li><div>                            &lt;?php _e( 'Submitted By', 'ninja-forms' ); ?&gt;: &lt;span id=&quot;post-visibility-display&quot;&gt;&lt;?php echo $name; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;major-publishing-actions&quot;&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;delete-action&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;!-- &lt;a class=&quot;submitdelete deletion&quot; href=&quot;&lt;?php echo get_delete_post_link( $post-&gt;ID ); ?&gt;&quot;&gt;Move to Trash&lt;/a&gt;--&gt;&lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;div id=&quot;publishing-action&quot;&gt;&nbsp;</div></li><li><div>                    &lt;span class=&quot;spinner&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                    &lt;input name=&quot;original_publish&quot; type=&quot;hidden&quot; id=&quot;original_publish&quot; value=&quot;&lt;?php _e( 'Update', 'ninja-forms' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                    &lt;input name=&quot;save&quot; type=&quot;submit&quot; class=&quot;button button-primary button-large&quot; id=&quot;publish&quot; accesskey=&quot;p&quot; value=&quot;&lt;?php _e( 'Update', 'ninja-forms' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save our submission user values&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save_sub( $sub_id, $post ) {&nbsp;</div></li><li><div>        global $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset ( $_POST['nf_edit_sub'] ) || $_POST['nf_edit_sub'] != 1 )&nbsp;</div></li><li><div>            return $sub_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // verify if this is an auto save routine.&nbsp;</div></li><li><div>        // If it is our form has not been submitted, so we dont want to do anything&nbsp;</div></li><li><div>        if ( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE )&nbsp;</div></li><li><div>            return $sub_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $pagenow != 'post.php' )&nbsp;</div></li><li><div>            return $sub_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $post-&gt;post_type != 'nf_sub' )&nbsp;</div></li><li><div>            return $sub_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Get the post type object. */&nbsp;</div></li><li><div>        $post_type = get_post_type_object( $post-&gt;post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Check if the current user has permission to edit the post. */&nbsp;</div></li><li><div>        if ( !current_user_can( $post_type-&gt;cap-&gt;edit_post, $sub_id ) )&nbsp;</div></li><li><div>            return $sub_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $_POST['fields'] as $field_id =&gt; $user_value ) {&nbsp;</div></li><li><div>            $user_value = nf_wp_kses_post_deep( apply_filters( 'nf_edit_sub_user_value', $user_value, $field_id, $sub_id ) );&nbsp;</div></li><li><div>            Ninja_Forms()-&gt;sub( $sub_id )-&gt;update_field( $field_id, $user_value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        set_transient( 'nf_sub_edit_ref', esc_url_raw( $_REQUEST['ref'] ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter our hidden columns so that they are handled on a per-form basis.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function filter_hidden_columns() {&nbsp;</div></li><li><div>        global $pagenow;&nbsp;</div></li><li><div>        // Bail if we aren't on the edit.php page, we aren't editing our custom post type, or we don't have a form_id set.&nbsp;</div></li><li><div>        if ( $pagenow != 'edit.php' || ! isset ( $_REQUEST['post_type'] ) || $_REQUEST['post_type'] != 'nf_sub' || ! isset ( $_REQUEST['form_id'] ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Grab our current user.&nbsp;</div></li><li><div>        $user = wp_get_current_user();&nbsp;</div></li><li><div>        // Grab our form id.&nbsp;</div></li><li><div>        $form_id = absint( $_REQUEST['form_id'] );&nbsp;</div></li><li><div>        // Get the columns that should be hidden for this form ID.&nbsp;</div></li><li><div>        $hidden_columns = get_user_option( 'manageedit-nf_subcolumnshidden-form-' . $form_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $hidden_columns === false ) {&nbsp;</div></li><li><div>            // If we don't have custom hidden columns set up for this form, then only show the first five columns.&nbsp;</div></li><li><div>            // Get our column headers&nbsp;</div></li><li><div>            $columns = get_column_headers( 'edit-nf_sub' );&nbsp;</div></li><li><div>            $hidden_columns = array();&nbsp;</div></li><li><div>            $x = 0;&nbsp;</div></li><li><div>            foreach ( $columns as $slug =&gt; $name ) {&nbsp;</div></li><li><div>                if ( $x &gt; 5 ) {&nbsp;</div></li><li><div>                    if ( $slug != 'sub_date' )&nbsp;</div></li><li><div>                        $hidden_columns[] = $slug;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $x++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        update_user_option( $user-&gt;ID, 'manageedit-nf_subcolumnshidden', $hidden_columns, true );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save our hidden columns per form id.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function hide_columns() {&nbsp;</div></li><li><div>        // Grab our current user.&nbsp;</div></li><li><div>        $user = wp_get_current_user();&nbsp;</div></li><li><div>        // Grab our form id.&nbsp;</div></li><li><div>        $form_id = absint( $_REQUEST['form_id'] );&nbsp;</div></li><li><div>        $hidden = isset( $_POST['hidden'] ) ? explode( ', ', esc_html( $_POST['hidden'] ) ) : array();&nbsp;</div></li><li><div>        $hidden = array_filter( $hidden );&nbsp;</div></li><li><div>        update_user_option( $user-&gt;ID, 'manageedit-nf_subcolumnshidden-form-' . $form_id, $hidden, true );&nbsp;</div></li><li><div>        die();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add custom screen options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function output_screen_options( $status, $args ) {&nbsp;</div></li><li><div>        if ( $args-&gt;base == 'edit' && $args-&gt;post_type == 'nf_sub' ) {&nbsp;</div></li><li><div>            $status .= '&lt;span id=&quot;nf-subs-screen-options&quot;&gt;' . $this-&gt;screen_options . '&lt;/span&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $status;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Listen for exporting subs&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7.3&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function export_listen() {&nbsp;</div></li><li><div>        // Bail if we aren't in the admin&nbsp;</div></li><li><div>        if ( ! is_admin() )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset ( $_REQUEST['form_id'] ) || empty ( $_REQUEST['form_id'] ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset ( $_REQUEST['export_single'] ) && ! empty( $_REQUEST['export_single'] ) )&nbsp;</div></li><li><div>            Ninja_Forms()-&gt;sub( esc_html( $_REQUEST['export_single'] ) )-&gt;export();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( isset ( $_REQUEST['action'] ) && $_REQUEST['action'] == 'export' ) || ( isset ( $_REQUEST['action2'] ) && $_REQUEST['action2'] == 'export' ) ) {&nbsp;</div></li><li><div>            Ninja_Forms()-&gt;subs()-&gt;export( ninja_forms_esc_html_deep( $_REQUEST['post'] ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset ( $_REQUEST['download_file'] ) && ! empty( $_REQUEST['download_file'] ) ) {&nbsp;</div></li><li><div>            // Open our download all file&nbsp;</div></li><li><div>            $filename = esc_html( $_REQUEST['download_file'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $upload_dir = wp_upload_dir();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $file_path = trailingslashit( $upload_dir['path'] ) . $filename . '.csv';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( file_exists( $file_path ) ) {&nbsp;</div></li><li><div>                $myfile = file_get_contents ( $file_path );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $redirect = esc_url_raw( remove_query_arg( array( 'download_file', 'download_all' ) ) );&nbsp;</div></li><li><div>                wp_redirect( $redirect );&nbsp;</div></li><li><div>                die();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            unlink( $file_path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $form_name = Ninja_Forms()-&gt;form( absint( $_REQUEST['form_id'] ) )-&gt;get_setting( 'form_title' );&nbsp;</div></li><li><div>            $form_name = sanitize_title( $form_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $today = date( 'Y-m-d', current_time( 'timestamp' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $filename = apply_filters( 'nf_download_all_filename', $form_name . '-all-subs-' . $today );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            header( 'Content-type: application/csv');&nbsp;</div></li><li><div>            header( 'Content-Disposition: attachment; filename=&quot;'.$filename .'.csv&quot;' );&nbsp;</div></li><li><div>            header( 'Pragma: no-cache');&nbsp;</div></li><li><div>            header( 'Expires: 0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            echo $myfile;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            die();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filter user capabilities&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @since 2.7.7&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function cap_filter( $allcaps, $cap, $args ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sub_cap = apply_filters( 'ninja_forms_admin_submissions_capabilities', 'manage_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $allcaps[ $sub_cap ] ) ) {&nbsp;</div></li><li><div>            $allcaps['nf_sub'] = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $allcaps;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/ninja-forms/3.1.1/classes/nf_subs_cpt/" class="active">3.1.1</a></li><li><a href="http://hookr.io/plugins/ninja-forms/3.1/classes/nf_subs_cpt/" class="">3.1</a></li><li><a href="http://hookr.io/plugins/ninja-forms/3.0.7/classes/nf_subs_cpt/" class="">3.0.7</a></li><li><a href="http://hookr.io/plugins/ninja-forms/3.0.6/classes/nf_subs_cpt/" class="">3.0.6</a></li><li><a href="http://hookr.io/plugins/ninja-forms/3.0.5/classes/nf_subs_cpt/" class="">3.0.5</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>NF_Subs_CPT</li><li><span></span>Ninja Forms</li><li><span></span>3.1.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>