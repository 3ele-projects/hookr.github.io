<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="5.7.0" data-slug="breadcrumb-navxt" data-type="file" data-id="10297"><head xmlns="http://www.w3.org/1999/xhtml"><title> class-bcn-breadcrumb-trail | file | Breadcrumb Navxt | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, breadcrumb-navxt, 5.7.0" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=09cad2a4a3408ed16b81e6cbf1824f2b' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/class-bcn-breadcrumb-trail/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fclass-bcn-breadcrumb-trail%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fclass-bcn-breadcrumb-trail%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-breadcrumb-navxt-5.7.0-file-class-bcn-breadcrumb-trail","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="class-bcn-breadcrumb-trail" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to breadcrumb-navxt." href="http://hookr.io/plugins/breadcrumb-navxt/" class="plugin"><span property="name">breadcrumb-navxt</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 5.7.0." href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/" class="H_VERSION"><span property="name">5.7.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">class-bcn-breadcrumb-trail</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="79"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/all/" title="All">All <span class="count badge">79</span></a></li><li class="" data-id="new" data-count="1"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/new/" title="New">New <span class="count badge">1</span></a></li><li class="" data-id="hooks" data-count="57"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/hooks/" title="Hooks">Hooks <span class="count badge">57</span></a></li><li class="" data-id="action" data-count="26"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/actions/" title="Actions">Actions <span class="count badge">26</span></a></li><li class="" data-id="filter" data-count="31"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/filters/" title="Filters">Filters <span class="count badge">31</span></a></li><li class="" data-id="class" data-count="9"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/classes/" title="Classes">Classes <span class="count badge">9</span></a></li><li class="" data-id="constant" data-count="1"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/constants/" title="Constants">Constants <span class="count badge">1</span></a></li><li class="" data-id="function" data-count="12"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/functions/" title="Functions">Functions <span class="count badge">12</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/breadcrumb-navxt/5.7.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/class.bcn_breadcrumb_trail.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**  </span>&nbsp;</div></li><li><div><span class="comment">  Copyright 2007-2017  John Havlik  (email : john.havlik@mtekk.us)</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  This program is free software; you can redistribute it and/or modify</span>&nbsp;</div></li><li><div><span class="comment">  it under the terms of the GNU General Public License as published by</span>&nbsp;</div></li><li><div><span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>&nbsp;</div></li><li><div><span class="comment">  (at your option) any later version.</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  This program is distributed in the hope that it will be useful, </span>&nbsp;</div></li><li><div><span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>&nbsp;</div></li><li><div><span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>&nbsp;</div></li><li><div><span class="comment">  GNU General Public License for more details.</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  You should have received a copy of the GNU General Public License</span>&nbsp;</div></li><li><div><span class="comment">  along with this program; if not, write to the Free Software</span>&nbsp;</div></li><li><div><span class="comment">  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>require_once(dirname(__FILE__) . '/includes/block_direct_access.php');&nbsp;</div></li><li><div><span class="comment">//The trail class</span>&nbsp;</div></li><li><div>class bcn_breadcrumb_trail&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">//Our member variables</span>&nbsp;</div></li><li><div>  const version = '5.7.0';&nbsp;</div></li><li><div>  <span class="comment">//An array of breadcrumbs</span>&nbsp;</div></li><li><div>  public $breadcrumbs = array();&nbsp;</div></li><li><div>  public $trail = array();&nbsp;</div></li><li><div>  <span class="comment">//The options</span>&nbsp;</div></li><li><div>  public $opt;&nbsp;</div></li><li><div>  <span class="comment">//Default constructor</span>&nbsp;</div></li><li><div>  public function __construct()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//@see https://core.trac.wordpress.org/ticket/10527</span>&nbsp;</div></li><li><div>      if(!is_textdomain_loaded('breadcrumb-navxt'))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          load_plugin_textdomain('breadcrumb-navxt', false, 'breadcrumb-navxt/languages');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;trail = &$this-&gt;breadcrumbs;&nbsp;</div></li><li><div>      <span class="comment">//Initilize with default option values</span>&nbsp;</div></li><li><div>      $this-&gt;opt = array(&nbsp;</div></li><li><div>          <span class="comment">//Should the mainsite be shown</span>&nbsp;</div></li><li><div>          'bmainsite_display' =&gt; true, &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for the main site</span>&nbsp;</div></li><li><div>          'Hmainsite_template' =&gt; bcn_breadcrumb::get_default_template(), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for the main site</span>, used when an anchor is not needed&nbsp;</div></li><li><div>          'Hmainsite_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//Should the home page be shown</span>&nbsp;</div></li><li><div>          'bhome_display' =&gt; true, &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for the home page</span>&nbsp;</div></li><li><div>          'Hhome_template' =&gt; bcn_breadcrumb::get_default_template(), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for the home page</span>, used when an anchor is not needed&nbsp;</div></li><li><div>          'Hhome_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//Should the blog page be shown globally</span>&nbsp;</div></li><li><div>          'bblog_display' =&gt; true, &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for the blog page only in static front page mode</span>&nbsp;</div></li><li><div>          'Hblog_template' =&gt; bcn_breadcrumb::get_default_template(), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for the blog page only in static front page mode</span>, used when an anchor is not needed&nbsp;</div></li><li><div>          'Hblog_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//Separator that is placed between each item in the breadcrumb trial, but not placed before</span>&nbsp;</div></li><li><div>          <span class="comment">//the first and not after the last breadcrumb</span>&nbsp;</div></li><li><div>          'hseparator' =&gt; ' &gt; ', &nbsp;</div></li><li><div>          <span class="comment">//Whether or not we should trim the breadcrumb titles</span>&nbsp;</div></li><li><div>          'blimit_title' =&gt; false, &nbsp;</div></li><li><div>          <span class="comment">//The maximum title length</span>&nbsp;</div></li><li><div>          'amax_title_length' =&gt; 20, &nbsp;</div></li><li><div>          <span class="comment">//Current item options</span>&nbsp;</div></li><li><div>          'bcurrent_item_linked' =&gt; false, &nbsp;</div></li><li><div>          <span class="comment">//Static page options</span>&nbsp;</div></li><li><div>          <span class="comment">//The anchor template for page breadcrumbs</span>&nbsp;</div></li><li><div>          'Hpost_page_template' =&gt; bcn_breadcrumb::get_default_template(), &nbsp;</div></li><li><div>          <span class="comment">//The anchor template for page breadcrumbs</span>, used when an anchor is not needed&nbsp;</div></li><li><div>          'Hpost_page_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//Just a link to the page on front property</span>&nbsp;</div></li><li><div>          'apost_page_root' =&gt; get_option('page_on_front'), &nbsp;</div></li><li><div>          <span class="comment">//Paged options</span>&nbsp;</div></li><li><div>          <span class="comment">//The template for paged breadcrumb</span>&nbsp;</div></li><li><div>          'Hpaged_template' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;span property=&quot;name&quot;&gt;Page %htitle%&lt;/span&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//Should we try filling out paged information</span>&nbsp;</div></li><li><div>          'bpaged_display' =&gt; false, &nbsp;</div></li><li><div>          <span class="comment">//The post options previously singleblogpost</span>&nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for post breadcrumbs</span>&nbsp;</div></li><li><div>          'Hpost_post_template' =&gt; bcn_breadcrumb::get_default_template(), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for post breadcrumbs</span>, used when an anchor is not needed&nbsp;</div></li><li><div>          'Hpost_post_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//Just a link for the page for posts</span>&nbsp;</div></li><li><div>          'apost_post_root' =&gt; get_option('page_for_posts'), &nbsp;</div></li><li><div>          <span class="comment">//Should the trail include the taxonomy of the post</span>&nbsp;</div></li><li><div>          'bpost_post_taxonomy_display' =&gt; true, &nbsp;</div></li><li><div>          <span class="comment">//Should the trail reflect the referer taxonomy or not</span>&nbsp;</div></li><li><div>          'bpost_post_taxonomy_referer' =&gt; false, &nbsp;</div></li><li><div>          <span class="comment">//What taxonomy should be shown leading to the post, tag or category</span>&nbsp;</div></li><li><div>          'Spost_post_taxonomy_type' =&gt; 'category', &nbsp;</div></li><li><div>          <span class="comment">//Attachment settings</span>&nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for attachment breadcrumbs</span>&nbsp;</div></li><li><div>          'Hpost_attachment_template' =&gt; bcn_breadcrumb::get_default_template(), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for attachment breadcrumbs</span>, used when an anchor is not needed&nbsp;</div></li><li><div>          'Hpost_attachment_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//404 page settings</span>&nbsp;</div></li><li><div>          <span class="comment">//The template for 404 breadcrumbs</span>&nbsp;</div></li><li><div>          'H404_template' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//The text to be shown in the breadcrumb for a 404 page</span>&nbsp;</div></li><li><div>          'S404_title' =&gt; __('404', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//Search page options</span>&nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for search breadcrumbs</span>&nbsp;</div></li><li><div>          'Hsearch_template' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;span property=&quot;name&quot;&gt;Search results for &#39;&lt;a property=&quot;item&quot; typeof=&quot;WebPage&quot; title=&quot;Go to the first page of search results for %title%.&quot; href=&quot;%link%&quot; class=&quot;%type%&quot;&gt;%htitle%&lt;/a&gt;&#39;&lt;/span&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for search breadcrumbs</span>, used when an anchor is not necessary&nbsp;</div></li><li><div>          'Hsearch_template_no_anchor' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;span property=&quot;name&quot;&gt;Search results for &#39;%htitle%&#39;&lt;/span&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//Tag related stuff</span>&nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for tag breadcrumbs</span>&nbsp;</div></li><li><div>          'Htax_post_tag_template' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;a property=&quot;item&quot; typeof=&quot;WebPage&quot; title=&quot;Go to the %title% tag archives.&quot; href=&quot;%link%&quot; class=&quot;%type%&quot;&gt;&lt;span property=&quot;name&quot;&gt;%htitle%&lt;/span&gt;&lt;/a&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for tag breadcrumbs</span>, used when an anchor is not necessary&nbsp;</div></li><li><div>          'Htax_post_tag_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//Post format related stuff</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//The breadcrumb template for post format breadcrumbs</span>, used when an anchor is not necessary</span>&nbsp;</div></li><li><div>          'Htax_post_format_template' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;a property=&quot;item&quot; typeof=&quot;WebPage&quot; title=&quot;Go to the %title% archives.&quot; href=&quot;%link%&quot; class=&quot;%type%&quot;&gt;&lt;span property=&quot;name&quot;&gt;%htitle%&lt;/span&gt;&lt;/a&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for post format breadcrumbs</span>&nbsp;</div></li><li><div>          'Htax_post_format_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//Author page stuff</span>&nbsp;</div></li><li><div>          <span class="comment">//The anchor template for author breadcrumbs</span>&nbsp;</div></li><li><div>          'Hauthor_template' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;span property=&quot;name&quot;&gt;Articles by: &lt;a title=&quot;Go to the first page of posts by %title%.&quot; href=&quot;%link%&quot; class=&quot;%type%&quot;&gt;%htitle%&lt;/a&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//The anchor template for author breadcrumbs</span>, used when anchors are not needed&nbsp;</div></li><li><div>          'Hauthor_template_no_anchor' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;span property=&quot;name&quot;&gt;Articles by: %htitle%&lt;/span&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//Which of the various WordPress display types should the author breadcrumb display</span>&nbsp;</div></li><li><div>          'Sauthor_name' =&gt; 'display_name', &nbsp;</div></li><li><div>          <span class="comment">//Category stuff</span>&nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for category breadcrumbs</span>&nbsp;</div></li><li><div>          'Htax_category_template' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;a property=&quot;item&quot; typeof=&quot;WebPage&quot; title=&quot;Go to the %title% category archives.&quot; href=&quot;%link%&quot; class=&quot;%type%&quot;&gt;&lt;span property=&quot;name&quot;&gt;%htitle%&lt;/span&gt;&lt;/a&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for category breadcrumbs</span>, used when anchors are not needed&nbsp;</div></li><li><div>          'Htax_category_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor, &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for date breadcrumbs</span>&nbsp;</div></li><li><div>          'Hdate_template' =&gt; __('&lt;span property=&quot;itemListElement&quot; typeof=&quot;ListItem&quot;&gt;&lt;a property=&quot;item&quot; typeof=&quot;WebPage&quot; title=&quot;Go to the %title% archives.&quot; href=&quot;%link%&quot; class=&quot;%type%&quot;&gt;&lt;span property=&quot;name&quot;&gt;%htitle%&lt;/span&gt;&lt;/a&gt;&lt;meta property=&quot;position&quot; content=&quot;%position%&quot;&gt;&lt;/span&gt;', 'breadcrumb-navxt'), &nbsp;</div></li><li><div>          <span class="comment">//The breadcrumb template for date breadcrumbs</span>, used when anchors are not needed&nbsp;</div></li><li><div>          'Hdate_template_no_anchor' =&gt; bcn_breadcrumb::default_template_no_anchor&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This returns the internal version</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string internal version of the Breadcrumb trail</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_version()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      _deprecated_function( __FUNCTION__, '5.2', 'bcn_breadcrumb_trail::version' );&nbsp;</div></li><li><div>      return self::version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds a breadcrumb to the breadcrumb trail</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param bcn_breadcrumb $object Breadcrumb to add to the trail</span>&nbsp;</div></li><li><div><span class="comment">   * @return pointer to the just added Breadcrumb</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function &add(bcn_breadcrumb $object)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;breadcrumbs[] = $object;&nbsp;</div></li><li><div>      <span class="comment">//Return the just added object</span>&nbsp;</div></li><li><div>      return $this-&gt;breadcrumbs[count($this-&gt;breadcrumbs) - 1];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for a search page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_search()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_search_query(), $this-&gt;opt['Hsearch_template_no_anchor'], array('search', 'current-item')));&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//If we're paged, or allowing the current item to be linked, let's link to the first page</span></span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bcurrent_item_linked'] || (is_paged() && $this-&gt;opt['bpaged_display']))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Since we are paged and are linking the root breadcrumb, time to change to the regular template</span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_template($this-&gt;opt['Hsearch_template']);&nbsp;</div></li><li><div>          <span class="comment">//Figure out the anchor for the search</span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_url(get_search_link());&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for an author page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_author()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if(get_query_var('author_name'))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $authordata = get_user_by('slug', get_query_var('author_name'));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $authordata = get_userdata(get_query_var('author'));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Setup array of valid author_name values</span>&nbsp;</div></li><li><div>      $valid_author_name = array('display_name', 'nickname', 'first_name', 'last_name');&nbsp;</div></li><li><div>      <span class="comment">//Make sure user picks only safe values</span>&nbsp;</div></li><li><div>      if(in_array($this-&gt;opt['Sauthor_name'], $valid_author_name))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_author_meta($this-&gt;opt['Sauthor_name'], $authordata-&gt;ID), $this-&gt;opt['Hauthor_template_no_anchor'], array('author', 'current-item'), NULL, $authordata-&gt;ID));&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//If we're paged, or allowing the current item to be linked, let's link to the first page</span></span>&nbsp;</div></li><li><div>          if($this-&gt;opt['bcurrent_item_linked'] || (is_paged() && $this-&gt;opt['bpaged_display']))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment">//Set the template to our one containing an anchor</span>&nbsp;</div></li><li><div>              $breadcrumb-&gt;set_template($this-&gt;opt['Hauthor_template']);&nbsp;</div></li><li><div>              $breadcrumb-&gt;set_url(get_author_posts_url($authordata-&gt;ID));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determines the taxonomy name represented by the specified query var</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param string $query_var The query var to attempt to find the corresponding taxonomy</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|bool Either the name of the taxonomy corresponding to the query_var or false if no taxonomy exists for the specified query_var</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function query_var_to_taxonomy($query_var)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp_taxonomies;&nbsp;</div></li><li><div>      foreach($wp_taxonomies as $taxonomy)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          if($taxonomy-&gt;query_var === $query_var)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              return $taxonomy-&gt;name;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determines the referer taxonomy</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @return string|bool Either the name of the taxonomy to use or false if a referer taxonomy wasn't found</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function determine_taxonomy()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp;&nbsp;</div></li><li><div>      <span class="comment">//Backup the server request variable</span>&nbsp;</div></li><li><div>      $bk_req = $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>      <span class="comment">//Now set the request URL to the referrer URL</span>&nbsp;</div></li><li><div>      <span class="comment">//Could just chain the [1] selection, but that's not PHP5.3 compatible</span>&nbsp;</div></li><li><div>      $url_split = explode(home_url(), esc_url(wp_get_referer()));&nbsp;</div></li><li><div>      if(isset($url_split[1]))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $_SERVER['REQUEST_URI'] = $url_split[1];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Create our own new instance of WP, and have it parse our faux request</span>&nbsp;</div></li><li><div>      $bcn_wp = new WP();&nbsp;</div></li><li><div>      <span class="comment">//Copy over the current global wp object's query_vars since CPTs and taxonomies are added directly to the global $wp</span>&nbsp;</div></li><li><div>      $bcn_wp-&gt;public_query_vars = $wp-&gt;public_query_vars;&nbsp;</div></li><li><div>      $bcn_wp-&gt;parse_request();&nbsp;</div></li><li><div>      $_SERVER['REQUEST_URI'] = $bk_req;&nbsp;</div></li><li><div>      if(is_array($bcn_wp-&gt;query_vars))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          foreach($bcn_wp-&gt;query_vars as $query_var =&gt; $value)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              if($taxonomy = $this-&gt;query_var_to_taxonomy($query_var))&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  return $taxonomy;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function selects the term that should be used for a post's hierarchy</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id The ID of the post to find the term for</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type The post type of the post to figure out the taxonomy for</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $taxonomy The taxonomy to use</span>&nbsp;</div></li><li><div><span class="comment">   * @return WP_Term|bool The term object to use for the post hierarchy or false if no suitable term was found </span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function pick_post_term($id, $type, $taxonomy)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Fill a temporary object with the terms</span>&nbsp;</div></li><li><div>      $bcn_object = get_the_terms($id, $taxonomy);&nbsp;</div></li><li><div>      $potential_parent = 0;&nbsp;</div></li><li><div>      <span class="comment">//Make sure we have an non-empty array</span>&nbsp;</div></li><li><div>      if(is_array($bcn_object))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Now try to find the deepest term of those that we know of</span>&nbsp;</div></li><li><div>          $bcn_use_term = key($bcn_object);&nbsp;</div></li><li><div>          foreach($bcn_object as $key =&gt; $object)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment">//Can't use the next($bcn_object) trick since order is unknown</span>&nbsp;</div></li><li><div>              if($object-&gt;parent &gt; 0  && ($potential_parent === 0 || $object-&gt;parent === $potential_parent))&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $bcn_use_term = $key;&nbsp;</div></li><li><div>                  $potential_parent = $object-&gt;term_id;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $bcn_object[$bcn_use_term];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This function fills breadcrumbs for any post taxonomy</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id The id of the post to figure out the taxonomy for</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type The post type of the post to figure out the taxonomy for</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $parent (optional) The id of the parent of the current post, used if hiearchal posts will be the &quot;taxonomy&quot; for the current post</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function post_hierarchy($id, $type, $parent = NULL)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Check to see if breadcrumbs for the taxonomy of the post needs to be generated</span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bpost_' . $type . '_taxonomy_display'])&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//TODO: Remove deprecated type selection</span></span>&nbsp;</div></li><li><div>          <span class="comment">//Check if we have a date 'taxonomy' request</span>&nbsp;</div></li><li><div>          if($this-&gt;opt['Spost_' . $type . '_taxonomy_type'] === 'BCN_DATE' || $this-&gt;opt['Spost_' . $type . '_taxonomy_type'] === 'date')&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_archive_by_date($type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//TODO: Remove deprecated type selection</span></span>&nbsp;</div></li><li><div>          <span class="comment">//Handle the use of hierarchical posts as the 'taxonomy'</span>&nbsp;</div></li><li><div>          else if($this-&gt;opt['Spost_' . $type . '_taxonomy_type'] === 'BCN_POST_PARENT' || $this-&gt;opt['Spost_' . $type . '_taxonomy_type'] === 'page')&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              if($parent == NULL)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  <span class="comment">//We have to grab the post to find its parent, can't use $post for this one</span>&nbsp;</div></li><li><div>                  $parent = get_post($id);&nbsp;</div></li><li><div>                  <span class="comment">//TODO should we check that we have a WP_Post object here?</span>&nbsp;</div></li><li><div>                  $parent = $parent-&gt;post_parent;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//Grab the frontpage, we'll need it shortly</span>&nbsp;</div></li><li><div>              $bcn_frontpage = get_option('page_on_front');&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//If there is a parent page let's find it</span></span>&nbsp;</div></li><li><div>              if($parent && $id != $parent && $bcn_frontpage != $parent)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $parent = $this-&gt;post_parents($parent, $bcn_frontpage);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $taxonomy = $this-&gt;opt['Spost_' . $type . '_taxonomy_type'];&nbsp;</div></li><li><div>              <span class="comment">//Possibly let the referer influence the taxonomy used</span>&nbsp;</div></li><li><div>              if($this-&gt;opt['bpost_' . $type . '_taxonomy_referer'] && $referrer_taxonomy = $this-&gt;determine_taxonomy())&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  <span class="comment">//See if there were any terms, if so, we can use the referrer influenced taxonomy</span>&nbsp;</div></li><li><div>                  $terms = get_the_terms($id, $referrer_taxonomy);&nbsp;</div></li><li><div>                  if(is_array($terms))&nbsp;</div></li><li><div>                  {&nbsp;</div></li><li><div>                      $taxonomy = $referrer_taxonomy;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//Handle all hierarchical taxonomies, including categories</span>&nbsp;</div></li><li><div>              if(is_taxonomy_hierarchical($taxonomy))&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  <span class="comment">//Filter the results of post_pick_term</span>&nbsp;</div></li><li><div>                  $term = apply_filters('bcn_pick_post_term', $this-&gt;pick_post_term($id, $type, $taxonomy), $id, $type, $taxonomy);&nbsp;</div></li><li><div>                  <span class="comment">//Only do something if we found a term</span>&nbsp;</div></li><li><div>                  if($term instanceof WP_Term)&nbsp;</div></li><li><div>                  {&nbsp;</div></li><li><div>                      <span class="comment">//Fill out the term hiearchy</span>&nbsp;</div></li><li><div>                      $parent = $this-&gt;term_parents($term-&gt;term_id, $taxonomy);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//Handle the rest of the taxonomies, including tags</span>&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $this-&gt;post_terms($id, $taxonomy);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//If we never got a good parent for the type_archive, make it now</span>&nbsp;</div></li><li><div>      if(!($parent instanceof WP_Post))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $parent = get_post($id);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Finish off with trying to find the type archive</span>&nbsp;</div></li><li><div>      $this-&gt;type_archive($parent);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for the terms of a post</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id The id of the post to find the terms for</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $taxonomy The name of the taxonomy that the term belongs to</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * TODO Need to implement this cleaner</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function post_terms($id, $taxonomy)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Apply a filter to the terms for the post referred to by ID</span>&nbsp;</div></li><li><div>      $bcn_terms = apply_filters('bcn_post_terms', get_the_terms($id, $taxonomy), $taxonomy, $id);&nbsp;</div></li><li><div>      <span class="comment">//Only process if we have terms</span>&nbsp;</div></li><li><div>      if(is_array($bcn_terms))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $title = '';    &nbsp;</div></li><li><div>          $is_first = true;&nbsp;</div></li><li><div>          <span class="comment">//Loop through all of the term results</span>&nbsp;</div></li><li><div>          foreach($bcn_terms as $term)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment">//Everything but the first term needs a comma separator</span>&nbsp;</div></li><li><div>              if($is_first == false)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $title .= ', ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//This is a bit hackish, but it compiles the term anchor and appends it to the current breadcrumb title</span>&nbsp;</div></li><li><div>              $title .= str_replace(&nbsp;</div></li><li><div>                  array('%title%', '%link%', '%htitle%', '%type%'), &nbsp;</div></li><li><div>                  array($term-&gt;name, $this-&gt;maybe_add_post_type_arg(get_term_link($term), NULL, $term-&gt;taxonomy), $term-&gt;name, $term-&gt;taxonomy), &nbsp;</div></li><li><div>                  $this-&gt;opt['Htax_' . $term-&gt;taxonomy . '_template']);&nbsp;</div></li><li><div>              $is_first = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, template, and type, get a pointer to it in return</span></span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb($title, NULL, array('taxonomy', $taxonomy)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This recursive functions fills the trail with breadcrumbs for parent terms.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id The id of the term.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $taxonomy The name of the taxonomy that the term belongs to</span>&nbsp;</div></li><li><div><span class="comment">   * @return WP_Term The term we stopped at</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function term_parents($id, $taxonomy)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Get the current category object, filter applied within this call</span>&nbsp;</div></li><li><div>      $term = get_term($id, $taxonomy);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, template, and type, get a pointer to it in return</span></span></span></span></span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb($term-&gt;name, $this-&gt;opt['Htax_' . $taxonomy . '_template'], array('taxonomy', $taxonomy), $this-&gt;maybe_add_post_type_arg(get_term_link($term), NULL, $taxonomy), $id));&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Make sure the id is valid, and that we won't end up spinning in a loop</span></span></span>&nbsp;</div></li><li><div>      if($term-&gt;parent && $term-&gt;parent != $id)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Figure out the rest of the term hiearchy via recursion</span>&nbsp;</div></li><li><div>          $term = $this-&gt;term_parents($term-&gt;parent, $taxonomy);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $term;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This recursive functions fills the trail with breadcrumbs for parent posts/pages.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id The id of the parent page.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $frontpage The id of the front page.</span>&nbsp;</div></li><li><div><span class="comment">   * @return WP_Post The parent we stopped at</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function post_parents($id, $frontpage)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Use WordPress API, though a bit heavier than the old method, this will ensure compatibility with other plug-ins</span>&nbsp;</div></li><li><div>      $parent = get_post($id);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, template, and type, get a pointer to it in return</span></span></span></span></span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_title($id), $this-&gt;opt['Hpost_' . $parent-&gt;post_type . '_template'], array('post', 'post-' . $parent-&gt;post_type), get_permalink($id), $id));&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Make sure the id is valid, and that we won't end up spinning in a loop</span></span></span>&nbsp;</div></li><li><div>      if($parent-&gt;post_parent &gt;= 0 && $parent-&gt;post_parent != false && $id != $parent-&gt;post_parent && $frontpage != $parent-&gt;post_parent)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//If valid, recursively call this function</span>&nbsp;</div></li><li><div>          $parent = $this-&gt;post_parents($parent-&gt;post_parent, $frontpage);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $parent;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for posts</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param $post WP_Post Instance of WP_Post object to create a breadcrumb for</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_post($post)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//If we did not get a WP_Post object, warn developer and return early</span>&nbsp;</div></li><li><div>      if(!($post instanceof WP_Post))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          _doing_it_wrong(__CLASS__ . '::' . __FUNCTION__, __('$post global is not of type WP_Post', 'breadcrumb-navxt'), '5.1.1');&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Place the breadcrumb in the trail, uses the bcn_breadcrumb constructor to set the title, template, and type</span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_title($post), $this-&gt;opt['Hpost_' . $post-&gt;post_type . '_template_no_anchor'], array('post', 'post-' . $post-&gt;post_type, 'current-item'), NULL, $post-&gt;ID));&nbsp;</div></li><li><div>      <span class="comment">//If the current item is to be linked, or this is a paged post, add in links</span>&nbsp;</div></li><li><div>      if(is_attachment() || $this-&gt;opt['bcurrent_item_linked'] || (get_query_var('page') &gt; 1 && $this-&gt;opt['bpaged_display']))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Change the template over to the normal, linked one</span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_template($this-&gt;opt['Hpost_' . $post-&gt;post_type . '_template']);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Add the link</span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_url(get_permalink($post));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//If we have page, force it to go through the parent tree</span>&nbsp;</div></li><li><div>      if($post-&gt;post_type === 'page')&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Done with the current item, now on to the parents</span></span>&nbsp;</div></li><li><div>          $frontpage = get_option('page_on_front');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//If there is a parent page let's find it</span></span>&nbsp;</div></li><li><div>          if($post-&gt;post_parent && $post-&gt;ID != $post-&gt;post_parent && $frontpage != $post-&gt;post_parent)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;post_parents($post-&gt;post_parent, $frontpage);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Otherwise we need the follow the hiearchy tree</span>&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Handle the post's hiearchy</span>&nbsp;</div></li><li><div>          $this-&gt;post_hierarchy($post-&gt;ID, $post-&gt;post_type, $post-&gt;post_parent);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for an attachment page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_attachment()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $post = get_post();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, template, and type, get a pointer to it in return</span></span></span></span></span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_title(), $this-&gt;opt['Hpost_attachment_template_no_anchor'], array('post', 'post-attachment', 'current-item'), NULL, $post-&gt;ID));&nbsp;</div></li><li><div>      if($this-&gt;opt['bcurrent_item_linked'])&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Change the template over to the normal, linked one</span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_template($this-&gt;opt['Hpost_attachment_template']);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Add the link</span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_url(get_permalink());&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Done with the current item, now on to the parents</span></span>&nbsp;</div></li><li><div>      $frontpage = get_option('page_on_front');&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Make sure the id is valid, and that we won't end up spinning in a loop</span></span></span>&nbsp;</div></li><li><div>      if($post-&gt;post_parent &gt;= 0 && $post-&gt;post_parent != false && $post-&gt;ID != $post-&gt;post_parent && $frontpage != $post-&gt;post_parent)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Get the parent's information</span>&nbsp;</div></li><li><div>          $parent = get_post($post-&gt;post_parent);&nbsp;</div></li><li><div>          <span class="comment">//Take care of the parent's breadcrumb</span>&nbsp;</div></li><li><div>          $this-&gt;do_post($parent);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This function fills a breadcrumb for any taxonomy archive, was previously two separate functions</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_archive_by_term()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Simmilar to using $post, but for things $post doesn't cover</span></span>&nbsp;</div></li><li><div>      $term = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, template, and type, get a pointer to it in return</span></span></span></span></span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb($term-&gt;name, $this-&gt;opt['Htax_' . $term-&gt;taxonomy . '_template_no_anchor'], array('archive', 'taxonomy', $term-&gt;taxonomy, 'current-item'), NULL, $term-&gt;term_id));&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//If we're paged, let's link to the first page</span></span></span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bcurrent_item_linked'] || (is_paged() && $this-&gt;opt['bpaged_display']))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_template($this-&gt;opt['Htax_' . $term-&gt;taxonomy . '_template']);&nbsp;</div></li><li><div>          <span class="comment">//Figure out the anchor for current category</span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_url($this-&gt;maybe_add_post_type_arg(get_term_link($term), NULL, $term-&gt;taxonomy));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Get parents of current term</span>&nbsp;</div></li><li><div>      if($term-&gt;parent)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $this-&gt;term_parents($term-&gt;parent, $term-&gt;taxonomy);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for a date archive.</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type The type to restrict the date archives to</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_archive_by_date($type)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>      <span class="comment">//First deal with the day breadcrumb</span>&nbsp;</div></li><li><div>      if(is_day() || is_single())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_time(_x('d', 'day archive breadcrumb date format', 'breadcrumb-navxt')), $this-&gt;opt['Hdate_template_no_anchor'], array('archive', 'date-day')));&nbsp;</div></li><li><div>          <span class="comment">//If this is a day archive, add current-item type</span>&nbsp;</div></li><li><div>          if(is_day())&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $breadcrumb-&gt;add_type('current-item');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//If we're paged, let's link to the first page</span></span></span>&nbsp;</div></li><li><div>          if($this-&gt;opt['bcurrent_item_linked'] || is_paged() && $this-&gt;opt['bpaged_display'] || is_single())&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">//We're linking, so set the linked template</span></span></span>&nbsp;</div></li><li><div>              $breadcrumb-&gt;set_template($this-&gt;opt['Hdate_template']);&nbsp;</div></li><li><div>              $url = get_day_link(get_the_time('Y'), get_the_time('m'), get_the_time('d'));&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Deal with the anchor</span></span></span></span>&nbsp;</div></li><li><div>              $breadcrumb-&gt;set_url($this-&gt;maybe_add_post_type_arg($url, $type));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Now deal with the month breadcrumb</span>&nbsp;</div></li><li><div>      if(is_month() || is_day() || is_single())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_time(_x('F', 'month archive breadcrumb date format', 'breadcrumb-navxt')), $this-&gt;opt['Hdate_template_no_anchor'], array('archive', 'date-month')));&nbsp;</div></li><li><div>          <span class="comment">//If this is a month archive, add current-item type</span>&nbsp;</div></li><li><div>          if(is_month())&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $breadcrumb-&gt;add_type('current-item');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//If we're paged, or not in the archive by month let's link to the first archive by month page</span>&nbsp;</div></li><li><div>          if($this-&gt;opt['bcurrent_item_linked'] || is_day() || is_single() || (is_month() && is_paged() && $this-&gt;opt['bpaged_display']))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">//We're linking, so set the linked template</span></span></span>&nbsp;</div></li><li><div>              $breadcrumb-&gt;set_template($this-&gt;opt['Hdate_template']);&nbsp;</div></li><li><div>              $url = get_month_link(get_the_time('Y'), get_the_time('m'));&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Deal with the anchor</span></span></span></span>&nbsp;</div></li><li><div>              $breadcrumb-&gt;set_url($this-&gt;maybe_add_post_type_arg($url, $type));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Place the year breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_time(_x('Y', 'year archive breadcrumb date format', 'breadcrumb-navxt')), $this-&gt;opt['Hdate_template_no_anchor'], array('archive', 'date-year')));&nbsp;</div></li><li><div>      <span class="comment">//If this is a year archive, add current-item type</span>&nbsp;</div></li><li><div>      if(is_year())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $breadcrumb-&gt;add_type('current-item');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//If we're paged, or not in the archive by year let's link to the first archive by year page</span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bcurrent_item_linked'] || is_day() || is_month() || is_single() || (is_paged() && $this-&gt;opt['bpaged_display']))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//We're linking, so set the linked template</span></span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_template($this-&gt;opt['Hdate_template']);&nbsp;</div></li><li><div>          $url = get_year_link(get_the_time('Y'));&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Deal with the anchor</span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_url($this-&gt;maybe_add_post_type_arg($url, $type));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for a post type archive (WP 3.1 feature)</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_archive_by_post_type()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $type_str = $this-&gt;get_type_string_query_var();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb(post_type_archive_title('', false), $this-&gt;opt['Hpost_' . $type_str . '_template_no_anchor'], array('archive', 'post-' . $type_str . '-archive', 'current-item')));&nbsp;</div></li><li><div>      if($this-&gt;opt['bcurrent_item_linked'] || is_paged() && $this-&gt;opt['bpaged_display'])&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          $breadcrumb-&gt;set_template($this-&gt;opt['Hpost_' . $type_str . '_template']);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Deal with the anchor</span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_url(get_post_type_archive_link($type_str));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for the front page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_front_page()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $current_site;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Get the site name</span></span></span></span>&nbsp;</div></li><li><div>      $site_name = get_option('blogname');&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $breadcrumb = $this-&gt;add(new bcn_breadcrumb($site_name, $this-&gt;opt['Hhome_template_no_anchor'], array('home', 'current-item')));&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//If we're paged, let's link to the first page</span></span></span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bcurrent_item_linked'] || (is_paged() && $this-&gt;opt['bpaged_display']))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_template($this-&gt;opt['Hhome_template']);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Figure out the anchor for home page</span></span>&nbsp;</div></li><li><div>          $breadcrumb-&gt;set_url(get_home_url());&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//If we have a multi site and are not on the main site we may need to add a breadcrumb for the main site</span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bmainsite_display'] && !is_main_site())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Get the site name</span></span></span></span>&nbsp;</div></li><li><div>          $site_name = get_site_option('site_name');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Place the main site breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb($site_name, $this-&gt;opt['Hmainsite_template'], array('main-home'), get_home_url($current_site-&gt;blog_id)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for the home page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_home()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $current_site;&nbsp;</div></li><li><div>      <span class="comment">//On everything else we need to link, but no current item (pre/suf)fixes</span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bhome_display'])&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Get the site name</span></span></span></span>&nbsp;</div></li><li><div>          $site_name = get_option('blogname');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb($site_name, $this-&gt;opt['Hhome_template'], array('home'), get_home_url()));&nbsp;</div></li><li><div>          <span class="comment">//If we have a multi site and are not on the main site we need to add a breadcrumb for the main site</span>&nbsp;</div></li><li><div>          if($this-&gt;opt['bmainsite_display'] && !is_main_site())&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Get the site name</span></span></span></span>&nbsp;</div></li><li><div>              $site_name = get_site_option('site_name');&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Place the main site breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span>&nbsp;</div></li><li><div>              $breadcrumb = $this-&gt;add(new bcn_breadcrumb($site_name, $this-&gt;opt['Hmainsite_template'], array('main-home'), get_home_url($current_site-&gt;blog_id)));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A modified version of WordPress' function of the same name</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param object $object the post or taxonomy object used to attempt to find the title</span>&nbsp;</div></li><li><div><span class="comment">   * @return string the title</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function post_type_archive_title($object)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if(isset($object-&gt;labels-&gt;name))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Core filter use here is ok for time being</span>&nbsp;</div></li><li><div>          <span class="comment">//TODO: Recheck validitiy prior to each release</span>&nbsp;</div></li><li><div>          return apply_filters('post_type_archive_title', $object-&gt;labels-&gt;name, $object-&gt;name);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determines if a post type is a built in type or not</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param string $post_type the name of the post type</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function is_builtin($post_type)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $type = get_post_type_object($post_type);&nbsp;</div></li><li><div>      <span class="comment">//If we get a null, that means either then type wasn't found, or we had 'any' as a type, treat as builtin</span>&nbsp;</div></li><li><div>      if($type === null)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          return $type-&gt;_builtin;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determines if the current location is a for a root page or not</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param string $post_type the name of the post type</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function treat_as_root_page($post_type)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return (is_home() || (is_post_type_archive() && !$this-&gt;opt['bpost_' . $post_type . '_archive_display']));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determines if a post type has archives enabled or not</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param string $post_type the name of the post type</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function has_archive($post_type)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $type = get_post_type_object($post_type); <span class="comment">//TODO need a check on this for WP_Error?</span>&nbsp;</div></li><li><div>      return $type-&gt;has_archive;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieves the query var for 'post_type', sets default to post, and escapes</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param string $default[optional] The default value to return if nothing was found/set or if post_type was an array</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @return string The post type string found in the post_type query var</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function get_type_string_query_var($default = 'post')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $type_str = get_query_var('post_type', $default);&nbsp;</div></li><li><div>      if($type_str === '' || is_array($type_str))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//If we didn't get a type, or it was an array, try the the first post</span>&nbsp;</div></li><li><div>          $post = get_post();&nbsp;</div></li><li><div>          if($post instanceof WP_Post)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $type_str = $post-&gt;post_type;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $type_str = $default;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return esc_attr($type_str);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieves the query var for 'post_type', and returns whether or not it is an array</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether or not the post_type query var is an array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function is_type_query_var_array()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return is_array(get_query_var('post_type'));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds the post type argument to the URL iff the passed in type is not post</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url The URL to possibly add the post_type argument to</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type[optional] The type to possibly add to the URL</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $taxonomy[optional] If we're dealing with a taxonomy term, the taxonomy of that term</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @return string The possibly modified URL</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function maybe_add_post_type_arg($url, $type = NULL, $taxonomy = NULL)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp_taxonomies;&nbsp;</div></li><li><div>      <span class="comment">//Rather than default to post, we should try to find the type</span>&nbsp;</div></li><li><div>      if($type == NULL)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $type = $this-&gt;get_type_string_query_var();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Add a query arg if we are not on the default post type for the archive in question and the post type is not post</span>&nbsp;</div></li><li><div>      $add_query_arg = (!($taxonomy && $type === $wp_taxonomies[$taxonomy]-&gt;object_type[0]) && $type !== 'post');&nbsp;</div></li><li><div>      <span class="comment">//Filter the add_query_arg logic, only add the query arg if necessary</span>&nbsp;</div></li><li><div>      if(apply_filters('bcn_add_post_type_arg', $add_query_arg, $type, $taxonomy))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $url = add_query_arg(array('post_type' =&gt; $type), $url);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $url;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * Deals with the post type archive and taxonomy archives</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post|WP_Taxonomy $type The post or taxonomy to generate the archive breadcrumb for</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function type_archive($type)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp_taxonomies;&nbsp;</div></li><li><div>      $type_str = false;&nbsp;</div></li><li><div>      if(!isset($type-&gt;taxonomy)) <span class="comment">//TODO could probably check the class type here</span>&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $type_str = $this-&gt;get_type_string_query_var();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//If this is a custom post type with a post type archive, add it</span>&nbsp;</div></li><li><div>      if($type_str && !$this-&gt;is_builtin($type_str) && $this-&gt;opt['bpost_' . $type_str . '_archive_display'] && $this-&gt;has_archive($type_str))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb($this-&gt;post_type_archive_title(get_post_type_object($type_str)), $this-&gt;opt['Hpost_' . $type_str . '_template'], array('post', 'post-' . $type_str . '-archive'), get_post_type_archive_link($type_str)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Otherwise, if this is a custom taxonomy with an archive, add it</span>&nbsp;</div></li><li><div>      else if(isset($type-&gt;taxonomy) && isset($wp_taxonomies[$type-&gt;taxonomy]-&gt;object_type[0]) &nbsp;</div></li><li><div>          && !$this-&gt;is_builtin($this-&gt;get_type_string_query_var($wp_taxonomies[$type-&gt;taxonomy]-&gt;object_type[0])) &nbsp;</div></li><li><div>          && $this-&gt;opt['bpost_' . $this-&gt;get_type_string_query_var($wp_taxonomies[$type-&gt;taxonomy]-&gt;object_type[0]) . '_archive_display'] &nbsp;</div></li><li><div>          && $this-&gt;has_archive($this-&gt;get_type_string_query_var($wp_taxonomies[$type-&gt;taxonomy]-&gt;object_type[0]))&nbsp;</div></li><li><div>          && !$this-&gt;is_type_query_var_array())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//We end up using the post type in several places, give it a variable</span>&nbsp;</div></li><li><div>          $post_type = apply_filters('bcn_type_archive_post_type', $this-&gt;get_type_string_query_var($wp_taxonomies[$type-&gt;taxonomy]-&gt;object_type[0]));&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, prefix, and suffix, get a pointer to it in return</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $breadcrumb = $this-&gt;add(new bcn_breadcrumb($this-&gt;post_type_archive_title(get_post_type_object($post_type)), $this-&gt;opt['Hpost_' . $post_type . '_template'], array('post', 'post-' . $post_type . '-archive'), get_post_type_archive_link($post_type)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function populates our type_str and root_id variables</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param post $type A post object we are using to figureout the type</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type_str The type string variable, passed by reference</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $root_id The ID for the post type root</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * TODO, can probably clean up all the logic here and use the code for the CPT archives for all paths</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function find_type($type, &$type_str, &$root_id)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp_taxonomies;&nbsp;</div></li><li><div>      <span class="comment">//We need to do special things for custom post types</span>&nbsp;</div></li><li><div>      if(is_singular() && !$this-&gt;is_builtin($type-&gt;post_type))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//We need the type for later, so save it</span></span></span></span>&nbsp;</div></li><li><div>          $type_str = $type-&gt;post_type;&nbsp;</div></li><li><div>          <span class="comment">//This will assign a ID for root page of a custom post</span>&nbsp;</div></li><li><div>          if(is_numeric($this-&gt;opt['apost_' . $type_str . '_root']))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $root_id = $this-&gt;opt['apost_' . $type_str . '_root'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//For CPT archives</span>&nbsp;</div></li><li><div>      else if(is_post_type_archive() && !isset($type-&gt;taxonomy))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//We need the type for later, so save it</span></span></span></span>&nbsp;</div></li><li><div>          $type_str = get_query_var('post_type');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//May be an array, if so, rewind the iterator and grab first item</span></span>&nbsp;</div></li><li><div>          if(is_array($type_str))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $type_str = reset($type_str);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//This will assign a ID for root page of a custom post</span>'s taxonomy archive&nbsp;</div></li><li><div>          if(is_numeric($this-&gt;opt['apost_' . $type_str . '_root']))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $root_id = $this-&gt;opt['apost_' . $type_str . '_root'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//We need to do special things for custom post type archives, but not author or date archives</span>&nbsp;</div></li><li><div>      else if(is_archive() && !is_author() && !is_date() && isset($type-&gt;taxonomy) && !$this-&gt;is_builtin($this-&gt;get_type_string_query_var($wp_taxonomies[$type-&gt;taxonomy]-&gt;object_type[0])))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//We need the type for later, so save it</span></span></span></span>&nbsp;</div></li><li><div>          $type_str = $this-&gt;get_type_string_query_var($wp_taxonomies[$type-&gt;taxonomy]-&gt;object_type[0]);&nbsp;</div></li><li><div>          <span class="comment">//This will assign a ID for root page of a custom post</span>'s taxonomy archive&nbsp;</div></li><li><div>          if(is_numeric($this-&gt;opt['apost_' . $type_str . '_root']))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $root_id = $this-&gt;opt['apost_' . $type_str . '_root'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else if(is_singular() && $type instanceof WP_Post && $type-&gt;post_type == 'page')&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $type_str = 'page';&nbsp;</div></li><li><div>          $root_id = get_option('page_on_front');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else if(($this-&gt;opt['bblog_display'] || is_home()) && !is_search())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $type_str = 'post';&nbsp;</div></li><li><div>          $root_id = get_option('page_for_posts');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function </span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Handles only the root page stuff for post types, including the &quot;page for posts&quot;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_root()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>      <span class="comment">//If this is an attachment then we need to change the queried object to the parent post</span>&nbsp;</div></li><li><div>      if(is_attachment())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Could use the $post global, but we can't really trust it</span>&nbsp;</div></li><li><div>          $post = get_post();&nbsp;</div></li><li><div>          $type = get_post($post-&gt;post_parent); <span class="comment">//TODO check for WP_Error?</span>&nbsp;</div></li><li><div>          <span class="comment">//If the parent of the attachment is a page, exit early (works around bug where is_single() returns true for an attachment to a page)</span>&nbsp;</div></li><li><div>          if($type-&gt;post_type == 'page')&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Simmilar to using $post, but for things $post doesn't cover</span></span>&nbsp;</div></li><li><div>          $type = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $root_id = -1;&nbsp;</div></li><li><div>      $type_str = '';&nbsp;</div></li><li><div>      <span class="comment">//Find our type string and root_id</span>&nbsp;</div></li><li><div>      $this-&gt;find_type($type, $type_str, $root_id);&nbsp;</div></li><li><div>      <span class="comment">//Continue only if we have a valid root_id</span>&nbsp;</div></li><li><div>      if($root_id &gt; 1)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $frontpage_id = get_option('page_on_front');&nbsp;</div></li><li><div>          <span class="comment">//We'll have to check if this ID is valid, e.g. user has specified a posts page</span>&nbsp;</div></li><li><div>          if($root_id && $root_id != $frontpage_id)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment">//Place the breadcrumb in the trail, uses the constructor to set the title, template, and type, we get a pointer to it in return</span>&nbsp;</div></li><li><div>              $breadcrumb = $this-&gt;add(new bcn_breadcrumb(get_the_title($root_id), $this-&gt;opt['Hpost_' . $type_str . '_template_no_anchor'], array($type_str . '-root', 'post', 'post-' . $type_str), NULL, $root_id));&nbsp;</div></li><li><div>              <span class="comment">//If we are at home, or any root page archive then we need to add the current item type</span>&nbsp;</div></li><li><div>              if($this-&gt;treat_as_root_page($type_str))&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $breadcrumb-&gt;add_type('current-item');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//If we're not on the current item we need to setup the anchor</span>&nbsp;</div></li><li><div>              if(!$this-&gt;treat_as_root_page($type_str)&nbsp;</div></li><li><div>                  || (is_paged() && $this-&gt;opt['bpaged_display'])&nbsp;</div></li><li><div>                  || ($this-&gt;treat_as_root_page($type_str) && $this-&gt;opt['bcurrent_item_linked']))&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $breadcrumb-&gt;set_template($this-&gt;opt['Hpost_' . $type_str . '_template']);&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Figure out the anchor for home page</span></span>&nbsp;</div></li><li><div>                  $breadcrumb-&gt;set_url(get_permalink($root_id));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//Done with the &quot;root&quot;, now on to the parents</span>&nbsp;</div></li><li><div>              <span class="comment">//Get the blog page</span>&nbsp;</div></li><li><div>              $bcn_post = get_post($root_id);&nbsp;</div></li><li><div>              <span class="comment">//If there is a parent post let's find it</span>&nbsp;</div></li><li><div>              if($bcn_post-&gt;post_parent && $bcn_post-&gt;ID != $bcn_post-&gt;post_parent && $frontpage_id != $bcn_post-&gt;post_parent)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $this-&gt;post_parents($bcn_post-&gt;post_parent, $frontpage_id);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for 404 pages.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_404()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the bcn_breadcrumb constructor to set the title, prefix, and suffix</span></span>&nbsp;</div></li><li><div>      $this-&gt;breadcrumbs[] = new bcn_breadcrumb($this-&gt;opt['S404_title'], $this-&gt;opt['H404_template'], array('404', 'current-item'));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * A Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills a breadcrumb for paged pages.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function do_paged()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Need to switch between paged and page for archives and singular (posts)</span>&nbsp;</div></li><li><div>      if(get_query_var('paged') &gt; 0)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Can use simple type hinting here to int since we already checked for greater than 0</span>&nbsp;</div></li><li><div>          $page_number = (int) get_query_var('paged');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $page_number = absint(get_query_var('page'));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Place the breadcrumb in the trail, uses the bcn_breadcrumb constructor to set the title, prefix, and suffix</span></span>&nbsp;</div></li><li><div>      $this-&gt;breadcrumbs[] = new bcn_breadcrumb($page_number, $this-&gt;opt['Hpaged_template'], array('paged'));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Breadcrumb Trail Filling Function</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * This functions fills the breadcrumb trail.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function fill()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $wpdb, $wp_query, $wp;&nbsp;</div></li><li><div>      <span class="comment">//Check to see if the trail is already populated</span>&nbsp;</div></li><li><div>      if(count($this-&gt;breadcrumbs) &gt; 0)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Exit early since we have breadcrumbs in the trail</span>&nbsp;</div></li><li><div>          return NULL;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Do any actions if necessary, we past through the current object instance to keep life simple</span></span>&nbsp;</div></li><li><div>      do_action('bcn_before_fill', $this);&nbsp;</div></li><li><div>      <span class="comment">//Do specific opperations for the various page types</span>&nbsp;</div></li><li><div>      <span class="comment">//Check if this isn't the first of a multi paged item</span>&nbsp;</div></li><li><div>      if($this-&gt;opt['bpaged_display'] && (is_paged() || is_singular() && get_query_var('page') &gt; 1))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $this-&gt;do_paged();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//For the front page, as it may also validate as a page, do it first</span>&nbsp;</div></li><li><div>      if(is_front_page())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Must have two seperate branches so that we don't evaluate it as a page</span>&nbsp;</div></li><li><div>          if($this-&gt;opt['bhome_display'])&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_front_page();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//For posts</span>&nbsp;</div></li><li><div>      else if(is_singular())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//For attachments</span>&nbsp;</div></li><li><div>          if(is_attachment())&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_attachment();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//For all other post types</span>&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_post(get_post());&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//For searches</span>&nbsp;</div></li><li><div>      else if(is_search())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $this-&gt;do_search();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//For author pages</span>&nbsp;</div></li><li><div>      else if(is_author())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $this-&gt;do_author();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//For archives</span>&nbsp;</div></li><li><div>      else if(is_archive())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $type = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//We need the type for later, so save it</span></span></span></span>&nbsp;</div></li><li><div>          $type_str = get_query_var('post_type');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//May be an array, if so, rewind the iterator and grab first item</span></span>&nbsp;</div></li><li><div>          if(is_array($type_str))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $type_str = reset($type_str);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//For date based archives</span>&nbsp;</div></li><li><div>          if(is_date())&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_archive_by_date($this-&gt;get_type_string_query_var());&nbsp;</div></li><li><div>              $this-&gt;type_archive($type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//If we have a post type archive, and it does not have a root page generate the archive</span>&nbsp;</div></li><li><div>          else if(is_post_type_archive() && !isset($type-&gt;taxonomy)&nbsp;</div></li><li><div>              && (!is_numeric($this-&gt;opt['apost_' . $type_str . '_root']) || $this-&gt;opt['bpost_' . $type_str . '_archive_display']))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_archive_by_post_type();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//For taxonomy based archives</span>&nbsp;</div></li><li><div>          else if(is_category() || is_tag() || is_tax())&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_archive_by_term();&nbsp;</div></li><li><div>              $this-&gt;type_archive($type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;type_archive($type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//For 404 pages</span>&nbsp;</div></li><li><div>      else if(is_404())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $this-&gt;do_404();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//If we are here, there may have been problems detecting the type</span>&nbsp;</div></li><li><div>          $type = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>          <span class="comment">//If it looks, walks, and quacks like a taxonomy, treat is as one</span>&nbsp;</div></li><li><div>          if(isset($type-&gt;taxonomy))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $this-&gt;do_archive_by_term();&nbsp;</div></li><li><div>              $this-&gt;type_archive($type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//We always do the home link last, unless on the frontpage</span>&nbsp;</div></li><li><div>      if(!is_front_page())&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $this-&gt;do_root();&nbsp;</div></li><li><div>          $this-&gt;do_home();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Do any actions if necessary, we past through the current object instance to keep life simple</span></span>&nbsp;</div></li><li><div>      do_action('bcn_after_fill', $this);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function will either set the order of the trail to reverse key </span>&nbsp;</div></li><li><div><span class="comment">   * order, or make sure it is forward key ordered.</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $reverse[optional] Whether to reverse the trail or not.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function order($reverse = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if($reverse)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//Since there may be multiple calls our trail may be in a non-standard order</span>&nbsp;</div></li><li><div>          ksort($this-&gt;breadcrumbs);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//For normal opperation we must reverse the array by key</span>&nbsp;</div></li><li><div>          krsort($this-&gt;breadcrumbs);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This functions outputs or returns the breadcrumb trail in string form.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void Void if Option to print out breadcrumb trail was chosen.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string String-Data of breadcrumb trail.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $return Whether to return data or to echo it.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $linked[optional] Whether to allow hyperlinks in the trail or not.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $reverse[optional] Whether to reverse the output or not.</span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * TODO: Fold display and display_list together, two functions are very simmilar </span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function display($return = false, $linked = true, $reverse = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Set trail order based on reverse flag</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;order($reverse);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Initilize the string which will hold the assembled trail</span></span>&nbsp;</div></li><li><div>      $trail_str = '';&nbsp;</div></li><li><div>      $position = 1;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//The main compiling loop</span></span>&nbsp;</div></li><li><div>      foreach($this-&gt;breadcrumbs as $key =&gt; $breadcrumb)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment">//We do different things for the separator based on the breadcrumb order</span>&nbsp;</div></li><li><div>          if($reverse)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment">//Add in the separator only if we are the 2nd or greater element</span>&nbsp;</div></li><li><div>              if($key &gt; 0)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $trail_str .= $this-&gt;opt['hseparator'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment">//Only show the separator when necessary</span>&nbsp;</div></li><li><div>              if($key &lt; count($this-&gt;breadcrumbs) - 1)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $trail_str .= $this-&gt;opt['hseparator'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Trim titles, if needed</span>&nbsp;</div></li><li><div>          if($this-&gt;opt['blimit_title'] && $this-&gt;opt['amax_title_length'] &gt; 0)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Trim the breadcrumb's title</span></span>&nbsp;</div></li><li><div>              $breadcrumb-&gt;title_trim($this-&gt;opt['amax_title_length']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Place in the breadcrumb's assembled elements</span>&nbsp;</div></li><li><div>          $trail_str .= $breadcrumb-&gt;assemble($linked, $position);&nbsp;</div></li><li><div>          $position++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Should we return or echo the assembled trail?</span></span></span>&nbsp;</div></li><li><div>      if($return)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          return $trail_str;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Helps track issues, please don't remove it</span></span>&nbsp;</div></li><li><div>          $credits = &quot;&lt;!-- Breadcrumb NavXT &quot; . $this::version . &quot; --&gt;\n&quot;;&nbsp;</div></li><li><div>          echo $credits . $trail_str;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This functions outputs or returns the breadcrumb trail in list form.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void Void if option to print out breadcrumb trail was chosen.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string String version of the breadcrumb trail.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $return Whether to return data or to echo it.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $linked[optional] Whether to allow hyperlinks in the trail or not.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $reverse[optional] Whether to reverse the output or not. </span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   * TODO: Can probably write this one in a smarter way now</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function display_list($return = false, $linked = true, $reverse = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Set trail order based on reverse flag</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;order($reverse);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Initilize the string which will hold the assembled trail</span></span>&nbsp;</div></li><li><div>      $trail_str = '';&nbsp;</div></li><li><div>      $position = 1;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//The main compiling loop</span></span>&nbsp;</div></li><li><div>      foreach($this-&gt;breadcrumbs as $key =&gt; $breadcrumb)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $li_class = '';&nbsp;</div></li><li><div>          <span class="comment">//On the first run we need to add in a class for the home breadcrumb</span>&nbsp;</div></li><li><div>          if($trail_str === '')&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $li_class .= ' class=&quot;home';&nbsp;</div></li><li><div>              if($key === 0)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $li_class .= ' current_item';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $li_class .= '&quot;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//If we are on the current item there are some things that must be done</span>&nbsp;</div></li><li><div>          else if($key === 0)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment">//Add in a class for current_item</span>&nbsp;</div></li><li><div>              $li_class .= ' class=&quot;current_item&quot;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Filter li_attributes adding attributes to the li element</span>&nbsp;</div></li><li><div>          $li_attribs = apply_filters('bcn_li_attributes', $li_class, $breadcrumb-&gt;get_types(), $breadcrumb-&gt;get_id());&nbsp;</div></li><li><div>          <span class="comment">//Trim titles, if requested</span>&nbsp;</div></li><li><div>          if($this-&gt;opt['blimit_title'] && $this-&gt;opt['amax_title_length'] &gt; 0)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Trim the breadcrumb's title</span></span>&nbsp;</div></li><li><div>              $breadcrumb-&gt;title_trim($this-&gt;opt['amax_title_length']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Assemble the breadrumb and wrap with li's</span>&nbsp;</div></li><li><div>          $trail_str .= sprintf(&quot;&lt;li%s&gt;%s&lt;/li&gt;\n&quot;, $li_attribs, $breadcrumb-&gt;assemble($linked, $position));&nbsp;</div></li><li><div>          $position++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Should we return or echo the assembled trail?</span></span></span>&nbsp;</div></li><li><div>      if($return)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          return $trail_str;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Helps track issues, please don't remove it</span></span>&nbsp;</div></li><li><div>          $credits = &quot;&lt;!-- Breadcrumb NavXT &quot; . $this::version . &quot; --&gt;\n&quot;;&nbsp;</div></li><li><div>          echo $credits . $trail_str;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This functions outputs or returns the breadcrumb trail in Schema.org BreadcrumbList compliant JSON-LD</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void Void if option to print out breadcrumb trail was chosen.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string String version of the breadcrumb trail.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $return Whether to return data or to echo it.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $reverse[optional] Whether to reverse the output or not. </span>&nbsp;</div></li><li><div><span class="comment">   * </span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function display_json_ld($return = false, $reverse = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Set trail order based on reverse flag</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;order($reverse);&nbsp;</div></li><li><div>      $trail_str =  json_encode(&nbsp;</div></li><li><div>          (object)array(&nbsp;</div></li><li><div>              '@context' =&gt; 'http:<span class="comment">//schema.org', </span>&nbsp;</div></li><li><div>              '@type' =&gt; 'BreadcrumbList', &nbsp;</div></li><li><div>              'itemListElement' =&gt; $this-&gt;json_ld_loop())&nbsp;</div></li><li><div> , JSON_UNESCAPED_SLASHES&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Should we return or echo the assembled trail?</span></span></span>&nbsp;</div></li><li><div>      if($return)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          return $trail_str;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          echo $trail_str;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function assembles all of the breadcrumbs into an object ready for json_encode</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array The array of breadcrumbs prepared for JSON-LD</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function json_ld_loop()&nbsp;</div></li><li><div>  {        &nbsp;</div></li><li><div>      $postion = 1;&nbsp;</div></li><li><div>      $breadcrumbs = array();&nbsp;</div></li><li><div>      <span class="comment">//Loop around our breadcrumbs, call the JSON-LD assembler</span>&nbsp;</div></li><li><div>      foreach($this-&gt;breadcrumbs as $breadcrumb)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $breadcrumbs[] = $breadcrumb-&gt;assemble_json_ld($postion);&nbsp;</div></li><li><div>          $postion++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $breadcrumbs;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Breadcrumb NavXT</li><li><span></span>5.7.0</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>