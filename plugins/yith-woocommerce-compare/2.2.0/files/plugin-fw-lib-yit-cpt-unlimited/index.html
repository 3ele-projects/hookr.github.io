<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.2.0" data-slug="yith-woocommerce-compare" data-type="file" data-id="66137"><head xmlns="http://www.w3.org/1999/xhtml"><title> plugin-fw-lib-yit-cpt-unlimited | file | Yith Woocommerce Compare | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, yith-woocommerce-compare, 2.2.0" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=0bd89542bd948f1f15927d7333943612' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/plugin-fw-lib-yit-cpt-unlimited/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fplugin-fw-lib-yit-cpt-unlimited%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fplugin-fw-lib-yit-cpt-unlimited%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-yith-woocommerce-compare-2.2.0-file-plugin-fw-lib-yit-cpt-unlimited","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="plugin-fw-lib-yit-cpt-unlimited" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to yith-woocommerce-compare." href="http://hookr.io/plugins/yith-woocommerce-compare/" class="plugin"><span property="name">yith-woocommerce-compare</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.2.0." href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/" class="H_VERSION"><span property="name">2.2.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">plugin-fw-lib-yit-cpt-unlimit&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="194"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/all/" title="All">All <span class="count badge">194</span></a></li><li class="" data-id="new" data-count="9"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/new/" title="New">New <span class="count badge">9</span></a></li><li class="" data-id="hooks" data-count="94"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/hooks/" title="Hooks">Hooks <span class="count badge">94</span></a></li><li class="" data-id="action" data-count="31"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/actions/" title="Actions">Actions <span class="count badge">31</span></a></li><li class="" data-id="filter" data-count="63"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/filters/" title="Filters">Filters <span class="count badge">63</span></a></li><li class="" data-id="class" data-count="20"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/classes/" title="Classes">Classes <span class="count badge">20</span></a></li><li class="" data-id="constant" data-count="13"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/constants/" title="Constants">Constants <span class="count badge">13</span></a></li><li class="" data-id="function" data-count="65"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/functions/" title="Functions">Functions <span class="count badge">65</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/yith-woocommerce-compare/2.2.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/plugin-fw/lib/yit-cpt-unlimited.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This file belongs to the YIT Framework.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This source file is subject to the GNU GENERAL PUBLIC LICENSE (GPL 3.0)</span>&nbsp;</div></li><li><div><span class="comment"> * that is bundled with this package in the file LICENSE.txt.</span>&nbsp;</div></li><li><div><span class="comment"> * It is also available through the world-wide-web at this URL:</span>&nbsp;</div></li><li><div><span class="comment"> * http://www.gnu.org/licenses/gpl-3.0.txt</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>if (!defined('ABSPATH')) {exit('Direct access forbidden.');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Manage the custom post types as Portfolio, Contact Forms and similar (called CPTU)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @class YIT_CPT_Unlimited</span>&nbsp;</div></li><li><div><span class="comment"> * @package    Yithemes</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @author Your Inspiration Themes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class YIT_CPT_Unlimited {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string The name of main post type of CPTU</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $_name = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string The prefix of each post type created by the post of main CPTU</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $_prefix_cpt = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string The labels defined for the main CPTU</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $_labels = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string The configuration arguments of post type</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $_args = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var array All post types created by the post of main CPTU</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $post_types = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var array $layouts Array with all portfolio layouts available for this site</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $layouts = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string $template_path The pathname of template folder</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $template_path = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string $template_url The URL of template folder</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $template_url = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var int $_index Unique sequential ID to differentiate same shortcodes in the same page</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $index = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string $_layout Temporary attribute to load automatically the settings for each layout</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $_layout = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructor</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Accept an array of arguments to define the characteristics of CPTU to register.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $defaults = array(&nbsp;</div></li><li><div>          'name' =&gt; '', &nbsp;</div></li><li><div>          'post_type_prefix' =&gt; '', &nbsp;</div></li><li><div>          'labels' =&gt; array(&nbsp;</div></li><li><div>              'main_name' =&gt; '', &nbsp;</div></li><li><div>              'singular' =&gt; '', &nbsp;</div></li><li><div>              'plural' =&gt; '', &nbsp;</div></li><li><div>              'menu' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'manage_layouts' =&gt; false, &nbsp;</div></li><li><div>          'add_multiuploader' =&gt; false, &nbsp;</div></li><li><div>          'sortable' =&gt; false, &nbsp;</div></li><li><div>          'has_single' =&gt; false, &nbsp;</div></li><li><div>          'has_taxonomy' =&gt; false, &nbsp;</div></li><li><div>          'label_item_sing' =&gt; '', &nbsp;</div></li><li><div>          'label_item_plur' =&gt; '', &nbsp;</div></li><li><div>          'shortcode_name' =&gt; '', &nbsp;</div></li><li><div>          'shortcode_icon' =&gt; '', <span class="comment">// URL or icon name from http://melchoyce.github.io/dashicons/</span>&nbsp;</div></li><li><div>          'layout_option' =&gt; '_type' <span class="comment">// the option ID of layout metabox</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $this-&gt;_args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// fix labels</span>&nbsp;</div></li><li><div>      if ( empty( $this-&gt;_args['labels']['main_name'] ) ) {&nbsp;</div></li><li><div>          $this-&gt;_args['labels']['main_name'] = $this-&gt;_args['labels']['singular'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( empty( $this-&gt;_args['labels']['menu'] ) ) {&nbsp;</div></li><li><div>          $this-&gt;_args['labels']['menu'] = $this-&gt;_args['labels']['singular'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** populate */</span>&nbsp;</div></li><li><div>      $this-&gt;_name = $this-&gt;_args['name'];&nbsp;</div></li><li><div>      $this-&gt;_prefix_cpt = $this-&gt;_args['post_type_prefix'];&nbsp;</div></li><li><div>      $this-&gt;_labels = $this-&gt;_args['labels'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'init', array( $this, 'register_post_type' ) );&nbsp;</div></li><li><div>      add_action( 'init', array( $this, 'register_cptu_post_types' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'save_post', array( $this, 'rewrite_flush') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// admin interface</span>&nbsp;</div></li><li><div>      add_action( 'admin_head', array( $this, 'add_cptu_menu_item' ) );&nbsp;</div></li><li><div>      add_action( 'admin_init', array( $this, 'add_quick_links_metaboxes' ) );&nbsp;</div></li><li><div>      add_action( 'admin_enqueue_scripts', array( $this, 'admin_assets' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// metaboxes</span>&nbsp;</div></li><li><div>      add_action( 'add_meta_boxes', array( $this, 'add_metabox_cptu' ), 2 );&nbsp;</div></li><li><div>      add_action( 'add_meta_boxes', array( $this, 'add_metabox_item_fields' ), 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// multiuploader</span>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['add_multiuploader'] ) {&nbsp;</div></li><li><div>          add_action( 'admin_footer', array( $this, 'add_button_multiuploader' ) );&nbsp;</div></li><li><div>          add_action( 'wp_ajax_yit_cptu_multiuploader', array( $this, 'post_multiuploader' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// layouts</span>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['manage_layouts'] ) {&nbsp;</div></li><li><div>          <span class="comment">// get all layouts available</span>&nbsp;</div></li><li><div>          $this-&gt;get_layouts();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// single layout</span>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['has_single'] ) {&nbsp;</div></li><li><div>          add_action( 'yit_loop', array( $this, 'single_template' ) );&nbsp;</div></li><li><div>          add_action( 'wp', array( $this, 'single_template_config' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( defined('DOING_AJAX') && DOING_AJAX ) {&nbsp;</div></li><li><div>              add_action( 'init', array( $this, 'single_template_config' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// archive template</span>&nbsp;</div></li><li><div>      add_action( 'wp', array( $this, 'archive_template' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// enqueue the assets of each layout</span>&nbsp;</div></li><li><div>      add_action( 'wp_enqueue_scripts', array( $this, 'frontend_assets' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add the shortcode, used to show the frontend</span>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;_args['shortcode_name'] ) ) {&nbsp;</div></li><li><div>          add_shortcode( $this-&gt;_args['shortcode_name'], array( &$this, 'add_shortcode' ) );&nbsp;</div></li><li><div>          add_filter( 'yit_shortcode_' . $this-&gt;_args['shortcode_name'] . '_icon', array( $this, 'shortcode_icon') );&nbsp;</div></li><li><div>          add_filter( 'yit-shortcode-plugin-init', array( $this, 'add_shortcode_to_box' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add sortable feature</span>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['sortable'] ) {&nbsp;</div></li><li><div>          add_action( 'admin_enqueue_scripts', array( $this, 'admin_sortable_assets' ) );&nbsp;</div></li><li><div>          add_action( 'wp_ajax_cpt_sort_posts', array( $this, 'sort_posts' ) );&nbsp;</div></li><li><div>          add_action( 'admin_init', array( $this, 'init_menu_order' ) );&nbsp;</div></li><li><div>          add_filter( 'pre_get_posts', array( $this, 'filter_active' ) );&nbsp;</div></li><li><div>          add_filter( 'pre_get_posts', array( $this, 'pre_get_posts' ) );&nbsp;</div></li><li><div>          add_filter( 'get_next_post_where', array( $this, 'sorted_next_post_where' ) );&nbsp;</div></li><li><div>          add_filter( 'get_previous_post_where', array( $this, 'sorted_prev_post_where' ) );&nbsp;</div></li><li><div>          add_filter( 'get_next_post_sort', array( $this, 'sorted_next_post_sort' ) );&nbsp;</div></li><li><div>          add_filter( 'get_previous_post_sort', array( $this, 'sorted_prev_post_sort' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add default columns to post type table list</span>&nbsp;</div></li><li><div>      add_filter( 'manage_edit-' . $this-&gt;_name . '_columns', array( $this, 'cptu_define_columns' ) );&nbsp;</div></li><li><div>      add_action( 'manage_' . $this-&gt;_name . '_posts_custom_column' , array( $this, 'cptu_change_columns' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add required post type for wordpress importer</span>&nbsp;</div></li><li><div>      add_filter( 'wp_import_post_data_raw', array( $this, 'add_importer_required_post_type' ) );&nbsp;</div></li><li><div>      add_filter( 'wp_import_terms', array( $this, 'add_importer_required_taxonomy' ) );&nbsp;</div></li><li><div>      add_action( 'wp_import_set_post_terms', array( $this, 'recount_terms_post' ), 10, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue the assets for the sortable feature</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function admin_sortable_assets() {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $post-&gt;post_type ) || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_enqueue_script( 'yit-cptu-sortable-posts', YIT_CORE_PLUGIN_URL . '/assets/js/yit-cptu-sortable-posts.js', array( 'jquery', 'jquery-ui-sortable' ), '1.0', true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function init_menu_order( $post_types = array() ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $post_types ) ) {&nbsp;</div></li><li><div>          $post_types = $wpdb-&gt;get_col( $wpdb-&gt;prepare( &quot;SELECT DISTINCT post_type FROM $wpdb-&gt;posts WHERE post_type LIKE %s&quot;, str_replace( '_', '\_', $this-&gt;_prefix_cpt ) . '%' ) );&nbsp;</div></li><li><div>      } elseif ( ! is_array( $post_types ) ) {&nbsp;</div></li><li><div>          $post_types = array( $post_types );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $post_types as $post_type ) {&nbsp;</div></li><li><div>          $count = $wpdb-&gt;get_var( &quot;SELECT COUNT(*) FROM $wpdb-&gt;posts WHERE post_type = '{$post_type}' AND post_status IN ('publish', 'pending', 'draft', 'private', 'future') AND menu_order = 0&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $count ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $sql = &quot;SELECT ID&nbsp;</div></li><li><div>                  FROM $wpdb-&gt;posts&nbsp;</div></li><li><div>                  WHERE post_type = '&quot; . $post_type . &quot;'&nbsp;</div></li><li><div>                  AND post_status IN ('publish', 'pending', 'draft', 'private', 'future')&nbsp;</div></li><li><div>                  ORDER BY post_date DESC&nbsp;</div></li><li><div>                  &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $results = $wpdb-&gt;get_results( $sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $results as $key =&gt; $result ) {&nbsp;</div></li><li><div>              $wpdb-&gt;update( $wpdb-&gt;posts, array( 'menu_order' =&gt; $key + 1 ), array( 'ID' =&gt; $result-&gt;ID ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Save the order of posts from sortable feature</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function sort_posts() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      parse_str( $_REQUEST['order'], $data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $data ) ) {&nbsp;</div></li><li><div>          <span class="comment">//$this-&gt;init_menu_order( $_REQUEST['post_type'] );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $id_arr = array( );&nbsp;</div></li><li><div>          foreach ( $data as $key =&gt; $values ) {&nbsp;</div></li><li><div>              foreach ( $values as $position =&gt; $id ) {&nbsp;</div></li><li><div>                  $id_arr[] = $id;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $menu_order_arr = array( );&nbsp;</div></li><li><div>          foreach ( $id_arr as $key =&gt; $id ) {&nbsp;</div></li><li><div>              $results = $wpdb-&gt;get_results( &quot;SELECT menu_order FROM $wpdb-&gt;posts WHERE ID = &quot; . $id );&nbsp;</div></li><li><div>              foreach ( $results as $result ) {&nbsp;</div></li><li><div>                  $menu_order_arr[] = $result-&gt;menu_order;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          sort( $menu_order_arr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $data as $key =&gt; $values ) {&nbsp;</div></li><li><div>              foreach ( $values as $position =&gt; $id ) {&nbsp;</div></li><li><div>                  $wpdb-&gt;update( $wpdb-&gt;posts, array( 'menu_order' =&gt; $menu_order_arr[$position] ), array( 'ID' =&gt; $id ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      die();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function filter_active( $wp_query ) {&nbsp;</div></li><li><div>      if ( is_admin() && isset( $wp_query-&gt;query['suppress_filters'] ) )&nbsp;</div></li><li><div>          $wp_query-&gt;query['suppress_filters'] = false;&nbsp;</div></li><li><div>      if ( is_admin() && isset( $wp_query-&gt;query_vars['suppress_filters'] ) )&nbsp;</div></li><li><div>          $wp_query-&gt;query_vars['suppress_filters'] = false;&nbsp;</div></li><li><div>      return $wp_query;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function pre_get_posts( $wp_query ) {&nbsp;</div></li><li><div>      if ( is_admin() && !defined( 'DOING_AJAX' ) ) {&nbsp;</div></li><li><div>          if ( isset( $wp_query-&gt;query['post_type'] ) ) {&nbsp;</div></li><li><div>              $post_types = (array) $wp_query-&gt;query['post_type'];&nbsp;</div></li><li><div>              foreach ( $post_types as $post_type ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;_is_valid( $post_type ) ) {&nbsp;</div></li><li><div>                      $wp_query-&gt;set( 'orderby', 'menu_order' );&nbsp;</div></li><li><div>                      $wp_query-&gt;set( 'order', 'ASC' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $active = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $wp_query-&gt;query['suppress_filters'] ) || isset( $wp_query-&gt;query['post_type'] ) ) {&nbsp;</div></li><li><div>              $post_types = (array) $wp_query-&gt;query['post_type'];&nbsp;</div></li><li><div>              foreach ( $post_types as $post_type ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;_is_valid( $post_type ) ) {&nbsp;</div></li><li><div>                      $active = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $active ) {&nbsp;</div></li><li><div>              if ( !isset( $wp_query-&gt;query['orderby'] ) || $wp_query-&gt;query['orderby'] == 'post_date' )&nbsp;</div></li><li><div>                  $wp_query-&gt;set( 'orderby', 'menu_order' );&nbsp;</div></li><li><div>              if ( !isset( $wp_query-&gt;query['order'] ) || $wp_query-&gt;query['order'] == 'DESC' )&nbsp;</div></li><li><div>                  $wp_query-&gt;set( 'order', 'ASC' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters where clause for get next post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $where</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonio La Rocca &lt;antonio.larocca@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function sorted_next_post_where( $where ) {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>      if( defined('DOING_AJAX') && DOING_AJAX && isset( $_REQUEST['post_id'] ) ) {&nbsp;</div></li><li><div>          $post = get_post( intval( $_REQUEST['post_id'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else{&nbsp;</div></li><li><div>          $post = get_post();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! $post || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          return $where;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $result = str_replace( &quot;'&quot; . $post-&gt;post_date . &quot;'&quot;, $post-&gt;menu_order, $where );&nbsp;</div></li><li><div>      $result = str_replace( 'p.post_date', 'p.menu_order', $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters where clause for get prev post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $where</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonio La Rocca &lt;antonio.larocca@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function sorted_prev_post_where( $where ) {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( defined('DOING_AJAX') && DOING_AJAX && isset( $_REQUEST['post_id'] ) ) {&nbsp;</div></li><li><div>          $post = get_post( intval( $_REQUEST['post_id'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else{&nbsp;</div></li><li><div>          $post = get_post();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! $post || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          return $where;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $result = str_replace( &quot;'&quot; . $post-&gt;post_date . &quot;'&quot;, $post-&gt;menu_order, $where );&nbsp;</div></li><li><div>      $result = str_replace( 'p.post_date', 'p.menu_order', $result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters sort clause for get next post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $sort</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @since    1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author   Antonio La Rocca &lt;antonio.larocca@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function sorted_next_post_sort( $sort ) {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( defined('DOING_AJAX') && DOING_AJAX && isset( $_REQUEST['post_id'] ) ) {&nbsp;</div></li><li><div>          $post = get_post( intval( $_REQUEST['post_id'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else{&nbsp;</div></li><li><div>          $post = get_post();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! $post || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          return $sort;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $result = str_replace( 'p.post_date', 'p.menu_order', $sort );&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters sort clause for get prev post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $sort</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @since    1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author   Antonio La Rocca &lt;antonio.larocca@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function sorted_prev_post_sort( $sort ) {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( defined('DOING_AJAX') && DOING_AJAX && isset( $_REQUEST['post_id'] ) ) {&nbsp;</div></li><li><div>          $post = get_post( intval( $_REQUEST['post_id'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else{&nbsp;</div></li><li><div>          $post = get_post();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! $post || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          return $sort;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $result = str_replace( 'p.post_date', 'p.menu_order', $sort );&nbsp;</div></li><li><div>      return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Register post type</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Register the post type for the creation of portfolios</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function register_post_type() {&nbsp;</div></li><li><div>      $labels = array(&nbsp;</div></li><li><div>          'name' =&gt; ucfirst( $this-&gt;_labels['main_name'] ), &nbsp;</div></li><li><div>          'singular_name' =&gt; ucfirst( $this-&gt;_labels['singular'] ), &nbsp;</div></li><li><div>          'add_new' =&gt; sprintf( __( 'Add %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['singular'] ) ), &nbsp;</div></li><li><div>          'add_new_item' =&gt; sprintf( __( 'Add New %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['singular'] ) ), &nbsp;</div></li><li><div>          'edit_item' =&gt; sprintf( __( 'Edit %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['singular'] ) ), &nbsp;</div></li><li><div>          'new_item' =&gt; sprintf( __( 'New %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['singular'] ) ), &nbsp;</div></li><li><div>          'all_items' =&gt; sprintf( __( 'All %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['plural'] ) ), &nbsp;</div></li><li><div>          'view_item' =&gt; sprintf( __( 'View %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['singular'] ) ), &nbsp;</div></li><li><div>          'search_items' =&gt; sprintf( __( 'Search %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['plural'] ) ), &nbsp;</div></li><li><div>          'not_found' =&gt; sprintf( __( 'No %s found', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['plural'] ) ), &nbsp;</div></li><li><div>          'not_found_in_trash' =&gt; sprintf( __( 'No %s found in Trash', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['plural'] ) ), &nbsp;</div></li><li><div>          'parent_item_colon' =&gt; '', &nbsp;</div></li><li><div>          'menu_name' =&gt; ucfirst( $this-&gt;_labels['menu'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          'labels' =&gt; apply_filters( 'yit_' . $this-&gt;_name . '_labels', $labels ), &nbsp;</div></li><li><div>          'public' =&gt; false, &nbsp;</div></li><li><div>          'publicly_queryable' =&gt; false, &nbsp;</div></li><li><div>          'show_ui' =&gt; true, &nbsp;</div></li><li><div>          'show_in_menu' =&gt; true, &nbsp;</div></li><li><div>          'query_var' =&gt; false, &nbsp;</div></li><li><div>          'capability_type' =&gt; 'post', &nbsp;</div></li><li><div>          'hierarchical' =&gt; false, &nbsp;</div></li><li><div>          'menu_position' =&gt; null, &nbsp;</div></li><li><div>          'supports' =&gt; array( 'title' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;_args['menu_icon'] ) ) {&nbsp;</div></li><li><div>          $args['menu_icon'] = $this-&gt;_args['menu_icon'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      register_post_type( $this-&gt;_name, apply_filters( 'yit_' . $this-&gt;_name . '_args', $args ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the values configured inside the custom post type</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $post /WP_Query The post where get the arguments configured in the cpt</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function _cpt_args( $post ) {&nbsp;</div></li><li><div>      if ( ! isset( $post-&gt;ID ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = apply_filters( 'yit_cptu_register_post_type_args', array(&nbsp;</div></li><li><div>          'layout' =&gt; get_post_meta( $post-&gt;ID, $this-&gt;_args['layout_option'], true ), &nbsp;</div></li><li><div>          'rewrite' =&gt; get_post_meta( $post-&gt;ID, '_rewrite', true ), &nbsp;</div></li><li><div>          'label_singular' =&gt; ! empty( $this-&gt;_args['label_item_sing'] ) ? $this-&gt;_args['label_item_sing'] : get_post_meta( $post-&gt;ID, '_label_singular', true ), &nbsp;</div></li><li><div>          'label_plural' =&gt; ! empty( $this-&gt;_args['label_item_plur'] ) ? $this-&gt;_args['label_item_plur'] : get_post_meta( $post-&gt;ID, '_label_plural', true ), &nbsp;</div></li><li><div>          'taxonomy' =&gt; get_post_meta( $post-&gt;ID, '_taxonomy', true ), &nbsp;</div></li><li><div>          'taxonomy_rewrite' =&gt; get_post_meta( $post-&gt;ID, '_taxonomy_rewrite', true ), &nbsp;</div></li><li><div> ), $this-&gt;_name, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $title = $post-&gt;post_title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $args['label_singular'] ) ) {&nbsp;</div></li><li><div>          $args['label_singular'] = $title;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $args['label_plural'] ) ) {&nbsp;</div></li><li><div>          $args['label_plural'] = $title;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $args;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the post types created for this CPTU</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array The link changed</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_post_types() {&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;post_types ) ) {&nbsp;</div></li><li><div>          return $this-&gt;post_types;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          'post_type' =&gt; $this-&gt;_name, &nbsp;</div></li><li><div>          'posts_per_page' =&gt; -1, &nbsp;</div></li><li><div>          'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $this-&gt;post_types = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;post_types;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Register portfolio post types</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Register the post types for each portfolio created by admin</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function register_cptu_post_types() {&nbsp;</div></li><li><div>      $post_types = $this-&gt;get_post_types();&nbsp;</div></li><li><div>      $pts = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $post_types as $pt ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          extract( $this-&gt;_cpt_args( $pt ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $name = $pt-&gt;post_name;&nbsp;</div></li><li><div>          $title = $pt-&gt;post_title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $labels = array(&nbsp;</div></li><li><div>              'name' =&gt; $title, &nbsp;</div></li><li><div>              'singular_name' =&gt; $label_singular, &nbsp;</div></li><li><div>              'add_new' =&gt; sprintf( __( 'Add %s', 'yith-plugin-fw' ), $label_singular ), &nbsp;</div></li><li><div>              'add_new_item' =&gt; sprintf( __( 'Add New %s', 'yith-plugin-fw' ), $label_singular ), &nbsp;</div></li><li><div>              'edit_item' =&gt; sprintf( __( 'Edit %s', 'yith-plugin-fw' ), $label_singular ), &nbsp;</div></li><li><div>              'new_item' =&gt; sprintf( __( 'New %s', 'yith-plugin-fw' ), $label_singular ), &nbsp;</div></li><li><div>              'all_items' =&gt; sprintf( __( 'All %s', 'yith-plugin-fw' ), $label_plural ), &nbsp;</div></li><li><div>              'view_item' =&gt; sprintf( __( 'View %s', 'yith-plugin-fw' ), $label_singular ), &nbsp;</div></li><li><div>              'search_items' =&gt; sprintf( __( 'Search %s', 'yith-plugin-fw' ), $label_plural ), &nbsp;</div></li><li><div>              'not_found' =&gt; sprintf( __( 'No %s found', 'yith-plugin-fw' ), $label_plural ), &nbsp;</div></li><li><div>              'not_found_in_trash' =&gt; sprintf( __( 'No %s found in Trash', 'yith-plugin-fw' ), $label_plural ), &nbsp;</div></li><li><div>              'parent_item_colon' =&gt; '', &nbsp;</div></li><li><div>              'menu_name' =&gt; $title&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $args = array(&nbsp;</div></li><li><div>              'labels' =&gt; apply_filters( 'yit_' . $this-&gt;_prefix_cpt . $name . '_labels', $labels ), &nbsp;</div></li><li><div>              'public' =&gt; true, &nbsp;</div></li><li><div>              'publicly_queryable' =&gt; true, &nbsp;</div></li><li><div>              'show_ui' =&gt; true, &nbsp;</div></li><li><div>              'show_in_menu' =&gt; false, &nbsp;</div></li><li><div>              'query_var' =&gt; true, &nbsp;</div></li><li><div>              'capability_type' =&gt; 'post', &nbsp;</div></li><li><div>              'hierarchical' =&gt; false, &nbsp;</div></li><li><div>              'menu_position' =&gt; null, &nbsp;</div></li><li><div>              'supports' =&gt; array( 'title', 'editor', 'thumbnail' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $this-&gt;_args['has_single'] ) {&nbsp;</div></li><li><div>              $args['public'] = false;&nbsp;</div></li><li><div>              $args['publicly_queryable'] = false;&nbsp;</div></li><li><div>              $args['query_var'] = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;_args['manage_layouts'] && isset($this-&gt;layouts[ $layout ]) && ! $this-&gt;layouts[ $layout ]['support']['description'] ) {&nbsp;</div></li><li><div>              unset( $args['supports'][1] );  <span class="comment">// remove 'editor'</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $rewrite ) ) {&nbsp;</div></li><li><div>              $args['rewrite'] = array( 'slug' =&gt; $rewrite );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// register post type</span>&nbsp;</div></li><li><div>          $post_type = yit_avoid_duplicate( str_replace( '-', '_', substr( $this-&gt;_prefix_cpt . $name, 0, 16) ), $post_types );&nbsp;</div></li><li><div>          register_post_type( $post_type, apply_filters( 'yit_' . $this-&gt;_prefix_cpt . $name . '_args', $args, $pt ) );  <span class="comment">// save the post type in post meta</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          update_post_meta( $pt-&gt;ID, '_post_type', $post_type );&nbsp;</div></li><li><div>          $pts[] = $post_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// register taxonomy</span>&nbsp;</div></li><li><div>          if ( $this-&gt;_args['has_taxonomy'] && ! empty( $taxonomy ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $labels = array(&nbsp;</div></li><li><div>                  'name' =&gt; sprintf( _x( '%s Categories', 'taxonomy general name', 'yith-plugin-fw' ), $label_singular ), &nbsp;</div></li><li><div>                  'singular_name' =&gt; _x( 'Category', 'taxonomy singular name', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'search_items' =&gt; __( 'Search Categories', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'all_items' =&gt; __( 'All Categories', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'parent_item' =&gt; __( 'Parent Category', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'parent_item_colon' =&gt; __( 'Parent Category:', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'edit_item' =&gt; __( 'Edit Category', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'update_item' =&gt; __( 'Update Category', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'add_new_item' =&gt; __( 'Add New Category', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'new_item_name' =&gt; __( 'New Category Name', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'menu_name' =&gt; __( 'Category', 'yith-plugin-fw' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $args = array(&nbsp;</div></li><li><div>                  'hierarchical' =&gt; true, &nbsp;</div></li><li><div>                  'labels' =&gt; $labels, &nbsp;</div></li><li><div>                  'show_ui' =&gt; true, &nbsp;</div></li><li><div>                  'show_admin_column' =&gt; true, &nbsp;</div></li><li><div>                  'query_var' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $taxonomy_rewrite ) ) {&nbsp;</div></li><li><div>                  $args['rewrite'] = array( 'slug' =&gt; $taxonomy_rewrite );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              register_taxonomy( substr( $taxonomy, 0, 32 ), $post_type, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_cache_set( 'yit_cptu_post_types', $post_types );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Flush Rewrite Rules</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * rewrite rules when a cpt unlimited is saved</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Emanuela Castorina &lt;emanuela.castorina@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function rewrite_flush( $post ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $post ) && $this-&gt;_is_valid( get_post_type( intval( $post ) ) ) ) {&nbsp;</div></li><li><div>          flush_rewrite_rules();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add the item for each portfolio under &quot;Portfolios&quot;</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_cptu_menu_item() {&nbsp;</div></li><li><div>      global $submenu, $post, $parent_file, $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// get current post type</span>&nbsp;</div></li><li><div>      if ( isset( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          $post_type = $post-&gt;post_type;&nbsp;</div></li><li><div>      } else if ( isset( $_REQUEST['post_type'] ) ) {&nbsp;</div></li><li><div>          $post_type = $_REQUEST['post_type'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $item = 'edit.php?post_type=' . $this-&gt;_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add new items</span>&nbsp;</div></li><li><div>      if ( strpos( $post_type, $this-&gt;_prefix_cpt ) !== false ) {&nbsp;</div></li><li><div>          global $wpdb;&nbsp;</div></li><li><div>          $portfolio = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT p.* FROM $wpdb-&gt;postmeta AS pm INNER JOIN $wpdb-&gt;posts AS p ON p.ID = pm.post_id WHERE pm.meta_key = %s AND pm.meta_value = %s AND p.post_type = %s&quot;, '_post_type', $post_type, $this-&gt;_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $portfolio-&gt;ID ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $label_singular = ! empty( $this-&gt;_args['label_item_sing'] ) ? $this-&gt;_args['label_item_sing'] : get_post_meta( $portfolio-&gt;ID, '_label_singular', true );&nbsp;</div></li><li><div>          $label_plural = ! empty( $this-&gt;_args['label_item_plur'] ) ? $this-&gt;_args['label_item_plur'] : get_post_meta( $portfolio-&gt;ID, '_label_plural', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $label_plural ) ) {&nbsp;</div></li><li><div>              $label_plural = $portfolio-&gt;post_title;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $label_singular ) ) {&nbsp;</div></li><li><div>              $label_singular = $portfolio-&gt;post_title;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $submenu[ $item ][15] = array( ucfirst( $label_plural ), 'edit_posts', 'edit.php?post_type=' . $post_type );&nbsp;</div></li><li><div>          $submenu[ $item ][20] = array( sprintf( __('Add %s', 'yith-plugin-fw'), ucfirst( $label_singular ) ), 'edit_posts', 'post-new.php?post_type=' . $post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          global $wp_taxonomies;&nbsp;</div></li><li><div>          $taxonomy = get_post_meta( $portfolio-&gt;ID, '_taxonomy', true );&nbsp;</div></li><li><div>          if ( isset( $wp_taxonomies[ $taxonomy ] ) ) {&nbsp;</div></li><li><div>              $submenu[ $item ][25] = array( __('Categories', 'yith-plugin-fw'), 'edit_posts', 'edit-tags.php?taxonomy=' . $taxonomy . '&post_type=' . $post_type );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// set the parent item inside the single of each post type</span>&nbsp;</div></li><li><div>      if ( $pagenow == 'post.php' && isset( $_GET['post'] ) && $this-&gt;_is_valid( get_post_type( intval( $_GET['post'] ) ) ) ) {&nbsp;</div></li><li><div>          $parent_file = 'edit.php?post_type=' . $this-&gt;_name;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Locate folder of CPTU templates, if there isn't a layouts management</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function template_path() {&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;template_path ) ) {&nbsp;</div></li><li><div>          return $this-&gt;template_path;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// paths</span></span>&nbsp;</div></li><li><div>      $stylesheet_path_1 = get_stylesheet_directory() . '/theme/templates/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $stylesheet_path_2 = get_template_directory()   . '/theme/templates/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $template_path_1 = get_stylesheet_directory() . '/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $template_path_2 = get_template_directory()   . '/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $plugin_path = $this-&gt;_args['plugin_path'] . '/templates/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( array( 'stylesheet_path_1', 'stylesheet_path_2', 'template_path_1', 'template_path_2', 'plugin_path' ) as $var ) {&nbsp;</div></li><li><div>          $path = ${$var};&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( file_exists( $path ) ) {&nbsp;</div></li><li><div>              $this-&gt;template_path = $path;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;template_path;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Locate folder of CPTU templates, if there isn't a layouts management</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function template_url() {&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;template_url ) ) {&nbsp;</div></li><li><div>          return $this-&gt;template_path;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;template_url = str_replace( array(&nbsp;</div></li><li><div>          get_stylesheet_directory(), &nbsp;</div></li><li><div>          get_template_directory(), &nbsp;</div></li><li><div>          $this-&gt;_args['plugin_path']&nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>          get_stylesheet_directory_uri(), &nbsp;</div></li><li><div>          get_template_directory_uri(), &nbsp;</div></li><li><div>          $this-&gt;_args['plugin_url']&nbsp;</div></li><li><div> ), $this-&gt;template_path() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;template_url;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve all layouts to manage by custom post type added in the site in this order:</span>&nbsp;</div></li><li><div><span class="comment">   * 1. Child theme (if exists)</span>&nbsp;</div></li><li><div><span class="comment">   * 2. Theme</span>&nbsp;</div></li><li><div><span class="comment">   * 3. Plugin</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * It also load the config.php file of each layout</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_layouts() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// paths</span></span>&nbsp;</div></li><li><div>      $stylesheet_path_1 = get_stylesheet_directory() . '/theme/templates/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $stylesheet_path_2 = get_template_directory()   . '/theme/templates/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $template_path_1 = get_stylesheet_directory() . '/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $template_path_2 = get_template_directory()   . '/' . $this-&gt;_name . '/';&nbsp;</div></li><li><div>      $plugin_path = $this-&gt;_args['plugin_path'] . '/templates/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( array( 'stylesheet_path_1', 'stylesheet_path_2', 'template_path_1', 'template_path_2', 'plugin_path' ) as $var ) {&nbsp;</div></li><li><div>          $path = ${$var};&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( file_exists( $path ) ) {&nbsp;</div></li><li><div>              foreach ( scandir( $path ) as $scan ) {&nbsp;</div></li><li><div>                  if ( ! isset( $this-&gt;layouts[$scan] ) && is_dir( $path . $scan ) && ! in_array( $scan, array( '.', '..', '.svn' ) ) && $scan[0] != '_' ) {&nbsp;</div></li><li><div>                      $this-&gt;layouts[$scan] = array(&nbsp;</div></li><li><div>                          'name' =&gt; ucfirst( str_replace( '-', ' ', $scan ) ), &nbsp;</div></li><li><div>                          'path' =&gt; $path . $scan, &nbsp;</div></li><li><div>                          'url' =&gt; str_replace( array(&nbsp;</div></li><li><div>                              get_stylesheet_directory(), &nbsp;</div></li><li><div>                              get_template_directory(), &nbsp;</div></li><li><div>                              $this-&gt;_args['plugin_path']&nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>                              get_stylesheet_directory_uri(), &nbsp;</div></li><li><div>                              get_template_directory_uri(), &nbsp;</div></li><li><div>                              $this-&gt;_args['plugin_url']&nbsp;</div></li><li><div> ), $path . $scan ), &nbsp;</div></li><li><div>                          'css' =&gt; array(), &nbsp;</div></li><li><div>                          'js' =&gt; array(), &nbsp;</div></li><li><div>                          'support' =&gt; array(&nbsp;</div></li><li><div>                              'description' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                          'columns' =&gt; array()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// set the vars for config.php</span>&nbsp;</div></li><li><div>                      $layout = $scan;&nbsp;</div></li><li><div>                      $this-&gt;_layout = $layout;   <span class="comment">// temporary attribute to load automatically the configuration inside the config.php, for this layout</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// TODO Fare in modo di caricare il file config.php soltanto quando realmente serve</span>&nbsp;</div></li><li><div>                      if ( ! in_array( $scan, array( 'single' ) ) && file_exists( $path . $scan . '/config.php' ) ) {&nbsp;</div></li><li><div>                          include_once( $path . $scan . '/config.php' );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Say if you want to set description for the current layout or not. This method must be used only inside the</span>&nbsp;</div></li><li><div><span class="comment">   * config.php file of layout</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $v string 'yes' or 'no'</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_description_field( $v ) {&nbsp;</div></li><li><div>      $this-&gt;layouts[ $this-&gt;_layout ]['support']['description'] = $v == 'yes' ? true : false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add the extra fields for the specific layout type of portfolio</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $fields The fields to add</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_layout_fields( $fields = array() ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// change the ID</span></span>&nbsp;</div></li><li><div>      foreach ( $fields as $id =&gt; $val ) {&nbsp;</div></li><li><div>          unset( $fields[ $id ] );&nbsp;</div></li><li><div>          $id = $this-&gt;_layout . '_' . $id;&nbsp;</div></li><li><div>          $fields[ $id ] = $val;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;layouts[ $this-&gt;_layout ]['fields'] = $fields;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add fields to add to the metabox of each item of each post type created</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $fields The fields to add</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_item_fields( $fields = array() ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// change the ID</span></span>&nbsp;</div></li><li><div>      foreach ( $fields as $id =&gt; $val ) {&nbsp;</div></li><li><div>          unset( $fields[ $id ] );&nbsp;</div></li><li><div>          <span class="comment">//$id = $this-&gt;_layout . '_' . $id;</span>&nbsp;</div></li><li><div>          $fields[ $id ] = $val;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;layouts[ $this-&gt;_layout ]['item_fields'] = $fields;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add columns to the table list</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $columns The columns to add in the table list</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_table_columns( $columns ) {&nbsp;</div></li><li><div>      $this-&gt;layouts[ $this-&gt;_layout ]['columns'] = $columns;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue the css files of layout</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $handle Name of the stylesheet.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $src    Path to the stylesheet from the root directory of WordPress. Example: '/css/mystyle.css'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array       $deps   An array of registered style handles this stylesheet depends on. Default empty array.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $ver    String specifying the stylesheet version number, if it has one. This parameter is used</span>&nbsp;</div></li><li><div><span class="comment">   *                            to ensure that the correct version is sent to the client regardless of caching, and so</span>&nbsp;</div></li><li><div><span class="comment">   *                            should be included if a version number is available and makes sense for the stylesheet.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $media  Optional. The media for which this stylesheet has been defined.</span>&nbsp;</div></li><li><div><span class="comment">   *                            Default 'all'. Accepts 'all', 'aural', 'braille', 'handheld', 'projection', 'print', </span>&nbsp;</div></li><li><div><span class="comment">   *                            'screen', 'tty', or 'tv'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function enqueue_style( $handle, $src = false, $deps = array(), $ver = false, $media = 'all' ) {&nbsp;</div></li><li><div>      $this-&gt;layouts[ $this-&gt;_layout ]['css'][] = compact( 'handle', 'src', 'deps', 'ver', 'media' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue the js files of layout</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $handle    Name of the script.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $src       Path to the script from the root directory of WordPress. Example: '/js/myscript.js'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array       $deps      An array of registered handles this script depends on. Default empty array.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $ver       Optional. String specifying the script version number, if it has one. This parameter</span>&nbsp;</div></li><li><div><span class="comment">   *                               is used to ensure that the correct version is sent to the client regardless of caching, </span>&nbsp;</div></li><li><div><span class="comment">   *                               and so should be included if a version number is available and makes sense for the script.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool        $in_footer Optional. Whether to enqueue the script before &lt;/head&gt; or before &lt;/body&gt;.</span>&nbsp;</div></li><li><div><span class="comment">   *                               Default 'false'. Accepts 'false' or 'true'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function enqueue_script( $handle, $src = false, $deps = array(), $ver = false, $in_footer = false ) {&nbsp;</div></li><li><div>      $this-&gt;layouts[ $this-&gt;_layout ]['js'][] = compact( 'handle', 'src', 'deps', 'ver', 'in_footer' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue the assets for the frontend</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function frontend_assets() {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// not single</span>&nbsp;</div></li><li><div>      if ( ! is_single() || ! isset( $post-&gt;post_type ) || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          $posts = get_posts(array(&nbsp;</div></li><li><div>              'post_type' =&gt; $this-&gt;_name, &nbsp;</div></li><li><div>              'posts_per_page' =&gt; -1, &nbsp;</div></li><li><div>              'post_status' =&gt; 'publish', &nbsp;</div></li><li><div>              'fields' =&gt; 'ids'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $enqueued = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $posts as $post_id ) {&nbsp;</div></li><li><div>              $layout = get_post_meta( $post_id, $this-&gt;_args['layout_option'], true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( in_array( $layout, array( $enqueued ) ) || ! isset( $this-&gt;layouts[ $layout ]['css'] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $this-&gt;layouts[ $layout ]['css'] as $asset ) {&nbsp;</div></li><li><div>                  if ( empty( $asset ) ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  yit_enqueue_style( $asset['handle'], empty( $asset['src'] ) ? false : $this-&gt;locate_url( $layout ) . $asset['src'], $asset['deps'], $asset['ver'], $asset['media'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $enqueued[] = $layout;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// load assets of single template</span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $layout = 'single';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $this-&gt;layouts[ $layout ]['css'] ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;layouts[ $layout ]['css'] as $asset ) {&nbsp;</div></li><li><div>              if ( empty( $asset ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              yit_enqueue_style( $asset['handle'], $this-&gt;locate_url( $layout ) . $asset['src'], $asset['deps'], $asset['ver'], $asset['media'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Register Metaboxes options</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Add the metabox for the portfolio settings</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_metabox_cptu() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Reorganize layouts</span>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['manage_layouts'] ) {&nbsp;</div></li><li><div>          $layouts = array();&nbsp;</div></li><li><div>          foreach ( $this-&gt;layouts as $layout_id =&gt; $layout ) {&nbsp;</div></li><li><div>              if ( 'single' == $layout_id ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $layouts[ $layout_id ] = $layout['name'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $layouts = apply_filters( 'yit_cptu_' . $this-&gt;_name . '_layout_values', $layouts );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $single_layouts = apply_filters( 'yit_cptu_' . $this-&gt;_name . '_single_layout_values', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $metabox_args = array(&nbsp;</div></li><li><div>          'label' =&gt; sprintf( __( '%s Settings', 'yith-plugin-fw' ), $this-&gt;_labels['singular'] ), &nbsp;</div></li><li><div>          'pages' =&gt; $this-&gt;_name, <span class="comment"><span class="comment">//or array( 'post-type1', 'post-type2')</span></span>&nbsp;</div></li><li><div>          'context' =&gt; 'normal', <span class="comment"><span class="comment">//('normal', 'advanced', or 'side')</span></span>&nbsp;</div></li><li><div>          'priority' =&gt; 'default', &nbsp;</div></li><li><div>          'tabs' =&gt; array(&nbsp;</div></li><li><div>              'settings' =&gt; array(&nbsp;</div></li><li><div>                  'label' =&gt; __( 'Settings', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'fields' =&gt; apply_filters( 'yit_cptu_fields', array(&nbsp;</div></li><li><div>                      'type' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Type', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'desc' =&gt; sprintf( __( 'Layout for this %s' , 'yith-plugin-fw' ), strtolower( $this-&gt;_labels['singular'] ) ), &nbsp;</div></li><li><div>                          'type' =&gt; 'select', &nbsp;</div></li><li><div>                          'options' =&gt; isset( $layouts ) ? $layouts : array(), &nbsp;</div></li><li><div>                          'std' =&gt; '' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      'rewrite' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Rewrite', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'desc' =&gt; __( 'Univocal identification name in the URL for each product (slug from post if empty)', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'type' =&gt; 'text', &nbsp;</div></li><li><div>                          'std' =&gt; '' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      'label_singular' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Label in Singular', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'desc' =&gt; __( 'Set a label in singular (title of portfolio if empty)', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'type' =&gt; 'text', &nbsp;</div></li><li><div>                          'std' =&gt; '' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      'label_plural' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Label in Plural', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'desc' =&gt; __( 'Set a label in plural (title of portfolio if empty)', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'type' =&gt; 'text', &nbsp;</div></li><li><div>                          'std' =&gt; '' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      'taxonomy' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Taxonomy', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'desc' =&gt; __( 'If you want to use categories in the portfolio, set a name for taxonomy. Name should be a slug (must not contain capital letters nor spaces) and must not be more than 32 characters long (database structure restriction).', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'type' =&gt; 'text', &nbsp;</div></li><li><div>                          'std' =&gt; '' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      'taxonomy_rewrite' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Taxonomy Rewrite', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'desc' =&gt; __( 'Set univocal name for each category page URL.', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'type' =&gt; 'text', &nbsp;</div></li><li><div>                          'std' =&gt; '' ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      'single_layout' =&gt; array(&nbsp;</div></li><li><div>                          'label' =&gt; __( 'Single layout', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'desc' =&gt; __( 'Layout for single page of this portfolio', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                          'type' =&gt; 'select', &nbsp;</div></li><li><div>                          'options' =&gt; $single_layouts, &nbsp;</div></li><li><div>                          'std' =&gt; '' ), &nbsp;</div></li><li><div> ) )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $this-&gt;_args['has_single'] ) {&nbsp;</div></li><li><div>          unset( $metabox_args['tabs']['settings']['fields']['rewrite'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $this-&gt;_args['has_taxonomy'] ) {&nbsp;</div></li><li><div>          unset( $metabox_args['tabs']['settings']['fields']['taxonomy'] );&nbsp;</div></li><li><div>          unset( $metabox_args['tabs']['settings']['fields']['taxonomy_rewrite'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;_args['label_item_sing'] ) ) {&nbsp;</div></li><li><div>          unset( $metabox_args['tabs']['settings']['fields']['label_singular'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $this-&gt;_args['label_item_plur'] ) ) {&nbsp;</div></li><li><div>          unset( $metabox_args['tabs']['settings']['fields']['label_plural'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['manage_layouts'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( count( $layouts ) &lt; 1 ) {&nbsp;</div></li><li><div>              unset( $metabox_args['tabs']['settings']['fields']['type'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Layouts options</span>&nbsp;</div></li><li><div>          foreach ( $this-&gt;layouts as $layout =&gt; $args ) {&nbsp;</div></li><li><div>              if ( ! isset( $args['fields'] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Section title</span>&nbsp;</div></li><li><div>              $metabox_args['tabs']['settings']['fields'][ $layout . '_title' ] = array(&nbsp;</div></li><li><div>                  'desc' =&gt; $args['name'] . ' ' . __( 'layout settings', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'type' =&gt; 'title', &nbsp;</div></li><li><div>                  'deps' =&gt; array(&nbsp;</div></li><li><div>                      'ids' =&gt; '_type', &nbsp;</div></li><li><div>                      'values' =&gt; $layout&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Options</span>&nbsp;</div></li><li><div>              foreach( $args['fields'] as $field_id =&gt; $field ) {&nbsp;</div></li><li><div>                  $metabox_args['tabs']['settings']['fields'][ $field_id ] = $field;&nbsp;</div></li><li><div>                  $metabox_args['tabs']['settings']['fields'][ $field_id ]['deps'] = array(&nbsp;</div></li><li><div>                      'ids' =&gt; '_type', &nbsp;</div></li><li><div>                      'values' =&gt; $layout&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }else {&nbsp;</div></li><li><div>          unset( $metabox_args['tabs']['settings']['fields']['type'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( count( $single_layouts ) &lt; 1 ) {&nbsp;</div></li><li><div>          unset( $metabox_args['tabs']['settings']['fields']['single_layout'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// undo if tab empty</span>&nbsp;</div></li><li><div>      if ( empty( $metabox_args['tabs']['settings']['fields'] ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $metabox = YIT_Metabox( $this-&gt;_name . '_cptu_settings' );&nbsp;</div></li><li><div>      $metabox-&gt;init( $metabox_args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Register Metaboxes options</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Add the metabox for the portfolio settings</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_metabox_item_fields() {&nbsp;</div></li><li><div>      global $pagenow, $post_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// get the actual post type, to add the metabox only if necessary</span>&nbsp;</div></li><li><div>      if ( $pagenow == 'post.php' && isset( $_REQUEST['post'] ) ) {&nbsp;</div></li><li><div>          $post_type = get_post_type( intval( $_REQUEST['post'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif( $pagenow == 'post.php' && isset( $_REQUEST['post_ID'] ) ) {&nbsp;</div></li><li><div>          $post_type = get_post_type( intval( $_REQUEST['post_ID'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( $pagenow == 'post-new.php' && isset( $_REQUEST['post_type'] ) ) {&nbsp;</div></li><li><div>          $post_type = $_REQUEST['post_type'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $layout = get_post_meta( $this-&gt;_get_id_by_name( $post_type ), $this-&gt;_args['layout_option'], true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $this-&gt;layouts[ $layout ]['item_fields'] ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $metabox_args = array(&nbsp;</div></li><li><div>          'label' =&gt; __( 'Settings', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>          'pages' =&gt; $post_type, <span class="comment"><span class="comment">//or array( 'post-type1', 'post-type2')</span></span>&nbsp;</div></li><li><div>          'context' =&gt; 'normal', <span class="comment"><span class="comment">//('normal', 'advanced', or 'side')</span></span>&nbsp;</div></li><li><div>          'priority' =&gt; 'default', &nbsp;</div></li><li><div>          'tabs' =&gt; array(&nbsp;</div></li><li><div>              'settings' =&gt; array(&nbsp;</div></li><li><div>                  'label' =&gt; __( 'Settings', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                  'fields' =&gt; $this-&gt;layouts[ $layout ]['item_fields']&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $metabox = YIT_Metabox( $post_type . '_item_fields' );&nbsp;</div></li><li><div>      $metabox-&gt;init( $metabox_args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add quick links inside the editing page of CPTU and Custom Post Types</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_quick_links_metaboxes() {&nbsp;</div></li><li><div>      <span class="comment">// CPTU</span>&nbsp;</div></li><li><div>      add_meta_box( $this-&gt;_name . '_quick_links', __( 'Quick links', 'yith-plugin-fw' ), array( $this, 'quick_links_cptu_inner' ), $this-&gt;_name, 'side', 'high' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// CPTs</span>&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          'post_type' =&gt; $this-&gt;_name, &nbsp;</div></li><li><div>          'posts_per_page' =&gt; -1, &nbsp;</div></li><li><div>          'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $post_types = get_posts( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $post_types as $post ) {&nbsp;</div></li><li><div>          $post_type = get_post_meta( $post-&gt;ID, '_post_type', true );&nbsp;</div></li><li><div>          extract( $this-&gt;_cpt_args( $post ) );&nbsp;</div></li><li><div>          add_meta_box( $post-&gt;post_type . '_quick_links', __( 'Quick links', 'yith-plugin-fw' ), array( $this, 'quick_links_cpt_inner' ), $post_type, 'side', 'high' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Link to: &quot;View Items&quot;, inside the CPTU</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function quick_links_cptu_inner( $post ) {&nbsp;</div></li><li><div>      extract( $this-&gt;_cpt_args( $post ) );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;a href=&quot;&lt;?php echo admin_url( 'edit.php?post_type=' . get_post_meta( $post-&gt;ID, '_post_type', true ) ) ?&gt;&quot;&gt;&lt;?php printf( __( 'View %s', 'yith-plugin-fw' ), $label_plural ) ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Link to: &quot;Edit %s&quot;, inside the CPTU</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function quick_links_cpt_inner( $post ) {&nbsp;</div></li><li><div>      $post = get_post( $this-&gt;_get_id_by_name( $post-&gt;post_type ) );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;a href=&quot;&lt;?php echo admin_url( &quot;post.php?post={$post-&gt;ID}&action=edit&quot; ) ?&gt;&quot;&gt;&lt;?php printf( __( 'Edit %s', 'yith-plugin-fw' ), $post-&gt;post_title ) ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Define the columns to use in the list table of main sliders post type</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $columns array The columns used in the list table</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function cptu_define_columns( $columns ) {&nbsp;</div></li><li><div>      unset( $columns['date'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $columns['actions'] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $columns;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Change the content of each column of the table list</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $column string The current column</span>&nbsp;</div></li><li><div><span class="comment">   * @param $post_id int The current post ID</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function cptu_change_columns( $column, $post_id ) {&nbsp;</div></li><li><div>      $post = get_post( $post_id );&nbsp;</div></li><li><div>      extract( $this-&gt;_cpt_args( $post ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $column ) {&nbsp;</div></li><li><div>          case 'actions' :&nbsp;</div></li><li><div>              echo '&lt;a href=&quot;' . admin_url( &quot;post.php?post={$post_id}&action=edit&quot; ) . '&quot; class=&quot;button-secondary&quot;&gt;' . sprintf( __( 'Edit %s', 'yith-plugin-fw' ), ucfirst( $this-&gt;_labels['singular'] ) ) . '&lt;/a&gt; ';&nbsp;</div></li><li><div>              echo '&lt;a href=&quot;' . admin_url( 'edit.php?post_type=' . get_post_meta( $post_id, '_post_type', true ) ) . '&quot; class=&quot;button-secondary&quot;&gt;' . sprintf( __( 'View %s', 'yith-plugin-fw' ), $label_plural ) . '&lt;/a&gt; ';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the path of layout specified in parameter</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $layout</span>&nbsp;</div></li><li><div><span class="comment">   * @param $file string The file to find</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool|string</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function locate_file( $layout, $file = '' ) {&nbsp;</div></li><li><div>      if ( ! $this-&gt;_args['manage_layouts'] ) {&nbsp;</div></li><li><div>          return $this-&gt;template_path(). '/' . ( ! empty( $file ) ? $file . '.php' : '' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $this-&gt;layouts[ $layout ] ) ) {&nbsp;</div></li><li><div>          $layout = 'default';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;layouts[ $layout ]['path'] . '/' . ( ! empty( $file ) ? $file . '.php' : '' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the URL of  layout specified in parameter</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $layout</span>&nbsp;</div></li><li><div><span class="comment">   * @param $file string The file to find</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool|string</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function locate_url( $layout, $file = '' ) {&nbsp;</div></li><li><div>      if ( ! $this-&gt;_args['manage_layouts'] ) {&nbsp;</div></li><li><div>          return $this-&gt;template_url();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $this-&gt;layouts[ $layout ] ) ) {&nbsp;</div></li><li><div>          $layout = 'default';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;layouts[ $layout ]['url'] . '/' . ( ! empty( $file ) ? $file . '.php' : '' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the post ID relative to the post of post type</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $name string</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function _get_id_by_name( $name ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT pm.post_id FROM $wpdb-&gt;postmeta AS pm INNER JOIN $wpdb-&gt;posts AS p ON p.ID = pm.post_id WHERE pm.meta_key = %s AND pm.meta_value = %s AND p.post_type = %s&quot;, '_post_type', $name, $this-&gt;_name ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the post_type of portfolio by portfolio name</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $name string</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function _get_post_type_by_name( $name ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT pm.meta_value FROM $wpdb-&gt;postmeta AS pm INNER JOIN $wpdb-&gt;posts AS p ON p.ID = pm.post_id WHERE pm.meta_key = %s AND p.post_name = %s AND p.post_type = %s&quot;, '_post_type', $name, $this-&gt;_name ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The shortcode used to show the frontend</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $atts</span>&nbsp;</div></li><li><div><span class="comment">   * @param null $content</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|null</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_shortcode( $atts, $content = null ) {&nbsp;</div></li><li><div>      $atts = wp_parse_args( $atts, array(&nbsp;</div></li><li><div>          'name' =&gt; null, &nbsp;</div></li><li><div>          'cat' =&gt; array(), &nbsp;</div></li><li><div>          'posts_per_page' =&gt; false, &nbsp;</div></li><li><div>          'style' =&gt; null, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// don't show the slider if 'name' is empty or is 'none'</span>&nbsp;</div></li><li><div>      if ( empty( $atts['name'] ) || 'none' == $atts['name'] ) return null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// compatibility fix: remove prefix if exists in portfolio object</span>&nbsp;</div></li><li><div>      if( function_exists( 'YIT_Portfolio' ) && method_exists( YIT_Portfolio(), 'is' ) && YIT_Portfolio()-&gt;is( $atts['name'] ) ) {&nbsp;</div></li><li><div>          $atts['name'] = str_replace( YIT_Portfolio()-&gt;post_type_prefix, '', $atts['name'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// pass vars to template</span>&nbsp;</div></li><li><div>      $atts['post_type'] = $this-&gt;_get_post_type_by_name( $atts['name'] );&nbsp;</div></li><li><div>      $atts['layout'] = $this-&gt;_args['manage_layouts'] ? get_post_meta( $this-&gt;_get_id_by_name( $atts['post_type'] ), $this-&gt;_args['layout_option'], true ) : '';&nbsp;</div></li><li><div>      extract( apply_filters( 'yit_cptu_frontend_vars', $atts, $this-&gt;_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// add the javascript assets</span></span>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['manage_layouts'] && isset( $this-&gt;layouts[ $layout ]['js'] ) && ! empty( $this-&gt;layouts[ $layout ]['js'] ) ) {&nbsp;</div></li><li><div>          foreach ( $this-&gt;layouts[ $layout ]['js'] as $asset ) {&nbsp;</div></li><li><div>              if ( empty( $asset ) ) continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $asset['src'] ) ) {&nbsp;</div></li><li><div>                  wp_enqueue_script( $asset['handle'] );&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              yit_enqueue_script( $asset['handle'], $this-&gt;locate_url( $layout ) . $asset['src'], $asset['deps'], $asset['ver'], $asset['in_footer'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Unique sequential index to differentiate more cpt in the same page</span>&nbsp;</div></li><li><div>      ++$this-&gt;index;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ob_start();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      include( $this-&gt;locate_file( $layout, 'markup' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return ob_get_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Shortcode icon</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Return the shortcode icone to display on shortcode panel</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $icon_url string Icone url found by yit_shortcode plugin</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonio.scarfi@yithemes.it&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function shortcode_icon( $icon_url ) {&nbsp;</div></li><li><div>      return ! empty( $this-&gt;_args['shortcode_icon'] ) ? $this-&gt;_args['shortcode_icon'] : $icon_url;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Return an array with cptu options to shortcode panel</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * All definition settings to add cptu shortcode to Yit Shortcode Panel</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $shortcodes</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_shortcode_to_box( $shortcodes ) {&nbsp;</div></li><li><div>      $post_types = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $this-&gt;get_post_types() as $post ) {&nbsp;</div></li><li><div>          $post_types[ $post-&gt;post_name ] = $post-&gt;post_title;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          $this-&gt;_args['shortcode_name'] =&gt; array(&nbsp;</div></li><li><div>              'title' =&gt; $this-&gt;_labels['singular'], &nbsp;</div></li><li><div>              'description' =&gt; sprintf( __( 'Show frontend of the %s', 'yith-plugin-fw' ), $this-&gt;_labels['main_name'] ), &nbsp;</div></li><li><div>              'tab' =&gt; 'cpt', &nbsp;</div></li><li><div>              'create' =&gt; false, &nbsp;</div></li><li><div>              'has_content' =&gt; false, &nbsp;</div></li><li><div>              'in_visual_composer' =&gt; true, &nbsp;</div></li><li><div>              'attributes' =&gt; array(&nbsp;</div></li><li><div>                  'name' =&gt; array(&nbsp;</div></li><li><div>                      'title' =&gt; __( 'Name', 'yith-plugin-fw' ), &nbsp;</div></li><li><div>                      'type' =&gt; 'select', &nbsp;</div></li><li><div>                      'options' =&gt; $post_types, &nbsp;</div></li><li><div>                      'std' =&gt; ''&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array_merge( $shortcodes, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check the post type passed in parameter, if is generated by this CPTU</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $post_type string The post type to check</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function _is_valid( $post_type ) {&nbsp;</div></li><li><div>      return (bool)( strpos( $post_type, $this-&gt;_args['post_type_prefix'] ) !== false );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add as a valid post type all cptu when importing dummy data</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $post array The post object</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonio La Rocca &lt;antonio.larocca@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">  */</span>&nbsp;</div></li><li><div>  public function add_importer_required_post_type( $post ) {&nbsp;</div></li><li><div>      global $wp_post_types, $wp_taxonomies;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( strpos( $post['post_type'], $this-&gt;_prefix_cpt ) === FALSE ) {&nbsp;</div></li><li><div>          return $post;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! isset( $wp_post_types[ $post['post_type'] ] ) ) {&nbsp;</div></li><li><div>          $wp_post_types[ $post['post_type'] ] = array(&nbsp;</div></li><li><div>              'name' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! empty( $post['terms'] ) ) {&nbsp;</div></li><li><div>          foreach( $post['terms'] as $term ) {&nbsp;</div></li><li><div>              if( ! isset( $wp_taxonomies[ $term['domain'] ] ) ) {&nbsp;</div></li><li><div>                  $wp_taxonomies[ $term['domain'] ] = array(&nbsp;</div></li><li><div>                      'name' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $post;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add taxonomy when importing dummy data</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $terms array Array of terms</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonio La Rocca &lt;antonio.larocca@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">  */</span>&nbsp;</div></li><li><div>  public function add_importer_required_taxonomy( $terms ) {&nbsp;</div></li><li><div>      global $wp_taxonomies;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! empty( $terms ) ) {&nbsp;</div></li><li><div>          foreach ( $terms as $term ) {&nbsp;</div></li><li><div>              if( isset( $term['domain'] ) &&  ! isset( $wp_taxonomies[ $term['domain'] ] ) ) {&nbsp;</div></li><li><div>                  $wp_taxonomies[ $term['domain'] ] = array(&nbsp;</div></li><li><div>                      'name' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $terms;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Force terms recount for imported taxonomy</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param $tt_ids array Terms ids</span>&nbsp;</div></li><li><div><span class="comment">   * @param $ids array Post ids</span>&nbsp;</div></li><li><div><span class="comment">   * @param $tax string Taxonomy name</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonio La Rocca &lt;antonio.larocca@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">  */</span>&nbsp;</div></li><li><div>  public function recount_terms_post( $tt_ids, $ids, $tax ) {&nbsp;</div></li><li><div>      wp_update_term_count( $tt_ids, $tax );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// ### ASSETS ###</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enqueue the assets for the admin</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function admin_assets() {&nbsp;</div></li><li><div>      wp_enqueue_media();&nbsp;</div></li><li><div>      wp_enqueue_script( 'yit-cptu', YIT_CORE_PLUGIN_URL . '/assets/js/yit-cpt-unlimited.js', array('jquery'), '', true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add the button to the top of the list table page of CPTU</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_button_multiuploader() {&nbsp;</div></li><li><div>      global $pagenow, $post_type, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( $pagenow != 'edit.php' ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cptu = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT p.post_type FROM $wpdb-&gt;postmeta AS pm INNER JOIN $wpdb-&gt;posts AS p ON p.ID = pm.post_id WHERE pm.meta_key = %s AND pm.meta_value = %s&quot;, '_post_type', $post_type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post = get_post( $this-&gt;_get_id_by_name( $post_type ) );&nbsp;</div></li><li><div>      if ( empty( $post ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      extract( $this-&gt;_cpt_args( $post ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $cptu != $this-&gt;_name || ! $this-&gt;_is_valid( $post_type ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;script&gt;&nbsp;</div></li><li><div>          (function($) {&nbsp;</div></li><li><div>              &quot;use strict&quot;;&nbsp;</div></li><li><div>              <span class="comment">// Author code here</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              var button = $('&lt;a /&gt;', {&nbsp;</div></li><li><div>                  href: '#', &nbsp;</div></li><li><div>                  class: 'multi-uploader add-new-h2', &nbsp;</div></li><li><div>                  'data-uploader_title': '&lt;?php printf( __( 'Add %s from images', 'yith-plugin-fw' ), $label_plural ) ?&gt;', &nbsp;</div></li><li><div>                  'data-uploader_button_text': '&lt;?php printf( __( 'Add %s', 'yith-plugin-fw' ), $label_plural ) ?&gt;'&nbsp;</div></li><li><div>              }).text('&lt;?php _e( 'Upload multiple files', 'yith-plugin-fw' ) ?&gt;');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              var spinner = $('&lt;span /&gt;', {&nbsp;</div></li><li><div>                  class: 'spinner', &nbsp;</div></li><li><div>                  style: 'float: none;'&nbsp;</div></li><li><div>              });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              button.appendTo('.wrap h2, .wrap h1').after(spinner);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          })(jQuery);&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add more posts by multiupload</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function post_multiuploader() {&nbsp;</div></li><li><div>      if ( ! isset( $_REQUEST['images'] ) || ! isset( $_REQUEST['post_type'] ) && $this-&gt;_is_valid( $_REQUEST['post_type'] ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $_REQUEST['images'] as $the ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Create post object</span>&nbsp;</div></li><li><div>          $arg = array(&nbsp;</div></li><li><div>              'post_title' =&gt; $the['title'], &nbsp;</div></li><li><div>              'post_type' =&gt; $_REQUEST['post_type']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $post_id = wp_insert_post( $arg );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          set_post_thumbnail( $post_id, $the['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      die();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// ###### SINGLE TEMPLATE ######</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Load the single template file</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function single_template() {&nbsp;</div></li><li><div>      global $post, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//        if ( defined('DOING_AJAX') && DOING_AJAX && isset( $_REQUEST['post_id'] ) ) {</span>&nbsp;</div></li><li><div><span class="comment">//            $post = get_post( $_REQUEST['post_id'] );</span>&nbsp;</div></li><li><div><span class="comment">//        }</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( ( ! defined('DOING_AJAX') || ! DOING_AJAX ) && ! is_single() ) || ! isset( $post-&gt;post_type ) || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// add the javascript assets</span></span>&nbsp;</div></li><li><div>      if ( $this-&gt;_args['manage_layouts'] ) {&nbsp;</div></li><li><div>          foreach ( $this-&gt;layouts[ 'single' ]['js'] as $asset ) {&nbsp;</div></li><li><div>              yit_enqueue_script( $asset['handle'], $this-&gt;locate_url( 'single' ) . $asset['src'], $asset['deps'], $asset['ver'], $asset['in_footer'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_name = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT p.post_name FROM $wpdb-&gt;postmeta AS pm INNER JOIN $wpdb-&gt;posts AS p ON p.ID = pm.post_id WHERE pm.meta_key = %s AND pm.meta_value = %s AND p.post_type = %s&quot;, '_post_type', $post-&gt;post_type, $this-&gt;_name ) );&nbsp;</div></li><li><div>      extract( apply_filters( 'yit_cptu_frontend_vars', array( 'name' =&gt; $post_name ), $this-&gt;_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      include( $this-&gt;locate_file( 'single', 'markup' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Load a file for the configuration of single template page of portfolio</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function single_template_config() {&nbsp;</div></li><li><div>      global $post, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( defined('DOING_AJAX') && DOING_AJAX && isset( $_REQUEST['post_id'] ) ) {&nbsp;</div></li><li><div>          $post = get_post( $_REQUEST['post_id'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( ( ! defined('DOING_AJAX') || ! DOING_AJAX ) && ! is_single() ) || ! isset( $post-&gt;post_type ) || ! $this-&gt;_is_valid( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_layout = 'single';&nbsp;</div></li><li><div>      $path = $this-&gt;locate_file( 'single', 'config' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( file_exists( $path ) ) {&nbsp;</div></li><li><div>          $post_name = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT p.post_name FROM $wpdb-&gt;postmeta AS pm INNER JOIN $wpdb-&gt;posts AS p ON p.ID = pm.post_id WHERE pm.meta_key = %s AND pm.meta_value = %s AND p.post_type = %s&quot;, '_post_type', $post-&gt;post_type, $this-&gt;_name ) );&nbsp;</div></li><li><div>          extract( apply_filters( 'yit_cptu_frontend_vars', array( 'name' =&gt; $post_name ), $this-&gt;_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          include( $path );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// ########################## ARCHIVE TEMPLATE ###############################</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Load the template for archive page</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function archive_template() {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// check if we are in archive template</span>&nbsp;</div></li><li><div>       if ( !( ! is_admin() && is_archive() && isset($wp_query-&gt;post) && $this-&gt;_is_valid( $wp_query-&gt;post-&gt;post_type ) ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// remove the action from loop of theme</span>&nbsp;</div></li><li><div>      remove_action( 'yit_content_loop', 'yit_content_loop', 10 );&nbsp;</div></li><li><div>      add_action( 'yit_content_loop', array( $this, 'archive_template_loop' ), 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Load loop for the archive template</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   * @since  1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @author Antonino Scarfi' &lt;antonino.scarfi@yithemes.com&gt;</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function archive_template_loop() {&nbsp;</div></li><li><div>      echo $this-&gt;add_shortcode( array( 'name' =&gt; $GLOBALS['wp_query']-&gt;post-&gt;post_type ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>YITH WooCommerce Compare</li><li><span></span>2.2.0</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2019 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>