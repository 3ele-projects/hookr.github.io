<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="3.8.0" data-slug="jetpack-by-wordpress-com" data-type="class" data-id="11486"><head xmlns="http://www.w3.org/1999/xhtml"><title> csstidy | class | Jetpack By WordPress Com | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="csstidy, class, plugin, jetpack-by-wordpress-com, 3.8.0" /><meta name="description" content="CSS Parser class" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=d1f11e91ac5c765270a65b2b3b11182e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/csstidy/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcsstidy%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcsstidy%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-jetpack-by-wordpress-com-3.8.0-class-csstidy","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="csstidy" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to jetpack-by-wordpress-com." href="http://hookr.io/plugins/jetpack-by-wordpress-com/" class="plugin"><span property="name">jetpack-by-wordpress-com</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.8.0." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/" class="H_VERSION"><span property="name">3.8.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">csstidy</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="1499"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/all/" title="All">All <span class="count badge">1499</span></a></li><li class="" data-id="new" data-count="17"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/new/" title="New">New <span class="count badge">17</span></a></li><li class="" data-id="hooks" data-count="599"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/hooks/" title="Hooks">Hooks <span class="count badge">599</span></a></li><li class="" data-id="action" data-count="195"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/actions/" title="Actions">Actions <span class="count badge">195</span></a></li><li class="" data-id="filter" data-count="404"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/filters/" title="Filters">Filters <span class="count badge">404</span></a></li><li class="active" data-id="class" data-count="262"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/" title="Classes">Classes <span class="count badge">262</span></a></li><li class="" data-id="constant" data-count="62"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/constants/" title="Constants">Constants <span class="count badge">62</span></a></li><li class="" data-id="function" data-count="530"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/functions/" title="Functions">Functions <span class="count badge">530</span></a></li><li class="" data-id="shortcode" data-count="46"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">46</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>csstidy</strong></h1><p>CSS Parser class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/files/modules-custom-css-csstidy-class-csstidy/" class="file">/modules/custom-css/csstidy/class.csstidy.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="51" class="block" start="73"><li><div>class csstidy {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the parsed CSS. This array is empty if preserve_css is on.&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $css = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the parsed CSS (raw)&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $tokens = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Printer class&nbsp;</div></li><li><div>     * @see csstidy_print&nbsp;</div></li><li><div>     * @var object&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $print;&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Optimiser class&nbsp;</div></li><li><div>     * @see csstidy_optimise&nbsp;</div></li><li><div>     * @var object&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $optimise;&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the CSS charset (@charset)&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $charset = '';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves all @import URLs&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $import = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the namespace&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $namespace = '';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Contains the version of csstidy&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $version = '1.3';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Stores the settings&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $settings = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the parser-status.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Possible values:&nbsp;</div></li><li><div>     * - is = in selector&nbsp;</div></li><li><div>     * - ip = in property&nbsp;</div></li><li><div>     * - iv = in value&nbsp;</div></li><li><div>     * - instr = in string (started at &quot; or ' or ( )&nbsp;</div></li><li><div>     * - ic = in comment (ignore everything)&nbsp;</div></li><li><div>     * - at = in @-block&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $status = 'is';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the current at rule (@media)&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $at = '';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the current selector&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $selector = '';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the current property&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $property = '';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the position of , in selectors&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $sel_separate = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the current value&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $value = '';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the current sub-value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Example for a subvalue:&nbsp;</div></li><li><div>     * background:url(foo.png) red no-repeat;&nbsp;</div></li><li><div>     * &quot;url(foo.png)&quot;, &quot;red&quot;, and  &quot;no-repeat&quot; are subvalues, &nbsp;</div></li><li><div>     * separated by whitespace&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $sub_value = '';&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Array which saves all subvalues for a property.&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @see sub_value&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $sub_value_arr = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the stack of characters that opened the current strings&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $str_char = array();&nbsp;</div></li><li><div>    public $cur_string = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Status from which the parser switched to ic or instr&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $from = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * =true if in invalid at-rule&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $invalid_at = false;&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * =true if something has been added to the current selector&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $added = false;&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Array which saves the message log&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $log = array();&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves the line number&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $line = 1;&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Marks if we need to leave quotes for a string&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $quoted_string = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * List of tokens&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $tokens_list = &quot;&quot;;&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads standard template and sets default settings&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.3&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function csstidy() {&nbsp;</div></li><li><div>        $this-&gt;settings['remove_bslash'] = true;&nbsp;</div></li><li><div>        $this-&gt;settings['compress_colors'] = true;&nbsp;</div></li><li><div>        $this-&gt;settings['compress_font-weight'] = true;&nbsp;</div></li><li><div>        $this-&gt;settings['lowercase_s'] = false;&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>          1 common shorthands optimization&nbsp;</div></li><li><div>          2 + font property optimization&nbsp;</div></li><li><div>          3 + background property optimization&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $this-&gt;settings['optimise_shorthands'] = 1;&nbsp;</div></li><li><div>        $this-&gt;settings['remove_last_;'] = true;&nbsp;</div></li><li><div>        /** rewrite all properties with low case, better for later gzip OK, safe*/&nbsp;</div></li><li><div>        $this-&gt;settings['case_properties'] = 1;&nbsp;</div></li><li><div>        /** sort properties in alpabetic order, better for later gzip&nbsp;</div></li><li><div>         * but can cause trouble in case of overiding same propertie or using hack&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $this-&gt;settings['sort_properties'] = false;&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>          1, 3, 5, etc -- enable sorting selectors inside @media: a{}b{}c{}&nbsp;</div></li><li><div>          2, 5, 8, etc -- enable sorting selectors inside one CSS declaration: a, b, c{}&nbsp;</div></li><li><div>          preserve order by default cause it can break functionnality&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $this-&gt;settings['sort_selectors'] = 0;&nbsp;</div></li><li><div>        /** is dangeroues to be used: CSS is broken sometimes */&nbsp;</div></li><li><div>        $this-&gt;settings['merge_selectors'] = 0;&nbsp;</div></li><li><div>        /** preserve or not browser hacks */&nbsp;</div></li><li><div>        $this-&gt;settings['discard_invalid_selectors'] = false;&nbsp;</div></li><li><div>        $this-&gt;settings['discard_invalid_properties'] = false;&nbsp;</div></li><li><div>        $this-&gt;settings['css_level'] = 'CSS2.1';&nbsp;</div></li><li><div>        $this-&gt;settings['preserve_css'] = false;&nbsp;</div></li><li><div>        $this-&gt;settings['timestamp'] = false;&nbsp;</div></li><li><div>        $this-&gt;settings['template'] = ''; // say that propertie exist&nbsp;</div></li><li><div>        $this-&gt;set_cfg('template', 'default'); // call load_template&nbsp;</div></li><li><div>        $this-&gt;optimise = new csstidy_optimise($this);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;tokens_list = & $GLOBALS['csstidy']['tokens'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the value of a setting.&nbsp;</div></li><li><div>     * @param string $setting&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_cfg($setting) {&nbsp;</div></li><li><div>        if (isset($this-&gt;settings[$setting])) {&nbsp;</div></li><li><div>            return $this-&gt;settings[$setting];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a template&nbsp;</div></li><li><div>     * @param string $template used by set_cfg to load a template via a configuration setting&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.4&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _load_template($template) {&nbsp;</div></li><li><div>        switch ($template) {&nbsp;</div></li><li><div>            case 'default':&nbsp;</div></li><li><div>                $this-&gt;load_template('default');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'highest':&nbsp;</div></li><li><div>                $this-&gt;load_template('highest_compression');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'high':&nbsp;</div></li><li><div>                $this-&gt;load_template('high_compression');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'low':&nbsp;</div></li><li><div>                $this-&gt;load_template('low_compression');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                $this-&gt;load_template($template);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set the value of a setting.&nbsp;</div></li><li><div>     * @param string $setting&nbsp;</div></li><li><div>     * @param mixed $value&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function set_cfg($setting, $value=null) {&nbsp;</div></li><li><div>        if (is_array($setting) && $value === null) {&nbsp;</div></li><li><div>            foreach ($setting as $setprop =&gt; $setval) {&nbsp;</div></li><li><div>                $this-&gt;settings[$setprop] = $setval;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (array_key_exists('template', $setting)) {&nbsp;</div></li><li><div>                $this-&gt;_load_template($this-&gt;settings['template']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        } else if (isset($this-&gt;settings[$setting]) && $value !== '') {&nbsp;</div></li><li><div>            $this-&gt;settings[$setting] = $value;&nbsp;</div></li><li><div>            if ($setting === 'template') {&nbsp;</div></li><li><div>                $this-&gt;_load_template($this-&gt;settings['template']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a token to $this-&gt;tokens&nbsp;</div></li><li><div>     * @param mixed $type&nbsp;</div></li><li><div>     * @param string $data&nbsp;</div></li><li><div>     * @param bool $do add a token even if preserve_css is off&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _add_token($type, $data, $do = false) {&nbsp;</div></li><li><div>        if ($this-&gt;get_cfg('preserve_css') || $do) {&nbsp;</div></li><li><div>            $this-&gt;tokens[] = array($type, ($type == COMMENT) ? $data : trim($data));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add a message to the message log&nbsp;</div></li><li><div>     * @param string $message&nbsp;</div></li><li><div>     * @param string $type&nbsp;</div></li><li><div>     * @param integer $line&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function log($message, $type, $line = -1) {&nbsp;</div></li><li><div>        if ($line === -1) {&nbsp;</div></li><li><div>            $line = $this-&gt;line;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $line = intval($line);&nbsp;</div></li><li><div>        $add = array('m' =&gt; $message, 't' =&gt; $type);&nbsp;</div></li><li><div>        if (!isset($this-&gt;log[$line]) || !in_array($add, $this-&gt;log[$line])) {&nbsp;</div></li><li><div>            $this-&gt;log[$line][] = $add;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parse unicode notations and find a replacement character&nbsp;</div></li><li><div>     * @param string $string&nbsp;</div></li><li><div>     * @param integer $i&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     * @version 1.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _unicode(&$string, &$i) {&nbsp;</div></li><li><div>        ++$i;&nbsp;</div></li><li><div>        $add = '';&nbsp;</div></li><li><div>        $replaced = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while ($i &lt; strlen($string) && (ctype_xdigit($string{$i}) || ctype_space($string{$i})) && strlen($add) &lt; 6) {&nbsp;</div></li><li><div>            $add .= $string{$i};&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (ctype_space($string{$i})) {&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $i++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (hexdec($add) &gt; 47 && hexdec($add) &lt; 58 || hexdec($add) &gt; 64 && hexdec($add) &lt; 91 || hexdec($add) &gt; 96 && hexdec($add) &lt; 123) {&nbsp;</div></li><li><div>            $this-&gt;log('Replaced unicode notation: Changed \\' . $add . ' to ' . chr(hexdec($add)), 'Information');&nbsp;</div></li><li><div>            $add = chr(hexdec($add));&nbsp;</div></li><li><div>            $replaced = true;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $add = trim('\\' . $add);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (@ctype_xdigit($string{$i + 1}) && ctype_space($string{$i})&nbsp;</div></li><li><div>                        && !$replaced || !ctype_space($string{$i})) {&nbsp;</div></li><li><div>            $i--;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($add !== '\\' || !$this-&gt;get_cfg('remove_bslash') || strpos($this-&gt;tokens_list, $string{$i + 1}) !== false) {&nbsp;</div></li><li><div>            return $add;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($add === '\\') {&nbsp;</div></li><li><div>            $this-&gt;log('Removed unnecessary backslash', 'Information');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Write formatted output to a file&nbsp;</div></li><li><div>     * @param string $filename&nbsp;</div></li><li><div>     * @param string $doctype when printing formatted, is a shorthand for the document type&nbsp;</div></li><li><div>     * @param bool $externalcss when printing formatted, indicates whether styles to be attached internally or as an external stylesheet&nbsp;</div></li><li><div>     * @param string $title when printing formatted, is the title to be added in the head of the document&nbsp;</div></li><li><div>     * @param string $lang when printing formatted, gives a two-letter language code to be added to the output&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.4&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function write_page($filename, $doctype='xhtml1.1', $externalcss=true, $title='', $lang='en') {&nbsp;</div></li><li><div>        $this-&gt;write($filename, true);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Write plain output to a file&nbsp;</div></li><li><div>     * @param string $filename&nbsp;</div></li><li><div>     * @param bool $formatted whether to print formatted or not&nbsp;</div></li><li><div>     * @param string $doctype when printing formatted, is a shorthand for the document type&nbsp;</div></li><li><div>     * @param bool $externalcss when printing formatted, indicates whether styles to be attached internally or as an external stylesheet&nbsp;</div></li><li><div>     * @param string $title when printing formatted, is the title to be added in the head of the document&nbsp;</div></li><li><div>     * @param string $lang when printing formatted, gives a two-letter language code to be added to the output&nbsp;</div></li><li><div>     * @param bool $pre_code whether to add pre and code tags around the code (for light HTML formatted templates)&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.4&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function write($filename, $formatted=false, $doctype='xhtml1.1', $externalcss=true, $title='', $lang='en', $pre_code=true) {&nbsp;</div></li><li><div>        $filename .= ( $formatted) ? '.xhtml' : '.css';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_dir('temp')) {&nbsp;</div></li><li><div>            $madedir = mkdir('temp');&nbsp;</div></li><li><div>            if (!$madedir) {&nbsp;</div></li><li><div>                print 'Could not make directory &quot;temp&quot; in ' . dirname(__FILE__);&nbsp;</div></li><li><div>                exit;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $handle = fopen('temp/' . $filename, 'w');&nbsp;</div></li><li><div>        if ($handle) {&nbsp;</div></li><li><div>            if (!$formatted) {&nbsp;</div></li><li><div>                fwrite($handle, $this-&gt;print-&gt;plain());&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                fwrite($handle, $this-&gt;print-&gt;formatted_page($doctype, $externalcss, $title, $lang, $pre_code));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        fclose($handle);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads a new template&nbsp;</div></li><li><div>     * @param string $content either filename (if $from_file == true), content of a template file, &quot;high_compression&quot;, &quot;highest_compression&quot;, &quot;low_compression&quot;, or &quot;default&quot;&nbsp;</div></li><li><div>     * @param bool $from_file uses $content as filename if true&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.1&nbsp;</div></li><li><div>     * @see http://csstidy.sourceforge.net/templates.php&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_template($content, $from_file=true) {&nbsp;</div></li><li><div>        $predefined_templates = & $GLOBALS['csstidy']['predefined_templates'];&nbsp;</div></li><li><div>        if ($content === 'high_compression' || $content === 'default' || $content === 'highest_compression' || $content === 'low_compression') {&nbsp;</div></li><li><div>            $this-&gt;template = $predefined_templates[$content];&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($from_file) {&nbsp;</div></li><li><div>            $content = strip_tags(file_get_contents($content), '&lt;span&gt;');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $content = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $content); // Unify newlines (because the output also only uses \n)&nbsp;</div></li><li><div>        $template = explode('|', $content);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; count($template); $i++) {&nbsp;</div></li><li><div>            $this-&gt;template[$i] = $template[$i];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Starts parsing from URL&nbsp;</div></li><li><div>     * @param string $url&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function parse_from_url($url) {&nbsp;</div></li><li><div>        return $this-&gt;parse(@file_get_contents($url));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if there is a token at the current position&nbsp;</div></li><li><div>     * @param string $string&nbsp;</div></li><li><div>     * @param integer $i&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.11&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function is_token(&$string, $i) {&nbsp;</div></li><li><div>        return (strpos($this-&gt;tokens_list, $string{$i}) !== false && !csstidy::escaped($string, $i));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parses CSS in $string. The code is saved as array in $this-&gt;css&nbsp;</div></li><li><div>     * @param string $string the CSS code&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @version 1.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function parse($string) {&nbsp;</div></li><li><div>        // Temporarily set locale to en_US in order to handle floats properly&nbsp;</div></li><li><div>        $old = @setlocale(LC_ALL, 0);&nbsp;</div></li><li><div>        @setlocale(LC_ALL, 'C');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // PHP bug? Settings need to be refreshed in PHP4&nbsp;</div></li><li><div>        $this-&gt;print = new csstidy_print($this);&nbsp;</div></li><li><div>        //$this-&gt;optimise = new csstidy_optimise($this);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $all_properties = & $GLOBALS['csstidy']['all_properties'];&nbsp;</div></li><li><div>        $at_rules = & $GLOBALS['csstidy']['at_rules'];&nbsp;</div></li><li><div>        $quoted_string_properties = & $GLOBALS['csstidy']['quoted_string_properties'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;css = array();&nbsp;</div></li><li><div>        $this-&gt;print-&gt;input_css = $string;&nbsp;</div></li><li><div>        $string = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $string) . ' ';&nbsp;</div></li><li><div>        $cur_comment = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ($i = 0, $size = strlen($string); $i &lt; $size; $i++) {&nbsp;</div></li><li><div>            if ($string{$i} === &quot;\n&quot; || $string{$i} === &quot;\r&quot;) {&nbsp;</div></li><li><div>                ++$this-&gt;line;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch ($this-&gt;status) {&nbsp;</div></li><li><div>                /** Case in at-block */&nbsp;</div></li><li><div>                case 'at':&nbsp;</div></li><li><div>                    if (csstidy::is_token($string, $i)) {&nbsp;</div></li><li><div>                        if ($string{$i} === '/' && @$string{$i + 1} === '*') {&nbsp;</div></li><li><div>                            $this-&gt;status = 'ic';&nbsp;</div></li><li><div>                            ++$i;&nbsp;</div></li><li><div>                            $this-&gt;from[] = 'at';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '{') {&nbsp;</div></li><li><div>                            $this-&gt;status = 'is';&nbsp;</div></li><li><div>                            $this-&gt;at = $this-&gt;css_new_media_section($this-&gt;at);&nbsp;</div></li><li><div>                            $this-&gt;_add_token(AT_START, $this-&gt;at);&nbsp;</div></li><li><div>                        } elseif ($string{$i} === ', ') {&nbsp;</div></li><li><div>                            $this-&gt;at = trim($this-&gt;at) . ', ';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '\\') {&nbsp;</div></li><li><div>                            $this-&gt;at .= $this-&gt;_unicode($string, $i);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // fix for complicated media, i.e @media screen and (-webkit-min-device-pixel-ratio:1.5)&nbsp;</div></li><li><div>                        // '/' is included for ratios in Opera: (-o-min-device-pixel-ratio: 3/2)&nbsp;</div></li><li><div>                        elseif (in_array($string{$i}, array('(', ')', ':', '.', '/'))) {&nbsp;</div></li><li><div>                            $this-&gt;at .= $string{$i};&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $lastpos = strlen($this-&gt;at) - 1;&nbsp;</div></li><li><div>                        if (!( (ctype_space($this-&gt;at{$lastpos}) || csstidy::is_token($this-&gt;at, $lastpos) && $this-&gt;at{$lastpos} === ', ') && ctype_space($string{$i}))) {&nbsp;</div></li><li><div>                            $this-&gt;at .= $string{$i};&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Case in-selector */&nbsp;</div></li><li><div>                case 'is':&nbsp;</div></li><li><div>                    if (csstidy::is_token($string, $i)) {&nbsp;</div></li><li><div>                        if ($string{$i} === '/' && @$string{$i + 1} === '*' && trim($this-&gt;selector) == '') {&nbsp;</div></li><li><div>                            $this-&gt;status = 'ic';&nbsp;</div></li><li><div>                            ++$i;&nbsp;</div></li><li><div>                            $this-&gt;from[] = 'is';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '@' && trim($this-&gt;selector) == '') {&nbsp;</div></li><li><div>                            // Check for at-rule&nbsp;</div></li><li><div>                            $this-&gt;invalid_at = true;&nbsp;</div></li><li><div>                            foreach ($at_rules as $name =&gt; $type) {&nbsp;</div></li><li><div>                                if (!strcasecmp(substr($string, $i + 1, strlen($name)), $name)) {&nbsp;</div></li><li><div>                                    ($type === 'at') ? $this-&gt;at = '@' . $name : $this-&gt;selector = '@' . $name;&nbsp;</div></li><li><div>                                    $this-&gt;status = $type;&nbsp;</div></li><li><div>                                    $i += strlen($name);&nbsp;</div></li><li><div>                                    $this-&gt;invalid_at = false;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ($this-&gt;invalid_at) {&nbsp;</div></li><li><div>                                $this-&gt;selector = '@';&nbsp;</div></li><li><div>                                $invalid_at_name = '';&nbsp;</div></li><li><div>                                for ($j = $i + 1; $j &lt; $size; ++$j) {&nbsp;</div></li><li><div>                                    if (!ctype_alpha($string{$j})) {&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    $invalid_at_name .= $string{$j};&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $this-&gt;log('Invalid @-rule: ' . $invalid_at_name . ' (removed)', 'Warning');&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } elseif (($string{$i} === '&quot;' || $string{$i} === &quot;'&quot;)) {&nbsp;</div></li><li><div>                            $this-&gt;cur_string[] = $string{$i};&nbsp;</div></li><li><div>                            $this-&gt;status = 'instr';&nbsp;</div></li><li><div>                            $this-&gt;str_char[] = $string{$i};&nbsp;</div></li><li><div>                            $this-&gt;from[] = 'is';&nbsp;</div></li><li><div>                            /** fixing CSS3 attribute selectors, i.e. a[href$=&quot;.mp3&quot; */&nbsp;</div></li><li><div>                            $this-&gt;quoted_string[] = ($string{$i - 1} == '=' );&nbsp;</div></li><li><div>                        } elseif ($this-&gt;invalid_at && $string{$i} === ';') {&nbsp;</div></li><li><div>                            $this-&gt;invalid_at = false;&nbsp;</div></li><li><div>                            $this-&gt;status = 'is';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '{') {&nbsp;</div></li><li><div>                            $this-&gt;status = 'ip';&nbsp;</div></li><li><div>                            if($this-&gt;at == '') {&nbsp;</div></li><li><div>                                $this-&gt;at = $this-&gt;css_new_media_section(DEFAULT_AT);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $this-&gt;selector = $this-&gt;css_new_selector($this-&gt;at, $this-&gt;selector);&nbsp;</div></li><li><div>                            $this-&gt;_add_token(SEL_START, $this-&gt;selector);&nbsp;</div></li><li><div>                            $this-&gt;added = false;&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '}') {&nbsp;</div></li><li><div>                            $this-&gt;_add_token(AT_END, $this-&gt;at);&nbsp;</div></li><li><div>                            $this-&gt;at = '';&nbsp;</div></li><li><div>                            $this-&gt;selector = '';&nbsp;</div></li><li><div>                            $this-&gt;sel_separate = array();&nbsp;</div></li><li><div>                        } elseif ($string{$i} === ', ') {&nbsp;</div></li><li><div>                            $this-&gt;selector = trim($this-&gt;selector) . ', ';&nbsp;</div></li><li><div>                            $this-&gt;sel_separate[] = strlen($this-&gt;selector);&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '\\') {&nbsp;</div></li><li><div>                            $this-&gt;selector .= $this-&gt;_unicode($string, $i);&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '*' && @in_array($string{$i + 1}, array('.', '#', '[', ':'))) {&nbsp;</div></li><li><div>                            // remove unnecessary universal selector, FS#147&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $this-&gt;selector .= $string{$i};&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $lastpos = strlen($this-&gt;selector) - 1;&nbsp;</div></li><li><div>                        if ($lastpos == -1 || !( (ctype_space($this-&gt;selector{$lastpos}) || csstidy::is_token($this-&gt;selector, $lastpos) && $this-&gt;selector{$lastpos} === ', ') && ctype_space($string{$i}))) {&nbsp;</div></li><li><div>                            $this-&gt;selector .= $string{$i};&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        else if (ctype_space($string{$i}) && $this-&gt;get_cfg('preserve_css') && !$this-&gt;get_cfg('merge_selectors')) {&nbsp;</div></li><li><div>                            $this-&gt;selector .= $string{$i};&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Case in-property */&nbsp;</div></li><li><div>                case 'ip':&nbsp;</div></li><li><div>                    if (csstidy::is_token($string, $i)) {&nbsp;</div></li><li><div>                        if (($string{$i} === ':' || $string{$i} === '=') && $this-&gt;property != '') {&nbsp;</div></li><li><div>                            $this-&gt;status = 'iv';&nbsp;</div></li><li><div>                            if (!$this-&gt;get_cfg('discard_invalid_properties') || csstidy::property_is_valid($this-&gt;property)) {&nbsp;</div></li><li><div>                                $this-&gt;property = $this-&gt;css_new_property($this-&gt;at, $this-&gt;selector, $this-&gt;property);&nbsp;</div></li><li><div>                                $this-&gt;_add_token(PROPERTY, $this-&gt;property);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '/' && @$string{$i + 1} === '*' && $this-&gt;property == '') {&nbsp;</div></li><li><div>                            $this-&gt;status = 'ic';&nbsp;</div></li><li><div>                            ++$i;&nbsp;</div></li><li><div>                            $this-&gt;from[] = 'ip';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '}') {&nbsp;</div></li><li><div>                            $this-&gt;explode_selectors();&nbsp;</div></li><li><div>                            $this-&gt;status = 'is';&nbsp;</div></li><li><div>                            $this-&gt;invalid_at = false;&nbsp;</div></li><li><div>                            $this-&gt;_add_token(SEL_END, $this-&gt;selector);&nbsp;</div></li><li><div>                            $this-&gt;selector = '';&nbsp;</div></li><li><div>                            $this-&gt;property = '';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === ';') {&nbsp;</div></li><li><div>                            $this-&gt;property = '';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '\\') {&nbsp;</div></li><li><div>                            $this-&gt;property .= $this-&gt;_unicode($string, $i);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // else this is dumb IE a hack, keep it&nbsp;</div></li><li><div>                        elseif ($this-&gt;property=='' AND !ctype_space($string{$i})) {&nbsp;</div></li><li><div>                            $this-&gt;property .= $string{$i};&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif (!ctype_space($string{$i})) {&nbsp;</div></li><li><div>                        $this-&gt;property .= $string{$i};&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Case in-value */&nbsp;</div></li><li><div>                case 'iv':&nbsp;</div></li><li><div>                    $pn = (($string{$i} === &quot;\n&quot; || $string{$i} === &quot;\r&quot;) && $this-&gt;property_is_next($string, $i + 1) || $i == strlen($string) - 1);&nbsp;</div></li><li><div>                    if ((csstidy::is_token($string, $i) || $pn) && (!($string{$i} == ', ' && !ctype_space($string{$i+1})))) {&nbsp;</div></li><li><div>                        if ($string{$i} === '/' && @$string{$i + 1} === '*') {&nbsp;</div></li><li><div>                            $this-&gt;status = 'ic';&nbsp;</div></li><li><div>                            ++$i;&nbsp;</div></li><li><div>                            $this-&gt;from[] = 'iv';&nbsp;</div></li><li><div>                        } elseif (($string{$i} === '&quot;' || $string{$i} === &quot;'&quot; || $string{$i} === '(')) {&nbsp;</div></li><li><div>                            $this-&gt;cur_string[] = $string{$i};&nbsp;</div></li><li><div>                            $this-&gt;str_char[] = ($string{$i} === '(') ? ')' : $string{$i};&nbsp;</div></li><li><div>                            $this-&gt;status = 'instr';&nbsp;</div></li><li><div>                            $this-&gt;from[] = 'iv';&nbsp;</div></li><li><div>                            $this-&gt;quoted_string[] = in_array(strtolower($this-&gt;property), $quoted_string_properties);&nbsp;</div></li><li><div>                        } elseif ($string{$i} === ', ') {&nbsp;</div></li><li><div>                            $this-&gt;sub_value = trim($this-&gt;sub_value) . ', ';&nbsp;</div></li><li><div>                        } elseif ($string{$i} === '\\') {&nbsp;</div></li><li><div>                            $this-&gt;sub_value .= $this-&gt;_unicode($string, $i);&nbsp;</div></li><li><div>                        } elseif ($string{$i} === ';' || $pn) {&nbsp;</div></li><li><div>                            if ($this-&gt;selector{0} === '@' && isset($at_rules[substr($this-&gt;selector, 1)]) && $at_rules[substr($this-&gt;selector, 1)] === 'iv') {&nbsp;</div></li><li><div>                                $this-&gt;status = 'is';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                switch ($this-&gt;selector) {&nbsp;</div></li><li><div>                                    case '@charset':&nbsp;</div></li><li><div>                                        /** Add quotes to charset */&nbsp;</div></li><li><div>                                        $this-&gt;sub_value_arr[] = '&quot;' . trim($this-&gt;sub_value) . '&quot;';&nbsp;</div></li><li><div>                                        $this-&gt;charset = $this-&gt;sub_value_arr[0];&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    case '@namespace':&nbsp;</div></li><li><div>                                        /** Add quotes to namespace */&nbsp;</div></li><li><div>                                        $this-&gt;sub_value_arr[] = '&quot;' . trim($this-&gt;sub_value) . '&quot;';&nbsp;</div></li><li><div>                                        $this-&gt;namespace = implode(' ', $this-&gt;sub_value_arr);&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    case '@import':&nbsp;</div></li><li><div>                                        $this-&gt;sub_value = trim($this-&gt;sub_value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        if (empty($this-&gt;sub_value_arr)) {&nbsp;</div></li><li><div>                                            // Quote URLs in imports only if they're not already inside url() and not already quoted.&nbsp;</div></li><li><div>                                            if (substr($this-&gt;sub_value, 0, 4) != 'url(') {&nbsp;</div></li><li><div>                                                if (!($this-&gt;sub_value{0} == substr($this-&gt;sub_value, -1) && in_array($this-&gt;sub_value{0}, array(&quot;'&quot;, '&quot;')))) {&nbsp;</div></li><li><div>                                                    $this-&gt;sub_value = '&quot;' . $this-&gt;sub_value . '&quot;';&nbsp;</div></li><li><div>                                                }&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $this-&gt;sub_value_arr[] = $this-&gt;sub_value;&nbsp;</div></li><li><div>                                        $this-&gt;import[] = implode(' ', $this-&gt;sub_value_arr);&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $this-&gt;sub_value_arr = array();&nbsp;</div></li><li><div>                                $this-&gt;sub_value = '';&nbsp;</div></li><li><div>                                $this-&gt;selector = '';&nbsp;</div></li><li><div>                                $this-&gt;sel_separate = array();&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $this-&gt;status = 'ip';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } elseif ($string{$i} !== '}') {&nbsp;</div></li><li><div>                            $this-&gt;sub_value .= $string{$i};&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if (($string{$i} === '}' || $string{$i} === ';' || $pn) && !empty($this-&gt;selector)) {&nbsp;</div></li><li><div>                            if ($this-&gt;at == '') {&nbsp;</div></li><li><div>                                $this-&gt;at = $this-&gt;css_new_media_section(DEFAULT_AT);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // case settings&nbsp;</div></li><li><div>                            if ($this-&gt;get_cfg('lowercase_s')) {&nbsp;</div></li><li><div>                                $this-&gt;selector = strtolower($this-&gt;selector);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $this-&gt;property = strtolower($this-&gt;property);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $this-&gt;optimise-&gt;subvalue();&nbsp;</div></li><li><div>                            if ($this-&gt;sub_value != '') {&nbsp;</div></li><li><div>                                if (substr($this-&gt;sub_value, 0, 6) == 'format') {&nbsp;</div></li><li><div>                                    $format_strings = csstidy::parse_string_list(substr($this-&gt;sub_value, 7, -1));&nbsp;</div></li><li><div>                                    if (!$format_strings) {&nbsp;</div></li><li><div>                                        $this-&gt;sub_value = &quot;&quot;;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    else {&nbsp;</div></li><li><div>                                        $this-&gt;sub_value = &quot;format(&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        foreach ($format_strings as $format_string) {&nbsp;</div></li><li><div>                                            $this-&gt;sub_value .= '&quot;' . str_replace('&quot;', '\\&quot;', $format_string) . '&quot;, ';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $this-&gt;sub_value = substr($this-&gt;sub_value, 0, -1) . &quot;)&quot;;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                if ($this-&gt;sub_value != '') {&nbsp;</div></li><li><div>                                    $this-&gt;sub_value_arr[] = $this-&gt;sub_value;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $this-&gt;sub_value = '';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $this-&gt;value = array_shift($this-&gt;sub_value_arr);&nbsp;</div></li><li><div>                            while(count($this-&gt;sub_value_arr)) {&nbsp;</div></li><li><div>                                //$this-&gt;value .= (substr($this-&gt;value, -1, 1)==', '?'':' ').array_shift($this-&gt;sub_value_arr);&nbsp;</div></li><li><div>                                $this-&gt;value .= ' '.array_shift($this-&gt;sub_value_arr);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $this-&gt;optimise-&gt;value();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $valid = csstidy::property_is_valid($this-&gt;property);&nbsp;</div></li><li><div>                            if ((!$this-&gt;invalid_at || $this-&gt;get_cfg('preserve_css')) && (!$this-&gt;get_cfg('discard_invalid_properties') || $valid)) {&nbsp;</div></li><li><div>                                $this-&gt;css_add_property($this-&gt;at, $this-&gt;selector, $this-&gt;property, $this-&gt;value);&nbsp;</div></li><li><div>                                $this-&gt;_add_token(VALUE, $this-&gt;value);&nbsp;</div></li><li><div>                                $this-&gt;optimise-&gt;shorthands();&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if (!$valid) {&nbsp;</div></li><li><div>                                if ($this-&gt;get_cfg('discard_invalid_properties')) {&nbsp;</div></li><li><div>                                    $this-&gt;log('Removed invalid property: ' . $this-&gt;property, 'Warning');&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $this-&gt;log('Invalid property in ' . strtoupper($this-&gt;get_cfg('css_level')) . ': ' . $this-&gt;property, 'Warning');&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $this-&gt;property = '';&nbsp;</div></li><li><div>                            $this-&gt;sub_value_arr = array();&nbsp;</div></li><li><div>                            $this-&gt;value = '';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if ($string{$i} === '}') {&nbsp;</div></li><li><div>                            $this-&gt;explode_selectors();&nbsp;</div></li><li><div>                            $this-&gt;_add_token(SEL_END, $this-&gt;selector);&nbsp;</div></li><li><div>                            $this-&gt;status = 'is';&nbsp;</div></li><li><div>                            $this-&gt;invalid_at = false;&nbsp;</div></li><li><div>                            $this-&gt;selector = '';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } elseif (!$pn) {&nbsp;</div></li><li><div>                        $this-&gt;sub_value .= $string{$i};&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (ctype_space($string{$i}) || $string{$i} == ', ') {&nbsp;</div></li><li><div>                            $this-&gt;optimise-&gt;subvalue();&nbsp;</div></li><li><div>                            if ($this-&gt;sub_value != '') {&nbsp;</div></li><li><div>                                $this-&gt;sub_value_arr[] = $this-&gt;sub_value;&nbsp;</div></li><li><div>                                $this-&gt;sub_value = '';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Case in string */&nbsp;</div></li><li><div>                case 'instr':&nbsp;</div></li><li><div>                    $_str_char = $this-&gt;str_char[count($this-&gt;str_char)-1];&nbsp;</div></li><li><div>                    $_cur_string = $this-&gt;cur_string[count($this-&gt;cur_string)-1];&nbsp;</div></li><li><div>                    $temp_add = $string{$i};&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Add another string to the stack. Strings can't be nested inside of quotes, only parentheses, but&nbsp;</div></li><li><div>                    // parentheticals can be nested more than once.&nbsp;</div></li><li><div>                    if ($_str_char === &quot;)&quot; && ($string{$i} === &quot;(&quot; || $string{$i} === '&quot;' || $string{$i} === '\'') && !csstidy::escaped($string, $i)) {&nbsp;</div></li><li><div>                        $this-&gt;cur_string[] = $string{$i};&nbsp;</div></li><li><div>                        $this-&gt;str_char[] = $string{$i} == &quot;(&quot; ? &quot;)&quot; : $string{$i};&nbsp;</div></li><li><div>                        $this-&gt;from[] = 'instr';&nbsp;</div></li><li><div>                        $this-&gt;quoted_string[] = !($string{$i} === &quot;(&quot;);&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($_str_char !== &quot;)&quot; && ($string{$i} === &quot;\n&quot; || $string{$i} === &quot;\r&quot;) && !($string{$i - 1} === '\\' && !csstidy::escaped($string, $i - 1))) {&nbsp;</div></li><li><div>                        $temp_add = &quot;\\A&quot;;&nbsp;</div></li><li><div>                        $this-&gt;log('Fixed incorrect newline in string', 'Warning');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $_cur_string .= $temp_add;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($string{$i} === $_str_char && !csstidy::escaped($string, $i)) {&nbsp;</div></li><li><div>                        $_quoted_string = array_pop($this-&gt;quoted_string);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;status = array_pop($this-&gt;from);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (!preg_match('|[' . implode('', $GLOBALS['csstidy']['whitespace']) . ']|uis', $_cur_string) && $this-&gt;property !== 'content') {&nbsp;</div></li><li><div>                            if (!$_quoted_string) {&nbsp;</div></li><li><div>                                if ($_str_char !== ')') {&nbsp;</div></li><li><div>                                    // Convert properties like&nbsp;</div></li><li><div>                                    // font-family: 'Arial';&nbsp;</div></li><li><div>                                    // to&nbsp;</div></li><li><div>                                    // font-family: Arial;&nbsp;</div></li><li><div>                                    // or&nbsp;</div></li><li><div>                                    // url(&quot;abc&quot;)&nbsp;</div></li><li><div>                                    // to&nbsp;</div></li><li><div>                                    // url(abc)&nbsp;</div></li><li><div>                                    $_cur_string = substr($_cur_string, 1, -1);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $_quoted_string = false;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        array_pop($this-&gt;cur_string);&nbsp;</div></li><li><div>                        array_pop($this-&gt;str_char);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($_str_char === &quot;)&quot;) {&nbsp;</div></li><li><div>                            $_cur_string = &quot;(&quot; . trim(substr($_cur_string, 1, -1)) . &quot;)&quot;;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($this-&gt;status === 'iv') {&nbsp;</div></li><li><div>                            if (!$_quoted_string) {&nbsp;</div></li><li><div>                                if (strpos($_cur_string, ', ')!==false)&nbsp;</div></li><li><div>                                    // we can on only remove space next to ', '&nbsp;</div></li><li><div>                                    $_cur_string = implode(', ', array_map('trim', explode(', ', $_cur_string)));&nbsp;</div></li><li><div>                                // and multiple spaces (too expensive)&nbsp;</div></li><li><div>                                if (strpos($_cur_string, '  ')!==false)&nbsp;</div></li><li><div>                                    $_cur_string = preg_replace(&quot;, \s+, &quot;, &quot; &quot;, $_cur_string);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $this-&gt;sub_value .= $_cur_string;&nbsp;</div></li><li><div>                        } elseif ($this-&gt;status === 'is') {&nbsp;</div></li><li><div>                            $this-&gt;selector .= $_cur_string;&nbsp;</div></li><li><div>                        } elseif ($this-&gt;status === 'instr') {&nbsp;</div></li><li><div>                            $this-&gt;cur_string[count($this-&gt;cur_string)-1] .= $_cur_string;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $this-&gt;cur_string[count($this-&gt;cur_string)-1] = $_cur_string;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                /** Case in-comment */&nbsp;</div></li><li><div>                case 'ic':&nbsp;</div></li><li><div>                    if ($string{$i} === '*' && $string{$i + 1} === '/') {&nbsp;</div></li><li><div>                        $this-&gt;status = array_pop($this-&gt;from);&nbsp;</div></li><li><div>                        $i++;&nbsp;</div></li><li><div>                        $this-&gt;_add_token(COMMENT, $cur_comment);&nbsp;</div></li><li><div>                        $cur_comment = '';&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $cur_comment .= $string{$i};&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;optimise-&gt;postparse();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;print-&gt;_reset();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        @setlocale(LC_ALL, $old); // Set locale back to original setting&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return!(empty($this-&gt;css) && empty($this-&gt;import) && empty($this-&gt;charset) && empty($this-&gt;tokens) && empty($this-&gt;namespace));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Explodes selectors&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function explode_selectors() {&nbsp;</div></li><li><div>        // Explode multiple selectors&nbsp;</div></li><li><div>        if ($this-&gt;get_cfg('merge_selectors') === 1) {&nbsp;</div></li><li><div>            $new_sels = array();&nbsp;</div></li><li><div>            $lastpos = 0;&nbsp;</div></li><li><div>            $this-&gt;sel_separate[] = strlen($this-&gt;selector);&nbsp;</div></li><li><div>            foreach ($this-&gt;sel_separate as $num =&gt; $pos) {&nbsp;</div></li><li><div>                if ($num == count($this-&gt;sel_separate) - 1) {&nbsp;</div></li><li><div>                    $pos += 1;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $new_sels[] = substr($this-&gt;selector, $lastpos, $pos - $lastpos - 1);&nbsp;</div></li><li><div>                $lastpos = $pos;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (count($new_sels) &gt; 1) {&nbsp;</div></li><li><div>                foreach ($new_sels as $selector) {&nbsp;</div></li><li><div>                    if (isset($this-&gt;css[$this-&gt;at][$this-&gt;selector])) {&nbsp;</div></li><li><div>                        $this-&gt;merge_css_blocks($this-&gt;at, $selector, $this-&gt;css[$this-&gt;at][$this-&gt;selector]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                unset($this-&gt;css[$this-&gt;at][$this-&gt;selector]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;sel_separate = array();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if a character is escaped (and returns true if it is)&nbsp;</div></li><li><div>     * @param string $string&nbsp;</div></li><li><div>     * @param integer $pos&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @version 1.02&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static function escaped(&$string, $pos) {&nbsp;</div></li><li><div>        return!(@($string{$pos - 1} !== '\\') || csstidy::escaped($string, $pos - 1));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a property with value to the existing CSS code&nbsp;</div></li><li><div>     * @param string $media&nbsp;</div></li><li><div>     * @param string $selector&nbsp;</div></li><li><div>     * @param string $property&nbsp;</div></li><li><div>     * @param string $new_val&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function css_add_property($media, $selector, $property, $new_val) {&nbsp;</div></li><li><div>        if ($this-&gt;get_cfg('preserve_css') || trim($new_val) == '') {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;added = true;&nbsp;</div></li><li><div>        if (isset($this-&gt;css[$media][$selector][$property])) {&nbsp;</div></li><li><div>            if ((csstidy::is_important($this-&gt;css[$media][$selector][$property]) && csstidy::is_important($new_val)) || !csstidy::is_important($this-&gt;css[$media][$selector][$property])) {&nbsp;</div></li><li><div>                $this-&gt;css[$media][$selector][$property] = trim($new_val);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;css[$media][$selector][$property] = trim($new_val);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Start a new media section.&nbsp;</div></li><li><div>     * Check if the media is not already known, &nbsp;</div></li><li><div>     * else rename it with extra spaces&nbsp;</div></li><li><div>     * to avoid merging&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $media&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function css_new_media_section($media) {&nbsp;</div></li><li><div>        if($this-&gt;get_cfg('preserve_css')) {&nbsp;</div></li><li><div>            return $media;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if the last @media is the same as this&nbsp;</div></li><li><div>        // keep it&nbsp;</div></li><li><div>        if (!$this-&gt;css OR !is_array($this-&gt;css) OR empty($this-&gt;css)) {&nbsp;</div></li><li><div>            return $media;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        end($this-&gt;css);&nbsp;</div></li><li><div>        list($at, ) = each($this-&gt;css);&nbsp;</div></li><li><div>        if ($at == $media) {&nbsp;</div></li><li><div>            return $media;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        while (isset($this-&gt;css[$media]))&nbsp;</div></li><li><div>            if (is_numeric($media))&nbsp;</div></li><li><div>                $media++;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $media .= &quot; &quot;;&nbsp;</div></li><li><div>        return $media;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Start a new selector.&nbsp;</div></li><li><div>     * If already referenced in this media section, &nbsp;</div></li><li><div>     * rename it with extra space to avoid merging&nbsp;</div></li><li><div>     * except if merging is required, &nbsp;</div></li><li><div>     * or last selector is the same (merge siblings)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * never merge @font-face&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $media&nbsp;</div></li><li><div>     * @param string $selector&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function css_new_selector($media, $selector) {&nbsp;</div></li><li><div>        if($this-&gt;get_cfg('preserve_css')) {&nbsp;</div></li><li><div>            return $selector;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $selector = trim($selector);&nbsp;</div></li><li><div>        if (strncmp($selector, &quot;@font-face&quot;, 10)!=0) {&nbsp;</div></li><li><div>            if ($this-&gt;settings['merge_selectors'] != false)&nbsp;</div></li><li><div>                return $selector;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!$this-&gt;css OR !isset($this-&gt;css[$media]) OR !$this-&gt;css[$media])&nbsp;</div></li><li><div>                return $selector;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if last is the same, keep it&nbsp;</div></li><li><div>            end($this-&gt;css[$media]);&nbsp;</div></li><li><div>            list($sel, ) = each($this-&gt;css[$media]);&nbsp;</div></li><li><div>            if ($sel == $selector) {&nbsp;</div></li><li><div>                return $selector;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (isset($this-&gt;css[$media][$selector]))&nbsp;</div></li><li><div>            $selector .= &quot; &quot;;&nbsp;</div></li><li><div>        return $selector;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Start a new propertie.&nbsp;</div></li><li><div>     * If already references in this selector, &nbsp;</div></li><li><div>     * rename it with extra space to avoid override&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $media&nbsp;</div></li><li><div>     * @param string $selector&nbsp;</div></li><li><div>     * @param string $property&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function css_new_property($media, $selector, $property) {&nbsp;</div></li><li><div>        if($this-&gt;get_cfg('preserve_css')) {&nbsp;</div></li><li><div>            return $property;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!$this-&gt;css OR !isset($this-&gt;css[$media][$selector]) OR !$this-&gt;css[$media][$selector])&nbsp;</div></li><li><div>            return $property;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (isset($this-&gt;css[$media][$selector][$property]))&nbsp;</div></li><li><div>            $property .= &quot; &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $property;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds CSS to an existing media/selector&nbsp;</div></li><li><div>     * @param string $media&nbsp;</div></li><li><div>     * @param string $selector&nbsp;</div></li><li><div>     * @param array $css_add&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function merge_css_blocks($media, $selector, $css_add) {&nbsp;</div></li><li><div>        foreach ($css_add as $property =&gt; $value) {&nbsp;</div></li><li><div>            $this-&gt;css_add_property($media, $selector, $property, $value, false);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if $value is !important.&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static function is_important(&$value) {&nbsp;</div></li><li><div>        return (!strcasecmp(substr(str_replace($GLOBALS['csstidy']['whitespace'], '', $value), -10, 10), '!important'));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a value without !important&nbsp;</div></li><li><div>     * @param string $value&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static function gvw_important($value) {&nbsp;</div></li><li><div>        if (csstidy::is_important($value)) {&nbsp;</div></li><li><div>            $value = trim($value);&nbsp;</div></li><li><div>            $value = substr($value, 0, -9);&nbsp;</div></li><li><div>            $value = trim($value);&nbsp;</div></li><li><div>            $value = substr($value, 0, -1);&nbsp;</div></li><li><div>            $value = trim($value);&nbsp;</div></li><li><div>            return $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if the next word in a string from pos is a CSS property&nbsp;</div></li><li><div>     * @param string $istring&nbsp;</div></li><li><div>     * @param integer $pos&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @version 1.2&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function property_is_next($istring, $pos) {&nbsp;</div></li><li><div>        $all_properties = & $GLOBALS['csstidy']['all_properties'];&nbsp;</div></li><li><div>        $istring = substr($istring, $pos, strlen($istring) - $pos);&nbsp;</div></li><li><div>        $pos = strpos($istring, ':');&nbsp;</div></li><li><div>        if ($pos === false) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $istring = strtolower(trim(substr($istring, 0, $pos)));&nbsp;</div></li><li><div>        if (isset($all_properties[$istring])) {&nbsp;</div></li><li><div>            $this-&gt;log('Added semicolon to the end of declaration', 'Warning');&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks if a property is valid&nbsp;</div></li><li><div>     * @param string $property&nbsp;</div></li><li><div>     * @return bool;&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @version 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function property_is_valid($property) {&nbsp;</div></li><li><div>        $property = strtolower($property);&nbsp;</div></li><li><div>        if (in_array(trim($property), $GLOBALS['csstidy']['multiple_properties'])) $property = trim($property);&nbsp;</div></li><li><div>        $all_properties = & $GLOBALS['csstidy']['all_properties'];&nbsp;</div></li><li><div>        return (isset($all_properties[$property]) && strpos($all_properties[$property], strtoupper($this-&gt;get_cfg('css_level'))) !== false );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Accepts a list of strings (e.g., the argument to format() in a @font-face src property)&nbsp;</div></li><li><div>     * and returns a list of the strings.  Converts things like:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * format(abc) =&gt; format(&quot;abc&quot;)&nbsp;</div></li><li><div>     * format(abc def) =&gt; format(&quot;abc&quot;, &quot;def&quot;)&nbsp;</div></li><li><div>     * format(abc &quot;def&quot;) =&gt; format(&quot;abc&quot;, &quot;def&quot;)&nbsp;</div></li><li><div>     * format(abc, def, ghi) =&gt; format(&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;)&nbsp;</div></li><li><div>     * format(&quot;abc&quot;, 'def') =&gt; format(&quot;abc&quot;, &quot;def&quot;)&nbsp;</div></li><li><div>     * format(&quot;abc, def, ghi&quot;) =&gt; format(&quot;abc, def, ghi&quot;)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function parse_string_list($value) {&nbsp;</div></li><li><div>        $value = trim($value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Case: empty&nbsp;</div></li><li><div>        if (!$value) return array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $strings = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $in_str = false;&nbsp;</div></li><li><div>        $current_string = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ($i = 0, $_len = strlen($value); $i &lt; $_len; $i++) {&nbsp;</div></li><li><div>            if (($value{$i} == &quot;, &quot; || $value{$i} === &quot; &quot;) && $in_str === true) {&nbsp;</div></li><li><div>                $in_str = false;&nbsp;</div></li><li><div>                $strings[] = $current_string;&nbsp;</div></li><li><div>                $current_string = &quot;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else if ($value{$i} == '&quot;' || $value{$i} == &quot;'&quot;) {&nbsp;</div></li><li><div>                if ($in_str === $value{$i}) {&nbsp;</div></li><li><div>                    $strings[] = $current_string;&nbsp;</div></li><li><div>                    $in_str = false;&nbsp;</div></li><li><div>                    $current_string = &quot;&quot;;&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else if (!$in_str) {&nbsp;</div></li><li><div>                    $in_str = $value{$i};&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                if ($in_str) {&nbsp;</div></li><li><div>                    $current_string .= $value{$i};&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    if (!preg_match(&quot;/[\s, ]/&quot;, $value{$i})) {&nbsp;</div></li><li><div>                        $in_str = true;&nbsp;</div></li><li><div>                        $current_string = $value{$i};&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($current_string) {&nbsp;</div></li><li><div>            $strings[] = $current_string;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $strings;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.2/classes/csstidy/" class="">3.8.2</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.1/classes/csstidy/" class="">3.8.1</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/csstidy/" class="active">3.8.0</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.7.2/classes/csstidy/" class="">3.7.2</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.7.1/classes/csstidy/" class="">3.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>csstidy</li><li><span></span>Jetpack by WordPress.com</li><li><span></span>3.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>