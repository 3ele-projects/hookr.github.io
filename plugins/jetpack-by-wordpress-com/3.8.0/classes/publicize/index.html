<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="3.8.0" data-slug="jetpack-by-wordpress-com" data-type="class" data-id="13339"><head xmlns="http://www.w3.org/1999/xhtml"><title> publicize | class | Jetpack By WordPress Com | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Publicize, class, plugin, jetpack-by-wordpress-com, 3.8.0" /><meta name="description" content="The Jetpack by WordPress.com Publicize class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=335e5cd4c4d08d51011756ec064ba91f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/publicize/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpublicize%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpublicize%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-jetpack-by-wordpress-com-3.8.0-class-publicize","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="publicize" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to jetpack-by-wordpress-com." href="http://hookr.io/plugins/jetpack-by-wordpress-com/" class="plugin"><span property="name">jetpack-by-wordpress-com</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.8.0." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/" class="H_VERSION"><span property="name">3.8.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">publicize</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="1499"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/all/" title="All">All <span class="count badge">1499</span></a></li><li class="" data-id="new" data-count="17"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/new/" title="New">New <span class="count badge">17</span></a></li><li class="" data-id="hooks" data-count="599"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/hooks/" title="Hooks">Hooks <span class="count badge">599</span></a></li><li class="" data-id="action" data-count="195"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/actions/" title="Actions">Actions <span class="count badge">195</span></a></li><li class="" data-id="filter" data-count="404"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/filters/" title="Filters">Filters <span class="count badge">404</span></a></li><li class="active" data-id="class" data-count="262"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/" title="Classes">Classes <span class="count badge">262</span></a></li><li class="" data-id="constant" data-count="62"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/constants/" title="Constants">Constants <span class="count badge">62</span></a></li><li class="" data-id="function" data-count="530"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/functions/" title="Functions">Functions <span class="count badge">530</span></a></li><li class="" data-id="shortcode" data-count="46"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">46</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Publicize</strong></h1><p>The Jetpack by WordPress.com <strong>Publicize</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/files/modules-publicize-publicize-jetpack/" class="file">/modules/publicize/publicize-jetpack.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="3" class="block" start="3"><li><div>class Publicize extends Publicize_Base {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function __construct() {&nbsp;</div></li><li><div>        parent::__construct();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'jetpack_xmlrpc_methods', array( $this, 'register_update_publicize_connections_xmlrpc_method' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'load-settings_page_sharing', array( $this, 'admin_page_load' ), 9 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_tumblr_options_page', array( $this, 'options_page_tumblr' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_facebook_options_page', array( $this, 'options_page_facebook' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_twitter_options_page', array( $this, 'options_page_twitter' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_linkedin_options_page', array( $this, 'options_page_linkedin' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_path_options_page', array( $this, 'options_page_path' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_google_plus_options_page', array( $this, 'options_page_google_plus' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_tumblr_options_save', array( $this, 'options_save_tumblr' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_facebook_options_save', array( $this, 'options_save_facebook' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_twitter_options_save', array( $this, 'options_save_twitter' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_linkedin_options_save', array( $this, 'options_save_linkedin' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_path_options_save', array( $this, 'options_save_path' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_publicize_google_plus_options_save', array( $this, 'options_save_google_plus' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'load-settings_page_sharing', array( $this, 'force_user_connection' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'publicize_checkbox_default', array( $this, 'publicize_checkbox_default' ), 10, 4 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'transition_post_status', array( $this, 'save_publicized' ), 10, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'jetpack_twitter_cards_site_tag', array( $this, 'enhaced_twitter_cards_site_tag' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'publicize_save_meta', array( $this, 'save_publicized_twitter_account' ), 10, 4 );&nbsp;</div></li><li><div>        add_action( 'publicize_save_meta', array( $this, 'save_publicized_facebook_account' ), 10, 4 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'jetpack_sharing_twitter_via', array( $this, 'get_publicized_twitter_account' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        include_once ( JETPACK__PLUGIN_DIR . 'modules/publicize/enhanced-open-graph.php' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function force_user_connection() {&nbsp;</div></li><li><div>        global $current_user;&nbsp;</div></li><li><div>        $user_token = Jetpack_Data::get_access_token( $current_user-&gt;ID );&nbsp;</div></li><li><div>        $is_user_connected = $user_token && !is_wp_error( $user_token );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If the user is already connected via Jetpack, then we're good&nbsp;</div></li><li><div>        if ( $is_user_connected )&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If they're not connected, then remove the Publicize UI and tell them they need to connect first&nbsp;</div></li><li><div>        global $publicize_ui;&nbsp;</div></li><li><div>        remove_action( 'pre_admin_screen_sharing', array( $publicize_ui, 'admin_page' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do we really need `admin_styles`? With the new admin UI, it's breaking some bits.&nbsp;</div></li><li><div>        // Jetpack::init()-&gt;admin_styles();&nbsp;</div></li><li><div>        add_action( 'pre_admin_screen_sharing', array( $this, 'admin_page_warning' ), 1 );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_page_warning() {&nbsp;</div></li><li><div>        $jetpack = Jetpack::init();&nbsp;</div></li><li><div>        $blog_name = get_bloginfo( 'blogname' );&nbsp;</div></li><li><div>        if ( empty( $blog_name ) ) {&nbsp;</div></li><li><div>            $blog_name = home_url( '/' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;message&quot; class=&quot;updated jetpack-message jp-connect&quot;&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;jetpack-wrap-container&quot;&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;jetpack-text-container&quot;&gt;&nbsp;</div></li><li><div>                    &lt;h4&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;?php printf(&nbsp;</div></li><li><div>                        esc_html( wptexturize( __( &quot;To use Publicize, you'll need to link your %s account to your WordPress.com account using the link below.&quot;, 'jetpack' ) ) ), &nbsp;</div></li><li><div>                        '&lt;strong&gt;' . esc_html( $blog_name ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;?php echo esc_html( wptexturize( __( &quot;If you don't have a WordPress.com account yet, you can sign up for free in just a few seconds.&quot;, 'jetpack' ) ) ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;/h4&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;jetpack-install-container&quot;&gt;&nbsp;</div></li><li><div>                    &lt;p class=&quot;submit&quot;&gt;&lt;a href=&quot;&lt;?php echo $jetpack-&gt;build_connect_url( false, menu_page_url( 'sharing', false ) ); ?&gt;&quot; class=&quot;button-connector&quot; id=&quot;wpcom-connect&quot;&gt;&lt;?php esc_html_e( 'Link account with WordPress.com', 'jetpack' ); ?&gt;&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove a Publicize connection&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function disconnect( $service_name, $connection_id, $_blog_id = false, $_user_id = false, $force_delete = false ) {&nbsp;</div></li><li><div>        Jetpack::load_xml_rpc_client();&nbsp;</div></li><li><div>        $xml = new Jetpack_IXR_Client();&nbsp;</div></li><li><div>        $xml-&gt;query( 'jetpack.deletePublicizeConnection', $connection_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! $xml-&gt;isError() ) {&nbsp;</div></li><li><div>            Jetpack_Options::update_option( 'publicize_connections', $xml-&gt;getResponse() );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function receive_updated_publicize_connections( $publicize_connections ) {&nbsp;</div></li><li><div>        Jetpack_Options::update_option( 'publicize_connections', $publicize_connections );&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function register_update_publicize_connections_xmlrpc_method( $methods ) {&nbsp;</div></li><li><div>        return array_merge( $methods, array(&nbsp;</div></li><li><div>            'jetpack.updatePublicizeConnections' =&gt; array( $this, 'receive_updated_publicize_connections' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_connections( $service_name, $_blog_id = false, $_user_id = false ) {&nbsp;</div></li><li><div>        $connections = Jetpack_Options::get_option( 'publicize_connections' );&nbsp;</div></li><li><div>        $connections_to_return = array();&nbsp;</div></li><li><div>        if ( !empty( $connections ) && is_array( $connections ) ) {&nbsp;</div></li><li><div>            if ( !empty( $connections[$service_name] ) ) {&nbsp;</div></li><li><div>                foreach( $connections[$service_name] as $id =&gt; $connection ) {&nbsp;</div></li><li><div>                    if ( 0 == $connection['connection_data']['user_id'] || $this-&gt;user_id() == $connection['connection_data']['user_id'] ) {&nbsp;</div></li><li><div>                        $connections_to_return[$id] = $connection;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $connections_to_return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_connection_id( $connection ) {&nbsp;</div></li><li><div>        return $connection['connection_data']['id'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_connection_meta( $connection ) {&nbsp;</div></li><li><div>        $connection['user_id'] = $connection['connection_data']['user_id']; // Allows for shared connections&nbsp;</div></li><li><div>        return $connection;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_page_load() {&nbsp;</div></li><li><div>        if ( isset( $_GET['action'] ) ) {&nbsp;</div></li><li><div>            if ( isset( $_GET['service'] ) )&nbsp;</div></li><li><div>                $service_name = $_GET['service'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch ( $_GET['action'] ) {&nbsp;</div></li><li><div>            case 'error':&nbsp;</div></li><li><div>                add_action( 'pre_admin_screen_sharing', array( $this, 'display_connection_error' ), 9 );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'request':&nbsp;</div></li><li><div>                check_admin_referer( 'keyring-request', 'kr_nonce' );&nbsp;</div></li><li><div>                check_admin_referer( &quot;keyring-request-$service_name&quot;, 'nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $verification = Jetpack::create_nonce( 'publicize' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $stats_options = get_option( 'stats_options' );&nbsp;</div></li><li><div>                $wpcom_blog_id = Jetpack_Options::get_option('id');&nbsp;</div></li><li><div>                $wpcom_blog_id = !empty( $wpcom_blog_id ) ? $wpcom_blog_id : $stats_options['blog_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $user = wp_get_current_user();&nbsp;</div></li><li><div>                $redirect = $this-&gt;api_url( $service_name, urlencode_deep( array(&nbsp;</div></li><li><div>                    'action' =&gt; 'request', &nbsp;</div></li><li><div>                    'redirect_uri' =&gt; add_query_arg( array( 'action' =&gt; 'done' ), menu_page_url( 'sharing', false ) ), &nbsp;</div></li><li><div>                    'for' =&gt; 'publicize', // required flag that says this connection is intended for publicize&nbsp;</div></li><li><div>                    'siteurl' =&gt; site_url(), &nbsp;</div></li><li><div>                    'state' =&gt; $user-&gt;ID, &nbsp;</div></li><li><div>                    'blog_id' =&gt; $wpcom_blog_id, &nbsp;</div></li><li><div>                    'secret_1' =&gt; $verification['secret_1'], &nbsp;</div></li><li><div>                    'secret_2' =&gt; $verification['secret_2'], &nbsp;</div></li><li><div>                    'eol' =&gt; $verification['eol'], &nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>                wp_redirect( $redirect );&nbsp;</div></li><li><div>                exit;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'completed':&nbsp;</div></li><li><div>                Jetpack::load_xml_rpc_client();&nbsp;</div></li><li><div>                $xml = new Jetpack_IXR_Client();&nbsp;</div></li><li><div>                $xml-&gt;query( 'jetpack.fetchPublicizeConnections' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( ! $xml-&gt;isError() ) {&nbsp;</div></li><li><div>                    $response = $xml-&gt;getResponse();&nbsp;</div></li><li><div>                    Jetpack_Options::update_option( 'publicize_connections', $response );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'delete':&nbsp;</div></li><li><div>                $id = $_GET['id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                check_admin_referer( 'keyring-request', 'kr_nonce' );&nbsp;</div></li><li><div>                check_admin_referer( &quot;keyring-request-$service_name&quot;, 'nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;disconnect( $service_name, $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                add_action( 'admin_notices', array( $this, 'display_disconnected' ) );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do we really need `admin_styles`? With the new admin UI, it's breaking some bits.&nbsp;</div></li><li><div>        // Errors encountered on WordPress.com's end are passed back as a code&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>        if ( isset( $_GET['action'] ) && 'error' == $_GET['action'] ) {&nbsp;</div></li><li><div>            // Load Jetpack's styles to handle the box&nbsp;</div></li><li><div>            Jetpack::init()-&gt;admin_styles();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        */&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function display_connection_error() {&nbsp;</div></li><li><div>        $code = false;&nbsp;</div></li><li><div>        if ( isset( $_GET['service'] ) ) {&nbsp;</div></li><li><div>            $service_name = $_GET['service'];&nbsp;</div></li><li><div>            $error = sprintf( __( 'There was a problem connecting to %s to create an authorized connection. Please try again in a moment.', 'jetpack' ), Publicize::get_service_label( $service_name ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( isset( $_GET['publicize_error'] ) ) {&nbsp;</div></li><li><div>                $code = strtolower( $_GET['publicize_error'] );&nbsp;</div></li><li><div>                switch ( $code ) {&nbsp;</div></li><li><div>                case '400':&nbsp;</div></li><li><div>                    $error = __( 'An invalid request was made. This normally means that something intercepted or corrupted the request from your server to the Jetpack Server. Try again and see if it works this time.', 'jetpack' );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'secret_mismatch':&nbsp;</div></li><li><div>                    $error = __( 'We could not verify that your server is making an authorized request. Please try again, and make sure there is nothing interfering with requests from your server to the Jetpack Server.', 'jetpack' );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'empty_blog_id':&nbsp;</div></li><li><div>                    $error = __( 'No blog_id was included in your request. Please try disconnecting Jetpack from WordPress.com and then reconnecting it. Once you have done that, try connecting Publicize again.', 'jetpack' );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'empty_state':&nbsp;</div></li><li><div>                    $error = sprintf( __( 'No user information was included in your request. Please make sure that your user account has connected to Jetpack. Connect your user account by going to the &lt;a href=&quot;%s&quot;&gt;Jetpack page&lt;/a&gt; within wp-admin.', 'jetpack' ), Jetpack::admin_url() );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    $error = __( 'Something which should never happen, happened. Sorry about that. If you try again, maybe it will work.', 'jetpack' );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $error = __( 'There was a problem connecting with Publicize. Please try again in a moment.', 'jetpack' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Using the same formatting/style as Jetpack::admin_notices() error&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;message&quot; class=&quot;jetpack-message jetpack-err&quot;&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;squeezer&quot;&gt;&nbsp;</div></li><li><div>                &lt;h4&gt;&lt;?php echo wp_kses( $error, array( 'a' =&gt; array( 'href' =&gt; true ), 'code' =&gt; true, 'strong' =&gt; true, 'br' =&gt; true, 'b' =&gt; true ) ); ?&gt;&lt;/h4&gt;&nbsp;</div></li><li><div>                &lt;?php if ( $code ) : ?&gt;&nbsp;</div></li><li><div>                &lt;p&gt;&lt;?php printf( __( 'Error code: %s', 'jetpack' ), esc_html( stripslashes( $code ) ) ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function display_disconnected() {&nbsp;</div></li><li><div>        echo &quot;&lt;div class='updated'&gt;\n&quot;;&nbsp;</div></li><li><div>        echo '&lt;p&gt;' . esc_html( __( 'That connection has been removed.', 'jetpack' ) ) . &quot;&lt;/p&gt;\n&quot;;&nbsp;</div></li><li><div>        echo &quot;&lt;/div&gt;\n\n&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function globalization() {&nbsp;</div></li><li><div>        if ( 'on' == $_REQUEST['global'] ) {&nbsp;</div></li><li><div>            $id = $_REQUEST['connection'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !current_user_can( $this-&gt;GLOBAL_CAP ) )&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            Jetpack::load_xml_rpc_client();&nbsp;</div></li><li><div>            $xml = new Jetpack_IXR_Client();&nbsp;</div></li><li><div>            $xml-&gt;query( 'jetpack.globalizePublicizeConnection', $id, 'globalize' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !$xml-&gt;isError() ) {&nbsp;</div></li><li><div>                $response = $xml-&gt;getResponse();&nbsp;</div></li><li><div>                Jetpack_Options::update_option( 'publicize_connections', $response );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    * Gets a URL to the public-api actions. Works like WP's admin_url&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    * @param string $service Shortname of a specific service.&nbsp;</div></li><li><div>    * @return URL to specific public-api process&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    // on WordPress.com this is/calls Keyring::admin_url&nbsp;</div></li><li><div>    function api_url( $service = false, $params = array() ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filters the API URL used to interact with WordPress.com.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @module publicize&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.0.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param string https://public-api.wordpress.com/connect/?jetpack=publicize Default Publicize API URL.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $url = apply_filters( 'publicize_api_url', 'https://public-api.wordpress.com/connect/?jetpack=publicize' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $service )&nbsp;</div></li><li><div>            $url = add_query_arg( array( 'service' =&gt; $service ), $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( count ( $params ) )&nbsp;</div></li><li><div>            $url = add_query_arg( $params, $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $url;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function connect_url( $service_name ) {&nbsp;</div></li><li><div>        return add_query_arg( array(&nbsp;</div></li><li><div>            'action' =&gt; 'request', &nbsp;</div></li><li><div>            'service' =&gt;  $service_name, &nbsp;</div></li><li><div>            'kr_nonce' =&gt; wp_create_nonce( 'keyring-request' ), &nbsp;</div></li><li><div>            'nonce' =&gt; wp_create_nonce( &quot;keyring-request-$service_name&quot; ), &nbsp;</div></li><li><div> ), menu_page_url( 'sharing', false ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function refresh_url( $service_name ) {&nbsp;</div></li><li><div>        return add_query_arg( array(&nbsp;</div></li><li><div>            'action' =&gt; 'request', &nbsp;</div></li><li><div>            'service' =&gt; $service_name, &nbsp;</div></li><li><div>            'kr_nonce' =&gt; wp_create_nonce( 'keyring-request' ), &nbsp;</div></li><li><div>            'refresh' =&gt; 1, &nbsp;</div></li><li><div>            'for' =&gt; 'publicize', &nbsp;</div></li><li><div>            'nonce' =&gt; wp_create_nonce( &quot;keyring-request-$service_name&quot; ), &nbsp;</div></li><li><div> ), admin_url( 'options-general.php?page=sharing' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function disconnect_url( $service_name, $id ) {&nbsp;</div></li><li><div>        return add_query_arg( array (&nbsp;</div></li><li><div>            'action' =&gt; 'delete', &nbsp;</div></li><li><div>            'service' =&gt; $service_name, &nbsp;</div></li><li><div>            'id' =&gt; $id, &nbsp;</div></li><li><div>            'kr_nonce' =&gt; wp_create_nonce( 'keyring-request' ), &nbsp;</div></li><li><div>            'nonce' =&gt; wp_create_nonce( &quot;keyring-request-$service_name&quot; ), &nbsp;</div></li><li><div> ), menu_page_url( 'sharing', false ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_services( $filter ) {&nbsp;</div></li><li><div>        if ( !in_array( $filter, array( 'all', 'connected' ) ) )&nbsp;</div></li><li><div>            $filter = 'all';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $services = array(&nbsp;</div></li><li><div>                'facebook' =&gt; array(), &nbsp;</div></li><li><div>                'twitter' =&gt; array(), &nbsp;</div></li><li><div>                'linkedin' =&gt; array(), &nbsp;</div></li><li><div>                'tumblr' =&gt; array(), &nbsp;</div></li><li><div>                'path' =&gt; array(), &nbsp;</div></li><li><div>                'google_plus' =&gt; array(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'all' == $filter ) {&nbsp;</div></li><li><div>            return $services;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $connected_services = array();&nbsp;</div></li><li><div>            foreach ( $services as $service =&gt; $empty ) {&nbsp;</div></li><li><div>                $connections = $this-&gt;get_connections( $service );&nbsp;</div></li><li><div>                if ( $connections )&nbsp;</div></li><li><div>                    $connected_services[$service] = $connections;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $connected_services;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_connection( $service, $id, $_blog_id = false, $_user_id = false ) {&nbsp;</div></li><li><div>        // Stub&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function flag_post_for_publicize( $new_status, $old_status, $post ) {&nbsp;</div></li><li><div>        // Stub only. Doesn't need to do anything on Jetpack Client&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function test_connection( $service_name, $connection ) {&nbsp;</div></li><li><div>        $connection_test_passed = true;&nbsp;</div></li><li><div>        $connection_test_message = '';&nbsp;</div></li><li><div>        $user_can_refresh = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = $this-&gt;get_connection_id( $connection );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Jetpack::load_xml_rpc_client();&nbsp;</div></li><li><div>        $xml = new Jetpack_IXR_Client();&nbsp;</div></li><li><div>        $xml-&gt;query( 'jetpack.testPublicizeConnection', $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $xml-&gt;isError() ) {&nbsp;</div></li><li><div>            $xml_response = $xml-&gt;getResponse();&nbsp;</div></li><li><div>            $connection_test_message = $xml_response['faultString'];&nbsp;</div></li><li><div>            $connection_test_passed = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Bail if all is well&nbsp;</div></li><li><div>        if ( $connection_test_passed ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set up refresh if the user can&nbsp;</div></li><li><div>        $user_can_refresh = current_user_can( $this-&gt;GLOBAL_CAP );&nbsp;</div></li><li><div>        if ( $user_can_refresh ) {&nbsp;</div></li><li><div>            $nonce = wp_create_nonce( &quot;keyring-request-&quot; . $service_name );&nbsp;</div></li><li><div>            $refresh_text = sprintf( _x( 'Refresh connection with %s', 'Refresh connection with {social media service}', 'jetpack' ), $this-&gt;get_service_label( $service_name ) );&nbsp;</div></li><li><div>            $refresh_url = $this-&gt;refresh_url( $service_name );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $error_data = array(&nbsp;</div></li><li><div>            'user_can_refresh' =&gt; $user_can_refresh, &nbsp;</div></li><li><div>            'refresh_text' =&gt; $refresh_text, &nbsp;</div></li><li><div>            'refresh_url' =&gt; $refresh_url&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return new WP_Error( 'pub_conn_test_failed', $connection_test_message, $error_data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save a flag locally to indicate that this post has already been Publicized via the selected&nbsp;</div></li><li><div>     * connections.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_publicized( $new_status, $old_status, $post ) {&nbsp;</div></li><li><div>        // Only do this when a post transitions to being published&nbsp;</div></li><li><div>        if ( 'publish' == $new_status && 'publish' != $old_status ) {&nbsp;</div></li><li><div>            update_post_meta( $post-&gt;ID, $this-&gt;POST_DONE . 'all', true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    * Options Code&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function options_page_facebook() {&nbsp;</div></li><li><div>        $connected_services = Jetpack_Options::get_option( 'publicize_connections' );&nbsp;</div></li><li><div>        $connection = $connected_services['facebook'][$_REQUEST['connection']];&nbsp;</div></li><li><div>        $options_to_show = ( ! empty( $connection['connection_data']['meta']['options_responses'] ) ? $connection['connection_data']['meta']['options_responses'] : false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Nonce check&nbsp;</div></li><li><div>        check_admin_referer( 'options_page_facebook_' . $_REQUEST['connection'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $me = ( ! empty( $options_to_show[0] )         ? $options_to_show[0]         : false );&nbsp;</div></li><li><div>        $pages = ( ! empty( $options_to_show[1]['data'] ) ? $options_to_show[1]['data'] : false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $profile_checked = true;&nbsp;</div></li><li><div>        $page_selected = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $connection['connection_data']['meta']['facebook_page'] ) ) {&nbsp;</div></li><li><div>            $found = false;&nbsp;</div></li><li><div>            if ( is_array( $pages-&gt;data ) ) {&nbsp;</div></li><li><div>                foreach ( $pages-&gt;data as $page ) {&nbsp;</div></li><li><div>                    if ( $page-&gt;id == $connection['connection_data']['meta']['facebook_page'] ) {&nbsp;</div></li><li><div>                        $found = true;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $found ) {&nbsp;</div></li><li><div>                $profile_checked = false;&nbsp;</div></li><li><div>                $page_selected = $connection['connection_data']['meta']['facebook_page'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;div id=&quot;thickbox-content&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            ob_start();&nbsp;</div></li><li><div>            Publicize_UI::connected_notice( 'Facebook' );&nbsp;</div></li><li><div>            $update_notice = ob_get_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $update_notice ) )&nbsp;</div></li><li><div>                echo $update_notice;&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php if ( !empty( $me['name'] ) ) : ?&gt;&nbsp;</div></li><li><div>            &lt;p&gt;&lt;?php printf(&nbsp;</div></li><li><div>                esc_html__( 'Publicize to my %s:', 'jetpack' ), &nbsp;</div></li><li><div>                '&lt;strong&gt;' . esc_html__( 'Facebook Wall', 'jetpack' ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>            &lt;table id=&quot;option-profile&quot;&gt;&nbsp;</div></li><li><div>                &lt;tbody&gt;&nbsp;</div></li><li><div>                    &lt;tr&gt;&nbsp;</div></li><li><div>                        &lt;td class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;option&quot; data-type=&quot;profile&quot; id=&quot;&lt;?php echo esc_attr( $me['id'] ) ?&gt;&quot; value=&quot;&quot; &lt;?php checked( $profile_checked, true ); ?&gt; /&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                        &lt;td class=&quot;thumbnail&quot;&gt;&lt;label for=&quot;&lt;?php echo esc_attr( $me['id'] ) ?&gt;&quot;&gt;&lt;img src=&quot;&lt;?php echo esc_url( $me['picture']['data']['url'] ) ?&gt;&quot; width=&quot;50&quot; height=&quot;50&quot; /&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                        &lt;td class=&quot;details&quot;&gt;&lt;label for=&quot;&lt;?php echo esc_attr( $me['id'] ) ?&gt;&quot;&gt;&lt;?php echo esc_html( $me['name'] ) ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                    &lt;/tr&gt;&nbsp;</div></li><li><div>                &lt;/tbody&gt;&nbsp;</div></li><li><div>            &lt;/table&gt;&nbsp;</div></li><li><div>            &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php if ( $pages ) : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;p&gt;&lt;?php printf(&nbsp;</div></li><li><div>                    esc_html__( 'Publicize to my %s:', 'jetpack' ), &nbsp;</div></li><li><div>                    '&lt;strong&gt;' . esc_html__( 'Facebook Page', 'jetpack' ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                &lt;table id=&quot;option-fb-fanpage&quot;&gt;&nbsp;</div></li><li><div>                    &lt;tbody&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        &lt;?php foreach ( $pages as $i =&gt; $page ) : ?&gt;&nbsp;</div></li><li><div>                            &lt;?php if ( ! ( $i % 2 ) ) : ?&gt;&nbsp;</div></li><li><div>                                &lt;tr&gt;&nbsp;</div></li><li><div>                            &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>                                    &lt;td class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;option&quot; data-type=&quot;page&quot; id=&quot;&lt;?php echo esc_attr( $page['id'] ) ?&gt;&quot; value=&quot;&lt;?php echo esc_attr( $page['id'] ) ?&gt;&quot; &lt;?php checked( $page_selected && $page_selected == $page['id'], true ); ?&gt; /&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                                    &lt;td class=&quot;thumbnail&quot;&gt;&lt;label for=&quot;&lt;?php echo esc_attr( $page['id'] ) ?&gt;&quot;&gt;&lt;img src=&quot;&lt;?php echo esc_url( str_replace( '_s', '_q', $page['picture']['data']['url'] ) ) ?&gt;&quot; width=&quot;50&quot; height=&quot;50&quot; /&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                                    &lt;td class=&quot;details&quot;&gt;&nbsp;</div></li><li><div>                                        &lt;label for=&quot;&lt;?php echo esc_attr( $page['id'] ) ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;span class=&quot;name&quot;&gt;&lt;?php echo esc_html( $page['name'] ) ?&gt;&lt;/span&gt;&lt;br/&gt;&nbsp;</div></li><li><div>                                            &lt;span class=&quot;category&quot;&gt;&lt;?php echo esc_html( $page['category'] ) ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                                        &lt;/label&gt;&nbsp;</div></li><li><div>                                    &lt;/td&gt;&nbsp;</div></li><li><div>                            &lt;?php if ( ( $i % 2 ) || ( $i == count( $pages ) - 1 ) ): ?&gt;&nbsp;</div></li><li><div>                                &lt;/tr&gt;&nbsp;</div></li><li><div>                            &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>                        &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;/tbody&gt;&nbsp;</div></li><li><div>                &lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php Publicize_UI::global_checkbox( 'facebook', $_REQUEST['connection'] ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;p style=&quot;text-align: center;&quot;&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;submit&quot; value=&quot;&lt;?php esc_attr_e( 'OK', 'jetpack' ) ?&gt;&quot; class=&quot;button fb-options save-options&quot; name=&quot;save&quot; data-connection=&quot;&lt;?php echo esc_attr( $_REQUEST['connection'] ); ?&gt;&quot; rel=&quot;&lt;?php echo wp_create_nonce('save_fb_token_' . $_REQUEST['connection'] ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/p&gt;&lt;br/&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function options_save_facebook() {&nbsp;</div></li><li><div>        // Nonce check&nbsp;</div></li><li><div>        check_admin_referer( 'save_fb_token_' . $_REQUEST['connection'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = $_POST['connection'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for a numeric page ID&nbsp;</div></li><li><div>        $page_id = $_POST['selected_id'];&nbsp;</div></li><li><div>        if ( !ctype_digit( $page_id ) )&nbsp;</div></li><li><div>            die( 'Security check' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST['selected_id'] ) && 'profile' == $_POST['type'] ) {&nbsp;</div></li><li><div>            // Publish to User Wall/Profile&nbsp;</div></li><li><div>            $options = array(&nbsp;</div></li><li><div>                'facebook_page' =&gt; null, &nbsp;</div></li><li><div>                'facebook_profile' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( 'page' != $_POST['type'] || !isset( $_POST['selected_id'] ) ) {&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Publish to Page&nbsp;</div></li><li><div>            $options = array(&nbsp;</div></li><li><div>                'facebook_page' =&gt; $page_id, &nbsp;</div></li><li><div>                'facebook_profile' =&gt; null&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Jetpack::load_xml_rpc_client();&nbsp;</div></li><li><div>        $xml = new Jetpack_IXR_Client();&nbsp;</div></li><li><div>        $xml-&gt;query( 'jetpack.setPublicizeOptions', $id, $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$xml-&gt;isError() ) {&nbsp;</div></li><li><div>            $response = $xml-&gt;getResponse();&nbsp;</div></li><li><div>            Jetpack_Options::update_option( 'publicize_connections', $response );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;globalization();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function options_page_tumblr() {&nbsp;</div></li><li><div>        // Nonce check&nbsp;</div></li><li><div>        check_admin_referer( 'options_page_tumblr_' . $_REQUEST['connection'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $connected_services = Jetpack_Options::get_option( 'publicize_connections' );&nbsp;</div></li><li><div>        $connection = $connected_services['tumblr'][$_POST['connection']];&nbsp;</div></li><li><div>        $options_to_show = $connection['connection_data']['meta']['options_responses'];&nbsp;</div></li><li><div>        $request = $options_to_show[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $blogs = $request['response']['user']['blogs'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $blog_selected = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $connection['connection_data']['meta']['tumblr_base_hostname'] ) ) {&nbsp;</div></li><li><div>            foreach ( $blogs as $blog ) {&nbsp;</div></li><li><div>                if ( $connection['connection_data']['meta']['tumblr_base_hostname'] == $this-&gt;get_basehostname( $blog['url'] ) ) {&nbsp;</div></li><li><div>                    $blog_selected = $connection['connection_data']['meta']['tumblr_base_hostname'];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Use their Primary blog if they haven't selected one yet&nbsp;</div></li><li><div>        if ( !$blog_selected ) {&nbsp;</div></li><li><div>            foreach ( $blogs as $blog ) {&nbsp;</div></li><li><div>                if ( $blog['primary'] )&nbsp;</div></li><li><div>                    $blog_selected = $this-&gt;get_basehostname( $blog['url'] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;div id=&quot;thickbox-content&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            ob_start();&nbsp;</div></li><li><div>            Publicize_UI::connected_notice( 'Tumblr' );&nbsp;</div></li><li><div>            $update_notice = ob_get_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $update_notice ) )&nbsp;</div></li><li><div>                echo $update_notice;&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;p&gt;&lt;?php printf(&nbsp;</div></li><li><div>                esc_html__( 'Publicize to my %s:', 'jetpack' ), &nbsp;</div></li><li><div>                '&lt;strong&gt;' . esc_html__( 'Tumblr blog', 'jetpack' ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;ul id=&quot;option-tumblr-blog&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            foreach ( $blogs as $blog ) {&nbsp;</div></li><li><div>                $url = $this-&gt;get_basehostname( $blog['url'] ); ?&gt;&nbsp;</div></li><li><div>                &lt;li&gt;&nbsp;</div></li><li><div>                    &lt;input type=&quot;radio&quot; name=&quot;option&quot; data-type=&quot;blog&quot; id=&quot;&lt;?php echo esc_attr( $url ) ?&gt;&quot; value=&quot;&lt;?php echo esc_attr( $url ) ?&gt;&quot; &lt;?php checked( $blog_selected == $url, true ); ?&gt; /&gt;&nbsp;</div></li><li><div>                    &lt;label for=&quot;&lt;?php echo esc_attr( $url ) ?&gt;&quot;&gt;&lt;span class=&quot;name&quot;&gt;&lt;?php echo esc_html( $blog['title'] ) ?&gt;&lt;/span&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                &lt;/li&gt;&nbsp;</div></li><li><div>            &lt;?php } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/ul&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php Publicize_UI::global_checkbox( 'tumblr', $_REQUEST['connection'] ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;p style=&quot;text-align: center;&quot;&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;submit&quot; value=&quot;&lt;?php esc_attr_e( 'OK', 'jetpack' ) ?&gt;&quot; class=&quot;button tumblr-options save-options&quot; name=&quot;save&quot; data-connection=&quot;&lt;?php echo esc_attr( $_REQUEST['connection'] ); ?&gt;&quot; rel=&quot;&lt;?php echo wp_create_nonce( 'save_tumblr_blog_' . $_REQUEST['connection'] ) ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/p&gt; &lt;br /&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_basehostname( $url ) {&nbsp;</div></li><li><div>        return parse_url( $url, PHP_URL_HOST );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function options_save_tumblr() {&nbsp;</div></li><li><div>        // Nonce check&nbsp;</div></li><li><div>        check_admin_referer( 'save_tumblr_blog_' . $_REQUEST['connection'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = $_POST['connection'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $options = array( 'tumblr_base_hostname' =&gt; $_POST['selected_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Jetpack::load_xml_rpc_client();&nbsp;</div></li><li><div>        $xml = new Jetpack_IXR_Client();&nbsp;</div></li><li><div>        $xml-&gt;query( 'jetpack.setPublicizeOptions', $id, $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$xml-&gt;isError() ) {&nbsp;</div></li><li><div>            $response = $xml-&gt;getResponse();&nbsp;</div></li><li><div>            Jetpack_Options::update_option( 'publicize_connections', $response );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;globalization();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function options_page_twitter() { Publicize_UI::options_page_other( 'twitter' ); }&nbsp;</div></li><li><div>    function options_page_linkedin() { Publicize_UI::options_page_other( 'linkedin' ); }&nbsp;</div></li><li><div>    function options_page_path() { Publicize_UI::options_page_other( 'path' ); }&nbsp;</div></li><li><div>    function options_page_google_plus() { Publicize_UI::options_page_other( 'google_plus' ); }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function options_save_twitter() { $this-&gt;options_save_other( 'twitter' ); }&nbsp;</div></li><li><div>    function options_save_linkedin() { $this-&gt;options_save_other( 'linkedin' ); }&nbsp;</div></li><li><div>    function options_save_path() { $this-&gt;options_save_other( 'path' ); }&nbsp;</div></li><li><div>    function options_save_google_plus() { $this-&gt;options_save_other( 'google_plus' ); }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function options_save_other( $service_name ) {&nbsp;</div></li><li><div>        // Nonce check&nbsp;</div></li><li><div>        check_admin_referer( 'save_' . $service_name . '_token_' . $_REQUEST['connection'] );&nbsp;</div></li><li><div>        $this-&gt;globalization();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    * Already-published posts should not be Publicized by default. This filter sets checked to&nbsp;</div></li><li><div>    * false if a post has already been published.&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function publicize_checkbox_default( $checked, $post_id, $name, $connection ) {&nbsp;</div></li><li><div>        if ( 'publish' == get_post_status( $post_id ) )&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $checked;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    * If there's only one shared connection to Twitter set it as twitter:site tag.&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function enhaced_twitter_cards_site_tag( $tag ) {&nbsp;</div></li><li><div>        $custom_site_tag = get_option( 'jetpack-twitter-cards-site-tag' );&nbsp;</div></li><li><div>        if( ! empty( $custom_site_tag ) )&nbsp;</div></li><li><div>            return $tag;&nbsp;</div></li><li><div>        if ( ! $this-&gt;is_enabled('twitter') )&nbsp;</div></li><li><div>            return $tag;&nbsp;</div></li><li><div>        $connections = $this-&gt;get_connections( 'twitter' );&nbsp;</div></li><li><div>        foreach ( $connections as $connection ) {&nbsp;</div></li><li><div>            $connection_meta = $this-&gt;get_connection_meta( $connection );&nbsp;</div></li><li><div>            if ( 0 == $connection_meta['connection_data']['user_id'] ) {&nbsp;</div></li><li><div>                // If the connection is shared&nbsp;</div></li><li><div>                return $this-&gt;get_display_name( 'twitter', $connection );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $tag;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function save_publicized_twitter_account( $submit_post, $post_id, $service_name, $connection ) {&nbsp;</div></li><li><div>        if ( 'twitter' == $service_name && $submit_post ) {&nbsp;</div></li><li><div>            $connection_meta = $this-&gt;get_connection_meta( $connection );&nbsp;</div></li><li><div>            $publicize_twitter_user = get_post_meta( $post_id, '_publicize_twitter_user' );&nbsp;</div></li><li><div>            if ( empty( $publicize_twitter_user ) || 0 != $connection_meta['connection_data']['user_id'] ) {&nbsp;</div></li><li><div>                update_post_meta( $post_id, '_publicize_twitter_user', $this-&gt;get_display_name( 'twitter', $connection ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function get_publicized_twitter_account( $account, $post_id ) {&nbsp;</div></li><li><div>        if ( ! empty( $account ) ) {&nbsp;</div></li><li><div>            return $account;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $account = get_post_meta( $post_id, '_publicize_twitter_user', true );&nbsp;</div></li><li><div>        if ( ! empty( $account ) ) {&nbsp;</div></li><li><div>            return $account;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    * Save the Publicized Facebook account when publishing a post&nbsp;</div></li><li><div>    * Use only Personal accounts, not Facebook Pages&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function save_publicized_facebook_account( $submit_post, $post_id, $service_name, $connection ) {&nbsp;</div></li><li><div>        $connection_meta = $this-&gt;get_connection_meta( $connection );&nbsp;</div></li><li><div>        if ( 'facebook' == $service_name && isset( $connection_meta['connection_data']['meta']['facebook_profile'] ) && $submit_post ) {&nbsp;</div></li><li><div>            $publicize_facebook_user = get_post_meta( $post_id, '_publicize_facebook_user' );&nbsp;</div></li><li><div>            if ( empty( $publicize_facebook_user ) || 0 != $connection_meta['connection_data']['user_id'] ) {&nbsp;</div></li><li><div>                $profile_link = $this-&gt;get_profile_link( 'facebook', $connection );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( false !== $profile_link ) {&nbsp;</div></li><li><div>                    update_post_meta( $post_id, '_publicize_facebook_user', $profile_link );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.2/classes/publicize/" class="">3.8.2</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.1/classes/publicize/" class="">3.8.1</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/publicize/" class="active">3.8.0</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.7.2/classes/publicize/" class="">3.7.2</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.7.1/classes/publicize/" class="">3.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>Publicize</li><li><span></span>Jetpack by WordPress.com</li><li><span></span>3.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>