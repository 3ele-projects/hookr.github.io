<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="3.8.0" data-slug="jetpack-by-wordpress-com" data-type="class" data-id="30330"><head xmlns="http://www.w3.org/1999/xhtml"><title> jetpack_site_icon | class | Jetpack By WordPress Com | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Jetpack_Site_Icon, class, plugin, jetpack-by-wordpress-com, 3.8.0" /><meta name="description" content="Plugin Name: Site Icon Plugin URL: http://wordpress.com/ Description:  Add a site icon for your website." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=08100943e5ae11a9cb84086945cfc103' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/jetpack_site_icon/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fjetpack_site_icon%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fjetpack_site_icon%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-jetpack-by-wordpress-com-3.8.0-class-jetpack_site_icon","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="jetpack_site_icon" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to jetpack-by-wordpress-com." href="http://hookr.io/plugins/jetpack-by-wordpress-com/" class="plugin"><span property="name">jetpack-by-wordpress-com</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.8.0." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/" class="H_VERSION"><span property="name">3.8.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">jetpack_site_icon</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="1499"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/all/" title="All">All <span class="count badge">1499</span></a></li><li class="" data-id="new" data-count="17"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/new/" title="New">New <span class="count badge">17</span></a></li><li class="" data-id="hooks" data-count="599"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/hooks/" title="Hooks">Hooks <span class="count badge">599</span></a></li><li class="" data-id="action" data-count="195"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/actions/" title="Actions">Actions <span class="count badge">195</span></a></li><li class="" data-id="filter" data-count="404"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/filters/" title="Filters">Filters <span class="count badge">404</span></a></li><li class="active" data-id="class" data-count="262"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/" title="Classes">Classes <span class="count badge">262</span></a></li><li class="" data-id="constant" data-count="62"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/constants/" title="Constants">Constants <span class="count badge">62</span></a></li><li class="" data-id="function" data-count="530"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/functions/" title="Functions">Functions <span class="count badge">530</span></a></li><li class="" data-id="shortcode" data-count="46"><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">46</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Jetpack_Site_Icon</strong></h1><p>Plugin Name: Site Icon Plugin URL: http://wordpress.com/ Description:  Add a site icon for your website.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/files/modules-site-icon-jetpack-site-icon/" class="file">/modules/site-icon/jetpack-site-icon.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="18" class="block" start="18"><li><div>class Jetpack_Site_Icon {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public $module = 'site-icon';&nbsp;</div></li><li><div>    public static $version = 1;&nbsp;</div></li><li><div>    public static $assets_version = 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static $min_size = 512; // the minimum size of the blavatar, 512 is the same as wp.com can be overwritten by SITE_ICON_MIN_SIZE&nbsp;</div></li><li><div>    public static $page_crop = 512; // the size to which to crop the image so that we can display it in the UI nicely&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static $accepted_file_types = array(&nbsp;</div></li><li><div>        'image/jpg', &nbsp;</div></li><li><div>        'image/jpeg', &nbsp;</div></li><li><div>        'image/gif', &nbsp;</div></li><li><div>        'image/png'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public static $site_icon_sizes = array(&nbsp;</div></li><li><div>        256, &nbsp;</div></li><li><div>        128, &nbsp;</div></li><li><div>        80, &nbsp;</div></li><li><div>        64, &nbsp;</div></li><li><div>        32, &nbsp;</div></li><li><div>        16, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    static $instance = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Singleton&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function init() {&nbsp;</div></li><li><div>        if ( ! self::$instance ) {&nbsp;</div></li><li><div>            self::$instance = new Jetpack_Site_Icon;&nbsp;</div></li><li><div>            self::$instance-&gt;register_hooks();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::$instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function __construct() {&nbsp;</div></li><li><div>        self::$min_size = ( defined( 'SITE_ICON_MIN_SIZE' ) && is_int( SITE_ICON_MIN_SIZE ) ) ? SITE_ICON_MIN_SIZE : self::$min_size;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register our actions and filters&nbsp;</div></li><li><div>     * @return null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function register_hooks() {&nbsp;</div></li><li><div>        add_action( 'jetpack_modules_loaded', array( $this, 'jetpack_modules_loaded' ) );&nbsp;</div></li><li><div>        add_action( 'admin_menu', array( $this, 'admin_menu_upload_site_icon' ) );&nbsp;</div></li><li><div>        add_filter( 'display_media_states', array( $this, 'add_media_state' ) );&nbsp;</div></li><li><div>        add_action( 'admin_init', array( $this, 'admin_init' ) );&nbsp;</div></li><li><div>        add_action( 'admin_init', array( $this, 'delete_site_icon_hook' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'admin_print_styles-options-general.php', array( $this, 'add_general_options_styles' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the favicon to the front end and backend if Core's site icon not used.&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * As of WP 4.3 and JP 3.6, both are outputting the same icons so no need to fire these.&nbsp;</div></li><li><div>         * This is a temporary solution until Jetpack's module primary function is deprecated.&nbsp;</div></li><li><div>         * In the future, Jetpack's can output other sizes using Core's icon.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( ( function_exists( 'has_site_icon' ) && ! has_site_icon() ) || ! function_exists( 'has_site_icon' ) ) {&nbsp;</div></li><li><div>            add_action( 'wp_head', array( $this, 'site_icon_add_meta' ) );&nbsp;</div></li><li><div>            add_action( 'admin_head', array( $this, 'site_icon_add_meta' ) );&nbsp;</div></li><li><div>            add_action( 'atom_head', array( $this, 'atom_icon' ) );&nbsp;</div></li><li><div>            add_action( 'rss2_head', array( $this, 'rss2_icon' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if site icon is available in core, and if so convert Jetpack's to use it.&nbsp;</div></li><li><div>        add_action( 'admin_init', array( 'Jetpack', 'jetpack_site_icon_available_in_core' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'delete_option', array( 'Jetpack_Site_Icon', 'delete_temp_data' ), 10, 1); // used to clean up after itself.&nbsp;</div></li><li><div>        add_action( 'delete_attachment', array( 'Jetpack_Site_Icon', 'delete_attachment_data' ), 10, 1); // in case user deletes the attachment via&nbsp;</div></li><li><div>        add_filter( 'get_post_metadata', array( 'Jetpack_Site_Icon', 'delete_attachment_images' ), 10, 4 );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * After all modules have been loaded.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function jetpack_modules_loaded() {&nbsp;</div></li><li><div>        Jetpack::enable_module_configurable( $this-&gt;module );&nbsp;</div></li><li><div>        Jetpack::module_configuration_load( $this-&gt;module, array( $this, 'jetpack_configuration_load' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add meta elements to a blog header to light up Blavatar icons recognized by user agents.&nbsp;</div></li><li><div>     * @link http://www.whatwg.org/specs/web-apps/current-work/multipage/links.html#rel-icon HTML5 specification link icon&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function site_icon_add_meta() {&nbsp;</div></li><li><div>        if (&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Toggles the Favicon meta elements from being loaded.&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @module site-icon&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @since 3.2.0&nbsp;</div></li><li><div>             *&nbsp;</div></li><li><div>             * @param bool Output Site Icon Meta Elements.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            apply_filters( 'site_icon_has_favicon', false )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $url_114 = jetpack_site_icon_url( null, 114 );&nbsp;</div></li><li><div>        $url_72 = jetpack_site_icon_url( null, 72 );&nbsp;</div></li><li><div>        $url_32 = jetpack_site_icon_url( null, 32 );&nbsp;</div></li><li><div>        if( $url_32 ) {&nbsp;</div></li><li><div>            echo '&lt;link rel=&quot;icon&quot; href=&quot;'.esc_url( $url_32 ) .'&quot; sizes=&quot;32x32&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>            echo '&lt;link rel=&quot;apple-touch-icon-precomposed&quot; href=&quot;'. esc_url( $url_114 ) .'&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>            // windows tiles&nbsp;</div></li><li><div>            echo '&lt;meta name=&quot;msapplication-TileImage&quot; content=&quot;' . esc_url( $url_114 ) . '&quot;/&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display icons in RSS2.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function rss2_icon() {&nbsp;</div></li><li><div>        /** This filter is documented in modules/site-icon/jetpack-site-icon.php */&nbsp;</div></li><li><div>        if ( apply_filters( 'site_icon_has_favicon', false ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $rss_title = get_wp_title_rss();&nbsp;</div></li><li><div>        if ( empty( $rss_title ) ) {&nbsp;</div></li><li><div>            $rss_title = get_bloginfo_rss( 'name' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $icon = jetpack_site_icon_url( null, 32 );&nbsp;</div></li><li><div>        if( $icon ) {&nbsp;</div></li><li><div>            echo '&nbsp;</div></li><li><div>    &lt;image&gt;&nbsp;</div></li><li><div>        &lt;url&gt;' . convert_chars( $icon ) . '&lt;/url&gt;&nbsp;</div></li><li><div>        &lt;title&gt;' . $rss_title . '&lt;/title&gt;&nbsp;</div></li><li><div>        &lt;link&gt;' .  get_bloginfo_rss( 'url' ) . '&lt;/link&gt;&nbsp;</div></li><li><div>        &lt;width&gt;32&lt;/width&gt;&nbsp;</div></li><li><div>        &lt;height&gt;32&lt;/height&gt;&nbsp;</div></li><li><div>    &lt;/image&gt; '.&quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display icons in atom feeds.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function atom_icon() {&nbsp;</div></li><li><div>        /** This filter is documented in modules/site-icon/jetpack-site-icon.php */&nbsp;</div></li><li><div>        if ( apply_filters( 'site_icon_has_favicon', false ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $url = jetpack_site_icon_url( null, 32 );&nbsp;</div></li><li><div>        if( $url ) {&nbsp;</div></li><li><div>            echo '&nbsp;</div></li><li><div>    &lt;icon&gt;' . $url . '&lt;/icon&gt; '.&quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add a hidden upload page from people&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_menu_upload_site_icon() {&nbsp;</div></li><li><div>         $page_hook = add_submenu_page(&nbsp;</div></li><li><div>             null, &nbsp;</div></li><li><div>             __( 'Site Icon Upload', 'jetpack' ), &nbsp;</div></li><li><div>             '', &nbsp;</div></li><li><div>             'manage_options', &nbsp;</div></li><li><div>             'jetpack-site_icon-upload', &nbsp;</div></li><li><div>             array( $this, 'upload_site_icon_page' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>         add_action( &quot;admin_head-$page_hook&quot;, array( $this, 'upload_balavatar_head' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add styles to the General Settings Screen&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_general_options_styles() {&nbsp;</div></li><li><div>        wp_enqueue_style( 'site-icon-admin' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add Styles to the Upload UI Page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function upload_balavatar_head() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_register_script( 'jetpack-site-icon-crop', plugin_dir_url( __FILE__ ). &quot;js/site-icon-crop.js&quot; , array( 'jquery', 'jcrop' ) , self::$assets_version, false);&nbsp;</div></li><li><div>        if ( isset( $_REQUEST['step'] )  && $_REQUEST['step'] == 2 ) {&nbsp;</div></li><li><div>            wp_enqueue_script( 'jetpack-site-icon-crop' );&nbsp;</div></li><li><div>            wp_enqueue_style( 'jcrop' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        wp_enqueue_style( 'site-icon-admin' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function add_media_state( $media_states ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( jetpack_has_site_icon() ) {&nbsp;</div></li><li><div>            global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( $post-&gt;ID == Jetpack_Options::get_option( 'site_icon_id' ) ) {&nbsp;</div></li><li><div>                $media_states[] = __( 'Site Icon', 'jetpack' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $media_states;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Direct the user to the Settings -&gt; General&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function jetpack_configuration_load() {&nbsp;</div></li><li><div>        wp_safe_redirect( admin_url( 'options-general.php#site-icon' ) );&nbsp;</div></li><li><div>        exit;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load on when the admin is initialized&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_init() {&nbsp;</div></li><li><div>        /** register the styles and scripts */&nbsp;</div></li><li><div>        wp_register_style( 'site-icon-admin' , plugin_dir_url( __FILE__ ). &quot;css/site-icon-admin.css&quot;, array(), self::$assets_version );&nbsp;</div></li><li><div>        // register the settings&nbsp;</div></li><li><div>        add_settings_section(&nbsp;</div></li><li><div>          $this-&gt;module, &nbsp;</div></li><li><div>          '', &nbsp;</div></li><li><div>          array( $this, 'site_icon_settings' ), &nbsp;</div></li><li><div>          'general'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // We didn't have site_icon_url in 3.2 // this could potentially be removed in a year&nbsp;</div></li><li><div>        if( get_option( 'site_icon_id' ) && ! Jetpack_Options::get_option( 'site_icon_url' ) ) {&nbsp;</div></li><li><div>            Jetpack_Options::update_option( 'site_icon_id', get_option( 'site_icon_id' ) );&nbsp;</div></li><li><div>            Jetpack_Options::update_option( 'site_icon_url', jetpack_site_icon_url( get_current_blog_id(), 512 ) );&nbsp;</div></li><li><div>            delete_option( 'site_icon_id' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks for permission to delete the site_icon&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_site_icon_hook() {&nbsp;</div></li><li><div>        // Delete the site_icon&nbsp;</div></li><li><div>        if ( isset( $GLOBALS['plugin_page'] ) && 'jetpack-site_icon-upload' == $GLOBALS['plugin_page'] ) {&nbsp;</div></li><li><div>            if ( isset( $_GET['action'] )&nbsp;</div></li><li><div>                    && 'remove' == $_GET['action']&nbsp;</div></li><li><div>                    && isset( $_GET['nonce'] )&nbsp;</div></li><li><div>                    && wp_verify_nonce( $_GET['nonce'], 'remove_site_icon' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $site_icon_id = Jetpack_Options::get_option( 'site_icon_id' );&nbsp;</div></li><li><div>                // Delete the previous Blavatar&nbsp;</div></li><li><div>                self::delete_site_icon( $site_icon_id, true );&nbsp;</div></li><li><div>                wp_safe_redirect( admin_url( 'options-general.php#site-icon' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add HTML to the General Settings&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function site_icon_settings() {&nbsp;</div></li><li><div>        $upload_blavatar_url = admin_url( 'options-general.php?page=jetpack-site_icon-upload' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // lets delete the temp data that we might he holding on to&nbsp;</div></li><li><div>        self::delete_temporay_data();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;site-icon&quot; class=&quot;site-icon-shell&quot;&gt;&nbsp;</div></li><li><div>            &lt;h3&gt;&lt;?php echo esc_html_e( 'Site Icon', 'jetpack' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;site-icon-content postbox&quot;&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;site-icon-image&quot;&gt;&nbsp;</div></li><li><div>                &lt;?php if( jetpack_has_site_icon() ) {&nbsp;</div></li><li><div>                    echo jetpack_get_site_icon( null, 128 );&nbsp;</div></li><li><div>                    } ?&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;site-icon-meta&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php if ( jetpack_has_site_icon() ) {&nbsp;</div></li><li><div>                    $remove_blavatar_url = admin_url( 'options-general.php?page=jetpack-site_icon-upload' ).&quot;&action=remove&nonce=&quot;.wp_create_nonce( 'remove_site_icon' ); // this could be an ajax url&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;a href=&quot;&lt;?php echo esc_url( $upload_blavatar_url ); ?&gt;&quot; id=&quot;site-icon-update&quot; class=&quot;button&quot;&gt;&lt;?php echo esc_html_e( 'Update Site Icon', 'jetpack' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                    &lt;a href=&quot;&lt;?php echo esc_url( $remove_blavatar_url ); ?&gt;&quot; id=&quot;site-icon-remove&quot; &gt;&lt;?php echo esc_html_e( 'Remove Icon', 'jetpack' ); ?&gt;&lt;/a&gt; &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php } else { ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;a href=&quot;&lt;?php echo esc_url( $upload_blavatar_url ); ?&gt;&quot; id=&quot;site-icon-update&quot; class=&quot;button&quot;&gt;&lt;?php echo esc_html_e( 'Add a Site Icon', 'jetpack' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;div class=&quot;site-icon-info&quot;&gt;&nbsp;</div></li><li><div>                        &lt;p&gt;&lt;?php echo esc_html_e( 'Site Icon creates a favicon for your site and more.', 'jetpack' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Hidden Upload Blavatar page for people that don't like modals&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function upload_site_icon_page() { ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php require_once( dirname( __FILE__ ) . '/upload-site-icon.php' ); ?&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Select a file admin view&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function select_page() {&nbsp;</div></li><li><div>        // Display the site_icon form to upload the image&nbsp;</div></li><li><div>         ?&gt;&nbsp;</div></li><li><div>        &lt;form action=&quot;&lt;?php echo esc_url( admin_url( 'options-general.php?page=jetpack-site_icon-upload' ) ); ?&gt;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;h2 class=&quot;site-icon-title&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php if( jetpack_has_site_icon() ) {&nbsp;</div></li><li><div>                esc_html_e( 'Update Site Icon', 'jetpack' );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                esc_html_e( 'Add Site Icon', 'jetpack' );&nbsp;</div></li><li><div>            } ?&gt; &lt;span class=&quot;small&quot;&gt;&lt;?php esc_html_e( 'select a file', 'jetpack' ); ?&gt;&lt;/span&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>            &lt;p&gt;&lt;?php esc_html_e( 'Upload a image that you want to use as your site icon. You will be asked to crop it in the next step.', 'jetpack' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;p&gt;&lt;input name=&quot;site-iconfile&quot; id=&quot;site-iconfile&quot; type=&quot;file&quot; /&gt;&lt;/p&gt;&nbsp;</div></li><li><div>            &lt;p&gt;&lt;?php esc_html_e( 'The image needs to be at least', 'jetpack' ); ?&gt; &lt;strong&gt;&lt;?php echo self::$min_size; ?&gt;px&lt;/strong&gt; &lt;?php esc_html_e( 'in both width and height.', 'jetpack' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>            &lt;p class=&quot;submit site-icon-submit-form&quot;&gt;&nbsp;</div></li><li><div>                &lt;input name=&quot;submit&quot; value=&quot;&lt;?php esc_attr_e( 'Upload Image' , 'jetpack' ); ?&gt;&quot; type=&quot;submit&quot; class=&quot;button button-primary button-large&quot; /&gt;&lt;?php printf( __( ' or &lt;a href=&quot;%s&quot;&gt;Cancel&lt;/a&gt; and go back to the settings.' , 'jetpack' ), esc_url( admin_url( 'options-general.php' ) ) ); ?&gt;&nbsp;</div></li><li><div>                &lt;input name=&quot;step&quot; value=&quot;2&quot; type=&quot;hidden&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php wp_nonce_field( 'update-site_icon-2', '_nonce' ); ?&gt;&nbsp;</div></li><li><div>            &lt;/p&gt;&nbsp;</div></li><li><div>        &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Crop a the image admin view&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function crop_page() {&nbsp;</div></li><li><div>        // handle the uploaded image&nbsp;</div></li><li><div>        $image = self::handle_file_upload( $_FILES['site-iconfile'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // display the image image croppping funcunality&nbsp;</div></li><li><div>        if( is_wp_error( $image ) ) { ?&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;message&quot; class=&quot;updated error below-h2&quot;&gt;&lt;p&gt;&lt;?php echo esc_html( $image-&gt;get_error_message() ); ?&gt;&lt;/p&gt;&lt;/div&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            // back to step one&nbsp;</div></li><li><div>            $_POST = array();&nbsp;</div></li><li><div>            self::delete_temporay_data();&nbsp;</div></li><li><div>            self::select_page();&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $crop_data = get_option( 'site_icon_temp_data' );&nbsp;</div></li><li><div>        $crop_ration = $crop_data['large_image_data'][0] / $crop_data['resized_image_data'][0]; // always bigger then 1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // lets make sure that the Javascript ia also loaded&nbsp;</div></li><li><div>        wp_localize_script( 'jetpack-site-icon-crop', 'Site_Icon_Crop_Data', self::initial_crop_data( $crop_data['large_image_data'][0] , $crop_data['large_image_data'][1], $crop_data['resized_image_data'][0], $crop_data['resized_image_data'][1] ) );&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;h2 class=&quot;site-icon-title&quot;&gt;&lt;?php esc_html_e( 'Site Icon', 'jetpack' ); ?&gt; &lt;span class=&quot;small&quot;&gt;&lt;?php esc_html_e( 'crop the image', 'jetpack' ); ?&gt;&lt;/span&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;site-icon-crop-shell&quot;&gt;&nbsp;</div></li><li><div>            &lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;&nbsp;</div></li><li><div>            &lt;p class=&quot;site-icon-submit-form&quot;&gt;&lt;input name=&quot;submit&quot; value=&quot;&lt;?php esc_attr_e( 'Crop Image', 'jetpack' ); ?&gt;&quot; type=&quot;submit&quot; class=&quot;button button-primary button-large&quot; /&gt;&lt;?php printf( __( ' or &lt;a href=&quot;%s&quot;&gt;Cancel&lt;/a&gt; and go back to the settings.' , 'jetpack' ), esc_url( admin_url( 'options-general.php' ) ) ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;site-icon-crop-preview-shell&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;h3&gt;&lt;?php esc_html_e( 'Preview', 'jetpack' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;strong&gt;&lt;?php esc_html_e( 'As your favicon', 'jetpack' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;site-icon-crop-favicon-preview-shell&quot;&gt;&nbsp;</div></li><li><div>                    &lt;img src=&quot;&lt;?php echo esc_url( plugin_dir_url( __FILE__ ). &quot;browser.png&quot; ); ?&gt;&quot; class=&quot;site-icon-browser-preview&quot; width=&quot;172&quot; height=&quot;79&quot; alt=&quot;&lt;?php esc_attr_e( 'Browser Chrome' , 'jetpack' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;site-icon-crop-preview-favicon&quot;&gt;&nbsp;</div></li><li><div>                        &lt;img src=&quot;&lt;?php echo esc_url( $image[0] ); ?&gt;&quot; id=&quot;preview-favicon&quot; alt=&quot;&lt;?php esc_attr_e( 'Preview Favicon' , 'jetpack' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;span class=&quot;site-icon-browser-title&quot;&gt;&lt;?php echo esc_html( get_bloginfo( 'name' ) ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;strong&gt;&lt;?php esc_html_e( 'As a mobile icon', 'jetpack' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;site-icon-crop-preview-homeicon&quot;&gt;&nbsp;</div></li><li><div>                    &lt;img src=&quot;&lt;?php echo esc_url( $image[0] ); ?&gt;&quot; id=&quot;preview-homeicon&quot; alt=&quot;&lt;?php esc_attr_e( 'Preview Home Icon' , 'jetpack' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;img src=&quot;&lt;?php echo esc_url( $image[0] ); ?&gt;&quot; id=&quot;crop-image&quot; class=&quot;site-icon-crop-image&quot;&nbsp;</div></li><li><div>                width=&quot;&lt;?php echo esc_attr( $crop_data['resized_image_data'][0] ); ?&gt;&quot;&nbsp;</div></li><li><div>                height=&quot;&lt;?php echo esc_attr( $crop_data['resized_image_data'][1] ); ?&gt;&quot;&nbsp;</div></li><li><div>                alt=&quot;&lt;?php esc_attr_e( 'Image to be cropped', 'jetpack' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;input name=&quot;step&quot; value=&quot;3&quot; type=&quot;hidden&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; id=&quot;crop-x&quot; name=&quot;crop-x&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; id=&quot;crop-y&quot; name=&quot;crop-y&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; id=&quot;crop-width&quot; name=&quot;crop-w&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; id=&quot;crop-height&quot; name=&quot;crop-h&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php wp_nonce_field( 'update-site_icon-3', '_nonce' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * All done page admin view&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function all_done_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $temp_image_data = get_option( 'site_icon_temp_data' );&nbsp;</div></li><li><div>        if( ! $temp_image_data ) {&nbsp;</div></li><li><div>            // start again&nbsp;</div></li><li><div>            self::select_page();&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $crop_ration = $temp_image_data['large_image_data'][0] / $temp_image_data['resized_image_data'][0]; // always bigger then 1&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $crop_data = self::convert_coodiantes_from_resized_to_full( $_POST['crop-x'], $_POST['crop-y'], $_POST['crop-w'], $_POST['crop-h'], $crop_ration );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $image_edit =  wp_get_image_editor( _load_image_to_edit_path( $temp_image_data['large_image_attachment_id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $image_edit ) ) {&nbsp;</div></li><li><div>            return $image_edit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete the previous site_icon&nbsp;</div></li><li><div>        $previous_site_icon_id =  Jetpack_Options::get_option( 'site_icon_id' );&nbsp;</div></li><li><div>        self::delete_site_icon( $previous_site_icon_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // crop the image&nbsp;</div></li><li><div>        $image_edit-&gt;crop( $crop_data['crop_x'], $crop_data['crop_y'], $crop_data['crop_width'], $crop_data['crop_height'], self::$min_size, self::$min_size );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $dir = wp_upload_dir();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $site_icon_filename = $image_edit-&gt;generate_filename( dechex ( time() ) . 'v' . self::$version . '_site_icon', null, 'png' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If the attachment is a URL, then change it to a local file name to allow us to save and then upload the cropped image&nbsp;</div></li><li><div>        $check_url = parse_url( $site_icon_filename );&nbsp;</div></li><li><div>        if ( isset( $check_url['host'] ) ) {&nbsp;</div></li><li><div>            $upload_dir = wp_upload_dir();&nbsp;</div></li><li><div>            $site_icon_filename = $upload_dir['path'] . '/' . basename( $site_icon_filename );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $image_edit-&gt;save( $site_icon_filename );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter( 'intermediate_image_sizes_advanced', array( 'Jetpack_Site_Icon', 'additional_sizes' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $site_icon_id = self::save_attachment(&nbsp;</div></li><li><div>            __( 'Large Blog Image', 'jetpack' ) , &nbsp;</div></li><li><div>            $site_icon_filename, &nbsp;</div></li><li><div>            'image/png'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        remove_filter( 'intermediate_image_sizes_advanced', array( 'Jetpack_Site_Icon', 'additional_sizes' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save the site_icon data into option&nbsp;</div></li><li><div>        Jetpack_Options::update_option( 'site_icon_id', $site_icon_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Get the site icon URL ready to sync&nbsp;</div></li><li><div>        Jetpack_Options::update_option( 'site_icon_url', jetpack_site_icon_url( get_current_blog_id(), 512 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;h2 class=&quot;site-icon-title&quot;&gt;&lt;?php esc_html_e( 'Site Icon', 'jetpack' ); ?&gt; &lt;span class=&quot;small&quot;&gt;&lt;?php esc_html_e( 'All Done', 'jetpack' ); ?&gt;&lt;/span&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;message&quot; class=&quot;updated below-h2&quot;&gt;&lt;p&gt;&lt;?php esc_html_e( 'Your site icon has been uploaded!', 'jetpack' ); ?&gt; &lt;a href=&quot;&lt;?php echo esc_url( admin_url( 'options-general.php' ) ); ?&gt;&quot; &gt;&lt;?php esc_html_e( 'Back to General Settings' , 'jetpack' ); ?&gt;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php echo jetpack_get_site_icon( null, $size = '128' ); ?&gt;&nbsp;</div></li><li><div>        &lt;?php echo jetpack_get_site_icon( null, $size = '48' ); ?&gt;&nbsp;</div></li><li><div>        &lt;?php echo jetpack_get_site_icon( null, $size = '16' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * This function is used to pass data to the localize script&nbsp;</div></li><li><div>     * so that we can center the cropper and also set the minimum&nbsp;</div></li><li><div>     * cropper if we still want to show the&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  int $large_width&nbsp;</div></li><li><div>     * @param  int $large_height&nbsp;</div></li><li><div>     * @param  int $resized_width&nbsp;</div></li><li><div>     * @param  int $resized_height&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function initial_crop_data( $large_width, $large_height, $resized_width, $resized_height ) {&nbsp;</div></li><li><div>        $init_x = 0;&nbsp;</div></li><li><div>        $init_y = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ration = $large_width / $resized_width;&nbsp;</div></li><li><div>        $min_crop_size = ( self::$min_size / $ration );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Landscape format ( width &gt; height )&nbsp;</div></li><li><div>        if( $resized_width &gt; $resized_height ) {&nbsp;</div></li><li><div>            $init_x = ( self::$page_crop - $resized_height ) / 2;&nbsp;</div></li><li><div>            $init_size = $resized_height;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Portrait format ( height &gt; width )&nbsp;</div></li><li><div>        if( $resized_width &lt; $resized_height ) {&nbsp;</div></li><li><div>            $init_y = ( self::$page_crop - $resized_width ) / 2;&nbsp;</div></li><li><div>            $init_size = $resized_height;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Square height == width&nbsp;</div></li><li><div>        if( $resized_width = $resized_height ) {&nbsp;</div></li><li><div>            $init_size = $resized_height;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array(&nbsp;</div></li><li><div>            'init_x' =&gt; $init_x, &nbsp;</div></li><li><div>            'init_y' =&gt; $init_y, &nbsp;</div></li><li><div>            'init_size' =&gt; $init_size, &nbsp;</div></li><li><div>            'min_size' =&gt; $min_crop_size&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete the temporary created data and attachments&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_temporay_data() {&nbsp;</div></li><li><div>        // This should autimatically delete the temporary files as well&nbsp;</div></li><li><div>        delete_option( 'site_icon_temp_data' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Function gets fired when delete_option( 'site_icon_temp_data' ) is run.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  $option string&nbsp;</div></li><li><div>     * @return null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>     public static function delete_temp_data( $option ) {&nbsp;</div></li><li><div>        if( 'site_icon_temp_data' == $option ) {&nbsp;</div></li><li><div>            $temp_image_data = get_option( 'site_icon_temp_data' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            remove_action( 'delete_attachment', array( 'Jetpack_Site_Icon', 'delete_attachment_data' ), 10, 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_delete_attachment( $temp_image_data['large_image_attachment_id'] , true );&nbsp;</div></li><li><div>            wp_delete_attachment( $temp_image_data['resized_image_attacment_id'] , true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param $post_id&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_attachment_data( $post_id ) {&nbsp;</div></li><li><div>        // The user could be deleting the site_icon image&nbsp;</div></li><li><div>        $site_icon_id = Jetpack_Options::get_option( 'site_icon_id' );&nbsp;</div></li><li><div>        if( $site_icon_id &&  $post_id == $site_icon_id ) {&nbsp;</div></li><li><div>            Jetpack_Options::delete_option( 'site_icon_id' );&nbsp;</div></li><li><div>            Jetpack_Options::delete_option( 'site_icon_url' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // The user could be deleting the temporary images&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param $check&nbsp;</div></li><li><div>     * @param $post_id&nbsp;</div></li><li><div>     * @param $meta_key&nbsp;</div></li><li><div>     * @param $single&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_attachment_images( $check, $post_id, $meta_key, $single ) {&nbsp;</div></li><li><div>        $site_icon_id = Jetpack_Options::get_option( 'site_icon_id' );&nbsp;</div></li><li><div>        if( $post_id == $site_icon_id && '_wp_attachment_backup_sizes' == $meta_key && true == $single )&nbsp;</div></li><li><div>            add_filter( 'intermediate_image_sizes', array( 'Jetpack_Site_Icon', 'intermediate_image_sizes' ) );&nbsp;</div></li><li><div>        return $check;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete the blavatar and all the attached data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $id&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function delete_site_icon( $id ) {&nbsp;</div></li><li><div>        // We add the filter to make sure that we also delete all the added images&nbsp;</div></li><li><div>        add_filter( 'intermediate_image_sizes', array( 'Jetpack_Site_Icon', 'intermediate_image_sizes' ) );&nbsp;</div></li><li><div>        wp_delete_attachment( $id , true );&nbsp;</div></li><li><div>        remove_filter( 'intermediate_image_sizes', array( 'Jetpack_Site_Icon', 'intermediate_image_sizes' ) );&nbsp;</div></li><li><div>        // for good measure also&nbsp;</div></li><li><div>        self::delete_temporay_data();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete the URL from the Jetpack Options array&nbsp;</div></li><li><div>        Jetpack_Options::delete_option( 'site_icon_url' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return Jetpack_Options::delete_option( 'site_icon_id' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @param $crop_x&nbsp;</div></li><li><div>     * @param $crop_y&nbsp;</div></li><li><div>     * @param $crop_width&nbsp;</div></li><li><div>     * @param $crop_height&nbsp;</div></li><li><div>     * @param $ratio&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function convert_coodiantes_from_resized_to_full( $crop_x, $crop_y, $crop_width, $crop_height, $ratio ) {&nbsp;</div></li><li><div>        return array(&nbsp;</div></li><li><div>            'crop_x' =&gt; floor( $crop_x * $ratio ), &nbsp;</div></li><li><div>            'crop_y' =&gt; floor( $crop_y * $ratio ), &nbsp;</div></li><li><div>            'crop_width' =&gt; floor( $crop_width * $ratio ), &nbsp;</div></li><li><div>            'crop_height' =&gt; floor( $crop_height * $ratio ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle the uploaded image&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $uploaded_file&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function handle_file_upload( $uploaded_file ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check that the image accuallt is a file with size&nbsp;</div></li><li><div>        if( !isset( $uploaded_file ) || ($uploaded_file['size'] &lt;= 0 ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'broke', __( 'Please upload a file.', 'jetpack' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $arr_file_type = wp_check_filetype( basename( $uploaded_file['name'] ) );&nbsp;</div></li><li><div>        $uploaded_file_type = $arr_file_type['type'];&nbsp;</div></li><li><div>        if( ! in_array( $uploaded_file_type, self::$accepted_file_types ) ) {&nbsp;</div></li><li><div>            // Create a temp file which should be deleted at when the scipt stops&nbsp;</div></li><li><div>            return new WP_Error( 'broke', __( 'The file that you uploaded is not an accepted file type. Please try again.', 'jetpack' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $image = wp_handle_upload( $uploaded_file, array( 'test_form' =&gt; false ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(  is_wp_error( $image ) ) {&nbsp;</div></li><li><div>              // this should contain the error message returned from wp_handle_upload&nbsp;</div></li><li><div>              unlink( $image['file'] ); // Lets delete the file since we are not going to be using it&nbsp;</div></li><li><div>            return $image;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Lets try to crop the image into smaller files.&nbsp;</div></li><li><div>        // We will be doing this later so it is better if it fails now.&nbsp;</div></li><li><div>        $image_edit = wp_get_image_editor( $image['file'] );&nbsp;</div></li><li><div>        if ( is_wp_error( $image_edit ) ) {&nbsp;</div></li><li><div>            // this should contain the error message from WP_Image_Editor&nbsp;</div></li><li><div>            unlink( $image['file'] ); // lets delete the file since we are not going to be using it&nbsp;</div></li><li><div>            return $image_edit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $image_size = getimagesize( $image['file'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $image_size[0] &lt; self::$min_size || $image_size[1] &lt; self::$min_size ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( $image_size[0] &lt; self::$min_size ) {&nbsp;</div></li><li><div>                return new WP_Error( 'broke', sprintf( __( 'The image that you uploaded is smaller than %upx in width.', 'jetpack' ), self::$min_size ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( $image_size[1] &lt; self::$min_size ) {&nbsp;</div></li><li><div>                return new WP_Error( 'broke', sprintf( __( 'The image that you uploaded is smaller than %upx in height.', 'jetpack' ), self::$min_size ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save the image as an attachment for later use.&nbsp;</div></li><li><div>        $large_attachment_id = self::save_attachment(&nbsp;</div></li><li><div>            __( 'Temporary Large Image for Blog Image', 'jetpack' ) , &nbsp;</div></li><li><div>            $image['file'], &nbsp;</div></li><li><div>            $uploaded_file_type, &nbsp;</div></li><li><div>            false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let's resize the image so that the user can easier crop a image that in the admin view&nbsp;</div></li><li><div>        $image_edit-&gt;resize( self::$page_crop, self::$page_crop, false );&nbsp;</div></li><li><div>        $dir = wp_upload_dir();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $resized_filename = $image_edit-&gt;generate_filename( 'temp', null, null );&nbsp;</div></li><li><div>        $image_edit-&gt;save( $resized_filename );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $resized_attach_id = self::save_attachment(&nbsp;</div></li><li><div>            __( 'Temporary Resized Image for Blog Image', 'jetpack' ), &nbsp;</div></li><li><div>            $resized_filename, &nbsp;</div></li><li><div>            $uploaded_file_type, &nbsp;</div></li><li><div>            false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $resized_image_size = getimagesize( $resized_filename );&nbsp;</div></li><li><div>        // Save all of this into the the database for that we can work with it later.&nbsp;</div></li><li><div>        update_option( 'site_icon_temp_data', array(&nbsp;</div></li><li><div>            'large_image_attachment_id' =&gt; $large_attachment_id, &nbsp;</div></li><li><div>            'large_image_data' =&gt; $image_size, &nbsp;</div></li><li><div>            'resized_image_attacment_id' =&gt; $resized_attach_id, &nbsp;</div></li><li><div>            'resized_image_data' =&gt; $resized_image_size&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return wp_get_attachment_image_src( $resized_attach_id, 'full' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save Blavatar files to Media Library&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string      $title&nbsp;</div></li><li><div>     * @param  string      $filename&nbsp;</div></li><li><div>     * @param  string      $file_type&nbsp;</div></li><li><div>     * @param  boolean     $generate_meta&nbsp;</div></li><li><div>     * @return int         $attactment_id&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function save_attachment( $title, $file, $file_type, $generate_meta = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $filename =  _wp_relative_upload_path( $file );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wp_upload_dir = wp_upload_dir();&nbsp;</div></li><li><div>        $attachment = array(&nbsp;</div></li><li><div>             'guid' =&gt; $wp_upload_dir['url'] . '/' . basename( $filename ), &nbsp;</div></li><li><div>            'post_mime_type' =&gt; $file_type, &nbsp;</div></li><li><div>            'post_title' =&gt; $title, &nbsp;</div></li><li><div>            'post_content' =&gt; '', &nbsp;</div></li><li><div>            'post_status' =&gt; 'inherit'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $attachment_id = wp_insert_attachment( $attachment, $filename );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( ! function_exists( 'wp_generate_attachment_metadata' ) )  {&nbsp;</div></li><li><div>            // Make sure that this file is included, as wp_generate_attachment_metadata() depends on it.&nbsp;</div></li><li><div>            require_once( ABSPATH . 'wp-admin/includes/image.php' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if( !$generate_meta )&nbsp;</div></li><li><div>            add_filter( 'intermediate_image_sizes_advanced', array( 'Jetpack_Site_Icon', 'only_thumbnail_size' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Generate the metadata for the attachment, and update the database record.&nbsp;</div></li><li><div>        $attach_data = wp_generate_attachment_metadata( $attachment_id, $file );&nbsp;</div></li><li><div>        wp_update_attachment_metadata( $attachment_id, $attach_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( !$generate_meta ) {&nbsp;</div></li><li><div>            remove_filter( 'intermediate_image_sizes_advanced', array( 'Jetpack_Site_Icon', 'only_thumbnail_size' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $attachment_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add additional sizes to be made when creating the site_icon images&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  array $sizes&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function additional_sizes( $sizes ) {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter the different dimensions that a site icon is saved in.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @module site-icon&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 3.2.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param array $site_icon_sizes Sizes available for the Site Icon.  Default is array(256, 128, 80, 64, 32, 16).&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        self::$site_icon_sizes = apply_filters( 'site_icon_image_sizes', self::$site_icon_sizes );&nbsp;</div></li><li><div>        // use a natural sort of numbers&nbsp;</div></li><li><div>        natsort( self::$site_icon_sizes );&nbsp;</div></li><li><div>        self::$site_icon_sizes = array_reverse ( self::$site_icon_sizes );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // ensure that we only resize the image into&nbsp;</div></li><li><div>        foreach( $sizes as $name =&gt; $size_array ) {&nbsp;</div></li><li><div>            if( $size_array['crop'] ) {&nbsp;</div></li><li><div>                $only_crop_sizes[ $name ] = $size_array;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach( self::$site_icon_sizes as $size ) {&nbsp;</div></li><li><div>            if( $size &lt; self::$min_size ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $only_crop_sizes['site_icon-'.$size] =  array(&nbsp;</div></li><li><div>                    &quot;width&quot; =&gt; $size, &nbsp;</div></li><li><div>                    &quot;height&quot;=&gt; $size, &nbsp;</div></li><li><div>                    &quot;crop&quot; =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $only_crop_sizes;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Helps us delete site_icon images that&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  [type] $sizes [description]&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function intermediate_image_sizes( $sizes ) {&nbsp;</div></li><li><div>        /** This filter is documented in modules/site-icon/jetpack-site-icon.php */&nbsp;</div></li><li><div>        self::$site_icon_sizes = apply_filters( 'site_icon_image_sizes', self::$site_icon_sizes );&nbsp;</div></li><li><div>        foreach( self::$site_icon_sizes as $size ) {&nbsp;</div></li><li><div>            $sizes[] = 'site_icon-'.$size;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $sizes;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Only resize the image to thumbnail so we can use&nbsp;</div></li><li><div>     * Use when resizing temporary images. This way we can see the temp image in Media Gallery.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  array $sizes&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function only_thumbnail_size( $sizes ) {&nbsp;</div></li><li><div>        foreach( $sizes as $name =&gt; $size_array ) {&nbsp;</div></li><li><div>            if( 'thumbnail' == $name ) {&nbsp;</div></li><li><div>                $only_thumb['thumbnail'] = $size_array;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $only_thumb;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 3.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.2/classes/jetpack_site_icon/" class="">3.8.2</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.1/classes/jetpack_site_icon/" class="">3.8.1</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.8.0/classes/jetpack_site_icon/" class="active">3.8.0</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.7.2/classes/jetpack_site_icon/" class="">3.7.2</a></li><li><a href="http://hookr.io/plugins/jetpack-by-wordpress-com/3.7.1/classes/jetpack_site_icon/" class="">3.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>Jetpack_Site_Icon</li><li><span></span>Jetpack by WordPress.com</li><li><span></span>3.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>