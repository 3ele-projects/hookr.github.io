<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.7.8" data-slug="easy-digital-downloads" data-type="file" data-id="19946"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-deprecated-functions | file | Easy Digital Downloads | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, easy-digital-downloads, 2.7.8" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=16946bbb3a2a25bb92de0ee75d87e1f5' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-deprecated-functions/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-deprecated-functions%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-deprecated-functions%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-easy-digital-downloads-2.7.8-file-includes-deprecated-functions","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-deprecated-functions" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to easy-digital-downloads." href="http://hookr.io/plugins/easy-digital-downloads/" class="plugin"><span property="name">easy-digital-downloads</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.8." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/" class="H_VERSION"><span property="name">2.7.8</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-deprecated-functions</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="2274"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/all/" title="All">All <span class="count badge">2274</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="1195"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/hooks/" title="Hooks">Hooks <span class="count badge">1195</span></a></li><li class="" data-id="action" data-count="469"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/actions/" title="Actions">Actions <span class="count badge">469</span></a></li><li class="" data-id="filter" data-count="726"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/filters/" title="Filters">Filters <span class="count badge">726</span></a></li><li class="" data-id="class" data-count="99"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/" title="Classes">Classes <span class="count badge">99</span></a></li><li class="" data-id="constant" data-count="11"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/constants/" title="Constants">Constants <span class="count badge">11</span></a></li><li class="" data-id="function" data-count="955"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/functions/" title="Functions">Functions <span class="count badge">955</span></a></li><li class="" data-id="shortcode" data-count="14"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">14</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/deprecated-functions.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Deprecated Functions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * All functions that have been deprecated.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package     EDD</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage  Deprecated</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright   Copyright (c) 2015, Pippin Williamson</span>&nbsp;</div></li><li><div><span class="comment"> * @license     http://opensource.org/licenses/gpl-2.0.php GNU Public License</span>&nbsp;</div></li><li><div><span class="comment"> * @since       1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly</span>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Download Sales Log</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Returns an array of sales and sale info for a download.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since       1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated  1.3.4</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $download_id ID number of the download to retrieve a log for</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $paginate Whether to paginate the results or not</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $number Number of results to return</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $offset Number of items to skip</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed array|bool</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function edd_get_download_sales_log( $download_id, $paginate = false, $number = 10, $offset = 0 ) {&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.3.4', null, $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sales_log = get_post_meta( $download_id, '_edd_sales_log', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $sales_log ) {&nbsp;</div></li><li><div>      $sales_log = array_reverse( $sales_log );&nbsp;</div></li><li><div>      $log = array();&nbsp;</div></li><li><div>      $log['number'] = count( $sales_log );&nbsp;</div></li><li><div>      $log['sales'] = $sales_log;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $paginate ) {&nbsp;</div></li><li><div>          $log['sales'] = array_slice( $sales_log, $offset, $number );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $log;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get File Download Log</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Returns an array of file download dates and user info.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.3.4</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $download_id the ID number of the download to retrieve a log for</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $paginate whether to paginate the results or not</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $number the number of results to return</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $offset the number of items to skip</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed array|bool</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function edd_get_file_download_log( $download_id, $paginate = false, $number = 10, $offset = 0 ) {&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.3.4', null, $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $download_log = get_post_meta( $download_id, '_edd_file_download_log', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $download_log ) {&nbsp;</div></li><li><div>      $download_log = array_reverse( $download_log );&nbsp;</div></li><li><div>      $log = array();&nbsp;</div></li><li><div>      $log['number'] = count( $download_log );&nbsp;</div></li><li><div>      $log['downloads'] = $download_log;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $paginate ) {&nbsp;</div></li><li><div>          $log['downloads'] = array_slice( $download_log, $offset, $number );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $log;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Downloads Of Purchase</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves an array of all files purchased.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.4</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int  $payment_id ID number of the purchase</span>&nbsp;</div></li><li><div><span class="comment"> * @param null $payment_meta</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|mixed</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_downloads_of_purchase( $payment_id, $payment_meta = null ) {&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.4', 'edd_get_payment_meta_downloads', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_null( $payment_meta ) ) {&nbsp;</div></li><li><div>      $payment_meta = edd_get_payment_meta( $payment_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $downloads = maybe_unserialize( $payment_meta['downloads'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $downloads )&nbsp;</div></li><li><div>      return $downloads;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Menu Access Level</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Returns the access level required to access the downloads menu. Currently not</span>&nbsp;</div></li><li><div><span class="comment"> * changeable, but here for a future update.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.4.4</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function edd_get_menu_access_level() {&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.4.4', 'current_user_can(\'manage_shop_settings\')', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_menu_access_level', 'manage_options' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check if only local taxes are enabled meaning users must opt in by using the</span>&nbsp;</div></li><li><div><span class="comment"> * option set from the EDD Settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.3.3</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.6</span>&nbsp;</div></li><li><div><span class="comment"> * @global $edd_options</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool $local_only</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_local_taxes_only() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.6', 'no alternatives', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $edd_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $local_only = isset( $edd_options['tax_condition'] ) && $edd_options['tax_condition'] == 'local';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_local_taxes_only', $local_only );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if a customer has opted into local taxes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.4.1</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.6</span>&nbsp;</div></li><li><div><span class="comment"> * @uses EDD_Session::get()</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_local_tax_opted_in() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.6', 'no alternatives', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $opted_in = EDD()-&gt;session-&gt;get( 'edd_local_tax_opt_in' );&nbsp;</div></li><li><div>  return ! empty( $opted_in );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Show taxes on individual prices?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.4</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.9</span>&nbsp;</div></li><li><div><span class="comment"> * @global $edd_options</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether or not to show taxes on prices</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_taxes_on_prices() {&nbsp;</div></li><li><div>  global $edd_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.9', 'no alternatives', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_taxes_on_prices', isset( $edd_options['taxes_on_prices'] ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Show Has Purchased Item Message</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Prints a notice when user has already purchased the item.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.8</span>&nbsp;</div></li><li><div><span class="comment"> * @global $user_ID</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_show_has_purchased_item_message() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.8', 'no alternatives', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $user_ID, $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( !isset( $post-&gt;ID ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( edd_has_user_purchased( $user_ID, $post-&gt;ID ) ) {&nbsp;</div></li><li><div>      $alert = '&lt;p class=&quot;edd_has_purchased&quot;&gt;' . __( 'You have already purchased this item, but you may purchase it again.', 'easy-digital-downloads' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>      echo apply_filters( 'edd_show_has_purchased_item_message', $alert );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Flushes the total earning cache when a new payment is created</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.8.4</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $payment Payment ID</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $payment_data Payment Data</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_clear_earnings_cache( $payment, $payment_data ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.8.4', 'no alternatives', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  delete_transient( 'edd_total_earnings' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div><span class="comment">//add_action( 'edd_insert_payment', 'edd_clear_earnings_cache', 10, 2 );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Cart Amount</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.9</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $add_taxes Whether to apply taxes (if enabled) (default: true)</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $local_override Force the local opt-in param - used for when not reading $_POST (default: false)</span>&nbsp;</div></li><li><div><span class="comment"> * @return float Total amount</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function edd_get_cart_amount( $add_taxes = true, $local_override = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '1.9', 'edd_get_cart_subtotal() or edd_get_cart_total()', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $amount = edd_get_cart_subtotal( );&nbsp;</div></li><li><div>  if ( ! empty( $_POST['edd-discount'] ) || edd_get_cart_discounts() !== false ) {&nbsp;</div></li><li><div>      <span class="comment">// Retrieve the discount stored in cookies</span>&nbsp;</div></li><li><div>      $discounts = edd_get_cart_discounts();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check for a posted discount</span>&nbsp;</div></li><li><div>      $posted_discount = isset( $_POST['edd-discount'] ) ? trim( $_POST['edd-discount'] ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $posted_discount && ! in_array( $posted_discount, $discounts ) ) {&nbsp;</div></li><li><div>          <span class="comment">// This discount hasn't been applied, so apply it</span>&nbsp;</div></li><li><div>          $amount = edd_get_discounted_amount( $posted_discount, $amount );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( ! empty( $discounts ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Apply the discounted amount from discounts already applied</span>&nbsp;</div></li><li><div>          $amount -= edd_get_cart_discounted_amount();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( edd_use_taxes() && edd_is_cart_taxed() && $add_taxes ) {&nbsp;</div></li><li><div>      $tax = edd_get_cart_tax();&nbsp;</div></li><li><div>      $amount += $tax;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( $amount &lt; 0 )&nbsp;</div></li><li><div>      $amount = 0.00;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_get_cart_amount', $amount, $add_taxes, $local_override );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Purchase Receipt Template Tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Displays all available template tags for the purchase receipt.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.9</span>&nbsp;</div></li><li><div><span class="comment"> * @author Daniel J Griffiths</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $tags</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_purchase_receipt_template_tags() {&nbsp;</div></li><li><div>  $tags = __('Enter the email that is sent to users after completing a successful purchase. HTML is accepted. Available template tags:', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{download_list} - ' . __('A list of download links for each download purchased', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{file_urls} - ' . __('A plain-text list of download URLs for each download purchased', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{name} - ' . __('The buyer\'s first name', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{fullname} - ' . __('The buyer\'s full name, first and last', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{username} - ' . __('The buyer\'s user name on the site, if they registered an account', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{user_email} - ' . __('The buyer\'s email address', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{billing_address} - ' . __('The buyer\'s billing address', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{date} - ' . __('The date of the purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{subtotal} - ' . __('The price of the purchase before taxes', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{tax} - ' . __('The taxed amount of the purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{price} - ' . __('The total price of the purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{payment_id} - ' . __('The unique ID number for this purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{receipt_id} - ' . __('The unique ID number for this purchase receipt', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{payment_method} - ' . __('The method of payment used for this purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{sitename} - ' . __('Your site name', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{receipt_link} - ' . __( 'Adds a link so users can view their receipt directly on your website if they are unable to view it in the browser correctly.', 'easy-digital-downloads' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_purchase_receipt_template_tags_description', $tags );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Sale Notification Template Tags</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Displays all available template tags for the sale notification email</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 1.9</span>&nbsp;</div></li><li><div><span class="comment"> * @author Daniel J Griffiths</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $tags</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_sale_notification_template_tags() {&nbsp;</div></li><li><div>  $tags = __( 'Enter the email that is sent to sale notification emails after completion of a purchase. HTML is accepted. Available template tags:', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{download_list} - ' . __('A list of download links for each download purchased', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{file_urls} - ' . __('A plain-text list of download URLs for each download purchased', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{name} - ' . __('The buyer\'s first name', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{fullname} - ' . __('The buyer\'s full name, first and last', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{username} - ' . __('The buyer\'s user name on the site, if they registered an account', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{user_email} - ' . __('The buyer\'s email address', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{billing_address} - ' . __('The buyer\'s billing address', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{date} - ' . __('The date of the purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{subtotal} - ' . __('The price of the purchase before taxes', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{tax} - ' . __('The taxed amount of the purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{price} - ' . __('The total price of the purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{payment_id} - ' . __('The unique ID number for this purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{receipt_id} - ' . __('The unique ID number for this purchase receipt', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{payment_method} - ' . __('The method of payment used for this purchase', 'easy-digital-downloads' ) . '&lt;br/&gt;' .&nbsp;</div></li><li><div>          '{sitename} - ' . __('Your site name', 'easy-digital-downloads' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_sale_notification_template_tags_description', $tags );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Email Template Header</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.8.2</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Email template header</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_email_body_header() {&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '2.0', '', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;html&gt;&nbsp;</div></li><li><div>  &lt;head&gt;&nbsp;</div></li><li><div>      &lt;style type=&quot;text/css&quot;&gt;#outlook a { padding: 0; }&lt;/style&gt;&nbsp;</div></li><li><div>  &lt;/head&gt;&nbsp;</div></li><li><div>  &lt;body dir=&quot;&lt;?php echo is_rtl() ? 'rtl' : 'ltr'; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  do_action( 'edd_email_body_header' );&nbsp;</div></li><li><div>  return ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Email Template Footer</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.8.2</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Email template footer</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_email_body_footer() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '2.0', '', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>  do_action( 'edd_email_body_footer' );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;/body&gt;&nbsp;</div></li><li><div>  &lt;/html&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  return ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Applies the Chosen Email Template</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.8.2</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $body The contents of the receipt email</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $payment_id The ID of the payment we are sending a receipt for</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $payment_data An array of meta information for the payment</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $email Formatted email with the template applied</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_apply_email_template( $body, $payment_id, $payment_data=array() ) {&nbsp;</div></li><li><div>  global $edd_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '2.0', '', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $template_name = isset( $edd_options['email_template'] ) ? $edd_options['email_template'] : 'default';&nbsp;</div></li><li><div>  $template_name = apply_filters( 'edd_email_template', $template_name, $payment_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $template_name == 'none' ) {&nbsp;</div></li><li><div>      if ( is_admin() )&nbsp;</div></li><li><div>          $body = edd_email_preview_template_tags( $body );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $body; <span class="comment">// Return the plain email with no template</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'edd_email_template_' . $template_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $template = ob_get_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_admin() )&nbsp;</div></li><li><div>      $body = edd_email_preview_template_tags( $body );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $body = apply_filters( 'edd_purchase_receipt_' . $template_name, $body );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $email = str_replace( '{email}', $body, $template );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $email;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if the user has enabled the option to calculate taxes after discounts</span>&nbsp;</div></li><li><div><span class="comment"> * have been entered</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.4.1</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.1</span>&nbsp;</div></li><li><div><span class="comment"> * @global $edd_options</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether or not taxes are calculated after discount</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_taxes_after_discounts() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '2.1', 'none', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $edd_options;&nbsp;</div></li><li><div>  $ret = isset( $edd_options['taxes_after_discounts'] ) && edd_use_taxes();&nbsp;</div></li><li><div>  return apply_filters( 'edd_taxes_after_discounts', $ret );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Verifies a download purchase using a purchase key and email.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated Please avoid usage of this function in favor of the tokenized urls with edd_validate_url_token()</span>&nbsp;</div></li><li><div><span class="comment"> * introduced in EDD 2.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $download_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $key</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $email</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $expire</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $file_key</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if payment and link was verified, false otherwise</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_verify_download_link( $download_id = 0, $key = '', $email = '', $expire = '', $file_key = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_query = array(&nbsp;</div></li><li><div>      'relation' =&gt; 'AND', &nbsp;</div></li><li><div>      array(&nbsp;</div></li><li><div>          'key' =&gt; '_edd_payment_purchase_key', &nbsp;</div></li><li><div>          'value' =&gt; $key&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      array(&nbsp;</div></li><li><div>          'key' =&gt; '_edd_payment_user_email', &nbsp;</div></li><li><div>          'value' =&gt; $email&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $accepted_stati = apply_filters( 'edd_allowed_download_stati', array( 'publish', 'complete' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $payments = get_posts( array( 'meta_query' =&gt; $meta_query, 'post_type' =&gt; 'edd_payment', 'post_status' =&gt; $accepted_stati ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $payments ) {&nbsp;</div></li><li><div>      foreach ( $payments as $payment ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $cart_details = edd_get_payment_meta_cart_details( $payment-&gt;ID, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $cart_details ) ) {&nbsp;</div></li><li><div>              foreach ( $cart_details as $cart_key =&gt; $cart_item ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( $cart_item['id'] != $download_id )&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $price_options = isset( $cart_item['item_number']['options'] ) ? $cart_item['item_number']['options'] : false;&nbsp;</div></li><li><div>                  $price_id = isset( $price_options['price_id'] ) ? $price_options['price_id'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $file_condition = edd_get_file_price_condition( $cart_item['id'], $file_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Check to see if the file download limit has been reached</span>&nbsp;</div></li><li><div>                  if ( edd_is_file_at_download_limit( $cart_item['id'], $payment-&gt;ID, $file_key, $price_id ) )&nbsp;</div></li><li><div>                      wp_die( apply_filters( 'edd_download_limit_reached_text', __( 'Sorry but you have hit your download limit for this file.', 'easy-digital-downloads' ) ), __( 'Error', 'easy-digital-downloads' ), array( 'response' =&gt; 403 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// If this download has variable prices, we have to confirm that this file was included in their purchase</span>&nbsp;</div></li><li><div>                  if ( ! empty( $price_options ) && $file_condition != 'all' && edd_has_variable_prices( $cart_item['id'] ) ) {&nbsp;</div></li><li><div>                      if ( $file_condition == $price_options['price_id'] )&nbsp;</div></li><li><div>                          return $payment-&gt;ID;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Make sure the link hasn't expired</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( base64_encode( base64_decode( $expire, true ) ) === $expire ) {&nbsp;</div></li><li><div>                      $expire = base64_decode( $expire ); <span class="comment">// If it is a base64 string, decode it. Old expiration dates were in base64</span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( current_time( 'timestamp' ) &gt; $expire ) {&nbsp;</div></li><li><div>                      wp_die( apply_filters( 'edd_download_link_expired_text', __( 'Sorry but your download link has expired.', 'easy-digital-downloads' ) ), __( 'Error', 'easy-digital-downloads' ), array( 'response' =&gt; 403 ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  return $payment-&gt;ID; <span class="comment">// Payment has been verified and link is still valid</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      wp_die( __( 'No payments matching your request were found.', 'easy-digital-downloads' ), __( 'Error', 'easy-digital-downloads' ), array( 'response' =&gt; 403 ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">// Payment not verified</span>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Success Page URL</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $query_string</span>&nbsp;</div></li><li><div><span class="comment"> * @access      public</span>&nbsp;</div></li><li><div><span class="comment"> * @since       1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated  2.6 Please avoid usage of this function in favor of edd_get_success_page_uri()</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function edd_get_success_page_url( $query_string = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '2.6', 'edd_get_success_page_uri()', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_success_page_url', edd_get_success_page_uri( $query_string ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Reduces earnings and sales stats when a purchase is refunded</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.8.2</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $payment_id the ID number of the payment</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $new_status the status of the payment, probably &quot;publish&quot;</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $old_status the status of the payment prior to being marked as &quot;complete&quot;, probably &quot;pending&quot;</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated  2.5.7 Please avoid usage of this function in favor of refund() in EDD_Payment</span>&nbsp;</div></li><li><div><span class="comment"> * @internal param Arguments $data passed</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_undo_purchase_on_refund( $payment_id, $new_status, $old_status ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>  _edd_deprecated_function( 'edd_undo_purchase_on_refund', '2.5.7', 'EDD_Payment-&gt;refund()', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $payment = new EDD_Payment( $payment_id );&nbsp;</div></li><li><div>  $payment-&gt;refund();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Earnings By Date</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.7</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $day Day number</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $month_num Month number</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $year Year</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $hour Hour</span>&nbsp;</div></li><li><div><span class="comment"> * @return int $earnings Earnings</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_earnings_by_date( $day = null, $month_num, $year = null, $hour = null, $include_taxes = true ) {&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '2.7', 'EDD_Payment_Stats()-&gt;get_earnings()', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array(&nbsp;</div></li><li><div>      'post_type' =&gt; 'edd_payment', &nbsp;</div></li><li><div>      'nopaging' =&gt; true, &nbsp;</div></li><li><div>      'year' =&gt; $year, &nbsp;</div></li><li><div>      'monthnum' =&gt; $month_num, &nbsp;</div></li><li><div>      'post_status' =&gt; array( 'publish', 'revoked' ), &nbsp;</div></li><li><div>      'fields' =&gt; 'ids', &nbsp;</div></li><li><div>      'update_post_term_cache' =&gt; false, &nbsp;</div></li><li><div>      'include_taxes' =&gt; $include_taxes, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $day ) ) {&nbsp;</div></li><li><div>      $args['day'] = $day;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $hour ) || $hour == 0 ) {&nbsp;</div></li><li><div>      $args['hour'] = $hour;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = apply_filters( 'edd_get_earnings_by_date_args', $args );&nbsp;</div></li><li><div>  $cached = get_transient( 'edd_stats_earnings' );&nbsp;</div></li><li><div>  $key = md5( json_encode( $args ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $cached[ $key ] ) ) {&nbsp;</div></li><li><div>      $sales = get_posts( $args );&nbsp;</div></li><li><div>      $earnings = 0;&nbsp;</div></li><li><div>      if ( $sales ) {&nbsp;</div></li><li><div>          $sales = implode( ', ', $sales );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $total_earnings = $wpdb-&gt;get_var( &quot;SELECT SUM(meta_value) FROM $wpdb-&gt;postmeta WHERE meta_key = '_edd_payment_total' AND post_id IN ({$sales})&quot; );&nbsp;</div></li><li><div>          $total_tax = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $include_taxes ) {&nbsp;</div></li><li><div>              $total_tax = $wpdb-&gt;get_var( &quot;SELECT SUM(meta_value) FROM $wpdb-&gt;postmeta WHERE meta_key = '_edd_payment_tax' AND post_id IN ({$sales})&quot; );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $earnings += ( $total_earnings - $total_tax );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Cache the results for one hour</span></span>&nbsp;</div></li><li><div>      $cached[ $key ] = $earnings;&nbsp;</div></li><li><div>      set_transient( 'edd_stats_earnings', $cached, HOUR_IN_SECONDS );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = $cached[ $key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return round( $result, 2 );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Sales By Date</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.4.0</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.7</span>&nbsp;</div></li><li><div><span class="comment"> * @author Sunny Ratilal</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $day Day number</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $month_num Month number</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $year Year</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $hour Hour</span>&nbsp;</div></li><li><div><span class="comment"> * @return int $count Sales</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_sales_by_date( $day = null, $month_num = null, $year = null, $hour = null ) {&nbsp;</div></li><li><div>  $backtrace = debug_backtrace();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  _edd_deprecated_function( __FUNCTION__, '2.7', 'EDD_Payment_Stats()-&gt;get_sales()', $backtrace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array(&nbsp;</div></li><li><div>      'post_type' =&gt; 'edd_payment', &nbsp;</div></li><li><div>      'nopaging' =&gt; true, &nbsp;</div></li><li><div>      'year' =&gt; $year, &nbsp;</div></li><li><div>      'fields' =&gt; 'ids', &nbsp;</div></li><li><div>      'post_status' =&gt; array( 'publish', 'revoked' ), &nbsp;</div></li><li><div>      'update_post_meta_cache' =&gt; false, &nbsp;</div></li><li><div>      'update_post_term_cache' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $show_free = apply_filters( 'edd_sales_by_date_show_free', true, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $show_free ) {&nbsp;</div></li><li><div>      $args['meta_query'] = array(&nbsp;</div></li><li><div>          array(&nbsp;</div></li><li><div>              'key' =&gt; '_edd_payment_total', &nbsp;</div></li><li><div>              'value' =&gt; 0, &nbsp;</div></li><li><div>              'compare' =&gt; '&gt;', &nbsp;</div></li><li><div>              'type' =&gt; 'NUMERIC', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $month_num ) )&nbsp;</div></li><li><div>      $args['monthnum'] = $month_num;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $day ) )&nbsp;</div></li><li><div>      $args['day'] = $day;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $hour ) )&nbsp;</div></li><li><div>      $args['hour'] = $hour;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = apply_filters( 'edd_get_sales_by_date_args', $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cached = get_transient( 'edd_stats_sales' );&nbsp;</div></li><li><div>  $key = md5( json_encode( $args ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $cached[ $key ] ) ) {&nbsp;</div></li><li><div>      $sales = new WP_Query( $args );&nbsp;</div></li><li><div>      $count = (int) $sales-&gt;post_count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Cache the results for one hour</span></span>&nbsp;</div></li><li><div>      $cached[ $key ] = $count;&nbsp;</div></li><li><div>      set_transient( 'edd_stats_sales', $cached, HOUR_IN_SECONDS );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = $cached[ $key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Easy Digital Downloads</li><li><span></span>2.7.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>