<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.7.8" data-slug="easy-digital-downloads" data-type="file" data-id="58065"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-admin-downloads-metabox | file | Easy Digital Downloads | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, easy-digital-downloads, 2.7.8" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ad883d7682da18692671f945acfa3a14' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-admin-downloads-metabox/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-downloads-metabox%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-admin-downloads-metabox%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-easy-digital-downloads-2.7.8-file-includes-admin-downloads-metabox","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-admin-downloads-metabox" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to easy-digital-downloads." href="http://hookr.io/plugins/easy-digital-downloads/" class="plugin"><span property="name">easy-digital-downloads</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.8." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/" class="H_VERSION"><span property="name">2.7.8</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-admin-downloads-meta&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="2274"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/all/" title="All">All <span class="count badge">2274</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="1195"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/hooks/" title="Hooks">Hooks <span class="count badge">1195</span></a></li><li class="" data-id="action" data-count="469"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/actions/" title="Actions">Actions <span class="count badge">469</span></a></li><li class="" data-id="filter" data-count="726"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/filters/" title="Filters">Filters <span class="count badge">726</span></a></li><li class="" data-id="class" data-count="99"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/" title="Classes">Classes <span class="count badge">99</span></a></li><li class="" data-id="constant" data-count="11"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/constants/" title="Constants">Constants <span class="count badge">11</span></a></li><li class="" data-id="function" data-count="955"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/functions/" title="Functions">Functions <span class="count badge">955</span></a></li><li class="" data-id="shortcode" data-count="14"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">14</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/admin/downloads/metabox.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Metabox Functions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package     EDD</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage  Admin/Downloads</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright   Copyright (c) 2015, Pippin Williamson</span>&nbsp;</div></li><li><div><span class="comment"> * @license     http://opensource.org/licenses/gpl-2.0.php GNU Public License</span>&nbsp;</div></li><li><div><span class="comment"> * @since       1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly</span>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** All Downloads *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register all the meta boxes for the Download custom post type</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_add_download_meta_box() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post_types = apply_filters( 'edd_download_metabox_post_types' , array( 'download' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $post_types as $post_type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Product Prices **/</span>&nbsp;</div></li><li><div>      add_meta_box( 'edd_product_prices', sprintf( __( '%1$s Prices', 'easy-digital-downloads' ), edd_get_label_singular(), edd_get_label_plural() ), 'edd_render_download_meta_box', $post_type, 'normal', 'high' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Product Files (and bundled products) **/</span>&nbsp;</div></li><li><div>      add_meta_box( 'edd_product_files', sprintf( __( '%1$s Files', 'easy-digital-downloads' ), edd_get_label_singular(), edd_get_label_plural() ), 'edd_render_files_meta_box', $post_type, 'normal', 'high' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Product Settings **/</span>&nbsp;</div></li><li><div>      add_meta_box( 'edd_product_settings', sprintf( __( '%1$s Settings', 'easy-digital-downloads' ), edd_get_label_singular(), edd_get_label_plural() ), 'edd_render_settings_meta_box', $post_type, 'side', 'default' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Product Notes */</span>&nbsp;</div></li><li><div>      add_meta_box( 'edd_product_notes', sprintf( __( '%1$s Notes', 'easy-digital-downloads' ), edd_get_label_singular(), edd_get_label_plural() ), 'edd_render_product_notes_meta_box', $post_type, 'normal', 'high' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( current_user_can( 'view_product_stats', get_the_ID() ) ) {&nbsp;</div></li><li><div>          <span class="comment">/** Product Stats */</span>&nbsp;</div></li><li><div>          add_meta_box( 'edd_product_stats', sprintf( __( '%1$s Stats', 'easy-digital-downloads' ), edd_get_label_singular(), edd_get_label_plural() ), 'edd_render_stats_meta_box', $post_type, 'side', 'high' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'add_meta_boxes', 'edd_add_download_meta_box' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns default EDD Download meta fields.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.9.5</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $fields Array of fields.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_download_metabox_fields() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fields = array(&nbsp;</div></li><li><div>          '_edd_product_type', &nbsp;</div></li><li><div>          'edd_price', &nbsp;</div></li><li><div>          '_variable_pricing', &nbsp;</div></li><li><div>          '_edd_price_options_mode', &nbsp;</div></li><li><div>          'edd_variable_prices', &nbsp;</div></li><li><div>          'edd_download_files', &nbsp;</div></li><li><div>          '_edd_purchase_text', &nbsp;</div></li><li><div>          '_edd_purchase_style', &nbsp;</div></li><li><div>          '_edd_purchase_color', &nbsp;</div></li><li><div>          '_edd_bundled_products', &nbsp;</div></li><li><div>          '_edd_hide_purchase_link', &nbsp;</div></li><li><div>          '_edd_download_tax_exclusive', &nbsp;</div></li><li><div>          '_edd_button_behavior', &nbsp;</div></li><li><div>          '_edd_quantities_disabled', &nbsp;</div></li><li><div>          'edd_product_notes', &nbsp;</div></li><li><div>          '_edd_default_price_id', &nbsp;</div></li><li><div>          '_edd_bundled_products_conditions'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( current_user_can( 'manage_shop_settings' ) ) {&nbsp;</div></li><li><div>      $fields[] = '_edd_download_limit';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( edd_use_skus() ) {&nbsp;</div></li><li><div>      $fields[] = 'edd_sku';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_metabox_fields_save', $fields );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Save post meta when the save_post action is called</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $post All the data of the the current post</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_download_meta_box_save( $post_id, $post ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $_POST['edd_download_meta_box_nonce'] ) || ! wp_verify_nonce( $_POST['edd_download_meta_box_nonce'], basename( __FILE__ ) ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( defined( 'DOING_AUTOSAVE' ) && DOING_AUTOSAVE ) || ( defined( 'DOING_AJAX') && DOING_AJAX ) || isset( $_REQUEST['bulk_edit'] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $post-&gt;post_type ) && 'revision' == $post-&gt;post_type ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! current_user_can( 'edit_product', $post_id ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The default fields that get saved</span>&nbsp;</div></li><li><div>  $fields = edd_download_metabox_fields();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $fields as $field ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Accept blank or &quot;0&quot;</span>&nbsp;</div></li><li><div>      if ( '_edd_download_limit' == $field ) {&nbsp;</div></li><li><div>          if ( ! empty( $_POST[ $field ] ) || ( isset( $_POST[ $field ] ) && strlen( $_POST[ $field ] ) === 0 ) || ( isset( $_POST[ $field ] ) && &quot;0&quot; === $_POST[ $field ] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $global_limit = edd_get_option( 'file_download_limit' );&nbsp;</div></li><li><div>              $new_limit = apply_filters( 'edd_metabox_save_' . $field, $_POST[ $field ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Only update the new limit if it is not the same as the global limit</span>&nbsp;</div></li><li><div>              if( $global_limit == $new_limit ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  delete_post_meta( $post_id, '_edd_download_limit' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  update_post_meta( $post_id, '_edd_download_limit', $new_limit );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } elseif ( '_edd_default_price_id' == $field && edd_has_variable_prices( $post_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST[ $field ] ) ) {&nbsp;</div></li><li><div>              $new_default_price_id = ( ! empty( $_POST[ $field ] ) && is_numeric( $_POST[ $field ] ) ) || ( 0 === (int) $_POST[ $field ] ) ? (int) $_POST[ $field ] : 1;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $new_default_price_id = 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          update_post_meta( $post_id, $field, $new_default_price_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $_POST[ $field ] ) ) {&nbsp;</div></li><li><div>              $new = apply_filters( 'edd_metabox_save_' . $field, $_POST[ $field ] );&nbsp;</div></li><li><div>              update_post_meta( $post_id, $field, $new );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              delete_post_meta( $post_id, $field );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( edd_has_variable_prices( $post_id ) ) {&nbsp;</div></li><li><div>      $lowest = edd_get_lowest_price_option( $post_id );&nbsp;</div></li><li><div>      update_post_meta( $post_id, 'edd_price', $lowest );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'edd_save_download', $post_id, $post );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'save_post', 'edd_download_meta_box_save', 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sanitize bundled products on save</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Ensures a user doesn't try and include a product's ID in the products bundled with that product</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since       1.6</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $products</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_sanitize_bundled_products_save( $products = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $self = array_search( $post-&gt;ID, $products );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( $self !== false )&nbsp;</div></li><li><div>      unset( $products[ $self ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return array_values( array_unique( $products ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'edd_metabox_save__edd_bundled_products', 'edd_sanitize_bundled_products_save' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Don't save blank rows.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * When saving, check the price and file table for blank rows.</span>&nbsp;</div></li><li><div><span class="comment"> * If the name of the price or file is empty, that row should not</span>&nbsp;</div></li><li><div><span class="comment"> * be saved.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.2</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $new Array of all the meta values</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $new New meta value with empty keys removed</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_metabox_save_check_blank_rows( $new ) {&nbsp;</div></li><li><div>  foreach ( $new as $key =&gt; $value ) {&nbsp;</div></li><li><div>      if ( empty( $value['name'] ) && empty( $value['amount'] ) && empty( $value['file'] ) )&nbsp;</div></li><li><div>          unset( $new[ $key ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $new;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Download Configuration *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Download Metabox</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Extensions (as well as the core plugin) can add items to the main download</span>&nbsp;</div></li><li><div><span class="comment"> * configuration metabox via the `edd_meta_box_fields` action.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_download_meta_box() {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output the price fields</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.9</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'edd_meta_box_price_fields', $post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output the price fields</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Left for backwards compatibility</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'edd_meta_box_fields', $post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_nonce_field( basename( __FILE__ ), 'edd_download_meta_box_nonce' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Download Files Metabox</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.9</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_files_meta_box() {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output the files fields</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.9</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'edd_meta_box_files_fields', $post-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Download Settings Metabox</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.9</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_settings_meta_box() {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output the files fields</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.9</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'edd_meta_box_settings_fields', $post-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Price Section</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If variable pricing is not enabled, simply output a single input box.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If variable pricing is enabled, outputs a table of all current prices.</span>&nbsp;</div></li><li><div><span class="comment"> * Extensions can add column heads to the table via the `edd_download_file_table_head`</span>&nbsp;</div></li><li><div><span class="comment"> * hook, and actual columns via `edd_download_file_table_row`</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see edd_render_price_row()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $post_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_price_field( $post_id ) {&nbsp;</div></li><li><div>  $price = edd_get_download_price( $post_id );&nbsp;</div></li><li><div>  $variable_pricing = edd_has_variable_prices( $post_id );&nbsp;</div></li><li><div>  $prices = edd_get_variable_prices( $post_id );&nbsp;</div></li><li><div>  $single_option_mode = edd_single_price_option_mode( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $price_display = $variable_pricing ? ' style=&quot;display:none;&quot;' : '';&nbsp;</div></li><li><div>  $variable_display = $variable_pricing ? '' : ' style=&quot;display:none;&quot;';&nbsp;</div></li><li><div>  $currency_position = edd_get_option( 'currency_position', 'before' );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;strong&gt;&lt;?php echo apply_filters( 'edd_price_options_heading', __( 'Pricing Options:', 'easy-digital-downloads' ) ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;edd_variable_pricing&quot;&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;checkbox&quot; name=&quot;_variable_pricing&quot; id=&quot;edd_variable_pricing&quot; value=&quot;1&quot; &lt;?php checked( 1, $variable_pricing ); ?&gt; /&gt;&nbsp;</div></li><li><div>          &lt;?php echo apply_filters( 'edd_variable_pricing_toggle_text', __( 'Enable variable pricing', 'easy-digital-downloads' ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;/label&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div id=&quot;edd_regular_price_field&quot; class=&quot;edd_pricing_fields&quot; &lt;?php echo $price_display; ?&gt;&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>          $price_args = array(&nbsp;</div></li><li><div>              'name' =&gt; 'edd_price', &nbsp;</div></li><li><div>              'value' =&gt; isset( $price ) ? esc_attr( edd_format_amount( $price ) ) : '', &nbsp;</div></li><li><div>              'class' =&gt; 'edd-price-field'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php if ( $currency_position == 'before' ) : ?&gt;&nbsp;</div></li><li><div>          &lt;?php echo edd_currency_filter( '' ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;text( $price_args ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php else : ?&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;text( $price_args ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php echo edd_currency_filter( '' ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_price_field', $post_id ); ?&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php do_action( 'edd_after_price_field', $post_id ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div id=&quot;edd_variable_price_fields&quot; class=&quot;edd_pricing_fields&quot; &lt;?php echo $variable_display; ?&gt;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; id=&quot;edd_variable_prices&quot; class=&quot;edd_variable_prices_name_field&quot; value=&quot;&quot;/&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;checkbox( array( 'name' =&gt; '_edd_price_options_mode', 'current' =&gt; $single_option_mode ) ); ?&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;_edd_price_options_mode&quot;&gt;&lt;?php echo apply_filters( 'edd_multi_option_purchase_text', __( 'Enable multi-option purchase mode. Allows multiple price options to be added to your cart at once', 'easy-digital-downloads' ) ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;edd_price_fields&quot; class=&quot;edd_meta_table_wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;table class=&quot;widefat edd_repeatable_table&quot; width=&quot;100%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&nbsp;</div></li><li><div>              &lt;thead&gt;&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 20px&quot;&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th&gt;&lt;?php _e( 'Option Name', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 100px&quot;&gt;&lt;?php _e( 'Price', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th class=&quot;edd_repeatable_default&quot;&gt;&lt;?php _e( 'Default', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 15px&quot;&gt;&lt;?php _e( 'ID', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;?php do_action( 'edd_download_price_table_head', $post_id ); ?&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 2%&quot;&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;/thead&gt;&nbsp;</div></li><li><div>              &lt;tbody&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                      if ( ! empty( $prices ) ) :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          foreach ( $prices as $key =&gt; $value ) :&nbsp;</div></li><li><div>                              $name = isset( $value['name'] )   ? $value['name']   : '';&nbsp;</div></li><li><div>                              $amount = isset( $value['amount'] ) ? $value['amount'] : '';&nbsp;</div></li><li><div>                              $index = isset( $value['index'] )  ? $value['index']  : $key;&nbsp;</div></li><li><div>                              $args = apply_filters( 'edd_price_row_args', compact( 'name', 'amount' ), $value );&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                              &lt;tr class=&quot;edd_variable_prices_wrapper edd_repeatable_row&quot; data-key=&quot;&lt;?php echo esc_attr( $key ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;?php do_action( 'edd_render_price_row', $key, $args, $post_id, $index ); ?&gt;&nbsp;</div></li><li><div>                              &lt;/tr&gt;&nbsp;</div></li><li><div>                          &lt;?php&nbsp;</div></li><li><div>                          endforeach;&nbsp;</div></li><li><div>                      else :&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>                      &lt;tr class=&quot;edd_variable_prices_wrapper edd_repeatable_row&quot; data-key=&quot;1&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php do_action( 'edd_render_price_row', 1, array(), $post_id, 1 ); ?&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                  &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;submit&quot; colspan=&quot;4&quot; style=&quot;float: none; clear:both; background:#fff;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;button class=&quot;button-secondary edd_add_repeatable&quot; style=&quot;margin: 6px 0;&quot;&gt;&lt;?php _e( 'Add New Price', 'easy-digital-downloads' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;/tbody&gt;&nbsp;</div></li><li><div>          &lt;/table&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&lt;!--end #edd_variable_price_fields--&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_price_fields', 'edd_render_price_field', 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Individual Price Row</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Used to output a table row for each price associated with a download.</span>&nbsp;</div></li><li><div><span class="comment"> * Can be called directly, or attached to an action.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.2</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       $key</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args</span>&nbsp;</div></li><li><div><span class="comment"> * @param       $post_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_price_row( $key, $args = array(), $post_id, $index ) {&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'name' =&gt; null, &nbsp;</div></li><li><div>      'amount' =&gt; null&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $default_price_id = edd_get_default_variable_price( $post_id );&nbsp;</div></li><li><div>  $currency_position = edd_get_option( 'currency_position', 'before' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;edd_draghandle&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;edd_variable_prices[&lt;?php echo $key; ?&gt;][index]&quot; class=&quot;edd_repeatable_index&quot; value=&quot;&lt;?php echo $index; ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;?php echo EDD()-&gt;html-&gt;text( array(&nbsp;</div></li><li><div>          'name' =&gt; 'edd_variable_prices[' . $key . '][name]', &nbsp;</div></li><li><div>          'value' =&gt; esc_attr( $args['name'] ), &nbsp;</div></li><li><div>          'placeholder' =&gt; __( 'Option Name', 'easy-digital-downloads' ), &nbsp;</div></li><li><div>          'class' =&gt; 'edd_variable_prices_name large-text'&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>          $price_args = array(&nbsp;</div></li><li><div>              'name' =&gt; 'edd_variable_prices[' . $key . '][amount]', &nbsp;</div></li><li><div>              'value' =&gt; $args['amount'], &nbsp;</div></li><li><div>              'placeholder' =&gt; edd_format_amount( 9.99 ), &nbsp;</div></li><li><div>              'class' =&gt; 'edd-price-field'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php if( $currency_position == 'before' ) : ?&gt;&nbsp;</div></li><li><div>          &lt;span&gt;&lt;?php echo edd_currency_filter( '' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;text( $price_args ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php else : ?&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;text( $price_args ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php echo edd_currency_filter( '' ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>  &lt;td class=&quot;edd_repeatable_default_wrapper&quot;&gt;&nbsp;</div></li><li><div>      &lt;label class=&quot;edd-default-price&quot;&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;radio&quot; &lt;?php checked( $default_price_id, $key, true ); ?&gt; class=&quot;edd_repeatable_default_input&quot; name=&quot;_edd_default_price_id&quot; value=&quot;&lt;?php echo $key; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php printf( __( 'Set ID %s as default price', 'easy-digital-downloads' ), $key ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/label&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;edd_price_id&quot;&gt;&lt;?php echo $key; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php do_action( 'edd_download_price_table_row', $post_id, $key, $args ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;button class=&quot;edd_remove_repeatable&quot; data-type=&quot;price&quot; style=&quot;background: url(&lt;?php echo admin_url('/images/xit.gif'); ?&gt;) no-repeat;&quot;&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php printf( __( 'Remove price option %s', 'easy-digital-downloads' ), $key ); ?&gt;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&times;&lt;/span&gt;&lt;/button&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_render_price_row', 'edd_render_price_row', 10, 4 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Product type options</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access      private</span>&nbsp;</div></li><li><div><span class="comment"> * @since       1.6</span>&nbsp;</div></li><li><div><span class="comment"> * @return      void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_product_type_field( $post_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $types = edd_get_download_types();&nbsp;</div></li><li><div>  $type = edd_get_download_type( $post_id );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;strong&gt;&lt;?php echo apply_filters( 'edd_product_type_options_heading', __( 'Product Type Options:', 'easy-digital-downloads' ) ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;?php echo EDD()-&gt;html-&gt;select( array(&nbsp;</div></li><li><div>          'options' =&gt; $types, &nbsp;</div></li><li><div>          'name' =&gt; '_edd_product_type', &nbsp;</div></li><li><div>          'id' =&gt; '_edd_product_type', &nbsp;</div></li><li><div>          'selected' =&gt; $type, &nbsp;</div></li><li><div>          'show_option_all' =&gt; false, &nbsp;</div></li><li><div>          'show_option_none' =&gt; false&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;edd_product_type&quot;&gt;&lt;?php _e( 'Select a product type', 'easy-digital-downloads' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;Product Type&lt;/strong&gt;: Sell this item as a single product, or use the Bundle type to sell a collection of products.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_files_fields', 'edd_render_product_type_field', 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders product field</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $post_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_products_field( $post_id ) {&nbsp;</div></li><li><div>  $download = new EDD_Download( $post_id );&nbsp;</div></li><li><div>  $type = $download-&gt;get_type();&nbsp;</div></li><li><div>  $display = $type == 'bundle' ? '' : ' style=&quot;display:none;&quot;';&nbsp;</div></li><li><div>  $products = $download-&gt;get_bundled_downloads();&nbsp;</div></li><li><div>  $variable_pricing = $download-&gt;has_variable_prices();&nbsp;</div></li><li><div>  $variable_display = $variable_pricing ? '' : 'display:none;';&nbsp;</div></li><li><div>  $prices = $download-&gt;get_prices();&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;edd_products&quot;&lt;?php echo $display; ?&gt;&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;edd_file_fields&quot; class=&quot;edd_meta_table_wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;table class=&quot;widefat edd_repeatable_table&quot; width=&quot;100%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&nbsp;</div></li><li><div>              &lt;thead&gt;&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 20px&quot;&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th&gt;&lt;?php printf( __( 'Bundled %s:', 'easy-digital-downloads' ), edd_get_label_plural() ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th class=&quot;pricing&quot; style=&quot;width: 20%;  &lt;?php echo $variable_display; ?&gt;&quot;&gt;&lt;?php _e( 'Price Assignment', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;?php do_action( 'edd_download_products_table_head', $post_id ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;/thead&gt;&nbsp;</div></li><li><div>              &lt;tbody&gt;&nbsp;</div></li><li><div>              &lt;?php if ( $products ) : ?&gt;&nbsp;</div></li><li><div>                  &lt;?php $index = 1; ?&gt;&nbsp;</div></li><li><div>                  &lt;?php foreach ( $products as $key =&gt; $product ) : ?&gt;&nbsp;</div></li><li><div>                      &lt;tr class=&quot;edd_repeatable_product_wrapper edd_repeatable_row&quot; data-key=&quot;&lt;?php echo esc_attr( $index ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;span class=&quot;edd_draghandle&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                              &lt;input type=&quot;hidden&quot; name=&quot;edd_bundled_products[&lt;?php echo $index; ?&gt;][index]&quot; class=&quot;edd_repeatable_index&quot; value=&quot;&lt;?php echo $index; ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                              echo EDD()-&gt;html-&gt;product_dropdown( array(&nbsp;</div></li><li><div>                                  'name' =&gt; '_edd_bundled_products[]', &nbsp;</div></li><li><div>                                  'id' =&gt; 'edd_bundled_products_' . $index, &nbsp;</div></li><li><div>                                  'selected' =&gt; $product, &nbsp;</div></li><li><div>                                  'multiple' =&gt; false, &nbsp;</div></li><li><div>                                  'chosen' =&gt; true, &nbsp;</div></li><li><div>                                  'bundles' =&gt; false, &nbsp;</div></li><li><div>                                  'variations' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                          &lt;td&gt;&nbsp;</div></li><li><div>                              &lt;button class=&quot;edd_remove_repeatable&quot; data-type=&quot;file&quot; style=&quot;background: url(&lt;?php echo admin_url('/images/xit.gif'); ?&gt;) no-repeat;&quot;&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php printf( __( 'Remove bundle option %s', 'easy-digital-downloads' ), $index ); ?&gt;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&times;&lt;/span&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                          &lt;td class=&quot;pricing&quot; style=&quot;&lt;?php echo $variable_display; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                                  $options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  if ( $prices ) {&nbsp;</div></li><li><div>                                      foreach ( $prices as $price_key =&gt; $price ) {&nbsp;</div></li><li><div>                                          $options[ $price_key ] = $prices[ $price_key ]['name'];&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  $price_assignments = edd_get_bundle_pricing_variations( $post_id );&nbsp;</div></li><li><div>                                  $price_assignments = $price_assignments[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  $selected = isset( $price_assignments[ $index ] ) ? $price_assignments[ $index ] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  echo EDD()-&gt;html-&gt;select( array(&nbsp;</div></li><li><div>                                      'name' =&gt; '_edd_bundled_products_conditions['. $index .']', &nbsp;</div></li><li><div>                                      'class' =&gt; 'edd_repeatable_condition_field', &nbsp;</div></li><li><div>                                      'options' =&gt; $options, &nbsp;</div></li><li><div>                                      'show_option_none' =&gt; false, &nbsp;</div></li><li><div>                                      'selected' =&gt; $selected&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                          &lt;?php do_action( 'edd_download_products_table_row', $post_id ); ?&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>                      &lt;?php $index++; ?&gt;&nbsp;</div></li><li><div>                  &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>              &lt;?php else: ?&gt;&nbsp;</div></li><li><div>                  &lt;tr class=&quot;edd_repeatable_product_wrapper edd_repeatable_row&quot; data-key=&quot;1&quot;&gt;&nbsp;</div></li><li><div>                      &lt;td&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;edd_draghandle&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;input type=&quot;hidden&quot; name=&quot;edd_bundled_products[1][index]&quot; class=&quot;edd_repeatable_index&quot; value=&quot;1&quot;/&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;td&gt;&nbsp;</div></li><li><div>                          &lt;?php&nbsp;</div></li><li><div>                          echo EDD()-&gt;html-&gt;product_dropdown( array(&nbsp;</div></li><li><div>                              'name' =&gt; '_edd_bundled_products[]', &nbsp;</div></li><li><div>                              'id' =&gt; 'edd_bundled_products_1', &nbsp;</div></li><li><div>                              'multiple' =&gt; false, &nbsp;</div></li><li><div>                              'chosen' =&gt; true, &nbsp;</div></li><li><div>                              'bundles' =&gt; false, &nbsp;</div></li><li><div>                              'variations' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                          ?&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;td&gt;&nbsp;</div></li><li><div>                          &lt;button class=&quot;edd_remove_repeatable&quot; data-type=&quot;file&quot; style=&quot;background: url(&lt;?php echo admin_url('/images/xit.gif'); ?&gt;) no-repeat;&quot;&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php echo __( 'Remove bundle option', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&times;&lt;/span&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;pricing&quot; style=&quot;&lt;?php echo $variable_display; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                              &lt;?php&nbsp;</div></li><li><div>                                  $options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  if ( $prices ) {&nbsp;</div></li><li><div>                                      foreach ( $prices as $price_key =&gt; $price ) {&nbsp;</div></li><li><div>                                          $options[ $price_key ] = $prices[ $price_key ]['name'];&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  $price_assignments = edd_get_bundle_pricing_variations( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  echo EDD()-&gt;html-&gt;select( array(&nbsp;</div></li><li><div>                                      'name' =&gt; '_edd_bundled_products_conditions[1]', &nbsp;</div></li><li><div>                                      'class' =&gt; 'edd_repeatable_condition_field', &nbsp;</div></li><li><div>                                      'options' =&gt; $options, &nbsp;</div></li><li><div>                                      'show_option_none' =&gt; false, &nbsp;</div></li><li><div>                                      'selected' =&gt; null, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                              ?&gt;&nbsp;</div></li><li><div>                          &lt;/td&gt;&nbsp;</div></li><li><div>                      &lt;?php do_action( 'edd_download_products_table_row', $post_id ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;submit&quot; colspan=&quot;3&quot; style=&quot;float: none; clear:both; background: #fff;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;button class=&quot;button-secondary edd_add_repeatable&quot; style=&quot;margin: 6px 0 10px;&quot;&gt;&lt;?php _e( 'Add New File', 'easy-digital-downloads' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;/tbody&gt;&nbsp;</div></li><li><div>          &lt;/table&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_files_fields', 'edd_render_products_field', 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * File Downloads section.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs a table of all current files. Extensions can add column heads to the table</span>&nbsp;</div></li><li><div><span class="comment"> * via the `edd_download_file_table_head` hook, and actual columns via</span>&nbsp;</div></li><li><div><span class="comment"> * `edd_download_file_table_row`</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see edd_render_file_row()</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_files_field( $post_id = 0 ) {&nbsp;</div></li><li><div>  $type = edd_get_download_type( $post_id );&nbsp;</div></li><li><div>  $files = edd_get_download_files( $post_id );&nbsp;</div></li><li><div>  $variable_pricing = edd_has_variable_prices( $post_id );&nbsp;</div></li><li><div>  $display = $type == 'bundle' ? ' style=&quot;display:none;&quot;' : '';&nbsp;</div></li><li><div>  $variable_display = $variable_pricing ? '' : 'display:none;';&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;edd_download_files&quot;&lt;?php echo $display; ?&gt;&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&nbsp;</div></li><li><div>          &lt;strong&gt;&lt;?php _e( 'File Downloads:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; id=&quot;edd_download_files&quot; class=&quot;edd_repeatable_upload_name_field&quot; value=&quot;&quot;/&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;div id=&quot;edd_file_fields&quot; class=&quot;edd_meta_table_wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;table class=&quot;widefat edd_repeatable_table&quot; width=&quot;100%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;&nbsp;</div></li><li><div>              &lt;thead&gt;&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 20px&quot;&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 20%&quot;&gt;&lt;?php _e( 'File Name', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th&gt;&lt;?php _e( 'File URL', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th class=&quot;pricing&quot; style=&quot;width: 20%; &lt;?php echo $variable_display; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php _e( 'Price Assignment', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>                          &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;Price Assignment&lt;/strong&gt;: With variable pricing enabled, you can choose to allow certain price variations access to specific files, or allow all price variations to access a file.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                      &lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 15px&quot;&gt;&lt;?php _e( 'ID', 'easy-digital-downloads' ); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                      &lt;?php do_action( 'edd_download_file_table_head', $post_id ); ?&gt;&nbsp;</div></li><li><div>                      &lt;th style=&quot;width: 2%&quot;&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;/thead&gt;&nbsp;</div></li><li><div>              &lt;tbody&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                  if ( ! empty( $files ) && is_array( $files ) ) :&nbsp;</div></li><li><div>                      foreach ( $files as $key =&gt; $value ) :&nbsp;</div></li><li><div>                          $index = isset( $value['index'] )         ? $value['index']         : $key;&nbsp;</div></li><li><div>                          $name = isset( $value['name'] )          ? $value['name']          : '';&nbsp;</div></li><li><div>                          $file = isset( $value['file'] )          ? $value['file']          : '';&nbsp;</div></li><li><div>                          $condition = isset( $value['condition'] )     ? $value['condition']     : false;&nbsp;</div></li><li><div>                          $attachment_id = isset( $value['attachment_id'] ) ? absint( $value['attachment_id'] ) : false;&nbsp;</div></li><li><div>                          $thumbnail_size = isset( $value['thumbnail_size'] ) ? $value['thumbnail_size'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $args = apply_filters( 'edd_file_row_args', compact( 'name', 'file', 'condition', 'attachment_id', 'thumbnail_size' ), $value );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>                      &lt;tr class=&quot;edd_repeatable_upload_wrapper edd_repeatable_row&quot; data-key=&quot;&lt;?php echo esc_attr( $key ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php do_action( 'edd_render_file_row', $key, $args, $post_id, $index ); ?&gt;&nbsp;</div></li><li><div>                      &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                      endforeach;&nbsp;</div></li><li><div>                  else :&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>                  &lt;tr class=&quot;edd_repeatable_upload_wrapper edd_repeatable_row&quot;&gt;&nbsp;</div></li><li><div>                      &lt;?php do_action( 'edd_render_file_row', 1, array(), $post_id, 0 ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>                  &lt;tr&gt;&nbsp;</div></li><li><div>                      &lt;td class=&quot;submit&quot; colspan=&quot;4&quot; style=&quot;float: none; clear:both; background: #fff;&quot;&gt;&nbsp;</div></li><li><div>                          &lt;button class=&quot;button-secondary edd_add_repeatable&quot; style=&quot;margin: 6px 0 10px;&quot;&gt;&lt;?php _e( 'Add New File', 'easy-digital-downloads' ); ?&gt;&lt;/button&gt;&nbsp;</div></li><li><div>                      &lt;/td&gt;&nbsp;</div></li><li><div>                  &lt;/tr&gt;&nbsp;</div></li><li><div>              &lt;/tbody&gt;&nbsp;</div></li><li><div>          &lt;/table&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_files_fields', 'edd_render_files_field', 20 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Individual file row.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Used to output a table row for each file associated with a download.</span>&nbsp;</div></li><li><div><span class="comment"> * Can be called directly, or attached to an action.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.2</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $key Array key</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args Array of all the arguments passed to the function</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_file_row( $key = '', $args = array(), $post_id, $index ) {&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'name' =&gt; null, &nbsp;</div></li><li><div>      'file' =&gt; null, &nbsp;</div></li><li><div>      'condition' =&gt; null, &nbsp;</div></li><li><div>      'attachment_id' =&gt; null, &nbsp;</div></li><li><div>      'thumbnail_size' =&gt; null, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $prices = edd_get_variable_prices( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $variable_pricing = edd_has_variable_prices( $post_id );&nbsp;</div></li><li><div>  $variable_display = $variable_pricing ? '' : ' style=&quot;display:none;&quot;';&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;edd_draghandle&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;edd_download_files[&lt;?php echo $key; ?&gt;][index]&quot; class=&quot;edd_repeatable_index&quot; value=&quot;&lt;?php echo $index; ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;edd_download_files[&lt;?php echo absint( $key ); ?&gt;][attachment_id]&quot; class=&quot;edd_repeatable_attachment_id_field&quot; value=&quot;&lt;?php echo esc_attr( absint( $args['attachment_id'] ) ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;edd_download_files[&lt;?php echo absint( $key ); ?&gt;][thumbnail_size]&quot; class=&quot;edd_repeatable_thumbnail_size_field&quot; value=&quot;&lt;?php echo esc_attr( $args['thumbnail_size'] ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>      &lt;?php echo EDD()-&gt;html-&gt;text( array(&nbsp;</div></li><li><div>          'name' =&gt; 'edd_download_files[' . $key . '][name]', &nbsp;</div></li><li><div>          'value' =&gt; $args['name'], &nbsp;</div></li><li><div>          'placeholder' =&gt; __( 'File Name', 'easy-digital-downloads' ), &nbsp;</div></li><li><div>          'class' =&gt; 'edd_repeatable_name_field large-text'&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;edd_repeatable_upload_field_container&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;text( array(&nbsp;</div></li><li><div>              'name' =&gt; 'edd_download_files[' . $key . '][file]', &nbsp;</div></li><li><div>              'value' =&gt; $args['file'], &nbsp;</div></li><li><div>              'placeholder' =&gt; __( 'Upload or enter the file URL', 'easy-digital-downloads' ), &nbsp;</div></li><li><div>              'class' =&gt; 'edd_repeatable_upload_field edd_upload_field large-text'&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;span class=&quot;edd_upload_file&quot;&gt;&nbsp;</div></li><li><div>              &lt;a href=&quot;#&quot; data-uploader-title=&quot;&lt;?php _e( 'Insert File', 'easy-digital-downloads' ); ?&gt;&quot; data-uploader-button-text=&quot;&lt;?php _e( 'Insert', 'easy-digital-downloads' ); ?&gt;&quot; class=&quot;edd_upload_file_button&quot; onclick=&quot;return false;&quot;&gt;&lt;?php _e( 'Upload a File', 'easy-digital-downloads' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td class=&quot;pricing&quot;&lt;?php echo $variable_display; ?&gt;&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>          $options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $prices ) {&nbsp;</div></li><li><div>              foreach ( $prices as $price_key =&gt; $price ) {&nbsp;</div></li><li><div>                  $options[ $price_key ] = $prices[ $price_key ]['name'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo EDD()-&gt;html-&gt;select( array(&nbsp;</div></li><li><div>              'name' =&gt; 'edd_download_files[' . $key . '][condition]', &nbsp;</div></li><li><div>              'class' =&gt; 'edd_repeatable_condition_field', &nbsp;</div></li><li><div>              'options' =&gt; $options, &nbsp;</div></li><li><div>              'selected' =&gt; $args['condition'], &nbsp;</div></li><li><div>              'show_option_none' =&gt; false&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;edd_file_id&quot;&gt;&lt;?php echo $key; ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php do_action( 'edd_download_file_table_row', $post_id, $key, $args ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;button class=&quot;edd_remove_repeatable&quot; data-type=&quot;file&quot; style=&quot;background: url(&lt;?php echo admin_url('/images/xit.gif'); ?&gt;) no-repeat;&quot;&gt;&lt;span class=&quot;screen-reader-text&quot;&gt;&lt;?php printf( __( 'Remove file option %s', 'easy-digital-downloads' ), $key ); ?&gt;&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&times;&lt;/span&gt;&lt;/button&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_render_file_row', 'edd_render_file_row', 10, 4 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Alter the Add to post button in the media manager for downloads</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  2.2</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array $strings Array of default strings for media manager</span>&nbsp;</div></li><li><div><span class="comment"> * @return array          The altered array of strings for media manager</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_download_media_strings( $strings ) {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $post || $post-&gt;post_type !== 'download' ) {&nbsp;</div></li><li><div>      return $strings;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $downloads_object = get_post_type_object( 'download' );&nbsp;</div></li><li><div>  $labels = $downloads_object-&gt;labels;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $strings['insertIntoPost'] = sprintf( __( 'Insert into %s', 'easy-digital-downloads' ), strtolower( $labels-&gt;singular_name ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $strings;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'media_view_strings', 'edd_download_media_strings', 10, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * File Download Limit Row</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The file download limit is the maximum number of times each file</span>&nbsp;</div></li><li><div><span class="comment"> * can be downloaded by the buyer</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.3.1</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_download_limit_row( $post_id ) {&nbsp;</div></li><li><div>  if( ! current_user_can( 'manage_shop_settings' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $edd_download_limit = edd_get_file_download_limit( $post_id );&nbsp;</div></li><li><div>  $display = 'bundle' == edd_get_download_type( $post_id ) ? ' style=&quot;display: none;&quot;' : '';&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;edd_download_limit_wrap&quot;&lt;?php echo $display; ?&gt;&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&lt;strong&gt;&lt;?php _e( 'File Download Limit:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&lt;/p&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;edd_download_limit&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;text( array(&nbsp;</div></li><li><div>              'name' =&gt; '_edd_download_limit', &nbsp;</div></li><li><div>              'value' =&gt; $edd_download_limit, &nbsp;</div></li><li><div>              'class' =&gt; 'small-text'&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php _e( 'Leave blank for global setting or 0 for unlimited', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>      &lt;/label&gt;&nbsp;</div></li><li><div>      &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;File Download Limit&lt;/strong&gt;: Limit the number of times a customer who purchased this product can access their download links.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_settings_fields', 'edd_render_download_limit_row', 20 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Product tax settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the option to mark whether a product is exclusive of tax</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.9</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_dowwn_tax_options( $post_id = 0 ) {&nbsp;</div></li><li><div>  if( ! current_user_can( 'manage_shop_settings' ) || ! edd_use_taxes() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $exclusive = edd_download_is_tax_exclusive( $post_id );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;strong&gt;&lt;?php _e( 'Ignore Tax:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;label for=&quot;_edd_download_tax_exclusive&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php echo EDD()-&gt;html-&gt;checkbox( array(&nbsp;</div></li><li><div>          'name' =&gt; '_edd_download_tax_exclusive', &nbsp;</div></li><li><div>          'current' =&gt; $exclusive&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php _e( 'Mark this product as exclusive of tax', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>  &lt;/label&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_settings_fields', 'edd_render_dowwn_tax_options', 30 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Product quantity settings</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the option to disable quantity field on product.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_download_quantity_option( $post_id = 0 ) {&nbsp;</div></li><li><div>  if( ! current_user_can( 'manage_shop_settings' ) || ! edd_item_quantities_enabled() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $disabled = edd_download_quantities_disabled( $post_id );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;strong&gt;&lt;?php _e( 'Item Quantities:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;label for=&quot;_edd_quantities_disabled&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php echo EDD()-&gt;html-&gt;checkbox( array(&nbsp;</div></li><li><div>          'name' =&gt; '_edd_quantities_disabled', &nbsp;</div></li><li><div>          'current' =&gt; $disabled&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php _e( 'Disable quantity input for this product', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>  &lt;/label&gt;&nbsp;</div></li><li><div>  &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;Item Quantities&lt;/strong&gt;: if disabled, customers will not be provided an option to change the number they wish to purchase.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_settings_fields', 'edd_render_download_quantity_option', 30 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add shortcode to settings meta box</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $post Contains all the download data</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_meta_box_shortcode() {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( $post-&gt;post_type != 'download' ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $purchase_text = edd_get_option( 'add_to_cart_text', __( 'Purchase', 'easy-digital-downloads' ) );&nbsp;</div></li><li><div>  $style = edd_get_option( 'button_style', 'button' );&nbsp;</div></li><li><div>  $color = edd_get_option( 'checkout_color', 'blue' );&nbsp;</div></li><li><div>  $color = ( $color == 'inherit' ) ? '' : $color;&nbsp;</div></li><li><div>  $shortcode = '[purchase_link id=&quot;' . absint( $post-&gt;ID ) . '&quot; text=&quot;' . esc_html( $purchase_text ) . '&quot; style=&quot;' . $style . '&quot; color=&quot;' . esc_attr( $color ) . '&quot;]';&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;strong&gt;&lt;?php _e( 'Purchase Shortcode:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>      &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;Purchse Shortcode&lt;/strong&gt;: Use this shortcode to output a purchase link for this product in the location of your choosing.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;text&quot; id=&quot;edd-purchase-shortcode&quot; class=&quot;widefat&quot; readonly=&quot;readonly&quot; value=&quot;&lt;?php echo htmlentities( $shortcode ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_settings_fields', 'edd_render_meta_box_shortcode', 35 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render Accounting Options</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_accounting_options( $post_id ) {&nbsp;</div></li><li><div>  if( ! edd_use_skus() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $edd_sku = get_post_meta( $post_id, 'edd_sku', true );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&lt;strong&gt;&lt;?php _e( 'Accounting Options:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;edd_sku&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php echo EDD()-&gt;html-&gt;text( array(&nbsp;</div></li><li><div>                  'name' =&gt; 'edd_sku', &nbsp;</div></li><li><div>                  'value' =&gt; $edd_sku, &nbsp;</div></li><li><div>                  'class' =&gt; 'small-text'&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php echo sprintf( __( 'Enter an SKU for this %s.', 'easy-digital-downloads' ), strtolower( edd_get_label_singular() ) ); ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_settings_fields', 'edd_render_accounting_options', 25 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render Disable Button</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_disable_button( $post_id ) {&nbsp;</div></li><li><div>  $hide_button = get_post_meta( $post_id, '_edd_hide_purchase_link', true ) ? 1 : 0;&nbsp;</div></li><li><div>  $behavior = get_post_meta( $post_id, '_edd_button_behavior', true );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;strong&gt;&lt;?php _e( 'Button Options:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;_edd_hide_purchase_link&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;checkbox( array(&nbsp;</div></li><li><div>              'name' =&gt; '_edd_hide_purchase_link', &nbsp;</div></li><li><div>              'current' =&gt; $hide_button&nbsp;</div></li><li><div> ) ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php _e( 'Disable the automatic output of the purchase button', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>          &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;Automatic Output&lt;/strong&gt;: By default, the purchase buttons will be displayed at the bottom of the download, when disabled you will need to use the Purchase link shortcode below to output the ability to buy the product where you prefer.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/label&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;?php $supports_buy_now = edd_shop_supports_buy_now(); ?&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;_edd_button_behavior&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          $args = array(&nbsp;</div></li><li><div>              'name' =&gt; '_edd_button_behavior', &nbsp;</div></li><li><div>              'options' =&gt; array(&nbsp;</div></li><li><div>                  'add_to_cart' =&gt; __( 'Add to Cart', 'easy-digital-downloads' ), &nbsp;</div></li><li><div>                  'direct' =&gt; __( 'Buy Now', 'easy-digital-downloads' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'show_option_all' =&gt; null, &nbsp;</div></li><li><div>              'show_option_none' =&gt; null, &nbsp;</div></li><li><div>              'selected' =&gt; $behavior&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $supports_buy_now ) {&nbsp;</div></li><li><div>              $args['disabled'] = true;&nbsp;</div></li><li><div>              $args['readonly'] = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;?php echo EDD()-&gt;html-&gt;select( $args ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php _e( 'Purchase button behavior', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php if ( $supports_buy_now ) : ?&gt;&nbsp;</div></li><li><div>              &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;Button Behavior&lt;/strong&gt;: Add to Cart buttons follow a traditional eCommerce flow. A Buy Now button bypasses most of the process, taking the customer directly from button click to payment, greatly speeding up the process of buying the product.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;?php else: ?&gt;&nbsp;</div></li><li><div>              &lt;span alt=&quot;f223&quot; class=&quot;edd-help-tip dashicons dashicons-editor-help&quot; title=&quot;&lt;?php _e( '&lt;strong&gt;Button Behavior&lt;/strong&gt;: Add to Cart buttons follow a traditional eCommerce flow. Buy Now buttons are only available for stores that have a single supported gateway active and that do not use taxes.', 'easy-digital-downloads' ); ?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;/label&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_meta_box_settings_fields', 'edd_render_disable_button', 30 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Product Notes *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Product Notes Meta Box</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the Product Notes meta box</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.1</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $post Contains all the download data</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_product_notes_meta_box() {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'edd_product_notes_meta_box_fields', $post-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render Product Notes Field</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.1</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $post_id Download (Post) ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_product_notes_field( $post_id ) {&nbsp;</div></li><li><div>  $product_notes = edd_get_product_notes( $post_id );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;textarea rows=&quot;1&quot; cols=&quot;40&quot; class=&quot;large-texarea&quot; name=&quot;edd_product_notes&quot; id=&quot;edd_product_notes_field&quot;&gt;&lt;?php echo esc_textarea( $product_notes ); ?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'Special notes or instructions for this product. These notes will be added to the purchase receipt.', 'easy-digital-downloads' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_product_notes_meta_box_fields', 'edd_render_product_notes_field' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Stats *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render Stats Meta Box</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $post Contains all the download data</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_render_stats_meta_box() {&nbsp;</div></li><li><div>  global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( ! current_user_can( 'view_product_stats', $post-&gt;ID ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $earnings = edd_get_download_earnings_stats( $post-&gt;ID );&nbsp;</div></li><li><div>  $sales = edd_get_download_sales_stats( $post-&gt;ID );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p class=&quot;product-sales-stats&quot;&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;label&quot;&gt;&lt;?php _e( 'Sales:', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;span&gt;&lt;a href=&quot;&lt;?php echo admin_url( '/edit.php?page=edd-reports&view=sales&post_type=download&tab=logs&download=' . $post-&gt;ID ); ?&gt;&quot;&gt;&lt;?php echo $sales; ?&gt;&lt;/a&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p class=&quot;product-earnings-stats&quot;&gt;&nbsp;</div></li><li><div>      &lt;span class=&quot;label&quot;&gt;&lt;?php _e( 'Earnings:', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;span&gt;&lt;a href=&quot;&lt;?php echo admin_url( 'edit.php?post_type=download&page=edd-reports&view=downloads&download-id=' . $post-&gt;ID ); ?&gt;&quot;&gt;&lt;?php echo edd_currency_filter( edd_format_amount( $earnings ) ); ?&gt;&lt;/a&gt;&lt;/span&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;hr /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p class=&quot;file-download-log&quot;&gt;&nbsp;</div></li><li><div>      &lt;span&gt;&lt;a href=&quot;&lt;?php echo admin_url( 'edit.php?page=edd-reports&view=file_downloads&post_type=download&tab=logs&download=' . $post-&gt;ID ); ?&gt;&quot;&gt;&lt;?php _e( 'View File Download Log', 'easy-digital-downloads' ); ?&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  do_action('edd_stats_meta_box');&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Easy Digital Downloads</li><li><span></span>2.7.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>