<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.7.8" data-slug="easy-digital-downloads" data-type="file" data-id="58134"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-checkout-template | file | Easy Digital Downloads | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, easy-digital-downloads, 2.7.8" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=a2928ab9a82c55fdfb64b8a1166566b9' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-checkout-template/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-checkout-template%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-checkout-template%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-easy-digital-downloads-2.7.8-file-includes-checkout-template","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-checkout-template" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to easy-digital-downloads." href="http://hookr.io/plugins/easy-digital-downloads/" class="plugin"><span property="name">easy-digital-downloads</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.8." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/" class="H_VERSION"><span property="name">2.7.8</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-checkout-template</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="2274"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/all/" title="All">All <span class="count badge">2274</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="1195"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/hooks/" title="Hooks">Hooks <span class="count badge">1195</span></a></li><li class="" data-id="action" data-count="469"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/actions/" title="Actions">Actions <span class="count badge">469</span></a></li><li class="" data-id="filter" data-count="726"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/filters/" title="Filters">Filters <span class="count badge">726</span></a></li><li class="" data-id="class" data-count="99"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/" title="Classes">Classes <span class="count badge">99</span></a></li><li class="" data-id="constant" data-count="11"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/constants/" title="Constants">Constants <span class="count badge">11</span></a></li><li class="" data-id="function" data-count="955"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/functions/" title="Functions">Functions <span class="count badge">955</span></a></li><li class="" data-id="shortcode" data-count="14"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">14</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/checkout/template.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checkout Template</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package     EDD</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage  Checkout</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright   Copyright (c) 2015, Pippin Williamson</span>&nbsp;</div></li><li><div><span class="comment"> * @license     http://opensource.org/licenses/gpl-2.0.php GNU Public License</span>&nbsp;</div></li><li><div><span class="comment"> * @since       1.0</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly</span>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Checkout Form</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_checkout_form() {&nbsp;</div></li><li><div>  $payment_mode = edd_get_chosen_gateway();&nbsp;</div></li><li><div>  $form_action = esc_url( edd_get_checkout_uri( 'payment-mode=' . $payment_mode ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>      echo '&lt;div id=&quot;edd_checkout_wrap&quot;&gt;';&nbsp;</div></li><li><div>      if ( edd_get_cart_contents() || edd_cart_has_fees() ) :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          edd_checkout_cart();&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;edd_checkout_form_wrap&quot; class=&quot;edd_clearfix&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php do_action( 'edd_before_purchase_form' ); ?&gt;&nbsp;</div></li><li><div>              &lt;form id=&quot;edd_purchase_form&quot; class=&quot;edd_form&quot; action=&quot;&lt;?php echo $form_action; ?&gt;&quot; method=&quot;POST&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Hooks in at the top of the checkout form</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  do_action( 'edd_checkout_form_top' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( edd_is_ajax_disabled() && ! empty( $_REQUEST['payment-mode'] ) ) {&nbsp;</div></li><li><div>                      do_action( 'edd_purchase_form' );&nbsp;</div></li><li><div>                  } elseif ( edd_show_gateways() ) {&nbsp;</div></li><li><div>                      do_action( 'edd_payment_mode_select' );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      do_action( 'edd_purchase_form' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Hooks in at the bottom of the checkout form</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  do_action( 'edd_checkout_form_bottom' )&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/form&gt;&nbsp;</div></li><li><div>              &lt;?php do_action( 'edd_after_purchase_form' ); ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&lt;!--end #edd_checkout_form_wrap--&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      else:&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires off when there is nothing in the cart</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'edd_cart_empty' );&nbsp;</div></li><li><div>      endif;&nbsp;</div></li><li><div>      echo '&lt;/div&gt;&lt;!--end #edd_checkout_wrap--&gt;';&nbsp;</div></li><li><div>  return ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the Purchase Form, hooks are provided to add to the purchase form.</span>&nbsp;</div></li><li><div><span class="comment"> * The default Purchase Form rendered displays a list of the enabled payment</span>&nbsp;</div></li><li><div><span class="comment"> * gateways, a user registration form (if enable) and a credit card info form</span>&nbsp;</div></li><li><div><span class="comment"> * if credit cards are enabled</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.4</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_show_purchase_form() {&nbsp;</div></li><li><div>  $payment_mode = edd_get_chosen_gateway();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Hooks in at the top of the purchase form</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.4</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'edd_purchase_form_top' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( edd_can_checkout() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do_action( 'edd_purchase_form_before_register_login' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $show_register_form = edd_get_option( 'show_register_form', 'none' ) ;&nbsp;</div></li><li><div>      if( ( $show_register_form === 'registration' || ( $show_register_form === 'both' && ! isset( $_GET['login'] ) ) ) && ! is_user_logged_in() ) : ?&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;edd_checkout_login_register&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php do_action( 'edd_purchase_form_register_fields' ); ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php elseif( ( $show_register_form === 'login' || ( $show_register_form === 'both' && isset( $_GET['login'] ) ) ) && ! is_user_logged_in() ) : ?&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;edd_checkout_login_register&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php do_action( 'edd_purchase_form_login_fields' ); ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php if( ( ! isset( $_GET['login'] ) && is_user_logged_in() ) || ! isset( $show_register_form ) || 'none' === $show_register_form || 'login' === $show_register_form ) {&nbsp;</div></li><li><div>          do_action( 'edd_purchase_form_after_user_info' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Hooks in before Credit Card Form</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.4</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'edd_purchase_form_before_cc_form' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( edd_get_cart_total() &gt; 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Load the credit card form and allow gateways to load their own if they wish</span>&nbsp;</div></li><li><div>          if ( has_action( 'edd_' . $payment_mode . '_cc_form' ) ) {&nbsp;</div></li><li><div>              do_action( 'edd_' . $payment_mode . '_cc_form' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              do_action( 'edd_cc_form' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Hooks in after Credit Card Form</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.4</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'edd_purchase_form_after_cc_form' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Can't checkout</span>&nbsp;</div></li><li><div>      do_action( 'edd_purchase_form_no_access' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Hooks in at the bottom of the purchase form</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.4</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'edd_purchase_form_bottom' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form', 'edd_show_purchase_form' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Shows the User Info fields in the Personal Info box, more fields can be added</span>&nbsp;</div></li><li><div><span class="comment"> * via the hooks provided.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.3.3</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_user_info_fields() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $customer = EDD()-&gt;session-&gt;get( 'customer' );&nbsp;</div></li><li><div>  $customer = wp_parse_args( $customer, array( 'first_name' =&gt; '', 'last_name' =&gt; '', 'email' =&gt; '' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( is_user_logged_in() ) {&nbsp;</div></li><li><div>      $user_data = get_userdata( get_current_user_id() );&nbsp;</div></li><li><div>      foreach( $customer as $key =&gt; $field ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'email' == $key && empty( $field ) ) {&nbsp;</div></li><li><div>              $customer[ $key ] = $user_data-&gt;user_email;&nbsp;</div></li><li><div>          } elseif ( empty( $field ) ) {&nbsp;</div></li><li><div>              $customer[ $key ] = $user_data-&gt;$key;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $customer = array_map( 'sanitize_text_field', $customer );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;fieldset id=&quot;edd_checkout_user_info&quot;&gt;&nbsp;</div></li><li><div>      &lt;legend&gt;&lt;?php echo apply_filters( 'edd_checkout_personal_info_text', esc_html__( 'Personal Info', 'easy-digital-downloads' ) ); ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_before_email' ); ?&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-email-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label class=&quot;edd-label&quot; for=&quot;edd-email&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php esc_html_e( 'Email Address', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'edd_email' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot; id=&quot;edd-email-description&quot;&gt;&lt;?php esc_html_e( 'We will send the purchase receipt to this address.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input class=&quot;edd-input required&quot; type=&quot;email&quot; name=&quot;edd_email&quot; placeholder=&quot;&lt;?php esc_html_e( 'Email address', 'easy-digital-downloads' ); ?&gt;&quot; id=&quot;edd-email&quot; value=&quot;&lt;?php echo esc_attr( $customer['email'] ); ?&gt;&quot; aria-describedby=&quot;edd-email-description&quot;&lt;?php if( edd_field_is_required( 'edd_email' ) ) {  echo ' required '; } ?&gt;/&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_after_email' ); ?&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-first-name-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label class=&quot;edd-label&quot; for=&quot;edd-first&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php esc_html_e( 'First Name', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'edd_first' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot; id=&quot;edd-first-description&quot;&gt;&lt;?php esc_html_e( 'We will use this to personalize your account experience.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input class=&quot;edd-input required&quot; type=&quot;text&quot; name=&quot;edd_first&quot; placeholder=&quot;&lt;?php esc_html_e( 'First Name', 'easy-digital-downloads' ); ?&gt;&quot; id=&quot;edd-first&quot; value=&quot;&lt;?php echo esc_attr( $customer['first_name'] ); ?&gt;&quot;&lt;?php if( edd_field_is_required( 'edd_first' ) ) {  echo ' required '; } ?&gt; aria-describedby=&quot;edd-first-description&quot; /&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-last-name-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label class=&quot;edd-label&quot; for=&quot;edd-last&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php esc_html_e( 'Last Name', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'edd_last' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot; id=&quot;edd-last-description&quot;&gt;&lt;?php esc_html_e( 'We will use this as well to personalize your account experience.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input class=&quot;edd-input&lt;?php if( edd_field_is_required( 'edd_last' ) ) { echo ' required'; } ?&gt;&quot; type=&quot;text&quot; name=&quot;edd_last&quot; id=&quot;edd-last&quot; placeholder=&quot;&lt;?php esc_html_e( 'Last Name', 'easy-digital-downloads' ); ?&gt;&quot; value=&quot;&lt;?php echo esc_attr( $customer['last_name'] ); ?&gt;&quot;&lt;?php if( edd_field_is_required( 'edd_last' ) ) {  echo ' required '; } ?&gt; aria-describedby=&quot;edd-last-description&quot;/&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_user_info' ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_user_info_fields' ); ?&gt;&nbsp;</div></li><li><div>  &lt;/fieldset&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form_after_user_info', 'edd_user_info_fields' );&nbsp;</div></li><li><div>add_action( 'edd_register_fields_before', 'edd_user_info_fields' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the credit card info form.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_cc_form() {&nbsp;</div></li><li><div>  ob_start(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php do_action( 'edd_before_cc_fields' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;fieldset id=&quot;edd_cc_fields&quot; class=&quot;edd-do-validate&quot;&gt;&nbsp;</div></li><li><div>      &lt;legend&gt;&lt;?php _e( 'Credit Card Info', 'easy-digital-downloads' ); ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>      &lt;?php if( is_ssl() ) : ?&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;edd_secure_site_wrapper&quot;&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;padlock&quot;&gt;&nbsp;</div></li><li><div>                  &lt;svg class=&quot;edd-icon edd-icon-lock&quot; xmlns=&quot;http:<span class="comment">//www.w3.org/2000/svg&quot; width=&quot;18&quot; height=&quot;28&quot; viewBox=&quot;0 0 18 28&quot; aria-hidden=&quot;true&quot;&gt;</span>&nbsp;</div></li><li><div>                      &lt;path d=&quot;M5 12h8V9c0-2.203-1.797-4-4-4S5 6.797 5 9v3zm13 1.5v9c0 .828-.672 1.5-1.5 1.5h-15C.672 24 0 23.328 0 22.5v-9c0-.828.672-1.5 1.5-1.5H2V9c0-3.844 3.156-7 7-7s7 3.156 7 7v3h.5c.828 0 1.5.672 1.5 1.5z&quot;/&gt;&nbsp;</div></li><li><div>                  &lt;/svg&gt;&nbsp;</div></li><li><div>              &lt;/span&gt;&nbsp;</div></li><li><div>              &lt;span&gt;&lt;?php _e( 'This is a secure SSL encrypted payment.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-number-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_number&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Card Number', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;card-type&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The (typically) 16 digits on the front of your credit card.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;tel&quot; pattern=&quot;[0-9]{13, 16}&quot; autocomplete=&quot;off&quot; name=&quot;card_number&quot; id=&quot;card_number&quot; class=&quot;card-number edd-input required&quot; placeholder=&quot;&lt;?php _e( 'Card number', 'easy-digital-downloads' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-cvc-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_cvc&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'CVC', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The 3 digit (back) or 4 digit (front) value on your card.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;tel&quot; pattern=&quot;[0-9]{3, 4}&quot; size=&quot;4&quot; maxlength=&quot;4&quot; autocomplete=&quot;off&quot; name=&quot;card_cvc&quot; id=&quot;card_cvc&quot; class=&quot;card-cvc edd-input required&quot; placeholder=&quot;&lt;?php _e( 'Security code', 'easy-digital-downloads' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-name-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_name&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Name on the Card', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The name printed on the front of your credit card.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;text&quot; autocomplete=&quot;off&quot; name=&quot;card_name&quot; id=&quot;card_name&quot; class=&quot;card-name edd-input required&quot; placeholder=&quot;&lt;?php _e( 'Card name', 'easy-digital-downloads' ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_before_cc_expiration' ); ?&gt;&nbsp;</div></li><li><div>      &lt;p class=&quot;card-expiration&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_exp_month&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Expiration (MM/YY)', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The date your credit card expires, typically on the front of the card.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;select id=&quot;card_exp_month&quot; name=&quot;card_exp_month&quot; class=&quot;card-expiry-month edd-select edd-select-small required&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php for( $i = 1; $i &lt;= 12; $i++ ) { echo '&lt;option value=&quot;' . $i . '&quot;&gt;' . sprintf ('%02d', $i ) . '&lt;/option&gt;'; } ?&gt;&nbsp;</div></li><li><div>          &lt;/select&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;exp-divider&quot;&gt; / &lt;/span&gt;&nbsp;</div></li><li><div>          &lt;select id=&quot;card_exp_year&quot; name=&quot;card_exp_year&quot; class=&quot;card-expiry-year edd-select edd-select-small required&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php for( $i = date('Y'); $i &lt;= date('Y') + 30; $i++ ) { echo '&lt;option value=&quot;' . $i . '&quot;&gt;' . substr( $i, 2 ) . '&lt;/option&gt;'; } ?&gt;&nbsp;</div></li><li><div>          &lt;/select&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_after_cc_expiration' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;/fieldset&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  do_action( 'edd_after_cc_fields' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_cc_form', 'edd_get_cc_form' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the default credit card address fields</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_default_cc_address_fields() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $logged_in = is_user_logged_in();&nbsp;</div></li><li><div>  $customer = EDD()-&gt;session-&gt;get( 'customer' );&nbsp;</div></li><li><div>  $customer = wp_parse_args( $customer, array( 'address' =&gt; array(&nbsp;</div></li><li><div>      'line1' =&gt; '', &nbsp;</div></li><li><div>      'line2' =&gt; '', &nbsp;</div></li><li><div>      'city' =&gt; '', &nbsp;</div></li><li><div>      'zip' =&gt; '', &nbsp;</div></li><li><div>      'state' =&gt; '', &nbsp;</div></li><li><div>      'country' =&gt; ''&nbsp;</div></li><li><div> ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $customer['address'] = array_map( 'sanitize_text_field', $customer['address'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( $logged_in ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $user_address = get_user_meta( get_current_user_id(), '_edd_user_address', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach( $customer['address'] as $key =&gt; $field ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $field ) && ! empty( $user_address[ $key ] ) ) {&nbsp;</div></li><li><div>              $customer['address'][ $key ] = $user_address[ $key ];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $customer['address'][ $key ] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start(); ?&gt;&nbsp;</div></li><li><div>  &lt;fieldset id=&quot;edd_cc_address&quot; class=&quot;cc-address&quot;&gt;&nbsp;</div></li><li><div>      &lt;legend&gt;&lt;?php _e( 'Billing Details', 'easy-digital-downloads' ); ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_cc_billing_top' ); ?&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-address-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_address&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Billing Address', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'card_address' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The primary billing address for your credit card.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;text&quot; id=&quot;card_address&quot; name=&quot;card_address&quot; class=&quot;card-address edd-input&lt;?php if( edd_field_is_required( 'card_address' ) ) { echo ' required'; } ?&gt;&quot; placeholder=&quot;&lt;?php _e( 'Address line 1', 'easy-digital-downloads' ); ?&gt;&quot; value=&quot;&lt;?php echo $customer['address']['line1']; ?&gt;&quot;&lt;?php if( edd_field_is_required( 'card_address' ) ) {  echo ' required '; } ?&gt;/&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-address-2-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_address_2&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Billing Address Line 2 (optional)', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'card_address_2' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The suite, apt no, PO box, etc, associated with your billing address.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;text&quot; id=&quot;card_address_2&quot; name=&quot;card_address_2&quot; class=&quot;card-address-2 edd-input&lt;?php if( edd_field_is_required( 'card_address_2' ) ) { echo ' required'; } ?&gt;&quot; placeholder=&quot;&lt;?php _e( 'Address line 2', 'easy-digital-downloads' ); ?&gt;&quot; value=&quot;&lt;?php echo $customer['address']['line2']; ?&gt;&quot;&lt;?php if( edd_field_is_required( 'card_address_2' ) ) {  echo ' required '; } ?&gt;/&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-city-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_city&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Billing City', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'card_city' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The city for your billing address.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;text&quot; id=&quot;card_city&quot; name=&quot;card_city&quot; class=&quot;card-city edd-input&lt;?php if( edd_field_is_required( 'card_city' ) ) { echo ' required'; } ?&gt;&quot; placeholder=&quot;&lt;?php _e( 'City', 'easy-digital-downloads' ); ?&gt;&quot; value=&quot;&lt;?php echo $customer['address']['city']; ?&gt;&quot;&lt;?php if( edd_field_is_required( 'card_city' ) ) {  echo ' required '; } ?&gt;/&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-zip-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_zip&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Billing Zip / Postal Code', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'card_zip' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The zip or postal code for your billing address.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;text&quot; size=&quot;4&quot; id=&quot;card_zip&quot; name=&quot;card_zip&quot; class=&quot;card-zip edd-input&lt;?php if( edd_field_is_required( 'card_zip' ) ) { echo ' required'; } ?&gt;&quot; placeholder=&quot;&lt;?php _e( 'Zip / Postal Code', 'easy-digital-downloads' ); ?&gt;&quot; value=&quot;&lt;?php echo $customer['address']['zip']; ?&gt;&quot;&lt;?php if( edd_field_is_required( 'card_zip' ) ) {  echo ' required '; } ?&gt;/&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-country-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;billing_country&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Billing Country', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'billing_country' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The country for your billing address.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;select name=&quot;billing_country&quot; id=&quot;billing_country&quot; class=&quot;billing_country edd-select&lt;?php if( edd_field_is_required( 'billing_country' ) ) { echo ' required'; } ?&gt;&quot;&lt;?php if( edd_field_is_required( 'billing_country' ) ) {  echo ' required '; } ?&gt;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $selected_country = edd_get_shop_country();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if( ! empty( $customer['address']['country'] ) && '*' !== $customer['address']['country'] ) {&nbsp;</div></li><li><div>                  $selected_country = $customer['address']['country'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $countries = edd_get_country_list();&nbsp;</div></li><li><div>              foreach( $countries as $country_code =&gt; $country ) {&nbsp;</div></li><li><div>                echo '&lt;option value=&quot;' . esc_attr( $country_code ) . '&quot;' . selected( $country_code, $selected_country, false ) . '&gt;' . $country . '&lt;/option&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/select&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p id=&quot;edd-card-state-wrap&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;card_state&quot; class=&quot;edd-label&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Billing State / Province', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_field_is_required( 'card_state' ) ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;/label&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The state or province for your billing address.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          $selected_state = edd_get_shop_state();&nbsp;</div></li><li><div>          $states = edd_get_shop_states( $selected_country );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if( ! empty( $customer['address']['state'] ) ) {&nbsp;</div></li><li><div>              $selected_state = $customer['address']['state'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if( ! empty( $states ) ) : ?&gt;&nbsp;</div></li><li><div>          &lt;select name=&quot;card_state&quot; id=&quot;card_state&quot; class=&quot;card_state edd-select&lt;?php if( edd_field_is_required( 'card_state' ) ) { echo ' required'; } ?&gt;&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                  foreach( $states as $state_code =&gt; $state ) {&nbsp;</div></li><li><div>                      echo '&lt;option value=&quot;' . $state_code . '&quot;' . selected( $state_code, $selected_state, false ) . '&gt;' . $state . '&lt;/option&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/select&gt;&nbsp;</div></li><li><div>          &lt;?php else : ?&gt;&nbsp;</div></li><li><div>          &lt;?php $customer_state = ! empty( $customer['address']['state'] ) ? $customer['address']['state'] : ''; ?&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;text&quot; size=&quot;6&quot; name=&quot;card_state&quot; id=&quot;card_state&quot; class=&quot;card_state edd-input&quot; value=&quot;&lt;?php echo esc_attr( $customer_state ); ?&gt;&quot; placeholder=&quot;&lt;?php _e( 'State / Province', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_cc_billing_bottom' ); ?&gt;&nbsp;</div></li><li><div>  &lt;/fieldset&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  echo ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_after_cc_fields', 'edd_default_cc_address_fields' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the billing address fields for cart taxation</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_checkout_tax_fields() {&nbsp;</div></li><li><div>  if( edd_cart_needs_tax_address_fields() && edd_get_cart_total() )&nbsp;</div></li><li><div>      edd_default_cc_address_fields();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form_after_cc_form', 'edd_checkout_tax_fields', 999 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the user registration fields. If the user is logged in, a login</span>&nbsp;</div></li><li><div><span class="comment"> * form is displayed other a registration form is provided for the user to</span>&nbsp;</div></li><li><div><span class="comment"> * create an account.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_register_fields() {&nbsp;</div></li><li><div>  $show_register_form = edd_get_option( 'show_register_form', 'none' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start(); ?&gt;&nbsp;</div></li><li><div>  &lt;fieldset id=&quot;edd_register_fields&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php if( $show_register_form == 'both' ) { ?&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-login-account-wrap&quot;&gt;&lt;?php _e( 'Already have an account?', 'easy-digital-downloads' ); ?&gt; &lt;a href=&quot;&lt;?php echo esc_url( add_query_arg( 'login', 1 ) ); ?&gt;&quot; class=&quot;edd_checkout_register_login&quot; data-action=&quot;checkout_login&quot;&gt;&lt;?php _e( 'Login', 'easy-digital-downloads' ); ?&gt;&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php do_action('edd_register_fields_before'); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;fieldset id=&quot;edd_register_account_fields&quot;&gt;&nbsp;</div></li><li><div>          &lt;legend&gt;&lt;?php _e( 'Create an account', 'easy-digital-downloads' ); if( !edd_no_guest_checkout() ) { echo ' ' . __( '(optional)', 'easy-digital-downloads' ); } ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>          &lt;?php do_action('edd_register_account_fields_before'); ?&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-user-login-wrap&quot;&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;edd_user_login&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Username', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;?php if( edd_no_guest_checkout() ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;?php } ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The username you will use to log into your account.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;input name=&quot;edd_user_login&quot; id=&quot;edd_user_login&quot; class=&quot;&lt;?php if(edd_no_guest_checkout()) { echo 'required '; } ?&gt;edd-input&quot; type=&quot;text&quot; placeholder=&quot;&lt;?php _e( 'Username', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-user-pass-wrap&quot;&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;edd_user_pass&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Password', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;?php if( edd_no_guest_checkout() ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;?php } ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'The password used to access your account.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;input name=&quot;edd_user_pass&quot; id=&quot;edd_user_pass&quot; class=&quot;&lt;?php if(edd_no_guest_checkout()) { echo 'required '; } ?&gt;edd-input&quot; placeholder=&quot;&lt;?php _e( 'Password', 'easy-digital-downloads' ); ?&gt;&quot; type=&quot;password&quot;/&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-user-pass-confirm-wrap&quot; class=&quot;edd_register_password&quot;&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;edd_user_pass_confirm&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Password Again', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;?php if( edd_no_guest_checkout() ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;?php } ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'Confirm your password.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;input name=&quot;edd_user_pass_confirm&quot; id=&quot;edd_user_pass_confirm&quot; class=&quot;&lt;?php if(edd_no_guest_checkout()) { echo 'required '; } ?&gt;edd-input&quot; placeholder=&quot;&lt;?php _e( 'Confirm password', 'easy-digital-downloads' ); ?&gt;&quot; type=&quot;password&quot;/&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;?php do_action( 'edd_register_account_fields_after' ); ?&gt;&nbsp;</div></li><li><div>      &lt;/fieldset&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php do_action('edd_register_fields_after'); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;edd-purchase-var&quot; value=&quot;needs-to-register&quot;/&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_user_info' ); ?&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_user_register_fields' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;/fieldset&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  echo ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form_register_fields', 'edd_get_register_fields' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Gets the login fields for the login form on the checkout. This function hooks</span>&nbsp;</div></li><li><div><span class="comment"> * on the edd_purchase_form_login_fields to display the login form if a user already</span>&nbsp;</div></li><li><div><span class="comment"> * had an account.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_login_fields() {&nbsp;</div></li><li><div>  $color = edd_get_option( 'checkout_color', 'gray' );&nbsp;</div></li><li><div>  $color = ( $color == 'inherit' ) ? '' : $color;&nbsp;</div></li><li><div>  $style = edd_get_option( 'button_style', 'button' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $show_register_form = edd_get_option( 'show_register_form', 'none' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start(); ?&gt;&nbsp;</div></li><li><div>      &lt;fieldset id=&quot;edd_login_fields&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php if( $show_register_form == 'both' ) { ?&gt;&nbsp;</div></li><li><div>              &lt;p id=&quot;edd-new-account-wrap&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Need to create an account?', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;a href=&quot;&lt;?php echo esc_url( remove_query_arg('login') ); ?&gt;&quot; class=&quot;edd_checkout_register_login&quot; data-action=&quot;checkout_register&quot;&gt;&nbsp;</div></li><li><div>                      &lt;?php _e( 'Register', 'easy-digital-downloads' ); if(!edd_no_guest_checkout()) { echo ' ' . __( 'or checkout as a guest.', 'easy-digital-downloads' ); } ?&gt;&nbsp;</div></li><li><div>                  &lt;/a&gt;&nbsp;</div></li><li><div>              &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;?php do_action('edd_checkout_login_fields_before'); ?&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-user-login-wrap&quot;&gt;&nbsp;</div></li><li><div>              &lt;label class=&quot;edd-label&quot; for=&quot;edd-username&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Username or Email', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;?php if( edd_no_guest_checkout() ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;?php } ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>              &lt;input class=&quot;&lt;?php if(edd_no_guest_checkout()) { echo 'required '; } ?&gt;edd-input&quot; type=&quot;text&quot; name=&quot;edd_user_login&quot; id=&quot;edd_user_login&quot; value=&quot;&quot; placeholder=&quot;&lt;?php _e( 'Your username or email address', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-user-pass-wrap&quot; class=&quot;edd_login_password&quot;&gt;&nbsp;</div></li><li><div>              &lt;label class=&quot;edd-label&quot; for=&quot;edd-password&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Password', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;?php if( edd_no_guest_checkout() ) { ?&gt;&nbsp;</div></li><li><div>                  &lt;span class=&quot;edd-required-indicator&quot;&gt;*&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;?php } ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>              &lt;input class=&quot;&lt;?php if(edd_no_guest_checkout()) { echo 'required '; } ?&gt;edd-input&quot; type=&quot;password&quot; name=&quot;edd_user_pass&quot; id=&quot;edd_user_pass&quot; placeholder=&quot;&lt;?php _e( 'Your password', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>              &lt;?php if( edd_no_guest_checkout() ) : ?&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;hidden&quot; name=&quot;edd-purchase-var&quot; value=&quot;needs-to-login&quot;/&gt;&nbsp;</div></li><li><div>              &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-user-login-submit&quot;&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;submit&quot; class=&quot;edd-submit button &lt;?php echo $color; ?&gt;&quot; name=&quot;edd_login_submit&quot; value=&quot;&lt;?php _e( 'Login', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;?php do_action('edd_checkout_login_fields_after'); ?&gt;&nbsp;</div></li><li><div>      &lt;/fieldset&gt;&lt;!--end #edd_login_fields--&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  echo ob_get_clean();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form_login_fields', 'edd_get_login_fields' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the payment mode form by getting all the enabled payment gateways and</span>&nbsp;</div></li><li><div><span class="comment"> * outputting them as radio buttons for the user to choose the payment gateway. If</span>&nbsp;</div></li><li><div><span class="comment"> * a default payment gateway has been chosen from the EDD Settings, it will be</span>&nbsp;</div></li><li><div><span class="comment"> * automatically selected.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.2</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_payment_mode_select() {&nbsp;</div></li><li><div>  $gateways = edd_get_enabled_payment_gateways( true );&nbsp;</div></li><li><div>  $page_URL = edd_get_current_page_url();&nbsp;</div></li><li><div>  $chosen_gateway = edd_get_chosen_gateway();&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;edd_payment_mode_select_wrap&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php do_action('edd_payment_mode_top'); ?&gt;&nbsp;</div></li><li><div>      &lt;?php if( edd_is_ajax_disabled() ) { ?&gt;&nbsp;</div></li><li><div>      &lt;form id=&quot;edd_payment_mode&quot; action=&quot;&lt;?php echo $page_URL; ?&gt;&quot; method=&quot;GET&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php } ?&gt;&nbsp;</div></li><li><div>          &lt;fieldset id=&quot;edd_payment_mode_select&quot;&gt;&nbsp;</div></li><li><div>              &lt;legend&gt;&lt;?php _e( 'Select Payment Method', 'easy-digital-downloads' ); ?&gt;&lt;/legend&gt;&nbsp;</div></li><li><div>              &lt;?php do_action( 'edd_payment_mode_before_gateways_wrap' ); ?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;edd-payment-mode-wrap&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'edd_payment_mode_before_gateways' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ( $gateways as $gateway_id =&gt; $gateway ) :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $label = apply_filters( 'edd_gateway_checkout_label_' . $gateway_id, $gateway['checkout_label'] );&nbsp;</div></li><li><div>                      $checked = checked( $gateway_id, $chosen_gateway, false );&nbsp;</div></li><li><div>                      $checked_class = $checked ? ' edd-gateway-option-selected' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      echo '&lt;label for=&quot;edd-gateway-' . esc_attr( $gateway_id ) . '&quot; class=&quot;edd-gateway-option' . $checked_class . '&quot; id=&quot;edd-gateway-option-' . esc_attr( $gateway_id ) . '&quot;&gt;';&nbsp;</div></li><li><div>                          echo '&lt;input type=&quot;radio&quot; name=&quot;payment-mode&quot; class=&quot;edd-gateway&quot; id=&quot;edd-gateway-' . esc_attr( $gateway_id ) . '&quot; value=&quot;' . esc_attr( $gateway_id ) . '&quot;' . $checked . '&gt;' . esc_html( $label );&nbsp;</div></li><li><div>                      echo '&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  endforeach;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  do_action( 'edd_payment_mode_after_gateways' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;?php do_action( 'edd_payment_mode_after_gateways_wrap' ); ?&gt;&nbsp;</div></li><li><div>          &lt;/fieldset&gt;&nbsp;</div></li><li><div>          &lt;fieldset id=&quot;edd_payment_mode_submit&quot; class=&quot;edd-no-js&quot;&gt;&nbsp;</div></li><li><div>              &lt;p id=&quot;edd-next-submit-wrap&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php echo edd_checkout_button_next(); ?&gt;&nbsp;</div></li><li><div>              &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;/fieldset&gt;&nbsp;</div></li><li><div>      &lt;?php if( edd_is_ajax_disabled() ) { ?&gt;&nbsp;</div></li><li><div>      &lt;/form&gt;&nbsp;</div></li><li><div>      &lt;?php } ?&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;edd_purchase_form_wrap&quot;&gt;&lt;/div&gt;&lt;!-- the checkout fields are loaded into this--&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php do_action('edd_payment_mode_bottom');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_payment_mode_select', 'edd_payment_mode_select' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Show Payment Icons by getting all the accepted icons from the EDD Settings</span>&nbsp;</div></li><li><div><span class="comment"> * then outputting the icons.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function edd_show_payment_icons() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( edd_show_gateways() && did_action( 'edd_payment_mode_top' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $payment_methods = edd_get_option( 'accepted_cards', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( empty( $payment_methods ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;div class=&quot;edd-payment-icons&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach( $payment_methods as $key =&gt; $card ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( edd_string_is_image_url( $key ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;img class=&quot;payment-icon&quot; src=&quot;' . esc_url( $key ) . '&quot;/&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $card = strtolower( str_replace( ' ', '', $card ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if( has_filter( 'edd_accepted_payment_' . $card . '_image' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $image = apply_filters( 'edd_accepted_payment_' . $card . '_image', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $image = edd_locate_template( 'images' . DIRECTORY_SEPARATOR . 'icons' . DIRECTORY_SEPARATOR . $card . '.png', false );&nbsp;</div></li><li><div>              $content_dir = WP_CONTENT_DIR;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if( function_exists( 'wp_normalize_path' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Replaces backslashes with forward slashes for Windows systems</span>&nbsp;</div></li><li><div>                  $image = wp_normalize_path( $image );&nbsp;</div></li><li><div>                  $content_dir = wp_normalize_path( $content_dir );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $image = str_replace( $content_dir, content_url(), $image );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if( edd_is_ssl_enforced() || is_ssl() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $image = edd_enforced_ssl_asset_filter( $image );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;img class=&quot;payment-icon&quot; src=&quot;' . esc_url( $image ) . '&quot;/&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&lt;/div&gt;';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_payment_mode_top', 'edd_show_payment_icons' );&nbsp;</div></li><li><div>add_action( 'edd_checkout_form_top', 'edd_show_payment_icons' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the Discount Code field which allows users to enter a discount code.</span>&nbsp;</div></li><li><div><span class="comment"> * This field is only displayed if there are any active discounts on the site else</span>&nbsp;</div></li><li><div><span class="comment"> * it's not displayed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.2</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>function edd_discount_field() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( isset( $_GET['payment-mode'] ) && edd_is_ajax_disabled() ) {&nbsp;</div></li><li><div>      return; <span class="comment">// Only show before a payment method has been selected if ajax is disabled</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( ! edd_is_checkout() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( edd_has_active_discounts() && edd_get_cart_total() ) :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $color = edd_get_option( 'checkout_color', 'blue' );&nbsp;</div></li><li><div>      $color = ( $color == 'inherit' ) ? '' : $color;&nbsp;</div></li><li><div>      $style = edd_get_option( 'button_style', 'button' );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;fieldset id=&quot;edd_discount_code&quot;&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd_show_discount&quot; style=&quot;display:none;&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e( 'Have a discount code?', 'easy-digital-downloads' ); ?&gt; &lt;a href=&quot;#&quot; class=&quot;edd_discount_link&quot;&gt;&lt;?php echo _x( 'Click to enter it', 'Entering a discount code', 'easy-digital-downloads' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>          &lt;p id=&quot;edd-discount-code-wrap&quot; class=&quot;edd-cart-adjustment&quot;&gt;&nbsp;</div></li><li><div>              &lt;label class=&quot;edd-label&quot; for=&quot;edd-discount&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php _e( 'Discount', 'easy-digital-downloads' ); ?&gt;&nbsp;</div></li><li><div>              &lt;/label&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-description&quot;&gt;&lt;?php _e( 'Enter a coupon code if you have one.', 'easy-digital-downloads' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;input class=&quot;edd-input&quot; type=&quot;text&quot; id=&quot;edd-discount&quot; name=&quot;edd-discount&quot; placeholder=&quot;&lt;?php _e( 'Enter discount', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;submit&quot; class=&quot;edd-apply-discount edd-submit button &lt;?php echo $color . ' ' . $style; ?&gt;&quot; value=&quot;&lt;?php echo _x( 'Apply', 'Apply discount at checkout', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;edd-discount-loader edd-loading&quot; id=&quot;edd-discount-loader&quot; style=&quot;display:none;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;span id=&quot;edd-discount-error-wrap&quot; class=&quot;edd_error edd-alert edd-alert-error&quot; aria-hidden=&quot;true&quot; style=&quot;display:none;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/p&gt;&nbsp;</div></li><li><div>      &lt;/fieldset&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  endif;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_checkout_form_top', 'edd_discount_field', -1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the Checkout Agree to Terms, this displays a checkbox for users to</span>&nbsp;</div></li><li><div><span class="comment"> * agree the T&Cs set in the EDD Settings. This is only displayed if T&Cs are</span>&nbsp;</div></li><li><div><span class="comment"> * set in the EDD Settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.3.2</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_terms_agreement() {&nbsp;</div></li><li><div>  if ( edd_get_option( 'show_agree_to_terms', false ) ) {&nbsp;</div></li><li><div>      $agree_text = edd_get_option( 'agree_text', '' );&nbsp;</div></li><li><div>      $agree_label = edd_get_option( 'agree_label', __( 'Agree to Terms?', 'easy-digital-downloads' ) );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;fieldset id=&quot;edd_terms_agreement&quot;&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;edd_terms&quot; style=&quot;display:none;&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>                  do_action( 'edd_before_terms' );&nbsp;</div></li><li><div>                  echo wpautop( stripslashes( $agree_text ) );&nbsp;</div></li><li><div>                  do_action( 'edd_after_terms' );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;edd_show_terms&quot;&gt;&nbsp;</div></li><li><div>              &lt;a href=&quot;#&quot; class=&quot;edd_terms_links&quot;&gt;&lt;?php _e( 'Show Terms', 'easy-digital-downloads' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>              &lt;a href=&quot;#&quot; class=&quot;edd_terms_links&quot; style=&quot;display:none;&quot;&gt;&lt;?php _e( 'Hide Terms', 'easy-digital-downloads' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;edd-terms-agreement&quot;&gt;&nbsp;</div></li><li><div>              &lt;input name=&quot;edd_agree_to_terms&quot; class=&quot;required&quot; type=&quot;checkbox&quot; id=&quot;edd_agree_to_terms&quot; value=&quot;1&quot;/&gt;&nbsp;</div></li><li><div>              &lt;label for=&quot;edd_agree_to_terms&quot;&gt;&lt;?php echo stripslashes( $agree_label ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/fieldset&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form_before_submit', 'edd_terms_agreement' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Shows the final purchase total at the bottom of the checkout page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_checkout_final_total() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;p id=&quot;edd_final_total_wrap&quot;&gt;&nbsp;</div></li><li><div>  &lt;strong&gt;&lt;?php _e( 'Purchase Total:', 'easy-digital-downloads' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>  &lt;span class=&quot;edd_cart_amount&quot; data-subtotal=&quot;&lt;?php echo edd_get_cart_subtotal(); ?&gt;&quot; data-total=&quot;&lt;?php echo edd_get_cart_total(); ?&gt;&quot;&gt;&lt;?php edd_cart_total(); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>&lt;/p&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form_before_submit', 'edd_checkout_final_total', 999 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the Checkout Submit section</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.3.3</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_checkout_submit() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;fieldset id=&quot;edd_purchase_submit&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_before_submit' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php edd_checkout_hidden_fields(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php echo edd_checkout_button_purchase(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php do_action( 'edd_purchase_form_after_submit' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php if ( edd_is_ajax_disabled() ) { ?&gt;&nbsp;</div></li><li><div>          &lt;p class=&quot;edd-cancel&quot;&gt;&lt;a href=&quot;&lt;?php echo edd_get_checkout_uri(); ?&gt;&quot;&gt;&lt;?php _e( 'Go back', 'easy-digital-downloads' ); ?&gt;&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>      &lt;?php } ?&gt;&nbsp;</div></li><li><div>  &lt;/fieldset&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_purchase_form_after_cc_form', 'edd_checkout_submit', 9999 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the Next button on the Checkout</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_checkout_button_next() {&nbsp;</div></li><li><div>  $color = edd_get_option( 'checkout_color', 'blue' );&nbsp;</div></li><li><div>  $color = ( $color == 'inherit' ) ? '' : $color;&nbsp;</div></li><li><div>  $style = edd_get_option( 'button_style', 'button' );&nbsp;</div></li><li><div>  $purchase_page = edd_get_option( 'purchase_page', '0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;hidden&quot; name=&quot;edd_action&quot; value=&quot;gateway_select&quot; /&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;hidden&quot; name=&quot;page_id&quot; value=&quot;&lt;?php echo absint( $purchase_page ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;submit&quot; name=&quot;gateway_submit&quot; id=&quot;edd_next_button&quot; class=&quot;edd-submit &lt;?php echo $color; ?&gt; &lt;?php echo $style; ?&gt;&quot; value=&quot;&lt;?php _e( 'Next', 'easy-digital-downloads' ); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  return apply_filters( 'edd_checkout_button_next', ob_get_clean() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the Purchase button on the Checkout</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_checkout_button_purchase() {&nbsp;</div></li><li><div>  $color = edd_get_option( 'checkout_color', 'blue' );&nbsp;</div></li><li><div>  $color = ( $color == 'inherit' ) ? '' : $color;&nbsp;</div></li><li><div>  $style = edd_get_option( 'button_style', 'button' );&nbsp;</div></li><li><div>  $label = edd_get_checkout_button_purchase_label();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;submit&quot; class=&quot;edd-submit &lt;?php echo $color; ?&gt; &lt;?php echo $style; ?&gt;&quot; id=&quot;edd-purchase-button&quot; name=&quot;edd-purchase&quot; value=&quot;&lt;?php echo $label; ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  return apply_filters( 'edd_checkout_button_purchase', ob_get_clean() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves the label for the purchase button</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.6</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_get_checkout_button_purchase_label() {&nbsp;</div></li><li><div>  $label = edd_get_option( 'checkout_label', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( edd_get_cart_total() ) {&nbsp;</div></li><li><div>      $complete_purchase = ! empty( $label ) ? $label : __( 'Purchase', 'easy-digital-downloads' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $complete_purchase = ! empty( $label ) ? $label : __( 'Free Download', 'easy-digital-downloads' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'edd_get_checkout_button_purchase_label', $complete_purchase, $label );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the JavaScript code for the Agree to Terms section to toggle</span>&nbsp;</div></li><li><div><span class="comment"> * the T&Cs text</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_agree_to_terms_js() {&nbsp;</div></li><li><div>  if ( edd_get_option( 'show_agree_to_terms', false ) ) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>      jQuery(document).ready(function($) {&nbsp;</div></li><li><div>          $( document.body ).on('click', '.edd_terms_links', function(e) {&nbsp;</div></li><li><div>              <span class="comment">//e.preventDefault();</span>&nbsp;</div></li><li><div>              $('#edd_terms').slideToggle();&nbsp;</div></li><li><div>              $('.edd_terms_links').toggle();&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'edd_checkout_form_top', 'edd_agree_to_terms_js' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders the hidden Checkout fields</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.3.2</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_checkout_hidden_fields() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;?php if ( is_user_logged_in() ) { ?&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;hidden&quot; name=&quot;edd-user-id&quot; value=&quot;&lt;?php echo get_current_user_id(); ?&gt;&quot;/&gt;&nbsp;</div></li><li><div>  &lt;?php } ?&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;hidden&quot; name=&quot;edd_action&quot; value=&quot;purchase&quot;/&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;hidden&quot; name=&quot;edd-gateway&quot; value=&quot;&lt;?php echo edd_get_chosen_gateway(); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filter Success Page Content</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Applies filters to the success page content.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content Content before filters</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $content Filtered content</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_filter_success_page_content( $content ) {&nbsp;</div></li><li><div>  if ( isset( $_GET['payment-confirmation'] ) && edd_is_success_page() ) {&nbsp;</div></li><li><div>      if ( has_filter( 'edd_payment_confirm_' . $_GET['payment-confirmation'] ) ) {&nbsp;</div></li><li><div>          $content = apply_filters( 'edd_payment_confirm_' . $_GET['payment-confirmation'], $content );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $content;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'the_content', 'edd_filter_success_page_content', 99999 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Show a download's files in the purchase receipt</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since  1.8.6</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int        $item_id      The download ID</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array      $receipt_args Args specified in the [edd_receipt] shortcode</span>&nbsp;</div></li><li><div><span class="comment"> * @param  array      $item         Cart item array</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function edd_receipt_show_download_files( $item_id, $receipt_args, $item = array() ) {&nbsp;</div></li><li><div>  return apply_filters( 'edd_receipt_show_download_files', true, $item_id, $receipt_args, $item );&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Easy Digital Downloads</li><li><span></span>2.7.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>