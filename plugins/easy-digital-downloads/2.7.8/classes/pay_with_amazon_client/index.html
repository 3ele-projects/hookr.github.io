<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.7.8" data-slug="easy-digital-downloads" data-type="class" data-id="58239"><head xmlns="http://www.w3.org/1999/xhtml"><title> paywithamazonclient | class | Easy Digital Downloads | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PayWithAmazon\Client, class, plugin, easy-digital-downloads, 2.7.8" /><meta name="description" content="The Easy Digital Downloads PayWithAmazon Client class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=b16f9f62c01956c4e54a58255bbd58e6' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pay_with_amazon_client/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpay_with_amazon_client%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpay_with_amazon_client%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-easy-digital-downloads-2.7.8-class-pay_with_amazon_client","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pay_with_amazon_client" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to easy-digital-downloads." href="http://hookr.io/plugins/easy-digital-downloads/" class="plugin"><span property="name">easy-digital-downloads</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.8." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/" class="H_VERSION"><span property="name">2.7.8</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pay_with_amazon_client</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="2274"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/all/" title="All">All <span class="count badge">2274</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="1195"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/hooks/" title="Hooks">Hooks <span class="count badge">1195</span></a></li><li class="" data-id="action" data-count="469"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/actions/" title="Actions">Actions <span class="count badge">469</span></a></li><li class="" data-id="filter" data-count="726"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/filters/" title="Filters">Filters <span class="count badge">726</span></a></li><li class="active" data-id="class" data-count="99"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/" title="Classes">Classes <span class="count badge">99</span></a></li><li class="" data-id="constant" data-count="11"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/constants/" title="Constants">Constants <span class="count badge">11</span></a></li><li class="" data-id="function" data-count="955"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/functions/" title="Functions">Functions <span class="count badge">955</span></a></li><li class="" data-id="shortcode" data-count="14"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">14</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PayWithAmazonClient</strong></h1><p>The Easy Digital Downloads <strong>PayWithAmazon Client</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/files/includes-gateways-libs-amazon-client/" class="file">/includes/gateways/libs/amazon/Client.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="17" class="block" start="17"><li><div>class Client implements ClientInterface&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    const MWS_CLIENT_VERSION = '1.0.0';&nbsp;</div></li><li><div>    const SERVICE_VERSION = '2013-01-01';&nbsp;</div></li><li><div>    const MAX_ERROR_RETRY = 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Construct User agent string based off of the application_name, application_version, PHP platform&nbsp;</div></li><li><div>    private $userAgent = null;&nbsp;</div></li><li><div>    private $parameters = null;&nbsp;</div></li><li><div>    private $mwsEndpointPath = null;&nbsp;</div></li><li><div>    private $mwsEndpointUrl = null;&nbsp;</div></li><li><div>    private $profileEndpoint = null;&nbsp;</div></li><li><div>    private $config = array('merchant_id' =&gt; null, &nbsp;</div></li><li><div>                'secret_key' =&gt; null, &nbsp;</div></li><li><div>                'access_key' =&gt; null, &nbsp;</div></li><li><div>                'region' =&gt; null, &nbsp;</div></li><li><div>                'currency_code' =&gt; null, &nbsp;</div></li><li><div>                'sandbox' =&gt; false, &nbsp;</div></li><li><div>                'platform_id' =&gt; null, &nbsp;</div></li><li><div>                'cabundle_file' =&gt; null, &nbsp;</div></li><li><div>                'application_name' =&gt; null, &nbsp;</div></li><li><div>                'application_version' =&gt; null, &nbsp;</div></li><li><div>                'proxy_host' =&gt; null, &nbsp;</div></li><li><div>                'proxy_port' =&gt; -1, &nbsp;</div></li><li><div>                'proxy_username' =&gt; null, &nbsp;</div></li><li><div>                'proxy_password' =&gt; null, &nbsp;</div></li><li><div>                'client_id' =&gt; null, &nbsp;</div></li><li><div>                'handle_throttle' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private $modePath = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Final URL to where the API parameters POST done, based off the config['region'] and respective $mwsServiceUrls&nbsp;</div></li><li><div>    private $mwsServiceUrl = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private $mwsServiceUrls = array('eu' =&gt; 'mws-eu.amazonservices.com', &nbsp;</div></li><li><div>                    'na' =&gt; 'mws.amazonservices.com', &nbsp;</div></li><li><div>                    'jp' =&gt; 'mws.amazonservices.jp');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Production profile end points to get the user information&nbsp;</div></li><li><div>    private $liveProfileEndpoint = array('uk' =&gt; 'https://api.amazon.co.uk', &nbsp;</div></li><li><div>                     'us' =&gt; 'https://api.amazon.com', &nbsp;</div></li><li><div>                     'de' =&gt; 'https://api.amazon.de', &nbsp;</div></li><li><div>                     'jp' =&gt; 'https://api.amazon.co.jp');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Sandbox profile end points to get the user information&nbsp;</div></li><li><div>    private $sandboxProfileEndpoint = array('uk' =&gt; 'https://api.sandbox.amazon.co.uk', &nbsp;</div></li><li><div>                        'us' =&gt; 'https://api.sandbox.amazon.com', &nbsp;</div></li><li><div>                        'de' =&gt; 'https://api.sandbox.amazon.de', &nbsp;</div></li><li><div>                        'jp' =&gt; 'https://api.sandbox.amazon.co.jp');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private $regionMappings = array('de' =&gt; 'eu', &nbsp;</div></li><li><div>                    'uk' =&gt; 'eu', &nbsp;</div></li><li><div>                    'us' =&gt; 'na', &nbsp;</div></li><li><div>                    'jp' =&gt; 'jp');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Boolean variable to check if the API call was a success&nbsp;</div></li><li><div>    public $success = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Takes user configuration array from the user as input&nbsp;</div></li><li><div>     * Takes JSON file path with configuration information as input&nbsp;</div></li><li><div>     * Validates the user configuration array against existing config array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function __construct($config = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!is_null($config)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (is_array($config)) {&nbsp;</div></li><li><div>                $configArray = $config;&nbsp;</div></li><li><div>            } elseif (!is_array($config)) {&nbsp;</div></li><li><div>        $configArray = $this-&gt;checkIfFileExists($config);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (is_array($configArray)) {&nbsp;</div></li><li><div>                $this-&gt;checkConfigKeys($configArray);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                throw new \Exception('$config is of the incorrect type ' . gettype($configArray) . ' and should be of the type array');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>        throw new \Exception('$config cannot be null.');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** checkIfFileExists -  check if the JSON file exists in the path provided */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function checkIfFileExists($config)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    if(file_exists($config))&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $jsonString = file_get_contents($config);&nbsp;</div></li><li><div>        $configArray = json_decode($jsonString, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $jsonError = json_last_error();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($jsonError != 0) {&nbsp;</div></li><li><div>        $errorMsg = &quot;Error with message - content is not in json format&quot; . $this-&gt;getErrorMessageForJsonError($jsonError) . &quot; &quot; . $configArray;&nbsp;</div></li><li><div>        throw new \Exception($errorMsg);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $errorMsg ='$config is not a Json File path or the Json File was not found in the path provided';&nbsp;</div></li><li><div>        throw new \Exception($errorMsg);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $configArray;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Checks if the keys of the input configuration matches the keys in the config array&nbsp;</div></li><li><div>     * if they match the values are taken else throws exception&nbsp;</div></li><li><div>     * strict case match is not performed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function checkConfigKeys($config)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $config = array_change_key_case($config, CASE_LOWER);&nbsp;</div></li><li><div>    $config = $this-&gt;trimArray($config);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($config as $key =&gt; $value) {&nbsp;</div></li><li><div>            if (array_key_exists($key, $this-&gt;config)) {&nbsp;</div></li><li><div>                $this-&gt;config[$key] = $value;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                throw new \Exception('Key ' . $key . ' is either not part of the configuration or has incorrect Key name.&nbsp;</div></li><li><div>                check the config array key names to match your key names of your config array', 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Convert a json error code to a descriptive error message&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $jsonError message code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string error message&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function getErrorMessageForJsonError($jsonError)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        switch ($jsonError) {&nbsp;</div></li><li><div>            case JSON_ERROR_DEPTH:&nbsp;</div></li><li><div>                return &quot; - maximum stack depth exceeded.&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case JSON_ERROR_STATE_MISMATCH:&nbsp;</div></li><li><div>                return &quot; - invalid or malformed JSON.&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case JSON_ERROR_CTRL_CHAR:&nbsp;</div></li><li><div>                return &quot; - control character error.&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case JSON_ERROR_SYNTAX:&nbsp;</div></li><li><div>                return &quot; - syntax error.&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                return &quot;.&quot;;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Setter for sandbox&nbsp;</div></li><li><div>     * Sets the Boolean value for config['sandbox'] variable&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setSandbox($value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (is_bool($value)) {&nbsp;</div></li><li><div>            $this-&gt;config['sandbox'] = $value;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception($value . ' is of type ' . gettype($value) . ' and should be a boolean value');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Setter for config['client_id']&nbsp;</div></li><li><div>     * Sets the value for config['client_id'] variable&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setClientId($value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!empty($value)) {&nbsp;</div></li><li><div>            $this-&gt;config['client_id'] = $value;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception('setter value for client ID provided is empty');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Setter for Proxy&nbsp;</div></li><li><div>     * input $proxy [array]&nbsp;</div></li><li><div>     * @param $proxy['proxy_user_host'] - hostname for the proxy&nbsp;</div></li><li><div>     * @param $proxy['proxy_user_port'] - hostname for the proxy&nbsp;</div></li><li><div>     * @param $proxy['proxy_user_name'] - if your proxy required a username&nbsp;</div></li><li><div>     * @param $proxy['proxy_user_password'] - if your proxy required a password&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setProxy($proxy)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $proxy = $this-&gt;trimArray($proxy);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($proxy['proxy_user_host']))&nbsp;</div></li><li><div>        $this-&gt;config['proxy_user_host'] = $proxy['proxy_user_host'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($proxy['proxy_user_port']))&nbsp;</div></li><li><div>            $this-&gt;config['proxy_user_port'] = $proxy['proxy_user_port'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($proxy['proxy_user_name']))&nbsp;</div></li><li><div>            $this-&gt;config['proxy_user_name'] = $proxy['proxy_user_name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($proxy['proxy_user_password']))&nbsp;</div></li><li><div>            $this-&gt;config['proxy_user_password'] = $proxy['proxy_user_password'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Setter for $mwsServiceUrl&nbsp;</div></li><li><div>     * Set the URL to which the post request has to be made for unit testing&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setMwsServiceUrl($url)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $this-&gt;mwsServiceUrl = $url;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Getter&nbsp;</div></li><li><div>     * Gets the value for the key if the key exists in config&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function __get($name)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (array_key_exists(strtolower($name), $this-&gt;config)) {&nbsp;</div></li><li><div>            return $this-&gt;config[strtolower($name)];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception('Key ' . $name . ' is either not a part of the configuration array config or the' . $name . 'does not match the key name in the config array', 1);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Getter for parameters string&nbsp;</div></li><li><div>     * Gets the value for the parameters string for unit testing&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getParameters()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    return trim($this-&gt;parameters);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Trim the input Array key values */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function trimArray($array)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    foreach ($array as $key =&gt; $value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $array[$key] = trim($value);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetUserInfo convenience function - Returns user's profile information from Amazon using the access token returned by the Button widget.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see http://login.amazon.com/website Step 4&nbsp;</div></li><li><div>     * @param $accessToken [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getUserInfo($accessToken)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Get the correct Profile Endpoint URL based off the country/region provided in the config['region']&nbsp;</div></li><li><div>        $this-&gt;profileEndpointUrl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (empty($accessToken)) {&nbsp;</div></li><li><div>            throw new \InvalidArgumentException('Access Token is a required parameter and is not set');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // To make sure double encoding doesn't occur decode first and encode again.&nbsp;</div></li><li><div>        $accessToken = urldecode($accessToken);&nbsp;</div></li><li><div>        $url = $this-&gt;profileEndpoint . '/auth/o2/tokeninfo?access_token=' . urlEncode($accessToken);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $httpCurlRequest = new HttpCurl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $response = $httpCurlRequest-&gt;httpGet($url);&nbsp;</div></li><li><div>        $data = json_decode($response);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($data-&gt;aud != $this-&gt;config['client_id']) {&nbsp;</div></li><li><div>            // The access token does not belong to us&nbsp;</div></li><li><div>            throw new \Exception('The Access token entered is incorrect');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Exchange the access token for user profile&nbsp;</div></li><li><div>        $url = $this-&gt;profileEndpoint . '/user/profile';&nbsp;</div></li><li><div>        $httpCurlRequest = new HttpCurl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $httpCurlRequest-&gt;setAccessToken($accessToken);&nbsp;</div></li><li><div>        $httpCurlRequest-&gt;setHttpHeader(true);&nbsp;</div></li><li><div>        $response = $httpCurlRequest-&gt;httpGet($url);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $userInfo = json_decode($response, true);&nbsp;</div></li><li><div>        return $userInfo;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** setParametersAndPost - sets the parameters array with non empty values from the requestParameters array sent to API calls.&nbsp;</div></li><li><div>     * If Provider Credit Details is present, values are set by setProviderCreditDetails&nbsp;</div></li><li><div>     * If Provider Credit Reversal Details is present, values are set by setProviderCreditDetails&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function setParametersAndPost($parameters, $fieldMappings, $requestParameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    /** For loop to take all the non empty parameters in the $requestParameters and add it into the $parameters array, &nbsp;</div></li><li><div>     * if the keys are matched from $requestParameters array with the $fieldMappings array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>        foreach ($requestParameters as $param =&gt; $value) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!is_array($value)) {&nbsp;</div></li><li><div>        $value = trim($value);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (array_key_exists($param, $fieldMappings) && $value!='') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(is_array($value)) {&nbsp;</div></li><li><div>            // If the parameter is a provider_credit_details or provider_credit_reversal_details, call the respective functions to set the values&nbsp;</div></li><li><div>            if($param === 'provider_credit_details') {&nbsp;</div></li><li><div>            $parameters = $this-&gt;setProviderCreditDetails($parameters, $value);&nbsp;</div></li><li><div>            } elseif ($param === 'provider_credit_reversal_details') {&nbsp;</div></li><li><div>            $parameters = $this-&gt;setProviderCreditReversalDetails($parameters, $value);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else{&nbsp;</div></li><li><div>            // For variables that are boolean values, strtolower them&nbsp;</div></li><li><div>            if($this-&gt;checkIfBool($value))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>            $value = strtolower($value);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $parameters[$fieldMappings[$param]] = $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $parameters = $this-&gt;setDefaultValues($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>    $responseObject = $this-&gt;calculateSignatureAndPost($parameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $responseObject;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** checkIfBool - checks if the input is a boolean */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function checkIfBool($string)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $string = strtolower($string);&nbsp;</div></li><li><div>    return in_array($string, array('true', 'false'));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** calculateSignatureAndPost - convert the Parameters array to string and curl POST the parameters to MWS */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function calculateSignatureAndPost($parameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    // Call the signature and Post function to perform the actions. Returns XML in array format&nbsp;</div></li><li><div>        $parametersString = $this-&gt;calculateSignatureAndParametersToString($parameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // POST using curl the String converted Parameters&nbsp;</div></li><li><div>    $response = $this-&gt;invokePost($parametersString);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Send this response as args to ResponseParser class which will return the object of the class.&nbsp;</div></li><li><div>        $responseObject = new ResponseParser($response);&nbsp;</div></li><li><div>        return $responseObject;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** If merchant_id is not set via the requestParameters array then it's taken from the config array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Set the platform_id if set in the config['platform_id'] array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * If currency_code is set in the $requestParameters and it exists in the $fieldMappings array, strtoupper it&nbsp;</div></li><li><div>     * else take the value from config array if set&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function setDefaultValues($parameters, $fieldMappings, $requestParameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (empty($requestParameters['merchant_id']))&nbsp;</div></li><li><div>            $parameters['SellerId'] = $this-&gt;config['merchant_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (array_key_exists('platform_id', $fieldMappings)) {&nbsp;</div></li><li><div>        if (empty($requestParameters['platform_id']) && !empty($this-&gt;config['platform_id']))&nbsp;</div></li><li><div>            $parameters[$fieldMappings['platform_id']] = $this-&gt;config['platform_id'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (array_key_exists('currency_code', $fieldMappings)) {&nbsp;</div></li><li><div>            if (!empty($requestParameters['currency_code'])) {&nbsp;</div></li><li><div>        $parameters[$fieldMappings['currency_code']] = strtoupper($requestParameters['currency_code']);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $parameters[$fieldMappings['currency_code']] = strtoupper($this-&gt;config['currency_code']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $parameters;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** setProviderCreditDetails - sets the provider credit details sent via the Capture or Authorize API calls&nbsp;</div></li><li><div>     * @param provider_id - [String]&nbsp;</div></li><li><div>     * @param credit_amount - [String]&nbsp;</div></li><li><div>     * @optional currency_code - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function setProviderCreditDetails($parameters, $providerCreditInfo)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $providerIndex = 0;&nbsp;</div></li><li><div>    $providerString = 'ProviderCreditList.member.';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'provider_id' =&gt; 'ProviderId', &nbsp;</div></li><li><div>            'credit_amount' =&gt; 'CreditAmount.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'CreditAmount.CurrencyCode'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    foreach ($providerCreditInfo as $key =&gt; $value)&nbsp;</div></li><li><div>     {&nbsp;</div></li><li><div>        $value = array_change_key_case($value, CASE_LOWER);&nbsp;</div></li><li><div>        $providerIndex = $providerIndex + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($value as $param =&gt; $val)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>        if (array_key_exists($param, $fieldMappings) && trim($val)!='') {&nbsp;</div></li><li><div>            $parameters[$providerString.$providerIndex. '.' .$fieldMappings[$param]] = $val;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If currency code is not entered take it from the config array&nbsp;</div></li><li><div>        if(empty($parameters[$providerString.$providerIndex. '.' .$fieldMappings['currency_code']]))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>        $parameters[$providerString.$providerIndex. '.' .$fieldMappings['currency_code']] = strtoupper($this-&gt;config['currency_code']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $parameters;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** setProviderCreditReversalDetails - sets the reverse provider credit details sent via the Refund API call.&nbsp;</div></li><li><div>     * @param provider_id - [String]&nbsp;</div></li><li><div>     * @param credit_amount - [String]&nbsp;</div></li><li><div>     * @optional currency_code - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function setProviderCreditReversalDetails($parameters, $providerCreditInfo)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $providerIndex = 0;&nbsp;</div></li><li><div>    $providerString = 'ProviderCreditReversalList.member.';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'provider_id' =&gt; 'ProviderId', &nbsp;</div></li><li><div>            'credit_reversal_amount' =&gt; 'CreditReversalAmount.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'CreditReversalAmount.CurrencyCode'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    foreach ($providerCreditInfo as $key =&gt; $value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $value = array_change_key_case($value, CASE_LOWER);&nbsp;</div></li><li><div>        $providerIndex = $providerIndex + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($value as $param =&gt; $val)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>        if (array_key_exists($param, $fieldMappings) && trim($val)!='') {&nbsp;</div></li><li><div>            $parameters[$providerString.$providerIndex. '.' .$fieldMappings[$param]] = $val;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If currency code is not entered take it from the config array&nbsp;</div></li><li><div>        if(empty($parameters[$providerString.$providerIndex. '.' .$fieldMappings['currency_code']]))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>        $parameters[$providerString.$providerIndex. '.' .$fieldMappings['currency_code']] = strtoupper($this-&gt;config['currency_code']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $parameters;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetOrderReferenceDetails API call - Returns details about the Order Reference object and its current state.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_GetOrderReferenceDetails.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_order_reference_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['address_consent_token'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getOrderReferenceDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetOrderReferenceDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_order_reference_id' =&gt; 'AmazonOrderReferenceId', &nbsp;</div></li><li><div>            'address_consent_token' =&gt; 'AddressConsentToken', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** SetOrderReferenceDetails API call - Sets order reference details such as the order total and a description for the order.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_SetOrderReferenceDetails.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_order_reference_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amount'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['platform_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_note'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_order_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['store_name'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['custom_information'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setOrderReferenceDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'SetOrderReferenceDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_order_reference_id' =&gt; 'AmazonOrderReferenceId', &nbsp;</div></li><li><div>            'amount' =&gt; 'OrderReferenceAttributes.OrderTotal.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'OrderReferenceAttributes.OrderTotal.CurrencyCode', &nbsp;</div></li><li><div>            'platform_id' =&gt; 'OrderReferenceAttributes.PlatformId', &nbsp;</div></li><li><div>            'seller_note' =&gt; 'OrderReferenceAttributes.SellerNote', &nbsp;</div></li><li><div>            'seller_order_id' =&gt; 'OrderReferenceAttributes.SellerOrderAttributes.SellerOrderId', &nbsp;</div></li><li><div>            'store_name' =&gt; 'OrderReferenceAttributes.SellerOrderAttributes.StoreName', &nbsp;</div></li><li><div>            'custom_information' =&gt; 'OrderReferenceAttributes.SellerOrderAttributes.CustomInformation', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** ConfirmOrderReferenceDetails API call - Confirms that the order reference is free of constraints and all required information has been set on the order reference.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_ConfirmOrderReference.html&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_order_reference_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function confirmOrderReference($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'ConfirmOrderReference';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_order_reference_id' =&gt; 'AmazonOrderReferenceId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** CancelOrderReferenceDetails API call - Cancels a previously confirmed order reference.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_CancelOrderReference.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_order_reference_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['cancelation_reason'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function cancelOrderReference($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'CancelOrderReference';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_order_reference_id' =&gt; 'AmazonOrderReferenceId', &nbsp;</div></li><li><div>            'cancelation_reason' =&gt; 'CancelationReason', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** CloseOrderReferenceDetails API call - Confirms that an order reference has been fulfilled (fully or partially)&nbsp;</div></li><li><div>     * and that you do not expect to create any new authorizations on this order reference.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_CloseOrderReference.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_order_reference_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['closure_reason'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function closeOrderReference($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'CloseOrderReference';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_order_reference_id' =&gt; 'AmazonOrderReferenceId', &nbsp;</div></li><li><div>            'closure_reason' =&gt; 'ClosureReason', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** CloseAuthorization API call - Closes an authorization.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_CloseOrderReference.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_authorization_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['closure_reason'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function closeAuthorization($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'CloseAuthorization';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_authorization_id' =&gt; 'AmazonAuthorizationId', &nbsp;</div></li><li><div>            'closure_reason' =&gt; 'ClosureReason', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Authorize API call - Reserves a specified amount against the payment method(s) stored in the order reference.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_Authorize.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_order_reference_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['authorization_amount'] [String]&nbsp;</div></li><li><div>     * @param requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['authorization_reference_id'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['capture_now'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['provider_credit_details'] - [array (array())]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_authorization_note'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['transaction_timeout'] [String] - Defaults to 1440 minutes&nbsp;</div></li><li><div>     * @optional requestParameters['soft_descriptor'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function authorize($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'Authorize';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_order_reference_id' =&gt; 'AmazonOrderReferenceId', &nbsp;</div></li><li><div>            'authorization_amount' =&gt; 'AuthorizationAmount.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'AuthorizationAmount.CurrencyCode', &nbsp;</div></li><li><div>            'authorization_reference_id' =&gt; 'AuthorizationReferenceId', &nbsp;</div></li><li><div>            'capture_now' =&gt; 'CaptureNow', &nbsp;</div></li><li><div>        'provider_credit_details' =&gt; array(), &nbsp;</div></li><li><div>            'seller_authorization_note' =&gt; 'SellerAuthorizationNote', &nbsp;</div></li><li><div>            'transaction_timeout' =&gt; 'TransactionTimeout', &nbsp;</div></li><li><div>            'soft_descriptor' =&gt; 'SoftDescriptor', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetAuthorizationDetails API call - Returns the status of a particular authorization and the total amount captured on the authorization.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_GetAuthorizationDetails.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_authorization_id'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getAuthorizationDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetAuthorizationDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_authorization_id' =&gt; 'AmazonAuthorizationId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Capture API call - Captures funds from an authorized payment instrument.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_Capture.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_authorization_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['capture_amount'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['capture_reference_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['provider_credit_details'] - [array (array())]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_capture_note'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['soft_descriptor'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function capture($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'Capture';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_authorization_id' =&gt; 'AmazonAuthorizationId', &nbsp;</div></li><li><div>            'capture_amount' =&gt; 'CaptureAmount.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'CaptureAmount.CurrencyCode', &nbsp;</div></li><li><div>            'capture_reference_id' =&gt; 'CaptureReferenceId', &nbsp;</div></li><li><div>        'provider_credit_details' =&gt; array(), &nbsp;</div></li><li><div>            'seller_capture_note' =&gt; 'SellerCaptureNote', &nbsp;</div></li><li><div>            'soft_descriptor' =&gt; 'SoftDescriptor', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetCaptureDetails API call - Returns the status of a particular capture and the total amount refunded on the capture.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_GetCaptureDetails.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_capture_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getCaptureDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetCaptureDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_capture_id' =&gt; 'AmazonCaptureId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Refund API call - Refunds a previously captured amount.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_Refund.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_capture_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['refund_reference_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['refund_amount'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['provider_credit_reversal_details'] - [array(array())]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_refund_note'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['soft_descriptor'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function refund($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'Refund';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_capture_id' =&gt; 'AmazonCaptureId', &nbsp;</div></li><li><div>            'refund_reference_id' =&gt; 'RefundReferenceId', &nbsp;</div></li><li><div>            'refund_amount' =&gt; 'RefundAmount.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'RefundAmount.CurrencyCode', &nbsp;</div></li><li><div>        'provider_credit_reversal_details' =&gt; array(), &nbsp;</div></li><li><div>            'seller_refund_note' =&gt; 'SellerRefundNote', &nbsp;</div></li><li><div>            'soft_descriptor' =&gt; 'SoftDescriptor', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetRefundDetails API call - Returns the status of a particular refund.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_GetRefundDetails.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_refund_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getRefundDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetRefundDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_refund_id' =&gt; 'AmazonRefundId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetServiceStatus API Call - Returns the operational status of the Off-Amazon Payments API section&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_GetServiceStatus.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The GetServiceStatus operation returns the operational status of the Off-Amazon Payments API&nbsp;</div></li><li><div>     * section of Amazon Marketplace Web Service (Amazon MWS).&nbsp;</div></li><li><div>     * Status values are GREEN, GREEN_I, YELLOW, and RED.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getServiceStatus($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetServiceStatus';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** CreateOrderReferenceForId API Call - Creates an order reference for the given object&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_CreateOrderReferenceForId.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['Id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['inherit_shipping_address'] [Boolean]&nbsp;</div></li><li><div>     * @optional requestParameters['ConfirmNow'] - [Boolean]&nbsp;</div></li><li><div>     * @optional Amount (required when confirm_now is set to true) [String]&nbsp;</div></li><li><div>     * @optional requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_note'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_order_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['store_name'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['custom_information'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function createOrderReferenceForId($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'CreateOrderReferenceForId';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'id' =&gt; 'Id', &nbsp;</div></li><li><div>            'id_type' =&gt; 'IdType', &nbsp;</div></li><li><div>            'inherit_shipping_address' =&gt; 'InheritShippingAddress', &nbsp;</div></li><li><div>            'confirm_now' =&gt; 'ConfirmNow', &nbsp;</div></li><li><div>            'amount' =&gt; 'OrderReferenceAttributes.OrderTotal.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'OrderReferenceAttributes.OrderTotal.CurrencyCode', &nbsp;</div></li><li><div>            'platform_id' =&gt; 'OrderReferenceAttributes.PlatformId', &nbsp;</div></li><li><div>            'seller_note' =&gt; 'OrderReferenceAttributes.SellerNote', &nbsp;</div></li><li><div>            'seller_order_id' =&gt; 'OrderReferenceAttributes.SellerOrderAttributes.SellerOrderId', &nbsp;</div></li><li><div>            'store_name' =&gt; 'OrderReferenceAttributes.SellerOrderAttributes.StoreName', &nbsp;</div></li><li><div>            'custom_information' =&gt; 'OrderReferenceAttributes.SellerOrderAttributes.CustomInformation', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetBillingAgreementDetails API Call - Returns details about the Billing Agreement object and its current state.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_GetBillingAgreementDetails.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_billing_agreement_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getBillingAgreementDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetBillingAgreementDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_billing_agreement_id' =&gt; 'AmazonBillingAgreementId', &nbsp;</div></li><li><div>            'address_consent_token' =&gt; 'AddressConsentToken', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** SetBillingAgreementDetails API call - Sets Billing Agreement details such as a description of the agreement and other information about the seller.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_SetBillingAgreementDetails.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_billing_agreement_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amount'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['platform_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_note'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_billing_agreement_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['store_name'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['custom_information'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setBillingAgreementDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'SetBillingAgreementDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_billing_agreement_id' =&gt; 'AmazonBillingAgreementId', &nbsp;</div></li><li><div>            'platform_id' =&gt; 'BillingAgreementAttributes.PlatformId', &nbsp;</div></li><li><div>            'seller_note' =&gt; 'BillingAgreementAttributes.SellerNote', &nbsp;</div></li><li><div>            'seller_billing_agreement_id' =&gt; 'BillingAgreementAttributes.SellerBillingAgreementAttributes.SellerBillingAgreementId', &nbsp;</div></li><li><div>            'custom_information' =&gt; 'BillingAgreementAttributes.SellerBillingAgreementAttributes.CustomInformation', &nbsp;</div></li><li><div>            'store_name' =&gt; 'BillingAgreementAttributes.SellerBillingAgreementAttributes.StoreName', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** ConfirmBillingAgreement API Call - Confirms that the Billing Agreement is free of constraints and all required information has been set on the Billing Agreement.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_ConfirmBillingAgreement.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_billing_agreement_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function confirmBillingAgreement($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'ConfirmBillingAgreement';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_billing_agreement_id' =&gt; 'AmazonBillingAgreementId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** ValidateBillignAgreement API Call - Validates the status of the Billing Agreement object and the payment method associated with it.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_ValidateBillingAgreement.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_billing_agreement_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function validateBillingAgreement($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'ValidateBillingAgreement';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_billing_agreement_id' =&gt; 'AmazonBillingAgreementId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** AuthorizeOnBillingAgreement API call - Reserves a specified amount against the payment method(s) stored in the Billing Agreement.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_AuthorizeOnBillingAgreement.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_billing_agreement_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['authorization_reference_id'] [String]&nbsp;</div></li><li><div>     * @param requestParameters['authorization_amount'] [String]&nbsp;</div></li><li><div>     * @param requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_authorization_note'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['transaction_timeout'] - Defaults to 1440 minutes&nbsp;</div></li><li><div>     * @optional requestParameters['capture_now'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['soft_descriptor'] - - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_note'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['platform_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['custom_information'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['seller_order_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['store_name'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['inherit_shipping_address'] [Boolean] - Defaults to true&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function authorizeOnBillingAgreement($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'AuthorizeOnBillingAgreement';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_billing_agreement_id' =&gt; 'AmazonBillingAgreementId', &nbsp;</div></li><li><div>            'authorization_reference_id' =&gt; 'AuthorizationReferenceId', &nbsp;</div></li><li><div>            'authorization_amount' =&gt; 'AuthorizationAmount.Amount', &nbsp;</div></li><li><div>            'currency_code' =&gt; 'AuthorizationAmount.CurrencyCode', &nbsp;</div></li><li><div>            'seller_authorization_note' =&gt; 'SellerAuthorizationNote', &nbsp;</div></li><li><div>            'transaction_timeout' =&gt; 'TransactionTimeout', &nbsp;</div></li><li><div>            'capture_now' =&gt; 'CaptureNow', &nbsp;</div></li><li><div>            'soft_descriptor' =&gt; 'SoftDescriptor', &nbsp;</div></li><li><div>            'seller_note' =&gt; 'SellerNote', &nbsp;</div></li><li><div>            'platform_id' =&gt; 'PlatformId', &nbsp;</div></li><li><div>            'custom_information' =&gt; 'SellerOrderAttributes.CustomInformation', &nbsp;</div></li><li><div>            'seller_order_id' =&gt; 'SellerOrderAttributes.SellerOrderId', &nbsp;</div></li><li><div>            'store_name' =&gt; 'SellerOrderAttributes.StoreName', &nbsp;</div></li><li><div>            'inherit_shipping_address' =&gt; 'InheritShippingAddress', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** CloseBillingAgreement API Call - Returns details about the Billing Agreement object and its current state.&nbsp;</div></li><li><div>     * @see http://docs.developer.amazonservices.com/en_US/off_amazon_payments/OffAmazonPayments_CloseBillingAgreement.html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_billing_agreement_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['closure_reason'] [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function closeBillingAgreement($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'CloseBillingAgreement';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_billing_agreement_id' =&gt; 'AmazonBillingAgreementId', &nbsp;</div></li><li><div>            'closure_reason' =&gt; 'ClosureReason', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** charge convenience method&nbsp;</div></li><li><div>     * Performs the API calls&nbsp;</div></li><li><div>     * 1. SetOrderReferenceDetails / SetBillingAgreementDetails&nbsp;</div></li><li><div>     * 2. ConfirmOrderReference / ConfirmBillingAgreement&nbsp;</div></li><li><div>     * 3. Authorize (with Capture) / AuthorizeOnBillingAgreeemnt (with Capture)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['amazon_reference_id'] - [String] : Order Reference ID /Billing Agreement ID&nbsp;</div></li><li><div>     * If requestParameters['amazon_reference_id'] is empty then the following is required, &nbsp;</div></li><li><div>     * @param requestParameters['amazon_order_reference_id'] - [String] : Order Reference ID&nbsp;</div></li><li><div>     * or, &nbsp;</div></li><li><div>     * @param requestParameters['amazon_billing_agreement_id'] - [String] : Billing Agreement ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $requestParameters['charge_amount'] - [String] : Amount value to be captured&nbsp;</div></li><li><div>     * @param requestParameters['currency_code'] - [String] : Currency Code for the Amount&nbsp;</div></li><li><div>     * @param requestParameters['authorization_reference_id'] - [String]- Any unique string that needs to be passed&nbsp;</div></li><li><div>     * @optional requestParameters['charge_note'] - [String] : Seller Note sent to the buyer&nbsp;</div></li><li><div>     * @optional requestParameters['transaction_timeout'] - [String] : Defaults to 1440 minutes&nbsp;</div></li><li><div>     * @optional requestParameters['charge_order_id'] - [String] : Custom Order ID provided&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function charge($requestParameters = array()) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>    $requestParameters= $this-&gt;trimArray($requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $setParameters = $authorizeParameters = $confirmParameters = $requestParameters;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $chargeType = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!empty($requestParameters['amazon_order_reference_id']))&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $chargeType = 'OrderReference';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    } elseif(!empty($requestParameters['amazon_billing_agreement_id'])) {&nbsp;</div></li><li><div>        $chargeType = 'BillingAgreement';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    } elseif (!empty($requestParameters['amazon_reference_id'])) {&nbsp;</div></li><li><div>            switch (substr(strtoupper($requestParameters['amazon_reference_id']), 0, 1)) {&nbsp;</div></li><li><div>                case 'P':&nbsp;</div></li><li><div>                case 'S':&nbsp;</div></li><li><div>                    $chargeType = 'OrderReference';&nbsp;</div></li><li><div>                    $setParameters['amazon_order_reference_id'] = $requestParameters['amazon_reference_id'];&nbsp;</div></li><li><div>                    $authorizeParameters['amazon_order_reference_id'] = $requestParameters['amazon_reference_id'];&nbsp;</div></li><li><div>                    $confirmParameters['amazon_order_reference_id'] = $requestParameters['amazon_reference_id'];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'B':&nbsp;</div></li><li><div>                case 'C':&nbsp;</div></li><li><div>                    $chargeType = 'BillingAgreement';&nbsp;</div></li><li><div>                    $setParameters['amazon_billing_agreement_id'] = $requestParameters['amazon_reference_id'];&nbsp;</div></li><li><div>                    $authorizeParameters['amazon_billing_agreement_id'] = $requestParameters['amazon_reference_id'];&nbsp;</div></li><li><div>                    $confirmParameters['amazon_billing_agreement_id'] = $requestParameters['amazon_reference_id'];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    throw new \Exception('Invalid Amazon Reference ID');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception('key amazon_order_reference_id or amazon_billing_agreement_id is null and is a required parameter');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Set the other parameters if the values are present&nbsp;</div></li><li><div>        $setParameters['amount'] = !empty($requestParameters['charge_amount']) ? $requestParameters['charge_amount'] : '';&nbsp;</div></li><li><div>        $authorizeParameters['authorization_amount'] = !empty($requestParameters['charge_amount']) ? $requestParameters['charge_amount'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $setParameters['seller_note'] = !empty($requestParameters['charge_note']) ? $requestParameters['charge_note'] : '';&nbsp;</div></li><li><div>        $authorizeParameters['seller_authorization_note'] = !empty($requestParameters['charge_note']) ? $requestParameters['charge_note'] : '';&nbsp;</div></li><li><div>        $authorizeParameters['seller_note'] = !empty($requestParameters['charge_note']) ? $requestParameters['charge_note'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $setParameters['seller_order_id'] = !empty($requestParameters['charge_order_id']) ? $requestParameters['charge_order_id'] : '';&nbsp;</div></li><li><div>        $setParameters['seller_billing_agreement_id'] = !empty($requestParameters['charge_order_id']) ? $requestParameters['charge_order_id'] : '';&nbsp;</div></li><li><div>        $authorizeParameters['seller_order_id'] = !empty($requestParameters['charge_order_id']) ? $requestParameters['charge_order_id'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $authorizeParameters['capture_now'] = 'true';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $response = $this-&gt;makeChargeCalls($chargeType, $setParameters, $confirmParameters, $authorizeParameters);&nbsp;</div></li><li><div>    return $response;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** makeChargeCalls - makes API calls based off the charge type (OrderReference or BillingAgreement) */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function makeChargeCalls($chargeType, $setParameters, $confirmParameters, $authorizeParameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    switch ($chargeType) {&nbsp;</div></li><li><div>            case 'OrderReference':&nbsp;</div></li><li><div>                $response = $this-&gt;setOrderReferenceDetails($setParameters);&nbsp;</div></li><li><div>                if ($this-&gt;success) {&nbsp;</div></li><li><div>                    $this-&gt;confirmOrderReference($confirmParameters);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($this-&gt;success) {&nbsp;</div></li><li><div>                    $response = $this-&gt;Authorize($authorizeParameters);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return $response;&nbsp;</div></li><li><div>            case 'BillingAgreement':&nbsp;</div></li><li><div>                // Get the Billing Agreement details and feed the response object to the ResponseParser&nbsp;</div></li><li><div>                $responseObj = $this-&gt;getBillingAgreementDetails($setParameters);&nbsp;</div></li><li><div>                // Call the function GetBillingAgreementDetailsStatus in ResponseParser.php providing it the XML response&nbsp;</div></li><li><div>                // $baStatus is an aray containing the State of the Billing Agreement&nbsp;</div></li><li><div>                $baStatus = $responseObj-&gt;getBillingAgreementDetailsStatus($responseObj-&gt;toXml());&nbsp;</div></li><li><div>                if ($baStatus['State'] != 'Open') {&nbsp;</div></li><li><div>                    $response = $this-&gt;SetBillingAgreementDetails($setParameters);&nbsp;</div></li><li><div>                    if ($this-&gt;success) {&nbsp;</div></li><li><div>                        $response = $this-&gt;ConfirmBillingAgreement($confirmParameters);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                // Check the Billing Agreement status again before making the Authorization.&nbsp;</div></li><li><div>                $responseObj = $this-&gt;getBillingAgreementDetails($setParameters);&nbsp;</div></li><li><div>                $baStatus = $responseObj-&gt;GetBillingAgreementDetailsStatus($responseObj-&gt;toXml());&nbsp;</div></li><li><div>                if ($this-&gt;success && $baStatus['State'] === 'Open') {&nbsp;</div></li><li><div>                    $response = $this-&gt;AuthorizeOnBillingAgreement($authorizeParameters);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            return $response;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetProviderCreditDetails API Call - Get the details of the Provider Credit.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_provider_credit_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getProviderCreditDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetProviderCreditDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_provider_credit_id' =&gt; 'AmazonProviderCreditId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GetProviderCreditReversalDetails API Call - Get details of the Provider Credit Reversal.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_provider_credit_reversal_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getProviderCreditReversalDetails($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'GetProviderCreditReversalDetails';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_provider_credit_reversal_id' =&gt; 'AmazonProviderCreditReversalId', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** ReverseProviderCredit API Call - Reverse the Provider Credit.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param requestParameters['merchant_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['amazon_provider_credit_id'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['credit_reversal_reference_id'] - [String]&nbsp;</div></li><li><div>     * @param requestParameters['credit_reversal_amount'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['currency_code'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['credit_reversal_note'] - [String]&nbsp;</div></li><li><div>     * @optional requestParameters['mws_auth_token'] - [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function reverseProviderCredit($requestParameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>    $parameters = array();&nbsp;</div></li><li><div>        $parameters['Action'] = 'ReverseProviderCredit';&nbsp;</div></li><li><div>        $requestParameters = array_change_key_case($requestParameters, CASE_LOWER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldMappings = array(&nbsp;</div></li><li><div>            'merchant_id' =&gt; 'SellerId', &nbsp;</div></li><li><div>            'amazon_provider_credit_id' =&gt; 'AmazonProviderCreditId', &nbsp;</div></li><li><div>        'credit_reversal_reference_id' =&gt; 'CreditReversalReferenceId', &nbsp;</div></li><li><div>        'credit_reversal_amount' =&gt; 'CreditReversalAmount.Amount', &nbsp;</div></li><li><div>        'currency_code' =&gt; 'CreditReversalAmount.CurrencyCode', &nbsp;</div></li><li><div>        'credit_reversal_note' =&gt; 'CreditReversalNote', &nbsp;</div></li><li><div>            'mws_auth_token' =&gt; 'MWSAuthToken'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $responseObject = $this-&gt;setParametersAndPost($parameters, $fieldMappings, $requestParameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ($responseObject);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Create an Array of required parameters, sort them&nbsp;</div></li><li><div>     * Calculate signature and invoke the POST to the MWS Service URL&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param AWSAccessKeyId [String]&nbsp;</div></li><li><div>     * @param Version [String]&nbsp;</div></li><li><div>     * @param SignatureMethod [String]&nbsp;</div></li><li><div>     * @param Timestamp [String]&nbsp;</div></li><li><div>     * @param Signature [String]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function calculateSignatureAndParametersToString($parameters = array())&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $parameters['AWSAccessKeyId'] = $this-&gt;config['access_key'];&nbsp;</div></li><li><div>        $parameters['Version'] = self::SERVICE_VERSION;&nbsp;</div></li><li><div>        $parameters['SignatureMethod'] = 'HmacSHA256';&nbsp;</div></li><li><div>        $parameters['SignatureVersion'] = 2;&nbsp;</div></li><li><div>        $parameters['Timestamp'] = $this-&gt;getFormattedTimestamp();&nbsp;</div></li><li><div>        uksort($parameters, 'strcmp');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;createServiceUrl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $parameters['Signature'] = $this-&gt;signParameters($parameters);&nbsp;</div></li><li><div>        $parameters = $this-&gt;getParametersAsString($parameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Save these parameters in the parameters variable so that it can be returned for unit testing.&nbsp;</div></li><li><div>    $this-&gt;parameters = $parameters;&nbsp;</div></li><li><div>        return $parameters;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Computes RFC 2104-compliant HMAC signature for request parameters&nbsp;</div></li><li><div>     * Implements AWS Signature, as per following spec:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * If Signature Version is 0, it signs concatenated Action and Timestamp&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * If Signature Version is 1, it performs the following:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Sorts all  parameters (including SignatureVersion and excluding Signature, &nbsp;</div></li><li><div>     * the value of which is being created), ignoring case.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Iterate over the sorted list and append the parameter name (in original case)&nbsp;</div></li><li><div>     * and then its value. It will not URL-encode the parameter values before&nbsp;</div></li><li><div>     * constructing this string. There are no separators.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * If Signature Version is 2, string to sign is based on following:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *    1. The HTTP Request Method followed by an ASCII newline (%0A)&nbsp;</div></li><li><div>     *    2. The HTTP Host header in the form of lowercase host, followed by an ASCII newline.&nbsp;</div></li><li><div>     *    3. The URL encoded HTTP absolute path component of the URI&nbsp;</div></li><li><div>     *       (up to but not including the query string parameters);&nbsp;</div></li><li><div>     *       if this is empty use a forward '/'. This parameter is followed by an ASCII newline.&nbsp;</div></li><li><div>     *    4. The concatenation of all query string components (names and values)&nbsp;</div></li><li><div>     *       as UTF-8 characters which are URL encoded as per RFC 3986&nbsp;</div></li><li><div>     *       (hex characters MUST be uppercase), sorted using lexicographic byte ordering.&nbsp;</div></li><li><div>     *       Parameter names are separated from their values by the '=' character&nbsp;</div></li><li><div>     *       (ASCII character 61), even if the value is empty.&nbsp;</div></li><li><div>     *       Pairs of parameter and values are separated by the '&' character (ASCII code 38).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function signParameters(array $parameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $signatureVersion = $parameters['SignatureVersion'];&nbsp;</div></li><li><div>        $algorithm = &quot;HmacSHA1&quot;;&nbsp;</div></li><li><div>        $stringToSign = null;&nbsp;</div></li><li><div>        if (2 === $signatureVersion) {&nbsp;</div></li><li><div>            $algorithm = &quot;HmacSHA256&quot;;&nbsp;</div></li><li><div>            $parameters['SignatureMethod'] = $algorithm;&nbsp;</div></li><li><div>            $stringToSign = $this-&gt;calculateStringToSignV2($parameters);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception(&quot;Invalid Signature Version specified&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;sign($stringToSign, $algorithm);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Calculate String to Sign for SignatureVersion 2&nbsp;</div></li><li><div>     * @param array $parameters request parameters&nbsp;</div></li><li><div>     * @return String to Sign&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function calculateStringToSignV2(array $parameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $data = 'POST';&nbsp;</div></li><li><div>        $data .= &quot;\n&quot;;&nbsp;</div></li><li><div>        $data .= $this-&gt;mwsEndpointUrl;&nbsp;</div></li><li><div>        $data .= &quot;\n&quot;;&nbsp;</div></li><li><div>        $data .= $this-&gt;mwsEndpointPath;&nbsp;</div></li><li><div>        $data .= &quot;\n&quot;;&nbsp;</div></li><li><div>        $data .= $this-&gt;getParametersAsString($parameters);&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Convert paremeters to Url encoded query string */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function getParametersAsString(array $parameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $queryParameters = array();&nbsp;</div></li><li><div>        foreach ($parameters as $key =&gt; $value) {&nbsp;</div></li><li><div>            $queryParameters[] = $key . '=' . $this-&gt;urlEncode($value);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return implode('&', $queryParameters);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function urlEncode($value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return str_replace('%7E', '~', rawurlencode($value));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Computes RFC 2104-compliant HMAC signature */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function sign($data, $algorithm)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($algorithm === 'HmacSHA1') {&nbsp;</div></li><li><div>            $hash = 'sha1';&nbsp;</div></li><li><div>        } else if ($algorithm === 'HmacSHA256') {&nbsp;</div></li><li><div>            $hash = 'sha256';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception(&quot;Non-supported signing method specified&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return base64_encode(hash_hmac($hash, $data, $this-&gt;config['secret_key'], true));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Formats date as ISO 8601 timestamp */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function getFormattedTimestamp()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return gmdate(&quot;Y-m-d\TH:i:s.\\0\\0\\0\\Z&quot;, time());&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** invokePost takes the parameters and invokes the httpPost function to POST the parameters&nbsp;</div></li><li><div>     * Exponential retries on error 500 and 503&nbsp;</div></li><li><div>     * The response from the POST is an XML which is converted to Array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function invokePost($parameters)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $response = array();&nbsp;</div></li><li><div>        $statusCode = 200;&nbsp;</div></li><li><div>        $this-&gt;success = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Submit the request and read response body&nbsp;</div></li><li><div>    try {&nbsp;</div></li><li><div>            $shouldRetry = true;&nbsp;</div></li><li><div>            $retries = 0;&nbsp;</div></li><li><div>            do {&nbsp;</div></li><li><div>                try {&nbsp;</div></li><li><div>                    $this-&gt;constructUserAgentHeader();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $httpCurlRequest = new HttpCurl($this-&gt;config);&nbsp;</div></li><li><div>            $response = $httpCurlRequest-&gt;httpPost($this-&gt;mwsServiceUrl, $this-&gt;userAgent, $parameters);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Split the API response into Response Body and the other parts of the response into other&nbsp;</div></li><li><div>                    list($other, $responseBody) = explode(&quot;\r\n\r\n&quot;, $response, 2);&nbsp;</div></li><li><div>                    $other = preg_split(&quot;/\r\n|\n|\r/&quot;, $other);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    list($protocol, $code, $text) = explode(' ', trim(array_shift($other)), 3);&nbsp;</div></li><li><div>                    $response = array(&nbsp;</div></li><li><div>                        'Status' =&gt; (int) $code, &nbsp;</div></li><li><div>                        'ResponseBody' =&gt; $responseBody&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $statusCode = $response['Status'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($statusCode == 200) {&nbsp;</div></li><li><div>                        $shouldRetry = false;&nbsp;</div></li><li><div>                        $this-&gt;success = true;&nbsp;</div></li><li><div>                    } elseif ($statusCode == 500 || $statusCode == 503) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $shouldRetry = true;&nbsp;</div></li><li><div>                        if ($shouldRetry && strtolower($this-&gt;config['handle_throttle'])) {&nbsp;</div></li><li><div>                            $this-&gt;pauseOnRetry(++$retries, $statusCode);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $shouldRetry = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } catch (\Exception $e) {&nbsp;</div></li><li><div>                    throw $e;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } while ($shouldRetry);&nbsp;</div></li><li><div>        } catch (\Exception $se) {&nbsp;</div></li><li><div>            throw $se;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $response;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Exponential sleep on failed request&nbsp;</div></li><li><div>     * @param retries current retry&nbsp;</div></li><li><div>     * @throws Exception if maximum number of retries has been reached&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function pauseOnRetry($retries, $status)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($retries &lt;= self::MAX_ERROR_RETRY) {&nbsp;</div></li><li><div>            $delay = (int) (pow(4, $retries) * 100000);&nbsp;</div></li><li><div>            usleep($delay);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception('Error Code: '. $status.PHP_EOL.'Maximum number of retry attempts - '. $retries .' reached');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Create MWS service URL and the Endpoint path */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function createServiceUrl()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;modePath = strtolower($this-&gt;config['sandbox']) ? 'OffAmazonPayments_Sandbox' : 'OffAmazonPayments';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($this-&gt;config['region'])) {&nbsp;</div></li><li><div>            $region = strtolower($this-&gt;config['region']);&nbsp;</div></li><li><div>            if (array_key_exists($region, $this-&gt;regionMappings)) {&nbsp;</div></li><li><div>                $this-&gt;mwsEndpointUrl = $this-&gt;mwsServiceUrls[$this-&gt;regionMappings[$region]];&nbsp;</div></li><li><div>                $this-&gt;mwsServiceUrl = 'https://' . $this-&gt;mwsEndpointUrl . '/' . $this-&gt;modePath . '/' . self::SERVICE_VERSION;&nbsp;</div></li><li><div>                $this-&gt;mwsEndpointPath = '/' . $this-&gt;modePath . '/' . self::SERVICE_VERSION;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                throw new \Exception($region . ' is not a valid region');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new \Exception(&quot;config['region'] is a required parameter and is not set&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Based on the config['region'] and config['sandbox'] values get the user profile URL */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function profileEndpointUrl()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!empty($this-&gt;config['region'])) {&nbsp;</div></li><li><div>            $region = strtolower($this-&gt;config['region']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (array_key_exists($region, $this-&gt;sandboxProfileEndpoint) && $this-&gt;config['sandbox'] ) {&nbsp;</div></li><li><div>                $this-&gt;profileEndpoint = $this-&gt;sandboxProfileEndpoint[$region];&nbsp;</div></li><li><div>        } elseif (array_key_exists($region, $this-&gt;liveProfileEndpoint)) {&nbsp;</div></li><li><div>        $this-&gt;profileEndpoint = $this-&gt;liveProfileEndpoint[$region];&nbsp;</div></li><li><div>        } else{&nbsp;</div></li><li><div>        throw new \Exception($region . ' is not a valid region');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>            throw new \Exception(&quot;config['region'] is a required parameter and is not set&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Create the User Agent Header sent with the POST request */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function constructUserAgentHeader()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;userAgent = $this-&gt;quoteApplicationName($this-&gt;config['application_name']) . '/' . $this-&gt;quoteApplicationVersion($this-&gt;config['application_version']);&nbsp;</div></li><li><div>        $this-&gt;userAgent .= ' (';&nbsp;</div></li><li><div>        $this-&gt;userAgent .= 'Language=PHP/' . phpversion();&nbsp;</div></li><li><div>        $this-&gt;userAgent .= '; ';&nbsp;</div></li><li><div>        $this-&gt;userAgent .= 'Platform=' . php_uname('s') . '/' . php_uname('m') . '/' . php_uname('r');&nbsp;</div></li><li><div>        $this-&gt;userAgent .= '; ';&nbsp;</div></li><li><div>        $this-&gt;userAgent .= 'MWSClientVersion=' . self::MWS_CLIENT_VERSION;&nbsp;</div></li><li><div>        $this-&gt;userAgent .= ')';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Collapse multiple whitespace characters into a single ' ' and backslash escape '\', &nbsp;</div></li><li><div>     * and '/' characters from a string.&nbsp;</div></li><li><div>     * @param $s&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function quoteApplicationName($s)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $quotedString = preg_replace('/ {2, }|\s/', ' ', $s);&nbsp;</div></li><li><div>        $quotedString = preg_replace('/\\\\/', '\\\\\\\\', $quotedString);&nbsp;</div></li><li><div>        $quotedString = preg_replace('/\//', '\\/', $quotedString);&nbsp;</div></li><li><div>        return $quotedString;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Collapse multiple whitespace characters into a single ' ' and backslash escape '\', &nbsp;</div></li><li><div>     * and '(' characters from a string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $s&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function quoteApplicationVersion($s)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $quotedString = preg_replace('/ {2, }|\s/', ' ', $s);&nbsp;</div></li><li><div>        $quotedString = preg_replace('/\\\\/', '\\\\\\\\', $quotedString);&nbsp;</div></li><li><div>        $quotedString = preg_replace('/\\(/', '\\(', $quotedString);&nbsp;</div></li><li><div>        return $quotedString;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/pay_with_amazon_client/" class="active">2.7.8</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.7/classes/pay_with_amazon_client/" class="">2.7.7</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.6/classes/pay_with_amazon_client/" class="">2.7.6</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.5/classes/pay_with_amazon_client/" class="">2.7.5</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.4/classes/pay_with_amazon_client/" class="">2.7.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PayWithAmazon\Client</li><li><span></span>Easy Digital Downloads</li><li><span></span>2.7.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>