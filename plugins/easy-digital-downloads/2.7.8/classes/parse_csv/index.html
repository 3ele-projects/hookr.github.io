<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.7.8" data-slug="easy-digital-downloads" data-type="class" data-id="58238"><head xmlns="http://www.w3.org/1999/xhtml"><title> parsecsv | class | Easy Digital Downloads | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="parseCSV, class, plugin, easy-digital-downloads, 2.7.8" /><meta name="description" content="The Easy Digital Downloads parseCSV class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=bb8afd8f51d722f6e7b41ac1117e53a6' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/parse_csv/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fparse_csv%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fparse_csv%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-easy-digital-downloads-2.7.8-class-parse_csv","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="parse_csv" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to easy-digital-downloads." href="http://hookr.io/plugins/easy-digital-downloads/" class="plugin"><span property="name">easy-digital-downloads</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.8." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/" class="H_VERSION"><span property="name">2.7.8</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">parse_csv</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="2274"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/all/" title="All">All <span class="count badge">2274</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="1195"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/hooks/" title="Hooks">Hooks <span class="count badge">1195</span></a></li><li class="" data-id="action" data-count="469"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/actions/" title="Actions">Actions <span class="count badge">469</span></a></li><li class="" data-id="filter" data-count="726"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/filters/" title="Filters">Filters <span class="count badge">726</span></a></li><li class="active" data-id="class" data-count="99"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/" title="Classes">Classes <span class="count badge">99</span></a></li><li class="" data-id="constant" data-count="11"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/constants/" title="Constants">Constants <span class="count badge">11</span></a></li><li class="" data-id="function" data-count="955"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/functions/" title="Functions">Functions <span class="count badge">955</span></a></li><li class="" data-id="shortcode" data-count="14"><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">14</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>parseCSV</strong></h1><p>The Easy Digital Downloads <strong>parseCSV</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/files/includes-libraries-parsecsv-lib/" class="file">/includes/libraries/parsecsv.lib.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="3" class="block" start="3"><li><div>class parseCSV {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    Class: parseCSV v0.4.3 beta&nbsp;</div></li><li><div>    https://github.com/parsecsv/parsecsv-for-php&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    Fully conforms to the specifications lined out on wikipedia:&nbsp;</div></li><li><div>    - http://en.wikipedia.org/wiki/Comma-separated_values&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    Based on the concept of Ming Hong Ng's CsvFileParser class:&nbsp;</div></li><li><div>    - http://minghong.blogspot.com/2006/07/csv-parser-for-php.html&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    (The MIT license)&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    Copyright (c) 2014 Jim Myhrberg.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    Permission is hereby granted, free of charge, to any person obtaining a copy&nbsp;</div></li><li><div>    of this software and associated documentation files (the &quot;Software&quot;), to deal&nbsp;</div></li><li><div>    in the Software without restriction, including without limitation the rights&nbsp;</div></li><li><div>    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&nbsp;</div></li><li><div>    copies of the Software, and to permit persons to whom the Software is&nbsp;</div></li><li><div>    furnished to do so, subject to the following conditions:&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    The above copyright notice and this permission notice shall be included in&nbsp;</div></li><li><div>    all copies or substantial portions of the Software.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&nbsp;</div></li><li><div>    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, &nbsp;</div></li><li><div>    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&nbsp;</div></li><li><div>    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&nbsp;</div></li><li><div>    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, &nbsp;</div></li><li><div>    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&nbsp;</div></li><li><div>    THE SOFTWARE.&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>    Code Examples&nbsp;</div></li><li><div>    ----------------&nbsp;</div></li><li><div>    # general usage&nbsp;</div></li><li><div>    $csv = new parseCSV('data.csv');&nbsp;</div></li><li><div>    print_r($csv-&gt;data);&nbsp;</div></li><li><div>    ----------------&nbsp;</div></li><li><div>    # tab delimited, and encoding conversion&nbsp;</div></li><li><div>    $csv = new parseCSV();&nbsp;</div></li><li><div>    $csv-&gt;encoding('UTF-16', 'UTF-8');&nbsp;</div></li><li><div>    $csv-&gt;delimiter = &quot;\t&quot;;&nbsp;</div></li><li><div>    $csv-&gt;parse('data.tsv');&nbsp;</div></li><li><div>    print_r($csv-&gt;data);&nbsp;</div></li><li><div>    ----------------&nbsp;</div></li><li><div>    # auto-detect delimiter character&nbsp;</div></li><li><div>    $csv = new parseCSV();&nbsp;</div></li><li><div>    $csv-&gt;auto('data.csv');&nbsp;</div></li><li><div>    print_r($csv-&gt;data);&nbsp;</div></li><li><div>    ----------------&nbsp;</div></li><li><div>    # modify data in a csv file&nbsp;</div></li><li><div>    $csv = new parseCSV();&nbsp;</div></li><li><div>    $csv-&gt;sort_by = 'id';&nbsp;</div></li><li><div>    $csv-&gt;parse('data.csv');&nbsp;</div></li><li><div>    # &quot;4&quot; is the value of the &quot;id&quot; column of the CSV row&nbsp;</div></li><li><div>    $csv-&gt;data[4] = array('firstname' =&gt; 'John', 'lastname' =&gt; 'Doe', 'email' =&gt; 'john@doe.com');&nbsp;</div></li><li><div>    $csv-&gt;save();&nbsp;</div></li><li><div>    ----------------&nbsp;</div></li><li><div>    # add row/entry to end of CSV file&nbsp;</div></li><li><div>    #  - only recommended when you know the extact sctructure of the file&nbsp;</div></li><li><div>    $csv = new parseCSV();&nbsp;</div></li><li><div>    $csv-&gt;save('data.csv', array(array('1986', 'Home', 'Nowhere', '')), true);&nbsp;</div></li><li><div>    ----------------&nbsp;</div></li><li><div>    # convert 2D array to csv data and send headers&nbsp;</div></li><li><div>    # to browser to treat output as a file and download it&nbsp;</div></li><li><div>    $csv = new parseCSV();&nbsp;</div></li><li><div>    $csv-&gt;output('movies.csv', $array, array('field 1', 'field 2'), ', ');&nbsp;</div></li><li><div>    ----------------&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Configuration&nbsp;</div></li><li><div>     * - set these options with $object-&gt;var_name = 'value';&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Heading&nbsp;</div></li><li><div>     * Use first line/entry as field names&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $heading = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Fields&nbsp;</div></li><li><div>     * Override field names&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sort By&nbsp;</div></li><li><div>     * Sort csv by this field&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $sort_by = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sort Reverse&nbsp;</div></li><li><div>     * Reverse the sort function&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $sort_reverse = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sort Type&nbsp;</div></li><li><div>     * Sort behavior passed to sort methods&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * regular = SORT_REGULAR&nbsp;</div></li><li><div>     * numeric = SORT_NUMERIC&nbsp;</div></li><li><div>     * string = SORT_STRING&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $sort_type = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delimiter&nbsp;</div></li><li><div>     * Delimiter character&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $delimiter = ', ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enclosure&nbsp;</div></li><li><div>     * Enclosure character&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $enclosure = '&quot;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enclose All&nbsp;</div></li><li><div>     * Force enclosing all columns&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $enclose_all = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Conditions&nbsp;</div></li><li><div>     * Basic SQL-Like conditions for row matching&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $conditions = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Offset&nbsp;</div></li><li><div>     * Number of rows to ignore from beginning of data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $offset = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Limit&nbsp;</div></li><li><div>     * Limits the number of returned rows to the specified amount&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $limit = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Auto Depth&nbsp;</div></li><li><div>     * Number of rows to analyze when attempting to auto-detect delimiter&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $auto_depth = 15;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Auto Non Charts&nbsp;</div></li><li><div>     * Characters that should be ignored when attempting to auto-detect delimiter&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $auto_non_chars = &quot;a-zA-Z0-9\n\r&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Auto Preferred&nbsp;</div></li><li><div>     * preferred delimiter characters, only used when all filtering method&nbsp;</div></li><li><div>     * returns multiple possible delimiters (happens very rarely)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $auto_preferred = &quot;, ;\t.:|&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert Encoding&nbsp;</div></li><li><div>     * Should we convert the csv encoding?&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $convert_encoding = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Input Encoding&nbsp;</div></li><li><div>     * Set the input encoding&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $input_encoding = 'ISO-8859-1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Output Encoding&nbsp;</div></li><li><div>     * Set the output encoding&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $output_encoding = 'ISO-8859-1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Linefeed&nbsp;</div></li><li><div>     * Line feed characters used by unparse, save, and output methods&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $linefeed = &quot;\r&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Output Delimiter&nbsp;</div></li><li><div>     * Sets the output delimiter used by the output method&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $output_delimiter = ', ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Output filename&nbsp;</div></li><li><div>     * Sets the output filename&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $output_filename = 'data.csv';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Keep File Data&nbsp;</div></li><li><div>     * keep raw file data in memory after successful parsing (useful for debugging)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $keep_file_data = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Internal variables&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * File&nbsp;</div></li><li><div>     * Current Filename&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $file;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * File Data&nbsp;</div></li><li><div>     * Current file data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $file_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Error&nbsp;</div></li><li><div>     * Contains the error code if one occured&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * 0 = No errors found. Everything should be fine :)&nbsp;</div></li><li><div>     * 1 = Hopefully correctable syntax error was found.&nbsp;</div></li><li><div>     * 2 = Enclosure character (double quote by default)&nbsp;</div></li><li><div>     *     was found in non-enclosed field. This means&nbsp;</div></li><li><div>     *     the file is either corrupt, or does not&nbsp;</div></li><li><div>     *     standard CSV formatting. Please validate&nbsp;</div></li><li><div>     *     the parsed data yourself.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $error = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Error Information&nbsp;</div></li><li><div>     * Detailed error information&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $error_info = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Titles&nbsp;</div></li><li><div>     * CSV titles if they exists&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $titles = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Data&nbsp;</div></li><li><div>     * Two dimensional array of CSV data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $data = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor&nbsp;</div></li><li><div>     * Class constructor&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param  [string]  input      The CSV string or a direct filepath&nbsp;</div></li><li><div>     * @param  [integer] offset     Number of rows to ignore from the beginning of  the data&nbsp;</div></li><li><div>     * @param  [integer] limit      Limits the number of returned rows to specified amount&nbsp;</div></li><li><div>     * @param  [string]  conditions Basic SQL-like conditions for row matching&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct($input = null, $offset = null, $limit = null, $conditions = null, $keep_file_data = null) {&nbsp;</div></li><li><div>        if (!is_null($offset)) {&nbsp;</div></li><li><div>            $this-&gt;offset = $offset;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_null($limit)) {&nbsp;</div></li><li><div>            $this-&gt;limit = $limit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_null($conditions)) {&nbsp;</div></li><li><div>            $this-&gt;conditions = $conditions;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_null($keep_file_data)) {&nbsp;</div></li><li><div>            $this-&gt;keep_file_data = $keep_file_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($input)) {&nbsp;</div></li><li><div>            $this-&gt;parse($input);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // ==============================================&nbsp;</div></li><li><div>    // ----- [ Main Functions ] ---------------------&nbsp;</div></li><li><div>    // ==============================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parse&nbsp;</div></li><li><div>     * Parse a CSV file or string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param  [string]  input      The CSV string or a direct filepath&nbsp;</div></li><li><div>     * @param  [integer] offset     Number of rows to ignore from the beginning of  the data&nbsp;</div></li><li><div>     * @param  [integer] limit      Limits the number of returned rows to specified amount&nbsp;</div></li><li><div>     * @param  [string]  conditions Basic SQL-like conditions for row matching&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return [bool]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse($input = null, $offset = null, $limit = null, $conditions = null) {&nbsp;</div></li><li><div>        if (is_null($input)) {&nbsp;</div></li><li><div>            $input = $this-&gt;file;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($input)) {&nbsp;</div></li><li><div>            if (!is_null($offset)) {&nbsp;</div></li><li><div>                $this-&gt;offset = $offset;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!is_null($limit)) {&nbsp;</div></li><li><div>                $this-&gt;limit = $limit;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!is_null($conditions)) {&nbsp;</div></li><li><div>                $this-&gt;conditions = $conditions;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (is_readable($input)) {&nbsp;</div></li><li><div>                $this-&gt;data = $this-&gt;parse_file($input);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;file_data = &$input;&nbsp;</div></li><li><div>                $this-&gt;data = $this-&gt;parse_string();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;data === false) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save&nbsp;</div></li><li><div>     * Save changes, or write a new file and/or data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param  [string] $file   File location to save to&nbsp;</div></li><li><div>     * @param  [array]  $data   2D array of data&nbsp;</div></li><li><div>     * @param  [bool]   $append Append current data to end of target CSV, if file exists&nbsp;</div></li><li><div>     * @param  [array]  $fields Field names&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return [bool]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function save($file = null, $data = array(), $append = false, $fields = array()) {&nbsp;</div></li><li><div>        if (empty($file)) {&nbsp;</div></li><li><div>            $file = &$this-&gt;file;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $mode = ($append) ? 'at' : 'wt';&nbsp;</div></li><li><div>        $is_php = (preg_match('/\.php$/i', $file)) ? true : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_wfile($file, $this-&gt;unparse($data, $fields, $append, $is_php), $mode);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Output&nbsp;</div></li><li><div>     * Generate a CSV based string for output.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param  [string] $filename  If specified, headers and data will be output directly to browser as a downloable file&nbsp;</div></li><li><div>     * @param  [array]  $data      2D array with data&nbsp;</div></li><li><div>     * @param  [array]  $fields    Field names&nbsp;</div></li><li><div>     * @param  [type]   $delimiter delimiter used to separate data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return [string]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function output($filename = null, $data = array(), $fields = array(), $delimiter = null) {&nbsp;</div></li><li><div>        if (empty($filename)) {&nbsp;</div></li><li><div>            $filename = $this-&gt;output_filename;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($delimiter === null) {&nbsp;</div></li><li><div>            $delimiter = $this-&gt;output_delimiter;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;unparse($data, $fields, null, null, $delimiter);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_null($filename)) {&nbsp;</div></li><li><div>            header('Content-type: application/csv');&nbsp;</div></li><li><div>            header('Content-Length: ' . strlen($data));&nbsp;</div></li><li><div>            header('Cache-Control: no-cache, must-revalidate');&nbsp;</div></li><li><div>            header('Pragma: no-cache');&nbsp;</div></li><li><div>            header('Expires: 0');&nbsp;</div></li><li><div>            header('Content-Disposition: attachment; filename=&quot;' . $filename . '&quot;; modification-date=&quot;' . date('r') . '&quot;;');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            echo $data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Encoding&nbsp;</div></li><li><div>     * Convert character encoding&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param  [string] $input  Input character encoding, uses default if left blank&nbsp;</div></li><li><div>     * @param  [string] $output Output character encoding, uses default if left blank&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function encoding($input = null, $output = null) {&nbsp;</div></li><li><div>        $this-&gt;convert_encoding = true;&nbsp;</div></li><li><div>        if (!is_null($input)) {&nbsp;</div></li><li><div>            $this-&gt;input_encoding = $input;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_null($output)) {&nbsp;</div></li><li><div>            $this-&gt;output_encoding = $output;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Auto&nbsp;</div></li><li><div>     * Auto-Detect Delimiter: Find delimiter by analyzing a specific number of&nbsp;</div></li><li><div>     * rows to determine most probable delimiter character&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param  [string] $file         Local CSV file&nbsp;</div></li><li><div>     * @param  [bool]   $parse        True/false parse file directly&nbsp;</div></li><li><div>     * @param  [int]    $search_depth Number of rows to analyze&nbsp;</div></li><li><div>     * @param  [string] $preferred    Preferred delimiter characters&nbsp;</div></li><li><div>     * @param  [string] $enclosure    Enclosure character, default is double quote (&quot;).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return [string]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function auto($file = null, $parse = true, $search_depth = null, $preferred = null, $enclosure = null) {&nbsp;</div></li><li><div>        if (is_null($file)) {&nbsp;</div></li><li><div>            $file = $this-&gt;file;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (empty($search_depth)) {&nbsp;</div></li><li><div>            $search_depth = $this-&gt;auto_depth;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (is_null($enclosure)) {&nbsp;</div></li><li><div>            $enclosure = $this-&gt;enclosure;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (is_null($preferred)) {&nbsp;</div></li><li><div>            $preferred = $this-&gt;auto_preferred;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (empty($this-&gt;file_data)) {&nbsp;</div></li><li><div>            if ($this-&gt;_check_data($file)) {&nbsp;</div></li><li><div>                $data = &$this-&gt;file_data;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $data = &$this-&gt;file_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $chars = array();&nbsp;</div></li><li><div>        $strlen = strlen($data);&nbsp;</div></li><li><div>        $enclosed = false;&nbsp;</div></li><li><div>        $n = 1;&nbsp;</div></li><li><div>        $to_end = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // walk specific depth finding posssible delimiter characters&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $strlen; $i++) {&nbsp;</div></li><li><div>            $ch = $data{$i};&nbsp;</div></li><li><div>            $nch = (isset($data{$i + 1})) ? $data{$i + 1} : false;&nbsp;</div></li><li><div>            $pch = (isset($data{$i - 1})) ? $data{$i - 1} : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // open and closing quotes&nbsp;</div></li><li><div>            if ($ch == $enclosure) {&nbsp;</div></li><li><div>                if (!$enclosed || $nch != $enclosure) {&nbsp;</div></li><li><div>                    $enclosed = ($enclosed) ? false : true;&nbsp;</div></li><li><div>                } elseif ($enclosed) {&nbsp;</div></li><li><div>                    $i++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // end of row&nbsp;</div></li><li><div>            } elseif (($ch == &quot;\n&quot; && $pch != &quot;\r&quot; || $ch == &quot;\r&quot;) && !$enclosed) {&nbsp;</div></li><li><div>                if ($n &gt;= $search_depth) {&nbsp;</div></li><li><div>                    $strlen = 0;&nbsp;</div></li><li><div>                    $to_end = false;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $n++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // count character&nbsp;</div></li><li><div>            } elseif (!$enclosed) {&nbsp;</div></li><li><div>                if (!preg_match('/[' . preg_quote($this-&gt;auto_non_chars, '/') . ']/i', $ch)) {&nbsp;</div></li><li><div>                    if (!isset($chars[$ch][$n])) {&nbsp;</div></li><li><div>                        $chars[$ch][$n] = 1;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $chars[$ch][$n]++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // filtering&nbsp;</div></li><li><div>        $depth = ($to_end) ? $n - 1 : $n;&nbsp;</div></li><li><div>        $filtered = array();&nbsp;</div></li><li><div>        foreach ($chars as $char =&gt; $value) {&nbsp;</div></li><li><div>            if ($match = $this-&gt;_check_count($char, $value, $depth, $preferred)) {&nbsp;</div></li><li><div>                $filtered[$match] = $char;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // capture most probable delimiter&nbsp;</div></li><li><div>        ksort($filtered);&nbsp;</div></li><li><div>        $this-&gt;delimiter = reset($filtered);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // parse data&nbsp;</div></li><li><div>        if ($parse) {&nbsp;</div></li><li><div>            $this-&gt;data = $this-&gt;parse_string();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;delimiter;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // ==============================================&nbsp;</div></li><li><div>    // ----- [ Core Functions ] ---------------------&nbsp;</div></li><li><div>    // ==============================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parse File&nbsp;</div></li><li><div>     * Read file to string and call parse_string()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  [string] $file Local CSV file&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return [array|bool]&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_file($file = null) {&nbsp;</div></li><li><div>        if (is_null($file)) {&nbsp;</div></li><li><div>            $file = $this-&gt;file;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (empty($this-&gt;file_data)) {&nbsp;</div></li><li><div>            $this-&gt;load_data($file);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return (!empty($this-&gt;file_data)) ? $this-&gt;parse_string() : false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parse CSV strings to arrays&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param   data   CSV string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  2D array with CSV data, or false on failure&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_string($data = null) {&nbsp;</div></li><li><div>        if (empty($data)) {&nbsp;</div></li><li><div>            if ($this-&gt;_check_data()) {&nbsp;</div></li><li><div>                $data = &$this-&gt;file_data;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $white_spaces = str_replace($this-&gt;delimiter, '', &quot; \t\x0B\0&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $rows = array();&nbsp;</div></li><li><div>        $row = array();&nbsp;</div></li><li><div>        $row_count = 0;&nbsp;</div></li><li><div>        $current = '';&nbsp;</div></li><li><div>        $head = (!empty($this-&gt;fields)) ? $this-&gt;fields : array();&nbsp;</div></li><li><div>        $col = 0;&nbsp;</div></li><li><div>        $enclosed = false;&nbsp;</div></li><li><div>        $was_enclosed = false;&nbsp;</div></li><li><div>        $strlen = strlen($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // force the parser to process end of data as a character (false) when&nbsp;</div></li><li><div>        // data does not end with a line feed or carriage return character.&nbsp;</div></li><li><div>        $lch = $data{$strlen - 1};&nbsp;</div></li><li><div>        if ($lch != &quot;\n&quot; && $lch != &quot;\r&quot;) {&nbsp;</div></li><li><div>            $strlen++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // walk through each character&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $strlen; $i++) {&nbsp;</div></li><li><div>            $ch = (isset($data{$i})) ? $data{$i} : false;&nbsp;</div></li><li><div>            $nch = (isset($data{$i + 1})) ? $data{$i + 1} : false;&nbsp;</div></li><li><div>            $pch = (isset($data{$i - 1})) ? $data{$i - 1} : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // open/close quotes, and inline quotes&nbsp;</div></li><li><div>            if ($ch == $this-&gt;enclosure) {&nbsp;</div></li><li><div>                if (!$enclosed) {&nbsp;</div></li><li><div>                    if (ltrim($current, $white_spaces) == '') {&nbsp;</div></li><li><div>                        $enclosed = true;&nbsp;</div></li><li><div>                        $was_enclosed = true;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $this-&gt;error = 2;&nbsp;</div></li><li><div>                        $error_row = count($rows) + 1;&nbsp;</div></li><li><div>                        $error_col = $col + 1;&nbsp;</div></li><li><div>                        if (!isset($this-&gt;error_info[$error_row . '-' . $error_col])) {&nbsp;</div></li><li><div>                            $this-&gt;error_info[$error_row . '-' . $error_col] = array(&nbsp;</div></li><li><div>                                'type' =&gt; 2, &nbsp;</div></li><li><div>                                'info' =&gt; 'Syntax error found on row ' . $error_row . '. Non-enclosed fields can not contain double-quotes.', &nbsp;</div></li><li><div>                                'row' =&gt; $error_row, &nbsp;</div></li><li><div>                                'field' =&gt; $error_col, &nbsp;</div></li><li><div>                                'field_name' =&gt; (!empty($head[$col])) ? $head[$col] : null, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $current .= $ch;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } elseif ($nch == $this-&gt;enclosure) {&nbsp;</div></li><li><div>                    $current .= $ch;&nbsp;</div></li><li><div>                    $i++;&nbsp;</div></li><li><div>                } elseif ($nch != $this-&gt;delimiter && $nch != &quot;\r&quot; && $nch != &quot;\n&quot;) {&nbsp;</div></li><li><div>                    for ($x = ($i + 1);isset($data{$x}) && ltrim($data{$x}, $white_spaces) == ''; $x++) {}&nbsp;</div></li><li><div>                    if ($data{$x} == $this-&gt;delimiter) {&nbsp;</div></li><li><div>                        $enclosed = false;&nbsp;</div></li><li><div>                        $i = $x;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        if ($this-&gt;error &lt; 1) {&nbsp;</div></li><li><div>                            $this-&gt;error = 1;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $error_row = count($rows) + 1;&nbsp;</div></li><li><div>                        $error_col = $col + 1;&nbsp;</div></li><li><div>                        if (!isset($this-&gt;error_info[$error_row . '-' . $error_col])) {&nbsp;</div></li><li><div>                            $this-&gt;error_info[$error_row . '-' . $error_col] = array(&nbsp;</div></li><li><div>                                'type' =&gt; 1, &nbsp;</div></li><li><div>                                'info' =&gt;&nbsp;</div></li><li><div>                                'Syntax error found on row ' . (count($rows) + 1) . '. ' .&nbsp;</div></li><li><div>                                'A single double-quote was found within an enclosed string. ' .&nbsp;</div></li><li><div>                                'Enclosed double-quotes must be escaped with a second double-quote.', &nbsp;</div></li><li><div>                                'row' =&gt; count($rows) + 1, &nbsp;</div></li><li><div>                                'field' =&gt; $col + 1, &nbsp;</div></li><li><div>                                'field_name' =&gt; (!empty($head[$col])) ? $head[$col] : null, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $current .= $ch;&nbsp;</div></li><li><div>                        $enclosed = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $enclosed = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // end of field/row/csv&nbsp;</div></li><li><div>            } elseif (($ch == $this-&gt;delimiter || $ch == &quot;\n&quot; || $ch == &quot;\r&quot; || $ch === false) && !$enclosed) {&nbsp;</div></li><li><div>                $key = (!empty($head[$col])) ? $head[$col] : $col;&nbsp;</div></li><li><div>                $row[$key] = ($was_enclosed) ? $current : trim($current);&nbsp;</div></li><li><div>                $current = '';&nbsp;</div></li><li><div>                $was_enclosed = false;&nbsp;</div></li><li><div>                $col++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // end of row&nbsp;</div></li><li><div>                if ($ch == &quot;\n&quot; || $ch == &quot;\r&quot; || $ch === false) {&nbsp;</div></li><li><div>                    if ($this-&gt;_validate_offset($row_count) && $this-&gt;_validate_row_conditions($row, $this-&gt;conditions)) {&nbsp;</div></li><li><div>                        if ($this-&gt;heading && empty($head)) {&nbsp;</div></li><li><div>                            $head = $row;&nbsp;</div></li><li><div>                        } elseif (empty($this-&gt;fields) || (!empty($this-&gt;fields) && (($this-&gt;heading && $row_count &gt; 0) || !$this-&gt;heading))) {&nbsp;</div></li><li><div>                            if (!empty($this-&gt;sort_by) && !empty($row[$this-&gt;sort_by])) {&nbsp;</div></li><li><div>                                if (isset($rows[$row[$this-&gt;sort_by]])) {&nbsp;</div></li><li><div>                                    $rows[$row[$this-&gt;sort_by] . '_0'] = &$rows[$row[$this-&gt;sort_by]];&nbsp;</div></li><li><div>                                    unset($rows[$row[$this-&gt;sort_by]]);&nbsp;</div></li><li><div>                                    for ($sn = 1;isset($rows[$row[$this-&gt;sort_by] . '_' . $sn]); $sn++) {}&nbsp;</div></li><li><div>                                    $rows[$row[$this-&gt;sort_by] . '_' . $sn] = $row;&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $rows[$row[$this-&gt;sort_by]] = $row;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $rows[] = $row;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $row = array();&nbsp;</div></li><li><div>                    $col = 0;&nbsp;</div></li><li><div>                    $row_count++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($this-&gt;sort_by === null && $this-&gt;limit !== null && count($rows) == $this-&gt;limit) {&nbsp;</div></li><li><div>                        $i = $strlen;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($ch == &quot;\r&quot; && $nch == &quot;\n&quot;) {&nbsp;</div></li><li><div>                        $i++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // append character to current field&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $current .= $ch;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;titles = $head;&nbsp;</div></li><li><div>        if (!empty($this-&gt;sort_by)) {&nbsp;</div></li><li><div>            $sort_type = SORT_REGULAR;&nbsp;</div></li><li><div>            if ($this-&gt;sort_type == 'numeric') {&nbsp;</div></li><li><div>                $sort_type = SORT_NUMERIC;&nbsp;</div></li><li><div>            } elseif ($this-&gt;sort_type == 'string') {&nbsp;</div></li><li><div>                $sort_type = SORT_STRING;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            ($this-&gt;sort_reverse) ? krsort($rows, $sort_type) : ksort($rows, $sort_type);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;offset !== null || $this-&gt;limit !== null) {&nbsp;</div></li><li><div>                $rows = array_slice($rows, ($this-&gt;offset === null ? 0 : $this-&gt;offset), $this-&gt;limit, true);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$this-&gt;keep_file_data) {&nbsp;</div></li><li><div>            $this-&gt;file_data = null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $rows;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create CSV data from array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param   data        2D array with data&nbsp;</div></li><li><div>     * @param   fields      field names&nbsp;</div></li><li><div>     * @param   append      if true, field names will not be output&nbsp;</div></li><li><div>     * @param   is_php      if a php die() call should be put on the first&nbsp;</div></li><li><div>     *                      line of the file, this is later ignored when read.&nbsp;</div></li><li><div>     * @param   delimiter   field delimiter to use&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  CSV data (text string)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function unparse($data = array(), $fields = array(), $append = false, $is_php = false, $delimiter = null) {&nbsp;</div></li><li><div>        if (!is_array($data) || empty($data)) {&nbsp;</div></li><li><div>            $data = &$this-&gt;data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_array($fields) || empty($fields)) {&nbsp;</div></li><li><div>            $fields = &$this-&gt;titles;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($delimiter === null) {&nbsp;</div></li><li><div>            $delimiter = $this-&gt;delimiter;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $string = ($is_php) ? &quot;&lt;?php header('Status: 403'); die(' '); ?&gt;&quot; . $this-&gt;linefeed : '';&nbsp;</div></li><li><div>        $entry = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // create heading&nbsp;</div></li><li><div>        if ($this-&gt;heading && !$append && !empty($fields)) {&nbsp;</div></li><li><div>            foreach ($fields as $key =&gt; $value) {&nbsp;</div></li><li><div>                $entry[] = $this-&gt;_enclose_value($value, $delimiter);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $string .= implode($delimiter, $entry) . $this-&gt;linefeed;&nbsp;</div></li><li><div>            $entry = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // create data&nbsp;</div></li><li><div>        foreach ($data as $key =&gt; $row) {&nbsp;</div></li><li><div>            foreach ($row as $field =&gt; $value) {&nbsp;</div></li><li><div>                $entry[] = $this-&gt;_enclose_value($value, $delimiter);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $string .= implode($delimiter, $entry) . $this-&gt;linefeed;&nbsp;</div></li><li><div>            $entry = array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;convert_encoding) {&nbsp;</div></li><li><div>            $string = iconv($this-&gt;input_encoding, $this-&gt;output_encoding, $string);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $string;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load local file or string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @param   input   local CSV file&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  true or false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_data($input = null) {&nbsp;</div></li><li><div>        $data = null;&nbsp;</div></li><li><div>        $file = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (is_null($input)) {&nbsp;</div></li><li><div>            $file = $this-&gt;file;&nbsp;</div></li><li><div>        } elseif (file_exists($input)) {&nbsp;</div></li><li><div>            $file = $input;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $data = $input;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($data) || $data = $this-&gt;_rfile($file)) {&nbsp;</div></li><li><div>            if ($this-&gt;file != $file) {&nbsp;</div></li><li><div>                $this-&gt;file = $file;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (preg_match('/\.php$/i', $file) && preg_match('/&lt;\?.*?\?&gt;(.*)/ims', $data, $strip)) {&nbsp;</div></li><li><div>                $data = ltrim($strip[1]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;convert_encoding) {&nbsp;</div></li><li><div>                $data = iconv($this-&gt;input_encoding, $this-&gt;output_encoding, $data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (substr($data, -1) != &quot;\n&quot;) {&nbsp;</div></li><li><div>                $data .= &quot;\n&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;file_data = &$data;&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // ==============================================&nbsp;</div></li><li><div>    // ----- [ Internal Functions ] -----------------&nbsp;</div></li><li><div>    // ==============================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate a row against specified conditions&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param   row          array with values from a row&nbsp;</div></li><li><div>     * @param   conditions   specified conditions that the row must match&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  true of false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _validate_row_conditions($row = array(), $conditions = null) {&nbsp;</div></li><li><div>        if (!empty($row)) {&nbsp;</div></li><li><div>            if (!empty($conditions)) {&nbsp;</div></li><li><div>                $conditions = (strpos($conditions, ' OR ') !== false) ? explode(' OR ', $conditions) : array($conditions);&nbsp;</div></li><li><div>                $or = '';&nbsp;</div></li><li><div>                foreach ($conditions as $key =&gt; $value) {&nbsp;</div></li><li><div>                    if (strpos($value, ' AND ') !== false) {&nbsp;</div></li><li><div>                        $value = explode(' AND ', $value);&nbsp;</div></li><li><div>                        $and = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        foreach ($value as $k =&gt; $v) {&nbsp;</div></li><li><div>                            $and .= $this-&gt;_validate_row_condition($row, $v);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $or .= (strpos($and, '0') !== false) ? '0' : '1';&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $or .= $this-&gt;_validate_row_condition($row, $value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return (strpos($or, '1') !== false) ? true : false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate a row against a single condition&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param   row          array with values from a row&nbsp;</div></li><li><div>     * @param   condition   specified condition that the row must match&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  true of false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _validate_row_condition($row, $condition) {&nbsp;</div></li><li><div>        $operators = array(&nbsp;</div></li><li><div>            '=', 'equals', 'is', &nbsp;</div></li><li><div>            '!=', 'is not', &nbsp;</div></li><li><div>            '&lt;', 'is less than', &nbsp;</div></li><li><div>            '&gt;', 'is greater than', &nbsp;</div></li><li><div>            '&lt;=', 'is less than or equals', &nbsp;</div></li><li><div>            '&gt;=', 'is greater than or equals', &nbsp;</div></li><li><div>            'contains', &nbsp;</div></li><li><div>            'does not contain', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $operators_regex = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($operators as $value) {&nbsp;</div></li><li><div>            $operators_regex[] = preg_quote($value, '/');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $operators_regex = implode('|', $operators_regex);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (preg_match('/^(.+) (' . $operators_regex . ') (.+)$/i', trim($condition), $capture)) {&nbsp;</div></li><li><div>            $field = $capture[1];&nbsp;</div></li><li><div>            $op = $capture[2];&nbsp;</div></li><li><div>            $value = $capture[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (preg_match('/^([\'\&quot;]{1})(.*)([\'\&quot;]{1})$/i', $value, $capture)) {&nbsp;</div></li><li><div>                if ($capture[1] == $capture[3]) {&nbsp;</div></li><li><div>                    $value = $capture[2];&nbsp;</div></li><li><div>                    $value = str_replace(&quot;\\n&quot;, &quot;\n&quot;, $value);&nbsp;</div></li><li><div>                    $value = str_replace(&quot;\\r&quot;, &quot;\r&quot;, $value);&nbsp;</div></li><li><div>                    $value = str_replace(&quot;\\t&quot;, &quot;\t&quot;, $value);&nbsp;</div></li><li><div>                    $value = stripslashes($value);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (array_key_exists($field, $row)) {&nbsp;</div></li><li><div>                if (($op == '=' || $op == 'equals' || $op == 'is') && $row[$field] == $value) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } elseif (($op == '!=' || $op == 'is not') && $row[$field] != $value) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } elseif (($op == '&lt;' || $op == 'is less than') && $row[$field] &lt; $value) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } elseif (($op == '&gt;' || $op == 'is greater than') && $row[$field] &gt; $value) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } elseif (($op == '&lt;=' || $op == 'is less than or equals') && $row[$field] &lt;= $value) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } elseif (($op == '&gt;=' || $op == 'is greater than or equals') && $row[$field] &gt;= $value) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } elseif ($op == 'contains' && preg_match('/' . preg_quote($value, '/') . '/i', $row[$field])) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } elseif ($op == 'does not contain' && !preg_match('/' . preg_quote($value, '/') . '/i', $row[$field])) {&nbsp;</div></li><li><div>                    return '1';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return '0';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return '1';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validates if the row is within the offset or not if sorting is disabled&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param   current_row   the current row number being processed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  true of false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _validate_offset($current_row) {&nbsp;</div></li><li><div>        if ($this-&gt;sort_by === null && $this-&gt;offset !== null && $current_row &lt; $this-&gt;offset) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enclose values if needed&nbsp;</div></li><li><div>     *  - only used by unparse()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param  value   string to process&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return Processed value&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _enclose_value($value = null, $delimiter = null) {&nbsp;</div></li><li><div>        if (is_null($delimiter)) {&nbsp;</div></li><li><div>            $delimiter = $this-&gt;delimiter;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($value !== null && $value != '') {&nbsp;</div></li><li><div>            $delimiter_quoted = preg_quote($delimiter, '/');&nbsp;</div></li><li><div>            $enclosure_quoted = preg_quote($this-&gt;enclosure, '/');&nbsp;</div></li><li><div>            if (preg_match(&quot;/&quot; . $delimiter_quoted . &quot;|&quot; . $enclosure_quoted . &quot;|\n|\r/i&quot;, $value) || ($value{0} == ' ' || substr($value, -1) == ' ') || $this-&gt;enclose_all) {&nbsp;</div></li><li><div>                $value = str_replace($this-&gt;enclosure, $this-&gt;enclosure . $this-&gt;enclosure, $value);&nbsp;</div></li><li><div>                $value = $this-&gt;enclosure . $value . $this-&gt;enclosure;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check file data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param   file   local filename&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  true or false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _check_data($file = null) {&nbsp;</div></li><li><div>        if (empty($this-&gt;file_data)) {&nbsp;</div></li><li><div>            if (is_null($file)) {&nbsp;</div></li><li><div>                $file = $this-&gt;file;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $this-&gt;load_data($file);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if passed info might be delimiter&nbsp;</div></li><li><div>     * Only used by find_delimiter&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param  [type] $char      [description]&nbsp;</div></li><li><div>     * @param  [type] $array     [description]&nbsp;</div></li><li><div>     * @param  [type] $depth     [description]&nbsp;</div></li><li><div>     * @param  [type] $preferred [description]&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return special string used for delimiter selection, or false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _check_count($char, $array, $depth, $preferred) {&nbsp;</div></li><li><div>        if ($depth == count($array)) {&nbsp;</div></li><li><div>            $first = null;&nbsp;</div></li><li><div>            $equal = null;&nbsp;</div></li><li><div>            $almost = false;&nbsp;</div></li><li><div>            foreach ($array as $key =&gt; $value) {&nbsp;</div></li><li><div>                if ($first == null) {&nbsp;</div></li><li><div>                    $first = $value;&nbsp;</div></li><li><div>                } elseif ($value == $first && $equal !== false) {&nbsp;</div></li><li><div>                    $equal = true;&nbsp;</div></li><li><div>                } elseif ($value == $first + 1 && $equal !== false) {&nbsp;</div></li><li><div>                    $equal = true;&nbsp;</div></li><li><div>                    $almost = true;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $equal = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($equal) {&nbsp;</div></li><li><div>                $match = ($almost) ? 2 : 1;&nbsp;</div></li><li><div>                $pref = strpos($preferred, $char);&nbsp;</div></li><li><div>                $pref = ($pref !== false) ? str_pad($pref, 3, '0', STR_PAD_LEFT) : '999';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $pref . $match . '.' . (99999 - str_pad($first, 5, '0', STR_PAD_LEFT));&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Read local file&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param   file   local filename&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  Data from file, or false on failure&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _rfile($file = null) {&nbsp;</div></li><li><div>        if (is_readable($file)) {&nbsp;</div></li><li><div>            if (!($fh = fopen($file, 'r'))) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data = fread($fh, filesize($file));&nbsp;</div></li><li><div>            fclose($fh);&nbsp;</div></li><li><div>            return $data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Write to local file&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access protected&nbsp;</div></li><li><div>     * @param   file     local filename&nbsp;</div></li><li><div>     * @param   string   data to write to file&nbsp;</div></li><li><div>     * @param   mode     fopen() mode&nbsp;</div></li><li><div>     * @param   lock     flock() mode&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return  true or false&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _wfile($file, $string = '', $mode = 'wb', $lock = 2) {&nbsp;</div></li><li><div>        if ($fp = fopen($file, $mode)) {&nbsp;</div></li><li><div>            flock($fp, $lock);&nbsp;</div></li><li><div>            $re = fwrite($fp, $string);&nbsp;</div></li><li><div>            $re2 = fclose($fp);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($re != false && $re2 != false) {&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.8/classes/parse_csv/" class="active">2.7.8</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.7/classes/parse_csv/" class="">2.7.7</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.6/classes/parse_csv/" class="">2.7.6</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.5/classes/parse_csv/" class="">2.7.5</a></li><li><a href="http://hookr.io/plugins/easy-digital-downloads/2.7.4/classes/parse_csv/" class="">2.7.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>parseCSV</li><li><span></span>Easy Digital Downloads</li><li><span></span>2.7.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>