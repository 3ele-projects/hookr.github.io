<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="4.1.0" data-slug="gravity-pdf" data-type="class" data-id="20869"><head xmlns="http://www.w3.org/1999/xhtml"><title> pdf_parser | class | Gravity Pdf | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="pdf_parser, class, plugin, gravity-pdf, 4.1.0" /><meta name="description" content="Class pdf_parser" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=14c3ffe18ebb9d89a776dc079364ea73' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pdf_parser/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpdf_parser%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpdf_parser%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-gravity-pdf-4.1.0-class-pdf_parser","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pdf_parser" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to gravity-pdf." href="http://hookr.io/plugins/gravity-pdf/" class="plugin"><span property="name">gravity-pdf</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.1.0." href="http://hookr.io/plugins/gravity-pdf/4.1.0/" class="H_VERSION"><span property="name">4.1.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/gravity-pdf/4.1.0/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pdf_parser</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="696"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/all/" title="All">All <span class="count badge">696</span></a></li><li class="" data-id="new" data-count="26"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/new/" title="New">New <span class="count badge">26</span></a></li><li class="" data-id="hooks" data-count="177"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/hooks/" title="Hooks">Hooks <span class="count badge">177</span></a></li><li class="" data-id="action" data-count="15"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/actions/" title="Actions">Actions <span class="count badge">15</span></a></li><li class="" data-id="filter" data-count="162"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/filters/" title="Filters">Filters <span class="count badge">162</span></a></li><li class="active" data-id="class" data-count="411"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/classes/" title="Classes">Classes <span class="count badge">411</span></a></li><li class="" data-id="constant" data-count="64"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/constants/" title="Constants">Constants <span class="count badge">64</span></a></li><li class="" data-id="function" data-count="43"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/functions/" title="Functions">Functions <span class="count badge">43</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>pdf_parser</strong></h1><p>Class pdf_parser.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/files/vendor-setasign-fpdi-pdf-parser/" class="file">/vendor/setasign/fpdi/pdf_parser.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="14" class="block" start="14"><li><div>class pdf_parser&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_NULL = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_NUMERIC = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_TOKEN = 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_HEX = 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_STRING = 4;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_DICTIONARY = 5;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_ARRAY = 6;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_OBJDEC = 7;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_OBJREF = 8;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_OBJECT = 9;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_STREAM = 10;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_BOOLEAN = 11;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Type constant&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var integer&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TYPE_REAL = 12;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Define the amount of byte in which the initial keyword of a PDF document should be searched.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static public $searchForStartxrefLength = 5500;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Filename&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $filename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * File resource&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var resource&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $_f;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * PDF Context&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var pdf_context&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $_c;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * xref-Data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $_xref;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Data of the Root object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $_root;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * PDF version of the loaded document&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $_pdfVersion;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * For reading encrypted documents and xref/object streams are in use&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var boolean&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $_readPlain = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The current read object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $_currentObj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $filename Source filename&nbsp;</div></li><li><div>     * @throws InvalidArgumentException&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct($filename)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;filename = $filename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_f = @fopen($this-&gt;filename, 'rb');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$this-&gt;_f) {&nbsp;</div></li><li><div>            throw new InvalidArgumentException(sprintf('Cannot open %s !', $filename));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;getPdfVersion();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!class_exists('pdf_context')) {&nbsp;</div></li><li><div>            require_once('pdf_context.php');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;_c = new pdf_context($this-&gt;_f);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Read xref-Data&nbsp;</div></li><li><div>        $this-&gt;_xref = array();&nbsp;</div></li><li><div>        $this-&gt;_readXref($this-&gt;_xref, $this-&gt;_findXref());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for Encryption&nbsp;</div></li><li><div>        $this-&gt;getEncryption();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Read root&nbsp;</div></li><li><div>        $this-&gt;_readRoot();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Destructor&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __destruct()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;closeFile();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Close the opened file&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function closeFile()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_f) && is_resource($this-&gt;_f)) {&nbsp;</div></li><li><div>            fclose($this-&gt;_f);&nbsp;</div></li><li><div>            unset($this-&gt;_f);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check Trailer for Encryption&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @throws Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function getEncryption()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (isset($this-&gt;_xref['trailer'][1]['/Encrypt'])) {&nbsp;</div></li><li><div>            throw new Exception('File is encrypted!');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get PDF-Version&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function getPdfVersion()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;_pdfVersion === null) {&nbsp;</div></li><li><div>            fseek($this-&gt;_f, 0);&nbsp;</div></li><li><div>            preg_match('/\d\.\d/', fread($this-&gt;_f, 16), $m);&nbsp;</div></li><li><div>            if (isset($m[0]))&nbsp;</div></li><li><div>                $this-&gt;_pdfVersion = $m[0];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_pdfVersion;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Read the /Root dictionary&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _readRoot()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;_xref['trailer'][1]['/Root'][0] != self::TYPE_OBJREF) {&nbsp;</div></li><li><div>            throw new Exception('Wrong Type of Root-Element! Must be an indirect reference');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_root = $this-&gt;resolveObject($this-&gt;_xref['trailer'][1]['/Root']);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Find the xref table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return integer&nbsp;</div></li><li><div>     * @throws Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _findXref()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $toRead = self::$searchForStartxrefLength;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $stat = fseek($this-&gt;_f, -$toRead, SEEK_END);&nbsp;</div></li><li><div>        if ($stat === -1) {&nbsp;</div></li><li><div>            fseek($this-&gt;_f, 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = fread($this-&gt;_f, $toRead);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $keywordPos = strpos(strrev($data), strrev('startxref'));&nbsp;</div></li><li><div>        if (false === $keywordPos) {&nbsp;</div></li><li><div>            $keywordPos = strpos(strrev($data), strrev('startref'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (false === $keywordPos) {&nbsp;</div></li><li><div>            throw new Exception('Unable to find &quot;startxref&quot; keyword.');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pos = strlen($data) - $keywordPos;&nbsp;</div></li><li><div>        $data = substr($data, $pos);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!preg_match('/\s*(\d+).*$/s', $data, $matches)) {&nbsp;</div></li><li><div>            throw new Exception('Unable to find pointer to xref table.');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return (int) $matches[1];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Read the xref table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $result Array of xref table entries&nbsp;</div></li><li><div>     * @param integer $offset of xref table&nbsp;</div></li><li><div>     * @return boolean&nbsp;</div></li><li><div>     * @throws Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _readXref(&$result, $offset)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $tempPos = $offset - min(20, $offset);&nbsp;</div></li><li><div>        fseek($this-&gt;_f, $tempPos); // set some bytes backwards to fetch corrupted docs&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = fread($this-&gt;_f, 100);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $xrefPos = strrpos($data, 'xref');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($xrefPos === false) {&nbsp;</div></li><li><div>            $this-&gt;_c-&gt;reset($offset);&nbsp;</div></li><li><div>            $xrefStreamObjDec = $this-&gt;_readValue($this-&gt;_c);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (is_array($xrefStreamObjDec) && isset($xrefStreamObjDec[0]) && $xrefStreamObjDec[0] == self::TYPE_OBJDEC) {&nbsp;</div></li><li><div>                throw new Exception(&nbsp;</div></li><li><div>                    sprintf(&nbsp;</div></li><li><div>                        'This document (%s) probably uses a compression technique which is not supported by the ' .&nbsp;</div></li><li><div>                        'free parser shipped with FPDI. (See https://www.setasign.com/fpdi-pdf-parser for more details)', &nbsp;</div></li><li><div>                        $this-&gt;filename&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                throw new Exception('Unable to find xref table.');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!isset($result['xrefLocation'])) {&nbsp;</div></li><li><div>            $result['xrefLocation'] = $tempPos + $xrefPos;&nbsp;</div></li><li><div>            $result['maxObject'] = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $cycles = -1;&nbsp;</div></li><li><div>        $bytesPerCycle = 100;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        fseek($this-&gt;_f, $tempPos = $tempPos + $xrefPos + 4); // set the handle directly after the &quot;xref&quot;-keyword&nbsp;</div></li><li><div>        $data = fread($this-&gt;_f, $bytesPerCycle);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (($trailerPos = strpos($data, 'trailer', max($bytesPerCycle * $cycles++, 0))) === false && !feof($this-&gt;_f)) {&nbsp;</div></li><li><div>            $data .= fread($this-&gt;_f, $bytesPerCycle);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($trailerPos === false) {&nbsp;</div></li><li><div>            throw new Exception('Trailer keyword not found after xref table');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = ltrim(substr($data, 0, $trailerPos));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get Line-Ending&nbsp;</div></li><li><div>        $found = preg_match_all(&quot;/(\r\n|\n|\r)/&quot;, substr($data, 0, 100), $m); // check the first 100 bytes for line breaks&nbsp;</div></li><li><div>        if ($found === 0) {&nbsp;</div></li><li><div>            throw new Exception('Xref table seems to be corrupted.');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $differentLineEndings = count(array_unique($m[0]));&nbsp;</div></li><li><div>        if ($differentLineEndings &gt; 1) {&nbsp;</div></li><li><div>            $lines = preg_split(&quot;/(\r\n|\n|\r)/&quot;, $data, -1, PREG_SPLIT_NO_EMPTY);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $lines = explode($m[0][0], $data);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $differentLineEndings = $m = null;&nbsp;</div></li><li><div>        unset($data, $differentLineEndings, $m);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $linesCount = count($lines);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $start = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $linesCount; $i++) {&nbsp;</div></li><li><div>            $line = trim($lines[$i]);&nbsp;</div></li><li><div>            if ($line) {&nbsp;</div></li><li><div>                $pieces = explode(' ', $line);&nbsp;</div></li><li><div>                $c = count($pieces);&nbsp;</div></li><li><div>                switch($c) {&nbsp;</div></li><li><div>                    case 2:&nbsp;</div></li><li><div>                        $start = (int)$pieces[0];&nbsp;</div></li><li><div>                        $end = $start + (int)$pieces[1];&nbsp;</div></li><li><div>                        if ($end &gt; $result['maxObject'])&nbsp;</div></li><li><div>                            $result['maxObject'] = $end;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 3:&nbsp;</div></li><li><div>                        if (!isset($result['xref'][$start]))&nbsp;</div></li><li><div>                            $result['xref'][$start] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (!array_key_exists($gen = (int) $pieces[1], $result['xref'][$start])) {&nbsp;</div></li><li><div>                            $result['xref'][$start][$gen] = $pieces[2] == 'n' ? (int) $pieces[0] : null;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $start++;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        throw new Exception('Unexpected data in xref table');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lines = $pieces = $line = $start = $end = $gen = null;&nbsp;</div></li><li><div>        unset($lines, $pieces, $line, $start, $end, $gen);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_c-&gt;reset($tempPos + $trailerPos + 7);&nbsp;</div></li><li><div>        $trailer = $this-&gt;_readValue($this-&gt;_c);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!isset($result['trailer'])) {&nbsp;</div></li><li><div>            $result['trailer'] = $trailer;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($trailer[1]['/Prev'])) {&nbsp;</div></li><li><div>            $this-&gt;_readXref($result, $trailer[1]['/Prev'][1]);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $trailer = null;&nbsp;</div></li><li><div>        unset($trailer);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reads a PDF value&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param pdf_context $c&nbsp;</div></li><li><div>     * @param string $token A token&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     * @throws Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _readValue(&$c, $token = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (is_null($token)) {&nbsp;</div></li><li><div>            $token = $this-&gt;_readToken($c);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($token === false) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ($token) {&nbsp;</div></li><li><div>            case '&lt;':&nbsp;</div></li><li><div>                // This is a hex string.&nbsp;</div></li><li><div>                // Read the value, then the terminator&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pos = $c-&gt;offset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                while(1) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $match = strpos($c-&gt;buffer, '&gt;', $pos);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // If you can't find it, try&nbsp;</div></li><li><div>                    // reading more data from the stream&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($match === false) {&nbsp;</div></li><li><div>                        if (!$c-&gt;increaseLength()) {&nbsp;</div></li><li><div>                            return false;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result = substr($c-&gt;buffer, $c-&gt;offset, $match - $c-&gt;offset);&nbsp;</div></li><li><div>                    $c-&gt;offset = $match + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    return array (self::TYPE_HEX, $result);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case '&lt;&lt;':&nbsp;</div></li><li><div>                // This is a dictionary.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $result = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Recurse into this function until we reach&nbsp;</div></li><li><div>                // the end of the dictionary.&nbsp;</div></li><li><div>                while (($key = $this-&gt;_readToken($c)) !== '&gt;&gt;') {&nbsp;</div></li><li><div>                    if ($key === false) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (($value =   $this-&gt;_readValue($c)) === false) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Catch missing value&nbsp;</div></li><li><div>                    if ($value[0] == self::TYPE_TOKEN && $value[1] == '&gt;&gt;') {&nbsp;</div></li><li><div>                        $result[$key] = array(self::TYPE_NULL);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result[$key] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return array (self::TYPE_DICTIONARY, $result);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case '[':&nbsp;</div></li><li><div>                // This is an array.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $result = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Recurse into this function until we reach&nbsp;</div></li><li><div>                // the end of the array.&nbsp;</div></li><li><div>                while (($token = $this-&gt;_readToken($c)) !== ']') {&nbsp;</div></li><li><div>                    if ($token === false) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (($value = $this-&gt;_readValue($c, $token)) === false) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result[] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return array (self::TYPE_ARRAY, $result);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case '(':&nbsp;</div></li><li><div>                // This is a string&nbsp;</div></li><li><div>                $pos = $c-&gt;offset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $openBrackets = 1;&nbsp;</div></li><li><div>                do {&nbsp;</div></li><li><div>                    for (; $openBrackets != 0 && $pos &lt; $c-&gt;length; $pos++) {&nbsp;</div></li><li><div>                        switch (ord($c-&gt;buffer[$pos])) {&nbsp;</div></li><li><div>                            case 0x28: // '('&nbsp;</div></li><li><div>                                $openBrackets++;&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                            case 0x29: // ')'&nbsp;</div></li><li><div>                                $openBrackets--;&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                            case 0x5C: // backslash&nbsp;</div></li><li><div>                                $pos++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } while($openBrackets != 0 && $c-&gt;increaseLength());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $result = substr($c-&gt;buffer, $c-&gt;offset, $pos - $c-&gt;offset - 1);&nbsp;</div></li><li><div>                $c-&gt;offset = $pos;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return array (self::TYPE_STRING, $result);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'stream':&nbsp;</div></li><li><div>                $tempPos = $c-&gt;getPos() - strlen($c-&gt;buffer);&nbsp;</div></li><li><div>                $tempOffset = $c-&gt;offset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $c-&gt;reset($startPos = $tempPos + $tempOffset);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Find the first &quot;newline&quot;&nbsp;</div></li><li><div>                while ($c-&gt;buffer[0] !== chr(10) && $c-&gt;buffer[0] !== chr(13)) {&nbsp;</div></li><li><div>                    $c-&gt;reset(++$startPos);&nbsp;</div></li><li><div>                    if ($c-&gt;ensureContent() === false) {&nbsp;</div></li><li><div>                        throw new Exception(&nbsp;</div></li><li><div>                            'Unable to parse stream data. No newline followed the stream keyword.'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $e = 0; // ensure line breaks in front of the stream&nbsp;</div></li><li><div>                if ($c-&gt;buffer[0] == chr(10) || $c-&gt;buffer[0] == chr(13))&nbsp;</div></li><li><div>                    $e++;&nbsp;</div></li><li><div>                if ($c-&gt;buffer[1] == chr(10) && $c-&gt;buffer[0] != chr(10))&nbsp;</div></li><li><div>                    $e++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($this-&gt;_currentObj[1][1]['/Length'][0] == self::TYPE_OBJREF) {&nbsp;</div></li><li><div>                    $tmpLength = $this-&gt;resolveObject($this-&gt;_currentObj[1][1]['/Length']);&nbsp;</div></li><li><div>                    $length = $tmpLength[1][1];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $length = $this-&gt;_currentObj[1][1]['/Length'][1];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($length &gt; 0) {&nbsp;</div></li><li><div>                    $c-&gt;reset($startPos + $e, $length);&nbsp;</div></li><li><div>                    $v = $c-&gt;buffer;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $v = '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $c-&gt;reset($startPos + $e + $length);&nbsp;</div></li><li><div>                $endstream = $this-&gt;_readToken($c);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($endstream != 'endstream') {&nbsp;</div></li><li><div>                    $c-&gt;reset($startPos + $e + $length + 9); // 9 = strlen(&quot;endstream&quot;)&nbsp;</div></li><li><div>                    // We don't throw an error here because the next&nbsp;</div></li><li><div>                    // round trip will start at a new offset&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return array(self::TYPE_STREAM, $v);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                if (is_numeric($token)) {&nbsp;</div></li><li><div>                    // A numeric token. Make sure that&nbsp;</div></li><li><div>                    // it is not part of something else.&nbsp;</div></li><li><div>                    if (($tok2 = $this-&gt;_readToken($c)) !== false) {&nbsp;</div></li><li><div>                        if (is_numeric($tok2)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Two numeric tokens in a row.&nbsp;</div></li><li><div>                            // In this case, we're probably in&nbsp;</div></li><li><div>                            // front of either an object reference&nbsp;</div></li><li><div>                            // or an object specification.&nbsp;</div></li><li><div>                            // Determine the case and return the data&nbsp;</div></li><li><div>                            if (($tok3 = $this-&gt;_readToken($c)) !== false) {&nbsp;</div></li><li><div>                                switch ($tok3) {&nbsp;</div></li><li><div>                                    case 'obj':&nbsp;</div></li><li><div>                                        return array(self::TYPE_OBJDEC, (int)$token, (int)$tok2);&nbsp;</div></li><li><div>                                    case 'R':&nbsp;</div></li><li><div>                                        return array(self::TYPE_OBJREF, (int)$token, (int)$tok2);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                // If we get to this point, that numeric value up&nbsp;</div></li><li><div>                                // there was just a numeric value. Push the extra&nbsp;</div></li><li><div>                                // tokens back into the stack and return the value.&nbsp;</div></li><li><div>                                array_push($c-&gt;stack, $tok3);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        array_push($c-&gt;stack, $tok2);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($token === (string)((int)$token))&nbsp;</div></li><li><div>                        return array(self::TYPE_NUMERIC, (int)$token);&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        return array(self::TYPE_REAL, (float)$token);&nbsp;</div></li><li><div>                } else if ($token == 'true' || $token == 'false') {&nbsp;</div></li><li><div>                    return array(self::TYPE_BOOLEAN, $token == 'true');&nbsp;</div></li><li><div>                } else if ($token == 'null') {&nbsp;</div></li><li><div>                   return array(self::TYPE_NULL);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // Just a token. Return it.&nbsp;</div></li><li><div>                    return array(self::TYPE_TOKEN, $token);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>         }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Resolve an object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $objSpec The object-data&nbsp;</div></li><li><div>     * @return array|boolean&nbsp;</div></li><li><div>     * @throws Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function resolveObject($objSpec)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $c = $this-&gt;_c;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Exit if we get invalid data&nbsp;</div></li><li><div>        if (!is_array($objSpec)) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($objSpec[0] == self::TYPE_OBJREF) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // This is a reference, resolve it&nbsp;</div></li><li><div>            if (isset($this-&gt;_xref['xref'][$objSpec[1]][$objSpec[2]])) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Save current file position&nbsp;</div></li><li><div>                // This is needed if you want to resolve&nbsp;</div></li><li><div>                // references while you're reading another object&nbsp;</div></li><li><div>                // (e.g.: if you need to determine the length&nbsp;</div></li><li><div>                // of a stream)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $oldPos = $c-&gt;getPos();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Reposition the file pointer and&nbsp;</div></li><li><div>                // load the object header.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $c-&gt;reset($this-&gt;_xref['xref'][$objSpec[1]][$objSpec[2]]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $header = $this-&gt;_readValue($c);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($header[0] != self::TYPE_OBJDEC || $header[1] != $objSpec[1] || $header[2] != $objSpec[2]) {&nbsp;</div></li><li><div>                    $toSearchFor = $objSpec[1] . ' ' . $objSpec[2] . ' obj';&nbsp;</div></li><li><div>                    if (preg_match('/' . $toSearchFor . '/', $c-&gt;buffer)) {&nbsp;</div></li><li><div>                        $c-&gt;offset = strpos($c-&gt;buffer, $toSearchFor) + strlen($toSearchFor);&nbsp;</div></li><li><div>                        // reset stack&nbsp;</div></li><li><div>                        $c-&gt;stack = array();&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        throw new Exception(&nbsp;</div></li><li><div>                            sprintf(&quot;Unable to find object (%s, %s) at expected location.&quot;, $objSpec[1], $objSpec[2])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // If we're being asked to store all the information&nbsp;</div></li><li><div>                // about the object, we add the object ID and generation&nbsp;</div></li><li><div>                // number for later use&nbsp;</div></li><li><div>                $result = array (&nbsp;</div></li><li><div>                    self::TYPE_OBJECT, &nbsp;</div></li><li><div>                    'obj' =&gt; $objSpec[1], &nbsp;</div></li><li><div>                    'gen' =&gt; $objSpec[2]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;_currentObj =& $result;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Now simply read the object data until&nbsp;</div></li><li><div>                // we encounter an end-of-object marker&nbsp;</div></li><li><div>                while (true) {&nbsp;</div></li><li><div>                    $value = $this-&gt;_readValue($c);&nbsp;</div></li><li><div>                    if ($value === false || count($result) &gt; 4) {&nbsp;</div></li><li><div>                        // in this case the parser couldn't find an &quot;endobj&quot; so we break here&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($value[0] == self::TYPE_TOKEN && $value[1] === 'endobj') {&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result[] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $c-&gt;reset($oldPos);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (isset($result[2][0]) && $result[2][0] == self::TYPE_STREAM) {&nbsp;</div></li><li><div>                    $result[0] = self::TYPE_STREAM;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                throw new Exception(&nbsp;</div></li><li><div>                    sprintf(&quot;Unable to find object (%s, %s) at expected location.&quot;, $objSpec[1], $objSpec[2])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $result;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $objSpec;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reads a token from the context&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param pdf_context $c&nbsp;</div></li><li><div>     * @return mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _readToken($c)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // If there is a token available&nbsp;</div></li><li><div>        // on the stack, pop it out and&nbsp;</div></li><li><div>        // return it.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (count($c-&gt;stack)) {&nbsp;</div></li><li><div>            return array_pop($c-&gt;stack);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Strip away any whitespace&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do {&nbsp;</div></li><li><div>            if (!$c-&gt;ensureContent()) {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $c-&gt;offset += strspn($c-&gt;buffer, &quot;\x20\x0A\x0C\x0D\x09\x00&quot;, $c-&gt;offset);&nbsp;</div></li><li><div>        } while ($c-&gt;offset &gt;= $c-&gt;length - 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the first character in the stream&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $char = $c-&gt;buffer[$c-&gt;offset++];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ($char) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case '[':&nbsp;</div></li><li><div>            case ']':&nbsp;</div></li><li><div>            case '(':&nbsp;</div></li><li><div>            case ')':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // This is either an array or literal string&nbsp;</div></li><li><div>                // delimiter, Return it&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $char;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case '&lt;':&nbsp;</div></li><li><div>            case '&gt;':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // This could either be a hex string or&nbsp;</div></li><li><div>                // dictionary delimiter. Determine the&nbsp;</div></li><li><div>                // appropriate case and return the token&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($c-&gt;buffer[$c-&gt;offset] == $char) {&nbsp;</div></li><li><div>                    if (!$c-&gt;ensureContent()) {&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $c-&gt;offset++;&nbsp;</div></li><li><div>                    return $char . $char;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return $char;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case '%':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // This is a comment - jump over it!&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $pos = $c-&gt;offset;&nbsp;</div></li><li><div>                while(1) {&nbsp;</div></li><li><div>                    $match = preg_match(&quot;/(\r\n|\r|\n)/&quot;, $c-&gt;buffer, $m, PREG_OFFSET_CAPTURE, $pos);&nbsp;</div></li><li><div>                    if ($match === 0) {&nbsp;</div></li><li><div>                        if (!$c-&gt;increaseLength()) {&nbsp;</div></li><li><div>                            return false;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            continue;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $c-&gt;offset = $m[0][1] + strlen($m[0][0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    return $this-&gt;_readToken($c);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // This is &quot;another&quot; type of token (probably&nbsp;</div></li><li><div>                // a dictionary entry or a numeric value)&nbsp;</div></li><li><div>                // Find the end and return it.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (!$c-&gt;ensureContent()) {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                while(1) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Determine the length of the token&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $pos = strcspn($c-&gt;buffer, &quot;\x20%[]&lt;&gt;()/\x0A\x0C\x0D\x09\x00&quot;, $c-&gt;offset);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($c-&gt;offset + $pos &lt;= $c-&gt;length - 1) {&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        // If the script reaches this point, &nbsp;</div></li><li><div>                        // the token may span beyond the end&nbsp;</div></li><li><div>                        // of the current buffer. Therefore, &nbsp;</div></li><li><div>                        // we increase the size of the buffer&nbsp;</div></li><li><div>                        // and try again--just to be safe.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $c-&gt;increaseLength();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $result = substr($c-&gt;buffer, $c-&gt;offset - 1, $pos + 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $c-&gt;offset += $pos;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $result;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Un-filter a stream object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $obj&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     * @throws Exception&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _unFilterStream($obj)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $filters = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($obj[1][1]['/Filter'])) {&nbsp;</div></li><li><div>            $filter = $obj[1][1]['/Filter'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($filter[0] == pdf_parser::TYPE_OBJREF) {&nbsp;</div></li><li><div>                $tmpFilter = $this-&gt;resolveObject($filter);&nbsp;</div></li><li><div>                $filter = $tmpFilter[1];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($filter[0] == pdf_parser::TYPE_TOKEN) {&nbsp;</div></li><li><div>                $filters[] = $filter;&nbsp;</div></li><li><div>            } else if ($filter[0] == pdf_parser::TYPE_ARRAY) {&nbsp;</div></li><li><div>                $filters = $filter[1];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $stream = $obj[2][1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($filters AS $filter) {&nbsp;</div></li><li><div>            switch ($filter[1]) {&nbsp;</div></li><li><div>                case '/FlateDecode':&nbsp;</div></li><li><div>                case '/Fl':&nbsp;</div></li><li><div>                    if (function_exists('gzuncompress')) {&nbsp;</div></li><li><div>                        $oStream = $stream;&nbsp;</div></li><li><div>                        $stream = (strlen($stream) &gt; 0) ? @gzuncompress($stream) : '';&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        throw new Exception(&nbsp;</div></li><li><div>                            sprintf('To handle %s filter, please compile php with zlib support.', $filter[1])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($stream === false) {&nbsp;</div></li><li><div>                        $tries = 0;&nbsp;</div></li><li><div>                        while ($tries &lt; 8 && ($stream === false || strlen($stream) &lt; strlen($oStream))) {&nbsp;</div></li><li><div>                            $oStream = substr($oStream, 1);&nbsp;</div></li><li><div>                            $stream = @gzinflate($oStream);&nbsp;</div></li><li><div>                            $tries++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($stream === false) {&nbsp;</div></li><li><div>                            throw new Exception('Error while decompressing stream.');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case '/LZWDecode':&nbsp;</div></li><li><div>                    if (!class_exists('FilterLZW')) {&nbsp;</div></li><li><div>                        require_once('filters/FilterLZW.php');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $decoder = new FilterLZW();&nbsp;</div></li><li><div>                    $stream = $decoder-&gt;decode($stream);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case '/ASCII85Decode':&nbsp;</div></li><li><div>                    if (!class_exists('FilterASCII85')) {&nbsp;</div></li><li><div>                        require_once('filters/FilterASCII85.php');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $decoder = new FilterASCII85();&nbsp;</div></li><li><div>                    $stream = $decoder-&gt;decode($stream);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case '/ASCIIHexDecode':&nbsp;</div></li><li><div>                    if (!class_exists('FilterASCIIHexDecode')) {&nbsp;</div></li><li><div>                        require_once('filters/FilterASCIIHexDecode.php');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $decoder = new FilterASCIIHexDecode();&nbsp;</div></li><li><div>                    $stream = $decoder-&gt;decode($stream);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case null:&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    throw new Exception(sprintf('Unsupported Filter: %s', $filter[1]));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $stream;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.0.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/classes/pdf_parser/" class="">4.1.1</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/classes/pdf_parser/" class="active">4.1.0</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.0.6/classes/pdf_parser/" class="">4.0.6</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.0.5/classes/pdf_parser/" class="">4.0.5</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.0.4/classes/pdf_parser/" class="">4.0.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>pdf_parser</li><li><span></span>Gravity PDF</li><li><span></span>4.1.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>